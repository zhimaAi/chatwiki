import{_ as us}from"./cu-scroll-D6f5DzhK.js";import{_ as $e,aB as Ps,aC as ds,aD as rs,aE as Bs,aF as Qe,aG as Ks,d as Ut,aH as Ys,am as Tt,aI as _s,aJ as Ws,aK as Vs,aL as Qs,aM as js,c as zt,aN as je,aO as Js,aP as Xs,a4 as Zs,aQ as eo,aR as to,aa as ss,a as so,aS as oo,ax as lo,aT as no,ap as ao,aU as io,aV as uo,aW as ro,aX as _o,aY as co}from"../../index-WMhSApoa.js";import{e as ge,r as ie,q as cs,ac as i,ad as l,k as e,ar as s,as as t,n as vt,ae as D,az as f,u as S,at as y,F as H,ax as ce,G as m,B as de,av as Ft,aw as Ze,f as p,o as Mt,ah as ps,ai as fe,af as po,J as Dt,b as fo,A as os}from"./vue-chunks-CGLjTDrY.js";import{E as vo,v as Gt,a9 as mo,ae as yt,bz as yo,bA as go,af as ho,bB as ko,G as fs,b as U,M as re,W as Je,o as vs,T as Et,y as et,z as tt,D as ms,av as bo,I as Ue,a6 as Fe,a0 as Ve,k as ys,ar as mt,h as gs,i as hs,B as Nt,am as ks,bC as wo,aT as xo,d as We,F as Xe,e as gt,w as bs,x as ws,V as Co,aQ as xs,bn as $o,bD as So,Q as Lo,aM as qo,a5 as Oo,bu as Ro,al as Io,ai as qt,aR as ct,bE as Ot,bF as Mo,aN as Do,az as Uo,ab as To,$ as zo}from"./ui-antd-BDReVt-O.js";import{E as Fo}from"./edit-subsection-Cun0tbhJ.js";import{_ as Cs,R as Go}from"./rename-modal-9CflFQCv.js";import{U as $s}from"./upload-input-XJmNWAIQ.js";import{t as ls}from"./validate-8MtiUsxW.js";import{M as ns}from"./model-select-DEPDrkCY.js";import{O as Eo}from"./open-grapg-modal-BJCGWmt2.js";import{_ as No}from"./page-alert-Dnjj-jJ2.js";import{d as Ho}from"./vuedraggable.umd--yFJy9Bz.js";const Ao={class:"subsection-box"},Po=["onDblclick"],Bo={class:"list-item"},Ko={class:"list-content"},Yo={class:"status-error"},Wo=["onClick","innerHTML"],Vo={class:"similar-question-list"},Qo={class:"list-item list-item-answer"},jo=["innerHTML"],Jo={class:"fragment-img"},Xo=["src"],Zo={class:"zm-line1"},el={class:"zm-line1"},tl={class:"right-opration"},sl=["onClick"],ol=["onClick"],ll=["onClick"],nl=["onClick"],al={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(Z,{expose:A,emit:ee}){const P=ee,w=Z,J=ge(()=>{var x,G;return((G=(x=w.paragraphLists)==null?void 0:x[0])==null?void 0:G.meta_list)||[]}),O=ie({selectedRowKeys:[]}),q=x=>{O.selectedRowKeys=x},C=()=>{O.selectedRowKeys=[]},g=x=>{P("openEditSubscription",x)},T=x=>{re.confirm({title:"提示",icon:e(Je),content:"确认是否删除该问答?",onOk(){return new Promise((G,E)=>{ds({id:x}).then(X=>{U.success("删除成功"),P("handleDelParagraph",x),G()}).catch(()=>{G()})})},onCancel(){}})},$=(x,G)=>{Ps({id:x.id,category_id:G}).then(E=>{U.success("设置成功"),P("getList")})},_=(x,G,E)=>{let X=E.field,F=E.order;F?F=F==="ascend"?"asc":"desc":X="",P("handleSort",{sort_field:X,sort_type:F})};function K(x,G,E={}){if(!G||!x)return x;const{highlightClass:X="highlight",caseSensitive:F=!1,wholeWord:R=!1}=E,I=F?"g":"gi";let a;return R?a=new RegExp(`\\b${v(G)}\\b`,I):a=new RegExp(v(G),I),x.replace(a,r=>`<span class="${X}">${r}</span>`)}function v(x){return x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return A({handleOpenEditModal:g,state:O,resetSelect:C}),(x,G)=>{const E=Gt,X=yt,F=vo,R=fs,I=cs("viewer");return l(),i("div",Ao,[e(R,{"data-source":Z.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:O.selectedRowKeys,onChange:q},pagination:!1,loading:w.isLoading,scroll:{x:1200},onChange:_},{default:s(()=>[e(F,{key:"id","data-index":"id",width:700},{title:s(()=>[m("问答（共"+y(w.total)+"个）",1)]),default:s(({record:a})=>[t("div",{class:"qa-list-box",onDblclick:r=>g(a)},[t("div",Bo,[G[0]||(G[0]=t("div",{class:"list-label"},"问题",-1)),t("div",Ko,[a.status==2?(l(),D(E,{key:0,placement:"top"},{title:s(()=>[t("span",null,y(a.errmsg),1)]),default:s(()=>[t("span",null,[t("span",Yo,[e(S(mo))])])]),_:2},1024)):f("",!0),t("span",{onClick:r=>g(a),innerHTML:K(a.question,w.search),class:"question-text"},null,8,Wo),a.similar_questions&&a.similar_questions.length?(l(),D(X,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[t("div",Vo,[(l(!0),i(H,null,ce(a.similar_questions,(r,M)=>(l(),i("div",{class:"similar-question-list-item",key:M},y(r),1))),128))])]),title:s(()=>[t("span",null,"共 "+y(a.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[t("a",null,"（"+y(a.similar_questions.length)+"）",1)]),_:2},1024)):f("",!0)])]),t("div",Qo,[G[1]||(G[1]=t("div",{class:"list-label"},"答案",-1)),t("div",{class:"list-content",innerHTML:K(a.answer,w.search)},null,8,jo)]),vt((l(),i("div",Jo,[(l(!0),i(H,null,ce(a.images,(r,M)=>(l(),i("img",{key:M,src:r,alt:""},null,8,Xo))),128))])),[[I]])],40,Po)]),_:1}),e(F,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),e(F,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),e(F,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),(l(!0),i(H,null,ce(J.value,a=>(l(),D(F,{key:`meta_${a.key}`,"data-index":`meta_${a.key}`,width:160},{title:s(()=>{var r;return[e(E,{title:((r=a.name)==null?void 0:r.length)>8?a.name:""},{default:s(()=>[t("div",Zo,y(a.name),1)]),_:2},1032,["title"])]}),default:s(({record:r})=>{var M;return[e(E,{title:((M=r[`meta_${a.key}`])==null?void 0:M.length)>8?r[`meta_${a.key}`]:""},{default:s(()=>[t("div",el,y(r[`meta_${a.key}`]),1)]),_:2},1032,["title"])]}),_:2},1032,["data-index"]))),128)),e(F,{title:"操作",key:"action","data-index":"action",width:120,fixed:"right"},{default:s(({record:a,index:r})=>[t("div",tl,[a.category_id>0?(l(),i("div",{key:0,class:"hover-btn-box",onClick:M=>$(a,0)},[e(S(yo),{style:{color:"#F59A23"}})],8,sl)):(l(),i("div",{key:1,class:"hover-btn-box",onClick:M=>$(a,4)},[e(S(go))],8,ol)),t("div",{class:"hover-btn-box",onClick:de(M=>g(a),["stop"])},[e(S(ho))],8,ll),t("div",{class:"hover-btn-box",onClick:de(M=>T(a.id),["stop"])},[e(S(ko))],8,nl)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},il=$e(al,[["__scopeId","data-v-1c35157d"]]),ul={class:"alert-box"},dl={class:"upload-file-box"},rl={key:0,class:"hight-set"},_l={key:0,class:"set-box"},cl={class:"form-item"},pl={class:"form-item-body"},fl={class:"form-item"},vl={class:"form-item-body"},ml={class:"form-item"},yl={class:"form-item-body"},gl={key:1,class:"set-box"},hl={class:"form-item"},kl={class:"form-item-body"},bl={class:"form-item"},wl={class:"form-item-body"},xl={class:"form-item"},Cl={class:"form-item-body"},$l={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=rs(),{qa_index_type:w}=P;Ft();const O=Ze().query,q=p(!1),C=p(!1),g=p([]),T=ee,$=p([]),_=Z,K=ge(()=>_.library_id||O.id),v=ie({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),x=p(!0),G=a=>{v.group_id=void 0,a>=0&&(v.group_id=a),q.value=!0},E=()=>{let a=new FormData;g.value.forEach(r=>{a.append("library_files",r)}),Bs(a).then(r=>{let M=[];for(let B in r.data)M.push({lable:r.data[B],value:B});$.value=M})},X=()=>{if(g.value.length==0){U.error("请选择文件");return}C.value=!0;let a=new FormData;a.append("library_id",K.value);let r=!1;if(g.value.forEach(M=>{(M.name.includes(".xlsx")||M.name.includes(".csv"))&&(r=!0),a.append("library_files",M)}),r){if(!v.question_column)return C.value=!1,U.error("请选择问题所在列");if(!v.answer_column)return C.value=!1,U.error("请选择答案所在列");a.append("question_column",v.question_column),a.append("answer_column",v.answer_column),v.similar_column&&a.append("similar_column",v.similar_column)}else a.append("question_lable",v.question_lable),a.append("answer_lable",v.answer_lable),a.append("similar_label",v.similar_label);a.append("group_id",v.group_id>=0?v.group_id:0),a.append("is_qa_doc",1),a.append("qa_index_type",w),Qe(a).then(M=>{T("ok"),q.value=!1,g.value=[],C.value=!1}).catch(()=>{C.value=!1})},F=()=>{g.value=[]},R=p(1),I=a=>{v.question_column=void 0,v.answer_column=void 0,v.similar_column=void 0,v.question_lable="问题：",v.answer_lable="答案：",v.similar_label="相似问法：",g.value=a,a&&a.length>0&&(a[0].type.includes(".document")?R.value=2:(R.value=1,E()))};return A({show:G}),(a,r)=>{const M=vs,B=tt,z=et,Y=Et,W=Ue,_e=re;return l(),i("div",null,[e(_e,{width:680,open:q.value,"onUpdate:open":r[9]||(r[9]=b=>q.value=b),"confirm-loading":C.value,maskClosable:!1,title:"上传文档",onOk:X,onCancel:F},{default:s(()=>[t("div",ul,[e(M,{"show-icon":""},{message:s(()=>[...r[10]||(r[10]=[t("div",null,[m(" 通过word或者Excel形式导入问答，建议您参考"),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),m("  "),t("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),m("创建导入文档 ")],-1),t("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),t("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])]),_:1})]),e(Y,{align:"center",style:{margin:"16px 0"}},{default:s(()=>[r[11]||(r[11]=t("div",null,"所属分组：",-1)),e(z,{value:v.group_id,"onUpdate:value":r[0]||(r[0]=b=>v.group_id=b),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(l(!0),i(H,null,ce(_.groupLists.filter(b=>b.id>=0),b=>(l(),D(B,{value:b.id},{default:s(()=>[m(y(b.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),t("div",dl,[e($s,{type:2,value:g.value,"onUpdate:value":r[1]||(r[1]=b=>g.value=b),onChange:I},null,8,["value"])]),g.value.length>0?(l(),i("div",rl,[t("a",{onClick:r[2]||(r[2]=b=>x.value=!x.value)},[r[12]||(r[12]=m("高级设置： ",-1)),x.value?(l(),D(S(bo),{key:1})):(l(),D(S(ms),{key:0}))]),x.value?(l(),i(H,{key:0},[R.value==1?(l(),i("div",_l,[t("div",cl,[r[13]||(r[13]=t("div",{class:"form-item-label required"},"问题所在列：",-1)),t("div",pl,[e(z,{value:v.question_column,"onUpdate:value":r[3]||(r[3]=b=>v.question_column=b),placeholder:"请选择列名",style:{width:"100%"}},{default:s(()=>[(l(!0),i(H,null,ce($.value,b=>(l(),D(B,{value:b.value,key:b.value},{default:s(()=>[m(y(b.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",fl,[r[14]||(r[14]=t("div",{class:"form-item-label"},"相似问法所在列：",-1)),t("div",vl,[e(z,{value:v.similar_column,"onUpdate:value":r[4]||(r[4]=b=>v.similar_column=b),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:s(()=>[(l(!0),i(H,null,ce($.value,b=>(l(),D(B,{value:b.value,key:b.value},{default:s(()=>[m(y(b.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",ml,[r[15]||(r[15]=t("div",{class:"form-item-label required"},"答案所在列：",-1)),t("div",yl,[e(z,{value:v.answer_column,"onUpdate:value":r[5]||(r[5]=b=>v.answer_column=b),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:s(()=>[(l(!0),i(H,null,ce($.value,b=>(l(),D(B,{value:b.value,key:b.value},{default:s(()=>[m(y(b.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):f("",!0),R.value==2?(l(),i("div",gl,[t("div",hl,[r[16]||(r[16]=t("div",{class:"form-item-label"},"问题开始标识符：",-1)),t("div",kl,[e(W,{placeholder:"请输入标识符",value:v.question_lable,"onUpdate:value":r[6]||(r[6]=b=>v.question_lable=b)},null,8,["value"])])]),t("div",bl,[r[17]||(r[17]=t("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),t("div",wl,[e(W,{placeholder:"请输入标识符",value:v.similar_label,"onUpdate:value":r[7]||(r[7]=b=>v.similar_label=b)},null,8,["value"])])]),t("div",xl,[r[18]||(r[18]=t("div",{class:"form-item-label"},"答案开始标识符：",-1)),t("div",Cl,[e(W,{placeholder:"请输入标识符",value:v.answer_lable,"onUpdate:value":r[8]||(r[8]=b=>v.answer_lable=b)},null,8,["value"])])])])):f("",!0)],64)):f("",!0)])):f("",!0)]),_:1},8,["open","confirm-loading"])])}}},Ss=$e($l,[["__scopeId","data-v-d745cbba"]]),Sl={class:"form-item"},Ll={class:"form-content"},ql={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=Ze().query,w=p(!1),J=ee,O=p("新建分组"),q=Z,C=ie({group_name:"",id:"",library_id:P.id}),g=$=>{C.group_name=$.group_name||"",C.id=$.id||"",O.value=$.id?"编辑分组":"新建分组",C.library_id=$.library_id,w.value=!0},T=()=>{if(!C.group_name)return U.error("请输入分组名称");Ks({...C,group_type:q.group_type}).then($=>{U.success(`${O.value}成功`),w.value=!1,J("ok")})};return A({show:g}),($,_)=>{const K=Ue,v=re;return l(),i("div",null,[e(v,{open:w.value,"onUpdate:open":_[1]||(_[1]=x=>w.value=x),title:O.value,onOk:T},{default:s(()=>[t("div",Sl,[_[2]||(_[2]=t("div",{class:"form-label"},"分组名称：",-1)),t("div",Ll,[e(K,{maxLength:15,value:C.group_name,"onUpdate:value":_[0]||(_[0]=x=>C.group_name=x),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Ls=$e(ql,[["__scopeId","data-v-853bcd54"]]),Ol={class:"qa-list-wrapper"},Rl={class:"group-head-box"},Il={class:"head-title"},Ml={class:"flex-between-box"},Dl={class:"search-box"},Ul={class:"classify-box"},Tl=["onClick"],zl={class:"classify-title"},Fl={class:"right-content"},Gl={key:0,class:"btn-box"},El={class:"hover-btn-wrap"},Nl=["onClick"],Hl=["onClick"],Al={class:"main-content-box"},Pl={class:"head-content"},Bl={class:"title"},Kl={class:"pover-group-content-box"},Yl={class:"group-head-box"},Wl={class:"head-title"},Vl={class:"flex-between-box"},Ql={class:"search-box"},jl={class:"classify-box classify-scroll-box"},Jl=["onClick"],Xl={class:"classify-title"},Zl={class:"right-content"},en={key:0,class:"btn-box"},tn={class:"hover-btn-wrap"},sn=["onClick"],on=["onClick"],ln={class:"btn-right-box"},nn={class:"des-content-block"},an={key:0,class:"alert-icon-box"},un={class:"content-block"},dn={class:"pagination-box"},as="qa_document_group_box_width",pt=180,Rt=256,rn={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(Z){const A=p(null),ee=p(null),w=Ze().query,J=p(""),O=p([]),q=p(-1),C=p([]),g=ge(()=>O.value.find(L=>L.id==q.value)||{}),T=ge(()=>O.value.filter(L=>L.group_name.includes(J.value))),$=Z,_=ge(()=>$.library_id||w.id),K=p([]),v=p(localStorage.getItem("qa_document_group_hide_key")==1),x=p(0),G=p(0),E={1:"本地文档",2:"在线文档",3:"自定义文档",4:"手工新增问答",5:"导入问答"},X={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},F=p({is_qa_doc:"1",library_id:_.value}),R=p({page:1,size:100}),I=ie({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:_.value,search:""}),a=L=>{I.sort_field=L.sort_field,I.sort_type=L.sort_type,r()},r=()=>{R.value.page=1,b()},M=(L,d)=>{R.value.page=L,R.value.size=d,b()},B=()=>{v.value=!v.value,localStorage.setItem("qa_document_group_hide_key",v.value?1:2)},z=()=>{Vs({id:_.value}).then(()=>{U.success("操作完成"),b()})},Y=p(null),W=L=>{L.group_id||q.value>=0&&(L.group_id=q.value),Y.value.showModal(JSON.parse(JSON.stringify(L)))},_e=p(!1),b=()=>{_e.value=!0,Ys({...R.value,...I,group_id:q.value}).then(L=>{_e.value=!1;let d=L.data,ye=d.list||[];ye.forEach(le=>{le.status_text=X[le.status],le.similar_questions&&(le.similar_questions=JSON.parse(le.similar_questions)),Array.isArray(le.meta_list)&&le.meta_list.forEach(ne=>{ne.type==1&&ne.value>0&&(ne.value=We(ne.value*1e3).format("YYYY-MM-DD HH:mm")),ne.key=="source"&&(ne.value=E[ne.value]),le[`meta_${ne.key}`]=ne.value})}),K.value=ye,x.value=d.total,G.value=d.exception_total,A.value&&A.value.resetSelect()})};b();const Re=()=>{Tt({library_id:_.value}).then(L=>{let ye=(L.data||[]).reduce((le,ne)=>le+ +ne.total,0);O.value=[{group_name:"全部分组",id:-1,total:ye},...L.data]})};Re();const he=p(null),te=L=>{he.value.show({...L,library_id:_.value})},ve=()=>{Re(),b()},Ie=L=>{q.value=L.id,r()},be=L=>{re.confirm({title:`确认删除分组${L.group_name}`,icon:e(Je),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){_s({id:L.id}).then(()=>{U.success("删除成功"),Re(),q.value==L.id&&(q.value=-1,r())})}})},Q=p(null),ht=()=>{Q.value.show(q.value)},pe=p(!1),we=ie({group_id:void 0,ids:""}),kt=()=>{if(A.value.state.selectedRowKeys.length==0)return U.error("请选择你要移动的问答");we.ids=A.value.state.selectedRowKeys.join(","),we.group_id=void 0,pe.value=!0},bt=()=>{if(A.value.state.selectedRowKeys.length==0)return U.error("请选择你要删除的问答");re.confirm({title:"提示",icon:e(Je),content:"确认是否删除所选问答?",onOk(){ds({id:A.value.state.selectedRowKeys.join(",")}).then(L=>{U.success("删除成功"),b()})},onCancel(){}})},ke=()=>{if(!we.group_id)return U.error("请选择分组");js({...we}).then(()=>{pe.value=!1,U.success("移动成功"),ve()})},Se=p(pt),Ge=p(!1);Mt(()=>{const L=parseInt(localStorage.getItem(as));L&&L>=pt&&L<=Rt&&(Se.value=L)});let me=!1,oe=0,Le=0;const wt=L=>{v.value||(me=!0,Ge.value=!0,oe=L.clientX,Le=Se.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Ee),document.addEventListener("mouseup",st))},Ee=L=>{if(!me)return;let d=Le+(L.clientX-oe);d=Math.max(pt,Math.min(Rt,d)),Se.value=d},st=()=>{me&&(me=!1,Ge.value=!1,localStorage.setItem(as,Se.value),document.body.style.cursor="",document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",st))},N=p(!1),xt=()=>{let L="";A.value.state.selectedRowKeys.length>0&&(L=A.value.state.selectedRowKeys.join(",")),Ws({library_id:w.id,export_type:2,group_id:q.value,data_ids:L}).then(d=>{N.value=!0})},ot=()=>{Qs.push({path:"/library/details/export-record",query:w})},lt=L=>{if(L==2){if(A.value.state.selectedRowKeys.length==0)return U.error("请选择你要修改的问答");C.value=A.value.state.selectedRowKeys}ee.value.show(L==2)};return(L,d)=>{const ye=Ut,le=Gt,ne=Ue,xe=hs,Ne=gs,He=ys,Ae=us,Ct=yt,Ce=Nt,nt=wo,$t=tt,St=et,Lt=Et,at=re,it=xo;return l(),i(H,null,[t("div",Ol,[t("div",{class:fe(["group-content-box",[{collapsed:v.value},{"no-transition":Ge.value}]]),style:ps(v.value?{}:{width:Se.value+"px",minWidth:pt+"px",maxWidth:Rt+"px"})},[t("div",Rl,[t("div",Il,[e(le,{title:"收起问答分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:B},[e(ye,{name:"put-away"})])]),_:1}),t("div",Ml,[d[18]||(d[18]=t("div",null,"问答分组",-1)),e(le,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:d[0]||(d[0]=k=>te({}))},[e(S(Fe))])]),_:1})])]),t("div",Dl,[e(ne,{value:J.value,"onUpdate:value":d[2]||(d[2]=k=>J.value=k),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[e(S(Ve),{onClick:d[1]||(d[1]=de(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",Ul,[e(Ae,{style:{"padding-right":"24px"}},{default:s(()=>[(l(!0),i(H,null,ce(T.value,k=>(l(),i("div",{class:fe(["classify-item",{active:k.id==q.value}]),onClick:Me=>Ie(k),key:k.id},[t("div",zl,y(k.group_name),1),t("div",Fl,[t("div",{class:fe(["num",{"num-block":k.id<=0}])},y(k.total),3),k.id>0?(l(),i("div",Gl,[e(He,{placement:"bottomRight"},{overlay:s(()=>[e(Ne,null,{default:s(()=>[e(xe,null,{default:s(()=>[t("div",{onClick:de(Me=>te(k),["stop"])},"重命名",8,Nl)]),_:2},1024),e(xe,null,{default:s(()=>[t("div",{onClick:de(Me=>be(k),["stop"])},"删 除",8,Hl)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",El,[e(S(mt))])]),_:2},1024)])):f("",!0)])],10,Tl))),128))]),_:1})]),v.value?f("",!0):(l(),i("div",{key:0,class:"resize-bar",onMousedown:wt},null,32))],6),t("div",Al,[e(Ae,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[t("div",Pl,[t("div",Bl,[v.value?(l(),D(Ct,{key:0,title:null,placement:"bottom"},{content:s(()=>[t("div",Kl,[t("div",Yl,[t("div",Wl,[t("div",Vl,[d[19]||(d[19]=t("div",null,"问答分组",-1)),e(le,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:d[3]||(d[3]=k=>te({}))},[e(S(Fe))])]),_:1})])]),t("div",Ql,[e(ne,{allowClear:"",value:J.value,"onUpdate:value":d[5]||(d[5]=k=>J.value=k),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[e(S(Ve),{onClick:d[4]||(d[4]=de(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",jl,[(l(!0),i(H,null,ce(T.value,k=>(l(),i("div",{class:fe(["classify-item",{active:k.id==q.value}]),onClick:Me=>Ie(k),key:k.id},[t("div",Xl,y(k.group_name),1),t("div",Zl,[t("div",{class:fe(["num",{"num-block":k.id<=0}])},y(k.total),3),k.id>0?(l(),i("div",en,[e(He,{placement:"bottomRight"},{overlay:s(()=>[e(Ne,null,{default:s(()=>[e(xe,null,{default:s(()=>[t("div",{onClick:de(Me=>te(k),["stop"])},"重命名",8,sn)]),_:2},1024),e(xe,null,{default:s(()=>[t("div",{onClick:de(Me=>be(k),["stop"])},"删 除",8,on)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",tn,[e(S(mt))])]),_:2},1024)])):f("",!0)])],10,Jl))),128))])])]),default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:B},[e(ye,{name:"expand"})])]),_:1})):f("",!0),t("div",null,y(g.value.group_name),1),t("div",ln,[t("div",null,[e(ne,{onChange:r,value:I.search,"onUpdate:value":d[6]||(d[6]=k=>I.search=k),placeholder:"搜索问答"},{suffix:s(()=>[e(S(Ve))]),_:1},8,["value"])]),e(Ce,{onClick:d[7]||(d[7]=k=>lt(1))},{default:s(()=>[d[20]||(d[20]=m("元数据 ",-1)),e(S(ks))]),_:1}),e(He,null,{overlay:s(()=>[e(Ne,null,{default:s(()=>[e(xe,{key:"1"},{default:s(()=>[t("div",{onClick:bt},"批量删除")]),_:1}),e(xe,{key:"2"},{default:s(()=>[t("div",{onClick:kt},"批量移动")]),_:1}),e(xe,{key:"2"},{default:s(()=>[t("div",{onClick:d[8]||(d[8]=k=>lt(2))},"修改元数据")]),_:1})]),_:1})]),default:s(()=>[e(Ce,null,{default:s(()=>[d[21]||(d[21]=m("批量操作 ",-1)),e(S(ms))]),_:1})]),_:1}),e(Ce,{onClick:d[9]||(d[9]=k=>ht())},{default:s(()=>[...d[22]||(d[22]=[m("导入",-1)])]),_:1}),e(Ce,{onClick:d[10]||(d[10]=k=>xt())},{default:s(()=>[...d[23]||(d[23]=[m("导出",-1)])]),_:1}),e(Ce,{onClick:d[11]||(d[11]=k=>W({})),type:"primary",icon:e(S(Fe))},{default:s(()=>[...d[24]||(d[24]=[m("问答",-1)])]),_:1},8,["icon"])])]),t("div",nn,[G.value>0?(l(),i("div",an,[e(ye,{name:"alert-icon"}),t("div",null,y(G.value)+"个问答学习失败",1),t("a",{onClick:z},"重新学习")])):f("",!0)])]),t("div",un,[e(il,{ref_key:"subsectionBoxRef",ref:A,total:x.value,isLoading:_e.value,paragraphLists:K.value,search:I.search,onOpenEditSubscription:W,onHandleDelParagraph:ve,onGetList:b,onHandleSort:a},null,8,["total","isLoading","paragraphLists","search"]),t("div",dn,[e(nt,{current:R.value.page,"onUpdate:current":d[12]||(d[12]=k=>R.value.page=k),"page-size":R.value.size,"onUpdate:pageSize":d[13]||(d[13]=k=>R.value.size=k),total:x.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:M},null,8,["current","page-size","total"])])])]),_:1})])]),e(Fo,{detailsInfo:F.value,onHandleEdit:ve,ref_key:"editSubscriptionRef",ref:Y},null,8,["detailsInfo"]),e(Ls,{ref_key:"addGroupRef",ref:he,onOk:ve},null,512),e(Ss,{groupLists:O.value,library_id:Z.library_id,onOk:ve,ref_key:"qaUploadModalRef",ref:Q},null,8,["groupLists","library_id"]),e(at,{open:pe.value,"onUpdate:open":d[15]||(d[15]=k=>pe.value=k),title:"批量移动分组",onOk:ke},{default:s(()=>[e(Lt,{align:"center",style:{margin:"24px 0"}},{default:s(()=>[d[25]||(d[25]=t("div",null,"移动到分组：",-1)),e(St,{value:we.group_id,"onUpdate:value":d[14]||(d[14]=k=>we.group_id=k),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(l(!0),i(H,null,ce(O.value.filter(k=>k.id>=0),k=>(l(),D($t,{value:k.id},{default:s(()=>[m(y(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),e(at,{open:N.value,"onUpdate:open":d[17]||(d[17]=k=>N.value=k),title:null,footer:null,width:640},{default:s(()=>[e(it,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:s(()=>[e(Ce,{style:{"margin-right":"16px"},onClick:d[16]||(d[16]=k=>N.value=!1)},{default:s(()=>[...d[26]||(d[26]=[m("知道了",-1)])]),_:1}),e(Ce,{onClick:ot,type:"primary"},{default:s(()=>[...d[27]||(d[27]=[m("去下载",-1)])]),_:1})]),_:1})]),_:1},8,["open"]),e(Cs,{ref_key:"metaRef",ref:ee,"library-id":_.value,"qa-ids":C.value,onChange:ve},null,8,["library-id","qa-ids"])],64)}}},su=$e(rn,[["__scopeId","data-v-d2c8ace0"]]),_n={class:"form-box"},cn={class:"upload-document-type-box"},pn=["onClick"],fn={class:"right-block"},vn={class:"title-block"},mn={class:"title-text"},yn={class:"desc"},gn={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=Ft(),w=Ze(),J=Xe.useForm,O=p(!1),q=p("添加自定义文档"),C=Z,g=ie({library_id:w.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),T=p([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),$=F=>{g.qa_index_type=F},_=ie({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:K,validate:v,validateInfos:x}=J(g,_),G=()=>{O.value=!0,K(),g.file_name="",g.is_qa_doc=0,g.qa_index_type=1,g.library_id=C.libraryInfo.id||w.query.id,C.libraryInfo.type==2&&(g.is_qa_doc=1)},E=p(!1),X=()=>{v().then(()=>{let F={...Dt(g),group_id:C.group_id};E.value=!0,Qe(F).then(R=>{U.success(`${q.value}成功`),O.value=!1,P.push("/library/preview?id="+R.data.file_ids[0])}).finally(()=>{E.value=!1})})};return A({add:G}),(F,R)=>{const I=Ue,a=gt,r=ws,M=bs,B=Ut,z=Xe,Y=re;return l(),i("div",null,[e(Y,{open:O.value,"onUpdate:open":R[2]||(R[2]=W=>O.value=W),title:q.value,onOk:X,width:"472px",confirmLoading:E.value},{default:s(()=>[t("div",_n,[e(z,{layout:"vertical"},{default:s(()=>[e(a,po({label:"文档名称"},S(x).file_name),{default:s(()=>[e(I,{type:"text",placeholder:"请输入文档名称",value:g.file_name,"onUpdate:value":R[0]||(R[0]=W=>g.file_name=W)},null,8,["value"])]),_:1},16),f("",!0),g.is_qa_doc==1?(l(),D(a,{key:1,label:"索引方式",required:""},{default:s(()=>[t("div",cn,[(l(!0),i(H,null,ce(T.value,W=>(l(),i("div",{class:fe(["type-item",{active:g.qa_index_type==W.value}]),key:W.value,onClick:_e=>$(W.value)},[t("div",fn,[t("div",vn,[e(B,{name:g.qa_index_type==W.value?W.iconNameActive:W.iconName},null,8,["name"]),t("div",mn,y(W.title),1)]),t("div",yn,y(W.desc),1)]),g.qa_index_type==W.value?(l(),D(B,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):f("",!0)],10,pn))),128))])]),_:1})):f("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},hn=$e(gn,[["__scopeId","data-v-a4f74280"]]),kn="/assets/img/guide-image-DSu20zRj.png",bn={class:"container"},wn={class:"guide-content"},xn={class:"content-box"},Cn={__name:"guide-learning-tips",setup(Z,{expose:A}){const ee=zt(),P=p(!1),w=p(!1),J=p(""),O=()=>{setTimeout(()=>{P.value=!0},500)},q=()=>{ee.setGuideLearningTips(w.value),P.value=!1},C=()=>{ee.setGuideLearningTips(w.value),P.value=!1};return A({show:O}),(g,T)=>{const $=Co,_=Nt,K=re;return l(),i("div",bn,[e(K,{open:P.value,"onUpdate:open":T[1]||(T[1]=v=>P.value=v),title:J.value,onOk:q,onCancel:C,width:"472px"},{footer:s(()=>[e(_,{type:"primary",onClick:q},{default:s(()=>[...T[5]||(T[5]=[m("我知道了",-1)])]),_:1})]),default:s(()=>[t("div",wn,[T[4]||(T[4]=t("img",{src:kn,alt:"操作引导",class:"guide-image"},null,-1)),t("div",xn,[T[3]||(T[3]=t("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),e($,{checked:w.value,"onUpdate:checked":T[0]||(T[0]=v=>w.value=v)},{default:s(()=>[...T[2]||(T[2]=[t("div",{class:"content-check"},"不再显示此提示",-1)])]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},$n=$e(Cn,[["__scopeId","data-v-33a87814"]]),Sn={__name:"edit-online-doc",emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=ee,w=ie({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),J=p({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),O=p(!1),q=$=>{$=JSON.parse(JSON.stringify($)),w.id=$.id||"",w.file_name=$.file_name||"",w.doc_auto_renew_frequency=+$.doc_auto_renew_frequency||1,$.doc_auto_renew_minute>0&&(w.doc_auto_renew_minute=je($.doc_auto_renew_minute)),O.value=!0},C=p(!1),g=p(null),T=()=>{g.value.validate().then(()=>{C.value=!0,Js({...w,doc_auto_renew_minute:w.doc_auto_renew_minute?je(w.doc_auto_renew_minute):0}).then(()=>{O.value=!1,C.value=!1,P("ok")})}).catch(()=>{C.value=!1})};return A({show:q}),($,_)=>{const K=Ue,v=gt,x=tt,G=et,E=xs,X=Xe,F=re;return l(),i("div",null,[e(F,{open:O.value,"onUpdate:open":_[3]||(_[3]=R=>O.value=R),"confirm-loading":C.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:T},{default:s(()=>[e(X,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:g,model:w,rules:J.value},{default:s(()=>[e(v,{name:"file_name",label:"文件名称"},{default:s(()=>[e(K,{value:w.file_name,"onUpdate:value":_[0]||(_[0]=R=>w.file_name=R),placeholder:"请输入"},null,8,["value"])]),_:1}),e(v,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:s(()=>[e(G,{value:w.doc_auto_renew_frequency,"onUpdate:value":_[1]||(_[1]=R=>w.doc_auto_renew_frequency=R),style:{width:"100%"}},{default:s(()=>[e(x,{value:1},{default:s(()=>[..._[4]||(_[4]=[m("不自动更新",-1)])]),_:1}),e(x,{value:2},{default:s(()=>[..._[5]||(_[5]=[m("每天",-1)])]),_:1}),e(x,{value:3},{default:s(()=>[..._[6]||(_[6]=[m("每3天",-1)])]),_:1}),e(x,{value:4},{default:s(()=>[..._[7]||(_[7]=[m("每7天",-1)])]),_:1}),e(x,{value:5},{default:s(()=>[..._[8]||(_[8]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),w.doc_auto_renew_frequency>1?(l(),D(v,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[e(E,{valueFormat:"HH:mm",value:w.doc_auto_renew_minute,"onUpdate:value":_[2]||(_[2]=R=>w.doc_auto_renew_minute=R),format:"HH:mm"},null,8,["value"])]),_:1})):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},Ln={class:"form-item"},qn={class:"form-content"},On={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=p(!1),w=ee,J=p("修改分组"),O=Z,q=ie({group_id:"",file_id:""}),C=p([]),g=_=>{q.group_id=_.group_id||"0",q.file_id=_.id||"",$(),P.value=!0},T=()=>{if(!q.group_id)return U.error("请选择分组");Xs({...q,library_id:O.libraryId,sense:O.sense}).then(_=>{U.success(`${J.value}成功`),P.value=!1,w("ok")})},$=()=>{Tt({library_id:O.libraryId,group_type:1}).then(_=>{C.value=_.data||[]})};return A({show:g}),(_,K)=>{const v=tt,x=et,G=re;return l(),i("div",null,[e(G,{open:P.value,"onUpdate:open":K[1]||(K[1]=E=>P.value=E),title:J.value,onOk:T},{default:s(()=>[t("div",Ln,[K[2]||(K[2]=t("div",{class:"form-label"},"分组名称：",-1)),t("div",qn,[e(x,{value:q.group_id,"onUpdate:value":K[0]||(K[0]=E=>q.group_id=E),style:{width:"100%"},placeholder:"请选择分组"},{default:s(()=>[(l(!0),i(H,null,ce(C.value,E=>(l(),D(v,{value:E.id},{default:s(()=>[m(y(E.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},Rn=$e(On,[["__scopeId","data-v-40485b34"]]),In="/assets/img/feishu-redirct-example-qgH_904t.png",Mn={key:0,class:"file-list"},Dn={__name:"add-feishu-document",props:{libraryId:{type:[Number,String],default:""}},emits:["ok"],setup(Z,{expose:A,emit:ee}){const P=ee,w=Z,J=zt(),O=`${window.location.origin}/manage/feishuUserAuthLogin/callback`,q=p(null),C={feishu_app_id:"",feishu_app_secret:"",user_access_token:"",file_type:1,feishu_document_id_list:[]},g=p(!1),T=p(!1),$=p(1),_=ie({feishu_document_id_list:[]}),K=ie({feishu_app_id:{message:"请输入飞书 AppId",required:!0},feishu_app_secret:{message:"请输入飞书 AppSecret",required:!0}}),v=p([]);function x(I=null){Object.assign(_,JSON.parse(JSON.stringify(C))),I?(Object.assign(_,I),G(),$.value=2):$.value=1,g.value=!0}function G(){const{feishu_app_id:I,feishu_app_secret:a,user_access_token:r}=_;eo({feishu_app_id:I,feishu_app_secret:a,user_access_token:r}).then(M=>{v.value=E((M==null?void 0:M.data)||[])})}function E(I=[]){return I.map(a=>{if(Array.isArray(a.children)){a.checkable=!1;const r=E(a.children);return{...a,children:r}}return a.checkable=!0,a}).filter(a=>{var r;return!!(a.type==="docx"||a.type==="folder"&&((r=a.children)!=null&&r.length))})}function X(I=[]){const a=[];function r(M){for(const B of M)B.type==="docx"&&B.token&&a.push(B.token),Array.isArray(B.children)&&r(B.children)}return r(I),a}const F=I=>{Zs(I),U.success("复制成功")};function R(){q.value.validate().then(()=>{if($.value==1){U.loading("正在进行验证...");let I="";const a={feishu_app_id:_.feishu_app_id,feishu_app_secret:_.feishu_app_secret},r={...a,id:w.libraryId};let M={...a,token:J.getToken??"",feishu_frontend_auth_redirect_url:to(`${I}/#/library/details/knowledge-document?${ss(r)}`)};window.location.href=`${I}/manage/feishuUserAuthLogin/redirect?${ss(M)}`}else{if(_.file_type==2){if(!_.feishu_document_id_list.length)return U.error("请选择同步文件")}else if(_.feishu_document_id_list=X(v.value),!_.feishu_document_id_list.length)return U.error("暂无可同步文件");let I={library_id:w.libraryId,doc_type:6,..._,doc_auto_renew_minute:je(_.doc_auto_renew_minute),feishu_document_id_list:_.feishu_document_id_list.toString()};delete I.file_type,delete I.user_access_token,T.value=!0,Qe(I).then(a=>{P("ok"),U.success("添加完成"),g.value=!1}).finally(()=>{T.value=!1})}})}return A({show:x}),(I,a)=>{const r=$o,M=yt,B=vs,z=Ue,Y=gt,W=Xe,_e=ws,b=bs,Re=So,he=re;return l(),D(he,{open:g.value,"onUpdate:open":a[5]||(a[5]=te=>g.value=te),"confirm-loading":T.value,maskClosable:!1,title:$.value==1?"导入飞书知识库":"请选择需要同步的文件",width:"646px",onOk:R},{default:s(()=>[$.value==1?(l(),i(H,{key:0},[e(B,{class:"zm-alert-info","show-icon":"",type:"info"},{message:s(()=>[a[7]||(a[7]=m(" 请先在",-1)),a[8]||(a[8]=t("a",{href:"https://open.feishu.cn/document/server-docs/api-call-guide/terminology",target:"_blank"},"飞书开发者后台",-1)),a[9]||(a[9]=m("创建自建应用获取App ID 和 App Secret，并将需要同步的 ",-1)),a[10]||(a[10]=t("a",{href:"https://open.feishu.cn/document/server-docs/docs/wiki-v2/wiki-qa#b5da330b",target:"_blank"},"知识库授权给对应应用",-1)),a[11]||(a[11]=m("； ",-1)),e(M,null,{title:s(()=>[e(r,{width:"600px",src:S(In)},null,8,["src"])]),default:s(()=>[a[6]||(a[6]=m(" 在飞书应用中填写重定向URL：",-1)),t("a",{onClick:a[0]||(a[0]=te=>F(O)),title:"点击复制"},y(O))]),_:1}),a[12]||(a[12]=m(" 。完成后，系统将自动同步知识库目录下.docx格式的云文档 ",-1))]),_:1}),e(W,{class:"mt16",layout:"vertical",ref_key:"formRef",ref:q,model:_,rules:K},{default:s(()=>[e(Y,{name:"feishu_app_id",label:"AppId"},{default:s(()=>[e(z,{value:_.feishu_app_id,"onUpdate:value":a[1]||(a[1]=te=>_.feishu_app_id=te),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppId"},null,8,["value"])]),_:1}),e(Y,{name:"feishu_app_secret",label:"AppSecret"},{default:s(()=>[e(z,{value:_.feishu_app_secret,"onUpdate:value":a[2]||(a[2]=te=>_.feishu_app_secret=te),valueModifiers:{trim:!0},placeholder:"请输入飞书 AppSecret"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])],64)):(l(),D(W,{key:1,layout:"vertical",ref_key:"formRef",ref:q,model:_,rules:K},{default:s(()=>[e(Y,{label:"文件范围"},{default:s(()=>[e(b,{value:_.file_type,"onUpdate:value":a[3]||(a[3]=te=>_.file_type=te)},{default:s(()=>[e(_e,{value:1},{default:s(()=>[...a[13]||(a[13]=[m("权限范围内所有文件",-1)])]),_:1}),e(_e,{value:2},{default:s(()=>[...a[14]||(a[14]=[m("部分文件",-1)])]),_:1})]),_:1},8,["value"]),_.file_type==2?(l(),i("div",Mn,[e(Re,{checkedKeys:_.feishu_document_id_list,"onUpdate:checkedKeys":a[4]||(a[4]=te=>_.feishu_document_id_list=te),multiple:"",checkable:"","field-names":{key:"token"},"tree-data":v.value},{title:s(({name:te,type:ve})=>[ve==="docx"?(l(),i(H,{key:0},[m(y(te)+".docx",1)],64)):(l(),i(H,{key:1},[m(y(te),1)],64))]),_:1},8,["checkedKeys","tree-data"])])):f("",!0)]),_:1})]),_:1},8,["model","rules"]))]),_:1},8,["open","confirm-loading","title"])}}},Un=$e(Dn,[["__scopeId","data-v-2705ffd4"]]),Tn={class:"details-library-page"},zn={class:"group-head-box"},Fn={class:"head-title"},Gn={class:"flex-between-box"},En={class:"classify-box",style:{"margin-top":"16px"}},Nn=["onClick"],Hn={key:0,class:"drag-btn"},An={key:1,style:{width:"20px"}},Pn={class:"classify-title"},Bn={class:"right-content"},Kn={key:0,class:"btn-box"},Yn={class:"hover-btn-wrap"},Wn=["onClick"],Vn=["onClick"],Qn={class:"main-content-box"},jn={class:"group-header-title"},Jn={class:"pover-group-content-box"},Xn={class:"group-head-box"},Zn={class:"head-title"},ea={class:"flex-between-box"},ta={class:"search-box"},sa={class:"classify-box classify-scroll-box"},oa=["onClick"],la={class:"classify-title"},na={class:"right-content"},aa={key:0,class:"btn-box"},ia={class:"hover-btn-wrap"},ua=["onClick"],da=["onClick"],ra={class:"title"},_a={class:"list-tools"},ca={class:"tools-items"},pa={class:"right-box"},fa={key:0,class:"status-box"},va={class:"status-item"},ma={class:"status-content"},ya={class:"status-item"},ga={class:"status-content content-tip"},ha={class:"status-item"},ka={class:"status-content content-tip"},ba={key:1,class:"status-select-box"},wa={class:"tool-item"},xa={class:"tool-item"},Ca={class:"dropdown-btn-menu"},$a={key:0,class:"desc"},Sa={key:1,class:"desc"},La={class:"dropdown-btn-menu"},qa={class:"dropdown-btn-menu"},Oa={class:"dropdown-btn-menu"},Ra={class:"list-content"},Ia={class:"zm-line1"},Ma={key:0,class:"doc-name-td"},Da=["href"],Ua=["onClick"],Ta={key:0},za={key:1},Fa=["onClick"],Ga={key:0},Ea={key:1},Na={key:2,class:"url-remark"},Ha=["onClick"],Aa={key:0,class:"pdf-progress-box"},Pa={class:"progress-title"},Ba={class:"status-box"},Ka=["onClick"],Ya={class:"progress-bar"},Wa={class:"num-box"},Va={key:0,class:"status-tag running"},Qa={key:2,class:"status-tag running"},ja={key:3,class:"status-tag complete"},Ja={class:"status-tag status-error"},Xa=["onClick"],Za={class:"status-tag status-error"},ei={class:"status-tag"},ti=["onClick"],si={key:7,class:"status-tag"},oi={key:8,class:"status-tag running"},li={class:"status-tag error"},ni={key:10,class:"status-tag cancel"},ai={key:11,class:"status-tag subning"},ii={class:"status-tag"},ui=["onClick"],di={key:1,class:"status-tag running"},ri={key:2,class:"status-tag complete"},_i={class:"status-tag error"},ci=["onClick"],pi={class:"zm-line1 reason-text"},fi={key:4,class:"status-tag running"},vi={class:"status-tag warning"},mi={class:"reason-text"},yi=["onClick"],gi={key:0},hi={key:1},ki={key:0,class:"text-block"},bi={class:"time-content-box"},wi={key:0},xi={key:1},Ci={key:2},$i={key:3},Si={key:4},Li={key:5,class:"ml4"},qi={key:6},Oi=["onClick"],Ri={key:1},Ii={key:0},Mi={key:1},Di=["onClick"],Ui=["onClick"],Ti={class:"zm-line1"},zi={class:"upload-file-box"},Fi={class:"select-card-box"},Gi=["onClick"],Ei={class:"card-title"},Ni={key:0,class:"card-switch-box"},Hi={class:"card-desc"},Ai={key:0,class:"card-switch"},is="qa_document_group_box_width",ft=180,It=256,Pi={__name:"knowledge-document",props:{type:{type:[Number,String],default:()=>2},library_id:{type:[Number,String],default:()=>""}},setup(Z){const{setStorage:A}=ao("localStorage"),ee=rs(),{changeGraphSwitch:P}=ee,w=so(),J=ge(()=>{var n;return((n=w.companyInfo)==null?void 0:n.neo4j_status)=="true"}),O=ge(()=>{var n;return((n=w.companyInfo)==null?void 0:n.ali_ocr_switch)=="1"}),q=Z,C=ge(()=>q.library_id||R.id),g=p(localStorage.getItem("document_group_hide_key")==1),T=p(""),$=p([]),_=p(-1),K=ge(()=>$.value.find(n=>n.id==_.value)||{}),v=ge(()=>$.value.filter(n=>n.group_name.includes(T.value))),x=zt(),G={1:"本地文档",2:"在线文档",3:"自定义文档",4:"手工新增问答",5:"导入问答"},E=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],X=Ze(),F=Ft(),R=X.query,I=p(!1),a=p(null),r=p(null),M=p(null),B=p(!1),z=p({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});ie({selectedRowKeys:[]});const Y=ie({use_model:"",model_config_id:""}),W=(n,o)=>{let h=o.modelName,j=o.modelId;Ie.value.length>0?re.confirm({title:`确定切换模型为${h}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){Y.use_model=h,Y.model_config_id=j,_e()},onCancel(){}}):(Y.use_model=h,Y.model_config_id=j,_e())},_e=(n=!0,o=null)=>{co({...Dt(z.value),use_model:Y.use_model,model_config_id:Y.model_config_id}).then(()=>{z.value.use_model=Y.use_model,z.value.model_config_id=Y.model_config_id,typeof o=="function"&&o(),n&&U.success("保存成功")})},b=p([]),Re=n=>{b.value=n},he=p([]),te=n=>{he.value=n,ve()},ve=()=>{if(!z.value.id){setTimeout(()=>{ve()},100);return}if(he.value.length>0&&!z.value.use_model){let n=null,o=null;for(let h of he.value)if(h.model_define==="chatwiki"){n=h;for(let j of n.children)if(j.name==="text-embedding-v2"){o=j;break}break}n||(n=he.value[0],o=n.children[0]),n&&(Y.use_model=o.name,Y.model_config_id=o.model_config_id,_e(!1))}},Ie=p([]),be=ie({learned_err_count:0,learned_count:0,learned_wait_count:0}),Q=ie({library_id:C.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),ht=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],pe=p([]),we=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"文章更新时间",dataIndex:"official_article_update_time",key:"official_article_update_time",width:220},{title:"合计",dataIndex:"total_hits",key:"total_hits",width:150,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",width:150,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",width:150,sorter:!0},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],kt=n=>{ke()},bt=(n,o,h)=>{Q.page=n.current,Q.size=n.pageSize,Q.sort_field="",Q.sort_type="",h.order&&h.field&&(Q.sort_field=h.field,Q.sort_type=h.order=="ascend"?"asc":"desc"),oe()},ke=()=>{Q.page=1,oe(),Te()};let Se=!1;const Ge=({id:n})=>{Ie.value.length==1&&(Se=!0),_o({id:n}).then(()=>{Se&&Q.page>1&&Q.page--,oe(),Te(),U.success("删除成功")})},me=(n,o={})=>{let h=X.name;if(n.status=="4"){if(h=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+n.id+"&page="+Q.page);return}return F.push({path:"/library/document-segmentation",query:{document_id:n.id,page:Q.page}})}if(n.status=="3"&&z.value.type!=2)return U.error("学习失败,不可预览");if(n.status=="0")return U.error("转换中,稍候可预览");if(n.status=="1")return U.error("学习中,不可预览");if(n.status=="6")return U.error("获取中,不可预览");if(n.status=="7")return U.error("获取失败,不可预览");if(n.status=="10")return U.error("正在分段,不可预览");if(h=="libraryConfig"){window.open("/#/library/preview?id="+n.id);return}F.push({name:"libraryPreview",query:{id:n.id,...o}})},oe=()=>{let n=Dt(Q);n.status==0&&(n.status=""),n.group_id=_.value,I.value=!0,oo(n).then(o=>{var Be;let h=o.data.info;!Y.use_model&&Y.use_model!=h.use_model&&(Y.use_model=h.use_model,Y.model_config_id=h.model_config_id),z.value={...h},B.value=h.graph_switch==1,h.graph_switch=="0"||!J.value?pe.value=we.filter(V=>!["graph_status","graph_entity_count"].includes(V.key)):pe.value=we,q.type!=3&&(pe.value=pe.value.filter(V=>V.key!="official_article_update_time"));let j=o.data.list||[],qe=o.data.count_data||{},ue=((Be=j==null?void 0:j[0])==null?void 0:Be.meta_list)||[],De=[];ue.forEach(V=>{pe.value.findIndex(se=>se.dataIndex==V.key)>-1||De.push({title:V.name,key:`meta_${V.key}`,dataIndex:`meta_${V.key}`,width:160})}),pe.value.splice(pe.value.length-1,0,...De),Q.total=o.data.total,be.learned_count=qe.learned_count,be.learned_err_count=qe.learned_err_count,be.learned_wait_count=qe.learned_wait_count;let Oe=!1;Ie.value=j.map(V=>(["1","6","0","5"].includes(V.status)&&(Oe=!0),V.file_size_str=lo(V.file_size),V.update_time=We(V.update_time*1e3).format("YYYY-MM-DD HH:mm"),V.official_article_update_time=We(V.official_article_update_time*1e3).format("YYYY-MM-DD HH:mm"),V.doc_last_renew_time_desc=V.doc_last_renew_time>0?We(V.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",Array.isArray(V.meta_list)&&V.meta_list.forEach(se=>{se.type==1&&se.value>0&&(se.value=We(se.value*1e3).format("YYYY-MM-DD HH:mm")),se.key=="source"&&(se.value=G[se.value]),V[`meta_${se.key}`]=se.value}),V)),Oe&&wt(),!Oe&&clearInterval(Le.value)}).finally(()=>{I.value=!1})},Le=p(null),wt=()=>{clearInterval(Le.value),Le.value=setInterval(()=>{oe()},1e3*5)},Ee=p(null),st=n=>{if(he.value.length==0){re.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){F.push({path:"/user/model"})}});return}let{key:o}=n;o==1&&ne(),o==2&&xt(),o==3&&Ee.value.add(),o==4&&M.value.show()},N=ie({open:!1,urls:"",library_id:C.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(n,o)=>ls(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),xt=()=>{N.open=!0,N.confirmLoading=!1,N.urls="",N.doc_auto_renew_minute="02:00",N.doc_auto_renew_frequency=1},ot=p(null),lt=()=>{ot.value.validate().then(()=>{N.confirmLoading=!0,Qe({library_id:N.library_id,urls:JSON.stringify(ls(N.urls)),doc_auto_renew_frequency:N.doc_auto_renew_frequency,doc_auto_renew_minute:je(N.doc_auto_renew_minute),doc_type:2,group_id:_.value}).then(()=>{N.open=!1,N.confirmLoading=!1,ke()})}).catch(()=>{N.confirmLoading=!1})},L=()=>{N.open=!1},d=ie({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ye=ge(()=>d.fileList.filter(n=>n.type==="application/pdf").length>0),le=p(null),ne=()=>{if(z.value.type==2){le.value.show();return}d.fileList=[],d.open=!0},xe=()=>{d.fileList=[]},Ne=n=>{d.fileList=n},He=()=>{if(a.value&&!x.getGuideLearningTips&&d.fileList.length>1&&a.value.show(),d.fileList.length==0){U.error("请选择文件");return}d.confirmLoading=!0;let n=new FormData;n.append("library_id",Q.library_id),n.append("group_id",_.value||0);let o=!1;d.fileList.forEach(h=>{(h.name.includes(".xlsx")||h.name.includes(".csv"))&&(o=!0),n.append("library_files",h)}),ye.value&&n.append("pdf_parse_type",d.pdf_parse_type),Qe(n).then(h=>{oe(),d.open=!1,d.fileList=[],d.confirmLoading=!1,o&&h.data.file_ids.length==1&&F.push("/library/document-segmentation?document_id="+h.data.file_ids[0])}).catch(()=>{d.confirmLoading=!1})},Ae=p(null),Ct=n=>{Ae.value.show(n)},Ce=n=>{F.push({path:"/library/document-segmentation",query:{document_id:n.id}})},nt=n=>{uo({id:n.id}).then(()=>{oe()})},$t=()=>{if(B.value){B.value=!1;let n={graph_model_config_id:z.value.graph_model_config_id,graph_use_model:z.value.graph_use_model};if((!n.graph_model_config_id||!n.graph_use_model)&&b.value.length>0){let h=b.value[0].children[0];n.graph_use_model=h.name,n.graph_model_config_id=h.model_config_id}r.value.show(n)}else z.value.graph_switch=0,_e(!1,()=>{oe(),P(0)})},St=n=>{B.value=!0,z.value.graph_switch=1,z.value.graph_model_config_id=n.graph_model_config_id,z.value.graph_use_model=n.graph_use_model,_e(!1,()=>{oe(),P(1)})},Lt=n=>{if(n.key==4&&!O.value)return!1;d.pdf_parse_type=n.key},at=()=>{window.open("#/user/aliocr")},it=p(null),k=n=>{it.value.show({...n})},Me=n=>{ro({id:n.id}).then(o=>{U.success("更新成功"),oe()})},qs=n=>{re.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){io({id:n.id}).then(o=>{U.success("取消成功"),oe()})}})},Os=n=>{A("graph:autoOpenFileId",n.id),F.push({path:"/library/details/knowledge-graph",query:{id:C.value}})},Rs=n=>{let o=`/manage/downloadLibraryFile?id=${n.id}&token=${x.getToken}`;var h=document.createElement("a");h.href=o,h.style.display="none",h.click()},Ht=()=>{g.value=!g.value,localStorage.setItem("document_group_hide_key",g.value?1:2)},Te=()=>{Tt({library_id:C.value,group_type:1}).then(n=>{let h=(n.data||[]).reduce((j,qe)=>j+ +qe.total,0);$.value=[{group_name:"全部分组",id:-1,total:h},...n.data]})};Te();const At=p(null),ut=n=>{At.value.show({...n,library_id:C.value})},Pt=p(null),Is=n=>{Pt.value.show({...n,sense:1})},dt=()=>{Te(),oe()},Bt=n=>{_.value=n.id,ke()},Kt=n=>{re.confirm({title:`确认删除分组${n.group_name}`,icon:e(Je),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){_s({id:n.id,sense:1}).then(()=>{U.success("删除成功"),Te(),_.value==n.id&&(_.value=-1,ke())})}})},Pe=p(ft),rt=p(!1);Mt(()=>{const n=parseInt(localStorage.getItem(is));n&&n>=ft&&n<=It&&(Pe.value=n),Ms()});const Ms=()=>{const{user_access_token:n,feishu_app_id:o,feishu_app_secret:h,...j}=R;n&&o&&h&&(F.replace({query:j}),M.value.show({user_access_token:n,feishu_app_id:o,feishu_app_secret:h}))};let _t=!1,Yt=0,Wt=0;const Ds=n=>{g.value||(_t=!0,rt.value=!0,Yt=n.clientX,Wt=Pe.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Vt),document.addEventListener("mouseup",Qt))},Vt=n=>{if(!_t)return;let o=Wt+(n.clientX-Yt);o=Math.max(ft,Math.min(It,o)),Pe.value=o},Qt=()=>{_t&&(_t=!1,rt.value=!1,localStorage.setItem(is,Pe.value),document.body.style.cursor="",document.removeEventListener("mousemove",Vt),document.removeEventListener("mouseup",Qt))},Us=n=>n.draggedContext.element.id>0&&n.relatedContext.element.id>0,Ts=async()=>{try{const n=$.value.filter(o=>o.id>0).map((o,h)=>({id:o.id,sort:$.value.length-h}));await no({library_id:C.value,sense:1,sort_group:JSON.stringify(n)}),U.success("排序已保存")}catch(n){console.error("排序保存失败:",n),Te()}},jt=p(null),zs=n=>{jt.value.show(n==2)};return Mt(()=>{R.page&&(Q.page=+R.page),oe()}),fo(()=>{Le.value&&clearInterval(Le.value)}),(n,o)=>{const h=Ut,j=Gt,qe=Ue,ue=hs,De=gs,Oe=ys,Be=us,V=yt,se=Et,ze=tt,Jt=et,Fs=Lo,Xt=Nt,Gs=Ro,Ke=Io,Zt=Do,Es=fs,Ye=gt,es=Xe,ts=re,Ns=zo,Hs=xs,As=cs("copy");return l(),i("div",Tn,[t("div",{class:fe(["group-content-box",[{collapsed:g.value},{"no-transition":rt.value}]]),style:ps(g.value?{}:{width:Pe.value+"px",minWidth:ft+"px",maxWidth:It+"px"})},[t("div",zn,[t("div",Fn,[e(j,{title:"收起问答分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:Ht},[e(h,{name:"put-away"})])]),_:1}),t("div",Gn,[o[18]||(o[18]=t("div",null,"知识分组",-1)),e(j,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=c=>ut({}))},[e(S(Fe))])]),_:1})])]),f("",!0)]),t("div",En,[e(Be,{style:{"padding-right":"24px"}},{default:s(()=>[e(S(Ho),{modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=c=>$.value=c),"item-key":"id",disabled:rt.value,onEnd:Ts,move:Us,handle:".drag-btn"},{item:s(({element:c})=>[t("div",{class:fe(["classify-item",{active:c.id==_.value}]),onClick:u=>Bt(c)},[c.id>0?(l(),i("span",Hn,[e(h,{name:"drag"})])):(l(),i("span",An)),t("div",Pn,y(c.group_name),1),t("div",Bn,[t("div",{class:fe(["num",{"num-block":c.id<=0}])},y(c.total),3),c.id>0?(l(),i("div",Kn,[e(Oe,{placement:"bottomRight"},{overlay:s(()=>[e(De,null,{default:s(()=>[e(ue,null,{default:s(()=>[t("div",{onClick:de(u=>ut(c),["stop"])},"重命名",8,Wn)]),_:2},1024),e(ue,null,{default:s(()=>[t("div",{onClick:de(u=>Kt(c),["stop"])},"删 除",8,Vn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",Yn,[e(S(mt))])]),_:2},1024)])):f("",!0)])],10,Nn)]),_:1},8,["modelValue","disabled"])]),_:1})]),g.value?f("",!0):(l(),i("div",{key:0,class:"resize-bar",onMousedown:Ds},null,32))],6),t("div",Qn,[e(Be,{scrollbar:!1},{default:s(()=>[t("div",jn,[g.value?(l(),D(V,{key:0,title:null,placement:"bottom"},{content:s(()=>[t("div",Jn,[t("div",Xn,[t("div",Zn,[t("div",ea,[o[19]||(o[19]=t("div",null,"问答分组",-1)),e(j,{title:"新建分组"},{default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=c=>ut({}))},[e(S(Fe))])]),_:1})])]),t("div",ta,[e(qe,{allowClear:"",value:T.value,"onUpdate:value":o[6]||(o[6]=c=>T.value=c),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[e(S(Ve),{onClick:o[5]||(o[5]=de(()=>{},["stop"]))})]),_:1},8,["value"])])]),t("div",sa,[(l(!0),i(H,null,ce(v.value,c=>(l(),i("div",{class:fe(["classify-item",{active:c.id==_.value}]),onClick:u=>Bt(c),key:c.id},[t("div",la,y(c.group_name),1),t("div",na,[t("div",{class:fe(["num",{"num-block":c.id<=0}])},y(c.total),3),c.id>0?(l(),i("div",aa,[e(Oe,{placement:"bottomRight"},{overlay:s(()=>[e(De,null,{default:s(()=>[e(ue,null,{default:s(()=>[t("div",{onClick:de(u=>ut(c),["stop"])},"重命名",8,ua)]),_:2},1024),e(ue,null,{default:s(()=>[t("div",{onClick:de(u=>Kt(c),["stop"])},"删 除",8,da)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",ia,[e(S(mt))])]),_:2},1024)])):f("",!0)])],10,oa))),128))])])]),default:s(()=>[t("div",{class:"hover-btn-wrap",onClick:Ht},[e(h,{name:"expand"})])]),_:1})):f("",!0),t("div",ra,y(K.value.group_name),1)]),t("div",_a,[t("div",ca,[vt(e(se,{align:"center",class:"tool-item custom-select-box"},{default:s(()=>[o[20]||(o[20]=t("span",null,"嵌入模型：",-1)),e(ns,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:Y.use_model,modeId:Y.model_config_id,style:{width:"240px"},onChange:W,onLoaded:te},null,8,["modeName","modeId"])]),_:1},512),[[os,!1]])]),t("div",pa,[z.value.type==0?(l(),i("div",fa,[t("div",va,[o[21]||(o[21]=t("div",{class:"status-label"},"已学习：",-1)),t("div",ma,y(be.learned_count),1)]),t("div",ya,[o[22]||(o[22]=t("div",{class:"status-label"},"，未学习：",-1)),t("div",ga,y(be.learned_wait_count),1)]),t("div",ha,[o[23]||(o[23]=t("div",{class:"status-label"},"，学习失败：",-1)),t("div",ka,y(be.learned_err_count),1)])])):f("",!0),z.value.type==0?(l(),i("div",ba,[e(Jt,{value:Q.status,"onUpdate:value":o[7]||(o[7]=c=>Q.status=c),style:{width:"150px"},placeholder:"请选择",onChange:kt},{default:s(()=>[(l(),i(H,null,ce(ht,c=>e(ze,{key:c.id,value:c.id},{default:s(()=>[m(y(c.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):f("",!0),t("div",wa,[e(qe,{style:{width:"140px"},value:Q.file_name,"onUpdate:value":o[8]||(o[8]=c=>Q.file_name=c),placeholder:"文档名称搜索",onChange:ke},{suffix:s(()=>[e(S(Ve),{onClick:ke,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),J.value?(l(),D(se,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:s(()=>[vt(e(ns,{modelType:"LLM",onLoaded:Re},null,512),[[os,!1]]),o[24]||(o[24]=t("span",null,"生成知识图谱：",-1)),e(Fs,{checked:B.value,"onUpdate:checked":o[9]||(o[9]=c=>B.value=c),onChange:$t,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})):f("",!0),q.type!=3?(l(),D(Xt,{key:3,onClick:o[10]||(o[10]=c=>zs(1))},{default:s(()=>[o[25]||(o[25]=m("元数据 ",-1)),e(S(ks))]),_:1})):f("",!0),t("div",xa,[e(Oe,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:s(()=>[e(De,{onClick:st},{default:s(()=>[(l(),D(ue,{key:1},{default:s(()=>[t("div",Ca,[e(se,{class:"title-block",gap:4},{default:s(()=>[e(h,{name:"doc-icon"}),o[26]||(o[26]=t("div",{class:"title"},"本地文档",-1))]),_:1}),z.value.type==2?(l(),i("div",$a," 上传本地 docx/csv/xlsx 等格式文件 ")):(l(),i("div",Sa," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),z.value.type!=2?(l(),D(ue,{key:2},{default:s(()=>[t("div",La,[e(se,{class:"title-block",gap:4},{default:s(()=>[e(h,{name:"link-icon"}),o[27]||(o[27]=t("div",{class:"title"},"在线数据",-1))]),_:1}),o[28]||(o[28]=t("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):f("",!0),(l(),D(ue,{key:3},{default:s(()=>[t("div",qa,[e(se,{class:"title-block",gap:4},{default:s(()=>[e(h,{name:"cu-doc-icon"}),o[29]||(o[29]=t("div",{class:"title"},"自定义文档",-1))]),_:1}),o[30]||(o[30]=t("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1})),z.value.type==0?(l(),D(ue,{key:4},{default:s(()=>[t("div",Oa,[e(se,{class:"title-block",gap:4},{default:s(()=>[e(h,{name:"feishu-doc"}),o[31]||(o[31]=t("div",{class:"title"},"飞书知识库",-1))]),_:1}),o[32]||(o[32]=t("div",{class:"desc"},"在线获取飞书知识库下docx格式云文档内容",-1))])]),_:1})):f("",!0)]),_:1})]),default:s(()=>[Z.type!=3?(l(),D(Xt,{key:0,type:"primary"},{icon:s(()=>[e(S(Fe))]),default:s(()=>[o[33]||(o[33]=t("span",null,"添加内容",-1))]),_:1})):f("",!0)]),_:1})])])]),z.value.type==0?(l(),D(No,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:s(()=>[...o[34]||(o[34]=[t("div",null,[t("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),t("p",null,"2、未学习的文档数据不会被检索到。")],-1)])]),_:1})):f("",!0),t("div",Ra,[e(Es,{columns:pe.value,"data-source":Ie.value,scroll:{x:1e3},"row-key":"id",pagination:{current:Q.page,total:Q.total,pageSize:Q.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:bt},{headerCell:s(({column:c})=>{var u;return[c.key.indexOf("meta_")>-1?(l(),D(j,{key:0,title:((u=c.title)==null?void 0:u.length)>8?c.title:""},{default:s(()=>[t("div",Ia,y(c.title),1)]),_:2},1032,["title"])):f("",!0)]}),bodyCell:s(({column:c,record:u})=>[c.key==="file_name"?(l(),i("div",Ma,[u.doc_type==2?(l(),D(V,{key:0,title:null},{content:s(()=>[o[35]||(o[35]=m(" 原链接：",-1)),t("a",{href:u.doc_url,target:"_blank"},y(u.doc_url),9,Da),vt(e(S(qo),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[As,`${u.doc_url}`]])]),default:s(()=>[t("a",{onClick:ae=>me(u)},[["5","6","7"].includes(u.status)?(l(),i("span",Ta,y(u.doc_url),1)):(l(),i("span",za,y(u.file_name),1))],8,Ua)]),_:2},1024)):(l(),i("a",{key:1,onClick:ae=>me(u)},[["5","6","7"].includes(u.status)?(l(),i("span",Ga,y(u.doc_url),1)):(l(),i("span",Ea,y(u.file_name),1))],8,Fa)),u.doc_type==2&&u.remark?(l(),i("div",Na," 备注："+y(u.remark),1)):f("",!0)])):f("",!0),c.key==="graph_entity_count"?(l(),i("a",{key:1,onClick:ae=>Os(u)},y(u.graph_entity_count),9,Ha)):f("",!0),c.key==="status"?(l(),i(H,{key:2},[u.file_ext=="pdf"&&u.pdf_parse_type>=2?(l(),i(H,{key:0},[u.status==0?(l(),i("div",Aa,[t("div",Pa,[t("span",Ba,[e(S(Oo)),o[36]||(o[36]=m("文档解析中",-1))]),t("a",{onClick:ae=>qs(u)},"取消",8,Ka)]),t("div",Ya,[e(Gs,{size:"small",class:"progress-bar-box",percent:parseInt(u.ocr_pdf_index/u.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),t("div",Wa,y(u.ocr_pdf_index)+" / "+y(u.ocr_pdf_total),1)])])):f("",!0)],64)):(l(),i(H,{key:1},[u.status==0?(l(),i("span",Va,[e(Ke,{size:"small"}),o[37]||(o[37]=m(" 转换中",-1))])):f("",!0)],64)),u.status==1?(l(),i("span",Qa,[e(Ke,{size:"small"}),o[38]||(o[38]=m(" 学习中",-1))])):f("",!0),u.status==2?(l(),i("span",ja,[e(S(qt)),o[39]||(o[39]=m(" 学习完成",-1))])):f("",!0),u.status==3?(l(),D(j,{key:4,placement:"top"},{title:s(()=>[t("span",null,y(u.errmsg),1)]),default:s(()=>[t("span",null,[t("span",Ja,[e(S(ct)),o[40]||(o[40]=m(" 转换失败",-1))]),z.value.type==2?(l(),i("a",{key:0,class:"ml8",onClick:ae=>me(u)},"学习",8,Xa)):f("",!0)])]),_:2},1024)):f("",!0),u.status==8?(l(),D(j,{key:5,placement:"top"},{title:s(()=>[t("span",null,y(u.errmsg),1)]),default:s(()=>[t("span",null,[t("span",Za,[e(S(ct)),o[41]||(o[41]=m(" 转化异常",-1))])])]),_:2},1024)):f("",!0),u.status==4?(l(),i(H,{key:6},[t("span",ei,[e(S(Ot)),o[42]||(o[42]=m(" 待学习",-1))]),t("a",{class:"ml8",onClick:ae=>me(u)},"学习",8,ti)],64)):f("",!0),u.status==5?(l(),i("span",si,[e(S(Ot)),o[43]||(o[43]=m(" 待获取",-1))])):f("",!0),u.status==6?(l(),i("span",oi,[e(Ke,{size:"small"}),o[44]||(o[44]=m(" 获取中",-1))])):f("",!0),u.status==7?(l(),D(j,{key:9,placement:"top"},{title:s(()=>[t("span",null,y(u.errmsg),1)]),default:s(()=>[t("span",li,[e(S(ct)),o[45]||(o[45]=m(" 获取失败",-1))])]),_:2},1024)):f("",!0),u.status==9?(l(),i("span",ni,[e(S(Je)),o[46]||(o[46]=m(" 取消解析",-1))])):f("",!0),u.status==10?(l(),i("span",ai,[e(Ke,{size:"small"}),o[47]||(o[47]=m(" 正在分段 ",-1))])):f("",!0)],64)):f("",!0),c.key==="graph_status"?(l(),i(H,{key:3},[u.graph_status==0?(l(),i(H,{key:0},[t("span",ii,[e(S(Ot)),o[48]||(o[48]=m(" 待生成",-1))]),t("a",{class:"ml8",onClick:ae=>nt(u)},"生成",8,ui)],64)):u.graph_status==1?(l(),i("span",di,[e(S(Mo)),o[49]||(o[49]=m(" 排队中",-1))])):u.graph_status==2?(l(),i("span",ri,[e(S(qt)),o[50]||(o[50]=m(" 生成完成",-1))])):u.graph_status==3?(l(),i(H,{key:3},[t("span",_i,[e(S(ct)),o[51]||(o[51]=m(" 生成失败",-1))]),t("a",{class:"ml8",onClick:ae=>nt(u)},"生成",8,ci),u.graph_err_msg?(l(),D(j,{key:0,title:u.graph_err_msg},{default:s(()=>[t("div",pi,"原因："+y(u.graph_err_msg),1)]),_:2},1032,["title"])):f("",!0)],64)):u.graph_status==4?(l(),i("span",fi,[e(Ke,{size:"small"}),o[52]||(o[52]=m(" 生成中",-1))])):u.graph_status==5?(l(),i(H,{key:5},[t("span",vi,[e(S(qt)),o[53]||(o[53]=m(" 部分成功",-1))]),t("div",mi,[m(" 失败数："+y(u.graph_err_count||0)+" ",1),t("a",{class:"ml8",onClick:ae=>me(u,{graph_status:3})},"详情",8,yi)])],64)):f("",!0)],64)):f("",!0),c.key==="file_size"?(l(),i(H,{key:4},[u.doc_type==3?(l(),i("span",gi,"-")):(l(),i("span",hi,y(u.file_size_str),1))],64)):f("",!0),c.key==="doc_auto_renew_frequency"?(l(),i(H,{key:5},[u.doc_type==2?(l(),i("div",ki,[t("div",bi,[u.doc_auto_renew_frequency==1?(l(),i("span",wi,"不自动更新")):f("",!0),u.doc_auto_renew_frequency==2?(l(),i("span",xi,"每天")):f("",!0),u.doc_auto_renew_frequency==3?(l(),i("span",Ci,"每3天")):f("",!0),u.doc_auto_renew_frequency==4?(l(),i("span",$i,"每7天")):f("",!0),u.doc_auto_renew_frequency==5?(l(),i("span",Si,"每30天")):f("",!0),u.doc_auto_renew_frequency>1&&u.doc_auto_renew_minute>0?(l(),i("span",Li,y(S(je)(u.doc_auto_renew_minute)),1)):f("",!0),u.doc_auto_renew_frequency>1?(l(),i("span",qi,"更新")):f("",!0),t("a",{class:"ml4 btn-hover-block",onClick:ae=>k(u)},"修改",8,Oi)]),e(se,{align:"center"},{default:s(()=>[m(" 最近更新: "+y(u.doc_last_renew_time_desc)+" ",1),e(Zt,{title:"确认更新?",onConfirm:ae=>Me(u)},{default:s(()=>[...o[54]||(o[54]=[t("a",{class:"ml4 btn-hover-block"},"更新",-1)])]),_:1},8,["onConfirm"])]),_:2},1024)])):(l(),i("div",Ri,"--"))],64)):f("",!0),c.key==="paragraph_count"?(l(),i(H,{key:6},[u.status==0||u.status==1?(l(),i("span",Ii,"-")):(l(),i("span",Mi,y(u.paragraph_count),1))],64)):f("",!0),c.key==="action"?(l(),D(se,{key:7,gap:8},{default:s(()=>[e(j,null,{title:s(()=>[...o[55]||(o[55]=[m("重新分段",-1)])]),default:s(()=>[e(S(Uo),{class:"btn-hover-block",onClick:ae=>Ce(u)},null,8,["onClick"])]),_:2},1024),e(Oe,null,{overlay:s(()=>[e(De,null,{default:s(()=>[u.doc_type==2?(l(),D(ue,{key:0},{default:s(()=>[t("div",{onClick:ae=>k(u)},"编辑",8,Di)]),_:2},1024)):f("",!0),e(ue,{disabled:u.status==6||u.status==7||u.status==0},{default:s(()=>[t("div",{onClick:ae=>me(u)},"预览",8,Ui)]),_:2},1032,["disabled"]),e(ue,{onClick:ae=>Ct(u)},{default:s(()=>[...o[56]||(o[56]=[t("div",null,"重命名",-1)])]),_:1},8,["onClick"]),e(Zt,{title:"确定要删除吗?",onConfirm:ae=>Ge(u)},{default:s(()=>[e(ue,null,{default:s(()=>[...o[57]||(o[57]=[t("span",null,"删除",-1)])]),_:1})]),_:1},8,["onConfirm"]),e(ue,{onClick:ae=>Is(u)},{default:s(()=>[...o[58]||(o[58]=[t("div",null,"修改分组",-1)])]),_:1},8,["onClick"]),e(ue,{onClick:ae=>Rs(u)},{default:s(()=>[...o[59]||(o[59]=[t("div",null,"下载文档",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[t("div",{class:"table-btn",onClick:o[11]||(o[11]=de(()=>{},["prevent"]))},[e(S(To),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):f("",!0),c.key.indexOf("meta_")>-1?(l(),D(j,{key:8,title:u[c.key].length>8?u[c.key]:""},{default:s(()=>[t("div",Ti,y(u[c.key]),1)]),_:2},1032,["title"])):f("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),e(ts,{open:d.open,"onUpdate:open":o[13]||(o[13]=c=>d.open=c),"confirm-loading":d.confirmLoading,maskClosable:!1,title:"上传文档",onOk:He,onCancel:xe,width:"740px"},{default:s(()=>[e(es,{class:"mt24"},{default:s(()=>[e(Ye,{required:"",label:""},{default:s(()=>[t("div",zi,[e($s,{type:z.value.type,maxCount:20,value:d.fileList,"onUpdate:value":o[12]||(o[12]=c=>d.fileList=c),onChange:Ne},null,8,["type","value"])])]),_:1}),ye.value?(l(),D(Ye,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:s(()=>[t("div",Fi,[(l(),i(H,null,ce(E,c=>t("div",{key:c.key,class:fe(["select-card-item",{active:d.pdf_parse_type==c.key},{disabled:c.key==4&&!O.value}]),onClick:de(u=>Lt(c),["stop"])},[e(h,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Ei,[e(h,{name:c.icon,style:{"font-size":"16px"}},null,8,["name"]),m(" "+y(c.title)+" ",1),c.key==4&&!O.value?(l(),i("div",Ni,"未开启")):f("",!0)]),t("div",Hi,y(c.desc),1),c.key==4&&!O.value?(l(),i("div",Ai,[o[60]||(o[60]=m(" 未开启阿里云OCR ",-1)),t("div",{class:"card-switch-btn",onClick:de(at,["stop"])},"去开启")])):f("",!0)],10,Gi)),64))])]),_:1})):f("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),e(Ss,{onOk:oe,ref_key:"qaUploadModalRef",ref:le},null,512),e(ts,{open:N.open,"onUpdate:open":o[17]||(o[17]=c=>N.open=c),"confirm-loading":N.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:lt,onCancel:L},{default:s(()=>[e(es,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:ot,model:N,rules:N.rules},{default:s(()=>[e(Ye,{name:"urls",label:"网页链接"},{default:s(()=>[e(Ns,{style:{height:"120px"},value:N.urls,"onUpdate:value":o[14]||(o[14]=c=>N.urls=c),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),e(Ye,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:s(()=>[e(Jt,{value:N.doc_auto_renew_frequency,"onUpdate:value":o[15]||(o[15]=c=>N.doc_auto_renew_frequency=c),style:{width:"100%"}},{default:s(()=>[e(ze,{value:1},{default:s(()=>[...o[61]||(o[61]=[m("不自动更新",-1)])]),_:1}),e(ze,{value:2},{default:s(()=>[...o[62]||(o[62]=[m("每天",-1)])]),_:1}),e(ze,{value:3},{default:s(()=>[...o[63]||(o[63]=[m("每3天",-1)])]),_:1}),e(ze,{value:4},{default:s(()=>[...o[64]||(o[64]=[m("每7天",-1)])]),_:1}),e(ze,{value:5},{default:s(()=>[...o[65]||(o[65]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),N.doc_auto_renew_frequency>1?(l(),D(Ye,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[e(Hs,{valueFormat:"HH:mm",value:N.doc_auto_renew_minute,"onUpdate:value":o[16]||(o[16]=c=>N.doc_auto_renew_minute=c),format:"HH:mm"},null,8,["value"])]),_:1})):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),e(hn,{libraryInfo:z.value,group_id:_.value,onOk:ke,ref_key:"addCustomDocumentRef",ref:Ee},null,8,["libraryInfo","group_id"]),e(Go,{onOk:ke,ref_key:"renameModalRef",ref:Ae},null,512),e(Eo,{onOk:St,ref_key:"openGrapgModalRef",ref:r},null,512),e($n,{ref_key:"guideLearningTipsRef",ref:a},null,512),e(Sn,{onOk:oe,ref_key:"editOnlineDocRef",ref:it},null,512),e(Ls,{group_type:"1",ref_key:"addGroupRef",ref:At,onOk:dt},null,512),e(Rn,{libraryId:C.value,sense:1,ref_key:"editGroupRef",ref:Pt,onOk:dt},null,8,["libraryId"]),e(Un,{ref_key:"feishuRef",ref:M,libraryId:C.value,onOk:dt},null,8,["libraryId"]),e(Cs,{ref_key:"metaRef",ref:jt,"library-id":C.value,onChange:dt},null,8,["library-id"])])}}},ou=$e(Pi,[["__scopeId","data-v-fcf712f3"]]);export{ou as K,su as Q};
