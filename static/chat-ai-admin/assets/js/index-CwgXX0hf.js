import{aa as be,e as H,l as u,f as F,o as Se,b as ve,Y as C,_ as k,k as L,a2 as M,F as P,ab as ye,a1 as I,af as N,u as j,G,a7 as W,B as Re,ac as Me,d as Ae,a5 as de,ae as qe,ag as xe,a9 as Ce}from"./vue-chunks-DCKTEHpB.js";import{u as D}from"./robot-4RO1uura.js";import{_ as me,d as f,af as ge}from"../../index-C1Xsov4S.js";import{g as Ke}from"./index-CTy81fs2.js";import{f as $e,az as Ie,e as Le}from"./ui-antd-D64OvTpt.js";import{T as Te}from"./top-header-D_d0IUdQ.js";import"./index-DLEjqKv8.js";import"./utils-D9NMMoMR.js";import"./add-group-CITgbMuU.js";import"./index-DTf9Tj4Y.js";const Be={class:"left-menu-box"},ze={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(b,{emit:T}){const i=be(),s=D(),g=b,r=i.query,q=H(()=>{const n=U.value.find(o=>o.id==="function-center"),a=(n==null?void 0:n.children)||[],l=a.find(o=>o.id==="auto-reply");if(i.path.split("/")[3]==="auto-reply"&&!l)return["function-center"];const t=a.find(o=>o.id==="subscribe-reply");if(i.path.split("/")[3]==="subscribe-reply"&&!t)return["function-center"];const m=a.find(o=>o.id==="smart-menu");if(i.path.split("/")[3]==="smart-menu"&&!m)return["function-center"];const x=a.find(o=>o.id==="payment");return i.path.split("/")[3]==="payment"&&!x?["function-center"]:[i.path.split("/")[3]]}),K=[{key:"workflow",id:"workflow",icon:()=>u(f,{name:"workflow",class:"menu-icon"}),label:"工作流编排",title:"工作流编排",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>u(f,{name:"jichupeizhi",class:"menu-icon"}),label:"基础配置",title:"基础配置",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>u(f,{name:"guanlianzhishiku",class:"menu-icon"}),label:"知识库",title:"知识库",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>u(f,{name:"skii",class:"menu-icon"}),label:"工作流",title:"工作流",path:"/robot/config/skill-config",menuIn:["0"]},{key:"external-services",id:"external-services",icon:()=>u(f,{name:"duiwaifuwu",class:"menu-icon"}),label:"对外服务",title:"对外服务",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>u(f,{name:"liaotianceshi",class:"menu-icon"}),label:"聊天测试",title:"聊天测试",path:"/robot/test",query:{robot_key:g.robotInfo.robot_key,id:g.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>u(f,{name:"qa-feedback",class:"menu-icon"}),label:"问答反馈",title:"问答反馈",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>u(f,{name:"session-record",class:"menu-icon"}),label:"会话记录",title:"会话记录",path:"/robot/config/session-record",query:{robot_key:g.robotInfo.robot_key,id:g.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>u(f,{name:"duiwaifuwu",class:"menu-icon"}),label:"API Key管理",title:"API Key管理",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>u(f,{name:"statistical-analysis",class:"menu-icon"}),label:"统计分析",title:"统计分析",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>u(f,{name:"export-record",class:"menu-icon"}),label:"导出记录",title:"导出记录",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>u(f,{name:"doc-file",class:"menu-icon"}),label:"调用日志",title:"调用日志",path:"/robot/config/invoke-logs",menuIn:["1"]}],R=F(null),$=F(null),B=F(null),z=F(null);async function O(){var n,a,l,t,m,x,o,h,J,Q,X,Z,ee,oe,ne,te,se,ae,ie,re,le,ce,ue,fe,pe,_e;try{const E=((n=g.robotInfo)==null?void 0:n.id)||r.id;if(!E)return;const V=await Ke({robot_id:E}),A=(V==null?void 0:V.data)||[],p=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(p){const e=((a=p==null?void 0:p.robot_config)==null?void 0:a.switch_status)??((l=p==null?void 0:p.user_config)==null?void 0:l.switch_status)??"0",c=((t=p==null?void 0:p.robot_config)==null?void 0:t.ai_reply_status)??((m=p==null?void 0:p.user_config)==null?void 0:m.ai_reply_status)??"0";s.setKeywordReplySwitchStatus(String(e)),s.setKeywordReplyAiReplyStatus(String(c))}else s.setKeywordReplySwitchStatus("0"),s.setKeywordReplyAiReplyStatus("0");const w=(A||[]).find(e=>{var c;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((c=e==null?void 0:e.robot_config)==null?void 0:c.fixed_menu)==="1"});w?R.value={key:"auto-reply",id:"auto-reply",icon:()=>u(f,{name:"auto-reply",class:"menu-icon"}),label:(x=w==null?void 0:w.menu)==null?void 0:x.name,title:(o=w==null?void 0:w.menu)==null?void 0:o.name,path:((h=w==null?void 0:w.menu)==null?void 0:h.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:R.value=null;const _=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(_){const e=((J=_==null?void 0:_.robot_config)==null?void 0:J.switch_status)??((Q=_==null?void 0:_.user_config)==null?void 0:Q.switch_status)??"0",c=((X=_==null?void 0:_.robot_config)==null?void 0:X.ai_reply_status)??((Z=_==null?void 0:_.user_config)==null?void 0:Z.ai_reply_status)??"0";s.setSubscribeReplySwitchStatus(String(e)),s.setSubscribeReplyAiReplyStatus(String(c))}else s.setSubscribeReplySwitchStatus("0"),s.setSubscribeReplyAiReplyStatus("0");!1||($.value=null);const y=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_smart_menu");if(y){const e=((ee=y==null?void 0:y.robot_config)==null?void 0:ee.switch_status)??((oe=y==null?void 0:y.user_config)==null?void 0:oe.switch_status)??"0",c=((ne=y==null?void 0:y.robot_config)==null?void 0:ne.ai_reply_status)??((te=y==null?void 0:y.user_config)==null?void 0:te.ai_reply_status)??"0";s.setSmartMenuSwitchStatus(String(e)),s.setSmartMenuAiReplyStatus(String(c))}else s.setSmartMenuSwitchStatus("0"),s.setSmartMenuAiReplyStatus("0");const S=(A||[]).find(e=>{var c;return(e==null?void 0:e.ability_type)==="robot_smart_menu"&&((c=e==null?void 0:e.robot_config)==null?void 0:c.fixed_menu)==="1"});S?B.value={key:"smart-menu",id:"smart-menu",icon:()=>u(f,{name:"smart-menu",class:"menu-icon"}),label:(se=S==null?void 0:S.menu)==null?void 0:se.name,title:(ae=S==null?void 0:S.menu)==null?void 0:ae.name,path:((ie=S==null?void 0:S.menu)==null?void 0:ie.path)||"/robot/ability/smart-menu",menuIn:["0","1"]}:B.value=null;const d=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_payment");if(d){const e=((re=d==null?void 0:d.robot_config)==null?void 0:re.switch_status)??((le=d==null?void 0:d.user_config)==null?void 0:le.switch_status)??"0",c=((ce=d==null?void 0:d.robot_config)==null?void 0:ce.ai_reply_status)??((ue=d==null?void 0:d.user_config)==null?void 0:ue.ai_reply_status)??"0";s.setPaymentSwitchStatus(String(e)),s.setPaymentAiReplyStatus(String(c))}else s.setPaymentSwitchStatus("0"),s.setPaymentAiReplyStatus("0");const v=(A||[]).find(e=>{var c;return(e==null?void 0:e.ability_type)==="robot_payment"&&((c=e==null?void 0:e.robot_config)==null?void 0:c.fixed_menu)==="1"});v?z.value={key:"payment",id:"payment",icon:()=>u(f,{name:"payment",class:"menu-icon"}),label:(fe=v==null?void 0:v.menu)==null?void 0:fe.name,title:(pe=v==null?void 0:v.menu)==null?void 0:pe.name,path:((_e=v==null?void 0:v.menu)==null?void 0:_e.path)||"/robot/ability/payment",menuIn:["0","1"]}:z.value=null}catch(E){console.warn("refreshAbilityMenu failed",E)}}function Y(n){var t,m;const a=((t=g.robotInfo)==null?void 0:t.id)||r.id,l=(m=n==null?void 0:n.detail)==null?void 0:m.robotId;!l||!a||String(l)!==String(a)||O()}Se(()=>{O(),window.addEventListener("robotAbilityUpdated",Y)}),ve(()=>{window.removeEventListener("robotAbilityUpdated",Y)});const U=H(()=>{let n=K;ge(r.id)==1?n=n.filter(t=>t.id=="external-services"):n=n.filter(t=>{var m;return t.menuIn.includes((m=g.robotInfo)==null?void 0:m.application_type)});const a=[...n],l=a.findIndex(t=>t.id==="function-center");if(l>=0){const t=[];R.value&&t.push(R.value),$.value&&t.push($.value),B.value&&t.push(B.value),z.value&&t.push(z.value),a[l]={...a[l],children:t}}return a}),he=H(()=>{const n=U.value.find(l=>l.id==="function-center");return n&&Array.isArray(n.children)&&n.children.length>0?["function-center"]:[]}),ke=n=>i.path.split("/")[3]===n.id,we=({item:n})=>{q.value.includes(n.id)};return(n,a)=>{const l=N("router-link"),t=$e,m=Ie,x=Le;return k(),C("div",Be,[L(x,{class:"left-menu",mode:"inline",selectedKeys:q.value,openKeys:he.value,onClick:we},{default:M(()=>[(k(!0),C(P,null,ye(U.value,o=>(k(),C(P,{key:o.key},[o.children&&o.children.length?(k(),I(m,{key:o.key,icon:o.icon,class:Me({"submenu-selected":ke(o)})},{title:M(()=>[L(l,{class:"default-color",to:{path:o.path,query:o.query||j(r)},target:o.target||"_self",onClick:a[0]||(a[0]=Re(()=>{},["stop"]))},{default:M(()=>[G(W(o.label),1)]),_:2},1032,["to","target"])]),default:M(()=>[(k(!0),C(P,null,ye(o.children,h=>(k(),I(l,{class:"default-color",key:h.key,to:{path:h.path,query:h.query||j(r)},target:h.target||"_self"},{default:M(()=>[(k(),I(t,{icon:h.icon,path:h.path,key:h.key},{default:M(()=>[G(W(h.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["to","target"]))),128))]),_:2},1032,["icon","class"])):(k(),I(l,{key:1,class:"default-color",target:o.target||"_self",to:{path:o.path,query:o.query||j(r)}},{default:M(()=>[(k(),I(t,{icon:o.icon,path:o.path,key:o.key},{default:M(()=>[G(W(o.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))],64))),128))]),_:1},8,["selectedKeys","openKeys"])])}}},Ee=me(ze,[["__scopeId","data-v-ff091b0b"]]),Fe=Ae({name:"robotPage",components:{leftMenu:Ee,TopHeader:Te},async beforeRouteEnter(b,T,i){const s=D(),{getRobot:g,robotInfo:r,getRobotLists:q,getGroupList:K}=s;await g(b.query.id),q(),K();let R=ge(b.query.id);if(R==0){i("/no-permission");return}if(R==1){window.location.href=`${r.h5_domain}/#/chat/pc?robot_key=${r.robot_key}`,i("/robot/list");return}let $=["basicConfig","libraryConfig","skillConfig"];if(r.application_type==1&&$.includes(b.name)){i(`/robot/config/workflow?id=${r.id}&robot_key=${r.robot_key}`);return}if(r.application_type==0&&b.name=="robotWorkflow"){i(`/robot/config/basic-config?id=${r.id}&robot_key=${r.robot_key}`);return}i()},setup(){const b=Ce(),T=D(),{robotInfo:i}=xe(T),s=H(()=>be().name!="robotWorkflow");return{robotInfo:i,changeMenu:r=>{b.push({path:r.path,query:{robot_key:i.value.robot_key,id:i.value.id}})},isShowLeft:s}}}),He={class:"robot-main-container"},Ne={class:"robot-page-layout"},Ue={key:0,class:"layout-left"},Ve={class:"layout-body"};function Pe(b,T,i,s,g,r){const q=N("TopHeader"),K=N("leftMenu"),R=N("router-view");return k(),C("div",He,[de("div",Ne,[b.isShowLeft?(k(),C("div",Ue,[L(q),L(K,{onChangeMenu:b.changeMenu,robotInfo:b.robotInfo},null,8,["onChangeMenu","robotInfo"])])):qe("",!0),de("div",Ve,[L(R)])])])}const oo=me(Fe,[["render",Pe],["__scopeId","data-v-f64f13e3"]]);export{oo as default};
