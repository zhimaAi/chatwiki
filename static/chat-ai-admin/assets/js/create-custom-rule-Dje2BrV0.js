import{b as Y,d as j}from"../../index-CPkdGIiL.js";import{e as A,ab as H,r as M,f as g,o as W,Y as _,a5 as l,k as n,ae as c,a2 as i,F as Z,a9 as ee,a7 as R,aa as te,_ as a,G as p,a1 as oe}from"./vue-chunks-Ci-XTWEs.js";import{M as le}from"./model-select-CiMSoZvM.js";import{al as se,a8 as ne,ai as de}from"./index-Bu5ae_-0.js";import{I as re,X as ie,ad as ae,Q as _e,q as pe,B as me,M as ue,ag as ce,ao as ye,R as ve,y as fe,a as m}from"./ui-antd-Bw8cEW5z.js";import"./utils-ChQO-_r6.js";import"./index-BxiNNyyE.js";const ge={class:"default-rule-page"},ke={class:"form-row"},we={class:"form-row"},he={class:"module-card"},Ce={class:"module-card-header"},be={class:"module-card-title"},Se={key:0,class:"module-card-body"},xe={class:"field"},Ae={key:0,class:"field"},Re={class:"tag-list"},Ie={key:1,class:"field"},ze={key:2,class:"field"},Ue={key:3,class:"field"},Ne={class:"module-card"},Me={class:"module-card-header"},Oe={class:"module-card-title"},Ve={key:0,class:"module-card-body"},Be={class:"field"},Le={class:"field"},Te={class:"field"},Je={class:"field-label"},Ke={class:"module-card"},qe={class:"module-card-header"},$e={class:"module-card-title"},De={key:0,class:"module-card-body"},Fe={class:"field"},Ee={class:"page-right-footer"},Ge={class:"task-modal"},Pe={key:0},Qe={__name:"create-custom-rule",setup(Xe){const y=H(),O=te(),w=A(()=>y.name==="exploreAiCommentManagementCreateCustomRule"&&y.query.copy==="1"),h=A(()=>y.name==="exploreAiCommentManagementCreateCustomRule"&&y.query.id),t=M({rule_name:"",use_model:"",model_config_id:"",delete_comment_switch:1,delete_type:[1,2],delete_keywords:[],delete_condition:2,delete_priority:1,delete_prompt:"",reply_comment_switch:1,reply_check_prompt:"",reply_type:1,reply_prompt:"",elect_comment_switch:1,elect_prompt:""}),I=A(()=>t.reply_type===1?"回复内容":"回复内容规则"),k=g(""),V=(d,e)=>{t.use_model=e.modelName,t.model_config_id=e.modelId},B=d=>{t.delete_keywords.splice(d,1)},L=()=>{const d=(k.value||"").trim();d&&(t.delete_keywords.includes(d)||t.delete_keywords.push(d),k.value="")},C=g(!1),z=g([]),b=g(!1),u=M({page:1,size:10,total:0}),U=g([]),T=[{title:"群发名称",dataIndex:"task_name",key:"task_name"}],J=d=>{U.value=d.map(e=>String(e))},K=()=>{b.value=!0,ne({page:u.page,size:u.size}).then(d=>{const e=(d==null?void 0:d.data)||{list:[],total:0};z.value=e.list||[],u.total=+e.total||0}).finally(()=>{b.value=!1})},q=d=>{u.page=d.current,u.size=d.pageSize,K()},$=()=>{const d={};(w.value||h.value)&&(d.id=y.query.id),se(d).then(e=>{const r=(e==null?void 0:e.data)||null;if(r){if(t.rule_name=r.rule_name||"默认规则",t.use_model=r.use_model||t.use_model,t.model_config_id=r.model_config_id||t.model_config_id,t.delete_comment_switch=+r.delete_comment_switch||0,t.reply_comment_switch=+r.reply_comment_switch||0,t.elect_comment_switch=+r.elect_comment_switch||0,r.delete_comment_rule){let s=r.delete_comment_rule;if(typeof s=="string")try{s=JSON.parse(s)}catch{}t.delete_type=Array.isArray(s.type)?s.type:[],t.delete_keywords=Array.isArray(s.keywords)?s.keywords:[],t.delete_condition=+s.condition||t.delete_condition,t.delete_priority=+s.priority||t.delete_priority,t.delete_prompt=s.prompt||""}if(r.reply_comment_rule){let s=r.reply_comment_rule;if(typeof s=="string")try{s=JSON.parse(s)}catch{}t.reply_check_prompt=s.check_reply_prompt||"",t.reply_type=+s.reply_type||t.reply_type,t.reply_prompt=s.reply_prompt||""}if(r.elect_comment_rule){let s=r.elect_comment_rule;if(typeof s=="string")try{s=JSON.parse(s)}catch{}t.elect_prompt=s.prompt||""}}})},D=()=>{if(!String(t.rule_name||"").trim())return m.error("请输入规则名称");if(!t.use_model)return m.error("请选择模型");if(t.delete_comment_switch==1){const e=Array.isArray(t.delete_type)?t.delete_type:[],r=e.includes(1),s=e.includes(2);if(e.length===0)return m.error("AI自动删评，请至少勾选一个选项");if(r&&(!t.delete_keywords||t.delete_keywords.length===0))return m.error("请输入敏感词");if(s&&!String(t.delete_prompt||"").trim())return m.error("请输入AI检测规则")}if(t.reply_comment_switch==1){if(!String(t.reply_check_prompt||"").trim())return m.error("请输入自动回复规则");if(!String(t.reply_prompt||"").trim())return m.error(`请输入${I.value}`)}if(t.elect_comment_switch==1&&!String(t.elect_prompt||"").trim())return m.error("请输入自动精选规则");const d={rule_name:t.rule_name,use_model:t.use_model,model_config_id:t.model_config_id,delete_comment_switch:t.delete_comment_switch,delete_comment_rule:JSON.stringify((()=>{const e=Array.isArray(t.delete_type)?t.delete_type:[],r=e.includes(2),s={type:e,keywords:t.delete_keywords,prompt:t.delete_prompt};return r&&(s.condition=t.delete_condition,s.priority=t.delete_priority),s})()),reply_comment_switch:t.reply_comment_switch,reply_comment_rule:JSON.stringify({check_reply_prompt:t.reply_check_prompt,reply_type:t.reply_type,reply_prompt:t.reply_prompt}),elect_comment_switch:t.elect_comment_switch,elect_comment_rule:JSON.stringify({prompt:t.elect_prompt})};h.value&&!w.value&&(d.id=y.query.id),de(d).then(()=>{m.success("保存成功")}),O.back()};return W(()=>{(h.value||w.value)&&$()}),(d,e)=>{const r=re,s=j,S=ie,N=ce,F=ae,E=ye,f=_e,v=ve,x=pe,G=me,P=fe,Q=ue;return a(),_("div",ge,[l("div",ke,[e[17]||(e[17]=l("div",{class:"form-label"},"规则名称",-1)),n(r,{value:t.rule_name,"onUpdate:value":e[0]||(e[0]=o=>t.rule_name=o),placeholder:"请输入规则名称",style:{width:"300px"}},null,8,["value"])]),l("div",we,[e[18]||(e[18]=l("div",{class:"form-label"},"模型",-1)),n(le,{modelType:"LLM",modeName:t.use_model,"onUpdate:modeName":e[1]||(e[1]=o=>t.use_model=o),modeId:t.model_config_id,"onUpdate:modeId":e[2]||(e[2]=o=>t.model_config_id=o),style:{width:"300px"},onChange:V},null,8,["modeName","modeId"])]),l("div",he,[l("div",Ce,[l("div",be,[n(s,{name:"comment-delete",style:{"font-size":"16px","margin-right":"8px"}}),e[19]||(e[19]=l("span",null,"AI自动删评",-1))]),n(S,{checked:t.delete_comment_switch,"onUpdate:checked":e[3]||(e[3]=o=>t.delete_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),t.delete_comment_switch==1?(a(),_("div",Se,[l("div",xe,[e[22]||(e[22]=l("div",{class:"field-label"},"规则",-1)),n(F,{value:t.delete_type,"onUpdate:value":e[4]||(e[4]=o=>t.delete_type=o)},{default:i(()=>[n(N,{value:1},{default:i(()=>e[20]||(e[20]=[p("触发敏感词")])),_:1,__:[20]}),n(N,{value:2},{default:i(()=>e[21]||(e[21]=[p("AI检测")])),_:1,__:[21]})]),_:1},8,["value"])]),(t.delete_type||[]).includes(1)?(a(),_("div",Ae,[e[23]||(e[23]=l("div",{class:"field-label"},"敏感词",-1)),l("div",Re,[(a(!0),_(Z,null,ee(t.delete_keywords,(o,X)=>(a(),oe(E,{key:o,closable:"",onClose:Ye=>B(X)},{default:i(()=>[p(R(o),1)]),_:2},1032,["onClose"]))),128))]),n(f,{value:k.value,"onUpdate:value":e[5]||(e[5]=o=>k.value=o),placeholder:"请输入",onBlur:L,"auto-size":{minRows:2}},null,8,["value"])])):c("",!0),(t.delete_type||[]).includes(2)?(a(),_("div",Ie,[e[24]||(e[24]=l("div",{class:"field-label"},"AI检测规则",-1)),n(f,{value:t.delete_prompt,"onUpdate:value":e[6]||(e[6]=o=>t.delete_prompt=o),placeholder:"请输入","auto-size":{minRows:3}},null,8,["value"])])):c("",!0),(t.delete_type||[]).includes(2)?(a(),_("div",ze,[e[27]||(e[27]=l("div",{class:"field-label"},"条件",-1)),n(x,{value:t.delete_condition,"onUpdate:value":e[7]||(e[7]=o=>t.delete_condition=o)},{default:i(()=>[n(v,{value:1},{default:i(()=>e[25]||(e[25]=[p("全部满足")])),_:1,__:[25]}),n(v,{value:2},{default:i(()=>e[26]||(e[26]=[p("满足其中一个条件")])),_:1,__:[26]})]),_:1},8,["value"])])):c("",!0),(t.delete_type||[]).includes(2)?(a(),_("div",Ue,[e[30]||(e[30]=l("div",{class:"field-label"},"优先级",-1)),n(x,{value:t.delete_priority,"onUpdate:value":e[8]||(e[8]=o=>t.delete_priority=o)},{default:i(()=>[n(v,{value:1},{default:i(()=>e[28]||(e[28]=[p("敏感词优先")])),_:1,__:[28]}),n(v,{value:2},{default:i(()=>e[29]||(e[29]=[p("AI检测优先")])),_:1,__:[29]})]),_:1},8,["value"])])):c("",!0)])):c("",!0)]),l("div",Ne,[l("div",Me,[l("div",Oe,[n(s,{name:"comment-reply",style:{"font-size":"16px","margin-right":"8px"}}),e[31]||(e[31]=l("span",null,"AI自动回复",-1))]),n(S,{checked:t.reply_comment_switch,"onUpdate:checked":e[9]||(e[9]=o=>t.reply_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),t.reply_comment_switch==1?(a(),_("div",Ve,[l("div",Be,[e[32]||(e[32]=l("div",{class:"field-label"},"自动回复规则",-1)),n(f,{value:t.reply_check_prompt,"onUpdate:value":e[10]||(e[10]=o=>t.reply_check_prompt=o),placeholder:"请输入","auto-size":{minRows:3}},null,8,["value"])]),l("div",Le,[e[35]||(e[35]=l("div",{class:"field-label"},"回复内容",-1)),n(x,{value:t.reply_type,"onUpdate:value":e[11]||(e[11]=o=>t.reply_type=o)},{default:i(()=>[n(v,{value:1},{default:i(()=>e[33]||(e[33]=[p("固定回复内容")])),_:1,__:[33]}),n(v,{value:2},{default:i(()=>e[34]||(e[34]=[p("AI生成回复内容")])),_:1,__:[34]})]),_:1},8,["value"])]),l("div",Te,[l("div",Je,R(I.value),1),n(f,{value:t.reply_prompt,"onUpdate:value":e[12]||(e[12]=o=>t.reply_prompt=o),placeholder:"请输入","auto-size":{minRows:3}},null,8,["value"])])])):c("",!0)]),l("div",Ke,[l("div",qe,[l("div",$e,[n(s,{name:"comment-selected",style:{"font-size":"16px","margin-right":"8px"}}),e[36]||(e[36]=l("span",null,"AI自动精选",-1))]),n(S,{checked:t.elect_comment_switch,"onUpdate:checked":e[13]||(e[13]=o=>t.elect_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),t.elect_comment_switch==1?(a(),_("div",De,[l("div",Fe,[e[37]||(e[37]=l("div",{class:"field-label"},"自动精选规则",-1)),n(f,{value:t.elect_prompt,"onUpdate:value":e[14]||(e[14]=o=>t.elect_prompt=o),placeholder:"请输入","auto-size":{minRows:3}},null,8,["value"])])])):c("",!0)]),l("div",Ee,[n(G,{type:"primary",onClick:D},{default:i(()=>e[38]||(e[38]=[p("保存并应用")])),_:1,__:[38]})]),n(Q,{open:C.value,"onUpdate:open":e[15]||(e[15]=o=>C.value=o),title:"选择群发任务",width:720,onOk:d.confirmSelectTasks,onCancel:e[16]||(e[16]=o=>C.value=!1)},{default:i(()=>[l("div",Ge,[n(P,{columns:T,"data-source":z.value,"row-key":o=>String(o.id),loading:b.value,pagination:{current:u.page,pageSize:u.size,total:u.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:q,"row-selection":{selectedRowKeys:U.value,onChange:J,preserveSelectedRowKeys:!0}},{headerCell:i(({column:o})=>[typeof o.title=="string"?(a(),_("span",Pe,R(o.title),1)):c("",!0)]),_:1},8,["data-source","row-key","loading","pagination","row-selection"])])]),_:1},8,["open","onOk"])])}}},lt=Y(Qe,[["__scopeId","data-v-eeba035f"]]);export{lt as default};
