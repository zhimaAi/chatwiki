{"version":3,"file":"add-collaborator-Ww1-CyL9.js","sources":["../../../../front-end/chat-ai-admin-vue/src/components/add-collaborator/add-collaborator.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <a-modal\r\n      v-model:open=\"open\"\r\n      :title=\"t('title_add_collaborator')\"\r\n      @ok=\"handleOk\"\r\n      :width=\"746\"\r\n      wrapClassName=\"no-padding-modal\"\r\n      :bodyStyle=\"{ 'max-height': '500px', 'overflow-y': 'auto' }\"\r\n      :confirmLoading=\"saveLoading\"\r\n    >\r\n      <div class=\"form-box\">\r\n        <a-form layout=\"vertical\">\r\n          <a-form-item :label=\"t('label_collaboration_permission')\" required>\r\n            <a-radio-group v-model:value=\"formState.operate_rights\">\r\n              <a-radio value=\"4\">{{ t('btn_manage') }}</a-radio>\r\n              <a-radio value=\"2\">{{ t('btn_edit') }}</a-radio>\r\n              <a-radio value=\"1\">{{ t('btn_view') }}</a-radio>\r\n            </a-radio-group>\r\n          </a-form-item>\r\n          <a-form-item :label=\"t('label_collaborator')\" required>\r\n            <a-radio-group v-model:value=\"formState.identity_type\">\r\n              <a-radio value=\"1\">{{ t('btn_select_by_member') }}</a-radio>\r\n              <a-radio value=\"2\">{{ t('btn_select_by_org') }}</a-radio>\r\n            </a-radio-group>\r\n            <div class=\"form-tip\" v-if=\"role_permission && role_permission.includes('TeamManage')\">\r\n              {{ t('msg_no_account_tip') }} <a @click=\"toManagePage\">{{ t('btn_go_to_add') }}</a>\r\n            </div>\r\n          </a-form-item>\r\n          <div class=\"list-box\" v-if=\"formState.identity_type == 1\">\r\n            <div\r\n              class=\"type-item\"\r\n              v-for=\"item in userLists\"\r\n              :key=\"item.value\"\r\n              @click=\"handleChangeUser(item)\"\r\n            >\r\n              <div class=\"user-block\">\r\n                <a-avatar shape=\"square\" :src=\"item.avatar\" :size=\"40\">\r\n                  <template #icon><UserOutlined v-if=\"!item.avatar\" /></template>\r\n                </a-avatar>\r\n                <div class=\"name-box\">\r\n                  <div class=\"name\">{{ item.user_name }}</div>\r\n                  <div class=\"remark-text\">{{ item.nick_name }}</div>\r\n                </div>\r\n              </div>\r\n              <svg-icon\r\n                class=\"check-arrow\"\r\n                name=\"check-arrow-filled\"\r\n                style=\"font-size: 24px; color: #fff\"\r\n                v-if=\"userCheckList.includes(item.id)\"\r\n              ></svg-icon>\r\n            </div>\r\n          </div>\r\n          <div class=\"checkbox-list\" v-if=\"formState.identity_type == 2\">\r\n            <a-checkbox-group v-model:value=\"departmentCheckList\" style=\"width: 100%\">\r\n              <div class=\"checklist-item\">\r\n                <a-checkbox v-for=\"item in departmentLists\" :key=\"item.id\" :value=\"item.id\">\r\n                  <div>{{ item.department_name }}</div>\r\n                </a-checkbox>\r\n              </div>\r\n            </a-checkbox-group>\r\n          </div>\r\n        </a-form>\r\n      </div>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed } from 'vue'\r\nimport { Form, message } from 'ant-design-vue'\r\nimport { UserOutlined } from '@ant-design/icons-vue'\r\nimport { getUserList } from '@/api/manage/index.js'\r\nimport { getAllDepartment, savePermissionManage } from '@/api/department/index.js'\r\nimport { usePermissionStore } from '@/stores/modules/permission'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('components.add-collaborator.add-collaborator')\r\n\r\nconst role_permission = computed(() => usePermissionStore().role_permission || [])\r\n\r\nconst emit = defineEmits(['ok'])\r\nconst useForm = Form.useForm\r\nconst open = ref(false)\r\n\r\nconst props = defineProps({\r\n  libraryInfo: {\r\n    type: Object,\r\n    default: () => {}\r\n  }\r\n})\r\n\r\nconst formState = reactive({\r\n  identity_type: '1',\r\n  operate_rights: '4'\r\n})\r\n\r\nconst userCheckList = ref([])\r\nconst departmentCheckList = ref([])\r\n\r\nconst handleChangeUser = (item) => {\r\n  if (item.role_type == 1) {\r\n    // if (!userCheckList.value.includes(item.id)) {\r\n    //   userCheckList.value.push(item.id)\r\n    // }\r\n    return\r\n  }\r\n  if (userCheckList.value.includes(item.id)) {\r\n    userCheckList.value = userCheckList.value.filter((id) => id != item.id)\r\n  } else {\r\n    userCheckList.value.push(item.id)\r\n  }\r\n}\r\nconst formRules = reactive({})\r\n\r\nconst { resetFields, validate, validateInfos } = useForm(formState, formRules)\r\n\r\nlet object_array = []\r\n\r\nlet tempCheckList = []\r\nconst show = (data, list) => {\r\n  getAllDepartList()\r\n  userCheckList.value = []\r\n  departmentCheckList.value = []\r\n  tempCheckList = []\r\n  data.forEach((item) => {\r\n    if (item.identity_type == 1) {\r\n      // 用户\r\n      // userCheckList.value.push(item.identity_id)\r\n      tempCheckList.push(item.identity_id)\r\n    }\r\n    if (item.identity_type == 2) {\r\n      // 部门\r\n      departmentCheckList.value.push(item.identity_id)\r\n    }\r\n  })\r\n  getAllUserList()\r\n  formState.operate_rights = '4'\r\n  formState.identity_type = '1'\r\n  object_array = list\r\n  open.value = true\r\n}\r\n\r\nconst saveLoading = ref(false)\r\nconst handleOk = () => {\r\n  object_array = object_array.map((item) => {\r\n    return {\r\n      object_id: +item.object_id,\r\n      object_type: +item.object_type,\r\n      operate_rights: +formState.operate_rights\r\n    }\r\n  })\r\n  let identity_ids = []\r\n  if (formState.identity_type == 1) {\r\n    identity_ids = userCheckList.value\r\n  } else {\r\n    identity_ids = departmentCheckList.value\r\n  }\r\n  if (identity_ids.length == 0) {\r\n    message.error(t('msg_select_member_or_org'))\r\n    return\r\n  }\r\n  let parmas = {\r\n    identity_type: formState.identity_type,\r\n    object_array: JSON.stringify(object_array),\r\n    identity_ids: identity_ids.join(',')\r\n  }\r\n  saveLoading.value = true\r\n  savePermissionManage(parmas)\r\n    .then((res) => {\r\n      message.success(t('msg_save_success'))\r\n      open.value = false\r\n      emit('ok')\r\n    })\r\n    .finally(() => {\r\n      saveLoading.value = false\r\n    })\r\n}\r\n\r\nconst userLists = ref([])\r\nconst getAllUserList = () => {\r\n  getUserList({\r\n    page: 1,\r\n    size: 200\r\n  }).then((res) => {\r\n    // userLists.value = res.data.list\r\n    userLists.value = res.data.list.filter(item => !tempCheckList.includes(item.id))\r\n  })\r\n}\r\n\r\nconst departmentLists = ref([])\r\nconst getAllDepartList = () => {\r\n  getAllDepartment().then((res) => {\r\n    let data = res.data || []\r\n    departmentLists.value = data\r\n  })\r\n}\r\n\r\nconst toManagePage = () => {\r\n  window.open(`/#/user/manage`)\r\n}\r\n\r\ndefineExpose({\r\n  show\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.form-box {\r\n  margin-top: 24px;\r\n  padding-right: 16px;\r\n  .ant-form-item {\r\n    margin-bottom: 16px;\r\n  }\r\n  ::v-deep(.ant-form-item-label) {\r\n    padding: 0 0 4px;\r\n  }\r\n  .form-tip {\r\n    color: #8c8c8c;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n    font-weight: 400;\r\n    margin-top: 4px;\r\n  }\r\n}\r\n\r\n.list-box {\r\n  display: flex;\r\n  margin-top: -8px;\r\n  flex-wrap: wrap;\r\n  gap: 8px;\r\n  .type-item {\r\n    position: relative;\r\n    width: 100%;\r\n    cursor: pointer;\r\n    padding: 16px;\r\n    display: flex;\r\n    border: 1px solid #e8e8e8;\r\n    border-radius: 6px;\r\n    box-shadow: none;\r\n    transition: box-shadow 1s;\r\n    width: calc(50% - 4px);\r\n    &:hover {\r\n      box-shadow:\r\n        0px 5px 5px -3px rgba(0, 0, 0, 0.1),\r\n        0px 8px 10px 1px rgba(0, 0, 0, 0.06),\r\n        0px 3px 14px 2px rgba(0, 0, 0, 0.05);\r\n    }\r\n    &.active {\r\n      border: 2px solid #2475fc;\r\n    }\r\n    .check-arrow {\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: -1px;\r\n    }\r\n  }\r\n  .user-block {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    .name-box {\r\n      flex: 1;\r\n      color: #262626;\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n    }\r\n    .remark-text {\r\n      margin-top: 2px;\r\n      font-size: 12px;\r\n      color: #8c8c8c;\r\n      line-height: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n.checklist-item {\r\n  display: flex;\r\n  width: 100%;\r\n  flex-direction: column;\r\n  .ant-checkbox-wrapper {\r\n    width: 100%;\r\n    padding: 12px 16px;\r\n    border-bottom: 1px solid #e8e8e8;\r\n    ::v-deep(.ant-checkbox + span) {\r\n      flex: 1;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["t","useI18n","role_permission","computed","usePermissionStore","emit","__emit","useForm","Form","open","ref","formState","reactive","userCheckList","departmentCheckList","handleChangeUser","item","id","formRules","resetFields","validate","validateInfos","object_array","tempCheckList","show","data","list","getAllDepartList","getAllUserList","saveLoading","handleOk","identity_ids","message","parmas","savePermissionManage","res","userLists","getUserList","departmentLists","getAllDepartment","toManagePage","__expose","_createElementBlock","_createVNode","_component_a_modal","$event","_unref","_createElementVNode","_hoisted_1","_component_a_form","_component_a_form_item","_component_a_radio_group","_cache","_component_a_radio","_openBlock","_hoisted_2","_createTextVNode","_toDisplayString","_hoisted_3","_Fragment","_renderList","_hoisted_5","_component_a_avatar","_createBlock","UserOutlined","_hoisted_6","_hoisted_7","_hoisted_8","_component_svg_icon","_hoisted_9","_component_a_checkbox_group","_hoisted_10","_component_a_checkbox"],"mappings":"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"}