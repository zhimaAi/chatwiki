import{u as S,_ as L,b6 as U,b7 as P,b8 as H}from"../../index-DSFcP5NQ.js";import{r as C,E as T,j as N,w as G,a as m,b as r,p as e,y as n,t as h,F as j,l as I,u as s,e as A,_ as $,v as t,ag as K,q as M,ah as E}from"./vue-chunks-BdaA73Wf.js";import{d as g}from"./utils-CvB22N-W.js";import{T as W,r as X,P as Z,b as ee,at as te,_ as ae,u as se,v as oe,B as le,J as ne,w as ie,x as ce}from"./ui-antd-Dl1wwwCD.js";import{_ as B}from"./emoji-mart-BBMRoEa3.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./other-LrIFyvU9.js";const de={class:"zm-date"},_e={class:"date-btn"},re={class:"date-content"},ue={__name:"date",props:{datekey:{type:String,default:"1"}},emits:["dateChange"],setup(F,{emit:i}){const{t:p}=S("views.robot.robot-config.qa-feedback.components.date"),w=F,f=C(1),o=i;let Y=T([{label:"label_today",value:!0,key:2,start_time:g().startOf("day"),end_time:g().endOf("day")},{label:"label_yesterday",value:!1,key:3,start_time:g().subtract(1,"day").startOf("day"),end_time:g().startOf("day").subtract(1,"millisecond")},{label:"label_last_7_days",value:!1,key:4,start_time:g().subtract(6,"day").startOf("day"),end_time:g().endOf("day").subtract(1,"millisecond")}]);const a=C(null),c=C(null),b=C([]),d=l=>l>=g().subtract(0,"day"),_=()=>{let l=f.value,v=null;Y.forEach(u=>{u.key==l&&(v=u)}),v?(b.value=[v.start_time,v.end_time],a.value=v.start_time.format("YYYY-MM-DD"),c.value=v.end_time.format("YYYY-MM-DD")):(b.value=[],a.value=null,c.value=null),O()},D=l=>{const v=g(l[0]).startOf("day");if(g(l[1]).endOf("day").diff(v,"days")>29)b.value[0]=l[0].startOf("day"),b.value[1]=v.add(29,"days").endOf("day"),a.value=b.value[0].format("YYYY-MM-DD"),c.value=b.value[1].format("YYYY-MM-DD"),ee.error(p("error_max_30_days"));else{const x=g(l[0]).startOf("day").format("YYYY-MM-DD"),q=g(l[1]).endOf("day").format("YYYY-MM-DD");b.value=l,a.value=x,c.value=q}f.value=1,O()},O=()=>{o("dateChange",{start_date:a.value,end_date:c.value})};return N(()=>{f.value=parseInt(w.datekey),_()}),G(()=>w.datekey,(l,v)=>{f.value=parseInt(w.datekey.split("-")[0]),_()}),(l,v)=>{const u=W,x=X,q=Z;return r(),m("div",de,[e("div",_e,[n(x,{value:f.value,"onUpdate:value":v[0]||(v[0]=y=>f.value=y),onChange:_},{default:h(()=>[(r(!0),m(j,null,I(s(Y),y=>(r(),A(u,{class:"date-btn-button",value:y.key,key:y.key},{default:h(()=>[$(t(s(p)(y.label)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",re,[n(q,{value:b.value,"onUpdate:value":v[1]||(v[1]=y=>b.value=y),onChange:D,format:"YYYY-MM-DD",disabledDate:d,allowClear:!1},null,8,["value"])])])}}},pe={class:"feedbacks-log-content"},be={class:"feedbacks-log-items"},ve={class:"feedbacks-log-label"},me={class:"feedbacks-log-item"},fe={class:"feedbacks-log-items"},ke={class:"feedbacks-log-label"},ye={class:"feedbacks-log-item"},he={class:"feedbacks-log-items"},ge={class:"feedbacks-log-label"},xe={class:"feedbacks-log-item"},Ce={key:0,class:"item-type"},$e={key:1,class:"item-type"},we={class:"feedbacks-log-label"},Ye={class:"feedbacks-log-item"},De={class:"quotes-box"},qe={key:0,class:"document-content"},Oe={key:1},Me={class:"document-content"},ze={class:"document-content"},Fe=["onClick"],Se={class:"feedbacks-log-items"},je={class:"feedbacks-log-label"},Ie={class:"feedbacks-log-item"},Le={key:0},Te={key:1},Ne={key:2},Ae={class:"feedbacks-log-items"},Be={class:"feedbacks-log-label"},Re={class:"feedbacks-log-item"},Qe={__name:"feedbacks-log-alert",setup(F,{expose:i}){const{t:p}=S("views.robot.robot-config.qa-feedback.components.feedbacks-log-alert"),w=K(),f=C(!1),o=T({question:"",library:[],context_qa:[],cur_question:"",cur_answer:"",error:""}),Y=()=>{f.value=!1},a=()=>{o.question="",o.library=[],o.context_qa=[],o.cur_question="",o.cur_answer="",o.error=""},c=d=>{a();for(const _ in d)o[_]=d[_],_=="robot"&&(o[_]=JSON.parse(d[_])),_=="quotes"&&(o[_]=JSON.parse(d[_]));f.value=!0},b=d=>{w.push("/library/preview?id="+d.FileId)};return i({open:c}),(d,_)=>{const D=L,O=ae;return r(),A(O,{class:"feedbacks-log-alert",open:f.value,"onUpdate:open":_[0]||(_[0]=l=>f.value=l),title:s(p)("title_feedback_details"),placement:"right",width:"746px",closable:!1},{extra:h(()=>[e("span",{class:"close-btn",onClick:Y},[n(s(te))])]),default:h(()=>[e("div",pe,[e("div",be,[e("div",ve,[e("span",null,t(s(p)("label_question")),1)]),e("div",me,[e("p",null,t(o.question),1)])]),e("div",fe,[e("div",ke,[e("span",null,t(s(p)("label_answer")),1)]),e("div",ye,[e("p",null,t(o.answer),1)])]),e("div",he,[e("div",ge,[e("span",null,t(s(p)("label_feedback")),1)]),e("div",xe,[o.type=="1"?(r(),m("div",Ce,[n(D,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"like-active"}),$(t(s(p)("label_like")),1)])):M("",!0),o.type=="2"?(r(),m("div",$e,[n(D,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"dislike-active"}),$(t(s(p)("label_dislike")),1)])):M("",!0),e("p",null,t(o.content),1)])]),(r(!0),m(j,null,I(o.quotes,(l,v)=>(r(),m("div",{class:"feedbacks-log-items",key:l.FileId},[e("div",we,[e("span",null,t(s(p)("label_reference_content"))+t(v+1),1)]),e("div",Ye,[e("div",De,[l.Type==1?(r(),m("div",qe,t(l.Content),1)):l.Type==2?(r(),m("div",Oe,[e("div",Me,"Q："+t(l.Question),1),e("div",ze,"A："+t(l.Answer),1)])):M("",!0),e("div",{class:"quotes-title",onClick:u=>b(l)},[n(D,{style:{"font-size":"16px",color:"#2475FC","margin-right":"4px"},name:"quotes"}),$(t(l.FileName),1)],8,Fe)])])]))),128)),e("div",Se,[e("div",je,[e("span",null,t(s(p)("label_chat_mode")),1)]),e("div",Ie,[o.robot.chat_type=="1"?(r(),m("p",Le,t(s(p)("label_only_knowledge_base")),1)):o.robot.chat_type=="2"?(r(),m("p",Te,t(s(p)("label_direct_connection")),1)):o.robot.chat_type=="3"?(r(),m("p",Ne,t(s(p)("label_hybrid")),1)):M("",!0)])]),e("div",Ae,[e("div",Be,[e("span",null,t(s(p)("label_used_model")),1)]),e("div",Re,[e("p",null,t(o.robot.use_model)+"("+t(o.robot.corp_name)+")",1)])])])]),_:1},8,["open","title"])}}},Ve=B(Qe,[["__scopeId","data-v-1f006c86"]]),Ee={class:"team-members-pages"},Je={class:"total"},Ue={class:"label total-label"},Pe={class:"total-num"},He={class:"set-model"},Ge={class:"label set-model-label"},Ke={class:"set-model-body"},We={class:"set-date"},Xe={class:"label set-date-label"},Ze={class:"set-date-body"},et={class:"set-reset"},tt={class:"list-box"},at={class:"user-box"},st={class:"name-info"},ot={class:"user-name"},lt={class:"user-info"},nt={key:0,class:"item-type"},it={key:1,class:"item-type"},ct={class:"item-content"},dt={class:"item-date"},_t={__name:"qa-feedback",setup(F){const{t:i}=S("views.robot.robot-config.qa-feedback.qa-feedback"),p=C(null),w=E(),f=C("1"),o=w.query,Y=C([{key:"all",id:"all",label:"placeholder_all_types",title:"placeholder_all_types"},{key:"1",id:"1",label:"label_like",title:"label_like"},{key:"2",id:"2",label:"label_dislike",title:"label_dislike"}]),a=T({robot_id:o.id,page:1,size:20,total:0,type:"all",start_date:"",end_date:""}),c=u=>{a.start_date=u.start_date,a.end_date=u.end_date,D()},b=async u=>{const x=await U({id:u.id});p.value.open(x.data)},d=()=>{a.type="all",a.start_date="",a.end_date="",f.value="1-"+Math.random()},_=u=>{a.page=u.current,a.size=u.pageSize,l()},D=()=>{a.page=1,l()},O=C([]),l=()=>{let u={robot_id:a.robot_id,page:a.page,size:a.size,start_date:a.start_date,end_date:a.end_date};a.type!="all"&&(u.type=a.type),P(u).then(x=>{let q=x.data.list;q.forEach(y=>{y.create_time=y.create_time>0?g(y.create_time*1e3).format("YYYY-MM-DD HH:mm"):"--",y.content=y.content?y.content:"--"}),O.value=q,a.total=+x.data.total})},v=u=>{a.type=u,D()};return N(()=>{}),(u,x)=>{const q=oe,y=se,R=le,Q=ne,z=ie,V=L,J=ce;return r(),m("div",Ee,[n(Q,{justify:"flex-end"},{default:h(()=>[e("div",Je,[e("div",Ue,t(s(i)("label_total"))+"：",1),e("div",Pe,t(a.total)+" "+t(s(i)("label_item")),1)]),e("div",He,[e("div",Ge,t(s(i)("label_type"))+"：",1),e("div",Ke,[n(y,{value:a.type,"onUpdate:value":x[0]||(x[0]=k=>a.type=k),placeholder:s(i)("placeholder_all_types"),onChange:v,style:{width:"130px"}},{default:h(()=>[(r(!0),m(j,null,I(Y.value,k=>(r(),A(q,{key:k.key,value:k.id},{default:h(()=>[e("span",null,t(s(i)(k.label)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),e("div",We,[e("div",Xe,[e("span",null,t(s(i)("label_date"))+"：",1)]),e("div",Ze,[n(ue,{onDateChange:c,datekey:f.value},null,8,["datekey"])])]),e("div",et,[n(R,{onClick:d},{default:h(()=>[$(t(s(i)("btn_reset")),1)]),_:1})])]),_:1}),e("div",tt,[n(J,{"data-source":O.value,pagination:a.total>a.size?{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}:!1,onChange:_},{default:h(()=>[n(z,{title:s(i)("table_column_qa"),"data-index":"question",width:"411px"},{default:h(({record:k})=>[e("div",at,[e("div",st,[e("div",ot,t(k.question),1),e("div",lt,t(k.answer),1)])])]),_:1},8,["title"]),n(z,{title:s(i)("table_column_feedback"),"data-index":"type",width:"160px"},{default:h(({record:k})=>[k.type=="1"?(r(),m("div",nt,[n(V,{style:{"font-size":"24px",color:"#8C8C8C"},name:"like"}),$(t(s(i)("label_like")),1)])):M("",!0),k.type=="2"?(r(),m("div",it,[n(V,{style:{"font-size":"24px",color:"#8C8C8C"},name:"dislike"}),$(t(s(i)("label_dislike")),1)])):M("",!0)]),_:1},8,["title"]),n(z,{title:s(i)("table_column_feedback_content"),"data-index":"content",width:"264px"},{default:h(({record:k})=>[e("div",ct,t(k.content),1)]),_:1},8,["title"]),n(z,{title:s(i)("table_column_time"),"data-index":"create_time",width:"200px"},{default:h(({record:k})=>[e("div",dt,t(k.create_time),1)]),_:1},8,["title"]),n(z,{title:s(i)("table_column_action"),"data-index":"action",width:"88px"},{default:h(({record:k})=>[n(Q,{gap:16,class:"action-box"},{default:h(()=>[n(R,{type:"link",onClick:gt=>b(k)},{default:h(()=>[$(t(s(i)("btn_view_details")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","pagination"])]),n(Ve,{ref_key:"feedbacksLogAlertRef",ref:p},null,512)])}}},rt=B(_t,[["__scopeId","data-v-4381c2b0"]]),ut={class:"user-model-page"},pt={class:"page-title"},bt={class:"overview-box"},vt={class:"item-info"},mt={class:"item-icon-content item-like"},ft={class:"item-icon-content item-dislike"},kt={class:"page-title"},yt={class:"list-wrapper"},ht={__name:"index",setup(F){const{t:i}=S("views.robot.robot-config.qa-feedback.index"),w=E().query,f=C([]),o=a=>{let c={title:"",id:0};switch(a){case"today_stats":c.title="label_today",c.id=1;break;case"yesterday_stats":c.title="label_yesterday",c.id=2;break;case"week_stats":c.title="label_last_7_days",c.id=3;break;case"total_stats":c.title="label_total",c.id=4;break}return c},Y=()=>{let a={robot_id:w.id};H(a).then(c=>{const b=[];for(const d in c.data){const _=c.data[d];b.push({key:d,dislike:_.dislike,like_count:_.like_count,titleObj:o(d)})}f.value=b.sort((d,_)=>d.titleObj.id-_.titleObj.id)})};return N(()=>{Y()}),(a,c)=>{const b=L;return r(),m("div",ut,[e("div",pt,t(s(i)("title_data_overview")),1),e("div",bt,[(r(!0),m(j,null,I(f.value,d=>(r(),m("div",{class:"item-box",key:d.titleObj.id},[e("div",vt,t(s(i)(d.titleObj.title)),1),e("div",mt,[n(b,{style:{"font-size":"24px",color:"#8C8C8C"},name:"like"}),$(t(d.like_count),1)]),e("div",ft,[n(b,{style:{"font-size":"24px",color:"#8C8C8C"},name:"dislike"}),$(t(d.dislike),1)])]))),128))]),e("div",kt,t(s(i)("title_feedback_records")),1),e("div",yt,[n(rt)])])}}},Ft=B(ht,[["__scopeId","data-v-f473e96e"]]);export{Ft as default};
//# sourceMappingURL=index-k2kpM_YW.js.map
