import{u as I,ac as X,ad as K,_ as Q,bW as Z,ay as M,bt as E,bm as ee,bX as te,f as ae,A as oe,ax as le,bs as ne}from"../../index-DSFcP5NQ.js";import{a as L,F as se,l as re,b as k,p as a,v as i,y as n,t as d,u as l,Y as $,c as O,r as A,E as S,j as ie,e as _e,m as T,ag as ce,q as de,_ as pe}from"./vue-chunks-BdaA73Wf.js";import{_ as N}from"./emoji-mart-BBMRoEa3.js";import{q as ue,f as me,g as fe,i as be,b as B,F,c as ye,I as ve,V as he,M as z,B as ge,a1 as xe,O as ke}from"./ui-antd-Dl1wwwCD.js";import{t as we}from"./validate-8MtiUsxW.js";import{A as Ce}from"./avatar-input-C3IZiYPk.js";import{_ as Le}from"./page-alert-DLppgA58.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";const $e={class:"list-box"},Ae=["onClick"],De={class:"library-info"},qe=["src"],Oe={class:"library-info-content"},Be={class:"library-title"},Ie={class:"item-body"},Ne={class:"item-footer"},Re={class:"library-size"},Se={class:"text-item"},Te={class:"text-item"},Fe=["onClick"],Me=["onClick"],Ee={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup(D,{emit:r}){const{t:s}=I("views.public-library.list"),h=r,w=D,y=p=>{h("edit",p)},m=p=>{h("delete",p)};return(p,u)=>{const g=ue,C=Q,b=fe,_=me,e=be;return k(),L("div",$e,[(k(!0),L(se,null,re(w.list,o=>(k(),L("div",{class:"list-item-wrapper",key:o.id},[a("div",{class:"list-item",onClick:$(f=>y(o),["stop"])},[a("div",De,[a("img",{class:"library-icon",src:o.avatar,alt:""},null,8,qe),a("div",Oe,[a("div",Be,i(o.library_name),1)])]),a("div",Ie,[n(g,{title:l(K)(o.library_intro,o,14,2,0),placement:"top"},{default:d(()=>[a("div",{class:"library-desc",ref_for:!0,ref:f=>l(X)(f,o)},i(o.library_intro),513)]),_:2},1032,["title"])]),a("div",Ne,[a("div",Re,[a("span",Se,i(l(s)("document_label"))+i(o.file_total),1),a("span",Te,i(l(s)("size_label"))+i(o.file_size_str),1)]),a("div",{class:"action-box",onClick:u[1]||(u[1]=$(()=>{},["stop"]))},[n(e,null,{overlay:d(()=>[n(_,null,{default:d(()=>[n(b,null,{default:d(()=>[a("a",{href:"javascript:;",onClick:$(f=>y(o),["stop"])},i(l(s)("manage_action")),9,Fe)]),_:2},1024),n(b,null,{default:d(()=>[a("a",{class:"delete-text-color",href:"javascript:;",onClick:f=>m(o)},i(l(s)("delete_action")),9,Me)]),_:2},1024)]),_:2},1024)]),default:d(()=>[a("div",{class:"action-item",onClick:u[0]||(u[0]=$(()=>{},["stop"]))},[n(C,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Ae)]))),128))])}}},ze=N(Ee,[["__scopeId","data-v-15b466c6"]]),Pe={class:"form-box"},Ve={class:"form-item-tip"},Ue={__name:"add-library-model",setup(D,{expose:r}){const{t:s}=I("views.public-library.add.add-library-model"),h=Z(),w=O(()=>h.getCurrentLocale.lang==="zh-CN"?5:24);B.config({duration:2});const y=ce(),m=A(!1),p=O(()=>1);let u="",g="";const C=F.useForm,b=A(!1),_=p.value==0?M:E,e=S({type:p.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:_,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:p.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),o=S({library_name:[{required:!0,message:s("library_name_required"),trigger:"change"}]}),{validate:f,validateInfos:R}=C(e,o),P=t=>{e.avatar=t.imageUrl,e.avatar_file=t.file},V=()=>{m.value=!1},U=()=>{f().then(()=>{j()}).catch(t=>{})},j=()=>{let t=new FormData,c=JSON.parse(JSON.stringify(e));t.append("type",e.type),t.append("access_rights",e.access_rights),t.append("library_name",e.library_name),t.append("library_intro",e.library_intro),t.append("use_model",c.use_model),t.append("model_config_id",e.model_config_id),t.append("avatar",e.avatar_file?e.avatar_file:""),t.append("is_offline",e.is_offline),t.append("urls",JSON.stringify(we(e.urls))),t.append("doc_type",e.doc_type),t.append("file_name",e.file_name),t.append("is_qa_doc",e.is_qa_doc),t.append("qa_index_type",e.qa_index_type),t.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),t.append("is_default",2),b.value=!0,ee(t).then(x=>{B.success(s("create_success")),g=x.data.id,u=x.data.library_key,Y(x.data.id)}).catch(()=>{b.value=!1})},J=async()=>{let t=s("untitled_document"),c={library_key:u,doc_id:"",doc_type:"4",pid:0,title:t,content:s("untitled_document_heading"),sort:0};return await te(c)},Y=()=>{J().then(t=>{let c=t.data.doc_id;y.replace({path:"/public-library/editor",query:{library_id:g,library_key:u,doc_id:c}})})};return r({show:()=>{m.value=!0}}),ie(()=>{}),(t,c)=>{const x=ve,q=ye,W=he,G=F,H=z;return k(),_e(H,{open:m.value,"onUpdate:open":c[3]||(c[3]=v=>m.value=v),title:l(s)("modal_title"),onOk:U,confirmLoading:b.value,onCancel:V,width:"640px"},{default:d(()=>[a("div",Pe,[n(G,{"label-col":{span:w.value}},{default:d(()=>[n(q,T({ref:"name",label:l(s)("library_name_label")},l(R).library_name),{default:d(()=>[n(x,{value:e.library_name,"onUpdate:value":c[0]||(c[0]=v=>e.library_name=v),type:"text",placeholder:l(s)("library_name_placeholder"),maxlength:20},null,8,["value","placeholder"])]),_:1},16,["label"]),n(q,{label:l(s)("library_intro_label")},{default:d(()=>[n(W,{maxlength:1e3,value:e.library_intro,"onUpdate:value":c[1]||(c[1]=v=>e.library_intro=v),placeholder:l(s)("library_intro_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(q,T({ref:"name",label:l(s)("library_cover_label")},l(R).avatar),{default:d(()=>[n(Ce,{value:e.avatar,"onUpdate:value":c[2]||(c[2]=v=>e.avatar=v),onChange:P},null,8,["value"]),a("div",Ve,i(l(s)("library_cover_tip")),1)]),_:1},16,["label"])]),_:1},8,["label-col"])])]),_:1},8,["open","title","confirmLoading"])}}},je=N(Ue,[["__scopeId","data-v-87870dc5"]]),Je={"bg-color":"#f5f9ff",class:"library-page"},Ye={class:"page-title"},We={class:"library-page-body"},Ge={class:"list-toolbar"},He={class:"toolbar-box"},Xe={class:"list-total"},Ke={key:0,class:"toolbar-box"},Qe={__name:"index",setup(D){const{t:r}=I("views.public-library.list");let{role_permission:s,role_type:h}=ae();const w=O(()=>h==1||s.includes("CreateOpenLibDoc")),y=A(null),m=A([]),p=()=>{oe({type:1}).then(_=>{let e=_.data||[];e.forEach(o=>{o.file_size_str=le(o.file_size),o.avatar||(o.avatar=o.type==0?M:E)}),m.value=e})};p();const u=()=>{y.value.show()},g=_=>{window.open(`/#/public-library/home?library_id=${_.id}&library_key=${_.library_key}`,"_blank","noopener")},C=_=>{let e=3,o=z.confirm({title:r("delete_title",{library_name:_.library_name}),icon:n(ke),content:r("delete_confirm"),okText:e+" "+r("confirm"),okType:"danger",okButtonProps:{disabled:!0},cancelText:r("cancel"),onOk(){b(_)},onCancel(){}}),f=setInterval(()=>{e==1?(o.update({okText:r("confirm"),okButtonProps:{disabled:!1}}),clearInterval(f),f=void 0):(e-=1,o.update({okText:e+" "+r("confirm"),okButtonProps:{disabled:!0}}))},1e3)},b=({id:_})=>{ne({id:_}).then(()=>{B.success(r("delete_success")),p()})};return(_,e)=>{const o=ge;return k(),L("div",Je,[a("div",Ye,i(l(r)("page_title")),1),n(Le,{style:{"margin-bottom":"16px"},title:l(r)("usage_instruction")},{default:d(()=>[a("div",null,[a("p",null,i(l(r)("usage_instruction_1")),1),a("p",null,i(l(r)("usage_instruction_2")),1)])]),_:1},8,["title"]),a("div",We,[a("div",Ge,[a("div",He,[a("h3",Xe,i(l(r)("all"))+" ("+i(m.value.length)+")",1)]),w.value?(k(),L("div",Ke,[n(o,{type:"primary",onClick:e[0]||(e[0]=f=>u())},{icon:d(()=>[n(l(xe))]),default:d(()=>[pe(" "+i(l(r)("new_document")),1)]),_:1})])):de("",!0)]),a("div",null,[n(ze,{list:m.value,onAdd:u,onEdit:g,onDelete:C},null,8,["list"])])]),n(je,{ref_key:"addLibraryModelRef",ref:y},null,512)])}}},ut=N(Qe,[["__scopeId","data-v-af94b39e"]]);export{ut as default};
//# sourceMappingURL=index-CuC1h4Rw.js.map
