import{i as G,L as P}from"./index-BfDgZ-27.js";import{n as C,k as rt,b as W,B as J,bN as nt,bD as lt}from"../../index-M_xDbIir.js";import{d as S,z,q as R,w as N,N as $,O as f,X as e,j as s,U as r,F as U,a1 as K,u as I,S as L,Z as g,_ as T,o as Q,a3 as X,a2 as it,a6 as j}from"./vue-chunks-BRsu9_To.js";import{a as dt,_ as ct}from"./RadioButton-Bb2kU0Fd.js";import{R as _t}from"./dayjs-DGNhaBdA.js";import{S as Z,a as tt}from"./index-khLftDou.js";import{Q as E}from"./QuestionCircleOutlined-B5SgdGK5.js";import{_ as et}from"./index-CSIZCO5e.js";import{_ as at}from"./index-B0RyY99D.js";import{u as ut}from"./chat-CL2A-jFK.js";import{T as pt,_ as mt}from"./index-WJK8Aswe.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-DRzYyKbC.js";import"./Checkbox-pA5GUfu7.js";import"./index-Cs0K2ZaB.js";import"./index-D48_VNbE.js";import"./colors-C56HAaAp.js";import"./ClockCircleOutlined-DkyJWIQA.js";import"./useMergedState-C0iIHNGF.js";import"./Trigger-CkoSoTBd.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./shallowequal-C0xnIuy8.js";import"./index-Btmz2D3B.js";import"./move-DD64vPeJ.js";import"./slide-DzpBPoRp.js";import"./index-CMIXnI2Z.js";import"./List-DKTpjnke.js";import"./DownOutlined-CI2wWtcJ.js";import"./CheckOutlined-DVulUWsT.js";import"./SearchOutlined-KUcJKUZw.js";import"./index-71hSlXGB.js";import"./index-mwk_dyAT.js";import"./useEventBus-BwH2zX88.js";import"./useIM-CnuA2bvJ.js";import"./index-BR_iTZbN.js";import"./index-B3CPYV6x.js";import"./collapseMotion-Brd6xpAT.js";import"./Dropdown-Dh4cjnmT.js";import"./useRefs-CRRjy_qY.js";import"./pick-BW-qU63h.js";import"./hasIn-DEwqUvIo.js";import"./PlusOutlined-DQ91YM1E.js";const yt={class:"zm-date"},ft={class:"date-btn"},ht={class:"date-content"},st={__name:"date",props:{datekey:{type:String,default:"1"}},emits:["dateChange"],setup(M,{emit:l}){const u=M,i=S(1),n=l;let p=z([{label:"近7日",value:!0,key:2,start_date:C().subtract(6,"day"),end_date:C().subtract(0,"day")},{label:"近14日",value:!1,key:3,start_date:C().subtract(13,"day"),end_date:C().subtract(0,"day")},{label:"近30日",value:!1,key:4,start_date:C().subtract(29,"day"),end_date:C().subtract(0,"day")}]);const d=S(null),o=S(null),c=S([]),x=h=>h>=C().subtract(0,"day"),Y=()=>{let h=i.value,m=null;p.forEach(A=>{A.key==h&&(m=A)}),c.value=[m.start_date,m.end_date],d.value=m.start_date.format("YYYY-MM-DD"),o.value=m.end_date.format("YYYY-MM-DD"),F()},B=(h,m)=>{const A=C(h[0]);C(h[1]).diff(A,"days")>29?(c.value[0]=h[0],c.value[1]=A.add(29,"days"),d.value=c.value[0].format("YYYY-MM-DD"),o.value=c.value[1].format("YYYY-MM-DD"),rt.error("最多只能选择30天")):(c.value=h,d.value=m[0],o.value=m[1]),i.value=1,F()},F=()=>{n("dateChange",{start_date:d.value,end_date:o.value})};return R(()=>{i.value=parseInt(u.datekey),Y()}),N(()=>u.datekey,(h,m)=>{i.value=parseInt(u.datekey.split("-")[0]),Y()}),(h,m)=>{const A=dt,O=ct,_=_t;return f(),$("div",yt,[e("div",ft,[s(O,{value:i.value,"onUpdate:value":m[0]||(m[0]=t=>i.value=t),onChange:Y},{default:r(()=>[(f(!0),$(U,null,K(I(p),t=>(f(),L(A,{class:"date-btn-button",value:t.key,key:t.key},{default:r(()=>[g(T(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",ht,[s(_,{value:c.value,"onUpdate:value":m[1]||(m[1]=t=>c.value=t),onChange:B,format:"YYYY-MM-DD",disabledDate:x,allowClear:!1},null,8,["value"])])])}}},vt={class:"container-echart"},bt=["id"],gt={__name:"echarts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}}},setup(M){const l=M;let u;const i=S(Math.floor(new Date().getTime()*Math.random())),n=()=>{const p={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"},left:"7%"},legend:{show:!1,right:"1%",textStyle:{color:"#262626",fontSize:"14px"},itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"5%",left:"10%",top:"10%",bottom:"25%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:l.xDataArray,axisLabel:{show:!0,fontSize:10,interval:0,rotate:60},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:l.yDataArray};u.setOption(p,{notMerge:!0})};return N(()=>l.xDataArray,()=>{setTimeout(()=>{n()},500)},{deep:!0}),N(()=>l.yDataArray,()=>{setTimeout(()=>{n()},500)},{deep:!0}),R(()=>{setTimeout(()=>{const p=document.getElementById(`echart${i.value}`);u=G(p),n()},500),window.addEventListener("resize",()=>{u.resize()})}),Q(()=>{window.removeEventListener("resize",()=>{u.resize()})}),(p,d)=>(f(),$("div",vt,[e("div",{id:"echart"+i.value,class:"interface-echart"},null,8,bt)]))}},q=W(gt,[["__scopeId","data-v-09286acf"]]),Dt={class:"team-members-pages"},xt={class:"set-model"},At={class:"set-model-body"},kt={class:"set-date"},St={class:"set-date-body"},wt={class:"set-reset"},Ct={class:"list-box"},$t={class:"list-item"},Mt={class:"item-top"},Yt={class:"item-top-left"},zt={class:"list-item"},It={class:"item-top"},Tt={class:"item-top-left"},Lt={class:"list-item"},Et={class:"item-top"},Ft={class:"item-top-left"},Ot={class:"list-item"},Bt={class:"item-top"},Nt={class:"item-top-left"},Wt={__name:"statistical_analysis",setup(M){const l=X(),u=[1,2,3,4],i=z({res1:null,res2:null,res3:null,res4:null}),n=z({res1:null,res2:null,res3:null,res4:null}),p=S([{key:"all",id:"all",label:"全部渠道",title:"全部渠道"},{key:"yun_h5",id:"yun_h5",label:"WebAPP",title:"WebAPP"},{key:"yun_pc",id:"yun_pc",label:"嵌入网站",title:"嵌入网站"}]),d=S("2"),o=z({channel:"all",start_date:"",end_date:""}),c=_=>{o.start_date=_.start_date,o.end_date=_.end_date,Y()},x=()=>{o.channel="all",d.value="2-"+Math.random()},Y=()=>{for(let _=0;_<u.length;_++){const t=u[_];A(t)}},B=z({name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}),F=_=>{const t=[];return _.map(a=>t.push(a.date.slice(5,a.date.length))),t},h=_=>(_/1e3).toFixed(2),m=(_,t)=>{const a=JSON.parse(JSON.stringify(B)),k=[];let v="日活用户数（人）";switch(t){case"1":v="日活用户数（人）";break;case"2":v="日新增用户数（人）";break;case"3":v="总消息数（条）";break;case"4":v="token消耗数（千）";break}return _.map(w=>k.push(t=="4"?h(w.amount):w.amount)),a.name=v,a.data=k,[a]},A=_=>{let t={type:_,start_date:o.start_date,end_date:o.end_date,robot_id:l.query.id};o.channel!="all"&&(t.channel=o.channel),nt(t).then(a=>{a.data.length>0&&(i["res"+a.data[0].type]=F(a.data),n["res"+a.data[0].type]=m(a.data,a.data[0].type))})},O=_=>{o.channel=_,Y()};return R(()=>{}),(_,t)=>{const a=tt,k=Z,v=J,w=et,D=at;return f(),$("div",Dt,[s(w,{justify:"flex-start"},{default:r(()=>[e("div",xt,[t[1]||(t[1]=e("div",{class:"label set-model-label"},"渠道：",-1)),e("div",At,[s(k,{value:o.channel,"onUpdate:value":t[0]||(t[0]=b=>o.channel=b),placeholder:"全部渠道",onChange:O,style:{width:"200px"}},{default:r(()=>[(f(!0),$(U,null,K(p.value,b=>(f(),L(a,{key:b.key,value:b.id},{default:r(()=>[e("span",null,T(b.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",kt,[t[2]||(t[2]=e("div",{class:"label set-date-label"},[e("span",null,"日期：")],-1)),e("div",St,[s(st,{onDateChange:c,datekey:d.value},null,8,["datekey"])])]),e("div",wt,[s(v,{onClick:x},{default:r(()=>t[3]||(t[3]=[g("重置")])),_:1,__:[3]})])]),_:1}),e("div",Ct,[e("div",$t,[e("div",Mt,[e("div",Yt,[t[5]||(t[5]=e("div",{class:"item-top-title"},"日活用户数",-1)),s(D,{placement:"top"},{title:r(()=>t[4]||(t[4]=[g("每天进行有效沟通的用户数。有效沟通的判定标准为一次及以上的问—答。")])),default:r(()=>[s(I(E))]),_:1})]),t[6]||(t[6]=e("div",{class:"item-top-right"},"单位（人）",-1))]),s(q,{xDataArray:i.res1,yDataArray:n.res1},null,8,["xDataArray","yDataArray"])]),e("div",zt,[e("div",It,[e("div",Tt,[t[8]||(t[8]=e("div",{class:"item-top-title"},"日新增用户数",-1)),s(D,{placement:"top"},{title:r(()=>t[7]||(t[7]=[g("每天进行有效沟通的新增用户数。有效沟通的判定标准为一次及以上的—问—答。")])),default:r(()=>[s(I(E))]),_:1})]),t[9]||(t[9]=e("div",{class:"item-top-right"},"单位（人）",-1))]),s(q,{xDataArray:i.res2,yDataArray:n.res2},null,8,["xDataArray","yDataArray"])]),e("div",Lt,[e("div",Et,[e("div",Ft,[t[11]||(t[11]=e("div",{class:"item-top-title"},"总消息数",-1)),s(D,{placement:"top"},{title:r(()=>t[10]||(t[10]=[g("每天用户和机器人沟通过程中产生的所有消息总数。")])),default:r(()=>[s(I(E))]),_:1})]),t[12]||(t[12]=e("div",{class:"item-top-right"},"单位（条）",-1))]),s(q,{xDataArray:i.res3,yDataArray:n.res3},null,8,["xDataArray","yDataArray"])]),e("div",Ot,[e("div",Bt,[e("div",Nt,[t[14]||(t[14]=e("div",{class:"item-top-title"},"Token消耗数",-1)),s(D,{placement:"top"},{title:r(()=>t[13]||(t[13]=[g("每天大模型消耗的token总数，包括使用大模型回答问题、优化问题、推荐问题的token消耗。")])),default:r(()=>[s(I(E))]),_:1})]),t[15]||(t[15]=e("div",{class:"item-top-right"},"单位（千）",-1))]),s(q,{xDataArray:i.res4,yDataArray:n.res4},null,8,["xDataArray","yDataArray"])])])])}}},Rt=W(Wt,[["__scopeId","data-v-67b0ae6e"]]),qt={class:"container-echart"},Pt=["id"],Ut={__name:"hit-line-charts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}},grid:{type:Object,default:function(){return{right:"5%",left:"0%",top:"0%",bottom:"35%"}}}},setup(M){const l=M;let u;const i=S(Math.floor(new Date().getTime()*Math.random())),n=()=>{const p={tooltip:{trigger:"axis",formatter:function(d){let o=d[0].axisValue+"<br>";return d.forEach(c=>{let x=c.value;c.seriesName==="命中率"&&(x+="%"),o+=`
              <span style="display:inline-block;margin-right:5px;border-radius:10px;
              width:9px;height:9px;background-color:${c.color};"></span>
              ${c.seriesName}: ${x}<br>
            `}),o}},grid:{right:"7%",left:"4%",top:"10%",bottom:"10%"},legend:{data:["消息总数","命中消息","未命中消息","命中率"],bottom:0},xAxis:{type:"category",data:l.xDataArray},yAxis:[{type:"value",name:"数量（次）"},{type:"value",name:"百分比（%）",axisLabel:{formatter:"{value}%"}}],series:l.yDataArray.map((d,o)=>d.name==="命中率"?{...d,yAxisIndex:1}:d)};u.setOption(p,{notMerge:!0})};return N(()=>l.xDataArray,()=>{setTimeout(()=>{n()},500)},{deep:!0}),N(()=>l.yDataArray,()=>{setTimeout(()=>{n()},500)},{deep:!0}),R(()=>{setTimeout(()=>{const p=document.getElementById(`echart${i.value}`);u=G(p),n()},500),window.addEventListener("resize",()=>{u.resize()})}),Q(()=>{window.removeEventListener("resize",()=>{u.resize()})}),(p,d)=>(f(),$("div",qt,[e("div",{id:"echart"+i.value,class:"interface-echart"},null,8,Pt)]))}},Kt=W(Ut,[["__scopeId","data-v-bf840eda"]]),Vt={class:"team-members-pages"},jt={class:"search-item"},Ht={class:"search-content"},Gt={class:"search-item"},Jt={class:"search-content"},Qt={class:"search-item"},Xt={class:"statics-header"},Zt={class:"statics-item"},te={class:"title"},ee={class:"num"},ae={class:"statics-item"},se={class:"title"},oe={class:"num"},re={class:"statics-item"},ne={class:"title"},le={class:"num"},ie={class:"statics-item"},de={class:"title"},ce={class:"num"},_e={__name:"hit-statics",setup(M){const l=it(),u=ut(),{getChannelList:i}=u,n=X(),p=S([]),d=S("2"),o=z({robot_id:n.query.id,start_date:"",end_date:"",channel:""}),c=z({library_hit_rate:0,library_hit_total:0,library_miss_total:0,message_total:0}),x=z({xAxis:[],series:[]}),Y=async()=>{const t=await i({robot_id:n.query.id});p.value=[{app_type:"",app_name:"全部渠道",app_id:""},...t.data]},B=t=>{o.start_date=t.start_date,o.end_date=t.end_date,h()},F=()=>{o.channel="",d.value="2-"+Math.random()},h=()=>{m()},m=async()=>{lt({...o}).then(t=>{Object.assign(c,t.data.header);let a=t.data.chart_list||[],k=[],v=[];k=a.map(w=>C(w.date).format("MM-DD")),v=A(a),x.xAxis=k,x.series=v})},A=t=>{const a=[],k=t.map(y=>y.library_hit_rate),v=t.map(y=>y.library_hit_total),w=t.map(y=>y.library_miss_total),D=t.map(y=>y.message_total),b=(y,ot,V)=>({name:y,type:"line",showSymbol:!1,symbol:"circle",symbolSize:6,itemStyle:{color:V,borderColor:"#fff",borderWidth:2},lineStyle:{width:2,color:V},smooth:!0,data:ot});return a.push(b("消息总数",D,"#0079FE"),b("命中消息",v,"#00C292"),b("未命中消息",w,"#FF6B6B"),b("命中率",k,"#333")),a},O=(t,a)=>{o.app_type=a.data.app_type,o.app_id=a.data.app_id,h()},_=()=>{localStorage.setItem("/robot/config/unknown_issue/activeKey",1),l.push({path:"/robot/config/unknown_issue",query:{id:n.query.id,robot_key:n.query.robot_key,start_date:o.start_date,end_date:o.end_date}})};return R(()=>{Y()}),(t,a)=>{const k=tt,v=Z,w=J,D=et,b=at;return f(),$("div",Vt,[s(D,{justify:"flex-start",gap:16},{default:r(()=>[e("div",jt,[a[1]||(a[1]=e("div",{class:"search-label"},"渠道：",-1)),e("div",Ht,[s(v,{value:o.channel,"onUpdate:value":a[0]||(a[0]=y=>o.channel=y),placeholder:"全部渠道",onChange:O,style:{width:"200px"}},{default:r(()=>[(f(!0),$(U,null,K(p.value,y=>(f(),L(k,{data:y,key:y.app_id+y.app_type,value:y.app_id+y.app_type},{default:r(()=>[e("span",null,T(y.app_name),1)]),_:2},1032,["data","value"]))),128))]),_:1},8,["value"])])]),e("div",Gt,[a[2]||(a[2]=e("div",{class:"search-label"},[e("span",null,"日期：")],-1)),e("div",Jt,[s(st,{onDateChange:B,datekey:d.value,disabledValue:"2025-01-01"},null,8,["datekey"])])]),e("div",Qt,[s(w,{onClick:F},{default:r(()=>a[3]||(a[3]=[g("重置")])),_:1,__:[3]})])]),_:1}),e("div",Xt,[e("div",Zt,[e("div",te,[s(D,{align:"center",gap:4},{default:r(()=>[a[5]||(a[5]=g("知识命中率 ")),s(b,null,{title:r(()=>a[4]||(a[4]=[g("命中知识库消息数 / 机器人回复消息总数")])),default:r(()=>[s(I(E))]),_:1})]),_:1,__:[5]})]),e("div",ee,T(c.library_hit_rate)+"%",1)]),e("div",ae,[e("div",se,[s(D,{align:"center",gap:4},{default:r(()=>[a[7]||(a[7]=g("消息总数 ")),s(b,null,{title:r(()=>a[6]||(a[6]=[g("仅统计机器人回复对应消息数量，不含人工服务期间消息")])),default:r(()=>[s(I(E))]),_:1})]),_:1,__:[7]})]),e("div",oe,T(c.message_total),1)]),e("div",re,[e("div",ne,[s(D,{align:"center",gap:4},{default:r(()=>[a[9]||(a[9]=g("知识库命中消息数 ")),s(b,null,{title:r(()=>a[8]||(a[8]=[g("机器人回复时，检索到知识库文档，则认为命中消息")])),default:r(()=>[s(I(E))]),_:1})]),_:1,__:[9]})]),e("div",le,T(c.library_hit_total),1)]),e("div",ie,[e("div",de,[s(D,{align:"center",gap:4},{default:r(()=>a[10]||(a[10]=[g("知识库未命中消息数 ")])),_:1,__:[10]}),e("a",{onClick:_},"详情")]),e("div",ce,T(c.library_miss_total),1)])]),e("div",null,[s(Kt,{ref:"hitLineChartRef",xDataArray:x.xAxis,yDataArray:x.series},null,8,["xDataArray","yDataArray"])])])}}},ue=W(_e,[["__scopeId","data-v-e9473f8e"]]),pe={class:"user-model-page"},me={class:"list-wrapper"},H="/robot/config/statistical_analysis/activeKey",ye={__name:"index",setup(M){const l=S(+localStorage.getItem(H)||1),u=()=>{localStorage.setItem(H,l.value)};return(i,n)=>{const p=mt,d=pt;return f(),$("div",pe,[s(d,{class:"tab-wrapper",onChange:u,activeKey:l.value,"onUpdate:activeKey":n[0]||(n[0]=o=>l.value=o)},{default:r(()=>[(f(),L(p,{key:1,tab:"基础统计"})),(f(),L(p,{key:3,tab:"命中统计"}))]),_:1},8,["activeKey"]),e("div",me,[l.value===1?(f(),L(Rt,{key:0})):j("",!0),l.value===3?(f(),L(ue,{key:1})):j("",!0)])])}}},la=W(ye,[["__scopeId","data-v-56921557"]]);export{la as default};
