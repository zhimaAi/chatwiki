{"version":3,"file":"index-tTkldvhy.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/public-library/ai/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"ai-config-page\">\r\n    <ConfigPageMenu />\r\n    <div class=\"page-container\">\r\n      <div class=\"ai-config-form\">\r\n        <a-form\r\n          ref=\"formRef\"\r\n          :model=\"formState\"\r\n          :label-col=\"{ span: 4 }\"\r\n          :wrapper-col=\"{ span: 8 }\"\r\n        >\r\n          <a-form-item>\r\n            <template #label>\r\n              {{ t('embed') }}&nbsp;\r\n              <a-tooltip>\r\n                <template #title>{{ t('embed_tooltip') }}</template>\r\n                <InfoCircleOutlined />\r\n              </a-tooltip>\r\n            </template>\r\n            <a-switch\r\n              v-model:checked=\"formState.use_model_switch\"\r\n              unCheckedValue=\"0\"\r\n              checkedValue=\"1\"\r\n            />\r\n          </a-form-item>\r\n\r\n          <a-form-item\r\n            :label=\"t('embed_model')\"\r\n            name=\"use_model\"\r\n            :rules=\"[{ required: true, message: t('select_embed_model') }]\"\r\n            v-if=\"formState.use_model_switch == 1\"\r\n          >\r\n            <ModelSelect\r\n              modelType=\"TEXT EMBEDDING\"\r\n              :placeholder=\"t('select_embed_model')\"\r\n              v-model:modeName=\"formState.use_model\"\r\n              v-model:modeId=\"formState.model_config_id\"\r\n            />\r\n          </a-form-item>\r\n\r\n          <a-form-item>\r\n            <template #label>\r\n              {{ t('ai_summary') }}&nbsp;\r\n              <a-tooltip>\r\n                <template #title>{{ t('ai_summary_tooltip') }}</template>\r\n                <InfoCircleOutlined />\r\n              </a-tooltip>\r\n            </template>\r\n            <a-switch v-model:checked=\"formState.ai_summary\" unCheckedValue=\"0\" checkedValue=\"1\" />\r\n          </a-form-item>\r\n\r\n          <a-form-item\r\n            :label=\"t('summary_model')\"\r\n            name=\"ai_summary_model\"\r\n            :rules=\"[{ required: true, message: t('select_summary_model') }]\"\r\n            v-if=\"formState.ai_summary == 1\"\r\n          >\r\n            <ModelSelect\r\n              modelType=\"LLM\"\r\n              v-model:modeName=\"formState.ai_summary_model\"\r\n              v-model:modeId=\"formState.summary_model_config_id\"\r\n            />\r\n          </a-form-item>\r\n\r\n          <a-form-item :wrapper-col=\"{ offset: 4, span: 8 }\">\r\n            <a-button type=\"primary\" :loading=\"loading\" @click=\"handleSubmit\">{{ t('save') }}</a-button>\r\n          </a-form-item>\r\n        </a-form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { getLibraryInfo, editLibrary } from '@/api/library/index'\r\nimport { useRoute } from 'vue-router'\r\nimport { ref, reactive, computed, onMounted, toRaw } from 'vue'\r\nimport { InfoCircleOutlined } from '@ant-design/icons-vue'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport ConfigPageMenu from '../components/config-page-menu.vue'\r\nimport ModelSelect from '@/components/model-select/model-select.vue'\r\nimport { usePublicLibraryStore } from '@/stores/modules/public-library'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.public-library.ai.index')\r\n\r\nconst libraryStore = usePublicLibraryStore()\r\n\r\nconst route = useRoute()\r\nconst library_id = computed(() => route.query.library_id)\r\nconst formRef = ref()\r\nconst loading = ref(false)\r\nlet oldState = {}\r\nconst formState = reactive({\r\n  library_name: '',\r\n  library_intro: '',\r\n  ai_summary: '',\r\n  ai_summary_model: '',\r\n  access_rights: '',\r\n  model_config_id: '',\r\n  use_model: '',\r\n  use_model_switch: '',\r\n  statistics_set: '',\r\n  summary_model_config_id: ''\r\n})\r\n\r\nconst handleSubmit = async () => {\r\n  try {\r\n    await formRef.value.validate()\r\n    // TODO: 调用API保存数据\r\n    let isChangeModel = oldState.use_model != formState.use_model\r\n    if (isChangeModel) {\r\n      Modal.confirm({\r\n        title: t('confirm_switch_model', { model: formState.use_model }),\r\n        content: t('switch_model_warning'),\r\n        okText: t('confirm'),\r\n        cancelText: t('cancel'),\r\n        onOk() {\r\n          saveData()\r\n        }\r\n      })\r\n    } else {\r\n      saveData()\r\n    }\r\n  } catch (error) {\r\n    console.error(t('form_validation_failed'), error)\r\n  }\r\n}\r\n\r\nconst saveData = () => {\r\n  let data = {\r\n    ...toRaw(formState)\r\n  }\r\n\r\n  loading.value = true\r\n  editLibrary(data)\r\n    .then(() => {\r\n      message.success(t('save_success'))\r\n      loading.value = false\r\n      oldState = JSON.parse(JSON.stringify(data))\r\n\r\n      libraryStore.getLibraryInfo()\r\n    })\r\n    .catch(() => {\r\n      loading.value = false\r\n    })\r\n}\r\n\r\nconst getData = () => {\r\n  getLibraryInfo({ id: library_id.value }).then((res) => {\r\n    let data = res.data || {}\r\n    data.use_model = data.use_model || void 0\r\n    data.ai_summary_model = data.ai_summary_model || void 0\r\n    oldState = JSON.parse(JSON.stringify(data))\r\n    Object.assign(formState, data)\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  getData()\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.ai-config-form {\r\n  padding: 8px 24px 24px;\r\n}\r\n.model-icon {\r\n  height: 18px;\r\n}\r\n</style>\r\n"],"names":["t","useI18n","libraryStore","usePublicLibraryStore","route","useRoute","library_id","computed","formRef","ref","loading","oldState","formState","reactive","handleSubmit","Modal","saveData","error","data","toRaw","editLibrary","message","getData","getLibraryInfo","res","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createVNode","ConfigPageMenu","_createElementVNode","_hoisted_2","_hoisted_3","_component_a_form","_component_a_form_item","_createTextVNode","_toDisplayString","_unref","_component_a_tooltip","InfoCircleOutlined","_component_a_switch","_cache","$event","_createBlock","ModelSelect","_component_a_button"],"mappings":"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"}