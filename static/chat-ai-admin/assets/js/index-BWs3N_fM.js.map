{"version":3,"file":"index-BWs3N_fM.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/export-record/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.user-model-page {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #f2f4f7;\r\n  display: flex;\r\n  flex-direction: column;\r\n  overflow: hidden;\r\n  .page-title {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 24px;\r\n    padding: 24px 24px 16px;\r\n    background-color: #fff;\r\n    color: #000000;\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n  }\r\n\r\n  .list-wrapper {\r\n    background: #fff;\r\n    flex: 1;\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n  }\r\n  .content-wrapper {\r\n    padding: 0 24px 16px 24px;\r\n  }\r\n  .search-block {\r\n    margin-top: 24px;\r\n  }\r\n  .table-list {\r\n    margin-top: 16px;\r\n  }\r\n  .status-item {\r\n    display: flex;\r\n    height: 22px;\r\n    align-items: center;\r\n    width: fit-content;\r\n    border-radius: 6px;\r\n    gap: 4px;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n    padding: 0 6px;\r\n    font-weight: 500;\r\n    white-space: nowrap;\r\n    .anticon {\r\n      font-size: 15px;\r\n    }\r\n    &.status-0 {\r\n      background: #edeff2;\r\n      color: #3a4559;\r\n    }\r\n    &.status-1 {\r\n      background: #e8effc;\r\n      color: #2475fc;\r\n    }\r\n    &.status-2 {\r\n      background: #e8fcf3;\r\n      color: #21a665;\r\n    }\r\n    &.status-3 {\r\n      color: #fb363f;\r\n      background-color: #f5c6c8;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"user-model-page\">\r\n    <div class=\"page-title\">{{ t('title_export_record') }}</div>\r\n    <div class=\"list-wrapper\">\r\n      <div class=\"content-wrapper\">\r\n        <a-alert show-icon :message=\"t('msg_export_file_retention')\"></a-alert>\r\n        <div class=\"search-block\">\r\n          <DateSelect datekey=\"2\" @dateChange=\"onDateChange\" />\r\n        </div>\r\n\r\n        <a-table\r\n          class=\"table-list\"\r\n          :columns=\"columns\"\r\n          :data-source=\"tableData\"\r\n          :pagination=\"{\r\n            current: requestParams.page,\r\n            total: requestParams.total,\r\n            pageSize: requestParams.size,\r\n            showQuickJumper: true,\r\n            showSizeChanger: true,\r\n            pageSizeOptions: ['10', '20', '50', '100']\r\n          }\"\r\n          @change=\"onTableChange\"\r\n        >\r\n          <template #bodyCell=\"{ column, record }\">\r\n            <template v-if=\"column.key === 'status'\">\r\n              <div v-if=\"record.status == 0\" class=\"status-item status-0\">\r\n                <ClockCircleFilled />{{ t('status_waiting_export') }}\r\n              </div>\r\n              <div v-if=\"record.status == 1\" class=\"status-item status-1\">\r\n                <LoadingOutlined />{{ t('status_exporting') }}\r\n              </div>\r\n              <div v-if=\"record.status == 2\" class=\"status-item status-2\">\r\n                <CheckCircleFilled />{{ t('status_export_success') }}\r\n              </div>\r\n              <div v-if=\"record.status == 3\" class=\"status-item status-3\">\r\n                <CloseCircleFilled />{{ t('status_export_failed') }}\r\n                <a-tooltip v-if=\"record.err_msg\">\r\n                  <template #title>{{ record.err_msg }}</template>\r\n                  <QuestionCircleOutlined />\r\n                </a-tooltip>\r\n              </div>\r\n            </template>\r\n\r\n            <template v-if=\"column.key === 'action'\">\r\n              <a @click=\"handleDownload(record)\" v-if=\"!record.is_over_7_days\">{{ t('action_download') }}</a>\r\n              <span v-else>--</span>\r\n            </template>\r\n          </template>\r\n        </a-table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport DateSelect from './components/date.vue'\r\nimport { getExportTaskList, downloadExportFile } from '@/api/chat'\r\nimport {\r\n  ClockCircleFilled,\r\n  CheckCircleFilled,\r\n  LoadingOutlined,\r\n  CloseCircleFilled,\r\n  QuestionCircleOutlined\r\n} from '@ant-design/icons-vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useUserStore } from '@/stores/modules/user'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport dayjs from 'dayjs'\r\nimport { reactive, ref } from 'vue'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.export-record.index')\r\nconst userStore = useUserStore()\r\nconst query = useRoute().query\r\n\r\nconst tableData = ref([])\r\n\r\nconst requestParams = reactive({\r\n  robot_id: query.id,\r\n  page: 1,\r\n  size: 10,\r\n  total: 0,\r\n  start_time: '',\r\n  end_time: ''\r\n})\r\n\r\nconst onTableChange = (pagination) => {\r\n  requestParams.page = pagination.current\r\n  requestParams.size = pagination.pageSize\r\n  getData()\r\n}\r\n\r\nconst onSearch = () => {\r\n  requestParams.page = 1\r\n  getData()\r\n}\r\n\r\nconst onDateChange = (data) => {\r\n  requestParams.start_time = data.start_time\r\n  requestParams.end_time = data.end_time\r\n  onSearch()\r\n}\r\n\r\nconst getData = () => {\r\n  getExportTaskList({\r\n    ...requestParams\r\n  }).then((res) => {\r\n    let lists = res.data.list\r\n    let maps = res.data.map\r\n    lists.forEach((item) => {\r\n      item.create_time_desc = dayjs(item.create_time * 1000).format('YYYY/MM/DD HH:mm')\r\n      item.source_desc = maps.filter((it) => it.source == item.source)[0]?.source_name\r\n      item.is_over_7_days = item.create_time < Date.now() / 1000 - 7 * 24 * 60 * 60\r\n    })\r\n    tableData.value = lists\r\n    requestParams.total = +res.data.total\r\n  })\r\n}\r\n\r\nconst handleDownload = (record) => {\r\n  // window.open(`/manage/downloadExportFile?id=${record.id}&robot_id=${query.id}`)\r\n  let targetUrl = `/manage/downloadExportFile?id=${record.id}&robot_id=${query.id}&token=${userStore.getToken}`\r\n  var aTag = document.createElement('a')\r\n  aTag.href = targetUrl\r\n  aTag.style.display = 'none'\r\n  aTag.click()\r\n  // document.body.removeChild(aTag)\r\n}\r\n\r\nconst columns = [\r\n  {\r\n    title: t('title_export_time'),\r\n    dataIndex: 'create_time_desc',\r\n    key: 'create_time_desc'\r\n  },\r\n  {\r\n    title: t('title_export_file_name'),\r\n    dataIndex: 'file_name',\r\n    key: 'file_name'\r\n  },\r\n  {\r\n    title: t('title_source'),\r\n    key: 'source_desc',\r\n    dataIndex: 'source_desc'\r\n  },\r\n  {\r\n    title: t('title_status'),\r\n    key: 'status',\r\n    dataIndex: 'status'\r\n  },\r\n  {\r\n    title: t('title_action'),\r\n    key: 'action'\r\n  }\r\n]\r\n</script>\r\n"],"names":["useI18n","userStore","useUserStore","query","useRoute","tableData","ref","requestParams","reactive","onTableChange","pagination","getData","onSearch","onDateChange","data","getExportTaskList","res","lists","maps","item","dayjs","_a","it","handleDownload","record","targetUrl","aTag","columns","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","_unref","_hoisted_3","_hoisted_4","_createVNode","_component_a_alert","_hoisted_5","DateSelect","_component_a_table","_withCtx","column","_Fragment","_hoisted_6","ClockCircleFilled","_hoisted_7","LoadingOutlined","_hoisted_8","CheckCircleFilled","_hoisted_9","CloseCircleFilled","_createTextVNode","_createBlock","_component_a_tooltip","QuestionCircleOutlined","$event","_hoisted_10"],"mappings":"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"}