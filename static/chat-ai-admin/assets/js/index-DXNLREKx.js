import{_ as rt}from"./cu-scroll-RG6yxhtf.js";import{a3 as et,d as h,ag as ct,N as u,O as l,j as i,U as r,_ as m,X as a,a6 as N,H as X,F as D,a1 as J,Z as v,S as L,u as d,Y as U,a0 as Y,z as ut}from"./vue-chunks-BRsu9_To.js";import{C as pt,S as _t}from"./classification-mark-modal-C56rYBrB.js";import{b as st,a6 as dt,bq as mt,dr as ft,d5 as vt,k as ot,M as Z,dq as gt,E as yt,d7 as ht,dN as K,B as kt,de as bt}from"../../index-M_xDbIir.js";import{S as A,a as W,c as tt,E as St}from"./edit-subsection-BWy4wHrv.js";import{C as Ct}from"./ClockCircleFilled-2GdWXrdd.js";import{S as xt}from"./index-D_6sH2t0.js";import"./index-D7wU2qJF.js";import{D as Lt}from"./dropdown-DCrM-GKY.js";import{M as qt,_ as wt}from"./index-B3CPYV6x.js";import{S as Mt}from"./SettingOutlined-fVP8x92y.js";import{S as Ot}from"./SyncOutlined-Ddoh8W5Z.js";import{M as $t}from"./MoreOutlined-CBDR9Xb3.js";import{_ as Et,a as It}from"./index-Bg1_T7h9.js";import{_ as Nt}from"./index-B0RyY99D.js";import{_ as Dt}from"./index-z217UQIH.js";import{S as Pt}from"./index-BC9KSyVC.js";import{S as zt,a as Bt}from"./index-khLftDou.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-WJK8Aswe.js";import"./Dropdown-Dh4cjnmT.js";import"./Trigger-CkoSoTBd.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-CMIXnI2Z.js";import"./useRefs-CRRjy_qY.js";import"./pick-BW-qU63h.js";import"./hasIn-DEwqUvIo.js";import"./useMergedState-C0iIHNGF.js";import"./PlusOutlined-DQ91YM1E.js";import"./slide-DzpBPoRp.js";import"./index-UA7y0weg.js";import"./Input-Bx6Hhp2b.js";import"./FormItemContext-DRzYyKbC.js";import"./index-Btmz2D3B.js";import"./inputProps-DsSGhBt6.js";import"./Search-w33R1D1l.js";import"./SearchOutlined-KUcJKUZw.js";import"./isPlainObject-A-SljaBF.js";import"./TextArea-C57yjED6.js";import"./Password-5njtOUlo.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./index-C8hUWloT.js";import"./index-BR_iTZbN.js";import"./index-BSroSjtu.js";import"./index-V0sRhm34.js";import"./Col-CFWsj1wI.js";import"./responsiveObserve-CRSSr9-w.js";import"./collapseMotion-Brd6xpAT.js";import"./QuestionCircleOutlined-B5SgdGK5.js";import"./DownloadOutlined-Cn7Sl8HY.js";import"./index-CsySi7_q.js";import"./CheckOutlined-DVulUWsT.js";import"./util-BwuffJOK.js";import"./index-DDHNcNyv.js";import"./index-Bm5IPe57.js";import"./index-BMSQkwth.js";import"./LeftOutlined-DbHJ8blF.js";import"./index-CwwB5REH.js";import"./index-tezmKtYb.js";import"./UpOutlined-DzDRcb4z.js";import"./DownOutlined-CI2wWtcJ.js";import"./RightOutlined-og3IpneX.js";import"./move-DD64vPeJ.js";import"./colors-C56HAaAp.js";import"./shallowequal-C0xnIuy8.js";import"./index-D8nD-csV.js";import"./List-DKTpjnke.js";import"./CaretDownFilled-BzxZQg7Y.js";import"./index-SuSZ4kHz.js";import"./index-Bn-th77D.js";import"./Checkbox-pA5GUfu7.js";import"./index-Dob-Z8xa.js";import"./RadioButton-Bb2kU0Fd.js";import"./CaretDownOutlined-C4FFiOW0.js";import"./index-RSdO8Qbf.js";const Ft={class:"subsection-box"},Rt=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#f40"}},Jt={key:2,class:"qa-list-box"},Qt={class:"list-item"},Vt={class:"list-content"},Tt={key:0,class:"list-item"},jt={class:"list-content"},Ut={class:"list-item"},At={class:"list-content"},Gt={class:"fragment-img"},Xt=["src"],Yt={key:3,class:"common-list-box"},Zt={class:"top-block"},Kt={class:"title"},Wt={class:"title"},te=["innerHTML"],ee={class:"fragment-img"},se=["src"],oe={key:0,class:"status-tag"},ie={key:1,class:"status-tag complete"},ae={class:"status-tag status-error"},ne={key:3,class:"status-tag running"},le={class:"right-opration"},re={key:0,class:"hover-btn-box"},ce={class:"hover-btn-box"},ue=["onClick"],pe=["onClick"],_e={class:"hover-btn-box"},de=["onClick"],me=["onClick"],fe={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup($,{expose:G,emit:Q}){const P=Q,z=$,_=et().query,g=(c,n)=>{let{id:f,title:S,content:H,question:I,answer:C,images:w,category_id:M,library_id:O}=c,x=c.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${n+1}】吗?`,onOk(){return new Promise((e,s)=>{gt({id:f,library_id:O,title:S,content:H,question:I,answer:C,images:w,category_id:M,similar_questions:JSON.stringify(x)}).then(t=>{P("handleConvert",c),e()}).catch(()=>{e()})})},onCancel(){}})},B=c=>{P("openEditSubscription",c)},F=c=>{Z.confirm({title:"提示",icon:i(yt),content:"是否取消该标记?",onOk(){b(c,{})},onCancel(){}})},y=h([]),E=()=>{ft({library_id:_.id}).then(c=>{y.value=c.data||[],P("getStatrList",c.data||[])})};E();const k=h(null),q=()=>{k.value.show()},R=c=>{var f;let n=(f=y.value.filter(S=>S.id==c.category_id)[0])==null?void 0:f.type;return n?tt[n]:"#F59A23"},b=(c,n={})=>{vt({id:c.id,category_id:n.id||0}).then(f=>{ot.success("修改成功"),n.id?c.category_id=n.id:P("handleDelParagraph",c.id),E()})},T=c=>{window.open(`/#/library/preview?id=${c.file_id}`)};return G({handleOpenEditModal:B}),(c,n)=>{const f=Et,S=Nt,H=xt,I=Dt,C=wt,w=qt,M=Lt,O=It,x=ct("viewer");return l(),u("div",Ft,[i(O,{"data-source":$.paragraphLists,pagination:!1},{default:r(()=>[i(f,{key:"id","data-index":"id",width:1148},{title:r(()=>[$.isQaLibray?(l(),u(D,{key:0},[v(" 问答（共"+m(z.total)+"个） ",1)],64)):(l(),u(D,{key:1},[v("分段 （共"+m(z.total)+"个分段）",1)],64))]),default:r(({record:e,index:s})=>[e.file_name?(l(),u("a",{key:0,class:"file-name-text",onClick:t=>T(e)},m(e.file_name),9,Rt)):(l(),u("div",Ht,"原文档已删除")),$.isQaLibray?(l(),u("div",Jt,[a("div",Qt,[n[0]||(n[0]=a("div",{class:"list-label"},"问题",-1)),a("div",Vt,m(e.question),1)]),e.similar_questions&&e.similar_questions.length?(l(),u("div",Tt,[n[1]||(n[1]=a("div",{class:"list-label"},"相似问法",-1)),a("div",jt,m(e.similar_questions.join("/")),1)])):N("",!0),a("div",Ut,[n[2]||(n[2]=a("div",{class:"list-label"},"答案",-1)),a("div",At,m(e.answer),1)]),X((l(),u("div",Gt,[(l(!0),u(D,null,J(e.images,(t,p)=>(l(),u("img",{key:p,src:t,alt:""},null,8,Xt))),128))])),[[x]])])):(l(),u("div",Yt,[a("div",Zt,[a("div",Kt,"分段"+m(s+1),1),a("div",Wt,m(e.title),1),a("span",null,"共"+m(e.word_total)+"个字符",1)]),a("div",{class:"content-box",innerHTML:e.content},null,8,te),X((l(),u("div",ee,[(l(!0),u(D,null,J(e.images,(t,p)=>(l(),u("img",{key:p,src:t,alt:""},null,8,se))),128))])),[[x]])]))]),_:1}),i(f,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:r(({record:e})=>[e.status==0?(l(),u("span",oe,[i(d(Ct)),n[3]||(n[3]=v(" 未转换"))])):N("",!0),e.status==1?(l(),u("span",ie,[i(d(dt)),n[4]||(n[4]=v(" 已转换"))])):N("",!0),e.status==2?(l(),L(S,{key:2,placement:"top"},{title:r(()=>[a("span",null,m(e.errmsg),1)]),default:r(()=>[a("span",null,[a("span",ae,[i(d(mt)),n[5]||(n[5]=v(" 转换异常"))])])]),_:2},1024)):N("",!0),e.status==3?(l(),u("span",ne,[i(H,{size:"small"}),n[6]||(n[6]=v(" 转换中"))])):N("",!0)]),_:1}),i(f,{title:"操作",key:"action","data-index":"action",width:120},{default:r(({record:e,index:s})=>[a("div",le,[$.isQaLibray?(l(),u("div",re,[e.category_id>0?(l(),L(I,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>b(e,{})},{default:r(()=>[i(d(A),{style:U({color:R(e),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),L(d(W),{key:1,onClick:t=>b(e,y.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])):(l(),L(M,{key:1},{overlay:r(()=>[i(w,null,{default:r(()=>[(l(!0),u(D,null,J(y.value,t=>(l(),L(C,{key:t.id},{default:r(()=>[a("div",{class:"start-item",onClick:p=>b(e,t)},[i(d(A),{style:U({color:d(tt)[t.type]})},null,8,["style"]),a("div",null,m(t.name||"-"),1)],8,ue)]),_:2},1024))),128)),i(C,null,{default:r(()=>[a("div",{class:"start-item",onClick:q},[i(d(Mt)),n[7]||(n[7]=a("div",null,"标记设置",-1))])]),_:1})]),_:2},1024)]),default:r(()=>[a("div",ce,[e.category_id>0?(l(),L(I,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>b(e,{})},{default:r(()=>[i(d(A),{style:U({color:R(e),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),L(d(W),{key:1,onClick:t=>b(e,y.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024)),i(S,null,{title:r(()=>n[8]||(n[8]=[v("重新转换")])),default:r(()=>[a("div",{class:"hover-btn-box",onClick:t=>g(e,s)},[i(d(Ot))],8,pe)]),_:2},1024),i(M,{placement:"bottomRight"},{overlay:r(()=>[i(w,null,{default:r(()=>[i(C,null,{default:r(()=>[a("div",{onClick:Y(t=>B(e),["stop"])},"编辑",8,de)]),_:2},1024),i(C,null,{default:r(()=>[a("div",{onClick:Y(t=>F(e),["stop"])},"删除",8,me)]),_:2},1024)]),_:2},1024)]),default:r(()=>[a("div",_e,[i(d($t))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),i(pt,{onOk:E,ref_key:"classificationMarkModalRef",ref:k},null,512)])}}},ve=st(fe,[["__scopeId","data-v-e14dfb75"]]),ge={class:"robot-page"},ye={class:"search-content-block"},he={class:"selct-star-box"},ke={class:"scroll-box"},be={class:"content-block"},Se={__name:"index",setup($){const Q=ht().type,z=et().query,V=h([]),_=h([]),g=h(0),B={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},F={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},y=h({}),E=s=>{V.value=s},k=h({page:1,size:30}),q=ut({status:-1,category_id:-1,library_id:z.id}),R=()=>{k.value.page=1,g.value=0,_.value=[],e()},b=s=>{q.category_id=s,R()},T=()=>{bt({id:z.id}).then(()=>ot.success("操作完成"))},c=h(null),n=s=>{c.value.showModal(JSON.parse(JSON.stringify(s)))},f=s=>{if(!s.id){k.value.page=1,e();return}let t=_.value,p=t.findIndex(o=>o.id==s.id);if(p>-1){let o=t[p];o.title=s.title,o.content=s.content,o.question=s.question,o.answer=s.answer,o.answer=s.answer,o.images=s.images,o.category_id=s.category_id,o.word_total=s.question.length+s.answer.length+s.content.length,o.similar_questions=JSON.parse(s.similar_questions),t.splice(p,1,o),_.value=t}},S=s=>{let t=_.value,p=t.findIndex(o=>o.id==s);p>-1&&(t.splice(p,1),_.value=t,g.value=--g.value,g.value)},H=()=>{x.value||_.value.length>=g.value||I()},I=()=>{k.value.page++,e()},C=()=>{M()};function w(){clearInterval(O),_.value.filter(t=>t.status==3).length?O=setInterval(()=>{M()},5e3):clearInterval(O)}const M=()=>{K({page:1,size:_.value.length,...q}).then(s=>{let p=s.data.list||[];p.forEach(o=>{o.status_text=F[o.status],o.graph_status_text=B[o.graph_status],o.similar_questions&&(o.similar_questions=JSON.parse(o.similar_questions))}),_.value=p,w()})};let O=null;const x=h(!1),e=()=>{x.value=!0,K({...k.value,...q}).then(s=>{x.value=!1;let t=s.data,p=t.list||[];t.info&&(y.value={...t.info,library_id:t.info.id,is_qa_doc:t.info.type==2?1:0}),p.forEach(o=>{o.status_text=F[o.status],o.graph_status_text=B[o.graph_status],o.similar_questions&&(o.similar_questions=JSON.parse(o.similar_questions))}),k.value.page==1&&(_.value=[]),_.value=[..._.value,...p],g.value=t.total,w()})};return e(),(s,t)=>{const p=Bt,o=zt,it=kt,at=Pt,nt=rt;return l(),u("div",ge,[a("div",ye,[a("div",he,[d(Q)==0?(l(),L(_t,{key:0,hideId:[0],startLists:V.value,onChange:b},null,8,["startLists"])):N("",!0)]),i(at,null,{default:r(()=>[i(o,{value:q.status,"onUpdate:value":t[0]||(t[0]=j=>q.status=j),placeholder:"请选择",style:{width:"160px"},onChange:R},{default:r(()=>[i(p,{value:-1},{default:r(()=>t[1]||(t[1]=[v("全部嵌入状态")])),_:1,__:[1]}),(l(),u(D,null,J(F,(j,lt)=>i(p,{value:lt},{default:r(()=>[v(m(j),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),i(it,{onClick:T},{default:r(()=>t[2]||(t[2]=[v("重新嵌入向量")])),_:1,__:[2]})]),_:1})]),a("div",ke,[i(nt,{scrollbar:{minSize:0},onOnScrollEnd:H},{default:r(()=>[a("div",be,[i(ve,{ref:"subsectionBoxRef",isQaLibray:y.value.is_qa_doc,total:g.value,paragraphLists:_.value,onOpenEditSubscription:n,onHandleDelParagraph:S,onHandleConvert:C,onGetStatrList:E},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),i(St,{detailsInfo:y.value,onHandleEdit:f,onHandleStatrList:E,ref_key:"editSubscriptionRef",ref:c},null,8,["detailsInfo"])])}}},Gs=st(Se,[["__scopeId","data-v-e1141154"]]);export{Gs as default};
