import{ch as I,ci as J,_ as X,j as K,A as W,cj as Z,ck as tt,cl as et}from"../../index-C5-B0r5-.js";import{P as at}from"./page-tabs-8XUPaggw.js";import{G as N,E as O,T as U,M as lt,d as B,X as st,H as nt,y as it,R as S,z as ot}from"./ui-antd-B11sc9DP.js";import{f as u,ac as f,ad as p,k as l,ar as i,G as m,at as o,as as s,r as P,o as dt,u as L,ae as R,az as M,F as _t,ax as rt}from"./vue-chunks-CGLjTDrY.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";const ut={__name:"detail-modal",setup(V,{expose:z}){const h=u(!1),y=u(!1),d=u([]),r=(t,c)=>{h.value=!0,y.value=!0,c==1?w(t):_(t)},w=t=>{I({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id,data_id:t.data_id}).then(c=>{d.value=c.data||[]}).finally(()=>{y.value=!1})},_=t=>{J({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id}).then(c=>{d.value=c.data||[]}).finally(()=>{y.value=!1})};return z({show:r}),(t,c)=>{const g=O,b=U,D=N,C=lt;return p(),f("div",null,[l(C,{open:h.value,"onUpdate:open":c[0]||(c[0]=v=>h.value=v),title:"机器人分布详情",width:624,footer:null},{default:i(()=>[l(D,{"data-source":d.value,loading:y.value,pagination:!1,scroll:{y:500}},{default:i(()=>[l(g,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:v})=>[m(o(v+1),1)]),_:1}),l(g,{key:"robot_name",title:"机器人",width:140},{default:i(({record:v})=>[m(o(v.robot_name),1)]),_:1}),l(g,{key:"tip",title:"触发次数",width:120},{default:i(({record:v})=>[l(b,{gap:12},{default:i(()=>[s("span",null,o(v.tip),1)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),_:1},8,["open"])])}}},ct={class:"library-page"},pt={class:"statics-block"},vt={class:"statics-item"},mt={class:"num"},yt={class:"search-box"},gt={class:"tab-box"},bt={class:"library-page-body"},ft={class:"list-box"},ht={key:0},xt={key:1,class:"qa-list-box"},kt={class:"list-item"},wt={class:"list-content"},Dt={class:"list-item",style:{color:"#8c8c8c"}},Ct={class:"list-content"},Yt={key:0},Lt={key:0},Mt=["onClick"],zt={__name:"index",setup(V){const z=K(),h=u([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),y=u(0),d=u([B().startOf("month"),B()]),r=u(1),w=u([]),_=P({begin_date_ymd:d.value[0].format("YYYYMMDD"),end_date_ymd:d.value[1].format("YYYYMMDD"),library_id:void 0}),t=P({page:1,size:100,total:0}),c=[{label:"按内容",value:1},{label:"按知识库",value:2}],g=u([]),b=u(!1),D=()=>{b.value=!0,tt({..._,...t}).then(n=>{let a=n.data.list||[];a=a.map(x=>({...x})),g.value=a,t.total=+n.data.total}).finally(()=>{b.value=!1})},C=()=>{b.value=!0,et({..._,...t}).then(n=>{let a=n.data.list||[];a=a.map(x=>({...x})),g.value=a,t.total=+n.data.total}).finally(()=>{b.value=!1})},v=()=>{t.total=0,r.value==1?t.size=100:t.size=20,Y()},j=n=>{t.page=n.current,t.size=n.pageSize,r.value==1?D():C()},Y=()=>{t.page=1,r.value==1?D():C()},q=()=>{_.begin_date_ymd="",_.end_date_ymd="",d.value&&d.value.length>0&&(_.begin_date_ymd=d.value[0].format("YYYYMMDD"),_.end_date_ymd=d.value[1].format("YYYYMMDD")),Y()},T=u(null),F=n=>{T.value.show({begin_date_ymd:_.begin_date_ymd,end_date_ymd:_.end_date_ymd,library_id:n.library_id,data_id:n.data_id},r.value)},A=()=>{Z().then(n=>{y.value=n.data.tip_total})};return dt(()=>{Y(),A(),W().then(n=>{w.value=n.data})}),(n,a)=>{const x=st,E=nt,G=ot,Q=it,k=O,$=U,H=N;return p(),f("div",ct,[l(at,{class:"mb-16",tabs:h.value,active:"/trigger-statics/list"},null,8,["tabs"]),s("div",pt,[s("div",vt,[a[3]||(a[3]=s("div",{class:"title"},"合计触发次数",-1)),s("div",mt,o(y.value),1)])]),s("div",yt,[l(x,{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e),allowClear:!1,onChange:q,style:{width:"256px"},presets:L(z)},null,8,["value","presets"])]),s("div",gt,[a[4]||(a[4]=s("div",{class:"main-title"},"触发次数排行榜",-1)),l(E,{onChange:v,value:r.value,"onUpdate:value":a[1]||(a[1]=e=>r.value=e),options:c},null,8,["value"]),r.value==1?(p(),R(Q,{key:0,placeholder:"全部知识库",allowClear:"",onChange:Y,value:_.library_id,"onUpdate:value":a[2]||(a[2]=e=>_.library_id=e),style:{width:"220px"}},{default:i(()=>[(p(!0),f(_t,null,rt(w.value,e=>(p(),R(G,{value:e.id},{default:i(()=>[m(o(e.library_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])):M("",!0)]),s("div",bt,[s("div",ft,[l(H,{"data-source":g.value,sticky:"",loading:b.value,pagination:{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:j,scroll:{x:800}},{default:i(()=>[l(k,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:e})=>[m(o(e+(t.page-1)*t.size+1),1)]),_:1}),r.value==1?(p(),R(k,{key:"content","data-index":"content",title:"知识内容",width:380},{default:i(({record:e})=>[e.content?(p(),f("div",ht,o(e.content),1)):(p(),f("div",xt,[s("div",kt,[a[5]||(a[5]=s("div",{class:"list-label"},"问题",-1)),s("div",wt,o(e.question),1)]),s("div",Dt,[a[6]||(a[6]=s("div",{class:"list-label"},"答案",-1)),s("div",Ct,o(e.answer),1)])]))]),_:1})):M("",!0),l(k,{key:"library_name",title:"所属知识库",width:140},{default:i(({record:e})=>[m(o(e.library_name)+" ",1),r.value==1?(p(),f("span",Yt,[l(L(S)),m(" "+o(e.group_name||"未分组")+" ",1),e.library_file_name?(p(),f("span",Lt,[l(L(S)),m(" "+o(e.library_file_name),1)])):M("",!0)])):M("",!0)]),_:1}),l(k,{key:"tip",title:"触发次数",width:100},{default:i(({record:e})=>[l($,{gap:12},{default:i(()=>[s("span",null,o(e.tip),1),s("a",{onClick:St=>F(e)},[a[7]||(a[7]=m("详情",-1)),l(L(S))],8,Mt)]),_:2},1024)]),_:1}),l(k,{key:"percentage",title:"占比",width:100},{default:i(({record:e})=>[m(o(e.percentage)+"% ",1)]),_:1})]),_:1},8,["data-source","loading","pagination"])])]),l(ut,{ref_key:"detailModalRef",ref:T},null,512)])}}},Vt=X(zt,[["__scopeId","data-v-71f27aae"]]);export{Vt as default};
