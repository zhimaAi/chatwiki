import{b as H,e5 as J,d as G,B as ee,af as fe,k as P,M as ve,a3 as be,e9 as te,h as ye,ea as ge,eb as he,e1 as ke,bv as xe,dk as Se}from"../../index-Bo1NSLpy.js";import{z as T,b as W,d as x,w as we,q as X,N as b,X as o,j as t,U as s,S as B,a6 as M,Z as k,F as V,a1 as ae,u as N,O as c,_ as U,a as oe,a7 as Ce,a5 as Le,H as $e,I as De,x as Ue,a0 as K,a3 as Ie,G as Oe,p as Q}from"./vue-chunks-BRsu9_To.js";import{C as Re}from"./config-page-menu-DaIttKzF.js";import{u as Pe}from"./index-C0kilmAu.js";import"./index-Bb6fuwF7.js";import{_ as se,R as le}from"./RadioButton-CWIeNl_M.js";import{S as Be,a as Me}from"./index-Bs02Ec-o.js";import{_ as ze}from"./index-Caod9rOO.js";import{I as je}from"./Input-CCKFAS4o.js";import{_ as re,F as ne}from"./index-COWZrpvC.js";import{B as E,P as Ae,S as Fe,M as Ne}from"./pull-up.esm-D94Swpvl.js";import{d as ie}from"./role_avatar-DL0r08JY.js";import{A as _e}from"./index-D86PgJML.js";import{P as Te}from"./PlusOutlined-vSxn8uyP.js";import"./index-BZOjzqJ2.js";import{D as qe}from"./dropdown-DAy60lp8.js";import{D as Ee}from"./DownOutlined-CrhRpWT5.js";import{M as Ve,_ as He}from"./index-Dxy-C30T.js";import{S as We}from"./index-QqDDBJFR.js";import{_ as Ge}from"./index-BDD9MbSg.js";import{a as Xe}from"./index-Ct9MFKxB.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-Cv3f2sEj.js";import"./Checkbox-B_uQPvVs.js";import"./Trigger-DtRTHvld.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-CuPJUS8f.js";import"./slide-CVAZ5BEM.js";import"./index-BwedndIp.js";import"./List-qVz67bUg.js";import"./useMergedState-C0iIHNGF.js";import"./CheckOutlined-C6m5maw6.js";import"./SearchOutlined-CFTHZIcT.js";import"./move-DztQgbGg.js";import"./Search-BF8URtRh.js";import"./isPlainObject-CHj0iPA3.js";import"./inputProps--_pnbyjO.js";import"./TextArea--DLJ7VtX.js";import"./Password-CJww1n-s.js";import"./Col-QoogualX.js";import"./responsiveObserve-D3ho5cFZ.js";import"./hasIn-BtXuxCTT.js";import"./collapseMotion-Brd6xpAT.js";import"./index-B4MPC5xv.js";import"./colors-4myZb9T8.js";import"./QuestionCircleOutlined-VG1FNUnl.js";import"./index-C_M0mW4F.js";import"./CaretDownFilled-DQ5FyPd3.js";import"./index-BeCYXilq.js";import"./index-pj8Mdu_P.js";import"./Dropdown-hEIgqeS3.js";import"./RightOutlined-zEOifMPB.js";import"./shallowequal-C0xnIuy8.js";import"./index-eahgXICC.js";import"./LeftOutlined-6ERu0fUO.js";import"./index-kP7DVVOS.js";import"./CaretDownOutlined-C8EH_hS-.js";const Ye={class:"form-box"},Ze={class:"form-box-header"},Je={class:"form-box-label"},Ke={class:"share-url-box"},Qe={__name:"permissions-form",props:{value:{type:Object,default:()=>({})},saveLoading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(z,{emit:I}){const{toClipboard:L}=Pe(),$=I,f=z,l=T({access_rights:"0",share_url:void 0,library_key:""}),p=W(()=>l.share_url+J+"/home/"+l.library_key),y=()=>{$("submit",l)},v=x([]),a=()=>{fe().then(u=>{v.value=u.data||[],l.share_url||v.value.length>0&&(l.share_url=v.value[0].url)})},D=u=>{l.access_rights=u.access_rights,l.share_url=u.share_url,l.library_key=u.library_key,(v.value.length==0||!l.share_url)&&a()},O=async()=>{if(!l.share_url){P.error("请选择自定义域名");return}let u=p.value;try{await L(u),P.success("复制成功")}catch{P.error("复制失败")}};return we(f.value,u=>{D({...u})}),X(()=>{a()}),(u,n)=>{const g=G,C=le,i=se,e=re,h=Me,d=Be,j=je,R=ze,A=ee,F=ne;return c(),b("div",Ye,[o("div",Ze,[o("div",Je,[t(g,{name:"auth",style:{"font-size":"14px",color:"#333"}}),n[2]||(n[2]=o("span",{class:"form-box-label-text"},"访问权限",-1))]),n[3]||(n[3]=o("div",null,null,-1))]),t(F,{"label-col":{span:4},style:{width:"750px"}},{default:s(()=>[t(e,{label:"访问权限"},{default:s(()=>[t(i,{value:l.access_rights,"onUpdate:value":n[0]||(n[0]=S=>l.access_rights=S),onChange:y},{default:s(()=>[t(C,{value:"0"},{default:s(()=>n[4]||(n[4]=[k("私有，仅能与应用关联，作为应用知识库")])),_:1,__:[4]}),t(C,{value:"1"},{default:s(()=>n[5]||(n[5]=[k("公开，发布到互联网，所有人可访问")])),_:1,__:[5]})]),_:1},8,["value"])]),_:1}),l.access_rights==1?(c(),B(e,{key:0,label:"复制链接"},{default:s(()=>[o("div",Ke,[t(R,{compact:"",style:{width:"600px",display:"flex"}},{default:s(()=>[t(d,{style:{width:"250px"},value:l.share_url,"onUpdate:value":n[1]||(n[1]=S=>l.share_url=S),placeholder:"请选择自定义域名",onChange:y},{default:s(()=>[(c(!0),b(V,null,ae(v.value,S=>(c(),B(h,{value:S.url,key:S.id},{default:s(()=>[k(U(S.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),t(j,{disabled:!0,value:N(J)+"/home/"+l.library_key,style:{width:"350px"}},null,8,["value"])]),_:1}),t(A,{class:"copy-btn",onClick:O},{default:s(()=>n[6]||(n[6]=[k("复制")])),_:1,__:[6]})]),n[7]||(n[7]=o("div",null,[o("a",{href:"/#/user/domain"},"添加自定义域名")],-1))]),_:1,__:[7]})):M("",!0)]),_:1})])}}},et=H(Qe,[["__scopeId","data-v-6562f3a7"]]),tt={class:"form-box"},at={class:"collaborator-list-tip"},ot={class:"list-content"},st={class:"collaborator-grid"},lt=["onClick"],rt={class:"user-info"},nt={class:"user-details"},it={class:"user-name"},_t={class:"user-nickname"},ct={key:0,class:"loading-more"},ut={key:1,class:"no-more"},dt={__name:"add-collaborator",props:{excludedIds:{type:Array,default:()=>[]}},emits:["ok"],setup(z,{expose:I,emit:L}){E.use(Ae),E.use(Fe),E.use(Ne);const $=L,f=z,l=oe("libraryState",{}),p=x(!1),y=x(null),v=x(!1),a=T({permission:"2",collaborators:[]}),D={permission:[{required:!0,message:"请选择协作权限"}],collaborators:[{required:!0,message:"请选择协作者",type:"array",min:1}]},O=_=>{let r=a.collaborators.indexOf(_.id);r>-1?a.collaborators.splice(r,1):a.collaborators.push(_.id)},u=x([]),n=W(()=>u.value.filter(_=>!f.excludedIds.includes(_.id))),g=T({page:1,size:20,total:0,search:""}),C=x(null),i=x(!1),e=x(!1);let h=x(null);const d=()=>{if(h.value){h.value.refresh();return}h.value=new E(C.value,{probeType:2,click:!0,scrollY:!0,bounce:!1,pullUpLoad:!0,scrollbar:{fade:!1,interactive:!0},mouseWheel:{speed:20,invert:!1,easeTime:300}}),h.value.on("pullingUp",j)},j=async()=>{i.value||e.value||(g.page=g.page+1,i.value=!0,await R(),h.value.finishPullUp(),i.value=!1)},R=async()=>{let _={page:g.page,size:g.size,search:g.search};return be(_).then(r=>{let m=r.data.list||[];return g.page==1?u.value=u.value=m:u.value=u.value.concat(m),g.total=+r.data.total,u.value.length>=g.total&&(e.value=!0),Ue(()=>{h.value&&h.value.refresh()}),r})},A=()=>{let _={operate_rights:a.permission,user_ids:a.collaborators.join(","),type:1,library_key:l.library_key};v.value=!0,te(_).then(()=>{p.value=!1,v.value=!1,$("ok",_),P.success("添加成功")}).catch(()=>{v.value=!1})},F=async()=>{var _;try{await((_=y.value)==null?void 0:_.validate()),A()}catch(r){console.error("表单验证失败:",r)}},S=()=>{var _;(_=y.value)==null||_.resetFields(),p.value=!1};return I({open:()=>{var _;p.value=!0,(_=y.value)==null||_.resetFields(),g.page=1,R(),setTimeout(()=>{d()},200)}}),(_,r)=>{const m=le,q=se,Z=re,ce=Ce("RouterLink"),ue=G,de=_e,pe=ne,me=ve;return c(),B(me,{open:p.value,"onUpdate:open":r[1]||(r[1]=w=>p.value=w),title:"添加协作者",width:"760px",confirmLoading:v.value,onOk:F,onCancel:S},{default:s(()=>[o("div",tt,[t(pe,{layout:"vertical",model:a,rules:D,ref_key:"formRef",ref:y},{default:s(()=>[t(Z,{name:"permission",label:"协作权限"},{default:s(()=>[t(q,{value:a.permission,"onUpdate:value":r[0]||(r[0]=w=>a.permission=w)},{default:s(()=>[t(m,{value:"4"},{default:s(()=>r[2]||(r[2]=[k("可管理")])),_:1,__:[2]}),t(m,{value:"2"},{default:s(()=>r[3]||(r[3]=[k("可编辑")])),_:1,__:[3]})]),_:1},8,["value"])]),_:1}),t(Z,{name:"collaborators",label:"协作者"},{default:s(()=>[o("div",at,[r[5]||(r[5]=k(" 如果协作者没有账号，请先到团队管理中添加账号 ")),t(ce,{to:"/user/manage",target:"_blank"},{default:s(()=>r[4]||(r[4]=[k("去添加")])),_:1,__:[4]})]),o("div",{class:"collaborator-list",ref_key:"listRef",ref:C},[o("div",ot,[o("div",st,[(c(!0),b(V,null,ae(n.value,w=>(c(),b("div",{class:Le(["collaborator-item",{active:a.collaborators.includes(w.id)}]),key:w.id,onClick:Bt=>O(w)},[$e(t(ue,{name:"check-arrow-filled",class:"check-icon"},null,512),[[De,a.collaborators.includes(w.id)]]),o("div",rt,[t(de,{class:"user-avatar",src:w.avatar||N(ie)},null,8,["src"]),o("div",nt,[o("div",it,U(w.user_name),1),o("div",_t,U(w.nick_name),1)])])],10,lt))),128))]),i.value?(c(),b("div",ct,"加载中...")):M("",!0),e.value?(c(),b("div",ut,"没有更多了")):M("",!0)])],512)]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},pt=H(dt,[["__scopeId","data-v-49f98487"]]),mt={class:"collaborator-list-box"},ft={class:"list-tools-box"},vt={class:"list-label"},bt={class:"label-text"},yt={class:"tools-box-right"},gt={class:"list-box"},ht={key:0,class:"name-cell"},kt={class:"user-info"},xt={class:"username"},St={class:"nickname"},wt={key:0,class:"role-cell"},Ct={key:1,class:"role-cell"},Lt={key:1},$t={__name:"collaborator-list",setup(z){const I=ye(),L=oe("libraryState",{}),$=x(null),f=[{title:"姓名",key:"name",width:"40%"},{title:"角色",dataIndex:"role",key:"role",width:"40%"},{title:"操作",key:"action",width:"20%"}],l={4:{label:"可管理",value:"4"},2:{label:"可编辑",value:"2"}},p=T({current:1,pageSize:999,total:0}),y=x([]),v=W(()=>y.value.map(i=>i.user_id)),a=(i,e)=>{e.operate_rights=i.key*1,e.operate_rights_label=l[e.operate_rights].label||"",D(e)},D=i=>{let e={operate_rights:i.operate_rights,user_ids:i.user_id,type:2,library_key:L.library_key};te(e).then(()=>{P.success("修改成功")}).catch(()=>{})},O=()=>{$.value.open()},u=i=>{let e={id:i.id,library_key:L.library_key};he(e).then(()=>{P.success("移除成功"),C()}).catch(()=>{})},n=()=>{C()},g=i=>{Object.assign(p,i),C()},C=()=>{ge({library_key:L.library_key,page:p.current,size:p.pageSize}).then(i=>{let e=i.data.list||[],{user_id:h}=I.userInfo;p.total=i.data.total,e.forEach(d=>{d.showDelete=!0,h==d.user_id&&(d.showDelete=!1),d.role_type==1&&(d.showDelete=!1),d.operate_rights=d.operate_rights*1,d.operate_rights_label="无权限",l[d.operate_rights]&&(d.operate_rights_label=l[d.operate_rights].label)}),y.value=e})};return X(()=>{C()}),(i,e)=>{const h=G,d=ee,j=_e,R=He,A=Ve,F=qe,S=Ge,Y=We,_=Xe;return c(),b("div",mt,[o("div",ft,[o("div",vt,[t(h,{name:"collaborator"}),o("span",bt,"协助权限 ("+U(p.total)+")",1)]),o("div",yt,[t(d,{type:"primary",size:"small",onClick:O},{default:s(()=>[t(N(Te)),e[2]||(e[2]=k(" 添加协助者"))]),_:1,__:[2]})])]),o("div",gt,[t(_,{columns:f,"data-source":y.value,pagination:p,onChange:g},{bodyCell:s(({column:r,record:m})=>[r.key==="name"?(c(),b("div",ht,[t(j,{class:"avatar",src:m.avatar||N(ie)},null,8,["src"]),o("div",kt,[o("div",xt,U(m.user_name),1),o("div",St,U(m.nick_name),1)])])):M("",!0),r.key==="role"?(c(),b(V,{key:1},[m.showDelete?(c(),b("div",wt,[t(F,null,{overlay:s(()=>[t(A,{onClick:q=>a(q,m)},{default:s(()=>[(c(),B(R,{key:4},{default:s(()=>e[3]||(e[3]=[k("可管理")])),_:1,__:[3]})),(c(),B(R,{key:2},{default:s(()=>e[4]||(e[4]=[k("可编辑")])),_:1,__:[4]}))]),_:2},1032,["onClick"])]),default:s(()=>[o("a",{class:"dropdown-label",onClick:e[0]||(e[0]=K(()=>{},["prevent"]))},[k(U(m.operate_rights_label)+" ",1),t(N(Ee),{style:{"font-size":"12px"}})])]),_:2},1024)])):(c(),b("div",Ct,[o("a",{class:"dropdown-label disabled",onClick:e[1]||(e[1]=K(()=>{},["prevent"]))},U(m.operate_rights_label),1)]))],64)):M("",!0),r.key==="action"?(c(),b(V,{key:2},[m.showDelete?(c(),B(Y,{key:0},{default:s(()=>[t(S,{title:"确定要移除此协作者吗?","ok-text":"确定","cancel-text":"取消",onConfirm:q=>u(m)},{default:s(()=>e[5]||(e[5]=[o("a",{href:"#"},"移除",-1)])),_:2,__:[5]},1032,["onConfirm"])]),_:2},1024)):(c(),b("span",Lt,[t(d,{style:{padding:"0"},type:"link",disabled:""},{default:s(()=>e[6]||(e[6]=[k("移除")])),_:1,__:[6]})]))],64)):M("",!0)]),_:1},8,["data-source","pagination"])]),t(pt,{excludedIds:v.value,ref_key:"addCollaboratorRef",ref:$,onOk:n},null,8,["excludedIds"])])}}},Dt=H($t,[["__scopeId","data-v-bd0b2d18"]]),Ut={class:"permissions-page"},It={class:"page-container"},Ot={class:"form-box-wrapper"},Rt={class:"collaborator-list-wrapper"},Pt={__name:"index",setup(z){const I=ke(),L=Ie(),$=W(()=>L.query.library_id),f=T({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""});Q("libraryState",f),Q("updateState",a=>{Object.assign(f,a)});const l=x(!1),p=a=>{Object.assign(f,a),l.value=!0,y().then(()=>{l.value=!1}).catch(()=>{l.value=!1})},y=async()=>{let a={...Oe(f)};delete a.library_key,a.avatar_file?(a.avatar=a.avatar_file,delete a.avatar_file):(delete a.avatar,delete a.avatar_file),await Se(a),I.getLibraryInfo(),P.success("修改成功")},v=()=>{xe({id:$.value}).then(a=>{Object.assign(f,a.data)})};return X(()=>{v()}),(a,D)=>(c(),b("div",Ut,[t(Re),o("div",It,[o("div",Ot,[t(et,{value:f,"onUpdate:value":D[0]||(D[0]=O=>f=O),saveLoading:l.value,onSubmit:p},null,8,["value","saveLoading"])]),o("div",Rt,[f.library_key?(c(),B(Dt,{key:0})):M("",!0)])])]))}},Ta=H(Pt,[["__scopeId","data-v-3344cec9"]]);export{Ta as default};
