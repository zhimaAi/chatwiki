import{ah as me,c as N,G as c,r as H,j as Se,J as Re,a as K,b as h,y as T,t as R,F as W,l as de,e as I,x as U,u as L,_ as D,v as J,Y as Me,h as qe,d as xe,p as ye,q as Ae,aj as Ce,ag as $e}from"./vue-chunks-BdaA73Wf.js";import{u as O}from"./robot-CIzNpArp.js";import{u as Ke,_ as u,ag as ge}from"../../index-DSFcP5NQ.js";import{g as Ie}from"./index-C67uUbSa.js";import{_ as he}from"./emoji-mart-BBMRoEa3.js";import{g as Le,ay as Te,f as je}from"./ui-antd-Dl1wwwCD.js";import{T as Be}from"./top-header-BV_CBGi9.js";import"./editor-cherry-CFIsbKoN.js";import"./index-Cg7-0swo.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./add-group-BYEOdPBe.js";import"./index-MT9fcN3v.js";const Ee={class:"left-menu-box"},Fe={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(y,{emit:j}){const r=me(),s=O(),{t:q}=Ke("views.robot.robot-config.components.left-menu"),a=y,k=r.query,x=N(()=>{const o=z.value.find(n=>n.id==="function-center"),i=(o==null?void 0:o.children)||[],l=i.find(n=>n.id==="auto-reply");if(r.path.split("/")[3]==="auto-reply"&&!l)return["function-center"];const t=i.find(n=>n.id==="subscribe-reply");if(r.path.split("/")[3]==="subscribe-reply"&&!t)return["function-center"];const m=i.find(n=>n.id==="smart-menu");if(r.path.split("/")[3]==="smart-menu"&&!m)return["function-center"];const $=i.find(n=>n.id==="payment");return r.path.split("/")[3]==="payment"&&!$?["function-center"]:[r.path.split("/")[3]]}),A=[{key:"workflow",id:"workflow",icon:()=>c(u,{name:"workflow",class:"menu-icon"}),label:"label_workflow_orchestration",title:"label_workflow_orchestration",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>c(u,{name:"jichupeizhi",class:"menu-icon"}),label:"label_basic_configuration",title:"label_basic_configuration",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>c(u,{name:"guanlianzhishiku",class:"menu-icon"}),label:"label_knowledge_base",title:"label_knowledge_base",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>c(u,{name:"skii",class:"menu-icon"}),label:"label_workflow",title:"label_workflow",path:"/robot/config/skill-config",menuIn:["0"]},{key:"function-center",id:"function-center",icon:()=>c(u,{name:"function-center",class:"menu-icon"}),label:"label_function_center",title:"label_function_center",path:"/robot/config/function-center",menuIn:["0","1"]},{key:"external-services",id:"external-services",icon:()=>c(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"label_external_services",title:"label_external_services",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>c(u,{name:"liaotianceshi",class:"menu-icon"}),label:"label_chat_test",title:"label_chat_test",path:"/robot/test",query:{robot_key:a.robotInfo.robot_key,id:a.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>c(u,{name:"qa-feedback",class:"menu-icon"}),label:"label_qa_feedback",title:"label_qa_feedback",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>c(u,{name:"session-record",class:"menu-icon"}),label:"label_session_records",title:"label_session_records",path:"/robot/config/session-record",query:{robot_key:a.robotInfo.robot_key,id:a.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>c(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"label_api_key_management",title:"label_api_key_management",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"unknown_issue",id:"unknown_issue",icon:()=>c(u,{name:"unknown-issue",class:"menu-icon"}),label:"label_unknown_issues",title:"label_unknown_issues",path:"/robot/config/unknown_issue",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>c(u,{name:"statistical-analysis",class:"menu-icon"}),label:"label_statistical_analysis",title:"label_statistical_analysis",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>c(u,{name:"export-record",class:"menu-icon"}),label:"label_export_records",title:"label_export_records",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>c(u,{name:"doc-file",class:"menu-icon"}),label:"label_invocation_logs",title:"label_invocation_logs",path:"/robot/config/invoke-logs",menuIn:["1"]}],C=H(null),V=H(null),B=H(null),E=H(null);async function P(){var o,i,l,t,m,$,n,g,Q,X,Z,ee,ne,oe,te,se,ae,ie,re,le,ce,ue,_e,fe,pe,be;try{const F=((o=a.robotInfo)==null?void 0:o.id)||k.id;if(!F)return;const G=await Ie({robot_id:F}),M=(G==null?void 0:G.data)||[],f=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(f){const e=((i=f==null?void 0:f.robot_config)==null?void 0:i.switch_status)??((l=f==null?void 0:f.user_config)==null?void 0:l.switch_status)??"0",_=((t=f==null?void 0:f.robot_config)==null?void 0:t.ai_reply_status)??((m=f==null?void 0:f.user_config)==null?void 0:m.ai_reply_status)??"0";s.setKeywordReplySwitchStatus(String(e)),s.setKeywordReplyAiReplyStatus(String(_))}else s.setKeywordReplySwitchStatus("0"),s.setKeywordReplyAiReplyStatus("0");const w=(M||[]).find(e=>{var _;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((_=e==null?void 0:e.robot_config)==null?void 0:_.fixed_menu)==="1"});w?C.value={key:"auto-reply",id:"auto-reply",icon:()=>c(u,{name:"auto-reply",class:"menu-icon"}),label:($=w==null?void 0:w.menu)==null?void 0:$.name,title:(n=w==null?void 0:w.menu)==null?void 0:n.name,path:((g=w==null?void 0:w.menu)==null?void 0:g.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:C.value=null;const p=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(p){const e=((Q=p==null?void 0:p.robot_config)==null?void 0:Q.switch_status)??((X=p==null?void 0:p.user_config)==null?void 0:X.switch_status)??"0",_=((Z=p==null?void 0:p.robot_config)==null?void 0:Z.ai_reply_status)??((ee=p==null?void 0:p.user_config)==null?void 0:ee.ai_reply_status)??"0";s.setSubscribeReplySwitchStatus(String(e)),s.setSubscribeReplyAiReplyStatus(String(_))}else s.setSubscribeReplySwitchStatus("0"),s.setSubscribeReplyAiReplyStatus("0");!1||(V.value=null);const b=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_smart_menu");if(b){const e=((ne=b==null?void 0:b.robot_config)==null?void 0:ne.switch_status)??((oe=b==null?void 0:b.user_config)==null?void 0:oe.switch_status)??"0",_=((te=b==null?void 0:b.robot_config)==null?void 0:te.ai_reply_status)??((se=b==null?void 0:b.user_config)==null?void 0:se.ai_reply_status)??"0";s.setSmartMenuSwitchStatus(String(e)),s.setSmartMenuAiReplyStatus(String(_))}else s.setSmartMenuSwitchStatus("0"),s.setSmartMenuAiReplyStatus("0");const v=(M||[]).find(e=>{var _;return(e==null?void 0:e.ability_type)==="robot_smart_menu"&&((_=e==null?void 0:e.robot_config)==null?void 0:_.fixed_menu)==="1"});v?B.value={key:"smart-menu",id:"smart-menu",icon:()=>c(u,{name:"smart-menu",class:"menu-icon"}),label:(ae=v==null?void 0:v.menu)==null?void 0:ae.name,title:(ie=v==null?void 0:v.menu)==null?void 0:ie.name,path:((re=v==null?void 0:v.menu)==null?void 0:re.path)||"/robot/ability/smart-menu",menuIn:["0","1"]}:B.value=null;const d=(M||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_payment");if(d){const e=((le=d==null?void 0:d.robot_config)==null?void 0:le.switch_status)??((ce=d==null?void 0:d.user_config)==null?void 0:ce.switch_status)??"0",_=((ue=d==null?void 0:d.robot_config)==null?void 0:ue.ai_reply_status)??((_e=d==null?void 0:d.user_config)==null?void 0:_e.ai_reply_status)??"0";s.setPaymentSwitchStatus(String(e)),s.setPaymentAiReplyStatus(String(_))}else s.setPaymentSwitchStatus("0"),s.setPaymentAiReplyStatus("0");const S=(M||[]).find(e=>{var _;return(e==null?void 0:e.ability_type)==="robot_payment"&&((_=e==null?void 0:e.robot_config)==null?void 0:_.fixed_menu)==="1"});S?E.value={key:"payment",id:"payment",icon:()=>c(u,{name:"payment",class:"menu-icon"}),label:(fe=S==null?void 0:S.menu)==null?void 0:fe.name,title:(pe=S==null?void 0:S.menu)==null?void 0:pe.name,path:((be=S==null?void 0:S.menu)==null?void 0:be.path)||"/robot/ability/payment",menuIn:["0","1"]}:E.value=null}catch(F){console.warn("refreshAbilityMenu failed",F)}}function Y(o){var t,m;const i=((t=a.robotInfo)==null?void 0:t.id)||k.id,l=(m=o==null?void 0:o.detail)==null?void 0:m.robotId;!l||!i||String(l)!==String(i)||P()}Se(()=>{P(),window.addEventListener("robotAbilityUpdated",Y)}),Re(()=>{window.removeEventListener("robotAbilityUpdated",Y)});const z=N(()=>{let o=A;ge(k.id)==1?o=o.filter(t=>t.id=="external-services"):o=o.filter(t=>{var m;return t.menuIn.includes((m=a.robotInfo)==null?void 0:m.application_type)});const i=[...o],l=i.findIndex(t=>t.id==="function-center");if(l>=0){const t=[];C.value&&t.push(C.value),V.value&&t.push(V.value),B.value&&t.push(B.value),E.value&&t.push(E.value),i[l]={...i[l],children:t}}return i}),ke=N(()=>{const o=z.value.find(l=>l.id==="function-center");return o&&Array.isArray(o.children)&&o.children.length>0?["function-center"]:[]}),we=o=>r.path.split("/")[3]===o.id,ve=({item:o})=>{x.value.includes(o.id)};return(o,i)=>{const l=U("router-link"),t=Le,m=Te,$=je;return h(),K("div",Ee,[T($,{class:"left-menu",mode:"inline",selectedKeys:x.value,openKeys:ke.value,onClick:ve},{default:R(()=>[(h(!0),K(W,null,de(z.value,n=>(h(),K(W,{key:n.key},[n.children&&n.children.length?(h(),I(m,{key:n.key,icon:n.icon,class:qe({"submenu-selected":we(n)})},{title:R(()=>[T(l,{class:"default-color",to:{path:n.path,query:n.query||L(k)},target:n.target||"_self",onClick:i[0]||(i[0]=Me(()=>{},["stop"]))},{default:R(()=>[D(J(L(q)(n.label)),1)]),_:2},1032,["to","target"])]),default:R(()=>[(h(!0),K(W,null,de(n.children,g=>(h(),I(l,{class:"default-color",key:g.key,to:{path:g.path,query:g.query||L(k)},target:g.target||"_self"},{default:R(()=>[(h(),I(t,{icon:g.icon,path:g.path,key:g.key},{default:R(()=>[D(J(g.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["to","target"]))),128))]),_:2},1032,["icon","class"])):(h(),I(l,{key:1,class:"default-color",target:n.target||"_self",to:{path:n.path,query:n.query||L(k)}},{default:R(()=>[(h(),I(t,{icon:n.icon,path:n.path,key:n.key},{default:R(()=>[D(J(L(q)(n.label)),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))],64))),128))]),_:1},8,["selectedKeys","openKeys"])])}}},He=he(Fe,[["__scopeId","data-v-c38f9d39"]]),Ne=xe({name:"robotPage",components:{leftMenu:He,TopHeader:Be},async beforeRouteEnter(y,j,r){const s=O(),{getRobot:q,robotInfo:a,getRobotLists:k,getGroupList:x}=s;await q(y.query.id),k(),x();let A=ge(y.query.id);if(A==0){r("/no-permission");return}if(A==1){window.location.href=`${a.h5_domain}/#/chat/pc?robot_key=${a.robot_key}`,r("/robot/list");return}let C=["basicConfig","libraryConfig","skillConfig"];if(a.application_type==1&&C.includes(y.name)){r(`/robot/config/workflow?id=${a.id}&robot_key=${a.robot_key}`);return}if(a.application_type==0&&y.name=="robotWorkflow"){r(`/robot/config/basic-config?id=${a.id}&robot_key=${a.robot_key}`);return}r()},setup(){const y=$e(),j=O(),{robotInfo:r}=Ce(j),s=N(()=>me().name!="robotWorkflow");return{robotInfo:r,changeMenu:a=>{y.push({path:a.path,query:{robot_key:r.value.robot_key,id:r.value.id}})},isShowLeft:s}}}),Ue={class:"robot-main-container"},Ve={class:"robot-page-layout"},ze={key:0,class:"layout-left"},Ge={class:"layout-body"};function We(y,j,r,s,q,a){const k=U("TopHeader"),x=U("leftMenu"),A=U("router-view");return h(),K("div",Ue,[ye("div",Ve,[y.isShowLeft?(h(),K("div",ze,[T(k),T(x,{onChangeMenu:y.changeMenu,robotInfo:y.robotInfo},null,8,["onChangeMenu","robotInfo"])])):Ae("",!0),ye("div",Ge,[T(A)])])])}const un=he(Ne,[["render",We],["__scopeId","data-v-5283f69c"]]);export{un as default};
//# sourceMappingURL=index-CQ5Ag9Nh.js.map
