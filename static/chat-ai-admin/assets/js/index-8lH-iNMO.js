import{b as ee,d as x,w as ie,N as _,O as r,j as e,X as k,U as l,u as z,_ as F,F as N,a1 as Y,a5 as ue,z as te,a6 as $,Z as v,x as re,ag as de,H as _e,D as pe,S as j,a2 as me}from"./vue-chunks-BRsu9_To.js";import{b as E,k as M,M as Q,ek as ce,el as fe,em as ke,h as ve,l as ge,B as he,W as ye,a2 as xe,bs as Ce,en as be,n as Z,E as we,eo as Fe,ep as De,eq as $e}from"../../index-Bo1NSLpy.js";import{P as ze}from"./page-tabs-BX6y8B32.js";import{_ as Me}from"./page-alert-RWJRrkK6.js";import{I as Ie}from"./InboxOutlined-CtX7CdvH.js";import{U as qe}from"./index-C19UYW2Z.js";import{M as Se}from"./model-select-BSeLg_eN.js";import{F as Ue,_ as Te}from"./index-COWZrpvC.js";import"./index-Bb6fuwF7.js";import{_ as Oe,R as Ae}from"./RadioButton-CWIeNl_M.js";import{_ as Le}from"./index-DrD42LNC.js";import{_ as Re}from"./TextArea--DLJ7VtX.js";import{U as Ne,I as Qe}from"./import-knowledge-modal-jCP-87Vk.js";import{C as G}from"./ClockCircleFilled-CqIMCeuB.js";import{S as Ee}from"./SyncOutlined-BFvMifVP.js";import{M as Pe,_ as Be}from"./index-Dxy-C30T.js";import"./index-BZOjzqJ2.js";import{D as He}from"./dropdown-DAy60lp8.js";import{_ as Ve,a as je}from"./index-Ct9MFKxB.js";import{_ as Ke}from"./index-Bbrx8UDU.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./Trigger-DtRTHvld.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-CJww1n-s.js";import"./Input-CCKFAS4o.js";import"./FormItemContext-Cv3f2sEj.js";import"./index-CuPJUS8f.js";import"./inputProps--_pnbyjO.js";import"./DownloadOutlined-BfFY8ehf.js";import"./index-B4MPC5xv.js";import"./colors-4myZb9T8.js";import"./index-OqAdRPIm.js";import"./CheckOutlined-C6m5maw6.js";import"./useRefs-CRRjy_qY.js";import"./collapseMotion-Brd6xpAT.js";import"./useMergedState-C0iIHNGF.js";import"./index-BPmrcBow.js";import"./index-Bs02Ec-o.js";import"./slide-CVAZ5BEM.js";import"./index-BwedndIp.js";import"./List-qVz67bUg.js";import"./DownOutlined-CrhRpWT5.js";import"./SearchOutlined-CFTHZIcT.js";import"./move-DztQgbGg.js";import"./isPlainObject-CHj0iPA3.js";import"./Col-QoogualX.js";import"./responsiveObserve-D3ho5cFZ.js";import"./hasIn-BtXuxCTT.js";import"./QuestionCircleOutlined-VG1FNUnl.js";import"./Checkbox-B_uQPvVs.js";import"./UpOutlined-DWTDMQqv.js";import"./PlusOutlined-vSxn8uyP.js";import"./validate-8MtiUsxW.js";import"./index-Caod9rOO.js";import"./Search-BF8URtRh.js";import"./SettingOutlined-DCgnXzhZ.js";import"./index-CNGEafUN.js";import"./shallowequal-C0xnIuy8.js";import"./Dropdown-hEIgqeS3.js";import"./RightOutlined-zEOifMPB.js";import"./index-C_M0mW4F.js";import"./CaretDownFilled-DQ5FyPd3.js";import"./index-BeCYXilq.js";import"./index-eahgXICC.js";import"./LeftOutlined-6ERu0fUO.js";import"./index-kP7DVVOS.js";import"./CaretDownOutlined-C8EH_hS-.js";const Ye={class:"ant-upload-drag-icon"},We={class:"ant-upload-hint"},Je={__name:"upload-input",props:{value:{type:Array,default:()=>[]},maxCount:{type:Number,default:1},type:{type:[String,Number],default:0}},emits:["change","update:value"],setup(O,{emit:I}){const D=I,c=O;let a=["docx","txt","md"];const q=ee(()=>a.map(u=>`.${u}`).join(",")),i=x([]);ie(()=>c.value,u=>{i.value=u},{immediate:!0});let b=null;const p=()=>{if(i.value.length>=c.maxCount)return M.error("一次最多上传"+c.maxCount+"个文件")},f=()=>{i.value.length>c.maxCount&&M.error("一次最多上传"+c.maxCount+"个文件");let u=[...i.value];D("change",u),D("update:value",u)},C=u=>{w(u),f()},w=u=>{for(let d=0;d<i.value.length;d++)if(i.value[d].uid===u.uid){i.value.splice(d,1);break}},S=u=>{const d=u.name.split(".").pop();return a.includes(d.toLowerCase())?u.size/1024/1024<100?(i.value=[...i.value||[],u],i.value.length>c.maxCount&&(i.value=i.value.splice(0,c.maxCount)),b&&clearTimeout(b),b=setTimeout(()=>{f(),clearTimeout(b)},50),!1):(M.error("文件大小不能超过100M"),!1):(M.error("不支持的文件格式"),!1)};return(u,d)=>{const m=qe;return r(),_("div",{class:ue(["upload-input",{disabled:i.value.length>=c.maxCount}])},[e(m,{"file-list":i.value,name:"file",multiple:!0,"max-count":c.maxCount,accept:q.value,beforeUpload:S,onRemove:C,class:"ant-upload-drag"},{default:l(()=>[k("div",Ye,[e(z(Ie))]),d[1]||(d[1]=k("div",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),k("div",We,[k("p",null,"一次只能上传"+F(c.maxCount)+"个文档，单个文件不超过100M",1),k("p",null,[d[0]||(d[0]=k("span",null,"支持文件类型：",-1)),(r(!0),_(N,null,Y(z(a),s=>(r(),_("span",{class:"ant-upload-hint-ext",key:s},"."+F(s),1))),128))])])]),_:1,__:[1]},8,["file-list","max-count","accept"]),k("div",{class:"disabled-mask",onClick:p})],2)}}},Xe=E(Je,[["__scopeId","data-v-1e55574f"]]),Ze={key:0,class:"mt8"},K=`根据user角色提供的文本，学习和分析它，并整理学习成果：
- 提出问题并给出每个问题的答案。
- 答案需详细完整，尽可能保留原文描述，可以适当扩展答案描述。
- 答案可以包含普通文字、链接、代码、表格、公示、媒体链接等 Markdown 元素。
- 最多提出 50 个问题。
- 生成的问题和答案和源文本语言相同。`,Ge={__name:"upload-document",emits:["ok"],setup(O,{expose:I,emit:D}){const c=D,a=te({faq_files:[],chunk_model:"",chunk_model_config_id:"",chunk_type:1,chunk_size:8e3,chunk_prompt:K}),q=x({chunk_model_config_id:[{message:"请选择提取模型",required:!0}],faq_files:[{message:"请选择文件",required:!0}]}),i=x(!1),b=()=>{i.value=!0,ce().then(m=>{let s=m.data||{chunk_model:"",chunk_model_config_id:"",chunk_size:8e3,chunk_prompt:K};a.faq_files=[],a.chunk_model=s.chunk_model,a.chunk_model_config_id=s.chunk_model_config_id,a.chunk_type=1,a.chunk_size=s.chunk_size||8e3,a.chunk_prompt=s.chunk_prompt||K,setTimeout(()=>{!a.chunk_model_config_id&&u.value.length>0&&u.value[0].children&&u.value[0].children.length&&(a.chunk_model_config_id=u.value[0].model_config_id,a.chunk_model=u.value[0].children[0].name)},500)})},p=x(!1),f=x(null),C=()=>{f.value.validate().then(()=>{w()}).catch(()=>{p.value=!1})},w=()=>{let m=new FormData;a.faq_files.forEach(s=>{m.append("faq_files",s)}),m.append("chunk_type",a.chunk_type),m.append("chunk_size",a.chunk_size),m.append("chunk_model",a.chunk_model),m.append("chunk_model_config_id",a.chunk_model_config_id),m.append("chunk_prompt",a.chunk_prompt),p.value=!0,fe(m).then(s=>{M.success("上传成功"),c("ok"),i.value=!1}).finally(()=>{p.value=!1})};x([]);const S=m=>{a.faq_files=m,f.value.validate(["faq_files"])},u=x([]),d=m=>{u.value=m,re(()=>{})};return I({show:b}),(m,s)=>{const U=Te,P=Ae,B=Oe,H=Le,A=Re,L=Ue,V=Q;return r(),_("div",null,[e(V,{open:i.value,"onUpdate:open":s[6]||(s[6]=g=>i.value=g),"confirm-loading":p.value,title:"上传文档",width:"746px",onOk:C},{default:l(()=>[e(L,{class:"url-add-form",layout:"vertical",ref_key:"formRef",ref:f,model:a,rules:q.value},{default:l(()=>[e(U,{name:"faq_files",label:null},{default:l(()=>[e(Xe,{maxCount:1,value:a.faq_files,"onUpdate:value":s[0]||(s[0]=g=>a.faq_files=g),onChange:S},null,8,["value"])]),_:1}),e(U,{name:"chunk_model_config_id",label:"提取模型"},{default:l(()=>[e(Se,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:a.chunk_model,"onUpdate:modeName":s[1]||(s[1]=g=>a.chunk_model=g),modeId:a.chunk_model_config_id,"onUpdate:modeId":s[2]||(s[2]=g=>a.chunk_model_config_id=g),style:{width:"100%"},onLoaded:d},null,8,["modeName","modeId"])]),_:1}),e(U,{label:"分块方式"},{default:l(()=>[e(B,{value:a.chunk_type,"onUpdate:value":s[3]||(s[3]=g=>a.chunk_type=g)},{default:l(()=>[e(P,{value:1},{default:l(()=>s[7]||(s[7]=[v("按长度")])),_:1,__:[7]})]),_:1},8,["value"]),a.chunk_type==1?(r(),_("div",Ze,[e(H,{value:a.chunk_size,"onUpdate:value":s[4]||(s[4]=g=>a.chunk_size=g),min:1,max:1e4,step:1,placeholder:"请输入",style:{width:"300px"}},null,8,["value"])])):$("",!0)]),_:1}),e(U,{label:"FAQ提取提示词"},{default:l(()=>[e(A,{value:a.chunk_prompt,"onUpdate:value":s[5]||(s[5]=g=>a.chunk_prompt=g),style:{height:"150px"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},et=E(Ge,[["__scopeId","data-v-a636dcd4"]]),tt={class:"list-box"},ot={class:"error-tip"},at={class:"content-block"},nt={class:"fragment-img"},lt=["src"],st={__name:"fail-detail",setup(O,{expose:I}){const D=x(!1),c=x([]),a=i=>{D.value=!0,c.value=[],q(i.id)},q=i=>{ke({id:i}).then(b=>{let p=b.data||[];c.value=p.map(f=>({...f,images:f.images?JSON.parse(f.images):[]}))})};return I({show:a}),(i,b)=>{const p=Q,f=de("viewer");return r(),_("div",null,[e(p,{wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"650px","overflow-y":"auto"},open:D.value,"onUpdate:open":b[0]||(b[0]=C=>D.value=C),title:"提取失败分段",width:746,footer:null},{default:l(()=>[k("div",tt,[(r(!0),_(N,null,Y(c.value,C=>(r(),_("div",{class:"list-item",key:C.id},[k("div",ot,F(C.split_errmsg),1),k("div",at,F(C.content),1),_e((r(),_("div",nt,[(r(!0),_(N,null,Y(C.images,(w,S)=>(r(),_("img",{key:S,src:w,alt:""},null,8,lt))),128))])),[[f]])]))),128))])]),_:1},8,["open"])])}}},it=E(st,[["__scopeId","data-v-e5fa761a"]]),ut={class:"library-page"},rt={class:"library-page-body"},dt={key:0,class:"btn-block"},_t={class:"list-box"},pt=["onClick"],mt={key:0,class:"status-block status-bule"},ct={key:1,class:"status-block status-bule"},ft={key:2,class:"status-block status-bule"},kt={key:3,class:"status-block status-green"},vt={key:4,class:"status-block status-red"},gt=["onClick"],ht={key:1},yt={key:2},xt=["onClick"],Ct={__name:"index",setup(O){const I=ve(),D=me(),c=ge();let{role_permission:a,role_type:q}=c;const i=ee(()=>q==1||a.includes("UploadDocFaq")),b=x([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),p=te({page:1,size:20,total:0}),f=x([{}]),C=x(!1),w=()=>{C.value=!1,be({...p}).then(t=>{let o=t.data.list||[];o=o.map(y=>{let h=Z(y.create_time*1e3).format("YY-MM-DD HH:mm");return{...y,create_time_desc:h}}),p.total=+t.data.total,f.value=o,m()}).finally(()=>{C.value=!1})};w();const S=()=>{p.page=1,w()},u=t=>{p.page=t.current,p.size=t.pageSize,w()};let d={};const m=()=>{f.value.forEach(t=>{t.status==2&&s(t.id)})};function s(t){d[t]&&clearInterval(d[t]),d[t]=setInterval(async()=>{try{const y=(await De({id:t})).data;y.create_time_desc=Z(y.create_time*1e3).format("YY-MM-DD HH:mm");const h=f.value.findIndex(R=>R.id==t);h!==-1&&f.value.splice(h,1,y),y.status!=2&&U(t)}catch{U(t)}},5e3)}function U(t){d[t]&&(clearInterval(d[t]),delete d[t])}const P=t=>{Q.confirm({title:"删除确认",icon:e(we),content:`是否删除该文件【${t.file_name}】?`,okText:"确定",cancelText:"取消",okType:"danger",onOk(){B(t)},onCancel(){}})},B=({id:t})=>{Fe({id:t}).then(()=>{M.success("删除成功"),w()})},H=t=>{Q.confirm({title:"重新分段确认",icon:null,okText:"确定",cancelText:"取消",onOk(){$e({id:t.id}).then(o=>{M.success("重新分段成功"),w()})},onCancel(){}})},A=t=>{if(t.status==2||t.status==3){D.push({path:"/ai-extract-faq/details",query:{id:t.id,file_name:t.file_name}});return}let o="无法查看文件详情";t.status==0&&(o="排队中,请稍候"),t.status==1&&(o="文档解析中,请稍候"),t.status==4&&(o="提取失败, 无法查看详情"),M.error(o)},L=x(null),V=()=>{L.value.show()},g=x(null),oe=t=>{g.value.show({...t})},W=(t,o)=>{let y=I.getToken,h=`/manage/exportFAQFileAllQA?id=${o}&token=${y}&ext=${t}`;window.location.href=h},J=x(null),ae=t=>{J.value.show({...t})};return pe(()=>{Object.keys(d).forEach(t=>{clearInterval(d[t])}),d={}}),(t,o)=>{const y=he,h=Ve,R=Ke,X=Be,ne=Pe,le=He,se=je;return r(),_(N,null,[k("div",ut,[e(ze,{class:"mb-16",tabs:b.value,active:"/ai-extract-faq/list"},null,8,["tabs"]),e(Me,{style:{"margin-bottom":"16px"},title:"使用说明"},{default:l(()=>o[0]||(o[0]=[k("div",null,[k("p",null," 1、文档拆分成若干大段落，然后由大模型从大段落中抽取问答对。问答对类型的只是由很高的检索精度，但是大模型提取问答对的过程中也可能会导致部分细节丢失。 "),k("p",null," 2、提取成功的文档，您可以下载到本地查看（系统会自动保存成docx格式），也可以直接导入到指定的问答知识库中。 ")],-1)])),_:1,__:[0]}),k("div",rt,[i.value?(r(),_("div",dt,[e(y,{onClick:V,type:"primary",icon:e(z(Ne))},{default:l(()=>o[1]||(o[1]=[v("上传文档提取")])),_:1,__:[1]},8,["icon"])])):$("",!0),k("div",_t,[e(se,{"data-source":f.value,loading:C.value,pagination:{current:p.page,total:p.total,pageSize:p.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:u,scroll:{x:800}},{default:l(()=>[e(h,{key:"file_name","data-index":"file_name",title:"原始文档",width:200},{default:l(({record:n})=>[k("a",{onClick:T=>A(n)},F(n.file_name),9,pt)]),_:1}),e(h,{key:"status",title:"状态",width:140},{default:l(({record:n})=>[n.status==0?(r(),_("div",mt,[e(z(ye)),o[2]||(o[2]=v("排队中 "))])):$("",!0),n.status==1?(r(),_("div",ct,[e(z(G)),o[3]||(o[3]=v("文档解析中 "))])):$("",!0),n.status==2?(r(),_("div",ft,[e(z(G)),o[4]||(o[4]=v("提取中 "))])):$("",!0),n.status==3?(r(),_("div",kt,[e(z(xe)),o[5]||(o[5]=v("提取完成 "))])):$("",!0),n.status==4?(r(),_("div",vt,[e(z(Ce)),o[6]||(o[6]=v("提取失败 "))])):$("",!0)]),_:1}),e(h,{key:"chunk_size",title:"分块方式",width:140},{default:l(({record:n})=>[v(" 按长度："+F(n.chunk_size),1)]),_:1}),e(h,{key:"count",title:"总分块数",width:110},{default:l(({record:n})=>[v(F(+n.success_count+ +n.fail_count),1)]),_:1}),e(h,{key:"success_count",title:"提取成功分块数",width:140},{default:l(({record:n})=>[v(F(n.success_count),1)]),_:1}),e(h,{key:"fail_count",title:"提取失败分块数",width:140},{default:l(({record:n})=>[e(R,{gap:12},{default:l(()=>[n.fail_count>0?(r(),_("a",{key:0,onClick:T=>ae(n)},F(n.fail_count),9,gt)):(r(),_("span",ht,F(n.fail_count),1)),n.status==3||n.status==4?(r(),_("a",yt,[n.fail_count>0?(r(),j(z(Ee),{key:0,onClick:T=>H(n)},null,8,["onClick"])):$("",!0)])):$("",!0)]),_:2},1024)]),_:1}),e(h,{key:"qa_count",title:"提取问答对数量",width:140},{default:l(({record:n})=>[k("a",{onClick:T=>A(n)},F(n.qa_count),9,xt)]),_:1}),e(h,{key:"create_time_desc",title:"上传时间",width:150},{default:l(({record:n})=>[v(F(n.create_time_desc),1)]),_:1}),e(h,{key:"key7",title:"操作",width:190,fixed:"right"},{default:l(({record:n})=>[e(R,{gap:16},{default:l(()=>[n.status==3?(r(),j(le,{key:0},{overlay:l(()=>[e(ne,null,{default:l(()=>[e(X,{onClick:T=>W("docx",n.id),key:"1"},{default:l(()=>o[7]||(o[7]=[v("下载为docx")])),_:2,__:[7]},1032,["onClick"]),e(X,{onClick:T=>W("xlsx",n.id),key:"2"},{default:l(()=>o[8]||(o[8]=[v("下载为xlsx")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024)]),default:l(()=>[e(y,{size:"small",type:"link",style:{padding:"0"}},{default:l(()=>o[9]||(o[9]=[v("下载")])),_:1,__:[9]})]),_:2},1024)):(r(),j(y,{key:1,disabled:"",size:"small",type:"link",style:{padding:"0"}},{default:l(()=>o[10]||(o[10]=[v("下载")])),_:1,__:[10]})),e(y,{onClick:T=>oe(n),disabled:n.status!=3,size:"small",type:"link",style:{padding:"0"}},{default:l(()=>o[11]||(o[11]=[v("导入问答库")])),_:2,__:[11]},1032,["onClick","disabled"]),e(y,{onClick:T=>P(n),size:"small",type:"link",style:{padding:"0"}},{default:l(()=>o[12]||(o[12]=[v("删除")])),_:2,__:[12]},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])])])]),e(et,{ref_key:"uploadDocumentRef",ref:L,onOk:S},null,512),e(Qe,{ref_key:"importKnowledgeModalRef",ref:g,onOk:w},null,512),e(it,{ref_key:"failDetailRef",ref:J},null,512)],64)}}},Qo=E(Ct,[["__scopeId","data-v-3cc6ad43"]]);export{Qo as default};
