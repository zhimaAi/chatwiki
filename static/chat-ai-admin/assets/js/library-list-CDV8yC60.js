import{_ as Ve}from"./cu-scroll-5W3_kglT.js";import{b as ie,e as Me,d as ye,bb as He,at as fe,au as me,bc as Pe,bd as Ze,be as Je,aw as Se,aN as Qe,j as Ue,F as Ie,as as je,aP as Ke,bf as We,bg as Ye,bh as Xe}from"../../index-CPkdGIiL.js";import{e as ue,Y as h,_ as i,a1 as G,F as R,a9 as be,a5 as l,ae as O,a7 as D,a2 as n,ad as J,G as c,B,k as a,f,u as L,r as Ce,o as et,n as re,A as _e,y as Ge,aa as xe,a3 as tt,J as Ae}from"./vue-chunks-Ci-XTWEs.js";import{E as Fe}from"./empty-box-fCJmmPRK.js";import{p as we,b as Te,c as qe,D as Ne,ay as ge,M as se,a as Q,F as at,e as lt,I as Ee,Q as nt,u as Re,v as De,X as ot,aD as st,a6 as it,ab as oe,E as dt,O as rt,q as _t,R as ut,k as pt,ag as ct,ac as ft,a3 as mt,ad as vt,B as Be,z as ze,an as ht,ax as kt,H as Oe}from"./ui-antd-Bw8cEW5z.js";import{A as gt}from"./avatar-input-DUNM9Pzu.js";import{t as yt}from"./validate-8MtiUsxW.js";import{M as he}from"./model-select-CiMSoZvM.js";import{O as bt}from"./open-grapg-modal-ydgy9TQ7.js";import{P as Ct}from"./page-tabs-MrUXWsdQ.js";import{_ as xt}from"./page-alert-DVGcaaG3.js";import{L as wt}from"./list-tabs-Bu_nGTVN.js";import{d as $t}from"./vuedraggable.umd-DJBjom-v.js";import{a as Lt}from"./index-CPuy80m4.js";import{L as It}from"./loading-box-B8yVBXxh.js";import{e as At}from"./index-Bu5ae_-0.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-ChQO-_r6.js";import"./empty-BFmzY9bl.js";import"./index-BxiNNyyE.js";const zt="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1764325377423'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='6546'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='300'%20height='300'%3e%3cpath%20d='M0%200m136.533333%200l750.933334%200q136.533333%200%20136.533333%20136.533333l0%20750.933334q0%20136.533333-136.533333%20136.533333l-750.933334%200q-136.533333%200-136.533333-136.533333l0-750.933334q0-136.533333%20136.533333-136.533333Z'%20fill='%231FD279'%20p-id='6547'%3e%3c/path%3e%3cpath%20d='M620.714667%20428.782933c7.0656%200%2014.0288%200.477867%2020.957866%201.2288-18.807467-85.162667-112.503467-148.411733-219.409066-148.411733C302.728533%20281.6%20204.8%20360.789333%20204.8%20461.346133c0%2058.026667%2032.597333%20105.710933%2087.04%20142.677334l-21.742933%2063.556266%2076.014933-37.034666c27.204267%205.2224%2049.015467%2010.581333%2076.151467%2010.581333%206.826667%200%2013.585067-0.341333%2020.309333-0.8192a152.8832%20152.8832%200%200%201-6.724267-44.270933c0-92.330667%2081.578667-167.253333%20184.866134-167.253334z%20m-116.906667-57.344c16.384%200%2027.204267%2010.478933%2027.204267%2026.4192%200%2015.837867-10.8544%2026.453333-27.204267%2026.453334-16.2816%200-32.6656-10.6496-32.6656-26.453334%200-15.940267%2016.384-26.385067%2032.6656-26.385066z%20m-152.200533%2052.872534c-16.2816%200-32.768-10.6496-32.768-26.453334%200-15.906133%2016.452267-26.385067%2032.768-26.385066s27.170133%2010.4448%2027.170133%2026.385066c0%2015.803733-10.8544%2026.453333-27.170133%2026.453334zM819.2%20593.476267c0-84.48-87.005867-153.361067-184.7296-153.361067-103.424%200-184.9344%2068.881067-184.9344%20153.361067%200%2084.650667%2081.5104%20153.3952%20184.9344%20153.3952%2021.674667%200%2043.52-5.3248%2065.262933-10.581334l59.630934%2031.709867-16.349867-52.804267c43.690667-31.8464%2076.1856-74.069333%2076.1856-121.719466z%20m-244.667733-26.453334c-10.820267%200-21.742933-10.4448-21.742934-21.162666%200-10.513067%2010.922667-21.0944%2021.742934-21.0944%2016.452267%200%2027.2384%2010.581333%2027.2384%2021.128533%200%2010.683733-10.786133%2021.162667-27.2384%2021.162667z%20m119.6032%200c-10.752%200-21.6064-10.4448-21.6064-21.162666%200-10.513067%2010.8544-21.0944%2021.6064-21.0944%2016.315733%200%2027.2384%2010.581333%2027.2384%2021.128533%200%2010.683733-10.922667%2021.162667-27.2384%2021.162667z'%20fill='%23FFFFFF'%20p-id='6548'%3e%3c/path%3e%3c/svg%3e",Ot={class:"list-box"},Mt=["onClick"],St={class:"library-info"},Ut={class:"library-icon"},Gt=["src"],Ft={key:0,class:"sync-tag run"},Tt={key:1,class:"sync-tag fail"},qt={class:"library-info-content"},Nt={class:"library-title"},Et={class:"library-type"},Rt={key:0,class:"type-tag"},Dt={key:1,class:"type-tag"},Bt={key:2,class:"type-tag"},Vt={key:3,class:"type-tag"},Ht={class:"item-body"},Pt={class:"library-desc"},Zt={class:"item-footer"},Jt={class:"library-size"},Qt={class:"text-item"},jt={class:"text-item"},Kt={class:"text-item"},Wt=["onClick"],Yt=["onClick"],Xt={__name:"index",props:{list:{type:Array,default:()=>[]}},emits:["add","edit","delete","openEditGroupModal"],setup(N,{emit:q}){const M=q,I=Me(),A=ue(()=>{var e;return((e=I.companyInfo)==null?void 0:e.neo4j_status)=="true"}),w=N,g=e=>{M("edit",e)},b=e=>{M("delete",e)},S=e=>{M("openEditGroupModal",e)};return(e,p)=>{const k=we,_=ye,y=qe,V=Te,F=Ne;return i(),h("div",Ot,[w.list.length?(i(!0),h(R,{key:0},be(w.list,m=>(i(),h("div",{class:"list-item-wrapper",key:m.id},[l("div",{class:"list-item",onClick:B(Y=>g(m),["stop"])},[l("div",St,[l("div",Ut,[l("img",{src:m.avatar},null,8,Gt),m.type==3?(i(),h(R,{key:0},[m.sync_official_content_status==2?(i(),h("span",Ft,"同步中")):m.sync_official_content_status==3?(i(),h("span",Tt,"同步失败")):O("",!0)],64)):O("",!0)]),l("div",qt,[l("div",Nt,D(m.library_name),1),l("div",Et,[m.type==0?(i(),h("span",Rt,"普通知识库")):O("",!0),m.type==1?(i(),h("span",Dt,"对外知识库")):O("",!0),m.type==2?(i(),h("span",Bt,"问答知识库")):O("",!0),m.type==3?(i(),h("span",Vt,"公众号知识库")):O("",!0),A.value?(i(),G(k,{key:4},{title:n(()=>[c(D(m.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:n(()=>[l("span",{class:J(["type-tag graph-tag",{"gray-tag":m.graph_switch==0}])},"Graph",2)]),_:2},1024)):O("",!0)])])]),l("div",Ht,[l("div",Pt,D(m.library_intro),1)]),l("div",Zt,[l("div",Jt,[l("span",Qt,"文档："+D(m.file_total),1),l("span",jt,"大小："+D(m.file_size_str),1),l("span",Kt,"关联应用："+D(m.robot_nums||0),1)]),l("div",{class:"action-box",onClick:p[1]||(p[1]=B(()=>{},["stop"]))},[a(F,null,{overlay:n(()=>[a(V,null,{default:n(()=>[a(y,null,{default:n(()=>[l("a",{class:"delete-text-color",href:"javascript:;",onClick:B(Y=>b(m),["stop"])},"删 除",8,Wt)]),_:2},1024),a(y,null,{default:n(()=>[l("div",{onClick:B(Y=>S(m),["stop"])},"修改分组",8,Yt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[l("div",{class:"action-item",onClick:p[0]||(p[0]=B(()=>{},["stop"]))},[a(_,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Mt)]))),128)):(i(),G(Fe,{key:1,style:{"margin-top":"80px"}}))])}}},ea=ie(Xt,[["__scopeId","data-v-8330f7eb"]]),ta="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.8066%2055.3034C14.0866%2051.3489%2011.0624%2045.5975%2015.5685%2027.6849C20.074%209.77234%2025.4347%206.23271%2041.1546%2010.1872C56.8746%2014.1417%2059.8378%2019.7747%2055.3323%2037.6873C50.8267%2055.5999%2045.5265%2059.2579%2029.8059%2055.3034H29.8066Z'%20fill='%232475FC'/%3e%3cpath%20d='M27.6401%2056.8699C9.97054%2056.8699%205.24487%2051.5938%205.24487%2031.46C5.24487%2011.3261%209.97054%206.15887%2027.6401%206.15887C45.3096%206.15887%2049.9398%2011.3261%2049.9398%2031.46C49.9398%2051.5938%2045.3096%2056.8699%2027.6401%2056.8699Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M38.7639%2045.5143H36.8936C36.3373%2045.5143%2035.8577%2045.4677%2035.4549%2045.3743C35.052%2045.281%2034.7067%2045.1363%2034.419%2044.9403C34.1313%2044.7443%2033.8867%2044.497%2033.6853%2044.1983C33.4838%2043.8997%2033.2968%2043.5543%2033.1242%2043.1623C32.8364%2042.453%2032.5727%2041.809%2032.3329%2041.2303C32.0931%2040.6517%2031.8869%2040.1477%2031.7142%2039.7183C31.5032%2039.233%2031.3114%2038.785%2031.1388%2038.3743H23.974C23.8397%2038.8037%2023.6767%2039.2703%2023.4849%2039.7743C23.3314%2040.2037%2023.13%2040.7217%2022.8806%2041.3283C22.6312%2041.935%2022.3435%2042.593%2022.0174%2043.3023C21.6337%2044.1423%2021.1925%2044.721%2020.6938%2045.0383C20.195%2045.3557%2019.6291%2045.5143%2018.9961%2045.5143H17.0107C16.1667%2045.5143%2015.596%2045.3323%2015.2986%2044.9683C15.0013%2044.6043%2015.0253%2043.9837%2015.3706%2043.1063C15.7159%2042.2663%2016.1187%2041.277%2016.5791%2040.1383C17.0395%2038.9997%2017.5286%2037.791%2018.0466%2036.5123C18.5645%2035.2337%2019.1016%2033.9223%2019.6579%2032.5783C20.2142%2031.2343%2020.7513%2029.9183%2021.2693%2028.6303C22.497%2025.625%2023.7822%2022.4983%2025.125%2019.2503C25.2593%2018.933%2025.4319%2018.6437%2025.6429%2018.3823C25.8347%2018.177%2026.0889%2017.981%2026.4054%2017.7943C26.7219%2017.6077%2027.12%2017.5143%2027.5996%2017.5143C28.0983%2017.5143%2028.5059%2017.6123%2028.8224%2017.8083C29.139%2018.0043%2029.4027%2018.2237%2029.6137%2018.4663C29.8439%2018.7463%2030.0262%2019.0543%2030.1604%2019.3903C31.5224%2022.6757%2032.8172%2025.821%2034.0449%2028.8263C34.5629%2030.1143%2035.1%2031.4257%2035.6563%2032.7603C36.2126%2034.095%2036.7449%2035.3923%2037.2532%2036.6523C37.7616%2037.9123%2038.2412%2039.093%2038.6919%2040.1943C39.1427%2041.2957%2039.5312%2042.2477%2039.8573%2043.0503C40.1259%2043.685%2040.1642%2044.2543%2039.9724%2044.7583C39.7806%2045.2623%2039.3777%2045.5143%2038.7639%2045.5143ZM30.4194%2034.8743L27.6859%2025.3823H27.6571L24.607%2034.8743H30.4194Z'%20fill='white'/%3e%3c/svg%3e",aa="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2062%2062'%20class='design-iconfont'%3e%3cpath%20d='M0%2014.5882C0%206.53137%206.53137%200%2014.5882%200H47.4118C55.4686%200%2062%206.53137%2062%2014.5882V47.4118C62%2055.4686%2055.4686%2062%2047.4118%2062H14.5882C6.53137%2062%200%2055.4686%200%2047.4118V14.5882Z'%20fill='%234876FF'/%3e%3cg%20filter='url(%23kd70btl3k__filter0_d_7802_38768)'%3e%3cpath%20d='M42.8433%2015.6719H27.4866C24.6533%2015.6719%2022.33%2017.9952%2022.33%2020.8852V32.6152C22.33%2035.5052%2024.6533%2037.8285%2027.4866%2037.8285H37.861L41.4876%2041.1719C42.5076%2042.1352%2044.2643%2041.4552%2044.2643%2040.0385V37.7719C47.041%2037.7719%2048%2035.4485%2048%2032.6152V20.8852C48%2017.9952%2045.6766%2015.6719%2042.8433%2015.6719Z'%20fill='%23D6E0FF'/%3e%3cpath%20d='M36.9952%2017.1719H19.7806C16.6044%2017.1719%2014%2019.7763%2014%2023.016V36.1652C14%2039.3413%2016.5409%2041.9458%2019.6535%2042.0093V44.5502C19.6535%2046.1383%2021.6227%2046.9005%2022.7661%2045.8206L26.8316%2042.0728H36.9952C40.1714%2042.0728%2042.7758%2039.4684%2042.7758%2036.2287V23.016C42.7758%2019.7763%2040.1714%2017.1719%2036.9952%2017.1719Z'%20fill='%23EBF0FF'/%3e%3cpath%20d='M35.8572%2028.9015C35.8572%2026.5396%2035.2018%2024.6658%2033.8911%2023.2801C32.5804%2021.8944%2030.8072%2021.1995%2028.5715%2021.1953C26.342%2021.1953%2024.5709%2021.8881%2023.2581%2023.2738C21.9453%2024.6595%2021.2878%2026.5259%2021.2858%2028.8732C21.2858%2031.1973%2021.9401%2033.0564%2023.2487%2034.4505C24.5574%2035.8446%2026.2974%2036.5427%2028.4688%2036.5447C29.0683%2036.5626%2029.6676%2036.5012%2030.2514%2036.3621C30.3074%2036.4093%2030.9638%2037.4265%2031.7726%2037.8863C32.3384%2038.2078%2033.0977%2038.2247%2033.6736%2038.1731C34.1554%2038.1299%2034.4572%2037.6737%2034.3836%2037.1957C34.3104%2036.7211%2033.8837%2036.3943%2033.42%2036.2696C33.3237%2036.2437%2033.2286%2036.2126%2033.1352%2036.1763C32.8819%2036.0309%2032.6781%2035.8113%2032.5503%2035.5464C34.757%2034.1965%2035.8593%2031.9815%2035.8572%2028.9015ZM31.278%2032.8475L31.1286%2033.0396C31.0602%2033.131%2030.6433%2032.1641%2029.6292%2031.8492C29.0996%2031.7142%2028.5513%2031.6807%2028.0124%2031.7487C27.6975%2031.7884%2027.4827%2032.0714%2027.4827%2032.3888C27.4827%2032.7549%2027.771%2033.0497%2028.1222%2033.153C28.3685%2033.2254%2028.6053%2033.33%2028.8266%2033.4648C29.2341%2033.7797%2029.5919%2034.186%2029.4176%2034.2332C29.113%2034.3135%2028.7992%2034.3527%2028.4844%2034.3497C27.9396%2034.3544%2027.403%2034.2154%2026.9274%2033.9465C26.4518%2033.6776%2026.0535%2033.288%2025.7717%2032.816C25.0935%2031.7873%2024.7534%2030.4394%2024.7513%2028.7724C24.7492%2027.1054%2025.0894%2025.7565%2025.7717%2024.7256C26.0684%2024.2609%2026.4754%2023.8788%2026.9555%2023.6142C27.4356%2023.3497%2027.9735%2023.2111%2028.5201%2023.2111C29.0668%2023.2111%2029.6047%2023.3497%2030.0848%2023.6142C30.5649%2023.8788%2030.9719%2024.2609%2031.2686%2024.7256C31.9592%2025.7313%2032.3046%2027.0739%2032.3046%2028.7535C32.3046%2030.4772%2031.9624%2031.8419%2031.278%2032.8475Z'%20fill='%234876FF'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='kd70btl3k__filter0_d_7802_38768'%20x='9.875'%20y='15.6719'%20width='42.25'%20height='38.9023'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='4.125'/%3e%3cfeGaussianBlur%20stdDeviation='2.0625'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20values='0%200%200%200%200.413084%200%200%200%200%200.250874%200%200%200%200%200.0886636%200%200%200%200.14%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20result='effect1_dropShadow_7802_38768'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect1_dropShadow_7802_38768'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",la={class:"add-libray-popup",ref:"modal"},na={class:"add-libray-popup-body"},oa={class:"libray-type-list"},sa={class:"libray-action"},ia={class:"libray-action"},da={__name:"add-libray-popup",emits:["ok"],setup(N,{expose:q,emit:M}){const I=M,A=f(!1),w=()=>{A.value=!0},g=()=>{A.value=!1},b=e=>{A.value=!1,I("ok",e)},S=e=>{b(e)};return q({show:w,close:g}),(e,p)=>{const k=se;return i(),h("div",la,[a(k,{footer:null,getContainer:()=>e.$refs.modal,open:A.value,"onUpdate:open":p[2]||(p[2]=_=>A.value=_),title:"",width:520,onOk:b},{default:n(()=>[l("div",na,[p[7]||(p[7]=l("div",{class:"popup-title"},"新建知识库",-1)),l("div",oa,[l("div",{class:"libray-item",onClick:p[0]||(p[0]=_=>S(0))},[p[3]||(p[3]=l("div",{class:"libray-item-header"},[l("img",{class:"libray-icon",src:ta,alt:""}),l("div",{class:"libray-type-name"},"普通知识库")],-1)),p[4]||(p[4]=l("div",{class:"libray-desc"}," 导入文档或网页创建知识库，知识库可以与聊天机器人或工作流关联。用户和机器人聊天时，机器人可以引用知识库内知识回复用户 ",-1)),l("div",sa,[a(L(ge))])]),l("div",{class:"libray-item",onClick:p[1]||(p[1]=_=>S(2))},[p[5]||(p[5]=l("div",{class:"libray-item-header"},[l("img",{class:"libray-icon",src:aa,alt:""}),l("div",{class:"libray-type-name"},"问答知识库")],-1)),p[6]||(p[6]=l("div",{class:"libray-desc"}," 通过excel或者word导入FAQ问答对构建知识库，适合客服场景或者需要用FAQ问答数据精确回答的场景。用户提问时，如果系统检索到与用户问题匹配度很高的问答对，会直接回复对应的答案。 ",-1)),l("div",ia,[a(L(ge))])])])])]),_:1},8,["getContainer","open"])],512)}}},ra=ie(da,[["__scopeId","data-v-107545a2"]]),_a={class:"form-box"},ua={class:"indexing-methods-box"},pa={class:"list-title-block"},ca={class:"list-title-block"},fa={class:"select-card-box"},ma={class:"card-title"},va={class:"card-title"},ha={class:"card-title"},ka={class:"card-title"},ga={class:"graph-switch-box"},ya={class:"lable-text"},ba={class:"graph-switch-box"},Ca={class:"lable-text"},ke="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",xa={__name:"add-library-model",setup(N,{expose:q}){const M=Me(),I=ue(()=>{var s;return((s=M.companyInfo)==null?void 0:s.neo4j_status)=="true"});Q.config({duration:2});const A=f(null),w=f(!0),g=xe(),b=f(!1),S=f(!1),e=Ce({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,normal_chunk_default_not_merged_text:"false",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:ke,group_id:0,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512,sync_official_history_type:2,enable_cron_sync_official_content:!0,app_id_list:""}),p=s=>{e.avatar=s.imageUrl,e.avatar_file=s.file},k=f([]);He().then(s=>{k.value=s.data.map(t=>({label:t.name,value:t.no}))});const _=s=>{e.chunk_type=s},y=f([]),V=s=>{y.value=s,Ge(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&F()})},F=()=>{if(y.value.length>0){let s=null,t=null;for(let z of y.value)if(z.model_define==="tongyi"){s=z;for(let u of s.children)if(u.name==="qwen-max"){t=u;break}break}s||(s=y.value[0],t=s.children[0]),s&&t&&(e.ai_chunk_model=t.name,e.ai_chunk_model_config_id=t.model_config_id)}},m=s=>{s.length&&(e.use_model=s[0].children[0].name,e.model_config_id=s[0].model_config_id)},Y=f(null),H=s=>{if(s){let t={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&y.value.length>0){let z=y.value[0];if(z){let u=z.children[0];t.graph_use_model=u.name,t.graph_model_config_id=u.model_config_id}}Y.value.show(t)}else e.graph_switch=!1},te=s=>{s.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=s.graph_model_config_id,e.graph_use_model=s.graph_use_model)},ae=()=>{b.value=!1},de=()=>{A.value.validate().then(()=>{$()}).catch(s=>{})},$=()=>{let s=new FormData,t=JSON.parse(JSON.stringify(e));s.append("type",e.type),s.append("access_rights",e.access_rights),s.append("library_name",e.library_name),s.append("qa_index_type",e.qa_index_type),s.append("library_intro",e.library_intro),s.append("use_model",t.use_model),s.append("model_config_id",e.model_config_id),s.append("avatar",e.avatar_file?e.avatar_file:""),s.append("is_offline",e.is_offline),s.append("urls",JSON.stringify(yt(e.urls))),s.append("doc_type",e.doc_type),s.append("file_name",e.file_name),s.append("is_qa_doc",e.is_qa_doc),s.append("qa_index_type",e.qa_index_type),s.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),s.append("chunk_type",e.chunk_type),s.append("normal_chunk_default_separators_no",JSON.stringify(e.normal_chunk_default_separators_no)),s.append("normal_chunk_default_not_merged_text",e.normal_chunk_default_not_merged_text),s.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),s.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),s.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),s.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),s.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),s.append("graph_switch",e.graph_switch?1:0),s.append("graph_model_config_id",e.graph_model_config_id),s.append("graph_use_model",e.graph_use_model),s.append("ai_chunk_size",e.ai_chunk_size),s.append("ai_chunk_model",e.ai_chunk_model),s.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),s.append("ai_chunk_prumpt",e.ai_chunk_prumpt),s.append("father_chunk_paragraph_type",e.father_chunk_paragraph_type),s.append("father_chunk_separators_no",JSON.stringify(e.father_chunk_separators_no)),s.append("son_chunk_separators_no",JSON.stringify(e.son_chunk_separators_no)),s.append("father_chunk_chunk_size",e.father_chunk_chunk_size),s.append("son_chunk_chunk_size",e.son_chunk_chunk_size),s.append("group_id",e.group_id),s.append("is_default",2);let z=Pe;e.type==3&&(z=Ze,s.append("app_id_list",e.app_id_list),s.append("sync_official_history_type",e.sync_official_history_type),s.append("enable_cron_sync_official_content",Number(e.enable_cron_sync_official_content))),S.value=!0,z(s).then(u=>{var X,ee;Q.success("创建成功"),b.value=!1;let x="/library/details/knowledge-document",E;e.type==3?E={id:(X=u==null?void 0:u.data)==null?void 0:X[0]}:(E={id:(ee=u==null?void 0:u.data)==null?void 0:ee.id},e.doc_type==3&&(x="/library/preview",E={id:u.data.file_ids[0]})),g.push({path:x,query:E}),S.value=!1,b.value=!1}).catch(()=>{S.value=!1})},v=({type:s,group_id:t,wx_app_ids:z})=>{e.type=s,s==3?e.app_id_list=z:s==0?(e.avatar=fe,e.avatar_file=fe):(e.avatar=me,e.avatar_file=me),e.library_name="",e.library_intro="",e.qa_index_type=1,e.chunk_type=1,e.normal_chunk_default_separators_no=[12,11],e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.normal_chunk_default_not_merged_text="false",e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.father_chunk_paragraph_type=2,e.father_chunk_separators_no=[12,11],e.father_chunk_chunk_size=1024,e.son_chunk_separators_no=[8,10],e.son_chunk_chunk_size=512,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=ke,e.group_id=t||0,b.value=!0},le=s=>{s!=e.qa_index_type&&(e.qa_index_type=s)};return q({show:v}),et(()=>{}),(s,t)=>{const z=Ee,u=lt,x=nt,E=De,X=Re,ee=ot,j=we,T=ye,K=rt,P=dt,pe=ut,ve=_t,d=at,r=se;return i(),h(R,null,[a(r,{open:b.value,"onUpdate:open":t[32]||(t[32]=o=>b.value=o),title:"添加知识库",onOk:de,confirmLoading:S.value,wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onCancel:ae,width:"620px"},{default:n(()=>[l("div",_a,[a(d,{layout:"vertical",ref_key:"formRef",ref:A,model:e},{default:n(()=>[e.type!=3?(i(),h(R,{key:0},[a(u,{ref:"name",name:"library_name",label:"知识库名称",rules:[{required:!0,message:"请输入库名称",trigger:"change"}]},{default:n(()=>[a(z,{value:e.library_name,"onUpdate:value":t[0]||(t[0]=o=>e.library_name=o),placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},512),a(u,{label:"知识库简介"},{default:n(()=>[a(x,{maxlength:1e3,value:e.library_intro,"onUpdate:value":t[1]||(t[1]=o=>e.library_intro=o),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),a(u,{ref:"name",label:"知识库封面"},{default:n(()=>[a(gt,{value:e.avatar,"onUpdate:value":t[2]||(t[2]=o=>e.avatar=o),onChange:p},null,8,["value"]),t[33]||(t[33]=l("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[33]},512)],64)):(i(),h(R,{key:1},[a(u,{label:"历史发布内容获取时间段"},{default:n(()=>[a(X,{value:e.sync_official_history_type,"onUpdate:value":t[3]||(t[3]=o=>e.sync_official_history_type=o)},{default:n(()=>[a(E,{value:10},{default:n(()=>t[34]||(t[34]=[c("全部")])),_:1,__:[34]}),a(E,{value:1},{default:n(()=>t[35]||(t[35]=[c("半年内")])),_:1,__:[35]}),a(E,{value:2},{default:n(()=>t[36]||(t[36]=[c("一年内")])),_:1,__:[36]}),a(E,{value:3},{default:n(()=>t[37]||(t[37]=[c("三年以内")])),_:1,__:[37]})]),_:1},8,["value"])]),_:1}),a(u,{label:"每天3:00获取最新发布内容"},{default:n(()=>[a(ee,{checked:e.enable_cron_sync_official_content,"onUpdate:checked":t[4]||(t[4]=o=>e.enable_cron_sync_official_content=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})],64)),l("div",{class:"hight-set-text",onClick:t[5]||(t[5]=o=>w.value=!w.value)},[w.value?(i(),G(L(st),{key:0})):(i(),G(L(it),{key:1})),t[38]||(t[38]=c(" 高级设置 ")),t[39]||(t[39]=l("span",{style:{color:"#8c8c8c"}},"适用于高级用户",-1))]),re(a(u,null,{label:n(()=>[t[41]||(t[41]=c("文档解析向量模型 ")),a(j,null,{title:n(()=>t[40]||(t[40]=[c("向量模型可以将分段数据转化为向量形式，存储到向量数据库中，便于后续根据用户问题查询匹配。")])),default:n(()=>[a(L(oe),{class:"ml4"})]),_:1})]),default:n(()=>[a(he,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":t[6]||(t[6]=o=>e.use_model=o),modeId:e.model_config_id,"onUpdate:modeId":t[7]||(t[7]=o=>e.model_config_id=o),onLoaded:m,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[_e,!w.value]]),re(a(u,{label:"索引方式"},{default:n(()=>[l("div",ua,[l("div",{class:J(["list-item",{active:e.qa_index_type==1}]),onClick:t[8]||(t[8]=o=>le(1))},[a(T,{class:"check-icon",name:"check-arrow-filled"}),l("div",pa,[a(T,{name:"file-search"}),t[42]||(t[42]=c(" 问题与答案一起生成索引 "))]),t[43]||(t[43]=l("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),l("div",{class:J(["list-item",{active:e.qa_index_type==2}]),onClick:t[9]||(t[9]=o=>le(2))},[a(T,{class:"check-icon",name:"check-arrow-filled"}),l("div",ca,[a(T,{name:"comment-search"}),t[44]||(t[44]=c(" 仅对问题生成索引 "))]),t[45]||(t[45]=l("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2)])]),_:1},512),[[_e,!w.value&&e.type==2]]),re(l("div",null,[a(u,{label:"分段方式",required:""},{default:n(()=>[t[54]||(t[54]=l("div",{class:"form-alert-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),l("div",fa,[l("div",{class:J(["select-card-item",{active:e.chunk_type==1}]),onClick:t[10]||(t[10]=o=>_(1))},[a(T,{class:"check-arrow",name:"check-arrow-filled"}),l("div",ma,[a(T,{name:"ordinary-segmentation",class:"title-icon"}),t[46]||(t[46]=c(" 普通分段 "))]),t[47]||(t[47]=l("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),l("div",{class:J(["select-card-item",{active:e.chunk_type==2}]),onClick:t[11]||(t[11]=o=>_(2))},[a(T,{class:"check-arrow",name:"check-arrow-filled"}),l("div",va,[a(T,{name:"semantic-segmentation",class:"title-icon"}),t[48]||(t[48]=c(" 语义分段 "))]),t[49]||(t[49]=l("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),l("div",{class:J(["select-card-item",{active:e.chunk_type==4}]),onClick:t[12]||(t[12]=o=>_(4))},[a(T,{class:"check-arrow",name:"check-arrow-filled"}),l("div",ha,[a(T,{name:"semantic-segmentation",class:"title-icon"}),t[50]||(t[50]=c(" 父子分段 "))]),t[51]||(t[51]=l("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2),l("div",{class:J(["select-card-item",{active:e.chunk_type==3}]),onClick:t[13]||(t[13]=o=>_(3))},[a(T,{class:"check-arrow",name:"check-arrow-filled"}),l("div",ka,[a(T,{name:"semantic-segmentation",class:"title-icon"}),t[52]||(t[52]=c(" AI分段 "))]),t[53]||(t[53]=l("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])]),_:1,__:[54]}),e.chunk_type==1?(i(),h(R,{key:0},[a(u,{label:"分段标识符",required:""},{default:n(()=>[a(X,{value:e.normal_chunk_default_separators_no,"onUpdate:value":t[14]||(t[14]=o=>e.normal_chunk_default_separators_no=o),mode:"tags",style:{width:"100%"},placeholder:"请选择分段标识符",options:k.value},null,8,["value","options"])]),_:1}),a(P,null,{default:n(()=>[a(u,{label:"分段最大长度",required:""},{default:n(()=>[a(P,{gap:8,align:"center"},{default:n(()=>[a(K,{value:e.normal_chunk_default_chunk_size,"onUpdate:value":t[15]||(t[15]=o=>e.normal_chunk_default_chunk_size=o),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[55]||(t[55]=c(" 字符 "))]),_:1,__:[55]})]),_:1}),a(u,{label:"分段重叠长度"},{default:n(()=>[a(P,{gap:8,align:"center"},{default:n(()=>[a(K,{value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":t[16]||(t[16]=o=>e.normal_chunk_default_chunk_overlap=o),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[56]||(t[56]=c(" 字符 "))]),_:1,__:[56]})]),_:1})]),_:1}),l("div",ga,[l("div",ya,[t[57]||(t[57]=c(" 自动合并较小分段 ")),a(j,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:n(()=>[a(L(oe),{class:"ml4"})]),_:1})]),a(ee,{checkedValue:"false",unCheckedValue:"true",checked:e.normal_chunk_default_not_merged_text,"onUpdate:checked":t[17]||(t[17]=o=>e.normal_chunk_default_not_merged_text=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])],64)):O("",!0),e.chunk_type==2?(i(),h(R,{key:1},[e.chunk_type==2?(i(),G(u,{key:0,required:""},{label:n(()=>[t[59]||(t[59]=c(" 分段阈值 ")),a(j,null,{title:n(()=>t[58]||(t[58]=[c("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")])),default:n(()=>[a(L(oe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:n(()=>[a(K,{value:e.semantic_chunk_default_threshold,"onUpdate:value":t[18]||(t[18]=o=>e.semantic_chunk_default_threshold=o),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):O("",!0),a(P,null,{default:n(()=>[a(u,{label:"分段最大长度",required:""},{default:n(()=>[a(P,{gap:8,align:"center"},{default:n(()=>[a(K,{value:e.semantic_chunk_default_chunk_size,"onUpdate:value":t[19]||(t[19]=o=>e.semantic_chunk_default_chunk_size=o),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[60]||(t[60]=c(" 字符 "))]),_:1,__:[60]})]),_:1}),a(u,{label:"分段重叠长度"},{default:n(()=>[a(P,{gap:8,align:"center"},{default:n(()=>[a(K,{value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":t[20]||(t[20]=o=>e.semantic_chunk_default_chunk_overlap=o),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[61]||(t[61]=c(" 字符 "))]),_:1,__:[61]})]),_:1})]),_:1})],64)):O("",!0),e.chunk_type==3?(i(),h(R,{key:2},[e.chunk_type==3?(i(),G(u,{key:0,required:""},{label:n(()=>t[62]||(t[62]=[c(" AI大模型 ")])),default:n(()=>[a(he,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":t[21]||(t[21]=o=>e.ai_chunk_model=o),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":t[22]||(t[22]=o=>e.ai_chunk_model_config_id=o),style:{width:"100%"},onLoaded:V},null,8,["modeName","modeId"])]),_:1})):O("",!0),a(u,{label:"提示词设置",required:""},{default:n(()=>[a(P,{gap:8,align:"center"},{default:n(()=>[a(x,{maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":t[23]||(t[23]=o=>e.ai_chunk_prumpt=o),placeholder:ke},null,8,["value"])]),_:1})]),_:1}),a(u,null,{label:n(()=>[t[64]||(t[64]=c(" 单次最大字符数 ")),a(j,null,{title:n(()=>t[63]||(t[63]=[c("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")])),default:n(()=>[a(L(oe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:n(()=>[a(K,{class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":t[24]||(t[24]=o=>e.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[65]||(t[65]=c(" 字符 "))]),_:1,__:[65]})],64)):O("",!0),e.chunk_type==4?(i(),h(R,{key:3},[t[70]||(t[70]=l("div",{class:"main-title-block"},"父块（用作上下文）",-1)),a(u,{label:"分段类型"},{default:n(()=>[a(ve,{value:e.father_chunk_paragraph_type,"onUpdate:value":t[25]||(t[25]=o=>e.father_chunk_paragraph_type=o)},{default:n(()=>[a(pe,{value:1},{default:n(()=>[t[66]||(t[66]=c("全文 ")),a(j,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:n(()=>[a(L(oe))]),_:1})]),_:1,__:[66]}),a(pe,{value:2},{default:n(()=>[t[67]||(t[67]=c("段落 ")),a(j,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:n(()=>[a(L(oe))]),_:1})]),_:1,__:[67]})]),_:1},8,["value"])]),_:1}),e.father_chunk_paragraph_type==2?(i(),G(u,{key:0,label:"分段标识符"},{default:n(()=>[a(X,{placeholder:"请选择",style:{width:"100%"},mode:"tags",options:k.value,value:e.father_chunk_separators_no,"onUpdate:value":t[26]||(t[26]=o=>e.father_chunk_separators_no=o)},null,8,["options","value"])]),_:1})):O("",!0),e.father_chunk_paragraph_type==2?(i(),G(u,{key:1,label:"分段最大长度"},{default:n(()=>[a(P,{align:"center",gap:8},{default:n(()=>[a(K,{style:{flex:"1"},value:e.father_chunk_chunk_size,"onUpdate:value":t[27]||(t[27]=o=>e.father_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[68]||(t[68]=l("span",{class:"unit-text"},"字符",-1))]),_:1,__:[68]})]),_:1})):O("",!0),t[71]||(t[71]=l("div",{class:"main-title-block"},"子块（用于检索）",-1)),a(u,{label:"分段标识符"},{default:n(()=>[a(X,{placeholder:"请选择",style:{width:"100%"},mode:"tags",options:k.value,value:e.son_chunk_separators_no,"onUpdate:value":t[28]||(t[28]=o=>e.son_chunk_separators_no=o)},null,8,["options","value"])]),_:1}),a(u,{label:"分段最大长度"},{default:n(()=>[a(P,{align:"center",gap:8},{default:n(()=>[a(K,{style:{flex:"1"},value:e.son_chunk_chunk_size,"onUpdate:value":t[29]||(t[29]=o=>e.son_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[69]||(t[69]=l("span",{class:"unit-text"},"字符",-1))]),_:1,__:[69]})]),_:1})],64)):O("",!0),re(l("div",ba,[l("div",Ca,[t[73]||(t[73]=c(" 生成知识图谱 ")),a(j,null,{title:n(()=>t[72]||(t[72]=[c("文件分块后，所有块将用于生成知识图谱，提高复杂问题推理能力。")])),default:n(()=>[a(L(oe),{class:"ml4"})]),_:1})]),a(ee,{onChange:H,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])],512),[[_e,I.value]]),re(a(u,{label:"知识图谱模型"},{default:n(()=>[a(he,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":t[30]||(t[30]=o=>e.graph_use_model=o),modeId:e.graph_model_config_id,"onUpdate:modeId":t[31]||(t[31]=o=>e.graph_model_config_id=o),style:{width:"300px"},onLoaded:V},null,8,["modeName","modeId"])]),_:1},512),[[_e,e.graph_switch&&I.value]])],512),[[_e,!w.value&&(e.type==0||e.type==3)]])]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"]),a(bt,{onOk:te,ref_key:"openGrapgModalRef",ref:Y},null,512)],64)}}},wa=ie(xa,[["__scopeId","data-v-791de538"]]),$a={class:"form-item"},La={class:"form-content"},Ia={__name:"add-group",emits:["ok"],setup(N,{expose:q,emit:M}){const I=f(!1),A=M,w=f("新建分组"),g=Ce({group_name:"",id:""}),b=e=>{g.group_name=e.group_name||"",g.id=e.id||"",w.value=e.id?"编辑分组":"新建分组",I.value=!0},S=()=>{if(!g.group_name)return Q.error("请输入分组名称");Je({...g}).then(e=>{Q.success(`${w.value}成功`),I.value=!1,A("ok")})};return q({show:b}),(e,p)=>{const k=Ee,_=se;return i(),h("div",null,[a(_,{open:I.value,"onUpdate:open":p[1]||(p[1]=y=>I.value=y),title:w.value,onOk:S,zIndex:2e3},{default:n(()=>[l("div",$a,[p[2]||(p[2]=l("div",{class:"form-label"},"分组名称：",-1)),l("div",La,[a(k,{maxLength:15,value:g.group_name,"onUpdate:value":p[0]||(p[0]=y=>g.group_name=y),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Aa=ie(Ia,[["__scopeId","data-v-14ebb44e"]]),za={class:"form-item"},Oa={class:"form-content"},Ma={__name:"edit-group",emits:["ok"],setup(N,{expose:q,emit:M}){const I=f(!1),A=M,w=f("修改分组"),g=Ce({group_id:"",library_id:""}),b=f([]),S=k=>{g.group_id=k.group_id||"0",g.library_id=k.id||"",p(),I.value=!0},e=()=>{if(!g.group_id)return Q.error("请选择分组");Qe({...g}).then(k=>{Q.success(`${w.value}成功`),I.value=!1,A("ok")})},p=()=>{Se().then(k=>{b.value=k.data||[]})};return q({show:S}),(k,_)=>{const y=De,V=Re,F=se;return i(),h("div",null,[a(F,{open:I.value,"onUpdate:open":_[1]||(_[1]=m=>I.value=m),title:w.value,onOk:e},{default:n(()=>[l("div",za,[_[2]||(_[2]=l("div",{class:"form-label"},"分组名称：",-1)),l("div",Oa,[a(V,{value:g.group_id,"onUpdate:value":_[0]||(_[0]=m=>g.group_id=m),style:{width:"100%"},placeholder:"请选择分组"},{default:n(()=>[(i(!0),h(R,null,be(b.value,m=>(i(),G(y,{value:m.id},{default:n(()=>[c(D(m.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},Sa=ie(Ma,[["__scopeId","data-v-42538830"]]),Ua={style:{"margin-bottom":"12px"}},Ga={class:"wechat-app-list"},Fa=["onClick"],Ta={class:"item-body"},qa=["src"],Na={class:"app-info"},Ea={class:"app-name"},Ra={class:"app-desc"},Da={class:"ext-info-list"},Ba={key:0,class:"status-block status-success"},Va={key:1,class:"status-block status-warning"},Ha={__name:"select-wechat-app",props:{title:{type:String,default:"选择公众号"},okText:{type:String,default:"确 定"},disabledAppIds:{type:Array,default:()=>[]}},emits:["ok"],setup(N,{expose:q,emit:M}){const I=M,A=N,w=xe();Ue();const g=f(!1),b=f(!1),S=f(!1),e=f(!1),p=f({}),k=f([]),_=f([]),y=ue(()=>k.value.filter($=>!A.disabledAppIds.includes($.app_id)));function V($,v){p.value=$,_.value=Array.isArray(v)?v:[],m(),g.value=!0}function F(){g.value=!1}function m(){b.value=!0,At({app_type:"official_account",app_name:""}).then($=>{k.value=$.data||[]}).finally(()=>{b.value=!1})}function Y(){let $=k.value.filter(v=>_.value.includes(v.app_id));I("ok",Ae(_.value),Ae($))}function H(){const $=w.resolve({path:"/user/official-account"});window.open($.href,"_blank")}function te($){if(A.disabledAppIds.includes($.app_id))return;let v=_.value.indexOf($.app_id);v>-1?_.value.splice(v,1):_.value.push($.app_id),ae()}function ae(){Ge(()=>{e.value=_.value.length===y.value.length})}function de(){e.value?(_.value=[],k.value.map($=>{A.disabledAppIds.includes($.app_id)||_.value.push($.app_id)})):_.value=[]}return q({open:V,close:F}),($,v)=>{const le=pt,s=ct,t=vt,z=Be,u=se;return i(),G(u,{open:g.value,"onUpdate:open":v[3]||(v[3]=x=>g.value=x),title:N.title,"confirm-loading":S.value,width:"626px"},{footer:n(()=>[a(z,{type:"primary",disabled:!_.value.length,onClick:Y},{default:n(()=>[c(D(N.okText),1)]),_:1},8,["disabled"])]),default:n(()=>[tt($.$slots,"alert",{},()=>[a(le,{type:"info",class:"zm-alert-info mt12"},{message:n(()=>[v[4]||(v[4]=c(" 公众号列表数据来源：系统管理>公众号管理。")),l("a",{onClick:H},"前往编辑公众号、添加公众号")]),_:1})],!0),b.value?(i(),G(It,{key:0,style:{margin:"10vh 0"}})):k.value.length?(i(),h(R,{key:1},[l("div",Ua,[a(s,{checked:e.value,"onUpdate:checked":v[0]||(v[0]=x=>e.value=x),disabled:!y.value.length,onChange:de},{default:n(()=>v[5]||(v[5]=[c("全选 ")])),_:1,__:[5]},8,["checked","disabled"])]),a(t,{value:_.value,"onUpdate:value":v[2]||(v[2]=x=>_.value=x)},{default:n(()=>[l("div",Ga,[(i(!0),h(R,null,be(k.value,x=>(i(),h("div",{key:x.id,class:J(["wechat-app-item",{disabled:N.disabledAppIds.includes(x.app_id)}]),onClick:E=>te(x)},[l("div",Ta,[l("img",{class:"app-avatar",src:x.app_avatar,alt:""},null,8,qa),l("div",Na,[l("div",Ea,D(x.app_name),1),l("div",Ra,"Appid："+D(x.app_id),1)])]),l("div",Da,[x.account_is_verify=="true"?(i(),h("div",Ba,[a(L(ft)),v[6]||(v[6]=c(" 已认证 "))])):(i(),h("div",Va,[a(L(mt)),v[7]||(v[7]=c(" 未认证 "))])),l("span",{onClick:v[1]||(v[1]=B(()=>{},["stop"]))},[a(s,{value:x.app_id,disabled:N.disabledAppIds.includes(x.app_id),onChange:ae},null,8,["value","disabled"])])])],10,Fa))),128))])]),_:1},8,["value"])],64)):(i(),G(Fe,{key:2,title:"暂未绑定公众号"},{desc:n(()=>[a(z,{type:"primary",onClick:H},{default:n(()=>v[8]||(v[8]=[c("绑定公众号")])),_:1,__:[8]})]),_:1}))]),_:3},8,["open","title","confirm-loading"])}}},Pa=ie(Ha,[["__scopeId","data-v-c0d74817"]]),Za={"bg-color":"#f5f9ff",class:"library-page"},Ja={class:"library-page-body"},Qa={class:"list-toolbar"},ja={class:"toolbar-box"},Ka={class:"toolbar-box"},Wa={class:"create-action"},Ya=["src"],Xa={class:"create-action"},el=["src"],tl={class:"list-group-box"},al={class:"group-head-box"},ll={key:0,class:"head-title"},nl={class:"classify-box",style:{"margin-top":"16px"}},ol=["onClick"],sl={class:"classify-title"},il={key:0,class:"drag-btn"},dl={key:1,style:{width:"20px",display:"inline-block"}},rl={class:"right-content"},_l={key:0,class:"btn-box"},ul={class:"hover-btn-wrap"},pl=["onClick"],cl=["onClick"],fl={__name:"library-list",setup(N){xe();const q=f([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),M=f([{title:"全部 (0)",value:"all"},{title:"普通知识库 (0)",value:"0"},{title:"问答知识库 (0)",value:"2"}]),I=Ue();let{role_permission:A,role_type:w}=I;const g=ue(()=>w==1||A.includes("LibraryCreate")),b=f(null),S=f(null),e=f(null),p=f(null),k=f([]),_=f("all"),y=f("");let V="library-list-hide-group-key";const F=f(localStorage.getItem(V)==1),m=()=>{F.value=!F.value,localStorage.setItem(V,F.value?1:0)},Y=f(""),H=f([]);ue(()=>H.value.filter(d=>d.group_name.includes(Y.value)));const te=()=>{let d=_.value==="all"?"":_.value;Se({type:d}).then(r=>{let o=r.data||[],C=0;o.forEach(W=>{C+=+W.total}),H.value=[{group_name:"全部",total:C,id:""},...o]})};te();const ae=d=>{d==3?e.value.open():de(d)},de=d=>{b.value.show({type:d,group_id:y.value})},$=(d,r)=>{if(!r.length)return Q.warning("请选择公众号");e.value.close(),b.value.show({type:3,group_id:y.value,wx_app_ids:d})},v=f([]),le=async d=>{await Lt({ability_type:"library_ability_official_account"}).then(Z=>{var ce;let ne=(Z==null?void 0:Z.data)||{};((ce=ne==null?void 0:ne.user_config)==null?void 0:ce.switch_status)==1&&(p.value=ne)});let r=0,o=0,C=0,W=0;k.value=[],d.forEach(Z=>{Z.type==0&&(o+=1),Z.type==2&&(C+=1),Z.type==3&&(W+=1,k.value.push(Z.official_app_id)),r+=1}),M.value=[{title:"全部 ("+r+")",value:"all"},{title:"普通知识库 ("+o+")",value:"0"},{title:"问答知识库 ("+C+")",value:"2"}],p.value&&M.value.push({title:"公众号知识库 ("+W+")",value:"3"})};let s=f([]);const t=()=>{let d=_.value==="all"?"":_.value;Ie({type:d}).then(r=>{let o=r.data||[];o.forEach(C=>{C.file_size_str=je(C.file_size),C.avatar||(C.avatar=C.type==0?fe:me)}),y.value!=""&&(o=o.filter(C=>C.group_id==y.value)),v.value=o,_.value==="all"?(s.value=r.data,le(s.value)):Ie().then(C=>{s.value=C.data,le(s.value)})})};t();const z=()=>{t(),te()},u=d=>{d.type=="1"?window.open(`/#/public-library/config?library_id=${d.id}`,"_blank","noopener"):window.open(`/#/library/details?id=${d.id}`,"_blank","noopener")},x=d=>{if(Ye(d.id)!=4)return Q.error("您没有删除该知识库的权限");let o=3,C=se.confirm({title:`删除${d.library_name}`,icon:a(Oe),content:"您确定要删除此知识库吗？",okText:o+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){E(d)},onCancel(){}}),W=setInterval(()=>{o==1?(C.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(W),W=void 0):(o-=1,C.update({okText:o+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},E=({id:d})=>{Xe({id:d}).then(()=>{Q.success("删除成功"),t(),te()})},X=d=>{y.value=d.id,t()},ee=f(null),j=d=>{ee.value.show({...d})},T=f(null),K=d=>{T.value.show({...d})},P=d=>{se.confirm({title:`确认删除分组${d.group_name}`,icon:a(Oe),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){We({id:d.id}).then(()=>{Q.success("删除成功"),te(),y.value==d.id&&(y.value=""),t()})}})};f(!1);const pe=d=>d.draggedContext.element.id>0&&d.relatedContext.element.id>0,ve=async()=>{try{const d=H.value.filter(r=>r.id>0).map((r,o)=>({id:r.id,sort:H.value.length-o}));await Ke({sort_group:JSON.stringify(d)}),Q.success("排序已保存")}catch(d){console.error("排序保存失败:",d),getGroupLists()}};return(d,r)=>{const o=Be,C=qe,W=Te,Z=Ne,ne=we,ce=ye,$e=Ve;return i(),h("div",Za,[a(Ct,{class:"mb-16",tabs:q.value,active:"/library/list"},null,8,["tabs"]),a(xt,{class:"mb-16 mr-16",title:"使用说明"},{default:n(()=>r[7]||(r[7]=[l("div",null,[l("p",null," 1、知识库可以关联到聊天机器人中使用，创建机器人之前请先创建知识库，然后去机器人设置中关联。 "),l("p",null," 2、知识库支持普通知识库和问答知识库。普通知识库适用于非结构化数据，支持text/doc/pdf/md/html等格式文件，上传后系统会自动分段处理，也支持自定义分段。问答知识库适用于一问一答形式结构化数据，支持通过excel/word批量上传或自定义添加问题和答案。 ")],-1)])),_:1,__:[7]}),l("div",Ja,[l("div",Qa,[l("div",ja,[a(wt,{tabs:M.value,value:_.value,"onUpdate:value":r[0]||(r[0]=U=>_.value=U),onChange:z},null,8,["tabs","value"])]),l("div",Ka,[g.value?(i(),G(Z,{key:0},{overlay:n(()=>[a(W,null,{default:n(()=>[a(C,{onClick:r[2]||(r[2]=B(U=>ae(0),["prevent"]))},{default:n(()=>[l("span",Wa,[l("img",{class:"icon",src:L(fe),alt:""},null,8,Ya),r[9]||(r[9]=l("span",null,"普通知识库",-1))])]),_:1}),a(C,{onClick:r[3]||(r[3]=B(U=>ae(2),["prevent"]))},{default:n(()=>[l("span",Xa,[l("img",{class:"icon",src:L(me),alt:""},null,8,el),r[10]||(r[10]=l("span",null,"问答知识库",-1))])]),_:1}),p.value?(i(),G(C,{key:0,onClick:r[4]||(r[4]=B(U=>ae(3),["prevent"]))},{default:n(()=>r[11]||(r[11]=[l("span",{class:"create-action"},[l("img",{class:"icon",src:zt,alt:""}),l("span",null,"公众号知识库")],-1)])),_:1,__:[11]})):O("",!0)]),_:1})]),default:n(()=>[a(o,{type:"primary",onClick:r[1]||(r[1]=B(()=>{},["prevent"]))},{icon:n(()=>[a(L(ze))]),default:n(()=>[r[8]||(r[8]=c(" 新建知识库 "))]),_:1,__:[8]})]),_:1})):O("",!0)])]),l("div",tl,[l("div",{class:J(["group-list-box",{"hide-group":F.value}])},[a($e,{style:{"padding-right":"16px"}},{default:n(()=>[l("div",al,[F.value?O("",!0):(i(),h("div",ll,[r[12]||(r[12]=l("div",null,"知识库分组",-1)),a(ne,{title:"新建分组"},{default:n(()=>[l("div",{class:"hover-btn-wrap",onClick:r[5]||(r[5]=U=>j({}))},[a(L(ze))])]),_:1})]))]),l("div",nl,[a(L($t),{modelValue:H.value,"onUpdate:modelValue":r[6]||(r[6]=U=>H.value=U),"item-key":"id",onEnd:ve,move:pe,handle:".drag-btn"},{item:n(({element:U})=>[l("div",{class:J(["classify-item",{active:U.id==y.value}]),onClick:Le=>X(U)},[l("div",sl,[U.id>0?(i(),h("span",il,[a(ce,{name:"drag"})])):(i(),h("span",dl)),c(" "+D(U.group_name),1)]),l("div",rl,[l("div",{class:J(["num",{"num-block":U.id<=0}])},D(U.total),3),U.id>0?(i(),h("div",_l,[a(Z,{placement:"bottomRight"},{overlay:n(()=>[a(W,null,{default:n(()=>[a(C,null,{default:n(()=>[l("div",{onClick:B(Le=>j(U),["stop"])},"重命名",8,pl)]),_:2},1024),a(C,null,{default:n(()=>[l("div",{onClick:B(Le=>P(U),["stop"])},"删 除",8,cl)]),_:2},1024)]),_:2},1024)]),default:n(()=>[l("div",ul,[a(L(ht))])]),_:2},1024)])):O("",!0)])],10,ol)]),_:1},8,["modelValue"])])]),_:1}),a(ne,{placement:"right",title:F.value?"展开分组":"收起分组"},{default:n(()=>[l("div",{class:"hide-group-box",onClick:m},[F.value?(i(),G(L(ge),{key:1})):(i(),G(L(kt),{key:0}))])]),_:1},8,["title"])],2),a($e,{style:{"padding-right":"16px",flex:"1"}},{default:n(()=>[a(ea,{"show-create":g.value,list:v.value,onEdit:u,onDelete:x,onOpenEditGroupModal:K},null,8,["show-create","list"])]),_:1})])]),a(ra,{ref_key:"addLibrayPopup",ref:S,onOk:de},null,512),a(wa,{ref_key:"addLibraryModelRef",ref:b},null,512),a(Aa,{ref_key:"addGroupRef",ref:ee,onOk:z},null,512),a(Sa,{ref_key:"editGroupRef",ref:T,onOk:z},null,512),a(Pa,{ref_key:"wxAppRef",ref:e,title:"添加知识库",okText:"下一步","disabled-app-ids":k.value,onOk:$},null,8,["disabled-app-ids"])])}}},Tl=ie(fl,[["__scopeId","data-v-efa569b8"]]);export{Tl as default};
