import{d as L}from"./utils-CvB22N-W.js";import{g as te}from"./index-Cg7-0swo.js";import{u as B,j as ae,t as oe,k as Q,l as se,m as ne,n as le,o as ie,p as _e,q as ue,v as de,f as ce}from"../../index-DSFcP5NQ.js";import{i as re}from"./charts-9PO4lPBa.js";import{_ as I}from"./emoji-mart-BBMRoEa3.js";import{w as pe,r as S,j as E,i as me,o as he,a as O,b as w,p as k,al as j,E as U,y as s,u as o,v,_ as C,t as l,F as J,l as K,e as z,m as V,q as F,c as ke}from"./vue-chunks-BdaA73Wf.js";import{P as W,Q as ve,B as G,w as N,x as P,T as fe,r as ge,u as ye,v as be,J as X,F as H,c as we,G as xe,V as De,M as Ce,b as Z,W as Se,I as $e,X as Ye,Y as Me,H as ze,Z as Ae,$ as Le}from"./ui-antd-Dl1wwwCD.js";import{i as Te}from"./index-MT9fcN3v.js";import"./editor-cherry-CFIsbKoN.js";import"./elkjs-BN8GIjVH.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./other-LrIFyvU9.js";const qe={class:"container-echart"},Oe={__name:"line-chart",props:{options:{type:Object,default:()=>({xAxis:[],series:[]})}},setup(R){const{t:e}=B("views.user.usetoken"),b=R;let _;const a=()=>{const u={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"}},legend:{show:!0,bottom:"0%",textStyle:{color:"#262626",fontSize:"14px"},data:[e("input"),e("output"),e("total")],itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"1.5%",left:"4%",top:"5%",bottom:"20%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:b.options.xAxis,axisLabel:{show:!0,fontSize:10,interval:"auto",rotate:0,lineHeight:26},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:[{name:e("input"),type:"line",showSymbol:!1,data:b.options.series.map(d=>d.prompt_token),smooth:!0,color:"#2475fc"},{name:e("output"),type:"line",showSymbol:!1,data:b.options.series.map(d=>d.completion_token),smooth:!0,color:"#646161"},{name:e("total"),type:"line",showSymbol:!1,data:b.options.series.map(d=>d.total_token),smooth:!0,color:"#4B7900"}]};_.setOption(u,{notMerge:!0})};pe(()=>b.options,()=>{setTimeout(()=>{a()},200)},{deep:!0});const m=()=>{_.resize()},f=S(null);return E(()=>{me(()=>{_=re(f.value),a()}),window.addEventListener("resize",m)}),he(()=>{window.removeEventListener("resize",m)}),(u,d)=>(w(),O("div",qe,[k("div",{ref_key:"chartRef",ref:f,class:"interface-echart"},null,512)]))}},Re=I(Oe,[["__scopeId","data-v-bf8e5520"]]),Fe={class:"statics-content"},Ue={class:"search-box"},Ie={class:"list-box"},Be={class:"main-title"},Ee={class:"main-title"},Ne={style:{"margin-left":"auto"}},Pe={__name:"statics-by-app",setup(R){const{t:e}=j(),b=ae(),_=S([L().subtract(7,"day"),L()]),a=S([]),m=U({start_date:_.value[0].format("YYYY-MM-DD"),end_date:_.value[1].format("YYYY-MM-DD"),token_app_type:"",robot_id:""}),f=U({page:1,size:20,total:0}),u=S([]),d=S([]),D=()=>{f.page=1,n(),Y()},q=r=>{f.page=r.current,f.size=r.pageSize,Y()};let A={chatwiki_robot:e("views.user.usetoken.robot"),workflow:e("views.user.usetoken.workflow"),other:e("views.user.usetoken.other")};const Y=()=>{Q({...m,page:f.page,size:f.size}).then(r=>{let c=r.data.list||[];u.value=c.map(x=>({...x,token_app_type_desc:A[x.token_app_type],completion_token_desc:h(x.completion_token),prompt_token_desc:h(x.prompt_token),total_token_desc:h(x.total_token)})),f.total=+r.data.total})},T=()=>{Q({...m,page:f.page,size:1e4}).then(r=>{let c=r.data.list||[];c=c.map(t=>({...t,robot_name:t.robot_name||"",token_app_type_desc:A[t.token_app_type],completion_token_desc:h(t.completion_token),prompt_token_desc:h(t.prompt_token),total_token_desc:h(t.total_token)}));let x=`${e("views.user.usetoken.type")},${e("views.user.usetoken.app_name")},${e("views.user.usetoken.total_consumption")}(k),${e("views.user.usetoken.input")}(k),${e("views.user.usetoken.output")}(k),${e("views.user.usetoken.date")}
`;se(x,c,["token_app_type_desc","robot_name","total_token_desc","prompt_token_desc","completion_token_desc","date"],e("views.user.usetoken.detail_data_prefix")+L().format("YYYY-MM-DD HH:mm:ss"))})},i=U({xAxis:[],series:[]}),n=()=>{oe({...m}).then(r=>{let c=r.data.list,x=[],g=[];c.forEach(t=>{x.push(L(t.date).format("YY/MM/DD")),g.push({completion_token:h(t.completion_token),prompt_token:h(t.prompt_token),total_token:h(t.total_token)})}),Object.assign(i,{xAxis:x,series:g})})};function h(r){return r<=0?0:(r/1e3).toFixed(2)}const p=()=>{m.start_date="",m.end_date="",_.value&&_.value.length>0&&(m.start_date=_.value[0].format("YYYY-MM-DD"),m.end_date=_.value[1].format("YYYY-MM-DD")),D()},y=()=>{if(m.token_app_type="",m.robot_id="",!a.value){D();return}m.token_app_type=a.value[0],a.value.length>=2&&(m.robot_id=a.value[1]),D()};return E(()=>{te().then(r=>{let c=r.data||[],x=c.filter(t=>t.application_type==0),g=c.filter(t=>t.application_type==1);d.value=[{label:e("views.user.usetoken.robot"),value:"chatwiki_robot",children:x.map(t=>({label:t.robot_name,value:t.id}))},{label:e("views.user.usetoken.workflow"),value:"workflow",children:g.map(t=>({label:t.robot_name,value:t.id}))},{label:e("views.user.usetoken.other"),value:"other"}]}),D()}),(r,c)=>{const x=W,g=ve,t=G,$=N,ee=P;return w(),O("div",Fe,[k("div",Ue,[s(x,{value:_.value,"onUpdate:value":c[0]||(c[0]=M=>_.value=M),allowClear:!1,onChange:p,style:{width:"256px"},presets:o(b)},null,8,["value","presets"]),s(g,{style:{width:"256px"},changeOnSelect:"",onChange:y,value:a.value,"onUpdate:value":c[1]||(c[1]=M=>a.value=M),options:d.value,placeholder:o(e)("views.user.usetoken.all_apps")},null,8,["value","options","placeholder"])]),k("div",Ie,[k("div",Be,v(o(e)("views.user.usetoken.usage_trend")),1),s(Re,{options:i},null,8,["options"]),k("div",Ee,[C(v(o(e)("views.user.usetoken.detail_data"))+" ",1),k("div",Ne,[s(t,{onClick:T},{default:l(()=>[C(v(o(e)("views.user.usetoken.export")),1)]),_:1})])]),s(ee,{style:{"margin-top":"16px"},"data-source":u.value,pagination:{current:f.page,total:f.total,pageSize:f.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:q},{default:l(()=>[s($,{title:o(e)("views.user.usetoken.type"),"data-index":"token_app_type_desc",width:100},{default:l(({record:M})=>[C(v(M.token_app_type_desc),1)]),_:1},8,["title"]),s($,{title:o(e)("views.user.usetoken.app_name"),"data-index":"robot_name",width:140},null,8,["title"]),s($,{title:o(e)("views.user.usetoken.total_consumption")+"(k)","data-index":"total_token_desc",width:140},{default:l(({record:M})=>[C(v(M.total_token_desc),1)]),_:1},8,["title"]),s($,{title:o(e)("views.user.usetoken.input")+"(k)","data-index":"prompt_token_desc",width:140},{default:l(({record:M})=>[C(v(M.prompt_token_desc),1)]),_:1},8,["title"]),s($,{title:o(e)("views.user.usetoken.output")+"(k)","data-index":"completion_token_desc",width:140},{default:l(({record:M})=>[C(v(M.completion_token_desc),1)]),_:1},8,["title"]),s($,{title:o(e)("views.user.usetoken.date"),"data-index":"date",width:140},{default:l(({record:M})=>[C(v(M.date),1)]),_:1},8,["title"])]),_:1},8,["data-source","pagination"])])])}}},Qe=I(Pe,[["__scopeId","data-v-649e0cdd"]]),Ve={class:"zm-date"},He={class:"date-btn"},je={class:"date-content"},Je={__name:"date",props:{dateType:{type:Number,default:1},rangeData:{type:Array,default:null}},emits:["dateChange"],setup(R,{emit:e}){const{t:b}=B("views.user.usetoken"),_=R,a=S(1),m=e;let f=U([{label:b("date.today"),value:!1,key:2,start_date:L(),end_date:L()},{label:b("date.yesterday"),value:!1,key:3,start_date:L().subtract(1,"day"),end_date:L().subtract(1,"day")},{label:b("date.last_seven_days"),value:!0,key:4,start_date:L().subtract(6,"day"),end_date:L().subtract(0,"day")}]);const u=S(null),d=S(null),D=S([]),q=i=>i>=L().subtract(0,"day"),A=()=>{let i=a.value,n=null;f.forEach(h=>{h.key==i&&(n=h)}),D.value=[n.start_date,n.end_date],u.value=n.start_date.format("YYYY-MM-DD"),d.value=n.end_date.format("YYYY-MM-DD"),T()},Y=(i,n)=>{a.value=1,D.value=i,u.value=n[0],d.value=n[1],T()},T=()=>{m("dateChange",{start_date:u.value,end_date:d.value})};return E(()=>{a.value=_.dateType,D.value=_.rangeData}),(i,n)=>{const h=fe,p=ge,y=W;return w(),O("div",Ve,[k("div",He,[s(p,{value:a.value,"onUpdate:value":n[0]||(n[0]=r=>a.value=r),onChange:A},{default:l(()=>[(w(!0),O(J,null,K(o(f),r=>(w(),z(h,{class:"date-btn-button",value:r.key,key:r.key},{default:l(()=>[C(v(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),k("div",je,[s(y,{value:D.value,"onUpdate:value":n[1]||(n[1]=r=>D.value=r),onChange:Y,format:"YYYY-MM-DD",disabledDate:q},null,8,["value"])])])}}},Ke={class:"team-members-pages"},We={class:"total"},Ge={class:"label total-label"},Xe={class:"total-num"},Ze={class:"set-model"},et={class:"label set-model-label"},tt={class:"set-model-body"},at={class:"set-date"},ot={class:"label set-date-label"},st={class:"set-date-body"},nt={class:"set-reset"},lt={class:"list-box"},it={class:"user-box"},_t={class:"name-info"},ut={class:"user-name"},dt={__name:"use-token",setup(R){const{t:e}=B("views.user.usetoken"),b=S(Date.now()),_=S([e("all_models")]),a=U({page:1,size:10,total:0,use_model:e("all_models"),start_date:"",end_date:""}),m=i=>{a.start_date=i.start_date,a.end_date=i.end_date,d()},f=()=>{a.use_model=e("all_models"),a.start_date="",a.end_date="",b.value=Date.now(),d()},u=i=>{a.page=i.current,a.size=i.pageSize,A()},d=()=>{a.page=1,A()},D=S([]),q=(i,n)=>{const h=(i.split(".")[1]?i.split(".")[1]:i.split(".")[0]).length,p=(n.split(".")[1]?n.split(".")[1]:n.split(".")[0]).length,y=Math.pow(10,Math.max(h,p));return(i*y+n*y)/y/1e3},A=()=>{let i={page:a.page,size:a.size,start_date:a.start_date,end_date:a.end_date};a.use_model!=e("all_models")&&(i.model=a.use_model),ne(i).then(n=>{let h=n.data.list;h.forEach(p=>{p.create_time=p.create_time>0?L(p.create_time*1e3).format("YYYY-MM-DD HH:mm"):"--",p.amount=q(p.prompt_token,p.completion_token)}),D.value=h,a.total=+n.data.total})},Y=i=>{a.use_model=i,d()},T=()=>{Te({}).then(i=>{_.value=[e("all_models"),...i.data]})};return E(()=>{T(),d()}),(i,n)=>{const h=be,p=ye,y=G,r=X,c=N,x=P;return w(),O("div",Ke,[s(r,{justify:"flex-end"},{default:l(()=>[k("div",We,[k("div",Ge,v(o(e)("total_label")),1),k("div",Xe,v(a.total)+v(o(e)("count_unit")),1)]),k("div",Ze,[k("div",et,v(o(e)("select_model_label")),1),k("div",tt,[s(p,{value:a.use_model,"onUpdate:value":n[0]||(n[0]=g=>a.use_model=g),placeholder:o(e)("all_models"),onChange:Y,style:{width:"200px"}},{default:l(()=>[(w(!0),O(J,null,K(_.value,g=>(w(),z(h,{key:g,value:g},{default:l(()=>[k("span",null,v(g),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),k("div",at,[k("div",ot,[k("span",null,v(o(e)("statistics_date_label")),1)]),k("div",st,[(w(),z(Je,{onDateChange:m,key:b.value}))])]),k("div",nt,[s(y,{onClick:f},{default:l(()=>[C(v(o(e)("reset_btn")),1)]),_:1})])]),_:1}),k("div",lt,[s(x,{"data-source":D.value,pagination:a.total>a.size?{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}:!1,onChange:u},{default:l(()=>[s(c,{title:o(e)("model_name"),"data-index":"model",width:"300px"},{default:l(({record:g})=>[k("div",it,[k("div",_t,[k("div",ut,v(g.corp)+"（"+v(g.model)+"）",1)])])]),_:1},8,["title"]),s(c,{title:o(e)("type"),"data-index":"IP",width:"190px"},{default:l(({record:g})=>[C(v(g.type),1)]),_:1},8,["title"]),s(c,{title:o(e)("token_consumption"),"data-index":"amount",width:"190px"},{default:l(({record:g})=>[C(v(g.amount),1)]),_:1},8,["title"]),s(c,{title:o(e)("date"),"data-index":"date",width:"190px"},{default:l(({record:g})=>[C(v(g.date),1)]),_:1},8,["title"])]),_:1},8,["data-source","pagination"])])])}}},ct=I(dt,[["__scopeId","data-v-32044ce0"]]),rt={__name:"token-quota-modal",emits:["ok"],setup(R,{expose:e,emit:b}){const{t:_}=B("views.user.usetoken.modal"),a=b,m=S(!1),f=S(_("token_limit")),u=U({max_token:"",description:"",robot_id:"",token_app_type:""});function d(p){return p<=0||!p?"":(p/1e3).toFixed(3)}let D=S(0);const q=(p={})=>{m.value=!0,T(),u.max_token=d(p.max_token),u.description=p.description||"",u.robot_id=p.robot_id||"",u.token_app_type=p.token_app_type||"",D.value=d(p.max_token-p.use_token)},A=U({max_token:[{required:!0,message:_("please_input_token_limit"),trigger:"blur"}]}),Y=H.useForm,{resetFields:T,validate:i,validateInfos:n}=Y(u,A),h=()=>{i().then(p=>{le({...u,max_token:(u.max_token*1e3).toFixed(3)}).then(y=>{Z.success(_("modify_success")),m.value=!1,a("ok")})})};return e({show:q}),(p,y)=>{const r=xe,c=we,x=De,g=H,t=Ce;return w(),z(t,{open:m.value,"onUpdate:open":y[2]||(y[2]=$=>m.value=$),title:f.value,onOk:h,width:540},{default:l(()=>[s(g,{layout:"vertical",style:{"margin-top":"16px"}},{default:l(()=>[s(c,V({label:o(_)("token_limit")},o(n).max_token),{default:l(()=>[s(r,{value:u.max_token,"onUpdate:value":y[0]||(y[0]=$=>u.max_token=$),style:{width:"60%"},min:.001,precision:3,placeholder:o(_)("please_input")},{addonAfter:l(()=>[...y[3]||(y[3]=[C(" k ",-1)])]),_:1},8,["value","placeholder"])]),_:1},16,["label"]),s(c,V({label:o(_)("remark")},o(n).description),{default:l(()=>[s(x,{maxLength:500,style:{height:"80px"},value:u.description,"onUpdate:value":y[1]||(y[1]=$=>u.description=$),placeholder:o(_)("please_input")},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1})]),_:1},8,["open","title"])}}},pt=I(rt,[["__scopeId","data-v-bc703b9e"]]),mt={class:"content-box"},ht={class:"search-block"},kt={class:"list-box"},vt=["onClick"],ft={__name:"quota-token",setup(R){const{t:e}=B("views.user.usetoken"),b=U({search:""}),_=S([]),a={chatwiki_robot:e("robot"),workflow:e("workflow"),other:e("other")},m=S(!1),f=()=>{u()},u=()=>{m.value=!0,ue({...b}).then(n=>{_.value=n.data.list||[]}).finally(()=>{m.value=!1})};let d=null;const D=n=>{if(d=n,d.switch_status==1){A();return}i(n)},q=()=>{d==null?u():A()},A=()=>{de({robot_id:d.robot_id,token_app_type:d.token_app_type,switch_status:d.switch_status==1?0:1}).then(n=>{Z.success(`${d.switch_status==1?e("quota.close_success"):e("quota.open_success")}`),u()})};function Y(n){return n<=0||!n?0:(n/1e3).toFixed(3)}const T=S(null),i=(n,h)=>{h&&(d=null),T.value.show(JSON.parse(JSON.stringify(n)))};return E(()=>{u()}),(n,h)=>{const p=$e,y=Ye,r=X,c=N,x=ze,g=P;return w(),O("div",mt,[k("div",ht,[s(p,{value:b.search,"onUpdate:value":h[0]||(h[0]=t=>b.search=t),placeholder:o(e)("quota.search_placeholder"),style:{width:"220px"},onChange:f},{suffix:l(()=>[s(o(Se),{onClick:f})]),_:1},8,["value","placeholder"])]),k("div",kt,[s(g,{"data-source":_.value,loading:m.value,pagination:!1,sticky:""},{default:l(()=>[s(c,{title:o(e)("quota.type"),"data-index":"token_app_type",width:120},{default:l(({record:t})=>[s(r,{gap:4,align:"center"},{default:l(()=>[t.token_app_type=="chatwiki_robot"?(w(),z(y,{key:0,size:24,src:o(ie)},null,8,["src"])):F("",!0),t.token_app_type=="workflow"?(w(),z(y,{key:1,size:24,src:o(_e)},null,8,["src"])):F("",!0),t.token_app_type=="other"?(w(),z(y,{key:2,size:24},{icon:l(()=>[s(o(Me),{style:{"font-size":"16px"}})]),_:1})):F("",!0),C(" "+v(a[t.token_app_type]),1)]),_:2},1024)]),_:1},8,["title"]),s(c,{title:o(e)("quota.app_name"),"data-index":"robot_name",width:160},null,8,["title"]),s(c,{title:o(e)("quota.today_consumption"),"data-index":"today_use_token",width:130},{default:l(({record:t})=>[C(v(Y(t.today_use_token)),1)]),_:1},8,["title"]),s(c,{title:o(e)("quota.token_limit"),"data-index":"amount",width:120},{default:l(({record:t})=>[C(v(t.is_config==1&&t.switch_status==1?Y(t.max_token):"-"),1)]),_:1},8,["title"]),s(c,{title:o(e)("quota.consumed"),"data-index":"amount2",width:120},{default:l(({record:t})=>[C(v(t.switch_status==1?Y(t.use_token):"-"),1)]),_:1},8,["title"]),s(c,{title:o(e)("quota.remaining"),"data-index":"amount3",width:120},{default:l(({record:t})=>[C(v(t.switch_status==1?Y(t.max_token-t.use_token):"-"),1)]),_:1},8,["title"]),s(c,{title:o(e)("quota.remark"),"data-index":"description",width:200,ellipsis:!0},{default:l(({record:t})=>[C(v(t.description||"--"),1)]),_:1},8,["title"]),s(c,{title:o(e)("quota.action"),"data-index":"action",width:120},{default:l(({record:t})=>[s(r,{align:"center",gap:8},{default:l(()=>[s(x,{onChange:$=>D(t),checked:t.switch_status==1,"checked-children":o(e)("quota.switch_on"),"un-checked-children":o(e)("quota.switch_off")},null,8,["onChange","checked","checked-children","un-checked-children"]),t.switch_status==1?(w(),O("a",{key:0,onClick:$=>i(t,!0)},v(o(e)("quota.setting")),9,vt)):F("",!0)]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","loading"])]),s(pt,{ref_key:"tokenQuotaModalRef",ref:T,onOk:q},null,512)])}}},gt=I(ft,[["__scopeId","data-v-513e18be"]]),yt={class:"user-model-page"},bt={class:"tabs-box"},wt={class:"list-wrapper"},xt={__name:"index",setup(R){const{t:e}=j(),b=ce(),_=ke(()=>b.role_type),a=S(1);return(m,f)=>{const u=Le,d=Ae;return w(),O("div",yt,[k("div",bt,[s(d,{activeKey:a.value,"onUpdate:activeKey":f[0]||(f[0]=D=>a.value=D)},{default:l(()=>[(w(),z(u,{key:1,tab:o(e)("views.user.usetoken.tabByApp")},null,8,["tab"])),(w(),z(u,{key:2,tab:o(e)("views.user.usetoken.tabByModel")},null,8,["tab"])),_.value==1||_.value==2?(w(),z(u,{key:3,tab:o(e)("views.user.usetoken.tabTokenQuota")},null,8,["tab"])):F("",!0)]),_:1},8,["activeKey"])]),k("div",wt,[a.value==1?(w(),z(Qe,{key:0})):F("",!0),a.value==2?(w(),z(ct,{key:1})):F("",!0),a.value==3?(w(),z(gt,{key:2})):F("",!0)])])}}},Ft=I(xt,[["__scopeId","data-v-9194f660"]]);export{Ft as default};
//# sourceMappingURL=index-DgVSA-1Y.js.map
