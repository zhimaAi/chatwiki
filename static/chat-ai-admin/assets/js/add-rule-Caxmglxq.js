import{u as ye,_ as me}from"../../index-DSFcP5NQ.js";import{ah as fe,r as y,c as ve,E as ce,j as he,a as B,y as u,p as i,t as _,ag as ge,b as c,v as r,u as o,_ as m,e as w,F as U,l as M,i as L}from"./vue-chunks-BdaA73Wf.js";import{M as be}from"./multi-reply-Ck3cS9Gg.js";import{e as J,h as Q,i as ke}from"./index-C67uUbSa.js";import{_ as we}from"./emoji-mart-BBMRoEa3.js";import{b as f,j as xe,F as Ce,k as Re,c as Ie,I as Ae,q as Be,ac as W,B as $e,a1 as N,an as ze,r as Fe,s as Ke}from"./ui-antd-Dl1wwwCD.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./index-B_UHbFfL.js";import"./index-Cg7-0swo.js";const qe={class:"subManage-edit"},Ue=["href"],Me={class:"main"},Ne={class:"nav-box",style:{"padding-top":"10px"}},Te={class:"item-box"},He={class:"item-title-box"},Se={class:"item-title"},Ee={class:"flex",style:{gap:"8px","align-items":"center"}},De={class:"tag-container",style:{"margin-top":"8px"}},Oe={class:"item-box",style:{"margin-top":"12px"}},Pe={class:"item-title-box"},Ve={class:"item-title"},je={class:"flex",style:{gap:"8px","align-items":"center"}},Le={class:"tag-container",style:{"margin-top":"8px"}},Je={class:"nav-box",style:{"margin-top":"24px"}},Qe={class:"item-box"},We={class:"nav-box",style:{"margin-top":"24px"}},Ge={class:"item-box"},Xe={class:"item-title-box"},Ye={class:"item-title"},Ze={class:"radio-container"},et={class:"btn-container"},tt={__name:"add-rule",setup(at){const{t:n}=ye("views.robot.robot-config.auto-reply.add-rule"),h=fe().query,k=y(+h.rule_id||+h["rule-id"]||0),G=ge(),X=ve(()=>`/#/robot/ability/auto-reply?id=${h.id}&robot_key=${h.robot_key}`),T=y(null),v=ce({name:"",reply_num:"0"}),Y={name:[{required:!0,message:n("msg_input_rule_name"),trigger:"blur"}]},g=y([]),b=y([]),R=y(""),I=y(""),$=y(!1),z=y(!1),H=y(null),S=y(null),F=y(!1),Z=()=>{$.value=!0,L(()=>{var a,t;const l=H.value;l!=null&&l.focus?l.focus():(t=(a=l==null?void 0:l.$el)==null?void 0:a.querySelector("input"))==null||t.focus()})},E=async()=>{var a,t;if(F.value)return;const l=(R.value||"").trim();if(!l){f.warning(n("msg_input_keyword"));return}if(g.value.includes(l)){f.warning(n("msg_keyword_exists"));return}try{F.value=!0;const s=await Q({id:k.value,robot_id:h.id,keyword:l}),e=(a=s==null?void 0:s.data)==null?void 0:a.is_repeat,C=((t=s==null?void 0:s.data)==null?void 0:t.rule_name)||"";if(e){f.error(n("msg_keyword_duplicate",{ruleName:C}));return}g.value.push(l),R.value="",$.value=!1}catch{f.error(n("msg_check_failed"))}finally{F.value=!1}},ee=l=>{g.value=g.value.filter(a=>a!==l)},K=y(!1),te=()=>{z.value=!0,L(()=>{var a,t;const l=S.value;l!=null&&l.focus?l.focus():(t=(a=l==null?void 0:l.$el)==null?void 0:a.querySelector("input"))==null||t.focus()})},D=async()=>{var a,t;if(K.value)return;const l=(I.value||"").trim();if(!l){f.warning(n("msg_input_keyword"));return}if(b.value.includes(l)){f.warning(n("msg_keyword_exists"));return}try{K.value=!0;const s=await Q({id:k.value,robot_id:h.id,keyword:l}),e=(a=s==null?void 0:s.data)==null?void 0:a.is_repeat,C=((t=s==null?void 0:s.data)==null?void 0:t.rule_name)||"";if(e){f.error(n("msg_keyword_duplicate",{ruleName:C}));return}b.value.push(l),I.value="",z.value=!1}catch{f.error(n("msg_check_failed"))}finally{K.value=!1}},ae=l=>{b.value=b.value.filter(a=>a!==l)},p=y([{type:"text",description:""}]),O=y([]),le=()=>{if(p.value.length>=5){f.warning(n("msg_max_reply_content"));return}p.value.push({type:"text",description:""})},ne=l=>{const{reply_index:a,...t}=l;a>=0&&a<p.value.length&&(p.value[a]=t)},oe=l=>{p.value.splice(l,1)},se=()=>{};function ue(l){return(l||[]).map(a=>({...a,status:"1"}))}function ie(l){const a={text:"2",image:"4",card:"3",imageText:"1",url:"5",smartMenu:"6"};return l.map(t=>a[t.type]||"").filter(Boolean)}const _e=()=>{var l;(l=T.value)==null||l.validate().then(async()=>{if(!g.value.length&&!b.value.length){f.warning(n("msg_at_least_one_keyword"));return}if(!p.value.length){f.warning(n("msg_at_least_one_reply"));return}for(const t of O.value)if(t&&t.validate&&!await t.validate())return;const a={robot_id:h.id,name:v.name,full_keyword:g.value,half_keyword:b.value,reply_content:JSON.stringify(ue(p.value)),reply_type:ie(p.value),reply_num:v.reply_num};k.value&&(a.id=k.value);try{const t=await ke(a);t&&t.res==0&&(f.success(n("msg_save_success")),G.push({path:"/robot/ability/auto-reply",query:{id:h.id,robot_key:h.robot_key}}))}catch{}})};return he(async()=>{const l=+(h.copy_id||0);if(!k.value&&l){try{const a=await J({id:l}),t=(a==null?void 0:a.data)||{};v.name=`${(t==null?void 0:t.name)||""}${n("label_copy_suffix")}`;const s=Array.isArray(t==null?void 0:t.reply_content)?t.reply_content:[];p.value=s.map(e=>({type:(e==null?void 0:e.type)||(e==null?void 0:e.reply_type)||"text",description:(e==null?void 0:e.description)||"",thumb_url:(e==null?void 0:e.thumb_url)||(e==null?void 0:e.pic)||"",title:(e==null?void 0:e.title)||"",url:(e==null?void 0:e.url)||"",appid:(e==null?void 0:e.appid)||"",page_path:(e==null?void 0:e.page_path)||"",smart_menu_id:(e==null?void 0:e.smart_menu_id)||"",smart_menu:(e==null?void 0:e.smart_menu)||{}})),v.reply_num=t.reply_num}catch{f.error(n("msg_load_failed"))}return}if(k.value)try{const a=await J({id:k.value}),t=(a==null?void 0:a.data)||{};v.name=(t==null?void 0:t.name)||"",g.value=Array.isArray(t==null?void 0:t.full_keyword)?t.full_keyword:[],b.value=Array.isArray(t==null?void 0:t.half_keyword)?t.half_keyword:[];const s=Array.isArray(t==null?void 0:t.reply_content)?t.reply_content:[];p.value=s.map(e=>({type:(e==null?void 0:e.type)||(e==null?void 0:e.reply_type)||"text",description:(e==null?void 0:e.description)||"",thumb_url:(e==null?void 0:e.thumb_url)||(e==null?void 0:e.pic)||"",title:(e==null?void 0:e.title)||"",url:(e==null?void 0:e.url)||"",appid:(e==null?void 0:e.appid)||"",page_path:(e==null?void 0:e.page_path)||"",smart_menu_id:(e==null?void 0:e.smart_menu_id)||"",smart_menu:(e==null?void 0:e.smart_menu)||{}})),v.reply_num=t.reply_num}catch{f.error(n("msg_load_failed"))}}),(l,a)=>{const t=Re,s=xe,e=Ae,C=Ie,q=me,P=Be,A=$e,V=ze,j=Ke,re=Fe,de=Ce;return c(),B("div",qe,[u(s,{class:"subManage-breadcrumb"},{default:_(()=>[u(t,null,{default:_(()=>[i("a",{href:X.value},r(o(n)("breadcrumb_keyword_reply")),9,Ue)]),_:1}),u(t,null,{default:_(()=>[m(r(o(n)("breadcrumb_add_rule")),1)]),_:1})]),_:1}),i("div",Me,[u(de,{ref_key:"formRef",ref:T,model:v,rules:Y},{default:_(()=>[u(C,{label:o(n)("label_rule_name"),name:"name",rules:[{required:!0,message:o(n)("msg_input_rule_name")}]},{default:_(()=>[u(e,{value:v.name,"onUpdate:value":a[0]||(a[0]=d=>v.name=d),placeholder:o(n)("ph_input"),style:{width:"512px"}},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),i("div",Ne,[u(q,{name:"set-keywords",style:{"font-size":"16px"}}),m(" "+r(o(n)("title_set_keywords")),1)]),i("div",Te,[i("div",He,[i("div",Se,r(o(n)("title_exact_match")),1),u(P,null,{title:_(()=>[m(r(o(n)("tip_exact_match")),1)]),default:_(()=>[u(o(W),{style:{color:"#8C8C8C"}})]),_:1})]),i("div",Ee,[$.value?(c(),w(e,{key:0,ref_key:"fullInputRef",ref:H,value:R.value,"onUpdate:value":a[1]||(a[1]=d=>R.value=d),placeholder:o(n)("ph_input_keyword"),style:{width:"260px"},onPressEnter:E,onBlur:E},null,8,["value","placeholder"])):(c(),w(A,{key:1,type:"dashed",class:"add-btn",onClick:Z},{icon:_(()=>[u(o(N))]),default:_(()=>[m(" "+r(o(n)("btn_add_keyword")),1)]),_:1}))]),i("div",De,[(c(!0),B(U,null,M(g.value,d=>(c(),w(V,{key:d,closable:"",onClose:x=>ee(d)},{default:_(()=>[m(r(d),1)]),_:2},1032,["onClose"]))),128))])]),i("div",Oe,[i("div",Pe,[i("div",Ve,r(o(n)("title_fuzzy_match")),1),u(P,null,{title:_(()=>[m(r(o(n)("tip_fuzzy_match")),1)]),default:_(()=>[u(o(W),{style:{color:"#8C8C8C"}})]),_:1})]),i("div",je,[z.value?(c(),w(e,{key:0,ref_key:"halfInputRef",ref:S,value:I.value,"onUpdate:value":a[2]||(a[2]=d=>I.value=d),placeholder:o(n)("ph_input_keyword"),style:{width:"260px"},onPressEnter:D,onBlur:D},null,8,["value","placeholder"])):(c(),w(A,{key:1,type:"dashed",class:"add-btn",onClick:te},{icon:_(()=>[u(o(N))]),default:_(()=>[m(" "+r(o(n)("btn_add_keyword")),1)]),_:1}))]),i("div",Le,[(c(!0),B(U,null,M(b.value,d=>(c(),w(V,{key:d,closable:"",onClose:x=>ae(d)},{default:_(()=>[m(r(d),1)]),_:2},1032,["onClose"]))),128))])]),i("div",Je,[u(q,{name:"reply-content",style:{"font-size":"16px"}}),m(" "+r(o(n)("title_reply_content")),1)]),i("div",Qe,[(c(!0),B(U,null,M(p.value,(d,x)=>(c(),w(be,{key:x,ref_for:!0,ref_key:"replyRefs",ref:O,value:p.value[x],"onUpdate:value":pe=>p.value[x]=pe,reply_index:x,onChange:ne,onDel:oe},null,8,["value","onUpdate:value","reply_index"]))),128)),u(A,{type:"dashed",style:{width:"694px"},disabled:p.value.length>=5,onClick:le},{icon:_(()=>[u(o(N))]),default:_(()=>[m(" "+r(o(n)("btn_add_reply_content"))+"("+r(p.value.length)+"/5) ",1)]),_:1},8,["disabled"])]),i("div",We,[u(q,{name:"reply-settings",style:{"font-size":"16px"}}),m(" "+r(o(n)("title_reply_settings")),1)]),i("div",Ge,[i("div",Xe,[i("div",Ye,r(o(n)("label_reply_method")),1)]),i("div",Ze,[u(re,{value:v.reply_num,"onUpdate:value":a[3]||(a[3]=d=>v.reply_num=d),onChange:se},{default:_(()=>[u(j,{value:"0"},{default:_(()=>[m(r(o(n)("reply_all")),1)]),_:1}),u(j,{value:"1"},{default:_(()=>[m(r(o(n)("reply_random")),1)]),_:1})]),_:1},8,["value"])])]),i("div",et,[u(A,{type:"primary",onClick:_e},{default:_(()=>[m(r(o(n)("btn_save")),1)]),_:1})])]),_:1},8,["model"])])])}}},ct=we(tt,[["__scopeId","data-v-6766353a"]]);export{ct as default};
//# sourceMappingURL=add-rule-Caxmglxq.js.map
