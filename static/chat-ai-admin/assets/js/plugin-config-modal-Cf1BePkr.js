import{s as U}from"./index-y6Ut8zwU.js";import{_ as j}from"../../index-C5-B0r5-.js";import{o as C,F as E,e as F,I as N,M as B,b as w}from"./ui-antd-B11sc9DP.js";import{f as p,r as V,ae as D,ad as k,ar as m,k as i,as as x,ac as b,F as K,ax as $,az as M,at as q}from"./vue-chunks-CGLjTDrY.js";const L={__name:"feishu-config-modal",emits:["change"],setup(z,{expose:S,emit:O}){const A=O,u=p({}),_=p(!1),f=p(!1),t=V({});function y(c={}){u.value=c,Object.assign(t,{name:"",appid:"",app_secret:"",is_default:!1}),(!u.value||!Object.keys(u.value).length)&&(t.is_default=!0),_.value=!0}function n(){try{if(f.value=!0,!t.name)throw"请输入凭证名称";if(u.value[t.name])throw"凭证名称已存在";if(!t.appid)throw"请输入APP ID";if(!t.app_secret)throw"请输入APP Secret";U({name:"feishu_bitable",data:JSON.stringify({...u.value,[t.name]:t})}).then(c=>{A("change"),_.value=!1,w.success("已保存")}).finally(()=>{f.value=!1})}catch(c){f.value=!1,w.error(c)}}return S({show:y}),(c,o)=>{const I=C,h=N,P=F,a=E,l=B;return k(),D(l,{open:_.value,"onUpdate:open":o[3]||(o[3]=s=>_.value=s),"confirm-loading":f.value,title:"API Key授权配置",width:"620px",onOk:n},{default:m(()=>[i(I,{type:"info","show-icon":"",message:"配置凭据后，工作流可直接调用此插件"}),i(a,{class:"mt16",model:t,"label-col":{span:4},"wrapper-col":{span:20}},{default:m(()=>[i(P,{label:"凭证名称",name:"name",rules:[{required:!0,message:"请输入凭证名称!"}]},{default:m(()=>[i(h,{value:t.name,"onUpdate:value":o[0]||(o[0]=s=>t.name=s),valueModifiers:{trim:!0},maxlength:16,placeholder:"请输入凭证名称"},null,8,["value"]),o[4]||(o[4]=x("div",{class:"tip-desc"},"仅用于区分多个授权配置的名称，不用于接口调用",-1))]),_:1}),i(P,{label:"APP ID",name:"appid",rules:[{required:!0,message:"请输入APP ID!"}]},{default:m(()=>[i(h,{value:t.appid,"onUpdate:value":o[1]||(o[1]=s=>t.appid=s),valueModifiers:{trim:!0},placeholder:"请输入APP ID"},null,8,["value"])]),_:1}),i(P,{label:"APP Secret",name:"app_secret",rules:[{required:!0,message:"请输入APP Secret!"}]},{default:m(()=>[i(h,{value:t.app_secret,"onUpdate:value":o[2]||(o[2]=s=>t.app_secret=s),valueModifiers:{trim:!0},placeholder:"请输入APP Secret"},null,8,["value"]),o[5]||(o[5]=x("div",{class:"tip-desc"},"如何获取APP ID和APP Secret",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])}}},ee=j(L,[["__scopeId","data-v-81d61a58"]]),G={style:{display:"flex","align-items":"center",gap:"8px"}},H=["href"],Q={key:0,class:"tip-desc"},R={key:1,class:"tip-desc"},T={__name:"plugin-config-modal",emits:["change"],setup(z,{expose:S,emit:O}){const A=O,u=p({}),_=p(""),f=p({}),t=p(!1),y=p(!1),n=V({}),c=p([]);function o(a){return String(a||"").replace(/`/g,"").trim()}function I(a){const l=[];Object.keys(a||{}).forEach(r=>{const d=a[r]||{};if(d&&d.use_plugin_config===!0){const v=d.params||{};Object.keys(v).forEach(g=>{const e=v[g]||{};e.plugin_config_component===!0&&l.push({key:g,name:e.name,desc:e.desc,tip:e.tip,required:!!e.required,placeholder:e.placeholder,click_title:o(e.click_title),click_url:o(e.click_url)})})}});const s=new Set;c.value=l.filter(r=>s.has(r.key)?!1:(s.add(r.key),!0)).sort((r,d)=>{var v,g;return+(((v=a==null?void 0:a[r.key])==null?void 0:v.sort_num)||0)-+(((g=a==null?void 0:a[d.key])==null?void 0:g.sort_num)||0)})}function h(a={},l="",s={}){u.value=a,_.value=l,f.value=s,Object.keys(n).forEach(r=>delete n[r]),Object.assign(n,{name:"",is_default:!1}),(!u.value||!Object.keys(u.value).length)&&(n.is_default=!0),I(f.value),c.value.forEach(r=>{n[r.key]=""}),t.value=!0}function P(){try{if(y.value=!0,!n.name)throw"请输入凭证名称";if(u.value[n.name])throw"凭证名称已存在";c.value.forEach(a=>{const l=String(n[a.key]||"").trim();if(a.required&&!l)throw`请输入${a.name||a.key}`}),U({name:_.value,data:JSON.stringify({...u.value,[n.name]:n})}).then(()=>{A("change"),t.value=!1,w.success("已保存")}).finally(()=>{y.value=!1})}catch(a){y.value=!1,w.error(String(a||"配置保存失败"))}}return S({show:h}),(a,l)=>{const s=C,r=N,d=F,v=E,g=B;return k(),D(g,{open:t.value,"onUpdate:open":l[1]||(l[1]=e=>t.value=e),"confirm-loading":y.value,title:"API Key授权配置",width:"620px",onOk:P},{default:m(()=>[i(s,{type:"info","show-icon":"",message:"配置凭据后，工作流可直接调用此插件"}),i(v,{class:"mt16",model:n,"label-col":{span:4},"wrapper-col":{span:20}},{default:m(()=>[i(d,{label:"凭证名称",name:"name",rules:[{required:!0,message:"请输入凭证名称!"}]},{default:m(()=>[i(r,{value:n.name,"onUpdate:value":l[0]||(l[0]=e=>n.name=e),valueModifiers:{trim:!0},maxlength:16,placeholder:"请输入凭证名称"},null,8,["value"]),l[2]||(l[2]=x("div",{class:"tip-desc"},"仅用于区分多个授权配置的名称，不用于接口调用",-1))]),_:1}),(k(!0),b(K,null,$(c.value,e=>(k(),D(d,{key:e.key,label:e.name||e.key,name:e.key,rules:e.required?[{required:!0,message:"请输入"+(e.name||e.key)+"!"}]:[]},{default:m(()=>[x("div",G,[i(r,{value:n[e.key],"onUpdate:value":J=>n[e.key]=J,valueModifiers:{trim:!0},placeholder:e.placeholder||""},null,8,["value","onUpdate:value","placeholder"]),e.click_url?(k(),b("a",{key:0,style:{"flex-shrink":"0"},href:e.click_url,target:"_blank",rel:"noopener noreferrer"},q(e.click_title||"获取"),9,H)):M("",!0)]),e.tip?(k(),b("div",Q,q(e.tip),1)):e.desc?(k(),b("div",R,q(e.desc),1)):M("",!0)]),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])}}},ae=j(T,[["__scopeId","data-v-e86219c2"]]);export{ee as F,ae as P};
