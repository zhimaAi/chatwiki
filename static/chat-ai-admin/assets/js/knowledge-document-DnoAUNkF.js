import{_ as to}from"./cu-scroll-BmUgdtgQ.js";import{b as ke,aw as Uo,ax as oo,ay as so,az as Mo,aA as at,aB as Do,d as Ct,aC as Go,aD as $t,aE as no,aF as To,aG as zo,aH as Eo,aI as Fo,h as lo,aJ as it,aK as No,aL as Po,e as Ho,aM as Bo,aq as Ko,aN as Wo,am as Vo,aO as Ao,aP as Qo,aQ as Jo,aR as Yo,aS as jo}from"../../index-OnalErht.js";import{r as le,q as ao,Y as a,_ as n,k as t,a2 as s,a5 as e,n as lt,a1 as F,ae as v,u as $,a7 as y,F as H,a9 as ue,G as m,B as ne,aa as Lt,ab as He,f as c,e as ve,o as wt,a6 as io,ad as re,a4 as Xo,J as xt,b as Zo,A as Jt}from"./vue-chunks-Ci-XTWEs.js";import{w as es,p as qt,a3 as ts,a8 as St,bm as os,bn as ss,a9 as ns,bo as ls,y as uo,a as E,M as ae,H as Pe,k as as,E as Ot,u as Be,v as Ke,g as is,ar as us,I as De,z as Me,T as Ne,D as ro,an as ut,b as _o,c as co,B as Rt,bp as ds,aJ as rs,F as dt,e as It,q as _s,R as cs,ag as ps,bq as po,X as vs,bd as ms,$ as fs,br as gs,ah as ys,ac as yt,bb as ot,bs as ht,bt as hs,bu as ks,av as bs,a5 as ws,Q as xs,d as Yt}from"./ui-antd-BgeWxFcI.js";import{E as Cs}from"./edit-subsection-Cb32iH-p.js";import{U as vo}from"./upload-input-Cuqbggcj.js";import{t as jt}from"./validate-8MtiUsxW.js";import{M as Xt}from"./model-select-BWi4a3Y6.js";import{O as $s}from"./open-grapg-modal-CJ8Bzz7E.js";import{R as Ls}from"./rename-modal-Bb0QQcZy.js";import{_ as qs}from"./page-alert-D1Mg_1Ia.js";import{d as Ss}from"./vuedraggable.umd-DJBjom-v.js";const Os={class:"subsection-box"},Rs=["onDblclick"],Is={class:"list-item"},Us={class:"list-content"},Ms={class:"status-error"},Ds=["onClick","innerHTML"],Gs={class:"similar-question-list"},Ts={class:"list-item list-item-answer"},zs=["innerHTML"],Es={class:"fragment-img"},Fs=["src"],Ns={class:"right-opration"},Ps=["onClick"],Hs=["onClick"],Bs=["onClick"],Ks=["onClick"],Ws={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(j,{expose:K,emit:oe}){const T=oe,h=j,W=le({selectedRowKeys:[]}),L=u=>{W.selectedRowKeys=u},P=()=>{W.selectedRowKeys=[]},w=u=>{T("openEditSubscription",u)},b=u=>{ae.confirm({title:"提示",icon:t(Pe),content:"确认是否删除该问答?",onOk(){return new Promise((S,Q)=>{oo({id:u}).then(I=>{E.success("删除成功"),T("handleDelParagraph",u),S()}).catch(()=>{S()})})},onCancel(){}})},R=(u,S)=>{Uo({id:u.id,category_id:S}).then(Q=>{E.success("设置成功"),T("getList")})},q=(u,S,Q)=>{let I=Q.field,M=Q.order;M?M=M==="ascend"?"asc":"desc":I="",T("handleSort",{sort_field:I,sort_type:M})};function p(u,S,Q={}){if(!S||!u)return u;const{highlightClass:I="highlight",caseSensitive:M=!1,wholeWord:J=!1}=Q,D=M?"g":"gi";let G;return J?G=new RegExp(`\\b${V(S)}\\b`,D):G=new RegExp(V(S),D),u.replace(G,x=>`<span class="${I}">${x}</span>`)}function V(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return K({handleOpenEditModal:w,state:W,resetSelect:P}),(u,S)=>{const Q=qt,I=St,M=es,J=uo,D=ao("viewer");return n(),a("div",Os,[t(J,{"data-source":j.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:W.selectedRowKeys,onChange:L},pagination:!1,loading:h.isLoading,onChange:q},{default:s(()=>[t(M,{key:"id","data-index":"id",width:1148},{title:s(()=>[m("问答（共"+y(h.total)+"个）",1)]),default:s(({record:G})=>[e("div",{class:"qa-list-box",onDblclick:x=>w(G)},[e("div",Is,[S[0]||(S[0]=e("div",{class:"list-label"},"问题",-1)),e("div",Us,[G.status==2?(n(),F(Q,{key:0,placement:"top"},{title:s(()=>[e("span",null,y(G.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Ms,[t($(ts))])])]),_:2},1024)):v("",!0),e("span",{onClick:x=>w(G),innerHTML:p(G.question,h.search),class:"question-text"},null,8,Ds),G.similar_questions&&G.similar_questions.length?(n(),F(I,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[e("div",Gs,[(n(!0),a(H,null,ue(G.similar_questions,(x,_)=>(n(),a("div",{class:"similar-question-list-item",key:_},y(x),1))),128))])]),title:s(()=>[e("span",null,"共 "+y(G.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[e("a",null,"（"+y(G.similar_questions.length)+"）",1)]),_:2},1024)):v("",!0)])]),e("div",Ts,[S[1]||(S[1]=e("div",{class:"list-label"},"答案",-1)),e("div",{class:"list-content",innerHTML:p(G.answer,h.search)},null,8,zs)]),lt((n(),a("div",Es,[(n(!0),a(H,null,ue(G.images,(x,_)=>(n(),a("img",{key:_,src:x,alt:""},null,8,Fs))),128))])),[[D]])],40,Rs)]),_:1}),t(M,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),t(M,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),t(M,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),t(M,{title:"操作",key:"action","data-index":"action",width:120},{default:s(({record:G,index:x})=>[e("div",Ns,[G.category_id>0?(n(),a("div",{key:0,class:"hover-btn-box",onClick:_=>R(G,0)},[t($(os),{style:{color:"#F59A23"}})],8,Ps)):(n(),a("div",{key:1,class:"hover-btn-box",onClick:_=>R(G,4)},[t($(ss))],8,Hs)),e("div",{class:"hover-btn-box",onClick:ne(_=>w(G),["stop"])},[t($(ns))],8,Bs),e("div",{class:"hover-btn-box",onClick:ne(_=>b(G.id),["stop"])},[t($(ls))],8,Ks)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},Vs=ke(Ws,[["__scopeId","data-v-d61f7351"]]),As={class:"alert-box"},Qs={class:"upload-file-box"},Js={key:0,class:"hight-set"},Ys={key:0,class:"set-box"},js={class:"form-item"},Xs={class:"form-item-body"},Zs={class:"form-item"},en={class:"form-item-body"},tn={class:"form-item"},on={class:"form-item-body"},sn={key:1,class:"set-box"},nn={class:"form-item"},ln={class:"form-item-body"},an={class:"form-item"},un={class:"form-item-body"},dn={class:"form-item"},rn={class:"form-item-body"},_n={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:K,emit:oe}){const T=so(),{qa_index_type:h}=T;Lt();const L=He().query,P=c(!1),w=c(!1),b=c([]),R=oe,q=c([]),p=j,V=ve(()=>p.library_id||L.id),u=le({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),S=c(!0),Q=x=>{u.group_id=void 0,x>=0&&(u.group_id=x),P.value=!0},I=()=>{let x=new FormData;b.value.forEach(_=>{x.append("library_files",_)}),Mo(x).then(_=>{let O=[];for(let z in _.data)O.push({lable:_.data[z],value:z});q.value=O})},M=()=>{if(b.value.length==0){E.error("请选择文件");return}w.value=!0;let x=new FormData;x.append("library_id",V.value);let _=!1;if(b.value.forEach(O=>{(O.name.includes(".xlsx")||O.name.includes(".csv"))&&(_=!0),x.append("library_files",O)}),_){if(!u.question_column)return w.value=!1,E.error("请选择问题所在列");if(!u.answer_column)return w.value=!1,E.error("请选择答案所在列");x.append("question_column",u.question_column),x.append("answer_column",u.answer_column),u.similar_column&&x.append("similar_column",u.similar_column)}else x.append("question_lable",u.question_lable),x.append("answer_lable",u.answer_lable),x.append("similar_label",u.similar_label);x.append("group_id",u.group_id>=0?u.group_id:0),x.append("is_qa_doc",1),x.append("qa_index_type",h),at(x).then(O=>{R("ok"),P.value=!1,b.value=[],w.value=!1}).catch(()=>{w.value=!1})},J=()=>{b.value=[]},D=c(1),G=x=>{u.question_column=void 0,u.answer_column=void 0,u.similar_column=void 0,u.question_lable="问题：",u.answer_lable="答案：",u.similar_label="相似问法：",b.value=x,x&&x.length>0&&(x[0].type.includes(".document")?D.value=2:(D.value=1,I()))};return K({show:Q}),(x,_)=>{const O=as,z=Ke,de=Be,X=Ot,B=De,be=ae;return n(),a("div",null,[t(be,{width:680,open:P.value,"onUpdate:open":_[9]||(_[9]=k=>P.value=k),"confirm-loading":w.value,maskClosable:!1,title:"上传文档",onOk:M,onCancel:J},{default:s(()=>[e("div",As,[t(O,{"show-icon":""},{message:s(()=>_[10]||(_[10]=[e("div",null,[m(" 通过word或者Excel形式导入问答，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),m("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),m("创建导入文档 ")],-1),e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),e("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])),_:1})]),t(X,{align:"center",style:{margin:"16px 0"}},{default:s(()=>[_[11]||(_[11]=e("div",null,"所属分组：",-1)),t(de,{value:u.group_id,"onUpdate:value":_[0]||(_[0]=k=>u.group_id=k),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,ue(p.groupLists.filter(k=>k.id>=0),k=>(n(),F(z,{value:k.id},{default:s(()=>[m(y(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[11]}),e("div",Qs,[t(vo,{type:2,value:b.value,"onUpdate:value":_[1]||(_[1]=k=>b.value=k),onChange:G},null,8,["value"])]),b.value.length>0?(n(),a("div",Js,[e("a",{onClick:_[2]||(_[2]=k=>S.value=!S.value)},[_[12]||(_[12]=m("高级设置： ")),S.value?(n(),F($(us),{key:1})):(n(),F($(is),{key:0}))]),S.value?(n(),a(H,{key:0},[D.value==1?(n(),a("div",Ys,[e("div",js,[_[13]||(_[13]=e("div",{class:"form-item-label required"},"问题所在列：",-1)),e("div",Xs,[t(de,{value:u.question_column,"onUpdate:value":_[3]||(_[3]=k=>u.question_column=k),placeholder:"请选择列名",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,ue(q.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Zs,[_[14]||(_[14]=e("div",{class:"form-item-label"},"相似问法所在列：",-1)),e("div",en,[t(de,{value:u.similar_column,"onUpdate:value":_[4]||(_[4]=k=>u.similar_column=k),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,ue(q.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",tn,[_[15]||(_[15]=e("div",{class:"form-item-label required"},"答案所在列：",-1)),e("div",on,[t(de,{value:u.answer_column,"onUpdate:value":_[5]||(_[5]=k=>u.answer_column=k),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),a(H,null,ue(q.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):v("",!0),D.value==2?(n(),a("div",sn,[e("div",nn,[_[16]||(_[16]=e("div",{class:"form-item-label"},"问题开始标识符：",-1)),e("div",ln,[t(B,{placeholder:"请输入标识符",value:u.question_lable,"onUpdate:value":_[6]||(_[6]=k=>u.question_lable=k)},null,8,["value"])])]),e("div",an,[_[17]||(_[17]=e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),e("div",un,[t(B,{placeholder:"请输入标识符",value:u.similar_label,"onUpdate:value":_[7]||(_[7]=k=>u.similar_label=k)},null,8,["value"])])]),e("div",dn,[_[18]||(_[18]=e("div",{class:"form-item-label"},"答案开始标识符：",-1)),e("div",rn,[t(B,{placeholder:"请输入标识符",value:u.answer_lable,"onUpdate:value":_[8]||(_[8]=k=>u.answer_lable=k)},null,8,["value"])])])])):v("",!0)],64)):v("",!0)])):v("",!0)]),_:1},8,["open","confirm-loading"])])}}},mo=ke(_n,[["__scopeId","data-v-c8302bd6"]]),cn={class:"form-item"},pn={class:"form-content"},vn={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(j,{expose:K,emit:oe}){const T=He().query,h=c(!1),W=oe,L=c("新建分组"),P=j,w=le({group_name:"",id:"",library_id:T.id}),b=q=>{w.group_name=q.group_name||"",w.id=q.id||"",L.value=q.id?"编辑分组":"新建分组",w.library_id=q.library_id,h.value=!0},R=()=>{if(!w.group_name)return E.error("请输入分组名称");Do({...w,group_type:P.group_type}).then(q=>{E.success(`${L.value}成功`),h.value=!1,W("ok")})};return K({show:b}),(q,p)=>{const V=De,u=ae;return n(),a("div",null,[t(u,{open:h.value,"onUpdate:open":p[1]||(p[1]=S=>h.value=S),title:L.value,onOk:R},{default:s(()=>[e("div",cn,[p[2]||(p[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",pn,[t(V,{maxLength:15,value:w.group_name,"onUpdate:value":p[0]||(p[0]=S=>w.group_name=S),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},fo=ke(vn,[["__scopeId","data-v-853bcd54"]]),mn={class:"qa-list-wrapper"},fn={class:"group-head-box"},gn={class:"head-title"},yn={class:"flex-between-box"},hn={class:"search-box"},kn={class:"classify-box"},bn=["onClick"],wn={class:"classify-title"},xn={class:"right-content"},Cn={key:0,class:"btn-box"},$n={class:"hover-btn-wrap"},Ln=["onClick"],qn=["onClick"],Sn={class:"main-content-box"},On={class:"head-content"},Rn={class:"title"},In={class:"pover-group-content-box"},Un={class:"group-head-box"},Mn={class:"head-title"},Dn={class:"flex-between-box"},Gn={class:"search-box"},Tn={class:"classify-box classify-scroll-box"},zn=["onClick"],En={class:"classify-title"},Fn={class:"right-content"},Nn={key:0,class:"btn-box"},Pn={class:"hover-btn-wrap"},Hn=["onClick"],Bn=["onClick"],Kn={class:"btn-right-box"},Wn={class:"des-content-block"},Vn={key:0,class:"alert-icon-box"},An={class:"content-block"},Qn={class:"pagination-box"},Zt="qa_document_group_box_width",st=180,kt=256,Jn={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(j){const K=c(null),T=He().query,h=c(""),W=c([]),L=c(-1),P=ve(()=>W.value.find(C=>C.id==L.value)||{}),w=ve(()=>W.value.filter(C=>C.group_name.includes(h.value))),b=j,R=ve(()=>b.library_id||T.id),q=c([]),p=c(localStorage.getItem("qa_document_group_hide_key")==1),V=c(0),u=c(0),S={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},Q=c({is_qa_doc:"1",library_id:R.value}),I=c({page:1,size:100}),M=le({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:R.value,search:""}),J=C=>{M.sort_field=C.sort_field,M.sort_type=C.sort_type,D()},D=()=>{I.value.page=1,X()},G=(C,d)=>{I.value.page=C,I.value.size=d,X()},x=()=>{p.value=!p.value,localStorage.setItem("qa_document_group_hide_key",p.value?1:2)},_=()=>{zo({id:R.value}).then(()=>{E.success("操作完成"),X()})},O=c(null),z=C=>{C.group_id||L.value>=0&&(C.group_id=L.value),O.value.showModal(JSON.parse(JSON.stringify(C)))},de=c(!1),X=()=>{de.value=!0,Go({...I.value,...M,group_id:L.value}).then(C=>{de.value=!1;let d=C.data,ce=d.list||[];ce.forEach(U=>{U.status_text=S[U.status],U.similar_questions&&(U.similar_questions=JSON.parse(U.similar_questions))}),q.value=ce,V.value=d.total,u.value=d.exception_total,K.value&&K.value.resetSelect()})};X();const B=()=>{$t({library_id:R.value}).then(C=>{let ce=(C.data||[]).reduce((U,ge)=>U+ +ge.total,0);W.value=[{group_name:"全部分组",id:-1,total:ce},...C.data]})};B();const be=c(null),k=C=>{be.value.show({...C,library_id:R.value})},we=()=>{B(),X()},Ge=C=>{L.value=C.id,D()},xe=C=>{ae.confirm({title:`确认删除分组${C.group_name}`,icon:t(Pe),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){no({id:C.id}).then(()=>{E.success("删除成功"),B(),L.value==C.id&&(L.value=-1,D())})}})},me=c(null),A=()=>{me.value.show(L.value)},qe=c(!1),_e=le({group_id:void 0,ids:""}),We=()=>{if(K.value.state.selectedRowKeys.length==0)return E.error("请选择你要移动的问答");_e.ids=K.value.state.selectedRowKeys.join(","),_e.group_id=void 0,qe.value=!0},rt=()=>{if(K.value.state.selectedRowKeys.length==0)return E.error("请选择你要删除的问答");ae.confirm({title:"提示",icon:t(Pe),content:"确认是否删除所选问答?",onOk(){oo({id:K.value.state.selectedRowKeys.join(",")}).then(C=>{E.success("删除成功"),X()})},onCancel(){}})},_t=()=>{if(!_e.group_id)return E.error("请选择分组");Fo({..._e}).then(()=>{qe.value=!1,E.success("移动成功"),we()})},ie=c(st),Se=c(!1);wt(()=>{const C=parseInt(localStorage.getItem(Zt));C&&C>=st&&C<=kt&&(ie.value=C)});let Oe=!1,fe=0,Z=0;const Ce=C=>{p.value||(Oe=!0,Se.value=!0,fe=C.clientX,Z=ie.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Ve),document.addEventListener("mouseup",Te))},Ve=C=>{if(!Oe)return;let d=Z+(C.clientX-fe);d=Math.max(st,Math.min(kt,d)),ie.value=d},Te=()=>{Oe&&(Oe=!1,Se.value=!1,localStorage.setItem(Zt,ie.value),document.body.style.cursor="",document.removeEventListener("mousemove",Ve),document.removeEventListener("mouseup",Te))},Re=c(!1),N=()=>{let C="";K.value.state.selectedRowKeys.length>0&&(C=K.value.state.selectedRowKeys.join(",")),To({library_id:T.id,export_type:2,group_id:L.value,data_ids:C}).then(d=>{Re.value=!0})},ct=()=>{Eo.push({path:"/library/details/export-record",query:T})};return(C,d)=>{const ce=Ct,U=qt,ge=De,$e=co,Ae=_o,Qe=ro,Je=to,pt=St,pe=Rt,vt=ds,mt=Ke,Ye=Be,ft=Ot,je=ae,gt=rs;return n(),a(H,null,[e("div",mn,[e("div",{class:re(["group-content-box",[{collapsed:p.value},{"no-transition":Se.value}]]),style:io(p.value?{}:{width:ie.value+"px",minWidth:st+"px",maxWidth:kt+"px"})},[e("div",fn,[e("div",gn,[t(U,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:x},[t(ce,{name:"put-away"})])]),_:1}),e("div",yn,[d[16]||(d[16]=e("div",null,"问答分组",-1)),t(U,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:d[0]||(d[0]=g=>k({}))},[t($(Me))])]),_:1})])]),e("div",hn,[t(ge,{value:h.value,"onUpdate:value":d[2]||(d[2]=g=>h.value=g),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:d[1]||(d[1]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",kn,[t(Je,{style:{"padding-right":"24px"}},{default:s(()=>[(n(!0),a(H,null,ue(w.value,g=>(n(),a("div",{class:re(["classify-item",{active:g.id==L.value}]),onClick:ye=>Ge(g),key:g.id},[e("div",wn,y(g.group_name),1),e("div",xn,[e("div",{class:re(["num",{"num-block":g.id<=0}])},y(g.total),3),g.id>0?(n(),a("div",Cn,[t(Qe,{placement:"bottomRight"},{overlay:s(()=>[t(Ae,null,{default:s(()=>[t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>k(g),["stop"])},"重命名",8,Ln)]),_:2},1024),t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>xe(g),["stop"])},"删 除",8,qn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",$n,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,bn))),128))]),_:1})]),p.value?v("",!0):(n(),a("div",{key:0,class:"resize-bar",onMousedown:Ce},null,32))],6),e("div",Sn,[t(Je,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[e("div",On,[e("div",Rn,[p.value?(n(),F(pt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",In,[e("div",Un,[e("div",Mn,[e("div",Dn,[d[17]||(d[17]=e("div",null,"问答分组",-1)),t(U,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:d[3]||(d[3]=g=>k({}))},[t($(Me))])]),_:1})])]),e("div",Gn,[t(ge,{allowClear:"",value:h.value,"onUpdate:value":d[5]||(d[5]=g=>h.value=g),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:d[4]||(d[4]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",Tn,[(n(!0),a(H,null,ue(w.value,g=>(n(),a("div",{class:re(["classify-item",{active:g.id==L.value}]),onClick:ye=>Ge(g),key:g.id},[e("div",En,y(g.group_name),1),e("div",Fn,[e("div",{class:re(["num",{"num-block":g.id<=0}])},y(g.total),3),g.id>0?(n(),a("div",Nn,[t(Qe,{placement:"bottomRight"},{overlay:s(()=>[t(Ae,null,{default:s(()=>[t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>k(g),["stop"])},"重命名",8,Hn)]),_:2},1024),t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>xe(g),["stop"])},"删 除",8,Bn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Pn,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,zn))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:x},[t(ce,{name:"expand"})])]),_:1})):v("",!0),e("div",null,y(P.value.group_name),1),e("div",Kn,[e("div",null,[t(ge,{onChange:D,value:M.search,"onUpdate:value":d[6]||(d[6]=g=>M.search=g),placeholder:"搜索问答"},{suffix:s(()=>[t($(Ne))]),_:1},8,["value"])]),t(pe,{onClick:rt},{default:s(()=>d[18]||(d[18]=[m("批量删除")])),_:1,__:[18]}),t(pe,{onClick:We},{default:s(()=>d[19]||(d[19]=[m("批量移动")])),_:1,__:[19]}),t(pe,{onClick:d[7]||(d[7]=g=>A())},{default:s(()=>d[20]||(d[20]=[m("批量导入")])),_:1,__:[20]}),t(pe,{onClick:d[8]||(d[8]=g=>N())},{default:s(()=>d[21]||(d[21]=[m("批量导出")])),_:1,__:[21]}),t(pe,{onClick:d[9]||(d[9]=g=>z({})),type:"primary",icon:t($(Me))},{default:s(()=>d[22]||(d[22]=[m("问答")])),_:1,__:[22]},8,["icon"])])]),e("div",Wn,[u.value>0?(n(),a("div",Vn,[t(ce,{name:"alert-icon"}),e("div",null,y(u.value)+"个问答学习失败",1),e("a",{onClick:_},"重新学习")])):v("",!0)])]),e("div",An,[t(Vs,{ref_key:"subsectionBoxRef",ref:K,total:V.value,isLoading:de.value,paragraphLists:q.value,search:M.search,onOpenEditSubscription:z,onHandleDelParagraph:we,onGetList:X,onHandleSort:J},null,8,["total","isLoading","paragraphLists","search"]),e("div",Qn,[t(vt,{current:I.value.page,"onUpdate:current":d[10]||(d[10]=g=>I.value.page=g),"page-size":I.value.size,"onUpdate:pageSize":d[11]||(d[11]=g=>I.value.size=g),total:V.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:G},null,8,["current","page-size","total"])])])]),_:1})])]),t(Cs,{detailsInfo:Q.value,onHandleEdit:we,ref_key:"editSubscriptionRef",ref:O},null,8,["detailsInfo"]),t(fo,{ref_key:"addGroupRef",ref:be,onOk:we},null,512),t(mo,{groupLists:W.value,library_id:j.library_id,onOk:we,ref_key:"qaUploadModalRef",ref:me},null,8,["groupLists","library_id"]),t(je,{open:qe.value,"onUpdate:open":d[13]||(d[13]=g=>qe.value=g),title:"批量移动分组",onOk:_t},{default:s(()=>[t(ft,{align:"center",style:{margin:"24px 0"}},{default:s(()=>[d[23]||(d[23]=e("div",null,"移动到分组：",-1)),t(Ye,{value:_e.group_id,"onUpdate:value":d[12]||(d[12]=g=>_e.group_id=g),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,ue(W.value.filter(g=>g.id>=0),g=>(n(),F(mt,{value:g.id},{default:s(()=>[m(y(g.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[23]})]),_:1},8,["open"]),t(je,{open:Re.value,"onUpdate:open":d[15]||(d[15]=g=>Re.value=g),title:null,footer:null,width:640},{default:s(()=>[t(gt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:s(()=>[t(pe,{style:{"margin-right":"16px"},onClick:d[14]||(d[14]=g=>Re.value=!1)},{default:s(()=>d[24]||(d[24]=[m("知道了")])),_:1,__:[24]}),t(pe,{onClick:ct,type:"primary"},{default:s(()=>d[25]||(d[25]=[m("去下载")])),_:1,__:[25]})]),_:1})]),_:1},8,["open"])],64)}}},Di=ke(Jn,[["__scopeId","data-v-8df4223f"]]),Yn={class:"form-box"},jn={class:"upload-document-type-box"},Xn=["onClick"],Zn={class:"right-block"},el={class:"title-block"},tl={class:"title-text"},ol={class:"desc"},sl={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(j,{expose:K,emit:oe}){const T=Lt(),h=He(),W=dt.useForm,L=c(!1),P=c("添加自定义文档"),w=j,b=le({library_id:h.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),R=c([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),q=J=>{b.qa_index_type=J},p=le({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:V,validate:u,validateInfos:S}=W(b,p),Q=()=>{L.value=!0,V(),b.file_name="",b.is_qa_doc=0,b.qa_index_type=1,b.library_id=w.libraryInfo.id||h.query.id,w.libraryInfo.type==2&&(b.is_qa_doc=1)},I=c(!1),M=()=>{u().then(()=>{let J={...xt(b),group_id:w.group_id};I.value=!0,at(J).then(D=>{E.success(`${P.value}成功`),L.value=!1,T.push("/library/preview?id="+D.data.file_ids[0])}).finally(()=>{I.value=!1})})};return K({add:Q}),(J,D)=>{const G=De,x=It,_=cs,O=_s,z=Ct,de=dt,X=ae;return n(),a("div",null,[t(X,{open:L.value,"onUpdate:open":D[2]||(D[2]=B=>L.value=B),title:P.value,onOk:M,width:"472px",confirmLoading:I.value},{default:s(()=>[e("div",Yn,[t(de,{layout:"vertical"},{default:s(()=>[t(x,Xo({label:"文档名称"},$(S).file_name),{default:s(()=>[t(G,{type:"text",placeholder:"请输入文档名称",value:b.file_name,"onUpdate:value":D[0]||(D[0]=B=>b.file_name=B)},null,8,["value"])]),_:1},16),v("",!0),b.is_qa_doc==1?(n(),F(x,{key:1,label:"索引方式",required:""},{default:s(()=>[e("div",jn,[(n(!0),a(H,null,ue(R.value,B=>(n(),a("div",{class:re(["type-item",{active:b.qa_index_type==B.value}]),key:B.value,onClick:be=>q(B.value)},[e("div",Zn,[e("div",el,[t(z,{name:b.qa_index_type==B.value?B.iconNameActive:B.iconName},null,8,["name"]),e("div",tl,y(B.title),1)]),e("div",ol,y(B.desc),1)]),b.qa_index_type==B.value?(n(),F(z,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],10,Xn))),128))])]),_:1})):v("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},nl=ke(sl,[["__scopeId","data-v-a4f74280"]]),ll="/assets/img/guide-image-DSu20zRj.png",al={class:"container"},il={class:"guide-content"},ul={class:"content-box"},dl={__name:"guide-learning-tips",setup(j,{expose:K}){const oe=lo(),T=c(!1),h=c(!1),W=c(""),L=()=>{setTimeout(()=>{T.value=!0},500)},P=()=>{oe.setGuideLearningTips(h.value),T.value=!1},w=()=>{oe.setGuideLearningTips(h.value),T.value=!1};return K({show:L}),(b,R)=>{const q=ps,p=Rt,V=ae;return n(),a("div",al,[t(V,{open:T.value,"onUpdate:open":R[1]||(R[1]=u=>T.value=u),title:W.value,onOk:P,onCancel:w,width:"472px"},{footer:s(()=>[t(p,{type:"primary",onClick:P},{default:s(()=>R[5]||(R[5]=[m("我知道了")])),_:1,__:[5]})]),default:s(()=>[e("div",il,[R[4]||(R[4]=e("img",{src:ll,alt:"操作引导",class:"guide-image"},null,-1)),e("div",ul,[R[3]||(R[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),t(q,{checked:h.value,"onUpdate:checked":R[0]||(R[0]=u=>h.value=u)},{default:s(()=>R[2]||(R[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])),_:1,__:[2]},8,["checked"])])])]),_:1},8,["open","title"])])}}},rl=ke(dl,[["__scopeId","data-v-33a87814"]]),_l={__name:"edit-online-doc",emits:["ok"],setup(j,{expose:K,emit:oe}){const T=oe,h=le({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),W=c({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),L=c(!1),P=q=>{q=JSON.parse(JSON.stringify(q)),h.id=q.id||"",h.file_name=q.file_name||"",h.doc_auto_renew_frequency=+q.doc_auto_renew_frequency||1,q.doc_auto_renew_minute>0&&(h.doc_auto_renew_minute=it(q.doc_auto_renew_minute)),L.value=!0},w=c(!1),b=c(null),R=()=>{b.value.validate().then(()=>{w.value=!0,No({...h,doc_auto_renew_minute:h.doc_auto_renew_minute?it(h.doc_auto_renew_minute):0}).then(()=>{L.value=!1,w.value=!1,T("ok")})}).catch(()=>{w.value=!1})};return K({show:P}),(q,p)=>{const V=De,u=It,S=Ke,Q=Be,I=po,M=dt,J=ae;return n(),a("div",null,[t(J,{open:L.value,"onUpdate:open":p[3]||(p[3]=D=>L.value=D),"confirm-loading":w.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:R},{default:s(()=>[t(M,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:b,model:h,rules:W.value},{default:s(()=>[t(u,{name:"file_name",label:"文件名称"},{default:s(()=>[t(V,{value:h.file_name,"onUpdate:value":p[0]||(p[0]=D=>h.file_name=D),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:s(()=>[t(Q,{value:h.doc_auto_renew_frequency,"onUpdate:value":p[1]||(p[1]=D=>h.doc_auto_renew_frequency=D),style:{width:"100%"}},{default:s(()=>[t(S,{value:1},{default:s(()=>p[4]||(p[4]=[m("不自动更新")])),_:1,__:[4]}),t(S,{value:2},{default:s(()=>p[5]||(p[5]=[m("每天")])),_:1,__:[5]}),t(S,{value:3},{default:s(()=>p[6]||(p[6]=[m("每3天")])),_:1,__:[6]}),t(S,{value:4},{default:s(()=>p[7]||(p[7]=[m("每7天")])),_:1,__:[7]}),t(S,{value:5},{default:s(()=>p[8]||(p[8]=[m("每30天")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),h.doc_auto_renew_frequency>1?(n(),F(u,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(I,{valueFormat:"HH:mm",value:h.doc_auto_renew_minute,"onUpdate:value":p[2]||(p[2]=D=>h.doc_auto_renew_minute=D),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},cl={class:"form-item"},pl={class:"form-content"},vl={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(j,{expose:K,emit:oe}){const T=c(!1),h=oe,W=c("修改分组"),L=j,P=le({group_id:"",file_id:""}),w=c([]),b=p=>{P.group_id=p.group_id||"0",P.file_id=p.id||"",q(),T.value=!0},R=()=>{if(!P.group_id)return E.error("请选择分组");Po({...P,library_id:L.libraryId,sense:L.sense}).then(p=>{E.success(`${W.value}成功`),T.value=!1,h("ok")})},q=()=>{$t({library_id:L.libraryId,group_type:1}).then(p=>{w.value=p.data||[]})};return K({show:b}),(p,V)=>{const u=Ke,S=Be,Q=ae;return n(),a("div",null,[t(Q,{open:T.value,"onUpdate:open":V[1]||(V[1]=I=>T.value=I),title:W.value,onOk:R},{default:s(()=>[e("div",cl,[V[2]||(V[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",pl,[t(S,{value:P.group_id,"onUpdate:value":V[0]||(V[0]=I=>P.group_id=I),style:{width:"100%"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),a(H,null,ue(w.value,I=>(n(),F(u,{value:I.id},{default:s(()=>[m(y(I.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},ml=ke(vl,[["__scopeId","data-v-40485b34"]]),fl={class:"details-library-page"},gl={class:"group-head-box"},yl={class:"head-title"},hl={class:"flex-between-box"},kl={class:"classify-box",style:{"margin-top":"16px"}},bl=["onClick"],wl={key:0,class:"drag-btn"},xl={key:1,style:{width:"20px"}},Cl={class:"classify-title"},$l={class:"right-content"},Ll={key:0,class:"btn-box"},ql={class:"hover-btn-wrap"},Sl=["onClick"],Ol=["onClick"],Rl={class:"main-content-box"},Il={class:"group-header-title"},Ul={class:"pover-group-content-box"},Ml={class:"group-head-box"},Dl={class:"head-title"},Gl={class:"flex-between-box"},Tl={class:"search-box"},zl={class:"classify-box classify-scroll-box"},El=["onClick"],Fl={class:"classify-title"},Nl={class:"right-content"},Pl={key:0,class:"btn-box"},Hl={class:"hover-btn-wrap"},Bl=["onClick"],Kl=["onClick"],Wl={class:"title"},Vl={class:"list-tools"},Al={class:"tools-items"},Ql={class:"right-box"},Jl={key:0,class:"status-box"},Yl={class:"status-item"},jl={class:"status-content"},Xl={class:"status-item"},Zl={class:"status-content content-tip"},ea={class:"status-item"},ta={class:"status-content content-tip"},oa={key:1,class:"status-select-box"},sa={class:"tool-item"},na={class:"tool-item"},la={class:"dropdown-btn-menu"},aa={key:0,class:"desc"},ia={key:1,class:"desc"},ua={class:"dropdown-btn-menu"},da={class:"dropdown-btn-menu"},ra={class:"list-content"},_a={key:0,class:"doc-name-td"},ca=["href"],pa=["onClick"],va={key:0},ma={key:1},fa=["onClick"],ga={key:0},ya={key:1},ha={key:2,class:"url-remark"},ka=["onClick"],ba={key:0,class:"pdf-progress-box"},wa={class:"progress-title"},xa={class:"status-box"},Ca=["onClick"],$a={class:"progress-bar"},La={class:"num-box"},qa={key:0,class:"status-tag running"},Sa={key:2,class:"status-tag running"},Oa={key:3,class:"status-tag complete"},Ra={class:"status-tag status-error"},Ia=["onClick"],Ua={class:"status-tag status-error"},Ma={class:"status-tag"},Da=["onClick"],Ga={key:7,class:"status-tag"},Ta={key:8,class:"status-tag running"},za={class:"status-tag error"},Ea={key:10,class:"status-tag cancel"},Fa={key:11,class:"status-tag subning"},Na={class:"status-tag"},Pa=["onClick"],Ha={key:1,class:"status-tag running"},Ba={key:2,class:"status-tag complete"},Ka={class:"status-tag error"},Wa=["onClick"],Va={class:"zm-line1 reason-text"},Aa={key:4,class:"status-tag running"},Qa={class:"status-tag warning"},Ja={class:"reason-text"},Ya=["onClick"],ja={key:0},Xa={key:1},Za={key:0,class:"text-block"},ei={class:"time-content-box"},ti={key:0},oi={key:1},si={key:2},ni={key:3},li={key:4},ai={key:5,class:"ml4"},ii={key:6},ui=["onClick"],di={key:1},ri={key:0},_i={key:1},ci=["onClick"],pi=["onClick"],vi={class:"upload-file-box"},mi={class:"select-card-box"},fi=["onClick"],gi={class:"card-title"},yi={key:0,class:"card-switch-box"},hi={class:"card-desc"},ki={key:0,class:"card-switch"},eo="qa_document_group_box_width",nt=180,bt=256,bi={__name:"knowledge-document",props:{library_id:{type:[Number,String],default:()=>""}},setup(j){const{setStorage:K}=Vo("localStorage"),oe=so(),{changeGraphSwitch:T}=oe,h=Ho(),W=ve(()=>{var l;return((l=h.companyInfo)==null?void 0:l.neo4j_status)=="true"}),L=ve(()=>{var l;return((l=h.companyInfo)==null?void 0:l.ali_ocr_switch)=="1"}),P=j,w=ve(()=>P.library_id||J.id),b=c(localStorage.getItem("document_group_hide_key")==1),R=c(""),q=c([]),p=c(-1),V=ve(()=>q.value.find(l=>l.id==p.value)||{}),u=ve(()=>q.value.filter(l=>l.group_name.includes(R.value))),S=lo(),Q=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],I=He(),M=Lt(),J=I.query,D=c(!1),G=c(null),x=c(null),_=c(!1),O=c({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});le({selectedRowKeys:[]});const z=le({use_model:"",model_config_id:""}),de=(l,o)=>{let f=o.modelName,Y=o.modelId;xe.value.length>0?ae.confirm({title:`确定切换模型为${f}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){z.use_model=f,z.model_config_id=Y,X()},onCancel(){}}):(z.use_model=f,z.model_config_id=Y,X())},X=(l=!0,o=null)=>{jo({...xt(O.value),use_model:z.use_model,model_config_id:z.model_config_id}).then(()=>{O.value.use_model=z.use_model,O.value.model_config_id=z.model_config_id,typeof o=="function"&&o(),l&&E.success("保存成功")})},B=c([]),be=l=>{B.value=l},k=c([]),we=l=>{k.value=l,Ge()},Ge=()=>{if(!O.value.id){setTimeout(()=>{Ge()},100);return}if(k.value.length>0&&!O.value.use_model){let l=null,o=null;for(let f of k.value)if(f.model_define==="chatwiki"){l=f;for(let Y of l.children)if(Y.name==="text-embedding-v2"){o=Y;break}break}l||(l=k.value[0],o=l.children[0]),l&&(z.use_model=o.name,z.model_config_id=o.model_config_id,X(!1))}},xe=c([]),me=le({learned_err_count:0,learned_count:0,learned_wait_count:0}),A=le({library_id:w.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),qe=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],_e=c([]),We=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"合计",dataIndex:"total_hits",key:"total_hits",width:150,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",width:150,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",width:150,sorter:!0},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],rt=l=>{ie()},_t=(l,o,f)=>{A.page=l.current,A.size=l.pageSize,A.sort_field="",A.sort_type="",f.order&&f.field&&(A.sort_field=f.field,A.sort_type=f.order=="ascend"?"asc":"desc"),Z()},ie=()=>{A.page=1,Z(),Ie()};let Se=!1;const Oe=({id:l})=>{xe.value.length==1&&(Se=!0),Yo({id:l}).then(()=>{Se&&A.page>1&&A.page--,Z(),Ie(),E.success("删除成功")})},fe=(l,o={})=>{let f=I.name;if(l.status=="4"){if(f=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+l.id+"&page="+A.page);return}return M.push({path:"/library/document-segmentation",query:{document_id:l.id,page:A.page}})}if(l.status=="3"&&O.value.type!=2)return E.error("学习失败,不可预览");if(l.status=="0")return E.error("转换中,稍候可预览");if(l.status=="1")return E.error("学习中,不可预览");if(l.status=="6")return E.error("获取中,不可预览");if(l.status=="7")return E.error("获取失败,不可预览");if(l.status=="10")return E.error("正在分段,不可预览");if(f=="libraryConfig"){window.open("/#/library/preview?id="+l.id);return}M.push({name:"libraryPreview",query:{id:l.id,...o}})},Z=()=>{let l=xt(A);l.status==0&&(l.status=""),l.group_id=p.value,D.value=!0,Bo(l).then(o=>{let f=o.data.info;!z.use_model&&z.use_model!=f.use_model&&(z.use_model=f.use_model,z.model_config_id=f.model_config_id),O.value={...f},_.value=f.graph_switch==1,f.graph_switch=="0"||!W.value?_e.value=We.filter(se=>!["graph_status","graph_entity_count"].includes(se.key)):_e.value=We;let Y=o.data.list||[],he=o.data.count_data||{};A.total=o.data.total,me.learned_count=he.learned_count,me.learned_err_count=he.learned_err_count,me.learned_wait_count=he.learned_wait_count;let ee=!1;xe.value=Y.map(se=>(["1","6","0","5"].includes(se.status)&&(ee=!0),se.file_size_str=Ko(se.file_size),se.update_time=Yt(se.update_time*1e3).format("YYYY-MM-DD HH:mm"),se.doc_last_renew_time_desc=se.doc_last_renew_time>0?Yt(se.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",se)),ee&&Ve(),!ee&&clearInterval(Ce.value)}).finally(()=>{D.value=!1})},Ce=c(null),Ve=()=>{clearInterval(Ce.value),Ce.value=setInterval(()=>{Z()},1e3*5)},Te=c(null),Re=l=>{if(k.value.length==0){ae.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){M.push({path:"/user/model"})}});return}let{key:o}=l;o==1&&Ae(),o==2&&ct(),o==3&&Te.value.add()},N=le({open:!1,urls:"",library_id:w.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(l,o)=>jt(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),ct=()=>{N.open=!0,N.confirmLoading=!1,N.urls="",N.doc_auto_renew_minute="02:00",N.doc_auto_renew_frequency=1},C=c(null),d=()=>{C.value.validate().then(()=>{N.confirmLoading=!0,at({library_id:N.library_id,urls:JSON.stringify(jt(N.urls)),doc_auto_renew_frequency:N.doc_auto_renew_frequency,doc_auto_renew_minute:it(N.doc_auto_renew_minute),doc_type:2,group_id:p.value}).then(()=>{N.open=!1,N.confirmLoading=!1,ie()})}).catch(()=>{N.confirmLoading=!1})},ce=()=>{N.open=!1},U=le({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ge=ve(()=>U.fileList.filter(l=>l.type==="application/pdf").length>0),$e=c(null),Ae=()=>{if(O.value.type==2){$e.value.show();return}U.fileList=[],U.open=!0},Qe=()=>{U.fileList=[]},Je=l=>{U.fileList=l},pt=()=>{if(G.value&&!S.getGuideLearningTips&&U.fileList.length>1&&G.value.show(),U.fileList.length==0){E.error("请选择文件");return}U.confirmLoading=!0;let l=new FormData;l.append("library_id",A.library_id),l.append("group_id",p.value||0);let o=!1;U.fileList.forEach(f=>{(f.name.includes(".xlsx")||f.name.includes(".csv"))&&(o=!0),l.append("library_files",f)}),ge.value&&l.append("pdf_parse_type",U.pdf_parse_type),at(l).then(f=>{Z(),U.open=!1,U.fileList=[],U.confirmLoading=!1,o&&f.data.file_ids.length==1&&M.push("/library/document-segmentation?document_id="+f.data.file_ids[0])}).catch(()=>{U.confirmLoading=!1})},pe=c(null),vt=l=>{pe.value.show(l)},mt=l=>{M.push({path:"/library/document-segmentation",query:{document_id:l.id}})},Ye=l=>{Qo({id:l.id}).then(()=>{Z()})},ft=()=>{if(_.value){_.value=!1;let l={graph_model_config_id:O.value.graph_model_config_id,graph_use_model:O.value.graph_use_model};if((!l.graph_model_config_id||!l.graph_use_model)&&B.value.length>0){let f=B.value[0].children[0];l.graph_use_model=f.name,l.graph_model_config_id=f.model_config_id}x.value.show(l)}else O.value.graph_switch=0,X(!1,()=>{Z(),T(0)})},je=l=>{_.value=!0,O.value.graph_switch=1,O.value.graph_model_config_id=l.graph_model_config_id,O.value.graph_use_model=l.graph_use_model,X(!1,()=>{Z(),T(1)})},gt=l=>{if(l.key==4&&!L.value)return!1;U.pdf_parse_type=l.key},g=()=>{window.open("#/user/aliocr")},ye=c(null),Ut=l=>{ye.value.show({...l})},go=l=>{Jo({id:l.id}).then(o=>{E.success("更新成功"),Z()})},yo=l=>{ae.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){Ao({id:l.id}).then(o=>{E.success("取消成功"),Z()})}})},ho=l=>{K("graph:autoOpenFileId",l.id),M.push({path:"/library/details/knowledge-graph",query:{id:w.value}})},ko=l=>{let o=`/manage/downloadLibraryFile?id=${l.id}&token=${S.getToken}`;var f=document.createElement("a");f.href=o,f.style.display="none",f.click()},Mt=()=>{b.value=!b.value,localStorage.setItem("document_group_hide_key",b.value?1:2)},Ie=()=>{$t({library_id:w.value,group_type:1}).then(l=>{let f=(l.data||[]).reduce((Y,he)=>Y+ +he.total,0);q.value=[{group_name:"全部分组",id:-1,total:f},...l.data]})};Ie();const Dt=c(null),Xe=l=>{Dt.value.show({...l,library_id:w.value})},Gt=c(null),bo=l=>{Gt.value.show({...l,sense:1})},Tt=()=>{Ie(),Z()},zt=l=>{p.value=l.id,ie()},Et=l=>{ae.confirm({title:`确认删除分组${l.group_name}`,icon:t(Pe),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){no({id:l.id,sense:1}).then(()=>{E.success("删除成功"),Ie(),p.value==l.id&&(p.value=-1,ie())})}})},ze=c(nt),Ze=c(!1);wt(()=>{const l=parseInt(localStorage.getItem(eo));l&&l>=nt&&l<=bt&&(ze.value=l)});let et=!1,Ft=0,Nt=0;const wo=l=>{b.value||(et=!0,Ze.value=!0,Ft=l.clientX,Nt=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Pt),document.addEventListener("mouseup",Ht))},Pt=l=>{if(!et)return;let o=Nt+(l.clientX-Ft);o=Math.max(nt,Math.min(bt,o)),ze.value=o},Ht=()=>{et&&(et=!1,Ze.value=!1,localStorage.setItem(eo,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",Pt),document.removeEventListener("mouseup",Ht))},xo=l=>l.draggedContext.element.id>0&&l.relatedContext.element.id>0,Co=async()=>{try{const l=q.value.filter(o=>o.id>0).map((o,f)=>({id:o.id,sort:q.value.length-f}));await Wo({library_id:w.value,sense:1,sort_group:JSON.stringify(l)}),E.success("排序已保存")}catch(l){console.error("排序保存失败:",l),Ie()}};return wt(()=>{J.page&&(A.page=+J.page),Z()}),Zo(()=>{Ce.value&&clearInterval(Ce.value)}),(l,o)=>{const f=Ct,Y=qt,he=De,ee=co,se=_o,tt=ro,Bt=to,Kt=St,Le=Ot,Ue=Ke,Wt=Be,$o=vs,Lo=Rt,qo=gs,Ee=ys,Vt=ks,So=uo,Fe=It,At=dt,Qt=ae,Oo=xs,Ro=po,Io=ao("copy");return n(),a("div",fl,[e("div",{class:re(["group-content-box",[{collapsed:b.value},{"no-transition":Ze.value}]]),style:io(b.value?{}:{width:ze.value+"px",minWidth:nt+"px",maxWidth:bt+"px"})},[e("div",gl,[e("div",yl,[t(Y,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Mt},[t(f,{name:"put-away"})])]),_:1}),e("div",hl,[o[17]||(o[17]=e("div",null,"知识分组",-1)),t(Y,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=r=>Xe({}))},[t($(Me))])]),_:1})])]),v("",!0)]),e("div",kl,[t(Bt,{style:{"padding-right":"24px"}},{default:s(()=>[t($(Ss),{modelValue:q.value,"onUpdate:modelValue":o[3]||(o[3]=r=>q.value=r),"item-key":"id",disabled:Ze.value,onEnd:Co,move:xo,handle:".drag-btn"},{item:s(({element:r})=>[e("div",{class:re(["classify-item",{active:r.id==p.value}]),onClick:i=>zt(r)},[r.id>0?(n(),a("span",wl,[t(f,{name:"drag"})])):(n(),a("span",xl)),e("div",Cl,y(r.group_name),1),e("div",$l,[e("div",{class:re(["num",{"num-block":r.id<=0}])},y(r.total),3),r.id>0?(n(),a("div",Ll,[t(tt,{placement:"bottomRight"},{overlay:s(()=>[t(se,null,{default:s(()=>[t(ee,null,{default:s(()=>[e("div",{onClick:ne(i=>Xe(r),["stop"])},"重命名",8,Sl)]),_:2},1024),t(ee,null,{default:s(()=>[e("div",{onClick:ne(i=>Et(r),["stop"])},"删 除",8,Ol)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",ql,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,bl)]),_:1},8,["modelValue","disabled"])]),_:1})]),b.value?v("",!0):(n(),a("div",{key:0,class:"resize-bar",onMousedown:wo},null,32))],6),e("div",Rl,[t(Bt,{scrollbar:!1},{default:s(()=>[e("div",Il,[b.value?(n(),F(Kt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",Ul,[e("div",Ml,[e("div",Dl,[e("div",Gl,[o[18]||(o[18]=e("div",null,"问答分组",-1)),t(Y,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=r=>Xe({}))},[t($(Me))])]),_:1})])]),e("div",Tl,[t(he,{allowClear:"",value:R.value,"onUpdate:value":o[6]||(o[6]=r=>R.value=r),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:o[5]||(o[5]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",zl,[(n(!0),a(H,null,ue(u.value,r=>(n(),a("div",{class:re(["classify-item",{active:r.id==p.value}]),onClick:i=>zt(r),key:r.id},[e("div",Fl,y(r.group_name),1),e("div",Nl,[e("div",{class:re(["num",{"num-block":r.id<=0}])},y(r.total),3),r.id>0?(n(),a("div",Pl,[t(tt,{placement:"bottomRight"},{overlay:s(()=>[t(se,null,{default:s(()=>[t(ee,null,{default:s(()=>[e("div",{onClick:ne(i=>Xe(r),["stop"])},"重命名",8,Bl)]),_:2},1024),t(ee,null,{default:s(()=>[e("div",{onClick:ne(i=>Et(r),["stop"])},"删 除",8,Kl)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Hl,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,El))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Mt},[t(f,{name:"expand"})])]),_:1})):v("",!0),e("div",Wl,y(V.value.group_name),1)]),e("div",Vl,[e("div",Al,[lt(t(Le,{align:"center",class:"tool-item custom-select-box"},{default:s(()=>[o[19]||(o[19]=e("span",null,"嵌入模型：",-1)),t(Xt,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:z.use_model,modeId:z.model_config_id,style:{width:"240px"},onChange:de,onLoaded:we},null,8,["modeName","modeId"])]),_:1,__:[19]},512),[[Jt,!1]])]),e("div",Ql,[O.value.type==0?(n(),a("div",Jl,[e("div",Yl,[o[20]||(o[20]=e("div",{class:"status-label"},"已学习：",-1)),e("div",jl,y(me.learned_count),1)]),e("div",Xl,[o[21]||(o[21]=e("div",{class:"status-label"},"，未学习：",-1)),e("div",Zl,y(me.learned_wait_count),1)]),e("div",ea,[o[22]||(o[22]=e("div",{class:"status-label"},"，学习失败：",-1)),e("div",ta,y(me.learned_err_count),1)])])):v("",!0),O.value.type==0?(n(),a("div",oa,[t(Wt,{value:A.status,"onUpdate:value":o[7]||(o[7]=r=>A.status=r),style:{width:"150px"},placeholder:"请选择",onChange:rt},{default:s(()=>[(n(),a(H,null,ue(qe,r=>t(Ue,{key:r.id,value:r.id},{default:s(()=>[m(y(r.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):v("",!0),e("div",sa,[t(he,{style:{width:"140px"},value:A.file_name,"onUpdate:value":o[8]||(o[8]=r=>A.file_name=r),placeholder:"文档名称搜索",onChange:ie},{suffix:s(()=>[t($(Ne),{onClick:ie,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),W.value?(n(),F(Le,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:s(()=>[lt(t(Xt,{modelType:"LLM",onLoaded:be},null,512),[[Jt,!1]]),o[23]||(o[23]=e("span",null,"生成知识图谱：",-1)),t($o,{checked:_.value,"onUpdate:checked":o[9]||(o[9]=r=>_.value=r),onChange:ft,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[23]})):v("",!0),e("div",na,[t(tt,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:s(()=>[t(se,{onClick:Re},{default:s(()=>[(n(),F(ee,{key:1},{default:s(()=>[e("div",la,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"doc-icon"}),o[24]||(o[24]=e("div",{class:"title"},"本地文档",-1))]),_:1,__:[24]}),O.value.type==2?(n(),a("div",aa," 上传本地 docx/csv/xlsx 等格式文件 ")):(n(),a("div",ia," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),O.value.type!=2?(n(),F(ee,{key:2},{default:s(()=>[e("div",ua,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"link-icon"}),o[25]||(o[25]=e("div",{class:"title"},"在线数据",-1))]),_:1,__:[25]}),o[26]||(o[26]=e("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):v("",!0),(n(),F(ee,{key:3},{default:s(()=>[e("div",da,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"cu-doc-icon"}),o[27]||(o[27]=e("div",{class:"title"},"自定义文档",-1))]),_:1,__:[27]}),o[28]||(o[28]=e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1}))]),_:1})]),default:s(()=>[t(Lo,{type:"primary"},{icon:s(()=>[t($(Me))]),default:s(()=>[o[29]||(o[29]=e("span",null,"添加内容",-1))]),_:1,__:[29]})]),_:1})])])]),O.value.type==0?(n(),F(qs,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:s(()=>o[30]||(o[30]=[e("div",null,[e("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),e("p",null,"2、未学习的文档数据不会被检索到。")],-1)])),_:1,__:[30]})):v("",!0),e("div",ra,[t(So,{columns:_e.value,"data-source":xe.value,scroll:{x:1e3},"row-key":"id",pagination:{current:A.page,total:A.total,pageSize:A.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:_t},{bodyCell:s(({column:r,record:i})=>[r.key==="file_name"?(n(),a("div",_a,[i.doc_type==2?(n(),F(Kt,{key:0,title:null},{content:s(()=>[o[31]||(o[31]=m(" 原链接：")),e("a",{href:i.doc_url,target:"_blank"},y(i.doc_url),9,ca),lt(t($(ms),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Io,`${i.doc_url}`]])]),default:s(()=>[e("a",{onClick:te=>fe(i)},[["5","6","7"].includes(i.status)?(n(),a("span",va,y(i.doc_url),1)):(n(),a("span",ma,y(i.file_name),1))],8,pa)]),_:2},1024)):(n(),a("a",{key:1,onClick:te=>fe(i)},[["5","6","7"].includes(i.status)?(n(),a("span",ga,y(i.doc_url),1)):(n(),a("span",ya,y(i.file_name),1))],8,fa)),i.doc_type==2&&i.remark?(n(),a("div",ha," 备注："+y(i.remark),1)):v("",!0)])):v("",!0),r.key==="graph_entity_count"?(n(),a("a",{key:1,onClick:te=>ho(i)},y(i.graph_entity_count),9,ka)):v("",!0),r.key==="status"?(n(),a(H,{key:2},[i.file_ext=="pdf"&&i.pdf_parse_type>=2?(n(),a(H,{key:0},[i.status==0?(n(),a("div",ba,[e("div",wa,[e("span",xa,[t($(fs)),o[32]||(o[32]=m("文档解析中"))]),e("a",{onClick:te=>yo(i)},"取消",8,Ca)]),e("div",$a,[t(qo,{size:"small",class:"progress-bar-box",percent:parseInt(i.ocr_pdf_index/i.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",La,y(i.ocr_pdf_index)+" / "+y(i.ocr_pdf_total),1)])])):v("",!0)],64)):(n(),a(H,{key:1},[i.status==0?(n(),a("span",qa,[t(Ee,{size:"small"}),o[33]||(o[33]=m(" 转换中"))])):v("",!0)],64)),i.status==1?(n(),a("span",Sa,[t(Ee,{size:"small"}),o[34]||(o[34]=m(" 学习中"))])):v("",!0),i.status==2?(n(),a("span",Oa,[t($(yt)),o[35]||(o[35]=m(" 学习完成"))])):v("",!0),i.status==3?(n(),F(Y,{key:4,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Ra,[t($(ot)),o[36]||(o[36]=m(" 转换失败"))]),O.value.type==2?(n(),a("a",{key:0,class:"ml8",onClick:te=>fe(i)},"学习",8,Ia)):v("",!0)])]),_:2},1024)):v("",!0),i.status==8?(n(),F(Y,{key:5,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Ua,[t($(ot)),o[37]||(o[37]=m(" 转化异常"))])])]),_:2},1024)):v("",!0),i.status==4?(n(),a(H,{key:6},[e("span",Ma,[t($(ht)),o[38]||(o[38]=m(" 待学习"))]),e("a",{class:"ml8",onClick:te=>fe(i)},"学习",8,Da)],64)):v("",!0),i.status==5?(n(),a("span",Ga,[t($(ht)),o[39]||(o[39]=m(" 待获取"))])):v("",!0),i.status==6?(n(),a("span",Ta,[t(Ee,{size:"small"}),o[40]||(o[40]=m(" 获取中"))])):v("",!0),i.status==7?(n(),F(Y,{key:9,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",za,[t($(ot)),o[41]||(o[41]=m(" 获取失败"))])]),_:2},1024)):v("",!0),i.status==9?(n(),a("span",Ea,[t($(Pe)),o[42]||(o[42]=m(" 取消解析"))])):v("",!0),i.status==10?(n(),a("span",Fa,[t(Ee,{size:"small"}),o[43]||(o[43]=m(" 正在分段 "))])):v("",!0)],64)):v("",!0),r.key==="graph_status"?(n(),a(H,{key:3},[i.graph_status==0?(n(),a(H,{key:0},[e("span",Na,[t($(ht)),o[44]||(o[44]=m(" 待生成"))]),e("a",{class:"ml8",onClick:te=>Ye(i)},"生成",8,Pa)],64)):i.graph_status==1?(n(),a("span",Ha,[t($(hs)),o[45]||(o[45]=m(" 排队中"))])):i.graph_status==2?(n(),a("span",Ba,[t($(yt)),o[46]||(o[46]=m(" 生成完成"))])):i.graph_status==3?(n(),a(H,{key:3},[e("span",Ka,[t($(ot)),o[47]||(o[47]=m(" 生成失败"))]),e("a",{class:"ml8",onClick:te=>Ye(i)},"生成",8,Wa),i.graph_err_msg?(n(),F(Y,{key:0,title:i.graph_err_msg},{default:s(()=>[e("div",Va,"原因："+y(i.graph_err_msg),1)]),_:2},1032,["title"])):v("",!0)],64)):i.graph_status==4?(n(),a("span",Aa,[t(Ee,{size:"small"}),o[48]||(o[48]=m(" 生成中"))])):i.graph_status==5?(n(),a(H,{key:5},[e("span",Qa,[t($(yt)),o[49]||(o[49]=m(" 部分成功"))]),e("div",Ja,[m(" 失败数："+y(i.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:te=>fe(i,{graph_status:3})},"详情",8,Ya)])],64)):v("",!0)],64)):v("",!0),r.key==="file_size"?(n(),a(H,{key:4},[i.doc_type==3?(n(),a("span",ja,"-")):(n(),a("span",Xa,y(i.file_size_str),1))],64)):v("",!0),r.key==="doc_auto_renew_frequency"?(n(),a(H,{key:5},[i.doc_type==2?(n(),a("div",Za,[e("div",ei,[i.doc_auto_renew_frequency==1?(n(),a("span",ti,"不自动更新")):v("",!0),i.doc_auto_renew_frequency==2?(n(),a("span",oi,"每天")):v("",!0),i.doc_auto_renew_frequency==3?(n(),a("span",si,"每3天")):v("",!0),i.doc_auto_renew_frequency==4?(n(),a("span",ni,"每7天")):v("",!0),i.doc_auto_renew_frequency==5?(n(),a("span",li,"每30天")):v("",!0),i.doc_auto_renew_frequency>1&&i.doc_auto_renew_minute>0?(n(),a("span",ai,y($(it)(i.doc_auto_renew_minute)),1)):v("",!0),i.doc_auto_renew_frequency>1?(n(),a("span",ii,"更新")):v("",!0),e("a",{class:"ml4 btn-hover-block",onClick:te=>Ut(i)},"修改",8,ui)]),t(Le,{align:"center"},{default:s(()=>[m(" 最近更新: "+y(i.doc_last_renew_time_desc)+" ",1),t(Vt,{title:"确认更新?",onConfirm:te=>go(i)},{default:s(()=>o[50]||(o[50]=[e("a",{class:"ml4 btn-hover-block"},"更新",-1)])),_:2,__:[50]},1032,["onConfirm"])]),_:2},1024)])):(n(),a("div",di,"--"))],64)):v("",!0),r.key==="paragraph_count"?(n(),a(H,{key:6},[i.status==0||i.status==1?(n(),a("span",ri,"-")):(n(),a("span",_i,y(i.paragraph_count),1))],64)):v("",!0),r.key==="action"?(n(),F(Le,{key:7,gap:8},{default:s(()=>[t(Y,null,{title:s(()=>o[51]||(o[51]=[m("重新分段")])),default:s(()=>[t($(bs),{class:"btn-hover-block",onClick:te=>mt(i)},null,8,["onClick"])]),_:2},1024),t(tt,null,{overlay:s(()=>[t(se,null,{default:s(()=>[i.doc_type==2?(n(),F(ee,{key:0},{default:s(()=>[e("div",{onClick:te=>Ut(i)},"编辑",8,ci)]),_:2},1024)):v("",!0),t(ee,{disabled:i.status==6||i.status==7||i.status==0},{default:s(()=>[e("div",{onClick:te=>fe(i)},"预览",8,pi)]),_:2},1032,["disabled"]),t(ee,{onClick:te=>vt(i)},{default:s(()=>o[52]||(o[52]=[e("div",null,"重命名",-1)])),_:2,__:[52]},1032,["onClick"]),t(Vt,{title:"确定要删除吗?",onConfirm:te=>Oe(i)},{default:s(()=>[t(ee,null,{default:s(()=>o[53]||(o[53]=[e("span",null,"删除",-1)])),_:1,__:[53]})]),_:2},1032,["onConfirm"]),t(ee,{onClick:te=>bo(i)},{default:s(()=>o[54]||(o[54]=[e("div",null,"修改分组",-1)])),_:2,__:[54]},1032,["onClick"]),t(ee,{onClick:te=>ko(i)},{default:s(()=>o[55]||(o[55]=[e("div",null,"下载文档",-1)])),_:2,__:[55]},1032,["onClick"])]),_:2},1024)]),default:s(()=>[e("div",{class:"table-btn",onClick:o[10]||(o[10]=ne(()=>{},["prevent"]))},[t($(ws),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),t(Qt,{open:U.open,"onUpdate:open":o[12]||(o[12]=r=>U.open=r),"confirm-loading":U.confirmLoading,maskClosable:!1,title:"上传文档",onOk:pt,onCancel:Qe,width:"740px"},{default:s(()=>[t(At,{class:"mt24"},{default:s(()=>[t(Fe,{required:"",label:""},{default:s(()=>[e("div",vi,[t(vo,{type:O.value.type,maxCount:20,value:U.fileList,"onUpdate:value":o[11]||(o[11]=r=>U.fileList=r),onChange:Je},null,8,["type","value"])])]),_:1}),ge.value?(n(),F(Fe,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:s(()=>[e("div",mi,[(n(),a(H,null,ue(Q,r=>e("div",{key:r.key,class:re(["select-card-item",{active:U.pdf_parse_type==r.key},{disabled:r.key==4&&!L.value}]),onClick:ne(i=>gt(r),["stop"])},[t(f,{class:"check-arrow",name:"check-arrow-filled"}),e("div",gi,[t(f,{name:r.icon,style:{"font-size":"16px"}},null,8,["name"]),m(" "+y(r.title)+" ",1),r.key==4&&!L.value?(n(),a("div",yi,"未开启")):v("",!0)]),e("div",hi,y(r.desc),1),r.key==4&&!L.value?(n(),a("div",ki,[o[56]||(o[56]=m(" 未开启阿里云OCR ")),e("div",{class:"card-switch-btn",onClick:ne(g,["stop"])},"去开启")])):v("",!0)],10,fi)),64))])]),_:1})):v("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(mo,{onOk:Z,ref_key:"qaUploadModalRef",ref:$e},null,512),t(Qt,{open:N.open,"onUpdate:open":o[16]||(o[16]=r=>N.open=r),"confirm-loading":N.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:d,onCancel:ce},{default:s(()=>[t(At,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:C,model:N,rules:N.rules},{default:s(()=>[t(Fe,{name:"urls",label:"网页链接"},{default:s(()=>[t(Oo,{style:{height:"120px"},value:N.urls,"onUpdate:value":o[13]||(o[13]=r=>N.urls=r),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(Fe,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:s(()=>[t(Wt,{value:N.doc_auto_renew_frequency,"onUpdate:value":o[14]||(o[14]=r=>N.doc_auto_renew_frequency=r),style:{width:"100%"}},{default:s(()=>[t(Ue,{value:1},{default:s(()=>o[57]||(o[57]=[m("不自动更新")])),_:1,__:[57]}),t(Ue,{value:2},{default:s(()=>o[58]||(o[58]=[m("每天")])),_:1,__:[58]}),t(Ue,{value:3},{default:s(()=>o[59]||(o[59]=[m("每3天")])),_:1,__:[59]}),t(Ue,{value:4},{default:s(()=>o[60]||(o[60]=[m("每7天")])),_:1,__:[60]}),t(Ue,{value:5},{default:s(()=>o[61]||(o[61]=[m("每30天")])),_:1,__:[61]})]),_:1},8,["value"])]),_:1}),N.doc_auto_renew_frequency>1?(n(),F(Fe,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(Ro,{valueFormat:"HH:mm",value:N.doc_auto_renew_minute,"onUpdate:value":o[15]||(o[15]=r=>N.doc_auto_renew_minute=r),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t(nl,{libraryInfo:O.value,group_id:p.value,onOk:ie,ref_key:"addCustomDocumentRef",ref:Te},null,8,["libraryInfo","group_id"]),t(Ls,{onOk:ie,ref_key:"renameModalRef",ref:pe},null,512),t($s,{onOk:je,ref_key:"openGrapgModalRef",ref:x},null,512),t(rl,{ref_key:"guideLearningTipsRef",ref:G},null,512),t(_l,{onOk:Z,ref_key:"editOnlineDocRef",ref:ye},null,512),t(fo,{group_type:"1",ref_key:"addGroupRef",ref:Dt,onOk:Tt},null,512),t(ml,{libraryId:w.value,sense:1,ref_key:"editGroupRef",ref:Gt,onOk:Tt},null,8,["libraryId"])])}}},Gi=ke(bi,[["__scopeId","data-v-a6cc0e2e"]]);export{Gi as K,Di as Q};
