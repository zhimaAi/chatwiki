{"version":3,"file":"index-zg96EuqO.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/skill-config/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.user-model-page {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #f2f4f7;\r\n  display: flex;\r\n  flex-direction: column;\r\n  overflow: hidden;\r\n  .page-title {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 24px;\r\n    padding: 16px;\r\n    background-color: #fff;\r\n    color: #000000;\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n  }\r\n\r\n  .list-wrapper {\r\n    background: #fff;\r\n    flex: 1;\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n  }\r\n  .content-wrapper {\r\n    padding: 16px;\r\n    padding-top: 0;\r\n  }\r\n  .actions-box {\r\n    margin: 16px 0;\r\n    display: flex;\r\n  }\r\n  .avatar-box {\r\n    display: flex;\r\n    align-items: center;\r\n    flex-wrap: wrap;\r\n    gap: 8px;\r\n    img {\r\n      width: 32px;\r\n      height: 32px;\r\n    }\r\n  }\r\n\r\n  .status-block{\r\n    display: flex;\r\n    gap: 4px;\r\n    align-items: center;\r\n    color: #8c8c8c;\r\n    span{\r\n      width: 8px;\r\n      height: 8px;\r\n      border-radius: 8px;\r\n      display: block;\r\n      background: #8c8c8c;\r\n    }\r\n    &.success{\r\n      color: #52C41A;\r\n      span{\r\n        background: #52C41A;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"user-model-page\">\r\n    <div class=\"page-title\">{{ t('title_workflow') }}</div>\r\n    <div class=\"list-wrapper\">\r\n      <div class=\"content-wrapper\">\r\n        <a-alert show-icon style=\"align-items: baseline\">\r\n          <template #message>\r\n            <div>\r\n              {{ t('msg_workflow_tip_1') }}\r\n            </div>\r\n            <div>{{ t('msg_workflow_tip_2') }}</div>\r\n          </template>\r\n        </a-alert>\r\n        <div class=\"actions-box\">\r\n          <a-button type=\"primary\" :icon=\"h(PlusOutlined)\" @click=\"handleOpenSelectLibraryAlert\"\r\n            >{{ t('btn_add_skill') }}</a-button\r\n          >\r\n        </div>\r\n        <a-table :data-source=\"selectedLibraryRows\">\r\n          <a-table-column key=\"robot_name\" :title=\"t('col_workflow')\">\r\n            <template #default=\"{ record }\">\r\n              <div class=\"avatar-box\">\r\n                <img :src=\"record.robot_avatar\" alt=\"\" />\r\n                <div>{{ record.robot_name }}</div>\r\n              </div>\r\n            </template>\r\n          </a-table-column>\r\n          <a-table-column key=\"robot_intro\" data-index=\"robot_intro\" :title=\"t('col_workflow_desc')\" >\r\n            <template #default=\"{ record }\">\r\n              {{ record.robot_intro || '--' }}\r\n            </template>\r\n          </a-table-column>\r\n          <a-table-column key=\"start_node_key\" :title=\"t('col_status')\">\r\n            <template #default=\"{ record }\">\r\n              <div v-if=\"!record.start_node_key\" class=\"status-block\"><span></span>{{ t('status_unpublished') }}</div>\r\n              <div v-else class=\"status-block success\"><span></span>{{ t('status_published') }}</div>\r\n            </template>\r\n          </a-table-column>\r\n          <a-table-column key=\"start_node_key\" :title=\"t('col_actions')\">\r\n            <template #default=\"{ record }\">\r\n              <a @click=\"handleRemoveCheckedLibrary(record)\">{{ t('action_remove') }}</a>\r\n            </template>\r\n          </a-table-column>\r\n        </a-table>\r\n      </div>\r\n    </div>\r\n    <RobotSelectAlert ref=\"robotSelectAlertRef\" @change=\"onChangeLibrarySelected\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { getRobotList, relationWorkFlow } from '@/api/robot/index.js'\r\nimport { storeToRefs } from 'pinia'\r\nimport { useRoute } from 'vue-router'\r\nimport { CloseCircleOutlined, PlusOutlined } from '@ant-design/icons-vue'\r\nimport RobotSelectAlert from '../basic-config/components/skill/robot-select-alert.vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { useRobotStore } from '@/stores/modules/robot'\r\nimport { reactive, ref, computed, watchEffect, toRaw, h } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.skill-config.index')\r\nconst query = useRoute().query\r\nconst robotStore = useRobotStore()\r\n\r\nconst { robotInfo } = storeToRefs(robotStore)\r\nconst { getRobot } = robotStore\r\n\r\nconst robotList = ref([])\r\n\r\nconst formState = reactive({\r\n  work_flow_ids: []\r\n})\r\n\r\n// 知识库\r\nconst robotSelectAlertRef = ref(null)\r\nconst selectedLibraryRows = computed(() => {\r\n  return robotList.value.filter((item) => {\r\n    return formState.work_flow_ids.includes(item.id)\r\n  })\r\n})\r\n\r\n// 移除知识库\r\nconst handleRemoveCheckedLibrary = (item) => {\r\n  let index = formState.work_flow_ids.indexOf(item.id)\r\n\r\n  formState.work_flow_ids.splice(index, 1)\r\n\r\n  onSave()\r\n}\r\n\r\nconst onChangeLibrarySelected = (checkedList) => {\r\n  formState.work_flow_ids = [...checkedList]\r\n\r\n  onSave()\r\n}\r\n\r\nconst handleOpenSelectLibraryAlert = () => {\r\n  robotSelectAlertRef.value.open([...formState.work_flow_ids])\r\n}\r\n\r\nconst onSave = () => {\r\n  let formData = { ...toRaw(formState) }\r\n\r\n  formData.work_flow_ids = formData.work_flow_ids.join(',')\r\n\r\n  relationWorkFlow({\r\n    id: query.id,\r\n    ...formData\r\n  }).then((res) => {\r\n    message.success(t('msg_save_success'))\r\n    getRobot(query.id)\r\n  })\r\n}\r\n\r\nfunction getRobotData() {\r\n  getRobotList().then((res) => {\r\n    robotList.value = res.data || []\r\n  })\r\n}\r\n\r\ngetRobotData()\r\n\r\nwatchEffect(() => {\r\n  formState.work_flow_ids = robotInfo.value.work_flow_ids.split(',')\r\n})\r\n</script>\r\n"],"names":["useI18n","query","useRoute","robotStore","useRobotStore","robotInfo","storeToRefs","getRobot","robotList","ref","formState","reactive","robotSelectAlertRef","selectedLibraryRows","computed","item","handleRemoveCheckedLibrary","index","onSave","onChangeLibrarySelected","checkedList","handleOpenSelectLibraryAlert","formData","toRaw","relationWorkFlow","res","message","getRobotData","getRobotList","watchEffect","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","_unref","_hoisted_3","_hoisted_4","_createVNode","_component_a_alert","_hoisted_5","_component_a_button","h","PlusOutlined","_component_a_table","_component_a_table_column","_withCtx","record","_hoisted_6","_createTextVNode","_hoisted_9","_hoisted_8","$event","_hoisted_10","RobotSelectAlert"],"mappings":"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"}