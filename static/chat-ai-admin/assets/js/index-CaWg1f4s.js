var $E=Object.defineProperty;var FE=(r,e,t)=>e in r?$E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ag=(r,e,t)=>FE(r,typeof e!="symbol"?e+"":e,t);import{b as pt,d as ni,aj as Pl,F as Th,aa as Fy,ak as zE,al as WE,ag as UE,ah as VE}from"../../index-0SFcfYGN.js";import{h as zy}from"./index-B3eanVnA.js";import{m as XE,w as GE,n as YE,o as Wy,p as sg,q as qE,t as lg}from"./index-B4oOBcCh.js";import{u as ri}from"./robot-DwqmFfQP.js";import{e as Kt,ab as Rl,f as Ce,o as Xt,Y as se,_ as Y,ae as Qe,a5 as E,k as B,a2 as V,G as He,a7 as De,F as it,a9 as ft,ad as wn,a1 as Fe,aa as Uy,n as as,A as ss,u as je,j as Ei,B as dn,a3 as za,c as wt,af as kn,a6 as Si,E as Vy,r as Vt,w as qt,y as _n,X as KE,J as zi,l as Dn,K as ls,d as us,s as JE,g as ZE,a4 as QE,ah as Xy,aj as Yd,p as zo,am as eC,m as tC,a8 as qd,ag as Il,b as nC}from"./vue-chunks-BSjLwu6d.js";import{p as Ci,a4 as rC,g as ds,ay as ug,a8 as iC,z as Rn,B as In,aD as Gy,I as Sr,b as Dh,c as Lh,D as Ph,au as oC,ab as Yn,M as ii,F as Oi,e as Wi,u as Pr,v as Rr,X as oa,Q as Kd,ar as Jd,aE as aa,aB as Bl,O as Ui,K as cs,E as fs,aA as aC,aF as Rh,y as Yy,q as qy,R as Ky,T as sC,av as lC,ah as Jy,ad as uC,ag as dC,a as no,aC as cC,ap as cr,ai as fC,aG as hs,a9 as Zy,aH as Qy,a7 as hC,aI as pC,aJ as Qt,aK as Lt,aL as Wa,aM as jl,aN as lf,aO as Ia,aP as on,aQ as Co,aR as ro,aS as ta,aT as Ua,aU as br,s as vC,aV as gC,aW as If,aX as Bf,aY as mC,aZ as e_,a_ as yC,a$ as _C,b0 as dg,b1 as bC,b2 as t_,b3 as n_,b4 as xC,b5 as r_,b6 as wC,b7 as nl,ao as i_,ac as o_,b8 as SC,b9 as EC,ba as CC,a3 as OC,bb as kC,an as NC,aw as MC,d as a_}from"./ui-antd-BIopZvX3.js";import{u as AC}from"./global-BjRUvN9c.js";import{_ as TC}from"./empty-BFmzY9bl.js";import{g as DC,a as LC,b as PC,_ as s_,c as l_,d as u_,e as d_,f as c_,h as f_,i as h_,j as p_,k as v_,l as g_,m as m_,n as y_,o as __,p as b_,q as x_,r as w_,s as S_,t as E_,u as C_,v as O_,w as k_,x as N_,y as M_,z as A_,A as T_,B as D_,C as L_,D as P_,E as R_,F as I_,G as B_,H as j_,I as H_,J as $_,K as F_,L as z_,M as W_,N as U_,O as V_,P as X_,Q as G_,R as Y_,S as q_,T as K_,U as J_,V as Z_,W as Q_,X as e0,Y as t0,Z as n0,$ as r0,a0 as i0,a1 as o0,a2 as a0,a3 as s0,a4 as l0,a5 as u0,a6 as d0,a7 as c0,a8 as f0,a9 as h0,aa as p0,ab as v0,ac as g0,ad as m0,ae as y0,af as _0,ag as b0,ah as x0,ai as w0,aj as S0,ak as E0,al as C0,am as O0,an as k0,ao as N0,ap as M0,aq as A0,ar as T0,as as D0,at as L0,au as P0,av as R0,aw as I0,ax as B0,ay as j0,az as H0,aA as $0,aB as F0,aC as z0,aD as W0,aE as U0,aF as V0,aG as X0,aH as G0,aI as Y0,aJ as q0,aK as K0,aL as J0,aM as Z0,aN as Q0,aO as eb,aP as tb,aQ as nb,aR as rb,aS as ib,aT as ob,aU as ab,aV as sb,aW as lb,aX as ub,aY as db,aZ as cb,a_ as fb,a$ as hb,b0 as pb,b1 as vb,b2 as gb,b3 as mb,b4 as yb,b5 as _b,b6 as bb,b7 as xb,b8 as wb,b9 as Sb,ba as Eb,bb as Cb,bc as Ob,bd as kb,be as Nb,bf as Mb,bg as Ab,bh as Tb,bi as Db,bj as Lb,bk as Pb,bl as Rb,bm as Ib,bn as Bb,bo as jb,bp as Hb,bq as $b,br as Fb,bs as zb,bt as Wb,bu as Ub,bv as Vb,bw as Xb,bx as Gb,by as Yb,bz as qb,bA as Kb,bB as Jb,bC as Zb,bD as Qb,bE as ex,bF as tx,bG as nx,bH as rx,bI as ix,bJ as ox,bK as ax,bL as sx,bM as lx,bN as ux,bO as dx,bP as cx,bQ as fx,bR as hx,bS as px,bT as vx,bU as gx,bV as mx,bW as yx,bX as _x,bY as bx,bZ as xx,b_ as wx,b$ as Sx,c0 as Ex,c1 as Cx,c2 as Ox,c3 as kx,c4 as Nx,c5 as Mx,c6 as Ax,c7 as Tx,c8 as Dx,c9 as Lx,ca as Px,cb as Rx,cc as Ix,cd as Bx,ce as jx,cf as Hx,cg as $x,ch as Fx,ci as zx,cj as Wx,ck as Ux,cl as Vx,cm as ps,cn as RC,co as IC,cp as BC,cq as jC,cr as HC}from"./styles-DcCBvrW-.js";import{M as Zd}from"./model-select-BMElW6Zs.js";import{_ as Xx}from"./index-CZhJIxhy.js";import{_ as Ih}from"./empty-CzGZrENG.js";import{a as $C,g as FC}from"./index-O362J1Hf.js";import{d as zC}from"./vuedraggable.umd-CLoFUBnR.js";import{g as Gx}from"./thirdMcp-D1EqHd4C.js";import{T as WC}from"./top-header-0GRPYDnM.js";import{a as UC}from"./add-group-CvrKwfP2.js";import"./utils-BMKRjDTh.js";import"./cu-scroll-BiKEilFP.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const VC={key:0,class:"sidebar-handle-wrapper"},XC={class:"sidebar-container"},GC={class:"sidebar-menus"},YC=["onClick"],qC={class:"menu-name"},KC={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(r){const e=AC(),t=Uy(),n=Rl(),i=Kt(()=>n.path.split("/")[3]),o=Ce(!0),s=Ce(!0);function l(){o.value=!o.value,s.value=!1,e.setHideLayoutTopAndBottom(o.value)}const d=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"未知问题",value:"unknown_issue",path:"/robot/config/unknown_issue",iconName:"unknown-issue"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],c=f=>{if(f.isNewWindowOpen){window.open(`/#${f.path}?robot_key=${n.query.robot_key}&id=${n.query.id}`);return}t.push({path:f.path,query:n.query})};return Xt(()=>{setTimeout(()=>{s.value=!1},3e3)}),(f,v)=>{const g=Ci,y=ni;return Y(),se("div",{class:wn(["sidebar-wrapper",{"is-hide":o.value}])},[r.showSidebarBtn?(Y(),se("div",VC,[B(g,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:s.value,"onUpdate:open":v[0]||(v[0]=b=>s.value=b),arrow:!1},{title:V(()=>[He(De(o.value?"展开":"收起"),1)]),default:V(()=>[E("span",{class:"sidebar-handle",onClick:l},v[1]||(v[1]=[E("span",{class:"handle-line handle-line01"},null,-1),E("span",{class:"handle-line handle-line02"},null,-1)]))]),_:1},8,["open"])])):Qe("",!0),E("div",XC,[E("div",GC,[(Y(),se(it,null,ft(d,b=>E("div",{class:wn(["sidebar-menu",{active:i.value==b.value}]),key:b.value,onClick:_=>c(b)},[o.value?(Y(),Fe(g,{key:0,placement:"bottom"},{title:V(()=>[E("span",null,De(b.label),1)]),default:V(()=>[B(y,{name:b.iconName,class:"menu-icon",size:"16"},null,8,["name"])]),_:2},1024)):(Y(),Fe(y,{key:1,name:b.iconName,class:"menu-icon",size:"16"},null,8,["name"])),E("span",qC,De(b.label),1)],10,YC)),64))])])],2)}}},JC=pt(KC,[["__scopeId","data-v-70985664"]]),ZC={name:"NodeCommon",props:{title:{type:String,default:""}},data(){return{isShowMenu:!1,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("change",r)},showMenu(){this.isShowMenu=!this.isShowMenu},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(r.target)&&r.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},QC={class:"zoom-select"},eO={class:"zoom-select-options"},tO=["onClick"];function nO(r,e,t,n,i,o){return Y(),se("div",QC,[E("div",{class:"zoom-select-label",onClick:e[0]||(e[0]=(...s)=>o.showMenu&&o.showMenu(...s))},De(t.title),1),as(E("div",eO,[(Y(!0),se(it,null,ft(i.menus,s=>(Y(),se("div",{class:"zoom-select-option",key:s.value,onClick:l=>o.handleMenu(s)},De(s.label),9,tO))),128)),e[2]||(e[2]=E("div",{class:"option-line"},null,-1)),E("div",{class:"zoom-select-option",onClick:e[1]||(e[1]=s=>o.handleMenu({label:"5%",value:5}))},"全览")],512),[[ss,i.isShowMenu]])])}const rO=pt(ZC,[["render",nO],["__scopeId","data-v-de91327a"]]),iO={class:"node-list-popup"},oO={class:"tabs-box"},aO={class:"node-list-popup-content"},sO={key:0,class:"node-list"},lO={class:"node-type"},uO={class:"node-flex-box"},dO=["onClick"],cO=["src","alt"],fO={class:"node-name"},hO={key:1,class:"mcp-box"},pO={class:"search-box"},vO={key:0,class:"mcp-list"},gO={class:"mcp-info-pop"},mO={class:"info"},yO=["src"],_O={class:"name"},bO={class:"extra"},xO=["onClick"],wO=["src"],SO={class:"info"},EO={class:"name"},CO={class:"total"},OO={class:"mcp-tools"},kO={class:"params-box"},NO={class:"param-item"},MO={class:"field"},AO={class:"name"},TO={class:"desc"},DO={class:"field"},LO={class:"name"},PO={class:"type"},RO={key:0,class:"required"},IO={class:"desc"},BO=["onClick"],jO={key:1,class:"empty-box"},HO={__name:"node-list-popup",props:{type:{type:String,default:""}},emits:["addNode"],setup(r,{emit:e}){const t=e,i=DC(r.type),o=Ce([]),s=Ce(1),l=Ce("");Xt(()=>{LC().then(b=>{o.value=b})});const d=Kt(()=>l.value?o.value.filter(b=>(b.description+b.name).indexOf(l.value)>-1):o.value);let c={};const f=b=>{b=JSON.parse(JSON.stringify(b)),b.id=Pl(b.type),c[b.type]?(c[b.type]=c[b.type]+1,b.properties.node_name=b.properties.node_name+c[b.type]):c[b.type]=1,t("addNode",b)},v=(b,_)=>{f(PC(b,_))};function g(b){s.value=b}function y(){window.open("/#/robot/list?active=3&mcp=2","_blank")}return(b,_)=>{const x=ni,w=rC,C=iC;return Y(),se("div",iO,[E("div",oO,[E("div",{class:wn(["tab-item",{active:s.value==1}]),onClick:_[0]||(_[0]=k=>g(1))},[B(x,{name:"base-node-type"}),_[3]||(_[3]=He(" 基础功能"))],2),E("div",{class:wn(["tab-item",{active:s.value==2}]),onClick:_[1]||(_[1]=k=>g(2))},[B(x,{name:"mcp-node-type"}),_[4]||(_[4]=He(" MCP"))],2)]),E("div",aO,[s.value==1?(Y(!0),se(it,{key:0},ft(je(i),k=>(Y(),se(it,{key:k.key},[k.hidden?Qe("",!0):(Y(),se("div",sO,[E("div",lO,De(k.name),1),E("div",uO,[(Y(!0),se(it,null,ft(k.nodes,D=>(Y(),se(it,{key:D.type},[D.hidden?Qe("",!0):(Y(),se("div",{key:0,class:"node-item",onClick:I=>f(D)},[E("img",{src:D.properties.node_icon,alt:D.properties.node_name},null,8,cO),E("div",fO,De(D.properties.node_name),1)],8,dO))],64))),128))])]))],64))),128)):(Y(),se("div",hO,[E("div",pO,[B(w,{value:l.value,"onUpdate:value":_[2]||(_[2]=k=>l.value=k),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),d.value.length?(Y(),se("div",vO,[(Y(!0),se(it,null,ft(d.value,(k,D)=>(Y(),se("div",{key:D,class:"mcp-item"},[B(C,{placement:"right"},{content:V(()=>[E("div",gO,[E("div",mO,[E("img",{class:"avatar",src:k.avatar},null,8,yO),E("div",_O,De(k.name),1)]),E("div",null,De(k.url),1),E("div",bO,"可用工具："+De(k.tools.length),1)])]),default:V(()=>[E("div",{class:"mcp-info",onClick:I=>k.expand=!k.expand},[E("img",{class:"avatar",src:k.avatar},null,8,wO),E("div",SO,[E("span",EO,De(k.name),1),E("span",CO,[He(De(k.tools.length)+" ",1),k.expand?(Y(),Fe(je(ds),{key:0})):(Y(),Fe(je(ug),{key:1}))])])],8,xO)]),_:2},1024),as(E("div",OO,[(Y(!0),se(it,null,ft(k.tools,(I,$)=>(Y(),Fe(C,{key:$,placement:"right"},{content:V(()=>[E("div",kO,[E("div",NO,[E("div",MO,[E("span",AO,De(I.name),1)]),E("div",TO,De(I.description),1)]),(Y(!0),se(it,null,ft(I.inputSchema.properties,(R,F)=>(Y(),se("div",{key:F,class:"param-item"},[E("div",DO,[E("span",LO,De(F),1),E("span",PO,De(R.type),1),I.inputSchema.required.includes(F)?(Y(),se("span",RO,"必填")):Qe("",!0)]),E("div",IO,De(R.description),1)]))),128))])]),default:V(()=>[E("div",{class:"mcp-tool-item",onClick:R=>v(k,I)},De(I.name),9,BO)]),_:2},1024))),128))],512),[[ss,k.expand]])]))),128))])):(Y(),se("div",jO,[_[6]||(_[6]=E("img",{style:{height:"200px"},src:TC},null,-1)),_[7]||(_[7]=E("div",null,"暂无可用MCP插件",-1)),E("a",{onClick:y},[_[5]||(_[5]=He("去添加")),B(je(ug))])]))]))])])}}},Yx=pt(HO,[["__scopeId","data-v-3e1b5aa1"]]),$O={class:"custom-control-warpper"},FO={class:"custom-control-body"},zO={class:"custom-control"},WO={class:"control-item zoom-control"},UO={class:"control-item"},VO={class:"control-item"},XO={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode"],setup(r,{emit:e}){const t=e,n=r,{eventCenter:i}=n.lf.graphModel,o=Ce(100),s=()=>{n.lf.zoom(o.value/100)},l=Ce("100%"),d=({label:w,value:C})=>{l.value=w,o.value=C,s()},c=()=>{let w=o.value=Math.floor(o.value/2);w<1&&(w=1),o.value=w,l.value=`${w}%`,s()},f=()=>{let w=o.value*2;w>800&&(w=800),o.value=w,l.value=`${w}%`,s()},v=Ce(!1),g=Ce(null),y=w=>{let C=Math.floor(w.transform.SCALE_X*100);o.value=C,l.value=`${C}%`},b=()=>{t("runTest")},_=w=>{v.value&&(g.value.contains(w.target)||(v.value=!1))},x=w=>{t("addNode",w),v.value=!1};return Xt(()=>{document.addEventListener("click",_),i.on("graph:transform",y)}),Ei(()=>{document.removeEventListener("click",_),i.off("graph:transform",y)}),(w,C)=>{const k=ni,D=In;return Y(),se("div",$O,[E("div",FO,[E("div",zO,[E("div",WO,[E("div",{class:"action-btn zoom-btn",onClick:c},[B(k,{name:"minus",size:"16"})]),B(rO,{title:l.value,onChange:d},null,8,["title"]),E("div",{class:"action-btn zoom-btn",onClick:f},[B(k,{name:"plus",size:"16"})])]),C[3]||(C[3]=E("i",{class:"control-line"},null,-1)),E("div",UO,[B(D,{type:"primary",onClick:C[0]||(C[0]=dn(I=>v.value=!0,["stop"]))},{icon:V(()=>[B(je(Rn))]),default:V(()=>[C[1]||(C[1]=E("span",null,"新建节点",-1))]),_:1,__:[1]})]),E("div",VO,[B(D,{onClick:b,style:{"background-color":"#00ad3a"},type:"primary"},{default:V(()=>[B(je(Gy)),C[2]||(C[2]=He("运行测试"))]),_:1,__:[2]})])]),as(E("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:g},[B(Yx,{onAddNode:x,type:"float-btn"})],512),[[ss,v.value]])])])}}},GO=pt(XO,[["__scopeId","data-v-1e113eb2"]]),YO={},qO={class:"node-form-layout"},KO={class:"layout-header"},JO={class:"layout-body"};function ZO(r,e){return Y(),se("div",qO,[E("div",KO,[za(r.$slots,"header",{},void 0,!0)]),E("div",JO,[za(r.$slots,"default",{},void 0,!0)])])}const hr=pt(YO,[["render",ZO],["__scopeId","data-v-a5d11f7a"]]),QO={class:"node-form-header"},ek={class:"node-title"},tk={class:"title-left"},nk=["src"],rk={class:"title-conttent"},ik={class:"title-right"},ok={class:"node-desc"},ak={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},setup(r){const e=wt("changeTitle"),t=wt("deleteNode"),n=wt("close"),i=r;let o=null;const s=g=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":Vx,"../../../../assets/svg/ai-generate-white.svg":Ux,"../../../../assets/svg/ai-generate.svg":Wx,"../../../../assets/svg/ai-mark.svg":zx,"../../../../assets/svg/ai.svg":Fx,"../../../../assets/svg/alert-icon.svg":$x,"../../../../assets/svg/ali-ocr.svg":Hx,"../../../../assets/svg/analysis.svg":jx,"../../../../assets/svg/anthrop.svg":Bx,"../../../../assets/svg/arrow-down.svg":Ix,"../../../../assets/svg/arrow-left.svg":Rx,"../../../../assets/svg/arrow-right.svg":Px,"../../../../assets/svg/attachment.svg":Lx,"../../../../assets/svg/auth.svg":Dx,"../../../../assets/svg/azure.svg":Tx,"../../../../assets/svg/baichuan.svg":Ax,"../../../../assets/svg/base-node-type.svg":Mx,"../../../../assets/svg/book.svg":Nx,"../../../../assets/svg/chat-cache.svg":kx,"../../../../assets/svg/chat-mode.svg":Ox,"../../../../assets/svg/chat-robot-icon.svg":Cx,"../../../../assets/svg/chat.svg":Ex,"../../../../assets/svg/check-arrow-filled.svg":Sx,"../../../../assets/svg/circularNeedle.svg":wx,"../../../../assets/svg/client.svg":xx,"../../../../assets/svg/close-circle.svg":bx,"../../../../assets/svg/cmd.svg":_x,"../../../../assets/svg/code-run-node.svg":yx,"../../../../assets/svg/cohere.svg":mx,"../../../../assets/svg/collaborator.svg":gx,"../../../../assets/svg/collapse-close.svg":vx,"../../../../assets/svg/collapse-open.svg":px,"../../../../assets/svg/colour-edit.svg":hx,"../../../../assets/svg/comment-search.svg":fx,"../../../../assets/svg/common-quession.svg":cx,"../../../../assets/svg/cu-doc-active.svg":dx,"../../../../assets/svg/cu-doc-icon.svg":ux,"../../../../assets/svg/data-node.svg":lx,"../../../../assets/svg/data-security.svg":sx,"../../../../assets/svg/database-menu-icon.svg":ax,"../../../../assets/svg/deepseek.svg":ox,"../../../../assets/svg/delete.svg":ix,"../../../../assets/svg/direct-connection.svg":rx,"../../../../assets/svg/dislike-active.svg":nx,"../../../../assets/svg/dislike.svg":tx,"../../../../assets/svg/doc-active-menu-icon.svg":ex,"../../../../assets/svg/doc-directory.svg":Qb,"../../../../assets/svg/doc-draft.svg":Zb,"../../../../assets/svg/doc-file.svg":Jb,"../../../../assets/svg/doc-file2.svg":Kb,"../../../../assets/svg/doc-icon-active.svg":qb,"../../../../assets/svg/doc-icon.svg":Yb,"../../../../assets/svg/doc-menu-icon.svg":Gb,"../../../../assets/svg/document.svg":Xb,"../../../../assets/svg/drag.svg":Vb,"../../../../assets/svg/duiwaifuwu.svg":Ub,"../../../../assets/svg/economic-active.svg":Wb,"../../../../assets/svg/economic.svg":zb,"../../../../assets/svg/edit-02.svg":Fb,"../../../../assets/svg/edit.svg":$b,"../../../../assets/svg/empty-document.svg":Hb,"../../../../assets/svg/empty.svg":jb,"../../../../assets/svg/end-node.svg":Bb,"../../../../assets/svg/enterprise-active.svg":Ib,"../../../../assets/svg/enterprise.svg":Rb,"../../../../assets/svg/enterprise2.svg":Pb,"../../../../assets/svg/expand.svg":Lb,"../../../../assets/svg/explain-node.svg":Db,"../../../../assets/svg/export-record.svg":Tb,"../../../../assets/svg/eye-open.svg":Ab,"../../../../assets/svg/field-menu-icon.svg":Mb,"../../../../assets/svg/file-search.svg":Nb,"../../../../assets/svg/finance.svg":kb,"../../../../assets/svg/gemini.svg":Ob,"../../../../assets/svg/generate-icon.svg":Cb,"../../../../assets/svg/gou.svg":Eb,"../../../../assets/svg/government.svg":Sb,"../../../../assets/svg/graph-icon.svg":wb,"../../../../assets/svg/guanlianzhishiku.svg":xb,"../../../../assets/svg/high-active.svg":bb,"../../../../assets/svg/high.svg":_b,"../../../../assets/svg/http-node.svg":yb,"../../../../assets/svg/huanyingyu.svg":mb,"../../../../assets/svg/huoshanyinqin.svg":gb,"../../../../assets/svg/img-icon.svg":vb,"../../../../assets/svg/input.svg":pb,"../../../../assets/svg/jibenpeizhi.svg":hb,"../../../../assets/svg/jichupeizhi.svg":fb,"../../../../assets/svg/jina.svg":cb,"../../../../assets/svg/judge-node.svg":db,"../../../../assets/svg/knowledge-base-node.svg":ub,"../../../../assets/svg/knowledge-config-active-icon.svg":lb,"../../../../assets/svg/knowledge-config-icon.svg":sb,"../../../../assets/svg/law.svg":ab,"../../../../assets/svg/liaotianceshi.svg":ob,"../../../../assets/svg/like-active.svg":ib,"../../../../assets/svg/like-icon.svg":rb,"../../../../assets/svg/like.svg":nb,"../../../../assets/svg/lingyiwanwu.svg":tb,"../../../../assets/svg/link-icon-active.svg":eb,"../../../../assets/svg/link-icon.svg":Q0,"../../../../assets/svg/link-left.svg":Z0,"../../../../assets/svg/login-success.svg":J0,"../../../../assets/svg/logout.svg":K0,"../../../../assets/svg/manufacture.svg":q0,"../../../../assets/svg/mcp-node-type.svg":Y0,"../../../../assets/svg/mcp-node.svg":G0,"../../../../assets/svg/medical-treatment.svg":X0,"../../../../assets/svg/menu-expand.svg":V0,"../../../../assets/svg/message.svg":U0,"../../../../assets/svg/minus.svg":W0,"../../../../assets/svg/mix-icon.svg":z0,"../../../../assets/svg/more-compatible.svg":F0,"../../../../assets/svg/moxingshezhi.svg":$0,"../../../../assets/svg/multimode-box.svg":H0,"../../../../assets/svg/nav-chat.svg":j0,"../../../../assets/svg/nav-doc.svg":B0,"../../../../assets/svg/nav-find.svg":I0,"../../../../assets/svg/nav-library.svg":R0,"../../../../assets/svg/nav-robot.svg":P0,"../../../../assets/svg/nav-search.svg":L0,"../../../../assets/svg/network.svg":D0,"../../../../assets/svg/open-ai.svg":T0,"../../../../assets/svg/ordinary-segmentation.svg":A0,"../../../../assets/svg/out-the-box.svg":M0,"../../../../assets/svg/output.svg":N0,"../../../../assets/svg/parameter-extraction-node.svg":k0,"../../../../assets/svg/pc.svg":O0,"../../../../assets/svg/pdf-img.svg":C0,"../../../../assets/svg/pdf-ocr.svg":E0,"../../../../assets/svg/pdf-text.svg":S0,"../../../../assets/svg/phone.svg":w0,"../../../../assets/svg/plugin-node-type.svg":x0,"../../../../assets/svg/plus.svg":b0,"../../../../assets/svg/point-h.svg":_0,"../../../../assets/svg/problem-optimization-node.svg":y0,"../../../../assets/svg/problem-optimization.svg":m0,"../../../../assets/svg/prompt-icon.svg":g0,"../../../../assets/svg/put-away.svg":v0,"../../../../assets/svg/qa-feedback.svg":p0,"../../../../assets/svg/question-node.svg":h0,"../../../../assets/svg/quick-Instruction.svg":f0,"../../../../assets/svg/quote-file.svg":c0,"../../../../assets/svg/quotes.svg":d0,"../../../../assets/svg/recommendation.svg":u0,"../../../../assets/svg/retail.svg":l0,"../../../../assets/svg/reward-points.svg":s0,"../../../../assets/svg/right-fork-icon.svg":a0,"../../../../assets/svg/save-draft.svg":o0,"../../../../assets/svg/sdk.svg":i0,"../../../../assets/svg/search-check-icon.svg":r0,"../../../../assets/svg/search-right.svg":n0,"../../../../assets/svg/search-tip.svg":t0,"../../../../assets/svg/search.svg":e0,"../../../../assets/svg/segmentation-down.svg":Q_,"../../../../assets/svg/segmentation-icon.svg":Z_,"../../../../assets/svg/segmentation-up.svg":J_,"../../../../assets/svg/segmentation.svg":K_,"../../../../assets/svg/select-disabled.svg":q_,"../../../../assets/svg/semantic-segmentation.svg":Y_,"../../../../assets/svg/sensitive-icon.svg":G_,"../../../../assets/svg/seo-gray.svg":X_,"../../../../assets/svg/seo-highlight.svg":V_,"../../../../assets/svg/seo-light.svg":U_,"../../../../assets/svg/session-record.svg":W_,"../../../../assets/svg/session.svg":z_,"../../../../assets/svg/setting.svg":F_,"../../../../assets/svg/share.svg":$_,"../../../../assets/svg/similarity.svg":H_,"../../../../assets/svg/skii.svg":j_,"../../../../assets/svg/source-energy.svg":B_,"../../../../assets/svg/specify-reply-node.svg":I_,"../../../../assets/svg/start-node.svg":R_,"../../../../assets/svg/statistical-analysis.svg":P_,"../../../../assets/svg/success.svg":L_,"../../../../assets/svg/suggested-issues.svg":D_,"../../../../assets/svg/switch-mobile.svg":T_,"../../../../assets/svg/system-setting.svg":A_,"../../../../assets/svg/team-manage-active.svg":M_,"../../../../assets/svg/team-manage.svg":N_,"../../../../assets/svg/team-manage2.svg":k_,"../../../../assets/svg/tengxunhunyuan.svg":O_,"../../../../assets/svg/test-active-menu-icon.svg":C_,"../../../../assets/svg/test-menu-icon.svg":E_,"../../../../assets/svg/think.svg":S_,"../../../../assets/svg/tongyiqianwen.svg":w_,"../../../../assets/svg/unit.svg":x_,"../../../../assets/svg/unknown-issue.svg":b_,"../../../../assets/svg/unknown-prompt.svg":__,"../../../../assets/svg/use-token-active.svg":y_,"../../../../assets/svg/use-token.svg":m_,"../../../../assets/svg/user-icon.svg":g_,"../../../../assets/svg/variable-assignment-node.svg":v_,"../../../../assets/svg/vector-icon.svg":p_,"../../../../assets/svg/wenxinyiyan.svg":h_,"../../../../assets/svg/workflow-robot-icon.svg":f_,"../../../../assets/svg/workflow.svg":c_,"../../../../assets/svg/xitongtishici.svg":d_,"../../../../assets/svg/xunfeixinghuo.svg":u_,"../../../../assets/svg/yuezhianmian.svg":l_,"../../../../assets/svg/zhipuai.svg":s_})[`../../../../assets/svg/${g}.svg`],import.meta.url).href,l=Kt(()=>s(i.iconName)),d=Ce(i.title),c=()=>{o&&clearTimeout(o),o=setTimeout(()=>{e(d.value)},250)},f=()=>{t()},v=()=>{n()};return(g,y)=>{const b=Sr,_=ni,x=Lh,w=Dh,C=Ph;return Y(),se("div",QO,[E("div",ek,[E("div",tk,[za(g.$slots,"node-icon",{},()=>[l.value?(Y(),se("img",{key:0,class:"node-icon",src:l.value},null,8,nk)):Qe("",!0)],!0)]),E("div",rk,[B(b,{class:"node-name-input",value:d.value,"onUpdate:value":y[0]||(y[0]=k=>d.value=k),placeholder:"请输入节点名称",onChange:dn(c,["stop"])},null,8,["value"])]),E("div",ik,[r.hideMenus?Qe("",!0):(Y(),Fe(C,{key:0},{overlay:V(()=>[B(w,{style:{width:"100px"}},{default:V(()=>[B(x,{onClick:y[2]||(y[2]=k=>f())},{default:V(()=>y[3]||(y[3]=[E("a",{href:"javascript:;"},"删除",-1)])),_:1,__:[3]})]),_:1})]),default:V(()=>[E("div",{class:"action-btn delete-btn",onClick:y[1]||(y[1]=dn(()=>{},["prevent"]))},[B(_,{name:"point-h",class:"btn-icon"})])]),_:1})),E("div",{class:"action-btn close-btn",onClick:v},[B(je(oC),{class:"btn-icon",style:{"font-size":"12px"}})])])]),E("div",ok,[za(g.$slots,"desc",{},()=>[He(De(i.desc),1)],!0)])])}}},pr=pt(ak,[["__scopeId","data-v-96804834"]]),Bh="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",sk="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",lk=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"array<string>",value:"array<string>"}],uk={emits:["close","update-node"],components:{NodeFormLayout:hr,NodeFormHeader:pr,QuestionCircleOutlined:Yn,PlusOutlined:Rn},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],show:!1,typOptions:[...lk],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let r=JSON.parse(this.node.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global},methods:{update(){let r=JSON.parse(this.node.node_params);r.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(r)};this.$emit("update-node",e)},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(r,e){this.formState={...r},this.editIndex=e,this.show=!0},handleDel(r){this.diy_global.splice(r,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},dk={class:"start-node-form"},ck={class:"node-form-content"},fk={class:"start-node"},hk={class:"start-node-options"},pk={class:"options-item-body"},vk={class:"option-label"},gk={class:"option-type"},mk={class:"start-node-options"},yk={class:"options-title"},_k={class:"options-item-body"},bk={class:"option-label"},xk={class:"option-type"},wk={class:"item-actions-box"},Sk={class:"action-items-box"};function Ek(r,e,t,n,i,o){const s=kn("NodeFormHeader"),l=kn("QuestionCircleOutlined"),d=Ci,c=ni,f=kn("PlusOutlined"),v=In,g=Sr,y=Wi,b=Rr,_=Pr,x=oa,w=Kd,C=Oi,k=ii,D=kn("NodeFormLayout");return Y(),Fe(D,null,{header:V(()=>[B(s,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:V(()=>e[5]||(e[5]=[E("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",dk,[E("div",ck,[E("div",fk,[E("div",hk,[e[6]||(e[6]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Bh,alt:"",class:"title-icon"}),He("输出")])],-1)),(Y(!0),se(it,null,ft(i.sys_global,I=>(Y(),se("div",{class:wn(["options-item",{"is-required":I.required}]),key:I.key},[E("div",pk,[E("div",vk,De(I.key),1),E("div",gk,De(I.typ),1)])],2))),128))]),E("div",mk,[E("div",yk,[e[8]||(e[8]=E("div",null,[E("img",{src:sk,alt:"",class:"title-icon"}),E("span",null,"自定义全局变量")],-1)),E("div",null,[B(d,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:V(()=>e[7]||(e[7]=[E("div",null,[He(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),E("br"),He(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),E("br"),He(" 2、通过api访问时，可以再API中传递参数值"),E("br"),He(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])),default:V(()=>[B(l,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(Y(!0),se(it,null,ft(i.diy_global,(I,$)=>(Y(),se("div",{class:wn(["options-item diy-options-item",{"is-required":I.required}]),key:I.key},[E("div",_k,[E("div",bk,De(I.key),1),E("div",xk,De(I.typ),1)]),E("div",wk,[B(c,{class:"action-btn",name:"edit-02",onClick:R=>o.handleEdit(I,$)},null,8,["onClick"]),B(c,{class:"action-btn",name:"close-circle",onClick:R=>o.handleDel($)},null,8,["onClick"])])],2))),128)),E("div",Sk,[B(v,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:o.handleAdd},{icon:V(()=>[B(f)]),default:V(()=>[e[9]||(e[9]=He(" 添加全局变量 "))]),_:1,__:[9]},8,["onClick"])])]),B(k,{open:i.show,"onUpdate:open":e[4]||(e[4]=I=>i.show=I),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:o.handleOk},{default:V(()=>[B(C,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:V(()=>[B(y,{label:"变量名",name:"key"},{default:V(()=>[B(g,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=I=>i.formState.key=I),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),B(y,{label:"类型",name:"typ"},{default:V(()=>[B(_,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=I=>i.formState.typ=I)},{default:V(()=>[(Y(!0),se(it,null,ft(i.typOptions,I=>(Y(),Fe(b,{value:I.value,key:I.value},{default:V(()=>[E("span",null,De(I.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),B(y,{label:"必填",name:"required"},{default:V(()=>[B(x,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=I=>i.formState.required=I)},null,8,["checked"])]),_:1}),B(y,{label:"描述",name:"desc"},{default:V(()=>[B(w,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=I=>i.formState.desc=I),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const Ck=pt(uk,[["render",Ek],["__scopeId","data-v-eb2fbc14"]]),Ok={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right"}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(r){r&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(r){const e=[],t=[],n=(i,o)=>{if(!i||i.length===0)return!1;for(let s=0;s<i.length;s++){const l=i[s],d=l[this.valueKey];if(d===r)return e[o]=l,t[o]=d,!0;if(l[this.childrenKey]&&l[this.childrenKey].length>0){if(e[o]=l,t[o]=d,n(l[this.childrenKey],o+1))return!0;e[o]=null,t[o]=null}}return!1};n(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(r){if(!r||r.length===0)return;const e=[];let t=this.options;for(let n=0;n<r.length;n++){const i=r[n],o=t.find(s=>s[this.valueKey]===i);if(o)e.push(o),t=o[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let r=0;r<this.selectedPath.length;r++){const e=this.selectedPath[r];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:r+1})}},handleSelect(r,e){this.hasChildren(r)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(r),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(r[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(r)&&this.activePath.push({title:r[this.labelKey],options:r[this.childrenKey],level:e+1}),this.$emit("select",r,this.selectedPath,e),(this.checkAnyLevel||!this.hasChildren(r))&&(this.$emit("change",r[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:r[this.valueKey]))},isActive(r,e){return!this.selectedPath||this.selectedPath.length<=e?!1:r[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(r){return r[this.childrenKey]&&r[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const r=this.$el;if(!r)return;const e=r.getBoundingClientRect(),t=window.innerWidth,n=180;e.right+n>t&&e.left>n?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",n)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",n))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},kk={class:"cascade-panel"},Nk={class:"cascade-panel-body"},Mk=["onClick"],Ak={class:"item-content"},Tk={class:"item-label"},Dk={key:0,class:"item-icon"},Lk={key:0,class:"cascade-panel-empty"};function Pk(r,e,t,n,i,o){return Y(),se("div",kk,[E("div",{class:wn(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(Y(!0),se(it,null,ft(i.activePath,(s,l)=>(Y(),se("div",{class:"cascade-panel-list",key:l},[E("div",Nk,[(Y(!0),se(it,null,ft(s.options,d=>(Y(),se("div",{class:wn(["cascade-panel-item",{active:o.isActive(d,l)}]),key:d.value,onClick:c=>o.handleSelect(d,l)},[E("div",Ak,[E("span",Tk,De(d.label),1),o.hasChildren(d)?(Y(),se("span",Dk,e[0]||(e[0]=[E("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[E("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)]))):Qe("",!0)])],10,Mk))),128)),s.options&&s.options.length===0?(Y(),se("div",Lk," 暂无数据 ")):Qe("",!0)])]))),128))],2)])}const Rk=pt(Ok,[["render",Pk],["__scopeId","data-v-9e580d45"]]),qx=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...qx(t.children)):e.push(t)}),e},Ik={name:"JMention",components:{CascadePanel:Rk},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(r){r.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(r){r.target.closest(".dropdown-list")&&r.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1,this.showAtList=!1},onFocus(){this.$emit("focus")},onOpen(r){this.$emit("open",r)},getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=qx(this.options),i=[...t,...n].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const o=new Set;i.forEach(s=>{const l=new RegExp(`(${s.value})`,"g");if(l.test(this.defaultValue)&&!o.has(s.value)){let d=s.node_name+"."+s.text;d=d.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${d}</span> `),o.add(s.value),this.selectOption(s,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?o+=d.textContent.slice(0,n):o+=d.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const s=n.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?i+=d.textContent.slice(0,t):i+=d.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize(),i=window.innerWidth,o=window.innerHeight;let s=t.bottom,l=t.left;return s+n.height>o&&(s=t.top-n.height),l+n.width>i&&(l=t.right-n.width),s<0&&(s=0),l<0&&(l=0),{top:s,left:l}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:t,left:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${n}px; top:${t}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),s=o.startOffset,l=o.startContainer;let d=s-t,c=l;if(d<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){d=f.textContent.length-t,c=f;break}f=f.previousSibling}}if(c.nodeType===Node.TEXT_NODE){c.replaceData(d,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const v=document.createElement("span");v.contentEditable=!0,v.innerHTML+="&nbsp;",v.classList.add("at-space");for(const b in e)f.dataset[b]=e[b];const g=document.createRange();g.setStart(c,d),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),v.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())},handleDirectionChange(r,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),n=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!n)return;const i=parseFloat(t[1]),o=parseFloat(n[1]);let s;r==="left"?s=i-e:s=i+e,this.positionStyle=`left:${s}px; top:${o}px;`}}},Bk={style:{width:"100%",position:"relative"}},jk={class:"mention-input-warpper",ref:"JMentionContainer"},Hk=["placeholder"],$k={key:0,class:"placeholder"};function Fk(r,e,t,n,i,o){const s=kn("CascadePanel");return Y(),se("div",Bk,[e[5]||(e[5]=E("div",null,null,-1)),(Y(),Fe(Vy,{to:"body"},[i.showDropdown?(Y(),se("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Si(i.positionStyle)},[B(s,{options:i.showOptions,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","onChange","onDirectionChange"])],4)):Qe("",!0)])),E("div",jk,[E("div",{ref:"JMention",style:Si([t.inputStyle]),class:wn(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onWheel:e[0]||(e[0]=dn(()=>{},["stop"])),onFocus:e[1]||(e[1]=(...l)=>o.onFocus&&o.onFocus(...l)),onInput:e[2]||(e[2]=(...l)=>o.divInput&&o.divInput(...l)),onKeydown:e[3]||(e[3]=(...l)=>o.dropDownKeydown&&o.dropDownKeydown(...l)),onClick:e[4]||(e[4]=(...l)=>o.clickJMention&&o.clickJMention(...l))},null,46,Hk),i.localValue.length==0?(Y(),se("span",$k,De(t.placeholder),1)):Qe("",!0)],512)])}const fr=pt(Ik,[["render",Fk],["__scopeId","data-v-e07dded7"]]),zk={class:"problem-optimization-form"},Wk={class:"gray-block"},Uk={class:"flex-block-item"},Vk={class:"number-box"},Xk={class:"number-slider-box"},Gk={class:"number-input-box"},Yk={class:"number-box"},qk={class:"number-slider-box"},Kk={class:"number-input-box"},Jk={class:"number-box"},Zk={class:"number-box"},Qk={class:"number-slider-box"},e2={class:"number-input-box"},t2={class:"field-list-item"},n2={class:"field-label"},r2={class:"field-type"},i2={class:"diy-form-item"},o2={class:"form-content"},a2={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=ri(),o=Ce(null),s=Kt(()=>i.modelList),l=Ce([]),d=Ce([]),c=Ce(!1),f=()=>{c.value=!c.value},v=(G,Q)=>{w.prompt=G,w.prompt_tags=Q};function g(){const G=n.lf.getNodeModelById(n.nodeId);if(G){let Q=G.getAllParentVariable();d.value=y(Q)}}function y(G){return G.forEach(Q=>{Q.typ=="node"?Q.node_type==1?Q.value="global":Q.value=Q.node_id:Q.value=Q.key,Q.children&&Q.children.length>0&&(Q.children=y(Q.children))}),G}const b=()=>{const G=n.lf.getNodeModelById(n.nodeId);if(G){let Q=G.getAllParentVariable();l.value=Q}};function _(G){if(G){let Q=G.split("."),T=Q[0],W=Q.filter((P,le)=>le>0).join(".");return[T,W]}return["global","question"]}const x=Ce(),w=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),C=()=>{const G=n.node.dataRaw||n.node.node_params||"{}",Q=JSON.stringify({question_optimize:JSON.parse(G).question_optimize||{}}),T=JSON.stringify({question_optimize:{...w,question_value:w.question_value.join("."),model_config_id:w.model_config_id?+w.model_config_id:w.model_config_id}});Q!=T&&t("update-node",{...n.node,...w,node_params:T})},k=()=>{try{let G=n.node.dataRaw||n.node.node_params||"{}",Q=JSON.parse(G).question_optimize||{};Q=JSON.parse(JSON.stringify(Q));let{model_config_id:T,use_model:W,context_pair:P,temperature:le,max_token:me,prompt:he,prompt_tags:Ne,question_value:ye,enable_thinking:ae}=Q;b(),g(),w.model_config_id=T,w.use_model=W,w.context_pair=P||0,w.temperature=le,w.max_token=me,w.prompt=he,w.enable_thinking=ae,w.prompt_tags=Ne||[],w.question_value=_(ye),!w.model_config_id&&s.value.length>0&&(w.model_config_id=s.value[0].id,w.use_model=s.value[0].children[0].name)}catch(G){}};qt(()=>w,()=>{C()},{deep:!0});const D=Ce(null),I=G=>{w.prompt="",G.prompt_type==1?w.prompt=G.markdown:w.prompt=G.prompt,_n(()=>{o.value.initData()})},$=G=>{G||g()},R=Ce({}),F=(G,Q)=>{R.value=Q},z=Kt(()=>{if(!w.model_config_id)return!1;let G=w.model_config_id+"#"+w.use_model;return R.value[G]}),ie=()=>{t("close")};return Xt(()=>{k()}),(G,Q)=>{const T=In,W=Wi,P=Ci,le=Bl,me=aa,he=Ui,Ne=oa,ye=cs,ae=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:ie},null,8,["title","iconName"])]),default:V(()=>[E("div",zk,[E("div",{class:"node-form-content",onMousedown:Q[11]||(Q[11]=dn(()=>{},["stop"]))},[B(ae,{ref_key:"formRef",ref:x,layout:"vertical",model:w},{default:V(()=>[E("div",Wk,[Q[24]||(Q[24]=E("div",{class:"gray-block-title"},"输入",-1)),B(W,{label:"LLM模型",name:"use_model"},{default:V(()=>[E("div",Uk,[B(Zd,{modelType:"LLM",modeName:w.use_model,"onUpdate:modeName":Q[0]||(Q[0]=Re=>w.use_model=Re),modeId:w.model_config_id,"onUpdate:modeId":Q[1]||(Q[1]=Re=>w.model_config_id=Re),onLoaded:F,style:{width:"348px"}},null,8,["modeName","modeId"]),B(T,{onClick:f},{default:V(()=>[Q[12]||(Q[12]=He("高级设置 ")),c.value?(Y(),Fe(je(ds),{key:0})):(Y(),Fe(je(Jd),{key:1}))]),_:1,__:[12]})])]),_:1}),c.value?(Y(),Fe(W,{key:0,name:"temperature"},{label:V(()=>[Q[14]||(Q[14]=E("span",null,"温度 ",-1)),B(P,null,{title:V(()=>Q[13]||(Q[13]=[He("温度越低，回答越严谨。温度越高，回答越发散。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",Vk,[E("div",Xk,[B(me,null,{default:V(()=>[B(le,{class:"custom-slider",value:w.temperature,"onUpdate:value":Q[2]||(Q[2]=Re=>w.temperature=Re),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",Gk,[B(he,{value:w.temperature,"onUpdate:value":Q[3]||(Q[3]=Re=>w.temperature=Re),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Qe("",!0),c.value?(Y(),Fe(W,{key:1,name:"max_token"},{label:V(()=>[Q[16]||(Q[16]=E("span",null,"最大token ",-1)),B(P,null,{title:V(()=>Q[15]||(Q[15]=[He("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",Yk,[E("div",qk,[B(me,null,{default:V(()=>[B(le,{class:"custom-slider",value:w.max_token,"onUpdate:value":Q[4]||(Q[4]=Re=>w.max_token=Re),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",Kk,[B(he,{value:w.max_token,"onUpdate:value":Q[5]||(Q[5]=Re=>w.max_token=Re),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Qe("",!0),c.value&&z.value?(Y(),Fe(W,{key:2,name:"enable_thinking"},{label:V(()=>[Q[18]||(Q[18]=E("span",null,"深度思考 ",-1)),B(P,null,{title:V(()=>Q[17]||(Q[17]=[He("开启时，调用大模型时会指定走深度思考模式")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",Jk,[B(Ne,{checked:w.enable_thinking,"onUpdate:checked":Q[6]||(Q[6]=Re=>w.enable_thinking=Re)},null,8,["checked"])])]),_:1})):Qe("",!0),B(W,{name:"context_pair"},{label:V(()=>[Q[20]||(Q[20]=E("span",null,"上下文数量 ",-1)),B(P,null,{title:V(()=>Q[19]||(Q[19]=[He("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",Zk,[E("div",Qk,[B(me,null,{default:V(()=>[B(le,{class:"custom-slider",value:w.context_pair,"onUpdate:value":Q[7]||(Q[7]=Re=>w.context_pair=Re),min:0,max:50},null,8,["value"])]),_:1})]),E("div",e2,[B(he,{value:w.context_pair,"onUpdate:value":Q[8]||(Q[8]=Re=>w.context_pair=Re),min:0,max:50},null,8,["value"])])])]),_:1}),B(W,{name:"prompt",class:"width-100"},{label:V(()=>Q[21]||(Q[21]=[E("div",{class:"space-between-box"},[E("div",null,"对话背景")],-1)])),default:V(()=>[B(fr,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:w.prompt_tags,defaultValue:w.prompt,ref_key:"atInputRef",ref:o,onOpen:b,onChange:Q[9]||(Q[9]=(Re,Le)=>v(Re,Le)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:V(({label:Re,payload:Le})=>[E("div",t2,[E("div",n2,De(Re),1),E("div",r2,De(Le.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),Q[22]||(Q[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",i2,[Q[23]||(Q[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",o2,[B(ye,{value:w.question_value,"onUpdate:value":Q[10]||(Q[10]=Re=>w.question_value=Re),onDropdownVisibleChange:$,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:Re})=>Re.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),Q[25]||(Q[25]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"问题优化结果"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[25]},8,["model"]),B(Xx,{onOk:I,ref_key:"importPromptRef",ref:D},null,512)],32)])]),_:1})}}},s2=pt(a2,[["__scopeId","data-v-1885fba6"]]),l2={class:"input-box"},u2={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(r,{expose:e,emit:t}){const n=Ce(!1),i=t;qt(()=>n.value,v=>{v||i("ok")});const o=r,s=Ce(null),l=()=>{n.value=!0,_n(()=>{s.value.refresh()})},d=v=>{i("open",v)},c=(v,g)=>{i("change",v,g)},f=()=>{n.value=!1};return e({show:l}),(v,g)=>{const y=In,b=ii;return Y(),se("div",null,[B(b,{open:n.value,"onUpdate:open":g[1]||(g[1]=_=>n.value=_),title:"字段详情",width:746},{footer:V(()=>[B(y,{type:"primary",onClick:f},{default:V(()=>g[2]||(g[2]=[He("确定")])),_:1,__:[2]})]),default:V(()=>[E("div",l2,[B(fr,{inputStyle:"height: 550px;",options:o.options,defaultSelectedList:o.defaultSelectedList,defaultValue:o.defaultValue,placeholder:o.placeholder,type:o.type,ref_key:"atInputRef",ref:s,onOpen:d,onChange:g[0]||(g[0]=(_,x)=>c(_,x))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},Kx=pt(u2,[["__scopeId","data-v-62373f0f"]]),d2={class:"problem-optimization-form"},c2={class:"gray-block"},f2={class:"flex-block-item"},h2={class:"number-box"},p2={class:"number-slider-box"},v2={class:"number-input-box"},g2={class:"number-box"},m2={class:"number-slider-box"},y2={class:"number-input-box"},_2={class:"number-box"},b2={class:"number-box"},x2={class:"number-slider-box"},w2={class:"number-input-box"},S2={class:"space-between-box"},E2={class:"field-list-item"},C2={class:"field-label"},O2={class:"field-type"},k2={class:"diy-form-item"},N2={class:"form-content"},M2={class:"diy-form-item mt12"},A2={class:"form-content"},T2={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=wt("getNode"),o=ri(),s=Ce(null),l=Kt(()=>o.modelList),d=Ce([]),c=Ce([]),f=Ce(!1),v=Ce(),g=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),y=()=>{f.value=!f.value},b=(me,he)=>{g.prompt=me,g.prompt_tags=he};function _(){let me=i().getAllParentVariable();c.value=w(me)}const x=Kt(()=>c.value.filter(he=>he.node_type==5));function w(me){return me.forEach(he=>{he.typ=="node"?he.node_type==1?he.value="global":he.value=he.node_id:he.value=he.key,he.children&&he.children.length>0&&(he.children=w(he.children))}),me}const C=()=>{let me=i().getAllParentVariable();d.value=me};function k(me){if(me){let he=me.split("."),Ne=he[0],ye=he.filter((ae,Re)=>Re>0).join(".");return[Ne,ye]}return["global","question"]}const D=Ce(null),I=()=>{D.value.show()},$=me=>{g.prompt="",me.prompt_type==1?g.prompt=me.markdown:g.prompt=me.prompt,_n(()=>{s.value.initData()})},R=Ce(null),F=()=>{R.value.show()},z=()=>{s.value.refresh()},ie=()=>{const me=JSON.stringify({llm:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});t("update-node",{...n.node,...g,node_params:me})},G=()=>{try{let me=n.node.dataRaw||n.node.node_params||"{}",he=JSON.parse(me).llm||{};he=JSON.parse(JSON.stringify(he));let{model_config_id:Ne,use_model:ye,context_pair:ae,temperature:Re,max_token:Le,prompt:Ve,prompt_tags:Ae,question_value:te,enable_thinking:ce,libs_node_key:_e}=he;C(),_(),g.model_config_id=Ne,g.use_model=ye,g.context_pair=ae||0,g.temperature=Re,g.max_token=Le,g.prompt=Ve,g.enable_thinking=ce,g.prompt_tags=Ae||[],g.libs_node_key=_e,g.question_value=k(te),!g.model_config_id&&l.value.length>0&&(g.model_config_id=l.value[0].id,g.use_model=l.value[0].children[0].name)}catch(me){}};qt(()=>g,()=>{ie()},{deep:!0});const Q=me=>{me||_()},T=Ce({}),W=(me,he)=>{T.value=he},P=Kt(()=>{if(!g.model_config_id)return!1;let me=g.model_config_id+"#"+g.use_model;return T.value[me]}),le=()=>{t("close")};return Xt(()=>{G()}),(me,he)=>{const Ne=In,ye=Wi,ae=Ci,Re=Bl,Le=aa,Ve=Ui,Ae=oa,te=fs,ce=cs,_e=Rr,Ie=Pr,Ke=Oi,$e=Xx;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:le},null,8,["title","iconName"])]),default:V(()=>[E("div",d2,[E("div",{class:"node-form-content",onMousedown:he[12]||(he[12]=dn(()=>{},["stop"]))},[B(Ke,{ref_key:"formRef",ref:v,layout:"vertical",model:g},{default:V(()=>[E("div",c2,[he[28]||(he[28]=E("div",{class:"gray-block-title"},"输入",-1)),B(ye,{label:"LLM模型",name:"use_model"},{default:V(()=>[E("div",f2,[B(Zd,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":he[0]||(he[0]=Ue=>g.use_model=Ue),modeId:g.model_config_id,"onUpdate:modeId":he[1]||(he[1]=Ue=>g.model_config_id=Ue),onLoaded:W,style:{width:"348px"}},null,8,["modeName","modeId"]),B(Ne,{onClick:y},{default:V(()=>[he[14]||(he[14]=He("高级设置 ")),f.value?(Y(),Fe(je(ds),{key:0})):(Y(),Fe(je(Jd),{key:1}))]),_:1,__:[14]})])]),_:1}),f.value?(Y(),Fe(ye,{key:0,name:"temperature"},{label:V(()=>[he[16]||(he[16]=E("span",null,"温度 ",-1)),B(ae,null,{title:V(()=>he[15]||(he[15]=[He("温度越低，回答越严谨。温度越高，回答越发散。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",h2,[E("div",p2,[B(Le,null,{default:V(()=>[B(Re,{class:"custom-slider",value:g.temperature,"onUpdate:value":he[2]||(he[2]=Ue=>g.temperature=Ue),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",v2,[B(Ve,{value:g.temperature,"onUpdate:value":he[3]||(he[3]=Ue=>g.temperature=Ue),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Qe("",!0),f.value?(Y(),Fe(ye,{key:1,name:"max_token"},{label:V(()=>[he[18]||(he[18]=E("span",null,"最大token ",-1)),B(ae,null,{title:V(()=>he[17]||(he[17]=[He("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",g2,[E("div",m2,[B(Le,null,{default:V(()=>[B(Re,{class:"custom-slider",value:g.max_token,"onUpdate:value":he[4]||(he[4]=Ue=>g.max_token=Ue),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",y2,[B(Ve,{value:g.max_token,"onUpdate:value":he[5]||(he[5]=Ue=>g.max_token=Ue),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Qe("",!0),f.value&&P.value?(Y(),Fe(ye,{key:2,name:"enable_thinking"},{label:V(()=>[he[20]||(he[20]=E("span",null,"深度思考 ",-1)),B(ae,null,{title:V(()=>he[19]||(he[19]=[He("开启时，调用大模型时会指定走深度思考模式")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",_2,[B(Ae,{checked:g.enable_thinking,"onUpdate:checked":he[6]||(he[6]=Ue=>g.enable_thinking=Ue)},null,8,["checked"])])]),_:1})):Qe("",!0),B(ye,{name:"context_pair"},{label:V(()=>[he[22]||(he[22]=E("span",null,"上下文数量 ",-1)),B(ae,null,{title:V(()=>he[21]||(he[21]=[He("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",b2,[E("div",x2,[B(Le,null,{default:V(()=>[B(Re,{class:"custom-slider",value:g.context_pair,"onUpdate:value":he[7]||(he[7]=Ue=>g.context_pair=Ue),min:0,max:50},null,8,["value"])]),_:1})]),E("div",w2,[B(Ve,{value:g.context_pair,"onUpdate:value":he[8]||(he[8]=Ue=>g.context_pair=Ue),min:0,max:50},null,8,["value"])])])]),_:1}),B(ye,{name:"prompt",class:"width-100"},{label:V(()=>[E("div",S2,[he[24]||(he[24]=E("div",null,"提示词",-1)),B(te,{gap:8},{default:V(()=>[E("div",{class:"btn-hover-wrap",onClick:I},[B(je(aC)),he[23]||(he[23]=He("从提示词库导入 "))]),E("div",{class:"btn-hover-wrap",onClick:F},[B(je(Rh))])]),_:1})])]),default:V(()=>[B(fr,{type:"textarea",inputStyle:"height: 100px;",options:d.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:s,onOpen:C,onChange:he[9]||(he[9]=(Ue,Nt)=>b(Ue,Nt)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:V(({label:Ue,payload:Nt})=>[E("div",E2,[E("div",C2,De(Ue),1),E("div",O2,De(Nt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),he[25]||(he[25]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[25]}),E("div",k2,[he[26]||(he[26]=E("div",{class:"form-label"},"用户问题",-1)),E("div",N2,[B(ce,{value:g.question_value,"onUpdate:value":he[10]||(he[10]=Ue=>g.question_value=Ue),onDropdownVisibleChange:Q,style:{width:"220px"},options:c.value,allowClear:!1,displayRender:({labels:Ue})=>Ue.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),E("div",M2,[he[27]||(he[27]=E("div",{class:"form-label"},"知识库引用",-1)),E("div",A2,[B(Ie,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:Q,value:g.libs_node_key,"onUpdate:value":he[11]||(he[11]=Ue=>g.libs_node_key=Ue),style:{width:"220px"}},{default:V(()=>[(Y(!0),se(it,null,ft(x.value,Ue=>(Y(),Fe(_e,{value:Ue.node_id,key:Ue.node_id},{default:V(()=>[He(De(Ue.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),he[29]||(he[29]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"AI回复内容"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[29]},8,["model"])],32),B($e,{onOk:$,ref_key:"importPromptRef",ref:D},null,512),B(Kx,{options:d.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:C,onChange:he[13]||(he[13]=(Ue,Nt)=>b(Ue,Nt)),onOk:z,ref_key:"fullAtInputRef",ref:R},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},D2=pt(T2,[["__scopeId","data-v-2f503b31"]]),Hl="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Oo=KE("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(r=>{this.formListQueue.push(r)});this.formListLoading=!0;try{const r=await FC();this.formList=r.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(r){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:r}){if(this.formFieldListMap[r]&&this.formFieldListMap[r].length>0)return[...this.formFieldListMap[r]];if(this.formFieldListLoadingMap[r])return new Promise(e=>{this.formFieldListQueueMap[r]||(this.formFieldListQueueMap[r]=[]),this.formFieldListQueueMap[r].push(e)});this.formFieldListLoadingMap[r]=!0;try{const e=await $C({form_id:r});this.formFieldListMap[r]=e.data||[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}catch(e){this.formFieldListMap[r]=[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}finally{this.formFieldListLoadingMap[r]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:r}){return this.formFieldListMap[r]=[],this.formFieldListLoadingMap[r]=!1,this.formFieldListQueueMap[r]=[],await this.getFormFieldList({form_id:r})}}}),L2={class:"field-select-box"},P2={key:0,class:"field-list-box"},R2={key:1,class:"empty-box"},I2={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Oo(),o=Vt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),s=Ce([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),l=Ce([]),d=(b,_)=>{o.selectedRowKeys=b,o.selectedRows=_},c=({formId:b,selectedRowKeys:_,selectedRows:x})=>{o.formId=b,o.selectedRowKeys=_,o.selectedRows=x,y(),o.show=!0},f=()=>{window.open("/#/database/details/field-manage?form_id="+o.formId)},v=()=>{n("ok",o.selectedRowKeys,o.selectedRows),o.show=!1},g=Ce(!1),y=()=>{g.value=!0,i.getFormFieldList({form_id:o.formId}).then(b=>{g.value=!1,b.forEach(_=>{_.value="",_.id=_.id*1}),l.value=b}).catch(()=>{g.value=!1})};return e({open:c}),(b,_)=>{const x=Yy,w=ii;return Y(),Fe(w,{width:"746px",open:o.show,"onUpdate:open":_[0]||(_[0]=C=>o.show=C),title:"关联数据表",onOk:v,"ok-text":"确定","cancel-text":"取消"},{default:V(()=>[E("div",L2,[l.value.length?(Y(),se("div",P2,[B(x,{rowKey:"name","row-selection":{selectedRowKeys:o.selectedRowKeys,onChange:d},dataSource:l.value,columns:s.value,loading:g.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):Qe("",!0),l.value.length?Qe("",!0):(Y(),se("div",R2,[_[2]||(_[2]=E("img",{src:Ih,alt:""},null,-1)),E("div",null,[_[1]||(_[1]=He(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},B2=pt(I2,[["__scopeId","data-v-226c889a"]]),j2={class:"field-list"},H2={class:"field-list-row"},$2={key:0,class:"field-list-col field-list-col-head field-value-head"},F2={key:1,class:"field-list-col field-list-col-head field-del-head"},z2={key:0,class:"field-list-row"},W2={class:"field-list-col field-value-col"},U2={class:"field-list-col field-name-col"},V2={class:"field-list-col field-type-col"},X2={key:0,class:"field-list-col field-value-col"},G2={key:1,class:"field-list-col field-del-col"},Y2=["onClick"],q2={key:0,class:"add-btn-box"},K2={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=wt("getNode"),o=Vt({list:n.list});qt(()=>n.list,_=>{o.list=_});const s=Ce([]),l=()=>{let _=i().getAllParentVariable();s.value=_||[]},d=()=>{l()},c=(_,x,w,C)=>{o.list[C].value=_,o.list[C].atTags=x,g()},f=(_,x)=>{o.list=[...x],g()},v=_=>{o.list.splice(_,1),g()},g=()=>{t("change",[...o.list])},y=Ce(),b=()=>{y.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(_=>_.name)})};return Xt(()=>{l()}),(_,x)=>{const w=Sr,C=Ci,k=ni,D=In;return Y(),se("div",null,[E("div",j2,[E("div",H2,[x[0]||(x[0]=E("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),x[1]||(x[1]=E("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),r.showInput?(Y(),se("div",$2,"字段值")):Qe("",!0),n.showDelete?(Y(),se("div",F2)):Qe("",!0)]),r.showEmptyFieldRow?(Y(),se("div",z2,[x[2]||(x[2]=E("div",{class:"field-list-col field-name-col"},"--",-1)),x[3]||(x[3]=E("div",{class:"field-list-col field-type-col"},"--",-1)),E("div",W2,[B(C,{title:"请先选择数据库"},{default:V(()=>[B(w,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):Qe("",!0),(Y(!0),se(it,null,ft(o.list,(I,$)=>(Y(),se("div",{class:"field-list-row",key:I.name},[E("div",U2,De(I.name),1),E("div",V2,De(I.type),1),r.showInput?(Y(),se("div",X2,[B(fr,{options:s.value,defaultValue:I.value,defaultSelectedList:I.atTags,onOpen:d,onChange:(R,F)=>c(R,F,I,$),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):Qe("",!0),n.showDelete?(Y(),se("div",G2,[E("span",{class:"del-btn",onClick:R=>v($)},[B(k,{class:"del-icon",name:"close-circle"})],8,Y2)])):Qe("",!0)]))),128))]),n.showAdd?(Y(),se("div",q2,[B(D,{class:"add-btn",type:"dashed",block:"",onClick:b},{default:V(()=>[B(je(Rn)),x[4]||(x[4]=He(" 添加更新字段"))]),_:1,__:[4]})])):Qe("",!0),B(B2,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:y,onOk:f},null,8,["formId"])])}}},jh=pt(K2,[["__scopeId","data-v-8972aaa9"]]),J2={class:"library-checkbox-box"},Z2={class:"list-box",ref:"scrollContainer"},Q2={class:"library-name"},eN={class:"library-desc"},tN={key:1,class:"empty-box"},nN={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=r,o=Ce(),s=Ce(!1),l=v=>{o.value=v,s.value=!0},d=()=>{s.value=!1,c()},c=()=>{let v=i.options.filter(g=>g.id===o.value);n("ok",o.value,JSON.parse(JSON.stringify(v[0])))},f=()=>{window.open("/#/database/list")};return e({open:l}),(v,g)=>{const y=Ky,b=qy,_=ii;return Y(),Fe(_,{width:"746px",open:s.value,"onUpdate:open":g[1]||(g[1]=x=>s.value=x),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:d},{default:V(()=>[E("div",J2,[r.options.length?(Y(),Fe(b,{key:0,value:o.value,"onUpdate:value":g[0]||(g[0]=x=>o.value=x),style:{width:"100%"}},{default:V(()=>[E("div",Z2,[(Y(!0),se(it,null,ft(i.options,x=>(Y(),se("div",{class:"list-item-wraapper",key:x.id},[B(y,{class:"list-item",value:x.id},{default:V(()=>[E("div",Q2,De(x.name),1),E("div",eN,De(x.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):Qe("",!0),r.options.length?Qe("",!0):(Y(),se("div",tN,[g[3]||(g[3]=E("img",{src:Ih,alt:""},null,-1)),E("div",null,[g[2]||(g[2]=He(" 暂无数据表, 请先去添加数据表 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},rN=pt(nN,[["__scopeId","data-v-51756847"]]),iN={class:""},oN={key:0,class:"data-table-info"},aN={class:"data-table-name"},sN={class:"data-table-desc"},lN={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(r,{emit:e}){const t=e,n=r,i=Ce(null),o=Kt(()=>{let c=n.options.filter(f=>f.id===n.value);return c.length?c[0]:null}),s=()=>{i.value.open()},l=(c,f)=>{t("update:value",c),t("change",c,f)},d=()=>{t("update:value",""),t("change","")};return(c,f)=>{const v=ni,g=In;return Y(),se("div",iN,[n.value?(Y(),se("div",oN,[E("div",aN,De(o.value?o.value.name:n.title),1),E("div",sN,De(o.value?o.value.description:n.description),1),B(v,{class:"del-btn",name:"close-circle",onClick:d})])):(Y(),Fe(g,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:s},{default:V(()=>[B(je(Rn)),f[0]||(f[0]=He(" 选择数据表"))]),_:1,__:[0]})),B(rN,{ref_key:"tableSelectAlertRef",ref:i,onOk:l,options:r.options},null,8,["options"])])}}},Qd=pt(lN,[["__scopeId","data-v-618f643f"]]),uN={class:"add-data-form"},dN={class:"node-box-content"},cN={class:"setting-box"},fN={class:"setting-box"},hN={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Oo();let o={};const s=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=(y,b)=>{b?(s.formData.form_name=b.name,s.formData.form_description=b.description,g(b.id)):(s.formData.form_name="",s.formData.form_description="",s.formData.datas=[]),f()},d=y=>{s.formData.datas=y,f()},c=()=>{let y=n.node.dataRaw||n.node.node_params||"{}";o=JSON.parse(y),s.formData=o.form_insert,f()},f=()=>{o.form_insert=zi(s.formData),t("update-node",{...n.node,node_params:JSON.stringify(o)})},v=async()=>{const y=await i.getFormList();s.tableList=y},g=async y=>{i.getFormFieldList({form_id:y}).then(b=>{b.forEach(_=>{_.id=_.id*1}),s.formData.datas=b,f()}).catch(()=>{})};return Xt(()=>{v(),c()}),(y,b)=>(Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:V(()=>b[1]||(b[1]=[E("span",null,[He("在指定数据表中插入数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",uN,[E("div",dN,[b[2]||(b[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Hl,alt:""}),E("span",{class:"text"},"输入")],-1)),b[3]||(b[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",cN,[B(Qd,{options:s.tableList,title:s.formData.form_name,description:s.formData.form_description,value:s.formData.form_id,"onUpdate:value":b[0]||(b[0]=_=>s.formData.form_id=_),onChange:l},null,8,["options","title","description","value"])]),b[4]||(b[4]=E("div",{class:"setting-label"},[E("span",null,"插入数据"),E("span",{class:"tip"},"（不填写字段值则为空）")],-1)),E("div",fN,[B(jh,{"form-id":s.formData.form_id,showEmptyFieldRow:s.formData.form_id=="",list:s.formData.datas,showAdd:!1,showDelete:!1,onChange:d},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},pN=pt(hN,[["__scopeId","data-v-9c25c5a9"]]),vN={class:"library-checkbox-box"},gN={class:"list-tools"},mN={class:"list-box",ref:"scrollContainer"},yN={class:"library-name"},_N={class:"library-desc"},bN={__name:"library-select-alert",emits:["change","close"],setup(r,{expose:e,emit:t}){const n=t,i=Vt({indeterminate:!1,checkAll:!1,checkedList:[]}),o=Ce(!1),s=w=>{g(),i.checkedList=w,o.value=!0},l=()=>{o.value=!1,v()},d=Ce(""),c=()=>{g()},f=Ce([]),v=()=>{n("change",[...i.checkedList])},g=async()=>{const w=await Th({library_name:d.value,type:""});if(w){let C=w.data||[];f.value=C}},y=Ce(!1),b=async()=>{y.value=!0,await g(),y.value=!1,no.success("刷新完成")},_=()=>{window.open("/#/library/add")},x=()=>{n("close")};return e({open:s}),(w,C)=>{const k=Sr,D=In,I=dC,$=uC,R=Jy,F=ii;return Y(),Fe(F,{width:"746px",open:o.value,"onUpdate:open":C[2]||(C[2]=z=>o.value=z),title:"关联知识库",onCancel:x,onOk:l,okText:"确定",cancelText:"取消"},{default:V(()=>[E("div",vN,[E("div",gN,[E("div",null,[B(k,{style:{width:"282px"},value:d.value,"onUpdate:value":C[0]||(C[0]=z=>d.value=z),placeholder:"请输入知识库名称搜索",onChange:c},{suffix:V(()=>[B(je(sC),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),E("div",null,[B(D,{style:{"margin-right":"8px"},onClick:b},{default:V(()=>[B(je(lC)),C[3]||(C[3]=He(" 刷新 "))]),_:1,__:[3]}),B(D,{type:"primary",ghost:"",onClick:_},{default:V(()=>C[4]||(C[4]=[He("新建知识库")])),_:1,__:[4]})])]),B(R,{spinning:y.value,delay:100},{default:V(()=>[B($,{value:i.checkedList,"onUpdate:value":C[1]||(C[1]=z=>i.checkedList=z),style:{width:"100%"}},{default:V(()=>[E("div",mN,[(Y(!0),se(it,null,ft(f.value,z=>(Y(),se("div",{class:"list-item-wraapper",key:z.id},[B(I,{class:"list-item",value:z.id},{default:V(()=>[E("div",yN,De(z.library_name),1),E("div",_N,De(z.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},xN=pt(bN,[["__scopeId","data-v-ae6d969c"]]),wN={class:"recall-settings-box"},SN={class:"form-box"},EN={class:"form-item is-required"},CN={class:"form-item-body"},ON={class:"retrieval-mode-items"},kN=["onClick"],NN={class:"retrieval-mode-title"},MN={class:"title-text"},AN={class:"retrieval-mode-desc"},TN={class:"form-item"},DN={class:"form-item-label"},LN={class:"form-item-body"},PN={class:"number-box"},RN={class:"number-slider-box"},IN={class:"number-input-box"},BN={class:"form-item"},jN={class:"form-item-label"},HN={class:"form-item-body"},$N={class:"number-box"},FN={class:"number-slider-box"},zN={class:"number-input-box"},WN={class:"form-item"},UN={class:"form-item-label"},VN={class:"form-item-body"},XN=["src"],GN={__name:"recall-settings-alert",emits:["change"],setup(r,{expose:e,emit:t}){const n=t,i=Ce([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=Vt({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=Ce(!1),l=_=>{b(),o.rerank_status=_.rerank_status||0,o.rerank_use_model=_.rerank_use_model||void 0,o.rerank_model_config_id=_.rerank_model_config_id||"",o.top_k=_.top_k,o.similarity=_.similarity,o.search_type=_.search_type,s.value=!0},d=(_,x)=>{o.rerank_model_config_id=x.rerank_model_config_id},c=_=>{o.search_type=_},f=()=>o.rerank_status==1&&!o.rerank_model_config_id,v=()=>{if(f())return no.error("请选择Rerank模型");s.value=!1,g()},g=()=>{n("change",zi(o))},y=Ce([]),b=()=>{zy({model_type:"RERANK"}).then(_=>{let x=_.data||[];y.value=x.map(w=>({id:w.model_config.id,name:w.model_info.model_name,icon:w.model_info.model_icon_url,children:w.model_info.rerank_model_list}))})};return e({open:l}),(_,x)=>{const w=ni,C=Ci,k=Bl,D=Ui,I=oa,$=fs,R=Rr,F=cC,z=Pr,ie=ii;return Y(),Fe(ie,{width:"472px",open:s.value,"onUpdate:open":x[6]||(x[6]=G=>s.value=G),title:"召回设置",onOk:v,okText:"确定",cancelText:"取消"},{default:V(()=>[E("div",wN,[E("div",SN,[E("div",EN,[x[7]||(x[7]=E("div",{class:"form-item-label"},[E("span",null,"检索模式")],-1)),E("div",CN,[E("div",ON,[(Y(!0),se(it,null,ft(i.value,G=>(Y(),se("div",{class:wn(["retrieval-mode-item",{active:o.search_type==G.value}]),key:G.value,onClick:Q=>c(G.value)},[o.search_type==G.value?(Y(),Fe(w,{key:0,class:"check-arrow",name:"check-arrow-filled"})):Qe("",!0),E("div",NN,[B(w,{name:G.iconName,class:"title-icon"},null,8,["name"]),E("span",MN,De(G.title),1),G.isRecommendation?(Y(),Fe(w,{key:0,class:"recommendation-icon",name:"recommendation"})):Qe("",!0)]),E("div",AN,De(G.desc),1)],10,kN))),128))])])]),E("div",TN,[E("div",DN,[x[9]||(x[9]=E("span",null,"Top K ",-1)),B(C,null,{title:V(()=>x[8]||(x[8]=[He("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),E("div",LN,[E("div",PN,[E("div",RN,[B(k,{class:"custom-slider",value:o.top_k,"onUpdate:value":x[0]||(x[0]=G=>o.top_k=G),min:1,max:10},null,8,["value"])]),E("div",IN,[B(D,{value:o.top_k,"onUpdate:value":x[1]||(x[1]=G=>o.top_k=G),min:1,max:10},null,8,["value"])])])])]),E("div",BN,[E("div",jN,[x[11]||(x[11]=E("span",null,"相似度阈值 ",-1)),B(C,null,{title:V(()=>x[10]||(x[10]=[He("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),E("div",HN,[E("div",$N,[E("div",FN,[B(k,{class:"custom-slider",value:o.similarity,"onUpdate:value":x[2]||(x[2]=G=>o.similarity=G),min:0,max:1,step:.01},null,8,["value"])]),E("div",zN,[B(D,{value:o.similarity,"onUpdate:value":x[3]||(x[3]=G=>o.similarity=G),min:0,max:1,step:.01},null,8,["value"])])])])]),E("div",WN,[E("div",UN,[x[12]||(x[12]=E("span",null,"Rerank模型",-1)),x[13]||(x[13]=He("   ")),B(I,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":x[4]||(x[4]=G=>o.rerank_status=G)},null,8,["checked"])]),E("div",VN,[B(z,{value:o.rerank_use_model,"onUpdate:value":x[5]||(x[5]=G=>o.rerank_use_model=G),placeholder:"请选择Rerank模型",onChange:d,style:{width:"320px"}},{default:V(()=>[(Y(!0),se(it,null,ft(y.value,G=>(Y(),Fe(F,{key:G.id},{label:V(()=>[B($,{align:"center",gap:8},{default:V(()=>[E("img",{class:"model-icon",src:G.icon,alt:""},null,8,XN),He(De(G.name),1)]),_:2},1024)]),default:V(()=>[(Y(!0),se(it,null,ft(G.children,Q=>(Y(),Fe(R,{value:Q,rerank_model_config_id:G.id,key:Q},{default:V(()=>[E("span",null,De(Q),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},YN=pt(GN,[["__scopeId","data-v-56081df4"]]),qN={class:"problem-optimization-form"},KN={class:"node-form-content"},JN={class:"gray-block"},ZN={class:"avatar-box"},QN=["src"],eM={class:"content-box"},tM={class:"list-name"},nM={class:"list-intro"},rM=["onClick"],iM={class:"btn-block"},oM={class:"diy-form-item"},aM={class:"form-content"},sM={class:"form-content"},lM={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Ce([]);function o(){const F=n.lf.getNodeModelById(n.nodeId);if(F){let z=F.getAllParentVariable();i.value=s(z)}}function s(F){return F.forEach(z=>{z.typ=="node"?z.node_type==1?z.value="global":z.value=z.node_id:z.value=z.key,z.children&&z.children.length>0&&(z.children=s(z.children))}),F}function l(F){if(F){let z=F.split("."),ie=z[0],G=z.filter((Q,T)=>T>0).join(".");return[ie,G]}return["global","question"]}const d=Ce(),c=Vt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:""}),f=()=>{const F=JSON.stringify({libs:{...c,rerank_model_config_id:c.rerank_model_config_id?+c.rerank_model_config_id:void 0,question_value:c.question_value.join("."),library_ids:c.library_ids.join(",")}});t("update-node",{...n.node,...c,node_params:F})},v=()=>{try{let F=n.node.dataRaw||n.node.node_params||"{}",z=JSON.parse(F).libs||{};o(),z=JSON.parse(JSON.stringify(z));for(let ie in z)ie=="library_ids"?c[ie]=z[ie]?z[ie].split(","):[]:ie=="question_value"?c.question_value=l(z.question_value):c[ie]=z[ie]}catch(F){}},g=Ce([]),y=Ce(null),b=Kt(()=>g.value.filter(F=>c.library_ids.includes(F.id))),_=F=>{let z=c.library_ids.indexOf(F.id);c.library_ids.splice(z,1)},x=F=>{I(),c.library_ids=[...F]},w=()=>{y.value.open([...c.library_ids])},C=Ce(null),k=()=>{C.value.open(zi(c))},D=F=>{c.rerank_status=F.rerank_status,c.rerank_use_model=F.rerank_use_model,c.rerank_model_config_id=F.rerank_model_config_id,c.top_k=F.top_k,c.similarity=F.similarity,c.search_type=F.search_type},I=async()=>{const F=await Th({type:""});F&&(g.value=F.data||[])};qt(()=>c,()=>{f()},{deep:!0});const $=F=>{F||o()},R=()=>{t("close")};return Xt(()=>{v(),I()}),(F,z)=>{const ie=In,G=Wi,Q=cs,T=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:R},null,8,["title","iconName"])]),default:V(()=>[E("div",qN,[E("div",KN,[B(T,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:V(()=>[E("div",JN,[z[4]||(z[4]=E("div",{class:"gray-block-title"},"输入",-1)),B(G,{label:"关联知识库"},{default:V(()=>[(Y(!0),se(it,null,ft(b.value,W=>(Y(),se("div",{class:"konwledge-list-item",key:W.id},[E("div",ZN,[E("img",{src:W.avatar,alt:""},null,8,QN)]),E("div",eM,[E("div",tM,De(W.library_name),1),E("div",nM,De(W.library_intro),1)]),E("div",{class:"btn-hover-wrap",onClick:P=>_(W)},[B(je(cr))],8,rM)]))),128)),E("div",iM,[E("div",null,[B(ie,{onClick:w,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>z[1]||(z[1]=[He("添加知识库")])),_:1,__:[1]},8,["icon"])]),E("div",null,[B(ie,{onClick:k,icon:Dn(je(fC)),block:"",type:"dashed"},{default:V(()=>z[2]||(z[2]=[He("召回设置")])),_:1,__:[2]},8,["icon"])])])]),_:1}),E("div",oM,[z[3]||(z[3]=E("div",{class:"form-label"},"用户问题",-1)),E("div",aM,[E("div",sM,[B(Q,{value:c.question_value,"onUpdate:value":z[0]||(z[0]=W=>c.question_value=W),onDropdownVisibleChange:$,style:{width:"220px"},options:i.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),z[5]||(z[5]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"知识库引用"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[5]},8,["model"]),B(xN,{ref_key:"librarySelectAlertRef",ref:y,onClose:I,onChange:x},null,512),B(YN,{ref_key:"recallSettingsAlertRef",ref:C,onChange:D},null,512)])])]),_:1})}}},uM=pt(lM,[["__scopeId","data-v-711d67f3"]]),Va="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",dM={class:"sub-field-item"},cM=["onClick"],fM=["onClick"],hM={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=Kt(()=>e.level>2?e.typOptions.filter(d=>d.value!="object"):e.typOptions),n=Kt(()=>e.level==2?"180px":"146px"),i=(d,c)=>{c[d].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(d,c)=>{c.splice(d,1)},s=d=>{d.subs=[]},l=d=>d.typ=="object"&&e.level<=2;return(d,c)=>{const f=Sr,v=Rr,g=Pr,y=kn("SubsKey",!0);return Y(!0),se(it,null,ft(e.data,(b,_)=>(Y(),se("div",{class:wn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:b.cu_key},[E("div",dM,[c[0]||(c[0]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(f,{class:"mr12",style:Si({width:n.value}),value:b.key,"onUpdate:value":x=>b.key=x,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),c[1]||(c[1]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(g,{class:"mr12",onChange:x=>s(b),value:b.typ,"onUpdate:value":x=>b.typ=x,placeholder:"请选择",style:Si({width:n.value})},{default:V(()=>[(Y(!0),se(it,null,ft(t.value,x=>(Y(),Fe(v,{value:x.value},{default:V(()=>[He(De(x.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(b)?(Y(),se("div",{key:0,class:"btn-hover-wrap mr12",onClick:x=>i(_,e.data)},[B(je(hs))],8,cM)):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:x=>o(_,e.data)},[B(je(cr))],8,fM)]),b.subs&&b.subs.length>0?(Y(),Fe(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:b.subs},null,8,["level","typOptions","data"])):Qe("",!0)],2))),128)}}},pM=pt(hM,[["__scopeId","data-v-01969e8c"]]);var cg={exports:{}},Yu={exports:{}},vM=Yu.exports,fg;function ko(){return fg||(fg=1,function(r,e){(function(t,n){r.exports=n()})(vM,function(){var t=navigator.userAgent,n=navigator.platform,i=/gecko\/\d/i.test(t),o=/MSIE \d/.test(t),s=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),l=/Edge\/(\d+)/.exec(t),d=o||s||l,c=d&&(o?document.documentMode||6:+(l||s)[1]),f=!l&&/WebKit\//.test(t),v=f&&/Qt\/\d+\.\d+/.test(t),g=!l&&/Chrome\/(\d+)/.exec(t),y=g&&+g[1],b=/Opera\//.test(t),_=/Apple Computer/.test(navigator.vendor),x=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),w=/PhantomJS/.test(t),C=_&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),k=/Android/.test(t),D=C||k||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),I=C||/Mac/.test(n),$=/\bCrOS\b/.test(t),R=/win/i.test(n),F=b&&t.match(/Version\/(\d*\.\d*)/);F&&(F=Number(F[1])),F&&F>=15&&(b=!1,f=!0);var z=I&&(v||b&&(F==null||F<12.11)),ie=i||d&&c>=9;function G(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}var Q=function(a,u){var p=a.className,h=G(u).exec(p);if(h){var m=p.slice(h.index+h[0].length);a.className=p.slice(0,h.index)+(m?h[1]+m:"")}};function T(a){for(var u=a.childNodes.length;u>0;--u)a.removeChild(a.firstChild);return a}function W(a,u){return T(a).appendChild(u)}function P(a,u,p,h){var m=document.createElement(a);if(p&&(m.className=p),h&&(m.style.cssText=h),typeof u=="string")m.appendChild(document.createTextNode(u));else if(u)for(var S=0;S<u.length;++S)m.appendChild(u[S]);return m}function le(a,u,p,h){var m=P(a,u,p,h);return m.setAttribute("role","presentation"),m}var me;document.createRange?me=function(a,u,p,h){var m=document.createRange();return m.setEnd(h||a,p),m.setStart(a,u),m}:me=function(a,u,p){var h=document.body.createTextRange();try{h.moveToElementText(a.parentNode)}catch{return h}return h.collapse(!0),h.moveEnd("character",p),h.moveStart("character",u),h};function he(a,u){if(u.nodeType==3&&(u=u.parentNode),a.contains)return a.contains(u);do if(u.nodeType==11&&(u=u.host),u==a)return!0;while(u=u.parentNode)}function Ne(a){var u=a.ownerDocument||a,p;try{p=a.activeElement}catch{p=u.body||null}for(;p&&p.shadowRoot&&p.shadowRoot.activeElement;)p=p.shadowRoot.activeElement;return p}function ye(a,u){var p=a.className;G(u).test(p)||(a.className+=(p?" ":"")+u)}function ae(a,u){for(var p=a.split(" "),h=0;h<p.length;h++)p[h]&&!G(p[h]).test(u)&&(u+=" "+p[h]);return u}var Re=function(a){a.select()};C?Re=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:d&&(Re=function(a){try{a.select()}catch{}});function Le(a){return a.display.wrapper.ownerDocument}function Ve(a){return Ae(a.display.wrapper)}function Ae(a){return a.getRootNode?a.getRootNode():a.ownerDocument}function te(a){return Le(a).defaultView}function ce(a){var u=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,u)}}function _e(a,u,p){u||(u={});for(var h in a)a.hasOwnProperty(h)&&(p!==!1||!u.hasOwnProperty(h))&&(u[h]=a[h]);return u}function Ie(a,u,p,h,m){u==null&&(u=a.search(/[^\s\u00a0]/),u==-1&&(u=a.length));for(var S=h||0,O=m||0;;){var A=a.indexOf("	",S);if(A<0||A>=u)return O+(u-S);O+=A-S,O+=p-O%p,S=A+1}}var Ke=function(){this.id=null,this.f=null,this.time=0,this.handler=ce(this.onTimeout,this)};Ke.prototype.onTimeout=function(a){a.id=0,a.time<=+new Date?a.f():setTimeout(a.handler,a.time-+new Date)},Ke.prototype.set=function(a,u){this.f=u;var p=+new Date+a;(!this.id||p<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,a),this.time=p)};function $e(a,u){for(var p=0;p<a.length;++p)if(a[p]==u)return p;return-1}var Ue=50,Nt={toString:function(){return"CodeMirror.Pass"}},ot={scroll:!1},Bt={origin:"*mouse"},bt={origin:"+move"};function rn(a,u,p){for(var h=0,m=0;;){var S=a.indexOf("	",h);S==-1&&(S=a.length);var O=S-h;if(S==a.length||m+O>=u)return h+Math.min(O,u-m);if(m+=S-h,m+=p-m%p,h=S+1,m>=u)return h}}var ln=[""];function Z(a){for(;ln.length<=a;)ln.push(N(ln)+" ");return ln[a]}function N(a){return a[a.length-1]}function H(a,u){for(var p=[],h=0;h<a.length;h++)p[h]=u(a[h],h);return p}function J(a,u,p){for(var h=0,m=p(u);h<a.length&&p(a[h])<=m;)h++;a.splice(h,0,u)}function X(){}function re(a,u){var p;return Object.create?p=Object.create(a):(X.prototype=a,p=new X),u&&_e(u,p),p}var ne=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ue(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||ne.test(a))}function we(a,u){return u?u.source.indexOf("\\w")>-1&&ue(a)?!0:u.test(a):ue(a)}function Se(a){for(var u in a)if(a.hasOwnProperty(u)&&a[u])return!1;return!0}var Pe=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Ge(a){return a.charCodeAt(0)>=768&&Pe.test(a)}function at(a,u,p){for(;(p<0?u>0:u<a.length)&&Ge(a.charAt(u));)u+=p;return u}function ut(a,u,p){for(var h=u>p?-1:1;;){if(u==p)return u;var m=(u+p)/2,S=h<0?Math.ceil(m):Math.floor(m);if(S==u)return a(S)?u:p;a(S)?p=S:u=S+h}}function kt(a,u,p,h){if(!a)return h(u,p,"ltr",0);for(var m=!1,S=0;S<a.length;++S){var O=a[S];(O.from<p&&O.to>u||u==p&&O.to==u)&&(h(Math.max(O.from,u),Math.min(O.to,p),O.level==1?"rtl":"ltr",S),m=!0)}m||h(u,p,"ltr")}var Xe=null;function rt(a,u,p){var h;Xe=null;for(var m=0;m<a.length;++m){var S=a[m];if(S.from<u&&S.to>u)return m;S.to==u&&(S.from!=S.to&&p=="before"?h=m:Xe=m),S.from==u&&(S.from!=S.to&&p!="before"?h=m:Xe=m)}return h??Xe}var Tt=function(){var a="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",u="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function p(j){return j<=247?a.charAt(j):1424<=j&&j<=1524?"R":1536<=j&&j<=1785?u.charAt(j-1536):1774<=j&&j<=2220?"r":8192<=j&&j<=8203?"w":j==8204?"b":"L"}var h=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,m=/[stwN]/,S=/[LRr]/,O=/[Lb1n]/,A=/[1n]/;function L(j,ee,oe){this.level=j,this.from=ee,this.to=oe}return function(j,ee){var oe=ee=="ltr"?"L":"R";if(j.length==0||ee=="ltr"&&!h.test(j))return!1;for(var ve=j.length,fe=[],Te=0;Te<ve;++Te)fe.push(p(j.charCodeAt(Te)));for(var Be=0,Ye=oe;Be<ve;++Be){var tt=fe[Be];tt=="m"?fe[Be]=Ye:Ye=tt}for(var st=0,nt=oe;st<ve;++st){var dt=fe[st];dt=="1"&&nt=="r"?fe[st]="n":S.test(dt)&&(nt=dt,dt=="r"&&(fe[st]="R"))}for(var St=1,xt=fe[0];St<ve-1;++St){var jt=fe[St];jt=="+"&&xt=="1"&&fe[St+1]=="1"?fe[St]="1":jt==","&&xt==fe[St+1]&&(xt=="1"||xt=="n")&&(fe[St]=xt),xt=jt}for(var hn=0;hn<ve;++hn){var Vn=fe[hn];if(Vn==",")fe[hn]="N";else if(Vn=="%"){var bn=void 0;for(bn=hn+1;bn<ve&&fe[bn]=="%";++bn);for(var Dr=hn&&fe[hn-1]=="!"||bn<ve&&fe[bn]=="1"?"1":"N",mr=hn;mr<bn;++mr)fe[mr]=Dr;hn=bn-1}}for(var Nn=0,yr=oe;Nn<ve;++Nn){var qn=fe[Nn];yr=="L"&&qn=="1"?fe[Nn]="L":S.test(qn)&&(yr=qn)}for(var Ln=0;Ln<ve;++Ln)if(m.test(fe[Ln])){var Mn=void 0;for(Mn=Ln+1;Mn<ve&&m.test(fe[Mn]);++Mn);for(var Sn=(Ln?fe[Ln-1]:oe)=="L",_r=(Mn<ve?fe[Mn]:oe)=="L",Oa=Sn==_r?Sn?"L":"R":oe,vo=Ln;vo<Mn;++vo)fe[vo]=Oa;Ln=Mn-1}for(var Qn=[],Ti,Xn=0;Xn<ve;)if(O.test(fe[Xn])){var af=Xn;for(++Xn;Xn<ve&&O.test(fe[Xn]);++Xn);Qn.push(new L(0,af,Xn))}else{var Ji=Xn,$o=Qn.length,Fo=ee=="rtl"?1:0;for(++Xn;Xn<ve&&fe[Xn]!="L";++Xn);for(var sr=Ji;sr<Xn;)if(A.test(fe[sr])){Ji<sr&&(Qn.splice($o,0,new L(1,Ji,sr)),$o+=Fo);var ka=sr;for(++sr;sr<Xn&&A.test(fe[sr]);++sr);Qn.splice($o,0,new L(2,ka,sr)),$o+=Fo,Ji=sr}else++sr;Ji<Xn&&Qn.splice($o,0,new L(1,Ji,Xn))}return ee=="ltr"&&(Qn[0].level==1&&(Ti=j.match(/^\s+/))&&(Qn[0].from=Ti[0].length,Qn.unshift(new L(0,0,Ti[0].length))),N(Qn).level==1&&(Ti=j.match(/\s+$/))&&(N(Qn).to-=Ti[0].length,Qn.push(new L(0,ve-Ti[0].length,ve)))),ee=="rtl"?Qn.reverse():Qn}}();function et(a,u){var p=a.order;return p==null&&(p=a.order=Tt(a.text,u)),p}var cn=[],lt=function(a,u,p){if(a.addEventListener)a.addEventListener(u,p,!1);else if(a.attachEvent)a.attachEvent("on"+u,p);else{var h=a._handlers||(a._handlers={});h[u]=(h[u]||cn).concat(p)}};function fn(a,u){return a._handlers&&a._handlers[u]||cn}function Ut(a,u,p){if(a.removeEventListener)a.removeEventListener(u,p,!1);else if(a.detachEvent)a.detachEvent("on"+u,p);else{var h=a._handlers,m=h&&h[u];if(m){var S=$e(m,p);S>-1&&(h[u]=m.slice(0,S).concat(m.slice(S+1)))}}}function Pt(a,u){var p=fn(a,u);if(p.length)for(var h=Array.prototype.slice.call(arguments,2),m=0;m<p.length;++m)p[m].apply(null,h)}function Rt(a,u,p){return typeof u=="string"&&(u={type:u,preventDefault:function(){this.defaultPrevented=!0}}),Pt(a,p||u.type,a,u),$t(u)||u.codemirrorIgnore}function Jt(a){var u=a._handlers&&a._handlers.cursorActivity;if(u)for(var p=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),h=0;h<u.length;++h)$e(p,u[h])==-1&&p.push(u[h])}function xe(a,u){return fn(a,u).length>0}function qe(a){a.prototype.on=function(u,p){lt(this,u,p)},a.prototype.off=function(u,p){Ut(this,u,p)}}function ht(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function _t(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function $t(a){return a.defaultPrevented!=null?a.defaultPrevented:a.returnValue==!1}function zt(a){ht(a),_t(a)}function Jn(a){return a.target||a.srcElement}function gn(a){var u=a.which;return u==null&&(a.button&1?u=1:a.button&2?u=3:a.button&4&&(u=2)),I&&a.ctrlKey&&u==1&&(u=3),u}var $n=function(){if(d&&c<9)return!1;var a=P("div");return"draggable"in a||"dragDrop"in a}(),Ur;function Vr(a){if(Ur==null){var u=P("span","​");W(a,P("span",[u,document.createTextNode("x")])),a.firstChild.offsetHeight!=0&&(Ur=u.offsetWidth<=1&&u.offsetHeight>2&&!(d&&c<8))}var p=Ur?P("span","​"):P("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return p.setAttribute("cm-text",""),p}var Gt;function Or(a){if(Gt!=null)return Gt;var u=W(a,document.createTextNode("AخA")),p=me(u,0,1).getBoundingClientRect(),h=me(u,1,2).getBoundingClientRect();return T(a),!p||p.left==p.right?!1:Gt=h.right-p.right<3}var En=`

b`.split(/\n/).length!=3?function(a){for(var u=0,p=[],h=a.length;u<=h;){var m=a.indexOf(`
`,u);m==-1&&(m=a.length);var S=a.slice(u,a.charAt(m-1)=="\r"?m-1:m),O=S.indexOf("\r");O!=-1?(p.push(S.slice(0,O)),u+=O+1):(p.push(S),u=m+1)}return p}:function(a){return a.split(/\r\n?|\n/)},kr=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch{return!1}}:function(a){var u;try{u=a.ownerDocument.selection.createRange()}catch{}return!u||u.parentElement()!=a?!1:u.compareEndPoints("StartToEnd",u)!=0},ai=function(){var a=P("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),typeof a.oncopy=="function")}(),Et=null;function Ni(a){if(Et!=null)return Et;var u=W(a,P("span","x")),p=u.getBoundingClientRect(),h=me(u,0,1).getBoundingClientRect();return Et=Math.abs(p.left-h.left)>1}var jr={},Fn={};function ir(a,u){arguments.length>2&&(u.dependencies=Array.prototype.slice.call(arguments,2)),jr[a]=u}function or(a,u){Fn[a]=u}function Nr(a){if(typeof a=="string"&&Fn.hasOwnProperty(a))a=Fn[a];else if(a&&typeof a.name=="string"&&Fn.hasOwnProperty(a.name)){var u=Fn[a.name];typeof u=="string"&&(u={name:u}),a=re(u,a),a.name=u.name}else{if(typeof a=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return Nr("application/xml");if(typeof a=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(a))return Nr("application/json")}return typeof a=="string"?{name:a}:a||{name:"null"}}function Xr(a,u){u=Nr(u);var p=jr[u.name];if(!p)return Xr(a,"text/plain");var h=p(a,u);if(Mr.hasOwnProperty(u.name)){var m=Mr[u.name];for(var S in m)m.hasOwnProperty(S)&&(h.hasOwnProperty(S)&&(h["_"+S]=h[S]),h[S]=m[S])}if(h.name=u.name,u.helperType&&(h.helperType=u.helperType),u.modeProps)for(var O in u.modeProps)h[O]=u.modeProps[O];return h}var Mr={};function Hr(a,u){var p=Mr.hasOwnProperty(a)?Mr[a]:Mr[a]={};_e(u,p)}function q(a,u){if(u===!0)return u;if(a.copyState)return a.copyState(u);var p={};for(var h in u){var m=u[h];m instanceof Array&&(m=m.concat([])),p[h]=m}return p}function ge(a,u){for(var p;a.innerMode&&(p=a.innerMode(u),!(!p||p.mode==a));)u=p.state,a=p.mode;return p||{mode:a,state:u}}function ze(a,u,p){return a.startState?a.startState(u,p):!0}var Ze=function(a,u,p){this.pos=this.start=0,this.string=a,this.tabSize=u||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=p};Ze.prototype.eol=function(){return this.pos>=this.string.length},Ze.prototype.sol=function(){return this.pos==this.lineStart},Ze.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Ze.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Ze.prototype.eat=function(a){var u=this.string.charAt(this.pos),p;if(typeof a=="string"?p=u==a:p=u&&(a.test?a.test(u):a(u)),p)return++this.pos,u},Ze.prototype.eatWhile=function(a){for(var u=this.pos;this.eat(a););return this.pos>u},Ze.prototype.eatSpace=function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},Ze.prototype.skipToEnd=function(){this.pos=this.string.length},Ze.prototype.skipTo=function(a){var u=this.string.indexOf(a,this.pos);if(u>-1)return this.pos=u,!0},Ze.prototype.backUp=function(a){this.pos-=a},Ze.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Ie(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Ie(this.string,this.lineStart,this.tabSize):0)},Ze.prototype.indentation=function(){return Ie(this.string,null,this.tabSize)-(this.lineStart?Ie(this.string,this.lineStart,this.tabSize):0)},Ze.prototype.match=function(a,u,p){if(typeof a=="string"){var h=function(O){return p?O.toLowerCase():O},m=this.string.substr(this.pos,a.length);if(h(m)==h(a))return u!==!1&&(this.pos+=a.length),!0}else{var S=this.string.slice(this.pos).match(a);return S&&S.index>0?null:(S&&u!==!1&&(this.pos+=S[0].length),S)}},Ze.prototype.current=function(){return this.string.slice(this.start,this.pos)},Ze.prototype.hideFirstChars=function(a,u){this.lineStart+=a;try{return u()}finally{this.lineStart-=a}},Ze.prototype.lookAhead=function(a){var u=this.lineOracle;return u&&u.lookAhead(a)},Ze.prototype.baseToken=function(){var a=this.lineOracle;return a&&a.baseToken(this.pos)};function We(a,u){if(u-=a.first,u<0||u>=a.size)throw new Error("There is no line "+(u+a.first)+" in the document.");for(var p=a;!p.lines;)for(var h=0;;++h){var m=p.children[h],S=m.chunkSize();if(u<S){p=m;break}u-=S}return p.lines[u]}function It(a,u,p){var h=[],m=u.line;return a.iter(u.line,p.line+1,function(S){var O=S.text;m==p.line&&(O=O.slice(0,p.ch)),m==u.line&&(O=O.slice(u.ch)),h.push(O),++m}),h}function pn(a,u,p){var h=[];return a.iter(u,p,function(m){h.push(m.text)}),h}function K(a,u){var p=u-a.height;if(p)for(var h=a;h;h=h.parent)h.height+=p}function M(a){if(a.parent==null)return null;for(var u=a.parent,p=$e(u.lines,a),h=u.parent;h;u=h,h=h.parent)for(var m=0;h.children[m]!=u;++m)p+=h.children[m].chunkSize();return p+u.first}function U(a,u){var p=a.first;e:do{for(var h=0;h<a.children.length;++h){var m=a.children[h],S=m.height;if(u<S){a=m;continue e}u-=S,p+=m.chunkSize()}return p}while(!a.lines);for(var O=0;O<a.lines.length;++O){var A=a.lines[O],L=A.height;if(u<L)break;u-=L}return p+O}function de(a,u){return u>=a.first&&u<a.first+a.size}function Ee(a,u){return String(a.lineNumberFormatter(u+a.firstLineNumber))}function pe(a,u,p){if(p===void 0&&(p=null),!(this instanceof pe))return new pe(a,u,p);this.line=a,this.ch=u,this.sticky=p}function be(a,u){return a.line-u.line||a.ch-u.ch}function Je(a,u){return a.sticky==u.sticky&&be(a,u)==0}function ct(a){return pe(a.line,a.ch)}function Ot(a,u){return be(a,u)<0?u:a}function Cn(a,u){return be(a,u)<0?a:u}function xs(a,u){return Math.max(a.first,Math.min(u,a.first+a.size-1))}function Mt(a,u){if(u.line<a.first)return pe(a.first,0);var p=a.first+a.size-1;return u.line>p?pe(p,We(a,p).text.length):Ar(u,We(a,u.line).text.length)}function Ar(a,u){var p=a.ch;return p==null||p>u?pe(a.line,u):p<0?pe(a.line,0):a}function la(a,u){for(var p=[],h=0;h<u.length;h++)p[h]=Mt(a,u[h]);return p}var io=function(a,u){this.state=a,this.lookAhead=u},mn=function(a,u,p,h){this.state=u,this.doc=a,this.line=p,this.maxLookAhead=h||0,this.baseTokens=null,this.baseTokenPos=1};mn.prototype.lookAhead=function(a){var u=this.doc.getLine(this.line+a);return u!=null&&a>this.maxLookAhead&&(this.maxLookAhead=a),u},mn.prototype.baseToken=function(a){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=a;)this.baseTokenPos+=2;var u=this.baseTokens[this.baseTokenPos+1];return{type:u&&u.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-a}},mn.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},mn.fromSaved=function(a,u,p){return u instanceof io?new mn(a,q(a.mode,u.state),p,u.lookAhead):new mn(a,q(a.mode,u),p)},mn.prototype.save=function(a){var u=a!==!1?q(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new io(u,this.maxLookAhead):u};function $r(a,u,p,h){var m=[a.state.modeGen],S={};vp(a,u.text,a.doc.mode,p,function(j,ee){return m.push(j,ee)},S,h);for(var O=p.state,A=function(j){p.baseTokens=m;var ee=a.state.overlays[j],oe=1,ve=0;p.state=!0,vp(a,u.text,ee.mode,p,function(fe,Te){for(var Be=oe;ve<fe;){var Ye=m[oe];Ye>fe&&m.splice(oe,1,fe,m[oe+1],Ye),oe+=2,ve=Math.min(fe,Ye)}if(Te)if(ee.opaque)m.splice(Be,oe-Be,fe,"overlay "+Te),oe=Be+2;else for(;Be<oe;Be+=2){var tt=m[Be+1];m[Be+1]=(tt?tt+" ":"")+"overlay "+Te}},S),p.state=O,p.baseTokens=null,p.baseTokenPos=1},L=0;L<a.state.overlays.length;++L)A(L);return{styles:m,classes:S.bgClass||S.textClass?S:null}}function Gl(a,u,p){if(!u.styles||u.styles[0]!=a.state.modeGen){var h=oo(a,M(u)),m=u.text.length>a.options.maxHighlightLength&&q(a.doc.mode,h.state),S=$r(a,u,h);m&&(h.state=m),u.stateAfter=h.save(!m),u.styles=S.styles,S.classes?u.styleClasses=S.classes:u.styleClasses&&(u.styleClasses=null),p===a.doc.highlightFrontier&&(a.doc.modeFrontier=Math.max(a.doc.modeFrontier,++a.doc.highlightFrontier))}return u.styles}function oo(a,u,p){var h=a.doc,m=a.display;if(!h.mode.startState)return new mn(h,!0,u);var S=zw(a,u,p),O=S>h.first&&We(h,S-1).stateAfter,A=O?mn.fromSaved(h,O,S):new mn(h,ze(h.mode),S);return h.iter(S,u,function(L){pc(a,L.text,A);var j=A.line;L.stateAfter=j==u-1||j%5==0||j>=m.viewFrom&&j<m.viewTo?A.save():null,A.nextLine()}),p&&(h.modeFrontier=A.line),A}function pc(a,u,p,h){var m=a.doc.mode,S=new Ze(u,a.options.tabSize,p);for(S.start=S.pos=h||0,u==""&&cp(m,p.state);!S.eol();)vc(m,S,p.state),S.start=S.pos}function cp(a,u){if(a.blankLine)return a.blankLine(u);if(a.innerMode){var p=ge(a,u);if(p.mode.blankLine)return p.mode.blankLine(p.state)}}function vc(a,u,p,h){for(var m=0;m<10;m++){h&&(h[0]=ge(a,p).mode);var S=a.token(u,p);if(u.pos>u.start)return S}throw new Error("Mode "+a.name+" failed to advance stream.")}var fp=function(a,u,p){this.start=a.start,this.end=a.pos,this.string=a.current(),this.type=u||null,this.state=p};function hp(a,u,p,h){var m=a.doc,S=m.mode,O;u=Mt(m,u);var A=We(m,u.line),L=oo(a,u.line,p),j=new Ze(A.text,a.options.tabSize,L),ee;for(h&&(ee=[]);(h||j.pos<u.ch)&&!j.eol();)j.start=j.pos,O=vc(S,j,L.state),h&&ee.push(new fp(j,O,q(m.mode,L.state)));return h?ee:new fp(j,O,L.state)}function pp(a,u){if(a)for(;;){var p=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!p)break;a=a.slice(0,p.index)+a.slice(p.index+p[0].length);var h=p[1]?"bgClass":"textClass";u[h]==null?u[h]=p[2]:new RegExp("(?:^|\\s)"+p[2]+"(?:$|\\s)").test(u[h])||(u[h]+=" "+p[2])}return a}function vp(a,u,p,h,m,S,O){var A=p.flattenSpans;A==null&&(A=a.options.flattenSpans);var L=0,j=null,ee=new Ze(u,a.options.tabSize,h),oe,ve=a.options.addModeClass&&[null];for(u==""&&pp(cp(p,h.state),S);!ee.eol();){if(ee.pos>a.options.maxHighlightLength?(A=!1,O&&pc(a,u,h,ee.pos),ee.pos=u.length,oe=null):oe=pp(vc(p,ee,h.state,ve),S),ve){var fe=ve[0].name;fe&&(oe="m-"+(oe?fe+" "+oe:fe))}if(!A||j!=oe){for(;L<ee.start;)L=Math.min(ee.start,L+5e3),m(L,j);j=oe}ee.start=ee.pos}for(;L<ee.pos;){var Te=Math.min(ee.pos,L+5e3);m(Te,j),L=Te}}function zw(a,u,p){for(var h,m,S=a.doc,O=p?-1:u-(a.doc.mode.innerMode?1e3:100),A=u;A>O;--A){if(A<=S.first)return S.first;var L=We(S,A-1),j=L.stateAfter;if(j&&(!p||A+(j instanceof io?j.lookAhead:0)<=S.modeFrontier))return A;var ee=Ie(L.text,null,a.options.tabSize);(m==null||h>ee)&&(m=A-1,h=ee)}return m}function Ww(a,u){if(a.modeFrontier=Math.min(a.modeFrontier,u),!(a.highlightFrontier<u-10)){for(var p=a.first,h=u-1;h>p;h--){var m=We(a,h).stateAfter;if(m&&(!(m instanceof io)||h+m.lookAhead<u)){p=h+1;break}}a.highlightFrontier=Math.min(a.highlightFrontier,p)}}var gp=!1,Xi=!1;function Uw(){gp=!0}function Vw(){Xi=!0}function Yl(a,u,p){this.marker=a,this.from=u,this.to=p}function ws(a,u){if(a)for(var p=0;p<a.length;++p){var h=a[p];if(h.marker==u)return h}}function Xw(a,u){for(var p,h=0;h<a.length;++h)a[h]!=u&&(p||(p=[])).push(a[h]);return p}function Gw(a,u,p){var h=p&&window.WeakSet&&(p.markedSpans||(p.markedSpans=new WeakSet));h&&a.markedSpans&&h.has(a.markedSpans)?a.markedSpans.push(u):(a.markedSpans=a.markedSpans?a.markedSpans.concat([u]):[u],h&&h.add(a.markedSpans)),u.marker.attachLine(a)}function Yw(a,u,p){var h;if(a)for(var m=0;m<a.length;++m){var S=a[m],O=S.marker,A=S.from==null||(O.inclusiveLeft?S.from<=u:S.from<u);if(A||S.from==u&&O.type=="bookmark"&&(!p||!S.marker.insertLeft)){var L=S.to==null||(O.inclusiveRight?S.to>=u:S.to>u);(h||(h=[])).push(new Yl(O,S.from,L?null:S.to))}}return h}function qw(a,u,p){var h;if(a)for(var m=0;m<a.length;++m){var S=a[m],O=S.marker,A=S.to==null||(O.inclusiveRight?S.to>=u:S.to>u);if(A||S.from==u&&O.type=="bookmark"&&(!p||S.marker.insertLeft)){var L=S.from==null||(O.inclusiveLeft?S.from<=u:S.from<u);(h||(h=[])).push(new Yl(O,L?null:S.from-u,S.to==null?null:S.to-u))}}return h}function gc(a,u){if(u.full)return null;var p=de(a,u.from.line)&&We(a,u.from.line).markedSpans,h=de(a,u.to.line)&&We(a,u.to.line).markedSpans;if(!p&&!h)return null;var m=u.from.ch,S=u.to.ch,O=be(u.from,u.to)==0,A=Yw(p,m,O),L=qw(h,S,O),j=u.text.length==1,ee=N(u.text).length+(j?m:0);if(A)for(var oe=0;oe<A.length;++oe){var ve=A[oe];if(ve.to==null){var fe=ws(L,ve.marker);fe?j&&(ve.to=fe.to==null?null:fe.to+ee):ve.to=m}}if(L)for(var Te=0;Te<L.length;++Te){var Be=L[Te];if(Be.to!=null&&(Be.to+=ee),Be.from==null){var Ye=ws(A,Be.marker);Ye||(Be.from=ee,j&&(A||(A=[])).push(Be))}else Be.from+=ee,j&&(A||(A=[])).push(Be)}A&&(A=mp(A)),L&&L!=A&&(L=mp(L));var tt=[A];if(!j){var st=u.text.length-2,nt;if(st>0&&A)for(var dt=0;dt<A.length;++dt)A[dt].to==null&&(nt||(nt=[])).push(new Yl(A[dt].marker,null,null));for(var St=0;St<st;++St)tt.push(nt);tt.push(L)}return tt}function mp(a){for(var u=0;u<a.length;++u){var p=a[u];p.from!=null&&p.from==p.to&&p.marker.clearWhenEmpty!==!1&&a.splice(u--,1)}return a.length?a:null}function Kw(a,u,p){var h=null;if(a.iter(u.line,p.line+1,function(fe){if(fe.markedSpans)for(var Te=0;Te<fe.markedSpans.length;++Te){var Be=fe.markedSpans[Te].marker;Be.readOnly&&(!h||$e(h,Be)==-1)&&(h||(h=[])).push(Be)}}),!h)return null;for(var m=[{from:u,to:p}],S=0;S<h.length;++S)for(var O=h[S],A=O.find(0),L=0;L<m.length;++L){var j=m[L];if(!(be(j.to,A.from)<0||be(j.from,A.to)>0)){var ee=[L,1],oe=be(j.from,A.from),ve=be(j.to,A.to);(oe<0||!O.inclusiveLeft&&!oe)&&ee.push({from:j.from,to:A.from}),(ve>0||!O.inclusiveRight&&!ve)&&ee.push({from:A.to,to:j.to}),m.splice.apply(m,ee),L+=ee.length-3}}return m}function yp(a){var u=a.markedSpans;if(u){for(var p=0;p<u.length;++p)u[p].marker.detachLine(a);a.markedSpans=null}}function _p(a,u){if(u){for(var p=0;p<u.length;++p)u[p].marker.attachLine(a);a.markedSpans=u}}function ql(a){return a.inclusiveLeft?-1:0}function Kl(a){return a.inclusiveRight?1:0}function mc(a,u){var p=a.lines.length-u.lines.length;if(p!=0)return p;var h=a.find(),m=u.find(),S=be(h.from,m.from)||ql(a)-ql(u);if(S)return-S;var O=be(h.to,m.to)||Kl(a)-Kl(u);return O||u.id-a.id}function bp(a,u){var p=Xi&&a.markedSpans,h;if(p)for(var m=void 0,S=0;S<p.length;++S)m=p[S],m.marker.collapsed&&(u?m.from:m.to)==null&&(!h||mc(h,m.marker)<0)&&(h=m.marker);return h}function xp(a){return bp(a,!0)}function Jl(a){return bp(a,!1)}function Jw(a,u){var p=Xi&&a.markedSpans,h;if(p)for(var m=0;m<p.length;++m){var S=p[m];S.marker.collapsed&&(S.from==null||S.from<u)&&(S.to==null||S.to>u)&&(!h||mc(h,S.marker)<0)&&(h=S.marker)}return h}function wp(a,u,p,h,m){var S=We(a,u),O=Xi&&S.markedSpans;if(O)for(var A=0;A<O.length;++A){var L=O[A];if(L.marker.collapsed){var j=L.marker.find(0),ee=be(j.from,p)||ql(L.marker)-ql(m),oe=be(j.to,h)||Kl(L.marker)-Kl(m);if(!(ee>=0&&oe<=0||ee<=0&&oe>=0)&&(ee<=0&&(L.marker.inclusiveRight&&m.inclusiveLeft?be(j.to,p)>=0:be(j.to,p)>0)||ee>=0&&(L.marker.inclusiveRight&&m.inclusiveLeft?be(j.from,h)<=0:be(j.from,h)<0)))return!0}}}function si(a){for(var u;u=xp(a);)a=u.find(-1,!0).line;return a}function Zw(a){for(var u;u=Jl(a);)a=u.find(1,!0).line;return a}function Qw(a){for(var u,p;u=Jl(a);)a=u.find(1,!0).line,(p||(p=[])).push(a);return p}function yc(a,u){var p=We(a,u),h=si(p);return p==h?u:M(h)}function Sp(a,u){if(u>a.lastLine())return u;var p=We(a,u),h;if(!ao(a,p))return u;for(;h=Jl(p);)p=h.find(1,!0).line;return M(p)+1}function ao(a,u){var p=Xi&&u.markedSpans;if(p){for(var h=void 0,m=0;m<p.length;++m)if(h=p[m],!!h.marker.collapsed){if(h.from==null)return!0;if(!h.marker.widgetNode&&h.from==0&&h.marker.inclusiveLeft&&_c(a,u,h))return!0}}}function _c(a,u,p){if(p.to==null){var h=p.marker.find(1,!0);return _c(a,h.line,ws(h.line.markedSpans,p.marker))}if(p.marker.inclusiveRight&&p.to==u.text.length)return!0;for(var m=void 0,S=0;S<u.markedSpans.length;++S)if(m=u.markedSpans[S],m.marker.collapsed&&!m.marker.widgetNode&&m.from==p.to&&(m.to==null||m.to!=p.from)&&(m.marker.inclusiveLeft||p.marker.inclusiveRight)&&_c(a,u,m))return!0}function Gi(a){a=si(a);for(var u=0,p=a.parent,h=0;h<p.lines.length;++h){var m=p.lines[h];if(m==a)break;u+=m.height}for(var S=p.parent;S;p=S,S=p.parent)for(var O=0;O<S.children.length;++O){var A=S.children[O];if(A==p)break;u+=A.height}return u}function Zl(a){if(a.height==0)return 0;for(var u=a.text.length,p,h=a;p=xp(h);){var m=p.find(0,!0);h=m.from.line,u+=m.from.ch-m.to.ch}for(h=a;p=Jl(h);){var S=p.find(0,!0);u-=h.text.length-S.from.ch,h=S.to.line,u+=h.text.length-S.to.ch}return u}function bc(a){var u=a.display,p=a.doc;u.maxLine=We(p,p.first),u.maxLineLength=Zl(u.maxLine),u.maxLineChanged=!0,p.iter(function(h){var m=Zl(h);m>u.maxLineLength&&(u.maxLineLength=m,u.maxLine=h)})}var ua=function(a,u,p){this.text=a,_p(this,u),this.height=p?p(this):1};ua.prototype.lineNo=function(){return M(this)},qe(ua);function eS(a,u,p,h){a.text=u,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),a.order!=null&&(a.order=null),yp(a),_p(a,p);var m=h?h(a):1;m!=a.height&&K(a,m)}function tS(a){a.parent=null,yp(a)}var nS={},rS={};function Ep(a,u){if(!a||/^\s*$/.test(a))return null;var p=u.addModeClass?rS:nS;return p[a]||(p[a]=a.replace(/\S+/g,"cm-$&"))}function Cp(a,u){var p=le("span",null,null,f?"padding-right: .1px":null),h={pre:le("pre",[p],"CodeMirror-line"),content:p,col:0,pos:0,cm:a,trailingSpace:!1,splitSpaces:a.getOption("lineWrapping")};u.measure={};for(var m=0;m<=(u.rest?u.rest.length:0);m++){var S=m?u.rest[m-1]:u.line,O=void 0;h.pos=0,h.addToken=oS,Or(a.display.measure)&&(O=et(S,a.doc.direction))&&(h.addToken=sS(h.addToken,O)),h.map=[];var A=u!=a.display.externalMeasured&&M(S);lS(S,h,Gl(a,S,A)),S.styleClasses&&(S.styleClasses.bgClass&&(h.bgClass=ae(S.styleClasses.bgClass,h.bgClass||"")),S.styleClasses.textClass&&(h.textClass=ae(S.styleClasses.textClass,h.textClass||""))),h.map.length==0&&h.map.push(0,0,h.content.appendChild(Vr(a.display.measure))),m==0?(u.measure.map=h.map,u.measure.cache={}):((u.measure.maps||(u.measure.maps=[])).push(h.map),(u.measure.caches||(u.measure.caches=[])).push({}))}if(f){var L=h.content.lastChild;(/\bcm-tab\b/.test(L.className)||L.querySelector&&L.querySelector(".cm-tab"))&&(h.content.className="cm-tab-wrap-hack")}return Pt(a,"renderLine",a,u.line,h.pre),h.pre.className&&(h.textClass=ae(h.pre.className,h.textClass||"")),h}function iS(a){var u=P("span","•","cm-invalidchar");return u.title="\\u"+a.charCodeAt(0).toString(16),u.setAttribute("aria-label",u.title),u}function oS(a,u,p,h,m,S,O){if(u){var A=a.splitSpaces?aS(u,a.trailingSpace):u,L=a.cm.state.specialChars,j=!1,ee;if(!L.test(u))a.col+=u.length,ee=document.createTextNode(A),a.map.push(a.pos,a.pos+u.length,ee),d&&c<9&&(j=!0),a.pos+=u.length;else{ee=document.createDocumentFragment();for(var oe=0;;){L.lastIndex=oe;var ve=L.exec(u),fe=ve?ve.index-oe:u.length-oe;if(fe){var Te=document.createTextNode(A.slice(oe,oe+fe));d&&c<9?ee.appendChild(P("span",[Te])):ee.appendChild(Te),a.map.push(a.pos,a.pos+fe,Te),a.col+=fe,a.pos+=fe}if(!ve)break;oe+=fe+1;var Be=void 0;if(ve[0]=="	"){var Ye=a.cm.options.tabSize,tt=Ye-a.col%Ye;Be=ee.appendChild(P("span",Z(tt),"cm-tab")),Be.setAttribute("role","presentation"),Be.setAttribute("cm-text","	"),a.col+=tt}else ve[0]=="\r"||ve[0]==`
`?(Be=ee.appendChild(P("span",ve[0]=="\r"?"␍":"␤","cm-invalidchar")),Be.setAttribute("cm-text",ve[0]),a.col+=1):(Be=a.cm.options.specialCharPlaceholder(ve[0]),Be.setAttribute("cm-text",ve[0]),d&&c<9?ee.appendChild(P("span",[Be])):ee.appendChild(Be),a.col+=1);a.map.push(a.pos,a.pos+1,Be),a.pos++}}if(a.trailingSpace=A.charCodeAt(u.length-1)==32,p||h||m||j||S||O){var st=p||"";h&&(st+=h),m&&(st+=m);var nt=P("span",[ee],st,S);if(O)for(var dt in O)O.hasOwnProperty(dt)&&dt!="style"&&dt!="class"&&nt.setAttribute(dt,O[dt]);return a.content.appendChild(nt)}a.content.appendChild(ee)}}function aS(a,u){if(a.length>1&&!/  /.test(a))return a;for(var p=u,h="",m=0;m<a.length;m++){var S=a.charAt(m);S==" "&&p&&(m==a.length-1||a.charCodeAt(m+1)==32)&&(S=" "),h+=S,p=S==" "}return h}function sS(a,u){return function(p,h,m,S,O,A,L){m=m?m+" cm-force-border":"cm-force-border";for(var j=p.pos,ee=j+h.length;;){for(var oe=void 0,ve=0;ve<u.length&&(oe=u[ve],!(oe.to>j&&oe.from<=j));ve++);if(oe.to>=ee)return a(p,h,m,S,O,A,L);a(p,h.slice(0,oe.to-j),m,S,null,A,L),S=null,h=h.slice(oe.to-j),j=oe.to}}}function Op(a,u,p,h){var m=!h&&p.widgetNode;m&&a.map.push(a.pos,a.pos+u,m),!h&&a.cm.display.input.needsContentAttribute&&(m||(m=a.content.appendChild(document.createElement("span"))),m.setAttribute("cm-marker",p.id)),m&&(a.cm.display.input.setUneditable(m),a.content.appendChild(m)),a.pos+=u,a.trailingSpace=!1}function lS(a,u,p){var h=a.markedSpans,m=a.text,S=0;if(!h){for(var O=1;O<p.length;O+=2)u.addToken(u,m.slice(S,S=p[O]),Ep(p[O+1],u.cm.options));return}for(var A=m.length,L=0,j=1,ee="",oe,ve,fe=0,Te,Be,Ye,tt,st;;){if(fe==L){Te=Be=Ye=ve="",st=null,tt=null,fe=1/0;for(var nt=[],dt=void 0,St=0;St<h.length;++St){var xt=h[St],jt=xt.marker;if(jt.type=="bookmark"&&xt.from==L&&jt.widgetNode)nt.push(jt);else if(xt.from<=L&&(xt.to==null||xt.to>L||jt.collapsed&&xt.to==L&&xt.from==L)){if(xt.to!=null&&xt.to!=L&&fe>xt.to&&(fe=xt.to,Be=""),jt.className&&(Te+=" "+jt.className),jt.css&&(ve=(ve?ve+";":"")+jt.css),jt.startStyle&&xt.from==L&&(Ye+=" "+jt.startStyle),jt.endStyle&&xt.to==fe&&(dt||(dt=[])).push(jt.endStyle,xt.to),jt.title&&((st||(st={})).title=jt.title),jt.attributes)for(var hn in jt.attributes)(st||(st={}))[hn]=jt.attributes[hn];jt.collapsed&&(!tt||mc(tt.marker,jt)<0)&&(tt=xt)}else xt.from>L&&fe>xt.from&&(fe=xt.from)}if(dt)for(var Vn=0;Vn<dt.length;Vn+=2)dt[Vn+1]==fe&&(Be+=" "+dt[Vn]);if(!tt||tt.from==L)for(var bn=0;bn<nt.length;++bn)Op(u,0,nt[bn]);if(tt&&(tt.from||0)==L){if(Op(u,(tt.to==null?A+1:tt.to)-L,tt.marker,tt.from==null),tt.to==null)return;tt.to==L&&(tt=!1)}}if(L>=A)break;for(var Dr=Math.min(A,fe);;){if(ee){var mr=L+ee.length;if(!tt){var Nn=mr>Dr?ee.slice(0,Dr-L):ee;u.addToken(u,Nn,oe?oe+Te:Te,Ye,L+Nn.length==fe?Be:"",ve,st)}if(mr>=Dr){ee=ee.slice(Dr-L),L=Dr;break}L=mr,Ye=""}ee=m.slice(S,S=p[j++]),oe=Ep(p[j++],u.cm.options)}}}function kp(a,u,p){this.line=u,this.rest=Qw(u),this.size=this.rest?M(N(this.rest))-p+1:1,this.node=this.text=null,this.hidden=ao(a,u)}function Ql(a,u,p){for(var h=[],m,S=u;S<p;S=m){var O=new kp(a.doc,We(a.doc,S),S);m=S+O.size,h.push(O)}return h}var da=null;function uS(a){da?da.ops.push(a):a.ownsGroup=da={ops:[a],delayedCallbacks:[]}}function dS(a){var u=a.delayedCallbacks,p=0;do{for(;p<u.length;p++)u[p].call(null);for(var h=0;h<a.ops.length;h++){var m=a.ops[h];if(m.cursorActivityHandlers)for(;m.cursorActivityCalled<m.cursorActivityHandlers.length;)m.cursorActivityHandlers[m.cursorActivityCalled++].call(null,m.cm)}}while(p<u.length)}function cS(a,u){var p=a.ownsGroup;if(p)try{dS(p)}finally{da=null,u(p)}}var Ss=null;function zn(a,u){var p=fn(a,u);if(p.length){var h=Array.prototype.slice.call(arguments,2),m;da?m=da.delayedCallbacks:Ss?m=Ss:(m=Ss=[],setTimeout(fS,0));for(var S=function(A){m.push(function(){return p[A].apply(null,h)})},O=0;O<p.length;++O)S(O)}}function fS(){var a=Ss;Ss=null;for(var u=0;u<a.length;++u)a[u]()}function Np(a,u,p,h){for(var m=0;m<u.changes.length;m++){var S=u.changes[m];S=="text"?pS(a,u):S=="gutter"?Ap(a,u,p,h):S=="class"?xc(a,u):S=="widget"&&vS(a,u,h)}u.changes=null}function Es(a){return a.node==a.text&&(a.node=P("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),d&&c<8&&(a.node.style.zIndex=2)),a.node}function hS(a,u){var p=u.bgClass?u.bgClass+" "+(u.line.bgClass||""):u.line.bgClass;if(p&&(p+=" CodeMirror-linebackground"),u.background)p?u.background.className=p:(u.background.parentNode.removeChild(u.background),u.background=null);else if(p){var h=Es(u);u.background=h.insertBefore(P("div",null,p),h.firstChild),a.display.input.setUneditable(u.background)}}function Mp(a,u){var p=a.display.externalMeasured;return p&&p.line==u.line?(a.display.externalMeasured=null,u.measure=p.measure,p.built):Cp(a,u)}function pS(a,u){var p=u.text.className,h=Mp(a,u);u.text==u.node&&(u.node=h.pre),u.text.parentNode.replaceChild(h.pre,u.text),u.text=h.pre,h.bgClass!=u.bgClass||h.textClass!=u.textClass?(u.bgClass=h.bgClass,u.textClass=h.textClass,xc(a,u)):p&&(u.text.className=p)}function xc(a,u){hS(a,u),u.line.wrapClass?Es(u).className=u.line.wrapClass:u.node!=u.text&&(u.node.className="");var p=u.textClass?u.textClass+" "+(u.line.textClass||""):u.line.textClass;u.text.className=p||""}function Ap(a,u,p,h){if(u.gutter&&(u.node.removeChild(u.gutter),u.gutter=null),u.gutterBackground&&(u.node.removeChild(u.gutterBackground),u.gutterBackground=null),u.line.gutterClass){var m=Es(u);u.gutterBackground=P("div",null,"CodeMirror-gutter-background "+u.line.gutterClass,"left: "+(a.options.fixedGutter?h.fixedPos:-h.gutterTotalWidth)+"px; width: "+h.gutterTotalWidth+"px"),a.display.input.setUneditable(u.gutterBackground),m.insertBefore(u.gutterBackground,u.text)}var S=u.line.gutterMarkers;if(a.options.lineNumbers||S){var O=Es(u),A=u.gutter=P("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?h.fixedPos:-h.gutterTotalWidth)+"px");if(A.setAttribute("aria-hidden","true"),a.display.input.setUneditable(A),O.insertBefore(A,u.text),u.line.gutterClass&&(A.className+=" "+u.line.gutterClass),a.options.lineNumbers&&(!S||!S["CodeMirror-linenumbers"])&&(u.lineNumber=A.appendChild(P("div",Ee(a.options,p),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+h.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),S)for(var L=0;L<a.display.gutterSpecs.length;++L){var j=a.display.gutterSpecs[L].className,ee=S.hasOwnProperty(j)&&S[j];ee&&A.appendChild(P("div",[ee],"CodeMirror-gutter-elt","left: "+h.gutterLeft[j]+"px; width: "+h.gutterWidth[j]+"px"))}}}function vS(a,u,p){u.alignable&&(u.alignable=null);for(var h=G("CodeMirror-linewidget"),m=u.node.firstChild,S=void 0;m;m=S)S=m.nextSibling,h.test(m.className)&&u.node.removeChild(m);Tp(a,u,p)}function gS(a,u,p,h){var m=Mp(a,u);return u.text=u.node=m.pre,m.bgClass&&(u.bgClass=m.bgClass),m.textClass&&(u.textClass=m.textClass),xc(a,u),Ap(a,u,p,h),Tp(a,u,h),u.node}function Tp(a,u,p){if(Dp(a,u.line,u,p,!0),u.rest)for(var h=0;h<u.rest.length;h++)Dp(a,u.rest[h],u,p,!1)}function Dp(a,u,p,h,m){if(u.widgets)for(var S=Es(p),O=0,A=u.widgets;O<A.length;++O){var L=A[O],j=P("div",[L.node],"CodeMirror-linewidget"+(L.className?" "+L.className:""));L.handleMouseEvents||j.setAttribute("cm-ignore-events","true"),mS(L,j,p,h),a.display.input.setUneditable(j),m&&L.above?S.insertBefore(j,p.gutter||p.text):S.appendChild(j),zn(L,"redraw")}}function mS(a,u,p,h){if(a.noHScroll){(p.alignable||(p.alignable=[])).push(u);var m=h.wrapperWidth;u.style.left=h.fixedPos+"px",a.coverGutter||(m-=h.gutterTotalWidth,u.style.paddingLeft=h.gutterTotalWidth+"px"),u.style.width=m+"px"}a.coverGutter&&(u.style.zIndex=5,u.style.position="relative",a.noHScroll||(u.style.marginLeft=-h.gutterTotalWidth+"px"))}function Cs(a){if(a.height!=null)return a.height;var u=a.doc.cm;if(!u)return 0;if(!he(document.body,a.node)){var p="position: relative;";a.coverGutter&&(p+="margin-left: -"+u.display.gutters.offsetWidth+"px;"),a.noHScroll&&(p+="width: "+u.display.wrapper.clientWidth+"px;"),W(u.display.measure,P("div",[a.node],null,p))}return a.height=a.node.parentNode.offsetHeight}function Yi(a,u){for(var p=Jn(u);p!=a.wrapper;p=p.parentNode)if(!p||p.nodeType==1&&p.getAttribute("cm-ignore-events")=="true"||p.parentNode==a.sizer&&p!=a.mover)return!0}function eu(a){return a.lineSpace.offsetTop}function wc(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function Lp(a){if(a.cachedPaddingH)return a.cachedPaddingH;var u=W(a.measure,P("pre","x","CodeMirror-line-like")),p=window.getComputedStyle?window.getComputedStyle(u):u.currentStyle,h={left:parseInt(p.paddingLeft),right:parseInt(p.paddingRight)};return!isNaN(h.left)&&!isNaN(h.right)&&(a.cachedPaddingH=h),h}function Mi(a){return Ue-a.display.nativeBarWidth}function Do(a){return a.display.scroller.clientWidth-Mi(a)-a.display.barWidth}function Sc(a){return a.display.scroller.clientHeight-Mi(a)-a.display.barHeight}function yS(a,u,p){var h=a.options.lineWrapping,m=h&&Do(a);if(!u.measure.heights||h&&u.measure.width!=m){var S=u.measure.heights=[];if(h){u.measure.width=m;for(var O=u.text.firstChild.getClientRects(),A=0;A<O.length-1;A++){var L=O[A],j=O[A+1];Math.abs(L.bottom-j.bottom)>2&&S.push((L.bottom+j.top)/2-p.top)}}S.push(p.bottom-p.top)}}function Pp(a,u,p){if(a.line==u)return{map:a.measure.map,cache:a.measure.cache};if(a.rest){for(var h=0;h<a.rest.length;h++)if(a.rest[h]==u)return{map:a.measure.maps[h],cache:a.measure.caches[h]};for(var m=0;m<a.rest.length;m++)if(M(a.rest[m])>p)return{map:a.measure.maps[m],cache:a.measure.caches[m],before:!0}}}function _S(a,u){u=si(u);var p=M(u),h=a.display.externalMeasured=new kp(a.doc,u,p);h.lineN=p;var m=h.built=Cp(a,h);return h.text=m.pre,W(a.display.lineMeasure,m.pre),h}function Rp(a,u,p,h){return Ai(a,ca(a,u),p,h)}function Ec(a,u){if(u>=a.display.viewFrom&&u<a.display.viewTo)return a.display.view[Ro(a,u)];var p=a.display.externalMeasured;if(p&&u>=p.lineN&&u<p.lineN+p.size)return p}function ca(a,u){var p=M(u),h=Ec(a,p);h&&!h.text?h=null:h&&h.changes&&(Np(a,h,p,Mc(a)),a.curOp.forceUpdate=!0),h||(h=_S(a,u));var m=Pp(h,u,p);return{line:u,view:h,rect:null,map:m.map,cache:m.cache,before:m.before,hasHeights:!1}}function Ai(a,u,p,h,m){u.before&&(p=-1);var S=p+(h||""),O;return u.cache.hasOwnProperty(S)?O=u.cache[S]:(u.rect||(u.rect=u.view.text.getBoundingClientRect()),u.hasHeights||(yS(a,u.view,u.rect),u.hasHeights=!0),O=xS(a,u,p,h),O.bogus||(u.cache[S]=O)),{left:O.left,right:O.right,top:m?O.rtop:O.top,bottom:m?O.rbottom:O.bottom}}var Ip={left:0,right:0,top:0,bottom:0};function Bp(a,u,p){for(var h,m,S,O,A,L,j=0;j<a.length;j+=3)if(A=a[j],L=a[j+1],u<A?(m=0,S=1,O="left"):u<L?(m=u-A,S=m+1):(j==a.length-3||u==L&&a[j+3]>u)&&(S=L-A,m=S-1,u>=L&&(O="right")),m!=null){if(h=a[j+2],A==L&&p==(h.insertLeft?"left":"right")&&(O=p),p=="left"&&m==0)for(;j&&a[j-2]==a[j-3]&&a[j-1].insertLeft;)h=a[(j-=3)+2],O="left";if(p=="right"&&m==L-A)for(;j<a.length-3&&a[j+3]==a[j+4]&&!a[j+5].insertLeft;)h=a[(j+=3)+2],O="right";break}return{node:h,start:m,end:S,collapse:O,coverStart:A,coverEnd:L}}function bS(a,u){var p=Ip;if(u=="left")for(var h=0;h<a.length&&(p=a[h]).left==p.right;h++);else for(var m=a.length-1;m>=0&&(p=a[m]).left==p.right;m--);return p}function xS(a,u,p,h){var m=Bp(u.map,p,h),S=m.node,O=m.start,A=m.end,L=m.collapse,j;if(S.nodeType==3){for(var ee=0;ee<4;ee++){for(;O&&Ge(u.line.text.charAt(m.coverStart+O));)--O;for(;m.coverStart+A<m.coverEnd&&Ge(u.line.text.charAt(m.coverStart+A));)++A;if(d&&c<9&&O==0&&A==m.coverEnd-m.coverStart?j=S.parentNode.getBoundingClientRect():j=bS(me(S,O,A).getClientRects(),h),j.left||j.right||O==0)break;A=O,O=O-1,L="right"}d&&c<11&&(j=wS(a.display.measure,j))}else{O>0&&(L=h="right");var oe;a.options.lineWrapping&&(oe=S.getClientRects()).length>1?j=oe[h=="right"?oe.length-1:0]:j=S.getBoundingClientRect()}if(d&&c<9&&!O&&(!j||!j.left&&!j.right)){var ve=S.parentNode.getClientRects()[0];ve?j={left:ve.left,right:ve.left+ha(a.display),top:ve.top,bottom:ve.bottom}:j=Ip}for(var fe=j.top-u.rect.top,Te=j.bottom-u.rect.top,Be=(fe+Te)/2,Ye=u.view.measure.heights,tt=0;tt<Ye.length-1&&!(Be<Ye[tt]);tt++);var st=tt?Ye[tt-1]:0,nt=Ye[tt],dt={left:(L=="right"?j.right:j.left)-u.rect.left,right:(L=="left"?j.left:j.right)-u.rect.left,top:st,bottom:nt};return!j.left&&!j.right&&(dt.bogus=!0),a.options.singleCursorHeightPerLine||(dt.rtop=fe,dt.rbottom=Te),dt}function wS(a,u){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!Ni(a))return u;var p=screen.logicalXDPI/screen.deviceXDPI,h=screen.logicalYDPI/screen.deviceYDPI;return{left:u.left*p,right:u.right*p,top:u.top*h,bottom:u.bottom*h}}function jp(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var u=0;u<a.rest.length;u++)a.measure.caches[u]={}}function Hp(a){a.display.externalMeasure=null,T(a.display.lineMeasure);for(var u=0;u<a.display.view.length;u++)jp(a.display.view[u])}function Os(a){Hp(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function $p(a){return g&&k?-(a.body.getBoundingClientRect().left-parseInt(getComputedStyle(a.body).marginLeft)):a.defaultView.pageXOffset||(a.documentElement||a.body).scrollLeft}function Fp(a){return g&&k?-(a.body.getBoundingClientRect().top-parseInt(getComputedStyle(a.body).marginTop)):a.defaultView.pageYOffset||(a.documentElement||a.body).scrollTop}function Cc(a){var u=si(a),p=u.widgets,h=0;if(p)for(var m=0;m<p.length;++m)p[m].above&&(h+=Cs(p[m]));return h}function tu(a,u,p,h,m){if(!m){var S=Cc(u);p.top+=S,p.bottom+=S}if(h=="line")return p;h||(h="local");var O=Gi(u);if(h=="local"?O+=eu(a.display):O-=a.display.viewOffset,h=="page"||h=="window"){var A=a.display.lineSpace.getBoundingClientRect();O+=A.top+(h=="window"?0:Fp(Le(a)));var L=A.left+(h=="window"?0:$p(Le(a)));p.left+=L,p.right+=L}return p.top+=O,p.bottom+=O,p}function zp(a,u,p){if(p=="div")return u;var h=u.left,m=u.top;if(p=="page")h-=$p(Le(a)),m-=Fp(Le(a));else if(p=="local"||!p){var S=a.display.sizer.getBoundingClientRect();h+=S.left,m+=S.top}var O=a.display.lineSpace.getBoundingClientRect();return{left:h-O.left,top:m-O.top}}function nu(a,u,p,h,m){return h||(h=We(a.doc,u.line)),tu(a,h,Rp(a,h,u.ch,m),p)}function li(a,u,p,h,m,S){h=h||We(a.doc,u.line),m||(m=ca(a,h));function O(Te,Be){var Ye=Ai(a,m,Te,Be?"right":"left",S);return Be?Ye.left=Ye.right:Ye.right=Ye.left,tu(a,h,Ye,p)}var A=et(h,a.doc.direction),L=u.ch,j=u.sticky;if(L>=h.text.length?(L=h.text.length,j="before"):L<=0&&(L=0,j="after"),!A)return O(j=="before"?L-1:L,j=="before");function ee(Te,Be,Ye){var tt=A[Be],st=tt.level==1;return O(Ye?Te-1:Te,st!=Ye)}var oe=rt(A,L,j),ve=Xe,fe=ee(L,oe,j=="before");return ve!=null&&(fe.other=ee(L,ve,j!="before")),fe}function Wp(a,u){var p=0;u=Mt(a.doc,u),a.options.lineWrapping||(p=ha(a.display)*u.ch);var h=We(a.doc,u.line),m=Gi(h)+eu(a.display);return{left:p,right:p,top:m,bottom:m+h.height}}function Oc(a,u,p,h,m){var S=pe(a,u,p);return S.xRel=m,h&&(S.outside=h),S}function kc(a,u,p){var h=a.doc;if(p+=a.display.viewOffset,p<0)return Oc(h.first,0,null,-1,-1);var m=U(h,p),S=h.first+h.size-1;if(m>S)return Oc(h.first+h.size-1,We(h,S).text.length,null,1,1);u<0&&(u=0);for(var O=We(h,m);;){var A=SS(a,O,m,u,p),L=Jw(O,A.ch+(A.xRel>0||A.outside>0?1:0));if(!L)return A;var j=L.find(1);if(j.line==m)return j;O=We(h,m=j.line)}}function Up(a,u,p,h){h-=Cc(u);var m=u.text.length,S=ut(function(O){return Ai(a,p,O-1).bottom<=h},m,0);return m=ut(function(O){return Ai(a,p,O).top>h},S,m),{begin:S,end:m}}function Vp(a,u,p,h){p||(p=ca(a,u));var m=tu(a,u,Ai(a,p,h),"line").top;return Up(a,u,p,m)}function Nc(a,u,p,h){return a.bottom<=p?!1:a.top>p?!0:(h?a.left:a.right)>u}function SS(a,u,p,h,m){m-=Gi(u);var S=ca(a,u),O=Cc(u),A=0,L=u.text.length,j=!0,ee=et(u,a.doc.direction);if(ee){var oe=(a.options.lineWrapping?CS:ES)(a,u,p,S,ee,h,m);j=oe.level!=1,A=j?oe.from:oe.to-1,L=j?oe.to:oe.from-1}var ve=null,fe=null,Te=ut(function(St){var xt=Ai(a,S,St);return xt.top+=O,xt.bottom+=O,Nc(xt,h,m,!1)?(xt.top<=m&&xt.left<=h&&(ve=St,fe=xt),!0):!1},A,L),Be,Ye,tt=!1;if(fe){var st=h-fe.left<fe.right-h,nt=st==j;Te=ve+(nt?0:1),Ye=nt?"after":"before",Be=st?fe.left:fe.right}else{!j&&(Te==L||Te==A)&&Te++,Ye=Te==0?"after":Te==u.text.length?"before":Ai(a,S,Te-(j?1:0)).bottom+O<=m==j?"after":"before";var dt=li(a,pe(p,Te,Ye),"line",u,S);Be=dt.left,tt=m<dt.top?-1:m>=dt.bottom?1:0}return Te=at(u.text,Te,1),Oc(p,Te,Ye,tt,h-Be)}function ES(a,u,p,h,m,S,O){var A=ut(function(oe){var ve=m[oe],fe=ve.level!=1;return Nc(li(a,pe(p,fe?ve.to:ve.from,fe?"before":"after"),"line",u,h),S,O,!0)},0,m.length-1),L=m[A];if(A>0){var j=L.level!=1,ee=li(a,pe(p,j?L.from:L.to,j?"after":"before"),"line",u,h);Nc(ee,S,O,!0)&&ee.top>O&&(L=m[A-1])}return L}function CS(a,u,p,h,m,S,O){var A=Up(a,u,h,O),L=A.begin,j=A.end;/\s/.test(u.text.charAt(j-1))&&j--;for(var ee=null,oe=null,ve=0;ve<m.length;ve++){var fe=m[ve];if(!(fe.from>=j||fe.to<=L)){var Te=fe.level!=1,Be=Ai(a,h,Te?Math.min(j,fe.to)-1:Math.max(L,fe.from)).right,Ye=Be<S?S-Be+1e9:Be-S;(!ee||oe>Ye)&&(ee=fe,oe=Ye)}}return ee||(ee=m[m.length-1]),ee.from<L&&(ee={from:L,to:ee.to,level:ee.level}),ee.to>j&&(ee={from:ee.from,to:j,level:ee.level}),ee}var Lo;function fa(a){if(a.cachedTextHeight!=null)return a.cachedTextHeight;if(Lo==null){Lo=P("pre",null,"CodeMirror-line-like");for(var u=0;u<49;++u)Lo.appendChild(document.createTextNode("x")),Lo.appendChild(P("br"));Lo.appendChild(document.createTextNode("x"))}W(a.measure,Lo);var p=Lo.offsetHeight/50;return p>3&&(a.cachedTextHeight=p),T(a.measure),p||1}function ha(a){if(a.cachedCharWidth!=null)return a.cachedCharWidth;var u=P("span","xxxxxxxxxx"),p=P("pre",[u],"CodeMirror-line-like");W(a.measure,p);var h=u.getBoundingClientRect(),m=(h.right-h.left)/10;return m>2&&(a.cachedCharWidth=m),m||10}function Mc(a){for(var u=a.display,p={},h={},m=u.gutters.clientLeft,S=u.gutters.firstChild,O=0;S;S=S.nextSibling,++O){var A=a.display.gutterSpecs[O].className;p[A]=S.offsetLeft+S.clientLeft+m,h[A]=S.clientWidth}return{fixedPos:Ac(u),gutterTotalWidth:u.gutters.offsetWidth,gutterLeft:p,gutterWidth:h,wrapperWidth:u.wrapper.clientWidth}}function Ac(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function Xp(a){var u=fa(a.display),p=a.options.lineWrapping,h=p&&Math.max(5,a.display.scroller.clientWidth/ha(a.display)-3);return function(m){if(ao(a.doc,m))return 0;var S=0;if(m.widgets)for(var O=0;O<m.widgets.length;O++)m.widgets[O].height&&(S+=m.widgets[O].height);return p?S+(Math.ceil(m.text.length/h)||1)*u:S+u}}function Tc(a){var u=a.doc,p=Xp(a);u.iter(function(h){var m=p(h);m!=h.height&&K(h,m)})}function Po(a,u,p,h){var m=a.display;if(!p&&Jn(u).getAttribute("cm-not-content")=="true")return null;var S,O,A=m.lineSpace.getBoundingClientRect();try{S=u.clientX-A.left,O=u.clientY-A.top}catch{return null}var L=kc(a,S,O),j;if(h&&L.xRel>0&&(j=We(a.doc,L.line).text).length==L.ch){var ee=Ie(j,j.length,a.options.tabSize)-j.length;L=pe(L.line,Math.max(0,Math.round((S-Lp(a.display).left)/ha(a.display))-ee))}return L}function Ro(a,u){if(u>=a.display.viewTo||(u-=a.display.viewFrom,u<0))return null;for(var p=a.display.view,h=0;h<p.length;h++)if(u-=p[h].size,u<0)return h}function vr(a,u,p,h){u==null&&(u=a.doc.first),p==null&&(p=a.doc.first+a.doc.size),h||(h=0);var m=a.display;if(h&&p<m.viewTo&&(m.updateLineNumbers==null||m.updateLineNumbers>u)&&(m.updateLineNumbers=u),a.curOp.viewChanged=!0,u>=m.viewTo)Xi&&yc(a.doc,u)<m.viewTo&&lo(a);else if(p<=m.viewFrom)Xi&&Sp(a.doc,p+h)>m.viewFrom?lo(a):(m.viewFrom+=h,m.viewTo+=h);else if(u<=m.viewFrom&&p>=m.viewTo)lo(a);else if(u<=m.viewFrom){var S=ru(a,p,p+h,1);S?(m.view=m.view.slice(S.index),m.viewFrom=S.lineN,m.viewTo+=h):lo(a)}else if(p>=m.viewTo){var O=ru(a,u,u,-1);O?(m.view=m.view.slice(0,O.index),m.viewTo=O.lineN):lo(a)}else{var A=ru(a,u,u,-1),L=ru(a,p,p+h,1);A&&L?(m.view=m.view.slice(0,A.index).concat(Ql(a,A.lineN,L.lineN)).concat(m.view.slice(L.index)),m.viewTo+=h):lo(a)}var j=m.externalMeasured;j&&(p<j.lineN?j.lineN+=h:u<j.lineN+j.size&&(m.externalMeasured=null))}function so(a,u,p){a.curOp.viewChanged=!0;var h=a.display,m=a.display.externalMeasured;if(m&&u>=m.lineN&&u<m.lineN+m.size&&(h.externalMeasured=null),!(u<h.viewFrom||u>=h.viewTo)){var S=h.view[Ro(a,u)];if(S.node!=null){var O=S.changes||(S.changes=[]);$e(O,p)==-1&&O.push(p)}}}function lo(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function ru(a,u,p,h){var m=Ro(a,u),S,O=a.display.view;if(!Xi||p==a.doc.first+a.doc.size)return{index:m,lineN:p};for(var A=a.display.viewFrom,L=0;L<m;L++)A+=O[L].size;if(A!=u){if(h>0){if(m==O.length-1)return null;S=A+O[m].size-u,m++}else S=A-u;u+=S,p+=S}for(;yc(a.doc,p)!=p;){if(m==(h<0?0:O.length-1))return null;p+=h*O[m-(h<0?1:0)].size,m+=h}return{index:m,lineN:p}}function OS(a,u,p){var h=a.display,m=h.view;m.length==0||u>=h.viewTo||p<=h.viewFrom?(h.view=Ql(a,u,p),h.viewFrom=u):(h.viewFrom>u?h.view=Ql(a,u,h.viewFrom).concat(h.view):h.viewFrom<u&&(h.view=h.view.slice(Ro(a,u))),h.viewFrom=u,h.viewTo<p?h.view=h.view.concat(Ql(a,h.viewTo,p)):h.viewTo>p&&(h.view=h.view.slice(0,Ro(a,p)))),h.viewTo=p}function Gp(a){for(var u=a.display.view,p=0,h=0;h<u.length;h++){var m=u[h];!m.hidden&&(!m.node||m.changes)&&++p}return p}function ks(a){a.display.input.showSelection(a.display.input.prepareSelection())}function Yp(a,u){u===void 0&&(u=!0);var p=a.doc,h={},m=h.cursors=document.createDocumentFragment(),S=h.selection=document.createDocumentFragment(),O=a.options.$customCursor;O&&(u=!0);for(var A=0;A<p.sel.ranges.length;A++)if(!(!u&&A==p.sel.primIndex)){var L=p.sel.ranges[A];if(!(L.from().line>=a.display.viewTo||L.to().line<a.display.viewFrom)){var j=L.empty();if(O){var ee=O(a,L);ee&&Dc(a,ee,m)}else(j||a.options.showCursorWhenSelecting)&&Dc(a,L.head,m);j||kS(a,L,S)}}return h}function Dc(a,u,p){var h=li(a,u,"div",null,null,!a.options.singleCursorHeightPerLine),m=p.appendChild(P("div"," ","CodeMirror-cursor"));if(m.style.left=h.left+"px",m.style.top=h.top+"px",m.style.height=Math.max(0,h.bottom-h.top)*a.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(a.getWrapperElement().className)){var S=nu(a,u,"div",null,null),O=S.right-S.left;m.style.width=(O>0?O:a.defaultCharWidth())+"px"}if(h.other){var A=p.appendChild(P("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));A.style.display="",A.style.left=h.other.left+"px",A.style.top=h.other.top+"px",A.style.height=(h.other.bottom-h.other.top)*.85+"px"}}function iu(a,u){return a.top-u.top||a.left-u.left}function kS(a,u,p){var h=a.display,m=a.doc,S=document.createDocumentFragment(),O=Lp(a.display),A=O.left,L=Math.max(h.sizerWidth,Do(a)-h.sizer.offsetLeft)-O.right,j=m.direction=="ltr";function ee(nt,dt,St,xt){dt<0&&(dt=0),dt=Math.round(dt),xt=Math.round(xt),S.appendChild(P("div",null,"CodeMirror-selected","position: absolute; left: "+nt+`px;
                             top: `+dt+"px; width: "+(St??L-nt)+`px;
                             height: `+(xt-dt)+"px"))}function oe(nt,dt,St){var xt=We(m,nt),jt=xt.text.length,hn,Vn;function bn(Nn,yr){return nu(a,pe(nt,Nn),"div",xt,yr)}function Dr(Nn,yr,qn){var Ln=Vp(a,xt,null,Nn),Mn=yr=="ltr"==(qn=="after")?"left":"right",Sn=qn=="after"?Ln.begin:Ln.end-(/\s/.test(xt.text.charAt(Ln.end-1))?2:1);return bn(Sn,Mn)[Mn]}var mr=et(xt,m.direction);return kt(mr,dt||0,St??jt,function(Nn,yr,qn,Ln){var Mn=qn=="ltr",Sn=bn(Nn,Mn?"left":"right"),_r=bn(yr-1,Mn?"right":"left"),Oa=dt==null&&Nn==0,vo=St==null&&yr==jt,Qn=Ln==0,Ti=!mr||Ln==mr.length-1;if(_r.top-Sn.top<=3){var Xn=(j?Oa:vo)&&Qn,af=(j?vo:Oa)&&Ti,Ji=Xn?A:(Mn?Sn:_r).left,$o=af?L:(Mn?_r:Sn).right;ee(Ji,Sn.top,$o-Ji,Sn.bottom)}else{var Fo,sr,ka,sf;Mn?(Fo=j&&Oa&&Qn?A:Sn.left,sr=j?L:Dr(Nn,qn,"before"),ka=j?A:Dr(yr,qn,"after"),sf=j&&vo&&Ti?L:_r.right):(Fo=j?Dr(Nn,qn,"before"):A,sr=!j&&Oa&&Qn?L:Sn.right,ka=!j&&vo&&Ti?A:_r.left,sf=j?Dr(yr,qn,"after"):L),ee(Fo,Sn.top,sr-Fo,Sn.bottom),Sn.bottom<_r.top&&ee(A,Sn.bottom,null,_r.top),ee(ka,_r.top,sf-ka,_r.bottom)}(!hn||iu(Sn,hn)<0)&&(hn=Sn),iu(_r,hn)<0&&(hn=_r),(!Vn||iu(Sn,Vn)<0)&&(Vn=Sn),iu(_r,Vn)<0&&(Vn=_r)}),{start:hn,end:Vn}}var ve=u.from(),fe=u.to();if(ve.line==fe.line)oe(ve.line,ve.ch,fe.ch);else{var Te=We(m,ve.line),Be=We(m,fe.line),Ye=si(Te)==si(Be),tt=oe(ve.line,ve.ch,Ye?Te.text.length+1:null).end,st=oe(fe.line,Ye?0:null,fe.ch).start;Ye&&(tt.top<st.top-2?(ee(tt.right,tt.top,null,tt.bottom),ee(A,st.top,st.left,st.bottom)):ee(tt.right,tt.top,st.left-tt.right,tt.bottom)),tt.bottom<st.top&&ee(A,tt.bottom,null,st.top)}p.appendChild(S)}function Lc(a){if(a.state.focused){var u=a.display;clearInterval(u.blinker);var p=!0;u.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?u.blinker=setInterval(function(){a.hasFocus()||pa(a),u.cursorDiv.style.visibility=(p=!p)?"":"hidden"},a.options.cursorBlinkRate):a.options.cursorBlinkRate<0&&(u.cursorDiv.style.visibility="hidden")}}function qp(a){a.hasFocus()||(a.display.input.focus(),a.state.focused||Rc(a))}function Pc(a){a.state.delayingBlurEvent=!0,setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,a.state.focused&&pa(a))},100)}function Rc(a,u){a.state.delayingBlurEvent&&!a.state.draggingText&&(a.state.delayingBlurEvent=!1),a.options.readOnly!="nocursor"&&(a.state.focused||(Pt(a,"focus",a,u),a.state.focused=!0,ye(a.display.wrapper,"CodeMirror-focused"),!a.curOp&&a.display.selForContextMenu!=a.doc.sel&&(a.display.input.reset(),f&&setTimeout(function(){return a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),Lc(a))}function pa(a,u){a.state.delayingBlurEvent||(a.state.focused&&(Pt(a,"blur",a,u),a.state.focused=!1,Q(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function ou(a){for(var u=a.display,p=u.lineDiv.offsetTop,h=Math.max(0,u.scroller.getBoundingClientRect().top),m=u.lineDiv.getBoundingClientRect().top,S=0,O=0;O<u.view.length;O++){var A=u.view[O],L=a.options.lineWrapping,j=void 0,ee=0;if(!A.hidden){if(m+=A.line.height,d&&c<8){var oe=A.node.offsetTop+A.node.offsetHeight;j=oe-p,p=oe}else{var ve=A.node.getBoundingClientRect();j=ve.bottom-ve.top,!L&&A.text.firstChild&&(ee=A.text.firstChild.getBoundingClientRect().right-ve.left-1)}var fe=A.line.height-j;if((fe>.005||fe<-.005)&&(m<h&&(S-=fe),K(A.line,j),Kp(A.line),A.rest))for(var Te=0;Te<A.rest.length;Te++)Kp(A.rest[Te]);if(ee>a.display.sizerWidth){var Be=Math.ceil(ee/ha(a.display));Be>a.display.maxLineLength&&(a.display.maxLineLength=Be,a.display.maxLine=A.line,a.display.maxLineChanged=!0)}}}Math.abs(S)>2&&(u.scroller.scrollTop+=S)}function Kp(a){if(a.widgets)for(var u=0;u<a.widgets.length;++u){var p=a.widgets[u],h=p.node.parentNode;h&&(p.height=h.offsetHeight)}}function au(a,u,p){var h=p&&p.top!=null?Math.max(0,p.top):a.scroller.scrollTop;h=Math.floor(h-eu(a));var m=p&&p.bottom!=null?p.bottom:h+a.wrapper.clientHeight,S=U(u,h),O=U(u,m);if(p&&p.ensure){var A=p.ensure.from.line,L=p.ensure.to.line;A<S?(S=A,O=U(u,Gi(We(u,A))+a.wrapper.clientHeight)):Math.min(L,u.lastLine())>=O&&(S=U(u,Gi(We(u,L))-a.wrapper.clientHeight),O=L)}return{from:S,to:Math.max(O,S+1)}}function NS(a,u){if(!Rt(a,"scrollCursorIntoView")){var p=a.display,h=p.sizer.getBoundingClientRect(),m=null,S=p.wrapper.ownerDocument;if(u.top+h.top<0?m=!0:u.bottom+h.top>(S.defaultView.innerHeight||S.documentElement.clientHeight)&&(m=!1),m!=null&&!w){var O=P("div","​",null,`position: absolute;
                         top: `+(u.top-p.viewOffset-eu(a.display))+`px;
                         height: `+(u.bottom-u.top+Mi(a)+p.barHeight)+`px;
                         left: `+u.left+"px; width: "+Math.max(2,u.right-u.left)+"px;");a.display.lineSpace.appendChild(O),O.scrollIntoView(m),a.display.lineSpace.removeChild(O)}}}function MS(a,u,p,h){h==null&&(h=0);var m;!a.options.lineWrapping&&u==p&&(p=u.sticky=="before"?pe(u.line,u.ch+1,"before"):u,u=u.ch?pe(u.line,u.sticky=="before"?u.ch-1:u.ch,"after"):u);for(var S=0;S<5;S++){var O=!1,A=li(a,u),L=!p||p==u?A:li(a,p);m={left:Math.min(A.left,L.left),top:Math.min(A.top,L.top)-h,right:Math.max(A.left,L.left),bottom:Math.max(A.bottom,L.bottom)+h};var j=Ic(a,m),ee=a.doc.scrollTop,oe=a.doc.scrollLeft;if(j.scrollTop!=null&&(Ms(a,j.scrollTop),Math.abs(a.doc.scrollTop-ee)>1&&(O=!0)),j.scrollLeft!=null&&(Io(a,j.scrollLeft),Math.abs(a.doc.scrollLeft-oe)>1&&(O=!0)),!O)break}return m}function AS(a,u){var p=Ic(a,u);p.scrollTop!=null&&Ms(a,p.scrollTop),p.scrollLeft!=null&&Io(a,p.scrollLeft)}function Ic(a,u){var p=a.display,h=fa(a.display);u.top<0&&(u.top=0);var m=a.curOp&&a.curOp.scrollTop!=null?a.curOp.scrollTop:p.scroller.scrollTop,S=Sc(a),O={};u.bottom-u.top>S&&(u.bottom=u.top+S);var A=a.doc.height+wc(p),L=u.top<h,j=u.bottom>A-h;if(u.top<m)O.scrollTop=L?0:u.top;else if(u.bottom>m+S){var ee=Math.min(u.top,(j?A:u.bottom)-S);ee!=m&&(O.scrollTop=ee)}var oe=a.options.fixedGutter?0:p.gutters.offsetWidth,ve=a.curOp&&a.curOp.scrollLeft!=null?a.curOp.scrollLeft:p.scroller.scrollLeft-oe,fe=Do(a)-p.gutters.offsetWidth,Te=u.right-u.left>fe;return Te&&(u.right=u.left+fe),u.left<10?O.scrollLeft=0:u.left<ve?O.scrollLeft=Math.max(0,u.left+oe-(Te?0:10)):u.right>fe+ve-3&&(O.scrollLeft=u.right+(Te?0:10)-fe),O}function Bc(a,u){u!=null&&(su(a),a.curOp.scrollTop=(a.curOp.scrollTop==null?a.doc.scrollTop:a.curOp.scrollTop)+u)}function va(a){su(a);var u=a.getCursor();a.curOp.scrollToPos={from:u,to:u,margin:a.options.cursorScrollMargin}}function Ns(a,u,p){(u!=null||p!=null)&&su(a),u!=null&&(a.curOp.scrollLeft=u),p!=null&&(a.curOp.scrollTop=p)}function TS(a,u){su(a),a.curOp.scrollToPos=u}function su(a){var u=a.curOp.scrollToPos;if(u){a.curOp.scrollToPos=null;var p=Wp(a,u.from),h=Wp(a,u.to);Jp(a,p,h,u.margin)}}function Jp(a,u,p,h){var m=Ic(a,{left:Math.min(u.left,p.left),top:Math.min(u.top,p.top)-h,right:Math.max(u.right,p.right),bottom:Math.max(u.bottom,p.bottom)+h});Ns(a,m.scrollLeft,m.scrollTop)}function Ms(a,u){Math.abs(a.doc.scrollTop-u)<2||(i||Hc(a,{top:u}),Zp(a,u,!0),i&&Hc(a),Ds(a,100))}function Zp(a,u,p){u=Math.max(0,Math.min(a.display.scroller.scrollHeight-a.display.scroller.clientHeight,u)),!(a.display.scroller.scrollTop==u&&!p)&&(a.doc.scrollTop=u,a.display.scrollbars.setScrollTop(u),a.display.scroller.scrollTop!=u&&(a.display.scroller.scrollTop=u))}function Io(a,u,p,h){u=Math.max(0,Math.min(u,a.display.scroller.scrollWidth-a.display.scroller.clientWidth)),!((p?u==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-u)<2)&&!h)&&(a.doc.scrollLeft=u,rv(a),a.display.scroller.scrollLeft!=u&&(a.display.scroller.scrollLeft=u),a.display.scrollbars.setScrollLeft(u))}function As(a){var u=a.display,p=u.gutters.offsetWidth,h=Math.round(a.doc.height+wc(a.display));return{clientHeight:u.scroller.clientHeight,viewHeight:u.wrapper.clientHeight,scrollWidth:u.scroller.scrollWidth,clientWidth:u.scroller.clientWidth,viewWidth:u.wrapper.clientWidth,barLeft:a.options.fixedGutter?p:0,docHeight:h,scrollHeight:h+Mi(a)+u.barHeight,nativeBarWidth:u.nativeBarWidth,gutterWidth:p}}var Bo=function(a,u,p){this.cm=p;var h=this.vert=P("div",[P("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),m=this.horiz=P("div",[P("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");h.tabIndex=m.tabIndex=-1,a(h),a(m),lt(h,"scroll",function(){h.clientHeight&&u(h.scrollTop,"vertical")}),lt(m,"scroll",function(){m.clientWidth&&u(m.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,d&&c<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Bo.prototype.update=function(a){var u=a.scrollWidth>a.clientWidth+1,p=a.scrollHeight>a.clientHeight+1,h=a.nativeBarWidth;if(p){this.vert.style.display="block",this.vert.style.bottom=u?h+"px":"0";var m=a.viewHeight-(u?h:0);this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+m)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(u){this.horiz.style.display="block",this.horiz.style.right=p?h+"px":"0",this.horiz.style.left=a.barLeft+"px";var S=a.viewWidth-a.barLeft-(p?h:0);this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+S)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&a.clientHeight>0&&(h==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:p?h:0,bottom:u?h:0}},Bo.prototype.setScrollLeft=function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Bo.prototype.setScrollTop=function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Bo.prototype.zeroWidthHack=function(){var a=I&&!x?"12px":"18px";this.horiz.style.height=this.vert.style.width=a,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new Ke,this.disableVert=new Ke},Bo.prototype.enableZeroWidthBar=function(a,u,p){a.style.visibility="";function h(){var m=a.getBoundingClientRect(),S=p=="vert"?document.elementFromPoint(m.right-1,(m.top+m.bottom)/2):document.elementFromPoint((m.right+m.left)/2,m.bottom-1);S!=a?a.style.visibility="hidden":u.set(1e3,h)}u.set(1e3,h)},Bo.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz),a.removeChild(this.vert)};var Ts=function(){};Ts.prototype.update=function(){return{bottom:0,right:0}},Ts.prototype.setScrollLeft=function(){},Ts.prototype.setScrollTop=function(){},Ts.prototype.clear=function(){};function ga(a,u){u||(u=As(a));var p=a.display.barWidth,h=a.display.barHeight;Qp(a,u);for(var m=0;m<4&&p!=a.display.barWidth||h!=a.display.barHeight;m++)p!=a.display.barWidth&&a.options.lineWrapping&&ou(a),Qp(a,As(a)),p=a.display.barWidth,h=a.display.barHeight}function Qp(a,u){var p=a.display,h=p.scrollbars.update(u);p.sizer.style.paddingRight=(p.barWidth=h.right)+"px",p.sizer.style.paddingBottom=(p.barHeight=h.bottom)+"px",p.heightForcer.style.borderBottom=h.bottom+"px solid transparent",h.right&&h.bottom?(p.scrollbarFiller.style.display="block",p.scrollbarFiller.style.height=h.bottom+"px",p.scrollbarFiller.style.width=h.right+"px"):p.scrollbarFiller.style.display="",h.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(p.gutterFiller.style.display="block",p.gutterFiller.style.height=h.bottom+"px",p.gutterFiller.style.width=u.gutterWidth+"px"):p.gutterFiller.style.display=""}var ev={native:Bo,null:Ts};function tv(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Q(a.display.wrapper,a.display.scrollbars.addClass)),a.display.scrollbars=new ev[a.options.scrollbarStyle](function(u){a.display.wrapper.insertBefore(u,a.display.scrollbarFiller),lt(u,"mousedown",function(){a.state.focused&&setTimeout(function(){return a.display.input.focus()},0)}),u.setAttribute("cm-not-content","true")},function(u,p){p=="horizontal"?Io(a,u):Ms(a,u)},a),a.display.scrollbars.addClass&&ye(a.display.wrapper,a.display.scrollbars.addClass)}var DS=0;function jo(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++DS,markArrays:null},uS(a.curOp)}function Ho(a){var u=a.curOp;u&&cS(u,function(p){for(var h=0;h<p.ops.length;h++)p.ops[h].cm.curOp=null;LS(p)})}function LS(a){for(var u=a.ops,p=0;p<u.length;p++)PS(u[p]);for(var h=0;h<u.length;h++)RS(u[h]);for(var m=0;m<u.length;m++)IS(u[m]);for(var S=0;S<u.length;S++)BS(u[S]);for(var O=0;O<u.length;O++)jS(u[O])}function PS(a){var u=a.cm,p=u.display;$S(u),a.updateMaxLine&&bc(u),a.mustUpdate=a.viewChanged||a.forceUpdate||a.scrollTop!=null||a.scrollToPos&&(a.scrollToPos.from.line<p.viewFrom||a.scrollToPos.to.line>=p.viewTo)||p.maxLineChanged&&u.options.lineWrapping,a.update=a.mustUpdate&&new lu(u,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function RS(a){a.updatedDisplay=a.mustUpdate&&jc(a.cm,a.update)}function IS(a){var u=a.cm,p=u.display;a.updatedDisplay&&ou(u),a.barMeasure=As(u),p.maxLineChanged&&!u.options.lineWrapping&&(a.adjustWidthTo=Rp(u,p.maxLine,p.maxLine.text.length).left+3,u.display.sizerWidth=a.adjustWidthTo,a.barMeasure.scrollWidth=Math.max(p.scroller.clientWidth,p.sizer.offsetLeft+a.adjustWidthTo+Mi(u)+u.display.barWidth),a.maxScrollLeft=Math.max(0,p.sizer.offsetLeft+a.adjustWidthTo-Do(u))),(a.updatedDisplay||a.selectionChanged)&&(a.preparedSelection=p.input.prepareSelection())}function BS(a){var u=a.cm;a.adjustWidthTo!=null&&(u.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<u.doc.scrollLeft&&Io(u,Math.min(u.display.scroller.scrollLeft,a.maxScrollLeft),!0),u.display.maxLineChanged=!1);var p=a.focus&&a.focus==Ne(Ve(u));a.preparedSelection&&u.display.input.showSelection(a.preparedSelection,p),(a.updatedDisplay||a.startHeight!=u.doc.height)&&ga(u,a.barMeasure),a.updatedDisplay&&Fc(u,a.barMeasure),a.selectionChanged&&Lc(u),u.state.focused&&a.updateInput&&u.display.input.reset(a.typing),p&&qp(a.cm)}function jS(a){var u=a.cm,p=u.display,h=u.doc;if(a.updatedDisplay&&nv(u,a.update),p.wheelStartX!=null&&(a.scrollTop!=null||a.scrollLeft!=null||a.scrollToPos)&&(p.wheelStartX=p.wheelStartY=null),a.scrollTop!=null&&Zp(u,a.scrollTop,a.forceScroll),a.scrollLeft!=null&&Io(u,a.scrollLeft,!0,!0),a.scrollToPos){var m=MS(u,Mt(h,a.scrollToPos.from),Mt(h,a.scrollToPos.to),a.scrollToPos.margin);NS(u,m)}var S=a.maybeHiddenMarkers,O=a.maybeUnhiddenMarkers;if(S)for(var A=0;A<S.length;++A)S[A].lines.length||Pt(S[A],"hide");if(O)for(var L=0;L<O.length;++L)O[L].lines.length&&Pt(O[L],"unhide");p.wrapper.offsetHeight&&(h.scrollTop=u.display.scroller.scrollTop),a.changeObjs&&Pt(u,"changes",u,a.changeObjs),a.update&&a.update.finish()}function Tr(a,u){if(a.curOp)return u();jo(a);try{return u()}finally{Ho(a)}}function Wn(a,u){return function(){if(a.curOp)return u.apply(a,arguments);jo(a);try{return u.apply(a,arguments)}finally{Ho(a)}}}function ar(a){return function(){if(this.curOp)return a.apply(this,arguments);jo(this);try{return a.apply(this,arguments)}finally{Ho(this)}}}function Un(a){return function(){var u=this.cm;if(!u||u.curOp)return a.apply(this,arguments);jo(u);try{return a.apply(this,arguments)}finally{Ho(u)}}}function Ds(a,u){a.doc.highlightFrontier<a.display.viewTo&&a.state.highlight.set(u,ce(HS,a))}function HS(a){var u=a.doc;if(!(u.highlightFrontier>=a.display.viewTo)){var p=+new Date+a.options.workTime,h=oo(a,u.highlightFrontier),m=[];u.iter(h.line,Math.min(u.first+u.size,a.display.viewTo+500),function(S){if(h.line>=a.display.viewFrom){var O=S.styles,A=S.text.length>a.options.maxHighlightLength?q(u.mode,h.state):null,L=$r(a,S,h,!0);A&&(h.state=A),S.styles=L.styles;var j=S.styleClasses,ee=L.classes;ee?S.styleClasses=ee:j&&(S.styleClasses=null);for(var oe=!O||O.length!=S.styles.length||j!=ee&&(!j||!ee||j.bgClass!=ee.bgClass||j.textClass!=ee.textClass),ve=0;!oe&&ve<O.length;++ve)oe=O[ve]!=S.styles[ve];oe&&m.push(h.line),S.stateAfter=h.save(),h.nextLine()}else S.text.length<=a.options.maxHighlightLength&&pc(a,S.text,h),S.stateAfter=h.line%5==0?h.save():null,h.nextLine();if(+new Date>p)return Ds(a,a.options.workDelay),!0}),u.highlightFrontier=h.line,u.modeFrontier=Math.max(u.modeFrontier,h.line),m.length&&Tr(a,function(){for(var S=0;S<m.length;S++)so(a,m[S],"text")})}}var lu=function(a,u,p){var h=a.display;this.viewport=u,this.visible=au(h,a.doc,u),this.editorIsHidden=!h.wrapper.offsetWidth,this.wrapperHeight=h.wrapper.clientHeight,this.wrapperWidth=h.wrapper.clientWidth,this.oldDisplayWidth=Do(a),this.force=p,this.dims=Mc(a),this.events=[]};lu.prototype.signal=function(a,u){xe(a,u)&&this.events.push(arguments)},lu.prototype.finish=function(){for(var a=0;a<this.events.length;a++)Pt.apply(null,this.events[a])};function $S(a){var u=a.display;!u.scrollbarsClipped&&u.scroller.offsetWidth&&(u.nativeBarWidth=u.scroller.offsetWidth-u.scroller.clientWidth,u.heightForcer.style.height=Mi(a)+"px",u.sizer.style.marginBottom=-u.nativeBarWidth+"px",u.sizer.style.borderRightWidth=Mi(a)+"px",u.scrollbarsClipped=!0)}function FS(a){if(a.hasFocus())return null;var u=Ne(Ve(a));if(!u||!he(a.display.lineDiv,u))return null;var p={activeElt:u};if(window.getSelection){var h=te(a).getSelection();h.anchorNode&&h.extend&&he(a.display.lineDiv,h.anchorNode)&&(p.anchorNode=h.anchorNode,p.anchorOffset=h.anchorOffset,p.focusNode=h.focusNode,p.focusOffset=h.focusOffset)}return p}function zS(a){if(!(!a||!a.activeElt||a.activeElt==Ne(Ae(a.activeElt)))&&(a.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(a.activeElt.nodeName)&&a.anchorNode&&he(document.body,a.anchorNode)&&he(document.body,a.focusNode))){var u=a.activeElt.ownerDocument,p=u.defaultView.getSelection(),h=u.createRange();h.setEnd(a.anchorNode,a.anchorOffset),h.collapse(!1),p.removeAllRanges(),p.addRange(h),p.extend(a.focusNode,a.focusOffset)}}function jc(a,u){var p=a.display,h=a.doc;if(u.editorIsHidden)return lo(a),!1;if(!u.force&&u.visible.from>=p.viewFrom&&u.visible.to<=p.viewTo&&(p.updateLineNumbers==null||p.updateLineNumbers>=p.viewTo)&&p.renderedView==p.view&&Gp(a)==0)return!1;iv(a)&&(lo(a),u.dims=Mc(a));var m=h.first+h.size,S=Math.max(u.visible.from-a.options.viewportMargin,h.first),O=Math.min(m,u.visible.to+a.options.viewportMargin);p.viewFrom<S&&S-p.viewFrom<20&&(S=Math.max(h.first,p.viewFrom)),p.viewTo>O&&p.viewTo-O<20&&(O=Math.min(m,p.viewTo)),Xi&&(S=yc(a.doc,S),O=Sp(a.doc,O));var A=S!=p.viewFrom||O!=p.viewTo||p.lastWrapHeight!=u.wrapperHeight||p.lastWrapWidth!=u.wrapperWidth;OS(a,S,O),p.viewOffset=Gi(We(a.doc,p.viewFrom)),a.display.mover.style.top=p.viewOffset+"px";var L=Gp(a);if(!A&&L==0&&!u.force&&p.renderedView==p.view&&(p.updateLineNumbers==null||p.updateLineNumbers>=p.viewTo))return!1;var j=FS(a);return L>4&&(p.lineDiv.style.display="none"),WS(a,p.updateLineNumbers,u.dims),L>4&&(p.lineDiv.style.display=""),p.renderedView=p.view,zS(j),T(p.cursorDiv),T(p.selectionDiv),p.gutters.style.height=p.sizer.style.minHeight=0,A&&(p.lastWrapHeight=u.wrapperHeight,p.lastWrapWidth=u.wrapperWidth,Ds(a,400)),p.updateLineNumbers=null,!0}function nv(a,u){for(var p=u.viewport,h=!0;;h=!1){if(!h||!a.options.lineWrapping||u.oldDisplayWidth==Do(a)){if(p&&p.top!=null&&(p={top:Math.min(a.doc.height+wc(a.display)-Sc(a),p.top)}),u.visible=au(a.display,a.doc,p),u.visible.from>=a.display.viewFrom&&u.visible.to<=a.display.viewTo)break}else h&&(u.visible=au(a.display,a.doc,p));if(!jc(a,u))break;ou(a);var m=As(a);ks(a),ga(a,m),Fc(a,m),u.force=!1}u.signal(a,"update",a),(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)&&(u.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo)}function Hc(a,u){var p=new lu(a,u);if(jc(a,p)){ou(a),nv(a,p);var h=As(a);ks(a),ga(a,h),Fc(a,h),p.finish()}}function WS(a,u,p){var h=a.display,m=a.options.lineNumbers,S=h.lineDiv,O=S.firstChild;function A(Te){var Be=Te.nextSibling;return f&&I&&a.display.currentWheelTarget==Te?Te.style.display="none":Te.parentNode.removeChild(Te),Be}for(var L=h.view,j=h.viewFrom,ee=0;ee<L.length;ee++){var oe=L[ee];if(!oe.hidden)if(!oe.node||oe.node.parentNode!=S){var ve=gS(a,oe,j,p);S.insertBefore(ve,O)}else{for(;O!=oe.node;)O=A(O);var fe=m&&u!=null&&u<=j&&oe.lineNumber;oe.changes&&($e(oe.changes,"gutter")>-1&&(fe=!1),Np(a,oe,j,p)),fe&&(T(oe.lineNumber),oe.lineNumber.appendChild(document.createTextNode(Ee(a.options,j)))),O=oe.node.nextSibling}j+=oe.size}for(;O;)O=A(O)}function $c(a){var u=a.gutters.offsetWidth;a.sizer.style.marginLeft=u+"px",zn(a,"gutterChanged",a)}function Fc(a,u){a.display.sizer.style.minHeight=u.docHeight+"px",a.display.heightForcer.style.top=u.docHeight+"px",a.display.gutters.style.height=u.docHeight+a.display.barHeight+Mi(a)+"px"}function rv(a){var u=a.display,p=u.view;if(!(!u.alignWidgets&&(!u.gutters.firstChild||!a.options.fixedGutter))){for(var h=Ac(u)-u.scroller.scrollLeft+a.doc.scrollLeft,m=u.gutters.offsetWidth,S=h+"px",O=0;O<p.length;O++)if(!p[O].hidden){a.options.fixedGutter&&(p[O].gutter&&(p[O].gutter.style.left=S),p[O].gutterBackground&&(p[O].gutterBackground.style.left=S));var A=p[O].alignable;if(A)for(var L=0;L<A.length;L++)A[L].style.left=S}a.options.fixedGutter&&(u.gutters.style.left=h+m+"px")}}function iv(a){if(!a.options.lineNumbers)return!1;var u=a.doc,p=Ee(a.options,u.first+u.size-1),h=a.display;if(p.length!=h.lineNumChars){var m=h.measure.appendChild(P("div",[P("div",p)],"CodeMirror-linenumber CodeMirror-gutter-elt")),S=m.firstChild.offsetWidth,O=m.offsetWidth-S;return h.lineGutter.style.width="",h.lineNumInnerWidth=Math.max(S,h.lineGutter.offsetWidth-O)+1,h.lineNumWidth=h.lineNumInnerWidth+O,h.lineNumChars=h.lineNumInnerWidth?p.length:-1,h.lineGutter.style.width=h.lineNumWidth+"px",$c(a.display),!0}return!1}function zc(a,u){for(var p=[],h=!1,m=0;m<a.length;m++){var S=a[m],O=null;if(typeof S!="string"&&(O=S.style,S=S.className),S=="CodeMirror-linenumbers")if(u)h=!0;else continue;p.push({className:S,style:O})}return u&&!h&&p.push({className:"CodeMirror-linenumbers",style:null}),p}function ov(a){var u=a.gutters,p=a.gutterSpecs;T(u),a.lineGutter=null;for(var h=0;h<p.length;++h){var m=p[h],S=m.className,O=m.style,A=u.appendChild(P("div",null,"CodeMirror-gutter "+S));O&&(A.style.cssText=O),S=="CodeMirror-linenumbers"&&(a.lineGutter=A,A.style.width=(a.lineNumWidth||1)+"px")}u.style.display=p.length?"":"none",$c(a)}function Ls(a){ov(a.display),vr(a),rv(a)}function US(a,u,p,h){var m=this;this.input=p,m.scrollbarFiller=P("div",null,"CodeMirror-scrollbar-filler"),m.scrollbarFiller.setAttribute("cm-not-content","true"),m.gutterFiller=P("div",null,"CodeMirror-gutter-filler"),m.gutterFiller.setAttribute("cm-not-content","true"),m.lineDiv=le("div",null,"CodeMirror-code"),m.selectionDiv=P("div",null,null,"position: relative; z-index: 1"),m.cursorDiv=P("div",null,"CodeMirror-cursors"),m.measure=P("div",null,"CodeMirror-measure"),m.lineMeasure=P("div",null,"CodeMirror-measure"),m.lineSpace=le("div",[m.measure,m.lineMeasure,m.selectionDiv,m.cursorDiv,m.lineDiv],null,"position: relative; outline: none");var S=le("div",[m.lineSpace],"CodeMirror-lines");m.mover=P("div",[S],null,"position: relative"),m.sizer=P("div",[m.mover],"CodeMirror-sizer"),m.sizerWidth=null,m.heightForcer=P("div",null,null,"position: absolute; height: "+Ue+"px; width: 1px;"),m.gutters=P("div",null,"CodeMirror-gutters"),m.lineGutter=null,m.scroller=P("div",[m.sizer,m.heightForcer,m.gutters],"CodeMirror-scroll"),m.scroller.setAttribute("tabIndex","-1"),m.wrapper=P("div",[m.scrollbarFiller,m.gutterFiller,m.scroller],"CodeMirror"),g&&y>=105&&(m.wrapper.style.clipPath="inset(0px)"),m.wrapper.setAttribute("translate","no"),d&&c<8&&(m.gutters.style.zIndex=-1,m.scroller.style.paddingRight=0),!f&&!(i&&D)&&(m.scroller.draggable=!0),a&&(a.appendChild?a.appendChild(m.wrapper):a(m.wrapper)),m.viewFrom=m.viewTo=u.first,m.reportedViewFrom=m.reportedViewTo=u.first,m.view=[],m.renderedView=null,m.externalMeasured=null,m.viewOffset=0,m.lastWrapHeight=m.lastWrapWidth=0,m.updateLineNumbers=null,m.nativeBarWidth=m.barHeight=m.barWidth=0,m.scrollbarsClipped=!1,m.lineNumWidth=m.lineNumInnerWidth=m.lineNumChars=null,m.alignWidgets=!1,m.cachedCharWidth=m.cachedTextHeight=m.cachedPaddingH=null,m.maxLine=null,m.maxLineLength=0,m.maxLineChanged=!1,m.wheelDX=m.wheelDY=m.wheelStartX=m.wheelStartY=null,m.shift=!1,m.selForContextMenu=null,m.activeTouch=null,m.gutterSpecs=zc(h.gutters,h.lineNumbers),ov(m),p.init(m)}var uu=0,qi=null;d?qi=-.53:i?qi=15:g?qi=-.7:_&&(qi=-1/3);function av(a){var u=a.wheelDeltaX,p=a.wheelDeltaY;return u==null&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(u=a.detail),p==null&&a.detail&&a.axis==a.VERTICAL_AXIS?p=a.detail:p==null&&(p=a.wheelDelta),{x:u,y:p}}function VS(a){var u=av(a);return u.x*=qi,u.y*=qi,u}function sv(a,u){g&&y==102&&(a.display.chromeScrollHack==null?a.display.sizer.style.pointerEvents="none":clearTimeout(a.display.chromeScrollHack),a.display.chromeScrollHack=setTimeout(function(){a.display.chromeScrollHack=null,a.display.sizer.style.pointerEvents=""},100));var p=av(u),h=p.x,m=p.y,S=qi;u.deltaMode===0&&(h=u.deltaX,m=u.deltaY,S=1);var O=a.display,A=O.scroller,L=A.scrollWidth>A.clientWidth,j=A.scrollHeight>A.clientHeight;if(h&&L||m&&j){if(m&&I&&f){e:for(var ee=u.target,oe=O.view;ee!=A;ee=ee.parentNode)for(var ve=0;ve<oe.length;ve++)if(oe[ve].node==ee){a.display.currentWheelTarget=ee;break e}}if(h&&!i&&!b&&S!=null){m&&j&&Ms(a,Math.max(0,A.scrollTop+m*S)),Io(a,Math.max(0,A.scrollLeft+h*S)),(!m||m&&j)&&ht(u),O.wheelStartX=null;return}if(m&&S!=null){var fe=m*S,Te=a.doc.scrollTop,Be=Te+O.wrapper.clientHeight;fe<0?Te=Math.max(0,Te+fe-50):Be=Math.min(a.doc.height,Be+fe+50),Hc(a,{top:Te,bottom:Be})}uu<20&&u.deltaMode!==0&&(O.wheelStartX==null?(O.wheelStartX=A.scrollLeft,O.wheelStartY=A.scrollTop,O.wheelDX=h,O.wheelDY=m,setTimeout(function(){if(O.wheelStartX!=null){var Ye=A.scrollLeft-O.wheelStartX,tt=A.scrollTop-O.wheelStartY,st=tt&&O.wheelDY&&tt/O.wheelDY||Ye&&O.wheelDX&&Ye/O.wheelDX;O.wheelStartX=O.wheelStartY=null,st&&(qi=(qi*uu+st)/(uu+1),++uu)}},200)):(O.wheelDX+=h,O.wheelDY+=m))}}var Fr=function(a,u){this.ranges=a,this.primIndex=u};Fr.prototype.primary=function(){return this.ranges[this.primIndex]},Fr.prototype.equals=function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var u=0;u<this.ranges.length;u++){var p=this.ranges[u],h=a.ranges[u];if(!Je(p.anchor,h.anchor)||!Je(p.head,h.head))return!1}return!0},Fr.prototype.deepCopy=function(){for(var a=[],u=0;u<this.ranges.length;u++)a[u]=new tn(ct(this.ranges[u].anchor),ct(this.ranges[u].head));return new Fr(a,this.primIndex)},Fr.prototype.somethingSelected=function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},Fr.prototype.contains=function(a,u){u||(u=a);for(var p=0;p<this.ranges.length;p++){var h=this.ranges[p];if(be(u,h.from())>=0&&be(a,h.to())<=0)return p}return-1};var tn=function(a,u){this.anchor=a,this.head=u};tn.prototype.from=function(){return Cn(this.anchor,this.head)},tn.prototype.to=function(){return Ot(this.anchor,this.head)},tn.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function ui(a,u,p){var h=a&&a.options.selectionsMayTouch,m=u[p];u.sort(function(ve,fe){return be(ve.from(),fe.from())}),p=$e(u,m);for(var S=1;S<u.length;S++){var O=u[S],A=u[S-1],L=be(A.to(),O.from());if(h&&!O.empty()?L>0:L>=0){var j=Cn(A.from(),O.from()),ee=Ot(A.to(),O.to()),oe=A.empty()?O.from()==O.head:A.from()==A.head;S<=p&&--p,u.splice(--S,2,new tn(oe?ee:j,oe?j:ee))}}return new Fr(u,p)}function uo(a,u){return new Fr([new tn(a,u||a)],0)}function co(a){return a.text?pe(a.from.line+a.text.length-1,N(a.text).length+(a.text.length==1?a.from.ch:0)):a.to}function lv(a,u){if(be(a,u.from)<0)return a;if(be(a,u.to)<=0)return co(u);var p=a.line+u.text.length-(u.to.line-u.from.line)-1,h=a.ch;return a.line==u.to.line&&(h+=co(u).ch-u.to.ch),pe(p,h)}function Wc(a,u){for(var p=[],h=0;h<a.sel.ranges.length;h++){var m=a.sel.ranges[h];p.push(new tn(lv(m.anchor,u),lv(m.head,u)))}return ui(a.cm,p,a.sel.primIndex)}function uv(a,u,p){return a.line==u.line?pe(p.line,a.ch-u.ch+p.ch):pe(p.line+(a.line-u.line),a.ch)}function XS(a,u,p){for(var h=[],m=pe(a.first,0),S=m,O=0;O<u.length;O++){var A=u[O],L=uv(A.from,m,S),j=uv(co(A),m,S);if(m=A.to,S=j,p=="around"){var ee=a.sel.ranges[O],oe=be(ee.head,ee.anchor)<0;h[O]=new tn(oe?j:L,oe?L:j)}else h[O]=new tn(L,L)}return new Fr(h,a.sel.primIndex)}function Uc(a){a.doc.mode=Xr(a.options,a.doc.modeOption),Ps(a)}function Ps(a){a.doc.iter(function(u){u.stateAfter&&(u.stateAfter=null),u.styles&&(u.styles=null)}),a.doc.modeFrontier=a.doc.highlightFrontier=a.doc.first,Ds(a,100),a.state.modeGen++,a.curOp&&vr(a)}function dv(a,u){return u.from.ch==0&&u.to.ch==0&&N(u.text)==""&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Vc(a,u,p,h){function m(st){return p?p[st]:null}function S(st,nt,dt){eS(st,nt,dt,h),zn(st,"change",st,u)}function O(st,nt){for(var dt=[],St=st;St<nt;++St)dt.push(new ua(j[St],m(St),h));return dt}var A=u.from,L=u.to,j=u.text,ee=We(a,A.line),oe=We(a,L.line),ve=N(j),fe=m(j.length-1),Te=L.line-A.line;if(u.full)a.insert(0,O(0,j.length)),a.remove(j.length,a.size-j.length);else if(dv(a,u)){var Be=O(0,j.length-1);S(oe,oe.text,fe),Te&&a.remove(A.line,Te),Be.length&&a.insert(A.line,Be)}else if(ee==oe)if(j.length==1)S(ee,ee.text.slice(0,A.ch)+ve+ee.text.slice(L.ch),fe);else{var Ye=O(1,j.length-1);Ye.push(new ua(ve+ee.text.slice(L.ch),fe,h)),S(ee,ee.text.slice(0,A.ch)+j[0],m(0)),a.insert(A.line+1,Ye)}else if(j.length==1)S(ee,ee.text.slice(0,A.ch)+j[0]+oe.text.slice(L.ch),m(0)),a.remove(A.line+1,Te);else{S(ee,ee.text.slice(0,A.ch)+j[0],m(0)),S(oe,ve+oe.text.slice(L.ch),fe);var tt=O(1,j.length-1);Te>1&&a.remove(A.line+1,Te-1),a.insert(A.line+1,tt)}zn(a,"change",a,u)}function fo(a,u,p){function h(m,S,O){if(m.linked)for(var A=0;A<m.linked.length;++A){var L=m.linked[A];if(L.doc!=S){var j=O&&L.sharedHist;p&&!j||(u(L.doc,j),h(L.doc,m,j))}}}h(a,null,!0)}function cv(a,u){if(u.cm)throw new Error("This document is already in use.");a.doc=u,u.cm=a,Tc(a),Uc(a),fv(a),a.options.direction=u.direction,a.options.lineWrapping||bc(a),a.options.mode=u.modeOption,vr(a)}function fv(a){(a.doc.direction=="rtl"?ye:Q)(a.display.lineDiv,"CodeMirror-rtl")}function GS(a){Tr(a,function(){fv(a),vr(a)})}function du(a){this.done=[],this.undone=[],this.undoDepth=a?a.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a?a.maxGeneration:1}function Xc(a,u){var p={from:ct(u.from),to:co(u),text:It(a,u.from,u.to)};return vv(a,p,u.from.line,u.to.line+1),fo(a,function(h){return vv(h,p,u.from.line,u.to.line+1)},!0),p}function hv(a){for(;a.length;){var u=N(a);if(u.ranges)a.pop();else break}}function YS(a,u){if(u)return hv(a.done),N(a.done);if(a.done.length&&!N(a.done).ranges)return N(a.done);if(a.done.length>1&&!a.done[a.done.length-2].ranges)return a.done.pop(),N(a.done)}function pv(a,u,p,h){var m=a.history;m.undone.length=0;var S=+new Date,O,A;if((m.lastOp==h||m.lastOrigin==u.origin&&u.origin&&(u.origin.charAt(0)=="+"&&m.lastModTime>S-(a.cm?a.cm.options.historyEventDelay:500)||u.origin.charAt(0)=="*"))&&(O=YS(m,m.lastOp==h)))A=N(O.changes),be(u.from,u.to)==0&&be(u.from,A.to)==0?A.to=co(u):O.changes.push(Xc(a,u));else{var L=N(m.done);for((!L||!L.ranges)&&cu(a.sel,m.done),O={changes:[Xc(a,u)],generation:m.generation},m.done.push(O);m.done.length>m.undoDepth;)m.done.shift(),m.done[0].ranges||m.done.shift()}m.done.push(p),m.generation=++m.maxGeneration,m.lastModTime=m.lastSelTime=S,m.lastOp=m.lastSelOp=h,m.lastOrigin=m.lastSelOrigin=u.origin,A||Pt(a,"historyAdded")}function qS(a,u,p,h){var m=u.charAt(0);return m=="*"||m=="+"&&p.ranges.length==h.ranges.length&&p.somethingSelected()==h.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function KS(a,u,p,h){var m=a.history,S=h&&h.origin;p==m.lastSelOp||S&&m.lastSelOrigin==S&&(m.lastModTime==m.lastSelTime&&m.lastOrigin==S||qS(a,S,N(m.done),u))?m.done[m.done.length-1]=u:cu(u,m.done),m.lastSelTime=+new Date,m.lastSelOrigin=S,m.lastSelOp=p,h&&h.clearRedo!==!1&&hv(m.undone)}function cu(a,u){var p=N(u);p&&p.ranges&&p.equals(a)||u.push(a)}function vv(a,u,p,h){var m=u["spans_"+a.id],S=0;a.iter(Math.max(a.first,p),Math.min(a.first+a.size,h),function(O){O.markedSpans&&((m||(m=u["spans_"+a.id]={}))[S]=O.markedSpans),++S})}function JS(a){if(!a)return null;for(var u,p=0;p<a.length;++p)a[p].marker.explicitlyCleared?u||(u=a.slice(0,p)):u&&u.push(a[p]);return u?u.length?u:null:a}function ZS(a,u){var p=u["spans_"+a.id];if(!p)return null;for(var h=[],m=0;m<u.text.length;++m)h.push(JS(p[m]));return h}function gv(a,u){var p=ZS(a,u),h=gc(a,u);if(!p)return h;if(!h)return p;for(var m=0;m<p.length;++m){var S=p[m],O=h[m];if(S&&O)e:for(var A=0;A<O.length;++A){for(var L=O[A],j=0;j<S.length;++j)if(S[j].marker==L.marker)continue e;S.push(L)}else O&&(p[m]=O)}return p}function ma(a,u,p){for(var h=[],m=0;m<a.length;++m){var S=a[m];if(S.ranges){h.push(p?Fr.prototype.deepCopy.call(S):S);continue}var O=S.changes,A=[];h.push({changes:A});for(var L=0;L<O.length;++L){var j=O[L],ee=void 0;if(A.push({from:j.from,to:j.to,text:j.text}),u)for(var oe in j)(ee=oe.match(/^spans_(\d+)$/))&&$e(u,Number(ee[1]))>-1&&(N(A)[oe]=j[oe],delete j[oe])}}return h}function Gc(a,u,p,h){if(h){var m=a.anchor;if(p){var S=be(u,m)<0;S!=be(p,m)<0?(m=u,u=p):S!=be(u,p)<0&&(u=p)}return new tn(m,u)}else return new tn(p||u,u)}function fu(a,u,p,h,m){m==null&&(m=a.cm&&(a.cm.display.shift||a.extend)),Zn(a,new Fr([Gc(a.sel.primary(),u,p,m)],0),h)}function mv(a,u,p){for(var h=[],m=a.cm&&(a.cm.display.shift||a.extend),S=0;S<a.sel.ranges.length;S++)h[S]=Gc(a.sel.ranges[S],u[S],null,m);var O=ui(a.cm,h,a.sel.primIndex);Zn(a,O,p)}function Yc(a,u,p,h){var m=a.sel.ranges.slice(0);m[u]=p,Zn(a,ui(a.cm,m,a.sel.primIndex),h)}function yv(a,u,p,h){Zn(a,uo(u,p),h)}function QS(a,u,p){var h={ranges:u.ranges,update:function(m){this.ranges=[];for(var S=0;S<m.length;S++)this.ranges[S]=new tn(Mt(a,m[S].anchor),Mt(a,m[S].head))},origin:p&&p.origin};return Pt(a,"beforeSelectionChange",a,h),a.cm&&Pt(a.cm,"beforeSelectionChange",a.cm,h),h.ranges!=u.ranges?ui(a.cm,h.ranges,h.ranges.length-1):u}function _v(a,u,p){var h=a.history.done,m=N(h);m&&m.ranges?(h[h.length-1]=u,hu(a,u,p)):Zn(a,u,p)}function Zn(a,u,p){hu(a,u,p),KS(a,a.sel,a.cm?a.cm.curOp.id:NaN,p)}function hu(a,u,p){(xe(a,"beforeSelectionChange")||a.cm&&xe(a.cm,"beforeSelectionChange"))&&(u=QS(a,u,p));var h=p&&p.bias||(be(u.primary().head,a.sel.primary().head)<0?-1:1);bv(a,wv(a,u,h,!0)),!(p&&p.scroll===!1)&&a.cm&&a.cm.getOption("readOnly")!="nocursor"&&va(a.cm)}function bv(a,u){u.equals(a.sel)||(a.sel=u,a.cm&&(a.cm.curOp.updateInput=1,a.cm.curOp.selectionChanged=!0,Jt(a.cm)),zn(a,"cursorActivity",a))}function xv(a){bv(a,wv(a,a.sel,null,!1))}function wv(a,u,p,h){for(var m,S=0;S<u.ranges.length;S++){var O=u.ranges[S],A=u.ranges.length==a.sel.ranges.length&&a.sel.ranges[S],L=pu(a,O.anchor,A&&A.anchor,p,h),j=O.head==O.anchor?L:pu(a,O.head,A&&A.head,p,h);(m||L!=O.anchor||j!=O.head)&&(m||(m=u.ranges.slice(0,S)),m[S]=new tn(L,j))}return m?ui(a.cm,m,u.primIndex):u}function ya(a,u,p,h,m){var S=We(a,u.line);if(S.markedSpans)for(var O=0;O<S.markedSpans.length;++O){var A=S.markedSpans[O],L=A.marker,j="selectLeft"in L?!L.selectLeft:L.inclusiveLeft,ee="selectRight"in L?!L.selectRight:L.inclusiveRight;if((A.from==null||(j?A.from<=u.ch:A.from<u.ch))&&(A.to==null||(ee?A.to>=u.ch:A.to>u.ch))){if(m&&(Pt(L,"beforeCursorEnter"),L.explicitlyCleared))if(S.markedSpans){--O;continue}else break;if(!L.atomic)continue;if(p){var oe=L.find(h<0?1:-1),ve=void 0;if((h<0?ee:j)&&(oe=Sv(a,oe,-h,oe&&oe.line==u.line?S:null)),oe&&oe.line==u.line&&(ve=be(oe,p))&&(h<0?ve<0:ve>0))return ya(a,oe,u,h,m)}var fe=L.find(h<0?-1:1);return(h<0?j:ee)&&(fe=Sv(a,fe,h,fe.line==u.line?S:null)),fe?ya(a,fe,u,h,m):null}}return u}function pu(a,u,p,h,m){var S=h||1,O=ya(a,u,p,S,m)||!m&&ya(a,u,p,S,!0)||ya(a,u,p,-S,m)||!m&&ya(a,u,p,-S,!0);return O||(a.cantEdit=!0,pe(a.first,0))}function Sv(a,u,p,h){return p<0&&u.ch==0?u.line>a.first?Mt(a,pe(u.line-1)):null:p>0&&u.ch==(h||We(a,u.line)).text.length?u.line<a.first+a.size-1?pe(u.line+1,0):null:new pe(u.line,u.ch+p)}function Ev(a){a.setSelection(pe(a.firstLine(),0),pe(a.lastLine()),ot)}function Cv(a,u,p){var h={canceled:!1,from:u.from,to:u.to,text:u.text,origin:u.origin,cancel:function(){return h.canceled=!0}};return p&&(h.update=function(m,S,O,A){m&&(h.from=Mt(a,m)),S&&(h.to=Mt(a,S)),O&&(h.text=O),A!==void 0&&(h.origin=A)}),Pt(a,"beforeChange",a,h),a.cm&&Pt(a.cm,"beforeChange",a.cm,h),h.canceled?(a.cm&&(a.cm.curOp.updateInput=2),null):{from:h.from,to:h.to,text:h.text,origin:h.origin}}function _a(a,u,p){if(a.cm){if(!a.cm.curOp)return Wn(a.cm,_a)(a,u,p);if(a.cm.state.suppressEdits)return}if(!((xe(a,"beforeChange")||a.cm&&xe(a.cm,"beforeChange"))&&(u=Cv(a,u,!0),!u))){var h=gp&&!p&&Kw(a,u.from,u.to);if(h)for(var m=h.length-1;m>=0;--m)Ov(a,{from:h[m].from,to:h[m].to,text:m?[""]:u.text,origin:u.origin});else Ov(a,u)}}function Ov(a,u){if(!(u.text.length==1&&u.text[0]==""&&be(u.from,u.to)==0)){var p=Wc(a,u);pv(a,u,p,a.cm?a.cm.curOp.id:NaN),Rs(a,u,p,gc(a,u));var h=[];fo(a,function(m,S){!S&&$e(h,m.history)==-1&&(Av(m.history,u),h.push(m.history)),Rs(m,u,null,gc(m,u))})}}function vu(a,u,p){var h=a.cm&&a.cm.state.suppressEdits;if(!(h&&!p)){for(var m=a.history,S,O=a.sel,A=u=="undo"?m.done:m.undone,L=u=="undo"?m.undone:m.done,j=0;j<A.length&&(S=A[j],!(p?S.ranges&&!S.equals(a.sel):!S.ranges));j++);if(j!=A.length){for(m.lastOrigin=m.lastSelOrigin=null;;)if(S=A.pop(),S.ranges){if(cu(S,L),p&&!S.equals(a.sel)){Zn(a,S,{clearRedo:!1});return}O=S}else if(h){A.push(S);return}else break;var ee=[];cu(O,L),L.push({changes:ee,generation:m.generation}),m.generation=S.generation||++m.maxGeneration;for(var oe=xe(a,"beforeChange")||a.cm&&xe(a.cm,"beforeChange"),ve=function(Be){var Ye=S.changes[Be];if(Ye.origin=u,oe&&!Cv(a,Ye,!1))return A.length=0,{};ee.push(Xc(a,Ye));var tt=Be?Wc(a,Ye):N(A);Rs(a,Ye,tt,gv(a,Ye)),!Be&&a.cm&&a.cm.scrollIntoView({from:Ye.from,to:co(Ye)});var st=[];fo(a,function(nt,dt){!dt&&$e(st,nt.history)==-1&&(Av(nt.history,Ye),st.push(nt.history)),Rs(nt,Ye,null,gv(nt,Ye))})},fe=S.changes.length-1;fe>=0;--fe){var Te=ve(fe);if(Te)return Te.v}}}}function kv(a,u){if(u!=0&&(a.first+=u,a.sel=new Fr(H(a.sel.ranges,function(m){return new tn(pe(m.anchor.line+u,m.anchor.ch),pe(m.head.line+u,m.head.ch))}),a.sel.primIndex),a.cm)){vr(a.cm,a.first,a.first-u,u);for(var p=a.cm.display,h=p.viewFrom;h<p.viewTo;h++)so(a.cm,h,"gutter")}}function Rs(a,u,p,h){if(a.cm&&!a.cm.curOp)return Wn(a.cm,Rs)(a,u,p,h);if(u.to.line<a.first){kv(a,u.text.length-1-(u.to.line-u.from.line));return}if(!(u.from.line>a.lastLine())){if(u.from.line<a.first){var m=u.text.length-1-(a.first-u.from.line);kv(a,m),u={from:pe(a.first,0),to:pe(u.to.line+m,u.to.ch),text:[N(u.text)],origin:u.origin}}var S=a.lastLine();u.to.line>S&&(u={from:u.from,to:pe(S,We(a,S).text.length),text:[u.text[0]],origin:u.origin}),u.removed=It(a,u.from,u.to),p||(p=Wc(a,u)),a.cm?eE(a.cm,u,h):Vc(a,u,h),hu(a,p,ot),a.cantEdit&&pu(a,pe(a.firstLine(),0))&&(a.cantEdit=!1)}}function eE(a,u,p){var h=a.doc,m=a.display,S=u.from,O=u.to,A=!1,L=S.line;a.options.lineWrapping||(L=M(si(We(h,S.line))),h.iter(L,O.line+1,function(fe){if(fe==m.maxLine)return A=!0,!0})),h.sel.contains(u.from,u.to)>-1&&Jt(a),Vc(h,u,p,Xp(a)),a.options.lineWrapping||(h.iter(L,S.line+u.text.length,function(fe){var Te=Zl(fe);Te>m.maxLineLength&&(m.maxLine=fe,m.maxLineLength=Te,m.maxLineChanged=!0,A=!1)}),A&&(a.curOp.updateMaxLine=!0)),Ww(h,S.line),Ds(a,400);var j=u.text.length-(O.line-S.line)-1;u.full?vr(a):S.line==O.line&&u.text.length==1&&!dv(a.doc,u)?so(a,S.line,"text"):vr(a,S.line,O.line+1,j);var ee=xe(a,"changes"),oe=xe(a,"change");if(oe||ee){var ve={from:S,to:O,text:u.text,removed:u.removed,origin:u.origin};oe&&zn(a,"change",a,ve),ee&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(ve)}a.display.selForContextMenu=null}function ba(a,u,p,h,m){var S;h||(h=p),be(h,p)<0&&(S=[h,p],p=S[0],h=S[1]),typeof u=="string"&&(u=a.splitLines(u)),_a(a,{from:p,to:h,text:u,origin:m})}function Nv(a,u,p,h){p<a.line?a.line+=h:u<a.line&&(a.line=u,a.ch=0)}function Mv(a,u,p,h){for(var m=0;m<a.length;++m){var S=a[m],O=!0;if(S.ranges){S.copied||(S=a[m]=S.deepCopy(),S.copied=!0);for(var A=0;A<S.ranges.length;A++)Nv(S.ranges[A].anchor,u,p,h),Nv(S.ranges[A].head,u,p,h);continue}for(var L=0;L<S.changes.length;++L){var j=S.changes[L];if(p<j.from.line)j.from=pe(j.from.line+h,j.from.ch),j.to=pe(j.to.line+h,j.to.ch);else if(u<=j.to.line){O=!1;break}}O||(a.splice(0,m+1),m=0)}}function Av(a,u){var p=u.from.line,h=u.to.line,m=u.text.length-(h-p)-1;Mv(a.done,p,h,m),Mv(a.undone,p,h,m)}function Is(a,u,p,h){var m=u,S=u;return typeof u=="number"?S=We(a,xs(a,u)):m=M(u),m==null?null:(h(S,m)&&a.cm&&so(a.cm,m,p),S)}function Bs(a){this.lines=a,this.parent=null;for(var u=0,p=0;p<a.length;++p)a[p].parent=this,u+=a[p].height;this.height=u}Bs.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,u){for(var p=a,h=a+u;p<h;++p){var m=this.lines[p];this.height-=m.height,tS(m),zn(m,"delete")}this.lines.splice(a,u)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,u,p){this.height+=p,this.lines=this.lines.slice(0,a).concat(u).concat(this.lines.slice(a));for(var h=0;h<u.length;++h)u[h].parent=this},iterN:function(a,u,p){for(var h=a+u;a<h;++a)if(p(this.lines[a]))return!0}};function js(a){this.children=a;for(var u=0,p=0,h=0;h<a.length;++h){var m=a[h];u+=m.chunkSize(),p+=m.height,m.parent=this}this.size=u,this.height=p,this.parent=null}js.prototype={chunkSize:function(){return this.size},removeInner:function(a,u){this.size-=u;for(var p=0;p<this.children.length;++p){var h=this.children[p],m=h.chunkSize();if(a<m){var S=Math.min(u,m-a),O=h.height;if(h.removeInner(a,S),this.height-=O-h.height,m==S&&(this.children.splice(p--,1),h.parent=null),(u-=S)==0)break;a=0}else a-=m}if(this.size-u<25&&(this.children.length>1||!(this.children[0]instanceof Bs))){var A=[];this.collapse(A),this.children=[new Bs(A)],this.children[0].parent=this}},collapse:function(a){for(var u=0;u<this.children.length;++u)this.children[u].collapse(a)},insertInner:function(a,u,p){this.size+=u.length,this.height+=p;for(var h=0;h<this.children.length;++h){var m=this.children[h],S=m.chunkSize();if(a<=S){if(m.insertInner(a,u,p),m.lines&&m.lines.length>50){for(var O=m.lines.length%25+25,A=O;A<m.lines.length;){var L=new Bs(m.lines.slice(A,A+=25));m.height-=L.height,this.children.splice(++h,0,L),L.parent=this}m.lines=m.lines.slice(0,O),this.maybeSpill()}break}a-=S}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var u=a.children.splice(a.children.length-5,5),p=new js(u);if(a.parent){a.size-=p.size,a.height-=p.height;var m=$e(a.parent.children,a);a.parent.children.splice(m+1,0,p)}else{var h=new js(a.children);h.parent=a,a.children=[h,p],a=h}p.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,u,p){for(var h=0;h<this.children.length;++h){var m=this.children[h],S=m.chunkSize();if(a<S){var O=Math.min(u,S-a);if(m.iterN(a,O,p))return!0;if((u-=O)==0)break;a=0}else a-=S}}};var Hs=function(a,u,p){if(p)for(var h in p)p.hasOwnProperty(h)&&(this[h]=p[h]);this.doc=a,this.node=u};Hs.prototype.clear=function(){var a=this.doc.cm,u=this.line.widgets,p=this.line,h=M(p);if(!(h==null||!u)){for(var m=0;m<u.length;++m)u[m]==this&&u.splice(m--,1);u.length||(p.widgets=null);var S=Cs(this);K(p,Math.max(0,p.height-S)),a&&(Tr(a,function(){Tv(a,p,-S),so(a,h,"widget")}),zn(a,"lineWidgetCleared",a,this,h))}},Hs.prototype.changed=function(){var a=this,u=this.height,p=this.doc.cm,h=this.line;this.height=null;var m=Cs(this)-u;m&&(ao(this.doc,h)||K(h,h.height+m),p&&Tr(p,function(){p.curOp.forceUpdate=!0,Tv(p,h,m),zn(p,"lineWidgetChanged",p,a,M(h))}))},qe(Hs);function Tv(a,u,p){Gi(u)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Bc(a,p)}function tE(a,u,p,h){var m=new Hs(a,p,h),S=a.cm;return S&&m.noHScroll&&(S.display.alignWidgets=!0),Is(a,u,"widget",function(O){var A=O.widgets||(O.widgets=[]);if(m.insertAt==null?A.push(m):A.splice(Math.min(A.length,Math.max(0,m.insertAt)),0,m),m.line=O,S&&!ao(a,O)){var L=Gi(O)<a.scrollTop;K(O,O.height+Cs(m)),L&&Bc(S,m.height),S.curOp.forceUpdate=!0}return!0}),S&&zn(S,"lineWidgetAdded",S,m,typeof u=="number"?u:M(u)),m}var Dv=0,ho=function(a,u){this.lines=[],this.type=u,this.doc=a,this.id=++Dv};ho.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,u=a&&!a.curOp;if(u&&jo(a),xe(this,"clear")){var p=this.find();p&&zn(this,"clear",p.from,p.to)}for(var h=null,m=null,S=0;S<this.lines.length;++S){var O=this.lines[S],A=ws(O.markedSpans,this);a&&!this.collapsed?so(a,M(O),"text"):a&&(A.to!=null&&(m=M(O)),A.from!=null&&(h=M(O))),O.markedSpans=Xw(O.markedSpans,A),A.from==null&&this.collapsed&&!ao(this.doc,O)&&a&&K(O,fa(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var L=0;L<this.lines.length;++L){var j=si(this.lines[L]),ee=Zl(j);ee>a.display.maxLineLength&&(a.display.maxLine=j,a.display.maxLineLength=ee,a.display.maxLineChanged=!0)}h!=null&&a&&this.collapsed&&vr(a,h,m+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&xv(a.doc)),a&&zn(a,"markerCleared",a,this,h,m),u&&Ho(a),this.parent&&this.parent.clear()}},ho.prototype.find=function(a,u){a==null&&this.type=="bookmark"&&(a=1);for(var p,h,m=0;m<this.lines.length;++m){var S=this.lines[m],O=ws(S.markedSpans,this);if(O.from!=null&&(p=pe(u?S:M(S),O.from),a==-1))return p;if(O.to!=null&&(h=pe(u?S:M(S),O.to),a==1))return h}return p&&{from:p,to:h}},ho.prototype.changed=function(){var a=this,u=this.find(-1,!0),p=this,h=this.doc.cm;!u||!h||Tr(h,function(){var m=u.line,S=M(u.line),O=Ec(h,S);if(O&&(jp(O),h.curOp.selectionChanged=h.curOp.forceUpdate=!0),h.curOp.updateMaxLine=!0,!ao(p.doc,m)&&p.height!=null){var A=p.height;p.height=null;var L=Cs(p)-A;L&&K(m,m.height+L)}zn(h,"markerChanged",h,a)})},ho.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var u=this.doc.cm.curOp;(!u.maybeHiddenMarkers||$e(u.maybeHiddenMarkers,this)==-1)&&(u.maybeUnhiddenMarkers||(u.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},ho.prototype.detachLine=function(a){if(this.lines.splice($e(this.lines,a),1),!this.lines.length&&this.doc.cm){var u=this.doc.cm.curOp;(u.maybeHiddenMarkers||(u.maybeHiddenMarkers=[])).push(this)}},qe(ho);function xa(a,u,p,h,m){if(h&&h.shared)return nE(a,u,p,h,m);if(a.cm&&!a.cm.curOp)return Wn(a.cm,xa)(a,u,p,h,m);var S=new ho(a,m),O=be(u,p);if(h&&_e(h,S,!1),O>0||O==0&&S.clearWhenEmpty!==!1)return S;if(S.replacedWith&&(S.collapsed=!0,S.widgetNode=le("span",[S.replacedWith],"CodeMirror-widget"),h.handleMouseEvents||S.widgetNode.setAttribute("cm-ignore-events","true"),h.insertLeft&&(S.widgetNode.insertLeft=!0)),S.collapsed){if(wp(a,u.line,u,p,S)||u.line!=p.line&&wp(a,p.line,u,p,S))throw new Error("Inserting collapsed marker partially overlapping an existing one");Vw()}S.addToHistory&&pv(a,{from:u,to:p,origin:"markText"},a.sel,NaN);var A=u.line,L=a.cm,j;if(a.iter(A,p.line+1,function(oe){L&&S.collapsed&&!L.options.lineWrapping&&si(oe)==L.display.maxLine&&(j=!0),S.collapsed&&A!=u.line&&K(oe,0),Gw(oe,new Yl(S,A==u.line?u.ch:null,A==p.line?p.ch:null),a.cm&&a.cm.curOp),++A}),S.collapsed&&a.iter(u.line,p.line+1,function(oe){ao(a,oe)&&K(oe,0)}),S.clearOnEnter&&lt(S,"beforeCursorEnter",function(){return S.clear()}),S.readOnly&&(Uw(),(a.history.done.length||a.history.undone.length)&&a.clearHistory()),S.collapsed&&(S.id=++Dv,S.atomic=!0),L){if(j&&(L.curOp.updateMaxLine=!0),S.collapsed)vr(L,u.line,p.line+1);else if(S.className||S.startStyle||S.endStyle||S.css||S.attributes||S.title)for(var ee=u.line;ee<=p.line;ee++)so(L,ee,"text");S.atomic&&xv(L.doc),zn(L,"markerAdded",L,S)}return S}var $s=function(a,u){this.markers=a,this.primary=u;for(var p=0;p<a.length;++p)a[p].parent=this};$s.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();zn(this,"clear")}},$s.prototype.find=function(a,u){return this.primary.find(a,u)},qe($s);function nE(a,u,p,h,m){h=_e(h),h.shared=!1;var S=[xa(a,u,p,h,m)],O=S[0],A=h.widgetNode;return fo(a,function(L){A&&(h.widgetNode=A.cloneNode(!0)),S.push(xa(L,Mt(L,u),Mt(L,p),h,m));for(var j=0;j<L.linked.length;++j)if(L.linked[j].isParent)return;O=N(S)}),new $s(S,O)}function Lv(a){return a.findMarks(pe(a.first,0),a.clipPos(pe(a.lastLine())),function(u){return u.parent})}function rE(a,u){for(var p=0;p<u.length;p++){var h=u[p],m=h.find(),S=a.clipPos(m.from),O=a.clipPos(m.to);if(be(S,O)){var A=xa(a,S,O,h.primary,h.primary.type);h.markers.push(A),A.parent=h}}}function iE(a){for(var u=function(h){var m=a[h],S=[m.primary.doc];fo(m.primary.doc,function(L){return S.push(L)});for(var O=0;O<m.markers.length;O++){var A=m.markers[O];$e(S,A.doc)==-1&&(A.parent=null,m.markers.splice(O--,1))}},p=0;p<a.length;p++)u(p)}var oE=0,gr=function(a,u,p,h,m){if(!(this instanceof gr))return new gr(a,u,p,h,m);p==null&&(p=0),js.call(this,[new Bs([new ua("",null)])]),this.first=p,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=p;var S=pe(p,0);this.sel=uo(S),this.history=new du(null),this.id=++oE,this.modeOption=u,this.lineSep=h,this.direction=m=="rtl"?"rtl":"ltr",this.extend=!1,typeof a=="string"&&(a=this.splitLines(a)),Vc(this,{from:S,to:S,text:a}),Zn(this,uo(S),ot)};gr.prototype=re(js.prototype,{constructor:gr,iter:function(a,u,p){p?this.iterN(a-this.first,u-a,p):this.iterN(this.first,this.first+this.size,a)},insert:function(a,u){for(var p=0,h=0;h<u.length;++h)p+=u[h].height;this.insertInner(a-this.first,u,p)},remove:function(a,u){this.removeInner(a-this.first,u)},getValue:function(a){var u=pn(this,this.first,this.first+this.size);return a===!1?u:u.join(a||this.lineSeparator())},setValue:Un(function(a){var u=pe(this.first,0),p=this.first+this.size-1;_a(this,{from:u,to:pe(p,We(this,p).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0),this.cm&&Ns(this.cm,0,0),Zn(this,uo(u),ot)}),replaceRange:function(a,u,p,h){u=Mt(this,u),p=p?Mt(this,p):u,ba(this,a,u,p,h)},getRange:function(a,u,p){var h=It(this,Mt(this,a),Mt(this,u));return p===!1?h:p===""?h.join(""):h.join(p||this.lineSeparator())},getLine:function(a){var u=this.getLineHandle(a);return u&&u.text},getLineHandle:function(a){if(de(this,a))return We(this,a)},getLineNumber:function(a){return M(a)},getLineHandleVisualStart:function(a){return typeof a=="number"&&(a=We(this,a)),si(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return Mt(this,a)},getCursor:function(a){var u=this.sel.primary(),p;return a==null||a=="head"?p=u.head:a=="anchor"?p=u.anchor:a=="end"||a=="to"||a===!1?p=u.to():p=u.from(),p},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Un(function(a,u,p){yv(this,Mt(this,typeof a=="number"?pe(a,u||0):a),null,p)}),setSelection:Un(function(a,u,p){yv(this,Mt(this,a),Mt(this,u||a),p)}),extendSelection:Un(function(a,u,p){fu(this,Mt(this,a),u&&Mt(this,u),p)}),extendSelections:Un(function(a,u){mv(this,la(this,a),u)}),extendSelectionsBy:Un(function(a,u){var p=H(this.sel.ranges,a);mv(this,la(this,p),u)}),setSelections:Un(function(a,u,p){if(a.length){for(var h=[],m=0;m<a.length;m++)h[m]=new tn(Mt(this,a[m].anchor),Mt(this,a[m].head||a[m].anchor));u==null&&(u=Math.min(a.length-1,this.sel.primIndex)),Zn(this,ui(this.cm,h,u),p)}}),addSelection:Un(function(a,u,p){var h=this.sel.ranges.slice(0);h.push(new tn(Mt(this,a),Mt(this,u||a))),Zn(this,ui(this.cm,h,h.length-1),p)}),getSelection:function(a){for(var u=this.sel.ranges,p,h=0;h<u.length;h++){var m=It(this,u[h].from(),u[h].to());p=p?p.concat(m):m}return a===!1?p:p.join(a||this.lineSeparator())},getSelections:function(a){for(var u=[],p=this.sel.ranges,h=0;h<p.length;h++){var m=It(this,p[h].from(),p[h].to());a!==!1&&(m=m.join(a||this.lineSeparator())),u[h]=m}return u},replaceSelection:function(a,u,p){for(var h=[],m=0;m<this.sel.ranges.length;m++)h[m]=a;this.replaceSelections(h,u,p||"+input")},replaceSelections:Un(function(a,u,p){for(var h=[],m=this.sel,S=0;S<m.ranges.length;S++){var O=m.ranges[S];h[S]={from:O.from(),to:O.to(),text:this.splitLines(a[S]),origin:p}}for(var A=u&&u!="end"&&XS(this,h,u),L=h.length-1;L>=0;L--)_a(this,h[L]);A?_v(this,A):this.cm&&va(this.cm)}),undo:Un(function(){vu(this,"undo")}),redo:Un(function(){vu(this,"redo")}),undoSelection:Un(function(){vu(this,"undo",!0)}),redoSelection:Un(function(){vu(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,u=0,p=0,h=0;h<a.done.length;h++)a.done[h].ranges||++u;for(var m=0;m<a.undone.length;m++)a.undone[m].ranges||++p;return{undo:u,redo:p}},clearHistory:function(){var a=this;this.history=new du(this.history),fo(this,function(u){return u.history=a.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:ma(this.history.done),undone:ma(this.history.undone)}},setHistory:function(a){var u=this.history=new du(this.history);u.done=ma(a.done.slice(0),null,!0),u.undone=ma(a.undone.slice(0),null,!0)},setGutterMarker:Un(function(a,u,p){return Is(this,a,"gutter",function(h){var m=h.gutterMarkers||(h.gutterMarkers={});return m[u]=p,!p&&Se(m)&&(h.gutterMarkers=null),!0})}),clearGutter:Un(function(a){var u=this;this.iter(function(p){p.gutterMarkers&&p.gutterMarkers[a]&&Is(u,p,"gutter",function(){return p.gutterMarkers[a]=null,Se(p.gutterMarkers)&&(p.gutterMarkers=null),!0})})}),lineInfo:function(a){var u;if(typeof a=="number"){if(!de(this,a)||(u=a,a=We(this,a),!a))return null}else if(u=M(a),u==null)return null;return{line:u,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:Un(function(a,u,p){return Is(this,a,u=="gutter"?"gutter":"class",function(h){var m=u=="text"?"textClass":u=="background"?"bgClass":u=="gutter"?"gutterClass":"wrapClass";if(!h[m])h[m]=p;else{if(G(p).test(h[m]))return!1;h[m]+=" "+p}return!0})}),removeLineClass:Un(function(a,u,p){return Is(this,a,u=="gutter"?"gutter":"class",function(h){var m=u=="text"?"textClass":u=="background"?"bgClass":u=="gutter"?"gutterClass":"wrapClass",S=h[m];if(S)if(p==null)h[m]=null;else{var O=S.match(G(p));if(!O)return!1;var A=O.index+O[0].length;h[m]=S.slice(0,O.index)+(!O.index||A==S.length?"":" ")+S.slice(A)||null}else return!1;return!0})}),addLineWidget:Un(function(a,u,p){return tE(this,a,u,p)}),removeLineWidget:function(a){a.clear()},markText:function(a,u,p){return xa(this,Mt(this,a),Mt(this,u),p,p&&p.type||"range")},setBookmark:function(a,u){var p={replacedWith:u&&(u.nodeType==null?u.widget:u),insertLeft:u&&u.insertLeft,clearWhenEmpty:!1,shared:u&&u.shared,handleMouseEvents:u&&u.handleMouseEvents};return a=Mt(this,a),xa(this,a,a,p,"bookmark")},findMarksAt:function(a){a=Mt(this,a);var u=[],p=We(this,a.line).markedSpans;if(p)for(var h=0;h<p.length;++h){var m=p[h];(m.from==null||m.from<=a.ch)&&(m.to==null||m.to>=a.ch)&&u.push(m.marker.parent||m.marker)}return u},findMarks:function(a,u,p){a=Mt(this,a),u=Mt(this,u);var h=[],m=a.line;return this.iter(a.line,u.line+1,function(S){var O=S.markedSpans;if(O)for(var A=0;A<O.length;A++){var L=O[A];!(L.to!=null&&m==a.line&&a.ch>=L.to||L.from==null&&m!=a.line||L.from!=null&&m==u.line&&L.from>=u.ch)&&(!p||p(L.marker))&&h.push(L.marker.parent||L.marker)}++m}),h},getAllMarks:function(){var a=[];return this.iter(function(u){var p=u.markedSpans;if(p)for(var h=0;h<p.length;++h)p[h].from!=null&&a.push(p[h].marker)}),a},posFromIndex:function(a){var u,p=this.first,h=this.lineSeparator().length;return this.iter(function(m){var S=m.text.length+h;if(S>a)return u=a,!0;a-=S,++p}),Mt(this,pe(p,u))},indexFromPos:function(a){a=Mt(this,a);var u=a.ch;if(a.line<this.first||a.ch<0)return 0;var p=this.lineSeparator().length;return this.iter(this.first,a.line,function(h){u+=h.text.length+p}),u},copy:function(a){var u=new gr(pn(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return u.scrollTop=this.scrollTop,u.scrollLeft=this.scrollLeft,u.sel=this.sel,u.extend=!1,a&&(u.history.undoDepth=this.history.undoDepth,u.setHistory(this.getHistory())),u},linkedDoc:function(a){a||(a={});var u=this.first,p=this.first+this.size;a.from!=null&&a.from>u&&(u=a.from),a.to!=null&&a.to<p&&(p=a.to);var h=new gr(pn(this,u,p),a.mode||this.modeOption,u,this.lineSep,this.direction);return a.sharedHist&&(h.history=this.history),(this.linked||(this.linked=[])).push({doc:h,sharedHist:a.sharedHist}),h.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],rE(h,Lv(this)),h},unlinkDoc:function(a){if(a instanceof yn&&(a=a.doc),this.linked)for(var u=0;u<this.linked.length;++u){var p=this.linked[u];if(p.doc==a){this.linked.splice(u,1),a.unlinkDoc(this),iE(Lv(this));break}}if(a.history==this.history){var h=[a.id];fo(a,function(m){return h.push(m.id)},!0),a.history=new du(null),a.history.done=ma(this.history.done,h),a.history.undone=ma(this.history.undone,h)}},iterLinkedDocs:function(a){fo(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):En(a)},lineSeparator:function(){return this.lineSep||`
`},setDirection:Un(function(a){a!="rtl"&&(a="ltr"),a!=this.direction&&(this.direction=a,this.iter(function(u){return u.order=null}),this.cm&&GS(this.cm))})}),gr.prototype.eachLine=gr.prototype.iter;var Pv=0;function aE(a){var u=this;if(Rv(u),!(Rt(u,a)||Yi(u.display,a))){ht(a),d&&(Pv=+new Date);var p=Po(u,a,!0),h=a.dataTransfer.files;if(!(!p||u.isReadOnly()))if(h&&h.length&&window.FileReader&&window.File)for(var m=h.length,S=Array(m),O=0,A=function(){++O==m&&Wn(u,function(){p=Mt(u.doc,p);var fe={from:p,to:p,text:u.doc.splitLines(S.filter(function(Te){return Te!=null}).join(u.doc.lineSeparator())),origin:"paste"};_a(u.doc,fe),_v(u.doc,uo(Mt(u.doc,p),Mt(u.doc,co(fe))))})()},L=function(fe,Te){if(u.options.allowDropFileTypes&&$e(u.options.allowDropFileTypes,fe.type)==-1){A();return}var Be=new FileReader;Be.onerror=function(){return A()},Be.onload=function(){var Ye=Be.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(Ye)){A();return}S[Te]=Ye,A()},Be.readAsText(fe)},j=0;j<h.length;j++)L(h[j],j);else{if(u.state.draggingText&&u.doc.sel.contains(p)>-1){u.state.draggingText(a),setTimeout(function(){return u.display.input.focus()},20);return}try{var ee=a.dataTransfer.getData("Text");if(ee){var oe;if(u.state.draggingText&&!u.state.draggingText.copy&&(oe=u.listSelections()),hu(u.doc,uo(p,p)),oe)for(var ve=0;ve<oe.length;++ve)ba(u.doc,"",oe[ve].anchor,oe[ve].head,"drag");u.replaceSelection(ee,"around","paste"),u.display.input.focus()}}catch{}}}}function sE(a,u){if(d&&(!a.state.draggingText||+new Date-Pv<100)){zt(u);return}if(!(Rt(a,u)||Yi(a.display,u))&&(u.dataTransfer.setData("Text",a.getSelection()),u.dataTransfer.effectAllowed="copyMove",u.dataTransfer.setDragImage&&!_)){var p=P("img",null,null,"position: fixed; left: 0; top: 0;");p.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",b&&(p.width=p.height=1,a.display.wrapper.appendChild(p),p._top=p.offsetTop),u.dataTransfer.setDragImage(p,0,0),b&&p.parentNode.removeChild(p)}}function lE(a,u){var p=Po(a,u);if(p){var h=document.createDocumentFragment();Dc(a,p,h),a.display.dragCursor||(a.display.dragCursor=P("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv)),W(a.display.dragCursor,h)}}function Rv(a){a.display.dragCursor&&(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function Iv(a){if(document.getElementsByClassName){for(var u=document.getElementsByClassName("CodeMirror"),p=[],h=0;h<u.length;h++){var m=u[h].CodeMirror;m&&p.push(m)}p.length&&p[0].operation(function(){for(var S=0;S<p.length;S++)a(p[S])})}}var Bv=!1;function uE(){Bv||(dE(),Bv=!0)}function dE(){var a;lt(window,"resize",function(){a==null&&(a=setTimeout(function(){a=null,Iv(cE)},100))}),lt(window,"blur",function(){return Iv(pa)})}function cE(a){var u=a.display;u.cachedCharWidth=u.cachedTextHeight=u.cachedPaddingH=null,u.scrollbarsClipped=!1,a.setSize()}for(var po={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Fs=0;Fs<10;Fs++)po[Fs+48]=po[Fs+96]=String(Fs);for(var gu=65;gu<=90;gu++)po[gu]=String.fromCharCode(gu);for(var zs=1;zs<=12;zs++)po[zs+111]=po[zs+63235]="F"+zs;var Ki={};Ki.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ki.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ki.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ki.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ki.default=I?Ki.macDefault:Ki.pcDefault;function fE(a){var u=a.split(/-(?!$)/);a=u[u.length-1];for(var p,h,m,S,O=0;O<u.length-1;O++){var A=u[O];if(/^(cmd|meta|m)$/i.test(A))S=!0;else if(/^a(lt)?$/i.test(A))p=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else throw new Error("Unrecognized modifier name: "+A)}return p&&(a="Alt-"+a),h&&(a="Ctrl-"+a),S&&(a="Cmd-"+a),m&&(a="Shift-"+a),a}function hE(a){var u={};for(var p in a)if(a.hasOwnProperty(p)){var h=a[p];if(/^(name|fallthrough|(de|at)tach)$/.test(p))continue;if(h=="..."){delete a[p];continue}for(var m=H(p.split(" "),fE),S=0;S<m.length;S++){var O=void 0,A=void 0;S==m.length-1?(A=m.join(" "),O=h):(A=m.slice(0,S+1).join(" "),O="...");var L=u[A];if(!L)u[A]=O;else if(L!=O)throw new Error("Inconsistent bindings for "+A)}delete a[p]}for(var j in u)a[j]=u[j];return a}function wa(a,u,p,h){u=mu(u);var m=u.call?u.call(a,h):u[a];if(m===!1)return"nothing";if(m==="...")return"multi";if(m!=null&&p(m))return"handled";if(u.fallthrough){if(Object.prototype.toString.call(u.fallthrough)!="[object Array]")return wa(a,u.fallthrough,p,h);for(var S=0;S<u.fallthrough.length;S++){var O=wa(a,u.fallthrough[S],p,h);if(O)return O}}}function jv(a){var u=typeof a=="string"?a:po[a.keyCode];return u=="Ctrl"||u=="Alt"||u=="Shift"||u=="Mod"}function Hv(a,u,p){var h=a;return u.altKey&&h!="Alt"&&(a="Alt-"+a),(z?u.metaKey:u.ctrlKey)&&h!="Ctrl"&&(a="Ctrl-"+a),(z?u.ctrlKey:u.metaKey)&&h!="Mod"&&(a="Cmd-"+a),!p&&u.shiftKey&&h!="Shift"&&(a="Shift-"+a),a}function $v(a,u){if(b&&a.keyCode==34&&a.char)return!1;var p=po[a.keyCode];return p==null||a.altGraphKey?!1:(a.keyCode==3&&a.code&&(p=a.code),Hv(p,a,u))}function mu(a){return typeof a=="string"?Ki[a]:a}function Sa(a,u){for(var p=a.doc.sel.ranges,h=[],m=0;m<p.length;m++){for(var S=u(p[m]);h.length&&be(S.from,N(h).to)<=0;){var O=h.pop();if(be(O.from,S.from)<0){S.from=O.from;break}}h.push(S)}Tr(a,function(){for(var A=h.length-1;A>=0;A--)ba(a.doc,"",h[A].from,h[A].to,"+delete");va(a)})}function qc(a,u,p){var h=at(a.text,u+p,p);return h<0||h>a.text.length?null:h}function Kc(a,u,p){var h=qc(a,u.ch,p);return h==null?null:new pe(u.line,h,p<0?"after":"before")}function Jc(a,u,p,h,m){if(a){u.doc.direction=="rtl"&&(m=-m);var S=et(p,u.doc.direction);if(S){var O=m<0?N(S):S[0],A=m<0==(O.level==1),L=A?"after":"before",j;if(O.level>0||u.doc.direction=="rtl"){var ee=ca(u,p);j=m<0?p.text.length-1:0;var oe=Ai(u,ee,j).top;j=ut(function(ve){return Ai(u,ee,ve).top==oe},m<0==(O.level==1)?O.from:O.to-1,j),L=="before"&&(j=qc(p,j,1))}else j=m<0?O.to:O.from;return new pe(h,j,L)}}return new pe(h,m<0?p.text.length:0,m<0?"before":"after")}function pE(a,u,p,h){var m=et(u,a.doc.direction);if(!m)return Kc(u,p,h);p.ch>=u.text.length?(p.ch=u.text.length,p.sticky="before"):p.ch<=0&&(p.ch=0,p.sticky="after");var S=rt(m,p.ch,p.sticky),O=m[S];if(a.doc.direction=="ltr"&&O.level%2==0&&(h>0?O.to>p.ch:O.from<p.ch))return Kc(u,p,h);var A=function(tt,st){return qc(u,tt instanceof pe?tt.ch:tt,st)},L,j=function(tt){return a.options.lineWrapping?(L=L||ca(a,u),Vp(a,u,L,tt)):{begin:0,end:u.text.length}},ee=j(p.sticky=="before"?A(p,-1):p.ch);if(a.doc.direction=="rtl"||O.level==1){var oe=O.level==1==h<0,ve=A(p,oe?1:-1);if(ve!=null&&(oe?ve<=O.to&&ve<=ee.end:ve>=O.from&&ve>=ee.begin)){var fe=oe?"before":"after";return new pe(p.line,ve,fe)}}var Te=function(tt,st,nt){for(var dt=function(hn,Vn){return Vn?new pe(p.line,A(hn,1),"before"):new pe(p.line,hn,"after")};tt>=0&&tt<m.length;tt+=st){var St=m[tt],xt=st>0==(St.level!=1),jt=xt?nt.begin:A(nt.end,-1);if(St.from<=jt&&jt<St.to||(jt=xt?St.from:A(St.to,-1),nt.begin<=jt&&jt<nt.end))return dt(jt,xt)}},Be=Te(S+h,h,ee);if(Be)return Be;var Ye=h>0?ee.end:A(ee.begin,-1);return Ye!=null&&!(h>0&&Ye==u.text.length)&&(Be=Te(h>0?0:m.length-1,h,j(Ye)),Be)?Be:null}var Ws={selectAll:Ev,singleSelection:function(a){return a.setSelection(a.getCursor("anchor"),a.getCursor("head"),ot)},killLine:function(a){return Sa(a,function(u){if(u.empty()){var p=We(a.doc,u.head.line).text.length;return u.head.ch==p&&u.head.line<a.lastLine()?{from:u.head,to:pe(u.head.line+1,0)}:{from:u.head,to:pe(u.head.line,p)}}else return{from:u.from(),to:u.to()}})},deleteLine:function(a){return Sa(a,function(u){return{from:pe(u.from().line,0),to:Mt(a.doc,pe(u.to().line+1,0))}})},delLineLeft:function(a){return Sa(a,function(u){return{from:pe(u.from().line,0),to:u.from()}})},delWrappedLineLeft:function(a){return Sa(a,function(u){var p=a.charCoords(u.head,"div").top+5,h=a.coordsChar({left:0,top:p},"div");return{from:h,to:u.from()}})},delWrappedLineRight:function(a){return Sa(a,function(u){var p=a.charCoords(u.head,"div").top+5,h=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:p},"div");return{from:u.from(),to:h}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(pe(a.firstLine(),0))},goDocEnd:function(a){return a.extendSelection(pe(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(u){return Fv(a,u.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(u){return zv(a,u.head)},{origin:"+move",bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(u){return vE(a,u.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:p},"div")},bt)},goLineLeft:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5;return a.coordsChar({left:0,top:p},"div")},bt)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5,h=a.coordsChar({left:0,top:p},"div");return h.ch<a.getLine(h.line).search(/\S/)?zv(a,u.head):h},bt)},goLineUp:function(a){return a.moveV(-1,"line")},goLineDown:function(a){return a.moveV(1,"line")},goPageUp:function(a){return a.moveV(-1,"page")},goPageDown:function(a){return a.moveV(1,"page")},goCharLeft:function(a){return a.moveH(-1,"char")},goCharRight:function(a){return a.moveH(1,"char")},goColumnLeft:function(a){return a.moveH(-1,"column")},goColumnRight:function(a){return a.moveH(1,"column")},goWordLeft:function(a){return a.moveH(-1,"word")},goGroupRight:function(a){return a.moveH(1,"group")},goGroupLeft:function(a){return a.moveH(-1,"group")},goWordRight:function(a){return a.moveH(1,"word")},delCharBefore:function(a){return a.deleteH(-1,"codepoint")},delCharAfter:function(a){return a.deleteH(1,"char")},delWordBefore:function(a){return a.deleteH(-1,"word")},delWordAfter:function(a){return a.deleteH(1,"word")},delGroupBefore:function(a){return a.deleteH(-1,"group")},delGroupAfter:function(a){return a.deleteH(1,"group")},indentAuto:function(a){return a.indentSelection("smart")},indentMore:function(a){return a.indentSelection("add")},indentLess:function(a){return a.indentSelection("subtract")},insertTab:function(a){return a.replaceSelection("	")},insertSoftTab:function(a){for(var u=[],p=a.listSelections(),h=a.options.tabSize,m=0;m<p.length;m++){var S=p[m].from(),O=Ie(a.getLine(S.line),S.ch,h);u.push(Z(h-O%h))}a.replaceSelections(u)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){return Tr(a,function(){for(var u=a.listSelections(),p=[],h=0;h<u.length;h++)if(u[h].empty()){var m=u[h].head,S=We(a.doc,m.line).text;if(S){if(m.ch==S.length&&(m=new pe(m.line,m.ch-1)),m.ch>0)m=new pe(m.line,m.ch+1),a.replaceRange(S.charAt(m.ch-1)+S.charAt(m.ch-2),pe(m.line,m.ch-2),m,"+transpose");else if(m.line>a.doc.first){var O=We(a.doc,m.line-1).text;O&&(m=new pe(m.line,1),a.replaceRange(S.charAt(0)+a.doc.lineSeparator()+O.charAt(O.length-1),pe(m.line-1,O.length-1),m,"+transpose"))}}p.push(new tn(m,m))}a.setSelections(p)})},newlineAndIndent:function(a){return Tr(a,function(){for(var u=a.listSelections(),p=u.length-1;p>=0;p--)a.replaceRange(a.doc.lineSeparator(),u[p].anchor,u[p].head,"+input");u=a.listSelections();for(var h=0;h<u.length;h++)a.indentLine(u[h].from().line,null,!0);va(a)})},openLine:function(a){return a.replaceSelection(`
`,"start")},toggleOverwrite:function(a){return a.toggleOverwrite()}};function Fv(a,u){var p=We(a.doc,u),h=si(p);return h!=p&&(u=M(h)),Jc(!0,a,h,u,1)}function vE(a,u){var p=We(a.doc,u),h=Zw(p);return h!=p&&(u=M(h)),Jc(!0,a,p,u,-1)}function zv(a,u){var p=Fv(a,u.line),h=We(a.doc,p.line),m=et(h,a.doc.direction);if(!m||m[0].level==0){var S=Math.max(p.ch,h.text.search(/\S/)),O=u.line==p.line&&u.ch<=S&&u.ch;return pe(p.line,O?0:S,p.sticky)}return p}function yu(a,u,p){if(typeof u=="string"&&(u=Ws[u],!u))return!1;a.display.input.ensurePolled();var h=a.display.shift,m=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),p&&(a.display.shift=!1),m=u(a)!=Nt}finally{a.display.shift=h,a.state.suppressEdits=!1}return m}function gE(a,u,p){for(var h=0;h<a.state.keyMaps.length;h++){var m=wa(u,a.state.keyMaps[h],p,a);if(m)return m}return a.options.extraKeys&&wa(u,a.options.extraKeys,p,a)||wa(u,a.options.keyMap,p,a)}var mE=new Ke;function Us(a,u,p,h){var m=a.state.keySeq;if(m){if(jv(u))return"handled";if(/\'$/.test(u)?a.state.keySeq=null:mE.set(50,function(){a.state.keySeq==m&&(a.state.keySeq=null,a.display.input.reset())}),Wv(a,m+" "+u,p,h))return!0}return Wv(a,u,p,h)}function Wv(a,u,p,h){var m=gE(a,u,h);return m=="multi"&&(a.state.keySeq=u),m=="handled"&&zn(a,"keyHandled",a,u,p),(m=="handled"||m=="multi")&&(ht(p),Lc(a)),!!m}function Uv(a,u){var p=$v(u,!0);return p?u.shiftKey&&!a.state.keySeq?Us(a,"Shift-"+p,u,function(h){return yu(a,h,!0)})||Us(a,p,u,function(h){if(typeof h=="string"?/^go[A-Z]/.test(h):h.motion)return yu(a,h)}):Us(a,p,u,function(h){return yu(a,h)}):!1}function yE(a,u,p){return Us(a,"'"+p+"'",u,function(h){return yu(a,h,!0)})}var Zc=null;function Vv(a){var u=this;if(!(a.target&&a.target!=u.display.input.getField())&&(u.curOp.focus=Ne(Ve(u)),!Rt(u,a))){d&&c<11&&a.keyCode==27&&(a.returnValue=!1);var p=a.keyCode;u.display.shift=p==16||a.shiftKey;var h=Uv(u,a);b&&(Zc=h?p:null,!h&&p==88&&!ai&&(I?a.metaKey:a.ctrlKey)&&u.replaceSelection("",null,"cut")),i&&!I&&!h&&p==46&&a.shiftKey&&!a.ctrlKey&&document.execCommand&&document.execCommand("cut"),p==18&&!/\bCodeMirror-crosshair\b/.test(u.display.lineDiv.className)&&_E(u)}}function _E(a){var u=a.display.lineDiv;ye(u,"CodeMirror-crosshair");function p(h){(h.keyCode==18||!h.altKey)&&(Q(u,"CodeMirror-crosshair"),Ut(document,"keyup",p),Ut(document,"mouseover",p))}lt(document,"keyup",p),lt(document,"mouseover",p)}function Xv(a){a.keyCode==16&&(this.doc.sel.shift=!1),Rt(this,a)}function Gv(a){var u=this;if(!(a.target&&a.target!=u.display.input.getField())&&!(Yi(u.display,a)||Rt(u,a)||a.ctrlKey&&!a.altKey||I&&a.metaKey)){var p=a.keyCode,h=a.charCode;if(b&&p==Zc){Zc=null,ht(a);return}if(!(b&&(!a.which||a.which<10)&&Uv(u,a))){var m=String.fromCharCode(h??p);m!="\b"&&(yE(u,a,m)||u.display.input.onKeyPress(a))}}}var bE=400,Qc=function(a,u,p){this.time=a,this.pos=u,this.button=p};Qc.prototype.compare=function(a,u,p){return this.time+bE>a&&be(u,this.pos)==0&&p==this.button};var Vs,Xs;function xE(a,u){var p=+new Date;return Xs&&Xs.compare(p,a,u)?(Vs=Xs=null,"triple"):Vs&&Vs.compare(p,a,u)?(Xs=new Qc(p,a,u),Vs=null,"double"):(Vs=new Qc(p,a,u),Xs=null,"single")}function Yv(a){var u=this,p=u.display;if(!(Rt(u,a)||p.activeTouch&&p.input.supportsTouch())){if(p.input.ensurePolled(),p.shift=a.shiftKey,Yi(p,a)){f||(p.scroller.draggable=!1,setTimeout(function(){return p.scroller.draggable=!0},100));return}if(!ef(u,a)){var h=Po(u,a),m=gn(a),S=h?xE(h,m):"single";te(u).focus(),m==1&&u.state.selectingText&&u.state.selectingText(a),!(h&&wE(u,m,h,S,a))&&(m==1?h?EE(u,h,S,a):Jn(a)==p.scroller&&ht(a):m==2?(h&&fu(u.doc,h),setTimeout(function(){return p.input.focus()},20)):m==3&&(ie?u.display.input.onContextMenu(a):Pc(u)))}}}function wE(a,u,p,h,m){var S="Click";return h=="double"?S="Double"+S:h=="triple"&&(S="Triple"+S),S=(u==1?"Left":u==2?"Middle":"Right")+S,Us(a,Hv(S,m),m,function(O){if(typeof O=="string"&&(O=Ws[O]),!O)return!1;var A=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),A=O(a,p)!=Nt}finally{a.state.suppressEdits=!1}return A})}function SE(a,u,p){var h=a.getOption("configureMouse"),m=h?h(a,u,p):{};if(m.unit==null){var S=$?p.shiftKey&&p.metaKey:p.altKey;m.unit=S?"rectangle":u=="single"?"char":u=="double"?"word":"line"}return(m.extend==null||a.doc.extend)&&(m.extend=a.doc.extend||p.shiftKey),m.addNew==null&&(m.addNew=I?p.metaKey:p.ctrlKey),m.moveOnDrag==null&&(m.moveOnDrag=!(I?p.altKey:p.ctrlKey)),m}function EE(a,u,p,h){d?setTimeout(ce(qp,a),0):a.curOp.focus=Ne(Ve(a));var m=SE(a,p,h),S=a.doc.sel,O;a.options.dragDrop&&$n&&!a.isReadOnly()&&p=="single"&&(O=S.contains(u))>-1&&(be((O=S.ranges[O]).from(),u)<0||u.xRel>0)&&(be(O.to(),u)>0||u.xRel<0)?CE(a,h,u,m):OE(a,h,u,m)}function CE(a,u,p,h){var m=a.display,S=!1,O=Wn(a,function(j){f&&(m.scroller.draggable=!1),a.state.draggingText=!1,a.state.delayingBlurEvent&&(a.hasFocus()?a.state.delayingBlurEvent=!1:Pc(a)),Ut(m.wrapper.ownerDocument,"mouseup",O),Ut(m.wrapper.ownerDocument,"mousemove",A),Ut(m.scroller,"dragstart",L),Ut(m.scroller,"drop",O),S||(ht(j),h.addNew||fu(a.doc,p,null,null,h.extend),f&&!_||d&&c==9?setTimeout(function(){m.wrapper.ownerDocument.body.focus({preventScroll:!0}),m.input.focus()},20):m.input.focus())}),A=function(j){S=S||Math.abs(u.clientX-j.clientX)+Math.abs(u.clientY-j.clientY)>=10},L=function(){return S=!0};f&&(m.scroller.draggable=!0),a.state.draggingText=O,O.copy=!h.moveOnDrag,lt(m.wrapper.ownerDocument,"mouseup",O),lt(m.wrapper.ownerDocument,"mousemove",A),lt(m.scroller,"dragstart",L),lt(m.scroller,"drop",O),a.state.delayingBlurEvent=!0,setTimeout(function(){return m.input.focus()},20),m.scroller.dragDrop&&m.scroller.dragDrop()}function qv(a,u,p){if(p=="char")return new tn(u,u);if(p=="word")return a.findWordAt(u);if(p=="line")return new tn(pe(u.line,0),Mt(a.doc,pe(u.line+1,0)));var h=p(a,u);return new tn(h.from,h.to)}function OE(a,u,p,h){d&&Pc(a);var m=a.display,S=a.doc;ht(u);var O,A,L=S.sel,j=L.ranges;if(h.addNew&&!h.extend?(A=S.sel.contains(p),A>-1?O=j[A]:O=new tn(p,p)):(O=S.sel.primary(),A=S.sel.primIndex),h.unit=="rectangle")h.addNew||(O=new tn(p,p)),p=Po(a,u,!0,!0),A=-1;else{var ee=qv(a,p,h.unit);h.extend?O=Gc(O,ee.anchor,ee.head,h.extend):O=ee}h.addNew?A==-1?(A=j.length,Zn(S,ui(a,j.concat([O]),A),{scroll:!1,origin:"*mouse"})):j.length>1&&j[A].empty()&&h.unit=="char"&&!h.extend?(Zn(S,ui(a,j.slice(0,A).concat(j.slice(A+1)),0),{scroll:!1,origin:"*mouse"}),L=S.sel):Yc(S,A,O,Bt):(A=0,Zn(S,new Fr([O],0),Bt),L=S.sel);var oe=p;function ve(nt){if(be(oe,nt)!=0)if(oe=nt,h.unit=="rectangle"){for(var dt=[],St=a.options.tabSize,xt=Ie(We(S,p.line).text,p.ch,St),jt=Ie(We(S,nt.line).text,nt.ch,St),hn=Math.min(xt,jt),Vn=Math.max(xt,jt),bn=Math.min(p.line,nt.line),Dr=Math.min(a.lastLine(),Math.max(p.line,nt.line));bn<=Dr;bn++){var mr=We(S,bn).text,Nn=rn(mr,hn,St);hn==Vn?dt.push(new tn(pe(bn,Nn),pe(bn,Nn))):mr.length>Nn&&dt.push(new tn(pe(bn,Nn),pe(bn,rn(mr,Vn,St))))}dt.length||dt.push(new tn(p,p)),Zn(S,ui(a,L.ranges.slice(0,A).concat(dt),A),{origin:"*mouse",scroll:!1}),a.scrollIntoView(nt)}else{var yr=O,qn=qv(a,nt,h.unit),Ln=yr.anchor,Mn;be(qn.anchor,Ln)>0?(Mn=qn.head,Ln=Cn(yr.from(),qn.anchor)):(Mn=qn.anchor,Ln=Ot(yr.to(),qn.head));var Sn=L.ranges.slice(0);Sn[A]=kE(a,new tn(Mt(S,Ln),Mn)),Zn(S,ui(a,Sn,A),Bt)}}var fe=m.wrapper.getBoundingClientRect(),Te=0;function Be(nt){var dt=++Te,St=Po(a,nt,!0,h.unit=="rectangle");if(St)if(be(St,oe)!=0){a.curOp.focus=Ne(Ve(a)),ve(St);var xt=au(m,S);(St.line>=xt.to||St.line<xt.from)&&setTimeout(Wn(a,function(){Te==dt&&Be(nt)}),150)}else{var jt=nt.clientY<fe.top?-20:nt.clientY>fe.bottom?20:0;jt&&setTimeout(Wn(a,function(){Te==dt&&(m.scroller.scrollTop+=jt,Be(nt))}),50)}}function Ye(nt){a.state.selectingText=!1,Te=1/0,nt&&(ht(nt),m.input.focus()),Ut(m.wrapper.ownerDocument,"mousemove",tt),Ut(m.wrapper.ownerDocument,"mouseup",st),S.history.lastSelOrigin=null}var tt=Wn(a,function(nt){nt.buttons===0||!gn(nt)?Ye(nt):Be(nt)}),st=Wn(a,Ye);a.state.selectingText=st,lt(m.wrapper.ownerDocument,"mousemove",tt),lt(m.wrapper.ownerDocument,"mouseup",st)}function kE(a,u){var p=u.anchor,h=u.head,m=We(a.doc,p.line);if(be(p,h)==0&&p.sticky==h.sticky)return u;var S=et(m);if(!S)return u;var O=rt(S,p.ch,p.sticky),A=S[O];if(A.from!=p.ch&&A.to!=p.ch)return u;var L=O+(A.from==p.ch==(A.level!=1)?0:1);if(L==0||L==S.length)return u;var j;if(h.line!=p.line)j=(h.line-p.line)*(a.doc.direction=="ltr"?1:-1)>0;else{var ee=rt(S,h.ch,h.sticky),oe=ee-O||(h.ch-p.ch)*(A.level==1?-1:1);ee==L-1||ee==L?j=oe<0:j=oe>0}var ve=S[L+(j?-1:0)],fe=j==(ve.level==1),Te=fe?ve.from:ve.to,Be=fe?"after":"before";return p.ch==Te&&p.sticky==Be?u:new tn(new pe(p.line,Te,Be),h)}function Kv(a,u,p,h){var m,S;if(u.touches)m=u.touches[0].clientX,S=u.touches[0].clientY;else try{m=u.clientX,S=u.clientY}catch{return!1}if(m>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;h&&ht(u);var O=a.display,A=O.lineDiv.getBoundingClientRect();if(S>A.bottom||!xe(a,p))return $t(u);S-=A.top-O.viewOffset;for(var L=0;L<a.display.gutterSpecs.length;++L){var j=O.gutters.childNodes[L];if(j&&j.getBoundingClientRect().right>=m){var ee=U(a.doc,S),oe=a.display.gutterSpecs[L];return Pt(a,p,a,ee,oe.className,u),$t(u)}}}function ef(a,u){return Kv(a,u,"gutterClick",!0)}function Jv(a,u){Yi(a.display,u)||NE(a,u)||Rt(a,u,"contextmenu")||ie||a.display.input.onContextMenu(u)}function NE(a,u){return xe(a,"gutterContextMenu")?Kv(a,u,"gutterContextMenu",!1):!1}function Zv(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Os(a)}var Ea={toString:function(){return"CodeMirror.Init"}},Qv={},_u={};function ME(a){var u=a.optionHandlers;function p(h,m,S,O){a.defaults[h]=m,S&&(u[h]=O?function(A,L,j){j!=Ea&&S(A,L,j)}:S)}a.defineOption=p,a.Init=Ea,p("value","",function(h,m){return h.setValue(m)},!0),p("mode",null,function(h,m){h.doc.modeOption=m,Uc(h)},!0),p("indentUnit",2,Uc,!0),p("indentWithTabs",!1),p("smartIndent",!0),p("tabSize",4,function(h){Ps(h),Os(h),vr(h)},!0),p("lineSeparator",null,function(h,m){if(h.doc.lineSep=m,!!m){var S=[],O=h.doc.first;h.doc.iter(function(L){for(var j=0;;){var ee=L.text.indexOf(m,j);if(ee==-1)break;j=ee+m.length,S.push(pe(O,ee))}O++});for(var A=S.length-1;A>=0;A--)ba(h.doc,m,S[A],pe(S[A].line,S[A].ch+m.length))}}),p("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(h,m,S){h.state.specialChars=new RegExp(m.source+(m.test("	")?"":"|	"),"g"),S!=Ea&&h.refresh()}),p("specialCharPlaceholder",iS,function(h){return h.refresh()},!0),p("electricChars",!0),p("inputStyle",D?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),p("spellcheck",!1,function(h,m){return h.getInputField().spellcheck=m},!0),p("autocorrect",!1,function(h,m){return h.getInputField().autocorrect=m},!0),p("autocapitalize",!1,function(h,m){return h.getInputField().autocapitalize=m},!0),p("rtlMoveVisually",!R),p("wholeLineUpdateBefore",!0),p("theme","default",function(h){Zv(h),Ls(h)},!0),p("keyMap","default",function(h,m,S){var O=mu(m),A=S!=Ea&&mu(S);A&&A.detach&&A.detach(h,O),O.attach&&O.attach(h,A||null)}),p("extraKeys",null),p("configureMouse",null),p("lineWrapping",!1,TE,!0),p("gutters",[],function(h,m){h.display.gutterSpecs=zc(m,h.options.lineNumbers),Ls(h)},!0),p("fixedGutter",!0,function(h,m){h.display.gutters.style.left=m?Ac(h.display)+"px":"0",h.refresh()},!0),p("coverGutterNextToScrollbar",!1,function(h){return ga(h)},!0),p("scrollbarStyle","native",function(h){tv(h),ga(h),h.display.scrollbars.setScrollTop(h.doc.scrollTop),h.display.scrollbars.setScrollLeft(h.doc.scrollLeft)},!0),p("lineNumbers",!1,function(h,m){h.display.gutterSpecs=zc(h.options.gutters,m),Ls(h)},!0),p("firstLineNumber",1,Ls,!0),p("lineNumberFormatter",function(h){return h},Ls,!0),p("showCursorWhenSelecting",!1,ks,!0),p("resetSelectionOnContextMenu",!0),p("lineWiseCopyCut",!0),p("pasteLinesPerSelection",!0),p("selectionsMayTouch",!1),p("readOnly",!1,function(h,m){m=="nocursor"&&(pa(h),h.display.input.blur()),h.display.input.readOnlyChanged(m)}),p("screenReaderLabel",null,function(h,m){m=m===""?null:m,h.display.input.screenReaderLabelChanged(m)}),p("disableInput",!1,function(h,m){m||h.display.input.reset()},!0),p("dragDrop",!0,AE),p("allowDropFileTypes",null),p("cursorBlinkRate",530),p("cursorScrollMargin",0),p("cursorHeight",1,ks,!0),p("singleCursorHeightPerLine",!0,ks,!0),p("workTime",100),p("workDelay",100),p("flattenSpans",!0,Ps,!0),p("addModeClass",!1,Ps,!0),p("pollInterval",100),p("undoDepth",200,function(h,m){return h.doc.history.undoDepth=m}),p("historyEventDelay",1250),p("viewportMargin",10,function(h){return h.refresh()},!0),p("maxHighlightLength",1e4,Ps,!0),p("moveInputWithCursor",!0,function(h,m){m||h.display.input.resetPosition()}),p("tabindex",null,function(h,m){return h.display.input.getField().tabIndex=m||""}),p("autofocus",null),p("direction","ltr",function(h,m){return h.doc.setDirection(m)},!0),p("phrases",null)}function AE(a,u,p){var h=p&&p!=Ea;if(!u!=!h){var m=a.display.dragFunctions,S=u?lt:Ut;S(a.display.scroller,"dragstart",m.start),S(a.display.scroller,"dragenter",m.enter),S(a.display.scroller,"dragover",m.over),S(a.display.scroller,"dragleave",m.leave),S(a.display.scroller,"drop",m.drop)}}function TE(a){a.options.lineWrapping?(ye(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Q(a.display.wrapper,"CodeMirror-wrap"),bc(a)),Tc(a),vr(a),Os(a),setTimeout(function(){return ga(a)},100)}function yn(a,u){var p=this;if(!(this instanceof yn))return new yn(a,u);this.options=u=u?_e(u):{},_e(Qv,u,!1);var h=u.value;typeof h=="string"?h=new gr(h,u.mode,null,u.lineSeparator,u.direction):u.mode&&(h.modeOption=u.mode),this.doc=h;var m=new yn.inputStyles[u.inputStyle](this),S=this.display=new US(a,h,m,u);S.wrapper.CodeMirror=this,Zv(this),u.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),tv(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Ke,keySeq:null,specialChars:null},u.autofocus&&!D&&S.input.focus(),d&&c<11&&setTimeout(function(){return p.display.input.reset(!0)},20),DE(this),uE(),jo(this),this.curOp.forceUpdate=!0,cv(this,h),u.autofocus&&!D||this.hasFocus()?setTimeout(function(){p.hasFocus()&&!p.state.focused&&Rc(p)},20):pa(this);for(var O in _u)_u.hasOwnProperty(O)&&_u[O](this,u[O],Ea);iv(this),u.finishInit&&u.finishInit(this);for(var A=0;A<tf.length;++A)tf[A](this);Ho(this),f&&u.lineWrapping&&getComputedStyle(S.lineDiv).textRendering=="optimizelegibility"&&(S.lineDiv.style.textRendering="auto")}yn.defaults=Qv,yn.optionHandlers=_u;function DE(a){var u=a.display;lt(u.scroller,"mousedown",Wn(a,Yv)),d&&c<11?lt(u.scroller,"dblclick",Wn(a,function(L){if(!Rt(a,L)){var j=Po(a,L);if(!(!j||ef(a,L)||Yi(a.display,L))){ht(L);var ee=a.findWordAt(j);fu(a.doc,ee.anchor,ee.head)}}})):lt(u.scroller,"dblclick",function(L){return Rt(a,L)||ht(L)}),lt(u.scroller,"contextmenu",function(L){return Jv(a,L)}),lt(u.input.getField(),"contextmenu",function(L){u.scroller.contains(L.target)||Jv(a,L)});var p,h={end:0};function m(){u.activeTouch&&(p=setTimeout(function(){return u.activeTouch=null},1e3),h=u.activeTouch,h.end=+new Date)}function S(L){if(L.touches.length!=1)return!1;var j=L.touches[0];return j.radiusX<=1&&j.radiusY<=1}function O(L,j){if(j.left==null)return!0;var ee=j.left-L.left,oe=j.top-L.top;return ee*ee+oe*oe>20*20}lt(u.scroller,"touchstart",function(L){if(!Rt(a,L)&&!S(L)&&!ef(a,L)){u.input.ensurePolled(),clearTimeout(p);var j=+new Date;u.activeTouch={start:j,moved:!1,prev:j-h.end<=300?h:null},L.touches.length==1&&(u.activeTouch.left=L.touches[0].pageX,u.activeTouch.top=L.touches[0].pageY)}}),lt(u.scroller,"touchmove",function(){u.activeTouch&&(u.activeTouch.moved=!0)}),lt(u.scroller,"touchend",function(L){var j=u.activeTouch;if(j&&!Yi(u,L)&&j.left!=null&&!j.moved&&new Date-j.start<300){var ee=a.coordsChar(u.activeTouch,"page"),oe;!j.prev||O(j,j.prev)?oe=new tn(ee,ee):!j.prev.prev||O(j,j.prev.prev)?oe=a.findWordAt(ee):oe=new tn(pe(ee.line,0),Mt(a.doc,pe(ee.line+1,0))),a.setSelection(oe.anchor,oe.head),a.focus(),ht(L)}m()}),lt(u.scroller,"touchcancel",m),lt(u.scroller,"scroll",function(){u.scroller.clientHeight&&(Ms(a,u.scroller.scrollTop),Io(a,u.scroller.scrollLeft,!0),Pt(a,"scroll",a))}),lt(u.scroller,"mousewheel",function(L){return sv(a,L)}),lt(u.scroller,"DOMMouseScroll",function(L){return sv(a,L)}),lt(u.wrapper,"scroll",function(){return u.wrapper.scrollTop=u.wrapper.scrollLeft=0}),u.dragFunctions={enter:function(L){Rt(a,L)||zt(L)},over:function(L){Rt(a,L)||(lE(a,L),zt(L))},start:function(L){return sE(a,L)},drop:Wn(a,aE),leave:function(L){Rt(a,L)||Rv(a)}};var A=u.input.getField();lt(A,"keyup",function(L){return Xv.call(a,L)}),lt(A,"keydown",Wn(a,Vv)),lt(A,"keypress",Wn(a,Gv)),lt(A,"focus",function(L){return Rc(a,L)}),lt(A,"blur",function(L){return pa(a,L)})}var tf=[];yn.defineInitHook=function(a){return tf.push(a)};function Gs(a,u,p,h){var m=a.doc,S;p==null&&(p="add"),p=="smart"&&(m.mode.indent?S=oo(a,u).state:p="prev");var O=a.options.tabSize,A=We(m,u),L=Ie(A.text,null,O);A.stateAfter&&(A.stateAfter=null);var j=A.text.match(/^\s*/)[0],ee;if(!h&&!/\S/.test(A.text))ee=0,p="not";else if(p=="smart"&&(ee=m.mode.indent(S,A.text.slice(j.length),A.text),ee==Nt||ee>150)){if(!h)return;p="prev"}p=="prev"?u>m.first?ee=Ie(We(m,u-1).text,null,O):ee=0:p=="add"?ee=L+a.options.indentUnit:p=="subtract"?ee=L-a.options.indentUnit:typeof p=="number"&&(ee=L+p),ee=Math.max(0,ee);var oe="",ve=0;if(a.options.indentWithTabs)for(var fe=Math.floor(ee/O);fe;--fe)ve+=O,oe+="	";if(ve<ee&&(oe+=Z(ee-ve)),oe!=j)return ba(m,oe,pe(u,0),pe(u,j.length),"+input"),A.stateAfter=null,!0;for(var Te=0;Te<m.sel.ranges.length;Te++){var Be=m.sel.ranges[Te];if(Be.head.line==u&&Be.head.ch<j.length){var Ye=pe(u,j.length);Yc(m,Te,new tn(Ye,Ye));break}}}var di=null;function bu(a){di=a}function nf(a,u,p,h,m){var S=a.doc;a.display.shift=!1,h||(h=S.sel);var O=+new Date-200,A=m=="paste"||a.state.pasteIncoming>O,L=En(u),j=null;if(A&&h.ranges.length>1)if(di&&di.text.join(`
`)==u){if(h.ranges.length%di.text.length==0){j=[];for(var ee=0;ee<di.text.length;ee++)j.push(S.splitLines(di.text[ee]))}}else L.length==h.ranges.length&&a.options.pasteLinesPerSelection&&(j=H(L,function(tt){return[tt]}));for(var oe=a.curOp.updateInput,ve=h.ranges.length-1;ve>=0;ve--){var fe=h.ranges[ve],Te=fe.from(),Be=fe.to();fe.empty()&&(p&&p>0?Te=pe(Te.line,Te.ch-p):a.state.overwrite&&!A?Be=pe(Be.line,Math.min(We(S,Be.line).text.length,Be.ch+N(L).length)):A&&di&&di.lineWise&&di.text.join(`
`)==L.join(`
`)&&(Te=Be=pe(Te.line,0)));var Ye={from:Te,to:Be,text:j?j[ve%j.length]:L,origin:m||(A?"paste":a.state.cutIncoming>O?"cut":"+input")};_a(a.doc,Ye),zn(a,"inputRead",a,Ye)}u&&!A&&tg(a,u),va(a),a.curOp.updateInput<2&&(a.curOp.updateInput=oe),a.curOp.typing=!0,a.state.pasteIncoming=a.state.cutIncoming=-1}function eg(a,u){var p=a.clipboardData&&a.clipboardData.getData("Text");if(p)return a.preventDefault(),!u.isReadOnly()&&!u.options.disableInput&&u.hasFocus()&&Tr(u,function(){return nf(u,p,0,null,"paste")}),!0}function tg(a,u){if(!(!a.options.electricChars||!a.options.smartIndent))for(var p=a.doc.sel,h=p.ranges.length-1;h>=0;h--){var m=p.ranges[h];if(!(m.head.ch>100||h&&p.ranges[h-1].head.line==m.head.line)){var S=a.getModeAt(m.head),O=!1;if(S.electricChars){for(var A=0;A<S.electricChars.length;A++)if(u.indexOf(S.electricChars.charAt(A))>-1){O=Gs(a,m.head.line,"smart");break}}else S.electricInput&&S.electricInput.test(We(a.doc,m.head.line).text.slice(0,m.head.ch))&&(O=Gs(a,m.head.line,"smart"));O&&zn(a,"electricInput",a,m.head.line)}}}function ng(a){for(var u=[],p=[],h=0;h<a.doc.sel.ranges.length;h++){var m=a.doc.sel.ranges[h].head.line,S={anchor:pe(m,0),head:pe(m+1,0)};p.push(S),u.push(a.getRange(S.anchor,S.head))}return{text:u,ranges:p}}function rf(a,u,p,h){a.setAttribute("autocorrect",p?"on":"off"),a.setAttribute("autocapitalize",h?"on":"off"),a.setAttribute("spellcheck",!!u)}function rg(){var a=P("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),u=P("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return f?a.style.width="1000px":a.setAttribute("wrap","off"),C&&(a.style.border="1px solid black"),u}function LE(a){var u=a.optionHandlers,p=a.helpers={};a.prototype={constructor:a,focus:function(){te(this).focus(),this.display.input.focus()},setOption:function(h,m){var S=this.options,O=S[h];S[h]==m&&h!="mode"||(S[h]=m,u.hasOwnProperty(h)&&Wn(this,u[h])(this,m,O),Pt(this,"optionChange",this,h))},getOption:function(h){return this.options[h]},getDoc:function(){return this.doc},addKeyMap:function(h,m){this.state.keyMaps[m?"push":"unshift"](mu(h))},removeKeyMap:function(h){for(var m=this.state.keyMaps,S=0;S<m.length;++S)if(m[S]==h||m[S].name==h)return m.splice(S,1),!0},addOverlay:ar(function(h,m){var S=h.token?h:a.getMode(this.options,h);if(S.startState)throw new Error("Overlays may not be stateful.");J(this.state.overlays,{mode:S,modeSpec:h,opaque:m&&m.opaque,priority:m&&m.priority||0},function(O){return O.priority}),this.state.modeGen++,vr(this)}),removeOverlay:ar(function(h){for(var m=this.state.overlays,S=0;S<m.length;++S){var O=m[S].modeSpec;if(O==h||typeof h=="string"&&O.name==h){m.splice(S,1),this.state.modeGen++,vr(this);return}}}),indentLine:ar(function(h,m,S){typeof m!="string"&&typeof m!="number"&&(m==null?m=this.options.smartIndent?"smart":"prev":m=m?"add":"subtract"),de(this.doc,h)&&Gs(this,h,m,S)}),indentSelection:ar(function(h){for(var m=this.doc.sel.ranges,S=-1,O=0;O<m.length;O++){var A=m[O];if(A.empty())A.head.line>S&&(Gs(this,A.head.line,h,!0),S=A.head.line,O==this.doc.sel.primIndex&&va(this));else{var L=A.from(),j=A.to(),ee=Math.max(S,L.line);S=Math.min(this.lastLine(),j.line-(j.ch?0:1))+1;for(var oe=ee;oe<S;++oe)Gs(this,oe,h);var ve=this.doc.sel.ranges;L.ch==0&&m.length==ve.length&&ve[O].from().ch>0&&Yc(this.doc,O,new tn(L,ve[O].to()),ot)}}}),getTokenAt:function(h,m){return hp(this,h,m)},getLineTokens:function(h,m){return hp(this,pe(h),m,!0)},getTokenTypeAt:function(h){h=Mt(this.doc,h);var m=Gl(this,We(this.doc,h.line)),S=0,O=(m.length-1)/2,A=h.ch,L;if(A==0)L=m[2];else for(;;){var j=S+O>>1;if((j?m[j*2-1]:0)>=A)O=j;else if(m[j*2+1]<A)S=j+1;else{L=m[j*2+2];break}}var ee=L?L.indexOf("overlay "):-1;return ee<0?L:ee==0?null:L.slice(0,ee-1)},getModeAt:function(h){var m=this.doc.mode;return m.innerMode?a.innerMode(m,this.getTokenAt(h).state).mode:m},getHelper:function(h,m){return this.getHelpers(h,m)[0]},getHelpers:function(h,m){var S=[];if(!p.hasOwnProperty(m))return S;var O=p[m],A=this.getModeAt(h);if(typeof A[m]=="string")O[A[m]]&&S.push(O[A[m]]);else if(A[m])for(var L=0;L<A[m].length;L++){var j=O[A[m][L]];j&&S.push(j)}else A.helperType&&O[A.helperType]?S.push(O[A.helperType]):O[A.name]&&S.push(O[A.name]);for(var ee=0;ee<O._global.length;ee++){var oe=O._global[ee];oe.pred(A,this)&&$e(S,oe.val)==-1&&S.push(oe.val)}return S},getStateAfter:function(h,m){var S=this.doc;return h=xs(S,h??S.first+S.size-1),oo(this,h+1,m).state},cursorCoords:function(h,m){var S,O=this.doc.sel.primary();return h==null?S=O.head:typeof h=="object"?S=Mt(this.doc,h):S=h?O.from():O.to(),li(this,S,m||"page")},charCoords:function(h,m){return nu(this,Mt(this.doc,h),m||"page")},coordsChar:function(h,m){return h=zp(this,h,m||"page"),kc(this,h.left,h.top)},lineAtHeight:function(h,m){return h=zp(this,{top:h,left:0},m||"page").top,U(this.doc,h+this.display.viewOffset)},heightAtLine:function(h,m,S){var O=!1,A;if(typeof h=="number"){var L=this.doc.first+this.doc.size-1;h<this.doc.first?h=this.doc.first:h>L&&(h=L,O=!0),A=We(this.doc,h)}else A=h;return tu(this,A,{top:0,left:0},m||"page",S||O).top+(O?this.doc.height-Gi(A):0)},defaultTextHeight:function(){return fa(this.display)},defaultCharWidth:function(){return ha(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(h,m,S,O,A){var L=this.display;h=li(this,Mt(this.doc,h));var j=h.bottom,ee=h.left;if(m.style.position="absolute",m.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(m),L.sizer.appendChild(m),O=="over")j=h.top;else if(O=="above"||O=="near"){var oe=Math.max(L.wrapper.clientHeight,this.doc.height),ve=Math.max(L.sizer.clientWidth,L.lineSpace.clientWidth);(O=="above"||h.bottom+m.offsetHeight>oe)&&h.top>m.offsetHeight?j=h.top-m.offsetHeight:h.bottom+m.offsetHeight<=oe&&(j=h.bottom),ee+m.offsetWidth>ve&&(ee=ve-m.offsetWidth)}m.style.top=j+"px",m.style.left=m.style.right="",A=="right"?(ee=L.sizer.clientWidth-m.offsetWidth,m.style.right="0px"):(A=="left"?ee=0:A=="middle"&&(ee=(L.sizer.clientWidth-m.offsetWidth)/2),m.style.left=ee+"px"),S&&AS(this,{left:ee,top:j,right:ee+m.offsetWidth,bottom:j+m.offsetHeight})},triggerOnKeyDown:ar(Vv),triggerOnKeyPress:ar(Gv),triggerOnKeyUp:Xv,triggerOnMouseDown:ar(Yv),execCommand:function(h){if(Ws.hasOwnProperty(h))return Ws[h].call(null,this)},triggerElectric:ar(function(h){tg(this,h)}),findPosH:function(h,m,S,O){var A=1;m<0&&(A=-1,m=-m);for(var L=Mt(this.doc,h),j=0;j<m&&(L=of(this.doc,L,A,S,O),!L.hitSide);++j);return L},moveH:ar(function(h,m){var S=this;this.extendSelectionsBy(function(O){return S.display.shift||S.doc.extend||O.empty()?of(S.doc,O.head,h,m,S.options.rtlMoveVisually):h<0?O.from():O.to()},bt)}),deleteH:ar(function(h,m){var S=this.doc.sel,O=this.doc;S.somethingSelected()?O.replaceSelection("",null,"+delete"):Sa(this,function(A){var L=of(O,A.head,h,m,!1);return h<0?{from:L,to:A.head}:{from:A.head,to:L}})}),findPosV:function(h,m,S,O){var A=1,L=O;m<0&&(A=-1,m=-m);for(var j=Mt(this.doc,h),ee=0;ee<m;++ee){var oe=li(this,j,"div");if(L==null?L=oe.left:oe.left=L,j=ig(this,oe,A,S),j.hitSide)break}return j},moveV:ar(function(h,m){var S=this,O=this.doc,A=[],L=!this.display.shift&&!O.extend&&O.sel.somethingSelected();if(O.extendSelectionsBy(function(ee){if(L)return h<0?ee.from():ee.to();var oe=li(S,ee.head,"div");ee.goalColumn!=null&&(oe.left=ee.goalColumn),A.push(oe.left);var ve=ig(S,oe,h,m);return m=="page"&&ee==O.sel.primary()&&Bc(S,nu(S,ve,"div").top-oe.top),ve},bt),A.length)for(var j=0;j<O.sel.ranges.length;j++)O.sel.ranges[j].goalColumn=A[j]}),findWordAt:function(h){var m=this.doc,S=We(m,h.line).text,O=h.ch,A=h.ch;if(S){var L=this.getHelper(h,"wordChars");(h.sticky=="before"||A==S.length)&&O?--O:++A;for(var j=S.charAt(O),ee=we(j,L)?function(oe){return we(oe,L)}:/\s/.test(j)?function(oe){return/\s/.test(oe)}:function(oe){return!/\s/.test(oe)&&!we(oe)};O>0&&ee(S.charAt(O-1));)--O;for(;A<S.length&&ee(S.charAt(A));)++A}return new tn(pe(h.line,O),pe(h.line,A))},toggleOverwrite:function(h){h!=null&&h==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?ye(this.display.cursorDiv,"CodeMirror-overwrite"):Q(this.display.cursorDiv,"CodeMirror-overwrite"),Pt(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Ne(Ve(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:ar(function(h,m){Ns(this,h,m)}),getScrollInfo:function(){var h=this.display.scroller;return{left:h.scrollLeft,top:h.scrollTop,height:h.scrollHeight-Mi(this)-this.display.barHeight,width:h.scrollWidth-Mi(this)-this.display.barWidth,clientHeight:Sc(this),clientWidth:Do(this)}},scrollIntoView:ar(function(h,m){h==null?(h={from:this.doc.sel.primary().head,to:null},m==null&&(m=this.options.cursorScrollMargin)):typeof h=="number"?h={from:pe(h,0),to:null}:h.from==null&&(h={from:h,to:null}),h.to||(h.to=h.from),h.margin=m||0,h.from.line!=null?TS(this,h):Jp(this,h.from,h.to,h.margin)}),setSize:ar(function(h,m){var S=this,O=function(L){return typeof L=="number"||/^\d+$/.test(String(L))?L+"px":L};h!=null&&(this.display.wrapper.style.width=O(h)),m!=null&&(this.display.wrapper.style.height=O(m)),this.options.lineWrapping&&Hp(this);var A=this.display.viewFrom;this.doc.iter(A,this.display.viewTo,function(L){if(L.widgets){for(var j=0;j<L.widgets.length;j++)if(L.widgets[j].noHScroll){so(S,A,"widget");break}}++A}),this.curOp.forceUpdate=!0,Pt(this,"refresh",this)}),operation:function(h){return Tr(this,h)},startOperation:function(){return jo(this)},endOperation:function(){return Ho(this)},refresh:ar(function(){var h=this.display.cachedTextHeight;vr(this),this.curOp.forceUpdate=!0,Os(this),Ns(this,this.doc.scrollLeft,this.doc.scrollTop),$c(this.display),(h==null||Math.abs(h-fa(this.display))>.5||this.options.lineWrapping)&&Tc(this),Pt(this,"refresh",this)}),swapDoc:ar(function(h){var m=this.doc;return m.cm=null,this.state.selectingText&&this.state.selectingText(),cv(this,h),Os(this),this.display.input.reset(),Ns(this,h.scrollLeft,h.scrollTop),this.curOp.forceScroll=!0,zn(this,"swapDoc",this,m),m}),phrase:function(h){var m=this.options.phrases;return m&&Object.prototype.hasOwnProperty.call(m,h)?m[h]:h},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},qe(a),a.registerHelper=function(h,m,S){p.hasOwnProperty(h)||(p[h]=a[h]={_global:[]}),p[h][m]=S},a.registerGlobalHelper=function(h,m,S,O){a.registerHelper(h,m,O),p[h]._global.push({pred:S,val:O})}}function of(a,u,p,h,m){var S=u,O=p,A=We(a,u.line),L=m&&a.direction=="rtl"?-p:p;function j(){var st=u.line+L;return st<a.first||st>=a.first+a.size?!1:(u=new pe(st,u.ch,u.sticky),A=We(a,st))}function ee(st){var nt;if(h=="codepoint"){var dt=A.text.charCodeAt(u.ch+(p>0?0:-1));if(isNaN(dt))nt=null;else{var St=p>0?dt>=55296&&dt<56320:dt>=56320&&dt<57343;nt=new pe(u.line,Math.max(0,Math.min(A.text.length,u.ch+p*(St?2:1))),-p)}}else m?nt=pE(a.cm,A,u,p):nt=Kc(A,u,p);if(nt==null)if(!st&&j())u=Jc(m,a.cm,A,u.line,L);else return!1;else u=nt;return!0}if(h=="char"||h=="codepoint")ee();else if(h=="column")ee(!0);else if(h=="word"||h=="group")for(var oe=null,ve=h=="group",fe=a.cm&&a.cm.getHelper(u,"wordChars"),Te=!0;!(p<0&&!ee(!Te));Te=!1){var Be=A.text.charAt(u.ch)||`
`,Ye=we(Be,fe)?"w":ve&&Be==`
`?"n":!ve||/\s/.test(Be)?null:"p";if(ve&&!Te&&!Ye&&(Ye="s"),oe&&oe!=Ye){p<0&&(p=1,ee(),u.sticky="after");break}if(Ye&&(oe=Ye),p>0&&!ee(!Te))break}var tt=pu(a,u,S,O,!0);return Je(S,tt)&&(tt.hitSide=!0),tt}function ig(a,u,p,h){var m=a.doc,S=u.left,O;if(h=="page"){var A=Math.min(a.display.wrapper.clientHeight,te(a).innerHeight||m(a).documentElement.clientHeight),L=Math.max(A-.5*fa(a.display),3);O=(p>0?u.bottom:u.top)+p*L}else h=="line"&&(O=p>0?u.bottom+3:u.top-3);for(var j;j=kc(a,S,O),!!j.outside;){if(p<0?O<=0:O>=m.height){j.hitSide=!0;break}O+=p*5}return j}var an=function(a){this.cm=a,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Ke,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};an.prototype.init=function(a){var u=this,p=this,h=p.cm,m=p.div=a.lineDiv;m.contentEditable=!0,rf(m,h.options.spellcheck,h.options.autocorrect,h.options.autocapitalize);function S(A){for(var L=A.target;L;L=L.parentNode){if(L==m)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(L.className))break}return!1}lt(m,"paste",function(A){!S(A)||Rt(h,A)||eg(A,h)||c<=11&&setTimeout(Wn(h,function(){return u.updateFromDOM()}),20)}),lt(m,"compositionstart",function(A){u.composing={data:A.data,done:!1}}),lt(m,"compositionupdate",function(A){u.composing||(u.composing={data:A.data,done:!1})}),lt(m,"compositionend",function(A){u.composing&&(A.data!=u.composing.data&&u.readFromDOMSoon(),u.composing.done=!0)}),lt(m,"touchstart",function(){return p.forceCompositionEnd()}),lt(m,"input",function(){u.composing||u.readFromDOMSoon()});function O(A){if(!(!S(A)||Rt(h,A))){if(h.somethingSelected())bu({lineWise:!1,text:h.getSelections()}),A.type=="cut"&&h.replaceSelection("",null,"cut");else if(h.options.lineWiseCopyCut){var L=ng(h);bu({lineWise:!0,text:L.text}),A.type=="cut"&&h.operation(function(){h.setSelections(L.ranges,0,ot),h.replaceSelection("",null,"cut")})}else return;if(A.clipboardData){A.clipboardData.clearData();var j=di.text.join(`
`);if(A.clipboardData.setData("Text",j),A.clipboardData.getData("Text")==j){A.preventDefault();return}}var ee=rg(),oe=ee.firstChild;rf(oe),h.display.lineSpace.insertBefore(ee,h.display.lineSpace.firstChild),oe.value=di.text.join(`
`);var ve=Ne(Ae(m));Re(oe),setTimeout(function(){h.display.lineSpace.removeChild(ee),ve.focus(),ve==m&&p.showPrimarySelection()},50)}}lt(m,"copy",O),lt(m,"cut",O)},an.prototype.screenReaderLabelChanged=function(a){a?this.div.setAttribute("aria-label",a):this.div.removeAttribute("aria-label")},an.prototype.prepareSelection=function(){var a=Yp(this.cm,!1);return a.focus=Ne(Ae(this.div))==this.div,a},an.prototype.showSelection=function(a,u){!a||!this.cm.display.view.length||((a.focus||u)&&this.showPrimarySelection(),this.showMultipleSelections(a))},an.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},an.prototype.showPrimarySelection=function(){var a=this.getSelection(),u=this.cm,p=u.doc.sel.primary(),h=p.from(),m=p.to();if(u.display.viewTo==u.display.viewFrom||h.line>=u.display.viewTo||m.line<u.display.viewFrom){a.removeAllRanges();return}var S=xu(u,a.anchorNode,a.anchorOffset),O=xu(u,a.focusNode,a.focusOffset);if(!(S&&!S.bad&&O&&!O.bad&&be(Cn(S,O),h)==0&&be(Ot(S,O),m)==0)){var A=u.display.view,L=h.line>=u.display.viewFrom&&og(u,h)||{node:A[0].measure.map[2],offset:0},j=m.line<u.display.viewTo&&og(u,m);if(!j){var ee=A[A.length-1].measure,oe=ee.maps?ee.maps[ee.maps.length-1]:ee.map;j={node:oe[oe.length-1],offset:oe[oe.length-2]-oe[oe.length-3]}}if(!L||!j){a.removeAllRanges();return}var ve=a.rangeCount&&a.getRangeAt(0),fe;try{fe=me(L.node,L.offset,j.offset,j.node)}catch{}fe&&(!i&&u.state.focused?(a.collapse(L.node,L.offset),fe.collapsed||(a.removeAllRanges(),a.addRange(fe))):(a.removeAllRanges(),a.addRange(fe)),ve&&a.anchorNode==null?a.addRange(ve):i&&this.startGracePeriod()),this.rememberSelection()}},an.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){a.gracePeriod=!1,a.selectionChanged()&&a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})},20)},an.prototype.showMultipleSelections=function(a){W(this.cm.display.cursorDiv,a.cursors),W(this.cm.display.selectionDiv,a.selection)},an.prototype.rememberSelection=function(){var a=this.getSelection();this.lastAnchorNode=a.anchorNode,this.lastAnchorOffset=a.anchorOffset,this.lastFocusNode=a.focusNode,this.lastFocusOffset=a.focusOffset},an.prototype.selectionInEditor=function(){var a=this.getSelection();if(!a.rangeCount)return!1;var u=a.getRangeAt(0).commonAncestorContainer;return he(this.div,u)},an.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||Ne(Ae(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},an.prototype.blur=function(){this.div.blur()},an.prototype.getField=function(){return this.div},an.prototype.supportsTouch=function(){return!0},an.prototype.receivedFocus=function(){var a=this,u=this;this.selectionInEditor()?setTimeout(function(){return a.pollSelection()},20):Tr(this.cm,function(){return u.cm.curOp.selectionChanged=!0});function p(){u.cm.state.focused&&(u.pollSelection(),u.polling.set(u.cm.options.pollInterval,p))}this.polling.set(this.cm.options.pollInterval,p)},an.prototype.selectionChanged=function(){var a=this.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},an.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var a=this.getSelection(),u=this.cm;if(k&&g&&this.cm.display.gutterSpecs.length&&PE(a.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var p=xu(u,a.anchorNode,a.anchorOffset),h=xu(u,a.focusNode,a.focusOffset);p&&h&&Tr(u,function(){Zn(u.doc,uo(p,h),ot),(p.bad||h.bad)&&(u.curOp.selectionChanged=!0)})}}},an.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var a=this.cm,u=a.display,p=a.doc.sel.primary(),h=p.from(),m=p.to();if(h.ch==0&&h.line>a.firstLine()&&(h=pe(h.line-1,We(a.doc,h.line-1).length)),m.ch==We(a.doc,m.line).text.length&&m.line<a.lastLine()&&(m=pe(m.line+1,0)),h.line<u.viewFrom||m.line>u.viewTo-1)return!1;var S,O,A;h.line==u.viewFrom||(S=Ro(a,h.line))==0?(O=M(u.view[0].line),A=u.view[0].node):(O=M(u.view[S].line),A=u.view[S-1].node.nextSibling);var L=Ro(a,m.line),j,ee;if(L==u.view.length-1?(j=u.viewTo-1,ee=u.lineDiv.lastChild):(j=M(u.view[L+1].line)-1,ee=u.view[L+1].node.previousSibling),!A)return!1;for(var oe=a.doc.splitLines(RE(a,A,ee,O,j)),ve=It(a.doc,pe(O,0),pe(j,We(a.doc,j).text.length));oe.length>1&&ve.length>1;)if(N(oe)==N(ve))oe.pop(),ve.pop(),j--;else if(oe[0]==ve[0])oe.shift(),ve.shift(),O++;else break;for(var fe=0,Te=0,Be=oe[0],Ye=ve[0],tt=Math.min(Be.length,Ye.length);fe<tt&&Be.charCodeAt(fe)==Ye.charCodeAt(fe);)++fe;for(var st=N(oe),nt=N(ve),dt=Math.min(st.length-(oe.length==1?fe:0),nt.length-(ve.length==1?fe:0));Te<dt&&st.charCodeAt(st.length-Te-1)==nt.charCodeAt(nt.length-Te-1);)++Te;if(oe.length==1&&ve.length==1&&O==h.line)for(;fe&&fe>h.ch&&st.charCodeAt(st.length-Te-1)==nt.charCodeAt(nt.length-Te-1);)fe--,Te++;oe[oe.length-1]=st.slice(0,st.length-Te).replace(/^\u200b+/,""),oe[0]=oe[0].slice(fe).replace(/\u200b+$/,"");var St=pe(O,fe),xt=pe(j,ve.length?N(ve).length-Te:0);if(oe.length>1||oe[0]||be(St,xt))return ba(a.doc,oe,St,xt,"+input"),!0},an.prototype.ensurePolled=function(){this.forceCompositionEnd()},an.prototype.reset=function(){this.forceCompositionEnd()},an.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},an.prototype.readFromDOMSoon=function(){var a=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(a.readDOMTimeout=null,a.composing)if(a.composing.done)a.composing=null;else return;a.updateFromDOM()},80))},an.prototype.updateFromDOM=function(){var a=this;(this.cm.isReadOnly()||!this.pollContent())&&Tr(this.cm,function(){return vr(a.cm)})},an.prototype.setUneditable=function(a){a.contentEditable="false"},an.prototype.onKeyPress=function(a){a.charCode==0||this.composing||(a.preventDefault(),this.cm.isReadOnly()||Wn(this.cm,nf)(this.cm,String.fromCharCode(a.charCode==null?a.keyCode:a.charCode),0))},an.prototype.readOnlyChanged=function(a){this.div.contentEditable=String(a!="nocursor")},an.prototype.onContextMenu=function(){},an.prototype.resetPosition=function(){},an.prototype.needsContentAttribute=!0;function og(a,u){var p=Ec(a,u.line);if(!p||p.hidden)return null;var h=We(a.doc,u.line),m=Pp(p,h,u.line),S=et(h,a.doc.direction),O="left";if(S){var A=rt(S,u.ch);O=A%2?"right":"left"}var L=Bp(m.map,u.ch,O);return L.offset=L.collapse=="right"?L.end:L.start,L}function PE(a){for(var u=a;u;u=u.parentNode)if(/CodeMirror-gutter-wrapper/.test(u.className))return!0;return!1}function Ca(a,u){return u&&(a.bad=!0),a}function RE(a,u,p,h,m){var S="",O=!1,A=a.doc.lineSeparator(),L=!1;function j(fe){return function(Te){return Te.id==fe}}function ee(){O&&(S+=A,L&&(S+=A),O=L=!1)}function oe(fe){fe&&(ee(),S+=fe)}function ve(fe){if(fe.nodeType==1){var Te=fe.getAttribute("cm-text");if(Te){oe(Te);return}var Be=fe.getAttribute("cm-marker"),Ye;if(Be){var tt=a.findMarks(pe(h,0),pe(m+1,0),j(+Be));tt.length&&(Ye=tt[0].find(0))&&oe(It(a.doc,Ye.from,Ye.to).join(A));return}if(fe.getAttribute("contenteditable")=="false")return;var st=/^(pre|div|p|li|table|br)$/i.test(fe.nodeName);if(!/^br$/i.test(fe.nodeName)&&fe.textContent.length==0)return;st&&ee();for(var nt=0;nt<fe.childNodes.length;nt++)ve(fe.childNodes[nt]);/^(pre|p)$/i.test(fe.nodeName)&&(L=!0),st&&(O=!0)}else fe.nodeType==3&&oe(fe.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;ve(u),u!=p;)u=u.nextSibling,L=!1;return S}function xu(a,u,p){var h;if(u==a.display.lineDiv){if(h=a.display.lineDiv.childNodes[p],!h)return Ca(a.clipPos(pe(a.display.viewTo-1)),!0);u=null,p=0}else for(h=u;;h=h.parentNode){if(!h||h==a.display.lineDiv)return null;if(h.parentNode&&h.parentNode==a.display.lineDiv)break}for(var m=0;m<a.display.view.length;m++){var S=a.display.view[m];if(S.node==h)return IE(S,u,p)}}function IE(a,u,p){var h=a.text.firstChild,m=!1;if(!u||!he(h,u))return Ca(pe(M(a.line),0),!0);if(u==h&&(m=!0,u=h.childNodes[p],p=0,!u)){var S=a.rest?N(a.rest):a.line;return Ca(pe(M(S),S.text.length),m)}var O=u.nodeType==3?u:null,A=u;for(!O&&u.childNodes.length==1&&u.firstChild.nodeType==3&&(O=u.firstChild,p&&(p=O.nodeValue.length));A.parentNode!=h;)A=A.parentNode;var L=a.measure,j=L.maps;function ee(Ye,tt,st){for(var nt=-1;nt<(j?j.length:0);nt++)for(var dt=nt<0?L.map:j[nt],St=0;St<dt.length;St+=3){var xt=dt[St+2];if(xt==Ye||xt==tt){var jt=M(nt<0?a.line:a.rest[nt]),hn=dt[St]+st;return(st<0||xt!=Ye)&&(hn=dt[St+(st?1:0)]),pe(jt,hn)}}}var oe=ee(O,A,p);if(oe)return Ca(oe,m);for(var ve=A.nextSibling,fe=O?O.nodeValue.length-p:0;ve;ve=ve.nextSibling){if(oe=ee(ve,ve.firstChild,0),oe)return Ca(pe(oe.line,oe.ch-fe),m);fe+=ve.textContent.length}for(var Te=A.previousSibling,Be=p;Te;Te=Te.previousSibling){if(oe=ee(Te,Te.firstChild,-1),oe)return Ca(pe(oe.line,oe.ch+Be),m);Be+=Te.textContent.length}}var On=function(a){this.cm=a,this.prevInput="",this.pollingFast=!1,this.polling=new Ke,this.hasSelection=!1,this.composing=null,this.resetting=!1};On.prototype.init=function(a){var u=this,p=this,h=this.cm;this.createField(a);var m=this.textarea;a.wrapper.insertBefore(this.wrapper,a.wrapper.firstChild),C&&(m.style.width="0px"),lt(m,"input",function(){d&&c>=9&&u.hasSelection&&(u.hasSelection=null),p.poll()}),lt(m,"paste",function(O){Rt(h,O)||eg(O,h)||(h.state.pasteIncoming=+new Date,p.fastPoll())});function S(O){if(!Rt(h,O)){if(h.somethingSelected())bu({lineWise:!1,text:h.getSelections()});else if(h.options.lineWiseCopyCut){var A=ng(h);bu({lineWise:!0,text:A.text}),O.type=="cut"?h.setSelections(A.ranges,null,ot):(p.prevInput="",m.value=A.text.join(`
`),Re(m))}else return;O.type=="cut"&&(h.state.cutIncoming=+new Date)}}lt(m,"cut",S),lt(m,"copy",S),lt(a.scroller,"paste",function(O){if(!(Yi(a,O)||Rt(h,O))){if(!m.dispatchEvent){h.state.pasteIncoming=+new Date,p.focus();return}var A=new Event("paste");A.clipboardData=O.clipboardData,m.dispatchEvent(A)}}),lt(a.lineSpace,"selectstart",function(O){Yi(a,O)||ht(O)}),lt(m,"compositionstart",function(){var O=h.getCursor("from");p.composing&&p.composing.range.clear(),p.composing={start:O,range:h.markText(O,h.getCursor("to"),{className:"CodeMirror-composing"})}}),lt(m,"compositionend",function(){p.composing&&(p.poll(),p.composing.range.clear(),p.composing=null)})},On.prototype.createField=function(a){this.wrapper=rg(),this.textarea=this.wrapper.firstChild;var u=this.cm.options;rf(this.textarea,u.spellcheck,u.autocorrect,u.autocapitalize)},On.prototype.screenReaderLabelChanged=function(a){a?this.textarea.setAttribute("aria-label",a):this.textarea.removeAttribute("aria-label")},On.prototype.prepareSelection=function(){var a=this.cm,u=a.display,p=a.doc,h=Yp(a);if(a.options.moveInputWithCursor){var m=li(a,p.sel.primary().head,"div"),S=u.wrapper.getBoundingClientRect(),O=u.lineDiv.getBoundingClientRect();h.teTop=Math.max(0,Math.min(u.wrapper.clientHeight-10,m.top+O.top-S.top)),h.teLeft=Math.max(0,Math.min(u.wrapper.clientWidth-10,m.left+O.left-S.left))}return h},On.prototype.showSelection=function(a){var u=this.cm,p=u.display;W(p.cursorDiv,a.cursors),W(p.selectionDiv,a.selection),a.teTop!=null&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},On.prototype.reset=function(a){if(!(this.contextMenuPending||this.composing&&a)){var u=this.cm;if(this.resetting=!0,u.somethingSelected()){this.prevInput="";var p=u.getSelection();this.textarea.value=p,u.state.focused&&Re(this.textarea),d&&c>=9&&(this.hasSelection=p)}else a||(this.prevInput=this.textarea.value="",d&&c>=9&&(this.hasSelection=null));this.resetting=!1}},On.prototype.getField=function(){return this.textarea},On.prototype.supportsTouch=function(){return!1},On.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!D||Ne(Ae(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},On.prototype.blur=function(){this.textarea.blur()},On.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},On.prototype.receivedFocus=function(){this.slowPoll()},On.prototype.slowPoll=function(){var a=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){a.poll(),a.cm.state.focused&&a.slowPoll()})},On.prototype.fastPoll=function(){var a=!1,u=this;u.pollingFast=!0;function p(){var h=u.poll();!h&&!a?(a=!0,u.polling.set(60,p)):(u.pollingFast=!1,u.slowPoll())}u.polling.set(20,p)},On.prototype.poll=function(){var a=this,u=this.cm,p=this.textarea,h=this.prevInput;if(this.contextMenuPending||this.resetting||!u.state.focused||kr(p)&&!h&&!this.composing||u.isReadOnly()||u.options.disableInput||u.state.keySeq)return!1;var m=p.value;if(m==h&&!u.somethingSelected())return!1;if(d&&c>=9&&this.hasSelection===m||I&&/[\uf700-\uf7ff]/.test(m))return u.display.input.reset(),!1;if(u.doc.sel==u.display.selForContextMenu){var S=m.charCodeAt(0);if(S==8203&&!h&&(h="​"),S==8666)return this.reset(),this.cm.execCommand("undo")}for(var O=0,A=Math.min(h.length,m.length);O<A&&h.charCodeAt(O)==m.charCodeAt(O);)++O;return Tr(u,function(){nf(u,m.slice(O),h.length-O,null,a.composing?"*compose":null),m.length>1e3||m.indexOf(`
`)>-1?p.value=a.prevInput="":a.prevInput=m,a.composing&&(a.composing.range.clear(),a.composing.range=u.markText(a.composing.start,u.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},On.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},On.prototype.onKeyPress=function(){d&&c>=9&&(this.hasSelection=null),this.fastPoll()},On.prototype.onContextMenu=function(a){var u=this,p=u.cm,h=p.display,m=u.textarea;u.contextMenuPending&&u.contextMenuPending();var S=Po(p,a),O=h.scroller.scrollTop;if(!S||b)return;var A=p.options.resetSelectionOnContextMenu;A&&p.doc.sel.contains(S)==-1&&Wn(p,Zn)(p.doc,uo(S),ot);var L=m.style.cssText,j=u.wrapper.style.cssText,ee=u.wrapper.offsetParent.getBoundingClientRect();u.wrapper.style.cssText="position: static",m.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(a.clientY-ee.top-5)+"px; left: "+(a.clientX-ee.left-5)+`px;
      z-index: 1000; background: `+(d?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var oe;f&&(oe=m.ownerDocument.defaultView.scrollY),h.input.focus(),f&&m.ownerDocument.defaultView.scrollTo(null,oe),h.input.reset(),p.somethingSelected()||(m.value=u.prevInput=" "),u.contextMenuPending=fe,h.selForContextMenu=p.doc.sel,clearTimeout(h.detectingSelectAll);function ve(){if(m.selectionStart!=null){var Be=p.somethingSelected(),Ye="​"+(Be?m.value:"");m.value="⇚",m.value=Ye,u.prevInput=Be?"":"​",m.selectionStart=1,m.selectionEnd=Ye.length,h.selForContextMenu=p.doc.sel}}function fe(){if(u.contextMenuPending==fe&&(u.contextMenuPending=!1,u.wrapper.style.cssText=j,m.style.cssText=L,d&&c<9&&h.scrollbars.setScrollTop(h.scroller.scrollTop=O),m.selectionStart!=null)){(!d||d&&c<9)&&ve();var Be=0,Ye=function(){h.selForContextMenu==p.doc.sel&&m.selectionStart==0&&m.selectionEnd>0&&u.prevInput=="​"?Wn(p,Ev)(p):Be++<10?h.detectingSelectAll=setTimeout(Ye,500):(h.selForContextMenu=null,h.input.reset())};h.detectingSelectAll=setTimeout(Ye,200)}}if(d&&c>=9&&ve(),ie){zt(a);var Te=function(){Ut(window,"mouseup",Te),setTimeout(fe,20)};lt(window,"mouseup",Te)}else setTimeout(fe,50)},On.prototype.readOnlyChanged=function(a){a||this.reset(),this.textarea.disabled=a=="nocursor",this.textarea.readOnly=!!a},On.prototype.setUneditable=function(){},On.prototype.needsContentAttribute=!1;function BE(a,u){if(u=u?_e(u):{},u.value=a.value,!u.tabindex&&a.tabIndex&&(u.tabindex=a.tabIndex),!u.placeholder&&a.placeholder&&(u.placeholder=a.placeholder),u.autofocus==null){var p=Ne(Ae(a));u.autofocus=p==a||a.getAttribute("autofocus")!=null&&p==document.body}function h(){a.value=A.getValue()}var m;if(a.form&&(lt(a.form,"submit",h),!u.leaveSubmitMethodAlone)){var S=a.form;m=S.submit;try{var O=S.submit=function(){h(),S.submit=m,S.submit(),S.submit=O}}catch{}}u.finishInit=function(L){L.save=h,L.getTextArea=function(){return a},L.toTextArea=function(){L.toTextArea=isNaN,h(),a.parentNode.removeChild(L.getWrapperElement()),a.style.display="",a.form&&(Ut(a.form,"submit",h),!u.leaveSubmitMethodAlone&&typeof a.form.submit=="function"&&(a.form.submit=m))}},a.style.display="none";var A=yn(function(L){return a.parentNode.insertBefore(L,a.nextSibling)},u);return A}function jE(a){a.off=Ut,a.on=lt,a.wheelEventPixels=VS,a.Doc=gr,a.splitLines=En,a.countColumn=Ie,a.findColumn=rn,a.isWordChar=ue,a.Pass=Nt,a.signal=Pt,a.Line=ua,a.changeEnd=co,a.scrollbarModel=ev,a.Pos=pe,a.cmpPos=be,a.modes=jr,a.mimeModes=Fn,a.resolveMode=Nr,a.getMode=Xr,a.modeExtensions=Mr,a.extendMode=Hr,a.copyState=q,a.startState=ze,a.innerMode=ge,a.commands=Ws,a.keyMap=Ki,a.keyName=$v,a.isModifierKey=jv,a.lookupKey=wa,a.normalizeKeyMap=hE,a.StringStream=Ze,a.SharedTextMarker=$s,a.TextMarker=ho,a.LineWidget=Hs,a.e_preventDefault=ht,a.e_stopPropagation=_t,a.e_stop=zt,a.addClass=ye,a.contains=he,a.rmClass=Q,a.keyNames=po}ME(yn),LE(yn);var HE="iter insert remove copy getEditor constructor".split(" ");for(var wu in gr.prototype)gr.prototype.hasOwnProperty(wu)&&$e(HE,wu)<0&&(yn.prototype[wu]=function(a){return function(){return a.apply(this.doc,arguments)}}(gr.prototype[wu]));return qe(gr),yn.inputStyles={textarea:On,contenteditable:an},yn.defineMode=function(a){!yn.defaults.mode&&a!="null"&&(yn.defaults.mode=a),ir.apply(this,arguments)},yn.defineMIME=or,yn.defineMode("null",function(){return{token:function(a){return a.skipToEnd()}}}),yn.defineMIME("text/plain","null"),yn.defineExtension=function(a,u){yn.prototype[a]=u},yn.defineDocExtension=function(a,u){gr.prototype[a]=u},yn.fromTextArea=BE,jE(yn),yn.version="5.65.19",yn})}(Yu)),Yu.exports}var hg;function gM(){return hg||(hg=1,function(r,e){(function(t){t(ko())})(function(t){t.defineMode("javascript",function(n,i){var o=n.indentUnit,s=i.statementIndent,l=i.jsonld,d=i.json||l,c=i.trackScope!==!1,f=i.typescript,v=i.wordCharacters||/[\w$\xa1-\uffff]/,g=function(){function M(ct){return{type:ct,style:"keyword"}}var U=M("keyword a"),de=M("keyword b"),Ee=M("keyword c"),pe=M("keyword d"),be=M("operator"),Je={type:"atom",style:"atom"};return{if:M("if"),while:U,with:U,else:de,do:de,try:de,finally:de,return:pe,break:pe,continue:pe,new:M("new"),delete:Ee,void:Ee,throw:Ee,debugger:M("debugger"),var:M("var"),const:M("var"),let:M("var"),function:M("function"),catch:M("catch"),for:M("for"),switch:M("switch"),case:M("case"),default:M("default"),in:be,typeof:be,instanceof:be,true:Je,false:Je,null:Je,undefined:Je,NaN:Je,Infinity:Je,this:M("this"),class:M("class"),super:M("atom"),yield:Ee,export:M("export"),import:M("import"),extends:Ee,await:Ee}}(),y=/[+\-*&%=<>!?|~^@]/,b=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function _(M){for(var U=!1,de,Ee=!1;(de=M.next())!=null;){if(!U){if(de=="/"&&!Ee)return;de=="["?Ee=!0:Ee&&de=="]"&&(Ee=!1)}U=!U&&de=="\\"}}var x,w;function C(M,U,de){return x=M,w=de,U}function k(M,U){var de=M.next();if(de=='"'||de=="'")return U.tokenize=D(de),U.tokenize(M,U);if(de=="."&&M.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return C("number","number");if(de=="."&&M.match(".."))return C("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(de))return C(de);if(de=="="&&M.eat(">"))return C("=>","operator");if(de=="0"&&M.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return C("number","number");if(/\d/.test(de))return M.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),C("number","number");if(de=="/")return M.eat("*")?(U.tokenize=I,I(M,U)):M.eat("/")?(M.skipToEnd(),C("comment","comment")):K(M,U,1)?(_(M),M.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),C("regexp","string-2")):(M.eat("="),C("operator","operator",M.current()));if(de=="`")return U.tokenize=$,$(M,U);if(de=="#"&&M.peek()=="!")return M.skipToEnd(),C("meta","meta");if(de=="#"&&M.eatWhile(v))return C("variable","property");if(de=="<"&&M.match("!--")||de=="-"&&M.match("->")&&!/\S/.test(M.string.slice(0,M.start)))return M.skipToEnd(),C("comment","comment");if(y.test(de))return(de!=">"||!U.lexical||U.lexical.type!=">")&&(M.eat("=")?(de=="!"||de=="=")&&M.eat("="):/[<>*+\-|&?]/.test(de)&&(M.eat(de),de==">"&&M.eat(de))),de=="?"&&M.eat(".")?C("."):C("operator","operator",M.current());if(v.test(de)){M.eatWhile(v);var Ee=M.current();if(U.lastType!="."){if(g.propertyIsEnumerable(Ee)){var pe=g[Ee];return C(pe.type,pe.style,Ee)}if(Ee=="async"&&M.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return C("async","keyword",Ee)}return C("variable","variable",Ee)}}function D(M){return function(U,de){var Ee=!1,pe;if(l&&U.peek()=="@"&&U.match(b))return de.tokenize=k,C("jsonld-keyword","meta");for(;(pe=U.next())!=null&&!(pe==M&&!Ee);)Ee=!Ee&&pe=="\\";return Ee||(de.tokenize=k),C("string","string")}}function I(M,U){for(var de=!1,Ee;Ee=M.next();){if(Ee=="/"&&de){U.tokenize=k;break}de=Ee=="*"}return C("comment","comment")}function $(M,U){for(var de=!1,Ee;(Ee=M.next())!=null;){if(!de&&(Ee=="`"||Ee=="$"&&M.eat("{"))){U.tokenize=k;break}de=!de&&Ee=="\\"}return C("quasi","string-2",M.current())}var R="([{}])";function F(M,U){U.fatArrowAt&&(U.fatArrowAt=null);var de=M.string.indexOf("=>",M.start);if(!(de<0)){if(f){var Ee=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(M.string.slice(M.start,de));Ee&&(de=Ee.index)}for(var pe=0,be=!1,Je=de-1;Je>=0;--Je){var ct=M.string.charAt(Je),Ot=R.indexOf(ct);if(Ot>=0&&Ot<3){if(!pe){++Je;break}if(--pe==0){ct=="("&&(be=!0);break}}else if(Ot>=3&&Ot<6)++pe;else if(v.test(ct))be=!0;else if(/["'\/`]/.test(ct))for(;;--Je){if(Je==0)return;var Cn=M.string.charAt(Je-1);if(Cn==ct&&M.string.charAt(Je-2)!="\\"){Je--;break}}else if(be&&!pe){++Je;break}}be&&!pe&&(U.fatArrowAt=Je)}}var z={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function ie(M,U,de,Ee,pe,be){this.indented=M,this.column=U,this.type=de,this.prev=pe,this.info=be,Ee!=null&&(this.align=Ee)}function G(M,U){if(!c)return!1;for(var de=M.localVars;de;de=de.next)if(de.name==U)return!0;for(var Ee=M.context;Ee;Ee=Ee.prev)for(var de=Ee.vars;de;de=de.next)if(de.name==U)return!0}function Q(M,U,de,Ee,pe){var be=M.cc;for(T.state=M,T.stream=pe,T.marked=null,T.cc=be,T.style=U,M.lexical.hasOwnProperty("align")||(M.lexical.align=!0);;){var Je=be.length?be.pop():d?$e:Ie;if(Je(de,Ee)){for(;be.length&&be[be.length-1].lex;)be.pop()();return T.marked?T.marked:de=="variable"&&G(M,Ee)?"variable-2":U}}}var T={state:null,marked:null,cc:null};function W(){for(var M=arguments.length-1;M>=0;M--)T.cc.push(arguments[M])}function P(){return W.apply(null,arguments),!0}function le(M,U){for(var de=U;de;de=de.next)if(de.name==M)return!0;return!1}function me(M){var U=T.state;if(T.marked="def",!!c){if(U.context){if(U.lexical.info=="var"&&U.context&&U.context.block){var de=he(M,U.context);if(de!=null){U.context=de;return}}else if(!le(M,U.localVars)){U.localVars=new ae(M,U.localVars);return}}i.globalVars&&!le(M,U.globalVars)&&(U.globalVars=new ae(M,U.globalVars))}}function he(M,U){if(U)if(U.block){var de=he(M,U.prev);return de?de==U.prev?U:new ye(de,U.vars,!0):null}else return le(M,U.vars)?U:new ye(U.prev,new ae(M,U.vars),!1);else return null}function Ne(M){return M=="public"||M=="private"||M=="protected"||M=="abstract"||M=="readonly"}function ye(M,U,de){this.prev=M,this.vars=U,this.block=de}function ae(M,U){this.name=M,this.next=U}var Re=new ae("this",new ae("arguments",null));function Le(){T.state.context=new ye(T.state.context,T.state.localVars,!1),T.state.localVars=Re}function Ve(){T.state.context=new ye(T.state.context,T.state.localVars,!0),T.state.localVars=null}Le.lex=Ve.lex=!0;function Ae(){T.state.localVars=T.state.context.vars,T.state.context=T.state.context.prev}Ae.lex=!0;function te(M,U){var de=function(){var Ee=T.state,pe=Ee.indented;if(Ee.lexical.type=="stat")pe=Ee.lexical.indented;else for(var be=Ee.lexical;be&&be.type==")"&&be.align;be=be.prev)pe=be.indented;Ee.lexical=new ie(pe,T.stream.column(),M,null,Ee.lexical,U)};return de.lex=!0,de}function ce(){var M=T.state;M.lexical.prev&&(M.lexical.type==")"&&(M.indented=M.lexical.indented),M.lexical=M.lexical.prev)}ce.lex=!0;function _e(M){function U(de){return de==M?P():M==";"||de=="}"||de==")"||de=="]"?W():P(U)}return U}function Ie(M,U){return M=="var"?P(te("vardef",U),_t,_e(";"),ce):M=="keyword a"?P(te("form"),Nt,Ie,ce):M=="keyword b"?P(te("form"),Ie,ce):M=="keyword d"?T.stream.match(/^\s*$/,!1)?P():P(te("stat"),Bt,_e(";"),ce):M=="debugger"?P(_e(";")):M=="{"?P(te("}"),Ve,ut,ce,Ae):M==";"?P():M=="if"?(T.state.lexical.info=="else"&&T.state.cc[T.state.cc.length-1]==ce&&T.state.cc.pop()(),P(te("form"),Nt,Ie,ce,Ur)):M=="function"?P(En):M=="for"?P(te("form"),Ve,Vr,Ie,Ae,ce):M=="class"||f&&U=="interface"?(T.marked="keyword",P(te("form",M=="class"?M:U),jr,ce)):M=="variable"?f&&U=="declare"?(T.marked="keyword",P(Ie)):f&&(U=="module"||U=="enum"||U=="type")&&T.stream.match(/^\s*\w/,!1)?(T.marked="keyword",U=="enum"?P(We):U=="type"?P(ai,_e("operator"),et,_e(";")):P(te("form"),$t,_e("{"),te("}"),ut,ce,ce)):f&&U=="namespace"?(T.marked="keyword",P(te("form"),$e,Ie,ce)):f&&U=="abstract"?(T.marked="keyword",P(Ie)):P(te("stat"),ne):M=="switch"?P(te("form"),Nt,_e("{"),te("}","switch"),Ve,ut,ce,ce,Ae):M=="case"?P($e,_e(":")):M=="default"?P(_e(":")):M=="catch"?P(te("form"),Le,Ke,Ie,ce,Ae):M=="export"?P(te("stat"),Nr,ce):M=="import"?P(te("stat"),Mr,ce):M=="async"?P(Ie):U=="@"?P($e,Ie):W(te("stat"),$e,_e(";"),ce)}function Ke(M){if(M=="(")return P(Et,_e(")"))}function $e(M,U){return ot(M,U,!1)}function Ue(M,U){return ot(M,U,!0)}function Nt(M){return M!="("?W():P(te(")"),Bt,_e(")"),ce)}function ot(M,U,de){if(T.state.fatArrowAt==T.stream.start){var Ee=de?H:N;if(M=="(")return P(Le,te(")"),Ge(Et,")"),ce,_e("=>"),Ee,Ae);if(M=="variable")return W(Le,$t,_e("=>"),Ee,Ae)}var pe=de?rn:bt;return z.hasOwnProperty(M)?P(pe):M=="function"?P(En,pe):M=="class"||f&&U=="interface"?(T.marked="keyword",P(te("form"),Ni,ce)):M=="keyword c"||M=="async"?P(de?Ue:$e):M=="("?P(te(")"),Bt,_e(")"),ce,pe):M=="operator"||M=="spread"?P(de?Ue:$e):M=="["?P(te("]"),Ze,ce,pe):M=="{"?at(we,"}",null,pe):M=="quasi"?W(ln,pe):M=="new"?P(J(de)):P()}function Bt(M){return M.match(/[;\}\)\],]/)?W():W($e)}function bt(M,U){return M==","?P(Bt):rn(M,U,!1)}function rn(M,U,de){var Ee=de==!1?bt:rn,pe=de==!1?$e:Ue;if(M=="=>")return P(Le,de?H:N,Ae);if(M=="operator")return/\+\+|--/.test(U)||f&&U=="!"?P(Ee):f&&U=="<"&&T.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?P(te(">"),Ge(et,">"),ce,Ee):U=="?"?P($e,_e(":"),pe):P(pe);if(M=="quasi")return W(ln,Ee);if(M!=";"){if(M=="(")return at(Ue,")","call",Ee);if(M==".")return P(ue,Ee);if(M=="[")return P(te("]"),Bt,_e("]"),ce,Ee);if(f&&U=="as")return T.marked="keyword",P(et,Ee);if(M=="regexp")return T.state.lastType=T.marked="operator",T.stream.backUp(T.stream.pos-T.stream.start-1),P(pe)}}function ln(M,U){return M!="quasi"?W():U.slice(U.length-2)!="${"?P(ln):P(Bt,Z)}function Z(M){if(M=="}")return T.marked="string-2",T.state.tokenize=$,P(ln)}function N(M){return F(T.stream,T.state),W(M=="{"?Ie:$e)}function H(M){return F(T.stream,T.state),W(M=="{"?Ie:Ue)}function J(M){return function(U){return U=="."?P(M?re:X):U=="variable"&&f?P(xe,M?rn:bt):W(M?Ue:$e)}}function X(M,U){if(U=="target")return T.marked="keyword",P(bt)}function re(M,U){if(U=="target")return T.marked="keyword",P(rn)}function ne(M){return M==":"?P(ce,Ie):W(bt,_e(";"),ce)}function ue(M){if(M=="variable")return T.marked="property",P()}function we(M,U){if(M=="async")return T.marked="property",P(we);if(M=="variable"||T.style=="keyword"){if(T.marked="property",U=="get"||U=="set")return P(Se);var de;return f&&T.state.fatArrowAt==T.stream.start&&(de=T.stream.match(/^\s*:\s*/,!1))&&(T.state.fatArrowAt=T.stream.pos+de[0].length),P(Pe)}else{if(M=="number"||M=="string")return T.marked=l?"property":T.style+" property",P(Pe);if(M=="jsonld-keyword")return P(Pe);if(f&&Ne(U))return T.marked="keyword",P(we);if(M=="[")return P($e,kt,_e("]"),Pe);if(M=="spread")return P(Ue,Pe);if(U=="*")return T.marked="keyword",P(we);if(M==":")return W(Pe)}}function Se(M){return M!="variable"?W(Pe):(T.marked="property",P(En))}function Pe(M){if(M==":")return P(Ue);if(M=="(")return W(En)}function Ge(M,U,de){function Ee(pe,be){if(de?de.indexOf(pe)>-1:pe==","){var Je=T.state.lexical;return Je.info=="call"&&(Je.pos=(Je.pos||0)+1),P(function(ct,Ot){return ct==U||Ot==U?W():W(M)},Ee)}return pe==U||be==U?P():de&&de.indexOf(";")>-1?W(M):P(_e(U))}return function(pe,be){return pe==U||be==U?P():W(M,Ee)}}function at(M,U,de){for(var Ee=3;Ee<arguments.length;Ee++)T.cc.push(arguments[Ee]);return P(te(U,de),Ge(M,U),ce)}function ut(M){return M=="}"?P():W(Ie,ut)}function kt(M,U){if(f){if(M==":")return P(et);if(U=="?")return P(kt)}}function Xe(M,U){if(f&&(M==":"||U=="in"))return P(et)}function rt(M){if(f&&M==":")return T.stream.match(/^\s*\w+\s+is\b/,!1)?P($e,Tt,et):P(et)}function Tt(M,U){if(U=="is")return T.marked="keyword",P()}function et(M,U){if(U=="keyof"||U=="typeof"||U=="infer"||U=="readonly")return T.marked="keyword",P(U=="typeof"?Ue:et);if(M=="variable"||U=="void")return T.marked="type",P(Jt);if(U=="|"||U=="&")return P(et);if(M=="string"||M=="number"||M=="atom")return P(Jt);if(M=="[")return P(te("]"),Ge(et,"]",","),ce,Jt);if(M=="{")return P(te("}"),lt,ce,Jt);if(M=="(")return P(Ge(Rt,")"),cn,Jt);if(M=="<")return P(Ge(et,">"),et);if(M=="quasi")return W(Ut,Jt)}function cn(M){if(M=="=>")return P(et)}function lt(M){return M.match(/[\}\)\]]/)?P():M==","||M==";"?P(lt):W(fn,lt)}function fn(M,U){if(M=="variable"||T.style=="keyword")return T.marked="property",P(fn);if(U=="?"||M=="number"||M=="string")return P(fn);if(M==":")return P(et);if(M=="[")return P(_e("variable"),Xe,_e("]"),fn);if(M=="(")return W(kr,fn);if(!M.match(/[;\}\)\],]/))return P()}function Ut(M,U){return M!="quasi"?W():U.slice(U.length-2)!="${"?P(Ut):P(et,Pt)}function Pt(M){if(M=="}")return T.marked="string-2",T.state.tokenize=$,P(Ut)}function Rt(M,U){return M=="variable"&&T.stream.match(/^\s*[?:]/,!1)||U=="?"?P(Rt):M==":"?P(et):M=="spread"?P(Rt):W(et)}function Jt(M,U){if(U=="<")return P(te(">"),Ge(et,">"),ce,Jt);if(U=="|"||M=="."||U=="&")return P(et);if(M=="[")return P(et,_e("]"),Jt);if(U=="extends"||U=="implements")return T.marked="keyword",P(et);if(U=="?")return P(et,_e(":"),et)}function xe(M,U){if(U=="<")return P(te(">"),Ge(et,">"),ce,Jt)}function qe(){return W(et,ht)}function ht(M,U){if(U=="=")return P(et)}function _t(M,U){return U=="enum"?(T.marked="keyword",P(We)):W($t,kt,gn,$n)}function $t(M,U){if(f&&Ne(U))return T.marked="keyword",P($t);if(M=="variable")return me(U),P();if(M=="spread")return P($t);if(M=="[")return at(Jn,"]");if(M=="{")return at(zt,"}")}function zt(M,U){return M=="variable"&&!T.stream.match(/^\s*:/,!1)?(me(U),P(gn)):(M=="variable"&&(T.marked="property"),M=="spread"?P($t):M=="}"?W():M=="["?P($e,_e("]"),_e(":"),zt):P(_e(":"),$t,gn))}function Jn(){return W($t,gn)}function gn(M,U){if(U=="=")return P(Ue)}function $n(M){if(M==",")return P(_t)}function Ur(M,U){if(M=="keyword b"&&U=="else")return P(te("form","else"),Ie,ce)}function Vr(M,U){if(U=="await")return P(Vr);if(M=="(")return P(te(")"),Gt,ce)}function Gt(M){return M=="var"?P(_t,Or):M=="variable"?P(Or):W(Or)}function Or(M,U){return M==")"?P():M==";"?P(Or):U=="in"||U=="of"?(T.marked="keyword",P($e,Or)):W($e,Or)}function En(M,U){if(U=="*")return T.marked="keyword",P(En);if(M=="variable")return me(U),P(En);if(M=="(")return P(Le,te(")"),Ge(Et,")"),ce,rt,Ie,Ae);if(f&&U=="<")return P(te(">"),Ge(qe,">"),ce,En)}function kr(M,U){if(U=="*")return T.marked="keyword",P(kr);if(M=="variable")return me(U),P(kr);if(M=="(")return P(Le,te(")"),Ge(Et,")"),ce,rt,Ae);if(f&&U=="<")return P(te(">"),Ge(qe,">"),ce,kr)}function ai(M,U){if(M=="keyword"||M=="variable")return T.marked="type",P(ai);if(U=="<")return P(te(">"),Ge(qe,">"),ce)}function Et(M,U){return U=="@"&&P($e,Et),M=="spread"?P(Et):f&&Ne(U)?(T.marked="keyword",P(Et)):f&&M=="this"?P(kt,gn):W($t,kt,gn)}function Ni(M,U){return M=="variable"?jr(M,U):Fn(M,U)}function jr(M,U){if(M=="variable")return me(U),P(Fn)}function Fn(M,U){if(U=="<")return P(te(">"),Ge(qe,">"),ce,Fn);if(U=="extends"||U=="implements"||f&&M==",")return U=="implements"&&(T.marked="keyword"),P(f?et:$e,Fn);if(M=="{")return P(te("}"),ir,ce)}function ir(M,U){if(M=="async"||M=="variable"&&(U=="static"||U=="get"||U=="set"||f&&Ne(U))&&T.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return T.marked="keyword",P(ir);if(M=="variable"||T.style=="keyword")return T.marked="property",P(or,ir);if(M=="number"||M=="string")return P(or,ir);if(M=="[")return P($e,kt,_e("]"),or,ir);if(U=="*")return T.marked="keyword",P(ir);if(f&&M=="(")return W(kr,ir);if(M==";"||M==",")return P(ir);if(M=="}")return P();if(U=="@")return P($e,ir)}function or(M,U){if(U=="!"||U=="?")return P(or);if(M==":")return P(et,gn);if(U=="=")return P(Ue);var de=T.state.lexical.prev,Ee=de&&de.info=="interface";return W(Ee?kr:En)}function Nr(M,U){return U=="*"?(T.marked="keyword",P(ze,_e(";"))):U=="default"?(T.marked="keyword",P($e,_e(";"))):M=="{"?P(Ge(Xr,"}"),ze,_e(";")):W(Ie)}function Xr(M,U){if(U=="as")return T.marked="keyword",P(_e("variable"));if(M=="variable")return W(Ue,Xr)}function Mr(M){return M=="string"?P():M=="("?W($e):M=="."?W(bt):W(Hr,q,ze)}function Hr(M,U){return M=="{"?at(Hr,"}"):(M=="variable"&&me(U),U=="*"&&(T.marked="keyword"),P(ge))}function q(M){if(M==",")return P(Hr,q)}function ge(M,U){if(U=="as")return T.marked="keyword",P(Hr)}function ze(M,U){if(U=="from")return T.marked="keyword",P($e)}function Ze(M){return M=="]"?P():W(Ge(Ue,"]"))}function We(){return W(te("form"),$t,_e("{"),te("}"),Ge(It,"}"),ce,ce)}function It(){return W($t,gn)}function pn(M,U){return M.lastType=="operator"||M.lastType==","||y.test(U.charAt(0))||/[,.]/.test(U.charAt(0))}function K(M,U,de){return U.tokenize==k&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(U.lastType)||U.lastType=="quasi"&&/\{\s*$/.test(M.string.slice(0,M.pos-(de||0)))}return{startState:function(M){var U={tokenize:k,lastType:"sof",cc:[],lexical:new ie((M||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new ye(null,null,!1),indented:M||0};return i.globalVars&&typeof i.globalVars=="object"&&(U.globalVars=i.globalVars),U},token:function(M,U){if(M.sol()&&(U.lexical.hasOwnProperty("align")||(U.lexical.align=!1),U.indented=M.indentation(),F(M,U)),U.tokenize!=I&&M.eatSpace())return null;var de=U.tokenize(M,U);return x=="comment"?de:(U.lastType=x=="operator"&&(w=="++"||w=="--")?"incdec":x,Q(U,de,x,w,M))},indent:function(M,U){if(M.tokenize==I||M.tokenize==$)return t.Pass;if(M.tokenize!=k)return 0;var de=U&&U.charAt(0),Ee=M.lexical,pe;if(!/^\s*else\b/.test(U))for(var be=M.cc.length-1;be>=0;--be){var Je=M.cc[be];if(Je==ce)Ee=Ee.prev;else if(Je!=Ur&&Je!=Ae)break}for(;(Ee.type=="stat"||Ee.type=="form")&&(de=="}"||(pe=M.cc[M.cc.length-1])&&(pe==bt||pe==rn)&&!/^[,\.=+\-*:?[\(]/.test(U));)Ee=Ee.prev;s&&Ee.type==")"&&Ee.prev.type=="stat"&&(Ee=Ee.prev);var ct=Ee.type,Ot=de==ct;return ct=="vardef"?Ee.indented+(M.lastType=="operator"||M.lastType==","?Ee.info.length+1:0):ct=="form"&&de=="{"?Ee.indented:ct=="form"?Ee.indented+o:ct=="stat"?Ee.indented+(pn(M,U)?s||o:0):Ee.info=="switch"&&!Ot&&i.doubleIndentSwitch!=!1?Ee.indented+(/^(?:case|default)\b/.test(U)?o:2*o):Ee.align?Ee.column+(Ot?0:1):Ee.indented+(Ot?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:d?null:"/*",blockCommentEnd:d?null:"*/",blockCommentContinue:d?null:" * ",lineComment:d?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:d?"json":"javascript",jsonldMode:l,jsonMode:d,expressionAllowed:K,skipExpression:function(M){Q(M,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),cg.exports}gM();var pg={exports:{}},vg;function Jx(){return vg||(vg=1,function(r,e){(function(t){t(ko())})(function(t){function n(l,d,c,f){if(c&&c.call){var v=c;c=null}else var v=s(l,c,"rangeFinder");typeof d=="number"&&(d=t.Pos(d,0));var g=s(l,c,"minFoldSize");function y(w){var C=v(l,d);if(!C||C.to.line-C.from.line<g)return null;if(f==="fold")return C;for(var k=l.findMarksAt(C.from),D=0;D<k.length;++D)if(k[D].__isFold){if(!w)return null;C.cleared=!0,k[D].clear()}return C}var b=y(!0);if(s(l,c,"scanUp"))for(;!b&&d.line>l.firstLine();)d=t.Pos(d.line-1,0),b=y(!1);if(!(!b||b.cleared||f==="unfold")){var _=i(l,c,b);t.on(_,"mousedown",function(w){x.clear(),t.e_preventDefault(w)});var x=l.markText(b.from,b.to,{replacedWith:_,clearOnEnter:s(l,c,"clearOnEnter"),__isFold:!0});x.on("clear",function(w,C){t.signal(l,"unfold",l,w,C)}),t.signal(l,"fold",l,b.from,b.to)}}function i(l,d,c){var f=s(l,d,"widget");if(typeof f=="function"&&(f=f(c.from,c.to)),typeof f=="string"){var v=document.createTextNode(f);f=document.createElement("span"),f.appendChild(v),f.className="CodeMirror-foldmarker"}else f&&(f=f.cloneNode(!0));return f}t.newFoldFunction=function(l,d){return function(c,f){n(c,f,{rangeFinder:l,widget:d})}},t.defineExtension("foldCode",function(l,d,c){n(this,l,d,c)}),t.defineExtension("isFolded",function(l){for(var d=this.findMarksAt(l),c=0;c<d.length;++c)if(d[c].__isFold)return!0}),t.commands.toggleFold=function(l){l.foldCode(l.getCursor())},t.commands.fold=function(l){l.foldCode(l.getCursor(),null,"fold")},t.commands.unfold=function(l){l.foldCode(l.getCursor(),{scanUp:!1},"unfold")},t.commands.foldAll=function(l){l.operation(function(){for(var d=l.firstLine(),c=l.lastLine();d<=c;d++)l.foldCode(t.Pos(d,0),{scanUp:!1},"fold")})},t.commands.unfoldAll=function(l){l.operation(function(){for(var d=l.firstLine(),c=l.lastLine();d<=c;d++)l.foldCode(t.Pos(d,0),{scanUp:!1},"unfold")})},t.registerHelper("fold","combine",function(){var l=Array.prototype.slice.call(arguments,0);return function(d,c){for(var f=0;f<l.length;++f){var v=l[f](d,c);if(v)return v}}}),t.registerHelper("fold","auto",function(l,d){for(var c=l.getHelpers(d,"fold"),f=0;f<c.length;f++){var v=c[f](l,d);if(v)return v}});var o={rangeFinder:t.fold.auto,widget:"↔",minFoldSize:0,scanUp:!1,clearOnEnter:!0};t.defineOption("foldOptions",null);function s(l,d,c){if(d&&d[c]!==void 0)return d[c];var f=l.options.foldOptions;return f&&f[c]!==void 0?f[c]:o[c]}t.defineExtension("foldOption",function(l,d){return s(this,l,d)})})}()),pg.exports}Jx();var gg={exports:{}},mg;function mM(){return mg||(mg=1,function(r,e){(function(t){t(ko(),Jx())})(function(t){t.defineOption("foldGutter",!1,function(x,w,C){C&&C!=t.Init&&(x.clearGutter(x.state.foldGutter.options.gutter),x.state.foldGutter=null,x.off("gutterClick",v),x.off("changes",y),x.off("viewportChange",b),x.off("fold",_),x.off("unfold",_),x.off("swapDoc",y),x.off("optionChange",g)),w&&(x.state.foldGutter=new i(o(w)),f(x),x.on("gutterClick",v),x.on("changes",y),x.on("viewportChange",b),x.on("fold",_),x.on("unfold",_),x.on("swapDoc",y),x.on("optionChange",g))});var n=t.Pos;function i(x){this.options=x,this.from=this.to=0}function o(x){return x===!0&&(x={}),x.gutter==null&&(x.gutter="CodeMirror-foldgutter"),x.indicatorOpen==null&&(x.indicatorOpen="CodeMirror-foldgutter-open"),x.indicatorFolded==null&&(x.indicatorFolded="CodeMirror-foldgutter-folded"),x}function s(x,w){for(var C=x.findMarks(n(w,0),n(w+1,0)),k=0;k<C.length;++k)if(C[k].__isFold){var D=C[k].find(-1);if(D&&D.line===w)return C[k]}}function l(x){if(typeof x=="string"){var w=document.createElement("div");return w.className=x+" CodeMirror-guttermarker-subtle",w}else return x.cloneNode(!0)}function d(x,w,C){var k=x.state.foldGutter.options,D=w-1,I=x.foldOption(k,"minFoldSize"),$=x.foldOption(k,"rangeFinder"),R=typeof k.indicatorFolded=="string"&&c(k.indicatorFolded),F=typeof k.indicatorOpen=="string"&&c(k.indicatorOpen);x.eachLine(w,C,function(z){++D;var ie=null,G=z.gutterMarkers;if(G&&(G=G[k.gutter]),s(x,D)){if(R&&G&&R.test(G.className))return;ie=l(k.indicatorFolded)}else{var Q=n(D,0),T=$&&$(x,Q);if(T&&T.to.line-T.from.line>=I){if(F&&G&&F.test(G.className))return;ie=l(k.indicatorOpen)}}!ie&&!G||x.setGutterMarker(z,k.gutter,ie)})}function c(x){return new RegExp("(^|\\s)"+x+"(?:$|\\s)\\s*")}function f(x){var w=x.getViewport(),C=x.state.foldGutter;C&&(x.operation(function(){d(x,w.from,w.to)}),C.from=w.from,C.to=w.to)}function v(x,w,C){var k=x.state.foldGutter;if(k){var D=k.options;if(C==D.gutter){var I=s(x,w);I?I.clear():x.foldCode(n(w,0),D)}}}function g(x,w){w=="mode"&&y(x)}function y(x){var w=x.state.foldGutter;if(w){var C=w.options;w.from=w.to=0,clearTimeout(w.changeUpdate),w.changeUpdate=setTimeout(function(){f(x)},C.foldOnChangeTimeSpan||600)}}function b(x){var w=x.state.foldGutter;if(w){var C=w.options;clearTimeout(w.changeUpdate),w.changeUpdate=setTimeout(function(){var k=x.getViewport();w.from==w.to||k.from-w.to>20||w.from-k.to>20?f(x):x.operation(function(){k.from<w.from&&(d(x,k.from,w.from),w.from=k.from),k.to>w.to&&(d(x,w.to,k.to),w.to=k.to)})},C.updateViewportTimeSpan||400)}}function _(x,w){var C=x.state.foldGutter;if(C){var k=w.line;k>=C.from&&k<C.to&&d(x,k,k+1)}}})}()),gg.exports}mM();var yg={exports:{}},_g;function yM(){return _g||(_g=1,function(r,e){(function(t){t(ko())})(function(t){function n(i){return function(o,s){var l=s.line,d=o.getLine(l);function c(_){for(var x,w=s.ch,C=0;;){var k=w<=0?-1:d.lastIndexOf(_[0],w-1);if(k==-1){if(C==1)break;C=1,w=d.length;continue}if(C==1&&k<s.ch)break;if(x=o.getTokenTypeAt(t.Pos(l,k+1)),!/^(comment|string)/.test(x))return{ch:k+1,tokenType:x,pair:_};w=k-1}}function f(_){var x=1,w=o.lastLine(),C,k=_.ch,D;e:for(var I=l;I<=w;++I)for(var $=o.getLine(I),R=I==l?k:0;;){var F=$.indexOf(_.pair[0],R),z=$.indexOf(_.pair[1],R);if(F<0&&(F=$.length),z<0&&(z=$.length),R=Math.min(F,z),R==$.length)break;if(o.getTokenTypeAt(t.Pos(I,R+1))==_.tokenType){if(R==F)++x;else if(!--x){C=I,D=R;break e}}++R}return C==null||l==C?null:{from:t.Pos(l,k),to:t.Pos(C,D)}}for(var v=[],g=0;g<i.length;g++){var y=c(i[g]);y&&v.push(y)}v.sort(function(_,x){return _.ch-x.ch});for(var g=0;g<v.length;g++){var b=f(v[g]);if(b)return b}return null}}t.registerHelper("fold","brace",n([["{","}"],["[","]"]])),t.registerHelper("fold","brace-paren",n([["{","}"],["[","]"],["(",")"]])),t.registerHelper("fold","import",function(i,o){function s(g){if(g<i.firstLine()||g>i.lastLine())return null;var y=i.getTokenAt(t.Pos(g,1));if(/\S/.test(y.string)||(y=i.getTokenAt(t.Pos(g,y.end+1))),y.type!="keyword"||y.string!="import")return null;for(var b=g,_=Math.min(i.lastLine(),g+10);b<=_;++b){var x=i.getLine(b),w=x.indexOf(";");if(w!=-1)return{startCh:y.end,end:t.Pos(b,w)}}}var l=o.line,d=s(l),c;if(!d||s(l-1)||(c=s(l-2))&&c.end.line==l-1)return null;for(var f=d.end;;){var v=s(f.line+1);if(v==null)break;f=v.end}return{from:i.clipPos(t.Pos(l,d.startCh+1)),to:f}}),t.registerHelper("fold","include",function(i,o){function s(v){if(v<i.firstLine()||v>i.lastLine())return null;var g=i.getTokenAt(t.Pos(v,1));if(/\S/.test(g.string)||(g=i.getTokenAt(t.Pos(v,g.end+1))),g.type=="meta"&&g.string.slice(0,8)=="#include")return g.start+8}var l=o.line,d=s(l);if(d==null||s(l-1)!=null)return null;for(var c=l;;){var f=s(c+1);if(f==null)break;++c}return{from:t.Pos(l,d+1),to:i.clipPos(t.Pos(c))}})})}()),yg.exports}yM();var bg={exports:{}},xg;function _M(){return xg||(xg=1,function(r,e){(function(t){t(ko())})(function(t){var n="CodeMirror-activeline",i="CodeMirror-activeline-background",o="CodeMirror-activeline-gutter";t.defineOption("styleActiveLine",!1,function(f,v,g){var y=g==t.Init?!1:g;v!=y&&(y&&(f.off("beforeSelectionChange",c),s(f),delete f.state.activeLines),v&&(f.state.activeLines=[],d(f,f.listSelections()),f.on("beforeSelectionChange",c)))});function s(f){for(var v=0;v<f.state.activeLines.length;v++)f.removeLineClass(f.state.activeLines[v],"wrap",n),f.removeLineClass(f.state.activeLines[v],"background",i),f.removeLineClass(f.state.activeLines[v],"gutter",o)}function l(f,v){if(f.length!=v.length)return!1;for(var g=0;g<f.length;g++)if(f[g]!=v[g])return!1;return!0}function d(f,v){for(var g=[],y=0;y<v.length;y++){var b=v[y],_=f.getOption("styleActiveLine");if(!(typeof _=="object"&&_.nonEmpty?b.anchor.line!=b.head.line:!b.empty())){var x=f.getLineHandleVisualStart(b.head.line);g[g.length-1]!=x&&g.push(x)}}l(f.state.activeLines,g)||f.operation(function(){s(f);for(var w=0;w<g.length;w++)f.addLineClass(g[w],"wrap",n),f.addLineClass(g[w],"background",i),f.addLineClass(g[w],"gutter",o);f.state.activeLines=g})}function c(f,v){d(f,v.ranges)}})}()),bg.exports}_M();var bM=ko();const Zx=ls(bM);var wg={exports:{}},Sg;function xM(){return Sg||(Sg=1,function(r,e){(function(t){t(ko())})(function(t){var n=t.Pos,i="http://www.w3.org/2000/svg";function o(N,H){this.mv=N,this.type=H,this.classes=H=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}o.prototype={constructor:o,init:function(N,H,J){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=t(N,_e({value:H,readOnly:!this.mv.options.allowEditingOriginals},_e(J))),this.mv.options.connect=="align"&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new Nt(this.edit)),this.orig.state.trackAlignable=new Nt(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.lockButton.setAttribute("aria-label",this.lockButton.title),this.orig.state.diffViews=[this];var X=J.chunkClassLocation||"background";Object.prototype.toString.call(X)!="[object Array]"&&(X=[X]),this.classes.classLocation=X,this.diff=le(W(H),W(J.value),this.mv.options.ignoreWhitespace),this.chunks=me(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=J.showDifferences!==!1},registerEvents:function(N){this.forceUpdate=d(this),g(this,!0,!1),c(this,N)},setShowDifferences:function(N){N=N!==!1,N!=this.showDifferences&&(this.showDifferences=N,this.forceUpdate("full"))}};function s(N){N.diffOutOfDate&&(N.diff=le(N.orig.getValue(),N.edit.getValue(),N.mv.options.ignoreWhitespace),N.chunks=me(N.diff),N.diffOutOfDate=!1,t.signal(N.edit,"updateDiff",N.diff))}var l=!1;function d(N){var H={from:0,to:0,marked:[]},J={from:0,to:0,marked:[]},X,re=!1;function ne(Ge){l=!0,re=!1,Ge=="full"&&(N.svg&&te(N.svg),N.copyButtons&&te(N.copyButtons),b(N.edit,H.marked,N.classes),b(N.orig,J.marked,N.classes),H.from=H.to=J.from=J.to=0),s(N),N.showDifferences&&(_(N.edit,N.diff,H,DIFF_INSERT,N.classes),_(N.orig,N.diff,J,DIFF_DELETE,N.classes)),N.mv.options.connect=="align"&&R(N),C(N),N.needsScrollSync!=null&&f(N,N.needsScrollSync),l=!1}function ue(Ge){l||(N.dealigned=!0,we(Ge))}function we(Ge){l||re||(clearTimeout(X),Ge===!0&&(re=!0),X=setTimeout(ne,Ge===!0?20:250))}function Se(Ge,at){N.diffOutOfDate||(N.diffOutOfDate=!0,H.from=H.to=J.from=J.to=0),ue(at.text.length-1!=at.to.line-at.from.line)}function Pe(){N.diffOutOfDate=!0,N.dealigned=!0,ne("full")}return N.edit.on("change",Se),N.orig.on("change",Se),N.edit.on("swapDoc",Pe),N.orig.on("swapDoc",Pe),N.mv.options.connect=="align"&&(t.on(N.edit.state.trackAlignable,"realign",ue),t.on(N.orig.state.trackAlignable,"realign",ue)),N.edit.on("viewportChange",function(){we(!1)}),N.orig.on("viewportChange",function(){we(!1)}),ne(),ne}function c(N,H){N.edit.on("scroll",function(){f(N,!0)&&C(N)}),N.orig.on("scroll",function(){f(N,!1)&&C(N),H&&f(H,!0)&&C(H)})}function f(N,H){if(N.diffOutOfDate)return N.lockScroll&&N.needsScrollSync==null&&(N.needsScrollSync=H),!1;if(N.needsScrollSync=null,!N.lockScroll)return!0;var J,X,re=+new Date;if(H?(J=N.edit,X=N.orig):(J=N.orig,X=N.edit),J.state.scrollSetBy==N&&(J.state.scrollSetAt||0)+250>re)return!1;var ne=J.getScrollInfo();if(N.mv.options.connect=="align")kt=ne.top;else{var ue=.5*ne.clientHeight,we=ne.top+ue,Se=J.lineAtHeight(we,"local"),Pe=ye(N.chunks,Se,H),Ge=v(J,H?Pe.edit:Pe.orig),at=v(X,H?Pe.orig:Pe.edit),ut=(we-Ge.top)/(Ge.bot-Ge.top),kt=at.top-ue+ut*(at.bot-at.top),Xe,rt;if(kt>ne.top&&(rt=ne.top/ue)<1)kt=kt*rt+ne.top*(1-rt);else if((Xe=ne.height-ne.clientHeight-ne.top)<ue){var Tt=X.getScrollInfo(),et=Tt.height-Tt.clientHeight-kt;et>Xe&&(rt=Xe/ue)<1&&(kt=kt*rt+(Tt.height-Tt.clientHeight-Xe)*(1-rt))}}return X.scrollTo(ne.left,kt),X.state.scrollSetAt=re,X.state.scrollSetBy=N,!0}function v(N,H){var J=H.after;return J==null&&(J=N.lastLine()+1),{top:N.heightAtLine(H.before||0,"local"),bot:N.heightAtLine(J,"local")}}function g(N,H,J){N.lockScroll=H,H&&J!=!1&&f(N,DIFF_INSERT)&&C(N),(H?t.addClass:t.rmClass)(N.lockButton,"CodeMirror-merge-scrolllock-enabled")}function y(N,H,J){for(var X=J.classLocation,re=0;re<X.length;re++)N.removeLineClass(H,X[re],J.chunk),N.removeLineClass(H,X[re],J.start),N.removeLineClass(H,X[re],J.end)}function b(N,H,J){for(var X=0;X<H.length;++X){var re=H[X];re instanceof t.TextMarker?re.clear():re.parent&&y(N,re,J)}H.length=0}function _(N,H,J,X,re){var ne=N.getViewport();N.operation(function(){J.from==J.to||ne.from-J.to>20||J.from-ne.to>20?(b(N,J.marked,re),w(N,H,X,J.marked,ne.from,ne.to,re),J.from=ne.from,J.to=ne.to):(ne.from<J.from&&(w(N,H,X,J.marked,ne.from,J.from,re),J.from=ne.from),ne.to>J.to&&(w(N,H,X,J.marked,J.to,ne.to,re),J.to=ne.to))})}function x(N,H,J,X,re,ne){for(var ue=J.classLocation,we=N.getLineHandle(H),Se=0;Se<ue.length;Se++)X&&N.addLineClass(we,ue[Se],J.chunk),re&&N.addLineClass(we,ue[Se],J.start),ne&&N.addLineClass(we,ue[Se],J.end);return we}function w(N,H,J,X,re,ne,ue){var we=n(0,0),Se=n(re,0),Pe=N.clipPos(n(ne-1)),Ge=J==DIFF_DELETE?ue.del:ue.insert;function at(Rt,Jt){for(var xe=Math.max(re,Rt),qe=Math.min(ne,Jt),ht=xe;ht<qe;++ht)X.push(x(N,ht,ue,!0,ht==Rt,ht==Jt-1));Rt==Jt&&xe==Jt&&qe==Jt&&(xe?X.push(x(N,xe-1,ue,!1,!1,!0)):X.push(x(N,xe,ue,!1,!0,!1)))}for(var ut=0,kt=!1,Xe=0;Xe<H.length;++Xe){var rt=H[Xe],Tt=rt[0],et=rt[1];if(Tt==DIFF_EQUAL){var cn=we.line+(Ne(H,Xe)?0:1);Ie(we,et);var lt=we.line+(he(H,Xe)?1:0);lt>cn&&(kt&&(at(ut,cn),kt=!1),ut=lt)}else if(kt=!0,Tt==J){var fn=Ie(we,et,!0),Ut=Bt(Se,we),Pt=ot(Pe,fn);bt(Ut,Pt)||X.push(N.markText(Ut,Pt,{className:Ge})),we=fn}}kt&&at(ut,we.line+1)}function C(N){if(N.showDifferences){if(N.svg){te(N.svg);var H=N.gap.offsetWidth;ce(N.svg,"width",H,"height",N.gap.offsetHeight)}N.copyButtons&&te(N.copyButtons);for(var J=N.edit.getViewport(),X=N.orig.getViewport(),re=N.mv.wrap.getBoundingClientRect().top,ne=re-N.edit.getScrollerElement().getBoundingClientRect().top+N.edit.getScrollInfo().top,ue=re-N.orig.getScrollerElement().getBoundingClientRect().top+N.orig.getScrollInfo().top,we=0;we<N.chunks.length;we++){var Se=N.chunks[we];Se.editFrom<=J.to&&Se.editTo>=J.from&&Se.origFrom<=X.to&&Se.origTo>=X.from&&ie(N,Se,ue,ne,H)}}}function k(N,H){for(var J=0,X=0,re=0;re<H.length;re++){var ne=H[re];if(ne.editTo>N&&ne.editFrom<=N)return null;if(ne.editFrom>N)break;J=ne.editTo,X=ne.origTo}return X+(N-J)}function D(N,H,J){for(var X=N.state.trackAlignable,re=N.firstLine(),ne=0,ue=[],we=0;;we++){for(var Se=H[we],Pe=Se?J?Se.origFrom:Se.editFrom:1e9;ne<X.alignable.length;ne+=2){var Ge=X.alignable[ne]+1;if(!(Ge<=re))if(Ge<=Pe)ue.push(Ge);else break}if(!Se)break;ue.push(re=J?Se.origTo:Se.editTo)}return ue}function I(N,H,J,X){var re=0,ne=0,ue=0,we=0;e:for(;;re++){var Se=N[re],Pe=H[ne];if(!Se&&Pe==null)break;for(var Ge=Se?Se[0]:1e9,at=Pe??1e9;ue<J.length;){var ut=J[ue];if(ut.origFrom<=at&&ut.origTo>at){ne++,re--;continue e}if(ut.editTo>Ge){if(ut.editFrom<=Ge)continue e;break}we+=ut.origTo-ut.origFrom-(ut.editTo-ut.editFrom),ue++}if(Ge==at-we)Se[X]=at,ne++;else if(Ge<at-we)Se[X]=Ge+we;else{var kt=[at-we,null,null];kt[X]=at,N.splice(re,0,kt),ne++}}}function $(N,H){var J=D(N.edit,N.chunks,!1),X=[];if(H)for(var re=0,ne=0;re<H.chunks.length;re++){for(var ue=H.chunks[re].editTo;ne<J.length&&J[ne]<ue;)ne++;(ne==J.length||J[ne]!=ue)&&J.splice(ne++,0,ue)}for(var re=0;re<J.length;re++)X.push([J[re],null,null]);return I(X,D(N.orig,N.chunks,!0),N.chunks,1),H&&I(X,D(H.orig,H.chunks,!0),H.chunks,2),X}function R(N,H){if(!(!N.dealigned&&!H)){if(!N.orig.curOp)return N.orig.operation(function(){R(N,H)});N.dealigned=!1;var J=N.mv.left==N?N.mv.right:N.mv.left;J&&(s(J),J.dealigned=!1);for(var X=$(N,J),re=N.mv.aligners,ne=0;ne<re.length;ne++)re[ne].clear();re.length=0;var ue=[N.edit,N.orig],we=[],Se=[];J&&ue.push(J.orig);for(var ne=0;ne<ue.length;ne++)we.push(ue[ne].getScrollInfo().top),Se.push(-ue[ne].getScrollerElement().getBoundingClientRect().top);(Se[0]!=Se[1]||ue.length==3&&Se[1]!=Se[2])&&F(ue,Se,[0,0,0],re);for(var Pe=0;Pe<X.length;Pe++)F(ue,Se,X[Pe],re);for(var ne=0;ne<ue.length;ne++)ue[ne].scrollTo(null,we[ne])}}function F(N,H,J,X){for(var re=-1e8,ne=[],ue=0;ue<N.length;ue++)if(J[ue]!=null){var we=N[ue].heightAtLine(J[ue],"local")-H[ue];ne[ue]=we,re=Math.max(re,we)}for(var ue=0;ue<N.length;ue++)if(J[ue]!=null){var Se=re-ne[ue];Se>1&&X.push(z(N[ue],J[ue],Se))}}function z(N,H,J){var X=!0;H>N.lastLine()&&(H--,X=!1);var re=document.createElement("div");return re.className="CodeMirror-merge-spacer",re.style.height=J+"px",re.style.minWidth="1px",N.addLineWidget(H,re,{height:J,above:X,mergeSpacer:!0,handleMouseEvents:!0})}function ie(N,H,J,X,re){var ne=N.type=="left",ue=N.orig.heightAtLine(H.origFrom,"local",!0)-J;if(N.svg){var we=ue,Se=N.edit.heightAtLine(H.editFrom,"local",!0)-X;if(ne){var Pe=we;we=Se,Se=Pe}var Ge=N.orig.heightAtLine(H.origTo,"local",!0)-J,at=N.edit.heightAtLine(H.editTo,"local",!0)-X;if(ne){var Pe=Ge;Ge=at,at=Pe}var ut=" C "+re/2+" "+Se+" "+re/2+" "+we+" "+(re+2)+" "+we,kt=" C "+re/2+" "+Ge+" "+re/2+" "+at+" -1 "+at;ce(N.svg.appendChild(document.createElementNS(i,"path")),"d","M -1 "+Se+ut+" L "+(re+2)+" "+Ge+kt+" z","class",N.classes.connect)}if(N.copyButtons){var Xe=N.copyButtons.appendChild(Ae("div",N.type=="left"?"⇝":"⇜","CodeMirror-merge-copy")),rt=N.mv.options.allowEditingOriginals;if(Xe.title=N.edit.phrase(rt?"Push to left":"Revert chunk"),Xe.chunk=H,Xe.style.top=(H.origTo>H.origFrom?ue:N.edit.heightAtLine(H.editFrom,"local")-X)+"px",Xe.setAttribute("role","button"),Xe.setAttribute("tabindex","0"),Xe.setAttribute("aria-label",Xe.title),rt){var Tt=N.edit.heightAtLine(H.editFrom,"local")-X,et=N.copyButtons.appendChild(Ae("div",N.type=="right"?"⇝":"⇜","CodeMirror-merge-copy-reverse"));et.title="Push to right",et.chunk={editFrom:H.origFrom,editTo:H.origTo,origFrom:H.editFrom,origTo:H.editTo},et.style.top=Tt+"px",N.type=="right"?et.style.left="2px":et.style.right="2px",et.setAttribute("role","button"),et.setAttribute("tabindex","0"),et.setAttribute("aria-label",et.title)}}}function G(N,H,J,X){if(!N.diffOutOfDate){var re=X.origTo>J.lastLine()?n(X.origFrom-1):n(X.origFrom,0),ne=n(X.origTo,0),ue=X.editTo>H.lastLine()?n(X.editFrom-1):n(X.editFrom,0),we=n(X.editTo,0),Se=N.mv.options.revertChunk;Se?Se(N.mv,J,re,ne,H,ue,we):H.replaceRange(J.getRange(re,ne),ue,we)}}var Q=t.MergeView=function(N,H){if(!(this instanceof Q))return new Q(N,H);this.options=H;var J=H.origLeft,X=H.origRight==null?H.orig:H.origRight,re=J!=null,ne=X!=null,ue=1+(re?1:0)+(ne?1:0),we=[],Se=this.left=null,Pe=this.right=null,Ge=this;if(re){Se=this.left=new o(this,"left");var at=Ae("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");we.push(at),we.push(T(Se))}var ut=Ae("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");if(we.push(ut),ne){Pe=this.right=new o(this,"right"),we.push(T(Pe));var kt=Ae("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");we.push(kt)}(ne?kt:ut).className+=" CodeMirror-merge-pane-rightmost",we.push(Ae("div",null,null,"height: 0; clear: both;"));var Xe=this.wrap=N.appendChild(Ae("div",we,"CodeMirror-merge CodeMirror-merge-"+ue+"pane"));this.edit=t(ut,_e(H)),Se&&Se.init(at,J,H),Pe&&Pe.init(kt,X,H),H.collapseIdentical&&this.editor().operation(function(){Ve(Ge,H.collapseIdentical)}),H.connect=="align"&&(this.aligners=[],R(this.left||this.right,!0)),Se&&Se.registerEvents(Pe),Pe&&Pe.registerEvents(Se);var rt=function(){Se&&C(Se),Pe&&C(Pe)};t.on(window,"resize",rt);var Tt=setInterval(function(){for(var et=Xe.parentNode;et&&et!=document.body;et=et.parentNode);et||(clearInterval(Tt),t.off(window,"resize",rt))},5e3)};function T(N){var H=N.lockButton=Ae("div",null,"CodeMirror-merge-scrolllock");H.setAttribute("role","button"),H.setAttribute("tabindex","0");var J=Ae("div",[H],"CodeMirror-merge-scrolllock-wrap");t.on(H,"click",function(){g(N,!N.lockScroll)}),t.on(H,"keyup",function(ue){(ue.key==="Enter"||ue.code==="Space")&&g(N,!N.lockScroll)});var X=[J];if(N.mv.options.revertButtons!==!1){N.copyButtons=Ae("div",null,"CodeMirror-merge-copybuttons-"+N.type);var re=function(ue){var we=ue.target||ue.srcElement;if(we.chunk){if(we.className=="CodeMirror-merge-copy-reverse"){G(N,N.orig,N.edit,we.chunk);return}G(N,N.edit,N.orig,we.chunk)}};t.on(N.copyButtons,"click",re),t.on(N.copyButtons,"keyup",function(ue){(ue.key==="Enter"||ue.code==="Space")&&re(ue)}),X.unshift(N.copyButtons)}if(N.mv.options.connect!="align"){var ne=document.createElementNS&&document.createElementNS(i,"svg");ne&&!ne.createSVGRect&&(ne=null),N.svg=ne,ne&&X.push(ne)}return N.gap=Ae("div",X,"CodeMirror-merge-gap")}Q.prototype={constructor:Q,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(N){this.right&&this.right.setShowDifferences(N),this.left&&this.left.setShowDifferences(N)},rightChunks:function(){if(this.right)return s(this.right),this.right.chunks},leftChunks:function(){if(this.left)return s(this.left),this.left.chunks}};function W(N){return typeof N=="string"?N:N.getValue()}var P;function le(N,H,J){P||(P=new diff_match_patch);for(var X=P.diff_main(N,H),re=0;re<X.length;++re){var ne=X[re];(J?!/[^ \t]/.test(ne[1]):!ne[1])?X.splice(re--,1):re&&X[re-1][0]==ne[0]&&(X.splice(re--,1),X[re][1]+=ne[1])}return X}function me(N){var H=[];if(!N.length)return H;for(var J=0,X=0,re=n(0,0),ne=n(0,0),ue=0;ue<N.length;++ue){var we=N[ue],Se=we[0];if(Se==DIFF_EQUAL){var Pe=!Ne(N,ue)||re.line<J||ne.line<X?1:0,Ge=re.line+Pe,at=ne.line+Pe;Ie(re,we[1],null,ne);var ut=he(N,ue)?1:0,kt=re.line+ut,Xe=ne.line+ut;kt>Ge&&(ue&&H.push({origFrom:X,origTo:at,editFrom:J,editTo:Ge}),J=kt,X=Xe)}else Ie(Se==DIFF_INSERT?re:ne,we[1])}return(J<=re.line||X<=ne.line)&&H.push({origFrom:X,origTo:ne.line+1,editFrom:J,editTo:re.line+1}),H}function he(N,H){if(H==N.length-1)return!0;var J=N[H+1][1];return J.length==1&&H<N.length-2||J.charCodeAt(0)!=10?!1:H==N.length-2?!0:(J=N[H+2][1],(J.length>1||H==N.length-3)&&J.charCodeAt(0)==10)}function Ne(N,H){if(H==0)return!0;var J=N[H-1][1];return J.charCodeAt(J.length-1)!=10?!1:H==1?!0:(J=N[H-2][1],J.charCodeAt(J.length-1)==10)}function ye(N,H,J){for(var X,re,ne,ue,we=0;we<N.length;we++){var Se=N[we],Pe=J?Se.editFrom:Se.origFrom,Ge=J?Se.editTo:Se.origTo;re==null&&(Pe>H?(re=Se.editFrom,ue=Se.origFrom):Ge>H&&(re=Se.editTo,ue=Se.origTo)),Ge<=H?(X=Se.editTo,ne=Se.origTo):Pe<=H&&(X=Se.editFrom,ne=Se.origFrom)}return{edit:{before:X,after:re},orig:{before:ne,after:ue}}}function ae(N,H,J){N.addLineClass(H,"wrap","CodeMirror-merge-collapsed-line");var X=document.createElement("span");X.className="CodeMirror-merge-collapsed-widget",X.title=N.phrase("Identical text collapsed. Click to expand.");var re=N.markText(n(H,0),n(J-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:X,clearOnEnter:!0});function ne(){re.clear(),N.removeLineClass(H,"wrap","CodeMirror-merge-collapsed-line")}return re.explicitlyCleared&&ne(),t.on(X,"click",ne),re.on("clear",ne),t.on(X,"click",ne),{mark:re,clear:ne}}function Re(N,H){var J=[];function X(){for(var we=0;we<J.length;we++)J[we].clear()}for(var re=0;re<H.length;re++){var ne=H[re],ue=ae(ne.cm,ne.line,ne.line+N);J.push(ue),ue.mark.on("clear",X)}return J[0].mark}function Le(N,H,J,X){for(var re=0;re<N.chunks.length;re++)for(var ne=N.chunks[re],ue=ne.editFrom-H;ue<ne.editTo+H;ue++){var we=ue+J;we>=0&&we<X.length&&(X[we]=!1)}}function Ve(N,H){typeof H!="number"&&(H=2);for(var J=[],X=N.editor(),re=X.firstLine(),ne=re,ue=X.lastLine();ne<=ue;ne++)J.push(!0);N.left&&Le(N.left,H,re,J),N.right&&Le(N.right,H,re,J);for(var we=0;we<J.length;we++)if(J[we]){for(var Se=we+re,Pe=1;we<J.length-1&&J[we+1];we++,Pe++);if(Pe>H){var Ge=[{line:Se,cm:X}];N.left&&Ge.push({line:k(Se,N.left.chunks),cm:N.left.orig}),N.right&&Ge.push({line:k(Se,N.right.chunks),cm:N.right.orig});var at=Re(Pe,Ge);N.options.onCollapse&&N.options.onCollapse(N,Se,Pe,at)}}}function Ae(N,H,J,X){var re=document.createElement(N);if(J&&(re.className=J),X&&(re.style.cssText=X),typeof H=="string")re.appendChild(document.createTextNode(H));else if(H)for(var ne=0;ne<H.length;++ne)re.appendChild(H[ne]);return re}function te(N){for(var H=N.childNodes.length;H>0;--H)N.removeChild(N.firstChild)}function ce(N){for(var H=1;H<arguments.length;H+=2)N.setAttribute(arguments[H],arguments[H+1])}function _e(N,H){H||(H={});for(var J in N)N.hasOwnProperty(J)&&(H[J]=N[J]);return H}function Ie(N,H,J,X){for(var re=J?n(N.line,N.ch):N,ne=0;;){var ue=H.indexOf(`
`,ne);if(ue==-1)break;++re.line,X&&++X.line,ne=ue+1}return re.ch=(ne?0:re.ch)+(H.length-ne),X&&(X.ch=(ne?0:X.ch)+(H.length-ne)),re}var Ke=1,$e=2,Ue=4;function Nt(N){this.cm=N,this.alignable=[],this.height=N.doc.height;var H=this;N.on("markerAdded",function(J,X){if(X.collapsed){var re=X.find(1);re!=null&&H.set(re.line,Ue)}}),N.on("markerCleared",function(J,X,re,ne){ne!=null&&X.collapsed&&H.check(ne,Ue,H.hasMarker)}),N.on("markerChanged",this.signal.bind(this)),N.on("lineWidgetAdded",function(J,X,re){X.mergeSpacer||(X.above?H.set(re-1,$e):H.set(re,Ke))}),N.on("lineWidgetCleared",function(J,X,re){X.mergeSpacer||(X.above?H.check(re-1,$e,H.hasWidgetBelow):H.check(re,Ke,H.hasWidget))}),N.on("lineWidgetChanged",this.signal.bind(this)),N.on("change",function(J,X){var re=X.from.line,ne=X.to.line-X.from.line,ue=X.text.length-1,we=re+ue;(ne||ue)&&H.map(re,ne,ue),H.check(we,Ue,H.hasMarker),(ne||ue)&&H.check(X.from.line,Ue,H.hasMarker)}),N.on("viewportChange",function(){H.cm.doc.height!=H.height&&H.signal()})}Nt.prototype={signal:function(){t.signal(this,"realign"),this.height=this.cm.doc.height},set:function(N,H){for(var J=-1;J<this.alignable.length;J+=2){var X=this.alignable[J]-N;if(X==0){if((this.alignable[J+1]&H)==H)return;this.alignable[J+1]|=H,this.signal();return}if(X>0)break}this.signal(),this.alignable.splice(J,0,N,H)},find:function(N){for(var H=0;H<this.alignable.length;H+=2)if(this.alignable[H]==N)return H;return-1},check:function(N,H,J){var X=this.find(N);if(!(X==-1||!(this.alignable[X+1]&H))&&!J.call(this,N)){this.signal();var re=this.alignable[X+1]&~H;re?this.alignable[X+1]=re:this.alignable.splice(X,2)}},hasMarker:function(N){var H=this.cm.getLineHandle(N);if(H.markedSpans){for(var J=0;J<H.markedSpans.length;J++)if(H.markedSpans[J].marker.collapsed&&H.markedSpans[J].to!=null)return!0}return!1},hasWidget:function(N){var H=this.cm.getLineHandle(N);if(H.widgets){for(var J=0;J<H.widgets.length;J++)if(!H.widgets[J].above&&!H.widgets[J].mergeSpacer)return!0}return!1},hasWidgetBelow:function(N){if(N==this.cm.lastLine())return!1;var H=this.cm.getLineHandle(N+1);if(H.widgets){for(var J=0;J<H.widgets.length;J++)if(H.widgets[J].above&&!H.widgets[J].mergeSpacer)return!0}return!1},map:function(N,H,J){for(var X=J-H,re=N+H,ne=-1,ue=-1,we=0;we<this.alignable.length;we+=2){var Se=this.alignable[we];Se==N&&this.alignable[we+1]&$e&&(ne=we),Se==re&&this.alignable[we+1]&$e&&(ue=we),!(Se<=N)&&(Se<re?this.alignable.splice(we--,2):this.alignable[we]+=X)}if(ne>-1){var Pe=this.alignable[ne+1];Pe==$e?this.alignable.splice(ne,2):this.alignable[ne+1]=Pe&~$e}ue>-1&&J&&this.set(N+J,$e)}};function ot(N,H){return(N.line-H.line||N.ch-H.ch)<0?N:H}function Bt(N,H){return(N.line-H.line||N.ch-H.ch)>0?N:H}function bt(N,H){return N.line==H.line&&N.ch==H.ch}function rn(N,H,J){for(var X=N.length-1;X>=0;X--){var re=N[X],ne=(J?re.origTo:re.editTo)-1;if(ne<H)return ne}}function ln(N,H,J){for(var X=0;X<N.length;X++){var re=N[X],ne=J?re.origFrom:re.editFrom;if(ne>H)return ne}}function Z(N,H){var J=null,X=N.state.diffViews,re=N.getCursor().line;if(X)for(var ne=0;ne<X.length;ne++){var ue=X[ne],we=N==ue.orig;s(ue);var Se=H<0?rn(ue.chunks,re,we):ln(ue.chunks,re,we);Se!=null&&(J==null||(H<0?Se>J:Se<J))&&(J=Se)}if(J!=null)N.setCursor(J,0);else return t.Pass}t.commands.goNextDiff=function(N){return Z(N,1)},t.commands.goPrevDiff=function(N){return Z(N,-1)}})}()),wg.exports}xM();var uf={exports:{}},Eg;function wM(){return Eg||(Eg=1,function(r){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,i=0;e.Diff=function(o,s){return[o,s]},e.prototype.diff_main=function(o,s,l,d){typeof d>"u"&&(this.Diff_Timeout<=0?d=Number.MAX_VALUE:d=new Date().getTime()+this.Diff_Timeout*1e3);var c=d;if(o==null||s==null)throw new Error("Null input. (diff_main)");if(o==s)return o?[new e.Diff(i,o)]:[];typeof l>"u"&&(l=!0);var f=l,v=this.diff_commonPrefix(o,s),g=o.substring(0,v);o=o.substring(v),s=s.substring(v),v=this.diff_commonSuffix(o,s);var y=o.substring(o.length-v);o=o.substring(0,o.length-v),s=s.substring(0,s.length-v);var b=this.diff_compute_(o,s,f,c);return g&&b.unshift(new e.Diff(i,g)),y&&b.push(new e.Diff(i,y)),this.diff_cleanupMerge(b),b},e.prototype.diff_compute_=function(o,s,l,d){var c;if(!o)return[new e.Diff(n,s)];if(!s)return[new e.Diff(t,o)];var f=o.length>s.length?o:s,v=o.length>s.length?s:o,g=f.indexOf(v);if(g!=-1)return c=[new e.Diff(n,f.substring(0,g)),new e.Diff(i,v),new e.Diff(n,f.substring(g+v.length))],o.length>s.length&&(c[0][0]=c[2][0]=t),c;if(v.length==1)return[new e.Diff(t,o),new e.Diff(n,s)];var y=this.diff_halfMatch_(o,s);if(y){var b=y[0],_=y[1],x=y[2],w=y[3],C=y[4],k=this.diff_main(b,x,l,d),D=this.diff_main(_,w,l,d);return k.concat([new e.Diff(i,C)],D)}return l&&o.length>100&&s.length>100?this.diff_lineMode_(o,s,d):this.diff_bisect_(o,s,d)},e.prototype.diff_lineMode_=function(o,s,l){var d=this.diff_linesToChars_(o,s);o=d.chars1,s=d.chars2;var c=d.lineArray,f=this.diff_main(o,s,!1,l);this.diff_charsToLines_(f,c),this.diff_cleanupSemantic(f),f.push(new e.Diff(i,""));for(var v=0,g=0,y=0,b="",_="";v<f.length;){switch(f[v][0]){case n:y++,_+=f[v][1];break;case t:g++,b+=f[v][1];break;case i:if(g>=1&&y>=1){f.splice(v-g-y,g+y),v=v-g-y;for(var x=this.diff_main(b,_,!1,l),w=x.length-1;w>=0;w--)f.splice(v,0,x[w]);v=v+x.length}y=0,g=0,b="",_="";break}v++}return f.pop(),f},e.prototype.diff_bisect_=function(o,s,l){for(var d=o.length,c=s.length,f=Math.ceil((d+c)/2),v=f,g=2*f,y=new Array(g),b=new Array(g),_=0;_<g;_++)y[_]=-1,b[_]=-1;y[v+1]=0,b[v+1]=0;for(var x=d-c,w=x%2!=0,C=0,k=0,D=0,I=0,$=0;$<f&&!(new Date().getTime()>l);$++){for(var R=-$+C;R<=$-k;R+=2){var F=v+R,z;R==-$||R!=$&&y[F-1]<y[F+1]?z=y[F+1]:z=y[F-1]+1;for(var ie=z-R;z<d&&ie<c&&o.charAt(z)==s.charAt(ie);)z++,ie++;if(y[F]=z,z>d)k+=2;else if(ie>c)C+=2;else if(w){var G=v+x-R;if(G>=0&&G<g&&b[G]!=-1){var Q=d-b[G];if(z>=Q)return this.diff_bisectSplit_(o,s,z,ie,l)}}}for(var T=-$+D;T<=$-I;T+=2){var G=v+T,Q;T==-$||T!=$&&b[G-1]<b[G+1]?Q=b[G+1]:Q=b[G-1]+1;for(var W=Q-T;Q<d&&W<c&&o.charAt(d-Q-1)==s.charAt(c-W-1);)Q++,W++;if(b[G]=Q,Q>d)I+=2;else if(W>c)D+=2;else if(!w){var F=v+x-T;if(F>=0&&F<g&&y[F]!=-1){var z=y[F],ie=v+z-F;if(Q=d-Q,z>=Q)return this.diff_bisectSplit_(o,s,z,ie,l)}}}}return[new e.Diff(t,o),new e.Diff(n,s)]},e.prototype.diff_bisectSplit_=function(o,s,l,d,c){var f=o.substring(0,l),v=s.substring(0,d),g=o.substring(l),y=s.substring(d),b=this.diff_main(f,v,!1,c),_=this.diff_main(g,y,!1,c);return b.concat(_)},e.prototype.diff_linesToChars_=function(o,s){var l=[],d={};l[0]="";function c(y){for(var b="",_=0,x=-1,w=l.length;x<y.length-1;){x=y.indexOf(`
`,_),x==-1&&(x=y.length-1);var C=y.substring(_,x+1);(d.hasOwnProperty?d.hasOwnProperty(C):d[C]!==void 0)?b+=String.fromCharCode(d[C]):(w==f&&(C=y.substring(_),x=y.length),b+=String.fromCharCode(w),d[C]=w,l[w++]=C),_=x+1}return b}var f=4e4,v=c(o);f=65535;var g=c(s);return{chars1:v,chars2:g,lineArray:l}},e.prototype.diff_charsToLines_=function(o,s){for(var l=0;l<o.length;l++){for(var d=o[l][1],c=[],f=0;f<d.length;f++)c[f]=s[d.charCodeAt(f)];o[l][1]=c.join("")}},e.prototype.diff_commonPrefix=function(o,s){if(!o||!s||o.charAt(0)!=s.charAt(0))return 0;for(var l=0,d=Math.min(o.length,s.length),c=d,f=0;l<c;)o.substring(f,c)==s.substring(f,c)?(l=c,f=l):d=c,c=Math.floor((d-l)/2+l);return c},e.prototype.diff_commonSuffix=function(o,s){if(!o||!s||o.charAt(o.length-1)!=s.charAt(s.length-1))return 0;for(var l=0,d=Math.min(o.length,s.length),c=d,f=0;l<c;)o.substring(o.length-c,o.length-f)==s.substring(s.length-c,s.length-f)?(l=c,f=l):d=c,c=Math.floor((d-l)/2+l);return c},e.prototype.diff_commonOverlap_=function(o,s){var l=o.length,d=s.length;if(l==0||d==0)return 0;l>d?o=o.substring(l-d):l<d&&(s=s.substring(0,l));var c=Math.min(l,d);if(o==s)return c;for(var f=0,v=1;;){var g=o.substring(c-v),y=s.indexOf(g);if(y==-1)return f;v+=y,(y==0||o.substring(c-v)==s.substring(0,v))&&(f=v,v++)}},e.prototype.diff_halfMatch_=function(o,s){if(this.Diff_Timeout<=0)return null;var l=o.length>s.length?o:s,d=o.length>s.length?s:o;if(l.length<4||d.length*2<l.length)return null;var c=this;function f(k,D,I){for(var $=k.substring(I,I+Math.floor(k.length/4)),R=-1,F="",z,ie,G,Q;(R=D.indexOf($,R+1))!=-1;){var T=c.diff_commonPrefix(k.substring(I),D.substring(R)),W=c.diff_commonSuffix(k.substring(0,I),D.substring(0,R));F.length<W+T&&(F=D.substring(R-W,R)+D.substring(R,R+T),z=k.substring(0,I-W),ie=k.substring(I+T),G=D.substring(0,R-W),Q=D.substring(R+T))}return F.length*2>=k.length?[z,ie,G,Q,F]:null}var v=f(l,d,Math.ceil(l.length/4)),g=f(l,d,Math.ceil(l.length/2)),y;if(!v&&!g)return null;g?v?y=v[4].length>g[4].length?v:g:y=g:y=v;var b,_,x,w;o.length>s.length?(b=y[0],_=y[1],x=y[2],w=y[3]):(x=y[0],w=y[1],b=y[2],_=y[3]);var C=y[4];return[b,_,x,w,C]},e.prototype.diff_cleanupSemantic=function(o){for(var s=!1,l=[],d=0,c=null,f=0,v=0,g=0,y=0,b=0;f<o.length;)o[f][0]==i?(l[d++]=f,v=y,g=b,y=0,b=0,c=o[f][1]):(o[f][0]==n?y+=o[f][1].length:b+=o[f][1].length,c&&c.length<=Math.max(v,g)&&c.length<=Math.max(y,b)&&(o.splice(l[d-1],0,new e.Diff(t,c)),o[l[d-1]+1][0]=n,d--,d--,f=d>0?l[d-1]:-1,v=0,g=0,y=0,b=0,c=null,s=!0)),f++;for(s&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),f=1;f<o.length;){if(o[f-1][0]==t&&o[f][0]==n){var _=o[f-1][1],x=o[f][1],w=this.diff_commonOverlap_(_,x),C=this.diff_commonOverlap_(x,_);w>=C?(w>=_.length/2||w>=x.length/2)&&(o.splice(f,0,new e.Diff(i,x.substring(0,w))),o[f-1][1]=_.substring(0,_.length-w),o[f+1][1]=x.substring(w),f++):(C>=_.length/2||C>=x.length/2)&&(o.splice(f,0,new e.Diff(i,_.substring(0,C))),o[f-1][0]=n,o[f-1][1]=x.substring(0,x.length-C),o[f+1][0]=t,o[f+1][1]=_.substring(C),f++),f++}f++}},e.prototype.diff_cleanupSemanticLossless=function(o){function s(C,k){if(!C||!k)return 6;var D=C.charAt(C.length-1),I=k.charAt(0),$=D.match(e.nonAlphaNumericRegex_),R=I.match(e.nonAlphaNumericRegex_),F=$&&D.match(e.whitespaceRegex_),z=R&&I.match(e.whitespaceRegex_),ie=F&&D.match(e.linebreakRegex_),G=z&&I.match(e.linebreakRegex_),Q=ie&&C.match(e.blanklineEndRegex_),T=G&&k.match(e.blanklineStartRegex_);return Q||T?5:ie||G?4:$&&!F&&z?3:F||z?2:$||R?1:0}for(var l=1;l<o.length-1;){if(o[l-1][0]==i&&o[l+1][0]==i){var d=o[l-1][1],c=o[l][1],f=o[l+1][1],v=this.diff_commonSuffix(d,c);if(v){var g=c.substring(c.length-v);d=d.substring(0,d.length-v),c=g+c.substring(0,c.length-v),f=g+f}for(var y=d,b=c,_=f,x=s(d,c)+s(c,f);c.charAt(0)===f.charAt(0);){d+=c.charAt(0),c=c.substring(1)+f.charAt(0),f=f.substring(1);var w=s(d,c)+s(c,f);w>=x&&(x=w,y=d,b=c,_=f)}o[l-1][1]!=y&&(y?o[l-1][1]=y:(o.splice(l-1,1),l--),o[l][1]=b,_?o[l+1][1]=_:(o.splice(l+1,1),l--))}l++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(o){for(var s=!1,l=[],d=0,c=null,f=0,v=!1,g=!1,y=!1,b=!1;f<o.length;)o[f][0]==i?(o[f][1].length<this.Diff_EditCost&&(y||b)?(l[d++]=f,v=y,g=b,c=o[f][1]):(d=0,c=null),y=b=!1):(o[f][0]==t?b=!0:y=!0,c&&(v&&g&&y&&b||c.length<this.Diff_EditCost/2&&v+g+y+b==3)&&(o.splice(l[d-1],0,new e.Diff(t,c)),o[l[d-1]+1][0]=n,d--,c=null,v&&g?(y=b=!0,d=0):(d--,f=d>0?l[d-1]:-1,y=b=!1),s=!0)),f++;s&&this.diff_cleanupMerge(o)},e.prototype.diff_cleanupMerge=function(o){o.push(new e.Diff(i,""));for(var s=0,l=0,d=0,c="",f="",v;s<o.length;)switch(o[s][0]){case n:d++,f+=o[s][1],s++;break;case t:l++,c+=o[s][1],s++;break;case i:l+d>1?(l!==0&&d!==0&&(v=this.diff_commonPrefix(f,c),v!==0&&(s-l-d>0&&o[s-l-d-1][0]==i?o[s-l-d-1][1]+=f.substring(0,v):(o.splice(0,0,new e.Diff(i,f.substring(0,v))),s++),f=f.substring(v),c=c.substring(v)),v=this.diff_commonSuffix(f,c),v!==0&&(o[s][1]=f.substring(f.length-v)+o[s][1],f=f.substring(0,f.length-v),c=c.substring(0,c.length-v))),s-=l+d,o.splice(s,l+d),c.length&&(o.splice(s,0,new e.Diff(t,c)),s++),f.length&&(o.splice(s,0,new e.Diff(n,f)),s++),s++):s!==0&&o[s-1][0]==i?(o[s-1][1]+=o[s][1],o.splice(s,1)):s++,d=0,l=0,c="",f="";break}o[o.length-1][1]===""&&o.pop();var g=!1;for(s=1;s<o.length-1;)o[s-1][0]==i&&o[s+1][0]==i&&(o[s][1].substring(o[s][1].length-o[s-1][1].length)==o[s-1][1]?(o[s][1]=o[s-1][1]+o[s][1].substring(0,o[s][1].length-o[s-1][1].length),o[s+1][1]=o[s-1][1]+o[s+1][1],o.splice(s-1,1),g=!0):o[s][1].substring(0,o[s+1][1].length)==o[s+1][1]&&(o[s-1][1]+=o[s+1][1],o[s][1]=o[s][1].substring(o[s+1][1].length)+o[s+1][1],o.splice(s+1,1),g=!0)),s++;g&&this.diff_cleanupMerge(o)},e.prototype.diff_xIndex=function(o,s){var l=0,d=0,c=0,f=0,v;for(v=0;v<o.length&&(o[v][0]!==n&&(l+=o[v][1].length),o[v][0]!==t&&(d+=o[v][1].length),!(l>s));v++)c=l,f=d;return o.length!=v&&o[v][0]===t?f:f+(s-c)},e.prototype.diff_prettyHtml=function(o){for(var s=[],l=/&/g,d=/</g,c=/>/g,f=/\n/g,v=0;v<o.length;v++){var g=o[v][0],y=o[v][1],b=y.replace(l,"&amp;").replace(d,"&lt;").replace(c,"&gt;").replace(f,"&para;<br>");switch(g){case n:s[v]='<ins style="background:#e6ffe6;">'+b+"</ins>";break;case t:s[v]='<del style="background:#ffe6e6;">'+b+"</del>";break;case i:s[v]="<span>"+b+"</span>";break}}return s.join("")},e.prototype.diff_text1=function(o){for(var s=[],l=0;l<o.length;l++)o[l][0]!==n&&(s[l]=o[l][1]);return s.join("")},e.prototype.diff_text2=function(o){for(var s=[],l=0;l<o.length;l++)o[l][0]!==t&&(s[l]=o[l][1]);return s.join("")},e.prototype.diff_levenshtein=function(o){for(var s=0,l=0,d=0,c=0;c<o.length;c++){var f=o[c][0],v=o[c][1];switch(f){case n:l+=v.length;break;case t:d+=v.length;break;case i:s+=Math.max(l,d),l=0,d=0;break}}return s+=Math.max(l,d),s},e.prototype.diff_toDelta=function(o){for(var s=[],l=0;l<o.length;l++)switch(o[l][0]){case n:s[l]="+"+encodeURI(o[l][1]);break;case t:s[l]="-"+o[l][1].length;break;case i:s[l]="="+o[l][1].length;break}return s.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(o,s){for(var l=[],d=0,c=0,f=s.split(/\t/g),v=0;v<f.length;v++){var g=f[v].substring(1);switch(f[v].charAt(0)){case"+":try{l[d++]=new e.Diff(n,decodeURI(g))}catch{throw new Error("Illegal escape in diff_fromDelta: "+g)}break;case"-":case"=":var y=parseInt(g,10);if(isNaN(y)||y<0)throw new Error("Invalid number in diff_fromDelta: "+g);var b=o.substring(c,c+=y);f[v].charAt(0)=="="?l[d++]=new e.Diff(i,b):l[d++]=new e.Diff(t,b);break;default:if(f[v])throw new Error("Invalid diff operation in diff_fromDelta: "+f[v])}}if(c!=o.length)throw new Error("Delta length ("+c+") does not equal source text length ("+o.length+").");return l},e.prototype.match_main=function(o,s,l){if(o==null||s==null||l==null)throw new Error("Null input. (match_main)");return l=Math.max(0,Math.min(l,o.length)),o==s?0:o.length?o.substring(l,l+s.length)==s?l:this.match_bitap_(o,s,l):-1},e.prototype.match_bitap_=function(o,s,l){if(s.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var d=this.match_alphabet_(s),c=this;function f(z,ie){var G=z/s.length,Q=Math.abs(l-ie);return c.Match_Distance?G+Q/c.Match_Distance:Q?1:G}var v=this.Match_Threshold,g=o.indexOf(s,l);g!=-1&&(v=Math.min(f(0,g),v),g=o.lastIndexOf(s,l+s.length),g!=-1&&(v=Math.min(f(0,g),v)));var y=1<<s.length-1;g=-1;for(var b,_,x=s.length+o.length,w,C=0;C<s.length;C++){for(b=0,_=x;b<_;)f(C,l+_)<=v?b=_:x=_,_=Math.floor((x-b)/2+b);x=_;var k=Math.max(1,l-_+1),D=Math.min(l+_,o.length)+s.length,I=Array(D+2);I[D+1]=(1<<C)-1;for(var $=D;$>=k;$--){var R=d[o.charAt($-1)];if(C===0?I[$]=(I[$+1]<<1|1)&R:I[$]=(I[$+1]<<1|1)&R|((w[$+1]|w[$])<<1|1)|w[$+1],I[$]&y){var F=f(C,$-1);if(F<=v)if(v=F,g=$-1,g>l)k=Math.max(1,2*l-g);else break}}if(f(C+1,l)>v)break;w=I}return g},e.prototype.match_alphabet_=function(o){for(var s={},l=0;l<o.length;l++)s[o.charAt(l)]=0;for(var l=0;l<o.length;l++)s[o.charAt(l)]|=1<<o.length-l-1;return s},e.prototype.patch_addContext_=function(o,s){if(s.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var l=s.substring(o.start2,o.start2+o.length1),d=0;s.indexOf(l)!=s.lastIndexOf(l)&&l.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)d+=this.Patch_Margin,l=s.substring(o.start2-d,o.start2+o.length1+d);d+=this.Patch_Margin;var c=s.substring(o.start2-d,o.start2);c&&o.diffs.unshift(new e.Diff(i,c));var f=s.substring(o.start2+o.length1,o.start2+o.length1+d);f&&o.diffs.push(new e.Diff(i,f)),o.start1-=c.length,o.start2-=c.length,o.length1+=c.length+f.length,o.length2+=c.length+f.length}},e.prototype.patch_make=function(o,s,l){var d,c;if(typeof o=="string"&&typeof s=="string"&&typeof l>"u")d=o,c=this.diff_main(d,s,!0),c.length>2&&(this.diff_cleanupSemantic(c),this.diff_cleanupEfficiency(c));else if(o&&typeof o=="object"&&typeof s>"u"&&typeof l>"u")c=o,d=this.diff_text1(c);else if(typeof o=="string"&&s&&typeof s=="object"&&typeof l>"u")d=o,c=s;else if(typeof o=="string"&&typeof s=="string"&&l&&typeof l=="object")d=o,c=l;else throw new Error("Unknown call format to patch_make.");if(c.length===0)return[];for(var f=[],v=new e.patch_obj,g=0,y=0,b=0,_=d,x=d,w=0;w<c.length;w++){var C=c[w][0],k=c[w][1];switch(!g&&C!==i&&(v.start1=y,v.start2=b),C){case n:v.diffs[g++]=c[w],v.length2+=k.length,x=x.substring(0,b)+k+x.substring(b);break;case t:v.length1+=k.length,v.diffs[g++]=c[w],x=x.substring(0,b)+x.substring(b+k.length);break;case i:k.length<=2*this.Patch_Margin&&g&&c.length!=w+1?(v.diffs[g++]=c[w],v.length1+=k.length,v.length2+=k.length):k.length>=2*this.Patch_Margin&&g&&(this.patch_addContext_(v,_),f.push(v),v=new e.patch_obj,g=0,_=x,y=b);break}C!==n&&(y+=k.length),C!==t&&(b+=k.length)}return g&&(this.patch_addContext_(v,_),f.push(v)),f},e.prototype.patch_deepCopy=function(o){for(var s=[],l=0;l<o.length;l++){var d=o[l],c=new e.patch_obj;c.diffs=[];for(var f=0;f<d.diffs.length;f++)c.diffs[f]=new e.Diff(d.diffs[f][0],d.diffs[f][1]);c.start1=d.start1,c.start2=d.start2,c.length1=d.length1,c.length2=d.length2,s[l]=c}return s},e.prototype.patch_apply=function(o,s){if(o.length==0)return[s,[]];o=this.patch_deepCopy(o);var l=this.patch_addPadding(o);s=l+s+l,this.patch_splitMax(o);for(var d=0,c=[],f=0;f<o.length;f++){var v=o[f].start2+d,g=this.diff_text1(o[f].diffs),y,b=-1;if(g.length>this.Match_MaxBits?(y=this.match_main(s,g.substring(0,this.Match_MaxBits),v),y!=-1&&(b=this.match_main(s,g.substring(g.length-this.Match_MaxBits),v+g.length-this.Match_MaxBits),(b==-1||y>=b)&&(y=-1))):y=this.match_main(s,g,v),y==-1)c[f]=!1,d-=o[f].length2-o[f].length1;else{c[f]=!0,d=y-v;var _;if(b==-1?_=s.substring(y,y+g.length):_=s.substring(y,b+this.Match_MaxBits),g==_)s=s.substring(0,y)+this.diff_text2(o[f].diffs)+s.substring(y+g.length);else{var x=this.diff_main(g,_,!1);if(g.length>this.Match_MaxBits&&this.diff_levenshtein(x)/g.length>this.Patch_DeleteThreshold)c[f]=!1;else{this.diff_cleanupSemanticLossless(x);for(var w=0,C,k=0;k<o[f].diffs.length;k++){var D=o[f].diffs[k];D[0]!==i&&(C=this.diff_xIndex(x,w)),D[0]===n?s=s.substring(0,y+C)+D[1]+s.substring(y+C):D[0]===t&&(s=s.substring(0,y+C)+s.substring(y+this.diff_xIndex(x,w+D[1].length))),D[0]!==t&&(w+=D[1].length)}}}}}return s=s.substring(l.length,s.length-l.length),[s,c]},e.prototype.patch_addPadding=function(o){for(var s=this.Patch_Margin,l="",d=1;d<=s;d++)l+=String.fromCharCode(d);for(var d=0;d<o.length;d++)o[d].start1+=s,o[d].start2+=s;var c=o[0],f=c.diffs;if(f.length==0||f[0][0]!=i)f.unshift(new e.Diff(i,l)),c.start1-=s,c.start2-=s,c.length1+=s,c.length2+=s;else if(s>f[0][1].length){var v=s-f[0][1].length;f[0][1]=l.substring(f[0][1].length)+f[0][1],c.start1-=v,c.start2-=v,c.length1+=v,c.length2+=v}if(c=o[o.length-1],f=c.diffs,f.length==0||f[f.length-1][0]!=i)f.push(new e.Diff(i,l)),c.length1+=s,c.length2+=s;else if(s>f[f.length-1][1].length){var v=s-f[f.length-1][1].length;f[f.length-1][1]+=l.substring(0,v),c.length1+=v,c.length2+=v}return l},e.prototype.patch_splitMax=function(o){for(var s=this.Match_MaxBits,l=0;l<o.length;l++)if(!(o[l].length1<=s)){var d=o[l];o.splice(l--,1);for(var c=d.start1,f=d.start2,v="";d.diffs.length!==0;){var g=new e.patch_obj,y=!0;for(g.start1=c-v.length,g.start2=f-v.length,v!==""&&(g.length1=g.length2=v.length,g.diffs.push(new e.Diff(i,v)));d.diffs.length!==0&&g.length1<s-this.Patch_Margin;){var b=d.diffs[0][0],_=d.diffs[0][1];b===n?(g.length2+=_.length,f+=_.length,g.diffs.push(d.diffs.shift()),y=!1):b===t&&g.diffs.length==1&&g.diffs[0][0]==i&&_.length>2*s?(g.length1+=_.length,c+=_.length,y=!1,g.diffs.push(new e.Diff(b,_)),d.diffs.shift()):(_=_.substring(0,s-g.length1-this.Patch_Margin),g.length1+=_.length,c+=_.length,b===i?(g.length2+=_.length,f+=_.length):y=!1,g.diffs.push(new e.Diff(b,_)),_==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(_.length))}v=this.diff_text2(g.diffs),v=v.substring(v.length-this.Patch_Margin);var x=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);x!==""&&(g.length1+=x.length,g.length2+=x.length,g.diffs.length!==0&&g.diffs[g.diffs.length-1][0]===i?g.diffs[g.diffs.length-1][1]+=x:g.diffs.push(new e.Diff(i,x))),y||o.splice(++l,0,g)}}},e.prototype.patch_toText=function(o){for(var s=[],l=0;l<o.length;l++)s[l]=o[l];return s.join("")},e.prototype.patch_fromText=function(o){var s=[];if(!o)return s;for(var l=o.split(`
`),d=0,c=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;d<l.length;){var f=l[d].match(c);if(!f)throw new Error("Invalid patch string: "+l[d]);var v=new e.patch_obj;for(s.push(v),v.start1=parseInt(f[1],10),f[2]===""?(v.start1--,v.length1=1):f[2]=="0"?v.length1=0:(v.start1--,v.length1=parseInt(f[2],10)),v.start2=parseInt(f[3],10),f[4]===""?(v.start2--,v.length2=1):f[4]=="0"?v.length2=0:(v.start2--,v.length2=parseInt(f[4],10)),d++;d<l.length;){var g=l[d].charAt(0);try{var y=decodeURI(l[d].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+y)}if(g=="-")v.diffs.push(new e.Diff(t,y));else if(g=="+")v.diffs.push(new e.Diff(n,y));else if(g==" ")v.diffs.push(new e.Diff(i,y));else{if(g=="@")break;if(g!=="")throw new Error('Invalid patch mode "'+g+'" in: '+y)}d++}}return s},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var o,s;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?s=this.start2+",0":this.length2==1?s=this.start2+1:s=this.start2+1+","+this.length2;for(var l=["@@ -"+o+" +"+s+` @@
`],d,c=0;c<this.diffs.length;c++){switch(this.diffs[c][0]){case n:d="+";break;case t:d="-";break;case i:d=" ";break}l[c+1]=d+encodeURI(this.diffs[c][1])+`
`}return l.join("").replace(/%20/g," ")},r.exports=e,r.exports.diff_match_patch=e,r.exports.DIFF_DELETE=t,r.exports.DIFF_INSERT=n,r.exports.DIFF_EQUAL=i}(uf)),uf.exports}var SM=wM();const EM=ls(SM);var Cg={exports:{}},Og;function CM(){return Og||(Og=1,function(r,e){(function(t){t(ko())})(function(t){t.defineSimpleMode=function(g,y){t.defineMode(g,function(b){return t.simpleMode(b,y)})},t.simpleMode=function(g,y){n(y,"start");var b={},_=y.meta||{},x=!1;for(var w in y)if(w!=_&&y.hasOwnProperty(w))for(var C=b[w]=[],k=y[w],D=0;D<k.length;D++){var I=k[D];C.push(new s(I,y)),(I.indent||I.dedent)&&(x=!0)}var $={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:x?[]:null}},copyState:function(F){var z={state:F.state,pending:F.pending,local:F.local,localState:null,indent:F.indent&&F.indent.slice(0)};F.localState&&(z.localState=t.copyState(F.local.mode,F.localState)),F.stack&&(z.stack=F.stack.slice(0));for(var ie=F.persistentStates;ie;ie=ie.next)z.persistentStates={mode:ie.mode,spec:ie.spec,state:ie.state==F.localState?z.localState:t.copyState(ie.mode,ie.state),next:z.persistentStates};return z},token:l(b,g),innerMode:function(F){return F.local&&{mode:F.local.mode,state:F.localState}},indent:v(b,_)};if(_)for(var R in _)_.hasOwnProperty(R)&&($[R]=_[R]);return $};function n(g,y){if(!g.hasOwnProperty(y))throw new Error("Undefined state "+y+" in simple mode")}function i(g,y){if(!g)return/(?:)/;var b="";return g instanceof RegExp?(g.ignoreCase&&(b="i"),g.unicode&&(b+="u"),g=g.source):g=String(g),new RegExp((y===!1?"":"^")+"(?:"+g+")",b)}function o(g){if(!g)return null;if(g.apply)return g;if(typeof g=="string")return g.replace(/\./g," ");for(var y=[],b=0;b<g.length;b++)y.push(g[b]&&g[b].replace(/\./g," "));return y}function s(g,y){(g.next||g.push)&&n(y,g.next||g.push),this.regex=i(g.regex),this.token=o(g.token),this.data=g}function l(g,y){return function(b,_){if(_.pending){var x=_.pending.shift();return _.pending.length==0&&(_.pending=null),b.pos+=x.text.length,x.token}if(_.local)if(_.local.end&&b.match(_.local.end)){var w=_.local.endToken||null;return _.local=_.localState=null,w}else{var w=_.local.mode.token(b,_.localState),C;return _.local.endScan&&(C=_.local.endScan.exec(b.current()))&&(b.pos=b.start+C.index),w}for(var k=g[_.state],D=0;D<k.length;D++){var I=k[D],$=(!I.data.sol||b.sol())&&b.match(I.regex);if($){I.data.next?_.state=I.data.next:I.data.push?((_.stack||(_.stack=[])).push(_.state),_.state=I.data.push):I.data.pop&&_.stack&&_.stack.length&&(_.state=_.stack.pop()),I.data.mode&&c(y,_,I.data.mode,I.token),I.data.indent&&_.indent.push(b.indentation()+y.indentUnit),I.data.dedent&&_.indent.pop();var R=I.token;if(R&&R.apply&&(R=R($)),$.length>2&&I.token&&typeof I.token!="string"){for(var F=2;F<$.length;F++)$[F]&&(_.pending||(_.pending=[])).push({text:$[F],token:I.token[F-1]});return b.backUp($[0].length-($[1]?$[1].length:0)),R[0]}else return R&&R.join?R[0]:R}}return b.next(),null}}function d(g,y){if(g===y)return!0;if(!g||typeof g!="object"||!y||typeof y!="object")return!1;var b=0;for(var _ in g)if(g.hasOwnProperty(_)){if(!y.hasOwnProperty(_)||!d(g[_],y[_]))return!1;b++}for(var _ in y)y.hasOwnProperty(_)&&b--;return b==0}function c(g,y,b,_){var x;if(b.persistent)for(var w=y.persistentStates;w&&!x;w=w.next)(b.spec?d(b.spec,w.spec):b.mode==w.mode)&&(x=w);var C=x?x.mode:b.mode||t.getMode(g,b.spec),k=x?x.state:t.startState(C);b.persistent&&!x&&(y.persistentStates={mode:C,spec:b.spec,state:k,next:y.persistentStates}),y.localState=k,y.local={mode:C,end:b.end&&i(b.end),endScan:b.end&&b.forceEnd!==!1&&i(b.end,!1),endToken:_&&_.join?_[_.length-1]:_}}function f(g,y){for(var b=0;b<y.length;b++)if(y[b]===g)return!0}function v(g,y){return function(b,_,x){if(b.local&&b.local.mode.indent)return b.local.mode.indent(b.localState,_,x);if(b.indent==null||b.local||y.dontIndentStates&&f(b.state,y.dontIndentStates)>-1)return t.Pass;var w=b.indent.length-1,C=g[b.state];e:for(;;){for(var k=0;k<C.length;k++){var D=C[k];if(D.data.dedent&&D.data.dedentIfLineStart!==!1){var I=D.regex.exec(_);if(I&&I[0]){w--,(D.next||D.push)&&(C=g[D.next||D.push]),_=_.slice(I[0].length);continue e}}}break}return w<0?0:b.indent[w]}}})}()),Cg.exports}CM();!window.CodeMirror&&(window.CodeMirror=Zx);const $l=window.CodeMirror||Zx,OM=us({name:"DefaultMode",props:{name:{type:String,default:`cm-textarea-${+new Date}`},value:{type:String,default:""},content:{type:String,default:""},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>null},placeholder:{type:String,default:""}},emits:{ready:r=>r,"update:cminstance":r=>r},setup(r,{emit:e}){const t=Ce(),n=Ce(null),i=()=>{n.value=Yd($l.fromTextArea(t.value,r.options)),e("update:cminstance",n.value);const o=qt(()=>r.cminstance,s=>{var l;s&&((l=r.cminstance)==null||l.setValue(r.value||r.content)),e("ready",je(n)),o==null||o()},{deep:!0})};return Xt(()=>{i()}),{textarea:t,initialize:i}}}),Hh=(r,e)=>{const t=r.__vccOpts||r;for(const[n,i]of e)t[n]=i;return t},kM=["name","placeholder"];function NM(r,e,t,n,i,o){return Y(),se("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,kM)}const kg=Hh(OM,[["render",NM]]);window.diff_match_patch=EM;window.DIFF_DELETE=-1;window.DIFF_INSERT=1;window.DIFF_EQUAL=0;const MM=us({name:"MergeMode",props:{options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=Ce(),n=Ce(),i=()=>{t.value=Yd($l.MergeView(n.value,r.options)),e("update:cminstance",t.value),e("ready",t)};return Xt(()=>{i()}),{mergeView:n,initialize:i}}}),AM={ref:"mergeView"};function TM(r,e,t,n,i,o){return Y(),se("div",AM,null,512)}const DM=Hh(MM,[["render",TM]]);function LM(r){const e=/#link#(.+)#link#/g,t=[];let n;for(n=e.exec(r);n;){const i=document.createElement("a"),o=JSON.parse(n[1]),s=Object.entries(o);for(const[l,d]of s)i.setAttribute(l,d);i.className="editor_custom_link",i.innerHTML="logDownload",t.push({start:n.index,end:n.index+n[0].length,node:i}),n=e.exec(r)}return t}function PM(r){const e=[];function t(){const n=/#log<(\w*)>log#((.|\r\n|\n)*?)#log<(\w*)>log#/g;let i;for(i=n.exec(r);i;){const o=i[0].replace(/\r\n/g,`
`).split(`
`),s=i[2].replace(/\r\n/g,`
`).split(`
`),l=document.createElement("span"),d=i[1];l.className=`c-editor--log__${d}`;let c=0;for(let f=0;f<o.length;f++){const v=o[f],g=s[f],y=l.cloneNode(!1);y.innerText=g,e.push({start:i.index+c,end:i.index+c+v.length,node:y}),c=c+v.length+1}i=n.exec(r)}}return t(),e}const Su=[{regex:/(\[.*?\])([ \t]*)(<error>[ \t])(.+)/,token:["tag","","error.strong","error.strong"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<info>)(.+)(.?)/,token:["tag","","bracket","bracket","hr"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<warning>)(.+)(.?)/,token:["tag","","comment","comment","hr"],sol:!0}];$l.defineSimpleMode("fclog",{start:[...Su,{regex:/.*/,token:"hr"}],error:[...Su,{regex:/.*/,token:"error.strong"}],info:[...Su,{regex:/.*/,token:"bracket"}],warning:[...Su,{regex:/.*\[/,token:"comment"}]});$l.defineSimpleMode("log",{start:[{regex:/^[=]+[^=]*[=]+/,token:"strong"},{regex:/([^\w])([A-Z][\w]*)/,token:["","string"]},{regex:/(^[A-Z][\w]*)/,token:"string"}]});const RM=us({name:"CodemirrorFclog",props:{value:{type:String,default:""},name:{type:String,default:`cm-textarea-${+new Date}`},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=Ce(),n=Ce(null),i=(s=r.cminstance)=>{s.getAllMarks().forEach(c=>c.clear());const l=s.getValue(),d=[].concat(LM(l)).concat(PM(l));for(let c=0;c<d.length;c++){const f=d[c];s.markText(s.posFromIndex(f.start),s.posFromIndex(f.end),{replacedWith:f.node})}},o=()=>{var s;n.value=Yd($l.fromTextArea(t.value,r.options)),e("update:cminstance",je(n)),(s=n.value)==null||s.on("change",i)};return qt(()=>r.cminstance,s=>{var l;s&&(i(r.cminstance),(l=r.cminstance)==null||l.setValue(r.value),e("ready",n))},{deep:!0,immediate:!0}),Xt(()=>{o()}),{initialize:o,textarea:t}}}),IM=["name","placeholder"];function BM(r,e,t,n,i,o){return Y(),se("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,IM)}const jM=Hh(RM,[["render",BM]]),Qx={"update:value":()=>!0,change:(r,e)=>({value:r,cm:e}),input:()=>!0,ready:r=>r},HM=["changes","scroll","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],$M=()=>{const r={};return HM.forEach(e=>{r[e]=(...t)=>t}),r},FM={...Qx,...$M()},df={mode:"text",theme:"default",lineNumbers:!0,smartIndent:!0,indentUnit:2,styleActiveLine:!0};function zM(r){Promise.resolve().then(()=>{const e=r.getScrollInfo();r.scrollTo(e.left,e.height)})}const WM=({props:r,cminstance:e,emit:t,internalInstance:n,content:i})=>{const o=Kt(()=>{var l;return r.merge?(l=je(e))==null?void 0:l.editor():je(e)}),s=()=>{const l=[];return Object.keys(n==null?void 0:n.vnode.props).forEach(d=>{if(d.startsWith("on")){const c=d.replace(d[2],d[2].toLowerCase()).slice(2);!Qx[c]&&l.push(c)}}),l};return{listenerEvents:()=>{o.value.on("change",d=>{const c=d.getValue();c===i.value&&c!==""||(i.value=c,t("update:value",i.value||""),t("input",i.value||" "),Promise.resolve().then(()=>{t("change",i.value,d)}),r.keepCursorInEnd&&zM(d))});const l={};s().filter(d=>!l[d]&&(l[d]=!0)).forEach(d=>{o.value.on(d,(...c)=>{t(d,...c)})})}}};function UM({props:r,cminstance:e,presetRef:t}){const n=Ce("100%"),i=Ce("100%"),o=Kt(()=>{var g;return r.merge?(g=je(e))==null?void 0:g.editor():je(e)}),s=()=>{_n(()=>{var g;(g=o.value)==null||g.refresh()})},l=g=>g?!(g&&isNaN(+g)):!1,d=(g=r.width,y=r.height)=>{var b;let _="100%",x="100%";l(g)?_=`${String(g)}px`:g&&(_=g),l(y)?x=`${String(y)}px`:y&&(x=y),n.value=_,i.value=x,(b=o.value)==null||b.setSize("100%","100%")},c=()=>{var g;const y=(g=o.value)==null?void 0:g.getWrapperElement();y==null||y.remove()},f=()=>{var g,y,b;const _=(g=o.value)==null?void 0:g.getDoc().getHistory();(y=t.value)==null||y.initialize(),c(),(b=o.value)==null||b.getDoc().setHistory(_)},v=()=>{const g=document.querySelector(".CodeMirror-gutters");return(g==null?void 0:g.style.left.replace("px",""))!=="0"};return{reload:f,refresh:s,resize:d,destroy:c,containerWidth:n,containerHeight:i,reviseStyle:()=>{if(s(),!v())return;const g=setInterval(()=>{v()?s():clearInterval(g)},60),y=setTimeout(()=>{clearInterval(g),clearTimeout(y)},400)}}}const VM=us({__name:"index",props:{value:{type:String,default:""},options:{type:Object,default:()=>df},globalOptions:{type:Object,default:()=>df},placeholder:{type:String,default:""},border:{type:Boolean,default:!1},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},originalStyle:{type:Boolean,default:!1},keepCursorInEnd:{type:Boolean,default:!1},merge:{type:Boolean,default:!1},name:{type:String,default:""},marker:{type:Function,default:()=>null},unseenLines:{type:Array,default:()=>[]}},emits:FM,setup(r,{expose:e,emit:t}){var n,i,o;typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value(G){if(G==null)throw new TypeError("Cannot convert undefined or null to object");const Q=Object(G);for(let T=1;T<arguments.length;T++){const W=arguments[T];if(W!=null)for(const P in W)Object.prototype.hasOwnProperty.call(W,P)&&(Q[P]=W[P])}return Q},writable:!0,configurable:!0});const s=r,l=t,d=Ce(null),c=Ce(""),f=JE(kg),v=Ce({foldGutter:!0,...df,...s.globalOptions,...s.options,gutters:[...new Set(["CodeMirror-linenumbers","CodeMirror-foldgutter",...((n=s.options)==null?void 0:n.gutters)||[]])]}),g=ZE(),y=s.name||((o=(i=g==null?void 0:g.parent)==null?void 0:i.type)==null?void 0:o.name)||void 0,b=Ce(null),_=Kt(()=>{var G;return s.merge?(G=je(d))==null?void 0:G.editor():je(d)}),{refresh:x,resize:w,destroy:C,containerHeight:k,containerWidth:D,reviseStyle:I}=UM({props:s,cminstance:d,presetRef:b}),{listenerEvents:$}=WM({props:s,cminstance:d,emit:l,internalInstance:g,content:c}),R=()=>{s.unseenLines!==void 0&&s.marker!==void 0&&s.unseenLines.forEach(G=>{var Q,T;const W=(Q=d.value)==null?void 0:Q.lineInfo(G);(T=d.value)==null||T.setGutterMarker(G,"breakpoints",W!=null&&W.gutterMarkers?null:s.marker())})},F=G=>{var Q,T;const W=(Q=d.value)==null?void 0:Q.getValue();G!==W&&((T=d.value)==null||T.setValue(G),c.value=G,I()),R()},z=()=>{$(),R(),w(s.width,s.height),l("ready",d.value),qt([()=>s.width,()=>s.height],([G,Q])=>{w(G,Q)},{deep:!0})},ie=()=>{if(s.options.mode==="fclog"||s.options.mode==="log"){f.value=jM;return}if(s.merge){f.value=DM;return}f.value=kg};return qt(()=>s.options,G=>{var Q;for(const T in s.options)(Q=_.value)==null||Q.setOption(T,je(G[T]))},{deep:!0}),qt(()=>s.value,G=>{F(G)}),qt(()=>s.merge,ie,{immediate:!0}),Ei(()=>{C()}),e({cminstance:d,resize:w,refresh:x,destroy:C}),(G,Q)=>(Y(),se("div",{class:wn(["codemirror-container",{merge:G.$props.merge,bordered:G.$props.border||G.$props.merge&&!s.originalStyle,"original-style":s.originalStyle}]),style:Si({height:je(k),width:je(D)})},[(Y(),Fe(Xy(f.value),QE({ref_key:"presetRef",ref:b,cminstance:d.value,"onUpdate:cminstance":Q[0]||(Q[0]=T=>d.value=T),style:{height:"100%"}},{...G.$props,...G.$attrs,options:v.value,name:je(y),content:c.value},{onReady:z}),null,16,["cminstance"]))],6))}});function XM(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}XM(`.codemirror-container {
  position: relative;
  display: inline-block;
  height: 100%;
  width: fit-content;
  font-size: 13px;
  overflow: hidden;
}
.codemirror-container.bordered {
  border: 1px solid #aaaaaa;
}

.codemirror-container .editor_custom_link {
  cursor: pointer;
  color: #1474f1;
  text-decoration: underline;
}
.codemirror-container .editor_custom_link:hover {
  color: #04b4fa;
}
.codemirror-container:not(.original-style) .CodeMirror-lines .CodeMirror-placeholder.CodeMirror-line-like {
  color: #666;
}
.codemirror-container:not(.original-style) .CodeMirror,
.codemirror-container:not(.original-style) .CodeMirror-merge-pane {
  height: 100%;
  font-family: consolas !important;
}
.codemirror-container:not(.original-style) .CodeMirror-merge,
.codemirror-container:not(.original-style) .CodeMirror-merge-right .CodeMirror {
  height: 100%;
  border: none !important;
}
.codemirror-container:not(.original-style) .c-editor--log__error {
  color: #bb0606;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__info {
  color: #333333;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__warning {
  color: #ee9900;
}
.codemirror-container:not(.original-style) .c-editor--log__success {
  color: #669600;
}
.codemirror-container:not(.original-style) .cm-header,
.codemirror-container:not(.original-style) .cm-strong {
  font-weight: bold;
}
`);const Ng={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(r,{expose:e,emit:t}){const n=t,i=Ce(""),o=r;qt(()=>o.value,g=>{i.value=g},{immediate:!0});const s={mode:"text/javascript",theme:"dracula"},l=Ce(null),d=g=>{n("update:value",g)},c=()=>{l.value.refresh()},f=()=>{},v=()=>{};return e({handleRefresh:c}),(g,y)=>(Y(),se("div",null,[B(je(VM),{onWheel:y[0]||(y[0]=dn(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":y[1]||(y[1]=b=>i.value=b),options:s,ref_key:"cmRef",ref:l,height:o.height,width:o.width,onChange:d,onInput:v,onReady:f},null,8,["value","height","width"])]))}},GM={class:"problem-optimization-form"},YM={class:"node-form-content"},qM={class:"gray-block"},KM={class:"array-form-box"},JM={class:"flex-block-item"},ZM=["onClick"],QM={class:"code-edit-box"},eA={class:"title-block"},tA={class:"code-box"},nA={class:"flex-block-item"},rA={class:"gray-block mt16"},iA={class:"output-box"},oA={class:"flex-block-item",style:{gap:"12px"}},aA=["onClick"],sA=["onClick"],lA={key:0,class:"sub-field-box"},uA={style:{margin:"40px 0 24px 0"}},Mg=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,dA={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Ce([]);function o(){const Q=n.lf.getNodeModelById(n.nodeId);if(Q){let T=Q.getAllParentVariable();i.value=s(T)}}function s(Q){return Q.forEach(T=>{T.typ=="node"?T.node_type==1?T.value="global":T.value=T.node_id:T.value=T.key,T.children&&T.children.length>0&&(T.children=s(T.children))}),Q}const l=Ce(),d=Vt({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),c=()=>{d.main_func=Mg};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function v(Q){return Q.forEach(T=>{T.cu_key=Math.random()*1e4,T.subs&&T.subs.length?v(T.subs):T.subs=[]}),Q}const g=()=>{const Q=JSON.stringify({code_run:{...d,params:y()}});t("update-node",{...n.node,...d,node_params:Q})};function y(){let Q=[];return d.params.forEach(T=>{Q.push({field:T.field,variable:T.variable&&T.variable.length>0?T.variable.join("."):""})}),Q}const b=()=>{try{let Q=n.node.dataRaw||n.node.node_params||"{}",T=JSON.parse(Q).code_run||{};T=JSON.parse(JSON.stringify(T)),o();for(let W in T){if(W=="params"){T[W]&&T[W].length>0?d[W]=T[W].map(P=>({...P,cu_key:Math.random()*1e4})):d[W]=[];continue}if(W=="output"){d.output=v(T[W]);continue}d[W]=T[W]}d.main_func=d.main_func||Mg,d.params=d.params.map(W=>{let P="";for(let le=0;le<f.length;le++)if(W.variable.indexOf(f[le])>-1){P=f[le];break}if(P!=""){let le=W.variable.split(".");W.variable=[le[0],P]}else W.variable=W.variable.split(".");return{...W,key:Math.random()*1e4}})}catch(Q){}};qt(()=>d,()=>{g()},{deep:!0});const _=()=>{d.params.push({key:"",value:"",cu_key:Math.random()*1e4})},x=Q=>{d.params.splice(Q,1)},w=()=>{d.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},C=Q=>{d.output.splice(Q,1)},k=Q=>{Q.subs=[]},D=Q=>{d.output[Q].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},I=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],$=Q=>{Q||o()},R=Ce(!1),F=Ce(null),z=()=>{R.value=!0,F.value&&F.value.handleRefresh()},ie=()=>{R.value=!1},G=()=>{t("close")};return Xt(()=>{b()}),(Q,T)=>{const W=Sr,P=aa,le=cs,me=Wi,he=In,Ne=fs,ye=Ui,ae=Rr,Re=Pr,Le=ii,Ve=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:G},null,8,["title","iconName"])]),default:V(()=>[E("div",GM,[E("div",YM,[B(Ve,{ref_key:"formRef",ref:l,layout:"vertical",model:d},{default:V(()=>[E("div",qM,[T[10]||(T[10]=E("div",{class:"gray-block-title"},"输入",-1)),E("div",KM,[T[6]||(T[6]=E("div",{class:"form-item-label"},"自定义输入参数",-1)),(Y(!0),se(it,null,ft(d.params,(Ae,te)=>(Y(),se("div",{class:"form-item-list",key:te},[B(me,{label:null,name:["params",te,"variable"]},{default:V(()=>[E("div",JM,[B(P,null,{default:V(()=>[B(W,{style:{width:"190px"},value:Ae.field,"onUpdate:value":ce=>Ae.field=ce,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),B(le,{value:Ae.variable,"onUpdate:value":ce=>Ae.variable=ce,onDropdownVisibleChange:$,style:{width:"400px"},options:i.value,allowClear:!1,displayRender:({labels:ce})=>ce.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),E("div",{class:"btn-hover-wrap",onClick:ce=>x(te)},[B(je(cr))],8,ZM)])]),_:2},1032,["name"])]))),128)),B(he,{onClick:_,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>T[5]||(T[5]=[He("添加参数")])),_:1,__:[5]},8,["icon"])]),E("div",QM,[E("div",eA,[T[7]||(T[7]=E("div",null,"JavaScript 代码",-1)),B(Ne,{gap:16,align:"center"},{default:V(()=>[E("a",{onClick:c},"还原为模板"),E("div",{class:"btn-hover-wrap",onClick:z},[B(je(Rh))])]),_:1})]),E("div",tA,[B(Ng,{value:d.main_func,"onUpdate:value":T[0]||(T[0]=Ae=>d.main_func=Ae),width:410,height:170},null,8,["value"])])]),B(me,{name:"timeout",class:"mt16"},{label:V(()=>[B(Ne,{gap:2},{default:V(()=>T[8]||(T[8]=[He("超时时长")])),_:1,__:[8]})]),default:V(()=>[E("div",nA,[B(ye,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:d.timeout,"onUpdate:value":T[1]||(T[1]=Ae=>d.timeout=Ae),min:0,max:3e3},null,8,["value"]),T[9]||(T[9]=He(" 秒 "))])]),_:1})]),E("div",rA,[T[13]||(T[13]=E("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),E("div",iA,[T[12]||(T[12]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:T[2]||(T[2]=dn(()=>{},["stop"]))},[(Y(!0),se(it,null,ft(d.output,(Ae,te)=>(Y(),se("div",{class:"form-item-list",key:te},[B(me,{label:null,name:["output",te,"key"]},{default:V(()=>[E("div",oA,[B(W,{style:{width:"214px"},value:Ae.key,"onUpdate:value":ce=>Ae.key=ce,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(P,null,{default:V(()=>[B(Re,{onChange:ce=>k(Ae),value:Ae.typ,"onUpdate:value":ce=>Ae.typ=ce,placeholder:"请选择",style:{width:"214px"}},{default:V(()=>[(Y(),se(it,null,ft(I,ce=>B(ae,{value:ce.value,key:ce.value},{default:V(()=>[He(De(ce.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Ae.typ=="object"?(Y(),se("div",{key:0,class:"btn-hover-wrap",onClick:ce=>D(te)},[B(je(hs))],8,aA)):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:ce=>C(te)},[B(je(cr))],8,sA)]),Ae.subs&&Ae.subs.length>0?(Y(),se("div",lA,[B(P,null,{default:V(()=>[B(pM,{data:Ae.subs,level:2,typOptions:I},null,8,["data"])]),_:2},1024)])):Qe("",!0)]),_:2},1032,["name"])]))),128)),B(he,{onClick:w,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>T[11]||(T[11]=[He("添加参数")])),_:1,__:[11]},8,["icon"])],32)])]),T[15]||(T[15]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"异常处理"),E("div",null,"运行代码报错时执行该分支")],-1)),B(Le,{open:R.value,"onUpdate:open":T[4]||(T[4]=Ae=>R.value=Ae),title:"编辑代码",width:746},{footer:V(()=>[B(he,{type:"primary",onClick:ie},{default:V(()=>T[14]||(T[14]=[He("确定")])),_:1,__:[14]})]),default:V(()=>[E("div",uA,[B(Ng,{ref_key:"codeEditBoxRef",ref:F,value:d.main_func,"onUpdate:value":T[3]||(T[3]=Ae=>d.main_func=Ae),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1,__:[15]},8,["model"])])])]),_:1})}}},cA=pt(dA,[["__scopeId","data-v-f417e76c"]]),fA={class:"sub-field-item"},hA=["onClick"],pA=["onClick"],vA={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=Kt(()=>e.level>2?e.typOptions.filter(d=>d.value!="object"):e.typOptions),n=Kt(()=>e.level==2?"180px":"146px"),i=(d,c)=>{c[d].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(d,c)=>{c.splice(d,1)},s=d=>{d.subs=[]},l=d=>d.typ=="object"&&e.level<=2;return(d,c)=>{const f=Sr,v=Rr,g=Pr,y=kn("SubsKey",!0);return Y(!0),se(it,null,ft(e.data,(b,_)=>(Y(),se("div",{class:wn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:b.cu_key},[E("div",fA,[c[0]||(c[0]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(f,{class:"mr12",style:Si({width:n.value}),value:b.key,"onUpdate:value":x=>b.key=x,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),c[1]||(c[1]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(g,{class:"mr12",onChange:x=>s(b),value:b.typ,"onUpdate:value":x=>b.typ=x,placeholder:"请选择",style:Si({width:n.value})},{default:V(()=>[(Y(!0),se(it,null,ft(t.value,x=>(Y(),Fe(v,{value:x.value},{default:V(()=>[He(De(x.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(b)?(Y(),se("div",{key:0,class:"btn-hover-wrap mr12",onClick:x=>i(_,e.data)},[B(je(hs))],8,hA)):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:x=>o(_,e.data)},[B(je(cr))],8,pA)]),b.subs&&b.subs.length>0?(Y(),Fe(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:b.subs},null,8,["level","typOptions","data"])):Qe("",!0)],2))),128)}}},gA=pt(vA,[["__scopeId","data-v-31e10652"]]),mA={class:"problem-optimization-form"},yA={class:"node-form-content"},_A={class:"gray-block"},bA={class:"flex-block-item"},xA={class:"array-form-box"},wA={class:"flex-block-item"},SA={class:"at-input-flex1"},EA={class:"field-list-item"},CA={class:"field-label"},OA={class:"field-type"},kA=["onClick"],NA={class:"array-form-box"},MA={class:"flex-block-item"},AA={class:"at-input-flex1"},TA={class:"field-list-item"},DA={class:"field-label"},LA={class:"field-type"},PA=["onClick"],RA={key:0},IA={key:0,class:"array-form-box"},BA={class:"flex-block-item"},jA={class:"at-input-flex1"},HA={class:"field-list-item"},$A={class:"field-label"},FA={class:"field-type"},zA=["onClick"],WA={class:"field-list-item"},UA={class:"field-label"},VA={class:"field-type"},XA={class:"flex-block-item"},GA={class:"gray-block mt16"},YA={class:"output-box"},qA={class:"flex-block-item",style:{gap:"12px"}},KA=["onClick"],JA=["onClick"],ZA={key:0,class:"sub-field-box"},QA={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Ce([]),o=Vt({}),s=(ie,G,Q)=>{if(ie){let T=`at_input_${G}_${Q}`;o[T]=ie}},l=(ie,G,Q,T)=>{ie=="body_raw"?(f.body_raw=G,f.body_raw_tags=Q):(T.tags=Q,T.value=G)},d=()=>{const ie=n.lf.getNodeModelById(n.nodeId);if(ie){let G=ie.getAllParentVariable();G.forEach(Q=>{Q.tags=Q.tags||[]}),i.value=G}},c=Ce(),f=Vt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function v(ie){return ie.forEach(G=>{G.cu_key=Math.random()*1e4,G.subs&&G.subs.length?v(G.subs):G.subs=[]}),ie}const g=()=>{const ie=JSON.stringify({curl:{...f}});t("update-node",{...n.node,...f,node_params:ie})},y=()=>{try{let ie=n.node.dataRaw||n.node.node_params||"{}",G=JSON.parse(ie).curl||{};G=JSON.parse(JSON.stringify(G)),d();for(let Q in G){if(Q=="headers"||Q=="params"||Q=="body"){G[Q]&&G[Q].length>0?f[Q]=G[Q].map(T=>({...T,cu_key:Math.random()*1e4})):f[Q]=[];continue}if(Q=="output"){f.output=v(G[Q]);continue}f[Q]=G[Q]}}catch(ie){}};qt(()=>f,()=>{g()},{deep:!0});const b=()=>{f.headers.push({key:"",value:"",cu_key:Math.random()*1e4})},_=ie=>{f.headers.splice(ie,1)},x=()=>{f.params.push({key:"",value:"",cu_key:Math.random()*1e4})},w=ie=>{f.params.splice(ie,1)},C=()=>{f.body.push({key:"",value:"",cu_key:Math.random()*1e4})},k=ie=>{f.body.splice(ie,1)},D=()=>{f.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},I=ie=>{f.output.splice(ie,1)},$=ie=>{ie.subs=[]},R=ie=>{f.output[ie].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],z=()=>{t("close")};return Xt(()=>{y()}),(ie,G)=>{const Q=Rr,T=Pr,W=aa,P=Sr,le=Wi,me=In,he=Ky,Ne=qy,ye=fs,ae=Ui,Re=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:z},null,8,["title","iconName"])]),default:V(()=>[E("div",mA,[E("div",yA,[B(Re,{ref_key:"formRef",ref:c,layout:"vertical",model:f},{default:V(()=>[E("div",_A,[G[19]||(G[19]=E("div",{class:"gray-block-title"},"输入",-1)),B(le,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:V(()=>[E("div",bA,[B(W,null,{default:V(()=>[B(T,{value:f.method,"onUpdate:value":G[0]||(G[0]=Le=>f.method=Le),style:{width:"120px"}},{default:V(()=>[B(Q,{value:"POST"},{default:V(()=>G[7]||(G[7]=[He("POST")])),_:1,__:[7]}),B(Q,{value:"GET"},{default:V(()=>G[8]||(G[8]=[He("GET")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),B(P,{class:"flex1",value:f.rawurl,"onUpdate:value":G[1]||(G[1]=Le=>f.rawurl=Le),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),E("div",xA,[G[10]||(G[10]=E("div",{class:"form-item-label"},"HEADERS",-1)),(Y(!0),se(it,null,ft(f.headers,(Le,Ve)=>(Y(),se("div",{class:"form-item-list",key:Ve},[B(le,{label:null,name:["headers",Ve,"value"]},{default:V(()=>[E("div",wA,[B(W,null,{default:V(()=>[B(P,{style:{width:"120px"},value:Le.key,"onUpdate:value":Ae=>Le.key=Ae,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",SA,[B(fr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Ae=>s(Ae,"headers",Ve),options:i.value,defaultSelectedList:Le.tags,defaultValue:Le.value,onOpen:d,onChange:(Ae,te)=>l("headers",Ae,te,Le,Ve),placeholder:"请输入变量值，键入“/”插入变量"},{option:V(({label:Ae,payload:te})=>[E("div",EA,[E("div",CA,De(Ae),1),E("div",OA,De(te.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:Ae=>_(Ve)},[B(je(cr))],8,kA)])]),_:2},1032,["name"])]))),128)),B(me,{onClick:b,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>G[9]||(G[9]=[He("添加参数")])),_:1,__:[9]},8,["icon"])]),E("div",NA,[G[12]||(G[12]=E("div",{class:"form-item-label"},"PARAMS",-1)),(Y(!0),se(it,null,ft(f.params,(Le,Ve)=>(Y(),se("div",{class:"form-item-list",key:Ve},[B(le,{label:null,name:["params",Ve,"value"]},{default:V(()=>[E("div",MA,[B(W,null,{default:V(()=>[B(P,{style:{width:"120px"},value:Le.key,"onUpdate:value":Ae=>Le.key=Ae,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",AA,[B(fr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Ae=>s(Ae,"params",Ve),options:i.value,defaultSelectedList:Le.tags,defaultValue:Le.value,onOpen:d,onChange:(Ae,te)=>l("params",Ae,te,Le,Ve),placeholder:"请输入变量值，键入“/”插入变量"},{option:V(({label:Ae,payload:te})=>[E("div",TA,[E("div",DA,De(Ae),1),E("div",LA,De(te.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:Ae=>w(Ve)},[B(je(cr))],8,PA)])]),_:2},1032,["name"])]))),128)),B(me,{onClick:x,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>G[11]||(G[11]=[He("添加参数")])),_:1,__:[11]},8,["icon"])]),f.method=="POST"?(Y(),se("div",RA,[B(le,{label:"BODY",name:"type",class:"line-height-22"},{default:V(()=>[B(Ne,{value:f.type,"onUpdate:value":G[2]||(G[2]=Le=>f.type=Le)},{default:V(()=>[B(he,{value:0},{default:V(()=>G[13]||(G[13]=[He("none")])),_:1,__:[13]}),B(he,{value:1},{default:V(()=>G[14]||(G[14]=[He("x-www-form-urlencoded")])),_:1,__:[14]}),B(he,{value:2},{default:V(()=>G[15]||(G[15]=[He("JSON")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),f.type==1?(Y(),se("div",IA,[(Y(!0),se(it,null,ft(f.body,(Le,Ve)=>(Y(),se("div",{class:"form-item-list",key:Ve},[B(le,{label:null,name:["body",Ve,"value"],rules:{required:!0}},{default:V(()=>[E("div",BA,[B(W,null,{default:V(()=>[B(P,{style:{width:"120px"},value:Le.key,"onUpdate:value":Ae=>Le.key=Ae,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",jA,[B(fr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Ae=>s(Ae,"body",Ve),options:i.value,defaultSelectedList:Le.tags,defaultValue:Le.value,onOpen:d,onChange:(Ae,te)=>l("body",Ae,te,Le,Ve),placeholder:"请输入变量值，键入“/”插入变量"},{option:V(({label:Ae,payload:te})=>[E("div",HA,[E("div",$A,De(Ae),1),E("div",FA,De(te.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:Ae=>k(Ve)},[B(je(cr))],8,zA)])]),_:2},1032,["name"])]))),128)),B(me,{onClick:C,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>G[16]||(G[16]=[He("添加参数")])),_:1,__:[16]},8,["icon"])])):Qe("",!0),f.type==2?(Y(),Fe(le,{key:1,label:null,name:"body_raw"},{default:V(()=>[B(fr,{type:"textarea",options:i.value,defaultSelectedList:f.body_raw_tags,defaultValue:f.body_raw,ref:Le=>s(Le,"body","body_raw"),onOpen:d,onChange:G[3]||(G[3]=(Le,Ve)=>l("body_raw",Le,Ve)),placeholder:"请输入变量值，键入“/”插入变量"},{option:V(({label:Le,payload:Ve})=>[E("div",WA,[E("div",UA,De(Le),1),E("div",VA,De(Ve.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):Qe("",!0)])):Qe("",!0),B(le,{name:"timeout"},{label:V(()=>[B(ye,{gap:2},{default:V(()=>G[17]||(G[17]=[He("超时时长")])),_:1,__:[17]})]),default:V(()=>[E("div",XA,[B(ae,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:f.timeout,"onUpdate:value":G[4]||(G[4]=Le=>f.timeout=Le),min:0,max:3e3},null,8,["value"]),G[18]||(G[18]=He(" 秒 "))])]),_:1})]),E("div",GA,[E("div",{class:"gray-block-title",onClick:G[5]||(G[5]=(...Le)=>ie.test&&ie.test(...Le))},"输出 (输出字段提取)"),E("div",YA,[G[21]||(G[21]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:G[6]||(G[6]=dn(()=>{},["stop"]))},[(Y(!0),se(it,null,ft(f.output,(Le,Ve)=>(Y(),se("div",{class:"form-item-list",key:Ve},[B(le,{label:null,name:["output",Ve,"key"]},{default:V(()=>[E("div",qA,[B(P,{style:{width:"214px"},value:Le.key,"onUpdate:value":Ae=>Le.key=Ae,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(W,null,{default:V(()=>[B(T,{onChange:Ae=>$(Le),value:Le.typ,"onUpdate:value":Ae=>Le.typ=Ae,placeholder:"请选择",style:{width:"214px"}},{default:V(()=>[(Y(),se(it,null,ft(F,Ae=>B(Q,{value:Ae.value,key:Ae.value},{default:V(()=>[He(De(Ae.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Le.typ=="object"?(Y(),se("div",{key:0,class:"btn-hover-wrap",onClick:Ae=>R(Ve)},[B(je(hs))],8,KA)):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:Ae=>I(Ve)},[B(je(cr))],8,JA)]),Le.subs&&Le.subs.length>0?(Y(),se("div",ZA,[B(W,null,{default:V(()=>[B(gA,{data:Le.subs,level:2,typOptions:F},null,8,["data"])]),_:2},1024)])):Qe("",!0)]),_:2},1032,["name"])]))),128)),B(me,{onClick:D,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>G[20]||(G[20]=[He("添加参数")])),_:1,__:[20]},8,["icon"])],32)])])]),_:1},8,["model"])])])]),_:1})}}},eT=pt(QA,[["__scopeId","data-v-299c49ec"]]),Pn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},e1={string:[Pn.EQUALITY.IS,Pn.EQUALITY.IS_NOT,Pn.TEXT.CONTAIN,Pn.TEXT.NOT_CONTAIN,Pn.NULLABILITY.EMPTY,Pn.NULLABILITY.NOT_EMPTY],integer:[Pn.COMPARISON.GT,Pn.COMPARISON.LT,Pn.COMPARISON.GTE,Pn.COMPARISON.LTE,Pn.EQUALITY.EQ,Pn.COMPARISON.BETWEEN],number:[Pn.COMPARISON.GT,Pn.COMPARISON.LT,Pn.COMPARISON.GTE,Pn.COMPARISON.LTE,Pn.EQUALITY.EQ,Pn.COMPARISON.BETWEEN],boolean:[Pn.BOOLEAN.TRUE,Pn.BOOLEAN.FALSE]},t1=r=>e1[r]||[],$h=(r,e)=>{const n=t1(e).find(i=>i.value===r);return(n==null?void 0:n.label)||r},tT={class:"query-condition-filter"},nT={class:"condition-select-box"},rT={class:"select-wrapper"},iT={class:"field-items"},oT={class:"field-select-box"},aT={class:"operator-select-box"},sT={class:"field-value-box"},lT={key:0,class:"site-input-group-wrapper"},uT={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},dT={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},cT=["onClick"],fT={class:"add-btn-box"},hT={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(r,{emit:e}){const t=e,n=r,i=wt("getNode"),o=Vt({list:n.where,type:n.type});qt(()=>n.where,k=>{o.list=k}),qt(()=>n.type,k=>{o.type=k});const s=Kt(()=>n.where.length>1),l=Kt(()=>e1),d=Ce([]),c=()=>{let k=i().getAllParentVariable();d.value=k||[]},f=()=>{c()},v=()=>{let k={type:o.type,list:o.list};t("change",k)},g=(k,D,I,$)=>{o.list[$].rule_value1=k,o.list[$].atTags=D,v()},y=(k,D,I,$)=>{o.list[$].rule_value2=k,o.list[$].atTags2=D,v()},b=()=>{let k={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list.push(k),v()},_=k=>{o.list.splice(k,1),v()},x=(k,D)=>{let I=t1(D.type),$={form_field_id:D.value,field_name:D.name,field_type:D.type,rule:I[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list[k]=$,v()},w=(k,D)=>{let I=o.list[k];I.rule=D.value,I.rule_value1="",I.rule_value2="",I.atTags=[],I.atTags2=[],v()},C=({key:k})=>{o.type=k,t("changeType",k),v()};return Xt(()=>{c()}),(k,D)=>{const I=Lh,$=Dh,R=Ph,F=Rr,z=Pr,ie=Sr,G=ni,Q=In,T=Ci;return Y(),se("div",{class:wn(["query-condition-filter-warpper",{"is-multiple":s.value}])},[E("div",tT,[D[5]||(D[5]=E("div",{class:"auxiliary-line"},null,-1)),E("div",nT,[E("div",rT,[B(R,null,{overlay:V(()=>[B($,{style:{width:"100px"},onClick:C},{default:V(()=>[(Y(),Fe(I,{key:1},{default:V(()=>D[1]||(D[1]=[E("a",{href:"javascript:;"},"且",-1)])),_:1,__:[1]})),(Y(),Fe(I,{key:2},{default:V(()=>D[2]||(D[2]=[E("a",{href:"javascript:;"},"或",-1)])),_:1,__:[2]}))]),_:1})]),default:V(()=>[E("a",{class:"ant-dropdown-link",onClick:D[0]||(D[0]=dn(()=>{},["prevent"]))},[He(De(o.type==1?"且":"或")+" ",1),B(je(ds))])]),_:1})])]),E("div",iT,[(Y(!0),se(it,null,ft(o.list,(W,P)=>(Y(),se("div",{class:"field-item",key:W.field},[E("div",oT,[B(z,{style:{width:"100px"},value:W.form_field_id,"onUpdate:value":le=>W.form_field_id=le,onChange:(le,me)=>x(P,me)},{default:V(()=>[B(F,{value:0,type:"integer",name:"ID",key:"id"},{default:V(()=>D[3]||(D[3]=[He("ID")])),_:1,__:[3]}),(Y(!0),se(it,null,ft(n.fieldOptions,le=>(Y(),Fe(F,{value:le.id,type:le.type,name:le.name,key:le.id},{default:V(()=>[He(De(le.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",aT,[B(z,{value:W.rule,"onUpdate:value":le=>W.rule=le,style:{width:"100px"},onChange:(le,me)=>w(P,me)},{default:V(()=>[(Y(!0),se(it,null,ft(l.value[W.field_type],le=>(Y(),Fe(F,{value:le.value,key:le.value},{default:V(()=>[He(De(le.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",sT,[W.rule==="between"?(Y(),se("div",lT,[E("div",uT,[B(fr,{options:d.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(le,me)=>g(le,me,W,P),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),D[4]||(D[4]=E("span",{class:"site-input-split"},"~",-1)),E("div",dT,[B(fr,{options:d.value,defaultValue:W.rule_value2,defaultSelectedList:W.atTags2,onOpen:f,onChange:(le,me)=>y(le,me,W,P),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(W.field_type)?(Y(),Fe(ie,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(W.field_type)?(Y(),Fe(fr,{key:2,options:d.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(le,me)=>g(le,me,W,P),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(Y(),Fe(fr,{key:3,options:d.value,defaultValue:W.rule_value1,defaultSelectedList:W.atTags,onOpen:f,onChange:(le,me)=>g(le,me,W,P),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),E("span",{class:"field-del-btn",onClick:le=>_(P)},[B(G,{class:"del-icon",name:"close-circle"})],8,cT)]))),128))])]),E("div",fT,[r.disabled?(Y(),Fe(T,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:V(()=>[E("span",null,[B(Q,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:V(()=>[B(je(Rn)),D[6]||(D[6]=He(" 添加条件 "))]),_:1,__:[6]})])]),_:1})):(Y(),Fe(Q,{key:1,class:"add-btn",type:"dashed",block:"",onClick:b},{default:V(()=>[B(je(Rn)),D[7]||(D[7]=He(" 添加条件 "))]),_:1,__:[7]}))])],2)}}},Fh=pt(hT,[["__scopeId","data-v-c3ccab04"]]),pT={class:"delete-data-form"},vT={class:"node-box-content"},gT={class:"setting-box"},mT={class:"setting-box"},yT={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(r){const e=r,t=wt("setData"),n=Oo();let i={};const o=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),s=({type:b,list:_})=>{o.formData.typ=b,o.formData.where=_,c()},l=(b,_)=>{_?(o.formData.form_name=_.name,o.formData.form_description=_.description,y(_.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.where=[]),c()},d=()=>{let b=e.node.dataRaw||"{}";i=JSON.parse(b);let _=f(i.form_delete.where||[]);i.form_delete.where=_,o.formData=i.form_delete,o.formData.form_id&&y(o.formData.form_id),c()},c=()=>{let b={...zi(o.formData)};b.where=v(b.where),i.form_delete=b,t({...e.node,node_params:JSON.stringify(i)})},f=b=>{let _=[];return b.forEach(x=>{let w=JSON.parse(JSON.stringify(x)),C=w.rule.split("_");w.form_field_id=w.form_field_id*1,w.field_type=C[0],C.shift(),w.rule=C.join("_"),_.push(w)}),_},v=b=>{let _=[];return b.forEach(x=>{let w=JSON.parse(JSON.stringify(x));w.form_field_id=w.form_field_id*1,w.rule=x.field_type+"_"+x.rule,_.push(w)}),_},g=async()=>{const b=await n.getFormList();b&&(o.tableList=b)},y=async b=>{n.getFormFieldList({form_id:b}).then(_=>{_.forEach(x=>{x.id=x.id*1}),o.fieldList=_}).catch(()=>{})};return Xt(()=>{g(),d()}),(b,_)=>(Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:V(()=>_[1]||(_[1]=[E("span",null,[He("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",pT,[E("div",vT,[_[2]||(_[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Hl,alt:""}),E("span",{class:"text"},"输入")],-1)),_[3]||(_[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",gT,[B(Qd,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":_[0]||(_[0]=x=>o.formData.form_id=x),onChange:l},null,8,["options","title","description","value"])]),_[4]||(_[4]=E("div",{class:"setting-label"},[E("span",null,"删除条件")],-1)),E("div",mT,[B(Fh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},_T=pt(yT,[["__scopeId","data-v-35e370b4"]]),bT={class:"variable-node"},xT={class:"node-form-content"},wT={class:"gray-block"},ST={class:"field-items"},ET={class:"field-name-box"},CT={class:"field-value-box"},OT={class:"field-value-option"},kT={class:"option-label"},NT={class:"option-type"},MT={class:"field-actions"},AT={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Ce([]),o=Ce([]);function s(){const w=n.lf.getNodeModelById(n.nodeId);if(w){let k=w.getGlobalVariable().diy_global||[];k.forEach(D=>{D.label=D.key,D.value="global."+D.key}),o.value=k||[]}}function l(){const w=n.lf.getNodeModelById(n.nodeId);if(w){let C=w.getAllParentVariable();i.value=C}}const d=Ce([]),c=()=>{let w=JSON.parse(n.node.node_params);w.assign=[...d.value],t("update-node",{...n.node,node_params:JSON.stringify(w)})},f=()=>{try{let w=n.node.dataRaw||n.node.node_params||"{}",C=JSON.parse(w).assign||[];C=JSON.parse(JSON.stringify(C)),C.forEach(k=>{k.tags=k.tags||[]}),d.value=C,s()}catch(w){}},v=w=>{w&&l()},g=(w,C,k)=>{k.tags=C,k.value=w,c()},y=()=>{d.value.push({variable:void 0,value:""}),c()},b=w=>{d.value.splice(w,1),c()},_=w=>{w&&s()},x=()=>{t("close")};return Xt(()=>{f()}),(w,C)=>{const k=Rr,D=Pr,I=In;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:x},null,8,["title","iconName"])]),default:V(()=>[E("div",bT,[E("div",xT,[E("div",wT,[E("div",ST,[(Y(!0),se(it,null,ft(d.value,($,R)=>(Y(),se("div",{class:"field-item",key:R},[E("div",ET,[B(D,{style:{width:"100%"},placeholder:"请输入选择变量",value:$.variable,"onUpdate:value":F=>$.variable=F,onDropdownVisibleChange:_,onChange:c},{default:V(()=>[(Y(!0),se(it,null,ft(o.value,F=>(Y(),Fe(k,{value:F.value,key:F.key},{default:V(()=>[E("span",null,De(F.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),E("div",CT,[B(fr,{ref_for:!0,ref:"atInput"+R,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:$.tags,defaultValue:$.value,onOpen:v,onChange:(F,z)=>g(F,z,$,R),placeholder:"请输入变量值，键入“/”插入变量"},{option:V(({label:F,payload:z})=>[E("div",OT,[E("div",kT,De(F),1),E("div",NT,De(z.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",MT,[B(je(cr),{class:"action-btn",onClick:F=>b(R)},null,8,["onClick"])])]))),128))]),E("div",null,[B(I,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:y},{icon:V(()=>[B(je(Rn))]),default:V(()=>[C[0]||(C[0]=He(" 添加赋值变量 "))]),_:1,__:[0]})])])])])]),_:1})}}},TT=pt(AT,[["__scopeId","data-v-2a9b706f"]]),DT={class:"update-data-form"},LT={class:"node-box-content"},PT={class:"setting-box"},RT={class:"setting-box"},IT={class:"setting-box"},BT={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=Oo();let i={};const o=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),s=({type:_,list:x})=>{o.formData.typ=_,o.formData.where=x,f()},l=(_,x)=>{x?(o.formData.form_name=x.name,o.formData.form_description=x.description,b(x.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.datas=[],o.formData.where=[],o.formData.typ=1),f()},d=_=>{o.formData.datas=_,f()},c=()=>{let _=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(_);let x=v(i.form_update.where||[]);i.form_update.where=x,o.formData=i.form_update,o.formData.form_id&&b(o.formData.form_id),f()},f=()=>{let _={...zi(o.formData)};_.where=g(_.where),i.form_update=_,t({...e.node,node_params:JSON.stringify(i)})},v=_=>{let x=[];return _.forEach(w=>{let C=JSON.parse(JSON.stringify(w)),k=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=k[0],k.shift(),C.rule=k.join("_"),x.push(C)}),x},g=_=>{let x=[];return _.forEach(w=>{let C=JSON.parse(JSON.stringify(w));C.form_field_id=C.form_field_id*1,C.rule=w.field_type+"_"+w.rule,x.push(C)}),x},y=async()=>{const _=await n.getFormList();_&&(o.tableList=_)},b=async _=>{n.getFormFieldList({form_id:_}).then(x=>{x.forEach(w=>{w.id=w.id*1}),o.fieldList=x}).catch(()=>{})};return Xt(()=>{y(),c()}),(_,x)=>(Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:V(()=>x[1]||(x[1]=[E("span",null,[He("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",DT,[E("div",LT,[x[2]||(x[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Hl,alt:""}),E("span",{class:"text"},"输入")],-1)),x[3]||(x[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",PT,[B(Qd,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":x[0]||(x[0]=w=>o.formData.form_id=w),onChange:l},null,8,["options","title","description","value"])]),x[4]||(x[4]=E("div",{class:"setting-label"},[E("span",null,"更新条件")],-1)),E("div",RT,[B(Fh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])]),x[5]||(x[5]=E("div",{class:"setting-label"},[E("span",null,"更新数据")],-1)),E("div",IT,[B(jh,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showEmptyFieldRow:o.formData.form_id=="",list:o.formData.datas,onChange:d},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},jT=pt(BT,[["__scopeId","data-v-60a76ec1"]]),n1={__name:"add-params-modal",emits:["add","edit","addSub"],setup(r,{expose:e,emit:t}){const n=t,i=Ce(!1),o=Ce("新增参数");let s="add";const l=(w,C)=>C?/^[a-zA-Z_]+$/.test(C)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let d=0;const c=Vt({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),f=()=>{i.value=!0},v=()=>{Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="add",o.value="新增参数",i.value=!0},g=w=>{d=w,Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="addSub",o.value="新增参数",i.value=!0},y=(w,C)=>{d=C,Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(c,{...w}),s="edit",o.value="编辑参数",i.value=!0},b=Ce(null),_=()=>{b.value.validate().then(()=>{s=="add"&&n("add",{...c}),s=="addSub"&&n("addSub",{...c},d),s=="edit"&&n("edit",{...c},d),i.value=!1})},x=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:f,add:v,edit:y,addSub:g}),(w,C)=>{const k=Sr,D=Wi,I=Rr,$=Pr,R=oa,F=Kd,z=Oi,ie=ii;return Y(),se("div",null,[B(ie,{open:i.value,"onUpdate:open":C[5]||(C[5]=G=>i.value=G),title:o.value,onOk:_,width:472,"ok-text":"确定","cancel-text":"取消"},{default:V(()=>[B(z,{ref_key:"formRef",ref:b,layout:"vertical",model:c,style:{margin:"24px 0"}},{default:V(()=>[B(D,{label:"参数key",name:"key",rules:[{required:!0,validator:(G,Q)=>l(G,Q)}]},{default:V(()=>[B(k,{value:c.key,"onUpdate:value":C[0]||(C[0]=G=>c.key=G),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),B(D,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:V(()=>[B($,{value:c.typ,"onUpdate:value":C[1]||(C[1]=G=>c.typ=G),placeholder:"请选择",style:{width:"100%"}},{default:V(()=>[(Y(),se(it,null,ft(x,G=>B(I,{value:G.value},{default:V(()=>[He(De(G.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),B(D,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:V(()=>[B(R,{checked:c.required,"onUpdate:checked":C[2]||(C[2]=G=>c.required=G)},null,8,["checked"])]),_:1}),B(D,{label:"默认值",name:"default",rules:[{required:c.required,message:"请输入默认值"}]},{default:V(()=>[B(k,{value:c.default,"onUpdate:value":C[3]||(C[3]=G=>c.default=G),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),B(D,{label:"枚举值",name:"enum"},{default:V(()=>[B(F,{style:{height:"80px"},value:c.enum,"onUpdate:value":C[4]||(C[4]=G=>c.enum=G),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},HT={class:"sub-field-item"},$T=["onClick"],FT=["onClick"],zT=["onClick"],WT={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=Kt(()=>e.level>2?e.typOptions.filter(y=>y.value!="object"):e.typOptions),n=Kt(()=>e.level==2?"180px":"146px");let i=0;const o=(y,b)=>{b.splice(y,1)},s=y=>{y.subs=[]},l=Ce(null),d=y=>{i=y,l.value.add()},c=(y,b)=>{l.value.edit(y,b)},f=y=>{e.data[i].subs.push(y)},v=(y,b)=>{e.data.splice(b,1,y)},g=y=>y.typ=="object"&&e.level<=2;return(y,b)=>{const _=Sr,x=Rr,w=Pr,C=kn("SubsKey",!0);return Y(),se(it,null,[(Y(!0),se(it,null,ft(e.data,(k,D)=>(Y(),se("div",{class:wn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:k.cu_key},[E("div",HT,[b[0]||(b[0]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(_,{class:"mr12",style:Si({width:n.value}),value:k.key,"onUpdate:value":I=>k.key=I,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),b[1]||(b[1]=E("img",{class:"fork-icon",src:Va,alt:""},null,-1)),B(w,{class:"mr12",onChange:I=>s(k),value:k.typ,"onUpdate:value":I=>k.typ=I,placeholder:"请选择",style:Si({width:n.value})},{default:V(()=>[(Y(!0),se(it,null,ft(t.value,I=>(Y(),Fe(x,{value:I.value},{default:V(()=>[He(De(I.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),g(k)?(Y(),se("div",{key:0,class:"btn-hover-wrap mr12",onClick:I=>d(D,e.data)},[B(je(hs))],8,$T)):Qe("",!0),E("div",{class:"btn-hover-wrap mr12",onClick:I=>c(k,D)},[B(je(Zy))],8,FT),E("div",{class:"btn-hover-wrap",onClick:I=>o(D,e.data)},[B(je(cr))],8,zT)]),k.subs&&k.subs.length>0?(Y(),Fe(C,{key:0,level:e.level+1,typOptions:e.typOptions,data:k.subs},null,8,["level","typOptions","data"])):Qe("",!0)],2))),128)),B(n1,{onAdd:f,onEdit:v,ref_key:"addParamsModalRef",ref:l},null,512)],64)}}},UT=pt(WT,[["__scopeId","data-v-f6bf59d5"]]),VT={class:"problem-optimization-form"},XT={class:"node-form-content"},GT={class:"gray-block"},YT={class:"flex-block-item"},qT={class:"number-box"},KT={class:"number-slider-box"},JT={class:"number-input-box"},ZT={class:"number-box"},QT={class:"number-slider-box"},eD={class:"number-input-box"},tD={class:"number-box"},nD={class:"number-box"},rD={class:"number-slider-box"},iD={class:"number-input-box"},oD={class:"field-list-item"},aD={class:"field-label"},sD={class:"field-type"},lD={class:"diy-form-item"},uD={class:"form-content"},dD={class:"gray-block mt16"},cD={class:"output-box"},fD={class:"array-form-box"},hD={class:"flex-block-item",style:{gap:"12px"}},pD=["onClick"],vD=["onClick"],gD=["onClick"],mD={key:0,class:"sub-field-box"},yD={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=ri(),o=Ce(null),s=Kt(()=>i.modelList),l=Ce([]),d=Ce([]),c=Ce(!1),f=()=>{c.value=!c.value},v=(ye,ae)=>{w.prompt=ye,w.prompt_tags=ae};function g(){const ye=n.lf.getNodeModelById(n.nodeId);if(ye){let ae=ye.getAllParentVariable();d.value=y(ae)}}function y(ye){return ye.forEach(ae=>{ae.typ=="node"?ae.node_type==1?ae.value="global":ae.value=ae.node_id:ae.value=ae.key,ae.children&&ae.children.length>0&&(ae.children=y(ae.children))}),ye}const b=()=>{const ye=n.lf.getNodeModelById(n.nodeId);if(ye){let ae=ye.getAllParentVariable();l.value=ae}};function _(ye){if(ye){let ae=ye.split("."),Re=ae[0],Le=ae.filter((Ve,Ae)=>Ae>0).join(".");return[Re,Le]}return["global","question"]}const x=Ce(),w=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),C=()=>{const ye=JSON.stringify({params_extractor:{...w,question_value:w.question_value.join("."),model_config_id:w.model_config_id?+w.model_config_id:w.model_config_id}});t("update-node",{...n.node,...w,node_params:ye})},k=()=>{try{let ye=n.node.dataRaw||n.node.node_params||"{}",ae=JSON.parse(ye).params_extractor||{};ae=JSON.parse(JSON.stringify(ae)),b(),g();for(let Re in ae){if(Re=="output"){w.output=D(ae[Re]);continue}if(Re=="question_value"){w.question_value=_(ae[Re]);continue}w[Re]=ae[Re]}!w.model_config_id&&s.value.length>0&&(w.model_config_id=s.value[0].id,w.use_model=s.value[0].children[0].name)}catch(ye){}};qt(()=>w,()=>{C()},{deep:!0});function D(ye){return ye.forEach(ae=>{ae.cu_key=Math.random()*1e4,ae.subs&&ae.subs.length?D(ae.subs):ae.subs=[]}),ye}const I=Ce(null),$=()=>{I.value.add()},R=(ye,ae)=>{I.value.edit(ye,ae)},F=ye=>{w.output.push(ye)},z=(ye,ae)=>{w.output.splice(ae,1,ye)},ie=ye=>{w.output.splice(ye,1)},G=ye=>{ye.subs=[]},Q=ye=>{I.value.addSub(ye)},T=(ye,ae)=>{w.output[ae].subs.push(ye)},W=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],P=ye=>{ye||g()},le=Ce({}),me=(ye,ae)=>{le.value=ae},he=Kt(()=>{if(!w.model_config_id)return!1;let ye=w.model_config_id+"#"+w.use_model;return le.value[ye]}),Ne=()=>{t("close")};return Xt(()=>{k()}),(ye,ae)=>{const Re=In,Le=Wi,Ve=Ci,Ae=Bl,te=aa,ce=Ui,_e=oa,Ie=cs,Ke=Sr,$e=Rr,Ue=Pr,Nt=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:Ne},null,8,["title","iconName"])]),default:V(()=>[E("div",VT,[E("div",XT,[B(Nt,{ref_key:"formRef",ref:x,layout:"vertical",model:w},{default:V(()=>[E("div",GT,[ae[24]||(ae[24]=E("div",{class:"gray-block-title"},"输入",-1)),B(Le,{label:"LLM模型",name:"use_model"},{default:V(()=>[E("div",YT,[B(Zd,{modelType:"LLM",modeName:w.use_model,"onUpdate:modeName":ae[0]||(ae[0]=ot=>w.use_model=ot),modeId:w.model_config_id,"onUpdate:modeId":ae[1]||(ae[1]=ot=>w.model_config_id=ot),onLoaded:me,style:{width:"348px"}},null,8,["modeName","modeId"]),B(Re,{onClick:f},{default:V(()=>[ae[12]||(ae[12]=He("高级设置 ")),c.value?(Y(),Fe(je(ds),{key:0})):(Y(),Fe(je(Jd),{key:1}))]),_:1,__:[12]})])]),_:1}),c.value?(Y(),Fe(Le,{key:0,name:"temperature"},{label:V(()=>[ae[14]||(ae[14]=E("span",null,"温度 ",-1)),B(Ve,null,{title:V(()=>ae[13]||(ae[13]=[He("温度越低，回答越严谨。温度越高，回答越发散。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",qT,[E("div",KT,[B(te,null,{default:V(()=>[B(Ae,{class:"custom-slider",value:w.temperature,"onUpdate:value":ae[2]||(ae[2]=ot=>w.temperature=ot),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",JT,[B(ce,{value:w.temperature,"onUpdate:value":ae[3]||(ae[3]=ot=>w.temperature=ot),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Qe("",!0),c.value?(Y(),Fe(Le,{key:1,name:"max_token"},{label:V(()=>[ae[16]||(ae[16]=E("span",null,"最大token ",-1)),B(Ve,null,{title:V(()=>ae[15]||(ae[15]=[He("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",ZT,[E("div",QT,[B(te,null,{default:V(()=>[B(Ae,{class:"custom-slider",value:w.max_token,"onUpdate:value":ae[4]||(ae[4]=ot=>w.max_token=ot),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",eD,[B(ce,{value:w.max_token,"onUpdate:value":ae[5]||(ae[5]=ot=>w.max_token=ot),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Qe("",!0),c.value&&he.value?(Y(),Fe(Le,{key:2,name:"enable_thinking"},{label:V(()=>[ae[18]||(ae[18]=E("span",null,"深度思考 ",-1)),B(Ve,null,{title:V(()=>ae[17]||(ae[17]=[He("开启时，调用大模型时会指定走深度思考模式")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",tD,[B(_e,{checked:w.enable_thinking,"onUpdate:checked":ae[6]||(ae[6]=ot=>w.enable_thinking=ot)},null,8,["checked"])])]),_:1})):Qe("",!0),B(Le,{name:"context_pair"},{label:V(()=>[ae[20]||(ae[20]=E("span",null,"上下文数量 ",-1)),B(Ve,null,{title:V(()=>ae[19]||(ae[19]=[He("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",nD,[E("div",rD,[B(te,null,{default:V(()=>[B(Ae,{class:"custom-slider",value:w.context_pair,"onUpdate:value":ae[7]||(ae[7]=ot=>w.context_pair=ot),min:0,max:50},null,8,["value"])]),_:1})]),E("div",iD,[B(ce,{value:w.context_pair,"onUpdate:value":ae[8]||(ae[8]=ot=>w.context_pair=ot),min:0,max:50},null,8,["value"])])])]),_:1}),B(Le,{name:"prompt",class:"width-100"},{label:V(()=>ae[21]||(ae[21]=[E("div",{class:"space-between-box"},[E("div",null,"提示词")],-1)])),default:V(()=>[B(fr,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:w.prompt_tags,defaultValue:w.prompt,ref_key:"atInputRef",ref:o,onOpen:b,onChange:ae[9]||(ae[9]=(ot,Bt)=>v(ot,Bt)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:V(({label:ot,payload:Bt})=>[E("div",oD,[E("div",aD,De(ot),1),E("div",sD,De(Bt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),ae[22]||(ae[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",lD,[ae[23]||(ae[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",uD,[B(Ie,{value:w.question_value,"onUpdate:value":ae[10]||(ae[10]=ot=>w.question_value=ot),onDropdownVisibleChange:P,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:ot})=>ot.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),E("div",dD,[E("div",{class:"gray-block-title",onClick:ae[11]||(ae[11]=(...ot)=>ye.test&&ye.test(...ot))},"输出 (输出字段提取)"),E("div",cD,[ae[26]||(ae[26]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",fD,[(Y(!0),se(it,null,ft(w.output,(ot,Bt)=>(Y(),se("div",{class:"form-item-list",key:Bt},[B(Le,{label:null,name:["output",Bt,"key"]},{default:V(()=>[E("div",hD,[B(Ke,{style:{width:"214px"},value:ot.key,"onUpdate:value":bt=>ot.key=bt,placeholder:"请输入"},null,8,["value","onUpdate:value"]),B(te,null,{default:V(()=>[B(Ue,{onChange:bt=>G(ot),value:ot.typ,"onUpdate:value":bt=>ot.typ=bt,placeholder:"请选择",style:{width:"214px"}},{default:V(()=>[(Y(),se(it,null,ft(W,bt=>B($e,{value:bt.value,key:bt.value},{default:V(()=>[He(De(bt.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),ot.typ=="object"?(Y(),se("div",{key:0,class:"btn-hover-wrap",onClick:bt=>Q(Bt)},[B(je(hs))],8,pD)):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:bt=>R(ot,Bt)},[B(je(Zy))],8,vD),E("div",{class:"btn-hover-wrap",onClick:bt=>ie(Bt)},[B(je(cr))],8,gD)]),ot.subs&&ot.subs.length>0?(Y(),se("div",mD,[B(te,null,{default:V(()=>[B(UT,{data:ot.subs,level:2,typOptions:W},null,8,["data"])]),_:2},1024)])):Qe("",!0)]),_:2},1032,["name"])]))),128)),B(Re,{onClick:$,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>ae[25]||(ae[25]=[He("添加参数")])),_:1,__:[25]},8,["icon"])])])])]),_:1},8,["model"])]),B(n1,{onAdd:F,onEdit:z,onAddSub:T,ref_key:"addParamsModalRef",ref:I},null,512)])]),_:1})}}},_D=pt(yD,[["__scopeId","data-v-00547038"]]),bD={class:"collapse-panel-warpper"},xD={class:"collapse-panel-header"},wD={class:"title-text"},SD={class:"collapse-panel-body"},ED={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(r){const t=Ce(r.defaultCollapsed),n=()=>{t.value=!t.value};return(i,o)=>{const s=ni;return Y(),se("div",bD,[E("div",xD,[E("div",{class:"collapse-panel-title",onClick:dn(n,["stop"])},[E("span",wD,[He(De(r.title)+" ",1),r.count?(Y(),se(it,{key:0},[He("（"+De(r.count)+"）",1)],64)):Qe("",!0)]),B(s,{name:"arrow-down",class:wn(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])])]),as(E("div",SD,[za(i.$slots,"default",{},void 0,!0)],512),[[ss,!t.value]])])}}},cf=pt(ED,[["__scopeId","data-v-9f89b1e9"]]),CD={class:"field-select-box"},OD={key:0,class:"field-list-box"},kD={key:1,class:"empty-box"},ND={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Vt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),o=Ce([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),s=Ce([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),l=(f,v)=>{i.selectedRowKeys=f,i.selectedRows=v},d=({formId:f,selectedRowKeys:v,selectedRows:g})=>{i.formId=f,i.selectedRowKeys=v,i.selectedRows=g,i.show=!0},c=()=>{n("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:d}),(f,v)=>{const g=Yy,y=ii;return Y(),Fe(y,{width:"746px",open:i.show,"onUpdate:open":v[1]||(v[1]=b=>i.show=b),title:"关联数据表",onOk:c,"ok-text":"确定","cancel-text":"取消"},{default:V(()=>[E("div",CD,[s.value.length?(Y(),se("div",OD,[B(g,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:l},dataSource:s.value,columns:o.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):Qe("",!0),s.value.length?Qe("",!0):(Y(),se("div",kD,[v[3]||(v[3]=E("img",{src:Ih,alt:""},null,-1)),E("div",null,[v[2]||(v[2]=He(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:v[0]||(v[0]=(...b)=>f.openAddLibrary&&f.openAddLibrary(...b))}," 去添加")])]))])]),_:1},8,["open"])}}},MD=pt(ND,[["__scopeId","data-v-e0fc750c"]]),AD={class:"field-list"},TD={class:"field-list-col field-drag-col"},DD={class:"drag-btn"},LD={class:"field-list-col field-name-col"},PD={class:"field-name-box"},RD={class:"field-name"},ID={class:"field-type-tag"},BD={class:"field-list-col field-value-col"},jD={key:0,class:"field-list-col field-del-col"},HD={class:"add-btn-box"},$D={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],o=Ce([]);qt(()=>n.list,g=>{o.value=g.map(y=>({...y,is_asc:y.is_asc?1:0}))});const s=g=>{o.value.splice(g,1),c()},l=(g,y)=>{o.value=y.map(b=>({...b})),c()},d=()=>{c()},c=()=>{let g=o.value.map(y=>({...y,is_asc:y.is_asc==1}));t("change",g)},f=Ce(),v=()=>{f.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(g=>g.name)})};return(g,y)=>{const b=Rr,_=Pr,x=ni,w=In,C=Ci;return Y(),se("div",null,[E("div",AD,[(Y(!0),se(it,null,ft(o.value,k=>(Y(),se("div",{class:"field-list-row",key:k.name},[E("div",TD,[E("span",DD,[B(je(Qy))])]),E("div",LD,[E("div",PD,[E("span",RD,De(k.name),1),E("span",ID,De(k.type),1)])]),E("div",BD,[B(_,{value:k.is_asc,"onUpdate:value":D=>k.is_asc=D,style:{width:"100%"},onChange:d},{default:V(()=>[(Y(),se(it,null,ft(i,D=>B(b,{value:D.value,key:D.key},{default:V(()=>[He(De(D.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value"])]),n.showDelete?(Y(),se("div",jD,[E("span",{class:"del-btn",onClick:y[0]||(y[0]=D=>s(g.index))},[B(x,{class:"del-icon",name:"close-circle"})])])):Qe("",!0)]))),128))]),E("div",HD,[r.disabled?(Y(),Fe(C,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:V(()=>[E("span",null,[B(w,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:V(()=>[B(je(Rn)),y[1]||(y[1]=He(" 添加排序字段 "))]),_:1,__:[1]})])]),_:1})):(Y(),Fe(w,{key:1,class:"add-btn",type:"dashed",block:"",onClick:v},{default:V(()=>[B(je(Rn)),y[2]||(y[2]=He(" 添加排序字段 "))]),_:1,__:[2]}))]),B(MD,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:f,onOk:l},null,8,["formId"])])}}},FD=pt($D,[["__scopeId","data-v-fbdcd109"]]),zD={class:"field-item"},WD={class:"field-name"},UD={class:"field-type"},VD={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(r){const e=r,t=Ce([]);return(n,i)=>{const o=ni,s=hC;return Y(),se("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=dn(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=dn(()=>{},["stop"]))},[B(s,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:V(({switcherCls:l})=>[E("span",{class:wn(l)},[B(o,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:V(({dataRef:l})=>[E("div",zD,[E("span",WD,De(l.title),1),E("span",UD,De(l.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},XD=pt(VD,[["__scopeId","data-v-2c5047db"]]),GD={class:"select-data-form"},YD={class:"node-box-content"},qD={class:"setting-box"},KD={class:"setting-box"},JD={class:"node-box-content"},ZD={class:"setting-box"},QD={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=wt("setData"),n=Oo();let i={};const o=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),s=Kt(()=>[{title:"output_list",key:"output_list",type:"Array(Object)",children:o.formData.fields.map(k=>({title:k.name,key:k.name,type:k.type}))},{title:"row_num",key:"row_num",type:"integer"}]),l=({type:C,list:k})=>{o.formData.typ=C,o.formData.where=k,y()},d=C=>{o.formData.order=[...C],y()},c=(C,k)=>{k?(o.formData.form_name=k.name,o.formData.form_description=k.description,w(k.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.typ=1,o.formData.fields=[],o.formData.where=[],o.formData.order=[],o.formData.limit=100),y()},f=C=>{o.formData.fields=C,y()},v=()=>{y()},g=()=>{let C=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(C);let k=b(i.form_select.where||[]);i.form_select.where=k,o.formData=i.form_select,o.formData.form_id&&w(o.formData.form_id),y()},y=()=>{let C={...zi(o.formData)};C.where=_(C.where),i.form_select=C,t({...e.node,node_params:JSON.stringify(i)})},b=C=>{let k=[];return C.forEach(D=>{let I=JSON.parse(JSON.stringify(D)),$=I.rule.split("_");I.form_field_id=I.form_field_id*1,I.field_type=$[0],$.shift(),I.rule=$.join("_"),k.push(I)}),k},_=C=>{let k=[];return C.forEach(D=>{let I=JSON.parse(JSON.stringify(D));I.form_field_id=I.form_field_id*1,I.rule=D.field_type+"_"+D.rule,k.push(I)}),k},x=async()=>{const C=await n.getFormList();C&&(o.tableList=C)},w=async C=>{n.getFormFieldList({form_id:C}).then(k=>{k.forEach(D=>{D.id=D.id*1}),o.fieldList=k}).catch(()=>{})};return Xt(()=>{x(),g()}),(C,k)=>{const D=Ui;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:V(()=>k[8]||(k[8]=[E("span",null,[He("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",GD,[E("div",YD,[k[9]||(k[9]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Hl,alt:""}),E("span",{class:"text"},"输入")],-1)),k[10]||(k[10]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",qD,[B(Qd,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":k[0]||(k[0]=I=>o.formData.form_id=I),onChange:c},null,8,["options","title","description","value"])]),E("div",KD,[B(cf,{title:"查询条件",count:o.formData.where.length},{default:V(()=>[B(Fh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:l},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),E("div",{class:"setting-box",onWheel:k[1]||(k[1]=dn(()=>{},["stop"])),onTouchmove:k[2]||(k[2]=dn(()=>{},["stop"]))},[B(cf,{title:"查询字段",count:o.formData.fields.length},{default:V(()=>[B(jh,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showInput:!1,showEmptyFieldRow:o.formData.form_id=="",list:o.formData.fields,onChange:f},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),E("div",{class:"setting-box",onWheel:k[3]||(k[3]=dn(()=>{},["stop"])),onTouchmove:k[4]||(k[4]=dn(()=>{},["stop"]))},[B(cf,{title:"排序",count:o.formData.order.length},{default:V(()=>[B(FD,{"form-id":o.formData.form_id,disabled:!o.formData.form_id,list:o.formData.order,onChange:d},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),k[11]||(k[11]=E("div",{class:"setting-label"},[E("span",null,"查询数量")],-1)),E("div",{class:"setting-box",onWheel:k[6]||(k[6]=dn(()=>{},["stop"])),onTouchmove:k[7]||(k[7]=dn(()=>{},["stop"]))},[B(D,{min:1,max:1e3,value:o.formData.limit,"onUpdate:value":k[5]||(k[5]=I=>o.formData.limit=I),disabled:!o.formData.form_id,style:{width:"205px"},onChange:v},null,8,["value","disabled"])],32)]),E("div",JD,[k[12]||(k[12]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Bh,alt:""}),E("span",{class:"text"},"输出")],-1)),E("div",ZD,[B(XD,{treeData:s.value},null,8,["treeData"])])])])]),_:1})}}},eL=pt(QD,[["__scopeId","data-v-a401f6c0"]]),tL={class:"problem-optimization-form"},nL={class:"gray-block"},rL={class:"flex-block-item"},iL={class:"number-box"},oL={class:"number-slider-box"},aL={class:"number-input-box"},sL={class:"number-box"},lL={class:"number-slider-box"},uL={class:"number-input-box"},dL={class:"number-box"},cL={class:"number-box"},fL={class:"number-slider-box"},hL={class:"number-input-box"},pL={class:"gray-block mt16"},vL={class:"array-form-box"},gL={class:"flex-block-item"},mL=["onClick"],yL={class:"form-item-list"},_L={class:"flex-block-item"},bL={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=ri(),o=Kt(()=>i.modelList),s=Ce(!1),l=()=>{s.value=!s.value},d=Ce(),c=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]}),f=()=>{const k=JSON.stringify({cate:{...c,model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t("update-node",{...n.node,...c,node_params:k})},v=()=>{try{let k=n.node.dataRaw||n.node.node_params||"{}",D=JSON.parse(k).cate||{};D=JSON.parse(JSON.stringify(D));for(let I in D)if(I=="categorys")if(D.categorys&&D.categorys.length>0){let $=D.categorys.map(R=>({...R,key:Math.random()*1e4}));c[I]=$}else c[I]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else c[I]=D[I];!c.model_config_id&&o.value.length>0&&(c.model_config_id=o.value[0].id,c.use_model=o.value[0].children[0].name)}catch(k){}};qt(()=>c,()=>{f()},{deep:!0});const g=()=>{c.categorys.push({category:"",next_node_key:"",key:Math.random()*1e4})},y=k=>{c.categorys.splice(k,1)},b=()=>Promise.resolve(),_=Ce({}),x=(k,D)=>{_.value=D},w=Kt(()=>{if(!c.model_config_id)return!1;let k=c.model_config_id+"#"+c.use_model;return _.value[k]}),C=()=>{t("close")};return Xt(()=>{v()}),(k,D)=>{const I=In,$=Wi,R=Ci,F=Bl,z=aa,ie=Ui,G=oa,Q=Sr,T=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:C},null,8,["title","iconName"])]),default:V(()=>[E("div",tL,[E("div",{class:"node-form-content",onMousedown:D[9]||(D[9]=dn(()=>{},["stop"]))},[B(T,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:V(()=>[E("div",nL,[D[19]||(D[19]=E("div",{class:"gray-block-title"},"输入",-1)),B($,{label:"LLM模型",name:"use_model"},{default:V(()=>[E("div",rL,[B(Zd,{modelType:"LLM",modeName:c.use_model,"onUpdate:modeName":D[0]||(D[0]=W=>c.use_model=W),modeId:c.model_config_id,"onUpdate:modeId":D[1]||(D[1]=W=>c.model_config_id=W),onLoaded:x,style:{width:"348px"}},null,8,["modeName","modeId"]),B(I,{onClick:l},{default:V(()=>[D[10]||(D[10]=He("高级设置 ")),s.value?(Y(),Fe(je(ds),{key:0})):(Y(),Fe(je(Jd),{key:1}))]),_:1,__:[10]})])]),_:1}),s.value?(Y(),Fe($,{key:0,name:"temperature"},{label:V(()=>[D[12]||(D[12]=E("span",null,"温度 ",-1)),B(R,null,{title:V(()=>D[11]||(D[11]=[He("温度越低，回答越严谨。温度越高，回答越发散。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",iL,[E("div",oL,[B(z,null,{default:V(()=>[B(F,{class:"custom-slider",value:c.temperature,"onUpdate:value":D[2]||(D[2]=W=>c.temperature=W),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",aL,[B(ie,{value:c.temperature,"onUpdate:value":D[3]||(D[3]=W=>c.temperature=W),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):Qe("",!0),s.value?(Y(),Fe($,{key:1,name:"max_token"},{label:V(()=>[D[14]||(D[14]=E("span",null,"最大token ",-1)),B(R,null,{title:V(()=>D[13]||(D[13]=[He("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",sL,[E("div",lL,[B(z,null,{default:V(()=>[B(F,{class:"custom-slider",value:c.max_token,"onUpdate:value":D[4]||(D[4]=W=>c.max_token=W),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",uL,[B(ie,{value:c.max_token,"onUpdate:value":D[5]||(D[5]=W=>c.max_token=W),min:0,max:100*1024},null,8,["value"])])])]),_:1})):Qe("",!0),s.value&&w.value?(Y(),Fe($,{key:2,name:"enable_thinking"},{label:V(()=>[D[16]||(D[16]=E("span",null,"深度思考 ",-1)),B(R,null,{title:V(()=>D[15]||(D[15]=[He("开启时，调用大模型时会指定走深度思考模式")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",dL,[B(G,{checked:c.enable_thinking,"onUpdate:checked":D[6]||(D[6]=W=>c.enable_thinking=W)},null,8,["checked"])])]),_:1})):Qe("",!0),B($,{name:"context_pair"},{label:V(()=>[D[18]||(D[18]=E("span",null,"上下文数量 ",-1)),B(R,null,{title:V(()=>D[17]||(D[17]=[He("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:V(()=>[B(je(Yn),{class:"question-icon"})]),_:1})]),default:V(()=>[E("div",cL,[E("div",fL,[B(z,null,{default:V(()=>[B(F,{class:"custom-slider",value:c.context_pair,"onUpdate:value":D[7]||(D[7]=W=>c.context_pair=W),min:0,max:50},null,8,["value"])]),_:1})]),E("div",hL,[B(ie,{value:c.context_pair,"onUpdate:value":D[8]||(D[8]=W=>c.context_pair=W),min:0,max:50},null,8,["value"])])])]),_:1}),D[20]||(D[20]=E("div",{class:"diy-form-item"},[E("div",{class:"form-label"},"用户问题"),E("div",{class:"form-content"},"流程开始>用户问题")],-1))]),E("div",pL,[D[22]||(D[22]=E("div",{class:"gray-block-title"},"问题分类设置",-1)),E("div",vL,[(Y(!0),se(it,null,ft(c.categorys,(W,P)=>(Y(),se("div",{class:"form-item-list",key:W.key},[B($,{label:null,name:["categorys",P,"category"],rules:{required:!0,validator:(le,me)=>b(le,me)}},{default:V(()=>[E("div",gL,[B(Q,{class:"flex1",value:W.category,"onUpdate:value":le=>W.category=le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),E("div",{class:"btn-hover-wrap",onClick:le=>y(P)},[B(je(cr))],8,mL)])]),_:2},1032,["name","rules"])]))),128)),E("div",yL,[B($,{label:null},{default:V(()=>[E("div",_L,[B(Q,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),B(I,{onClick:g,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>D[21]||(D[21]=[He("添加问题分类")])),_:1,__:[21]},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},xL=pt(bL,[["__scopeId","data-v-b7e48f9a"]]),wL={class:"judge-node-form"},SL={class:"gray-block-title"},EL=["onClick"],CL={class:"condition-list-box"},OL={class:"left-select-box"},kL={class:"condition-body"},NL=["onClick"],ML={class:"btn-wrap"},AL={class:"add-btn-block"},TL={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=wt("getNode"),n=wt("setData"),i=Ce(),o=Vt({term:[]}),s=Ce([]);function l(){let $=t().getAllParentVariable();s.value=d($)}function d($){return $.forEach(R=>{R.typ=="node"?R.node_type==1?R.value="global":R.value=R.node_id:R.value=R.key,R.children&&R.children.length>0&&(R.children=d(R.children))}),$}const c=$=>{$||l()};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const v=()=>{try{let $=JSON.parse(e.node.node_params).term||[];$=$.map(R=>{let F=R.terms.map(z=>{let ie="";for(let G=0;G<f.length;G++)if(z.variable.indexOf(f[G])>-1){ie=f[G];break}if(ie!=""){let G=z.variable.split(".");z.variable=[G[0],ie]}else z.variable=z.variable.split(".");return{...z,type:z.type>0?z.type:1,key:Math.random()*1e4}});return{...R,is_or:R.is_or?1:0,terms:F,key:Math.random()*1e4}}),o.term=$,g()}catch($){}},g=()=>{let $=JSON.parse(JSON.stringify(o.term));$=$.map(R=>({is_or:R.is_or==1,next_node_key:R.next_node_key,terms:R.terms.map(F=>({variable:F.variable.join("."),is_mult:F.is_mult,type:F.type,value:F.value}))})),n({...e.node,term:$,node_params:JSON.stringify({term:$})})},y=$=>{o.term[$].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},b=($,R)=>{o.term[$].terms.splice(R,1)},_=()=>{o.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},x=$=>{o.term.splice($,1)},w=$=>{let R=D($);$.is_mult=R.includes("array"),$.type=void 0};let C=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],k=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function D($){let R="";if($.variable&&$.variable.length>0){let F=s.value.filter(z=>z.key==$.variable[0]);F&&F.length&&(R=F[0].typ),R=="object"&&(F[0]&&F[0].children&&(F=F[0].subs.filter(z=>z.key==$.variable[1])),F&&F.length&&(R=F[0].typ),R=="object"&&(F[0]&&F[0].children&&(F=F[0].subs.filter(z=>z.key==$.variable[2])),F&&F.length&&(R=F[0].typ)))}return R}function I($){if(!$.variable)return[];let R=D($);return R==""?$.is_mult?k:C:R=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:R.includes("array")?k:C}return qt(()=>o,()=>{g()},{deep:!0}),Xt(()=>{l(),v()}),($,R)=>{const F=fs,z=Rr,ie=Pr,G=cs,Q=Sr,T=In,W=Oi;return Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:V(()=>R[2]||(R[2]=[E("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])),_:1},8,["title","iconName"])]),default:V(()=>[E("div",wL,[E("div",{class:"form-block",onMousedown:R[1]||(R[1]=dn(()=>{},["stop"]))},[B(W,{ref_key:"formRef",ref:i,layout:"vertical",model:o},{default:V(()=>[B(je(zC),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:o.term,"onUpdate:modelValue":R[0]||(R[0]=P=>o.term=P),"item-key":"key"},{item:V(({element:P,index:le})=>[(Y(),se("div",{class:"gray-block",key:P.key},[E("div",SL,[B(F,{gap:8},{default:V(()=>[B(je(Qy),{class:"icon drag-btn"}),He(De(le==0?"if":"else if"),1)]),_:2},1024),o.term.length>1?(Y(),se("div",{key:0,class:"btn-hover-wrap",onClick:me=>x(le)},[B(je(cr))],8,EL)):Qe("",!0)]),E("div",CL,[E("div",OL,[B(ie,{size:"small",value:P.is_or,"onUpdate:value":me=>P.is_or=me,bordered:!1,style:{width:"64px"}},{default:V(()=>[B(z,{value:0},{default:V(()=>R[3]||(R[3]=[He("and")])),_:1,__:[3]}),B(z,{value:1},{default:V(()=>R[4]||(R[4]=[He("or")])),_:1,__:[4]})]),_:2},1032,["value","onUpdate:value"])]),E("div",kL,[(Y(!0),se(it,null,ft(P.terms,(me,he)=>(Y(),se("div",{class:"condition-item",key:me.key},[B(G,{value:me.variable,"onUpdate:value":Ne=>me.variable=Ne,onChange:Ne=>w(me),onDropdownVisibleChange:c,style:{width:"160px"},options:s.value,allowClear:!1,displayRender:({labels:Ne})=>Ne.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),B(ie,{value:me.type,"onUpdate:value":Ne=>me.type=Ne,style:{width:"120px"},placeholder:"请选择"},{default:V(()=>[(Y(!0),se(it,null,ft(I(me),Ne=>(Y(),Fe(z,{value:Ne.value,key:Ne.value},{default:V(()=>[He(De(Ne.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),me.type!=5&&me.type!=6?(Y(),Fe(Q,{key:0,placeholder:"请输入",value:me.value,"onUpdate:value":Ne=>me.value=Ne,style:{width:"150px"}},null,8,["value","onUpdate:value"])):Qe("",!0),E("div",{class:"btn-hover-wrap",onClick:Ne=>b(le,he)},[B(je(cr))],8,NL)]))),128))])]),E("div",ML,[B(T,{onClick:me=>y(le),icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>R[5]||(R[5]=[He("添加条件")])),_:2,__:[5]},1032,["onClick","icon"])])]))]),_:1},8,["modelValue"]),E("div",AL,[B(T,{onClick:_,icon:Dn(je(Rn)),block:"",type:"dashed"},{default:V(()=>R[6]||(R[6]=[He("添加分支")])),_:1,__:[6]},8,["icon"])]),R[7]||(R[7]=E("div",{class:"gray-block mt8"},[E("div",{class:"gray-block-title"},"else"),E("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1,__:[7]},8,["model"])],32)])]),_:1})}}},DL=pt(TL,[["__scopeId","data-v-1db77572"]]),LL={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:pr,AtInput:fr,FullscreenOutlined:Rh,FullAtInput:Kx,NodeFormLayout:hr},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.update()}},mounted(){this.getValueOptions();const r=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const n=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=n.content,this.formState.content_tags=n.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),r.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(r){ps.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.node.node_params);r.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},PL={class:"specify-reply-form"},RL={class:"node-content"},IL={class:"form-item-label"},BL={class:"flex-between-box"},jL={class:"form-item-body"};function HL(r,e,t,n,i,o){const s=kn("NodeFormHeader"),l=kn("FullscreenOutlined"),d=kn("at-input"),c=kn("FullAtInput"),f=kn("NodeFormLayout");return Y(),Fe(f,null,{header:V(()=>[B(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:V(()=>[E("div",PL,[E("div",RL,[e[5]||(e[5]=E("div",{class:"form-label"},"输出",-1)),E("div",{class:"form-item",onMousedown:e[2]||(e[2]=dn(()=>{},["stop"]))},[E("div",IL,[E("div",BL,[e[4]||(e[4]=E("div",null,"消息内容",-1)),E("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...v)=>o.handleOpenFullAtModal&&o.handleOpenFullAtModal(...v))},[B(l)])])]),E("div",jL,[B(d,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:o.showAtList,onChange:e[1]||(e[1]=(v,g)=>o.changeValue(v,g))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),B(c,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:o.showAtList,onChange:e[3]||(e[3]=(v,g)=>o.changeValue(v,g)),onOk:o.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const $L=pt(LL,[["render",HL],["__scopeId","data-v-a5be1c4a"]]),FL=["src"],zL={class:"mcp-form"},WL={class:"node-options"},UL={class:"options-item-tit"},VL={class:"option-label"},XL={class:"option-type"},GL={class:"field-list-item"},YL={class:"field-label"},qL={class:"field-type"},KL={class:"desc"},JL={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=wt("getNode"),t=wt("setData"),n=r,i=Vt({mcpInfo:{},toolInfo:{}}),o=Vt({params:{}}),s=Ce([]);let l={};function d(){c(),l=JSON.parse(n.node.node_params),g()}function c(){s.value=e().getAllParentVariable()}function f(y,b,_){y.value=b,y.tags=_,v()}function v(){let y={arguments:{},tag_map:{}};for(let b in o.params){let _=o.params[b].value,x=i.toolInfo.inputSchema.properties[b]||{};x.type=="string"?_=String(_):["number","integer"].includes(x.type)&&(_=Number(_)),y.arguments[b]=_,y.tag_map[b]=o.params[b].tags}l.mcp.arguments=y.arguments,l.mcp.tag_map=y.tag_map||[],t({...n.node,node_params:JSON.stringify(l)})}const g=()=>{Gx({provider_id:l.mcp.provider_id}).then(y=>{var C;i.mcpInfo=(y==null?void 0:y.data)||{};let b=Fy((C=i.mcpInfo)==null?void 0:C.tools,{});i.toolInfo=b.find(k=>k.name==l.mcp.tool_name);let _=i.toolInfo.inputSchema||{},x=(_==null?void 0:_.properties)||{},w=(_==null?void 0:_.required)||[];x=JSON.parse(JSON.stringify(x));for(let k in x)x[k].value=String(l.mcp.arguments[k]||""),x[k].tags=l.mcp.tag_map?l.mcp.tag_map[k]:[],x[k].required=w.includes(k);o.params=x})};return Xt(()=>{d()}),(y,b)=>(Y(),Fe(hr,null,{header:V(()=>[B(pr,{title:r.node.node_name,iconName:r.node.node_icon_name},{"node-icon":V(()=>[E("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,FL)]),desc:V(()=>[E("span",null,De(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:V(()=>[E("div",zL,[E("div",WL,[b[0]||(b[0]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Hl,class:"title-icon"}),He("输入")])],-1)),(Y(!0),se(it,null,ft(o.params,(_,x)=>(Y(),se("div",{key:x,class:wn(["options-item",{"is-required":_.required}])},[E("div",UL,[E("div",VL,De(x),1),E("div",XL,De(_.type),1)]),E("div",null,[B(fr,{type:"textarea",inputStyle:"height: 64px;",options:s.value,defaultSelectedList:_.tags,defaultValue:_.value,ref_for:!0,ref:"atInputRef",onOpen:c,onChange:(w,C)=>f(_,w,C),placeholder:"请输入内容，键入“/”可以插入变量"},{option:V(({label:w,payload:C})=>[E("div",GL,[E("div",YL,De(w),1),E("div",qL,De(C.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",KL,De(_.description),1)],2))),128))]),b[1]||(b[1]=E("div",{class:"node-options"},[E("div",{class:"options-title"},[E("div",null,[E("img",{src:Bh,class:"title-icon"}),He("输出")])]),E("div",{class:"options-item"},[E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"输出")]),E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"text"),E("div",{class:"option-type"},"string")]),E("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},ZL=pt(JL,[["__scopeId","data-v-726864ab"]]),QL=["width"],eP={class:"node-form-drawer-body"},tP=["node-key"],nP={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(r,{expose:e,emit:t}){const n={"start-node":Ck,"problem-optimization-node":s2,"ai-dialogue-node":D2,"add-data-node":pN,"knowledge-base-node":uM,"code-run-node":cA,"http-node":eT,"delete-data-node":_T,"variable-assignment-node":TT,"update-data-node":jT,"parameter-extraction-node":_D,"select-data-node":eL,"question-node":xL,"judge-node":DL,"specify-reply-node":$L,"mcp-node":ZL},i=t,o=r,s=Kt({get:()=>o.open,set:C=>i("update:open",C)}),l=()=>{s.value=!1},d=Kt(()=>["delete-data-node","update-data-node","select-data-node","judge-node"].includes(o.nodeType)?600:480),c=()=>o.lf.getNodeModelById(o.nodeId),f=()=>o.lf.graphModel,v=C=>{x(C)},g=C=>{i("change-title",C)},y=()=>{s.value=!1,f().deleteNode(o.nodeId)};zo("lf",o.lf),zo("getNode",c),zo("getGraph",f),zo("setData",v),zo("changeTitle",g),zo("deleteNode",y),zo("close",l);const b=Kt(()=>{const C=`${o.nodeType}`;return n[C]||null}),_=Ce(null),x=C=>{clearTimeout(_.value),_.value=setTimeout(()=>{C.dataRaw=C.node_params,i("update-node",C)},300)},w=()=>{s.value=!1};return e({open}),(C,k)=>{const D=In,I=pC;return Y(),Fe(tC,{name:"slide-right",appear:""},{default:V(()=>[s.value?(Y(),se("div",{key:0,width:d.value,style:Si({width:d.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:eC(w,["esc"])},[E("div",eP,[E("div",{class:"drawer-form","node-key":o.nodeType},[b.value?(Y(),Fe(Xy(b.value),{lf:o.lf,"node-id":o.nodeId,"node-type":o.nodeType,node:o.node,key:o.nodeId,onClose:w,onUpdateNode:x},null,40,["lf","node-id","node-type","node"])):(Y(),Fe(I,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:V(()=>[B(D,{type:"primary",onClick:w},{default:V(()=>k[0]||(k[0]=[He("关闭")])),_:1,__:[0]})]),_:1}))],8,tP)])],44,QL)):Qe("",!0)]),_:1})}}},rP=pt(nP,[["__scopeId","data-v-6f564b1e"]]);var ec,Ft,r1,Xo,Ag,i1,o1,a1,zh,jf,Hf,_l={},s1=[],iP=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Fl=Array.isArray;function eo(r,e){for(var t in e)r[t]=e[t];return r}function Wh(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function vt(r,e,t){var n,i,o,s={};for(o in e)o=="key"?n=e[o]:o=="ref"?i=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?ec.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(o in r.defaultProps)s[o]===void 0&&(s[o]=r.defaultProps[o]);return qu(r,s,n,i,null)}function qu(r,e,t,n,i){var o={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++r1,__i:-1,__u:0};return i==null&&Ft.vnode!=null&&Ft.vnode(o),o}function tc(){return{current:null}}function Xa(r){return r.children}function Wt(r,e){this.props=r,this.context=e}function Ga(r,e){if(e==null)return r.__?Ga(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?Ga(r):null}function l1(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return l1(r)}}function Tg(r){(!r.__d&&(r.__d=!0)&&Xo.push(r)&&!rd.__r++||Ag!=Ft.debounceRendering)&&((Ag=Ft.debounceRendering)||i1)(rd)}function rd(){for(var r,e,t,n,i,o,s,l=1;Xo.length;)Xo.length>l&&Xo.sort(o1),r=Xo.shift(),l=Xo.length,r.__d&&(t=void 0,i=(n=(e=r).__v).__e,o=[],s=[],e.__P&&((t=eo({},n)).__v=n.__v+1,Ft.vnode&&Ft.vnode(t),Uh(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[i]:null,o,i??Ga(n),!!(32&n.__u),s),t.__v=n.__v,t.__.__k[t.__i]=t,c1(o,t,s),t.__e!=i&&l1(t)));rd.__r=0}function u1(r,e,t,n,i,o,s,l,d,c,f){var v,g,y,b,_,x,w=n&&n.__k||s1,C=e.length;for(d=oP(t,e,w,d,C),v=0;v<C;v++)(y=t.__k[v])!=null&&(g=y.__i==-1?_l:w[y.__i]||_l,y.__i=v,x=Uh(r,y,g,i,o,s,l,d,c,f),b=y.__e,y.ref&&g.ref!=y.ref&&(g.ref&&Vh(g.ref,null,y),f.push(y.ref,y.__c||b,y)),_==null&&b!=null&&(_=b),4&y.__u||g.__k===y.__k?d=d1(y,d,r):typeof y.type=="function"&&x!==void 0?d=x:b&&(d=b.nextSibling),y.__u&=-7);return t.__e=_,d}function oP(r,e,t,n,i){var o,s,l,d,c,f=t.length,v=f,g=0;for(r.__k=new Array(i),o=0;o<i;o++)(s=e[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(d=o+g,(s=r.__k[o]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?qu(null,s,null,null,null):Fl(s)?qu(Xa,{children:s},null,null,null):s.constructor==null&&s.__b>0?qu(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=r,s.__b=r.__b+1,l=null,(c=s.__i=aP(s,t,d,v))!=-1&&(v--,(l=t[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(i>f?g--:i<f&&g++),typeof s.type!="function"&&(s.__u|=4)):c!=d&&(c==d-1?g--:c==d+1?g++:(c>d?g--:g++,s.__u|=4))):r.__k[o]=null;if(v)for(o=0;o<f;o++)(l=t[o])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=Ga(l)),h1(l,l));return n}function d1(r,e,t){var n,i;if(typeof r.type=="function"){for(n=r.__k,i=0;n&&i<n.length;i++)n[i]&&(n[i].__=r,e=d1(n[i],e,t));return e}r.__e!=e&&(e&&r.type&&!t.contains(e)&&(e=Ga(r)),t.insertBefore(r.__e,e||null),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function id(r,e){return e=e||[],r==null||typeof r=="boolean"||(Fl(r)?r.some(function(t){id(t,e)}):e.push(r)),e}function aP(r,e,t,n){var i,o,s=r.key,l=r.type,d=e[t];if(d===null&&r.key==null||d&&s==d.key&&l==d.type&&(2&d.__u)==0)return t;if(n>(d!=null&&(2&d.__u)==0?1:0))for(i=t-1,o=t+1;i>=0||o<e.length;){if(i>=0){if((d=e[i])&&(2&d.__u)==0&&s==d.key&&l==d.type)return i;i--}if(o<e.length){if((d=e[o])&&(2&d.__u)==0&&s==d.key&&l==d.type)return o;o++}}return-1}function Dg(r,e,t){e[0]=="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||iP.test(e)?t:t+"px"}function Eu(r,e,t,n,i){var o,s;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||Dg(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||Dg(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(a1,"$1")),s=e.toLowerCase(),e=s in r||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+o]=t,t?n?t.u=n.u:(t.u=zh,r.addEventListener(e,o?Hf:jf,o)):r.removeEventListener(e,o?Hf:jf,o);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function Lg(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=zh++;else if(e.t<t.u)return;return t(Ft.event?Ft.event(e):e)}}}function Uh(r,e,t,n,i,o,s,l,d,c){var f,v,g,y,b,_,x,w,C,k,D,I,$,R,F,z,ie,G=e.type;if(e.constructor!=null)return null;128&t.__u&&(d=!!(32&t.__u),o=[l=e.__e=t.__e]),(f=Ft.__b)&&f(e);e:if(typeof G=="function")try{if(w=e.props,C="prototype"in G&&G.prototype.render,k=(f=G.contextType)&&n[f.__c],D=f?k?k.props.value:f.__:n,t.__c?x=(v=e.__c=t.__c).__=v.__E:(C?e.__c=v=new G(w,D):(e.__c=v=new Wt(w,D),v.constructor=G,v.render=lP),k&&k.sub(v),v.props=w,v.state||(v.state={}),v.context=D,v.__n=n,g=v.__d=!0,v.__h=[],v._sb=[]),C&&v.__s==null&&(v.__s=v.state),C&&G.getDerivedStateFromProps!=null&&(v.__s==v.state&&(v.__s=eo({},v.__s)),eo(v.__s,G.getDerivedStateFromProps(w,v.__s))),y=v.props,b=v.state,v.__v=e,g)C&&G.getDerivedStateFromProps==null&&v.componentWillMount!=null&&v.componentWillMount(),C&&v.componentDidMount!=null&&v.__h.push(v.componentDidMount);else{if(C&&G.getDerivedStateFromProps==null&&w!==y&&v.componentWillReceiveProps!=null&&v.componentWillReceiveProps(w,D),!v.__e&&v.shouldComponentUpdate!=null&&v.shouldComponentUpdate(w,v.__s,D)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(v.props=w,v.state=v.__s,v.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(Q){Q&&(Q.__=e)}),I=0;I<v._sb.length;I++)v.__h.push(v._sb[I]);v._sb=[],v.__h.length&&s.push(v);break e}v.componentWillUpdate!=null&&v.componentWillUpdate(w,v.__s,D),C&&v.componentDidUpdate!=null&&v.__h.push(function(){v.componentDidUpdate(y,b,_)})}if(v.context=D,v.props=w,v.__P=r,v.__e=!1,$=Ft.__r,R=0,C){for(v.state=v.__s,v.__d=!1,$&&$(e),f=v.render(v.props,v.state,v.context),F=0;F<v._sb.length;F++)v.__h.push(v._sb[F]);v._sb=[]}else do v.__d=!1,$&&$(e),f=v.render(v.props,v.state,v.context),v.state=v.__s;while(v.__d&&++R<25);v.state=v.__s,v.getChildContext!=null&&(n=eo(eo({},n),v.getChildContext())),C&&!g&&v.getSnapshotBeforeUpdate!=null&&(_=v.getSnapshotBeforeUpdate(y,b)),z=f,f!=null&&f.type===Xa&&f.key==null&&(z=f1(f.props.children)),l=u1(r,Fl(z)?z:[z],e,t,n,i,o,s,l,d,c),v.base=e.__e,e.__u&=-161,v.__h.length&&s.push(v),x&&(v.__E=v.__=null)}catch(Q){if(e.__v=null,d||o!=null)if(Q.then){for(e.__u|=d?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,e.__e=l}else for(ie=o.length;ie--;)Wh(o[ie]);else e.__e=t.__e,e.__k=t.__k;Ft.__e(Q,e,t)}else o==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):l=e.__e=sP(t.__e,e,t,n,i,o,s,d,c);return(f=Ft.diffed)&&f(e),128&e.__u?void 0:l}function c1(r,e,t){for(var n=0;n<t.length;n++)Vh(t[n],t[++n],t[++n]);Ft.__c&&Ft.__c(e,r),r.some(function(i){try{r=i.__h,i.__h=[],r.some(function(o){o.call(i)})}catch(o){Ft.__e(o,i.__v)}})}function f1(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Fl(r)?r.map(f1):eo({},r)}function sP(r,e,t,n,i,o,s,l,d){var c,f,v,g,y,b,_,x=t.props,w=e.props,C=e.type;if(C=="svg"?i="http://www.w3.org/2000/svg":C=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((y=o[c])&&"setAttribute"in y==!!C&&(C?y.localName==C:y.nodeType==3)){r=y,o[c]=null;break}}if(r==null){if(C==null)return document.createTextNode(w);r=document.createElementNS(i,C,w.is&&w),l&&(Ft.__m&&Ft.__m(e,o),l=!1),o=null}if(C==null)x===w||l&&r.data==w||(r.data=w);else{if(o=o&&ec.call(r.childNodes),x=t.props||_l,!l&&o!=null)for(x={},c=0;c<r.attributes.length;c++)x[(y=r.attributes[c]).name]=y.value;for(c in x)if(y=x[c],c!="children"){if(c=="dangerouslySetInnerHTML")v=y;else if(!(c in w)){if(c=="value"&&"defaultValue"in w||c=="checked"&&"defaultChecked"in w)continue;Eu(r,c,null,y,i)}}for(c in w)y=w[c],c=="children"?g=y:c=="dangerouslySetInnerHTML"?f=y:c=="value"?b=y:c=="checked"?_=y:l&&typeof y!="function"||x[c]===y||Eu(r,c,y,x[c],i);if(f)l||v&&(f.__html==v.__html||f.__html==r.innerHTML)||(r.innerHTML=f.__html),e.__k=[];else if(v&&(r.innerHTML=""),u1(e.type=="template"?r.content:r,Fl(g)?g:[g],e,t,n,C=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,s,o?o[0]:t.__k&&Ga(t,0),l,d),o!=null)for(c=o.length;c--;)Wh(o[c]);l||(c="value",C=="progress"&&b==null?r.removeAttribute("value"):b!=null&&(b!==r[c]||C=="progress"&&!b||C=="option"&&b!=x[c])&&Eu(r,c,b,x[c],i),c="checked",_!=null&&_!=r[c]&&Eu(r,c,_,x[c],i))}return r}function Vh(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(i){Ft.__e(i,t)}}function h1(r,e,t){var n,i;if(Ft.unmount&&Ft.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||Vh(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){Ft.__e(o,e)}n.base=n.__P=null}if(n=r.__k)for(i=0;i<n.length;i++)n[i]&&h1(n[i],e,t||typeof r.type!="function");t||Wh(r.__e),r.__c=r.__=r.__e=void 0}function lP(r,e,t){return this.constructor(r,t)}function uP(r,e,t){var n,i,o,s;e==document&&(e=document.documentElement),Ft.__&&Ft.__(r,e),i=(n=!1)?null:e.__k,o=[],s=[],Uh(e,r=e.__k=vt(Xa,null,[r]),i||_l,_l,e.namespaceURI,i?null:e.firstChild?ec.call(e.childNodes):null,o,i?i.__e:e.firstChild,n,s),c1(o,r,s)}ec=s1.slice,Ft={__e:function(r,e,t,n){for(var i,o,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(r)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(r,n||{}),s=i.__d),s)return i.__E=i}catch(l){r=l}throw r}},r1=0,Wt.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=eo({},this.state),typeof r=="function"&&(r=r(eo({},t),this.props)),r&&eo(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),Tg(this))},Wt.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Tg(this))},Wt.prototype.render=Xa,Xo=[],i1=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o1=function(r,e){return r.__v.__b-e.__v.__b},rd.__r=0,a1=/(PointerCapture)$|Capture$/i,zh=0,jf=Lg(!1),Hf=Lg(!0);var dP="An invariant failed, however the error is obfuscated because this is a production build.",od=[];Object.freeze(od);var Xh={};Object.freeze(Xh);function Lr(){return++mt.mobxGuid}function en(r){throw Zo(!1,r),"X"}function Zo(r,e){if(!r)throw new Error("[mobx] "+(e||dP))}function p1(r){var e=!1;return function(){if(!e)return e=!0,r.apply(this,arguments)}}var Cu=function(){};function cP(r){var e=[];return r.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function Gh(r){return r!==null&&typeof r=="object"}function vs(r){if(r===null||typeof r!="object")return!1;var e=Object.getPrototypeOf(r);return e===Object.prototype||e===null}function fP(r){if(ms(r)||Ir(r))return r;if(Array.isArray(r))return new Map(r);if(vs(r)){var e=new Map;for(var t in r)e.set(t,r[t]);return e}else return en("Cannot convert to map from '"+r+"'")}function gs(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function hP(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function pP(r,e){var t=Object.getOwnPropertyDescriptor(r,e);return!t||t.configurable!==!1&&t.writable!==!1}function No(r,e){var t="isMobX"+r;return e.prototype[t]=!0,function(n){return Gh(n)&&n[t]===!0}}function ms(r){return r instanceof Map}function zl(r){return r instanceof Set}function v1(r){var e=new Set;for(var t in r)e.add(t);return Object.getOwnPropertySymbols(r).forEach(function(n){Object.getOwnPropertyDescriptor(r,n).enumerable&&e.add(n)}),Array.from(e)}function bo(r){return r&&r.toString?r.toString():new String(r).toString()}function g1(r){return r===null?null:typeof r=="object"?""+r:r}var vP=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames,Dt=Symbol("mobx administration"),ys=function(){function r(e){e===void 0&&(e="Atom@"+Lr()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=nn.NOT_TRACKING}return r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.reportObserved=function(){return k1(this)},r.prototype.reportChanged=function(){_i(),BP(this),bi()},r.prototype.toString=function(){return this.name},r}(),Yh=No("Atom",ys);function qh(r,e,t){e===void 0&&(e=Cu),t===void 0&&(t=Cu);var n=new ys(r);return e!==Cu&&KP(n,e),t!==Cu&&L1(n,t),n}function gP(r,e){return W1(r,e)}function mP(r,e){return Object.is(r,e)}var Ya={structural:gP,default:mP};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var $f=function(r,e){return $f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},$f(r,e)};function yP(r,e){$f(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ad=function(){return ad=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ad.apply(this,arguments)};function Bi(r){var e=typeof Symbol=="function"&&r[Symbol.iterator],t=0;return e?e.call(r):{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}}}function Ba(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o}function Kh(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ba(arguments[e]));return r}var sd=Symbol("mobx did run lazy initializers"),Zs=Symbol("mobx pending decorators"),_P={},bP={};function xP(r,e){var t=e?_P:bP;return t[r]||(t[r]={configurable:!0,enumerable:e,get:function(){return na(this),this[r]},set:function(n){na(this),this[r]=n}})}function na(r){var e,t;if(r[sd]!==!0){var n=r[Zs];if(n){gs(r,sd,!0);var i=Kh(Object.getOwnPropertySymbols(n),Object.keys(n));try{for(var o=Bi(i),s=o.next();!s.done;s=o.next()){var l=s.value,d=n[l];d.propertyCreator(r,d.prop,d.descriptor,d.decoratorTarget,d.decoratorArguments)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}}}function m1(r,e){return function(){var n,i=function(s,l,d,c){if(c===!0)return e(s,l,d,s,n),null;if(!Object.prototype.hasOwnProperty.call(s,Zs)){var f=s[Zs];gs(s,Zs,ad({},f))}return s[Zs][l]={prop:l,propertyCreator:e,descriptor:d,decoratorTarget:s,decoratorArguments:n},xP(l,r)};return wP(arguments)?(n=od,i.apply(null,arguments)):(n=Array.prototype.slice.call(arguments),i)}}function wP(r){return(r.length===2||r.length===3)&&(typeof r[1]=="string"||typeof r[1]=="symbol")||r.length===4&&r[3]===!0}function Wl(r,e,t){return Za(r)?r:Array.isArray(r)?Me.array(r,{name:t}):vs(r)?Me.object(r,void 0,{name:t}):ms(r)?Me.map(r,{name:t}):zl(r)?Me.set(r,{name:t}):r}function SP(r,e,t){return r==null||ki(r)||Vi(r)||Ir(r)||ti(r)?r:Array.isArray(r)?Me.array(r,{name:t,deep:!1}):vs(r)?Me.object(r,void 0,{name:t,deep:!1}):ms(r)?Me.map(r,{name:t,deep:!1}):zl(r)?Me.set(r,{name:t,deep:!1}):en(!1)}function nc(r){return r}function EP(r,e,t){return W1(r,e)?e:r}function rc(r){Zo(r);var e=m1(!0,function(n,i,o,s,l){var d=o?o.initializer?o.initializer.call(n):o.value:void 0;tp(n).addObservableProp(i,d,r)}),t=e;return t.enhancer=r,t}var y1={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(y1);function Ra(r){return r==null?y1:typeof r=="string"?{name:r,deep:!0,proxy:!0}:r}var Jh=rc(Wl),CP=rc(SP),_1=rc(nc),OP=rc(EP);function Ou(r){return r.defaultDecorator?r.defaultDecorator.enhancer:r.deep===!1?nc:Wl}function kP(r,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return Jh.apply(null,arguments);if(Za(r))return r;var n=vs(r)?Me.object(r,e,t):Array.isArray(r)?Me.array(r,e):ms(r)?Me.map(r,e):zl(r)?Me.set(r,e):r;if(n!==r)return n;en(!1)}var Pg={box:function(r,e){arguments.length>2&&Ys("box");var t=Ra(e);return new ea(r,Ou(t),t.name,!0,t.equals)},array:function(r,e){arguments.length>2&&Ys("array");var t=Ra(e);return cR(r,Ou(t),t.name)},map:function(r,e){arguments.length>2&&Ys("map");var t=Ra(e);return new ep(r,Ou(t),t.name)},set:function(r,e){arguments.length>2&&Ys("set");var t=Ra(e);return new F1(r,Ou(t),t.name)},object:function(r,e,t){typeof arguments[1]=="string"&&Ys("object");var n=Ra(t);if(n.proxy===!1)return Xf({},r,e,n);var i=R1(n),o=Xf({},void 0,void 0,n),s=lR(o);return I1(s,r,e,i),s},ref:_1,shallow:CP,deep:Jh,struct:OP},Me=kP;Object.keys(Pg).forEach(function(r){return Me[r]=Pg[r]});function Ys(r){en("Expected one or two arguments to observable."+r+". Did you accidentally try to use observable."+r+" as decorator?")}var ld=m1(!1,function(r,e,t,n,i){var o=t.get,s=t.set,l=i[0]||{};tp(r).addComputedProp(r,e,ad({get:o,set:s,context:r},l))}),NP=ld({equals:Ya.structural}),un=function(e,t,n){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return ld.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new Ka(i)};un.struct=NP;var nn;(function(r){r[r.NOT_TRACKING=-1]="NOT_TRACKING",r[r.UP_TO_DATE=0]="UP_TO_DATE",r[r.POSSIBLY_STALE=1]="POSSIBLY_STALE",r[r.STALE=2]="STALE"})(nn||(nn={}));var ji;(function(r){r[r.NONE=0]="NONE",r[r.LOG=1]="LOG",r[r.BREAK=2]="BREAK"})(ji||(ji={}));var ud=function(){function r(e){this.cause=e}return r}();function Qs(r){return r instanceof ud}function Ff(r){switch(r.dependenciesState){case nn.UP_TO_DATE:return!1;case nn.NOT_TRACKING:case nn.STALE:return!0;case nn.POSSIBLY_STALE:{for(var e=Zh(!0),t=_s(),n=r.observing,i=n.length,o=0;o<i;o++){var s=n[o];if(Ja(s)){if(mt.disableErrorBoundaries)s.get();else try{s.get()}catch{return wo(t),rl(e),!0}if(r.dependenciesState===nn.STALE)return wo(t),rl(e),!0}}return w1(r),wo(t),rl(e),!1}}}function qa(r){var e=r.observers.size>0;mt.computationDepth>0&&e&&en(!1),!mt.allowStateChanges&&(e||mt.enforceActions==="strict")&&en(!1)}function b1(r,e,t){var n=Zh(!0);w1(r),r.newObserving=new Array(r.observing.length+100),r.unboundDepsCount=0,r.runId=++mt.runId;var i=mt.trackingDerivation;mt.trackingDerivation=r;var o;if(mt.disableErrorBoundaries===!0)o=e.call(t);else try{o=e.call(t)}catch(s){o=new ud(s)}return mt.trackingDerivation=i,MP(r),rl(n),o}function MP(r){for(var e=r.observing,t=r.observing=r.newObserving,n=nn.UP_TO_DATE,i=0,o=r.unboundDepsCount,s=0;s<o;s++){var l=t[s];l.diffValue===0&&(l.diffValue=1,i!==s&&(t[i]=l),i++),l.dependenciesState>n&&(n=l.dependenciesState)}for(t.length=i,r.newObserving=null,o=e.length;o--;){var l=e[o];l.diffValue===0&&C1(l,r),l.diffValue=0}for(;i--;){var l=t[i];l.diffValue===1&&(l.diffValue=0,IP(l,r))}n!==nn.UP_TO_DATE&&(r.dependenciesState=n,r.onBecomeStale())}function zf(r){var e=r.observing;r.observing=[];for(var t=e.length;t--;)C1(e[t],r);r.dependenciesState=nn.NOT_TRACKING}function x1(r){var e=_s();try{return r()}finally{wo(e)}}function _s(){var r=mt.trackingDerivation;return mt.trackingDerivation=null,r}function wo(r){mt.trackingDerivation=r}function Zh(r){var e=mt.allowStateReads;return mt.allowStateReads=r,e}function rl(r){mt.allowStateReads=r}function w1(r){if(r.dependenciesState!==nn.UP_TO_DATE){r.dependenciesState=nn.UP_TO_DATE;for(var e=r.observing,t=e.length;t--;)e[t].lowestObserverState=nn.UP_TO_DATE}}var dd=0,AP=1,Rg=Object.getOwnPropertyDescriptor(function(){},"name");Rg&&Rg.configurable;function Qo(r,e,t){var n=function(){return S1(r,e,t||this,arguments)};return n.isMobxAction=!0,n}function S1(r,e,t,n){var i=TP();try{return e.apply(t,n)}catch(o){throw i.error=o,o}finally{DP(i)}}function TP(r,e,t){var n=Qr(),i=0,o=_s();_i();var s=ic(!0),l=Zh(!0),d={prevDerivation:o,prevAllowStateChanges:s,prevAllowStateReads:l,notifySpy:n,startTime:i,actionId:AP++,parentActionId:dd};return dd=d.actionId,d}function DP(r){dd!==r.actionId&&en("invalid action stack. did you forget to finish an action?"),dd=r.parentActionId,r.error!==void 0&&(mt.suppressReactionErrors=!0),oc(r.prevAllowStateChanges),rl(r.prevAllowStateReads),bi(),wo(r.prevDerivation),r.notifySpy,mt.suppressReactionErrors=!1}function ic(r){var e=mt.allowStateChanges;return mt.allowStateChanges=r,e}function oc(r){mt.allowStateChanges=r}var ea=function(r){yP(e,r);function e(t,n,i,o,s){i===void 0&&(i="ObservableValue@"+Lr()),s===void 0&&(s=Ya.default);var l=r.call(this,i)||this;return l.enhancer=n,l.name=i,l.equals=s,l.hasUnreportedChange=!1,l.value=n(t,void 0,i),l}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==mt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(qa(this),Hi(this)){var n=$i(this,{object:this,type:"update",newValue:t});if(!n)return mt.UNCHANGED;t=n.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?mt.UNCHANGED:t},e.prototype.setNewValue=function(t){var n=this.value;this.value=t,this.reportChanged(),xi(this)&&wi(this,{type:"update",object:this,newValue:t,oldValue:n})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return Ul(this,t)},e.prototype.observe=function(t,n){return n&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),Vl(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return g1(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e}(ys),LP=No("ObservableValue",ea),Ka=function(){function r(e){this.dependenciesState=nn.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=nn.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+Lr(),this.value=new ud(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=ji.NONE,Zo(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+Lr(),e.set&&(this.setter=Qo(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?Ya.structural:Ya.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return r.prototype.onBecomeStale=function(){HP(this)},r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.get=function(){this.isComputing&&en("Cycle detected in computation "+this.name+": "+this.derivation),mt.inBatch===0&&this.observers.size===0&&!this.keepAlive?Ff(this)&&(this.warnAboutUntrackedRead(),_i(),this.value=this.computeValue(!1),bi()):(k1(this),Ff(this)&&this.trackAndCompute()&&jP(this));var e=this.value;if(Qs(e))throw e.cause;return e},r.prototype.peek=function(){var e=this.computeValue(!1);if(Qs(e))throw e.cause;return e},r.prototype.set=function(e){if(this.setter){Zo(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else Zo(!1,!1)},r.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===nn.NOT_TRACKING,n=this.computeValue(!0),i=t||Qs(e)||Qs(n)||!this.equals(e,n);return i&&(this.value=n),i},r.prototype.computeValue=function(e){this.isComputing=!0,mt.computationDepth++;var t;if(e)t=b1(this,this.derivation,this.scope);else if(mt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(n){t=new ud(n)}return mt.computationDepth--,this.isComputing=!1,t},r.prototype.suspend=function(){this.keepAlive||(zf(this),this.value=void 0)},r.prototype.observe=function(e,t){var n=this,i=!0,o=void 0;return GP(function(){var s=n.get();if(!i||t){var l=_s();e({type:"update",object:n,newValue:s,oldValue:o}),wo(l)}i=!1,o=s})},r.prototype.warnAboutUntrackedRead=function(){},r.prototype.toJSON=function(){return this.get()},r.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},r.prototype.valueOf=function(){return g1(this.get())},r.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},r}(),Ja=No("ComputedValue",Ka),Ku=function(){function r(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return r}(),PP={};function Wf(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:PP}var Ju=!0,E1=!1,mt=function(){var r=Wf();return r.__mobxInstanceCount>0&&!r.__mobxGlobals&&(Ju=!1),r.__mobxGlobals&&r.__mobxGlobals.version!==new Ku().version&&(Ju=!1),Ju?r.__mobxGlobals?(r.__mobxInstanceCount+=1,r.__mobxGlobals.UNCHANGED||(r.__mobxGlobals.UNCHANGED={}),r.__mobxGlobals):(r.__mobxInstanceCount=1,r.__mobxGlobals=new Ku):(setTimeout(function(){E1||en("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new Ku)}();function RP(){(mt.pendingReactions.length||mt.inBatch||mt.isRunningReactions)&&en("isolateGlobalState should be called before MobX is running any reactions"),E1=!0,Ju&&(--Wf().__mobxInstanceCount===0&&(Wf().__mobxGlobals=void 0),mt=new Ku)}function Uf(){return mt}function IP(r,e){r.observers.add(e),r.lowestObserverState>e.dependenciesState&&(r.lowestObserverState=e.dependenciesState)}function C1(r,e){r.observers.delete(e),r.observers.size===0&&O1(r)}function O1(r){r.isPendingUnobservation===!1&&(r.isPendingUnobservation=!0,mt.pendingUnobservations.push(r))}function _i(){mt.inBatch++}function bi(){if(--mt.inBatch===0){A1();for(var r=mt.pendingUnobservations,e=0;e<r.length;e++){var t=r[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof Ka&&t.suspend())}mt.pendingUnobservations=[]}}function k1(r){var e=mt.trackingDerivation;return e!==null?(e.runId!==r.lastAccessedBy&&(r.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=r,r.isBeingObserved||(r.isBeingObserved=!0,r.onBecomeObserved())),!0):(r.observers.size===0&&mt.inBatch>0&&O1(r),!1)}function BP(r){r.lowestObserverState!==nn.STALE&&(r.lowestObserverState=nn.STALE,r.observers.forEach(function(e){e.dependenciesState===nn.UP_TO_DATE&&(e.isTracing!==ji.NONE&&N1(e,r),e.onBecomeStale()),e.dependenciesState=nn.STALE}))}function jP(r){r.lowestObserverState!==nn.STALE&&(r.lowestObserverState=nn.STALE,r.observers.forEach(function(e){e.dependenciesState===nn.POSSIBLY_STALE?e.dependenciesState=nn.STALE:e.dependenciesState===nn.UP_TO_DATE&&(r.lowestObserverState=nn.UP_TO_DATE)}))}function HP(r){r.lowestObserverState===nn.UP_TO_DATE&&(r.lowestObserverState=nn.POSSIBLY_STALE,r.observers.forEach(function(e){e.dependenciesState===nn.UP_TO_DATE&&(e.dependenciesState=nn.POSSIBLY_STALE,e.isTracing!==ji.NONE&&N1(e,r),e.onBecomeStale())}))}function N1(r,e){if(""+r.name+e.name,r.isTracing===ji.BREAK){var t=[];M1(ZP(r),t,1),new Function(`debugger;
/*
Tracing '`+r.name+`'

You are entering this break point because derivation '`+r.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(r instanceof Ka?r.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function M1(r,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+r.name),r.dependencies&&r.dependencies.forEach(function(n){return M1(n,e,t+1)})}var bl=function(){function r(e,t,n,i){e===void 0&&(e="Reaction@"+Lr()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=n,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=nn.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+Lr(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=ji.NONE}return r.prototype.onBecomeStale=function(){this.schedule()},r.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,mt.pendingReactions.push(this),A1())},r.prototype.isScheduled=function(){return this._isScheduled},r.prototype.runReaction=function(){if(!this.isDisposed){if(_i(),this._isScheduled=!1,Ff(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&Qr()}catch(e){this.reportExceptionInDerivation(e)}}bi()}},r.prototype.track=function(e){if(!this.isDisposed){_i(),this._isRunning=!0;var t=b1(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&zf(this),Qs(t)&&this.reportExceptionInDerivation(t.cause),bi()}},r.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(mt.disableErrorBoundaries)throw e;var n="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";mt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(n,e),mt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},r.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(_i(),zf(this),bi()))},r.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[Dt]=this,e},r.prototype.toString=function(){return"Reaction["+this.name+"]"},r.prototype.trace=function(e){e===void 0&&(e=!1),oR(this,e)},r}(),Ig=100,Vf=function(r){return r()};function A1(){mt.inBatch>0||mt.isRunningReactions||Vf($P)}function $P(){mt.isRunningReactions=!0;for(var r=mt.pendingReactions,e=0;r.length>0;){++e===Ig&&(console.error("Reaction doesn't converge to a stable state after "+Ig+" iterations."+(" Probably there is a cycle in the reactive function: "+r[0])),r.splice(0));for(var t=r.splice(0),n=0,i=t.length;n<i;n++)t[n].runReaction()}mt.isRunningReactions=!1}var cd=No("Reaction",bl);function FP(r){var e=Vf;Vf=function(t){return r(function(){return e(t)})}}function Qr(){return!1}function zP(r){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function WP(){en(!1)}function Bg(r){return function(e,t,n){if(n){if(n.value)return{value:Qo(r,n.value),enumerable:!1,configurable:!0,writable:!0};var i=n.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return Qo(r,i.call(this))}}}return UP(r).apply(this,arguments)}}function UP(r){return function(e,t,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){gs(this,t,Oe(r,i))}})}}function VP(r,e,t,n){return n===!0?(ff(r,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return ff(this,e,t.value||t.initializer.call(this)),this[e]},set:WP}:{enumerable:!1,configurable:!0,set:function(i){ff(this,e,i)},get:function(){}}}var Oe=function(e,t,n,i){if(arguments.length===1&&typeof e=="function")return Qo(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return Qo(e,t);if(arguments.length===1&&typeof e=="string")return Bg(e);if(i===!0)gs(e,t,Qo(e.name||t,n.value,this));else return Bg(t).apply(null,arguments)};Oe.bound=VP;function XP(r,e){var t=typeof r=="string"?r:r.name||"<unnamed action>",n=typeof r=="function"?r:e;return S1(t,n,this,void 0)}function ff(r,e,t){gs(r,e,Qo(e,t.bind(r)))}function GP(r,e){e===void 0&&(e=Xh);var t=e&&e.name||r.name||"Autorun@"+Lr(),n=!e.scheduler&&!e.delay,i;if(n)i=new bl(t,function(){this.track(l)},e.onError,e.requiresObservable);else{var o=T1(e),s=!1;i=new bl(t,function(){s||(s=!0,o(function(){s=!1,i.isDisposed||i.track(l)}))},e.onError,e.requiresObservable)}function l(){r(i)}return i.schedule(),i.getDisposer()}var YP=function(r){return r()};function T1(r){return r.scheduler?r.scheduler:r.delay?function(e){return setTimeout(e,r.delay)}:YP}function D1(r,e,t){t===void 0&&(t=Xh);var n=t.name||"Reaction@"+Lr(),i=Oe(n,t.onError?qP(t.onError,e):e),o=!t.scheduler&&!t.delay,s=T1(t),l=!0,d=!1,c,f=t.compareStructural?Ya.structural:t.equals||Ya.default,v=new bl(n,function(){l||o?g():d||(d=!0,s(g))},t.onError,t.requiresObservable);function g(){if(d=!1,!v.isDisposed){var y=!1;v.track(function(){var b=r(v);y=l||!f(c,b),c=b}),l&&t.fireImmediately&&i(c,v),!l&&y===!0&&i(c,v),l&&(l=!1)}}return v.schedule(),v.getDisposer()}function qP(r,e){return function(){try{return e.apply(this,arguments)}catch(t){r.call(this,t)}}}function KP(r,e,t){return P1("onBecomeObserved",r,e)}function L1(r,e,t){return P1("onBecomeUnobserved",r,e)}function P1(r,e,t,n){var i=Eo(e),o=t,s=r+"Listeners";i[s]?i[s].add(o):i[s]=new Set([o]);var l=i[r];return typeof l!="function"?en(!1):function(){var d=i[s];d&&(d.delete(o),d.size===0&&delete i[s])}}function JP(r){var e=r.enforceActions,t=r.computedRequiresReaction,n=r.computedConfigurable,i=r.disableErrorBoundaries,o=r.reactionScheduler,s=r.reactionRequiresObservable,l=r.observableRequiresReaction;if(RP(),e!==void 0){var d=void 0;switch(e){case!0:case"observed":d=!0;break;case!1:case"never":d=!1;break;case"strict":case"always":d="strict";break;default:en("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}mt.enforceActions=d,mt.allowStateChanges=!(d===!0||d==="strict")}t!==void 0&&(mt.computedRequiresReaction=!!t),s!==void 0&&(mt.reactionRequiresObservable=!!s),l!==void 0&&(mt.observableRequiresReaction=!!l,mt.allowStateReads=!mt.observableRequiresReaction),n!==void 0&&(mt.computedConfigurable=!!n),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),mt.disableErrorBoundaries=!!i),o&&FP(o)}function Xf(r,e,t,n){n=Ra(n);var i=R1(n);return na(r),tp(r,n.name,i.enhancer),e&&I1(r,e,t,i),r}function R1(r){return r.defaultDecorator||(r.deep===!1?_1:Jh)}function I1(r,e,t,n){var i,o,s,l,d,c;_i();try{var s=vP(e);try{for(var f=Bi(s),v=f.next();!v.done;v=f.next()){var c=v.value,g=Object.getOwnPropertyDescriptor(e,c),y=t&&c in t?t[c]:g.get?ld:n,b=y(r,c,g,!0);b&&Object.defineProperty(r,c,b)}}catch(x){i={error:x}}finally{try{v&&!v.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}finally{bi()}}function ZP(r,e){return B1(Eo(r,e))}function B1(r){var e={name:r.name};return r.observing&&r.observing.length>0&&(e.dependencies=cP(r.observing).map(B1)),e}function j1(r,e){if(r==null)return!1;if(e!==void 0){if(ki(r)===!1||!r[Dt].values.has(e))return!1;var t=Eo(r,e);return Ja(t)}return Ja(r)}function QP(r){return arguments.length>1?en(!1):j1(r)}function jg(r,e){return typeof e!="string"?en(!1):j1(r,e)}function eR(r,e){return r==null?!1:ki(r)||!!r[Dt]||Yh(r)||cd(r)||Ja(r)}function Za(r){return arguments.length!==1&&en(!1),eR(r)}function Qa(r){return ki(r)?r[Dt].getKeys():Ir(r)||ti(r)?Array.from(r.keys()):Vi(r)?r.map(function(e,t){return t}):en(!1)}function tR(r){return ki(r)?Qa(r).map(function(e){return r[e]}):Ir(r)?Qa(r).map(function(e){return r.get(e)}):ti(r)?Array.from(r.values()):Vi(r)?r.slice():en(!1)}function nR(r){return ki(r)?Qa(r).map(function(e){return[e,r[e]]}):Ir(r)?Qa(r).map(function(e){return[e,r.get(e)]}):ti(r)?Array.from(r.entries()):Vi(r)?r.map(function(e,t){return[t,e]}):en(!1)}function Qh(r,e,t){if(arguments.length===2&&!ti(r)){_i();var n=e;try{for(var i in n)Qh(r,i,n[i])}finally{bi()}return}if(ki(r)){var o=r[Dt],s=o.values.get(e);s?o.write(e,t):o.addObservableProp(e,t,o.defaultEnhancer)}else if(Ir(r))r.set(e,t);else if(ti(r))r.add(e);else if(Vi(r))typeof e!="number"&&(e=parseInt(e,10)),Zo(e>=0,"Not a valid index: '"+e+"'"),_i(),e>=r.length&&(r.length=e+1),r[e]=t,bi();else return en(!1)}function H1(r,e,t,n){return rR(r,e,t)}function rR(r,e,t){return ac(r).observe(e,t)}var iR={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Na(r,e,t,n){return n.detectCycles&&r.set(e,t),t}function go(r,e,t){if(!e.recurseEverything&&!Za(r)||typeof r!="object")return r;if(r===null)return null;if(r instanceof Date)return r;if(LP(r))return go(r.get(),e,t);Za(r)&&Qa(r);var n=e.detectCycles===!0;if(n&&r!==null&&t.has(r))return t.get(r);if(Vi(r)||Array.isArray(r)){var i=Na(t,r,[],e),o=r.map(function(y){return go(y,e,t)});i.length=o.length;for(var s=0,l=o.length;s<l;s++)i[s]=o[s];return i}if(ti(r)||Object.getPrototypeOf(r)===Set.prototype)if(e.exportMapsAsObjects===!1){var d=Na(t,r,new Set,e);return r.forEach(function(y){d.add(go(y,e,t))}),d}else{var c=Na(t,r,[],e);return r.forEach(function(y){c.push(go(y,e,t))}),c}if(Ir(r)||Object.getPrototypeOf(r)===Map.prototype)if(e.exportMapsAsObjects===!1){var f=Na(t,r,new Map,e);return r.forEach(function(y,b){f.set(b,go(y,e,t))}),f}else{var v=Na(t,r,{},e);return r.forEach(function(y,b){v[b]=go(y,e,t)}),v}var g=Na(t,r,{},e);return v1(r).forEach(function(y){g[y]=go(r[y],e,t)}),g}function pi(r,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=iR),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),go(r,e,t)}function oR(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=!1;typeof r[r.length-1]=="boolean"&&(t=r.pop());var n=aR(r);if(!n)return en(!1);n.isTracing===ji.NONE&&""+n.name,n.isTracing=t?ji.BREAK:ji.LOG}function aR(r){switch(r.length){case 0:return mt.trackingDerivation;case 1:return Eo(r[0]);case 2:return Eo(r[0],r[1])}}function gi(r,e){e===void 0&&(e=void 0),_i();try{return r.apply(e)}finally{bi()}}function ku(r){return r[Dt]}function Nu(r){return typeof r=="string"||typeof r=="number"||typeof r=="symbol"}var sR={has:function(r,e){if(e===Dt||e==="constructor"||e===sd)return!0;var t=ku(r);return Nu(e)?t.has(e):e in r},get:function(r,e){if(e===Dt||e==="constructor"||e===sd)return r[e];var t=ku(r),n=t.values.get(e);if(n instanceof ys){var i=n.get();return i===void 0&&t.has(e),i}return Nu(e)&&t.has(e),r[e]},set:function(r,e,t){return Nu(e)?(Qh(r,e,t),!0):!1},deleteProperty:function(r,e){if(!Nu(e))return!1;var t=ku(r);return t.remove(e),!0},ownKeys:function(r){var e=ku(r);return e.keysAtom.reportObserved(),Reflect.ownKeys(r)},preventExtensions:function(r){return en("Dynamic observable objects cannot be frozen"),!1}};function lR(r){var e=new Proxy(r,sR);return r[Dt].proxy=e,e}function Hi(r){return r.interceptors!==void 0&&r.interceptors.length>0}function Ul(r,e){var t=r.interceptors||(r.interceptors=[]);return t.push(e),p1(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function $i(r,e){var t=_s();try{for(var n=Kh(r.interceptors||[]),i=0,o=n.length;i<o&&(e=n[i](e),Zo(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{wo(t)}}function xi(r){return r.changeListeners!==void 0&&r.changeListeners.length>0}function Vl(r,e){var t=r.changeListeners||(r.changeListeners=[]);return t.push(e),p1(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function wi(r,e){var t=_s(),n=r.changeListeners;if(n){n=n.slice();for(var i=0,o=n.length;i<o;i++)n[i](e);wo(t)}}var uR=1e4,dR={get:function(r,e){return e===Dt?r[Dt]:e==="length"?r[Dt].getArrayLength():typeof e=="number"?Qi.get.call(r,e):typeof e=="string"&&!isNaN(e)?Qi.get.call(r,parseInt(e)):Qi.hasOwnProperty(e)?Qi[e]:r[e]},set:function(r,e,t){return e==="length"&&r[Dt].setArrayLength(t),typeof e=="number"&&Qi.set.call(r,e,t),typeof e=="symbol"||isNaN(e)?r[e]=t:Qi.set.call(r,parseInt(e),t),!0},preventExtensions:function(r){return en("Observable arrays cannot be frozen"),!1}};function cR(r,e,t,n){t===void 0&&(t="ObservableArray@"+Lr()),n===void 0&&(n=!1);var i=new $1(t,e,n);hP(i.values,Dt,i);var o=new Proxy(i.values,dR);if(i.proxy=o,r&&r.length){var s=ic(!0);i.spliceWithArray(0,0,r),oc(s)}return o}var $1=function(){function r(e,t,n){this.owned=n,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new ys(e||"ObservableArray@"+Lr()),this.enhancer=function(i,o){return t(i,o,e+"[..]")}}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},r.prototype.intercept=function(e){return Ul(this,e)},r.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),Vl(this,e)},r.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},r.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var n=new Array(e-t),i=0;i<e-t;i++)n[i]=void 0;this.spliceWithArray(t,0,n)}else this.spliceWithArray(e,t-e)},r.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},r.prototype.spliceWithArray=function(e,t,n){var i=this;qa(this.atom);var o=this.values.length;if(e===void 0?e=0:e>o?e=o:e<0&&(e=Math.max(0,o+e)),arguments.length===1?t=o-e:t==null?t=0:t=Math.max(0,Math.min(t,o-e)),n===void 0&&(n=od),Hi(this)){var s=$i(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:n});if(!s)return od;t=s.removedCount,n=s.added}n=n.length===0?n:n.map(function(d){return i.enhancer(d,void 0)});var l=this.spliceItemsIntoValues(e,t,n);return(t!==0||n.length!==0)&&this.notifyArraySplice(e,n,l),this.dehanceValues(l)},r.prototype.spliceItemsIntoValues=function(e,t,n){var i;if(n.length<uR)return(i=this.values).splice.apply(i,Kh([e,t],n));var o=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(n,this.values.slice(e+t)),o},r.prototype.notifyArrayChildUpdate=function(e,t,n){var i=!this.owned&&Qr(),o=xi(this),s=o||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:n}:null;this.atom.reportChanged(),o&&wi(this,s)},r.prototype.notifyArraySplice=function(e,t,n){var i=!this.owned&&Qr(),o=xi(this),s=o||i?{object:this.proxy,type:"splice",index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom.reportChanged(),o&&wi(this,s)},r}(),Qi={intercept:function(r){return this[Dt].intercept(r)},observe:function(r,e){e===void 0&&(e=!1);var t=this[Dt];return t.observe(r,e)},clear:function(){return this.splice(0)},replace:function(r){var e=this[Dt];return e.spliceWithArray(0,e.values.length,r)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=this[Dt];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(r);case 2:return i.spliceWithArray(r,e)}return i.spliceWithArray(r,e,t)},spliceWithArray:function(r,e,t){var n=this[Dt];return n.spliceWithArray(r,e,t)},push:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[Dt];return t.spliceWithArray(t.values.length,0,r),t.values.length},pop:function(){return this.splice(Math.max(this[Dt].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[Dt];return t.spliceWithArray(0,0,r),t.values.length},reverse:function(){var r=this.slice();return r.reverse.apply(r,arguments)},sort:function(r){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(r){var e=this[Dt],t=e.dehanceValues(e.values).indexOf(r);return t>-1?(this.splice(t,1),!0):!1},get:function(r){var e=this[Dt];if(e){if(r<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[r]);console.warn("[mobx.array] Attempt to read an array index ("+r+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(r,e){var t=this[Dt],n=t.values;if(r<n.length){qa(t.atom);var i=n[r];if(Hi(t)){var o=$i(t,{type:"update",object:t.proxy,index:r,newValue:e});if(!o)return;e=o.newValue}e=t.enhancer(e,i);var s=e!==i;s&&(n[r]=e,t.notifyArrayChildUpdate(r,e,i))}else if(r===n.length)t.spliceWithArray(r,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+r+" is larger than "+n.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(r){typeof Array.prototype[r]=="function"&&(Qi[r]=function(){var e=this[Dt];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[r].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(r){typeof Array.prototype[r]=="function"&&(Qi[r]=function(e,t){var n=this,i=this[Dt];i.atom.reportObserved();var o=i.dehanceValues(i.values);return o[r](function(s,l){return e.call(t,s,l,n)},t)})});["reduce","reduceRight"].forEach(function(r){Qi[r]=function(){var e=this,t=this[Dt];t.atom.reportObserved();var n=arguments[0];return arguments[0]=function(i,o,s){return o=t.dehanceValue(o),n(i,o,s,e)},t.values[r].apply(t.values,arguments)}});var fR=No("ObservableArrayAdministration",$1);function Vi(r){return Gh(r)&&fR(r[Dt])}var Hg,hR={},ep=function(){function r(e,t,n){if(t===void 0&&(t=Wl),n===void 0&&(n="ObservableMap@"+Lr()),this.enhancer=t,this.name=n,this[Hg]=hR,this._keysAtom=qh(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return r.prototype._has=function(e){return this._data.has(e)},r.prototype.has=function(e){var t=this;if(!mt.trackingDerivation)return this._has(e);var n=this._hasMap.get(e);if(!n){var i=n=new ea(this._has(e),nc,this.name+"."+bo(e)+"?",!1);this._hasMap.set(e,i),L1(i,function(){return t._hasMap.delete(e)})}return n.get()},r.prototype.set=function(e,t){var n=this._has(e);if(Hi(this)){var i=$i(this,{type:n?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return n?this._updateValue(e,t):this._addValue(e,t),this},r.prototype.delete=function(e){var t=this;if(qa(this._keysAtom),Hi(this)){var n=$i(this,{type:"delete",object:this,name:e});if(!n)return!1}if(this._has(e)){var i=Qr(),o=xi(this),n=o||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return gi(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var l=t._data.get(e);l.setNewValue(void 0),t._data.delete(e)}),o&&wi(this,n),!0}return!1},r.prototype._updateHasMapEntry=function(e,t){var n=this._hasMap.get(e);n&&n.setNewValue(t)},r.prototype._updateValue=function(e,t){var n=this._data.get(e);if(t=n.prepareNewValue(t),t!==mt.UNCHANGED){var i=Qr(),o=xi(this),s=o||i?{type:"update",object:this,oldValue:n.value,name:e,newValue:t}:null;n.setNewValue(t),o&&wi(this,s)}},r.prototype._addValue=function(e,t){var n=this;qa(this._keysAtom),gi(function(){var l=new ea(t,n.enhancer,n.name+"."+bo(e),!1);n._data.set(e,l),t=l.value,n._updateHasMapEntry(e,!0),n._keysAtom.reportChanged()});var i=Qr(),o=xi(this),s=o||i?{type:"add",object:this,name:e,newValue:t}:null;o&&wi(this,s)},r.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},r.prototype.values=function(){var e=this,t=this.keys();return fd({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:e.get(o)}}})},r.prototype.entries=function(){var e=this,t=this.keys();return fd({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:[o,e.get(o)]}}})},r.prototype[Hg=Dt,Symbol.iterator]=function(){return this.entries()},r.prototype.forEach=function(e,t){var n,i;try{for(var o=Bi(this),s=o.next();!s.done;s=o.next()){var l=Ba(s.value,2),d=l[0],c=l[1];e.call(t,c,d,this)}}catch(f){n={error:f}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},r.prototype.merge=function(e){var t=this;return Ir(e)&&(e=e.toJS()),gi(function(){var n=ic(!0);try{vs(e)?v1(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var o=Ba(i,2),s=o[0],l=o[1];return t.set(s,l)}):ms(e)?(e.constructor!==Map&&en("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,o){return t.set(o,i)})):e!=null&&en("Cannot initialize map from "+e)}finally{oc(n)}}),this},r.prototype.clear=function(){var e=this;gi(function(){x1(function(){var t,n;try{for(var i=Bi(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;e.delete(s)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.replace=function(e){var t=this;return gi(function(){var n,i,o,s,l=fP(e),d=new Map,c=!1;try{for(var f=Bi(t._data.keys()),v=f.next();!v.done;v=f.next()){var g=v.value;if(!l.has(g)){var y=t.delete(g);if(y)c=!0;else{var b=t._data.get(g);d.set(g,b)}}}}catch(F){n={error:F}}finally{try{v&&!v.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var _=Bi(l.entries()),x=_.next();!x.done;x=_.next()){var w=Ba(x.value,2),g=w[0],b=w[1],C=t._data.has(g);if(t.set(g,b),t._data.has(g)){var k=t._data.get(g);d.set(g,k),C||(c=!0)}}}catch(F){o={error:F}}finally{try{x&&!x.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}if(!c)if(t._data.size!==d.size)t._keysAtom.reportChanged();else for(var D=t._data.keys(),I=d.keys(),$=D.next(),R=I.next();!$.done;){if($.value!==R.value){t._keysAtom.reportChanged();break}$=D.next(),R=I.next()}t._data=d}),this},Object.defineProperty(r.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.toPOJO=function(){var e,t,n={};try{for(var i=Bi(this),o=i.next();!o.done;o=i.next()){var s=Ba(o.value,2),l=s[0],d=s[1];n[typeof l=="symbol"?l:bo(l)]=d}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.toJS=function(){return new Map(this)},r.prototype.toJSON=function(){return this.toPOJO()},r.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return bo(t)+": "+(""+e.get(t))}).join(", ")+" }]"},r.prototype.observe=function(e,t){return Vl(this,e)},r.prototype.intercept=function(e){return Ul(this,e)},r}(),Ir=No("ObservableMap",ep),$g,pR={},F1=function(){function r(e,t,n){if(t===void 0&&(t=Wl),n===void 0&&(n="ObservableSet@"+Lr()),this.name=n,this[$g]=pR,this._data=new Set,this._atom=qh(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,o){return t(i,o,n)},e&&this.replace(e)}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.clear=function(){var e=this;gi(function(){x1(function(){var t,n;try{for(var i=Bi(e._data.values()),o=i.next();!o.done;o=i.next()){var s=o.value;e.delete(s)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.forEach=function(e,t){var n,i;try{for(var o=Bi(this),s=o.next();!s.done;s=o.next()){var l=s.value;e.call(t,l,l,this)}}catch(d){n={error:d}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},Object.defineProperty(r.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.add=function(e){var t=this;if(qa(this._atom),Hi(this)){var n=$i(this,{type:"add",object:this,newValue:e});if(!n)return this}if(!this.has(e)){gi(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=Qr(),o=xi(this),n=o||i?{type:"add",object:this,newValue:e}:null;o&&wi(this,n)}return this},r.prototype.delete=function(e){var t=this;if(Hi(this)){var n=$i(this,{type:"delete",object:this,oldValue:e});if(!n)return!1}if(this.has(e)){var i=Qr(),o=xi(this),n=o||i?{type:"delete",object:this,oldValue:e}:null;return gi(function(){t._atom.reportChanged(),t._data.delete(e)}),o&&wi(this,n),!0}return!1},r.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},r.prototype.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return fd({next:function(){var i=e;return e+=1,i<n.length?{value:[t[i],n[i]],done:!1}:{done:!0}}})},r.prototype.keys=function(){return this.values()},r.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,n=Array.from(this._data.values());return fd({next:function(){return t<n.length?{value:e.dehanceValue(n[t++]),done:!1}:{done:!0}}})},r.prototype.replace=function(e){var t=this;return ti(e)&&(e=e.toJS()),gi(function(){var n=ic(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):zl(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&en("Cannot initialize set from "+e)}finally{oc(n)}}),this},r.prototype.observe=function(e,t){return Vl(this,e)},r.prototype.intercept=function(e){return Ul(this,e)},r.prototype.toJS=function(){return new Set(this)},r.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},r.prototype[$g=Dt,Symbol.iterator]=function(){return this.values()},r}(),ti=No("ObservableSet",F1),z1=function(){function r(e,t,n,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=n,this.defaultEnhancer=i,this.keysAtom=new ys(n+".keys")}return r.prototype.read=function(e){return this.values.get(e).get()},r.prototype.write=function(e,t){var n=this.target,i=this.values.get(e);if(i instanceof Ka){i.set(t);return}if(Hi(this)){var o=$i(this,{type:"update",object:this.proxy||n,name:e,newValue:t});if(!o)return;t=o.newValue}if(t=i.prepareNewValue(t),t!==mt.UNCHANGED){var s=xi(this),l=Qr(),o=s||l?{type:"update",object:this.proxy||n,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),s&&wi(this,o)}},r.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),n=t.get(e);if(n)return n.get();var i=!!this.values.get(e);return n=new ea(i,nc,this.name+"."+bo(e)+"?",!1),t.set(e,n),n.get()},r.prototype.addObservableProp=function(e,t,n){n===void 0&&(n=this.defaultEnhancer);var i=this.target;if(Hi(this)){var o=$i(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!o)return;t=o.newValue}var s=new ea(t,n,this.name+"."+bo(e),!1);this.values.set(e,s),t=s.value,Object.defineProperty(i,e,vR(e)),this.notifyPropertyAddition(e,t)},r.prototype.addComputedProp=function(e,t,n){var i=this.target;n.name=n.name||this.name+"."+bo(t),this.values.set(t,new Ka(n)),(e===i||pP(e,t))&&Object.defineProperty(e,t,gR(t))},r.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(Hi(this)){var n=$i(this,{object:this.proxy||t,name:e,type:"remove"});if(!n)return}try{_i();var i=xi(this),o=Qr(),s=this.values.get(e),l=s&&s.get();if(s&&s.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var d=this.pendingKeys.get(e);d&&d.set(!1)}delete this.target[e];var n=i||o?{type:"remove",object:this.proxy||t,oldValue:l,name:e}:null;i&&wi(this,n)}finally{bi()}}},r.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},r.prototype.observe=function(e,t){return Vl(this,e)},r.prototype.intercept=function(e){return Ul(this,e)},r.prototype.notifyPropertyAddition=function(e,t){var n=xi(this),i=Qr(),o=n||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(n&&wi(this,o),this.pendingKeys){var s=this.pendingKeys.get(e);s&&s.set(!0)}this.keysAtom.reportChanged()},r.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var n=[];try{for(var i=Bi(this.values),o=i.next();!o.done;o=i.next()){var s=Ba(o.value,2),l=s[0],d=s[1];d instanceof ea&&n.push(l)}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}();function tp(r,e,t){if(e===void 0&&(e=""),t===void 0&&(t=Wl),Object.prototype.hasOwnProperty.call(r,Dt))return r[Dt];vs(r)||(e=(r.constructor.name||"ObservableObject")+"@"+Lr()),e||(e="ObservableObject@"+Lr());var n=new z1(r,new Map,bo(e),t);return gs(r,Dt,n),n}var Fg=Object.create(null),zg=Object.create(null);function vR(r){return Fg[r]||(Fg[r]={configurable:!0,enumerable:!0,get:function(){return this[Dt].read(r)},set:function(e){this[Dt].write(r,e)}})}function Wg(r){var e=r[Dt];return e||(na(r),r[Dt])}function gR(r){return zg[r]||(zg[r]={configurable:mt.computedConfigurable,enumerable:!1,get:function(){return Wg(this).read(r)},set:function(e){Wg(this).write(r,e)}})}var mR=No("ObservableObjectAdministration",z1);function ki(r){return Gh(r)?(na(r),mR(r[Dt])):!1}function Eo(r,e){if(typeof r=="object"&&r!==null){if(Vi(r))return e!==void 0&&en(!1),r[Dt].atom;if(ti(r))return r[Dt];if(Ir(r)){var t=r;if(e===void 0)return t._keysAtom;var n=t._data.get(e)||t._hasMap.get(e);return n||en(!1),n}if(na(r),e&&!r[Dt]&&r[e],ki(r)){if(!e)return en(!1);var n=r[Dt].values.get(e);return n||en(!1),n}if(Yh(r)||Ja(r)||cd(r))return r}else if(typeof r=="function"&&cd(r[Dt]))return r[Dt];return en(!1)}function ac(r,e){if(r||en("Expecting some object"),e!==void 0)return ac(Eo(r,e));if(Yh(r)||Ja(r)||cd(r)||Ir(r)||ti(r))return r;if(na(r),r[Dt])return r[Dt];en(!1)}function yR(r,e){var t;return e!==void 0?t=Eo(r,e):ki(r)||Ir(r)||ti(r)?t=ac(r):t=Eo(r),t.name}var Ug=Object.prototype.toString;function W1(r,e,t){return t===void 0&&(t=-1),Gf(r,e,t)}function Gf(r,e,t,n,i){if(r===e)return r!==0||1/r===1/e;if(r==null||e==null)return!1;if(r!==r)return e!==e;var o=typeof r;if(o!=="function"&&o!=="object"&&typeof e!="object")return!1;var s=Ug.call(r);if(s!==Ug.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+r==""+e;case"[object Number]":return+r!=+r?+e!=+e:+r==0?1/+r===1/e:+r==+e;case"[object Date]":case"[object Boolean]":return+r==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(r)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}r=Vg(r),e=Vg(e);var l=s==="[object Array]";if(!l){if(typeof r!="object"||typeof e!="object")return!1;var d=r.constructor,c=e.constructor;if(d!==c&&!(typeof d=="function"&&d instanceof d&&typeof c=="function"&&c instanceof c)&&"constructor"in r&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),n=n||[],i=i||[];for(var f=n.length;f--;)if(n[f]===r)return i[f]===e;if(n.push(r),i.push(e),l){if(f=r.length,f!==e.length)return!1;for(;f--;)if(!Gf(r[f],e[f],t-1,n,i))return!1}else{var v=Object.keys(r),g=void 0;if(f=v.length,Object.keys(e).length!==f)return!1;for(;f--;)if(g=v[f],!(_R(e,g)&&Gf(r[g],e[g],t-1,n,i)))return!1}return n.pop(),i.pop(),!0}function Vg(r){return Vi(r)?r.slice():ms(r)||Ir(r)||zl(r)||ti(r)?Array.from(r.entries()):r}function _R(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function fd(r){return r[Symbol.iterator]=bR,r}function bR(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:zP,extras:{getDebugName:yR},$mobx:Dt});function xR(r){return!(r.prototype&&r.prototype.render)&&!Wt.isPrototypeOf(r)}function U1(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,n=t===void 0?"":t,i=e.suffix,o=i===void 0?"":i,s=r.displayName||r.name||r.constructor&&r.constructor.name||"<component>";return n+s+o}var Xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},V1=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},X1=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),G1=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},Y1=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},Gg=console;function wR(r){var e=Uf().allowStateChanges;return Uf().allowStateChanges=r,e}function SR(r){Uf().allowStateChanges=r}function ER(r,e,t,n,i){var o=wR(r),s=void 0;try{s=e(t,n,i)}finally{SR(o)}return s}function Yg(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r[e],i=q1[e],o=n?t===!0?function(){i.apply(this,arguments),n.apply(this,arguments)}:function(){n.apply(this,arguments),i.apply(this,arguments)}:i;r[e]=o}function qg(r,e){if(r==null||e==null||(typeof r>"u"?"undefined":Xg(r))!=="object"||(typeof e>"u"?"undefined":Xg(e))!=="object")return r!==e;var t=Object.keys(r);if(t.length!==Object.keys(e).length)return!0;for(var n=void 0,i=t.length-1;n=t[i];i--)if(e[n]!==r[n])return!0;return!1}var q1={componentWillMount:function(){var e=this,t=U1(this),n=!1,i=!1;function o(v){var g=this[v],y=qh("reactive "+v);Object.defineProperty(this,v,{configurable:!0,enumerable:!0,get:function(){return y.reportObserved(),g},set:function(_){!i&&qg(g,_)?(g=_,n=!0,y.reportChanged(),n=!1):g=_}})}o.call(this,"props"),o.call(this,"state");var s=this.render.bind(this),l=null,d=!1,c=function(){return l=new bl(t+".render()",function(){if(!d&&(d=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var g=!0;try{i=!0,n||Wt.prototype.forceUpdate.call(e),g=!1}finally{i=!1,g&&l.dispose()}}}),l.reactComponent=e,f.$mobx=l,e.render=f,f(e.props,e.state,e.context)},f=function(g,y,b){d=!1;var _=void 0,x=void 0;if(l.track(function(){try{x=ER(!1,s,g,y,b)}catch(w){_=w}}),_)throw _;return x};this.render=c},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:qg(this.props,e)}};function np(r){if(arguments.length>1&&Gg.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),r.isMobxInjector===!0&&Gg.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),xR(r)){var e,t;return np((t=e=function(i){G1(o,i);function o(){return V1(this,o),Y1(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return X1(o,[{key:"render",value:function(){return r.call(this,this.props,this.context)}}]),o}(Wt),e.displayName=U1(r),t))}if(!r)throw new Error("Please pass a valid component to 'observer'");var n=r.prototype||r;return CR(n),r.isMobXReactObserver=!0,r}function CR(r){Yg(r,"componentWillMount",!0),Yg(r,"componentDidMount"),r.shouldComponentUpdate||(r.shouldComponentUpdate=q1.shouldComponentUpdate)}var OR=np(function(r){var e=r.children;return e[0]()});OR.displayName="Observer";var kR=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function NR(r,e){return e={exports:{}},r(e,e.exports),e.exports}NR(function(r,e){(function(t,n){r.exports=n()})(kR,function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,o=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,l=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,c=d&&d(Object);return function f(v,g,y){if(typeof g!="string"){if(c){var b=d(g);b&&b!==c&&f(v,b,y)}var _=o(g);s&&(_=_.concat(s(g)));for(var x=0;x<_.length;++x){var w=_[x];if(!t[w]&&!n[w]&&(!y||!y[w])){var C=l(g,w);try{i(v,w,C)}catch{}}}return v}return v}})});var Kg={children:!0,key:!0,ref:!0},Jg=console;(function(r){G1(e,r);function e(){return V1(this,e),Y1(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return X1(e,[{key:"render",value:function(n){var i=n.children;return i.length>1?vt("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var n={},i=this.context.mobxStores;if(i)for(var o in i)n[o]=i[o];for(var s in this.props)!Kg[s]&&s!=="suppressChangedStoreWarning"&&(n[s]=this.props[s]);return{mobxStores:n}}},{key:"componentWillReceiveProps",value:function(n){if(Object.keys(n).length!==Object.keys(this.props).length&&Jg.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!n.suppressChangedStoreWarning)for(var i in n)!Kg[i]&&this.props[i]!==n[i]&&Jg.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Wt);if(!Wt)throw new Error("mobx-preact requires Preact to be available");var Ri,hf,Zg,K1=[],nr=Ft,Qg=nr.__b,em=nr.__r,tm=nr.diffed,nm=nr.__c,rm=nr.unmount,im=nr.__;function MR(){for(var r;r=K1.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(Zu),r.__H.__h.forEach(Yf),r.__H.__h=[]}catch(e){r.__H.__h=[],nr.__e(e,r.__v)}}nr.__b=function(r){Ri=null,Qg&&Qg(r)},nr.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),im&&im(r,e)},nr.__r=function(r){em&&em(r);var e=(Ri=r.__c).__H;e&&(hf===Ri?(e.__h=[],Ri.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(Zu),e.__h.forEach(Yf),e.__h=[])),hf=Ri},nr.diffed=function(r){tm&&tm(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(K1.push(e)!==1&&Zg===nr.requestAnimationFrame||((Zg=nr.requestAnimationFrame)||AR)(MR)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),hf=Ri=null},nr.__c=function(r,e){e.some(function(t){try{t.__h.forEach(Zu),t.__h=t.__h.filter(function(n){return!n.__||Yf(n)})}catch(n){e.some(function(i){i.__h&&(i.__h=[])}),e=[],nr.__e(n,t.__v)}}),nm&&nm(r,e)},nr.unmount=function(r){rm&&rm(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{Zu(n)}catch(i){e=i}}),t.__H=void 0,e&&nr.__e(e,t.__v))};var om=typeof requestAnimationFrame=="function";function AR(r){var e,t=function(){clearTimeout(n),om&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,35);om&&(e=requestAnimationFrame(t))}function Zu(r){var e=Ri,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),Ri=e}function Yf(r){var e=Ri;r.__c=r.__(),Ri=e}function TR(r,e){for(var t in e)r[t]=e[t];return r}function am(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function sm(r,e){this.props=r,this.context=e}(sm.prototype=new Wt).isPureReactComponent=!0,sm.prototype.shouldComponentUpdate=function(r,e){return am(this.props,r)||am(this.state,e)};var lm=Ft.__b;Ft.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),lm&&lm(r)};var DR=Ft.__e;Ft.__e=function(r,e,t,n){if(r.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(r,e)}DR(r,e,t,n)};var um=Ft.unmount;function J1(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=TR({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return J1(n,e,t)})),r}function Z1(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return Z1(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function pf(){this.__u=0,this.o=null,this.__b=null}function Q1(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function Mu(){this.i=null,this.l=null}Ft.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),um&&um(r)},(pf.prototype=new Wt).__c=function(r,e){var t=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(t);var i=Q1(n.__v),o=!1,s=function(){o||(o=!0,t.__R=null,i?i(l):l())};t.__R=s;var l=function(){if(!--n.__u){if(n.state.__a){var d=n.state.__a;n.__v.__k[0]=Z1(d,d.__c.__P,d.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(s,s)},pf.prototype.componentWillUnmount=function(){this.o=[]},pf.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=J1(this.__b,t,n.__O=n.__P)}this.__b=null}var i=e.__a&&vt(Xa,null,r.fallback);return i&&(i.__u&=-33),[vt(Xa,null,e.__a?null:r.children),i]};var dm=function(r,e,t){if(++t[1]===t[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(t=r.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.i=t=t[2]}};(Mu.prototype=new Wt).__a=function(r){var e=this,t=Q1(e.__v),n=e.l.get(r);return n[0]++,function(i){var o=function(){e.props.revealOrder?(n.push(i),dm(e,r,n)):i()};t?t(o):o()}},Mu.prototype.render=function(r){this.i=null,this.l=new Map;var e=id(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return r.children},Mu.prototype.componentDidUpdate=Mu.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,t){dm(r,t,e)})};var LR=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,PR=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,RR=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,IR=/[A-Z0-9]/g,BR=typeof document<"u",jR=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function cm(r,e,t){return e.__k==null&&(e.textContent=""),uP(r,e),typeof t=="function"&&t(),r?r.__c:null}Wt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Wt.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var fm=Ft.event;function HR(){}function $R(){return this.cancelBubble}function FR(){return this.defaultPrevented}Ft.event=function(r){return fm&&(r=fm(r)),r.persist=HR,r.isPropagationStopped=$R,r.isDefaultPrevented=FR,r.nativeEvent=r};var zR={enumerable:!1,configurable:!0,get:function(){return this.class}},hm=Ft.vnode;Ft.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,i={},o=n.indexOf("-")===-1;for(var s in t){var l=t[s];if(!(s==="value"&&"defaultValue"in t&&l==null||BR&&s==="children"&&n==="noscript"||s==="class"||s==="className")){var d=s.toLowerCase();s==="defaultValue"&&"value"in t&&t.value==null?s="value":s==="download"&&l===!0?l="":d==="translate"&&l==="no"?l=!1:d[0]==="o"&&d[1]==="n"?d==="ondoubleclick"?s="ondblclick":d!=="onchange"||n!=="input"&&n!=="textarea"||jR(t.type)?d==="onfocus"?s="onfocusin":d==="onblur"?s="onfocusout":RR.test(s)&&(s=d):d=s="oninput":o&&PR.test(s)?s=s.replace(IR,"-$&").toLowerCase():l===null&&(l=void 0),d==="oninput"&&i[s=d]&&(s="oninputCapture"),i[s]=l}}n=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=id(t.children).forEach(function(c){c.props.selected=i.value.indexOf(c.props.value)!=-1})),n=="select"&&i.defaultValue!=null&&(i.value=id(t.children).forEach(function(c){c.props.selected=i.multiple?i.defaultValue.indexOf(c.props.value)!=-1:i.defaultValue==c.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",zR)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i}(r),r.$$typeof=LR,hm&&hm(r)};var pm=Ft.__r;Ft.__r=function(r){pm&&pm(r),r.__c};var vm=Ft.diffed;Ft.diffed=function(r){vm&&vm(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var WR=0;function ke(r,e,t,n,i,o){e||(e={});var s,l,d=e;if("ref"in d)for(l in d={},e)l=="ref"?s=e[l]:d[l]=e[l];var c={type:r,props:d,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--WR,__i:-1,__u:0,__source:i,__self:o};if(typeof r=="function"&&(s=r.defaultProps))for(l in s)d[l]===void 0&&(d[l]=s[l]);return Ft.vnode&&Ft.vnode(c),c}var UR=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},xl;(function(r){function e(t){var n=UR(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return Qt({},r.defaults,n)}r.get=e})(xl||(xl={}));(function(r){r.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(xl||(xl={}));var gm={node:!1,edge:!1},VR={node:!0,edge:!0},XR=function(r){return!r||typeof r=="boolean"?r===!0?Lt(VR):Lt(gm):Wa(Lt(gm),r)},GR=function(){return jl(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function dr(r){try{return JSON.parse(JSON.stringify(r))}catch{return r}}var Au=200,YR=9999,qR=10,Yt;(function(r){r[r.DEFAULT=1]="DEFAULT",r[r.TEXT_EDIT=2]="TEXT_EDIT",r[r.SHOW_MENU=3]="SHOW_MENU",r[r.ALLOW_CONNECT=4]="ALLOW_CONNECT",r[r.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(Yt||(Yt={}));var xn;(function(r){r.NODE="node",r.EDGE="edge",r.GRAPH="graph"})(xn||(xn={}));var Ht;(function(r){r.NODE="node",r.CIRCLE_NODE="circle-node",r.POLYGON_NODE="polygon-node",r.RECT_NODE="rect-node",r.TEXT_NODE="text-node",r.ELLIPSE_NODE="ellipse-node",r.DIAMOND_NODE="diamond-node",r.HTML_NODE="html-node",r.CUSTOM_HTML_NODE="custom-html-node",r.EDGE="edge",r.LINE_EDGE="line-edge",r.POLYLINE_EDGE="polyline-edge",r.BEZIER_EDGE="bezier-edge",r.GRAPH="graph"})(Ht||(Ht={}));var yt;(function(r){r.ELEMENT_CLICK="element:click",r.NODE_ADD="node:add",r.NODE_DELETE="node:delete",r.NODE_CLICK="node:click",r.NODE_DBCLICK="node:dbclick",r.NODE_GROUP_COPY="node:group-copy-add",r.NODE_DND_ADD="node:dnd-add",r.NODE_DND_DRAG="node:dnd-drag",r.NODE_MOUSEDOWN="node:mousedown",r.NODE_DRAGSTART="node:dragstart",r.NODE_DRAG="node:drag",r.NODE_DROP="node:drop",r.NODE_MOUSEUP="node:mouseup",r.NODE_MOUSEMOVE="node:mousemove",r.NODE_MOUSEENTER="node:mouseenter",r.NODE_MOUSELEAVE="node:mouseleave",r.NODE_CONTEXTMENU="node:contextmenu",r.NODE_ROTATE="node:rotate",r.NODE_RESIZE="node:resize",r.NODE_FOCUS="node:focus",r.NODE_BLUR="node:blur",r.NODE_PROPERTIES_CHANGE="node:properties-change",r.NODE_PROPERTIES_DELETE="node:properties-delete",r.EDGE_ADD="edge:add",r.EDGE_DELETE="edge:delete",r.EDGE_CLICK="edge:click",r.EDGE_DBCLICK="edge:dbclick",r.EDGE_FOCUS="edge:focus",r.EDGE_BLUR="edge:blur",r.EDGE_MOUSEENTER="edge:mouseenter",r.EDGE_MOUSELEAVE="edge:mouseleave",r.EDGE_CONTEXTMENU="edge:contextmenu",r.EDGE_ADJUST="edge:adjust",r.EDGE_EXCHANGE_NODE="edge:exchange-node",r.ANCHOR_CLICK="anchor:click",r.ANCHOR_MOUSEDOWN="anchor:mousedown",r.ANCHOR_DRAGSTART="anchor:dragstart",r.ANCHOR_DRAG="anchor:drag",r.ANCHOR_DROP="anchor:drop",r.ANCHOR_DRAGEND="anchor:dragend",r.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",r.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",r.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",r.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",r.ADJUST_POINT_DRAG="adjustPoint:drag",r.ADJUST_POINT_DROP="adjustPoint:drop",r.ADJUST_POINT_DRAGEND="adjustPoint:dragend",r.BLANK_MOUSEDOWN="blank:mousedown",r.BLANK_DRAGSTART="blank:dragstart",r.BLANK_DRAG="blank:drag",r.BLANK_DROP="blank:drop",r.BLANK_MOUSEMOVE="blank:mousemove",r.BLANK_MOUSEUP="blank:mouseup",r.BLANK_CLICK="blank:click",r.BLANK_CONTEXTMENU="blank:contextmenu",r.SELECTION_MOUSEDOWN="selection:mousedown",r.SELECTION_DRAGSTART="selection:dragstart",r.SELECTION_DRAG="selection:drag",r.SELECTION_DROP="selection:drop",r.SELECTION_MOUSEMOVE="selection:mousemove",r.SELECTION_MOUSEUP="selection:mouseup",r.SELECTION_CONTEXTMENU="selection:contextmenu",r.CONNECTION_NOT_ALLOWED="connection:not-allowed",r.TEXT_MOUSEDOWN="text:mousedown",r.TEXT_DRAGSTART="text:dragstart",r.TEXT_DRAG="text:drag",r.TEXT_DROP="text:drop",r.TEXT_CLICK="text:click",r.TEXT_DBCLICK="text:dbclick",r.TEXT_BLUR="text:blur",r.TEXT_MOUSEMOVE="text:mousemove",r.TEXT_MOUSEUP="text:mouseup",r.TEXT_FOCUS="text:focus",r.TEXT_ADD="text:add",r.TEXT_UPDATE="text:update",r.TEXT_CLEAR="text:clear",r.LABEL_MOUSEDOWN="label:mousedown",r.LABEL_DRAGSTART="label:dragstart",r.LABEL_DRAG="label:drag",r.LABEL_DROP="label:drop",r.LABEL_CLICK="label:click",r.LABEL_DBCLICK="label:dbclick",r.LABEL_BLUR="label:blur",r.LABEL_MOUSEMOVE="label:mousemove",r.LABEL_MOUSEUP="label:mouseup",r.LABEL_FOCUS="label:focus",r.LABEL_ADD="label:add",r.LABEL_UPDATE="label:update",r.LABEL_CLEAR="label:clear",r.LABEL_DELETE="label:delete",r.LABEL_SHOULD_ADD="label:should-add",r.LABEL_BATCH_ADD="label:batch-add",r.LABEL_SHOULD_UPDATE="label:should-update",r.LABEL_SHOULD_DELETE="label:should-delete",r.LABEL_BATCH_DELETE="label:batch-delete",r.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",r.HISTORY_CHANGE="history:change",r.GRAPH_TRANSFORM="graph:transform",r.GRAPH_RENDERED="graph:rendered",r.GRAPH_UPDATED="graph:updated"})(yt||(yt={}));var mi;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.INCREASE=1]="INCREASE"})(mi||(mi={}));var vn;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(vn||(vn={}));var ei;(function(r){r.TEXT="text",r.LABEL="label"})(ei||(ei={}));var KR=0,oi=function(){function r(e){var t=e.onDragStart,n=t===void 0?lf:t,i=e.onDragging,o=i===void 0?lf:i,s=e.onDragEnd,l=s===void 0?lf:s,d=e.eventType,c=d===void 0?"":d,f=e.eventCenter,v=e.step,g=v===void 0?1:v,y=e.isStopPropagation,b=y===void 0?!0:y,_=e.model,x=e.data,w=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(C){var k,D,I=window==null?void 0:window.document;if(C.button===KR){w.isStopPropagation&&C.stopPropagation(),w.isStartDragging=!0,w.startX=C.clientX,w.startY=C.clientY,I.addEventListener("mousemove",w.handleMouseMove,!1),I.addEventListener("mouseup",w.handleMouseUp,!1);var $=(k=w.model)===null||k===void 0?void 0:k.getData();(D=w.eventCenter)===null||D===void 0||D.emit(yt["".concat(w.eventType,"_MOUSEDOWN")],{e:C,data:w.data||$}),w.startTime=new Date().getTime()}},this.handleMouseMove=function(C){var k,D;if(w.isStopPropagation&&C.stopPropagation(),!!w.isStartDragging&&(w.sumDeltaX+=C.clientX-w.startX,w.sumDeltaY+=C.clientY-w.startY,w.startX=C.clientX,w.startY=C.clientY,w.step<=1||Math.abs(w.sumDeltaX)>w.step||Math.abs(w.sumDeltaY)>w.step)){var I=w.sumDeltaX%w.step,$=w.sumDeltaY%w.step,R=w.sumDeltaX-I,F=w.sumDeltaY-$;w.sumDeltaX=I,w.sumDeltaY=$;var z=(k=w.model)===null||k===void 0?void 0:k.getData();w.isDragging||((D=w.eventCenter)===null||D===void 0||D.emit(yt["".concat(w.eventType,"_DRAGSTART")],{e:C,data:w.data||z}),w.onDragStart({event:C})),w.isDragging=!0,Promise.resolve().then(function(){var ie,G;w.onDragging({deltaX:R,deltaY:F,event:C}),(ie=w.eventCenter)===null||ie===void 0||ie.emit(yt["".concat(w.eventType,"_MOUSEMOVE")],{deltaX:R,deltaY:F,e:C,data:w.data||z}),(G=w.eventCenter)===null||G===void 0||G.emit(yt["".concat(w.eventType,"_DRAG")],{e:C,data:w.data||z})})}},this.handleMouseUp=function(C){var k=window.document;w.isStartDragging=!1,w.isStopPropagation&&C.stopPropagation(),Promise.resolve().then(function(){var D,I,$;k.removeEventListener("mousemove",w.handleMouseMove,!1),k.removeEventListener("mouseup",w.handleMouseUp,!1);var R=(D=w.model)===null||D===void 0?void 0:D.getData();(I=w.eventCenter)===null||I===void 0||I.emit(yt["".concat(w.eventType,"_MOUSEUP")],{e:C,data:w.data||R}),w.isDragging&&(w.isDragging=!1,w.onDragEnd({event:C}),($=w.eventCenter)===null||$===void 0||$.emit(yt["".concat(w.eventType,"_DROP")],{e:C,data:w.data||R}))})},this.cancelDrag=function(){var C=window==null?void 0:window.document;C.removeEventListener("mousemove",w.handleMouseMove,!1),C.removeEventListener("mouseup",w.handleMouseUp,!1),w.onDragEnd({event:void 0}),w.isDragging=!1},this.destroy=function(){w.isStartDragging&&w.cancelDrag()},this.onDragStart=n,this.onDragging=o,this.onDragEnd=l,this.step=g,this.isStopPropagation=b,this.eventType=c,this.eventCenter=f,this.model=_,this.data=x}return r.prototype.setStep=function(e){this.step=e},r.prototype.setModel=function(e){this.model=e},r}(),JR=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{x:e-n/2,y:t-i/2,x1:e+n/2,y1:t+i/2}},ZR=function(r){var e=r.startPoint,t=r.endPoint,n=(e.x+t.x)/2,i=(e.y+t.y)/2,o=Math.abs(e.x-t.x)+10,s=Math.abs(e.y-t.y)+10;return{x:n-o/2,y:i-s/2,x1:n+o/2,y1:i+s/2}},QR=function(r){var e=r.points,t=ra(e),n=El(t,8),i=n.x,o=n.y,s=n.width,l=n.height;return{x:i-s/2,y:o-l/2,x1:i+s/2,y1:o+l/2}},e3=function(r){var e=r.path,t=rp(e),n=El(t,8),i=n.x,o=n.y,s=n.width,l=n.height;return{x:i-s/2,y:o-l/2,x1:i+s/2,y1:o+l/2}},t3=function(r){if(r.modelType===Ht.LINE_EDGE)return ZR(r);if(r.modelType===Ht.POLYLINE_EDGE)return QR(r);if(r.modelType===Ht.BEZIER_EDGE)return e3(r)},n3=function(r,e,t,n){var i=(e.y-r.y)*(n.x-t.x)-(r.x-e.x)*(t.y-n.y);if(i===0)return!1;var o=((e.x-r.x)*(n.x-t.x)*(t.y-r.y)+(e.y-r.y)*(n.x-t.x)*r.x-(n.y-t.y)*(e.x-r.x)*t.x)/i,s=-((e.y-r.y)*(n.y-t.y)*(t.x-r.x)+(e.x-r.x)*(n.y-t.y)*r.y-(n.x-t.x)*(e.y-r.y)*t.y)/i;return(o-r.x)*(o-e.x)<=0&&(s-r.y)*(s-e.y)<=0&&(o-t.x)*(o-n.x)<=0&&(s-t.y)*(s-n.y)<=0?{x:o,y:s}:!1},wl=function(r,e,t){var n=r.x,i=r.y,o=e.x,s=e.y,l=t.x,d=t.y,c=(d-s)/(l-o),f=s-c*o;return(n>=o&&n<=l||n<=o&&n>=l)&&(i>=s&&i<=d||i<=s&&i>=d)&&Math.abs(i-c*n-f)<Number.EPSILON},Sl=function(r){var e=r.start,t=r.end,n=r.offset,i=r.verticalLength,o=r.type,s={leftX:0,leftY:0,rightX:0,rightY:0},l=Math.atan((t.y-e.y)/(t.x-e.x)),d=Math.atan(n/i),c=Math.sqrt(i*i+n*n);return o==="start"?t.x>=e.x?(s.leftX=e.x+c*Math.sin(l+d),s.leftY=e.y-c*Math.cos(l+d),s.rightX=e.x-c*Math.sin(l-d),s.rightY=e.y+c*Math.cos(l-d)):(s.leftX=e.x-c*Math.sin(l+d),s.leftY=e.y+c*Math.cos(l+d),s.rightX=e.x+c*Math.sin(l-d),s.rightY=e.y-c*Math.cos(l-d)):o==="end"&&(t.x>=e.x?(s.leftX=t.x+c*Math.sin(l-d),s.leftY=t.y-c*Math.cos(l-d),s.rightX=t.x-c*Math.sin(l+d),s.rightY=t.y+c*Math.cos(l+d)):(s.leftX=t.x-c*Math.sin(l-d),s.leftY=t.y+c*Math.cos(l-d),s.rightX=t.x+c*Math.sin(l+d),s.rightY=t.y-c*Math.cos(l+d))),s},ja=function(){return ja=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ja.apply(this,arguments)},Jr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},xo=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},r3=function(r,e){return Math.abs(r.centerX-e.centerX)*2<r.width+e.width&&Math.abs(r.centerY-e.centerY)*2<r.height+e.height},qf=function(r){var e=[],t={};return r.forEach(function(n){var i="".concat(n.x,"-").concat(n.y);n.id=i,t[i]=n}),Object.keys(t).forEach(function(n){e.push(t[n])}),e},hd=function(r,e){return r.width===0&&r.height===0?r:{x:r.x,y:r.y,centerX:r.centerX,centerY:r.centerY,minX:r.minX-e,minY:r.minY-e,maxX:r.maxX+e,maxY:r.maxY+e,height:r.height+2*e,width:r.width+2*e}},i3=function(r,e){var t=Math.abs(r.x-e.centerX),n=Math.abs(r.y-e.centerY);return t/e.width>n/e.height?vn.HORIZONTAL:vn.VERTICAL},pd=function(r,e,t){var n=i3(t,e);return n===vn.HORIZONTAL?{x:t.x>r.centerX?r.maxX:r.minX,y:t.y}:{x:t.x,y:t.y>r.centerY?r.maxY:r.minY}},mm=function(r,e){var t=Math.min(r.minX,e.minX),n=Math.min(r.minY,e.minY),i=Math.max(r.maxX,e.maxX),o=Math.max(r.maxY,e.maxY);return{x:(t+i)/2,y:(n+o)/2,centerX:(t+i)/2,centerY:(n+o)/2,minX:t,minY:n,maxX:i,maxY:o,height:o-n,width:i-t}},El=function(r,e){r===void 0&&(r=[]);var t=[],n=[];r.forEach(function(f){t.push(f.x),n.push(f.y)});var i=Math.min.apply(Math,xo([],Jr(t),!1)),o=Math.max.apply(Math,xo([],Jr(t),!1)),s=Math.min.apply(Math,xo([],Jr(n),!1)),l=Math.max.apply(Math,xo([],Jr(n),!1)),d=o-i,c=l-s;return e&&(d+=e,c+=e),{centerX:(i+o)/2,centerY:(s+l)/2,maxX:o,maxY:l,minX:i,minY:s,x:(i+o)/2,y:(s+l)/2,height:c,width:d}},vd=function(r){var e=r.minX,t=r.minY,n=r.maxX,i=r.maxY;return[{x:e,y:t},{x:n,y:t},{x:n,y:i},{x:e,y:i}]},Tu=function(r,e){var t=r.x,n=r.y;return t<e.minX||t>e.maxX||n<e.minY||n>e.maxY},o3=function(r,e){return e<r.minX||e>r.maxX?[]:[{x:e,y:r.minY},{x:e,y:r.maxY}]},a3=function(r,e){return e<r.minY||e>r.maxY?[]:[{x:r.minX,y:e},{x:r.maxX,y:e}]},s3=function(r,e){return xo(xo([],Jr(o3(r,e.x)),!1),Jr(a3(r,e.y)),!1)},Kf=function(r,e){return Math.abs(r.x-e.x)+Math.abs(r.y-e.y)},l3=function(r,e){var t=-2,n=0;return e.forEach(function(i){i&&(r.x===i.x&&(n+=t),r.y===i.y&&(n+=t))}),n},ym=function(r,e,t,n,i){return Kf(r,e)+Kf(r,t)+l3(r,[e,t,n,i])},ew=function(r,e,t,n,i){i||(i=0),r.unshift(e[n]),t[n]&&t[n]!==n&&i<=100&&ew(r,e,t,t[n],i+1)},u3=function(r,e){var t=r.indexOf(e);t>-1&&r.splice(t,1)},el=function(r,e,t,n){var i=e.x-r.x,o=e.y-r.y,s=n.x-t.x,l=n.y-t.y,d=(-o*(r.x-t.x)+i*(r.y-t.y))/(-s*o+i*l),c=(s*(r.y-t.y)-l*(r.x-t.x))/(-s*o+i*l);return d>=0&&d<=1&&c>=0&&c<=1},_m=function(r,e,t){if(t.width===0&&t.height===0)return!1;var n=Jr(vd(t),4),i=n[0],o=n[1],s=n[2],l=n[3];return el(r,e,i,o)||el(r,e,i,l)||el(r,e,o,s)||el(r,e,s,l)},d3=function(r,e,t,n){var i=[];return r.forEach(function(o){o!==e&&(o.x===e.x||o.y===e.y)&&!_m(o,e,t)&&!_m(o,e,n)&&i.push(o)}),qf(i)},c3=function(r,e,t,n,i,o,s){var l=[],d=[e],c={},f={},v={};e.id&&(f[e.id]=0,v[e.id]=ym(e,t,e));var g={};r.forEach(function(_){_.id&&(g[_.id]=_)});for(var y=function(){var _,x=1/0;if(d.forEach(function(C){C.id&&v[C.id]<x&&(x=v[C.id],_=C)}),_===t&&t.id){var w=[];return ew(w,g,c,t.id),{value:w}}if(!_)return{value:[e,t]};u3(d,_),l.push(_),d3(r,_,n,i).forEach(function(C){if(l.indexOf(C)===-1&&(d.indexOf(C)===-1&&d.push(C),_!=null&&_.id&&(C!=null&&C.id))){var k=v[_.id]+Kf(_,C);if(f[C.id]&&k>=f[C.id])return;c[C.id]=_.id,f[C.id]=k,v[C.id]=f[C.id]+ym(C,t,e,o,s)}})};d.length;){var b=y();if(typeof b=="object")return b.value}return[e,t]},bm=function(r){return zr(r)},tw=function(r){for(var e=1;e<r.length-1;){var t=r[e-1],n=r[e],i=r[e+1];t.x===n.x&&n.x===i.x||t.y===n.y&&n.y===i.y?r.splice(e,1):e++}return r},xm=function(r,e,t,n,i){var o=bm(t),s=bm(n),l=hd(o,i),d=hd(s,i),c=pd(l,o,r),f=pd(d,s,e);if(r3(l,d)){var v=h3(r,e,c,f);return xo(xo([r,c],Jr(v),!1),[f,e],!1)}var g=El([c,f]),y=mm(l,g),b=mm(d,g),_=[];_=_.concat(vd(y)),_=_.concat(vd(b));var x={x:(r.x+e.x)/2,y:(r.y+e.y)/2};[g,y,b].forEach(function(C){_=_.concat(s3(C,x).filter(function(k){return Tu(k,l)&&Tu(k,d)}))}),[{x:c.x,y:f.y},{x:f.x,y:c.y}].forEach(function(C){Tu(C,l)&&Tu(C,d)&&_.push(C)}),_.unshift(c),_.push(f),_=qf(_);var w=c3(_,c,f,o,s,r,e);return w.unshift(r),w.push(e),w.length>2&&(w=tw(w)),qf(w)},f3=function(r){if(r.length===1){var e=Jr(r,1),t=e[0];return[t,t]}else{for(var n=r[0],i=r[1],o=yi(n.x,n.y,i.x,i.y),s=1;s<r.length-1;s++){var l=r[s],d=r[s+1],c=yi(l.x,l.y,d.x,d.y);c>o&&(o=c,n=l,i=d)}return[n,i]}},wm=function(r,e,t){var n=to(r,t),i=to(e,t);return n&&i},Sm=function(r,e,t){var n=to(r,t),i=to(e,t),o=n&&i,s=n||i;return!o&&s},Em=function(r,e,t){for(var n=void 0,i=zr(t),o=vd(i),s=0;s<o.length;s++){var l=el(r,e,o[s],o[(s+1)%o.length]);l&&(n=[o[s],o[(s+1)%o.length]])}if(n)return n3(r,e,n[0],n[1])},gd=function(r,e){var t=void 0;return r.x===e.x?t=vn.VERTICAL:r.y===e.y&&(t=vn.HORIZONTAL),t},ra=function(r){var e=r.split(" "),t=[];return e&&e.forEach(function(n){var i=Jr(n.split(","),2),o=i[0],s=i[1];t.push({x:Number(o),y:Number(s)})}),t},h3=function(r,e,t,n){var i=[],o=gd(r,t),s=gd(e,n);if(o===s)r.y===t.y?(i.push({x:t.x,y:(t.y+n.y)/2}),i.push({x:n.x,y:(t.y+n.y)/2})):(i.push({x:(t.x+n.x)/2,y:t.y}),i.push({x:(t.x+n.x)/2,y:n.y}));else{var l={x:t.x,y:n.y},d=wl(l,r,t),c=wl(l,e,n);if(d||c)l={x:n.x,y:t.y};else{var f=Cm(l,r,t),v=Cm(l,e,n);f&&v&&(l={x:n.x,y:t.y})}i.push(l)}return i},Cm=function(r,e,t){return r.x===e.x&&r.x===t.x||r.y===e.y&&r.y===t.y},nw=function(r){if(!r)return 0;for(var e=0,t=0;t<r.length;t++){var n=r.charCodeAt(t);r.match(/[A-Z]/)?e+=1.5:n>=1&&n<=126||n>=65376&&n<=65439?e+=1:e+=2}return e},p3=function(r){var e=r.start,t=r.end,n;if(e.x===t.x&&e.y===t.y)n="";else{var i={start:e,end:t,offset:10,verticalLength:5},o=Sl(ja(ja({},i),{type:"start"})),s=Sl(ja(ja({},i),{type:"end"}));n="M".concat(o.leftX," ").concat(o.leftY,`
    L`).concat(o.rightX," ").concat(o.rightY,`
    L`).concat(s.rightX," ").concat(s.rightY,`
    L`).concat(s.leftX," ").concat(s.leftY," z")}return{d:n,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},Om=function(r){var e=r.start,t=r.end,n=r.sourceNode,i=r.targetNode,o=r.offset,s=zr(n),l=zr(i),d=hd(s,o),c=hd(l,o),f=pd(d,s,e),v=pd(c,l,t);return{sNext:f,ePre:v}},rp=function(r){var e=r.replace(/M/g,"").replace(/C/g,",").split(","),t=Du(e[0]),n=Du(e[1]),i=Du(e[2]),o=Du(e[3]);return[t,n,i,o]},Du=function(r){var e=Jr(r.replace(/(^\s*)/g,"").split(" "),2),t=e[0],n=e[1];return{x:+t,y:+n}},km=function(r,e){var t=Jr(r,4),n=t[0],i=t[1],o=t[2],s=t[3],l=iI(n,i,o,s,e);return[l,r[3]]},rw=function(r,e){for(var t=r.x,n=r.y,i=ra(e),o=Number.MAX_SAFE_INTEGER,s,l=[],d=0;d<i.length;d++)l.push({start:i[d],end:i[(d+1)%i.length]});if(l.forEach(function(g){var y=g.start,b=g.end;if(y.x===b.x){var _={x:y.x,y:n},x=wl(_,y,b);if(x){var w=Math.abs(y.x-t);w<o&&(o=w,s=_)}}else if(y.y===b.y){var _={x:t,y:y.y},x=wl(_,y,b);if(x){var w=Math.abs(y.y-n);w<o&&(o=w,s=_)}}}),!s){var c=l[0],f=c.start,v=c.end;s={x:f.x+(v.x-f.x)/2,y:f.y+(v.y-f.y)/2}}return s},v3=function(r){return Ia(r,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},Nm=function(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))};function g3(r,e){return typeof e!="function"?function(t,n,i){return Object.assign({type:r.edgeType},i)}:function(t,n,i){var o=e(t,n,i);return o?typeof o=="string"?Object.assign({},i,{type:o}):Object.assign({type:o},i):{type:r.edgeType}}}var m3=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return on(e,function(o){var s=nw(o);i=s>i?s:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},Ma=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Lu=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};function es(r,e,t){return t&&e*Math.round(r/e)||r}function y3(r,e,t){if(!r)return[];var n=Math.min.apply(Math,Lu([],Ma(r.map(function(_){return _[0]})),!1)),i=Math.max.apply(Math,Lu([],Ma(r.map(function(_){return _[0]})),!1)),o=Math.min.apply(Math,Lu([],Ma(r.map(function(_){return _[1]})),!1)),s=Math.max.apply(Math,Lu([],Ma(r.map(function(_){return _[1]})),!1)),l=-n,d=-o,c=r.map(function(_){var x=Ma(_,2),w=x[0],C=x[1];return[w+l,C+d]}),f=i-n,v=s-o,g=e?e/f:1,y=t?t/v:1,b=Math.min(g,y);return c.map(function(_){var x=Ma(_,2),w=x[0],C=x[1];return[w*b,C*b]})}var vf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},gf=function(r,e,t){var n=vf(r,2),i=n[0],o=n[1],s=vf(e,2),l=s[0],d=s[1],c=vf(t,2),f=c[0],v=c[1];return i>l&&i<f&&o>d&&o<v},iw=function(r,e){var t=e.multipleSelectKey,n=!1;switch(t){case"meta":n=r.metaKey;break;case"alt":n=r.altKey;break;case"shift":n=r.shiftKey;break;case"ctrl":n=r.ctrlKey;break;default:n=!1;break}return n},ip=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function Mm(r,e){return r instanceof rr&&e instanceof rr}var ow=function(r){ip(e,r);function e(t,n,i){var o=r.call(this,3)||this;return o[0]=t,o[1]=n,o[2]=i,o.x=t,o.y=n,o.z=i,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.add=function(t){if(Mm(this,t))return new rr(this.x+t.x,this.y+t.y);var n=this.z+t.z;return new Jf((this.x+t.x)/n,(this.y+t.y)/n)},e.prototype.subtract=function(t){if(Mm(this,t))return new rr(this.x-t.x,this.y-t.y);var n=this.z-t.z;return n===0?new rr(this.x-t.x,this.y-t.y):new Jf((this.x-t.x)/n,(this.y-t.y)/n)},e}(Array),rr=function(r){ip(e,r);function e(t,n,i){var o=r.call(this,t,n,i??0)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var n=this;return t.reduce(function(i,o,s){return i+o*n[s]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var n=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return n>=0?i:-i},e}(ow),Jf=function(r){ip(e,r);function e(t,n){var i=r.call(this,t,n,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e}(ow),sc=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Aa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},mf=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Xl=function(r){sc(e,r);function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=r.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(o,s){i[s]=o}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return mf([],Aa(this.map(function(n){return n[t]})),!1)},e.prototype.transpose=function(){for(var t=[],n=0;n<this.columns;n++)t.push(this.getColumn(n));return new(e.bind.apply(e,mf([void 0],Aa(t),!1)))},e.prototype.cross=function(t){var n=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var o=this.getRow(i),s=function(d){var c=t.getColumn(d);n[i][d]=o.reduce(function(f,v,g){return f+v*c[g]},0)},l=0;l<t.columns;l++)s(l);return new(e.bind.apply(e,mf([void 0],Aa(n),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new Jf(t[0],t[1])})},e.prototype.toString=function(){var t=Aa(this[0],2),n=t[0],i=t[1],o=Aa(this[1],2),s=o[0],l=o[1],d=Aa(this[2],2),c=d[0],f=d[1];return"matrix(".concat(n," ").concat(i," ").concat(s," ").concat(l," ").concat(c," ").concat(f,")")},e.prototype.translate=function(t,n){return this.cross(new md(t,n))},e.prototype.rotate=function(t){return this.cross(new _3(t))},e.prototype.scale=function(t,n){return this.cross(new b3(t,n))},e}(Array),_3=function(r){sc(e,r);function e(t){var n=r.call(this,new rr(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new rr(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new rr(0,0,1))||this;return Object.setPrototypeOf(n,e.prototype),n}return e.prototype.inverse=function(){return this.transpose()},e}(Xl),b3=function(r){sc(e,r);function e(t,n){var i=r.call(this,new rr(t,0,0),new rr(0,n,0),new rr(0,0,1))||this;return i.sx=t,i.sy=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(Xl),md=function(r){sc(e,r);function e(t,n){var i=r.call(this,new rr(1,0,0),new rr(0,1,0),new rr(t,n,1))||this;return i.tx=t,i.ty=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(Xl);JP({});var yd=function(){return yd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yd.apply(this,arguments)},x3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Zf=function(r){var e=r.anchors;return e},_d=function(r,e){for(var t=e.nodes,n,i=t.length-1;i>=0;i--){var o=t[i],s=E3(r,o);if(s){var l=o.getTargetAnchor(r);if(l){var d={node:o,anchorIndex:l.index,anchor:l.anchor};(!n||w3(o,n.node,e))&&(n=d)}}}return n},w3=function(r,e,t){return r.zIndex>e.zIndex?!0:t.nodesMap[r.id].index>t.nodesMap[e.id].index},S3=function(r,e){for(var t=Zf(e),n,i=Number.MAX_SAFE_INTEGER,o=0;o<t.length;o++){var s=yi(r.x,r.y,t[o].x,t[o].y);s<i&&(i=s,n={index:o,anchor:yd(yd({},t[o]),{x:t[o].x,y:t[o].y,id:t[o].id})})}return n},yi=function(r,e,t,n){return Math.hypot(r-t,e-n)},to=function(r,e,t){t===void 0&&(t=0);var n=!1,i=zr(e),o=x3(new Xl([r.x,r.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),s=o[0],l=o[1],d={x:s,y:l};return d.x>=i.minX-t&&d.x<=i.maxX+t&&d.y>=i.minY-t&&d.y<=i.maxY+t&&(n=!0),n},E3=function(r,e){return to(r,e,5)},zr=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{minX:e-n/2,minY:t-i/2,maxX:e+n/2,maxY:t+i/2,x:e,y:t,width:n,height:i,centerX:e,centerY:t}},C3=function(r){var e=r,t=e.x,n=e.y,i=e.width,o=e.height,s=e.radius;return[{x:t-i/2+s,y:n-o/2+s,r:s},{x:t+i/2-s,y:n-o/2+s,r:s},{x:t-i/2+s,y:n+o/2-s,r:s},{x:t+i/2-s,y:n+o/2-s,r:s}]},Am=function(r,e,t){var n=C3(t),i,o=Number.MAX_SAFE_INTEGER;return n.forEach(function(s){var l=yi(r.x,r.y,s.x,s.y);l<o&&(o=l,i=s)}),Qf(r,e,i)},Qf=function(r,e,t){var n,i=t.x,o=t.y,s=t.r;if(e===vn.HORIZONTAL){var l=i-Math.sqrt(s*s-(r.y-o)*(r.y-o)),d=i+Math.sqrt(s*s-(r.y-o)*(r.y-o)),c=Math.abs(l-r.x)<Math.abs(d-r.x)?l:d;n={x:c,y:r.y}}else if(e===vn.VERTICAL){var f=o-Math.sqrt(s*s-(r.x-i)*(r.x-i)),v=o+Math.sqrt(s*s-(r.x-i)*(r.x-i)),g=Math.abs(f-r.y)<Math.abs(v-r.y)?f:v;n={x:r.x,y:g}}return n},Tm=function(r,e){var t=e,n=!1,i=t.x,o=t.y,s=t.width,l=t.height,d=t.radius,c={minX:i-s/2+d,maxX:i+s/2-d,minY:o-l/2+d,maxY:o+l/2-d};return r.y===o+l/2||r.y===o-l/2?n=r.x>c.minX&&r.x<c.maxX:(r.x===i+s/2||r.x===i-s/2)&&(n=r.y>c.minY&&r.y<c.maxY),n},Dm=function(r,e,t){var n,i=t,o=i.x,s=i.y,l=i.rx,d=i.ry;if(e===vn.HORIZONTAL){var c=o-Math.sqrt(l*l-(r.y-s)*(r.y-s)*l*l/(d*d)),f=o+Math.sqrt(l*l-(r.y-s)*(r.y-s)*l*l/(d*d)),v=Math.abs(c-r.x)<Math.abs(f-r.x)?c:f;n={x:v,y:r.y}}else if(e===vn.VERTICAL){var g=s-Math.sqrt(d*d-(r.x-o)*(r.x-o)*d*d/(l*l)),y=s+Math.sqrt(d*d-(r.x-o)*(r.x-o)*d*d/(l*l)),b=Math.abs(g-r.y)<Math.abs(y-r.y)?g:y;n={x:r.x,y:b}}return n},Pu=function(r,e,t){for(var n=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,o,s=[],l=0;l<n.length;l++)s.push({start:n[l],end:n[(l+1)%n.length]});return s.forEach(function(d){var c=d.start,f=d.end,v=c,g=f;c.x>f.x&&(v=f,g=c);var y={x:r.x,y:r.y};if(v.x===g.x&&e===vn.HORIZONTAL&&(y={x:v.x,y:r.y}),v.y===g.y&&e===vn.VERTICAL&&(y={x:r.x,y:v.y}),v.x!==g.x&&v.y!==g.y){var b=(g.y-v.y)/(g.x-v.x),_=(v.x*g.y-g.x*v.y)/(v.x-g.x);e===vn.HORIZONTAL?y={x:(r.y-_)/b,y:r.y}:e===vn.VERTICAL&&(y={x:r.x,y:b*r.x+_})}var x=wl(y,c,f);if(x){var w=yi(y.x,y.y,r.x,r.y);w<i&&(i=w,o=y)}}),o},O3=function(r){var e=Ia(r,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},Lm=function(r,e,t,n){var i=r.x,o=r.y;return e.x>r.x?i=r.x+t/2:e.x<r.x&&(i=r.x-t/2),e.y>r.y?o=r.y+n/2:e.y<r.y&&(o=r.y-n/2),{x:i,y:o}},aw=function(r){var e=r.rows,t=r.style,n=r.rowsLength,i=r.className,o=document.createElement("div");o.className=i,o.style.fontSize="".concat(t.fontSize),o.style.width="".concat(t.width),o.style.lineHeight="".concat(t.lineHeight),o.style.padding="".concat(t.padding),t.fontFamily&&(o.style.fontFamily="".concat(t.fontFamily)),n>1?e.forEach(function(l){var d=document.createElement("div");d.textContent=l,o.appendChild(d)}):o.textContent=e[0],document.body.appendChild(o);var s=o.clientHeight;return document.body.removeChild(o),s},Pm=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return e&&e.forEach(function(o){var s=nw(o);i=s>i?s:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},bd=function(r){return typeof r!="object"?{isAllPass:!!r,msg:r?"":"不允许连接"}:r};let Ru;const k3=new Uint8Array(16);function N3(){if(!Ru&&(Ru=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ru))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ru(k3)}const tr=[];for(let r=0;r<256;++r)tr.push((r+256).toString(16).slice(1));function M3(r,e=0){return tr[r[e+0]]+tr[r[e+1]]+tr[r[e+2]]+tr[r[e+3]]+"-"+tr[r[e+4]]+tr[r[e+5]]+"-"+tr[r[e+6]]+tr[r[e+7]]+"-"+tr[r[e+8]]+tr[r[e+9]]+"-"+tr[r[e+10]]+tr[r[e+11]]+tr[r[e+12]]+tr[r[e+13]]+tr[r[e+14]]+tr[r[e+15]]}const A3=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Rm={randomUUID:A3};function T3(r,e,t){if(Rm.randomUUID&&!r)return Rm.randomUUID();r=r||{};const n=r.random||(r.rng||N3)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,M3(n)}var So=function(){return T3()},il=new Map,sw=function(r){var e=So();function t(){r();var i=il.get(e);if(i){var o=window.requestAnimationFrame(t);il.set(e,o)}}var n=window.requestAnimationFrame(t);return il.set(e,n),e},xd=function(r){var e=il.get(r);e&&(window.cancelAnimationFrame(e),il.delete(r))},Cl=function(){return Cl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Cl.apply(this,arguments)},D3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function lw(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.value,s=r.fontSize,l=s===void 0?12:s,d=r.fill,c=d===void 0?"currentColor":d,f=r.overflowMode,v=f===void 0?"default":f,g=r.textWidth,y=g===void 0?void 0:g,b=r.model,_={x:t,y:i,fill:c,fontSize:l,textAnchor:"middle",dominantBaseline:"central"};if(on(Co(r),function(I){var $=D3(I,2),R=$[0],F=$[1];typeof F!="object"&&(_[R]=F)}),o){var x=String(o).split(/[\r\n]/g),w=x.length;if(v!=="default"){var C=b.BaseType,k=b.modelType;if(C===xn.NODE&&k!==Ht.TEXT_NODE||C===xn.EDGE&&y)return L3(r)}if(w>1){var D=x.map(function(I,$){var R=l+2,F=($-(w-1)/2)*R;return ke("tspan",{className:"lf-text-tspan",x:t,y:i+F,children:I})});return ke("text",Cl({},_,{children:D}))}return ke("text",Cl({},_,{children:o}))}return null}function L3(r){var e=r.x,t=r.y,n=r.value,i=r.model,o=r.textWidth,s=r.fontSize,l=s===void 0?12:s,d=r.lineHeight,c=r.fontFamily,f=c===void 0?"":c,v=r.wrapPadding,g=v===void 0?"0, 0":v,y=r.overflowMode,b=i.width,_=i.height,x=i.textHeight,w=o||b,C=String(n).split(/[\r\n]/g),k=C.length,D=aw({rows:C,style:{fontSize:"".concat(l,"px"),width:"".concat(w,"px"),fontFamily:f,lineHeight:d,padding:g},rowsLength:k,className:"lf-get-text-height"}),I=_>D?_:D;x&&(I=x);var $=y==="ellipsis";return $&&(I=l+2),ke("g",{children:ke("foreignObject",{width:w,height:I,x:e-w/2,y:t-I/2,style:{overflow:"visible",textAlign:"left"},children:ke("div",{className:"lf-node-text-auto-wrap",style:{minHeight:I,width:w,padding:g},children:ke("div",{className:$?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:$?C.join(""):"",style:Cl({},r),children:C.map(function(R){return ke("div",{className:"lf-node-text--auto-wrap-inner",children:R})})})})})})}var eh=function(){return eh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},eh.apply(this,arguments)},P3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function ts(r){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return on(Co(r),function(t){var n=P3(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),ke("line",eh({},e))}var th=function(){return th=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},th.apply(this,arguments)},R3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function Zr(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=r.className,s=r.strokeWidth,l=r.radius,d=l===void 0?0:l,c=e-n/2,f=t-i/2,v={};return v["stroke-width"]=s,on(Co(r),function(g){var y=R3(g,2),b=y[0],_=y[1];typeof _!="object"&&(v[b]=_)}),o?v.className="lf-basic-shape ".concat(o):v.className="lf-basic-shape",d&&(v.rx=d,v.ry=d),v.x=c,v.y=f,ke("rect",th({},v))}var nh=function(){return nh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},nh.apply(this,arguments)},I3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function Ol(r){var e={d:""};return on(Co(r),function(t){var n=I3(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),ke("path",nh({},e))}var rh=function(){return rh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},rh.apply(this,arguments)},B3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function ns(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.r,s=o===void 0?4:o,l=r.className,d={cx:t,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return on(Co(r),function(c){var f=B3(c,2),v=f[0],g=f[1];typeof g!="object"&&(d[v]=g)}),l?d.className="lf-basic-shape ".concat(l):d.className="lf-basic-shape",ke("circle",rh({},d))}var ih=function(){return ih=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ih.apply(this,arguments)},j3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function H3(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.rx,s=o===void 0?4:o,l=r.ry,d=l===void 0?4:l,c=r.className,f={cx:t,cy:i,rx:s,ry:d,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return on(Co(r),function(v){var g=j3(v,2),y=g[0],b=g[1];typeof b!="object"&&(f[y]=b)}),c?f.className="lf-basic-shape ".concat(c):f.className="lf-basic-shape",ke("ellipse",ih({},f))}var wd=function(){return wd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},wd.apply(this,arguments)},$3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function F3(r,e){var t=r.map(function(C){return{x:C[0],y:C[1]}}),n=t.length;if(n<3)return"";for(var i=Math.abs(e),o="",s=0;s<n;s++){var l=t[(s-1+n)%n],d=t[s],c=t[(s+1)%n],f={x:d.x-l.x,y:d.y-l.y},v={x:c.x-d.x,y:c.y-d.y},g=Math.hypot(f.x,f.y),y=Math.hypot(v.x,v.y),b={x:f.x/g,y:f.y/g},_={x:v.x/y,y:v.y/y},x={x:d.x-b.x*i,y:d.y-b.y*i},w={x:d.x+_.x*i,y:d.y+_.y*i};s===0?o+="M ".concat(x.x," ").concat(x.y," "):o+="L ".concat(x.x," ").concat(x.y," "),o+="Q ".concat(d.x," ").concat(d.y," ").concat(w.x," ").concat(w.y," ")}return o+="Z",o}function op(r){var e=r.points,t=e===void 0?[]:e,n=r.className,i=r.radius,o={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(on(Co(r),function(l){var d=$3(l,2),c=d[0],f=d[1];typeof f!="object"&&(o[c]=f)}),n?o.classNmae="lf-basic-shape ".concat(n):o.className="lf-basic-shape",i){var s=F3(t,i);return o.d=s,ke("path",wd({},o))}else return o.points=t.map(function(l){return l.join(",")}).join(" "),ke("polygon",wd({},o))}var oh=function(){return oh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},oh.apply(this,arguments)},z3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function W3(r){var e=r.className,t={points:"",fill:"none"};return on(Co(r),function(n){var i=z3(n,2),o=i[0],s=i[1];(o==="style"||typeof s!="object")&&(t[o]=s)}),e&&(t.className="".concat(e)),ke("polyline",oh({},t))}var uw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),kl=function(){return kl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},kl.apply(this,arguments)},U3=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},V3=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},sn;(function(r){r[r.LEFT_TOP=0]="LEFT_TOP",r[r.RIGHT_TOP=1]="RIGHT_TOP",r[r.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",r[r.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(sn||(sn={}));var X3=function(r){uw(e,r);function e(t){var n=r.call(this)||this;n.updateEdgePointByAnchors=function(){var l=n.nodeModel,d=l.id,c=l.anchors,f=n.graphModel.getNodeEdges(d);on(f,function(v){if(v.sourceNodeId===d){var g=ta(c,function(y){return y.id===v.sourceAnchorId});g&&v.updateStartPoint({x:g.x,y:g.y})}else if(v.targetNodeId===d){var g=ta(c,function(b){return b.id===v.targetAnchorId});g&&v.updateEndPoint({x:g.x,y:g.y})}})},n.triggerResizeEvent=function(l,d,c,f,v,g){n.graphModel.eventCenter.emit(yt.NODE_RESIZE,{preData:l,data:d,deltaX:c,deltaY:f,index:v,model:g})},n.recalcResizeInfo=function(l,d,c,f,v){c===void 0&&(c=1),f===void 0&&(f=!1),v===void 0&&(v=!1);var g=Lt(d),y=g.deltaX,b=g.deltaY,_=g.width,x=g.height,w=g.PCTResizeInfo;if(w){var C=4,k=0,D=0;switch(l){case sn.LEFT_TOP:D=(y*-1-b)/C;break;case sn.RIGHT_TOP:D=(y-b)/C;break;case sn.RIGHT_BOTTOM:D=(y+b)/C;break;case sn.LEFT_BOTTOM:D=(y*-1+b)/C;break}D!==0&&(k=Math.round(D/w.ResizeBasis.basisHeight*1e5)/1e3),w.ResizePCT.widthPCT=Math.max(Math.min(w.ResizePCT.widthPCT+k,w.ScaleLimit.maxScaleLimit),w.ScaleLimit.minScaleLimit),w.ResizePCT.heightPCT=Math.max(Math.min(w.ResizePCT.heightPCT+k,w.ScaleLimit.maxScaleLimit),w.ScaleLimit.minScaleLimit);var I=Math.round(w.ResizePCT.widthPCT*w.ResizeBasis.basisWidth/100),$=Math.round(w.ResizePCT.heightPCT*w.ResizeBasis.basisHeight/100);switch(l){case sn.LEFT_TOP:y=_-I,b=x-$;break;case sn.RIGHT_TOP:y=I-_,b=x-$;break;case sn.RIGHT_BOTTOM:y=I-_,b=$-x;break;case sn.LEFT_BOTTOM:y=_-I,b=$-x;break}return g}switch(l){case sn.LEFT_TOP:g.width=f?_:_-y*c,g.height=v?x:x-b*c;break;case sn.RIGHT_TOP:g.width=f?_:_+y*c,g.height=v?x:x-b*c;break;case sn.RIGHT_BOTTOM:g.width=f?_:_+y*c,g.height=v?x:x+b*c;break;case sn.LEFT_BOTTOM:g.width=f?_:_-y*c,g.height=v?x:x+b*c;break}return g},n.resizeNode=function(l){var d=l.deltaX,c=l.deltaY,f=n.index,v=n.props,g=v.model,y=v.graphModel,b=v.x,_=v.y;dw({x:b,y:_,deltaX:d,deltaY:c,index:f,nodeModel:g,graphModel:y,cancelCallback:function(){n.dragHandler.cancelDrag()}})},n.onDragStart=function(){n.graphModel.selectNodeById(n.nodeModel.id)},n.onDragging=function(l){var d=l.deltaX,c=l.deltaY,f=n.graphModel.transformModel,v=V3(f.fixDeltaXY(d,c),2),g=v[0],y=v[1];n.resizeNode({deltaX:g,deltaY:y})},n.onDragEnd=function(){var l=n.nodeModel.x,d=n.nodeModel.y;n.nodeModel.moveTo(l,d),n.updateEdgePointByAnchors()};var i=t.index,o=t.model,s=t.graphModel;return n.index=i,n.nodeModel=o,n.graphModel=s,n.dragHandler=new oi({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:s.gridSize}),n}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy()},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.direction,s=t.model,l=s.getResizeControlStyle(),d=l.width,c=l.height,f=U3(l,["width","height"]);return ke("g",{className:"lf-resize-control lf-resize-control-".concat(o),children:[ke(Zr,kl({className:"lf-resize-control-content",x:n,y:i,width:d??7,height:c??7},f)),ke(Zr,{className:"lf-resize-control-content",x:n,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(Wt),G3=function(r){uw(e,r);function e(){return r.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=zr(n),s=o.minX,l=o.minY,d=o.maxX,c=o.maxY,f=[{index:sn.LEFT_TOP,direction:"nw",x:s,y:l},{index:sn.RIGHT_TOP,direction:"ne",x:d,y:l},{index:sn.RIGHT_BOTTOM,direction:"se",x:d,y:c},{index:sn.LEFT_BOTTOM,direction:"sw",x:s,y:c}];return ro(f,function(v){return ke(X3,kl({},v,{model:n,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getResizeOutlineStyle();return ke(Zr,kl({},l,{x:n,y:i,width:o,height:s}))},e.prototype.render=function(){return ke("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(Wt);function Y3(r,e){var t=r.x,n=r.y,i=e.x,o=e.y,s={x:t+(i-t)/2,y:n+(o-n)/2};return s}function tl(r,e,t){var n=q3(t),i=r.x-e.x,o=r.y-e.y,s=i*Math.cos(n)-o*Math.sin(n)+e.x,l=i*Math.sin(n)+o*Math.cos(n)+e.y;return{x:s,y:l}}function q3(r){return r*Math.PI/180}function K3(r){return r/Math.PI*180}function J3(r,e,t,n,i,o,s,l,d){l===void 0&&(l=!1),d===void 0&&(d=!1);var c=e.deltaX,f=e.deltaY,v=e.width,g=e.height,y=K3(t),b={x:n,y:i},_={x:o,y:s},x=tl(b,_,y),w={x:x.x+c,y:x.y+f},C=tI(x,w,_,y,l,d,v,g),k=C.width,D=C.height,I=C.center;return e.width=k*r,e.height=D*r,e.deltaX=(I.x-_.x)*2,e.deltaY=(I.y-_.y)*2,e}var Z3=function(r,e,t,n,i,o,s,l,d,c){t===void 0&&(t=1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=0);var f=Lt(e),v=f.deltaX,g=f.deltaY,y=f.width,b=f.height,_=f.PCTResizeInfo;if(_){var x=4,w=0,C=0;switch(r){case sn.LEFT_TOP:C=(v*-1-g)/x;break;case sn.RIGHT_TOP:C=(v-g)/x;break;case sn.RIGHT_BOTTOM:C=(v+g)/x;break;case sn.LEFT_BOTTOM:C=(v*-1+g)/x;break}C!==0&&(w=Math.round(C/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+w,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+w,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var k=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),D=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(r){case sn.LEFT_TOP:v=y-k,g=b-D;break;case sn.RIGHT_TOP:v=k-y,g=b-D;break;case sn.RIGHT_BOTTOM:v=k-y,g=D-b;break;case sn.LEFT_BOTTOM:v=y-k,g=D-b;break}return f}if(o%(2*Math.PI)!==0&&s!==void 0&&l!==void 0)return J3(t,f,o,s,l,d,c,n,i);switch(r){case sn.LEFT_TOP:f.width=n?y:y-v*t,f.height=i?b:b-g*t;break;case sn.RIGHT_TOP:f.width=n?y:y+v*t,f.height=i?b:b-g*t;break;case sn.RIGHT_BOTTOM:f.width=n?y:y+v*t,f.height=i?b:b+g*t;break;case sn.LEFT_BOTTOM:f.width=n?y:y-v*t,f.height=i?b:b+g*t;break}return f},Q3=function(r,e){var t=r.id,n=r.anchors,i=e.getNodeEdges(t);on(i,function(o){if(o.sourceNodeId===t){var s=ta(n,function(l){return l.id===o.sourceAnchorId});s&&o.updateStartPoint({x:s.x,y:s.y})}else if(o.targetNodeId===t){var s=ta(n,function(d){return d.id===o.targetAnchorId});s&&o.updateEndPoint({x:s.x,y:s.y})}})},eI=function(r,e,t,n,i,o,s){s.eventCenter.emit(yt.NODE_RESIZE,{preData:r,data:e,deltaX:t,deltaY:n,index:i,model:o})},dw=function(r){var e=r.x,t=r.y,n=r.deltaX,i=r.deltaY,o=r.index,s=r.nodeModel,l=r.graphModel,d=r.cancelCallback,c=s.r,f=s.rx,v=s.ry,g=s.width,y=s.height,b=s.PCTResizeInfo,_=s.minWidth,x=s.minHeight,w=s.maxWidth,C=s.maxHeight,k=s.rotate,D=s.x,I=s.y,$=_===w,R=x===C,F={width:c||f||g,height:c||v||y,deltaX:n,deltaY:i,PCTResizeInfo:b},z=c||f&&v?1/2:1,ie=e,G=t,Q=Z3(o,F,z,$,R,k,ie,G,D,I);if(Q.width<_||Q.width>w||Q.height<x||Q.height>C){d==null||d();return}(k%(2*Math.PI)==0||b||ie===void 0||G===void 0)&&(Q.deltaX=$?0:Q.deltaX,Q.deltaY=R?0:Q.deltaY);var T=s.getData(),W=s.resize(Q);T.x===W.x&&T.y===W.y||(Q3(s,l),eI(T,W,n,i,o,s,l))};function tI(r,e,t,n,i,o,s,l){i===void 0&&(i=!1),o===void 0&&(o=!1);var d={x:t.x-(r.x-t.x),y:t.y-(r.y-t.y)},c=Y3(d,e),f=tl(e,c,-n),v=tl(d,c,-n);if(i){var g=Math.abs(f.x-v.x),y=g-s;c.x>f.x?c.x=c.x+y/2:c.x=c.x-y/2}if(o){var b=Math.abs(f.y-v.y),_=b-l;c.y>f.y?c.y=c.y+_/2:c.y=c.y-_/2}if(i||o){var x=tl(v,c,n),w=x.x-d.x,C=x.y-d.y;c.x=c.x-w,c.y=c.y-C,v=tl(d,c,-n),f={x:c.x-(v.x-c.x),y:c.y-(v.y-c.y)}}var k=Math.abs(f.x-v.x),D=Math.abs(f.y-v.y);return i&&(k=s),o&&(D=l),{width:k,height:D,center:c}}var nI=100,rI={x:1,y:0};function iI(r,e,t,n,i){for(var o=function(y){if(y<0||y>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:r.x*Math.pow(1-y,3)+3*e.x*y*Math.pow(1-y,2)+3*t.x*Math.pow(y,2)*(1-y)+n.x*Math.pow(y,3),y:r.y*Math.pow(1-y,3)+3*e.y*y*Math.pow(1-y,2)+3*t.y*Math.pow(y,2)*(1-y)+n.y*Math.pow(y,3)}},s=0,l=2,d=n.x,c=n.y,f=n;s<i&&l<50;){f=o(1-l/nI);var v=f.x,g=f.y;s=yi(d,c,v,g),l++}return f}function oI(r,e){return r.x*e.y-r.y*e.x}function aI(r,e){var t=[r.x,r.y,r.z],n=[e.x,e.y,e.z];return n.reduce(function(i,o,s){return i+o*t[s]})}function sI(r,e){var t=oI(r,e),n=Math.acos(aI(Im(r),Im(e)));return t>=0?n:-n}function Im(r){var e=Math.hypot(r.x,r.y);return{x:r.x/e,y:r.y/e,z:0}}function lI(r){return sI(rI,r)}function uI(r){return r*(180/Math.PI)}var cw={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},dI={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},cI={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},fI={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Nl={colorful:fI,dark:cI,radius:dI,default:cw},hI={background:"#23272e"},pI={background:"#fefeff"},ah={background:"#ffffff"},Ml={colorful:pI,dark:hI,radius:ah,default:ah},vI={color:"#66676a",thickness:1},gI={color:"#dadada",thickness:1},sh={color:"#acacac",thickness:1},Al={colorful:gI,dark:vI,radius:sh,default:sh},fw=function(r,e){var t=Lt(cw);return e&&(t=Wa(t,Nl[e])),r&&(t=Wa(t,r)),t},mI=function(r,e){if(Nl[r]){console.warn("theme mode ".concat(r," already exists"));return}Nl[r]=e,Ml[r]=e.background||ah,Al[r]=e.grid||sh},yI=function(r){delete Nl[r],delete Ml[r],delete Al[r]},Bm=function(){var r={colorful:{},dark:{},radius:{},default:{}};Qt(Nl,r),Qt(Ml,r),Qt(Al,r)},_I=fw,bI=1e3,xI=999,ap=function(){return++bI},wI=function(){return--xI},Tn=function(){return Tn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Tn.apply(this,arguments)},Ct=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},lc=function(){function r(e,t){var n;this.BaseType=xn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ei.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=Yt.DEFAULT,this.modelType=Ht.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initEdgeData(e),this.setAttributes()}return r.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||So()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var o=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=o,Qt(this,v3(e));var s=this.graphModel.overlapMode;s===mi.INCREASE&&(this.zIndex=e.zIndex||ap()),this.setAnchors(),this.initPoints(),this.formatText(e)},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.getEdgeStyle=function(){return Tn(Tn({},this.graphModel.theme.baseEdge),this.style)},r.prototype.getAdjustPointStyle=function(){return Tn({},this.graphModel.theme.edgeAdjust)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Lt(e)},r.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Lt(e)},r.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),n=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return Tn(Tn(Tn({},e),{fill:i,stroke:i}),n)},r.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Lt(t)},r.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(r.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),r.prototype.getBeginAnchor=function(e,t,n){var i,o,s=Zf(e);if(n){if(i=ta(s,function(l){return l.id===n}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(n,"，已使用默认锚点作为起点"))}return s.forEach(function(l){var d=Nm(l,t);(o===void 0||d<o)&&(o=d,i=l)}),i},r.prototype.getEndAnchor=function(e,t){var n=this,i,o,s=Zf(e);if(t){if(i=ta(s,function(l){return l.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return s.forEach(function(l){if(n.startPoint){var d=Nm(l,n.startPoint);(o===void 0||d<o)&&(o=d,i=l)}}),i},r.prototype.getProperties=function(){return pi(this.properties)},r.prototype.getData=function(){var e=this.properties;Za(e)&&(e=pi(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:Qt({},this.startPoint),endPoint:Qt({},this.endPoint)};this.graphModel.overlapMode===mi.INCREASE&&(t.zIndex=this.zIndex);var n=this.text,i=n.x,o=n.y,s=n.value;return s&&(t.text={x:i,y:o,value:s}),t},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.setProperty=function(e,t){Qh(this.properties,e,dr(t)),this.setAttributes()},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setProperties=function(e){this.properties=Tn(Tn({},pi(this.properties)),dr(e)),this.setAttributes()},r.prototype.changeEdgeId=function(e){var t=this.arrowConfig,n=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),n&&n==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},r.prototype.setStyle=function(e,t){var n;this.style=Tn(Tn({},this.style),(n={},n[e]=dr(t),n))},r.prototype.setStyles=function(e){this.style=Tn(Tn({},this.style),dr(e))},r.prototype.updateStyles=function(e){this.style=Tn({},dr(e))},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,s=o.edgeTextDraggable,l=o.edgeTextEdit,d=this.textPosition,c=d.x,f=d.y,v=e.text,g={value:"",x:c,y:f,draggable:s,editable:l};v&&(typeof v=="string"?g=Tn(Tn({},g),{value:v}):(g=Tn(Tn({},g),{x:(t=v.x)!==null&&t!==void 0?t:c,y:(n=v.y)!==null&&n!==void 0?n:f,value:(i=v.value)!==null&&i!==void 0?i:""}),Ua(v.draggable)||(g.draggable=v.draggable),Ua(v.editable)||(g.editable=v.editable))),this.text=g},r.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,n=e.y;this.text.x=t,this.text.y=n},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,s=n.value,l=n.draggable,d=n.editable;this.text={value:s,editable:d,draggable:l,x:i+e,y:o+t}},r.prototype.setText=function(e){e&&Qt(this.text,e)},r.prototype.updateText=function(e){this.text=Tn(Tn({},pi(this.text)),{value:e})},r.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.openEdgeAnimation=function(){this.isAnimation=!0},r.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateStartPoint=function(e){this.startPoint=e},r.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},r.prototype.updateEndPoint=function(e){this.endPoint=e},r.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},r.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},r.prototype.initPoints=function(){},r.prototype.updateAttributes=function(e){Qt(this,e)},r.prototype.getAdjustStart=function(){return this.startPoint},r.prototype.getAdjustEnd=function(){return this.endPoint},r.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,n=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:n.x,y:n.y})},r.BaseType=xn.EDGE,Ct([Me],r.prototype,"type",void 0),Ct([Me],r.prototype,"sourceNodeId",void 0),Ct([Me],r.prototype,"targetNodeId",void 0),Ct([Me],r.prototype,"startPoint",void 0),Ct([Me],r.prototype,"endPoint",void 0),Ct([Me],r.prototype,"textMode",void 0),Ct([Me],r.prototype,"text",void 0),Ct([Me],r.prototype,"properties",void 0),Ct([Me],r.prototype,"points",void 0),Ct([Me],r.prototype,"pointsList",void 0),Ct([Me],r.prototype,"isSelected",void 0),Ct([Me],r.prototype,"isHovered",void 0),Ct([Me],r.prototype,"isHitable",void 0),Ct([Me],r.prototype,"isHittable",void 0),Ct([Me],r.prototype,"draggable",void 0),Ct([Me],r.prototype,"visible",void 0),Ct([Me],r.prototype,"isAnimation",void 0),Ct([Me],r.prototype,"isShowAdjustPoint",void 0),Ct([Me],r.prototype,"zIndex",void 0),Ct([Me],r.prototype,"state",void 0),Ct([Me],r.prototype,"style",void 0),Ct([Me],r.prototype,"arrowConfig",void 0),Ct([un],r.prototype,"sourceNode",null),Ct([un],r.prototype,"targetNode",null),Ct([un],r.prototype,"textPosition",null),Ct([Oe],r.prototype,"setProperty",null),Ct([Oe],r.prototype,"deleteProperty",null),Ct([Oe],r.prototype,"setProperties",null),Ct([Oe],r.prototype,"changeEdgeId",null),Ct([Oe],r.prototype,"setStyle",null),Ct([Oe],r.prototype,"setStyles",null),Ct([Oe],r.prototype,"updateStyles",null),Ct([Oe],r.prototype,"setTextMode",null),Ct([Oe],r.prototype,"formatText",null),Ct([Oe],r.prototype,"resetTextPosition",null),Ct([Oe],r.prototype,"moveText",null),Ct([Oe],r.prototype,"setText",null),Ct([Oe],r.prototype,"updateText",null),Ct([Oe],r.prototype,"setAnchors",null),Ct([Oe],r.prototype,"setSelected",null),Ct([Oe],r.prototype,"setHovered",null),Ct([Oe],r.prototype,"setHitable",null),Ct([Oe],r.prototype,"setHittable",null),Ct([Oe],r.prototype,"openEdgeAnimation",null),Ct([Oe],r.prototype,"closeEdgeAnimation",null),Ct([Oe],r.prototype,"setElementState",null),Ct([Oe],r.prototype,"updateStartPoint",null),Ct([Oe],r.prototype,"moveStartPoint",null),Ct([Oe],r.prototype,"updateEndPoint",null),Ct([Oe],r.prototype,"moveEndPoint",null),Ct([Oe],r.prototype,"setZIndex",null),Ct([Oe],r.prototype,"initPoints",null),Ct([Oe],r.prototype,"updateAttributes",null),Ct([Oe],r.prototype,"getAdjustStart",null),Ct([Oe],r.prototype,"getAdjustEnd",null),Ct([Oe],r.prototype,"updateAfterAdjustStartAndEnd",null),r}(),SI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Go=function(){return Go=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Go.apply(this,arguments)},Gr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},yf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},jm=function(r){SI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=jl(t,"properties.offset",100),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return Go(Go(Go({},n),Lt(t)),Lt(o))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,n=0;return this.pointsList.forEach(function(i){var o=i.x,s=i.y;t+=o,n+=s}),{x:t/this.pointsList.length,y:n/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,s=i.y;return{x:o,y:s}});return Go(Go({},t),{pointsList:n})},e.prototype.getControls=function(){var t=this.startPoint,n=this.endPoint,i=Om({start:t,end:n,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var n=yf(t,4),i=n[0],o=n[1],s=n[2],l=n[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(o.x," ").concat(o.y,`,
    `).concat(s.x," ").concat(s.y,`,
    `).concat(l.x," ").concat(l.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),n=t.sNext,i=t.ePre;this.updatePath(n,i)},e.prototype.updatePath=function(t,n){t=Lt(t),n=Lt(n);var i={x:this.startPoint.x,y:this.startPoint.y},o={x:this.endPoint.x,y:this.endPoint.y};if(!t||!n){var s=this.getControls();t=s.sNext,n=s.ePre}this.pointsList=[i,t,n,o],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n;var i=yf(this.pointsList,3),o=i[1],s=i[2];o.x+=t,o.y+=n,this.updatePath(o,s)},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n;var i=yf(this.pointsList,3),o=i[1],s=i[2];s.x+=t,s.y+=n,this.updatePath(o,s)},e.prototype.updateAdjustAnchor=function(t,n){var i;n==="sNext"?this.pointsList[1]=t:n==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(Qt({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,s=t.targetNode,l=Om({start:n,end:i,sourceNode:o,targetNode:s,offset:this.offset}),d=l.sNext,c=l.ePre;this.pointsList=[n,d,c,i],this.initPoints()},Gr([Me],e.prototype,"offset",void 0),Gr([Me],e.prototype,"path",void 0),Gr([Oe],e.prototype,"initPoints",null),Gr([Oe],e.prototype,"updatePoints",null),Gr([Oe],e.prototype,"updateStartPoint",null),Gr([Oe],e.prototype,"updateEndPoint",null),Gr([Oe],e.prototype,"moveStartPoint",null),Gr([Oe],e.prototype,"moveEndPoint",null),Gr([Oe],e.prototype,"updateAdjustAnchor",null),Gr([Oe],e.prototype,"getAdjustStart",null),Gr([Oe],e.prototype,"getAdjustEnd",null),Gr([Oe],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(lc),EI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ol=function(){return ol=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ol.apply(this,arguments)},Hm=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},CI=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},$m=function(r){EI(e,r);function e(){var t=r.apply(this,CI([],Hm(arguments),!1))||this;return t.modelType=Ht.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return ol(ol(ol({},n),Lt(t)),Lt(o))},e.prototype.initEdgeData=function(t){r.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var n=Hm(t,2),i=n[0],o=n[1];return"".concat(i.x,",").concat(i.y," ").concat(o.x,",").concat(o.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(lc),OI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),al=function(){return al=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},al.apply(this,arguments)},er=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Fm=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},kI=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},rs=function(r){OI(e,r);function e(){var t=r.apply(this,kI([],Fm(arguments),!1))||this;return t.modelType=Ht.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=jl(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return al(al(al({},n),Lt(t)),Lt(o))},e.prototype.getTextPosition=function(){var t,n=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!n){var i=this.dbClickPosition,o=i.x,s=i.y;return{x:o,y:s}}var l=ra(this.points),d=Fm(f3(l),2),c=d[0],f=d[1];return{x:(c.x+f.x)/2,y:(c.y+f.y)/2}},e.prototype.getAfterAnchor=function(t,n,i){var o,s;return i.forEach(function(l){var d;t===vn.HORIZONTAL?d=Math.abs(n.y-l.y):t===vn.VERTICAL&&(d=Math.abs(n.x-l.x)),(!s||s>d)&&(s=d,o=l)}),o},e.prototype.getCrossPoint=function(t,n,i){var o;return t===vn.HORIZONTAL?o={x:i.x,y:n.y}:t===vn.VERTICAL&&(o={x:n.x,y:i.y}),o},e.prototype.removeCrossPoints=function(t,n,i){var o=i.map(function(w){return w});if(t===1){var s=o[t],l=o[n],d=o[t-1],c=wm(d,s,this.sourceNode);if(c){var f=Sm(s,l,this.sourceNode);if(f){var v=Em(s,l,this.sourceNode);v&&(o[t]=v,o.splice(t-1,1),t--,n--)}}else{var g=this.sourceNode.anchors;g.forEach(function(w){if(w.x===d.x&&w.x===s.x||w.y===d.y&&w.y===s.y){var C=yi(w.x,w.y,s.x,s.y),k=yi(d.x,d.y,s.x,s.y);C<k&&(o[t-1]=w)}})}}if(n===i.length-2){var y=o[t],b=o[n],_=o[n+1],x=wm(b,_,this.targetNode);if(x){var f=Sm(y,b,this.targetNode);if(f){var v=Em(y,b,this.targetNode);v&&(o[n]=v,o.splice(n+1,1))}}else{var g=this.targetNode.anchors;g.forEach(function(C){if(C.x===_.x&&C.x===b.x||C.y===_.y&&C.y===b.y){var k=yi(C.x,C.y,b.x,b.y),D=yi(_.x,_.y,b.x,b.y);k<D&&(o[n+1]=C)}})}}return o},e.prototype.getDraggingPoints=function(t,n,i,o,s){var l=s.map(function(f){return f}),d=this.getAfterAnchor(t,i,o),c=this.getCrossPoint(t,i,d);return n==="start"?(l.unshift(c),l.unshift(d)):(l.push(c),l.push(d)),l},e.prototype.updateCrossPoints=function(t){var n=t.map(function(C){return C}),i=t[0],o=t[1],s=t[n.length-2],l=t[n.length-1],d=this,c=d.sourceNode,f=d.targetNode,v=c.modelType,g=f.modelType,y=gd(i,o),b=n[0];switch(v){case Ht.RECT_NODE:if(c.radius!==0){var _=Tm(i,c);_||(b=Am(i,y,c))}break;case Ht.CIRCLE_NODE:b=Qf(i,y,c);break;case Ht.ELLIPSE_NODE:b=Dm(i,y,c);break;case Ht.DIAMOND_NODE:b=Pu(i,y,c);break;case Ht.POLYGON_NODE:b=Pu(i,y,c);break}b&&(n[0]=b);var x=gd(s,l),w=n[n.length-1];switch(g){case Ht.RECT_NODE:if(f.radius!==0){var _=Tm(l,f);_||(w=Am(l,x,f))}break;case Ht.CIRCLE_NODE:w=Qf(l,x,f);break;case Ht.ELLIPSE_NODE:w=Dm(l,x,f);break;case Ht.DIAMOND_NODE:w=Pu(l,x,f);break;case Ht.POLYGON_NODE:w=Pu(l,x,f);break}return w&&(n[n.length-1]=w),n},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,s=i.y;return{x:o,y:s}});return Object.assign({},t,{pointsList:n})},e.prototype.getPath=function(t){return t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=xm({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n,this.updatePoints()},e.prototype.updatePointsList=function(t,n){this.pointsList.forEach(function(s){s.x+=t,s.y+=n});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var o=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},o),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,n){var i;this.isDragging=!0;var o=t.start,s=t.end,l=t.startIndex,d=t.endIndex,c=t.direction,f=this.pointsList,v=f;return c===vn.HORIZONTAL?(f[l]={x:o.x,y:o.y+n.y},f[d]={x:s.x,y:s.y+n.y},v=this.pointsList.map(function(g){return g})):c===vn.VERTICAL&&(f[l]={x:o.x+n.x,y:o.y},f[d]={x:s.x+n.x,y:s.y},v=this.pointsList.map(function(g){return g})),this.updatePointsAfterDrag(v),this.draggingPointList=v,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(Qt({},this.text,this.textPosition)),{start:Qt({},f[l]),end:Qt({},f[d]),startIndex:l,endIndex:d,direction:c}},e.prototype.dragAppend=function(t,n){var i;this.isDragging=!0;var o=t.start,s=t.end,l=t.startIndex,d=t.endIndex,c=t.direction,f=this.pointsList;if(c===vn.HORIZONTAL){f[l]={x:o.x,y:o.y+n.y},f[d]={x:s.x,y:s.y+n.y};var v=this.pointsList.map(function(x){return x});if(l!==0&&d!==this.pointsList.length-1&&(v=this.removeCrossPoints(l,d,v)),l===0){var g={x:o.x,y:o.y+n.y},y=to(g,this.sourceNode);if(!y){var b=this.sourceNode.anchors;v=this.getDraggingPoints(c,"start",g,b,v)}}if(d===this.pointsList.length-1){var _={x:s.x,y:s.y+n.y},y=to(_,this.targetNode);if(!y){var b=this.targetNode.anchors;v=this.getDraggingPoints(c,"end",_,b,v)}}this.updatePointsAfterDrag(v),this.draggingPointList=v}else if(c===vn.VERTICAL){f[l]={x:o.x+n.x,y:o.y},f[d]={x:s.x+n.x,y:s.y};var v=this.pointsList.map(function(w){return w});if(l!==0&&d!==this.pointsList.length-1&&(v=this.removeCrossPoints(l,d,v)),l===0){var g={x:o.x+n.x,y:o.y},y=to(g,this.sourceNode);if(!y){var b=this.sourceNode.anchors;v=this.getDraggingPoints(c,"start",g,b,v)}}if(d===this.pointsList.length-1){var _={x:s.x+n.x,y:s.y},y=to(_,this.targetNode);if(!y){var b=this.targetNode.anchors;v=this.getDraggingPoints(c,"end",_,b,v)}}this.updatePointsAfterDrag(v),this.draggingPointList=v}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(Qt({},this.text,this.textPosition)),{start:Qt({},f[l]),end:Qt({},f[d]),startIndex:l,endIndex:d,direction:c}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=tw(ra(this.points));this.pointsList=t.map(function(o){return o}),this.draggingPointList=[];var n=t[0];this.startPoint=Qt({},n);var i=t[t.length-1];this.endPoint=Qt({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var n=this.updateCrossPoints(t);this.points=n.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,s=t.targetNode;this.pointsList=xm({x:n.x,y:n.y},{x:i.x,y:i.y},o,s,this.offset||0),this.initPoints()},er([Me],e.prototype,"offset",void 0),er([Me],e.prototype,"dbClickPosition",void 0),er([Oe],e.prototype,"initPoints",null),er([Oe],e.prototype,"updatePoints",null),er([Oe],e.prototype,"updateStartPoint",null),er([Oe],e.prototype,"moveStartPoint",null),er([Oe],e.prototype,"updateEndPoint",null),er([Oe],e.prototype,"moveEndPoint",null),er([Oe],e.prototype,"updatePointsList",null),er([Oe],e.prototype,"dragAppendStart",null),er([Oe],e.prototype,"dragAppendSimple",null),er([Oe],e.prototype,"dragAppend",null),er([Oe],e.prototype,"dragAppendEnd",null),er([Oe],e.prototype,"updatePointsAfterDrag",null),er([Oe],e.prototype,"getAdjustStart",null),er([Oe],e.prototype,"getAdjustEnd",null),er([Oe],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(lc),Gn=function(){return Gn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Gn.apply(this,arguments)},At=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},zm=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},NI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Mo=function(){function r(e,t){var n;this.BaseType=xn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ei.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=Yt.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=Ht.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,n=t.x,i=n===void 0?0:n,o=t.y,s=o===void 0?0:o;this.transform=new md(-i,-s).rotate(e).translate(i,s).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),r.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||So()}this.formatText(e),Qt(this,O3(e));var o=this.graphModel.overlapMode;o===mi.INCREASE&&(this.zIndex=e.zIndex||ap())},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,s=o.nodeTextDraggable,l=o.nodeTextEdit,d=e.x,c=e.y,f=e.text,v={value:"",x:d,y:c,draggable:s,editable:l};f&&(typeof f=="string"?v.value=f:(v=Gn(Gn({},v),{x:(t=f.x)!==null&&t!==void 0?t:d,y:(n=f.y)!==null&&n!==void 0?n:c,value:(i=f.value)!==null&&i!==void 0?i:""}),Ua(f.draggable)||(v.draggable=f.draggable),Ua(f.editable)||(v.editable=f.editable))),e.text=v},r.prototype.resize=function(e){var t=e.width,n=e.height,i=e.deltaX,o=e.deltaY,s=this.isAllowResizeNode(i,o,t,n);return s?(this.move(i/2,o/2),this.width=t,this.height=n,this.setProperties({width:t,height:n}),this.getData()):this.getData()},r.prototype.proportionalResize=function(){},r.prototype.getData=function(){var e=this.text,t=e.x,n=e.y,i=e.value,o=this.properties;Za(o)&&(o=pi(o)),br(o.width)&&(o.width=this.width),br(o.height)&&(o.height=this.height);var s={id:this.id,type:this.type,x:this.x,y:this.y,properties:o};return this.rotate&&(s.rotate=this.rotate),this.graphModel.overlapMode===mi.INCREASE&&(s.zIndex=this.zIndex),i&&(s.text={x:t,y:n,value:i}),s},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.getProperties=function(){return pi(this.properties)},r.prototype.getOuterGAttributes=function(){return{className:""}},r.prototype.getNodeStyle=function(){return Gn(Gn({},this.graphModel.theme.baseNode),this.style)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,n=t===void 0?{}:t;return Gn(Gn({},Lt(e)),Lt(n))},r.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Lt(e)},r.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Lt(e)},r.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Lt(e)},r.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Lt(t)},r.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Lt(t)},r.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Lt(e)},r.prototype.isAllowConnectedAsSource=function(e,t,n,i){var o=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var s=!0,l="",d=0;d<o.length;d++){var c=o[d];if(!c.validate.call(this,this,e,t,n,i)){s=!1,l=c.message;break}}return{isAllPass:s,msg:l}},r.prototype.getConnectedSourceRules=function(){return this.sourceRules},r.prototype.isAllowConnectedAsTarget=function(e,t,n,i){var o=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var s=!0,l="",d=0;d<o.length;d++){var c=o[d];if(!c.validate.call(this,e,this,t,n,i)){s=!1,l=c.message;break}}return{isAllPass:s,msg:l}},r.prototype.isAllowMoveNode=function(e,t){var n,i,o=!0,s=!0,l=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var d=zm(l),c=d.next();!c.done;c=d.next()){var f=c.value,v=f(this,e,t);if(!v)return!1;if(typeof v=="object"){var g=v;if(!g.x&&!g.y)return!1;o=o&&g.x,s=s&&g.y}}}catch(y){n={error:y}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return{x:o,y:s}},r.prototype.getConnectedTargetRules=function(){return this.targetRules},r.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,n=e.id,i=e.x,o=e.y;return t&&t.length>0?t.map(function(s,l){return s.length?(s=s,{id:"".concat(n,"_").concat(l),x:i+s[0],y:o+s[1]}):(s=s,Gn(Gn({},s),{x:i+s.x,y:o+s.y,id:s.id||"".concat(n,"_").concat(l)}))}):this.getDefaultAnchor()},r.prototype.getDefaultAnchor=function(){return[]},r.prototype.getTargetAnchor=function(e){return S3(e,this)},r.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(r.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,n=t.x,i=t.y,o=t.rotate;return e.forEach(function(s){var l=s.x,d=s.y,c=NI(new Xl([l,d,1]).translate(-n,-i).rotate(o).translate(n,i)[0],2),f=c[0],v=c[1];s.x=f,s.y=v}),e},enumerable:!1,configurable:!0}),r.prototype.getAnchorInfo=function(e){if(!br(e))for(var t=0;t<this.anchors.length;t++){var n=this.anchors[t];if(n.id===e)return n}},r.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},r.prototype.isAllowMoveByXORY=function(e,t,n){var i,o;if(n)i=!0,o=!0;else{var s=this.isAllowMoveNode(e,t);typeof s=="boolean"?(i=s,o=s):(i=s.x,o=s.y)}return{isAllowMoveX:i,isAllowMoveY:o}},r.prototype.move=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,s=i.isAllowMoveY;return o&&(this.x=this.x+e,this.text&&this.moveText(e,0)),s&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(o||s)&&(this.rotate=this._rotate),o||s},r.prototype.getMoveDistance=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,s=i.isAllowMoveY,l=0,d=0;return o&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),l=e),s&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),d=t),this.transform=new md(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[l,d]},r.prototype.moveTo=function(e,t,n){n===void 0&&(n=!1);var i=e-this.x,o=t-this.y;return!n&&!this.isAllowMoveNode(i,o)?!1:(this.text&&this.moveText(i,o),this.x=e,this.y=t,!0)},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,s=n.value,l=n.draggable,d=n.editable;this.text={value:s,editable:d,draggable:l,x:i+e,y:o+t}},r.prototype.updateText=function(e){this.text=Gn(Gn({},pi(this.text)),{value:e})},r.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},r.prototype.isAllowResizeNode=function(e,t,n,i){var o,s,l=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var d=zm(l),c=d.next();!c.done;c=d.next()){var f=c.value,v=f(this,e,t,n,i);if(!v)return!1}}catch(g){o={error:g}}finally{try{c&&!c.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}return!0},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},r.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},r.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},r.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateProperties=function(e,t){var n=pi(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(yt.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:n,properties:e})},r.prototype.setProperty=function(e,t){var n=pi(this.properties),i=Lt(n);vC(i,e,dr(t)),this.updateProperties(i,[e])},r.prototype.setProperties=function(e){var t=pi(this.properties),n=Gn(Gn({},t),dr(e)),i=[];gC(e,function(o,s){(If(t,s)&&t[s]!==o||!If(t,s))&&i.push(s)}),this.updateProperties(n,i)},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setStyle=function(e,t){var n;this.style=Gn(Gn({},this.style),(n={},n[e]=dr(t),n))},r.prototype.setStyles=function(e){this.style=Gn(Gn({},this.style),dr(e))},r.prototype.updateStyles=function(e){this.style=Gn({},dr(e))},r.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},r.prototype.updateAttributes=function(e){Qt(this,e)},r.BaseType=xn.NODE,At([Me],r.prototype,"type",void 0),At([Me],r.prototype,"x",void 0),At([Me],r.prototype,"y",void 0),At([Me],r.prototype,"textMode",void 0),At([Me],r.prototype,"text",void 0),At([Me],r.prototype,"properties",void 0),At([Me],r.prototype,"_width",void 0),At([Me],r.prototype,"_height",void 0),At([Me],r.prototype,"anchorsOffset",void 0),At([Me],r.prototype,"isSelected",void 0),At([Me],r.prototype,"isHovered",void 0),At([Me],r.prototype,"isShowAnchor",void 0),At([Me],r.prototype,"isDragging",void 0),At([Me],r.prototype,"isHitable",void 0),At([Me],r.prototype,"isHittable",void 0),At([Me],r.prototype,"draggable",void 0),At([Me],r.prototype,"visible",void 0),At([Me],r.prototype,"rotatable",void 0),At([Me],r.prototype,"resizable",void 0),At([Me],r.prototype,"zIndex",void 0),At([Me],r.prototype,"state",void 0),At([Me],r.prototype,"autoToFront",void 0),At([Me],r.prototype,"style",void 0),At([Me],r.prototype,"transform",void 0),At([Me],r.prototype,"_rotate",void 0),At([un],r.prototype,"incoming",null),At([un],r.prototype,"outgoing",null),At([Oe],r.prototype,"setTextMode",null),At([Oe],r.prototype,"addNodeMoveRules",null),At([Oe],r.prototype,"move",null),At([Oe],r.prototype,"getMoveDistance",null),At([Oe],r.prototype,"moveTo",null),At([Oe],r.prototype,"moveText",null),At([Oe],r.prototype,"updateText",null),At([Oe],r.prototype,"addNodeResizeRules",null),At([Oe],r.prototype,"setSelected",null),At([Oe],r.prototype,"setHovered",null),At([Oe],r.prototype,"setIsShowAnchor",null),At([Oe],r.prototype,"setRotatable",null),At([Oe],r.prototype,"setResizable",null),At([Oe],r.prototype,"setHitable",null),At([Oe],r.prototype,"setHittable",null),At([Oe],r.prototype,"setElementState",null),At([Oe],r.prototype,"setProperty",null),At([Oe],r.prototype,"setProperties",null),At([Oe],r.prototype,"deleteProperty",null),At([Oe],r.prototype,"setStyle",null),At([Oe],r.prototype,"setStyles",null),At([Oe],r.prototype,"updateStyles",null),At([Oe],r.prototype,"setZIndex",null),At([Oe],r.prototype,"updateAttributes",null),r}(),MI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),sl=function(){return sl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},sl.apply(this,arguments)},_f=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Sd=function(r){MI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.circle,i=this.properties.style,o=i===void 0?{}:i;return sl(sl(sl({},t),Lt(n)),Lt(o))},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.r;return[{x:n,y:i-o,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+o,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.deltaX,o=t.deltaY;return this.move(i/2,o/2),this.r=n,this.setProperties({r:n}),this.getData()},_f([Me],e.prototype,"r",void 0),_f([un],e.prototype,"width",null),_f([un],e.prototype,"height",null),e}(Mo),AI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ll=function(){return ll=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ll.apply(this,arguments)},Ta=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Iu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},lh=function(r){AI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.diamond,i=this.properties.style,o=i===void 0?{}:i;return ll(ll(ll({},t),Lt(n)),Lt(o))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,n=t.x,i=t.y,o=t.rx,s=t.ry;return[[n,i-s],[n+o,i],[n,i+s],[n-o,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return ro(this.points,function(t){var n=Iu(t,2),i=n[0],o=n[1];return{x:i,y:o}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return on(this.points,function(i){var o=Iu(i,1),s=o[0];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return on(this.points,function(i){var o=Iu(i,2),s=o[1];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return ro(this.points,function(n,i){var o=Iu(n,2),s=o[0],l=o[1];return{x:s,y:l,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,s=t.deltaY;return this.move(o/2,s/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},Ta([Me],e.prototype,"rx",void 0),Ta([Me],e.prototype,"ry",void 0),Ta([un],e.prototype,"points",null),Ta([un],e.prototype,"pointsPosition",null),Ta([un],e.prototype,"width",null),Ta([un],e.prototype,"height",null),e}(Mo),TI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ul=function(){return ul=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ul.apply(this,arguments)},Bu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},uh=function(r){TI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.ellipse,i=this.properties.style,o=i===void 0?{}:i;return ul(ul(ul({},t),Lt(n)),Lt(o))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.rx,s=t.ry;return[{x:n,y:i-s,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,s=t.deltaY;return this.move(o/2,s/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},Bu([Me],e.prototype,"rx",void 0),Bu([Me],e.prototype,"ry",void 0),Bu([un],e.prototype,"width",null),Bu([un],e.prototype,"height",null),e}(Mo),DI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),dl=function(){return dl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},dl.apply(this,arguments)},ju=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Hu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Ed=function(r){DI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.points,i=t.width,o=t.height,s=n||this.points;this.points=y3(s,i,o)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.polygon,i=this.properties.style,o=i===void 0?{}:i;return dl(dl(dl({},t),Lt(n)),Lt(o))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return this.points.map(function(l){return{x:l[0]+n-o/2,y:l[1]+i-s/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Hu(i,1),s=o[0];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Hu(i,2),s=o[1];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=this,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points;return d.map(function(c,f){var v=Hu(c,2),g=v[0],y=v[1];return{x:i+g-s/2,y:o+y-l/2,id:"".concat(t.id,"_").concat(f)}})},e.prototype.resize=function(t){var n=this,i=t.width,o=t.height,s=t.deltaX,l=t.deltaY;this.move(s/2,l/2);var d=ro(this.points,function(c){var f=Hu(c,2),v=f[0],g=f[1];return[v*i/n.width,g*o/n.height]});return this.points=d,this.properties.points=d,this.getData()},ju([Me],e.prototype,"points",void 0),ju([un],e.prototype,"pointsPosition",null),ju([un],e.prototype,"width",null),ju([un],e.prototype,"height",null),e}(Mo),LI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),cl=function(){return cl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},cl.apply(this,arguments)},PI=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},is=function(r){LI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height,o=t.radius,s=this.getNodeStyle().radius;br(n)||(this.width=n),br(i)||(this.height=i),br(o)||(this.radius=o),br(s)||(this.radius=s)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return[{x:n,y:i-s/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.rect,i=this.properties.style,o=i===void 0?{}:i;return cl(cl(cl({},t),Lt(n)),Lt(o))},PI([Me],e.prototype,"radius",void 0),e}(Mo),RI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),fl=function(){return fl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},fl.apply(this,arguments)},Wm=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},II=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},BI=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Um=function(r){RI(e,r);function e(){var t=r.apply(this,BI([],II(arguments),!1))||this;return t.modelType=Ht.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=r.prototype.getTextStyle.call(this),n=this.graphModel.theme.text,i=this.properties.textStyle;return fl(fl(fl({},t),Lt(n)),Lt(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=Pm({rows:t,fontSize:n,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=Pm({rows:t,fontSize:n,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),Wm([un],e.prototype,"width",null),Wm([un],e.prototype,"height",null),e}(Mo),jI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Tl=function(r){jI(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Ht.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height;n&&(this.width=n),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return[{x:n,y:i-s/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e}(Mo),Zt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},HI={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},$u=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],$I=function(){function r(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=ei.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ei.TEXT,this.edgeTextMode=ei.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",Qt(this,this.computeConfig(e))}return r.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);Qt(this,t)},r.prototype.computeConfig=function(e){var t=e.isSilentMode,n=e.textDraggable,i=e.textMode,o=e.textEdit,s=e.adjustEdgeStartAndEnd,l={};if(t===!1&&Qt(l,this.stagedConfig),t===!0&&t!==this.isSilentMode){var d=Ia(HI,$u);this.stagedConfig=Ia(this,$u),Qt(l,d)}Ua(o)||Qt(l,{nodeTextEdit:o,edgeTextEdit:o}),Ua(n)||Qt(l,{nodeTextDraggable:n,edgeTextDraggable:n}),i&&Qt(l,{nodeTextMode:i,edgeTextMode:i}),Bf(s)&&Qt(l,{adjustEdgeStart:s,adjustEdgeEnd:s});var c=Ia(e,$u);return Qt(l,c)},r.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},r.prototype.getConfig=function(){return Ia(this,$u)},Zt([Me],r.prototype,"isSilentMode",void 0),Zt([Me],r.prototype,"stopZoomGraph",void 0),Zt([Me],r.prototype,"stopMoveGraph",void 0),Zt([Me],r.prototype,"stopScrollGraph",void 0),Zt([Me],r.prototype,"snapGrid",void 0),Zt([Me],r.prototype,"textMode",void 0),Zt([Me],r.prototype,"textEdit",void 0),Zt([Me],r.prototype,"textDraggable",void 0),Zt([Me],r.prototype,"nodeTextEdit",void 0),Zt([Me],r.prototype,"nodeTextDraggable",void 0),Zt([Me],r.prototype,"nodeTextMultiple",void 0),Zt([Me],r.prototype,"nodeTextVertical",void 0),Zt([Me],r.prototype,"nodeTextMode",void 0),Zt([Me],r.prototype,"edgeTextMode",void 0),Zt([Me],r.prototype,"edgeTextEdit",void 0),Zt([Me],r.prototype,"edgeTextDraggable",void 0),Zt([Me],r.prototype,"edgeTextMultiple",void 0),Zt([Me],r.prototype,"edgeTextVertical",void 0),Zt([Me],r.prototype,"hideAnchors",void 0),Zt([Me],r.prototype,"allowRotate",void 0),Zt([Me],r.prototype,"allowResize",void 0),Zt([Me],r.prototype,"hoverOutline",void 0),Zt([Me],r.prototype,"nodeSelectedOutline",void 0),Zt([Me],r.prototype,"adjustNodePosition",void 0),Zt([Me],r.prototype,"autoExpand",void 0),Zt([Me],r.prototype,"adjustEdge",void 0),Zt([Me],r.prototype,"adjustEdgeMiddle",void 0),Zt([Me],r.prototype,"adjustEdgeStartAndEnd",void 0),Zt([Me],r.prototype,"adjustEdgeStart",void 0),Zt([Me],r.prototype,"adjustEdgeEnd",void 0),Zt([Me],r.prototype,"edgeSelectedOutline",void 0),Zt([Oe],r.prototype,"updateEditConfig",null),Zt([Oe],r.prototype,"updateTextMode",null),r}(),FI="*",zI=function(){function r(){this._events={}}return r.prototype.on=function(e,t,n){var i=this;e==null||e.split(",").forEach(function(o){o=o.trim(),i._events[o]||(i._events[o]=[]),i._events[o].push({callback:t,once:!!n})})},r.prototype.once=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){i=i.trim(),n.on(i,t,!0)})},r.prototype.emit=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){var o=n._events[i]||[],s=n._events[FI]||[],l=function(d){for(var c=d.length,f=0;f<c;f++)if(d[f]){var v=d[f],g=v.callback,y=v.once;y&&(d.splice(f,1),d.length===0&&delete n._events[i],c--,f--),g.apply(n,[t])}};l(o),l(s)})},r.prototype.off=function(e,t){var n=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete n._events[i];else{for(var o=n._events[i]||[],s=o.length,l=0;l<s;l++)o[l].callback===t&&(o.splice(l,1),s--,l--);o.length===0&&delete n._events[i]}})},r.prototype.getEvents=function(){return this._events},r.prototype.destroy=function(){this._events={}},r}(),WI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),dh=function(){return dh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},dh.apply(this,arguments)},UI=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},VI=function(r){WI(e,r);function e(t){var n=r.call(this)||this;n.stepScrollX=0,n.stepScrollY=0,n.onDragging=function(l){var d=l.deltaX,c=l.deltaY;n.setState({isDragging:!0});var f=n.props.graphModel,v=f.transformModel,g=f.editConfigModel;g.stopMoveGraph!==!0&&v.translate(d,c)},n.onDragEnd=function(){n.setState({isDragging:!1})},n.zoomHandler=function(l){var d=n.props,c=d.graphModel,f=c.editConfigModel,v=c.transformModel,g=c.gridSize,y=d.graphModel,b=l.deltaX,_=l.deltaY,x=f.stopScrollGraph,w=f.stopZoomGraph;if(!x&&!l.ctrlKey&&!l.metaKey){if(l.preventDefault(),n.stepScrollX+=b,n.stepScrollY+=_,Math.abs(n.stepScrollX)>=g){var C=n.stepScrollX%g,k=n.stepScrollX-C;v.translate(-k*v.SCALE_X,0),n.stepScrollX=C}if(Math.abs(n.stepScrollY)>=g){var D=n.stepScrollY%g,I=n.stepScrollY-D;v.translate(0,-I*v.SCALE_Y),n.stepScrollY=D}return}if(!w){l.preventDefault();var $=y.getPointByClient({x:l.clientX,y:l.clientY}),R=$.canvasOverlayPosition,F=R.x,z=R.y;v.zoom(l.deltaY<0,[F,z])}},n.clickHandler=function(l){var d=l.target;if(d.getAttribute("name")==="canvas-overlay"){var c=n.props.graphModel,f=c.selectElements;f.size>0&&c.clearSelectElements(),c.eventCenter.emit(yt.BLANK_CLICK,{e:l})}},n.handleContextMenu=function(l){var d=l.target;if(d.getAttribute("name")==="canvas-overlay"){l.preventDefault();var c=n.props.graphModel,f=c.getPointByClient({x:l.clientX,y:l.clientY});c.eventCenter.emit(yt.BLANK_CONTEXTMENU,{e:l,position:f})}},n.mouseDownHandler=function(l){var d=n.props.graphModel,c=d.eventCenter,f=d.editConfigModel,v=d.transformModel.SCALE_X,g=d.gridSize,y=f.adjustEdge,b=f.adjustNodePosition,_=f.stopMoveGraph,x=l.target,w=!y&&!b;(x.getAttribute("name")==="canvas-overlay"||w)&&(_!==!0?(n.stepDrag.setStep(g*v),n.stepDrag.handleMouseDown(l)):c.emit(yt.BLANK_MOUSEDOWN,{e:l}),n.clickHandler(l))};var i=t.graphModel,o=i.gridSize,s=i.eventCenter;return n.stepDrag=new oi({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"BLANK",isStopPropagation:!1,eventCenter:s,model:void 0}),n.state={isDragging:!1},n}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props,o=i.children,s=i.dnd,l=this.state.isDragging;return ke("svg",dh({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:l?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},s.eventMap(),{children:ke("g",{transform:n,children:o})}))},e=UI([xr],e),e}(Wt),hw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dl=function(){return Dl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dl.apply(this,arguments)},XI=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},GI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Vm=function(r){hw(e,r);function e(){var t=r.call(this)||this;return t.onDragging=function(n){var i=n.event,o=t.props,s=o.graphModel,l=o.bezierModel,d=o.type,c=s.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,f=c.x,v=c.y;l.updateAdjustAnchor({x:f,y:v},d),s.eventCenter.emit(yt.EDGE_ADJUST,{data:l.getData()})},t.onDragEnd=function(){var n=t.props.bezierModel;n.isDragging=!1},t.dragHandler=new oi({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,n=this.props.position,i=n.x,o=n.y,s=this.props.bezierModel,l=s.getEdgeStyle().adjustAnchor;return ke(ns,Dl({className:"lf-bezier-adjust-anchor",x:i,y:o},l,{onMouseDown:function(d){t.dragHandler.handleMouseDown(d)}}))},e}(Wt),YI=function(r){hw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,n){var i=t.path,o=t.id,s=rp(i),l=GI(s,4),d=l[0],c=l[1],f=l[2],v=l[3],g=t.getEdgeStyle().adjustLine,y=[];return y.push(ke(ts,Dl({x1:d.x,y1:d.y,x2:c.x,y2:c.y},g))),y.push(ke(Vm,{position:c,bezierModel:t,graphModel:n,type:"sNext"},"".concat(o,"_ePre"))),y.push(ke(ts,Dl({x1:v.x,y1:v.y,x2:f.x,y2:f.y},g))),y.push(ke(Vm,{position:f,bezierModel:t,graphModel:n,type:"ePre"},"".concat(o,"_sNext"))),y},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,n=t.edges,i=[],o=0;o<n.length;o++){var s=n[o];s.isSelected&&s.modelType===Ht.BEZIER_EDGE&&s.draggable&&i.push(this.getBezierAdjust(s,t))}return i},e.prototype.render=function(){return ke("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=XI([xr],e),e}(Wt),qI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),KI=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},JI=function(r){qI(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return ke("div",{className:"lf-background",children:ke("div",{style:mC(t)?t:{},className:"lf-background-area"})})},e=KI([xr],e),e}(Wt),ZI=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),QI=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Fa=function(r){ZI(e,r);function e(t){var n=r.call(this,t)||this;return n.id=So(),n.gridOptions=n.props.graphModel.grid,n}return e.prototype.renderDot=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,s=t.visible,l=n??{},d=l.color,c=l.thickness,f=c===void 0?2:c,v=Math.min(Math.max(2,f),o/4),g=s?1:0;return ke("g",{fill:d,opacity:g,children:[ke("circle",{cx:0,cy:0,r:v/2}),ke("circle",{cx:0,cy:o,r:v/2}),ke("circle",{cx:o,cy:0,r:v/2}),ke("circle",{cx:o,cy:o,r:v/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,s=t.visible,l=n??{},d=l.color,c=l.thickness,f=c===void 0?1:c,v=Math.min(Math.max(1,f),o/2),g="M 0 0 H ".concat(o," V ").concat(o," H 0 Z"),y=s?1:0;return ke("path",{d:g,stroke:d,strokeWidth:v/2,opacity:y,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,n=t.transformModel,i=t.grid;this.gridOptions=i;var o=this.gridOptions,s=o.type,l=o.size,d=l===void 0?1:l,c=n.SCALE_X,f=n.SKEW_Y,v=n.SKEW_X,g=n.SCALE_Y,y=n.TRANSLATE_X,b=n.TRANSLATE_Y,_=[c,f,v,g,y,b].join(","),x="matrix(".concat(_,")");return ke("div",{className:"lf-grid",children:ke("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[ke("defs",{children:ke("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:x,x:"0",y:"0",width:d,height:d,children:[s==="dot"&&this.renderDot(),s==="mesh"&&this.renderMesh()]})}),ke("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=QI([xr],e),e}(Wt);(function(r){r.defaultProps={size:qR,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var n=Lt(r.defaultProps);return typeof t=="number"?Qt(n,{size:t}):typeof t=="boolean"?Qt(n,{visible:t}):Qt(n,t)}r.getGridOptions=e})(Fa||(Fa={}));var e8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),t8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},n8=function(r){e8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props.children;return ke("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:ke("g",{transform:n,children:i})})},e=t8([xr],e),e}(Wt),r8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),mo=function(){return mo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},mo.apply(this,arguments)},i8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},o8=function(r){r8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,n=t.nodes,i=t.editConfigModel,o=i.hoverOutline,s=i.nodeSelectedOutline,l=[];return n.forEach(function(d){if(d.isHovered||d.isSelected){var c=d.isHovered,f=d.isSelected,v=d.x,g=d.y,y=d.width,b=d.height;if(s&&f||o&&c){var _=d.getOutlineStyle(),x={};if(Object.keys(_).forEach(function(C){C!=="hover"&&(x[C]=_[C])}),c){var w=_.hover;x=mo(mo({},x),w)}l.push(ke(Zr,mo({transform:d.transform,className:"lf-outline-node",x:v,y:g,width:y+10,height:b+10},x)))}}}),l},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,n=t.edges,i=t.editConfigModel,o=i.edgeSelectedOutline,s=i.hoverOutline,l=[],d=0;d<n.length;d++){var c=n[d];(o&&c.isSelected||s&&c.isHovered)&&(c.modelType===Ht.LINE_EDGE?l.push(this.getLineOutline(c)):c.modelType===Ht.POLYLINE_EDGE?l.push(this.getPolylineOutline(c)):c.modelType===Ht.BEZIER_EDGE&&l.push(this.getBezierOutline(c)))}return l},e.prototype.getLineOutline=function(t){var n=t.startPoint,i=t.endPoint,o=(n.x+i.x)/2,s=(n.y+i.y)/2,l=Math.abs(n.x-i.x)+10,d=Math.abs(n.y-i.y)+10,c=t.getOutlineStyle();return ke(Zr,mo({className:"lf-outline-edge",x:o,y:s,width:l,height:d},c))},e.prototype.getPolylineOutline=function(t){var n=t.points,i=ra(n),o=El(i,8),s=o.x,l=o.y,d=o.width,c=o.height,f=t.getOutlineStyle();return ke(Zr,mo({className:"lf-outline",x:s,y:l,width:d,height:c},f))},e.prototype.getBezierOutline=function(t){var n=t.path,i=rp(n),o=El(i,8),s=o.x,l=o.y,d=o.width,c=o.height,f=t.getOutlineStyle();return ke(Zr,mo({className:"lf-outline",x:s,y:l,width:d,height:c},f))},e.prototype.render=function(){return ke("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=i8([xr],e),e}(Wt),a8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yo=function(){return yo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yo.apply(this,arguments)},s8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},l8=function(r){a8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,n=t??{},i=n.position,o=n.isShowHorizontal,s=n.isShowVertical,l=t==null?void 0:t.getStyle(),d=i??{},c=d.x,f=c===void 0?0:c,v=d.y,g=v===void 0?0:v,y=yo(yo({x1:-1e5,y1:g,x2:1e5,y2:g},l),{stroke:o?l==null?void 0:l.stroke:"none"}),b=yo(yo({x1:f,y1:-1e5,x2:f,y2:1e5},l),{stroke:s?l==null?void 0:l.stroke:"none"});return ke("g",{className:"lf-snapline",children:[ke(ts,yo({},y)),ke(ts,yo({},b))]})},e=s8([xr],e),e}(Wt),u8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),d8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},c8=function(r){u8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,n=t.tool,i=t.graphModel,o=i.textEditElement,s=n.getTools(),l=s.map(function(d){return vt(d,{textEditElement:o,graphModel:i,lf:n.instance})});return n.components=l,l},e.prototype.triggerToolRender=function(){var t=this.props,n=t.tool,i=t.graphModel,o=document.querySelector("#ToolOverlay_".concat(i.flowId)),s=n.getInstance();s.components.forEach(function(l){return l(s,o)}),s.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return ke("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=d8([xr],e),e}(Wt),lr=function(){return lr=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},lr.apply(this,arguments)},gt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},f8=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kn=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Yr=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},h8=function(){function r(e){var t=this,n,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=mi.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var o=e.container,s=e.partial,l=e.background,d=l===void 0?{}:l,c=e.grid,f=e.idGenerator,v=e.edgeGenerator,g=e.animation,y=e.customTrajectory;this.rootEl=o,this.partial=!!s,this.background=d,typeof c=="object"&&e.snapGrid&&(this.gridSize=c.size||1),this.customStyles=e.style||{},this.grid=Fa.getGridOptions(c??!1),this.theme=fw(e.style,e.themeMode),this.theme.grid=Lt(this.grid),this.theme.background=Lt(this.background),this.edgeType=e.edgeType||"polyline",this.animation=XR(g),this.overlapMode=e.overlapMode||mi.DEFAULT,this.width=(n=e.width)!==null&&n!==void 0?n:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=br(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=br(e.height);var b=new ResizeObserver(e_(function(_){var x,w;try{for(var C=f8(_),k=C.next();!k.done;k=C.next()){var D=k.value;D.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:D.contentRect}))}}catch(I){x={error:I}}finally{try{k&&!k.done&&(w=C.return)&&w.call(C)}finally{if(x)throw x.error}}},16));b.observe(this.rootEl),this.waitCleanEffects.push(function(){b.disconnect()}),this.eventCenter=new zI,this.editConfigModel=new $I(e),this.transformModel=new g8(this.eventCenter,e),this.flowId=So(),this.idGenerator=f,this.edgeGenerator=g3(this,v),this.customTrajectory=y}return Object.defineProperty(r.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelsMap",{get:function(){return Yr(Yr([],Kn(this.nodes),!1),Kn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sortElements",{get:function(){for(var e=Yr(Yr([],Kn(this.nodes),!1),Kn(this.edges),!1).sort(function(l,d){return l.zIndex-d.zIndex}),t=[],n=[-Au,-Au],i=[this.width+Au,this.height+Au],o=0;o<e.length;o++){var s=e[o];s.visible&&(!this.partial||s.isSelected||this.isElementInArea(s,n,i,!1,!1))&&t.push(s)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(n){return n.state===Yt.TEXT_EDIT}),t=this.edges.find(function(n){return n.state===Yt.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),r.prototype.getAreaElement=function(e,t,n,i,o){var s=this;n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1);var l=[];return on(Yr(Yr([],Kn(this.nodes),!1),Kn(this.edges),!1),function(d){var c=s.isElementInArea(d,e,t,n,i);(!o||d.visible)&&c&&l.push(d)}),l},r.prototype.getModel=function(e){return this.modelMap.get(e)},r.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getPointByClient=function(e){var t=e.x,n=e.y,i=this.rootEl.getBoundingClientRect(),o={x:t-i.left,y:n-i.top},s=Kn(this.transformModel.HtmlPointToCanvasPoint([o.x,o.y]),2),l=s[0],d=s[1],c={x:l,y:d};return{domOverlayPosition:o,canvasOverlayPosition:c}},r.prototype.isElementInArea=function(e,t,n,i,o){var s;if(i===void 0&&(i=!0),o===void 0&&(o=!0),e.BaseType===xn.NODE){e=e;for(var l=zr(e),d=l.minX,c=l.minY,f=l.maxX,v=l.maxY,g=[{x:d,y:c},{x:f,y:c},{x:f,y:v},{x:d,y:v}],y=o,b=0;b<g.length;b++){var _=g[b],x=_.x,w=_.y;if(s=Kn(this.transformModel.CanvasPointToHtmlPoint([x,w]),2),x=s[0],w=s[1],gf([x,w],t,n)!==o){y=!o;break}}return y}if(e.BaseType===xn.EDGE){e=e;var C=e.startPoint,k=e.endPoint,D=this.transformModel.CanvasPointToHtmlPoint([C.x,C.y]),I=this.transformModel.CanvasPointToHtmlPoint([k.x,k.y]),$=gf(D,t,n),R=gf(I,t,n);return i?$&&R:$||R}return!1},r.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=ro(e.nodes,function(i){var o=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(o.id,o),t.nodeModelMap.set(o.id,o),o}):this.nodes=[],e.edges){var n=this.edgeType;this.edges=ro(e.edges,function(i){var o,s=t.getModel((o=i.type)!==null&&o!==void 0?o:n);if(!s)throw new Error("找不到".concat(i.type,"对应的边。"));var l=new s(i,t);return t.edgeModelMap.set(l.id,l),t.elementsModelMap.set(l.id,l),l})}else this.edges=[]},r.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(n){var i=n.getData();i&&!n.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(n){var i=n.getData();i&&!n.virtual&&t.push(i)}),{nodes:t,edges:e}},r.prototype.modelToHistoryData=function(){for(var e=!1,t=[],n=0;n<this.nodes.length;n++){var i=this.nodes[n];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var o=!1,s=[],l=0;l<this.edges.length;l++){var d=this.edges[l];if(d.isDragging){o=!0;break}else s.push(d.getHistoryData())}return o?!1:{nodes:t,edges:s}},r.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getElement=function(e){return this.modelsMap[e]},r.prototype.getNodeEdges=function(e){for(var t=[],n=0;n<this.edges.length;n++){var i=this.edges[n],o=i.sourceNodeId===e,s=i.targetNodeId===e;(o||s)&&t.push(i)}return t},r.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,n={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===xn.NODE&&n.nodes.push(i.getData()),i.BaseType===xn.EDGE){var o=i.getData(),s=t.get(o.sourceNodeId)&&t.get(o.targetNodeId);(e||s)&&n.edges.push(o)}}),n},r.prototype.updateAttributes=function(e,t){var n=this.getElement(e);n==null||n.updateAttributes(t)},r.prototype.changeNodeId=function(e,t){return t||(t=So()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(n){n.sourceNodeId===e&&(n.sourceNodeId=t),n.targetNodeId===e&&(n.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},r.prototype.changeEdgeId=function(e,t){return t||(t=So()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(n){n.id===e&&n.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},r.prototype.getTextModel=function(e){var t=this.editConfigModel,n=t.textMode,i=t.nodeTextMode,o=t.edgeTextMode;if(e.BaseType===xn.NODE)return e.textMode||i||n||ei.TEXT;if(e.BaseType===xn.EDGE)return e.textMode||o||n||ei.TEXT},r.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},r.prototype.setFakeNode=function(e){this.fakeNode=e},r.prototype.removeFakeNode=function(){this.fakeNode=null},r.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},r.prototype.toFront=function(e){var t,n,i,o=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((n=this.edgesMap[e])===null||n===void 0?void 0:n.model);o&&(this.overlapMode===mi.DEFAULT&&((i=this.topElement)===null||i===void 0||i.setZIndex(),o.setZIndex(YR),this.topElement=o),this.overlapMode===mi.INCREASE&&this.setElementZIndex(e,"top"))},r.prototype.setElementZIndex=function(e,t){var n,i,o=((n=this.nodesMap[e])===null||n===void 0?void 0:n.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(o){var s=void 0;typeof t=="number"?s=t:(t==="top"&&(s=ap()),t==="bottom"&&(s=wI())),o.setZIndex(s)}},r.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,n=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(yt.NODE_DELETE,{data:n,model:t})},r.prototype.addNode=function(e,t,n){t===void 0&&(t=yt.NODE_ADD);var i=dr(e),o=i.id;o&&this.nodesMap[o]&&delete i.id;var s=this.getModelAfterSnapToGrid(i);this.nodes.push(s);var l=s.getData(),d={data:l};return n&&(d.e=n),this.eventCenter.emit(t,d),s},r.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),n=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,o=e.y;i&&o&&(e.x=es(i,this.gridSize,n),e.y=es(o,this.gridSize,n),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-o));var s=new t(e,this);return this.nodeModelMap.set(s.id,s),this.elementsModelMap.set(s.id,s),s},r.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){n.x+=30,n.y+=30,n.id="",typeof n.text=="object"&&n.text!==null&&(n.text.x+=30,n.text.y+=30);var i=this.addNode(n);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},r.prototype.moveNode=function(e,t,n,i){var o;i===void 0&&(i=!1);var s=this.nodesMap[e];if(!s){console.warn("不存在id为".concat(e,"的节点"));return}var l=s.model;o=Kn(l.getMoveDistance(t,n,i),2),t=o[0],n=o[1],this.moveEdge(e,t,n)},r.prototype.moveNode2Coordinate=function(e,t,n,i){i===void 0&&(i=!1);var o=this.nodesMap[e];if(!o){console.warn("不存在id为".concat(e,"的节点"));return}var s=o.model,l=s.x,d=s.y,c=t-l,f=n-d;this.moveNode(e,c,f,i)},r.prototype.editText=function(e){this.setElementStateById(e,Yt.TEXT_EDIT)},r.prototype.addEdge=function(e){var t=dr(e),n=t.type;n||(n=this.edgeType),t.id&&this.edgesMap[t.id]&&delete t.id;var i=this.getModel(n);if(!i)throw new Error("找不到".concat(n,"对应的边，请确认是否已注册此类型边。"));var o=new i(lr(lr({},t),{type:n}),this);this.edgeModelMap.set(o.id,o),this.elementsModelMap.set(o.id,o);var s=o.getData();return this.edges.push(o),this.eventCenter.emit(yt.EDGE_ADD,{data:s}),o},r.prototype.moveEdge=function(e,t,n){for(var i=0;i<this.edges.length;i++){var o=this.edges[i],s=o.textPosition,l=s.x,d=s.y,c=this.edges[i].sourceNodeId===e,f=this.edges[i].targetNodeId===e;c&&o.moveStartPoint(t,n),f&&o.moveEndPoint(t,n),(c||f)&&this.handleEdgeTextMove(o,l,d)}},r.prototype.handleEdgeTextMove=function(e,t,n){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===Ht.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var o=e.text,s=rw(o,e.points);e.moveText(s.x-o.x,s.y-o.y)}var l=e.textPosition,d=l.x,c=l.y;e.moveText(d-t,c-n)},r.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var n=0;n<this.edges.length;n++)if(this.edges[n].sourceNodeId===e&&this.edges[n].targetNodeId===t){var i=this.edges[n].getData();this.edges.splice(n,1),n--,this.eventCenter.emit(yt.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var n=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(n,1),this.eventCenter.emit(yt.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(yt.EDGE_DELETE,{data:n})}},r.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(yt.EDGE_DELETE,{data:n})}},r.prototype.setElementStateById=function(e,t,n){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(Yt.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(Yt.DEFAULT)})},r.prototype.updateText=function(e,t){var n=ta(Yr(Yr([],Kn(this.nodes),!1),Kn(this.edges),!1),function(i){return i.id===e});n==null||n.updateText(t)},r.prototype.selectNodeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.nodesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectEdgeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.edgesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var n=this.getElement(e);n==null||n.setSelected(!0)},r.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},r.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===mi.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},r.prototype.moveNodes=function(e,t,n,i){var o,s,l,d=this;i===void 0&&(i=!1);for(var c=e.reduce(function(k,D){var I,$=(I=d.nodesMap[D])===null||I===void 0?void 0:I.model;return $&&(k[D]=$.getMoveDistance(t,n,i)),k},{}),f=0;f<this.edges.length;f++){var v=this.edges[f],g=v.textPosition,y=g.x,b=g.y,_=c[v.sourceNodeId],x=c[v.targetNodeId],w=void 0,C=void 0;_&&x&&v.modelType===Ht.POLYLINE_EDGE?(o=Kn(_,2),w=o[0],C=o[1],v.updatePointsList(w,C)):(_&&(s=Kn(_,2),w=s[0],C=s[1],v.moveStartPoint(w,C)),x&&(l=Kn(x,2),w=l[0],C=l[1],v.moveEndPoint(w,C))),(_||x)&&this.handleEdgeTextMove(v,y,b)}},r.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},r.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},r.prototype.setDefaultEdgeType=function(e){this.edgeType=e},r.prototype.changeNodeType=function(e,t){var n=this.getNodeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的节点"));return}var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var s=new o(i,this);this.nodes.splice(this.nodesMap[e].index,1,s);var l=this.getNodeEdges(e);l.forEach(function(d){if(d.sourceNodeId===e){var c=Lm(s,d.startPoint,s.width,s.height);d.updateStartPoint(c)}if(d.targetNodeId===e){var c=Lm(s,d.endPoint,s.width,s.height);d.updateEndPoint(c)}})},r.prototype.changeEdgeType=function(e,t){var n=this.getEdgeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的边"));return}if(n.type!==t){var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var s=new o(i,this);this.edges.splice(this.edgesMap[e].index,1,s)}},r.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetNodeId===e&&t.push(n)}),t},r.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceNodeId===e&&t.push(n)}),t},r.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetAnchorId===e&&t.push(n)}),t},r.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceAnchorId===e&&t.push(n)}),t},r.prototype.getNodeIncomingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){var o;i.targetNodeId===e&&n.push((o=t.nodesMap[i.sourceNodeId])===null||o===void 0?void 0:o.model)}),n},r.prototype.getNodeOutgoingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&n.push(t.nodesMap[i.targetNodeId].model)}),n},r.prototype.setTheme=function(e,t){var n;if(t&&(Ml[t]&&this.updateBackgroundOptions(lr(lr({},typeof this.background=="object"?this.background:{}),Ml[t])),Al[t]&&this.updateGridOptions(Fa.getGridOptions(lr(lr({},this.grid),Al[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=Fa.getGridOptions((n=e.grid)!==null&&n!==void 0?n:!1);this.updateGridOptions(i)}this.theme=_I(lr(lr({},this.customStyles),e),t),this.customStyles=lr(lr({},this.customStyles),e)},r.prototype.getTheme=function(){var e=this,t=e.background,n=e.grid,i=lr(lr({},Lt(this.theme)),{background:t,grid:n});return i},r.prototype.updateGridOptions=function(e){Wa(this.grid,e)},r.prototype.updateGridSize=function(e){this.gridSize=e},r.prototype.updateBackgroundOptions=function(e){Bf(e)||Bf(this.background)?this.background=e:this.background=lr(lr({},this.background),e)},r.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=br(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=br(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},r.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},r.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],n=[];e.forEach(function(g){var y=g.x,b=g.y,_=g.width,x=g.height,w=g.getNodeStyle().strokeWidth,C=w===void 0?0:w,k=y+_/2+C,D=y-_/2-C,I=b+x/2+C,$=b-x/2-C;t=t.concat([k,D].filter(function(R){return!Number.isNaN(R)})),n=n.concat([I,$].filter(function(R){return!Number.isNaN(R)}))});var i=Math.min.apply(Math,Yr([],Kn(t),!1)),o=Math.max.apply(Math,Yr([],Kn(t),!1)),s=Math.min.apply(Math,Yr([],Kn(n),!1)),l=Math.max.apply(Math,Yr([],Kn(n),!1)),d=o-i||0,c=l-s||0,f=i+d/2,v=s+c/2;return{width:d,height:c,x:f,y:v}},r.prototype.translateCenter=function(){var e=this,t=e.nodes,n=e.width,i=e.height,o=e.rootEl,s=e.transformModel;if(t.length){var l=n||o.clientWidth,d=i||o.clientHeight,c=this.getVirtualRectSize(),f=c.x,v=c.y;s.focusOn(f,v,l,d)}},r.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var n=this,i=n.nodes,o=n.width,s=n.height,l=n.rootEl,d=n.transformModel;if(i.length){var c=o||l.clientWidth,f=s||l.clientHeight,v=this.getVirtualRectSize(),g=v.width,y=v.height,b=v.x,_=v.y,x=(g+t)/c,w=(y+e)/f,C=1/Math.max(x,w),k=[c/2,f/2];d.zoom(C,k),d.focusOn(b,_,c,f)}},r.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},r.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},r.prototype.getPartial=function(){return this.partial},r.prototype.setPartial=function(e){this.partial=e},r.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},gt([Me],r.prototype,"width",void 0),gt([Me],r.prototype,"height",void 0),gt([Me],r.prototype,"theme",void 0),gt([Me],r.prototype,"grid",void 0),gt([Me],r.prototype,"edgeType",void 0),gt([Me],r.prototype,"nodes",void 0),gt([Me],r.prototype,"edges",void 0),gt([Me],r.prototype,"fakeNode",void 0),gt([Me],r.prototype,"overlapMode",void 0),gt([Me],r.prototype,"background",void 0),gt([Me],r.prototype,"gridSize",void 0),gt([Me],r.prototype,"transformModel",void 0),gt([Me],r.prototype,"editConfigModel",void 0),gt([Me],r.prototype,"partial",void 0),gt([un],r.prototype,"nodesMap",null),gt([un],r.prototype,"edgesMap",null),gt([un],r.prototype,"modelsMap",null),gt([un],r.prototype,"sortElements",null),gt([un],r.prototype,"textEditElement",null),gt([un],r.prototype,"selectElements",null),gt([un],r.prototype,"selectNodes",null),gt([Oe],r.prototype,"setTextMode",null),gt([Oe],r.prototype,"setFakeNode",null),gt([Oe],r.prototype,"removeFakeNode",null),gt([Oe],r.prototype,"setModel",null),gt([Oe],r.prototype,"toFront",null),gt([Oe],r.prototype,"setElementZIndex",null),gt([Oe],r.prototype,"deleteNode",null),gt([Oe],r.prototype,"addNode",null),gt([Oe],r.prototype,"cloneNode",null),gt([Oe],r.prototype,"moveNode",null),gt([Oe],r.prototype,"moveNode2Coordinate",null),gt([Oe],r.prototype,"editText",null),gt([Oe],r.prototype,"addEdge",null),gt([Oe],r.prototype,"moveEdge",null),gt([Oe],r.prototype,"deleteEdgeBySourceAndTarget",null),gt([Oe],r.prototype,"deleteEdgeById",null),gt([Oe],r.prototype,"deleteEdgeBySource",null),gt([Oe],r.prototype,"deleteEdgeByTarget",null),gt([Oe],r.prototype,"setElementStateById",null),gt([Oe],r.prototype,"updateText",null),gt([Oe],r.prototype,"selectNodeById",null),gt([Oe],r.prototype,"selectEdgeById",null),gt([Oe],r.prototype,"selectElementById",null),gt([Oe],r.prototype,"deselectElementById",null),gt([Oe],r.prototype,"clearSelectElements",null),gt([Oe],r.prototype,"moveNodes",null),gt([Oe],r.prototype,"setDefaultEdgeType",null),gt([Oe],r.prototype,"changeNodeType",null),gt([Oe],r.prototype,"changeEdgeType",null),gt([Oe],r.prototype,"getNodeIncomingEdge",null),gt([Oe],r.prototype,"getNodeOutgoingEdge",null),gt([Oe],r.prototype,"getAnchorIncomingEdge",null),gt([Oe],r.prototype,"getAnchorOutgoingEdge",null),gt([Oe],r.prototype,"getNodeIncomingNode",null),gt([Oe],r.prototype,"getNodeOutgoingNode",null),gt([Oe],r.prototype,"setTheme",null),gt([Oe],r.prototype,"getTheme",null),gt([Oe],r.prototype,"resize",null),gt([Oe],r.prototype,"clearData",null),gt([Oe],r.prototype,"translateCenter",null),gt([Oe],r.prototype,"fitView",null),gt([Oe],r.prototype,"openEdgeAnimation",null),gt([Oe],r.prototype,"closeEdgeAnimation",null),gt([Oe],r.prototype,"setPartial",null),r}(),Yo=function(){return Yo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Yo.apply(this,arguments)},qs=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},p8=function(){function r(e){this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e}return r.prototype.getStyle=function(){return Yo({},this.graphModel.theme.snapline)},r.prototype.getCenterSnapLine=function(e,t){for(var n=e.x,i=e.y,o=!1,s=!1,l=0;l<t.length;l++){var d=t[l];if(d.id!==e.id&&(n===d.x&&(o=!0),i===d.y&&(s=!0),o&&s))break}return{isShowVertical:o,isShowHorizontal:s,position:{x:n,y:i}}},r.prototype.getHorizontalSnapline=function(e,t){var n=!1,i=0,o=e.id,s;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)s=zr(l);else{var d=this.graphModel.getNodeModelById(o);d&&(s=zr(d))}}for(var c=0;c<t.length;c++){var f=t[c];if(f.id!==e.id){var v=zr(f);if(v.minY===(s==null?void 0:s.minY)||v.maxY===(s==null?void 0:s.minY)){n=!0,i=s.minY;break}if(v.minY===(s==null?void 0:s.maxY)||v.maxY===(s==null?void 0:s.maxY)){n=!0,i=s.maxY;break}}}return{isShowHorizontal:n,isShowVertical:this.isShowVertical,position:Yo(Yo({},this.position),{y:i})}},r.prototype.getVerticalSnapline=function(e,t){var n=!1,i=0,o=e.id,s;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)s=zr(l);else{var d=this.graphModel.getNodeModelById(o);d&&(s=zr(d))}}for(var c=0;c<t.length;c++){var f=t[c];if(f.id!==e.id){var v=zr(f);if(v.minX===(s==null?void 0:s.minX)||v.maxX===(s==null?void 0:s.minX)){n=!0,i=s.minX;break}if(v.minX===(s==null?void 0:s.maxX)||v.maxX===(s==null?void 0:s.maxX)){n=!0,i=s.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:n,position:Yo(Yo({},this.position),{x:i})}},r.prototype.getSnapLinePosition=function(e,t){var n=this.getCenterSnapLine(e,t),i=n.isShowHorizontal,o=n.isShowVertical;if(!i){var s=this.getHorizontalSnapline(e,t);s.isShowHorizontal&&(n.isShowHorizontal=s.isShowHorizontal,n.position.y=s.position.y)}if(!o){var l=this.getVerticalSnapline(e,t);l.isShowVertical&&(n.isShowVertical=l.isShowVertical,n.position.x=l.position.x)}return n},r.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,n=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=n},r.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},r.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,n=this.getSnapLinePosition(e,t);this.setSnaplineInfo(n)},qs([Me],r.prototype,"isShowHorizontal",void 0),qs([Me],r.prototype,"isShowVertical",void 0),qs([Me],r.prototype,"position",void 0),qs([Oe],r.prototype,"clearSnapline",null),qs([Oe],r.prototype,"setNodeSnapLine",null),r}(),ci=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Da=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},v8={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},g8=function(){function r(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var n=t.stopMoveGraph,i=n===void 0?!1:n;this.updateTranslateLimits(i)}return r.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},r.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},r.prototype.HtmlPointToCanvasPoint=function(e){var t=Da(e,2),n=t[0],i=t[1];return[(n-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},r.prototype.CanvasPointToHtmlPoint=function(e){var t=Da(e,2),n=t[0],i=t[1];return[n*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},r.prototype.moveCanvasPointByHtml=function(e,t,n){var i=Da(e,2),o=i[0],s=i[1];return[o+t/this.SCALE_X,s+n/this.SCALE_Y]},r.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},r.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},r.prototype.zoom=function(e,t){e===void 0&&(e=!1);var n=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(n=e,i=e):e?(n+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(n-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),n<this.MINI_SCALE_SIZE||n>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(n-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=n,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},r.prototype.emitGraphTransform=function(e){this.eventCenter.emit(yt.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},r.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},r.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},r.prototype.focusOn=function(e,t,n,i){var o=Da(this.CanvasPointToHtmlPoint([e,t]),2),s=o[0],l=o[1],d=Da([n/2-s,i/2-l],2),c=d[0],f=d[1];this.TRANSLATE_X+=c,this.TRANSLATE_Y+=f,this.emitGraphTransform("focusOn")},r.prototype.updateTranslateLimits=function(e){var t;t=Da(Array.isArray(e)&&e.length===4?e:v8[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},ci([Me],r.prototype,"SCALE_X",void 0),ci([Me],r.prototype,"SKEW_Y",void 0),ci([Me],r.prototype,"SKEW_X",void 0),ci([Me],r.prototype,"SCALE_Y",void 0),ci([Me],r.prototype,"TRANSLATE_X",void 0),ci([Me],r.prototype,"TRANSLATE_Y",void 0),ci([Me],r.prototype,"ZOOM_SIZE",void 0),ci([Oe],r.prototype,"zoom",null),ci([Oe],r.prototype,"resetZoom",null),ci([Oe],r.prototype,"translate",null),ci([Oe],r.prototype,"focusOn",null),r}(),m8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),y8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},_8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},b8=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},x8=function(r){m8(e,r);function e(){var t=r.apply(this,b8([],_8(arguments),!1))||this;return t.handleResize=function(){var n=t.props,i=n.graphModel,o=n.options,s=i.width,l=i.height,d=i.isContainerWidth,c=i.isContainerHeight,f=s,v=l,g=!1;d&&(f=void 0,g=!0),c&&(v=void 0,g=!0),g&&i.resize(f,v),o.width=s,o.height=l},t.throttleResize=yC(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(yt.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,n,i){i===void 0&&(i="canvas-overlay");var o=this.props.getView,s=o(t.type);return s?ke(s,{model:t,graphModel:n,overlay:i},t.id):null},e.prototype.render=function(){var t=this,n=this.props,i=n.graphModel,o=n.tool,s=n.options,l=n.dnd,d=n.snaplineModel,c={};s.width&&(c.width="".concat(i.width,"px")),s.height&&(c.height="".concat(i.height,"px"));var f=i.fakeNode,v=i.editConfigModel,g=i.background,y=v.adjustEdge;return ke("div",{className:"lf-graph","flow-id":i.flowId,style:c,children:[ke(VI,{graphModel:i,dnd:l,children:[ke("g",{className:"lf-base",children:ro(i.sortElements,function(b){return t.getComponent(b,i)})}),f?this.getComponent(f,i):""]}),ke(n8,{graphModel:i,children:[ke(o8,{graphModel:i}),y?ke(YI,{graphModel:i}):"",s.snapline!==!1?ke(l8,{snaplineModel:d}):""]}),ke(c8,{graphModel:i,tool:o}),g&&ke(JI,{background:g}),ke(Fa,{graphModel:i})]})},e=y8([xr],e),e}(Wt),w8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Pi=function(){return Pi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Pi.apply(this,arguments)},S8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},E8=function(r){w8(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(n){var i=n.event,o=t.props,s=o.anchorData,l=o.nodeModel,d=o.graphModel;d.selectNodeById(l.id),l.autoToFront&&d.toFront(l.id),d.eventCenter.emit(yt.ANCHOR_DRAGSTART,{data:s,e:i,nodeModel:l}),t.setState({startX:s.x,startY:s.y,endX:s.x,endY:s.y})},t.onDragging=function(n){var i=n.event,o=t.props,s=o.graphModel,l=o.nodeModel,d=o.anchorData,c=s.transformModel,f=s.eventCenter,v=s.width,g=s.height,y=s.editConfigModel,b=y.autoExpand,_=y.stopMoveGraph;if(i){var x=i.clientX,w=i.clientY,C=s.getPointByClient({x,y:w}),k=C.domOverlayPosition,D=k.x,I=k.y,$=C.canvasOverlayPosition,R=$.x,F=$.y;t.t&&xd(t.t);var z=[],ie=10;D<10?z=[ie,0]:D+10>v?z=[-ie,0]:I<10?z=[0,ie]:I+10>g&&(z=[0,-ie]),t.setState({endX:R,endY:F,dragging:!0}),t.moveAnchorEnd(R,F),z.length>0&&!_&&b&&(t.t=sw(function(){var G=S8(z,2),Q=G[0],T=G[1];c.translate(Q,T);var W=t.state,P=W.endX,le=W.endY;t.setState({endX:P-Q,endY:le-T}),t.moveAnchorEnd(P-Q,le-T)})),f.emit(yt.ANCHOR_DRAG,{data:d,e:i,nodeModel:l})}},t.onDragEnd=function(n){var i=n.event;t.t&&xd(t.t);var o=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var s=t.props,l=s.graphModel,d=s.nodeModel,c=s.anchorData;l.eventCenter.emit(yt.ANCHOR_DRAGEND,{data:c,e:i,nodeModel:d,edgeModel:o??void 0})},t.checkEnd=function(n){var i,o=t.props,s=o.graphModel,l=o.nodeModel,d=o.anchorData,c=d.x,f=d.y,v=d.id,g=t.state,y=g.endX,b=g.endY,_=g.dragging,x=_d({x:y,y:b},s);if(t.preTargetNode&&t.preTargetNode.state!==Yt.DEFAULT&&t.preTargetNode.setElementState(Yt.DEFAULT),!!_&&x&&x.node){var w=x.node,C=x.anchor.id,k="".concat(l.id,"_").concat(w.id,"_").concat(C,"_").concat(v),D=t.sourceRuleResults.get(k)||{},I=D.isAllPass,$=D.msg,R=t.targetRuleResults.get(k)||{},F=R.isAllPass,z=R.msg;if(I&&F){w.setElementState(Yt.DEFAULT);var ie=s.getNodeModelById(x.node.id),G=(i=s.edgeGenerator)===null||i===void 0?void 0:i.call(s,l.getData(),ie==null?void 0:ie.getData()),Q=s.addEdge(Pi(Pi({},G),{sourceNodeId:l.id,sourceAnchorId:v,startPoint:{x:c,y:f},targetNodeId:x.node.id,targetAnchorId:x.anchor.id,endPoint:{x:x.anchor.x,y:x.anchor.y}})),T=t.props.anchorData;return s.eventCenter.emit(yt.ANCHOR_DROP,{data:T,e:n,nodeModel:l,edgeModel:Q}),Q}var W=w.getData();return s.eventCenter.emit(yt.CONNECTION_NOT_ALLOWED,{data:W,msg:z||$||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new oi({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,n=t.anchorData,i=t.style,o=t.node,s=o.getAnchorShape(n);if(s)return s;var l=n.x,d=n.y,c=Pi(Pi({},i),i==null?void 0:i.hover);return ke("g",{children:[ke(ns,Pi({className:"lf-node-anchor-hover"},c,{x:l,y:d})),ke(ns,Pi({className:"lf-node-anchor"},i,{x:l,y:d}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,n=t.graphModel,i=n.getAnchorIncomingEdge,o=n.getAnchorOutgoingEdge,s=t.anchorData.id;return{incomingEdgeList:i(s),outgoingEdgeList:o(s)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,n){var i,o,s=this.props,l=s.graphModel,d=s.nodeModel,c=s.anchorData,f=_d({x:t,y:n},l);if(f){var v=f.node,g=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(Yt.DEFAULT),c.id===g)return;this.preTargetNode=v;var y="".concat(d.id,"_").concat(v.id,"_").concat(g,"_").concat(c.id);if(!this.targetRuleResults.has(y)){var b=f.anchor,_=d.isAllowConnectedAsSource(v,c,b),x=v.isAllowConnectedAsTarget(d,c,b);this.sourceRuleResults.set(y,bd(_)),this.targetRuleResults.set(y,bd(x))}var w=((i=this.sourceRuleResults.get(y))!==null&&i!==void 0?i:{}).isAllPass,C=((o=this.targetRuleResults.get(y))!==null&&o!==void 0?o:{}).isAllPass;w&&C?v.setElementState(Yt.ALLOW_CONNECT):v.setElementState(Yt.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==Yt.DEFAULT&&this.preTargetNode.setElementState(Yt.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,n=t.startX,i=t.startY,o=t.endX,s=t.endY,l=yi(n,i,o,s);return l>10},e.prototype.render=function(){var t=this,n=this.state,i=n.startX,o=n.startY,s=n.endX,l=n.endY,d=this.props,c=d.anchorData,f=d.edgeStyle,v=d.nodeModel,g=d.graphModel,y=c.edgeAddable;return ke("g",{className:"lf-anchor",children:[ke("g",{onClick:function(b){b.stopPropagation(),g.eventCenter.emit(yt.ANCHOR_CLICK,{data:c,e:b,nodeModel:v})},onMouseDown:function(b){g.eventCenter.emit(yt.ANCHOR_MOUSEDOWN,{data:c,e:b,nodeModel:v}),y!==!1&&t.dragHandler.handleMouseDown(b)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(Pi({sourcePoint:{x:i,y:o},targetPoint:{x:s,y:l}},f)):ke(ts,Pi({x1:i,y1:o,x2:s,y2:l},f,{"pointer-events":"none"})))]})},e}(Wt),C8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ch=function(){return ch=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ch.apply(this,arguments)},O8=function(r){C8(e,r);function e(t){var n=r.call(this,t)||this;return n.style={},n.onDragging=function(i){var o,s=i.event,l=n.props,d=l.graphModel,c=l.nodeModel,f=l.eventCenter,v=d.selectNodes,g=c.x,y=c.y,b=s.clientX,_=s.clientY,x=d.getPointByClient({x:b,y:_}).canvasOverlayPosition,w=x.x,C=x.y,k=new rr(w-g,C-y),D=((o=n.normal)===null||o===void 0?void 0:o.angle(k))-n.defaultAngle,I=new md(-g,-y).rotate(D).translate(g,y).toString();c.transform=I,c.rotate=D;var $=ro(v,function(F){return F.id});$.indexOf(c.id)===-1&&($=[c.id]);var R=_C($,function(F,z){var ie=d.getNodeModelById(z);return F[z]=ie==null?void 0:ie.getMoveDistance(0,0,!1),F},{});$.forEach(function(F){var z=d.getNodeEdges(F);z.forEach(function(ie){if(R[ie.sourceNodeId]){var G=d.getNodeModelById(ie.sourceNodeId),Q=G.anchors.find(function(T){return T.id===ie.sourceAnchorId});ie.updateStartPoint(Q)}if(R[ie.targetNodeId]){var G=d.getNodeModelById(ie.targetNodeId),Q=G.anchors.find(function(P){return P.id===ie.targetAnchorId});ie.updateEndPoint(Q)}})}),f.emit(yt.NODE_ROTATE,{e:s,model:c,data:c.getData()})},n.style=t.style,n.stepperDrag=new oi({onDragging:n.onDragging}),n}return e.prototype.render=function(){var t=this,n=this.props.nodeModel,i=n.x,o=n.y,s=n.width,l=n.height,d=i+s/2+20,c=o-l/2-20;return this.normal=new rr(1,0),this.defaultAngle=this.normal.angle(new rr(d-i,c-o)),n.defaultAngle=this.defaultAngle,ke("g",{className:"lf-rotate-control",children:ke("g",{onMouseDown:function(f){t.stepperDrag.handleMouseDown(f)},children:ke(ns,ch({},this.style,{cx:d,cy:c}))})})},e}(Wt),bf={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Xm;function k8(){return Xm||(Xm=1,function(r){(function(){var e={}.hasOwnProperty;function t(){for(var o="",s=0;s<arguments.length;s++){var l=arguments[s];l&&(o=i(o,n(l)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var s="";for(var l in o)e.call(o,l)&&o[l]&&(s=i(s,l));return s}function i(o,s){return s?o?o+" "+s:o+s:o}r.exports?(t.default=t,r.exports=t):window.classNames=t})()}(bf)),bf.exports}var N8=k8();const fh=ls(N8);var M8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),hh=function(){return hh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hh.apply(this,arguments)},A8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},pw=function(r){M8(e,r);function e(t){var n=r.call(this)||this;n.mouseDownHandler=function(o){var s=n.props,l=s.draggable,d=s.model,c=s.graphModel,f=c.editConfigModel.nodeTextDraggable;(l??f)&&(o.stopPropagation(),n.stepperDrag.model=d,n.stepperDrag.handleMouseDown(o))},n.onDragging=function(o){var s=o.deltaX,l=o.deltaY,d=n.props,c=d.model,f=d.graphModel.transformModel;if(s||l){var v=A8(f.fixDeltaXY(s,l),2),g=v[0],y=v[1];c.moveText(g,y)}},n.dbClickHandler=function(){var o=n.props,s=o.editable,l=o.graphModel.eventCenter,d=o.model;s&&d.setElementState(Yt.TEXT_EDIT),l.emit(yt.TEXT_DBCLICK,{data:d.text,model:d})};var i=t.draggable;return n.stepperDrag=new oi({onDragging:n.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),n}return e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=n.text,l=s.value,d=s.x,c=s.y,f=s.editable,v=s.draggable,g={x:d,y:c,className:"",value:l},y=n.getTextStyle(),b=o.nodeTextDraggable||v;return ke(lw,hh({},g,y,{className:fh({"lf-element-text":f,"lf-text-draggable":!f&&b,"lf-text-disabled":!f&&!b}),model:n}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return ke("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(Wt),T8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),fi=function(){return fi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},fi.apply(this,arguments)},Fu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},D8=function(r){T8(e,r);function e(t){var n=r.call(this,t)||this;return n.setHoverOn=function(){n.setState({isHovered:!0})},n.setHoverOff=function(){n.setState({isHovered:!1})},n.state={isHovered:!1},n}return e.prototype.getBackground=function(){var t=this.state.isHovered,n=this.props.model,i=n.text,o=n.getTextStyle(),s=o.background||{};if(t&&o.hover&&o.hover.background&&(s=fi(fi({},s),o.hover.background)),i!=null&&i.value&&(s==null?void 0:s.fill)!=="transparent"){var l=o.fontSize,d=o.textWidth,c=o.lineHeight,f=o.overflowMode,v=s.wrapPadding,g=i==null?void 0:i.value.split(/[\r\n]/g),y=g.length,b=i.x,_=i.y,x={};if(f==="autoWrap"&&d){var w=aw({rows:g,style:{fontSize:"".concat(l,"px"),width:"".concat(d,"px"),lineHeight:c,padding:v},rowsLength:y,className:"lf-get-text-height"});x=fi(fi({},s),{x:b,y:_,width:d,height:w})}else{var C=m3({rows:g,rowsLength:y,fontSize:l}),k=C.width,D=C.height;if(f==="ellipsis"&&(k=d,D=l+2),typeof s.wrapPadding=="string"){var I=s.wrapPadding.split(",").filter(function(Ne){return Ne.trim()}).map(function(Ne){return parseFloat(Ne.trim())});if(I.length>0&&I.length<=4){if(I.length===1){var $=Fu(I,1),R=$[0];I=[R,R,R,R]}else if(I.length===2){var F=Fu(I,2),z=F[0],ie=F[1];I=[z,ie,z,ie]}else if(I.length===3){var G=Fu(I,3),Q=G[0],ie=G[1],T=G[2];I=[Q,ie,T,ie]}var W=Fu(I,4),P=W[0],le=W[1],me=W[2],he=W[3];k+=le+he,D+=P+me,b=b+(le-he)/2,_=_+(me-P)/2}}x=fi(fi({},s),{x:b-1,y:_-1,width:k,height:D})}return ke(Zr,fi({},x))}return null},e.prototype.getShape=function(){var t=this.props.model,n=t.text,i=n.x,o=n.y,s=n.value;if(!s)return null;var l=t.getTextStyle(),d=fi({x:i,y:o,value:s,model:t,className:"lf-element-text"},l);return ke("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),ke(lw,fi({},d))]})},e}(pw),L8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Cd=function(){return Cd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Cd.apply(this,arguments)},P8=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},zu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Ao=function(r){L8(e,r);function e(t){var n=r.call(this)||this;n.onDragStart=function(d){var c=d.event,f=n.props,v=f.model,g=f.graphModel;if(c){var y=g.getPointByClient({x:c.clientX,y:c.clientY}).canvasOverlayPosition,b=y.x,_=y.y;n.moveOffset={dx:v.x-b,dy:v.y-_}}},n.onDragging=function(d){var c,f,v,g,y=d.event,b=n.props,_=b.model,x=b.graphModel,w=x.editConfigModel,C=w.stopMoveGraph,k=w.autoExpand,D=w.snapGrid,I=x.transformModel,$=x.selectNodes,R=x.width,F=x.height,z=x.gridSize;_.isDragging=!0;var ie=y,G=ie.clientX,Q=ie.clientY,T=x.getPointByClient({x:G,y:Q}).canvasOverlayPosition,W=T.x,P=T.y,le=zu(I.CanvasPointToHtmlPoint([W,P]),2),me=le[0],he=le[1];if(W=W+((f=(c=n.moveOffset)===null||c===void 0?void 0:c.dx)!==null&&f!==void 0?f:0),P=P+((g=(v=n.moveOffset)===null||v===void 0?void 0:v.dy)!==null&&g!==void 0?g:0),W=es(W,z,D),P=es(P,z,D),!R||!F){x.moveNode2Coordinate(_.id,W,P);return}var Ne=me<0||he<0||me>R||he>F;if(!(k&&!C&&Ne)){var ye=zu(I.CanvasPointToHtmlPoint([W-_.width/2,P-_.height/2]),2),ae=ye[0],Re=ye[1],Le=zu(I.CanvasPointToHtmlPoint([W+_.width/2,P+_.height/2]),2),Ve=Le[0],Ae=Le[1],te=Math.max(z,20),ce=[];ae<0?ce=[te,0]:Ve>x.width?ce=[-te,0]:Re<0?ce=[0,te]:Ae>x.height&&(ce=[0,-te]),n.t&&xd(n.t);var _e=$.map(function(Ie){return Ie.id});_e.indexOf(_.id)===-1&&(_e=[_.id]),ce.length>0&&!C&&k?n.t=sw(function(){var Ie=zu(ce,2),Ke=Ie[0],$e=Ie[1];I.translate(Ke??0,$e??0);var Ue=-(Ke??0)/I.SCALE_X,Nt=-($e??0)/I.SCALE_X;x.moveNodes(_e,Ue,Nt)}):x.moveNodes(_e,W-_.x,P-_.y)}},n.onDragEnd=function(){n.t&&xd(n.t);var d=n.props.model;d.isDragging=!1},n.onMouseOut=function(d){GR()&&n.setHoverOff(d)},n.handleMouseUp=function(){var d=n.props.model;n.mouseUpDrag=d.isDragging},n.handleClick=function(d){var c=n.mouseUpDrag===!1;if(n.startTime){var f=n.props,v=f.model,g=f.graphModel;if(c){var y=v.getData(),b=g.getPointByClient({x:d.clientX,y:d.clientY}),_={data:y,e:d,position:b,isSelected:!1,isMultiple:!1},x=d.button===2,w=d.detail===2;if(!x){var C=g.editConfigModel,k=iw(d,C);_.isMultiple=k,v.isSelected&&!w&&k?(_.isSelected=!1,v.setSelected(!1)):(g.selectNodeById(v.id,k),_.isSelected=!0,C.isSilentMode||n.toFront()),w?(C.nodeTextEdit&&v.text.editable&&C.textMode===ei.TEXT&&(v.setSelected(!1),g.setElementStateById(v.id,Yt.TEXT_EDIT)),g.eventCenter.emit(yt.NODE_DBCLICK,_)):(g.eventCenter.emit(yt.ELEMENT_CLICK,_),g.eventCenter.emit(yt.NODE_CLICK,_))}}}},n.handleContextMenu=function(d){d.preventDefault();var c=n.props,f=c.model,v=c.graphModel,g=v.editConfigModel,y=f.getData(),b=v.getPointByClient({x:d.clientX,y:d.clientY});v.setElementStateById(f.id,Yt.SHOW_MENU,b.domOverlayPosition),f.isSelected||v.selectNodeById(f.id),v.eventCenter.emit(yt.NODE_CONTEXTMENU,{data:y,e:d,position:b}),g.isSilentMode||n.toFront()},n.handleMouseDown=function(d){var c=n.props,f=c.model,v=c.graphModel;n.startTime=new Date().getTime();var g=v.editConfigModel;g.adjustNodePosition&&f.draggable&&n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.handleFocus=function(){var d=n.props,c=d.model,f=d.graphModel;f.eventCenter.emit(yt.NODE_FOCUS,{data:c.getData()})},n.handleBlur=function(){var d=n.props,c=d.model,f=d.graphModel;f.eventCenter.emit(yt.NODE_BLUR,{data:c.getData()})},n.setHoverOn=function(d){var c=n.props,f=c.model,v=c.graphModel;if(!f.isHovered){var g=f.getData();f.setHovered(!0),v.eventCenter.emit(yt.NODE_MOUSEENTER,{data:g,e:d})}},n.setHoverOff=function(d){var c=n.props,f=c.model,v=c.graphModel,g=f.getData();f.isHovered&&(f.setHovered(!1),v.eventCenter.emit(yt.NODE_MOUSELEAVE,{data:g,e:d}))};var i=t.graphModel,o=i.gridSize,s=i.eventCenter,l=t.model;return n.stepDrag=new oi({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"NODE",isStopPropagation:!1,eventCenter:s,model:l}),n.modelDisposer=D1(function(){return n.props},function(d){d&&d.model&&n.stepDrag.setModel(d.model)}),n}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,n=this.props,i=n.model,o=n.graphModel,s=i.isSelected,l=i.isHitable,d=i.isDragging,c=i.isShowAnchor;return l&&(s||c)&&!d?ro(i.anchors,function(f,v){var g=i.getAnchorLineStyle(f),y=i.getAnchorStyle(f);return ke(E8,{anchorData:f,node:t,style:y,edgeStyle:g,anchorIndex:v,nodeModel:i,graphModel:o,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.isSilentMode,l=o.allowRotate,d=n.isSelected,c=n.isHitable,f=n.rotatable,v=n.isHovered,g=l&&f,y=n.getRotateControlStyle();if(!s&&c&&(d||v)&&g)return ke(O8,{graphModel:i,nodeModel:n,eventCenter:i.eventCenter,style:y})},e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.isSilentMode,l=o.allowResize,d=n.isSelected,c=n.isHitable,f=n.resizable,v=n.isHovered,g=l&&f,y=n.getResizeControlStyle();return!s&&c&&(d||v)&&g?ke(G3,{style:y,model:n,graphModel:i}):null},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,s=o.editConfigModel;if(s.nodeTextMode!==ei.TEXT||i.state===Yt.TEXT_EDIT)return null;if(i.text){var l=!1;return s.nodeTextDraggable&&i.text.draggable&&(l=!0),ke(pw,{editable:s.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,n=t.state,i=t.isDragging,o=t.isSelected,s="lf-node";switch(n){case Yt.ALLOW_CONNECT:s+=" lf-node-allow";break;case Yt.NOT_ALLOW_CONNECT:s+=" lf-node-not-allow";break;default:s+=" lf-node-default";break}return i&&(s+=" lf-dragging"),o&&(s+=" lf-node-selected"),s},e.prototype.toFront=function(){var t=this.props,n=t.model,i=t.graphModel;n.autoToFront&&i.toFront(n.id)},e.prototype.render=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.hideAnchors,l=o.adjustNodePosition,d=o.allowRotate,c=o.allowResize,f=i.gridSize,v=i.transformModel.SCALE_X,g=n.isHitable,y=n.draggable,b=n.transform,_=n.getOuterGAttributes(),x=_.className,w=x===void 0?"":x,C=P8(_,["className"]),k=ke("g",{className:"lf-node-content",children:[ke("g",{transform:b,children:[this.getShape(),this.getText(),d&&this.getRotateControl(),c&&this.getResizeControl()]}),!s&&this.getAnchors()]}),D;return g?(l&&y&&this.stepDrag.setStep(f*v),D=ke("g",Cd({className:"".concat(this.getStateClassName()," ").concat(w),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},C,{children:k}))):D=ke("g",Cd({className:"".concat(this.getStateClassName()," ").concat(w)},C,{children:k})),D},e.isObserved=!1,e}(Wt),R8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ph=function(){return ph=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ph.apply(this,arguments)},ia=function(r){R8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return ke(Zr,ph({},n,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(Ao),I8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vh=function(){return vh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vh.apply(this,arguments)},Od=function(r){I8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.r,s=t.getNodeStyle();return ke(ns,vh({},s,{x:n,y:i,r:o}))},e}(Ao),B8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),kd=function(){return kd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},kd.apply(this,arguments)},Nd=function(r){B8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points,c=t.getNodeStyle(),f={transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(o-l/2,")")};return ke("g",kd({},f,{children:ke(op,kd({},c,{points:d,x:i,y:o}))}))},e}(Ao),j8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gh=function(){return gh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gh.apply(this,arguments)},mh=function(r){j8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return ke("g",{children:ke(op,gh({},n,{points:t.points,x:t.x,y:t.y}))})},e}(Ao),H8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yh=function(){return yh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yh.apply(this,arguments)},_h=function(r){H8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return ke(H3,yh({},n,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(Ao),$8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),hl=function(){return hl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hl.apply(this,arguments)},Gm=function(r){$8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,n=t.getTextStyle(),i=t.width,o=t.height,s=t.x,l=t.y,d=hl(hl({},n.background),{x:s,y:l,width:i,height:o});return ke(Zr,hl({},d))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return ke("g",{children:this.getBackground()})},e}(Ao),F8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bh=function(){return bh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bh.apply(this,arguments)},z8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},W8=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Ll=function(r){F8(e,r);function e(){var t=r.apply(this,W8([],z8(arguments),!1))||this;return t.ref=tc(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.height,s=t.width,l=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),ke("foreignObject",bh({},l,{x:n-s/2,y:i-o/2,width:s,height:o,ref:this.ref}))},e}(Ao),U8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),hi=function(){return hi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hi.apply(this,arguments)},V8=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},X8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Ii;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(Ii||(Ii={}));var Ym=function(r){U8(e,r);function e(t){var n=r.call(this)||this;n.handleMouseDown=function(d){n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.onDragStart=function(){var d=n.props,c=d.x,f=d.y,v=d.edgeModel,g=v.startPoint,y=v.endPoint,b=v.pointsList;n.oldEdge={startPoint:g,endPoint:y,pointsList:b},n.setState({endX:c,endY:f,dragging:!0})},n.onDragging=function(d){var c=d.deltaX,f=d.deltaY,v=n.state,g=v.endX,y=v.endY,b=n.props,_=b.graphModel,x=b.type,w=_.transformModel,C=_.editConfigModel,k=X8(w.moveCanvasPointByHtml([g,y],c,f),2),D=k[0],I=k[1];n.setState({endX:D,endY:I,dragging:!0});var $=n.props.edgeModel,R=_d({x:g,y},_);if(R&&R.node&&n.isAllowAdjust(R).pass){var F=$.startPoint,z=$.endPoint,ie=$.sourceNode,G=$.targetNode,Q=x===Ii.SOURCE?{startPoint:{x:R.anchor.x,y:R.anchor.y},endPoint:{x:z.x,y:z.y},sourceNode:R.node,targetNode:G}:{startPoint:{x:F.x,y:F.y},endPoint:{x:R.anchor.x,y:R.anchor.y},sourceNode:ie,targetNode:R.node};$.updateAfterAdjustStartAndEnd(Q)}else x===Ii.SOURCE?$.updateStartPoint({x:D,y:I}):$.updateEndPoint({x:D,y:I});$.text.value&&C.adjustEdge&&$.setText(Object.assign({},$.text,$.textPosition))},n.onDragEnd=function(d){var c,f,v,g=d.event;try{n.setState({dragging:!1});var y=n.props,b=y.graphModel,_=y.edgeModel,x=y.type,w=n.state,C=w.endX,k=w.endY,D=w.dragging,I=_d({x:C,y:k},b);if(!D)return;var $=!1,R=void 0;if(I&&I.node){var F=n.isAllowAdjust(I),z=F.pass,ie=F.msg,G=F.newTargetNode;if(z){var Q=_.getData(),T=Q.text,W=Q.sourceAnchorId,P=W===void 0?"":W,le=Q.targetAnchorId,me=le===void 0?"":le,he=V8(Q,["text","sourceAnchorId","targetAnchorId"]);if(R=hi(hi({sourceAnchorId:P,targetAnchorId:me},he),{text:(T==null?void 0:T.value)||""}),x===Ii.SOURCE){var Ne=b.getNodeModelById(I.node.id),ye=b.getNodeModelById(_.targetNodeId),ae=(c=b.edgeGenerator)===null||c===void 0?void 0:c.call(b,Ne==null?void 0:Ne.getData(),ye==null?void 0:ye.getData(),R);R=hi(hi({},ae),{sourceNodeId:I.node.id,sourceAnchorId:I.anchor.id,startPoint:{x:I.anchor.x,y:I.anchor.y},targetNodeId:_.targetNodeId,endPoint:hi({},_.endPoint)}),_.sourceNodeId===I.node.id&&_.sourceAnchorId===I.anchor.id&&($=!0)}else if(x===Ii.TARGET){var Ne=b.getNodeModelById(_.sourceNodeId),ye=b.getNodeModelById(I.node.id),ae=(f=b.edgeGenerator)===null||f===void 0?void 0:f.call(b,Ne==null?void 0:Ne.getData(),ye==null?void 0:ye.getData(),R);R=hi(hi({},ae),{sourceNodeId:_.sourceNodeId,startPoint:hi({},_.startPoint),targetNodeId:I.node.id,targetAnchorId:I.anchor.id,endPoint:{x:I.anchor.x,y:I.anchor.y}}),_.targetNodeId===I.node.id&&_.targetAnchorId===I.anchor.id&&($=!0)}}else{$=!0;var Re=G.getData();b.eventCenter.emit(yt.CONNECTION_NOT_ALLOWED,{data:Re,msg:ie})}}else $=!0;if($)n.recoveryEdge();else{var Le=_.getData();b.deleteEdgeById(_.id);var Ve=b.addEdge(hi({},R));b.eventCenter.emit(yt.EDGE_EXCHANGE_NODE,{data:{newEdge:Ve.getData(),oldEdge:Le}})}(v=n.preTargetNode)===null||v===void 0||v.setElementState(Yt.DEFAULT)}finally{var b=n.props.graphModel;b.eventCenter.emit(yt.ADJUST_POINT_DRAGEND,{e:g,data:n.stepDragData})}},n.recoveryEdge=function(){var d=n.props.edgeModel,c=n.oldEdge,f=c.startPoint,v=c.endPoint,g=c.pointsList;d.updateStartPoint(f),d.updateEndPoint(v),d.modelType!==Ht.LINE_EDGE&&(d.pointsList=g??[],d.initPoints())},n.getAdjustPointStyle=function(){var d=n.props.graphModel.theme,c=d.edgeAdjust;return c},n.state={dragging:!1,endX:0,endY:0},n.targetRuleResults=new Map,n.sourceRuleResults=new Map;var i=t.type,o=t.edgeModel,s=t.graphModel,l=s.eventCenter;return n.stepDragData={type:i,edgeData:o.getData()},n.stepDrag=new oi({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:l,data:n.stepDragData}),n}return e.prototype.isAllowAdjust=function(t){var n=this.props,i=n.edgeModel,o=i.id,s=i.sourceNode,l=i.targetNode,d=i.sourceAnchorId,c=i.targetAnchorId,f=n.type,v,g,y,b;if(f===Ii.SOURCE?(v=t.node,g=l,y=t.anchor,b=l.getAnchorInfo(c)):(v=s,g=t.node,b=t.anchor,y=s.getAnchorInfo(d)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(Yt.DEFAULT),this.preTargetNode=t.node,b.id===y.id)return{pass:!1,msg:"",newTargetNode:g};var _="".concat(v.id,"_").concat(g.id,"_").concat(y.id,"_").concat(b.id);if(!this.targetRuleResults.has(_)){var x=v.isAllowConnectedAsSource(g,y,b,o),w=g.isAllowConnectedAsTarget(v,y,b,o);this.sourceRuleResults.set(_,bd(x)),this.targetRuleResults.set(_,bd(w))}var C=this.sourceRuleResults.get(_),k=C.isAllPass,D=C.msg,I=this.targetRuleResults.get(_),$=I.isAllPass,R=I.msg,F=k&&$?Yt.ALLOW_CONNECT:Yt.NOT_ALLOW_CONNECT;return f===Ii.SOURCE?v.setElementState(F):g.setElementState(F),{pass:k&&$,msg:R||D,newTargetNode:g}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.getAdjustPointShape,s=t.edgeModel,l=this.state.dragging;return ke("g",{pointerEvents:l?"none":"",onMouseDown:this.handleMouseDown,children:l?"":o(n,i,s)})},e}(Wt),G8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),xh=function(){return xh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},xh.apply(this,arguments)};(function(r){G8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,n=t.arrowInfo,i=t.style,o=n.start,s=n.end,l={start:o,end:s,offset:i.offset,verticalLength:i.verticalLength,type:"end"},d=Sl(l),c=d.leftX,f=d.leftY,v=d.rightX,g=d.rightY;return xh({d:"M".concat(c," ").concat(f," L").concat(s.x," ").concat(s.y," L").concat(v," ").concat(g," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),n=t.d,i=t.strokeWidth,o=t.stroke,s=t.fill;return ke(Ol,{d:n,fill:s,strokeWidth:i,stroke:o})},e.prototype.render=function(){return ke("g",{className:"lf-arrow",children:this.getShape()})},e})(Wt);var Y8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),pl=function(){return pl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},pl.apply(this,arguments)},q8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},uc=function(r){Y8(e,r);function e(){var t=r.call(this)||this;return t.textRef=tc(),t.handleHover=function(n,i){var o=t.props,s=o.model,l=o.graphModel.eventCenter;s.setHovered(n);var d=n?yt.EDGE_MOUSEENTER:yt.EDGE_MOUSELEAVE,c=s.getData();l.emit(d,{data:c,e:i})},t.setHoverOn=function(n){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,n))},t.setHoverOff=function(n){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,n))},t.handleContextMenu=function(n){n.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,o=i.model,s=i.graphModel,l=s.editConfigModel,d=s.getPointByClient({x:n.clientX,y:n.clientY});s.setElementStateById(o.id,Yt.SHOW_MENU,d.domOverlayPosition),l.isSilentMode||t.toFront(),o.isSelected||s.selectEdgeById(o.id);var c=o==null?void 0:o.getData();s.eventCenter.emit(yt.EDGE_CONTEXTMENU,{data:c,e:n,position:d})},t.handleMouseDown=function(n){n.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(){var n=t.props.model;t.mouseUpDrag=n.isDragging},t.handleClick=function(n){if(t.startTime&&!t.mouseUpDrag){var i=n.button===2;if(!i){var o=n.detail===2,s=t.props,l=s.model,d=s.graphModel,c=l==null?void 0:l.getData(),f=d.getPointByClient({x:n.clientX,y:n.clientY});if(o){var v=d.editConfigModel,g=d.textEditElement,y=l.id,b=l.text,_=l.modelType;if(g&&g.id===y&&d.setElementStateById(y,Yt.DEFAULT),v.edgeTextEdit&&b.editable&&(l.setSelected(!1),d.setElementStateById(y,Yt.TEXT_EDIT)),_===Ht.POLYLINE_EDGE){var x=l,w=d.getPointByClient({x:n.x,y:n.y}).canvasOverlayPosition,C=w.x,k=w.y;x.dbClickPosition=rw({x:C,y:k},x.points)}d.eventCenter.emit(yt.EDGE_DBCLICK,{data:c,e:n,position:f})}else d.eventCenter.emit(yt.ELEMENT_CLICK,{data:c,e:n,position:f}),d.eventCenter.emit(yt.EDGE_CLICK,{data:c,e:n,position:f});var D=d.editConfigModel;d.selectEdgeById(l.id,iw(n,D)),D.isSilentMode||t.toFront()}}},t.handleFocus=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(yt.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(yt.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return ke("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,s=o.editConfigModel;if(s.edgeTextMode!==ei.TEXT||i.state===Yt.TEXT_EDIT)return null;if(i.text){var l=!1;return s.edgeTextDraggable&&i.text.draggable&&(l=!0),ke(D8,{ref:this.textRef,editable:s.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isSelected,s=this.state.hover;return{start:n,end:i,hover:s,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint;return[n,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,n=t.id,i=t.getArrowStyle(),o=i.refY,s=o===void 0?0:o,l=i.refX,d=l===void 0?2:l,c=q8(this.getLastTwoPoints(),2),f=c[0],v=c[1],g="auto";return f!==null&&v!==null&&(g=uI(lI({x:v.x-f.x,y:v.y-f.y}))),ke("g",{children:ke("defs",{children:[ke("marker",{id:"marker-start-".concat(n),refX:-d,refY:s,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),ke("marker",{id:"marker-end-".concat(n),refX:d,refY:s,overflow:"visible",orient:g,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,n){var i=n.stroke,o=n.fill,s=o===void 0?i:o,l=n.strokeWidth,d=n.offset,c=d===void 0?10:d,f=n.verticalLength,v=n.strokeLinecap,g=n.strokeLinejoin,y=n.transform,b="";switch(t){case"solid":b="M".concat(-c/4,",0 L").concat(3*c/4,",").concat(f," L").concat(3*c/4,",-").concat(f," Z");break;case"hollow":b="M".concat(-c/4,",0 L").concat(3*c/4,",").concat(f," L").concat(-c/4,",0 L").concat(3*c/4,",-").concat(f," L").concat(-c/4,",0 Z");break;case"diamond":b="M".concat(-c/2,",0 L0,").concat(f," L").concat(c/2,",0 L0,-").concat(f," L").concat(-c/2,",0 Z");break;case"circle":b="M".concat(-c/2,",0 A").concat(c/4,",").concat(c/4," 0 1,0 ").concat(c/2,",0 A").concat(c/4,",").concat(c/4," 0 1,0 ").concat(-c/2,",0 Z");break;default:b="";break}return ke("path",{d:b,stroke:i,fill:s,strokeWidth:l,strokeLinecap:v,strokeLinejoin:g,transform:y})},e.prototype.getStartArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,s=n.offset,l=n.verticalLength,d=n.startArrowType,c=d===void 0?"none":d,f=n.strokeLinecap,v=n.strokeLinejoin;return this.getArrowPath(c,{stroke:i,strokeWidth:o,offset:s,verticalLength:l,strokeLinecap:f,strokeLinejoin:v})},e.prototype.getEndArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,s=n.offset,l=n.verticalLength,d=n.endArrowType,c=d===void 0?"solid":d,f=n.strokeLinecap,v=n.strokeLinejoin;return this.getArrowPath(c,{stroke:i,strokeWidth:o,offset:s,verticalLength:l,strokeLinecap:f,strokeLinejoin:v,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,n,i){var o=i.getAdjustPointStyle();return ke(ns,pl({className:"lf-edge-adjust-point"},o,{x:t,y:n}))},e.prototype.getAdjustPoints=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.adjustEdgeStartAndEnd,l=o.adjustEdgeStart,d=o.adjustEdgeEnd,c=n.getAdjustStart(),f=n.getAdjustEnd();return ke("g",{children:[s&&l&&ke(Ym,pl({type:Ii.SOURCE},c,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i})),s&&d&&ke(Ym,pl({type:Ii.TARGET},f,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return ke("g",{})},e.prototype.getAppend=function(){return ke("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,n=t.graphModel,i=t.model;n.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,n=t.isSelected,i=t.isHitable,o=t.isShowAdjustPoint;return ke("g",{children:[ke("g",{className:["lf-edge",!i&&"pointer-none",n&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),o&&n?this.getAdjustPoints():""]})},e.isObserved=!1,e}(Wt),K8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),wh=function(){return wh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},wh.apply(this,arguments)},J8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},qm=function(r){K8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.getEdgeStyle(),i=t,o=i.path,s=i.isAnimation,l=i.arrowConfig,d=t.getEdgeAnimationStyle(),c=d.strokeDasharray,f=d.stroke,v=d.strokeDashoffset,g=d.animationName,y=d.animationDuration,b=d.animationIterationCount,_=d.animationTimingFunction,x=d.animationDirection;return ke(Ol,wh({d:o},n,l,s?{strokeDasharray:c,stroke:f,style:{strokeDashoffset:v,animationName:g,animationDuration:y,animationIterationCount:b,animationTimingFunction:_,animationDirection:x}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return ke(Ol,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,n=this.state.hover,i=t.isSelected,o=t.getArrowStyle().offset,s=t.pointsList.map(function(v){return{x:v.x,y:v.y}}),l=J8(km(s,o),2),d=l[0],c=l[1],f={start:d,end:c,hover:n,isSelected:i};return f},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.getArrowStyle().offset,i=t.pointsList.map(function(o){return{x:o.x,y:o.y}});return km(i,n)},e}(uc),Z8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Sh=function(){return Sh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Sh.apply(this,arguments)},Km=function(r){Z8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isAnimation,s=t.arrowConfig,l=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),c=d.strokeDasharray,f=d.stroke,v=d.strokeDashoffset,g=d.animationName,y=d.animationDuration,b=d.animationIterationCount,_=d.animationTimingFunction,x=d.animationDirection;return ke(ts,Sh({},l,{x1:n.x,y1:n.y,x2:i.x,y2:i.y},s,o?{strokeDasharray:c,stroke:f,style:{strokeDashoffset:v,animationName:g,animationDuration:y,animationIterationCount:b,animationTimingFunction:_,animationDirection:x}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o={start:n,end:i},s=p3(o),l=s.d,d=s.strokeWidth,c=s.fill,f=s.strokeDasharray,v=s.stroke;return ke(Ol,{d:l,fill:c,strokeWidth:d,stroke:v,strokeDasharray:f})},e}(uc),Q8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),qo=function(){return qo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},qo.apply(this,arguments)},e4=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},os=function(r){Q8(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(){var n=t.props.model;n.dragAppendStart(),t.isShowAdjustPointTemp=n.isShowAdjustPoint,n.isShowAdjustPoint=!1},t.onDragging=function(n){var i=n.deltaX,o=n.deltaY,s=t.props,l=s.model,d=s.graphModel;t.isDragging=!0;var c=d.transformModel,f=d.editConfigModel,v=e4(c.fixDeltaXY(i,o),2),g=v[0],y=v[1],b=l,_=f.adjustEdgeMiddle;_?t.appendInfo=b.dragAppendSimple(t.appendInfo,{x:g,y}):t.appendInfo=b.dragAppend(t.appendInfo,{x:g,y})},t.onDragEnd=function(){var n,i=t.props,o=i.model,s=i.graphModel.eventCenter,l=o;l.dragAppendEnd(),t.isDragging=!1,l.isShowAdjustPoint=(n=t.isShowAdjustPointTemp)!==null&&n!==void 0?n:!1,t.appendInfo=void 0,s.emit(yt.EDGE_ADJUST,{data:l.getData()})},t.beforeDragStart=function(n,i){i.draggable&&t.drag.handleMouseDown(n),t.appendInfo=i},t.drag=new oi({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,s=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,v=l.animationName,g=l.animationDuration,y=l.animationIterationCount,b=l.animationTimingFunction,_=l.animationDirection;return ke(W3,qo({points:n},s,o,i?{strokeDasharray:d,stroke:c,style:{strokeDashoffset:f,animationName:v,animationDuration:g,animationIterationCount:y,animationTimingFunction:b,animationDirection:_}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.points,i=t.isSelected,o=this.state.hover,s=ra(n),l=s[0],d=s[0];return s.length>=2&&(l=s[s.length-2],d=s[s.length-1]),{start:l,end:d,hover:o,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.points,i=ra(n),o=i[0],s=i[0];return i.length>=2&&(o=i[i.length-2],s=i[i.length-1]),[o,s]},e.prototype.getAppendAttributes=function(t){var n=t.start,i=t.end,o;if(n.x===i.x&&n.y===i.y)o="";else{var s={start:n,end:i,offset:10,verticalLength:5},l=Sl(qo(qo({},s),{type:"start"})),d=Sl(qo(qo({},s),{type:"end"}));o="M".concat(l.leftX," ").concat(l.leftY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(d.rightX," ").concat(d.rightY,`
      L`).concat(d.leftX," ").concat(d.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var n=this.getAppendAttributes(t),i=n.d,o=n.strokeWidth,s=n.fill,l=n.strokeDasharray,d=n.stroke;return ke(Ol,{d:i,fill:s,strokeWidth:o,stroke:d,strokeDasharray:l})},e.prototype.getAppendWidth=function(){for(var t=this,n=this.props,i=n.model,o=n.graphModel,s=i.pointsList,l=i.draggable,d=[],c=s.length,f=function(y){var b="lf-polyline-append",_={start:{x:s[y].x,y:s[y].y},end:{x:s[y+1].x,y:s[y+1].y},startIndex:y,endIndex:y+1,direction:vn.HORIZONTAL,draggable:!0},x=ke("g",{className:b,children:v.getAppendShape(_)}),w=o.editConfigModel,C=w.adjustEdge,k=w.adjustEdgeMiddle;if(C&&l){var D=_.startIndex,I=_.endIndex,$=k&&(D===0||I===c-1);_.draggable=!$,_.start.x===_.end.x?(_.draggable&&(b+="-ew-resize"),_.direction=vn.VERTICAL):_.start.y===_.end.y&&(_.draggable&&(b+="-ns-resize"),_.direction=vn.HORIZONTAL),x=ke("g",{className:v.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(R){return t.beforeDragStart(R,_)},children:ke("g",{className:b,children:v.getAppendShape(_)})})}d.push(x)},v=this,g=0;g<c-1;g++)f(g);return ke("g",{children:d})},e}(uc),Ha=function(){return Ha=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ha.apply(this,arguments)},t4=function(){function r(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(Ha(Ha({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(i.preventDefault(),t.fakeNode){var o=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),s=o.x,l=o.y;t.fakeNode.moveTo(s,l);var d=t.fakeNode.getData();t.lf.setNodeSnapLine(d),t.lf.graphModel.eventCenter.emit(yt.NODE_DND_DRAG,{data:d,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(Ha(Ha({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),yt.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var n=e.lf;this.lf=n}return r.prototype.clientToLocalPoint=function(e){var t=e.x,n=e.y,i=jl(this.lf.options,["grid","size"]),o=this.lf.graphModel.getPointByClient({x:t,y:n}),s=o.canvasOverlayPosition,l=s.x,d=s.y,c=this.lf.graphModel.editConfigModel.snapGrid;return{x:es(l,i,c),y:es(d,i,c)}},r.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},r.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},r}();function n4(r,e){r.on("node:mousemove",function(t){var n=t.data;e.setNodeSnapLine(n)}),r.on("node:mouseup",function(){e.clearSnapline()})}var r4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zi=function(){return Zi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Zi.apply(this,arguments)},i4=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},o4=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},a4=function(r){r4(e,r);function e(t){var n=r.call(this,t)||this;return n.ref=tc(),n.__prevText={type:"",text:"",id:""},n.keyupHandler=function(i){var o=n.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(o==null||o.setElementState(Yt.DEFAULT))},n.inputHandler=function(i){var o=i.target.innerText,s=n.props.graphModel.textEditElement;s&&(n.__prevText={type:s.type,text:o.replace(/(\r\n)+$|(\n)+$/,""),id:s.id})},n.keydownHandler=function(i){i.stopPropagation()},n.state={style:{left:0,top:0}},n}return e.getDerivedStateFromProps=function(t){var n,i=t.textEditElement,o=t.graphModel,s=o.transformModel,l=o.theme,d=l.inputText,c;if(i){if(!(!((n=i.text)===null||n===void 0)&&n.value)&&i.BaseType===xn.EDGE){var f=i.text,v=i.textPosition,g=v.x,y=v.y;f.x=g,f.y=y,i.setText(f)}var b={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===xn.EDGE){var _=l.edgeText,x=_.overflowMode,w=_.lineHeight,C=_.wrapPadding,k=_.textWidth;k&&x==="autoWrap"&&(c=Zi(Zi({},b),{width:k,minWidth:k,lineHeight:w,padding:C}))}else if(i.BaseType===xn.NODE){var D=l.nodeText,x=D.overflowMode,w=D.lineHeight,C=D.wrapPadding,k=D.textWidth,I=i.width,$=i.modelType,R=i.textWidth,F=R||k||I;($!==Ht.TEXT_NODE&&x==="autoWrap"||$===Ht.TEXT_NODE&&k)&&(c=Zi(Zi({},b),{width:F,minWidth:F,lineHeight:w,padding:C}))}var z=i.text,ie=z.x,G=z.y,Q=o4(s.CanvasPointToHtmlPoint([ie,G]),2),T=Q[0],W=Q[1];return{style:Zi(Zi({left:T,top:W},c),d)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var n=this.__prevText,i=n.text,o=n.id;t.updateText(o,i),t.eventCenter.emit(yt.TEXT_UPDATE,{data:Zi({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(n)}},e.prototype.render=function(){var t,n=this.props.graphModel.textEditElement,i=this.state.style;return n?ke("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=n.text)===null||t===void 0?void 0:t.value},n.id):null},e.toolName="text-edit-tool",e=i4([xr],e),e}(Wt),s4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),l4=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},xf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},u4=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},d4=function(r){s4(e,r);function e(t){var n=r.call(this,t)||this;n.handleMouseDown=function(l){n.stepDrag.handleMouseDown(l)},n.handleWheelEvent=function(l){var d,c;l.preventDefault();var f=l.deltaX,v=l.deltaY,g=l.clientX,y=l.clientY,b=l.ctrlKey,_=new WheelEvent("wheel",{deltaX:f,deltaY:v,clientX:g,clientY:y,ctrlKey:b});(c=(d=n.props.lf.container)===null||d===void 0?void 0:d.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||c===void 0||c.dispatchEvent(_)},n.onDragging=function(l){var d=l.deltaX,c=l.deltaY,f=n.props,v=f.graphModel,g=f.lf,y=g.getTransform(),b=y.SCALE_X,_=y.SCALE_Y,x=v.getSelectElements(!0);v.moveNodes(x.nodes.map(function(w){return w.id}),d/b,c/_)},n.handleContextMenu=function(l){l.preventDefault();var d=n.props,c=d.graphModel,f=d.graphModel,v=f.eventCenter,g=f.selectElements,y=c.getPointByClient({x:l.clientX,y:l.clientY}),b={nodes:[],edges:[]},_=u4([],xf(g.values()),!1);_.forEach(function(x){x.BaseType===xn.NODE&&b.nodes.push(x.getData()),x.BaseType===xn.EDGE&&b.edges.push(x.getData())}),v.emit(yt.SELECTION_CONTEXTMENU,{data:b,e:l,position:y})};var i=t.graphModel,o=i.gridSize,s=i.eventCenter;return n.stepDrag=new oi({onDragging:n.onDragging,step:o,eventType:"SELECTION",eventCenter:s}),n}return e.prototype.render=function(){var t,n,i=this.props.graphModel,o=i.selectElements,s=i.transformModel,l=this.props.lf.getTransform(),d=l.SCALE_X,c=l.SCALE_Y;if(!(o.size<=1)){var f=Number.MAX_SAFE_INTEGER,v=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER;o.forEach(function(_){var x;_.BaseType===xn.NODE&&(x=JR(_)),_.BaseType===xn.EDGE&&(x=t3(_)),x!==void 0&&(f=Math.min(f,x.x),v=Math.min(v,x.y),g=Math.max(g,x.x1),y=Math.max(y,x.y1))}),t=xf(s.CanvasPointToHtmlPoint([f,v]),2),f=t[0],v=t[1],n=xf(s.CanvasPointToHtmlPoint([g,y]),2),g=n[0],y=n[1];var b={left:"".concat(f-20*d/2,"px"),top:"".concat(v-20*c/2,"px"),width:"".concat(g-f+20*d,"px"),height:"".concat(y-v+20*c,"px"),"border-width":"".concat(2*d,"px")};return ke("div",{className:"lf-multiple-select",style:b,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=l4([xr],e),e}(Wt),wf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},c4=[a4,d4],f4=function(){function r(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,on(c4,function(o){t.isDisabled(o.toolName)||t.registerTool(o.toolName,o)});var n=e.graphModel,i=n.eventCenter;i.on("".concat(yt.GRAPH_TRANSFORM,",").concat(yt.NODE_CLICK,",").concat(yt.BLANK_CLICK," "),function(){var o,s=n.textEditElement,l=n.editConfigModel,d=l.edgeTextEdit,c=l.nodeTextEdit;(d||c)&&s&&((o=n.textEditElement)===null||o===void 0||o.setElementState(Yt.DEFAULT))})}return r.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},r.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},r.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},r.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},r.prototype.getTools=function(){return Array.from(this.toolMap.values())},r.prototype.getInstance=function(){return this.instance},r.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},wf([Me],r.prototype,"toolMap",void 0),wf([Oe],r.prototype,"disableTool",null),wf([Oe],r.prototype,"enableTool",null),r}();function h4(r){throw new Error("[mobx-utils] "+r)}function Md(r,e){e===void 0&&(e="Illegal state"),r||h4(e)}var vw=function(r){return r&&r!==Object.prototype&&Object.getOwnPropertyNames(r).concat(vw(Object.getPrototypeOf(r))||[])},p4=function(r){var e=vw(r),t=e.filter(function(n,i){return e.indexOf(n)===i});return t},v4=function(r){return p4(r).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},gw="pending",Ad="fulfilled",sp="rejected";function g4(r){switch(this.state){case gw:return r.pending&&r.pending(this.value);case sp:return r.rejected&&r.rejected(this.value);case Ad:return r.fulfilled?r.fulfilled(this.value):this.value}}function Jm(r,e){if(Md(arguments.length<=2,"fromPromise expects up to two arguments"),Md(typeof r=="function"||typeof r=="object"&&r&&typeof r.then=="function","Please pass a promise or function to fromPromise"),r.isPromiseBasedObservable===!0)return r;typeof r=="function"&&(r=new Promise(r));var t=r;r.then(Oe("observableFromPromise-resolve",function(i){t.value=i,t.state=Ad}),Oe("observableFromPromise-reject",function(i){t.value=i,t.state=sp})),t.isPromiseBasedObservable=!0,t.case=g4;var n=e&&e.state===Ad?e.value:void 0;return Xf(t,{value:n,state:gw},{},{deep:!1}),t}(function(r){r.reject=Oe("fromPromise.reject",function(t){var n=r(Promise.reject(t));return n.state=sp,n.value=t,n});function e(t){t===void 0&&(t=void 0);var n=r(Promise.resolve(t));return n.state=Ad,n.value=t,n}r.resolve=Oe("fromPromise.resolve",e)})(Jm||(Jm={}));var Wu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o};(function(){function r(e,t){var n=this;XP(function(){n.current=t,n.subscription=e.subscribe(n)})}return r.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},r.prototype.next=function(e){this.current=e},r.prototype.complete=function(){this.dispose()},r.prototype.error=function(e){this.current=e,this.dispose()},Wu([Me.ref],r.prototype,"current",void 0),Wu([Oe.bound],r.prototype,"next",null),Wu([Oe.bound],r.prototype,"complete",null),Wu([Oe.bound],r.prototype,"error",null),r})();var Td=function(){return Td=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Td.apply(this,arguments)},Ks=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},m4=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function r(e){var t=this;this.model=e,this.localValues=Me.map({}),this.localComputedValues=Me.map({}),this.isPropertyDirty=function(n){return t.localValues.has(n)},Md(ki(e),"createViewModel expects an observable object"),v4(e).forEach(function(n){if(!(n===Dt||n==="__mobxDidRunLazyInitializers")){if(Md(m4.indexOf(n)===-1,"The propertyname "+n+" is reserved and cannot be used with viewModels"),jg(e,n)){var i=ac(e,n).derivation;t.localComputedValues.set(n,un(i.bind(t)))}var o=Object.getOwnPropertyDescriptor(e,n),s=o?{enumerable:o.enumerable}:{};Object.defineProperty(t,n,Td(Td({},s),{configurable:!0,get:function(){return jg(e,n)?t.localComputedValues.get(n).get():t.isPropertyDirty(n)?t.localValues.get(n):t.model[n]},set:Oe(function(l){l!==t.model[n]?t.localValues.set(n,l):t.localValues.delete(n)})}))}})}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),r.prototype.submit=function(){var e=this;Qa(this.localValues).forEach(function(t){var n=e.localValues.get(t),i=e.model[t];Vi(i)?i.replace(n):Ir(i)?(i.clear(),i.merge(n)):QP(n)||(e.model[t]=n)}),this.localValues.clear()},r.prototype.reset=function(){this.localValues.clear()},r.prototype.resetProperty=function(e){this.localValues.delete(e)},Ks([un],r.prototype,"isDirty",null),Ks([un],r.prototype,"changedValues",null),Ks([Oe.bound],r.prototype,"submit",null),Ks([Oe.bound],r.prototype,"reset",null),Ks([Oe.bound],r.prototype,"resetProperty",null),r})();function Sf(r){if(!r)return"ROOT";for(var e=[];r.parent;)e.push(r.path),r=r.parent;return e.reverse().join("/")}function Ef(r){return ki(r)||Vi(r)||Ir(r)}function y4(r,e){var t=new WeakMap;function n(l){var d=t.get(l.object);i(l,d),e(l,Sf(d),r)}function i(l,d){switch(l.type){case"add":o(l.newValue,d,l.name);break;case"update":s(l.oldValue),o(l.newValue,d,l.name||""+l.index);break;case"remove":case"delete":s(l.oldValue);break;case"splice":l.removed.map(s),l.added.forEach(function(v,g){return o(v,d,""+(l.index+g))});for(var c=l.index+l.addedCount;c<l.object.length;c++)if(Ef(l.object[c])){var f=t.get(l.object[c]);f&&(f.path=""+c)}break}}function o(l,d,c){if(Ef(l)){var f=t.get(l);if(f){if(f.parent!==d||f.path!==c)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Sf(d)+"/"+c+"',")+(" but it already exists at '"+Sf(f.parent)+"/"+f.path+"'"))}else{var v={parent:d,path:c,dispose:H1(l,n)};t.set(l,v),nR(l).forEach(function(g){var y=g[0],b=g[1];return o(b,v,y)})}}}function s(l){if(Ef(l)){var d=t.get(l);if(!d)return;t.delete(l),d.dispose(),tR(l).forEach(s)}}return o(r,void 0,""),function(){s(r)}}var _4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){_4(e,r);function e(t,n,i){var o=i===void 0?{}:i,s=o.name,l=s===void 0?"ogm"+(Math.random()*1e3|0):s,d=o.keyToName,c=d===void 0?function(g){return""+g}:d,f=r.call(this)||this;f._keyToName=c,f._groupBy=n,f._ogmInfoKey=Symbol("ogmInfo"+l),f._base=t;for(var v=0;v<t.length;v++)f._addItem(t[v]);return f._disposeBaseObserver=H1(f._base,function(g){if(g.type==="splice")gi(function(){for(var y=0,b=g.removed;y<b.length;y++){var _=b[y];f._removeItem(_)}for(var x=0,w=g.added;x<w.length;x++){var C=w[x];f._addItem(C)}});else if(g.type==="update")gi(function(){f._removeItem(g.oldValue),f._addItem(g.newValue)});else throw new Error("illegal state")}),f}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,n){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var n=this._base[t],i=n[this._ogmInfoKey];i.reaction(),delete n[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var n=r.prototype.get.call(this,t);return n===void 0&&(n=Me([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),r.prototype.set.call(this,t,n)),n},e.prototype._removeFromGroupArr=function(t,n){var i=r.prototype.get.call(this,t);i.length===1?r.prototype.delete.call(this,t):(n===i.length-1||(i[n]=i[i.length-1],i[n][this._ogmInfoKey].groupArrIndex=n),i.length--)},e.prototype._addItem=function(t){var n=this,i=this._groupBy(t),o=this._getGroupArr(i),s={groupByValue:i,groupArrIndex:o.length,reaction:D1(function(){return n._groupBy(t)},function(l,d){var c=t[n._ogmInfoKey];n._removeFromGroupArr(c.groupByValue,c.groupArrIndex);var f=n._getGroupArr(l),v=f.length;f.push(t),c.groupByValue=l,c.groupArrIndex=v})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:s}),o.push(t)},e.prototype._removeItem=function(t){var n=t[this._ogmInfoKey];this._removeFromGroupArr(n.groupByValue,n.groupArrIndex),n.reaction(),delete t[this._ogmInfoKey]},e})(ep);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var Eh=function(){return Eh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Eh.apply(this,arguments)},b4=function(){function r(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return r.prototype.add=function(e){dg(bC(this.undos),e)||(this.undos.push(e),dg(this.curData,e)||(this.redos=[]),this.eventCenter.emit(yt.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},r.prototype.undoAble=function(){return this.undos.length>1},r.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Lt(t),t}},r.prototype.redoAble=function(){return this.redos.length>0},r.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Lt(e),e}},r.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=y4(e,e_(function(){var n=e.modelToHistoryData();n&&t.add(Eh({},n))},this.waitTime))},r.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},r}(),Cf={exports:{}},Zm;function x4(){return Zm||(Zm=1,function(r){(function(e,t,n){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d,c=1;c<20;++c)i[111+c]="f"+c;for(c=0;c<=9;++c)i[c+96]=c.toString();function f(R,F,z){if(R.addEventListener){R.addEventListener(F,z,!1);return}R.attachEvent("on"+F,z)}function v(R){if(R.type=="keypress"){var F=String.fromCharCode(R.which);return R.shiftKey||(F=F.toLowerCase()),F}return i[R.which]?i[R.which]:o[R.which]?o[R.which]:String.fromCharCode(R.which).toLowerCase()}function g(R,F){return R.sort().join(",")===F.sort().join(",")}function y(R){var F=[];return R.shiftKey&&F.push("shift"),R.altKey&&F.push("alt"),R.ctrlKey&&F.push("ctrl"),R.metaKey&&F.push("meta"),F}function b(R){if(R.preventDefault){R.preventDefault();return}R.returnValue=!1}function _(R){if(R.stopPropagation){R.stopPropagation();return}R.cancelBubble=!0}function x(R){return R=="shift"||R=="ctrl"||R=="alt"||R=="meta"}function w(){if(!d){d={};for(var R in i)R>95&&R<112||i.hasOwnProperty(R)&&(d[i[R]]=R)}return d}function C(R,F,z){return z||(z=w()[R]?"keydown":"keypress"),z=="keypress"&&F.length&&(z="keydown"),z}function k(R){return R==="+"?["+"]:(R=R.replace(/\+{2}/g,"+plus"),R.split("+"))}function D(R,F){var z,ie,G,Q=[];for(z=k(R),G=0;G<z.length;++G)ie=z[G],l[ie]&&(ie=l[ie]),F&&F!="keypress"&&s[ie]&&(ie=s[ie],Q.push("shift")),x(ie)&&Q.push(ie);return F=C(ie,Q,F),{key:ie,modifiers:Q,action:F}}function I(R,F){return R===null||R===t?!1:R===F?!0:I(R.parentNode,F)}function $(R){var F=this;if(R=R||t,!(F instanceof $))return new $(R);F.target=R,F._callbacks={},F._directMap={};var z={},ie,G=!1,Q=!1,T=!1;function W(ae){ae=ae||{};var Re=!1,Le;for(Le in z){if(ae[Le]){Re=!0;continue}z[Le]=0}Re||(T=!1)}function P(ae,Re,Le,Ve,Ae,te){var ce,_e,Ie=[],Ke=Le.type;if(!F._callbacks[ae])return[];for(Ke=="keyup"&&x(ae)&&(Re=[ae]),ce=0;ce<F._callbacks[ae].length;++ce)if(_e=F._callbacks[ae][ce],!(!Ve&&_e.seq&&z[_e.seq]!=_e.level)&&Ke==_e.action&&(Ke=="keypress"&&!Le.metaKey&&!Le.ctrlKey||g(Re,_e.modifiers))){var $e=!Ve&&_e.combo==Ae,Ue=Ve&&_e.seq==Ve&&_e.level==te;($e||Ue)&&F._callbacks[ae].splice(ce,1),Ie.push(_e)}return Ie}function le(ae,Re,Le,Ve){F.stopCallback(Re,Re.target||Re.srcElement,Le,Ve)||ae(Re,Le)===!1&&(b(Re),_(Re))}F._handleKey=function(ae,Re,Le){var Ve=P(ae,Re,Le),Ae,te={},ce=0,_e=!1;for(Ae=0;Ae<Ve.length;++Ae)Ve[Ae].seq&&(ce=Math.max(ce,Ve[Ae].level));for(Ae=0;Ae<Ve.length;++Ae){if(Ve[Ae].seq){if(Ve[Ae].level!=ce)continue;_e=!0,te[Ve[Ae].seq]=1,le(Ve[Ae].callback,Le,Ve[Ae].combo,Ve[Ae].seq);continue}_e||le(Ve[Ae].callback,Le,Ve[Ae].combo)}var Ie=Le.type=="keypress"&&Q;Le.type==T&&!x(ae)&&!Ie&&W(te),Q=_e&&Le.type=="keydown"};function me(ae){typeof ae.which!="number"&&(ae.which=ae.keyCode);var Re=v(ae);if(Re){if(ae.type=="keyup"&&G===Re){G=!1;return}F.handleKey(Re,y(ae),ae)}}function he(){clearTimeout(ie),ie=setTimeout(W,1e3)}function Ne(ae,Re,Le,Ve){z[ae]=0;function Ae(Ke){return function(){T=Ke,++z[ae],he()}}function te(Ke){le(Le,Ke,ae),Ve!=="keyup"&&(G=v(Ke)),setTimeout(W,10)}for(var ce=0;ce<Re.length;++ce){var _e=ce+1===Re.length,Ie=_e?te:Ae(Ve||D(Re[ce+1]).action);ye(Re[ce],Ie,Ve,ae,ce)}}function ye(ae,Re,Le,Ve,Ae){F._directMap[ae+":"+Le]=Re,ae=ae.replace(/\s+/g," ");var te=ae.split(" "),ce;if(te.length>1){Ne(ae,te,Re,Le);return}ce=D(ae,Le),F._callbacks[ce.key]=F._callbacks[ce.key]||[],P(ce.key,ce.modifiers,{type:ce.action},Ve,ae,Ae),F._callbacks[ce.key][Ve?"unshift":"push"]({callback:Re,modifiers:ce.modifiers,action:ce.action,seq:Ve,level:Ae,combo:ae})}F._bindMultiple=function(ae,Re,Le){for(var Ve=0;Ve<ae.length;++Ve)ye(ae[Ve],Re,Le)},f(R,"keypress",me),f(R,"keydown",me),f(R,"keyup",me)}$.prototype.bind=function(R,F,z){var ie=this;return R=R instanceof Array?R:[R],ie._bindMultiple.call(ie,R,F,z),ie},$.prototype.unbind=function(R,F){var z=this;return z.bind.call(z,R,function(){},F)},$.prototype.trigger=function(R,F){var z=this;return z._directMap[R+":"+F]&&z._directMap[R+":"+F]({},R),z},$.prototype.reset=function(){var R=this;return R._callbacks={},R._directMap={},R},$.prototype.stopCallback=function(R,F){var z=this;if((" "+F.className+" ").indexOf(" mousetrap ")>-1||I(F,z.target))return!1;if("composedPath"in R&&typeof R.composedPath=="function"){var ie=R.composedPath()[0];ie!==R.target&&(F=ie)}return F.tagName=="INPUT"||F.tagName=="SELECT"||F.tagName=="TEXTAREA"||F.isContentEditable},$.prototype.handleKey=function(){var R=this;return R._handleKey.apply(R,arguments)},$.addKeycodes=function(R){for(var F in R)R.hasOwnProperty(F)&&(i[F]=R[F]);d=null},$.init=function(){var R=$(t);for(var F in R)F.charAt(0)!=="_"&&($[F]=function(z){return function(){return R[z].apply(R,arguments)}}(F))},$.init(),e.Mousetrap=$,r.exports&&(r.exports=$)})(typeof window<"u"?window:null,typeof window<"u"?document:null)}(Cf)),Cf.exports}var w4=x4();const S4=ls(w4);var Di=null;function Qm(r,e){return r.x+=e,r.y+=e,t_(r.text)||(r.text.x+=e,r.text.y+=e),r}function ey(r,e){return r.startPoint&&(r.startPoint.x+=e,r.startPoint.y+=e),r.endPoint&&(r.endPoint.x+=e,r.endPoint.y+=e),r.pointsList&&r.pointsList.length>0&&r.pointsList.forEach(function(t){t.x+=e,t.y+=e}),t_(r.text)||(r.text.x+=e,r.text.y+=e),r}var La=40,Uu=40;function E4(r,e){var t=r.keyboard,n=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Uu=La,!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=r.options.guards,o=e.getSelectElements(!1),s=i&&i.beforeClone?i.beforeClone(o):!0;return!s||o.nodes.length===0&&o.edges.length===0?(Di=null,!0):(Di=o,Di.nodes.forEach(function(l){return Qm(l,La)}),Di.edges.forEach(function(l){return ey(l,La)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;if(Di&&(Di.nodes||Di.edges)){r.clearSelectElements();var i=r.addElements(Di,Uu);if(!i)return!0;i.nodes.forEach(function(o){return r.selectElementById(o.id,!0)}),i.edges.forEach(function(o){return r.selectElementById(o.id,!0)}),Di.nodes.forEach(function(o){return Qm(o,La)}),Di.edges.forEach(function(o){return ey(o,La)}),Uu=Uu+La}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.redo(),!1)}),t.on(["backspace"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return r.clearSelectElements(),i.edges.forEach(function(o){return o.id&&r.deleteEdge(o.id)}),i.nodes.forEach(function(o){return o.id&&r.deleteNode(o.id)}),!1})}var C4=function(){function r(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new S4(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return r.prototype.initShortcuts=function(){var e=this,t,n=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(n)if(n_(n))n.forEach(function(l){var d=l.keys,c=l.callback,f=l.action;return e.on(d,c,f)});else{var i=n.keys,o=n.callback,s=n.action;this.on(i,o,s)}},r.prototype.on=function(e,t,n){this.mousetrap.bind(this.getKeys(e),t,n)},Object.defineProperty(r.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),r.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},r.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},r.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},r.prototype.destroy=function(){this.mousetrap.reset()},r.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(n){return t.formatKey(n)})},r.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},r}(),_o=function(){return _o=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},_o.apply(this,arguments)},Vu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Of=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},kf=Symbol("plugin registered by Logicflow.use"),Ch=function(){function r(e){var t=this,n;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(c,f){return t.viewMap.set(c,f)},this.getView=function(c){return t.viewMap.get(c)};var i=xl.get(e),o=i.container,s=i.width,l=i.height;this.options=i,this.container=this.initContainer(o,s,l),this.graphModel=new h8(_o(_o({},i),{container:this.container})),this.plugins=(n=i.plugins)!==null&&n!==void 0?n:[];var d=this.graphModel.eventCenter;this.tool=new f4(this),this.dnd=new t4({lf:this}),this.history=new b4(d),this.keyboard=new C4({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new p8(this.graphModel),n4(d,this.snaplineModel)),i.isSilentMode||(E4(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return r.prototype.initContainer=function(e,t,n){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=n?"".concat(n,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return r.toStringTag},enumerable:!1,configurable:!0}),r.prototype.register=function(e,t,n){if(n===void 0&&(n=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:uc,BaseEdgeModel:lc,BaseNode:Ao,BaseNodeModel:Mo,RectNode:ia,RectNodeModel:is,CircleNode:Od,CircleNodeModel:Sd,PolygonNode:Nd,PolygonNodeModel:Ed,TextNode:Gm,TextNodeModel:Um,LineEdge:Km,LineEdgeModel:$m,DiamondNode:mh,DiamondNodeModel:lh,PolylineEdge:os,PolylineEdgeModel:rs,BezierEdge:qm,BezierEdgeModel:jm,EllipseNode:_h,EllipseNodeModel:uh,HtmlNode:Ll,HtmlNodeModel:Tl,h:vt,type:e};if(this.viewMap.forEach(function(c){var f=c.extendKey;f&&(i[f]=c)}),this.graphModel.modelMap.forEach(function(c){var f=c.extendKey;f&&(i[f]=c)}),t){var o=t(i),s=o.view,l=o.model,d=s;n&&!d.isObserved&&(d.isObserved=!0,d=xr(d)),this.setView(e,d),this.graphModel.setModel(e,l)}},r.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=xr(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},r.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),on(e,function(n){t.registerElement(n)})},r.prototype.defaultRegister=function(){var e=[{type:"rect",view:ia,model:is},{type:"circle",view:Od,model:Sd},{type:"polygon",view:Nd,model:Ed},{type:"text",view:Gm,model:Um},{type:"ellipse",view:_h,model:uh},{type:"diamond",view:mh,model:lh},{type:"html",view:Ll,model:Tl},{type:"line",view:Km,model:$m},{type:"polyline",view:os,model:rs},{type:"bezier",view:qm,model:jm}];this.batchRegister(e)},r.prototype.addNode=function(e,t,n){return t===void 0&&(t=yt.NODE_ADD),this.graphModel.addNode(e,t,n)},r.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteNode(e),o},r.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){var i=this.options.guards,o=i!=null&&i.beforeClone?i.beforeClone(n):!0;if(o)return this.graphModel.cloneNode(e)}},r.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},r.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},r.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},r.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},r.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},r.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},r.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},r.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},r.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var n=new t(_o(_o({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(n),n},r.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},r.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},r.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},r.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},r.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},r.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},r.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},r.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,n=e.targetNodeId,i=[],o=this.graphModel.edges;return t&&n?on(o,function(s){s.sourceNodeId===t&&s.targetNodeId===n&&i.push(s)}):t?on(o,function(s){s.sourceNodeId===t&&i.push(s)}):n&&on(o,function(s){s.targetNodeId===n&&i.push(s)}),i},r.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},r.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},r.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteEdgeById(e),o},r.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,n=e.targetNodeId;t&&n?this.graphModel.deleteEdgeBySourceAndTarget(t,n):t?this.graphModel.deleteEdgeBySource(t):n&&this.graphModel.deleteEdgeByTarget(n)},r.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},r.prototype.addElements=function(e,t){var n=this,i=e.nodes,o=e.edges;t===void 0&&(t=40);var s={},l={nodes:[],edges:[]};return on(i,function(d){var c=d.id,f=n.addNode(d);c&&(s[c]=f.id),l.nodes.push(f)}),on(o,function(d){var c=d.sourceNodeId,f=d.targetNodeId;s[c]&&(c=s[c]),s[f]&&(f=s[f]);var v=n.graphModel.addEdge(_o(_o({},d),{sourceNodeId:c,targetNodeId:f}));l.edges.push(v)}),l},r.prototype.selectElementById=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),this.graphModel.selectElementById(e,t),!t&&n&&this.graphModel.toFront(e)},r.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},r.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},r.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},r.prototype.getModelById=function(e){return this.graphModel.getElement(e)},r.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},r.prototype.deleteElement=function(e){var t,n,i,o=this.getModelById(e);if(!o)return!1;var s=(t={},t[xn.NODE]=this.deleteNode,t[xn.EDGE]=this.deleteEdge,t);return(i=(n=s[o.BaseType])===null||n===void 0?void 0:n.call(this,e))!==null&&i!==void 0?i:!1},r.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},r.prototype.getAreaElement=function(e,t,n,i,o){return n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1),this.graphModel.getAreaElement(e,t,n,i,o).map(function(s){return s.getData()})},r.prototype.setProperties=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.setProperties(dr(t))},r.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},r.prototype.deleteProperty=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.deleteProperty(t)},r.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},r.prototype.editText=function(e){this.graphModel.editText(e)},r.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},r.prototype.updateEditConfig=function(e){var t=this.graphModel,n=t.editConfigModel,i=t.transformModel,o=n.snapGrid;if(n.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!br(e==null?void 0:e.snapGrid)&&e.snapGrid!==o){var s=this.graphModel.grid.size,l=s===void 0?1:s;this.graphModel.updateGridSize(e.snapGrid?l:1)}},r.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},r.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},r.prototype.getTheme=function(){return this.graphModel.getTheme()},r.prototype.focusByElement=function(e){var t=void 0,n=this.getNodeModelById(e);if(n){var i=n.getData(),o=i.x,s=i.y;t={x:o,y:s}}var l=this.getEdgeModelById(e);if(l){var d=l.textPosition,o=d.x,s=d.y;t={x:o,y:s}}t&&this.focusByCoordinate(t)},r.prototype.focusByCoordinate=function(e){var t=this.graphModel,n=t.transformModel,i=t.width,o=t.height,s=e.x,l=e.y;n.focusOn(s,l,i,o)},r.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,n=e.coordinate;t&&this.focusByElement(t),n&&this.focusByCoordinate(n)}},r.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},r.prototype.toFront=function(e){this.graphModel.toFront(e)},r.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},r.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Of([n],Vu(e),!1)):n},r.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},r.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},r.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(dr(e)),this.options.history!==!1&&this.history.watch(this.graphModel),cm(ke(x8,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(yt.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},r.prototype.render=function(e){var t=Lt(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},r.prototype.undo=function(){if(this.history.undoAble()){var e=dr(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.redo=function(){if(this.history.redoAble()){var e=dr(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.zoom=function(e,t){var n=this.graphModel.transformModel;return n.zoom(e,t)},r.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},r.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},r.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},r.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,n=e.SCALE_Y,i=e.TRANSLATE_X,o=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:n,TRANSLATE_X:i,TRANSLATE_Y:o}},r.prototype.translate=function(e,t){var n=this.graphModel.transformModel;n.translate(e,t)},r.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,n=e.TRANSLATE_Y;this.translate(-t,-n)},r.prototype.translateCenter=function(){this.graphModel.translateCenter()},r.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},r.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},r.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},r.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},r.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},r.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},r.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},r.use=function(e,t){var n,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(n={},n[kf]=kf,n.extension=e,n.props=t,n))},r.addThemeMode=function(e,t){mI(e,t)},r.removeThemeMode=function(e){yI(e)},r.clearThemeMode=function(){Bm()},r.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var n=Array.from(r.extensions,function(o){var s=Vu(o,2),l=s[1];return l}),i=Of(Of([],Vu(this.plugins),!1),Vu(n),!1);on(i,function(o){var s,l;kf in o?(s=o.extension,l=o.props):s=o;var d=s==null?void 0:s.pluginName;xC(e,d)===-1&&t.installPlugin(s,l)})},r.prototype.installPlugin=function(e,t){var n,i;if("pluginName"in e&&"install"in e){var o=e.pluginName,s=e.install,l=e.render;o&&(s&&s.call(e,this,r),l&&this.components.push(l.bind(e)),this.extension[o]=e);return}var d=e,c=d.pluginName,f=new d({lf:this,LogicFlow:r,props:t,options:(i=(n=this.options.pluginsOptions)===null||n===void 0?void 0:n[c])!==null&&i!==void 0?i:{}});f.render&&this.components.push(f.render.bind(f)),this.extension[c]=f},r.prototype.destroy=function(){var e;this.clearData(),cm(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Bm();for(var t in this.extension){var n=this.extension[t];"destroy"in n&&((e=n.destroy)===null||e===void 0||e.call(n))}},r.extensions=new Map,r}();(function(r){r.toStringTag="LF.".concat(r.name)})(Ch||(Ch={}));const O4=Ch;function xr(r){return np(r)}var ty={width:40,height:40},ny={width:40,height:40},ry={width:40,height:40},iy={width:100,height:80},oy={width:100,height:80},k4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),N4=(globalThis==null?void 0:globalThis._ids)||new k4;function bs(){return N4.next()}var mw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){mw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(bs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=r.prototype.getConnectedTargetRules.call(this),n={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(n),t},e.extendKey="StartEventModel",e})(Sd);(function(r){mw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(Od);var yw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dd=function(){return Dd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dd.apply(this,arguments)};(function(r){yw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(bs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=r.prototype.getConnectedSourceRules.call(this),n={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(n),t},e.extendKey="EndEventModel",e})(Sd);(function(r){yw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle(),i=t,o=i.x,s=i.y,l=i.r,d=r.prototype.getShape.call(this);return vt("g",{},d,vt("circle",Dd(Dd({},n),{cx:o,cy:s,r:l-5})))},e.extendKey="EndEventView",e})(Od);var _w=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){_w(e,r);function e(t,n){return t.id||(t.id="Flow_".concat(bs())),r.call(this,t,n)||this}return e.extendKey="SequenceFlowModel",e})(rs);(function(r){_w(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(os);var bw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vl=function(){return vl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vl.apply(this,arguments)};(function(r){bw(e,r);function e(t,n){var i=this;return t.id||(t.id="Gateway_".concat(bs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=r.call(this,t,n)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(Ed);(function(r){bw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points,c=t.getNodeStyle();return vt("g",{transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(o-l/2,")")},vt("polygon",vl(vl({},c),{x:i,y:o,points:d})),vt("path",vl({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},c)))},e.extendKey="ExclusiveGatewayNode",e})(Nd);var xw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Oh=function(){return Oh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Oh.apply(this,arguments)};(function(r){xw(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(bs())),r.call(this,t,n)||this}return e.extendKey="ServiceTaskModel",e})(is);(function(r){xw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getNodeStyle();return vt("svg",{x:n-o/2+5,y:i-s/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},vt("path",{fill:l.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.radius,d=t.getNodeStyle();return vt("g",{},[vt("rect",Oh({x:n-o/2,y:i-s/2,rx:l,ry:l,width:o,height:s},d)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(ia);var ww=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ld=function(){return Ld=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ld.apply(this,arguments)};(function(r){ww(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(bs())),r.call(this,t,n)||this}return e.extendKey="UserTaskModel",e})(is);(function(r){ww(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getNodeStyle();return vt("svg",{x:n-o/2+5,y:i-s/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},vt("path",{fill:l.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.radius,d=t.getNodeStyle();return vt("g",{},[vt("rect",Ld(Ld({},d),{x:n-o/2,y:i-s/2,rx:l,ry:l,width:o,height:s})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(ia);var M4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),A4=(globalThis==null?void 0:globalThis._ids)||new M4;function ay(){return A4.next()}function Sw(r){return Object.prototype.toString.call(r)}function T4(r){return"  ".repeat(r)}function Pd(r){var e=r;return Sw(r)==="[object Object]"?(e={},Object.keys(r).forEach(function(t){var n=t;t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=Pd(r[t])})):Array.isArray(r)&&(e=[],r.forEach(function(t,n){e[n]=Pd(t)})),e}function D4(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(Pd(r)).replace(/"/g,"'")}return e}var Wo=`	
`;function Qu(r,e,t){var n=T4(t);if(r!==0&&r!==!1&&!r)return Wo+n+"<".concat(e," />");var i="";if(e==="#text")return Wo+n+r;if(e==="#cdata-section")return Wo+n+"<![CDATA["+r+"]]>";if(e==="#comment")return Wo+n+"<!--"+r+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+D4(r)+'"';if(Array.isArray(r))r.forEach(function(d){i+=Qu(d,e,t+1)});else if(Sw(r)==="[object Object]"){var o=Object.keys(r),s="",l="";i+=(t===0?"":Wo+n)+"<"+e,o.forEach(function(d){d.charAt(0)==="-"?s+=Qu(r[d],d,t+1):l+=Qu(r[d],d,t+1)}),i+=s+(l!==""?">".concat(l).concat(Wo+n,"</").concat(e,">"):" />")}else i+=Wo+n+"<".concat(e,">").concat(r.toString(),"</").concat(e,">");return i}function L4(r){var e="";for(var t in r)e+=Qu(r[t],t,0);return e}var Er=function(){};Er.ObjTree=function(){return this};Er.ObjTree.VERSION="0.23";Er.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Er.ObjTree.prototype.attr_prefix="-";Er.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e)return this.parseDOM(e)};Er.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,s=t,l=n.onComplete;n.onComplete=function(f){var v;f&&f.responseXML&&f.responseXML.documentElement&&(v=o.parseDOM(f.responseXML.documentElement)),s(v,f),l&&l(f)}}else n.asynchronous=!1;var d;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var c=new HTTP.Request(n);c&&(d=c.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var c=new Ajax.Request(r,n);c&&(d=c.transport)}if(t)return d;if(d&&d.responseXML&&d.responseXML.documentElement)return this.parseDOM(d.responseXML.documentElement)};Er.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!=11){var n={};n[r.nodeName]=t,t=n}return t}};Er.ObjTree.prototype.parseElement=function(r){if(r.nodeType!=7){if(r.nodeType==3||r.nodeType==4||r.nodeType==8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var s=r.attributes[i].nodeValue;try{s=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=r.attributes[i].nodeValue}s&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var d=r.childNodes[i].nodeType;d==3||d==4||d==8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var s=this.parseElement(r.childNodes[i]);s&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}}else t===null&&(t={});return t}};Er.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t==1&&(r[e]=[]),r[e][r[e].length]=n):t==1?r[e]=n:t==2?r[e]=[r[e],n]:r[e][r[e].length]=n};Er.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};Er.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];i.charAt(0)!=this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<"+i+" />":typeof o=="object"&&o.constructor==Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" "+i.substring(1)+'="'+this.xml_escape(o)+'"'}var s=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<"+r+s+`>
`+l+"</"+r+`>
`:l="<"+r+s+">"+l+"</"+r+`>
`:l="<"+r+s+` />
`),l};Er.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<"+r+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};Er.ObjTree.prototype.scalar_to_xml=function(r,e){return r=="#text"?this.xml_escape(e):"<"+r+">"+this.xml_escape(e)+"</"+r+`>
`};Er.ObjTree.prototype.xml_escape=function(r){return r.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var P4=function(r){return new Er.ObjTree().parseXML(r)},R4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),kh=function(){return kh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},kh.apply(this,arguments)},dc=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Fi;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow"})(Fi||(Fi={}));var Ew=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],sy=["properties","startPoint","endPoint","pointsList"];function ly(r){var e=r?sy.concat(r):sy;return function(t){function n(i){var o={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(s){return n(s)}):(Object.entries(i).forEach(function(s){var l=dc(s,2),d=l[0],c=l[1];typeof c!="object"?d.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(d)?o[d]=c:o["-".concat(d)]=c:e.includes(d)?o["-".concat(d)]=n(c):o[d]=n(c)}),o)}return n(t)}}function Rd(r){var e={};return Object.entries(r).forEach(function(t){var n=dc(t,2),i=n[0],o=n[1];i.indexOf("-")===0?e[i.substring(1)]=Pd(o):typeof o=="string"?e[i]=o:Object.prototype.toString.call(o)==="[object Object]"?e[i]=Rd(o):Array.isArray(o)?e[i]=o.map(function(s){return Rd(s)}):e[i]=o}),e}function I4(r,e,t){var n=new Map;e.nodes.forEach(function(o){var s,l={"-id":o.id};if(!((s=o.text)===null||s===void 0)&&s.value&&(l["-name"]=o.text.value),o.properties){var d=ly(t)(o.properties);Object.assign(l,d)}n.set(o.id,l),r[o.type]?Array.isArray(r[o.type])?r[o.type].push(l):r[o.type]=[r[o.type],l]:r[o.type]=l});var i=e.edges.map(function(o){var s,l,d=n.get(o.targetNodeId);d["bpmn:incoming"]?Array.isArray(d["bpmn:incoming"])?d["bpmn:incoming"].push(o.id):d["bpmn:incoming"]=[d["bpmn:incoming"],o.id]:d["bpmn:incoming"]=o.id;var c={"-id":o.id,"-sourceRef":o.sourceNodeId,"-targetRef":o.targetNodeId};if(!((s=o.text)===null||s===void 0)&&s.value&&(c["-name"]=(l=o.text)===null||l===void 0?void 0:l.value),o.properties){var f=ly(t)(o.properties);Object.assign(c,f)}return c});e.edges.forEach(function(o){var s=n.get(o.sourceNodeId);s["bpmn:outgoing"]?Array.isArray(s["bpmn:outgoing"])?s["bpmn:outgoing"].push(o.id):s["bpmn:outgoing"]=[s["bpmn:outgoing"],o.id]:s["bpmn:outgoing"]=o.id}),r[Fi.FLOW]=i}function B4(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var d=l.x,c=l.y;return{"-x":d,"-y":c}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,s=80,l=t.x,d=t.y,c=To.shapeConfigMap.get(t.type);c&&(o=c.width,s=c.height),l-=o/2,d-=s/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":d,"-width":o,"-height":s}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}function j4(r){var e=[],t=[],n=r["bpmn:definitions"];if(n){var i=n["bpmn:process"];Object.keys(i).forEach(function(o){if(o.indexOf("bpmn:")===0){var s=i[o];if(o===Fi.FLOW){var l=n["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];t=$4(s,l)}else{var d=n["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];e=e.concat(H4(s,d,o))}}})}return{nodes:e,edges:t}}function H4(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(s){var l;Array.isArray(e)?l=e.find(function(c){return c["-bpmnElement"]===s["-id"]}):l=e;var d=uy(l,t,s);n.push(d)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===r["-id"]}):i=e;var o=uy(i,t,r);n.push(o)}return n}function uy(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=t["-name"],s=To.shapeConfigMap.get(e);s&&(n+=s.width/2,i+=s.height/2);var l;Object.entries(t).forEach(function(v){var g=dc(v,2),y=g[0],b=g[1];Ew.indexOf(y)===-1&&(l||(l={}),l[y]=b)}),l&&(l=Rd(l));var d;if(o&&(d={x:n,y:i,value:o},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var c=r["bpmndi:BPMNLabel"]["dc:Bounds"];d.x=Number(c["-x"])+Number(c["-width"])/2,d.y=Number(c["-y"])+Number(c["-height"])/2}var f={id:r["-bpmnElement"],type:e,x:n,y:i,properties:l};return d&&(f.text=d),f}function $4(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):o=e,t.push(dy(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(dy(n,r))}return t}function dy(r,e){var t,n=e["-name"]?"".concat(e["-name"]):"";if(n){var i=r["bpmndi:BPMNLabel"]["dc:Bounds"],o=0;n.split(`
`).forEach(function(d){o<d.length&&(o=d.length)}),t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7}}var s;Object.entries(e).forEach(function(d){var c=dc(d,2),f=c[0],v=c[1];Ew.indexOf(f)===-1&&(s||(s={}),s[f]=v)}),s&&(s=Rd(s));var l={id:e["-id"],type:Fi.FLOW,pointsList:r["di:waypoint"].map(function(d){return{x:Number(d["-x"]),y:Number(d["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(l.text=t),l}var To=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var s=kh({},n.processAttributes);I4(s,i,o);var l={"-id":"BPMNPlane_1","-bpmnElement":s["-id"]};B4(l,i);var d=n.definitionAttributes;d["bpmn:process"]=s,d["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":l};var c={"bpmn:definitions":d};return c},this.adapterIn=function(i){if(i)return j4(i)},t.adapterIn=function(i){return n.adapterIn(i)},t.adapterOut=function(i,o){return n.adapterOut(i,o)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(ay())},this.definitionAttributes={"-id":"Definitions_".concat(ay()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();To.shapeConfigMap.set(Fi.START,{width:ty.width,height:ty.height});To.shapeConfigMap.set(Fi.END,{width:ny.width,height:ny.height});To.shapeConfigMap.set(Fi.GATEWAY,{width:ry.width,height:ry.height});To.shapeConfigMap.set(Fi.SYSTEM,{width:iy.width,height:iy.height});To.shapeConfigMap.set(Fi.USER,{width:oy.width,height:oy.height});(function(r){R4(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(o){var s=P4(o);return n.adapterIn(s)},n.adapterXmlOut=function(o,s){var l=n.adapterOut(o,s);return L4(l)};var i=t.lf;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n}return e.pluginName="bpmnXmlAdapter",e})(To);var F4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var n=Math.random()*16|0,i=t==="x"?n:n&3|8;return i.toString(16)});return e},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),z4=(globalThis==null?void 0:globalThis._ids)||new F4;function W4(){return z4.next()}vt("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),vt("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),vt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});vt("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});vt("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var U4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ko=function(){return Ko=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ko.apply(this,arguments)},V4=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},X4=oi,G4=function(r){U4(e,r);function e(t){var n=r.call(this)||this;return n.updatePosition=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.x,c=l.y;n.nodeModel.x=d+o/2,n.nodeModel.y=c+s/2,n.nodeModel.moveText(o/2,s/2)},n.getResize=function(i){var o=i.index,s=i.deltaX,l=i.deltaY,d=i.width,c=i.height,f=i.PCTResizeInfo,v=i.pct,g=v===void 0?1:v,y=i.freezeWidth,b=y===void 0?!1:y,_=i.freezeHeight,x=_===void 0?!1:_,w={width:d,height:c,deltaX:s,deltaY:l};if(f){var C=4,k=0,D=0;switch(o){case 0:D=(s*-1-l)/C;break;case 1:D=(s-l)/C;break;case 2:D=(s+l)/C;break;case 3:D=(s*-1+l)/C;break}D!==0&&(k=Math.round(D/f.ResizeBasis.basisHeight*1e5)/1e3),f.ResizePCT.widthPCT=Math.max(Math.min(f.ResizePCT.widthPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit),f.ResizePCT.heightPCT=Math.max(Math.min(f.ResizePCT.heightPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit);var I=Math.round(f.ResizePCT.widthPCT*f.ResizeBasis.basisWidth/100),$=Math.round(f.ResizePCT.heightPCT*f.ResizeBasis.basisHeight/100);switch(o){case 0:s=d-I,l=c-$;break;case 1:s=I-d,l=c-$;break;case 2:s=I-d,l=$-c;break;case 3:s=d-I,l=$-c;break}return w.width=I,w.height=$,w.deltaX=s/g,w.deltaY=l/g,w}switch(o){case 0:w.width=b?d:d-s*g,w.height=x?c:c-l*g;break;case 1:w.width=b?d:d+s*g,w.height=x?c:c-l*g;break;case 2:w.width=b?d:d+s*g,w.height=x?c:c+l*g;break;case 3:w.width=b?d:d-s*g,w.height=x?c:c+l*g;break}return w},n.updateEdgePointByAnchors=function(){var i=n.nodeModel,o=i.id,s=i.anchors,l=n.getNodeEdges(o);l.sourceEdges.forEach(function(d){var c=s.find(function(f){return f.id===d.sourceAnchorId});c&&d.updateStartPoint({x:c.x,y:c.y})}),l.targetEdges.forEach(function(d){var c=s.find(function(f){return f.id===d.targetAnchorId});c&&d.updateEndPoint({x:c.x,y:c.y})})},n.updateRect=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.x,c=l.y,f=l.width,v=l.height,g=l.radius,y=l.PCTResizeInfo,b=n.nodeModel,_=b.minWidth,x=b.minHeight,w=b.maxWidth,C=b.maxHeight,k=n.index,D=_===w,I=x===C,$=n.getResize({index:k,deltaX:o,deltaY:s,width:f,height:v,PCTResizeInfo:y,pct:1,freezeWidth:D,freezeHeight:I});if($.width<_||$.width>w||$.height<x||$.height>C){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:D?0:$.deltaX,deltaY:I?0:$.deltaY}),n.nodeModel.width=$.width,n.nodeModel.height=$.height,n.nodeModel.setProperties({nodeSize:{width:$.width,height:$.height}});var R={x:d,y:c,width:f,height:v,radius:g},F={x:n.nodeModel.x,y:n.nodeModel.y,width:n.nodeModel.width,height:n.nodeModel.height,radius:g};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:R,afterNode:F})},n.updateEllipse=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.rx,c=l.ry,f=l.x,v=l.y,g=l.PCTResizeInfo,y=n.index,b=n.nodeModel,_=b.minWidth,x=b.minHeight,w=b.maxWidth,C=b.maxHeight,k=_===w,D=x===C,I=d,$=c,R=n.getResize({index:y,deltaX:o,deltaY:s,width:I,height:$,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:D});if(R.width<_/2||R.width>w/2||R.height<x/2||R.height>C/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:R.deltaX,deltaY:D?0:R.deltaY}),n.nodeModel.rx=R.width,n.nodeModel.ry=R.height,n.nodeModel.setProperties({nodeSize:{rx:R.width,ry:R.height}});var F={x:f,y:v},z={rx:R.width,ry:R.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:Ko(Ko({},F),{rx:d,ry:c}),afterNode:z})},n.updateDiamond=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.rx,c=l.ry,f=l.x,v=l.y,g=l.PCTResizeInfo,y=n.index,b=n.nodeModel,_=b.minWidth,x=b.minHeight,w=b.maxWidth,C=b.maxHeight,k=_===w,D=x===C,I=d,$=c,R=n.getResize({index:y,deltaX:o,deltaY:s,width:I,height:$,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:D});if(R.width<_/2||R.width>w/2||R.height<x/2||R.height>C/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:R.deltaX,deltaY:D?0:R.deltaY}),n.nodeModel.rx=R.width,n.nodeModel.ry=R.height,n.nodeModel.setProperties({nodeSize:{rx:R.width,ry:R.height}});var F={x:f,y:v,rx:d,ry:c},z={rx:R.width,ry:R.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:F,afterNode:z})},n.eventEmit=function(i){var o=i.deltaX,s=i.deltaY,l=i.beforeNode,d=i.afterNode,c=n.nodeModel,f=c.id,v=c.modelType,g=c.type,y=Ko({id:f,modelType:v,type:g},l),b=Ko({id:f,modelType:v,type:g},d);n.graphModel.eventCenter.emit("node:resize",{preData:y,data:b,deltaX:o,deltaY:s,index:n.index,model:n.nodeModel})},n.onDragging=function(i){var o,s=i.deltaX,l=i.deltaY,d=n.graphModel.transformModel,c=n.nodeModel.modelType;o=V4(d.fixDeltaXY(s,l),2),s=o[0],l=o[1],c===Ht.RECT_NODE||c===Ht.HTML_NODE?n.updateRect({deltaX:s,deltaY:l}):c===Ht.ELLIPSE_NODE?n.updateEllipse({deltaX:s,deltaY:l}):c===Ht.DIAMOND_NODE&&n.updateDiamond({deltaX:s,deltaY:l})},n.onDragEnd=function(){var i=n.graphModel.gridSize,o=i===void 0?1:i,s=o*Math.round(n.nodeModel.x/o),l=o*Math.round(n.nodeModel.y/o);n.nodeModel.moveTo(s,l),n.updateEdgePointByAnchors()},n.index=t.index,n.nodeModel=t.model,n.graphModel=t.graphModel,n.dragHandler=new X4({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:1}),n}return e.prototype.getNodeEdges=function(t){for(var n=this.graphModel,i=n.edges,o=[],s=[],l=0;l<i.length;l++){var d=i[l];d.sourceNodeId===t?o.push(d):i[l].targetNodeId===t&&s.push(d)}return{sourceEdges:o,targetEdges:s}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.index,s=t.model,l=s.getControlPointStyle();return ke("g",{className:"lf-resize-control-".concat(o),children:ke(Zr,Ko({className:"lf-node-control",x:n,y:i},l,{onMouseDown:this.dragHandler.handleMouseDown}))})},e}(Wt),Y4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Id=function(){return Id=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Id.apply(this,arguments)},cc=function(r){Y4(e,r);function e(){var t=r.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=n.x,s=n.y,l=n.width,d=n.height,c={minX:o-l/2,minY:s-d/2,maxX:o+l/2,maxY:s+d/2},f=c.minX,v=c.minY,g=c.maxX,y=c.maxY,b=[{x:f,y:v},{x:g,y:v},{x:g,y},{x:f,y}];return b.map(function(_,x){return ke(G4,Id({index:x},_,{model:n,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getResizeOutlineStyle();return ke(Zr,Id({},l,{x:n,y:i,width:o,height:s}))},e.prototype.render=function(){return ke("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e}(Wt),Cw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){Cw(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(uh);(function(r){Cw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return ke(cc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel.editConfigModel.isSilentMode;return ke("g",{children:[this.getResizeShape(),n.isSelected&&!i?this.getControlGroup():""]})},e})(_h);var Ow=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Nh=function(){return Nh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Nh.apply(this,arguments)};(function(r){Ow(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(lh);(function(r){Ow(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return ke(cc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,n=t.points,i=t.getNodeStyle();return ke("g",{children:ke(op,Nh({},i,{points:n}))})},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return ke("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(mh);var kw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){kw(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Tl);(function(r){kw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return ke(cc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return ke("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(Ll);var Nw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),q4=function(r){Nw(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e}(is),K4=function(r){Nw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return ke(cc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return ke("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e}(ia),Mw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bd=function(){return Bd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bd.apply(this,arguments)},Uo=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Vo=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},cy=500,fy=300,J4=-1e4;(function(r){Mw(e,r);function e(){var t=r.apply(this,Vo([],Uo(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=cy,t.unfoldedHeight=fy,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var n=this;r.prototype.initNodeData.call(this,t);var i=[];n_(t.children)&&(i=t.children),this.children=new Set(i),this.width=cy,this.height=fy,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=J4,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){n.isFolded&&n.foldGroup(n.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var n=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=Vo(Vo([],Uo(this.incoming.edges),!1),Uo(this.outgoing.edges),!1);this.children.forEach(function(o){var s=n.graphModel.getElement(o);if(s){var l=s.isFolded;if(s.isGroup&&!s.isFolded&&s.foldGroup(t),s.isGroup&&!t){var d=n.childrenLastFoldStatus[o];d!==void 0&&d!==s.isFolded&&s.foldGroup(d)}n.childrenLastFoldStatus[o]=!!l,s.visible=!t;var c=s.incoming.edges,f=s.outgoing.edges;i=Vo(Vo(Vo([],Uo(i),!1),Uo(c),!1),Uo(f),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var n=r.prototype.getAnchorStyle.call(this,t);return n.stroke="transparent",n.fill="transparent",n.hover.fill="transparent",n.hover.stroke="transparent",n},e.prototype.foldEdge=function(t,n){var i=this;n.forEach(function(o,s){var l=o.id,d=o.sourceNodeId,c=o.targetNodeId,f=o.startPoint,v=o.endPoint,g=o.type,y=o.text,b=o.getProperties(),_={id:"".concat(l,"__").concat(s),sourceNodeId:d,targetNodeId:c,startPoint:f,endPoint:v,type:g,properties:b,text:y==null?void 0:y.value};o.virtual&&i.graphModel.deleteEdgeById(o.id);var x=i.graphModel.group.getNodeGroup(c);x||(x=i.graphModel.getNodeModelById(c));var w=i.graphModel.group.getNodeGroup(d);w||(w=i.graphModel.getNodeModelById(d)),t&&o.visible!==!1&&(i.children.has(d)||i.id===d?(_.startPoint=void 0,_.sourceNodeId=i.id):(_.endPoint=void 0,_.targetNodeId=i.id),(x.id!==i.id||w.id!==i.id)&&i.createVirtualEdge(_),o.visible=!1),!t&&o.visible===!1&&(x&&x.isGroup&&x.isFolded?(_.targetNodeId=x.id,_.endPoint=void 0,i.createVirtualEdge(_)):w&&w.isGroup&&w.isFolded?(_.sourceNodeId=w.id,_.startPoint=void 0,i.createVirtualEdge(_)):o.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isFoldedEdge=!0},e.prototype.isInRange=function(t){var n=t.minX,i=t.minY,o=t.maxX,s=t.maxY;return n>=this.x-this.width/2&&o<=this.x+this.width/2&&i>=this.y-this.height/2&&s<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var n=t.minX,i=t.minY,o=t.maxX,s=t.maxY;return{x:n>=this.x-this.width/2&&o<=this.x+this.width/2,y:i>=this.y-this.height/2&&s<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this);n.children=[],this.children.forEach(function(o){var s=t.graphModel.getNodeModelById(o);s&&!s.virtual&&n.children.push(o)});var i=n.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,n},e.prototype.getHistoryData=function(){var t=r.prototype.getData.call(this);t.children=Vo([],Uo(this.children),!1),t.isGroup=!0;var n=t.properties;return n==null||delete n.groupAddable,n!=null&&n.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(q4);(function(r){Mw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,n=t.resizable,i=t.properties;return n&&!i.isFolded?r.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,s=t.y,l=t.radius,d=t.properties,c=t.getAddableOutlineStyle;if(!d.groupAddable)return null;var f=this.props.model.getNodeStyle().strokeWidth,v=f===void 0?0:f,g=c(),y=n+v+8,b=i+v+8;return vt("rect",Bd(Bd({},g),{width:y,height:b,x:o-y/2,y:s-b/2,rx:l,ry:l}))},e.prototype.getFoldIcon=function(){var t=this.props.model,n=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var o=vt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," M").concat(n+7,",").concat(i+2," ").concat(n+7,",").concat(i+10):"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," ")});return vt("g",{},[vt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),o])},e.prototype.getResizeShape=function(){return vt("g",{},[this.getAddableShape(),r.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(K4);var hy=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gl=function(){return gl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gl.apply(this,arguments)};function Z4(r){var e=function(n){hy(i,n);function i(o,s){o.id||(o.id="Flow_".concat(W4()));var l=gl(gl(gl({},{}),o.properties),{isDefaultFlow:!1});return o.properties=l,n.call(this,o,s)||this}return i.extendKey="SequenceFlowModel",i}(rs),t=function(n){hy(i,n);function i(){return n!==null&&n.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var o=this.props.model,s=o.properties.isDefaultFlow;return s?vt("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):vt("path",{d:""})},i.extendKey="SequenceFlowEdge",i}(os);return{type:"bpmn:sequenceFlow",view:t,model:e}}Z4();var py={width:40,height:40},vy={width:40,height:40},gy={width:100,height:80},jd={width:100,height:80},my={width:100,height:80},yy={width:100,height:80},_y={width:100,height:80},by={width:100,height:80},xy={width:100,height:80},wy={width:100,height:80},Cr=function(){};Cr.ObjTree=function(){return this};Cr.ObjTree.VERSION="0.23";Cr.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Cr.ObjTree.prototype.attr_prefix="-";Cr.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};Cr.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,s=t,l=n.onComplete;n.onComplete=function(f){var v;f&&f.responseXML&&f.responseXML.documentElement&&(v=o.parseDOM(f.responseXML.documentElement)),s(v,f),l&&l(f)}}else n.asynchronous=!1;var d;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var c=new HTTP.Request(n);c&&(d=c.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var c=new Ajax.Request(r,n);c&&(d=c.transport)}if(t)return d;if(d&&d.responseXML&&d.responseXML.documentElement)return this.parseDOM(d.responseXML.documentElement)};Cr.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!==11){var n={};n[r.nodeName]=t,t=n}return t}};Cr.ObjTree.prototype.parseElement=function(r){if(r.nodeType!==7){if(r.nodeType===3||r.nodeType===4||r.nodeType===8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var s=r.attributes[i].nodeValue;try{s=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=r.attributes[i].nodeValue}s!=null&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var d=r.childNodes[i].nodeType;d===3||d===4||d===8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var s=this.parseElement(r.childNodes[i]);s&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}}else t===null&&(t={});return t}};Cr.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t===1&&(r[e]=[]),r[e][r[e].length]=n):t===1?r[e]=n:t===2?r[e]=[r[e],n]:r[e][r[e].length]=n};Cr.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};Cr.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(If(e,i)){var o=e[i];i.charAt(0)!==this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<".concat(i," />"):typeof o=="object"&&o.constructor===Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(o),'"')}var s=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<".concat(r).concat(s,`>
`).concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(s,">").concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(s,` />
`)),l};Cr.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<".concat(r," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};Cr.ObjTree.prototype.scalar_to_xml=function(r,e){return r==="#text"?this.xml_escape(e):"<".concat(r,">").concat(this.xml_escape(e),"</").concat(r,`>
`)};Cr.ObjTree.prototype.xml_escape=function(r){return r.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var Q4=function(r){return new Cr.ObjTree().parseXML(r)};function Aw(r){return Object.prototype.toString.call(r)}function Sy(r){return"  ".repeat(r)}function Hd(r){return Aw(r)==="[object Object]"?Object.keys(r).reduce(function(e,t){var n=t;return t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=Hd(r[t]),e},{}):Array.isArray(r)?r.map(function(e){return Hd(e)}):r}function eB(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(Hd(r)).replace(/"/g,"'")}return e}var Ey=`	
`;function ed(r,e,t){var n=Sy(t),i="",o=Ey+n;if(e==="-json")return"";if(e==="#text")return o+r;if(e==="#cdata-section")return"".concat(o,"<![CDATA[").concat(r,"]]>");if(e==="#comment")return"".concat(o,"<!--").concat(r,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(eB(r),'"');if(Array.isArray(r))i+=r.map(function(c){return ed(c,e,t+1)}).join("");else if(Aw(r)==="[object Object]"){var s=Object.keys(r),l="",d=r["-json"]?Ey+Sy(t+1)+r["-json"]:"";i+="".concat(t===0?"":o,"<").concat(e),s.forEach(function(c){c.charAt(0)==="-"?l+=ed(r[c],c,t+1):d+=ed(r[c],c,t+1)}),i+=l+(d!==""?">".concat(d).concat(o,"</").concat(e,">"):" />")}else i+="".concat(o,"<").concat(e,">").concat(r.toString(),"</").concat(e,">");return i}function tB(r){var e="";for(var t in r)e+=ed(r[t],t,0);return e}var nB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Mh=function(){return Mh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Mh.apply(this,arguments)},Cy=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},lp=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ur=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},vi=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},wr;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",r.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",r.BOUNDARY="bpmn:boundaryEvent",r.PARALLEL_GATEWAY="bpmn:parallelGateway",r.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",r.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow",r.SUBPROCESS="bpmn:subProcess"})(wr||(wr={}));var Tw=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],rB=["properties","startPoint","endPoint","pointsList"],$d={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},Dw=function(r,e){var t=Object.keys(e||{});return t.forEach(function(n){if(r[n]){var i=e[n],o=i.in,s=i.out;o&&(r[n].in=o),s&&(r[n].out=s)}else r[n]=e[n]}),r},Kr={"bpmn:startEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=Kr[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateCatchEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=Kr[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateThrowEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=Kr[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:boundaryEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=Kr[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:sequenceFlow":{out:function(r){var e=r.properties,t=e.expressionType,n=e.condition;return n?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(n,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(n,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(r){var e=r.properties,t=e.timerType,n=e.timerValue,i=e.definitionId,o=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(n,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&n?">".concat(o(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(r,e){var t,n,i,o,s=r,l=e["-id"],d="",c="";try{for(var f=lp(Object.keys(e)),v=f.next();!v.done;v=f.next()){var g=v.value;g.includes("bpmn:")&&(i=ur(g.split(":"),2),d=i[1],c=(o=e[g])===null||o===void 0?void 0:o["#text"])}}catch(y){t={error:y}}finally{try{v&&!v.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}return{"-definitionId":l,"-definitionType":s,"-timerType":d,"-timerValue":c}}},"bpmn:conditionExpression":{in:function(r,e){var t,n="",i="";return e["#cdata-section"]?(i="cdata",n=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",n=e["#text"]),{"-condition":n,"-expressionType":i}}}};function iB(r){var e=r??{},t=e.retainedAttrsFields,n=e.excludeFields,i=e.transformer,o=new Set(vi(vi([],ur(rB),!1),ur(t||[]),!1)),s={in:new Set(vi(vi([],ur($d.in),!1),ur((n==null?void 0:n.in)||[]),!1)),out:new Set(vi(vi([],ur($d.out),!1),ur((n==null?void 0:n.out)||[]),!1))};return Kr=Dw(Kr,i),function(l){var d=l.nodes,c=l.edges;function f(v,g){var y,b;if((v==null?void 0:v.flag)!==1){var _;if((_=Kr[v.type])&&_.out){var x=_.out(v),w=Object.keys(x);w.length>0&&w.forEach(function(z){v[z]=x[z]})}v!=null&&v.children&&(v.children=v.children.map(function(z){var ie=d.find(function(G){return G.id===z})||c.find(function(G){return G.id===z});return ie||{}}));var C={};if(typeof v=="string")return v;if(Array.isArray(v))return v.map(function(z){return f(z,"")}).filter(function(z){return z!=null});try{for(var k=lp(Object.entries(v)),D=k.next();!D.done;D=k.next()){var I=ur(D.value,2),$=I[0],R=I[1];if((R==null?void 0:R.flag)===1)return;var F=[g,$].filter(function(z){return z}).join(".");s.out.has(F)||(typeof R!="object"?$.indexOf("-")===0||["#text","#cdata-section","#comment"].includes($)?C[$]=R:C["-".concat($)]=R:o.has(F)?C["-".concat($)]=f(R,F):C[$]=f(R,F))}}catch(z){y={error:z}}finally{try{D&&!D.done&&(b=k.return)&&b.call(k)}finally{if(y)throw y.error}}return C}}return f(l,"")}}function Fd(r){var e,t,n={};try{for(var i=lp(Object.entries(r)),o=i.next();!o.done;o=i.next()){var s=ur(o.value,2),l=s[0],d=s[1];l.indexOf("-")===0?n[l.substring(1)]=Hd(d):typeof d=="string"?n[l]=d:Object.prototype.toString.call(d)==="[object Object]"?n[l]=Fd(d):Array.isArray(d)?n[l]=d.map(function(c){return Fd(c)}):n[l]=d}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n}function oB(r,e,t){var n,i=new Map,o=iB(t)(e);o.nodes.forEach(function(l){var d=l["-id"],c=l["-type"],f=l.text,v=l.children,g=Cy(l,["-id","-type","text","children"]),y={"-id":d};f!=null&&f["-value"]&&(y["-name"]=f["-value"]),g["-json"]&&(y["-json"]=g["-json"]),g["-properties"]&&Object.assign(y,g["-properties"]),v&&(y.children=v),r[c]||(r[c]=[]),r[c].push(y),i.set(d,y)});var s=o.edges.map(function(l){var d=l["-id"],c=l["-sourceNodeId"],f=l["-targetNodeId"],v=l.text,g=Cy(l,["-id","-sourceNodeId","-targetNodeId","text"]),y=i.get(f);y["bpmn:incoming"]||(y["bpmn:incoming"]=[]),y["bpmn:incoming"].push(d);var b={"-id":d,"-sourceRef":c,"-targetRef":f};return v!=null&&v["-value"]&&(b["-name"]=v["-value"]),g["-json"]&&(b["-json"]=g["-json"]),g["-properties"]&&Object.assign(b,g["-properties"]),b});return e.edges.forEach(function(l){var d=l.sourceNodeId,c=l.id,f=i.get(d);f["bpmn:outgoing"]||(f["bpmn:outgoing"]=[]),f["bpmn:outgoing"].push(c)}),(n=r["bpmn:subProcess"])===null||n===void 0||n.forEach(function(l){var d={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},c=[];l.children.forEach(function(_){var x,w=i.get(_["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(k){w[k]&&w[k].forEach(function(D){d[k].add(D)})});var C=(x=r[_["-type"]])===null||x===void 0?void 0:x.findIndex(function(k){return k["-id"]===_["-id"]});C>=0&&r[_["-type"]].splice(C,1),i.delete(_["-id"]),l[_["-type"]]||(l[_["-type"]]=[]),l[_["-type"]].push(w)});var f=d["bpmn:incoming"],v=d["bpmn:outgoing"];v.forEach(function(_){f.has(_)&&c.push(_)});for(var g=function(_){var x=s.findIndex(function(w){return w["-id"]===c[_]});x>=0?(l["bpmn:sequenceFlow"]||(l["bpmn:sequenceFlow"]=[]),l["bpmn:sequenceFlow"].push(s[x]),s.splice(x,1)):_++,y=_},y,b=0;b<c.length;)g(b),b=y;delete l.children}),r[wr.FLOW]=s,r}function aB(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var d=l.x,c=l.y;return{"-x":d,"-y":c}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,s=80,l=t.x,d=t.y,c=Br.shapeConfigMap.get(t.type);c&&(o=c.width,s=c.height),l-=o/2,d-=s/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":d,"-width":o,"-height":s}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}var sB=["bpmn:incoming","bpmn:outgoing"];function lB(r,e){var t=[],n=[],i=new Map,o=e??{},s=o.transformer,l=o.excludeFields,d={in:new Set(vi(vi([],ur($d.in),!1),ur((l==null?void 0:l.in)||[]),!1)),out:new Set(vi(vi([],ur($d.out),!1),ur((l==null?void 0:l.out)||[]),!1))};Kr=Dw(Kr,s);var c=r["bpmn:definitions"];if(c){var f=c["bpmn:process"];(function(g,y){y.forEach(function(b){try{Object.keys(g).forEach(function(_){try{b(_)}catch(x){console.error(x)}})}catch(_){console.error(_)}})})(f,[function(g){function y(_){_["-children"]||(_["-children"]=[]),Object.keys(_).forEach(function(x){var w;x.indexOf("bpmn:")===0&&!sB.includes(x)&&(f[x]||(f[x]=[]),!Array.isArray(f[x])&&(f[x]=[f[x]]),Array.isArray(_[x])?(w=f[x]).push.apply(w,vi([],ur(_[x]),!1)):f[x].push(_[x]),Array.isArray(_[x])?_[x].forEach(function(C){!x.includes("Flow")&&_["-children"].push(C["-id"])}):!x.includes("Flow")&&_["-children"].push(_[x]["-id"]),delete _[x])})}if(g==="bpmn:subProcess"){var b=f[g];Array.isArray(b)?b.forEach(function(_){g==="bpmn:subProcess"&&y(_)}):y(b)}},function(g){var y=function(_){Object.keys(_).forEach(function(x){var w,C;if(x.includes("bpmn:")){var k={};Kr[x]&&Kr[x].in?(k=(C=(w=Kr[x]).in)===null||C===void 0?void 0:C.call(w,x,r_.cloneDeep(_[x])),delete _[x]):b(_[x]);var D=void 0;(D=Reflect.ownKeys(k)).length>0&&D.forEach(function(I){Reflect.set(_,I,k[I])})}})};function b(_){i.set(_["-id"],_),Array.isArray(_)?_.forEach(function(x){b(x)}):typeof _=="object"&&y(_)}b(f[g])},function(g){if(g.indexOf("bpmn:")===0){var y=f[g];if(g==="bpmn:sequenceFlow"){var b=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];n=dB(y,b)}else{var _=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(g==="bpmn:boundaryEvent"){var x=f[g],w=function(C){var k=C["-attachedToRef"],D=i.get(k);D["-boundaryEvents"]||(D["-boundaryEvents"]=[]),D["-boundaryEvents"].push(C["-id"])};Array.isArray(x)?x.forEach(function(C){w(C)}):w(x)}t=t.concat(uB(y,_,g))}}}])}var v=function(g,y,b){Object.keys(g).forEach(function(_){var x=b?"".concat(b,".").concat(_):_;y.has(x)?delete g[_]:typeof g[_]=="object"&&v(g[_],y,x)})};return t.forEach(function(g){var y,b;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var _=(b=e==null?void 0:e.mapping)===null||b===void 0?void 0:b.in,x=g.type;_[x]&&(g.type=_[x])}v(g,d.in,"")}),n.forEach(function(g){var y,b;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var _=(b=e==null?void 0:e.mapping)===null||b===void 0?void 0:b.in,x=g.type;_[x]&&(g.type=_[x])}v(g,d.in,"")}),{nodes:t,edges:n}}function uB(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(s){var l;Array.isArray(e)?l=e.find(function(c){return c["-bpmnElement"]===s["-id"]}):l=e;var d=Oy(l,t,s);n.push(d)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===r["-id"]}):i=e;var o=Oy(i,t,r);n.push(o)}return n}function Oy(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=t["-children"],s=t["-name"],l=Br.shapeConfigMap.get(e);l&&(n+=l.width/2,i+=l.height/2);var d={};Object.entries(t).forEach(function(g){var y=ur(g,2),b=y[0],_=y[1];Tw.includes(b)||(d[b]=_)}),d=Fd(d);var c;if(s&&(c={x:n,y:i,value:s},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var f=r["bpmndi:BPMNLabel"]["dc:Bounds"];c.x=Number(f["-x"])+Number(f["-width"])/2,c.y=Number(f["-y"])+Number(f["-height"])/2}var v={id:r["-bpmnElement"],type:e,x:n,y:i,properties:d};return o&&(v.children=o),c&&(v.text=c),v}function dB(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):o=e,t.push(ky(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(ky(n,r))}return t}function ky(r,e){var t,n=e["-name"]?"".concat(e["-name"]):"";if(n){var i=r["bpmndi:BPMNLabel"]["dc:Bounds"],o=0;n.split(`
`).forEach(function(c){o<c.length&&(o=c.length)}),t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7}}var s={};Object.entries(e).forEach(function(c){var f=ur(c,2),v=f[0],g=f[1];Tw.includes(v)||(s[v]=g)}),s=Fd(s);var l=r["di:waypoint"].map(function(c){return{x:Number(c["-x"]),y:Number(c["-y"])}}),d={id:e["-id"],type:wr.FLOW,pointsList:l,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(d.text=t),d}var Br=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var s,l,d=Mh({},n.processAttributes);oB(d,i,o);var c={"-id":"BPMNPlane_1","-bpmnElement":d["-id"]};aB(c,i);var f=n.definitionAttributes;f["bpmn:process"]=d,f["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":c};var v={"bpmn:definitions":f};if(!((s=o==null?void 0:o.mapping)===null||s===void 0)&&s.out){var g=(l=o==null?void 0:o.mapping)===null||l===void 0?void 0:l.out,y=function(b){Array.isArray(b)&&b.forEach(function(_){return y(_)}),typeof b=="object"&&Object.keys(b).forEach(function(_){var x;(x=g[_])?(b[x]=r_.cloneDeep(b[_]),delete b[_],y(b[x])):y(b[_])})};y(v)}return v},this.adapterIn=function(i,o){if(i)return lB(i,o)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();Br.shapeConfigMap.set(wr.START,{width:py.width,height:py.height});Br.shapeConfigMap.set(wr.END,{width:vy.width,height:vy.height});Br.shapeConfigMap.set(wr.INTERMEDIATE_CATCH,{width:jd.width,height:jd.height});Br.shapeConfigMap.set(wr.INTERMEDIATE_THROW,{width:jd.width,height:jd.height});Br.shapeConfigMap.set(wr.BOUNDARY,{width:gy.width,height:gy.height});Br.shapeConfigMap.set(wr.PARALLEL_GATEWAY,{width:my.width,height:my.height});Br.shapeConfigMap.set(wr.INCLUSIVE_GATEWAY,{width:yy.width,height:yy.height});Br.shapeConfigMap.set(wr.EXCLUSIVE_GATEWAY,{width:_y.width,height:_y.height});Br.shapeConfigMap.set(wr.SYSTEM,{width:by.width,height:by.height});Br.shapeConfigMap.set(wr.USER,{width:xy.width,height:xy.height});Br.shapeConfigMap.set(wr.SUBPROCESS,{width:wy.width,height:wy.height});(function(r){nB(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(s){var l=Q4(s);return n.adapterIn(l,n.props)},n.adapterXmlOut=function(s){var l=n.adapterOut(s,n.props);return tB(l)};var i=t.lf,o=t.props;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n.props=o,n}return e.pluginName="BPMNAdapter",e})(Br);function cB(r,e,t){var n=e.x,i=e.y,o=r.x,s=r.y,l=o-n,d=s-i,c=l*Math.cos(t)-d*Math.sin(t),f=l*Math.sin(t)+d*Math.cos(t),v=c+n,g=f+i;return{x:v,y:g}}var fB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),zd=function(){return zd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},zd.apply(this,arguments)},hB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},pB=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){fB(e,r);function e(){var t=r.apply(this,pB([],hB(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(n){var i=n.model,o=t.props,s=o.model,l=o.graphModel,d=s.transformWithContainer,c=s.isRestrict,f=t.childrenPositionMap;if(!(!d||c)&&i.id===s.id){var v={x:s.x,y:s.y};on(Array.from(s.children),function(g){var y=l.getNodeModelById(g);if(y){var b={x:y.x,y:y.y};f.has(y.id)?b=f.get(y.id):f.set(y.id,b);var _=i.rotate*(180/Math.PI);_<0&&(_+=360);var x=_*(Math.PI/180),w=cB(b,v,x);y.moveTo(w.x,w.y),y.rotate=i.rotate}})}},t.onNodeResize=function(n){var i=n.deltaX,o=n.deltaY,s=n.index,l=n.model,d=n.preData,c=t.props,f=c.model,v=c.graphModel,g=f.transformWithContainer,y=f.isRestrict;if(!(!g||y)&&l.id===f.id){var b=d.properties,_=b||{},x=_.width,w=_.height;on(Array.from(f.children),function(C){var k=v.getNodeModelById(C);if(k){var D=k.width/x*i,I=k.height/w*o;dw({deltaX:D,deltaY:I,index:s,nodeModel:k,graphModel:v,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var n=t.props.model;n.isCollapsed&&n.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){r.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,n){var i=this,o=[];return t.isGroup&&on(Array.from(t.children),function(s){o.push(s);var l=n.getNodeModelById(s);l!=null&&l.isGroup&&(o=o.concat(i.getNodesInGroup(l,n)))}),o},e.prototype.getResizeControl=function(){var t=this.props.model,n=t.resizable,i=t.isCollapsed,o=n&&!i;return o?r.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,s=t.y,l=t.radius,d=t.groupAddable;if(!d)return null;var c=t.getNodeStyle().strokeWidth,f=c===void 0?0:c,v=t.getAddableOutlineStyle(),g=n+f+8,y=i+f+8;return vt("rect",zd(zd({},v),{width:g,height:y,x:o-g/2,y:s-y/2,rx:l,ry:l}))},e.prototype.getCollapseIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," M").concat(t+7,",").concat(n+2," ").concat(t+7,",").concat(n+10)},e.prototype.getExpandIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=n-o/2+10,d=i-s/2+10;if(!t.collapsible)return null;var c=t!=null&&t.isCollapsed?this.getCollapseIcon(l,d):this.getExpandIcon(l,d),f=vt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:c});return vt("g",{},[vt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:l,y:d,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),f])},e.prototype.getShape=function(){return vt("g",{},[this.getAppendAreaShape(),r.prototype.getShape.call(this),this.getOperateIcon()])},e})(ia);var vB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Wd=function(){return Wd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wd.apply(this,arguments)},Nf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Pa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Js=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},gB=400,mB=230,yB=80,_B=60,bB=-1e4;(function(r){vB(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var n;r.prototype.initNodeData.call(this,t);var i=(n=t.properties)!==null&&n!==void 0?n:{},o=i.children,s=i.width,l=i.height,d=i.collapsedWidth,c=i.collapsedHeight,f=i.collapsible,v=i.isCollapsed,g=i.zIndex,y=i.isRestrict,b=i.autoResize,_=i.autoToFront,x=i.transformWithContainer;this.children=o?new Set(o):new Set,this.zIndex=g??bB,this.isCollapsed=v??!1,this.setProperties({isCollapsed:v??!1});var w=s??gB,C=l??mB;this.width=w,this.height=C,this.expandWidth=w,this.expandHeight=C,this.collapsedWidth=d??yB,this.collapsedHeight=c??_B,this.isRestrict=y??!1,this.transformWithContainer=x??!1,this.autoResize=b??!1,this.collapsible=f??!0,this.autoToFront=_??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this),i=[];return on(Array.from(this.children),function(o){var s=t.graphModel.getNodeModelById(o);s&&!s.virtual&&i.push(o)}),n.children=i,n.properties&&(n.properties.children=i,n.properties.isCollapsed=this.isCollapsed),n},e.prototype.getNodesInGroup=function(t){var n=[];return t.isGroup&&on(Array.from(t.children),function(i){n.push(i)}),n},e.prototype.getMoveDistance=function(t,n,i){i===void 0&&(i=!1);var o=Pa(r.prototype.getMoveDistance.call(this,t,n,i),2),s=o[0],l=o[1],d=this.getNodesInGroup(this);return this.graphModel.moveNodes(d,t,n,i),[s,l]},e.prototype.getHistoryData=function(){var t=r.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var n=this,i=n.x,o=n.y,s=n.collapsedWidth,l=n.collapsedHeight,d=n.expandWidth,c=n.expandHeight,f=n.isCollapsed;return f&&(t.x=i+d/2-s/2,t.y=o+c/2-l/2,t.text&&(t.text.x=t.text.x+d/2-s/2,t.text.y=t.text.y+c/2-l/2)),t},e.prototype.toggleCollapse=function(t){var n=this,i=this.graphModel,o=!!t;this.isCollapsed=o,this.setProperties({isCollapsed:o}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:o,nodeModel:this}),o?this.collapse():this.expand();var s=Js(Js([],Pa(this.incoming.edges),!1),Pa(this.outgoing.edges),!1),l=Array.from(this.children);on(l,function(d){var c,f,v=n.graphModel.elementsModelMap.get(d);if(v){var g=v.isCollapsed;if(v.isGroup){var y=v;if(y.isCollapsed||y.toggleCollapse(t),!t){var b=(c=n.childrenLastCollapseStateDict)===null||c===void 0?void 0:c.get(d);b!==void 0&&b!==v.isCollapsed&&y.toggleCollapse(b)}}if((f=n.childrenLastCollapseStateDict)===null||f===void 0||f.set(d,!!g),v.visible=!t,v.BaseType===xn.NODE){var _=v.incoming.edges,x=v.outgoing.edges;s=Js(Js(Js([],Pa(s),!1),Pa(_),!1),Pa(x),!1)}}}),this.collapseEdge(o,s)},e.prototype.collapse=function(){var t=this,n=t.x,i=t.y,o=t.text,s=t.width,l=t.height,d=t.collapsedWidth,c=t.collapsedHeight;this.x=n-s/2+d/2,this.y=i-l/2+c/2,this.text.x=o.x-s/2+d/2,this.text.y=o.y-l/2+c/2,this.expandWidth=s,this.expandHeight=l,this.width=d,this.height=c},e.prototype.expand=function(){var t=this,n=t.x,i=t.y,o=t.text,s=t.expandWidth,l=t.expandHeight,d=t.collapsedWidth,c=t.collapsedHeight;this.width=s,this.height=l,this.x=n+this.width/2-d/2,this.y=i+this.height/2-c/2,this.text.x=o.x+this.width/2-d/2,this.text.y=o.y+this.height/2-c/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,n){var i=this,o=this.graphModel;on(n,function(s,l){var d,c=s.getData(),f=c.targetNodeId,v=c.sourceNodeId,g=Wd(Wd({},c),{id:"".concat(c.id,"__").concat(l),text:(d=c.text)===null||d===void 0?void 0:d.value});s.virtual&&o.deleteEdgeById(s.id);var y=o.dynamicGroup.getGroupByNodeId(f);y||(y=o.getNodeModelById(f));var b=o.dynamicGroup.getGroupByNodeId(v);b||(b=o.getNodeModelById(v)),t&&s.visible&&(i.children.has(v)||i.id===v?(g.startPoint=void 0,g.sourceNodeId=i.id):(g.endPoint=void 0,g.targetNodeId=i.id),(y.id!==i.id||b.id!==i.id)&&i.createVirtualEdge(g),s.visible=!1),!t&&!s.visible&&(y&&y.isGroup&&y.isCollapsed?(g.targetNodeId=y.id,g.endPoint=void 0,i.createVirtualEdge(g)):b&&b.isGroup&&b.isCollapsed?(g.sourceNodeId=b.id,g.startPoint=void 0,i.createVirtualEdge(g)):s.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var n=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:n,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var n=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:n})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=r.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Nf([Me],e.prototype,"isCollapsed",void 0),Nf([Me],e.prototype,"groupAddable",void 0),Nf([Me],e.prototype,"transformWithContainer",void 0),e})(is);var Ny;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(Ny||(Ny={}));var xB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ml=function(){return ml=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ml.apply(this,arguments)},wB=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},SB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},EB=function(r){xB(e,r);function e(t){var n=r.call(this,t)||this;n.textRef=tc(),n.setHoverOn=function(){var d=n.props.element;d.isDragging||n.state.isHovered||(n.setState({isHovered:!0}),d.setHovered(!0))},n.setHoverOff=function(){var d=n.props.element;n.state.isHovered&&(n.setState({isHovered:!1}),d.setHovered(!1))},n.handleMouseDown=function(d){var c,f=n.props,v=f.label,g=f.graphModel,y=g.editConfigModel.nodeTextDraggable;((c=v.draggable)!==null&&c!==void 0?c:y)&&!n.state.isDragging&&!n.state.isEditing&&n.stepDrag.handleMouseDown(d)},n.handleMouseUp=function(d){n.state.isDragging&&n.stepDrag.handleMouseUp(d)},n.handleDragging=function(d){var c=d.deltaX,f=d.deltaY;n.state.isDragging||n.setState({isDragging:!0});var v=n.props,g=v.label,y=v.graphModel,b=y.transformModel,_=SB(b.fixDeltaXY(c,f),2),x=_[0],w=_[1];n.setElementModelLabelInfo({x:g.x+x,y:g.y+w}),y.eventCenter.emit("label:drag",{data:g.getData(),model:g})},n.handleDragEnd=function(){n.setState({isDragging:!1})},n.handleClick=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel;v.setSelected(!n.state.isSelected),n.setState({isSelected:!n.state.isSelected}),n.setElementModelLabelInfo({isSelected:!0}),g.eventCenter.emit("label:click",{data:f.getData(),e:d,model:v})},n.handleDbClick=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel;if(g.eventCenter.emit("label:dblclick",{data:f.getData(),e:d,model:v}),!f.editable){v.setSelected(!0);return}if(v.setSelected(),v.setElementState(Yt.TEXT_EDIT),n.setState({isEditing:!0}),n.textRef.current){n.textRef.current.contentEditable="true",n.textRef.current.focus();var y=document.createRange(),b=window.getSelection();y.selectNodeContents(n.textRef.current),y.collapse(!1),b==null||b.removeAllRanges(),b==null||b.addRange(y)}},n.handleBlur=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel.eventCenter;g.emit("label:blur",{e:d,model:v,data:f.getData(),element:n.textRef.current}),n.setState({isDragging:!1,isHovered:!1,isSelected:!1})},n.handleInput=function(d){var c=n.props,f=c.label,v=c.graphModel;v.eventCenter.emit("label:input",{e:d,data:f.getData()})},n.reCalcLabelSize=function(){};var i=t.label,o=t.graphModel,s=o.gridSize,l=o.eventCenter;return n.stepDrag=new oi({onDragging:n.handleDragging,onDragEnd:n.handleDragEnd,step:s,eventType:"LABEL",model:i,eventCenter:l}),n.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},n}return e.prototype.setElementModelLabelInfo=function(t){var n=this.props,i=n.label,o=n.element,s=n.graphModel,l=o.properties._label,d=l,c=wC(d,function(g){return g.id===i.id}),f=d[c];d[c]=ml(ml({},f),t);var v=s.getElement(o.id);v==null||v.setProperty("_label",d)},e.prototype.componentDidMount=function(){var t=this,n=this.props,i=n.label,o=n.element,s=n.graphModel;s.eventCenter.on("blank:click,node:click,edge:click,label:click",function(l){var d,c,f,v,g=l.data;if(((g==null?void 0:g.type)!=="label"||g.type==="label"&&g.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var y=(c=(d=t.textRef.current)===null||d===void 0?void 0:d.innerText)!==null&&c!==void 0?c:"",b=(v=(f=t.textRef.current)===null||f===void 0?void 0:f.innerHTML)!==null&&v!==void 0?v:"";t.setElementModelLabelInfo({value:y,content:b,isSelected:!1}),o.setElementState(Yt.DEFAULT)}((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,n=this.props,i=n.label,o=n.element,s=n.graphModel,l=this.state,d=l.isDragging,c=l.isHovered,f=l.isSelected,v=l.isEditing,g=s.transformModel,y=g.getTransformStyle().transform,b=i.id,_=i.x,x=i.y,w=i.zIndex,C=i.vertical,k=i.style,D=i.rotate,I=i.content,$=i.labelWidth,R=i.textOverflowMode,F=$??(o.BaseType==="node"?o.width-20:80),z={left:"".concat(_-F/2,"px"),top:"".concat(x-10,"px"),width:"".concat(F,"px"),height:"20px",zIndex:w??1,transform:D?"".concat(y," rotate(").concat(D,"deg)"):"".concat(y," rotate(").concat(C?-.25:0,"turn)")};return ke("div",{id:"element-container-".concat(b),className:fh("lf-label-editor-container"),style:z,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:ke("div",{ref:this.textRef,id:"editor-container-".concat(b),className:fh("lf-label-editor",(t={"lf-label-editor-dragging":d,"lf-label-editor-editing":v,"lf-label-editor-hover":!v&&(c||f)},t["lf-label-editor-".concat(R)]=!v,t)),onInput:this.handleInput,style:ml({maxWidth:"".concat(F,"px"),boxSizing:"border-box",display:"inline-block",background:v||o.BaseType==="edge"?"#fff":"transparent"},k),dangerouslySetInnerHTML:{__html:I}})})},e=wB([xr],e),e}(Wt),qr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},CB=So,OB=function(){function r(e,t,n){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=n,this.id=(i=e.id)!==null&&i!==void 0?i:CB(),this.initLabelData(e)}return r.prototype.initLabelData=function(e){Qt(this,e)},r.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:pi(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},qr([Me],r.prototype,"x",void 0),qr([Me],r.prototype,"y",void 0),qr([Me],r.prototype,"content",void 0),qr([Me],r.prototype,"value",void 0),qr([Me],r.prototype,"rotate",void 0),qr([Me],r.prototype,"style",void 0),qr([Me],r.prototype,"zIndex",void 0),qr([Me],r.prototype,"vertical",void 0),qr([Me],r.prototype,"editable",void 0),qr([Me],r.prototype,"draggable",void 0),qr([Me],r.prototype,"labelWidth",void 0),qr([Me],r.prototype,"textOverflowMode",void 0),r}(),td={exports:{}},Mf=td.exports,My;function kB(){return My||(My=1,function(r){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||function(e){if("Element"in e){var t="classList",n="prototype",i=e.Element[n],o=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},l=Array[n].indexOf||function(b){for(var _=0,x=this.length;_<x;_++)if(_ in this&&this[_]===b)return _;return-1},d=function(b,_){this.name=b,this.code=DOMException[b],this.message=_},c=function(b,_){if(_==="")throw new d("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(_))throw new d("INVALID_CHARACTER_ERR","String contains an invalid character");return l.call(b,_)},f=function(b){for(var _=s.call(b.getAttribute("class")||""),x=_?_.split(/\s+/):[],w=0,C=x.length;w<C;w++)this.push(x[w]);this._updateClassName=function(){b.setAttribute("class",this.toString())}},v=f[n]=[],g=function(){return new f(this)};if(d[n]=Error[n],v.item=function(b){return this[b]||null},v.contains=function(b){return b+="",c(this,b)!==-1},v.add=function(){var b=arguments,_=0,x=b.length,w,C=!1;do w=b[_]+"",c(this,w)===-1&&(this.push(w),C=!0);while(++_<x);C&&this._updateClassName()},v.remove=function(){var b=arguments,_=0,x=b.length,w,C=!1,k;do for(w=b[_]+"",k=c(this,w);k!==-1;)this.splice(k,1),C=!0,k=c(this,w);while(++_<x);C&&this._updateClassName()},v.toggle=function(b,_){b+="";var x=this.contains(b),w=x?_!==!0&&"remove":_!==!1&&"add";return w&&this[w](b),_===!0||_===!1?_:!x},v.toString=function(){return this.join(" ")},o.defineProperty){var y={get:g,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,y)}catch(b){b.number===-2146823252&&(y.enumerable=!1,o.defineProperty(i,t,y))}}else o[n].__defineGetter__&&i.__defineGetter__(t,g)}}(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(i){var o=function(R){return Object.prototype.toString.call(R).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},l=function(F,z,ie){this.data=F,this.size=F.length,this.type=z,this.encoding=ie},d=s.prototype,c=l.prototype,f=i.FileReaderSync,v=function(R){this.code=this[this.name=R]},g="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),y=g.length,b=i.URL||i.webkitURL||i,_=b.createObjectURL,x=b.revokeObjectURL,w=b,C=i.btoa,k=i.atob,D=i.ArrayBuffer,I=i.Uint8Array,$=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(l.fake=c.fake=!0;y--;)v.prototype[g[y]]=y+1;return b.createObjectURL||(w=i.URL=function(R){var F=document.createElementNS("http://www.w3.org/1999/xhtml","a"),z;return F.href=R,"origin"in F||(F.protocol.toLowerCase()==="data:"?F.origin=null:(z=R.match($),F.origin=z&&z[1])),F}),w.createObjectURL=function(R){var F=R.type,z;if(F===null&&(F="application/octet-stream"),R instanceof l)return z="data:"+F,R.encoding==="base64"?z+";base64,"+R.data:R.encoding==="URI"?z+","+decodeURIComponent(R.data):C?z+";base64,"+C(R.data):z+","+encodeURIComponent(R.data);if(_)return _.call(b,R)},w.revokeObjectURL=function(R){R.substring(0,5)!=="data:"&&x&&x.call(b,R)},d.append=function(R){var F=this.data;if(I&&(R instanceof D||R instanceof I)){for(var z="",ie=new I(R),G=0,Q=ie.length;G<Q;G++)z+=String.fromCharCode(ie[G]);F.push(z)}else if(o(R)==="Blob"||o(R)==="File")if(f){var T=new f;F.push(T.readAsBinaryString(R))}else throw new v("NOT_READABLE_ERR");else R instanceof l?R.encoding==="base64"&&k?F.push(k(R.data)):R.encoding==="URI"?F.push(decodeURIComponent(R.data)):R.encoding==="raw"&&F.push(R.data):(typeof R!="string"&&(R+=""),F.push(unescape(encodeURIComponent(R))))},d.getBlob=function(R){return arguments.length||(R=null),new l(this.data.join(""),R,"raw")},d.toString=function(){return"[object BlobBuilder]"},c.slice=function(R,F,z){var ie=arguments.length;return ie<3&&(z=null),new l(this.data.slice(R,ie>1?F:this.data.length),z,this.encoding)},c.toString=function(){return"[object Blob]"},c.close=function(){this.size=0,delete this.data},s}(e);e.Blob=function(i,o){var s=o&&o.type||"",l=new t;if(i)for(var d=0,c=i.length;d<c;d++)Uint8Array&&i[d]instanceof Uint8Array?l.append(i[d].buffer):l.append(i[d]);var f=l.getBlob(s);return!f.slice&&f.webkitSlice&&(f.slice=f.webkitSlice),f};var n=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=n(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||Mf.content||Mf),function(e,t){var n=typeof process<"u"&&process&&process.versions&&process.versions.electron;n?e.MediumEditor=t:r.exports=t}(Mf,function(){function e(t,n){return this.init(t,n)}return e.extensions={},function(t){function n(d,c){var f,v=Array.prototype.slice.call(arguments,2);c=c||{};for(var g=0;g<v.length;g++){var y=v[g];if(y)for(f in y)y.hasOwnProperty(f)&&typeof y[f]<"u"&&(d||c.hasOwnProperty(f)===!1)&&(c[f]=y[f])}return c}var i=!1;try{var o=document.createElement("div"),s=document.createTextNode(" ");o.appendChild(s),i=o.contains(s)}catch{}var l={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(d){return!!(l.isMac&&d.metaKey||!l.isMac&&d.ctrlKey)},isKey:function(d,c){var f=l.getKeyCode(d);return Array.isArray(c)===!1?f===c:c.indexOf(f)!==-1},getKeyCode:function(d){var c=d.which;return c===null&&(c=d.charCode!==null?d.charCode:d.keyCode),c},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var c=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,c)},defaults:function(){var c=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,c)},createLink:function(d,c,f,v){var g=d.createElement("a");return l.moveTextRangeIntoElement(c[0],c[c.length-1],g),g.setAttribute("href",f),v&&(v==="_blank"&&g.setAttribute("rel","noopener noreferrer"),g.setAttribute("target",v)),g},findOrCreateMatchingTextNodes:function(d,c,f){for(var v=d.createTreeWalker(c,NodeFilter.SHOW_ALL,null,!1),g=[],y=0,b=!1,_=null,x=null;(_=v.nextNode())!==null;)if(!(_.nodeType>3))if(_.nodeType===3){if(!b&&f.start<y+_.nodeValue.length&&(b=!0,x=l.splitStartNodeIfNeeded(_,f.start,y)),b&&l.splitEndNodeIfNeeded(_,x,f.end,y),b&&y===f.end)break;if(b&&y>f.end+1)throw new Error("PerformLinking overshot the target!");b&&g.push(x||_),y+=_.nodeValue.length,x!==null&&(y+=x.nodeValue.length,v.nextNode()),x=null}else _.tagName.toLowerCase()==="img"&&(!b&&f.start<=y&&(b=!0),b&&g.push(_));return g},splitStartNodeIfNeeded:function(d,c,f){return c!==f?d.splitText(c-f):null},splitEndNodeIfNeeded:function(d,c,f,v){var g,y;g=v+d.nodeValue.length+(c?c.nodeValue.length:0)-1,y=f-v-(c?d.nodeValue.length:0),g>=f&&v!==g&&y!==0&&(c||d).splitText(y)},splitByBlockElements:function(d){if(d.nodeType!==3&&d.nodeType!==1)return[];var c=[],f=e.util.blockContainerElementNames.join(",");if(d.nodeType===3||d.querySelectorAll(f).length===0)return[d];for(var v=0;v<d.childNodes.length;v++){var g=d.childNodes[v];if(g.nodeType===3)c.push(g);else if(g.nodeType===1){var y=g.querySelectorAll(f);y.length===0?c.push(g):c=c.concat(e.util.splitByBlockElements(g))}}return c},findAdjacentTextNodeWithContent:function(c,f,v){var g=!1,y,b=v.createNodeIterator(c,NodeFilter.SHOW_TEXT,null,!1);for(y=b.nextNode();y;){if(y===f)g=!0;else if(g&&y.nodeType===3&&y.nodeValue&&y.nodeValue.trim().length>0)break;y=b.nextNode()}return y},findPreviousSibling:function(d){if(!d||l.isMediumEditorElement(d))return!1;for(var c=d.previousSibling;!c&&!l.isMediumEditorElement(d.parentNode);)d=d.parentNode,c=d.previousSibling;return c},isDescendant:function(c,f,v){if(!c||!f)return!1;if(c===f)return!!v;if(c.nodeType!==1)return!1;if(i||f.nodeType!==3)return c.contains(f);for(var g=f.parentNode;g!==null;){if(g===c)return!0;g=g.parentNode}return!1},isElement:function(c){return!!(c&&c.nodeType===1)},throttle:function(d,c){var f=50,v,g,y,b=null,_=0,x=function(){_=Date.now(),b=null,y=d.apply(v,g),b||(v=g=null)};return!c&&c!==0&&(c=f),function(){var w=Date.now(),C=c-(w-_);return v=this,g=arguments,C<=0||C>c?(b&&(clearTimeout(b),b=null),_=w,y=d.apply(v,g),b||(v=g=null)):b||(b=setTimeout(x,C)),y}},traverseUp:function(d,c){if(!d)return!1;do{if(d.nodeType===1){if(c(d))return d;if(l.isMediumEditorElement(d))return!1}d=d.parentNode}while(d);return!1},htmlEntities:function(d){return String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(d,c){var f,v,g,y,b,_,x,w=!1,C=["insertHTML",!1,c];if(!e.util.isEdge&&d.queryCommandSupported("insertHTML"))try{return d.execCommand.apply(d,C)}catch{}if(f=d.getSelection(),f.rangeCount){if(v=f.getRangeAt(0),x=v.commonAncestorContainer,l.isMediumEditorElement(x)&&!x.firstChild)v.selectNode(x.appendChild(d.createTextNode("")));else if(x.nodeType===3&&v.startOffset===0&&v.endOffset===x.nodeValue.length||x.nodeType!==3&&x.innerHTML===v.toString()){for(;!l.isMediumEditorElement(x)&&x.parentNode&&x.parentNode.childNodes.length===1&&!l.isMediumEditorElement(x.parentNode);)x=x.parentNode;v.selectNode(x)}for(v.deleteContents(),g=d.createElement("div"),g.innerHTML=c,y=d.createDocumentFragment();g.firstChild;)b=g.firstChild,_=y.appendChild(b);v.insertNode(y),_&&(v=v.cloneRange(),v.setStartAfter(_),v.collapse(!0),e.selection.selectRange(d,v)),w=!0}return d.execCommand.callListeners&&d.execCommand.callListeners(C,w),w},execFormatBlock:function(d,c){var f=l.getTopBlockContainer(e.selection.getSelectionStart(d)),v;if(c==="blockquote"){if(f&&(v=Array.prototype.slice.call(f.childNodes),v.some(function(g){return l.isBlockContainer(g)})))return d.execCommand("outdent",!1,null);if(l.isIE)return d.execCommand("indent",!1,c)}if(f&&c===f.nodeName.toLowerCase()&&(c="p"),l.isIE&&(c="<"+c+">"),f&&f.nodeName.toLowerCase()==="blockquote"){if(l.isIE&&c==="<p>")return d.execCommand("outdent",!1,c);if((l.isFF||l.isEdge)&&c==="p")return v=Array.prototype.slice.call(f.childNodes),v.some(function(g){return!l.isBlockContainer(g)})&&d.execCommand("formatBlock",!1,c),d.execCommand("outdent",!1,c)}return d.execCommand("formatBlock",!1,c)},setTargetBlank:function(d,c){var f,v=c||!1;if(d.nodeName.toLowerCase()==="a")d.target="_blank",d.rel="noopener noreferrer";else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)(v===!1||v===d[f].attributes.href.value)&&(d[f].target="_blank",d[f].rel="noopener noreferrer")},removeTargetBlank:function(d,c){var f;if(d.nodeName.toLowerCase()==="a")d.removeAttribute("target"),d.removeAttribute("rel");else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)c===d[f].attributes.href.value&&(d[f].removeAttribute("target"),d[f].removeAttribute("rel"))},addClassToAnchors:function(d,c){var f=c.split(" "),v,g;if(d.nodeName.toLowerCase()==="a")for(g=0;g<f.length;g+=1)d.classList.add(f[g]);else{var y=d.getElementsByTagName("a");if(y.length===0){var b=l.getClosestTag(d,"a");d=b?[b]:[]}else d=y;for(v=0;v<d.length;v+=1)for(g=0;g<f.length;g+=1)d[v].classList.add(f[g])}},isListItem:function(d){if(!d)return!1;if(d.nodeName.toLowerCase()==="li")return!0;for(var c=d.parentNode,f=c.nodeName.toLowerCase();f==="li"||!l.isBlockContainer(c)&&f!=="div";){if(f==="li")return!0;if(c=c.parentNode,c)f=c.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(d,c){if(c.nodeName.toLowerCase()==="li"){var f=c.parentElement;f.parentElement.nodeName.toLowerCase()==="p"&&(l.unwrap(f.parentElement,d),e.selection.moveCursor(d,c.firstChild,c.firstChild.textContent.length))}},splitOffDOMTree:function(d,c,f){for(var v=c,g=null,y=!f;v!==d;){var b=v.parentNode,_=b.cloneNode(!1),x=y?v:b.firstChild,w;for(g&&(y?_.appendChild(g):w=g),g=_;x;){var C=x.nextSibling;x===v?(x.hasChildNodes()?x=x.cloneNode(!1):x.parentNode.removeChild(x),x.textContent&&g.appendChild(x),x=y?C:null):(x.parentNode.removeChild(x),(x.hasChildNodes()||x.textContent)&&g.appendChild(x),x=C)}w&&g.appendChild(w),v=b}return g},moveTextRangeIntoElement:function(d,c,f){if(!d||!c)return!1;var v=l.findCommonRoot(d,c);if(!v)return!1;if(c===d){var g=d.parentNode,y=d.nextSibling;return g.removeChild(d),f.appendChild(d),y?g.insertBefore(f,y):g.appendChild(f),f.hasChildNodes()}for(var b=[],_,x,w,C=0;C<v.childNodes.length;C++)if(w=v.childNodes[C],!_)l.isDescendant(w,d,!0)&&(_=w);else if(l.isDescendant(w,c,!0)){x=w;break}else b.push(w);var k=x.nextSibling,D=v.ownerDocument.createDocumentFragment();return _===d?(_.parentNode.removeChild(_),D.appendChild(_)):D.appendChild(l.splitOffDOMTree(_,d)),b.forEach(function(I){I.parentNode.removeChild(I),D.appendChild(I)}),x===c?(x.parentNode.removeChild(x),D.appendChild(x)):D.appendChild(l.splitOffDOMTree(x,c,!0)),f.appendChild(D),x.parentNode===v?v.insertBefore(f,x):k?v.insertBefore(f,k):v.appendChild(f),f.hasChildNodes()},depthOfNode:function(d){for(var c=0,f=d;f.parentNode!==null;)f=f.parentNode,c++;return c},findCommonRoot:function(d,c){for(var f=l.depthOfNode(d),v=l.depthOfNode(c),g=d,y=c;f!==v;)f>v?(g=g.parentNode,f-=1):(y=y.parentNode,v-=1);for(;g!==y;)g=g.parentNode,y=y.parentNode;return g},isElementAtBeginningOfBlock:function(d){for(var c,f;!l.isBlockContainer(d)&&!l.isMediumEditorElement(d);){for(f=d;f=f.previousSibling;)if(c=f.nodeType===3?f.nodeValue:f.textContent,c.length>0)return!1;d=d.parentNode}return!0},isMediumEditorElement:function(d){return d&&d.getAttribute&&!!d.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(d){return l.traverseUp(d,function(c){return l.isMediumEditorElement(c)})},isBlockContainer:function(d){return d&&d.nodeType!==3&&l.blockContainerElementNames.indexOf(d.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(d){return l.traverseUp(d,function(c){return l.isBlockContainer(c)||l.isMediumEditorElement(c)})},getTopBlockContainer:function(d){var c=l.isBlockContainer(d)?d:!1;return l.traverseUp(d,function(f){return l.isBlockContainer(f)&&(c=f),!c&&l.isMediumEditorElement(f)?(c=f,!0):!1}),c},getFirstSelectableLeafNode:function(d){for(;d&&d.firstChild;)d=d.firstChild;if(d=l.traverseUp(d,function(f){return l.emptyElementNames.indexOf(f.nodeName.toLowerCase())===-1}),d.nodeName.toLowerCase()==="table"){var c=d.querySelector("th, td");c&&(d=c)}return d},getFirstTextNode:function(d){return l.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),l._getFirstTextNode(d)},_getFirstTextNode:function(d){if(d.nodeType===3)return d;for(var c=0;c<d.childNodes.length;c++){var f=l._getFirstTextNode(d.childNodes[c]);if(f!==null)return f}return null},ensureUrlHasProtocol:function(d){return d.indexOf("://")===-1?"http://"+d:d},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(d,c,f){var v=d+" is deprecated, please use "+c+" instead.";f&&(v+=" Will be removed in "+f),l.warn(v)},deprecatedMethod:function(d,c,f,v){l.deprecated(d,c,v),typeof this[c]=="function"&&this[c].apply(this,f)},cleanupAttrs:function(d,c){c.forEach(function(f){d.removeAttribute(f)})},cleanupTags:function(d,c){c.indexOf(d.nodeName.toLowerCase())!==-1&&d.parentNode.removeChild(d)},unwrapTags:function(d,c){c.indexOf(d.nodeName.toLowerCase())!==-1&&e.util.unwrap(d,document)},getClosestTag:function(d,c){return l.traverseUp(d,function(f){return f.nodeName.toLowerCase()===c.toLowerCase()})},unwrap:function(d,c){for(var f=c.createDocumentFragment(),v=Array.prototype.slice.call(d.childNodes),g=0;g<v.length;g++)f.appendChild(v[g]);f.childNodes.length?d.parentNode.replaceChild(f,d):d.parentNode.removeChild(d)},guid:function(){function d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}};e.util=l}(window),function(){var t=function(n){e.util.extend(this,n)};t.extend=function(n){var i=this,o;n&&n.hasOwnProperty("constructor")?o=n.constructor:o=function(){return i.apply(this,arguments)},e.util.extend(o,i);var s=function(){this.constructor=o};return s.prototype=i.prototype,o.prototype=new s,n&&e.util.extend(o.prototype,n),o},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(n){return this.base.options[n]}},["execAction","on","off","subscribe","trigger"].forEach(function(n){t.prototype[n]=function(){return this.base[n].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(i,o){var s=o.getSelection(),l,d;return s.rangeCount===0?!1:(l=s.getRangeAt(0),d=l.commonAncestorContainer,e.util.traverseUp(d,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(o){return e.util.isMediumEditorElement(o)},i)},exportSelection:function(i,o){if(!i)return null;var s=null,l=o.getSelection();if(l.rangeCount>0){var d=l.getRangeAt(0),c=d.cloneRange(),f;c.selectNodeContents(i),c.setEnd(d.startContainer,d.startOffset),f=c.toString().length,s={start:f,end:f+d.toString().length},this.doesRangeStartWithImages(d,o)&&(s.startsWithImage=!0);var v=this.getTrailingImageCount(i,s,d.endContainer,d.endOffset);if(v&&(s.trailingImageCount=v),f!==0){var g=this.getIndexRelativeToAdjacentEmptyBlocks(o,i,d.startContainer,d.startOffset);g!==-1&&(s.emptyBlocksIndex=g)}}return s},importSelection:function(i,o,s,l){if(!(!i||!o)){var d=s.createRange();d.setStart(o,0),d.collapse(!0);var c=o,f=[],v=0,g=!1,y=!1,b=0,_=!1,x,w=!1,C=null;for((l||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(w=!0);!_&&c;){if(c.nodeType>3){c=f.pop();continue}if(c.nodeType===3&&!y)x=v+c.length,!g&&i.start>=v&&i.start<=x&&(w||i.start<x?(d.setStart(c,i.start-v),g=!0):C=c),g&&i.end>=v&&i.end<=x&&(i.trailingImageCount?y=!0:(d.setEnd(c,i.end-v),_=!0)),v=x;else{if(i.trailingImageCount&&y&&(c.nodeName.toLowerCase()==="img"&&b++,b===i.trailingImageCount)){for(var k=0;c.parentNode.childNodes[k]!==c;)k++;d.setEnd(c.parentNode,k+1),_=!0}if(!_&&c.nodeType===1)for(var D=c.childNodes.length-1;D>=0;)f.push(c.childNodes[D]),D-=1}_||(c=f.pop())}!g&&C&&(d.setStart(C,C.length),d.setEnd(C,C.length)),typeof i.emptyBlocksIndex<"u"&&(d=this.importSelectionMoveCursorPastBlocks(s,o,i.emptyBlocksIndex,d)),l&&(d=this.importSelectionMoveCursorPastAnchor(i,d)),this.selectRange(s,d)}},importSelectionMoveCursorPastAnchor:function(i,o){var s=function(v){return v.nodeName.toLowerCase()==="a"};if(i.start===i.end&&o.startContainer.nodeType===3&&o.startOffset===o.startContainer.nodeValue.length&&e.util.traverseUp(o.startContainer,s)){for(var l=o.startContainer,d=o.startContainer.parentNode;d!==null&&d.nodeName.toLowerCase()!=="a";)d.childNodes[d.childNodes.length-1]!==l?d=null:(l=d,d=d.parentNode);if(d!==null&&d.nodeName.toLowerCase()==="a"){for(var c=null,f=0;c===null&&f<d.parentNode.childNodes.length;f++)d.parentNode.childNodes[f]===d&&(c=f);o.setStart(d.parentNode,c+1),o.collapse(!0)}}return o},importSelectionMoveCursorPastBlocks:function(i,o,s,l){var d=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),c=l.startContainer,f,v,g=0;for(s=s||1,c.nodeType===3&&e.util.isBlockContainer(c.previousSibling)?f=c.previousSibling:f=e.util.getClosestBlockContainer(c);d.nextNode();)if(!v)f===d.currentNode&&(v=d.currentNode);else if(v=d.currentNode,g++,g===s||v.textContent.length>0)break;return v||(v=f),l.setStart(e.util.getFirstSelectableLeafNode(v),0),l},getIndexRelativeToAdjacentEmptyBlocks:function(i,o,s,l){if(s.textContent.length>0&&l>0)return-1;var d=s;if(d.nodeType!==3&&(d=s.childNodes[l]),d){if(!e.util.isElementAtBeginningOfBlock(d))return-1;var c=e.util.findPreviousSibling(d);if(c){if(c.nodeValue)return-1}else return-1}for(var f=e.util.getClosestBlockContainer(s),v=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),g=0;v.nextNode();){var y=v.currentNode.textContent==="";if((y||g>0)&&(g+=1),v.currentNode===f)return g;y||(g=0)}return g},doesRangeStartWithImages:function(i,o){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var s=i.startContainer.querySelector("img");if(!s)return!1;for(var l=o.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);l.nextNode();){var d=l.currentNode;if(d===s)break;if(d.nodeValue)return!1}return!0},getTrailingImageCount:function(i,o,s,l){if(l===0||s.nodeType!==1||s.nodeName.toLowerCase()!=="img"&&!s.querySelector("img"))return 0;for(var d=s.childNodes[l-1];d.hasChildNodes();)d=d.lastChild;for(var c=i,f=[],v=0,g=!1,y=!1,b=!1,_,x=0;!b&&c;){if(c.nodeType>3){c=f.pop();continue}if(c.nodeType===3&&!y)x=0,_=v+c.length,!g&&o.start>=v&&o.start<=_&&(g=!0),g&&o.end>=v&&o.end<=_&&(y=!0),v=_;else if(c.nodeName.toLowerCase()==="img"&&x++,c===d)b=!0;else if(c.nodeType===1)for(var w=c.childNodes.length-1;w>=0;)f.push(c.childNodes[w]),w-=1;b||(c=f.pop())}return x},selectionContainsContent:function(i){var o=i.getSelection();if(!o||o.isCollapsed||!o.rangeCount)return!1;if(o.toString().trim()!=="")return!0;var s=this.getSelectedParentElement(o.getRangeAt(0));return!!(s&&(s.nodeName.toLowerCase()==="img"||s.nodeType===1&&s.querySelector("img")))},selectionInContentEditableFalse:function(i){var o,s=this.findMatchingSelectionParent(function(l){var d=l&&l.getAttribute("contenteditable");return d==="true"&&(o=!0),l.nodeName!=="#text"&&d==="false"},i);return!o&&s},getSelectionHtml:function(o){var s,l="",d=o.getSelection(),c,f;if(d.rangeCount){for(f=o.createElement("div"),s=0,c=d.rangeCount;s<c;s+=1)f.appendChild(d.getRangeAt(s).cloneContents());l=f.innerHTML}return l},getCaretOffsets:function(o,s){var l,d;return s||(s=window.getSelection().getRangeAt(0)),l=s.cloneRange(),d=s.cloneRange(),l.selectNodeContents(o),l.setEnd(s.endContainer,s.endOffset),d.selectNodeContents(o),d.setStart(s.endContainer,s.endOffset),{left:l.toString().length,right:d.toString().length}},rangeSelectsSingleNode:function(i){var o=i.startContainer;return o===i.endContainer&&o.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var o=i.getSelection(),s,l,d;if(!o.rangeCount||o.isCollapsed||!o.getRangeAt(0).commonAncestorContainer)return[];if(s=o.getRangeAt(0),s.commonAncestorContainer.nodeType===3){for(l=[],d=s.commonAncestorContainer;d.parentNode&&d.parentNode.childNodes.length===1;)l.push(d.parentNode),d=d.parentNode;return l}return[].filter.call(s.commonAncestorContainer.getElementsByTagName("*"),function(c){return typeof o.containsNode=="function"?o.containsNode(c,!0):!0})},selectNode:function(i,o){var s=o.createRange();s.selectNodeContents(i),this.selectRange(o,s)},select:function(i,o,s,l,d){var c=i.createRange();return c.setStart(o,s),l?c.setEnd(l,d):c.collapse(!0),this.selectRange(i,c),c},clearSelection:function(i,o){o?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,o,s){this.select(i,o,s)},getSelectionRange:function(i){var o=i.getSelection();return o.rangeCount===0?null:o.getRangeAt(0)},selectRange:function(i,o){var s=i.getSelection();s.removeAllRanges(),s.addRange(o)},getSelectionStart:function(i){var o=i.getSelection().anchorNode,s=o&&o.nodeType===3?o.parentNode:o;return s}};e.selection=n}(),function(){function t(i,o){return i?i.some(function(s){if(typeof s.getInteractionElements!="function")return!1;var l=s.getInteractionElements();return l?(Array.isArray(l)||(l=[l]),l.some(function(d){return e.util.isDescendant(d,o,!0)})):!1}):!1}var n=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,o,s,l){var d=this.base.options.contentWindow,c=this.base.options.ownerDocument;i=e.util.isElement(i)||[d,c].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(f){f.addEventListener(o,s,l),this.events.push([f,o,s,l])}).bind(this))},detachDOMEvent:function(i,o,s,l){var d,c,f=this.base.options.contentWindow,v=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[f,v].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(g){d=this.indexOfListener(g,o,s,l),d!==-1&&(c=this.events.splice(d,1)[0],c[0].removeEventListener(c[1],c[2],c[3]))}).bind(this)))},indexOfListener:function(i,o,s,l){var d,c,f;for(d=0,c=this.events.length;d<c;d=d+1)if(f=this.events[d],f[0]===i&&f[1]===o&&f[2]===s&&f[3]===l)return d;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var o=this.events.filter(function(c){return c&&c[0].getAttribute&&c[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),s=0,l=o.length;s<l;s++){var d=o[s];this.detachDOMEvent(d[0],d[1],d[2],d[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(o){this.attachDOMEvent(i,o.name,o.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,o){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(o)},detachCustomEvent:function(i,o){var s=this.indexOfCustomListener(i,o);s!==-1&&this.customEvents[i].splice(s,1)},indexOfCustomListener:function(i,o){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(o)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,o,s){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(l){l(o,s)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var o=i.execCommand.listeners.indexOf(this.execCommandListener);o!==-1&&i.execCommand.listeners.splice(o,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var o=function(l,d){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(c){c({command:l[0],value:l[2],args:l,result:d})})},s=function(){var l=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return l;var d=Array.prototype.slice.call(arguments);return o(d,l),l};s.orig=i.execCommand,s.listeners=[],s.callListeners=o,i.execCommand=s}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(o){this.contentCache[o.getAttribute("medium-editor-index")]=o.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,o){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(s){this.attachDOMEvent(s,i,o.bind(this))},this),this.eventsCache.push({name:i,handler:o})},cleanupElement:function(i){var o=i.getAttribute("medium-editor-index");o&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[o])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,o){var s=this.base.getFocusedElement(),l;s&&o.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(s,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(l=s),l||this.base.elements.some(function(c){return!l&&e.util.isDescendant(c,i,!0)&&(l=c),!!l},this);var d=!e.util.isDescendant(s,i,!0)&&!t(this.base.extensions,i);l!==s&&(s&&d&&(s.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",o,s)),l&&(l.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",o,l))),d&&this.triggerCustomEvent("externalInteraction",o)},updateInput:function(i,o){if(this.contentCache){var s=i.getAttribute("medium-editor-index"),l=i.innerHTML;l!==this.contentCache[s]&&this.triggerCustomEvent("editableInput",o,i),this.contentCache[s]=l}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var o=i.currentTarget.activeElement,s;this.base.elements.some(function(l){return e.util.isDescendant(l,o,!0)?(s=l,!0):!1},this),s&&this.updateInput(s,{target:o,currentTarget:s})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var o={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(o.currentTarget,o)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=n}(),function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(n){t.isBuiltInButton(n)?e.Extension.call(this,this.defaults[n]):e.Extension.call(this,n)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var n=this.document.createElement("button"),i=this.contentDefault,o=this.getAria(),s=this.getEditorOption("buttonLabels");return n.classList.add("medium-editor-action"),n.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(l){n.classList.add(l)}),n.setAttribute("data-action",this.getAction()),o&&(n.setAttribute("title",o),n.setAttribute("aria-label",o)),this.attrs&&Object.keys(this.attrs).forEach(function(l){n.setAttribute(l,this.attrs[l])},this),s==="fontawesome"&&this.contentFA&&(i=this.contentFA),n.innerHTML=i,n},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var n=null;return this.useQueryState&&(n=this.base.queryCommandState(this.getAction())),n},isAlreadyApplied:function(n){var i=!1,o=this.getTagNames(),s,l;return this.knownState===!1||this.knownState===!0?this.knownState:(o&&o.length>0&&(i=o.indexOf(n.nodeName.toLowerCase())!==-1),!i&&this.style&&(s=this.style.value.split("|"),l=this.window.getComputedStyle(n,null).getPropertyValue(this.style.prop),s.forEach(function(d){this.knownState||(i=l.indexOf(d)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(n){return typeof n=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(n)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.hideToolbarDefaultActions()},setToolbarPosition:function(){var n=this.base.getExtensionByName("toolbar");n&&n.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(n){e.util.isKey(n,e.util.keyCode.K)&&e.util.isMetaCtrlKey(n)&&!n.shiftKey&&this.handleClick(n)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var n=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return n.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),n.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),n.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(n){var i=this.getInput(),o=this.getAnchorTargetCheckbox(),s=this.getAnchorButtonCheckbox();if(n=n||{value:""},typeof n=="string"&&(n={value:n}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=n.value,i.focus(),o&&(o.checked=n.target==="_blank"),s){var l=n.buttonClass?n.buttonClass.split(" "):[];s.checked=l.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var n=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),o={value:this.getInput().value.trim()};return this.linkValidation&&(o.value=this.checkLinkFormat(o.value)),o.target="_self",n&&n.checked&&(o.target="_blank"),i&&i.checked&&(o.buttonClass=this.customClassOption),o},doFormSave:function(){var n=this.getFormOpts();this.completeFormSave(n)},completeFormSave:function(n){this.base.restoreSelection(),this.execAction(this.action,n),this.base.checkSelection()},ensureEncodedUri:function(n){return n===decodeURI(n)?encodeURI(n):n},ensureEncodedUriComponent:function(n){return n===decodeURIComponent(n)?encodeURIComponent(n):n},ensureEncodedParam:function(n){var i=n.split("="),o=i[0],s=i[1];return o+(s===void 0?"":"="+this.ensureEncodedUriComponent(s))},ensureEncodedQuery:function(n){return n.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(n){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,o=i.test(n),s="",l=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,d=n.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),c=d[1],f=d[2],v=d[3];if(l.test(n))return"tel:"+n;if(!o){var g=c.split("/")[0];(g.match(/.+(\.|:).+/)||g==="localhost")&&(s="http://")}return s+this.ensureEncodedUri(c)+(f===void 0?"":"?"+this.ensureEncodedQuery(f))+(v===void 0?"":"#"+v)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(n){var i=n.querySelector(".medium-editor-toolbar-close"),o=n.querySelector(".medium-editor-toolbar-save"),s=n.querySelector(".medium-editor-toolbar-input");this.on(n,"click",this.handleFormClick.bind(this)),this.on(s,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(o,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var n=this.document,i=n.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(n){if(n.keyCode===e.util.keyCode.ENTER){n.preventDefault(),this.doFormSave();return}n.keyCode===e.util.keyCode.ESCAPE&&(n.preventDefault(),this.doFormCancel())},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var n=this.document.createElement("div");return n.id="medium-editor-anchor-preview-"+this.getEditorId(),n.className="medium-editor-anchor-preview",n.innerHTML=this.getTemplate(),this.on(n,"click",this.handleClick.bind(this)),n},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(n){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||n.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=n.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=n.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=n,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(n){n=n||this.activeAnchor;var i=this.window.innerWidth,o=this.anchorPreview.offsetHeight,s=n.getBoundingClientRect(),l=this.diffLeft,d=this.diffTop,c=this.getEditorOption("elementsContainer"),f=["absolute","fixed"].indexOf(window.getComputedStyle(c).getPropertyValue("position"))>-1,v={},g,y,b,_,x;g=this.anchorPreview.offsetWidth/2;var w=this.base.getExtensionByName("toolbar");w&&(l=w.diffLeft,d=w.diffTop),y=l-g,f?(_=c.getBoundingClientRect(),["top","left"].forEach(function(C){v[C]=s[C]-_[C]}),v.width=s.width,v.height=s.height,s=v,i=_.width,x=c.scrollTop):x=this.window.pageYOffset,b=s.left+s.width/2,x+=o+s.top+s.height-d-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(x)+"px",this.anchorPreview.style.right="initial",b<g?(this.anchorPreview.style.left=y+g+"px",this.anchorPreview.style.right="initial"):i-b<g?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=y+b+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(n){var i=this.base.getExtensionByName("anchor"),o=this.activeAnchor;i&&o&&(n.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(o){var s={value:o.attributes.href.value,target:o.getAttribute("target"),buttonClass:o.getAttribute("class")};i.showForm(s),o=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(n){var i=e.util.getClosestTag(n.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var o=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&o&&o.isDisplayed&&o.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(n){(!n.relatedTarget||!/anchor-preview/.test(n.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var n=new Date().getTime()-this.lastOver;n>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){var t,n,i,o,s;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+n+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",o=new RegExp("^("+n+")$","i"),s=new RegExp(i,"gi");function l(c){return!e.util.getClosestTag(c,"a")}var d=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var c=0,f=0;f<this.window._mediumEditors.length;f++){var v=this.window._mediumEditors[f];v!==null&&v.getExtensionByName("autoLink")!==void 0&&c++}return c===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(c,f){this.performLinking(f)},onKeypress:function(c){this.disableEventHandling||e.util.isKey(c,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var f=this.base.exportSelection();this.performLinking(c.target)&&this.base.importSelection(f,!0)}catch(v){window.console&&window.console.error("Failed to perform linking",v),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(c){var f=e.util.splitByBlockElements(c),v=!1;f.length===0&&(f=[c]);for(var g=0;g<f.length;g++)v=this.removeObsoleteAutoLinkSpans(f[g])||v,v=this.performLinkingWithinElement(f[g])||v;return this.base.events.updateInput(c,{target:c,currentTarget:c}),v},removeObsoleteAutoLinkSpans:function(c){if(!c||c.nodeType===3)return!1;for(var f=c.querySelectorAll('span[data-auto-link="true"]'),v=!1,g=0;g<f.length;g++){var y=f[g].textContent;if(y.indexOf("://")===-1&&(y=e.util.ensureUrlHasProtocol(y)),f[g].getAttribute("data-href")!==y&&l(f[g])){v=!0;var b=y.replace(/\s+$/,"");if(f[g].getAttribute("data-href")===b){var _=y.length-b.length,x=e.util.splitOffDOMTree(f[g],this.splitTextBeforeEnd(f[g],_));f[g].parentNode.insertBefore(x,f[g].nextSibling)}else e.util.unwrap(f[g],this.document)}}return v},splitTextBeforeEnd:function(c,f){for(var v=this.document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null,!1),g=!0;g;)g=v.lastChild()!==null;for(var y,b,_;f>0&&_!==null;)y=v.currentNode,b=y.nodeValue,b.length>f?(_=y.splitText(b.length-f),f=0):(_=v.previousNode(),f-=b.length);return _},performLinkingWithinElement:function(c){for(var f=this.findLinkableText(c),v=!1,g=0;g<f.length;g++){var y=e.util.findOrCreateMatchingTextNodes(this.document,c,f[g]);this.shouldNotLink(y)||this.createAutoLink(y,f[g].href)}return v},shouldNotLink:function(c){for(var f=!1,v=0;v<c.length&&f===!1;v++)f=!!e.util.traverseUp(c[v],function(g){return g.nodeName.toLowerCase()==="a"||g.getAttribute&&g.getAttribute("data-auto-link")==="true"});return f},findLinkableText:function(c){for(var f=c.textContent,v=null,g=[];(v=s.exec(f))!==null;){var y=!0,b=v.index+v[0].length;y=(v.index===0||t.indexOf(f[v.index-1])!==-1)&&(b===f.length||t.indexOf(f[b])!==-1),y=y&&(v[0].indexOf("/")!==-1||o.test(v[0].split(".").pop().split("?").shift())),y&&g.push({href:v[0],start:v.index,end:b})}return g},createAutoLink:function(c,f){f=e.util.ensureUrlHasProtocol(f);var v=e.util.createLink(this.document,c,f,this.getEditorOption("targetBlank")?"_blank":null),g=this.document.createElement("span");for(g.setAttribute("data-auto-link","true"),g.setAttribute("data-href",f),v.insertBefore(g,v.firstChild);v.childNodes.length>1;)g.appendChild(v.childNodes[1])}});e.extensions.autoLink=d}(),function(){var t="medium-editor-dragover";function n(o){var s=e.util.getContainerEditorElement(o),l=Array.prototype.slice.call(s.parentElement.querySelectorAll("."+t));l.forEach(function(d){d.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){o.preventDefault(),o.dataTransfer.dropEffect="copy";var s=o.target.classList?o.target:o.target.parentElement;n(s),o.type==="dragover"&&s.classList.add(t)},handleDrop:function(o){o.preventDefault(),o.stopPropagation(),this.base.selectElement(o.target);var s=this.base.exportSelection();s.start=s.end,this.base.importSelection(s),o.dataTransfer.files&&Array.prototype.slice.call(o.dataTransfer.files).forEach(function(l){this.isAllowedFile(l)&&l.type.match("image")&&this.insertImageFile(l)},this),n(o.target)},isAllowedFile:function(o){return this.allowedTypes.some(function(s){return!!o.type.match(s)})},insertImageFile:function(o){if(typeof FileReader=="function"){var s=new FileReader;s.readAsDataURL(o),s.addEventListener("load",(function(l){var d=this.document.createElement("img");d.src=l.target.result,e.util.insertHTMLCommand(this.document,d.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(n){var i=n.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(n)},this)},handleKeydown:function(n){var i=e.util.getKeyCode(n);if(this.keys[i]){var o=e.util.isMetaCtrlKey(n),s=!!n.shiftKey,l=!!n.altKey;this.keys[i].forEach(function(d){d.meta===o&&d.shift===s&&(d.alt===l||d.alt===void 0)&&(n.preventDefault(),n.stopPropagation(),typeof d.command=="function"?d.command.apply(this):d.command!==!1&&this.execAction(d.command))},this)}}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(n){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("select"),s=n.createElement("a"),l=n.createElement("a"),d;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var c=0;c<this.fonts.length;c++)d=n.createElement("option"),d.innerHTML=this.fonts[c],d.value=this.fonts[c],o.appendChild(d);return o.className="medium-editor-toolbar-select",i.appendChild(o),this.on(o,"change",this.handleFontChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("face")&&n.removeAttribute("face")})},handleFontChange:function(){var n=this.getSelect().value;n===""?this.clearFontName():this.execAction("fontName",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(n){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("input"),s=n.createElement("a"),l=n.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),o.setAttribute("type","range"),o.setAttribute("min","1"),o.setAttribute("max","7"),o.className="medium-editor-toolbar-input",i.appendChild(o),this.on(o,"change",this.handleSliderChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("size")&&n.removeAttribute("size")})},handleSliderChange:function(){var n=this.getInput().value;n==="4"?this.clearFontSize():this.execAction("fontSize",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){var t="%ME_PASTEBIN%",n=null,i=null,o=function(c){c.stopPropagation()};function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function l(c,f,v){var g=c.clipboardData||f.clipboardData||v.dataTransfer,y={};if(!g)return y;if(g.getData){var b=g.getData("Text");b&&b.length>0&&(y["text/plain"]=b)}if(g.types)for(var _=0;_<g.types.length;_++){var x=g.types[_];y[x]=g.getData(x)}return y}var d=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(c){this.on(c,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(c,f){this.on(f,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(c,f){if(!c.defaultPrevented){var v=l(c,this.window,this.document),g=v["text/html"],y=v["text/plain"];this.window.clipboardData&&c.clipboardData===void 0&&!g&&(g=y),(g||y)&&(c.preventDefault(),this.doPaste(g,y,f))}},doPaste:function(c,f,v){var g,y="",b;if(this.cleanPastedHTML&&c)return this.cleanPaste(c);if(f){if(this.getEditorOption("disableReturn")||v&&v.getAttribute("data-disable-return"))y=e.util.htmlEntities(f);else if(g=f.split(/[\r\n]+/g),g.length>1)for(b=0;b<g.length;b+=1)g[b]!==""&&(y+="<p>"+e.util.htmlEntities(g[b])+"</p>");else y=e.util.htmlEntities(g[0]);e.util.insertHTMLCommand(this.document,y)}},handlePasteBinPaste:function(c){if(c.defaultPrevented){this.removePasteBin();return}var f=l(c,this.window,this.document),v=f["text/html"],g=f["text/plain"],y=i;if(!this.cleanPastedHTML||v){c.preventDefault(),this.removePasteBin(),this.doPaste(v,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y);return}setTimeout((function(){this.cleanPastedHTML&&(v=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(v,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y)}).bind(this),0)},handleKeydown:function(c,f){e.util.isKey(c,e.util.keyCode.V)&&e.util.isMetaCtrlKey(c)&&(c.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(f))},createPasteBin:function(c){var f,v=e.selection.getSelectionRange(this.document),g=this.window.pageYOffset;i=c,v&&(f=v.getClientRects(),f.length?g+=f[0].top:v.startContainer.getBoundingClientRect!==void 0?g+=v.startContainer.getBoundingClientRect().top:g+=v.getBoundingClientRect().top),n=v;var y=this.document.createElement("div");y.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),y.setAttribute("style","border: 1px red solid; position: absolute; top: "+g+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),y.setAttribute("contentEditable",!0),y.innerHTML=t,this.document.body.appendChild(y),this.on(y,"focus",o),this.on(y,"focusin",o),this.on(y,"focusout",o),y.focus(),e.selection.selectNode(y,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(y,"paste",this.boundHandlePaste)},removePasteBin:function(){n!==null&&(e.selection.selectRange(this.document,n),n=null),i!==null&&(i=null);var c=this.getPasteBin();c&&c&&(this.off(c,"focus",o),this.off(c,"focusin",o),this.off(c,"focusout",o),this.off(c,"paste",this.boundHandlePaste),c.parentElement.removeChild(c))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var c=this.getPasteBin();if(!c||c.firstChild&&c.firstChild.id==="mcepastebin")return!1;var f=c.innerHTML;return!f||f===t?!1:f},cleanPaste:function(c){var f,v,g,y,b=/<p|<br|<div/.test(c),_=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(f=0;f<_.length;f+=1)c=c.replace(_[f][0],_[f][1]);if(!b)return this.pasteHTML(c);for(g=this.document.createElement("div"),g.innerHTML="<p>"+c.split("<br><br>").join("</p><p>")+"</p>",v=g.querySelectorAll("a,p,div,br"),f=0;f<v.length;f+=1)switch(y=v[f],y.innerHTML=y.innerHTML.replace(/\n/gi," "),y.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(y);break;case"br":this.filterLineBreak(y);break}this.pasteHTML(g.innerHTML)},pasteHTML:function(c,f){f=e.util.defaults({},f,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var v,g,y,b,_=this.document.createDocumentFragment();for(_.appendChild(this.document.createElement("body")),b=_.querySelector("body"),b.innerHTML=c,this.cleanupSpans(b),v=b.querySelectorAll("*"),y=0;y<v.length;y+=1)g=v[y],g.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(g),e.util.cleanupAttrs(g,f.cleanAttrs),e.util.cleanupTags(g,f.cleanTags),e.util.unwrapTags(g,f.unwrapTags);e.util.insertHTMLCommand(this.document,b.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(c){return c&&(c.nodeName.toLowerCase()==="p"||c.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(c){/^\s*$/.test(c.textContent)&&c.parentNode&&c.parentNode.removeChild(c)},filterLineBreak:function(c){this.isCommonBlock(c.previousElementSibling)?this.removeWithParent(c):this.isCommonBlock(c.parentNode)&&(c.parentNode.firstChild===c||c.parentNode.lastChild===c)?this.removeWithParent(c):c.parentNode&&c.parentNode.childElementCount===1&&c.parentNode.textContent===""&&this.removeWithParent(c)},removeWithParent:function(c){c&&c.parentNode&&(c.parentNode.parentNode&&c.parentNode.childElementCount===1?c.parentNode.parentNode.removeChild(c.parentNode):c.parentNode.removeChild(c))},cleanupSpans:function(c){var f,v,g,y=c.querySelectorAll(".replace-with"),b=function(_){return _&&_.nodeName!=="#text"&&_.getAttribute("contenteditable")==="false"};for(f=0;f<y.length;f+=1)v=y[f],g=this.document.createElement(v.classList.contains("bold")?"b":"i"),v.classList.contains("bold")&&v.classList.contains("italic")?g.innerHTML="<i>"+v.innerHTML+"</i>":g.innerHTML=v.innerHTML,v.parentNode.replaceChild(g,v);for(y=c.querySelectorAll("span"),f=0;f<y.length;f+=1){if(v=y[f],e.util.traverseUp(v,b))return!1;e.util.unwrap(v,this.document)}}});e.extensions.paste=d}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(n,i){this.initElement(i)},initElement:function(n){n.getAttribute("data-placeholder")||n.setAttribute("data-placeholder",this.text),this.updatePlaceholder(n)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(n,i){this.cleanupElement(i)},cleanupElement:function(n){n.getAttribute("data-placeholder")===this.text&&n.removeAttribute("data-placeholder")},showPlaceholder:function(n){n&&(e.util.isFF&&n.childNodes.length===0?(n.classList.add("medium-editor-placeholder-relative"),n.classList.remove("medium-editor-placeholder")):(n.classList.add("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(n){n&&(n.classList.remove("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(n,i){if(n.querySelector("img, blockquote, ul, ol, table")||n.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(n);i||this.showPlaceholder(n)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(n,i){var o=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,o)},handleFocus:function(n,i){this.hidePlaceholder(i)},handleBlur:function(n,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(n,i){return this.base.extensions.forEach(function(o){if(o!==this)return n.apply(i||this,arguments)},this)},createToolbar:function(){var n=this.document.createElement("div");return n.id="medium-editor-toolbar-"+this.getEditorId(),n.className="medium-editor-toolbar",this.static?n.className+=" static-toolbar":this.relativeContainer?n.className+=" medium-editor-relative-toolbar":n.className+=" medium-editor-stalker-toolbar",n.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&n.appendChild(i.getForm())}),this.attachEventHandlers(),n},createToolbarButtons:function(){var n=this.document.createElement("ul"),i,o,s,l,d,c;return n.id="medium-editor-toolbar-actions"+this.getEditorId(),n.className="medium-editor-toolbar-actions",n.style.display="block",this.buttons.forEach(function(f){typeof f=="string"?(d=f,c=null):(d=f.name,c=f),l=this.base.addBuiltInExtension(d,c),l&&typeof l.getButton=="function"&&(o=l.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(o)?i.appendChild(o):i.innerHTML=o,n.appendChild(i))},this),s=n.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),n},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(n){if(n&&n.target&&e.util.isDescendant(this.getToolbarElement(),n.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(n){n.hasForm&&n.isDisplayed()&&n.hideForm()})},multipleBlockElementsSelected:function(){var n=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),o=e.selection.getSelectionHtml(this.document).replace(n,""),s=o.match(i);return!!s&&s.length>1},modifySelection:function(){var n=this.window.getSelection(),i=n.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var o=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(o){for(var s=0;o.nodeValue.substr(s,1).trim().length===0;)s=s+1;i=e.selection.select(this.document,o,s,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var n=e.selection.getSelectionElement(this.window);if(!n||this.getEditorElements().indexOf(n)===-1||n.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(n){typeof n.isActive=="function"&&typeof n.setInactive=="function"&&n.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var n=[],i=null,o=e.selection.getSelectionRange(this.document),s,l=function(d){typeof d.checkState=="function"?d.checkState(s):typeof d.isActive=="function"&&typeof d.isAlreadyApplied=="function"&&typeof d.setActive=="function"&&!d.isActive()&&d.isAlreadyApplied(s)&&d.setActive()};if(o&&(this.forEachExtension(function(d){if(typeof d.queryCommandState=="function"&&(i=d.queryCommandState(),i!==null)){i&&typeof d.setActive=="function"&&d.setActive();return}n.push(d)}),s=e.selection.getSelectedParentElement(o),!!this.getEditorElements().some(function(d){return e.util.isDescendant(d,s,!0)})))for(;s&&(n.forEach(l),!e.util.isMediumEditorElement(s));)s=s.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var n=this.base.getFocusedElement(),i=this.window.getSelection();if(!n)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(n):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(n){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,o=this.window.innerWidth,s=this.getToolbarElement(),l=n.getBoundingClientRect(),d=l.top+i,c=l.left+l.width/2,f=s.offsetHeight,v=s.offsetWidth,g=v/2,y;switch(this.sticky?i>d+n.offsetHeight-f-this.stickyTopOffset?(s.style.top=d+n.offsetHeight-f+"px",s.classList.remove("medium-editor-sticky-toolbar")):i>d-f-this.stickyTopOffset?(s.classList.add("medium-editor-sticky-toolbar"),s.style.top=this.stickyTopOffset+"px"):(s.classList.remove("medium-editor-sticky-toolbar"),s.style.top=d-f+"px"):s.style.top=d-f+"px",this.align){case"left":y=l.left;break;case"right":y=l.right-v;break;case"center":y=c-g;break}y<0?y=0:y+v>o&&(y=o-Math.ceil(v)-1),s.style.left=y+"px"},positionToolbar:function(n){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=n.getRangeAt(0),o=i.getBoundingClientRect();(!o||o.height===0&&o.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?o=i.startContainer.querySelector("img").getBoundingClientRect():o=i.startContainer.getBoundingClientRect());var s=this.window.innerWidth,l=this.getToolbarElement(),d=l.offsetHeight,c=l.offsetWidth,f=c/2,v=50,g=this.diffLeft-f,y=this.getEditorOption("elementsContainer"),b=["absolute","fixed"].indexOf(window.getComputedStyle(y).getPropertyValue("position"))>-1,_={},x={},w,C;b?(C=y.getBoundingClientRect(),["top","left"].forEach(function(k){x[k]=o[k]-C[k]}),x.width=o.width,x.height=o.height,o=x,s=C.width,_.top=y.scrollTop):_.top=this.window.pageYOffset,w=o.left+o.width/2,_.top+=o.top-d,o.top<v?(l.classList.add("medium-toolbar-arrow-over"),l.classList.remove("medium-toolbar-arrow-under"),_.top+=v+o.height-this.diffTop):(l.classList.add("medium-toolbar-arrow-under"),l.classList.remove("medium-toolbar-arrow-over"),_.top+=this.diffTop),w<f?(_.left=g+f,_.right="initial"):s-w<f?(_.left="auto",_.right=0):(_.left=g+w,_.right="initial"),["top","left","right"].forEach(function(k){l.style[k]=_[k]+(isNaN(_[k])?"":"px")})}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(n){var i="medium-editor-dragover";n.preventDefault(),n.dataTransfer.dropEffect="copy",n.type==="dragover"?n.target.classList.add(i):n.type==="dragleave"&&n.target.classList.remove(i)},handleDrop:function(n){var i="medium-editor-dragover",o;n.preventDefault(),n.stopPropagation(),n.dataTransfer.files&&(o=Array.prototype.slice.call(n.dataTransfer.files,0),o.some((function(s){if(s.type.match("image")){var l,d;l=new FileReader,l.readAsDataURL(s),d="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+d+'" />'),l.onload=(function(){var c=this.document.getElementById(d);c&&(c.removeAttribute("id"),c.removeAttribute("class"),c.src=l.result)}).bind(this)}}).bind(this))),n.target.classList.remove(i)}});e.extensions.imageDragging=t}(),function(){function t(T){var W=e.selection.getSelectionStart(this.options.ownerDocument),P=W.textContent,le=e.selection.getCaretOffsets(W);(P[le.left-1]===void 0||P[le.left-1].trim()===""||P[le.left]!==void 0&&P[le.left].trim()==="")&&T.preventDefault()}function n(T,W){if(this.options.disableReturn||W.getAttribute("data-disable-return"))T.preventDefault();else if(this.options.disableDoubleReturn||W.getAttribute("data-disable-double-return")){var P=e.selection.getSelectionStart(this.options.ownerDocument);(P&&P.textContent.trim()===""&&P.nodeName.toLowerCase()!=="li"||P.previousElementSibling&&P.previousElementSibling.nodeName.toLowerCase()!=="br"&&P.previousElementSibling.textContent.trim()==="")&&T.preventDefault()}}function i(T){var W=e.selection.getSelectionStart(this.options.ownerDocument),P=W&&W.nodeName.toLowerCase();P==="pre"&&(T.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(W)&&(T.preventDefault(),T.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function o(T){var W,P=e.selection.getSelectionStart(this.options.ownerDocument),le=P.nodeName.toLowerCase(),me=/^(\s+|<br\/?>)?$/i,he=/h\d/i;e.util.isKey(T,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&P.previousElementSibling&&he.test(le)&&e.selection.getCaretOffsets(P).left===0?e.util.isKey(T,e.util.keyCode.BACKSPACE)&&me.test(P.previousElementSibling.innerHTML)?(P.previousElementSibling.parentNode.removeChild(P.previousElementSibling),T.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(T,e.util.keyCode.ENTER)&&(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",P.previousElementSibling.parentNode.insertBefore(W,P),T.preventDefault()):e.util.isKey(T,e.util.keyCode.DELETE)&&P.nextElementSibling&&P.previousElementSibling&&!he.test(le)&&me.test(P.innerHTML)&&he.test(P.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,P.nextElementSibling),P.previousElementSibling.parentNode.removeChild(P),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&le==="li"&&me.test(P.innerHTML)&&!P.previousElementSibling&&!P.parentElement.previousElementSibling&&P.nextElementSibling&&P.nextElementSibling.nodeName.toLowerCase()==="li"?(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",P.parentElement.parentElement.insertBefore(W,P.parentElement),e.selection.moveCursor(this.options.ownerDocument,W),P.parentElement.removeChild(P),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(P,"blockquote")!==!1&&e.selection.getCaretOffsets(P).left===0?(T.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(T,e.util.keyCode.ENTER)&&e.util.getClosestTag(P,"blockquote")!==!1&&e.selection.getCaretOffsets(P).right===0?(W=this.options.ownerDocument.createElement("p"),W.innerHTML="<br>",P.parentElement.insertBefore(W,P.nextSibling),e.selection.moveCursor(this.options.ownerDocument,W),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(P.parentElement)&&!P.previousElementSibling&&P.nextElementSibling&&me.test(P.innerHTML)&&(T.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,P.nextSibling),P.parentElement.removeChild(P))}function s(T){var W=e.selection.getSelectionStart(this.options.ownerDocument),P;W&&(e.util.isMediumEditorElement(W)&&W.children.length===0&&!e.util.isBlockContainer(W)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(T,e.util.keyCode.ENTER)&&!e.util.isListItem(W)&&!e.util.isBlockContainer(W)&&(P=W.nodeName.toLowerCase(),P==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!T.shiftKey&&!T.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function l(T,W){var P=W.parentNode.querySelector('textarea[medium-editor-textarea-id="'+W.getAttribute("medium-editor-textarea-id")+'"]');P&&(P.value=W.innerHTML.trim())}function d(T){T._mediumEditors||(T._mediumEditors=[null]),this.id||(this.id=T._mediumEditors.length),T._mediumEditors[this.id]=this}function c(T){!T._mediumEditors||!T._mediumEditors[this.id]||(T._mediumEditors[this.id]=null)}function f(T,W,P){var le=[];if(T||(T=[]),typeof T=="string"&&(T=W.querySelectorAll(T)),e.util.isElement(T)&&(T=[T]),P)for(var me=0;me<T.length;me++){var he=T[me];e.util.isElement(he)&&!he.getAttribute("data-medium-editor-element")&&!he.getAttribute("medium-editor-textarea-id")&&le.push(he)}else le=Array.prototype.slice.apply(T);return le}function v(T){var W=T.parentNode.querySelector('textarea[medium-editor-textarea-id="'+T.getAttribute("medium-editor-textarea-id")+'"]');W&&(W.classList.remove("medium-editor-hidden"),W.removeAttribute("medium-editor-textarea-id")),T.parentNode&&T.parentNode.removeChild(T)}function g(T,W){return Object.keys(W).forEach(function(P){T[P]===void 0&&(T[P]=W[P])}),T}function y(T,W,P){var le={window:P.options.contentWindow,document:P.options.ownerDocument,base:P};return T=g(T,le),typeof T.init=="function"&&T.init(),T.name||(T.name=W),T}function b(){return this.elements.every(function(T){return!!T.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function _(){return b.call(this)?this.options.anchorPreview!==!1:!1}function x(){return this.options.placeholder!==!1}function w(){return this.options.autoLink!==!1}function C(){return this.options.imageDragging!==!1}function k(){return this.options.keyboardCommands!==!1}function D(){return!this.options.extensions.imageDragging}function I(T){for(var W=this.options.ownerDocument.createElement("div"),P=Date.now(),le="medium-editor-"+P,me=T.attributes;this.options.ownerDocument.getElementById(le);)P++,le="medium-editor-"+P;W.className=T.className,W.id=le,W.innerHTML=T.value,T.setAttribute("medium-editor-textarea-id",le);for(var he=0,Ne=me.length;he<Ne;he++)W.hasAttribute(me[he].nodeName)||W.setAttribute(me[he].nodeName,me[he].value);return T.form&&this.on(T.form,"reset",(function(ye){ye.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(le))}).bind(this)),T.classList.add("medium-editor-hidden"),T.parentNode.insertBefore(W,T),W}function $(T,W){if(!T.getAttribute("data-medium-editor-element")){T.nodeName.toLowerCase()==="textarea"&&(T=I.call(this,T),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=l.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!T.getAttribute("data-disable-editing")&&(T.setAttribute("contentEditable",!0),T.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(T.getAttribute("data-disable-return")||T.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!T.getAttribute("data-disable-return")&&this.on(T,"keyup",s.bind(this));var P=e.util.guid();T.setAttribute("data-medium-editor-element",!0),T.classList.add("medium-editor-element"),T.setAttribute("role","textbox"),T.setAttribute("aria-multiline",!0),T.setAttribute("data-medium-editor-editor-index",W),T.setAttribute("medium-editor-index",P),Q[P]=T.innerHTML,this.events.attachAllEventsToElement(T)}return T}function R(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",o.bind(this)),this.subscribe("editableKeydownEnter",o.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function F(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(me){me!=="toolbar"&&this.options.extensions[me]&&this.extensions.push(y(this.options.extensions[me],me,this))},this),D.call(this)){var T=this.options.fileDragging;T||(T={},C.call(this)||(T.allowedTypes=[])),this.addBuiltInExtension("fileDragging",T)}var W={paste:!0,"anchor-preview":_.call(this),autoLink:w.call(this),keyboardCommands:k.call(this),placeholder:x.call(this)};Object.keys(W).forEach(function(me){W[me]&&this.addBuiltInExtension(me)},this);var P=this.options.extensions.toolbar;if(!P&&b.call(this)){var le=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});P=new e.extensions.toolbar(le)}P&&this.extensions.push(y(P,"toolbar",this))}function z(T,W){var P=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return W&&P.forEach(function(le){W.hasOwnProperty(le[0])&&W[le[0]]!==void 0&&e.util.deprecated(le[0],le[1],"v6.0.0")}),e.util.defaults({},W,T)}function ie(T,W){var P=/^append-(.+)$/gi,le=/justify([A-Za-z]*)$/g,me,he;if(me=P.exec(T),me)return e.util.execFormatBlock(this.options.ownerDocument,me[1]);if(T==="fontSize")return W.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),he=W.value||W.size,this.options.ownerDocument.execCommand("fontSize",!1,he);if(T==="fontName")return W.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),he=W.value||W.name,this.options.ownerDocument.execCommand("fontName",!1,he);if(T==="createLink")return this.createLink(W);if(T==="image"){var Ne=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,Ne)}if(T==="html"){var ye=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,ye)}if(le.exec(T)){var ae=this.options.ownerDocument.execCommand(T,!1,null),Re=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return Re&&G.call(this,e.util.getTopBlockContainer(Re)),ae}return he=W&&W.value,this.options.ownerDocument.execCommand(T,!1,he)}function G(T){if(T){var W,P=Array.prototype.slice.call(T.childNodes).filter(function(le){var me=le.nodeName.toLowerCase()==="div";return me&&!W&&(W=le.style.textAlign),me});P.length&&(this.saveSelection(),P.forEach(function(le){if(le.style.textAlign===W){var me=le.lastChild;if(me){e.util.unwrap(le,this.options.ownerDocument);var he=this.options.ownerDocument.createElement("BR");me.parentNode.insertBefore(he,me.nextSibling)}}},this),T.style.textAlign=W,this.restoreSelection())}}var Q={};e.prototype={init:function(T,W){return this.options=z.call(this,this.defaults,W),this.origElements=T,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(d.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,F.call(this),R.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(T){typeof T.destroy=="function"&&T.destroy()},this),this.events.destroy(),this.elements.forEach(function(T){this.options.spellcheck&&(T.innerHTML=T.innerHTML),T.removeAttribute("contentEditable"),T.removeAttribute("spellcheck"),T.removeAttribute("data-medium-editor-element"),T.classList.remove("medium-editor-element"),T.removeAttribute("role"),T.removeAttribute("aria-multiline"),T.removeAttribute("medium-editor-index"),T.removeAttribute("data-medium-editor-editor-index"),T.getAttribute("medium-editor-textarea-id")&&v(T)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,c.call(this,this.options.contentWindow))},on:function(T,W,P,le){return this.events.attachDOMEvent(T,W,P,le),this},off:function(T,W,P,le){return this.events.detachDOMEvent(T,W,P,le),this},subscribe:function(T,W){return this.events.attachCustomEvent(T,W),this},unsubscribe:function(T,W){return this.events.detachCustomEvent(T,W),this},trigger:function(T,W,P){return this.events.triggerCustomEvent(T,W,P),this},delay:function(T){var W=this;return setTimeout(function(){W.isActive&&T()},this.options.delay)},serialize:function(){var T,W,P={},le=this.elements.length;for(T=0;T<le;T+=1)W=this.elements[T].id!==""?this.elements[T].id:"element-"+T,P[W]={value:this.elements[T].innerHTML.trim()};return P},getExtensionByName:function(T){var W;return this.extensions&&this.extensions.length&&this.extensions.some(function(P){return P.name===T?(W=P,!0):!1}),W},addBuiltInExtension:function(T,W){var P=this.getExtensionByName(T),le;if(P)return P;switch(T){case"anchor":le=e.util.extend({},this.options.anchor,W),P=new e.extensions.anchor(le);break;case"anchor-preview":P=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":P=new e.extensions.autoLink;break;case"fileDragging":P=new e.extensions.fileDragging(W);break;case"fontname":P=new e.extensions.fontName(this.options.fontName);break;case"fontsize":P=new e.extensions.fontSize(W);break;case"keyboardCommands":P=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":P=new e.extensions.paste(this.options.paste);break;case"placeholder":P=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(T)&&(W?(le=e.util.defaults({},W,e.extensions.button.prototype.defaults[T]),P=new e.extensions.button(le)):P=new e.extensions.button(T))}return P&&this.extensions.push(y(P,T,this)),P},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var T=this.getExtensionByName("toolbar");return T&&T.checkState(),this},queryCommandState:function(T){var W=/^full-(.+)$/gi,P,le=null;P=W.exec(T),P&&(T=P[1]);try{le=this.options.ownerDocument.queryCommandState(T)}catch{le=null}return le},execAction:function(T,W){var P=/^full-(.+)$/gi,le,me;return le=P.exec(T),le?(this.saveSelection(),this.selectAllContents(),me=ie.call(this,le[1],W),this.restoreSelection()):me=ie.call(this,T,W),(T==="insertunorderedlist"||T==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),me},getSelectedParentElement:function(T){return T===void 0&&(T=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(T)},selectAllContents:function(){var T=e.selection.getSelectionElement(this.options.contentWindow);if(T){for(;T.children.length===1;)T=T.children[0];this.selectElement(T)}},selectElement:function(T){e.selection.selectNode(T,this.options.ownerDocument);var W=e.selection.getSelectionElement(this.options.contentWindow);W&&this.events.focusElement(W)},getFocusedElement:function(){var T;return this.elements.some(function(W){return!T&&W.getAttribute("data-medium-focused")&&(T=W),!!T},this),T},exportSelection:function(){var T=e.selection.getSelectionElement(this.options.contentWindow),W=this.elements.indexOf(T),P=null;return W>=0&&(P=e.selection.exportSelection(T,this.options.ownerDocument)),P!==null&&W!==0&&(P.editableElementIndex=W),P},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(T,W){if(T){var P=this.elements[T.editableElementIndex||0];e.selection.importSelection(T,P,this.options.ownerDocument,W)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(T){var W=e.selection.getSelectionElement(this.options.contentWindow),P={},le;if(this.elements.indexOf(W)!==-1){try{if(this.events.disableCustomEvent("editableInput"),T.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),le=T.url||T.value,le&&le.trim().length>0){var me=this.options.contentWindow.getSelection();if(me){var he=me.getRangeAt(0),Ne=he.commonAncestorContainer,ye,ae,Re,Le;if(he.endContainer.nodeType===3&&he.startContainer.nodeType!==3&&he.startOffset===0&&he.startContainer.firstChild===he.endContainer&&(Ne=he.endContainer),ae=e.util.getClosestBlockContainer(he.startContainer),Re=e.util.getClosestBlockContainer(he.endContainer),Ne.nodeType!==3&&Ne.textContent.length!==0&&ae===Re){var Ve=ae||W,Ae=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),ye=this.exportSelection(),Ae.appendChild(Ve.cloneNode(!0)),W===Ve?e.selection.select(this.options.ownerDocument,Ve.firstChild,0,Ve.lastChild,Ve.lastChild.nodeType===3?Ve.lastChild.nodeValue.length:Ve.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,Ve,0,Ve,Ve.childNodes.length);var te=this.exportSelection();Le=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,Ae,{start:ye.start-te.start,end:ye.end-te.start,editableElementIndex:ye.editableElementIndex}),Le.length===0&&(Ae=this.options.ownerDocument.createDocumentFragment(),Ae.appendChild(Ne.cloneNode(!0)),Le=[Ae.firstChild.firstChild,Ae.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Le,le.trim());var ce=(Ae.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,Ae.firstChild.innerHTML.replace(/^\s+/,"")),ye.start-=ce,ye.end-=ce,this.importSelection(ye)}else this.options.ownerDocument.execCommand("createLink",!1,le);this.options.targetBlank||T.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),le):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),le),T.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),T.buttonClass)}}if(this.options.targetBlank||T.target==="_blank"||T.buttonClass){P=this.options.ownerDocument.createEvent("HTMLEvents"),P.initEvent("input",!0,!0,this.options.contentWindow);for(var _e=0,Ie=this.elements.length;_e<Ie;_e+=1)this.elements[_e].dispatchEvent(P)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",P,W)}},cleanPaste:function(T){this.getExtensionByName("paste").cleanPaste(T)},pasteHTML:function(T,W){this.getExtensionByName("paste").pasteHTML(T,W)},setContent:function(T,W){if(W=W||0,this.elements[W]){var P=this.elements[W];P.innerHTML=T,this.checkContentChanged(P)}},getContent:function(T){return T=T||0,this.elements[T]?this.elements[T].innerHTML.trim():null},checkContentChanged:function(T){T=T||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(T,{target:T,currentTarget:T})},resetContent:function(T){if(T){var W=this.elements.indexOf(T);W!==-1&&this.setContent(Q[T.getAttribute("medium-editor-index")],W);return}this.elements.forEach(function(P,le){this.setContent(Q[P.getAttribute("medium-editor-index")],le)},this)},addElements:function(T){var W=f(T,this.options.ownerDocument,!0);if(W.length===0)return!1;W.forEach(function(P){P=$.call(this,P,this.id),this.elements.push(P),this.trigger("addElement",{target:P,currentTarget:P},P)},this)},removeElements:function(T){var W=f(T,this.options.ownerDocument),P=W.map(function(le){return le.getAttribute("medium-editor-textarea-id")&&le.parentNode?le.parentNode.querySelector('div[medium-editor-textarea-id="'+le.getAttribute("medium-editor-textarea-id")+'"]'):le});this.elements=this.elements.filter(function(le){return P.indexOf(le)!==-1?(this.events.cleanupElement(le),le.getAttribute("medium-editor-textarea-id")&&v(le),this.trigger("removeElement",{target:le,currentTarget:le},le),!1):!0},this)}},e.getEditorFromElement=function(T){var W=T.getAttribute("data-medium-editor-editor-index"),P=T&&T.ownerDocument&&(T.ownerDocument.defaultView||T.ownerDocument.parentWindow);return P&&P._mediumEditors&&P._mediumEditors[W]?P._mediumEditors[W]:null}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(t){var n=t.split("-"),i=n[0].split("."),o=n.length>1?n[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:o,toString:function(){return[i[0],i[1],i[2]].join(".")+(o?"-"+o:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e}())}(td)),td.exports}var NB=kB();const Ud=ls(NB);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var up=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},dp=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),Xu=function(){function r(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var l=e[Symbol.iterator](),d;!(i=(d=l.next()).done)&&(n.push(d.value),!(t&&n.length===t));i=!0);}catch(c){o=!0,s=c}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return n}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(r){return this.indexOf(r)===0};String.prototype.padStart=String.prototype.padStart||function(r,e){for(var t=this;t.length<r;)t=e+t;return t};var MB={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Ay(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?r.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):r.toString();return t||"0"}var AB=function(){function r(e,t,n,i){up(this,r);var o=this;function s(d){if(d.startsWith("hsl")){var c=d.match(/([\-\d\.e]+)/g).map(Number),f=Xu(c,4),v=f[0],g=f[1],y=f[2],b=f[3];b===void 0&&(b=1),v/=360,g/=100,y/=100,o.hsla=[v,g,y,b]}else if(d.startsWith("rgb")){var _=d.match(/([\-\d\.e]+)/g).map(Number),x=Xu(_,4),w=x[0],C=x[1],k=x[2],D=x[3];D===void 0&&(D=1),o.rgba=[w,C,k,D]}else d.startsWith("#")?o.rgba=r.hexToRgb(d):o.rgba=r.nameToRgb(d)||r.hexToRgb(d)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(n===void 0){var l=e&&""+e;l&&s(l.toLowerCase())}else this.rgba=[e,t,n,i===void 0?1:i]}return dp(r,[{key:"printRGB",value:function(t){var n=t?this.rgba:this.rgba.slice(0,3),i=n.map(function(o,s){return Ay(o,s===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var n=[360,100,100,1],i=["","%","%",""],o=t?this.hsla:this.hsla.slice(0,3),s=o.map(function(l,d){return Ay(l*n[d],d===3?3:1)+i[d]});return t?"hsla("+s+")":"hsl("+s+")"}},{key:"printHex",value:function(t){var n=this.hex;return t?n:n.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=r.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=r.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,n=t.map(function(i,o){return o<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+n.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=r.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var n=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!n.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=n.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(o){return parseInt(o,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var n=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=MB[n];return i===void 0?i:r.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var n=Xu(t,4),i=n[0],o=n[1],s=n[2],l=n[3];i/=255,o/=255,s/=255;var d=Math.max(i,o,s),c=Math.min(i,o,s),f=void 0,v=void 0,g=(d+c)/2;if(d===c)f=v=0;else{var y=d-c;switch(v=g>.5?y/(2-d-c):y/(d+c),d){case i:f=(o-s)/y+(o<s?6:0);break;case o:f=(s-i)/y+2;break;case s:f=(i-o)/y+4;break}f/=6}return[f,v,g,l]}},{key:"hslToRgb",value:function(t){var n=Xu(t,4),i=n[0],o=n[1],s=n[2],l=n[3],d=void 0,c=void 0,f=void 0;if(o===0)d=c=f=s;else{var v=function(x,w,C){return C<0&&(C+=1),C>1&&(C-=1),C<.16666666666666666?x+(w-x)*6*C:C<.5?w:C<.6666666666666666?x+(w-x)*(.6666666666666666-C)*6:x},g=s<.5?s*(1+o):s+o-s*o,y=2*s-g;d=v(y,g,i+1/3),c=v(y,g,i),f=v(y,g,i-1/3)}var b=[d*255,c*255,f*255].map(Math.round);return b[3]=l,b}}]),r}(),TB=function(){function r(){up(this,r),this._events=[]}return dp(r,[{key:"add",value:function(t,n,i){t.addEventListener(n,i,!1),this._events.push({target:t,type:n,handler:i})}},{key:"remove",value:function(t,n,i){this._events=this._events.filter(function(o){var s=!0;return t&&t!==o.target&&(s=!1),n&&n!==o.type&&(s=!1),i&&i!==o.handler&&(s=!1),s&&r._doRemove(o.target,o.type,o.handler),!s})}},{key:"destroy",value:function(){this._events.forEach(function(t){return r._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,n,i){t.removeEventListener(n,i,!1)}}]),r}();function DB(r){var e=document.createElement("div");return e.innerHTML=r,e.firstElementChild}function Af(r,e,t){var n=!1;function i(d,c,f){return Math.max(c,Math.min(d,f))}function o(d,c,f){if(f&&(n=!0),!!n){d.preventDefault();var v=e.getBoundingClientRect(),g=v.width,y=v.height,b=c.clientX,_=c.clientY,x=i(b-v.left,0,g),w=i(_-v.top,0,y);t(x/g,w/y)}}function s(d,c){var f=d.buttons===void 0?d.which:d.buttons;f===1?o(d,d,c):n=!1}function l(d,c){d.touches.length===1?o(d,d.touches[0],c):n=!1}r.add(e,"mousedown",function(d){s(d,!0)}),r.add(e,"touchstart",function(d){l(d,!0)}),r.add(window,"mousemove",s),r.add(e,"touchmove",l),r.add(window,"mouseup",function(d){n=!1}),r.add(e,"touchend",function(d){n=!1}),r.add(e,"touchcancel",function(d){n=!1})}var LB=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,PB=360,Lw="keydown",Gu="mousedown",Tf="focusin";function Li(r,e){return(e||document).querySelector(r)}function RB(r){r.preventDefault(),r.stopPropagation()}function Df(r,e,t,n,i){r.add(e,Lw,function(o){t.indexOf(o.key)>=0&&n(o)})}var Pw=function(){function r(e){up(this,r),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new TB,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return dp(r,[{key:"setOptions",value:function(t){var n=this;if(!t)return;var i=this.settings;function o(c,f,v){for(var g in c)f[g]=c[g]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),o(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var s=t.color||t.colour;s&&this._setColor(s)}var l=i.parent;if(l&&i.popup&&!this._popupInited){var d=function(f){return n.openHandler(f)};this._events.add(l,"click",d),Df(this._events,l,[" ","Spacebar","Enter"],d),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var n=t&&t.type===Lw?this._domEdit:this.domElement;setTimeout(function(){return n.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var n=t&&t.type,i=!1;if(!t)i=!0;else if(n===Gu||n===Tf){var o=(this.__containedEvent||0)+100;t.timeStamp>o&&(i=!0)}else RB(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",n!==Gu&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,n){this.closeHandler(),this.setOptions(t),n&&this.openHandler()}},{key:"setColor",value:function(t,n){this._setColor(t,{silent:n})}},{key:"_setColor",value:function(t,n){if(typeof t=="string"&&(t=t.trim()),!!t){n=n||{};var i=void 0;try{i=new AB(t)}catch(s){if(n.failSilently)return;throw s}if(!this.settings.alpha){var o=i.hsla;o[3]=1,i.hsla=o}this.colour=this.color=i,this._setHSLA(null,null,null,null,n)}}},{key:"setColour",value:function(t,n){this.setColor(t,n)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var n=this._toggleDOM(!0);return this._setPosition(),n}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',o=DB(i);return this.domElement=o,this._domH=Li(".picker_hue",o),this._domSL=Li(".picker_sl",o),this._domA=Li(".picker_alpha",o),this._domEdit=Li(".picker_editor input",o),this._domSample=Li(".picker_sample",o),this._domOkay=Li(".picker_done button",o),this._domCancel=Li(".picker_cancel button",o),o.classList.add("layout_"+this.settings.layout),this.settings.alpha||o.classList.add("no_alpha"),this.settings.editor||o.classList.add("no_editor"),this.settings.cancelButton||o.classList.add("no_cancel"),this._ifPopup(function(){return o.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,n=this,i=this.domElement,o=this._events;function s(c,f,v){o.add(c,f,v)}s(i,"click",function(c){return c.preventDefault()}),Af(o,this._domH,function(c,f){return n._setHSLA(c)}),Af(o,this._domSL,function(c,f){return n._setHSLA(null,c,1-f)}),this.settings.alpha&&Af(o,this._domA,function(c,f){return n._setHSLA(null,null,null,1-f)});var l=this._domEdit;s(l,"input",function(c){n._setColor(this.value,{fromEditor:!0,failSilently:!0})}),s(l,"focus",function(c){var f=this;f.selectionStart===f.selectionEnd&&f.select()}),this._ifPopup(function(){var c=function(g){return t.closeHandler(g)};s(window,Gu,c),s(window,Tf,c),Df(o,i,["Esc","Escape"],c);var f=function(g){t.__containedEvent=g.timeStamp};s(i,Gu,f),s(i,Tf,f),s(t._domCancel,"click",c)});var d=function(f){t._ifPopup(function(){return t.closeHandler(f)}),t.onDone&&t.onDone(t.colour)};s(this._domOkay,"click",d),Df(o,i,["Enter"],d)}},{key:"_setPosition",value:function(){var t=this.settings.parent,n=this.domElement;t!==n.parentNode&&t.appendChild(n),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var o=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(s){s===o?n.classList.add(s):n.classList.remove(s)}),n.classList.add(o)})}},{key:"_setHSLA",value:function(t,n,i,o,s){s=s||{};var l=this.colour,d=l.hsla;[t,n,i,o].forEach(function(c,f){(c||c===0)&&(d[f]=c)}),l.hsla=d,this._updateUI(s),this.onChange&&!s.silent&&this.onChange(l)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var n=this.colour,i=n.hsla,o="hsl("+i[0]*PB+", 100%, 50%)",s=n.hslString,l=n.hslaString,d=this._domH,c=this._domSL,f=this._domA,v=Li(".picker_selector",d),g=Li(".picker_selector",c),y=Li(".picker_selector",f);function b($,R,F){R.style.left=F*100+"%"}function _($,R,F){R.style.top=F*100+"%"}b(d,v,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=o,b(c,g,i[1]),_(c,g,1-i[2]),c.style.color=s,_(f,y,1-i[3]);var x=s,w=x.replace("hsl","hsla").replace(")",", 0)"),C="linear-gradient("+[x,w]+")";if(this._domA.style.background=C+", "+LB,!t.fromEditor){var k=this.settings.editorFormat,D=this.settings.alpha,I=void 0;switch(k){case"rgb":I=n.printRGB(D);break;case"hsl":I=n.printHSL(D);break;default:I=n.printHex(D)}this._domEdit.value=I}this._domSample.style.color=l}},{key:"_ifPopup",value:function(t,n){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):n&&n()}},{key:"_toggleDOM",value:function(t){var n=this.domElement;if(!n)return!1;var i=t?"":"none",o=n.style.display!==i;return o&&(n.style.display=i),o}}]),r}();{var Lf=document.createElement("style");Lf.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(Lf),Pw.StyleElement=Lf}var Pf={exports:{}},Ty;function Rw(){return Ty||(Ty=1,function(r,e){(function(t,n){r.exports=t()})(function(){var t="object",n="function",i="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],d=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function c(te,ce){var _e=typeof te[ce];return _e==n||!!(_e==t&&te[ce])||_e=="unknown"}function f(te,ce){return!!(typeof te[ce]==t&&te[ce])}function v(te,ce){return typeof te[ce]!=i}function g(te){return function(ce,_e){for(var Ie=_e.length;Ie--;)if(!te(ce,_e[Ie]))return!1;return!0}}var y=g(c),b=g(f),_=g(v);function x(te){return te&&y(te,d)&&_(te,l)}function w(te){return f(te,"body")?te.body:te.getElementsByTagName("body")[0]}var C=[].forEach?function(te,ce){te.forEach(ce)}:function(te,ce){for(var _e=0,Ie=te.length;_e<Ie;++_e)ce(te[_e],_e)},k={},D=typeof window!=i&&typeof document!=i,I={isHostMethod:c,isHostObject:f,isHostProperty:v,areHostMethods:y,areHostObjects:b,areHostProperties:_,isTextRange:x,getBody:w,forEach:C},$={version:"1.3.2",initialized:!1,isBrowser:D,supported:!0,util:I,features:{},modules:k,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function R(te){typeof console!=i&&c(console,"log")}function F(te,ce){D&&ce?alert(te):R(te)}function z(te){$.initialized=!0,$.supported=!1,F("Rangy is not supported in this environment. Reason: "+te,$.config.alertOnFail)}$.fail=z;function ie(te){F("Rangy warning: "+te,$.config.alertOnWarn)}$.warn=ie;var G;({}).hasOwnProperty?(I.extend=G=function(te,ce,_e){var Ie,Ke;for(var $e in ce)$e==="__proto__"||$e==="constructor"||$e==="prototype"||ce.hasOwnProperty($e)&&(Ie=te[$e],Ke=ce[$e],_e&&Ie!==null&&typeof Ie=="object"&&Ke!==null&&typeof Ke=="object"&&G(Ie,Ke,!0),te[$e]=Ke);return ce.hasOwnProperty("toString")&&(te.toString=ce.toString),te},I.createOptions=function(te,ce){var _e={};return G(_e,ce),te&&G(_e,te),_e}):z("hasOwnProperty not supported"),D||z("Rangy can only run in a browser"),function(){var te;if(D){var ce=document.createElement("div");ce.appendChild(document.createElement("span"));var _e=[].slice;try{_e.call(ce.childNodes,0)[0].nodeType==1&&(te=function(Ie){return _e.call(Ie,0)})}catch{}}te||(te=function(Ie){for(var Ke=[],$e=0,Ue=Ie.length;$e<Ue;++$e)Ke[$e]=Ie[$e];return Ke}),I.toArray=te}();var Q;D&&(c(document,"addEventListener")?Q=function(te,ce,_e){te.addEventListener(ce,_e,!1)}:c(document,"attachEvent")?Q=function(te,ce,_e){te.attachEvent("on"+ce,_e)}:z("Document does not have required addEventListener or attachEvent method"),I.addListener=Q);var T=[];function W(te){return te.message||te.description||String(te)}function P(){if(!(!D||$.initialized)){var te,ce=!1,_e=!1;c(document,"createRange")&&(te=document.createRange(),y(te,s)&&_(te,o)&&(ce=!0));var Ie=w(document);if(!Ie||Ie.nodeName.toLowerCase()!="body"){z("No body element found");return}if(Ie&&c(Ie,"createTextRange")&&(te=Ie.createTextRange(),x(te)&&(_e=!0)),!ce&&!_e){z("Neither Range nor TextRange are available");return}$.initialized=!0,$.features={implementsDomRange:ce,implementsTextRange:_e};var Ke,$e;for(var Ue in k)(Ke=k[Ue])instanceof ye&&Ke.init(Ke,$);for(var Nt=0,ot=T.length;Nt<ot;++Nt)try{T[Nt]($)}catch(Bt){$e="Rangy init listener threw an exception. Continuing. Detail: "+W(Bt),R($e)}}}function le(te,ce,_e){_e&&(te+=" in module "+_e.name),$.warn("DEPRECATED: "+te+" is deprecated. Please use "+ce+" instead.")}function me(te,ce,_e,Ie){te[ce]=function(){return le(ce,_e,Ie),te[_e].apply(te,I.toArray(arguments))}}I.deprecationNotice=le,I.createAliasForDeprecatedMethod=me,$.init=P,$.addInitListener=function(te){$.initialized?te($):T.push(te)};var he=[];$.addShimListener=function(te){he.push(te)};function Ne(te){te=te||window,P();for(var ce=0,_e=he.length;ce<_e;++ce)he[ce](te)}D&&($.shim=$.createMissingNativeApi=Ne,me($,"createMissingNativeApi","shim"));function ye(te,ce,_e){this.name=te,this.dependencies=ce,this.initialized=!1,this.supported=!1,this.initializer=_e}ye.prototype={init:function(){for(var te=this.dependencies||[],ce=0,_e=te.length,Ie,Ke;ce<_e;++ce){if(Ke=te[ce],Ie=k[Ke],!Ie||!(Ie instanceof ye))throw new Error("required module '"+Ke+"' not found");if(Ie.init(),!Ie.supported)throw new Error("required module '"+Ke+"' not supported")}this.initializer(this)},fail:function(te){throw this.initialized=!0,this.supported=!1,new Error(te)},warn:function(te){$.warn("Module "+this.name+": "+te)},deprecationNotice:function(te,ce){$.warn("DEPRECATED: "+te+" in module "+this.name+" is deprecated. Please use "+ce+" instead")},createError:function(te){return new Error("Error in Rangy "+this.name+" module: "+te)}};function ae(te,ce,_e){var Ie=new ye(te,ce,function(Ke){if(!Ke.initialized){Ke.initialized=!0;try{_e($,Ke),Ke.supported=!0}catch(Ue){var $e="Module '"+te+"' failed to load: "+W(Ue);R($e),Ue.stack&&R(Ue.stack)}}});return k[te]=Ie,Ie}$.createModule=function(te){var ce,_e;arguments.length==2?(ce=arguments[1],_e=[]):(ce=arguments[2],_e=arguments[1]);var Ie=ae(te,_e,ce);$.initialized&&$.supported&&Ie.init()},$.createCoreModule=function(te,ce,_e){ae(te,ce,_e)};function Re(){}$.RangePrototype=Re,$.rangePrototype=new Re;function Le(){}$.selectionPrototype=new Le,$.createCoreModule("DomUtil",[],function(te,ce){var _e="undefined",Ie=te.util,Ke=Ie.getBody;Ie.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||ce.fail("document missing a Node creation method"),Ie.isHostMethod(document,"getElementsByTagName")||ce.fail("document missing getElementsByTagName method");var $e=document.createElement("div");Ie.areHostMethods($e,["insertBefore","appendChild","cloneNode"])||ce.fail("Incomplete Element implementation"),Ie.isHostProperty($e,"innerHTML")||ce.fail("Element is missing innerHTML property");var Ue=document.createTextNode("test");Ie.areHostMethods(Ue,["splitText","deleteData","insertData","appendData","cloneNode"])||ce.fail("Incomplete Text Node implementation");var Nt=function(xe,qe){for(var ht=xe.length;ht--;)if(xe[ht]===qe)return!0;return!1};function ot(xe){var qe;return typeof xe.namespaceURI==_e||(qe=xe.namespaceURI)===null||qe=="http://www.w3.org/1999/xhtml"}function Bt(xe){var qe=xe.parentNode;return qe.nodeType==1?qe:null}function bt(xe){for(var qe=0;xe=xe.previousSibling;)++qe;return qe}function rn(xe){switch(xe.nodeType){case 7:case 10:return 0;case 3:case 8:return xe.length;default:return xe.childNodes.length}}function ln(xe,qe){var ht=[],_t;for(_t=xe;_t;_t=_t.parentNode)ht.push(_t);for(_t=qe;_t;_t=_t.parentNode)if(Nt(ht,_t))return _t;return null}function Z(xe,qe,ht){for(var _t=ht?qe:qe.parentNode;_t;){if(_t===xe)return!0;_t=_t.parentNode}return!1}function N(xe,qe){return Z(xe,qe,!0)}function H(xe,qe,ht){for(var _t,$t=ht?xe:xe.parentNode;$t;){if(_t=$t.parentNode,_t===qe)return $t;$t=_t}return null}function J(xe){var qe=xe.nodeType;return qe==3||qe==4||qe==8}function X(xe){if(!xe)return!1;var qe=xe.nodeType;return qe==3||qe==8}function re(xe,qe){var ht=qe.nextSibling,_t=qe.parentNode;return ht?_t.insertBefore(xe,ht):_t.appendChild(xe),xe}function ne(xe,qe,ht){var _t=xe.cloneNode(!1);if(_t.deleteData(0,qe),xe.deleteData(qe,xe.length-qe),re(_t,xe),ht)for(var $t=0,zt;zt=ht[$t++];)zt.node==xe&&zt.offset>qe?(zt.node=_t,zt.offset-=qe):zt.node==xe.parentNode&&zt.offset>bt(xe)&&++zt.offset;return _t}function ue(xe){if(xe.nodeType==9)return xe;if(typeof xe.ownerDocument!=_e)return xe.ownerDocument;if(typeof xe.document!=_e)return xe.document;if(xe.parentNode)return ue(xe.parentNode);throw ce.createError("getDocument: no document found for node")}function we(xe){var qe=ue(xe);if(typeof qe.defaultView!=_e)return qe.defaultView;if(typeof qe.parentWindow!=_e)return qe.parentWindow;throw ce.createError("Cannot get a window object for node")}function Se(xe){if(typeof xe.contentDocument!=_e)return xe.contentDocument;if(typeof xe.contentWindow!=_e)return xe.contentWindow.document;throw ce.createError("getIframeDocument: No Document object found for iframe element")}function Pe(xe){if(typeof xe.contentWindow!=_e)return xe.contentWindow;if(typeof xe.contentDocument!=_e)return xe.contentDocument.defaultView;throw ce.createError("getIframeWindow: No Window object found for iframe element")}function Ge(xe){return xe&&Ie.isHostMethod(xe,"setTimeout")&&Ie.isHostObject(xe,"document")}function at(xe,qe,ht){var _t;if(xe?Ie.isHostProperty(xe,"nodeType")?_t=xe.nodeType==1&&xe.tagName.toLowerCase()=="iframe"?Se(xe):ue(xe):Ge(xe)&&(_t=xe.document):_t=document,!_t)throw qe.createError(ht+"(): Parameter must be a Window object or DOM node");return _t}function ut(xe){for(var qe;qe=xe.parentNode;)xe=qe;return xe}function kt(xe,qe,ht,_t){var $t,zt,Jn,gn,$n;if(xe==ht)return qe===_t?0:qe<_t?-1:1;if($t=H(ht,xe,!0))return qe<=bt($t)?-1:1;if($t=H(xe,ht,!0))return bt($t)<_t?-1:1;if(zt=ln(xe,ht),!zt)throw new Error("comparePoints error: nodes have no common ancestor");if(Jn=xe===zt?zt:H(xe,zt,!0),gn=ht===zt?zt:H(ht,zt,!0),Jn===gn)throw ce.createError("comparePoints got to case 4 and childA and childB are the same!");for($n=zt.firstChild;$n;){if($n===Jn)return-1;if($n===gn)return 1;$n=$n.nextSibling}}var Xe=!1;function rt(xe){var qe;try{return qe=xe.parentNode,!1}catch{return!0}}(function(){var xe=document.createElement("b");xe.innerHTML="1";var qe=xe.firstChild;xe.innerHTML="<br />",Xe=rt(qe),te.features.crashyTextNodes=Xe})();function Tt(xe){if(!xe)return"[No node]";if(Xe&&rt(xe))return"[Broken node]";if(J(xe))return'"'+xe.data+'"';if(xe.nodeType==1){var qe=xe.id?' id="'+xe.id+'"':"";return"<"+xe.nodeName+qe+">[index:"+bt(xe)+",length:"+xe.childNodes.length+"]["+(xe.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return xe.nodeName}function et(xe){for(var qe=ue(xe).createDocumentFragment(),ht;ht=xe.firstChild;)qe.appendChild(ht);return qe}var cn;typeof window.getComputedStyle!=_e?cn=function(xe,qe){return we(xe).getComputedStyle(xe,null)[qe]}:typeof document.documentElement.currentStyle!=_e?cn=function(xe,qe){return xe.currentStyle?xe.currentStyle[qe]:""}:ce.fail("No means of obtaining computed style properties found");function lt(xe,qe,ht){var _t=Ke(xe),$t=xe.createElement("div");$t.contentEditable=""+!!ht,qe&&($t.innerHTML=qe);var zt=_t.firstChild;return zt?_t.insertBefore($t,zt):_t.appendChild($t),$t}function fn(xe){return xe.parentNode.removeChild(xe)}function Ut(xe){this.root=xe,this._next=xe}Ut.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var xe=this._current=this._next,qe,ht;if(this._current)if(qe=xe.firstChild,qe)this._next=qe;else{for(ht=null;xe!==this.root&&!(ht=xe.nextSibling);)xe=xe.parentNode;this._next=ht}return this._current},detach:function(){this._current=this._next=this.root=null}};function Pt(xe){return new Ut(xe)}function Rt(xe,qe){this.node=xe,this.offset=qe}Rt.prototype={equals:function(xe){return!!xe&&this.node===xe.node&&this.offset==xe.offset},inspect:function(){return"[DomPosition("+Tt(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function Jt(xe){this.code=this[xe],this.codeName=xe,this.message="DOMException: "+this.codeName}Jt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},Jt.prototype.toString=function(){return this.message},te.dom={arrayContains:Nt,isHtmlNamespace:ot,parentElement:Bt,getNodeIndex:bt,getNodeLength:rn,getCommonAncestor:ln,isAncestorOf:Z,isOrIsAncestorOf:N,getClosestAncestorIn:H,isCharacterDataNode:J,isTextOrCommentNode:X,insertAfter:re,splitDataNode:ne,getDocument:ue,getWindow:we,getIframeWindow:Pe,getIframeDocument:Se,getBody:Ke,isWindow:Ge,getContentDocument:at,getRootContainer:ut,comparePoints:kt,isBrokenNode:rt,inspectNode:Tt,getComputedStyleProperty:cn,createTestElement:lt,removeNode:fn,fragmentFromNodeChildren:et,createIterator:Pt,DomPosition:Rt},te.DOMException=Jt}),$.createCoreModule("DomRange",["DomUtil"],function(te,ce){var _e=te.dom,Ie=te.util,Ke=_e.DomPosition,$e=te.DOMException,Ue=_e.isCharacterDataNode,Nt=_e.getNodeIndex,ot=_e.isOrIsAncestorOf,Bt=_e.getDocument,bt=_e.comparePoints,rn=_e.splitDataNode,ln=_e.getClosestAncestorIn,Z=_e.getNodeLength,N=_e.arrayContains,H=_e.getRootContainer,J=te.features.crashyTextNodes,X=_e.removeNode;function re(K,M){return K.nodeType!=3&&(ot(K,M.startContainer)||ot(K,M.endContainer))}function ne(K){return K.document||Bt(K.startContainer)}function ue(K){return H(K.startContainer)}function we(K){return new Ke(K.parentNode,Nt(K))}function Se(K){return new Ke(K.parentNode,Nt(K)+1)}function Pe(K,M,U){var de=K.nodeType==11?K.firstChild:K;return Ue(M)?U==M.length?_e.insertAfter(K,M):M.parentNode.insertBefore(K,U==0?M:rn(M,U)):U>=M.childNodes.length?M.appendChild(K):M.insertBefore(K,M.childNodes[U]),de}function Ge(K,M,U){if(Gt(K),Gt(M),ne(M)!=ne(K))throw new $e("WRONG_DOCUMENT_ERR");var de=bt(K.startContainer,K.startOffset,M.endContainer,M.endOffset),Ee=bt(K.endContainer,K.endOffset,M.startContainer,M.startOffset);return U?de<=0&&Ee>=0:de<0&&Ee>0}function at(K){for(var M,U,de=ne(K.range).createDocumentFragment(),Ee;U=K.next();){if(M=K.isPartiallySelectedSubtree(),U=U.cloneNode(!M),M&&(Ee=K.getSubtreeIterator(),U.appendChild(at(Ee)),Ee.detach()),U.nodeType==10)throw new $e("HIERARCHY_REQUEST_ERR");de.appendChild(U)}return de}function ut(K,M,U){var de,Ee;U=U||{stop:!1};for(var pe,be;pe=K.next();)if(K.isPartiallySelectedSubtree()){if(M(pe)===!1){U.stop=!0;return}else if(be=K.getSubtreeIterator(),ut(be,M,U),be.detach(),U.stop)return}else for(de=_e.createIterator(pe);Ee=de.next();)if(M(Ee)===!1){U.stop=!0;return}}function kt(K){for(var M;K.next();)K.isPartiallySelectedSubtree()?(M=K.getSubtreeIterator(),kt(M),M.detach()):K.remove()}function Xe(K){for(var M,U=ne(K.range).createDocumentFragment(),de;M=K.next();){if(K.isPartiallySelectedSubtree()?(M=M.cloneNode(!1),de=K.getSubtreeIterator(),M.appendChild(Xe(de)),de.detach()):K.remove(),M.nodeType==10)throw new $e("HIERARCHY_REQUEST_ERR");U.appendChild(M)}return U}function rt(K,M,U){var de=!!(M&&M.length),Ee,pe=!!U;de&&(Ee=new RegExp("^("+M.join("|")+")$"));var be=[];return ut(new et(K,!1),function(Je){if(!(de&&!Ee.test(Je.nodeType))&&!(pe&&!U(Je))){var ct=K.startContainer;if(!(Je==ct&&Ue(ct)&&K.startOffset==ct.length)){var Ot=K.endContainer;Je==Ot&&Ue(Ot)&&K.endOffset==0||be.push(Je)}}}),be}function Tt(K){var M=typeof K.getName>"u"?"Range":K.getName();return"["+M+"("+_e.inspectNode(K.startContainer)+":"+K.startOffset+", "+_e.inspectNode(K.endContainer)+":"+K.endOffset+")]"}function et(K,M){if(this.range=K,this.clonePartiallySelectedTextNodes=M,!K.collapsed){this.sc=K.startContainer,this.so=K.startOffset,this.ec=K.endContainer,this.eo=K.endOffset;var U=K.commonAncestorContainer;this.sc===this.ec&&Ue(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===U&&!Ue(this.sc)?this.sc.childNodes[this.so]:ln(this.sc,U,!0),this._last=this.ec===U&&!Ue(this.ec)?this.ec.childNodes[this.eo-1]:ln(this.ec,U,!0))}}et.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var K=this._current=this._next;return K&&(this._next=K!==this._last?K.nextSibling:null,Ue(K)&&this.clonePartiallySelectedTextNodes&&(K===this.ec&&(K=K.cloneNode(!0)).deleteData(this.eo,K.length-this.eo),this._current===this.sc&&(K=K.cloneNode(!0)).deleteData(0,this.so))),K},remove:function(){var K=this._current,M,U;Ue(K)&&(K===this.sc||K===this.ec)?(M=K===this.sc?this.so:0,U=K===this.ec?this.eo:K.length,M!=U&&K.deleteData(M,U-M)):K.parentNode&&X(K)},isPartiallySelectedSubtree:function(){var K=this._current;return re(K,this.range)},getSubtreeIterator:function(){var K;if(this.isSingleCharacterDataNode)K=this.range.cloneRange(),K.collapse(!1);else{K=new pn(ne(this.range));var M=this._current,U=M,de=0,Ee=M,pe=Z(M);ot(M,this.sc)&&(U=this.sc,de=this.so),ot(M,this.ec)&&(Ee=this.ec,pe=this.eo),It(K,U,de,Ee,pe)}return new et(K,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var cn=[1,3,4,5,7,8,10],lt=[2,9,11],fn=[5,6,10,12],Ut=[1,3,4,5,7,8,10,11],Pt=[1,3,4,5,7,8];function Rt(K){return function(M,U){for(var de,Ee=U?M:M.parentNode;Ee;){if(de=Ee.nodeType,N(K,de))return Ee;Ee=Ee.parentNode}return null}}var Jt=Rt([9,11]),xe=Rt(fn),qe=Rt([6,10,12]),ht=Rt([1]);function _t(K,M){if(qe(K,M))throw new $e("INVALID_NODE_TYPE_ERR")}function $t(K,M){if(!N(M,K.nodeType))throw new $e("INVALID_NODE_TYPE_ERR")}function zt(K,M){if(M<0||M>(Ue(K)?K.length:K.childNodes.length))throw new $e("INDEX_SIZE_ERR")}function Jn(K,M){if(Jt(K,!0)!==Jt(M,!0))throw new $e("WRONG_DOCUMENT_ERR")}function gn(K){if(xe(K,!0))throw new $e("NO_MODIFICATION_ALLOWED_ERR")}function $n(K,M){if(!K)throw new $e(M)}function Ur(K,M){return M<=(Ue(K)?K.length:K.childNodes.length)}function Vr(K){return!!K.startContainer&&!!K.endContainer&&!(J&&(_e.isBrokenNode(K.startContainer)||_e.isBrokenNode(K.endContainer)))&&H(K.startContainer)==H(K.endContainer)&&Ur(K.startContainer,K.startOffset)&&Ur(K.endContainer,K.endOffset)}function Gt(K){if(!Vr(K))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+K.inspect()+")")}var Or=document.createElement("style"),En=!1;try{Or.innerHTML="<b>x</b>",En=Or.firstChild.nodeType==3}catch{}te.features.htmlParsingConforms=En;var kr=En?function(K){var M=this.startContainer,U=Bt(M);if(!M)throw new $e("INVALID_STATE_ERR");var de=null;return M.nodeType==1?de=M:Ue(M)&&(de=_e.parentElement(M)),de===null||de.nodeName=="HTML"&&_e.isHtmlNamespace(Bt(de).documentElement)&&_e.isHtmlNamespace(de)?de=U.createElement("body"):de=de.cloneNode(!1),de.innerHTML=K,_e.fragmentFromNodeChildren(de)}:function(K){var M=ne(this),U=M.createElement("body");return U.innerHTML=K,_e.fragmentFromNodeChildren(U)};function ai(K,M){Gt(K);var U=K.startContainer,de=K.startOffset,Ee=K.endContainer,pe=K.endOffset,be=U===Ee;Ue(Ee)&&pe>0&&pe<Ee.length&&rn(Ee,pe,M),Ue(U)&&de>0&&de<U.length&&(U=rn(U,de,M),be?(pe-=de,Ee=U):Ee==U.parentNode&&pe>=Nt(U)&&pe++,de=0),K.setStartAndEnd(U,de,Ee,pe)}function Et(K){Gt(K);var M=K.commonAncestorContainer.parentNode.cloneNode(!1);return M.appendChild(K.cloneContents()),M.innerHTML}var Ni=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],jr=0,Fn=1,ir=2,or=3,Nr=0,Xr=1,Mr=2,Hr=3;Ie.extend(te.rangePrototype,{compareBoundaryPoints:function(K,M){Gt(this),Jn(this.startContainer,M.startContainer);var U,de,Ee,pe,be=K==or||K==jr?"start":"end",Je=K==Fn||K==jr?"start":"end";return U=this[be+"Container"],de=this[be+"Offset"],Ee=M[Je+"Container"],pe=M[Je+"Offset"],bt(U,de,Ee,pe)},insertNode:function(K){if(Gt(this),$t(K,Ut),gn(this.startContainer),ot(K,this.startContainer))throw new $e("HIERARCHY_REQUEST_ERR");var M=Pe(K,this.startContainer,this.startOffset);this.setStartBefore(M)},cloneContents:function(){Gt(this);var K,M;if(this.collapsed)return ne(this).createDocumentFragment();if(this.startContainer===this.endContainer&&Ue(this.startContainer))return K=this.startContainer.cloneNode(!0),K.data=K.data.slice(this.startOffset,this.endOffset),M=ne(this).createDocumentFragment(),M.appendChild(K),M;var U=new et(this,!0);return K=at(U),U.detach(),K},canSurroundContents:function(){Gt(this),gn(this.startContainer),gn(this.endContainer);var K=new et(this,!0),M=K._first&&re(K._first,this)||K._last&&re(K._last,this);return K.detach(),!M},surroundContents:function(K){if($t(K,Pt),!this.canSurroundContents())throw new $e("INVALID_STATE_ERR");var M=this.extractContents();if(K.hasChildNodes())for(;K.lastChild;)K.removeChild(K.lastChild);Pe(K,this.startContainer,this.startOffset),K.appendChild(M),this.selectNode(K)},cloneRange:function(){Gt(this);for(var K=new pn(ne(this)),M=Ni.length,U;M--;)U=Ni[M],K[U]=this[U];return K},toString:function(){Gt(this);var K=this.startContainer;if(K===this.endContainer&&Ue(K))return K.nodeType==3||K.nodeType==4?K.data.slice(this.startOffset,this.endOffset):"";var M=[],U=new et(this,!0);return ut(U,function(de){(de.nodeType==3||de.nodeType==4)&&M.push(de.data)}),U.detach(),M.join("")},compareNode:function(K){Gt(this);var M=K.parentNode,U=Nt(K);if(!M)throw new $e("NOT_FOUND_ERR");var de=this.comparePoint(M,U),Ee=this.comparePoint(M,U+1);return de<0?Ee>0?Mr:Nr:Ee>0?Xr:Hr},comparePoint:function(K,M){return Gt(this),$n(K,"HIERARCHY_REQUEST_ERR"),Jn(K,this.startContainer),bt(K,M,this.startContainer,this.startOffset)<0?-1:bt(K,M,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:kr,toHtml:function(){return Et(this)},intersectsNode:function(K,M){if(Gt(this),H(K)!=ue(this))return!1;var U=K.parentNode,de=Nt(K);if(!U)return!0;var Ee=bt(U,de,this.endContainer,this.endOffset),pe=bt(U,de+1,this.startContainer,this.startOffset);return M?Ee<=0&&pe>=0:Ee<0&&pe>0},isPointInRange:function(K,M){return Gt(this),$n(K,"HIERARCHY_REQUEST_ERR"),Jn(K,this.startContainer),bt(K,M,this.startContainer,this.startOffset)>=0&&bt(K,M,this.endContainer,this.endOffset)<=0},intersectsRange:function(K){return Ge(this,K,!1)},intersectsOrTouchesRange:function(K){return Ge(this,K,!0)},intersection:function(K){if(this.intersectsRange(K)){var M=bt(this.startContainer,this.startOffset,K.startContainer,K.startOffset),U=bt(this.endContainer,this.endOffset,K.endContainer,K.endOffset),de=this.cloneRange();return M==-1&&de.setStart(K.startContainer,K.startOffset),U==1&&de.setEnd(K.endContainer,K.endOffset),de}return null},union:function(K){if(this.intersectsOrTouchesRange(K)){var M=this.cloneRange();return bt(K.startContainer,K.startOffset,this.startContainer,this.startOffset)==-1&&M.setStart(K.startContainer,K.startOffset),bt(K.endContainer,K.endOffset,this.endContainer,this.endOffset)==1&&M.setEnd(K.endContainer,K.endOffset),M}else throw new $e("Ranges do not intersect")},containsNode:function(K,M){return M?this.intersectsNode(K,!1):this.compareNode(K)==Hr},containsNodeContents:function(K){return this.comparePoint(K,0)>=0&&this.comparePoint(K,Z(K))<=0},containsRange:function(K){var M=this.intersection(K);return M!==null&&K.equals(M)},containsNodeText:function(K){var M=this.cloneRange();M.selectNode(K);var U=M.getNodes([3]);if(U.length>0){M.setStart(U[0],0);var de=U.pop();return M.setEnd(de,de.length),this.containsRange(M)}else return this.containsNodeContents(K)},getNodes:function(K,M){return Gt(this),rt(this,K,M)},getDocument:function(){return ne(this)},collapseBefore:function(K){this.setEndBefore(K),this.collapse(!1)},collapseAfter:function(K){this.setStartAfter(K),this.collapse(!0)},getBookmark:function(K){var M=ne(this),U=te.createRange(M);K=K||_e.getBody(M),U.selectNodeContents(K);var de=this.intersection(U),Ee=0,pe=0;return de&&(U.setEnd(de.startContainer,de.startOffset),Ee=U.toString().length,pe=Ee+de.toString().length),{start:Ee,end:pe,containerNode:K}},moveToBookmark:function(K){var M=K.containerNode,U=0;this.setStart(M,0),this.collapse(!0);for(var de=[M],Ee,pe=!1,be=!1,Je,ct,Ot;!be&&(Ee=de.pop());)if(Ee.nodeType==3)Je=U+Ee.length,!pe&&K.start>=U&&K.start<=Je&&(this.setStart(Ee,K.start-U),pe=!0),pe&&K.end>=U&&K.end<=Je&&(this.setEnd(Ee,K.end-U),be=!0),U=Je;else for(Ot=Ee.childNodes,ct=Ot.length;ct--;)de.push(Ot[ct])},getName:function(){return"DomRange"},equals:function(K){return pn.rangesEqual(this,K)},isValid:function(){return Vr(this)},inspect:function(){return Tt(this)},detach:function(){}});function q(K){K.START_TO_START=jr,K.START_TO_END=Fn,K.END_TO_END=ir,K.END_TO_START=or,K.NODE_BEFORE=Nr,K.NODE_AFTER=Xr,K.NODE_BEFORE_AND_AFTER=Mr,K.NODE_INSIDE=Hr}function ge(K){q(K),q(K.prototype)}function ze(K,M){return function(){Gt(this);var U=this.startContainer,de=this.startOffset,Ee=this.commonAncestorContainer,pe=new et(this,!0),be,Je;U!==Ee&&(be=ln(U,Ee,!0),Je=Se(be),U=Je.node,de=Je.offset),ut(pe,gn),pe.reset();var ct=K(pe);return pe.detach(),M(this,U,de,U,de),ct}}function Ze(K,M){function U(be,Je){return function(ct){$t(ct,cn),$t(H(ct),lt);var Ot=(be?we:Se)(ct);(Je?de:Ee)(this,Ot.node,Ot.offset)}}function de(be,Je,ct){var Ot=be.endContainer,Cn=be.endOffset;(Je!==be.startContainer||ct!==be.startOffset)&&((H(Je)!=H(Ot)||bt(Je,ct,Ot,Cn)==1)&&(Ot=Je,Cn=ct),M(be,Je,ct,Ot,Cn))}function Ee(be,Je,ct){var Ot=be.startContainer,Cn=be.startOffset;(Je!==be.endContainer||ct!==be.endOffset)&&((H(Je)!=H(Ot)||bt(Je,ct,Ot,Cn)==-1)&&(Ot=Je,Cn=ct),M(be,Ot,Cn,Je,ct))}var pe=function(){};pe.prototype=te.rangePrototype,K.prototype=new pe,Ie.extend(K.prototype,{setStart:function(be,Je){_t(be,!0),zt(be,Je),de(this,be,Je)},setEnd:function(be,Je){_t(be,!0),zt(be,Je),Ee(this,be,Je)},setStartAndEnd:function(){var be=arguments,Je=be[0],ct=be[1],Ot=Je,Cn=ct;switch(be.length){case 3:Cn=be[2];break;case 4:Ot=be[2],Cn=be[3];break}_t(Je,!0),zt(Je,ct),_t(Ot,!0),zt(Ot,Cn),M(this,Je,ct,Ot,Cn)},setBoundary:function(be,Je,ct){this["set"+(ct?"Start":"End")](be,Je)},setStartBefore:U(!0,!0),setStartAfter:U(!1,!0),setEndBefore:U(!0,!1),setEndAfter:U(!1,!1),collapse:function(be){Gt(this),be?M(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):M(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(be){_t(be,!0),M(this,be,0,be,Z(be))},selectNode:function(be){_t(be,!1),$t(be,cn);var Je=we(be),ct=Se(be);M(this,Je.node,Je.offset,ct.node,ct.offset)},extractContents:ze(Xe,M),deleteContents:ze(kt,M),canSurroundContents:function(){Gt(this),gn(this.startContainer),gn(this.endContainer);var be=new et(this,!0),Je=be._first&&re(be._first,this)||be._last&&re(be._last,this);return be.detach(),!Je},splitBoundaries:function(){ai(this)},splitBoundariesPreservingPositions:function(be){ai(this,be)},normalizeBoundaries:function(){Gt(this);var be=this.startContainer,Je=this.startOffset,ct=this.endContainer,Ot=this.endOffset,Cn=function(mn){var $r=mn.nextSibling;$r&&$r.nodeType==mn.nodeType&&(ct=mn,Ot=mn.length,mn.appendData($r.data),X($r))},xs=function(mn){var $r=mn.previousSibling;if($r&&$r.nodeType==mn.nodeType){be=mn;var Gl=mn.length;if(Je=$r.length,mn.insertData(0,$r.data),X($r),be==ct)Ot+=Je,ct=be;else if(ct==mn.parentNode){var oo=Nt(mn);Ot==oo?(ct=mn,Ot=Gl):Ot>oo&&Ot--}}},Mt=!0,Ar;if(Ue(ct))Ot==ct.length?Cn(ct):Ot==0&&(Ar=ct.previousSibling,Ar&&Ar.nodeType==ct.nodeType&&(Ot=Ar.length,be==ct&&(Mt=!1),Ar.appendData(ct.data),X(ct),ct=Ar));else{if(Ot>0){var la=ct.childNodes[Ot-1];la&&Ue(la)&&Cn(la)}Mt=!this.collapsed}if(Mt){if(Ue(be))Je==0?xs(be):Je==be.length&&(Ar=be.nextSibling,Ar&&Ar.nodeType==be.nodeType&&(ct==Ar&&(ct=be,Ot+=be.length),be.appendData(Ar.data),X(Ar)));else if(Je<be.childNodes.length){var io=be.childNodes[Je];io&&Ue(io)&&xs(io)}}else be=ct,Je=Ot;M(this,be,Je,ct,Ot)},collapseToPoint:function(be,Je){_t(be,!0),zt(be,Je),this.setStartAndEnd(be,Je)},parentElement:function(){Gt(this);var be=this.commonAncestorContainer;return be?ht(this.commonAncestorContainer,!0):null}}),ge(K)}function We(K){K.collapsed=K.startContainer===K.endContainer&&K.startOffset===K.endOffset,K.commonAncestorContainer=K.collapsed?K.startContainer:_e.getCommonAncestor(K.startContainer,K.endContainer)}function It(K,M,U,de,Ee){K.startContainer=M,K.startOffset=U,K.endContainer=de,K.endOffset=Ee,K.document=_e.getDocument(M),We(K)}function pn(K){It(this,K,0,K,0)}Ze(pn,It),Ie.extend(pn,{rangeProperties:Ni,RangeIterator:et,copyComparisonConstants:ge,createPrototypeRange:Ze,inspect:Tt,toHtml:Et,getRangeDocument:ne,rangesEqual:function(K,M){return K.startContainer===M.startContainer&&K.startOffset===M.startOffset&&K.endContainer===M.endContainer&&K.endOffset===M.endOffset}}),te.DomRange=pn}),$.createCoreModule("WrappedRange",["DomRange"],function(te,ce){var _e,Ie,Ke=te.dom,$e=te.util,Ue=Ke.DomPosition,Nt=te.DomRange,ot=Ke.getBody,Bt=Ke.getContentDocument,bt=Ke.isCharacterDataNode;if(te.features.implementsDomRange&&function(){var X,re=Nt.rangeProperties;function ne(Xe){for(var rt=re.length,Tt;rt--;)Tt=re[rt],Xe[Tt]=Xe.nativeRange[Tt];Xe.collapsed=Xe.startContainer===Xe.endContainer&&Xe.startOffset===Xe.endOffset}function ue(Xe,rt,Tt,et,cn){var lt=Xe.startContainer!==rt||Xe.startOffset!=Tt,fn=Xe.endContainer!==et||Xe.endOffset!=cn,Ut=!Xe.equals(Xe.nativeRange);(lt||fn||Ut)&&(Xe.setEnd(et,cn),Xe.setStart(rt,Tt))}var we;_e=function(Xe){if(!Xe)throw ce.createError("WrappedRange: Range must be specified");this.nativeRange=Xe,ne(this)},Nt.createPrototypeRange(_e,ue),X=_e.prototype,X.selectNode=function(Xe){this.nativeRange.selectNode(Xe),ne(this)},X.cloneContents=function(){return this.nativeRange.cloneContents()},X.surroundContents=function(Xe){this.nativeRange.surroundContents(Xe),ne(this)},X.collapse=function(Xe){this.nativeRange.collapse(Xe),ne(this)},X.cloneRange=function(){return new _e(this.nativeRange.cloneRange())},X.refresh=function(){ne(this)},X.toString=function(){return this.nativeRange.toString()};var Se=document.createTextNode("test");ot(document).appendChild(Se);var Pe=document.createRange();Pe.setStart(Se,0),Pe.setEnd(Se,0);try{Pe.setStart(Se,1),X.setStart=function(Xe,rt){this.nativeRange.setStart(Xe,rt),ne(this)},X.setEnd=function(Xe,rt){this.nativeRange.setEnd(Xe,rt),ne(this)},we=function(Xe){return function(rt){this.nativeRange[Xe](rt),ne(this)}}}catch{X.setStart=function(rt,Tt){try{this.nativeRange.setStart(rt,Tt)}catch{this.nativeRange.setEnd(rt,Tt),this.nativeRange.setStart(rt,Tt)}ne(this)},X.setEnd=function(rt,Tt){try{this.nativeRange.setEnd(rt,Tt)}catch{this.nativeRange.setStart(rt,Tt),this.nativeRange.setEnd(rt,Tt)}ne(this)},we=function(rt,Tt){return function(et){try{this.nativeRange[rt](et)}catch{this.nativeRange[Tt](et),this.nativeRange[rt](et)}ne(this)}}}X.setStartBefore=we("setStartBefore","setEndBefore"),X.setStartAfter=we("setStartAfter","setEndAfter"),X.setEndBefore=we("setEndBefore","setStartBefore"),X.setEndAfter=we("setEndAfter","setStartAfter"),X.selectNodeContents=function(Xe){this.setStartAndEnd(Xe,0,Ke.getNodeLength(Xe))},Pe.selectNodeContents(Se),Pe.setEnd(Se,3);var Ge=document.createRange();Ge.selectNodeContents(Se),Ge.setEnd(Se,4),Ge.setStart(Se,2),Pe.compareBoundaryPoints(Pe.START_TO_END,Ge)==-1&&Pe.compareBoundaryPoints(Pe.END_TO_START,Ge)==1?X.compareBoundaryPoints=function(Xe,rt){return rt=rt.nativeRange||rt,Xe==rt.START_TO_END?Xe=rt.END_TO_START:Xe==rt.END_TO_START&&(Xe=rt.START_TO_END),this.nativeRange.compareBoundaryPoints(Xe,rt)}:X.compareBoundaryPoints=function(Xe,rt){return this.nativeRange.compareBoundaryPoints(Xe,rt.nativeRange||rt)};var at=document.createElement("div");at.innerHTML="123";var ut=at.firstChild,kt=ot(document);kt.appendChild(at),Pe.setStart(ut,1),Pe.setEnd(ut,2),Pe.deleteContents(),ut.data=="13"&&(X.deleteContents=function(){this.nativeRange.deleteContents(),ne(this)},X.extractContents=function(){var Xe=this.nativeRange.extractContents();return ne(this),Xe}),kt.removeChild(at),kt=null,$e.isHostMethod(Pe,"createContextualFragment")&&(X.createContextualFragment=function(Xe){return this.nativeRange.createContextualFragment(Xe)}),ot(document).removeChild(Se),X.getName=function(){return"WrappedRange"},te.WrappedRange=_e,te.createNativeRange=function(Xe){return Xe=Bt(Xe,ce,"createNativeRange"),Xe.createRange()}}(),te.features.implementsTextRange){var rn=function(X){var re=X.parentElement(),ne=X.duplicate();ne.collapse(!0);var ue=ne.parentElement();ne=X.duplicate(),ne.collapse(!1);var we=ne.parentElement(),Se=ue==we?ue:Ke.getCommonAncestor(ue,we);return Se==re?Se:Ke.getCommonAncestor(re,Se)},ln=function(X){return X.compareEndPoints("StartToEnd",X)==0},Z=function(X,re,ne,ue,we){var Se=X.duplicate();Se.collapse(ne);var Pe=Se.parentElement();if(Ke.isOrIsAncestorOf(re,Pe)||(Pe=re),!Pe.canHaveHTML){var Ge=new Ue(Pe.parentNode,Ke.getNodeIndex(Pe));return{boundaryPosition:Ge,nodeInfo:{nodeIndex:Ge.offset,containerElement:Ge.node}}}var at=Ke.getDocument(Pe).createElement("span");at.parentNode&&Ke.removeNode(at);for(var ut,kt=ne?"StartToStart":"StartToEnd",Xe,rt,Tt,et,cn=we&&we.containerElement==Pe?we.nodeIndex:0,lt=Pe.childNodes.length,fn=lt,Ut=fn;Ut==lt?Pe.appendChild(at):Pe.insertBefore(at,Pe.childNodes[Ut]),Se.moveToElementText(at),ut=Se.compareEndPoints(kt,X),!(ut==0||cn==fn);){if(ut==-1){if(fn==cn+1)break;cn=Ut}else fn=fn==cn+1?cn:Ut;Ut=Math.floor((cn+fn)/2),Pe.removeChild(at)}if(et=at.nextSibling,ut==-1&&et&&bt(et)){Se.setEndPoint(ne?"EndToStart":"EndToEnd",X);var Pt;if(/[\r\n]/.test(et.data)){var Rt=Se.duplicate(),Jt=Rt.text.replace(/\r\n/g,"\r").length;for(Pt=Rt.moveStart("character",Jt);(ut=Rt.compareEndPoints("StartToEnd",Rt))==-1;)Pt++,Rt.moveStart("character",1)}else Pt=Se.text.length;Tt=new Ue(et,Pt)}else Xe=(ue||!ne)&&at.previousSibling,rt=(ue||ne)&&at.nextSibling,rt&&bt(rt)?Tt=new Ue(rt,0):Xe&&bt(Xe)?Tt=new Ue(Xe,Xe.data.length):Tt=new Ue(Pe,Ke.getNodeIndex(at));return Ke.removeNode(at),{boundaryPosition:Tt,nodeInfo:{nodeIndex:Ut,containerElement:Pe}}},N=function(X,re){var ne,ue,we=X.offset,Se=Ke.getDocument(X.node),Pe,Ge,at=ot(Se).createTextRange(),ut=bt(X.node);return ut?(ne=X.node,ue=ne.parentNode):(Ge=X.node.childNodes,ne=we<Ge.length?Ge[we]:null,ue=X.node),Pe=Se.createElement("span"),Pe.innerHTML="&#feff;",ne?ue.insertBefore(Pe,ne):ue.appendChild(Pe),at.moveToElementText(Pe),at.collapse(!re),ue.removeChild(Pe),ut&&at[re?"moveStart":"moveEnd"]("character",we),at};Ie=function(X){this.textRange=X,this.refresh()},Ie.prototype=new Nt(document),Ie.prototype.refresh=function(){var X,re,ne,ue=rn(this.textRange);ln(this.textRange)?re=X=Z(this.textRange,ue,!0,!0).boundaryPosition:(ne=Z(this.textRange,ue,!0,!1),X=ne.boundaryPosition,re=Z(this.textRange,ue,!1,!1,ne.nodeInfo).boundaryPosition),this.setStart(X.node,X.offset),this.setEnd(re.node,re.offset)},Ie.prototype.getName=function(){return"WrappedTextRange"},Nt.copyComparisonConstants(Ie);var H=function(X){if(X.collapsed)return N(new Ue(X.startContainer,X.startOffset),!0);var re=N(new Ue(X.startContainer,X.startOffset),!0),ne=N(new Ue(X.endContainer,X.endOffset),!1),ue=ot(Nt.getRangeDocument(X)).createTextRange();return ue.setEndPoint("StartToStart",re),ue.setEndPoint("EndToEnd",ne),ue};if(Ie.rangeToTextRange=H,Ie.prototype.toTextRange=function(){return H(this)},te.WrappedTextRange=Ie,!te.features.implementsDomRange||te.config.preferTextRange){var J=function(X){return X("return this;")()}(Function);typeof J.Range>"u"&&(J.Range=Ie),te.createNativeRange=function(X){return X=Bt(X,ce,"createNativeRange"),ot(X).createTextRange()},te.WrappedRange=Ie}}te.createRange=function(X){return X=Bt(X,ce,"createRange"),new te.WrappedRange(te.createNativeRange(X))},te.createRangyRange=function(X){return X=Bt(X,ce,"createRangyRange"),new Nt(X)},$e.createAliasForDeprecatedMethod(te,"createIframeRange","createRange"),$e.createAliasForDeprecatedMethod(te,"createIframeRangyRange","createRangyRange"),te.addShimListener(function(X){var re=X.document;typeof re.createRange>"u"&&(re.createRange=function(){return te.createRange(re)}),re=X=null})}),$.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(te,ce){te.config.checkSelectionRanges=!0;var _e="boolean",Ie="number",Ke=te.dom,$e=te.util,Ue=$e.isHostMethod,Nt=te.DomRange,ot=te.WrappedRange,Bt=te.DOMException,bt=Ke.DomPosition,rn,ln,Z=te.features,N="Control",H=Ke.getDocument,J=Ke.getBody,X=Nt.rangesEqual;function re(q){return typeof q=="string"?/^backward(s)?$/i.test(q):!!q}function ne(q,ge){if(q){if(Ke.isWindow(q))return q;if(q instanceof Gt)return q.win;var ze=Ke.getContentDocument(q,ce,ge);return Ke.getWindow(ze)}else return window}function ue(q){return ne(q,"getWinSelection").getSelection()}function we(q){return ne(q,"getDocSelection").document.selection}function Se(q){var ge=!1;return q.anchorNode&&(ge=Ke.comparePoints(q.anchorNode,q.anchorOffset,q.focusNode,q.focusOffset)==1),ge}var Pe=Ue(window,"getSelection"),Ge=$e.isHostObject(document,"selection");Z.implementsWinGetSelection=Pe,Z.implementsDocSelection=Ge;var at=Ge&&(!Pe||te.config.preferTextRange);if(at)rn=we,te.isSelectionValid=function(q){var ge=ne(q,"isSelectionValid").document,ze=ge.selection;return ze.type!="None"||H(ze.createRange().parentElement())==ge};else if(Pe)rn=ue,te.isSelectionValid=function(){return!0};else return ce.fail("Neither document.selection or window.getSelection() detected."),!1;te.getNativeSelection=rn;var ut=rn();if(!ut)return ce.fail("Native selection was null (possibly issue 138?)"),!1;var kt=te.createNativeRange(document),Xe=J(document),rt=$e.areHostProperties(ut,["anchorNode","focusNode","anchorOffset","focusOffset"]);Z.selectionHasAnchorAndFocus=rt;var Tt=Ue(ut,"extend");Z.selectionHasExtend=Tt;var et=Ue(ut,"setBaseAndExtent");Z.selectionHasSetBaseAndExtent=et;var cn=typeof ut.rangeCount==Ie;Z.selectionHasRangeCount=cn;var lt=!1,fn=!0,Ut=Tt?function(q,ge){var ze=Nt.getRangeDocument(ge),Ze=te.createRange(ze);Ze.collapseToPoint(ge.endContainer,ge.endOffset),q.addRange(_t(Ze)),q.extend(ge.startContainer,ge.startOffset)}:null;$e.areHostMethods(ut,["addRange","getRangeAt","removeAllRanges"])&&typeof ut.rangeCount==Ie&&Z.implementsDomRange&&function(){var q=window.getSelection();if(q){for(var ge=q.rangeCount,ze=ge>1,Ze=[],We=Se(q),It=0;It<ge;++It)Ze[It]=q.getRangeAt(It);var pn=Ke.createTestElement(document,"",!1),K=pn.appendChild(document.createTextNode("   ")),M=document.createRange();if(M.setStart(K,1),M.collapse(!0),q.removeAllRanges(),q.addRange(M),fn=q.rangeCount==1,q.removeAllRanges(),!ze){var U=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(U&&parseInt(U[1])>=36)lt=!1;else{var de=M.cloneRange();M.setStart(K,0),de.setEnd(K,3),de.setStart(K,2),q.addRange(M),q.addRange(de),lt=q.rangeCount==2}}for(Ke.removeNode(pn),q.removeAllRanges(),It=0;It<ge;++It)It==0&&We?Ut?Ut(q,Ze[It]):(te.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),q.addRange(Ze[It])):q.addRange(Ze[It])}}(),Z.selectionSupportsMultipleRanges=lt,Z.collapsedNonEditableSelectionsSupported=fn;var Pt=!1,Rt;Xe&&Ue(Xe,"createControlRange")&&(Rt=Xe.createControlRange(),$e.areHostProperties(Rt,["item","add"])&&(Pt=!0)),Z.implementsControlRange=Pt,rt?ln=function(q){return q.anchorNode===q.focusNode&&q.anchorOffset===q.focusOffset}:ln=function(q){return q.rangeCount?q.getRangeAt(q.rangeCount-1).collapsed:!1};function Jt(q,ge,ze){var Ze=ze?"end":"start",We=ze?"start":"end";q.anchorNode=ge[Ze+"Container"],q.anchorOffset=ge[Ze+"Offset"],q.focusNode=ge[We+"Container"],q.focusOffset=ge[We+"Offset"]}function xe(q){var ge=q.nativeSelection;q.anchorNode=ge.anchorNode,q.anchorOffset=ge.anchorOffset,q.focusNode=ge.focusNode,q.focusOffset=ge.focusOffset}function qe(q){q.anchorNode=q.focusNode=null,q.anchorOffset=q.focusOffset=0,q.rangeCount=0,q.isCollapsed=!0,q._ranges.length=0,ht(q)}function ht(q){q.type=q.rangeCount==0?"None":ln(q)?"Caret":"Range"}function _t(q){var ge;return q instanceof Nt?(ge=te.createNativeRange(q.getDocument()),ge.setEnd(q.endContainer,q.endOffset),ge.setStart(q.startContainer,q.startOffset)):q instanceof ot?ge=q.nativeRange:Z.implementsDomRange&&q instanceof Ke.getWindow(q.startContainer).Range&&(ge=q),ge}function $t(q){if(!q.length||q[0].nodeType!=1)return!1;for(var ge=1,ze=q.length;ge<ze;++ge)if(!Ke.isAncestorOf(q[0],q[ge]))return!1;return!0}function zt(q){var ge=q.getNodes();if(!$t(ge))throw ce.createError("getSingleElementFromRange: range "+q.inspect()+" did not consist of a single element");return ge[0]}function Jn(q){return!!q&&typeof q.text<"u"}function gn(q,ge){var ze=new ot(ge);q._ranges=[ze],Jt(q,ze,!1),q.rangeCount=1,q.isCollapsed=ze.collapsed,ht(q)}function $n(q){if(q._ranges.length=0,q.docSelection.type=="None")qe(q);else{var ge=q.docSelection.createRange();if(Jn(ge))gn(q,ge);else{q.rangeCount=ge.length;for(var ze,Ze=H(ge.item(0)),We=0;We<q.rangeCount;++We)ze=te.createRange(Ze),ze.selectNode(ge.item(We)),q._ranges.push(ze);q.isCollapsed=q.rangeCount==1&&q._ranges[0].collapsed,Jt(q,q._ranges[q.rangeCount-1],!1),ht(q)}}}function Ur(q,ge){for(var ze=q.docSelection.createRange(),Ze=zt(ge),We=H(ze.item(0)),It=J(We).createControlRange(),pn=0,K=ze.length;pn<K;++pn)It.add(ze.item(pn));try{It.add(Ze)}catch{throw ce.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}It.select(),$n(q)}var Vr;Ue(ut,"getRangeAt")?Vr=function(q,ge){try{return q.getRangeAt(ge)}catch{return null}}:rt&&(Vr=function(q){var ge=H(q.anchorNode),ze=te.createRange(ge);return ze.setStartAndEnd(q.anchorNode,q.anchorOffset,q.focusNode,q.focusOffset),ze.collapsed!==this.isCollapsed&&ze.setStartAndEnd(q.focusNode,q.focusOffset,q.anchorNode,q.anchorOffset),ze});function Gt(q,ge,ze){this.nativeSelection=q,this.docSelection=ge,this._ranges=[],this.win=ze,this.refresh()}Gt.prototype=te.selectionPrototype;function Or(q){q.win=q.anchorNode=q.focusNode=q._ranges=null,q.rangeCount=q.anchorOffset=q.focusOffset=0,q.detached=!0,ht(q)}var En=[];function kr(q,ge){for(var ze=En.length,Ze,We;ze--;)if(Ze=En[ze],We=Ze.selection,ge=="deleteAll")Or(We);else if(Ze.win==q)return ge=="delete"?(En.splice(ze,1),!0):We;return ge=="deleteAll"&&(En.length=0),null}var ai=function(q){if(q&&q instanceof Gt)return q.refresh(),q;q=ne(q,"getNativeSelection");var ge=kr(q),ze=rn(q),Ze=Ge?we(q):null;return ge?(ge.nativeSelection=ze,ge.docSelection=Ze,ge.refresh()):(ge=new Gt(ze,Ze,q),En.push({win:q,selection:ge})),ge};te.getSelection=ai,$e.createAliasForDeprecatedMethod(te,"getIframeSelection","getSelection");var Et=Gt.prototype;function Ni(q,ge){for(var ze=H(ge[0].startContainer),Ze=J(ze).createControlRange(),We=0,It,pn=ge.length;We<pn;++We){It=zt(ge[We]);try{Ze.add(It)}catch{throw ce.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}Ze.select(),$n(q)}if(!at&&rt&&$e.areHostMethods(ut,["removeAllRanges","addRange"])){Et.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),qe(this)};var jr=function(q,ge){Ut(q.nativeSelection,ge),q.refresh()};cn?Et.addRange=function(q,ge){if(Pt&&Ge&&this.docSelection.type==N)Ur(this,q);else if(re(ge)&&Tt)jr(this,q);else{var ze;lt?ze=this.rangeCount:(this.removeAllRanges(),ze=0);var Ze=_t(q).cloneRange();try{this.nativeSelection.addRange(Ze)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==ze+1){if(te.config.checkSelectionRanges){var We=Vr(this.nativeSelection,this.rangeCount-1);We&&!X(We,q)&&(q=new ot(We))}this._ranges[this.rangeCount-1]=q,Jt(this,q,or(this.nativeSelection)),this.isCollapsed=ln(this),ht(this)}else this.refresh()}}:Et.addRange=function(q,ge){re(ge)&&Tt?jr(this,q):(this.nativeSelection.addRange(_t(q)),this.refresh())},Et.setRanges=function(q){if(Pt&&Ge&&q.length>1)Ni(this,q);else{this.removeAllRanges();for(var ge=0,ze=q.length;ge<ze;++ge)this.addRange(q[ge])}}}else if(Ue(ut,"empty")&&Ue(kt,"select")&&Pt&&at)Et.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var q;if(this.anchorNode)q=H(this.anchorNode);else if(this.docSelection.type==N){var ge=this.docSelection.createRange();ge.length&&(q=H(ge.item(0)))}if(q){var ze=J(q).createTextRange();ze.select(),this.docSelection.empty()}}}catch{}qe(this)},Et.addRange=function(q){this.docSelection.type==N?Ur(this,q):(te.WrappedTextRange.rangeToTextRange(q).select(),this._ranges[0]=q,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,Jt(this,q,!1),ht(this))},Et.setRanges=function(q){this.removeAllRanges();var ge=q.length;ge>1?Ni(this,q):ge&&this.addRange(q[0])};else return ce.fail("No means of selecting a Range or TextRange was found"),!1;Et.getRangeAt=function(q){if(q<0||q>=this.rangeCount)throw new Bt("INDEX_SIZE_ERR");return this._ranges[q].cloneRange()};var Fn;if(at)Fn=function(q){var ge;te.isSelectionValid(q.win)?ge=q.docSelection.createRange():(ge=J(q.win.document).createTextRange(),ge.collapse(!0)),q.docSelection.type==N?$n(q):Jn(ge)?gn(q,ge):qe(q)};else if(Ue(ut,"getRangeAt")&&typeof ut.rangeCount==Ie)Fn=function(q){if(Pt&&Ge&&q.docSelection.type==N)$n(q);else if(q._ranges.length=q.rangeCount=q.nativeSelection.rangeCount,q.rangeCount){for(var ge=0,ze=q.rangeCount;ge<ze;++ge)q._ranges[ge]=new te.WrappedRange(q.nativeSelection.getRangeAt(ge));Jt(q,q._ranges[q.rangeCount-1],or(q.nativeSelection)),q.isCollapsed=ln(q),ht(q)}else qe(q)};else if(rt&&typeof ut.isCollapsed==_e&&typeof kt.collapsed==_e&&Z.implementsDomRange)Fn=function(q){var ge,ze=q.nativeSelection;ze.anchorNode?(ge=Vr(ze,0),q._ranges=[ge],q.rangeCount=1,xe(q),q.isCollapsed=ln(q),ht(q)):qe(q)};else return ce.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Et.refresh=function(q){var ge=q?this._ranges.slice(0):null,ze=this.anchorNode,Ze=this.anchorOffset;if(Fn(this),q){var We=ge.length;if(We!=this._ranges.length||this.anchorNode!=ze||this.anchorOffset!=Ze)return!0;for(;We--;)if(!X(ge[We],this._ranges[We]))return!0;return!1}};var ir=function(q,ge){var ze=q.getAllRanges();q.removeAllRanges();for(var Ze=0,We=ze.length;Ze<We;++Ze)X(ge,ze[Ze])||q.addRange(ze[Ze]);q.rangeCount||qe(q)};Pt&&Ge?Et.removeRange=function(q){if(this.docSelection.type==N){for(var ge=this.docSelection.createRange(),ze=zt(q),Ze=H(ge.item(0)),We=J(Ze).createControlRange(),It,pn=!1,K=0,M=ge.length;K<M;++K)It=ge.item(K),It!==ze||pn?We.add(ge.item(K)):pn=!0;We.select(),$n(this)}else ir(this,q)}:Et.removeRange=function(q){ir(this,q)};var or;!at&&rt&&Z.implementsDomRange?(or=Se,Et.isBackward=function(){return or(this)}):or=Et.isBackward=function(){return!1},Et.isBackwards=Et.isBackward,Et.toString=function(){for(var q=[],ge=0,ze=this.rangeCount;ge<ze;++ge)q[ge]=""+this._ranges[ge];return q.join("")};function Nr(q,ge){if(q.win.document!=H(ge))throw new Bt("WRONG_DOCUMENT_ERR")}function Xr(q,ge){if(ge<0||ge>(Ke.isCharacterDataNode(q)?q.length:q.childNodes.length))throw new Bt("INDEX_SIZE_ERR")}Et.collapse=function(q,ge){Nr(this,q);var ze=te.createRange(q);ze.collapseToPoint(q,ge),this.setSingleRange(ze),this.isCollapsed=!0},Et.collapseToStart=function(){if(this.rangeCount){var q=this._ranges[0];this.collapse(q.startContainer,q.startOffset)}else throw new Bt("INVALID_STATE_ERR")},Et.collapseToEnd=function(){if(this.rangeCount){var q=this._ranges[this.rangeCount-1];this.collapse(q.endContainer,q.endOffset)}else throw new Bt("INVALID_STATE_ERR")},Et.selectAllChildren=function(q){Nr(this,q);var ge=te.createRange(q);ge.selectNodeContents(q),this.setSingleRange(ge)},et?Et.setBaseAndExtent=function(q,ge,ze,Ze){this.nativeSelection.setBaseAndExtent(q,ge,ze,Ze),this.refresh()}:Tt&&(Et.setBaseAndExtent=function(q,ge,ze,Ze){Xr(q,ge),Xr(ze,Ze),Nr(this,q),Nr(this,ze);var We=te.createRange(node),It=Ke.comparePoints(q,ge,ze,Ze)==-1;It?We.setStartAndEnd(ze,Ze,q,ge):We.setStartAndEnd(q,ge,ze,Ze),this.setSingleRange(We,It)}),Et.deleteFromDocument=function(){if(Pt&&Ge&&this.docSelection.type==N){for(var q=this.docSelection.createRange(),ge;q.length;)ge=q.item(0),q.remove(ge),Ke.removeNode(ge);this.refresh()}else if(this.rangeCount){var ze=this.getAllRanges();if(ze.length){this.removeAllRanges();for(var Ze=0,We=ze.length;Ze<We;++Ze)ze[Ze].deleteContents();this.addRange(ze[We-1])}}},Et.eachRange=function(q,ge){for(var ze=0,Ze=this._ranges.length;ze<Ze;++ze)if(q(this.getRangeAt(ze)))return ge},Et.getAllRanges=function(){var q=[];return this.eachRange(function(ge){q.push(ge)}),q},Et.setSingleRange=function(q,ge){this.removeAllRanges(),this.addRange(q,ge)},Et.callMethodOnEachRange=function(q,ge){var ze=[];return this.eachRange(function(Ze){ze.push(Ze[q].apply(Ze,ge||[]))}),ze};function Mr(q){return function(ge,ze){var Ze;this.rangeCount?(Ze=this.getRangeAt(0),Ze["set"+(q?"Start":"End")](ge,ze)):(Ze=te.createRange(this.win.document),Ze.setStartAndEnd(ge,ze)),this.setSingleRange(Ze,this.isBackward())}}Et.setStart=Mr(!0),Et.setEnd=Mr(!1),te.rangePrototype.select=function(q){ai(this.getDocument()).setSingleRange(this,q)},Et.changeEachRange=function(q){var ge=[],ze=this.isBackward();this.eachRange(function(Ze){q(Ze),ge.push(Ze)}),this.removeAllRanges(),ze&&ge.length==1?this.addRange(ge[0],"backward"):this.setRanges(ge)},Et.containsNode=function(q,ge){return this.eachRange(function(ze){return ze.containsNode(q,ge)},!0)||!1},Et.getBookmark=function(q){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[q])}},Et.moveToBookmark=function(q){for(var ge=[],ze=0,Ze,We;Ze=q.rangeBookmarks[ze++];)We=te.createRange(this.win),We.moveToBookmark(Ze),ge.push(We);q.backward?this.setSingleRange(ge[0],"backward"):this.setRanges(ge)},Et.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Et.restoreRanges=function(q){this.removeAllRanges();for(var ge=0,ze;ze=q.ranges[ge];++ge)this.addRange(ze,q.backward&&ge==0)},Et.toHtml=function(){var q=[];return this.eachRange(function(ge){q.push(Nt.toHtml(ge))}),q.join("")},Z.implementsTextRange&&(Et.getNativeTextRange=function(){var q;if(q=this.docSelection){var ge=q.createRange();if(Jn(ge))return ge;throw ce.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return te.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw ce.createError("getNativeTextRange: selection contains no range")}});function Hr(q){var ge=[],ze=new bt(q.anchorNode,q.anchorOffset),Ze=new bt(q.focusNode,q.focusOffset),We=typeof q.getName=="function"?q.getName():"Selection";if(typeof q.rangeCount<"u")for(var It=0,pn=q.rangeCount;It<pn;++It)ge[It]=Nt.inspect(q.getRangeAt(It));return"["+We+"(Ranges: "+ge.join(", ")+")(anchor: "+ze.inspect()+", focus: "+Ze.inspect()+"]"}Et.getName=function(){return"WrappedSelection"},Et.inspect=function(){return Hr(this)},Et.detach=function(){kr(this.win,"delete"),Or(this)},Gt.detachAll=function(){kr(null,"deleteAll")},Gt.inspect=Hr,Gt.isDirectionBackward=re,te.Selection=Gt,te.selectionPrototype=Et,te.addShimListener(function(q){typeof q.getSelection>"u"&&(q.getSelection=function(){return ai(q)}),q=null})});var Ve=!1,Ae=function(te){Ve||(Ve=!0,!$.initialized&&$.config.autoInitialize&&P())};return D&&(document.readyState=="complete"?Ae():(c(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",Ae,!1),Q(window,"load",Ae))),$})}(Pf)),Pf.exports}var IB=Rw();const Dy=ls(IB);var Rf={exports:{}},Ly;function BB(){return Ly||(Ly=1,function(r,e){(function(t,n){r.exports=t(Rw())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(n,i){var o=n.dom,s=o.DomPosition,l=o.arrayContains,d=n.util,c=d.forEach,f="span",v=d.isHostMethod(document,"createElementNS");function g(Z,N){for(var H in Z)if(Z.hasOwnProperty(H)&&N(H,Z[H])===!1)return!1;return!0}function y(Z){return Z.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function b(Z,N){return!!Z&&new RegExp("(?:^|\\s)"+N+"(?:\\s|$)").test(Z)}function _(Z,N){if(typeof Z.classList=="object")return Z.classList.contains(N);var H=typeof Z.className=="string",J=H?Z.className:Z.getAttribute("class");return b(J,N)}function x(Z,N){if(typeof Z.classList=="object")Z.classList.add(N);else{var H=typeof Z.className=="string",J=H?Z.className:Z.getAttribute("class");J?b(J,N)||(J+=" "+N):J=N,H?Z.className=J:Z.setAttribute("class",J)}}var w=function(){function Z(N,H,J){return H&&J?" ":""}return function(N,H){if(typeof N.classList=="object")N.classList.remove(H);else{var J=typeof N.className=="string",X=J?N.className:N.getAttribute("class");X=X.replace(new RegExp("(^|\\s)"+H+"(\\s|$)"),Z),J?N.className=X:N.setAttribute("class",X)}}}();function C(Z){var N=typeof Z.className=="string";return N?Z.className:Z.getAttribute("class")}function k(Z){return Z&&Z.split(/\s+/).sort().join(" ")}function D(Z){return k(C(Z))}function I(Z,N){return D(Z)==D(N)}function $(Z,N){for(var H=N.split(/\s+/),J=0,X=H.length;J<X;++J)if(!_(Z,y(H[J])))return!1;return!0}function R(Z){var N=Z.parentNode;return N&&N.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(N.nodeName)}function F(Z,N,H,J,X){var re=Z.node,ne=Z.offset,ue=re,we=ne;re==J&&ne>X&&++we,re==N&&(ne==H||ne==H+1)&&(ue=J,we+=X-H),re==N&&ne>H+1&&--we,Z.node=ue,Z.offset=we}function z(Z,N,H){Z.node==N&&Z.offset>H&&--Z.offset}function ie(Z,N,H,J){H==-1&&(H=N.childNodes.length);var X=Z.parentNode,re=o.getNodeIndex(Z);c(J,function(ne){F(ne,X,re,N,H)}),N.childNodes.length==H?N.appendChild(Z):N.insertBefore(Z,N.childNodes[H])}function G(Z,N){var H=Z.parentNode,J=o.getNodeIndex(Z);c(N,function(X){z(X,H,J)}),o.removeNode(Z)}function Q(Z,N,H,J,X){for(var re,ne=[];re=Z.firstChild;)ie(re,N,H++,X),ne.push(re);return G(Z,X),ne}function T(Z,N){return Q(Z,Z.parentNode,o.getNodeIndex(Z),!0,N)}function W(Z,N){var H=Z.cloneRange();H.selectNodeContents(N);var J=H.intersection(Z),X=J?J.toString():"";return X!=""}function P(Z){for(var N=Z.getNodes([3]),H=0,J;(J=N[H])&&!W(Z,J);)++H;for(var X=N.length-1;(J=N[X])&&!W(Z,J);)--X;return N.slice(H,X+1)}function le(Z,N){if(Z.attributes.length!=N.attributes.length)return!1;for(var H=0,J=Z.attributes.length,X,re,ne;H<J;++H)if(X=Z.attributes[H],ne=X.name,ne!="class"&&(re=N.attributes.getNamedItem(ne),X===null!=(re===null)||X.specified!=re.specified||X.specified&&X.nodeValue!==re.nodeValue))return!1;return!0}function me(Z,N){for(var H=0,J=Z.attributes.length,X;H<J;++H)if(X=Z.attributes[H].name,!(N&&l(N,X))&&Z.attributes[H].specified&&X!="class")return!0;return!1}var he=o.getComputedStyleProperty,Ne=function(){var Z=document.createElement("div");return typeof Z.isContentEditable=="boolean"?function(N){return N&&N.nodeType==1&&N.isContentEditable}:function(N){return!N||N.nodeType!=1||N.contentEditable=="false"?!1:N.contentEditable=="true"||Ne(N.parentNode)}}();function ye(Z){var N;return Z&&Z.nodeType==1&&((N=Z.parentNode)&&N.nodeType==9&&N.designMode=="on"||Ne(Z)&&!Ne(Z.parentNode))}function ae(Z){return(Ne(Z)||Z.nodeType!=1&&Ne(Z.parentNode))&&!ye(Z)}var Re=/^inline(-block|-table)?$/i;function Le(Z){return Z&&Z.nodeType==1&&!Re.test(he(Z,"display"))}var Ve=/[^\r\n\t\f \u200B]/;function Ae(Z){if(Z.data.length==0)return!0;if(Ve.test(Z.data))return!1;var N=he(Z.parentNode,"whiteSpace");switch(N){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(Z.data))return!1}return Le(Z.previousSibling)||Le(Z.nextSibling)}function te(Z){var N=[],H,J;for(H=0;J=Z[H++];)N.push(new s(J.startContainer,J.startOffset),new s(J.endContainer,J.endOffset));return N}function ce(Z,N){for(var H=0,J,X,re,ne=Z.length;H<ne;++H)J=Z[H],X=N[H*2],re=N[H*2+1],J.setStartAndEnd(X.node,X.offset,re.node,re.offset)}function _e(Z,N){return o.isCharacterDataNode(Z)?N==0?!!Z.previousSibling:N==Z.length?!!Z.nextSibling:!0:N>0&&N<Z.childNodes.length}function Ie(Z,N,H,J){var X,re,ne=H==0;if(o.isAncestorOf(N,Z))return Z;if(o.isCharacterDataNode(N)){var ue=o.getNodeIndex(N);if(H==0)H=ue;else if(H==N.length)H=ue+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+H+" in "+N.data);N=N.parentNode}if(_e(N,H)){X=N.cloneNode(!1),re=N.parentNode,X.id&&X.removeAttribute("id");for(var we,Se=0;we=N.childNodes[H];)ie(we,X,Se++,J);return ie(X,re,o.getNodeIndex(N)+1,J),N==Z?X:Ie(Z,re,o.getNodeIndex(X),J)}else if(Z!=N){X=N.parentNode;var Pe=o.getNodeIndex(N);return ne||Pe++,Ie(Z,X,Pe,J)}return Z}function Ke(Z,N){return Z.namespaceURI==N.namespaceURI&&Z.tagName.toLowerCase()==N.tagName.toLowerCase()&&I(Z,N)&&le(Z,N)&&he(Z,"display")=="inline"&&he(N,"display")=="inline"}function $e(Z){var N=Z?"nextSibling":"previousSibling";return function(H,J){var X=H.parentNode,re=H[N];if(re){if(re&&re.nodeType==3)return re}else if(J&&(re=X[N],re&&re.nodeType==1&&Ke(X,re))){var ne=re[Z?"firstChild":"lastChild"];if(ne&&ne.nodeType==3)return ne}return null}}var Ue=$e(!1),Nt=$e(!0);function ot(Z){this.isElementMerge=Z.nodeType==1,this.textNodes=[];var N=this.isElementMerge?Z.lastChild:Z;N&&(this.textNodes[0]=N)}ot.prototype={doMerge:function(Z){var N=this.textNodes,H=N[0];if(N.length>1){var J=o.getNodeIndex(H),X=[],re=0,ne;c(N,function(ue,we){ne=ue.parentNode,we>0&&(ne.removeChild(ue),ne.hasChildNodes()||o.removeNode(ne),Z&&c(Z,function(Se){Se.node==ue&&(Se.node=H,Se.offset+=re),Se.node==ne&&Se.offset>J&&(--Se.offset,Se.offset==J+1&&we<N.length-1&&(Se.node=H,Se.offset=re))})),X[we]=ue.data,re+=ue.data.length}),H.data=X.join("")}return H.data},getLength:function(){for(var Z=this.textNodes.length,N=0;Z--;)N+=this.textNodes[Z].length;return N},toString:function(){var Z=[];return c(this.textNodes,function(N,H){Z[H]="'"+N.data+"'"}),"[Merge("+Z.join(",")+")]"}};var Bt=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],bt={};function rn(Z,N,H){var J,X,re,ne,ue=this;ue.cssClass=ue.className=Z;var we=null,Se={};if(typeof N=="object"&&N!==null){for(typeof N.elementTagName<"u"&&(N.elementTagName=N.elementTagName.toLowerCase()),H=N.tagNames,we=N.elementProperties,Se=N.elementAttributes,X=0;ne=Bt[X++];)N.hasOwnProperty(ne)&&(ue[ne]=N[ne]);J=N.normalize}else J=N;ue.normalize=typeof J>"u"?!0:J,ue.attrExceptions=[];var Pe=document.createElement(ue.elementTagName);ue.elementProperties=ue.copyPropertiesToElement(we,Pe,!0),g(Se,function(at,ut){ue.attrExceptions.push(at),Se[at]=""+ut}),ue.elementAttributes=Se,ue.elementSortedClassName=ue.elementProperties.hasOwnProperty("className")?k(ue.elementProperties.className+" "+Z):Z,ue.applyToAnyTagName=!1;var Ge=typeof H;if(Ge=="string")H=="*"?ue.applyToAnyTagName=!0:ue.tagNames=y(H.toLowerCase()).split(/\s*,\s*/);else if(Ge=="object"&&typeof H.length=="number")for(ue.tagNames=[],X=0,re=H.length;X<re;++X)H[X]=="*"?ue.applyToAnyTagName=!0:ue.tagNames.push(H[X].toLowerCase());else ue.tagNames=[ue.elementTagName]}rn.prototype={elementTagName:f,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(Z,N,H){var J,X,re={},ne,ue,we,Se;for(var Pe in Z)if(Z.hasOwnProperty(Pe))if(ue=Z[Pe],we=N[Pe],Pe=="className")x(N,ue),x(N,this.className),N[Pe]=k(N[Pe]),H&&(re[Pe]=ue);else if(Pe=="style"){X=we,H&&(re[Pe]=ne={});for(J in Z[Pe])Z[Pe].hasOwnProperty(J)&&(X[J]=ue[J],H&&(ne[J]=X[J]));this.attrExceptions.push(Pe)}else N[Pe]=ue,H&&(re[Pe]=N[Pe],Se=bt.hasOwnProperty(Pe)?bt[Pe]:Pe,this.attrExceptions.push(Se));return H?re:""},copyAttributesToElement:function(Z,N){for(var H in Z)Z.hasOwnProperty(H)&&!/^class(?:Name)?$/i.test(H)&&N.setAttribute(H,Z[H])},appliesToElement:function(Z){return l(this.tagNames,Z.tagName.toLowerCase())},getEmptyElements:function(Z){var N=this;return Z.getNodes([1],function(H){return N.appliesToElement(H)&&!H.hasChildNodes()})},hasClass:function(Z){return Z.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(Z))&&_(Z,this.className)},getSelfOrAncestorWithClass:function(Z){for(;Z;){if(this.hasClass(Z))return Z;Z=Z.parentNode}return null},isModifiable:function(Z){return!this.applyToEditableOnly||ae(Z)},isIgnorableWhiteSpaceNode:function(Z){return this.ignoreWhiteSpace&&Z&&Z.nodeType==3&&Ae(Z)},postApply:function(Z,N,H,J){var X=Z[0],re=Z[Z.length-1],ne=[],ue,we=X,Se=re,Pe=0,Ge=re.length,at;c(Z,function(rt){at=Ue(rt,!J),at?(ue||(ue=new ot(at),ne.push(ue)),ue.textNodes.push(rt),rt===X&&(we=ue.textNodes[0],Pe=we.length),rt===re&&(Se=ue.textNodes[0],Ge=ue.getLength())):ue=null});var ut=Nt(re,!J);if(ut&&(ue||(ue=new ot(re),ne.push(ue)),ue.textNodes.push(ut)),ne.length){for(var kt=0,Xe=ne.length;kt<Xe;++kt)ne[kt].doMerge(H);N.setStartAndEnd(we,Pe,Se,Ge)}},createContainer:function(Z){var N=o.getDocument(Z),H=v&&!o.isHtmlNamespace(Z)&&Z.namespaceURI?N.createElementNS(Z.namespaceURI,this.elementTagName):N.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,H,!1),this.copyAttributesToElement(this.elementAttributes,H),x(H,this.className),this.onElementCreate&&this.onElementCreate(H,this),H},elementHasProperties:function(Z,N){var H=this;return g(N,function(J,X){if(J=="className")return $(Z,X);if(typeof X=="object"){if(!H.elementHasProperties(Z[J],X))return!1}else if(Z[J]!==X)return!1})},elementHasAttributes:function(Z,N){return g(N,function(H,J){if(Z.getAttribute(H)!==J)return!1})},applyToTextNode:function(Z,N){if(R(Z)){var H=Z.parentNode;if(H.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(H)&&this.elementHasProperties(H,this.elementProperties)&&this.elementHasAttributes(H,this.elementAttributes))x(H,this.className);else{var J=Z.parentNode,X=this.createContainer(J);J.insertBefore(X,Z),X.appendChild(Z)}}},isRemovable:function(Z){return Z.tagName.toLowerCase()==this.elementTagName&&D(Z)==this.elementSortedClassName&&this.elementHasProperties(Z,this.elementProperties)&&!me(Z,this.attrExceptions)&&this.elementHasAttributes(Z,this.elementAttributes)&&this.isModifiable(Z)},isEmptyContainer:function(Z){var N=Z.childNodes.length;return Z.nodeType==1&&this.isRemovable(Z)&&(N==0||N==1&&this.isEmptyContainer(Z.firstChild))},removeEmptyContainers:function(Z){var N=this,H=Z.getNodes([1],function(re){return N.isEmptyContainer(re)}),J=[Z],X=te(J);c(H,function(re){G(re,X)}),ce(J,X)},undoToTextNode:function(Z,N,H,J){if(!N.containsNode(H)){var X=N.cloneRange();X.selectNode(H),X.isPointInRange(N.endContainer,N.endOffset)&&(Ie(H,N.endContainer,N.endOffset,J),N.setEndAfter(H)),X.isPointInRange(N.startContainer,N.startOffset)&&(H=Ie(H,N.startContainer,N.startOffset,J))}this.isRemovable(H)?T(H,J):w(H,this.className)},splitAncestorWithClass:function(Z,N,H){var J=this.getSelfOrAncestorWithClass(Z);J&&Ie(J,Z,N,H)},undoToAncestor:function(Z,N){this.isRemovable(Z)?T(Z,N):w(Z,this.className)},applyToRange:function(Z,N){var H=this;N=N||[];var J=te(N||[]);Z.splitBoundariesPreservingPositions(J),H.removeEmptyElements&&H.removeEmptyContainers(Z);var X=P(Z);if(X.length){c(X,function(ue){!H.isIgnorableWhiteSpaceNode(ue)&&!H.getSelfOrAncestorWithClass(ue)&&H.isModifiable(ue)&&H.applyToTextNode(ue,J)});var re=X[X.length-1];Z.setStartAndEnd(X[0],0,re,re.length),H.normalize&&H.postApply(X,Z,J,!1),ce(N,J)}var ne=H.getEmptyElements(Z);c(ne,function(ue){x(ue,H.className)})},applyToRanges:function(Z){for(var N=Z.length;N--;)this.applyToRange(Z[N],Z);return Z},applyToSelection:function(Z){var N=n.getSelection(Z);N.setRanges(this.applyToRanges(N.getAllRanges()))},undoToRange:function(Z,N){var H=this;N=N||[];var J=te(N);Z.splitBoundariesPreservingPositions(J),H.removeEmptyElements&&H.removeEmptyContainers(Z,J);var X=P(Z),re,ne,ue=X[X.length-1];if(X.length){H.splitAncestorWithClass(Z.endContainer,Z.endOffset,J),H.splitAncestorWithClass(Z.startContainer,Z.startOffset,J);for(var we=0,Se=X.length;we<Se;++we)re=X[we],ne=H.getSelfOrAncestorWithClass(re),ne&&H.isModifiable(re)&&H.undoToAncestor(ne,J);Z.setStartAndEnd(X[0],0,ue,ue.length),H.normalize&&H.postApply(X,Z,J,!0),ce(N,J)}var Pe=H.getEmptyElements(Z);c(Pe,function(Ge){w(Ge,H.className)})},undoToRanges:function(Z){for(var N=Z.length;N--;)this.undoToRange(Z[N],Z);return Z},undoToSelection:function(Z){var N=n.getSelection(Z),H=n.getSelection(Z).getAllRanges();this.undoToRanges(H),N.setRanges(H)},isAppliedToRange:function(Z){if(Z.collapsed||Z.toString()=="")return!!this.getSelfOrAncestorWithClass(Z.commonAncestorContainer);var N=Z.getNodes([3]);if(N.length){for(var H=0,J;J=N[H++];)if(!this.isIgnorableWhiteSpaceNode(J)&&W(Z,J)&&this.isModifiable(J)&&!this.getSelfOrAncestorWithClass(J))return!1}return!0},isAppliedToRanges:function(Z){var N=Z.length;if(N==0)return!1;for(;N--;)if(!this.isAppliedToRange(Z[N]))return!1;return!0},isAppliedToSelection:function(Z){var N=n.getSelection(Z);return this.isAppliedToRanges(N.getAllRanges())},toggleRange:function(Z){this.isAppliedToRange(Z)?this.undoToRange(Z):this.applyToRange(Z)},toggleSelection:function(Z){this.isAppliedToSelection(Z)?this.undoToSelection(Z):this.applyToSelection(Z)},getElementsWithClassIntersectingRange:function(Z){var N=[],H=this;return Z.getNodes([3],function(J){var X=H.getSelfOrAncestorWithClass(J);X&&!l(N,X)&&N.push(X)}),N},detach:function(){}};function ln(Z,N,H){return new rn(Z,N,H)}rn.util={hasClass:_,addClass:x,removeClass:w,getClass:C,hasSameClasses:I,hasAllClasses:$,replaceWithOwnChildren:T,elementsHaveSameNonClassAttributes:le,elementHasNonClassAttributes:me,splitNodeAt:Ie,isEditableElement:Ne,isEditingHost:ye,isEditable:ae},n.CssClassApplier=n.ClassApplier=rn,n.createClassApplier=ln,d.createAliasForDeprecatedMethod(n,"createCssClassApplier","createClassApplier",i)}),t})}(Rf)),Rf.exports}BB();var Py={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},Ry=Ud.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var r=this;Dy.init(),Ud.extensions.button.prototype.init.call(this),this.colorPicker=new Pw({parent:this.button,color:"#000",onDone:function(e){r.coloredText&&r.coloredText.isAppliedToSelection()&&r.coloredText.undoToSelection(),r.coloredText=Dy.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),r.coloredText.toggleSelection(),r.base.checkContentChanged(),r.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(r){return r.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),jB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),HB=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Iy=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},By=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){jB(e,r);function e(t){var n=r.call(this,t)||this;n.labelMap=new Map;var i=t.lf,o=t.graphModel;return n.lf=i,n.graphModel=o,n.state={tick:0},n}return e.prototype.componentDidMount=function(){var t=this,n=this.props.graphModel;this.editor=new Ud(".lf-label-editor",Wa(Py,{autoLink:!0,extensions:{colorPicker:new Ry}})),n.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),n.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new Ud(".lf-label-editor",Wa(Py,{autoLink:!0,extensions:{colorPicker:new Ry}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,n=this.props,i=n.lf.extension,o=n.graphModel,s=By(By([],Iy(o.nodes),!1),Iy(o.edges),!1),l=i.label;if(l){var d=[];return on(s,function(c){var f,v,g=c.getData(),y=(v=(f=g.properties)===null||f===void 0?void 0:f._label)!==null&&v!==void 0?v:[];on(y,function(b){var _=t.labelMap,x=new OB(b,c,o);_.set(x.id,x),d.push(ke(EB,{label:x,element:c,graphModel:o},x.id))})}),d}return null},e.prototype.render=function(){return ke("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=HB([xr],e),e})(Wt);var $B=function(){function r(e){var t=e.lf,n=this;this.lf=t,this.lf.setPatternItems=function(i){n.setPatternItems(i)}}return r.prototype.render=function(e,t){var n=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.shapeList.forEach(function(i){var o;(o=n.panelEl)===null||o===void 0||o.appendChild(n.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},r.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},r.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},r.prototype.createDndItem=function(e){var t=this,n=document.createElement("div");n.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),n.appendChild(i),e.label){var o=document.createElement("div");o.innerText=e.label,o.className="lf-dnd-text",n.appendChild(o)}return e.disabled?(n.classList.add("disabled"),n.onmousedown=function(){e.callback&&e.callback(t.lf,t.domContainer)},n):(n.onmousedown=function(){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer)},n.ondblclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:s,data:e})},n.onclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:s,data:e})},n.oncontextmenu=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:s,data:e})},n)},r.pluginName="dndPanel",r}(),FB=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zB=function(){function r(e){var t=e.lf,n=e.LogicFlow,i=e.options,o=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){o.updateViewPortBounds(),o.isShow&&o.updateViewPort()},this.render=function(l,d){o.container=d,o.lf.on("history:change",function(){o.isShow&&o.setView()}),o.lf.on("graph:transform",function(){o.isShow&&o.setView(!1)})},this.show=function(l,d){o.isShow||(o.createMiniMap(l,d),o.setView()),o.isShow=!0},this.hide=function(){o.isShow&&(o.removeMiniMap(),o.lf.emit("miniMap:close",{})),o.isShow=!1},this.updatePosition=function(l){if(typeof l=="object")(l.left!==void 0||l.right!==void 0)&&(o.leftPosition=l.left,o.rightPosition=l.right),(l.top!==void 0||l.bottom!==void 0)&&(o.topPosition=l.top,o.bottomPosition=l.bottom);else switch(l){case"left-top":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=0,o.bottomPosition=void 0;break;case"right-top":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=0,o.bottomPosition=void 0;break;case"left-bottom":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=void 0,o.bottomPosition=0;break;case"right-bottom":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=void 0,o.bottomPosition=0;break}o.updateMiniMapPosition()},this.reset=function(){o.lf.resetTranslate(),o.lf.resetZoom()},this.setShowEdge=function(l){o.showEdge!==l&&(o.showEdge=l,o.setView())},this.startDrag=function(l){document.addEventListener("mousemove",o.drag),document.addEventListener("mouseup",o.drop);var d=l.x,c=l.y;o.startPosition={x:d,y:c}},this.drag=function(l){var d=l.x,c=l.y,f=(d-o.startPosition.x)/o.scale,v=(c-o.startPosition.y)/o.scale,g=o.viewPortLeft+f+o.viewPortWidth/o.scale/2,y=o.viewPortTop+v+o.viewPortHeight/o.scale/2;o.startPosition={x:d,y:c},o.lf.focusOn({coordinate:{x:g,y}})},this.drop=function(){document.removeEventListener("mousemove",o.drag),document.removeEventListener("mouseup",o.drop)},this.mapClick=function(l){var d=l.offsetX,c=l.offsetY,f=o.translateX+d/o.scale,v=o.translateY+c/o.scale;o.lf.focusOn({coordinate:{x:f,y:v}})},this.lf=t,this.LFCtor=n,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var s={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=s,this.elementAreaBounds=s,this.viewPortBounds=s,this.initMiniMap(),t.on("graph:resize",this.onGraphResize)}return r.prototype.setOption=function(e){var t=e.width,n=t===void 0?150:t,i=e.height,o=i===void 0?220:i,s=e.showEdge,l=s===void 0?!1:s,d=e.isShowHeader,c=d===void 0?!1:d,f=e.isShowCloseIcon,v=f===void 0?!1:f,g=e.leftPosition,y=e.topPosition,b=e.rightPosition,_=b===void 0?0:b,x=e.bottomPosition,w=x===void 0?0:x,C=e.headerTitle,k=C===void 0?"导航":C;this.width=n,this.height=o,this.showEdge=l,this.isShowHeader=c,this.isShowCloseIcon=v,this.leftPosition=g,this.rightPosition=g!==void 0?void 0:_,this.topPosition=y,this.bottomPosition=y!==void 0?void 0:w,this.headerTitle=k},r.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins}),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},r.prototype.createMiniMap=function(e,t){var n,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(n=this.container)===null||n===void 0||n.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var o=document.createElement("div");o.className="lf-mini-map-header",o.innerText=this.headerTitle,i.appendChild(o);var s=document.createElement("span");s.className="lf-mini-map-close",s.addEventListener("click",this.hide),i.appendChild(s)},r.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},r.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},r.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},r.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},n=e.nodes;n&&n.length>0&&n.forEach(function(i){var o,s,l=i.x,d=i.y,c=(o=i.width)!==null&&o!==void 0?o:200,f=(s=i.height)!==null&&s!==void 0?s:200,v=l-c/2,g=l+c/2,y=d-f/2,b=d+f/2;t.left=Math.min(v,t.left),t.right=Math.max(g,t.right),t.top=Math.min(y,t.top),t.bottom=Math.max(b,t.bottom)}),this.elementAreaBounds=t},r.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,n=e.TRANSLATE_Y,i=e.SCALE_X,o=e.SCALE_Y,s=this.lf.graphModel,l=s.width,d=s.height;this.viewPortBounds={left:-t/i,right:(-t+l)/i,top:-n/o,bottom:(-n+d)/o}},r.prototype.resetData=function(e){var t=e.nodes,n=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&n.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?n:[]}},r.prototype.setView=function(e){var t,n;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),o=this.resetData(i),s=this.lf.viewMap,l=this.lf.graphModel.modelMap,d=this.lfMap.viewMap;try{for(var c=FB(s.keys()),f=c.next();!f.done;f=c.next()){var v=f.value;d.has(v)||this.lfMap.register({type:v,view:s.get(v),model:l.get(v)})}}catch(z){t={error:z}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}this.lfMap.render(o),this.updateBounds(o)}else this.updateBounds();var g=this.bounds,y=g.left,b=g.top,_=g.right,x=g.bottom,w=_-y,C=x-b,k=this.width/w,D=this.height/C,I=Math.min(k,D);this.scale=I;var $=y-(this.width/I-w)/2,R=b-(this.height/I-C)/2;if(this.lfMap.graphModel.transformModel.translate(-$+this.translateX,-R+this.translateY),this.translateX=$,this.translateY=R,this.miniMapWrap.firstChild){var F=this.miniMapWrap.firstChild.style;F.pointerEvents="none",F.transform="matrix(".concat(I,", 0, 0, ").concat(I,", 0, 0)"),F.transformOrigin="left top",F.height="".concat(this.height/I,"px"),F.width="".concat(this.width/I,"px"),this.updateViewPort()}},r.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),n=t.TRANSLATE_X,i=t.TRANSLATE_Y,o=t.SCALE_X,s=t.SCALE_Y,l=this.lf.graphModel,d=l.width,c=l.height;this.viewPortLeft=-n/o,this.viewPortTop=-i/s,this.viewPortWidth=d/o*this.scale,this.viewPortHeight=c/s*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},r.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.addEventListener("mousedown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},r.prototype.destroy=function(){this.lf.off("graph:resize",this.onGraphResize)},r.pluginName="miniMap",r}();var Iw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),$a=function(){return $a=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},$a.apply(this,arguments)},yl=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},WB={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function UB(r){for(var e=r,t=1;t<e.length-1;){var n=yl(e[t-1],2),i=n[0],o=n[1],s=yl(e[t],2),l=s[0],d=s[1],c=yl(e[t+1],2),f=c[0],v=c[1];i===l&&l===f||o===d&&d===v?e.splice(t,1):t++}return e}function VB(r,e,t,n){var i=[r[0],r[1]],o=[r[0],r[1]];switch(t){case"tl":return e==="tr"?(i[1]+=n,o[0]+=n):e==="lb"&&(i[0]+=n,o[1]+=n),[i,o];case"tr":return e==="tl"?(i[1]+=n,o[0]-=n):e==="rb"&&(i[0]-=n,o[1]+=n),[i,o];case"bl":return e==="br"?(i[1]-=n,o[0]+=n):e==="lt"&&(i[0]+=n,o[1]-=n),[i,o];case"br":return e==="bl"?(i[1]-=n,o[0]-=n):e==="rt"&&(i[0]-=n,o[1]-=n),[i,o];default:return[]}}function XB(r,e,t,n){var i,o="",s="";r[0]===e[0]?o=r[1]>e[1]?"t":"b":r[1]===e[1]&&(o=r[0]>e[0]?"l":"r"),e[0]===t[0]?s=e[1]>t[1]?"t":"b":e[1]===t[1]&&(s=e[0]>t[0]?"l":"r");var l=Math.min(Math.hypot(e[0]-r[0],e[1]-r[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,n)||1/5*n,d="".concat(o).concat(s),c=WB[d]||"-",f="L ".concat(r[0]," ").concat(r[1]);if(c==="-")f+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var v=yl(VB(e,d,c,l),2),g=v[0],y=v[1];g&&y&&(f+="L ".concat(g[0]," ").concat(g[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(y[0]," ").concat(y[1]),i=yl(y,2),e[0]=i[0],e[1]=i[1])}return f}function GB(r,e){var t=0,n="";if(r.length===2)n+="M".concat(r[t][0]," ").concat(r[t++][1]," L ").concat(r[t][0]," ").concat(r[t][1]);else{for(n+="M".concat(r[t][0]," ").concat(r[t++][1]);t+1<r.length;){var i=r[t-1],o=r[t],s=r[t+++1];n+=XB(i,o,s,e)}n+="L ".concat(r[t][0]," ").concat(r[t][1])}return n}(function(r){Iw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,s=t.radius,l=s===void 0?5:s,d=t.getEdgeStyle(),c=t.getEdgeAnimationStyle(),f=UB(n.split(" ").map(function(y){return y.split(",").map(function(b){return+b})})),v=GB(f,l),g=$a($a($a({style:i?c:{}},d),o),{fill:"none"});return vt("path",$a({d:v},g))},e})(os);(function(r){Iw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(rs);var Bw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Vd=function(){return Vd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Vd.apply(this,arguments)},jy=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Hy=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},YB=function(r){Bw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.id,i=t.x,o=t.y,s=t.width,l=t.height,d=t.properties,c=this.props.model.getNodeStyle();return vt("svg",{x:i-s/2,y:o-l/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[d.labelText?vt("text",{x:0,y:-5,fontSize:"16px",fill:c.stroke},d.labelText):"",d.disabledDelete?"":vt("text",{x:d.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:c.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,n)},"x")])},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.id,d=this.props.model.getNodeStyle();return vt("g",{},[vt("rect",Vd(Vd({},d),{x:n-o/2,y:i-s/2,width:o,height:s,id:l})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var n=this.props.graphModel;n.deleteNode(t)},e}(Nd),qB=function(r){Bw(e,r);function e(){var t=r.apply(this,Hy([],jy(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},r.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,n;this.points=[],((n=this.properties)===null||n===void 0?void 0:n.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var n=t.x,i=t.y;this.x=n,this.y=i},e.prototype.updatePointsByNodes=function(t){var n=this,i=[],o=1/0,s=1/0,l=-1/0,d=-1/0;t.forEach(function(c){var f=n.graphModel.getNodeModelById(c);if(f){var v=f.width,g=f.height,y=f.x,b=f.y;o=Math.min(o,y-v/2-n.d),s=Math.min(s,b-g/2-n.d),l=Math.max(l,y+v/2+n.d),d=Math.max(d,b+g/2+n.d)}}),i.push([o,s],[l,s],[l,d],[o,d]),![o,s,l,d].some(function(c){return Math.abs(c)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(l+o)/2,y:(d+s)/2}))},e.prototype.resize=function(t){var n;this.isResize=!0;for(var i=t.width,o=t.height,s={x:i/this.width,y:o/this.height},l=(this.properties.node_selection_ids||[]).slice(),d=[],c=new Set;l.length;){var f=l.shift(),v=(n=this.graphModel.nodesMap[f])===null||n===void 0?void 0:n.model;if(v){if(!nd(v)){d.push(v);continue}c.has(v.id)||(c.add(v.id),l.push.apply(l,Hy([],jy(v.properties.node_selection_ids||[]),!1)))}}var g={x:this.x-this.width/2,y:this.y-this.height/2},y=r.prototype.resize.call(this,t),b={x:this.x-this.width/2,y:this.y-this.height/2};return d.forEach(function(_){_.width=_.width*s.x,_.height=_.height*s.y;var x=(_.x-g.x)*s.x+b.x-_.x,w=(_.y-g.y)*s.y+b.y-_.y;_.move(x,w,!0)}),this.isResize=!1,y},e}(Ed),Ah="node-selection";(function(){function r(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:Ah,view:YB,model:qB})}return Object.defineProperty(r.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),r.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},r.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},r.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,n=this.lf.getGraphRawData(),i=t.filter(function(o){return o!==e.currentClickNode.id});return n.nodes.find(function(o){if(o.type==="node-selection"){var s=jl(o,"properties.node_selection_ids",[]);return i.every(function(l){return s.includes(l)})}return!1})},r.prototype.onNodeChange=function(e,t){var n=e.graphModel.nodes.filter(function(i){if(!nd(i))return!1;var o=i.properties.node_selection_ids||[];return o.includes(t.id)});Promise.resolve().then(function(){n.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},r.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(n){var i;if(!(!n.e.shiftKey||n.data.type===Ah)){t.currentClickNode=n.data;var o=!1;t.selectNodesIds.includes(n.data.id)&&((i=t.lf.getNodeModelById(n.data.id))===null||i===void 0||i.setSelected(!1),o=!0);var s=e.getSelectElements(!0).nodes;t.selectNodes=s,t.selectNodes.length===1?o?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(n,i,o){if(t.onNodeChange(e,n),nd(n)&&!n.isResize){var s=n.properties.node_selection_ids||[];return e.graphModel.moveNodes(s,i,o,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(n){return nd(n)||t.onNodeChange(e,n),!0})},r.pluginName="node-selection",r})();var nd=function(r){return!!(r&&r.type===Ah)},KB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Xd=function(){return Xd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Xd.apply(this,arguments)};(function(r){KB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.properties;return vt("text",{x:n-o/2+5,y:i-s/2+16,fontSize:12,fill:"blue"},l.moreText)},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=this.props.model.getNodeStyle();return vt("g",{},[vt("rect",Xd(Xd({},l),{fill:"#FFFFFF",x:n-o/2,y:i-s/2})),this.getLabelShape()])},e})(ia);var JB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Jo=function(){return Jo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Jo.apply(this,arguments)},ZB=function(r){JB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,n=t.width,i=t.height,o=t.radius;br(n)||(this.width=n),br(i)||(this.height=i),br(o)||(this.radius=o)},e.prototype.getTextStyle=function(){var t=this.properties,n=t.refX,i=n===void 0?0:n,o=t.refY,s=o===void 0?0:o,l=t.textStyle,d=r.prototype.getTextStyle.call(this);return Jo(Jo(Jo({},d),Lt(l)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(s,")")})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.properties.style;return Jo(Jo({},t),Lt(n)||{})},e}(Tl),jw={};function An(r,e){var t=r.type,n=r.component,i=r.effect,o=r.view,s=r.model;if(!t)throw new Error("You should specify type in config");jw[t]={component:n,effect:i},e.register({type:t,view:o||rj,model:s||ZB})}var fc=!1,Gd=Vt({});function QB(r,e,t,n,i){fc&&(Gd[r]=Yd(us({render:function(){return Dn(Vy,{to:t},[Dn(e,{node:n,graph:i})])},provide:function(){return{getNode:function(){return n},getGraph:function(){return i}}}})))}function ej(r){fc&&delete Gd[r]}function $y(){return fc}function tj(){return fc=!0,us({props:{flowId:{type:String,required:!0}},setup:function(r){return function(){var e=[];return Object.keys(Gd).forEach(function(t){t.startsWith(r.flowId)&&e.push(Gd[t])}),Dn(it,{},e.map(function(t){return Dn(t)}))}}})}var nj=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),rj=function(r){nj(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var n=document.createElement("div");n.className="custom-vue-node-content",this.root=n,t.appendChild(n),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var n=this.getComponentContainer(),i=this.props,o=i.model,s=i.graphModel;if(n){var l=jw[o.type].component;l&&($y()?QB(this.targetId(),l,n,o,s):(this.vm=qd({render:function(){return Dn(l,{node:o,graph:s})},provide:function(){return{getNode:function(){return o},getGraph:function(){return s}}}}),(t=this.vm)===null||t===void 0||t.mount(n)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){$y()&&ej(this.targetId()),this.unmountVueComponent()},e}(Ll);const ij={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},methods:{handleDelete(){const r=this.getGraphModel(),e=this.getModel();r.deleteEdgeById(e.id),this.$emit("delete")}}},oj={class:"custom-line-popup"};function aj(r,e,t,n,i,o){return as((Y(),se("div",oj,[E("button",{class:"delete-btn",onClick:e[0]||(e[0]=dn((...s)=>o.handleDelete&&o.handleDelete(...s),["stop"]))},"删 除")],512)),[[ss,t.isSelected]])}const sj=pt(ij,[["render",aj],["__scopeId","data-v-6456a6d9"]]),lj=70,uj=36;class dj extends os{constructor(e){super(e),this.isMounted=!1,this.r=Dn(sj,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=qd({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=lj,customHeight:n=uj}=e.getProperties(),i=e.id,{startPoint:o,endPoint:s,arrowConfig:l,pointsList:d}=e;let c={x:(o.x+s.x-t)/2,y:(o.y+s.y-n)/2,width:t,height:n};if(d.length>2){let v=Math.round(d.length/2);c.x=d[v-1].x+5,c.y=d[v-1].y}const f={width:t,height:n};return setTimeout(()=>{const v=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(v))},0),vt("foreignObject",{...c,id:"line_"+i},[vt("div",{id:i,style:f,className:"vue-app-wrapper"})])}}class cj extends rs{initEdgeData(e){super.initEdgeData(e)}createId(){return Pl("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),n=this.graphModel.getNodeModelById(this.targetNodeId),i=n==null?void 0:n.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}}const fj={type:"custom-edge",view:dj,model:cj};function Hw(r,e){return r.map(t=>{let n=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,o=e?e.node_type:t.node_type,s=t.name||t.key,l=e?`${e.text}.${s}`:s,d=t.children||t.subs||[],c="",f="";o==1?f=`global.${l}`:e?f=`${e.original_value}.${t.key}`:f=`${n}.${t.key}`,c=`【${f}】`;let v={label:s,value:c,original_value:f,node_id:n,node_name:i,node_type:o,text:l,key:t.key,id:n,typ:t.typ,children:d||[]};return v.children&&v.children.length>0&&(v.children=Hw(v.children,v)),v})}class Bn extends Ll{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=Dn(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=qd({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let n=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:n},t.model._width=i,t.model._height=n,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:n=>{t.model.properties.anchorList=n},setData:n=>{n.dataRaw=n.node_params,_n(()=>{t.model.properties={...t.model.properties,...n};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model._height=i||n.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:n=>{t.model.properties.node_name=n,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:n,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),n=t.map(b=>b.sourceAnchorId),i=t.map(b=>b.targetAnchorId),o=!1;const{x:s,y:l,type:d}=e,c=10;d==="left"?o=i.includes(e.id):o=n.includes(e.id);const f=vt("circle",{className:"custom-anchor-circle",cx:s,cy:l,r:c,fill:"#fff",stroke:"#2475FC","stroke-width":2}),v=vt("g",{className:"custom-anchor-arrow",transform:`translate(${s-c-2}, ${l-c-2})`},[vt("circle",{cx:12,cy:12,r:c,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),vt("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),g=vt("g",{className:`custom-anchor-plus ${o?"anchor-hide":""}`,transform:`translate(${s-c-2}, ${l-c-2})`},[vt("circle",{cx:12,cy:12,r:c,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),vt("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),vt("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return vt("g",{id:e.id,className:`custom-anchor custom-anchor-${d} ${o?"anchor-selected":"anchor-not-selected"}`,onClick:b=>{b.stopPropagation();const{graphModel:_,model:x}=this.props;d==="right"&&!o&&_.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:x})}},f,v,g)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class jn extends Tl{createId(){return Pl(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(o=>o.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let n=JSON.parse(t.properties.node_params);return{sys_global:n.start.sys_global,diy_global:n.start.diy_global,all_global:[...n.start.sys_global,...n.start.diy_global]}}getAllParentVariable(){const e=[],t=new Set,n=this.incoming.edges,{nodes:i}=this.graphModel,o=["start-node","http-node","parameter-extraction-node","knowledge-base-node","ai-dialogue-node","specify-reply-node","problem-optimization-node","select-data-node","code-run-node","mcp-node"];let s=i.find(c=>c.type==="start-node");s&&(t.add(s.id),e.push(s));const l=c=>{for(let f=0;f<c.length;f++){let g=c[f].sourceNode;t.has(g.id)||(t.add(g.id),o.includes(g.type)&&e.push(g),l(g.incoming.edges))}};l(n);let d=[];for(const c of e){if(!o.includes(c.type))continue;let f=JSON.parse(c.properties.node_params),v={label:c.properties.node_name,value:c.id,node_id:c.id,node_type:c.properties.node_type,typ:"node",children:[]};c.type==="http-node"&&(v.children=f.curl.output),c.type==="code-run-node"&&(v.children=f.code_run.output),c.type==="parameter-extraction-node"&&(v.children=f.params_extractor.output),c.type==="start-node"&&(v.children=[...f.start.diy_global,...f.start.sys_global]),c.type==="select-data-node"&&(v.children=[{key:"output_list",typ:"Array(Object)",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),c.type==="knowledge-base-node"&&(v.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),c.type==="ai-dialogue-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),c.type==="specify-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),c.type==="problem-optimization-node"&&(v.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),c.type==="mcp-node"&&(v.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),v.children.forEach(g=>{g.node_id=c.id,g.node_name=c.properties.node_name,g.node_type=c.properties.node_type}),v.children=Hw(v.children,null),d.push(v)}return d}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const hj="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",pj={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[]}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("handleMenu",r)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){let r=this.getNode();this.getGraph().deleteNode(r.id)},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(r.target)&&r.target!==this.$el.querySelector(".node-menu-btn")&&r.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImggeUrl(r){return new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":Vx,"../../../../assets/svg/ai-generate-white.svg":Ux,"../../../../assets/svg/ai-generate.svg":Wx,"../../../../assets/svg/ai-mark.svg":zx,"../../../../assets/svg/ai.svg":Fx,"../../../../assets/svg/alert-icon.svg":$x,"../../../../assets/svg/ali-ocr.svg":Hx,"../../../../assets/svg/analysis.svg":jx,"../../../../assets/svg/anthrop.svg":Bx,"../../../../assets/svg/arrow-down.svg":Ix,"../../../../assets/svg/arrow-left.svg":Rx,"../../../../assets/svg/arrow-right.svg":Px,"../../../../assets/svg/attachment.svg":Lx,"../../../../assets/svg/auth.svg":Dx,"../../../../assets/svg/azure.svg":Tx,"../../../../assets/svg/baichuan.svg":Ax,"../../../../assets/svg/base-node-type.svg":Mx,"../../../../assets/svg/book.svg":Nx,"../../../../assets/svg/chat-cache.svg":kx,"../../../../assets/svg/chat-mode.svg":Ox,"../../../../assets/svg/chat-robot-icon.svg":Cx,"../../../../assets/svg/chat.svg":Ex,"../../../../assets/svg/check-arrow-filled.svg":Sx,"../../../../assets/svg/circularNeedle.svg":wx,"../../../../assets/svg/client.svg":xx,"../../../../assets/svg/close-circle.svg":bx,"../../../../assets/svg/cmd.svg":_x,"../../../../assets/svg/code-run-node.svg":yx,"../../../../assets/svg/cohere.svg":mx,"../../../../assets/svg/collaborator.svg":gx,"../../../../assets/svg/collapse-close.svg":vx,"../../../../assets/svg/collapse-open.svg":px,"../../../../assets/svg/colour-edit.svg":hx,"../../../../assets/svg/comment-search.svg":fx,"../../../../assets/svg/common-quession.svg":cx,"../../../../assets/svg/cu-doc-active.svg":dx,"../../../../assets/svg/cu-doc-icon.svg":ux,"../../../../assets/svg/data-node.svg":lx,"../../../../assets/svg/data-security.svg":sx,"../../../../assets/svg/database-menu-icon.svg":ax,"../../../../assets/svg/deepseek.svg":ox,"../../../../assets/svg/delete.svg":ix,"../../../../assets/svg/direct-connection.svg":rx,"../../../../assets/svg/dislike-active.svg":nx,"../../../../assets/svg/dislike.svg":tx,"../../../../assets/svg/doc-active-menu-icon.svg":ex,"../../../../assets/svg/doc-directory.svg":Qb,"../../../../assets/svg/doc-draft.svg":Zb,"../../../../assets/svg/doc-file.svg":Jb,"../../../../assets/svg/doc-file2.svg":Kb,"../../../../assets/svg/doc-icon-active.svg":qb,"../../../../assets/svg/doc-icon.svg":Yb,"../../../../assets/svg/doc-menu-icon.svg":Gb,"../../../../assets/svg/document.svg":Xb,"../../../../assets/svg/drag.svg":Vb,"../../../../assets/svg/duiwaifuwu.svg":Ub,"../../../../assets/svg/economic-active.svg":Wb,"../../../../assets/svg/economic.svg":zb,"../../../../assets/svg/edit-02.svg":Fb,"../../../../assets/svg/edit.svg":$b,"../../../../assets/svg/empty-document.svg":Hb,"../../../../assets/svg/empty.svg":jb,"../../../../assets/svg/end-node.svg":Bb,"../../../../assets/svg/enterprise-active.svg":Ib,"../../../../assets/svg/enterprise.svg":Rb,"../../../../assets/svg/enterprise2.svg":Pb,"../../../../assets/svg/expand.svg":Lb,"../../../../assets/svg/explain-node.svg":Db,"../../../../assets/svg/export-record.svg":Tb,"../../../../assets/svg/eye-open.svg":Ab,"../../../../assets/svg/field-menu-icon.svg":Mb,"../../../../assets/svg/file-search.svg":Nb,"../../../../assets/svg/finance.svg":kb,"../../../../assets/svg/gemini.svg":Ob,"../../../../assets/svg/generate-icon.svg":Cb,"../../../../assets/svg/gou.svg":Eb,"../../../../assets/svg/government.svg":Sb,"../../../../assets/svg/graph-icon.svg":wb,"../../../../assets/svg/guanlianzhishiku.svg":xb,"../../../../assets/svg/high-active.svg":bb,"../../../../assets/svg/high.svg":_b,"../../../../assets/svg/http-node.svg":yb,"../../../../assets/svg/huanyingyu.svg":mb,"../../../../assets/svg/huoshanyinqin.svg":gb,"../../../../assets/svg/img-icon.svg":vb,"../../../../assets/svg/input.svg":pb,"../../../../assets/svg/jibenpeizhi.svg":hb,"../../../../assets/svg/jichupeizhi.svg":fb,"../../../../assets/svg/jina.svg":cb,"../../../../assets/svg/judge-node.svg":db,"../../../../assets/svg/knowledge-base-node.svg":ub,"../../../../assets/svg/knowledge-config-active-icon.svg":lb,"../../../../assets/svg/knowledge-config-icon.svg":sb,"../../../../assets/svg/law.svg":ab,"../../../../assets/svg/liaotianceshi.svg":ob,"../../../../assets/svg/like-active.svg":ib,"../../../../assets/svg/like-icon.svg":rb,"../../../../assets/svg/like.svg":nb,"../../../../assets/svg/lingyiwanwu.svg":tb,"../../../../assets/svg/link-icon-active.svg":eb,"../../../../assets/svg/link-icon.svg":Q0,"../../../../assets/svg/link-left.svg":Z0,"../../../../assets/svg/login-success.svg":J0,"../../../../assets/svg/logout.svg":K0,"../../../../assets/svg/manufacture.svg":q0,"../../../../assets/svg/mcp-node-type.svg":Y0,"../../../../assets/svg/mcp-node.svg":G0,"../../../../assets/svg/medical-treatment.svg":X0,"../../../../assets/svg/menu-expand.svg":V0,"../../../../assets/svg/message.svg":U0,"../../../../assets/svg/minus.svg":W0,"../../../../assets/svg/mix-icon.svg":z0,"../../../../assets/svg/more-compatible.svg":F0,"../../../../assets/svg/moxingshezhi.svg":$0,"../../../../assets/svg/multimode-box.svg":H0,"../../../../assets/svg/nav-chat.svg":j0,"../../../../assets/svg/nav-doc.svg":B0,"../../../../assets/svg/nav-find.svg":I0,"../../../../assets/svg/nav-library.svg":R0,"../../../../assets/svg/nav-robot.svg":P0,"../../../../assets/svg/nav-search.svg":L0,"../../../../assets/svg/network.svg":D0,"../../../../assets/svg/open-ai.svg":T0,"../../../../assets/svg/ordinary-segmentation.svg":A0,"../../../../assets/svg/out-the-box.svg":M0,"../../../../assets/svg/output.svg":N0,"../../../../assets/svg/parameter-extraction-node.svg":k0,"../../../../assets/svg/pc.svg":O0,"../../../../assets/svg/pdf-img.svg":C0,"../../../../assets/svg/pdf-ocr.svg":E0,"../../../../assets/svg/pdf-text.svg":S0,"../../../../assets/svg/phone.svg":w0,"../../../../assets/svg/plugin-node-type.svg":x0,"../../../../assets/svg/plus.svg":b0,"../../../../assets/svg/point-h.svg":_0,"../../../../assets/svg/problem-optimization-node.svg":y0,"../../../../assets/svg/problem-optimization.svg":m0,"../../../../assets/svg/prompt-icon.svg":g0,"../../../../assets/svg/put-away.svg":v0,"../../../../assets/svg/qa-feedback.svg":p0,"../../../../assets/svg/question-node.svg":h0,"../../../../assets/svg/quick-Instruction.svg":f0,"../../../../assets/svg/quote-file.svg":c0,"../../../../assets/svg/quotes.svg":d0,"../../../../assets/svg/recommendation.svg":u0,"../../../../assets/svg/retail.svg":l0,"../../../../assets/svg/reward-points.svg":s0,"../../../../assets/svg/right-fork-icon.svg":a0,"../../../../assets/svg/save-draft.svg":o0,"../../../../assets/svg/sdk.svg":i0,"../../../../assets/svg/search-check-icon.svg":r0,"../../../../assets/svg/search-right.svg":n0,"../../../../assets/svg/search-tip.svg":t0,"../../../../assets/svg/search.svg":e0,"../../../../assets/svg/segmentation-down.svg":Q_,"../../../../assets/svg/segmentation-icon.svg":Z_,"../../../../assets/svg/segmentation-up.svg":J_,"../../../../assets/svg/segmentation.svg":K_,"../../../../assets/svg/select-disabled.svg":q_,"../../../../assets/svg/semantic-segmentation.svg":Y_,"../../../../assets/svg/sensitive-icon.svg":G_,"../../../../assets/svg/seo-gray.svg":X_,"../../../../assets/svg/seo-highlight.svg":V_,"../../../../assets/svg/seo-light.svg":U_,"../../../../assets/svg/session-record.svg":W_,"../../../../assets/svg/session.svg":z_,"../../../../assets/svg/setting.svg":F_,"../../../../assets/svg/share.svg":$_,"../../../../assets/svg/similarity.svg":H_,"../../../../assets/svg/skii.svg":j_,"../../../../assets/svg/source-energy.svg":B_,"../../../../assets/svg/specify-reply-node.svg":I_,"../../../../assets/svg/start-node.svg":R_,"../../../../assets/svg/statistical-analysis.svg":P_,"../../../../assets/svg/success.svg":L_,"../../../../assets/svg/suggested-issues.svg":D_,"../../../../assets/svg/switch-mobile.svg":T_,"../../../../assets/svg/system-setting.svg":A_,"../../../../assets/svg/team-manage-active.svg":M_,"../../../../assets/svg/team-manage.svg":N_,"../../../../assets/svg/team-manage2.svg":k_,"../../../../assets/svg/tengxunhunyuan.svg":O_,"../../../../assets/svg/test-active-menu-icon.svg":C_,"../../../../assets/svg/test-menu-icon.svg":E_,"../../../../assets/svg/think.svg":S_,"../../../../assets/svg/tongyiqianwen.svg":w_,"../../../../assets/svg/unit.svg":x_,"../../../../assets/svg/unknown-issue.svg":b_,"../../../../assets/svg/unknown-prompt.svg":__,"../../../../assets/svg/use-token-active.svg":y_,"../../../../assets/svg/use-token.svg":m_,"../../../../assets/svg/user-icon.svg":g_,"../../../../assets/svg/variable-assignment-node.svg":v_,"../../../../assets/svg/vector-icon.svg":p_,"../../../../assets/svg/wenxinyiyan.svg":h_,"../../../../assets/svg/workflow-robot-icon.svg":f_,"../../../../assets/svg/workflow.svg":c_,"../../../../assets/svg/xitongtishici.svg":d_,"../../../../assets/svg/xunfeixinghuo.svg":u_,"../../../../assets/svg/yuezhianmian.svg":l_,"../../../../assets/svg/zhipuai.svg":s_})[`../../../../assets/svg/${r}.svg`],import.meta.url).href},updateTitle(r){this.setTitle(r)}}},vj=["data-node-name","data-node-type"],gj={class:"node-header"},mj={class:"node-header-left"},yj={key:0,class:"node-icon"},_j=["src"],bj={class:"node-title"},xj={key:0,class:"node-menu-wrapper"},wj={class:"node-menus"},Sj=["onClick"],Ej={class:"node-body"};function Cj(r,e,t,n,i,o){return Y(),se("div",{class:wn(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[E("div",{class:wn(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[E("div",gj,[E("div",mj,[t.iconUrl||t.iconName?(Y(),se("span",yj,[E("img",{src:t.iconUrl||o.getImggeUrl(t.iconName),alt:""},null,8,_j)])):Qe("",!0),E("span",bj,De(t.title),1)]),E("div",null,[t.hideMenus?Qe("",!0):(Y(),se("div",xj,[E("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=dn((...s)=>o.showMenu&&o.showMenu(...s),["stop"]))},e[2]||(e[2]=[E("img",{class:"btn-icon",src:hj,alt:""},null,-1)])),as(E("div",wj,[(Y(!0),se(it,null,ft(o.allMenus,s=>(Y(),se("div",{class:"node-menu",key:s.key,onClick:dn(l=>o.handleMenu(s),["stop"])},De(s.name),9,Sj))),128)),E("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=dn(s=>o.handleDelete(r.item),["stop"]))},"删除")],512),[[ss,i.isShowMenu]])]))])]),E("div",Ej,[za(r.$slots,"default",{},void 0,!0)])],2)],10,vj)}const Hn=pt(pj,[["render",Cj],["__scopeId","data-v-ea987c32"]]),Oj={name:"StartNode",components:{NodeCommon:Hn},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(){this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let r=JSON.parse(this.properties.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global,this.$nextTick(()=>{this.resetSize()})}}},kj={class:"start-node"},Nj={class:"start-node-options"},Mj={class:"options-list"},Aj={class:"option-label"},Tj={class:"option-type"};function Dj(r,e,t,n,i,o){const s=kn("node-common");return Y(),Fe(s,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:V(()=>[E("div",kj,[E("div",Nj,[e[0]||(e[0]=E("div",{class:"options-title"},"输入",-1)),E("div",Mj,[(Y(!0),se(it,null,ft(o.options,l=>(Y(),se("div",{class:wn(["options-item",{"is-required":l.required}]),key:l.key},[E("div",Aj,De(l.key),1),E("div",Tj,De(l.typ),1)],2))),128))])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const Lj=pt(Oj,[["render",Dj],["__scopeId","data-v-2734ae49"]]);let Pj=class extends Bn{constructor(e){super(e),this.renderVue(Lj,e)}},Rj=class extends jn{setAttributes(){this.width=568,this.height=322;const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",isHovered:s,isSelected:l,nodeId:e}]}};const Ij={type:"start-node",model:Rj,view:Pj},hc={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(r){const e=r,t=ri(),{modelList:n}=Il(t),i=Ce(""),o=()=>{if(!e.useModel){i.value="";return}for(const s of n.value)if(s.children){for(const l of s.children)if(e.useModel==l.name&&e.modelConfigId==l.id){i.value=l.show_model_name||l.deployment_name||l.name;return}}};return qt(()=>[e.useModel,e.modelConfigId],()=>{o()},{immediate:!0}),(s,l)=>(Y(),se("span",null,De(i.value),1))}},sa={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(r,{expose:e}){const t=r,n=wt("getNode"),i=Ce([]),o=Ce("");function s(){let v=n().getAllParentVariable();i.value=l(v)}function l(v){return v.forEach(g=>{g.typ=="node"?g.node_type==1?g.value="global":g.value=g.node_id:g.value=g.key,g.children&&g.children.length>0&&(g.children=l(g.children))}),v}const d=(v,g)=>{for(const y of v){if(y.value===g)return y.label;if(y.children&&y.children.length>0){const b=d(y.children,g);if(b)return b}}return null},c=()=>{if(!t.value||t.value.length===0)return"";s();let v=[];t.value.forEach(g=>{const y=d(i.value,g);y&&v.push(y)}),o.value=v.join("/")},f=()=>{c()};return qt(()=>t.value,()=>{c()},{immediate:!0}),e({refresh:f}),(v,g)=>(Y(),se("span",null,De(o.value),1))}},Bj={class:"ai-dialogue-node"},jj={class:"field-list"},Hj={class:"field-item"},$j={class:"field-item-content"},Fj={class:"field-value"},zj={class:"field-key"},Wj={class:"field-item"},Uj={class:"field-item-content"},Vj={class:"field-value"},Xj={class:"field-key"},Gj={class:"field-item"},Yj={class:"field-item-content"},qj={class:"category-list"},Kj={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("resetSize"),i=ri(),{modelList:o}=Il(i),s=Ce([]),l=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]});function d(v){if(v&&typeof v=="string"){let g=v.split("."),y=g[0],b=g.filter((_,x)=>x>0).join(".");return[y,b]}else if(v&&typeof v=="object"&&v.length===2)return v;return["global","question"]}const c=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(v).cate||{}}catch{g={}}g=JSON.parse(JSON.stringify(g));for(let y in g)if(y==="question_value")l.question_value=d(g.question_value);else if(y=="categorys")if(g.categorys&&g.categorys.length>0){let b=g.categorys.map(_=>({..._,key:Math.random()*1e4}));l[y]=b}else l[y]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else l[y]=g[y];!l.model_config_id&&o.value.length>0&&(l.model_config_id=o.value[0].id,l.use_model=o.value[0].children[0].name),_n(()=>{n()})},f=()=>{const v=JSON.stringify({cate:{...l,model_config_id:l.model_config_id?+l.model_config_id:l.model_config_id}});t({...e.node,...l,node_params:v})};return qt(()=>e.properties,c,{deep:!0}),Xt(()=>{c(),n(),f()}),Ei(()=>{}),(v,g)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",Bj,[E("div",jj,[E("div",Hj,[g[0]||(g[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",$j,[E("div",Fj,[E("span",zj,[B(sa,{ref:"questionTextRef",value:l.question_value},null,8,["value"])])])])]),E("div",Wj,[g[1]||(g[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",Uj,[E("div",Vj,[E("span",Xj,[B(hc,{useModel:l.use_model,modelConfigId:l.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",Gj,[g[3]||(g[3]=E("div",{class:"field-item-label"},"问题分类",-1)),E("div",Yj,[E("div",qj,[(Y(!0),se(it,null,ft(l.categorys,y=>(Y(),se("div",{class:"field-value category-value",key:y.key},[E("span",null,De(y.category),1)]))),128)),g[2]||(g[2]=E("div",{class:"field-value category-value"},[E("span",null,"默认分类")],-1))])])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Jj=pt(Kj,[["__scopeId","data-v-b64488fe"]]);let Zj=class extends Bn{constructor(e){super(e),this.renderVue(Jj,e)}},Qj=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getAnchorPos(){return RC(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;let c=[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}],f=this.getAnchorPos(),v=n-o/2;for(let g=0;g<f.length;g++)c.push({id:f[g].id,x:t+i/2,y:v+132+g*32,type:"right"});return c.push({id:d+"-anchor_right",x:t+i/2,y:o/2+n-28,type:"right",nodeId:e}),c}};const e5={type:"question-node",model:Qj,view:Zj},t5={name:"QuestionNode",components:{NodeCommon:Hn},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},n5={class:"question-node"},r5={class:"node-desc"};function i5(r,e,t,n,i,o){const s=kn("node-common");return Y(),Fe(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:V(()=>[E("div",n5,[E("div",r5,De(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const o5=pt(t5,[["render",i5],["__scopeId","data-v-8633f28f"]]);let a5=class extends Bn{constructor(e){super(e),this.renderVue(o5,e)}},s5=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;let c=[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&c.push({x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}),c}};const l5={type:"action-node",model:s5,view:a5},u5={name:"QuestionNode",components:{NodeCommon:Hn},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(r){return zE(r)}}},d5={class:"qa-node"},c5={key:0,class:"no-data"};function f5(r,e,t,n,i,o){const s=kn("node-common");return Y(),Fe(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:V(()=>[E("div",d5,[t.properties.no_resp_jump_time?Qe("",!0):(Y(),se("div",c5,"点击设置消息内容"))])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const h5=pt(u5,[["render",f5],["__scopeId","data-v-a598f971"]]);let p5=class extends Bn{constructor(e){super(e),this.renderVue(h5,e)}},v5=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const g5={type:"qa-node",model:v5,view:p5},m5={class:"ai-dialogue-node"},y5={class:"field-list"},_5={class:"field-item"},b5={class:"field-item-content"},x5={class:"field-value"},w5={class:"field-item"},S5={class:"field-item-content"},E5={class:"field-value"},C5={class:"field-key"},O5={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=ri(),{modelList:l}=Il(s),d=Ce(null),c=Ce([]),f=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),v=Ce([]);function g(w){if(w){let C=w.split("."),k=C[0],D=C.filter((I,$)=>$>0).join(".");return[k,D]}return["global","question"]}const y=()=>{const w=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(w).llm||{}}catch{C={}}_();const{model_config_id:k,use_model:D,context_pair:I,temperature:$,max_token:R,prompt:F,prompt_tags:z,question_value:ie,enable_thinking:G,libs_node_key:Q}=JSON.parse(JSON.stringify(C));f.model_config_id=k,f.use_model=D,f.context_pair=I||0,f.temperature=$,f.max_token=R,f.prompt=F,f.enable_thinking=G,f.prompt_tags=z||[],f.libs_node_key=Q,f.question_value=g(ie),!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),_n(()=>{o()})},b=()=>{const w=JSON.stringify({llm:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:w})},_=()=>{let w=i().getAllParentVariable();v.value=w},x=w=>{_(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(C=>{if(C.node_id==w.node_id){let k=C.label.split("/");k[0]=w.node_name,C.label=k.join("/"),C.node_name=w.node_name}}),b(),d.value.refresh()};return qt(()=>e.properties,y,{deep:!0}),Xt(()=>{y(),o(),n().eventCenter.on("custom:setNodeName",x)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",x)}),(w,C)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",m5,[E("div",y5,[E("div",_5,[C[0]||(C[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",b5,[E("div",x5,[B(sa,{ref_key:"questionTextRef",ref:d,value:f.question_value},null,8,["value"])])])]),E("div",w5,[C[1]||(C[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",S5,[E("div",E5,[E("span",C5,[B(hc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),C[2]||(C[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"AI回复内容"),E("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},k5=pt(O5,[["__scopeId","data-v-0e7130b7"]]);let N5=class extends Bn{constructor(e){super(e),this.renderVue(k5,e)}},M5=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const A5={type:"ai-dialogue-node",model:M5,view:N5},$w=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...$w(t.children)):e.push(t)}),e},T5={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=$w(this.options),i=[...t,...n].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const o=new Set;i.forEach(s=>{const l=new RegExp(`(${s.value})`,"g");if(l.test(this.defaultValue)&&!o.has(s.value)){let d=s.node_name+"."+s.text;d=d.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${d}</span> `),o.add(s.value),this.selectOption(s,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?o+=d.textContent.slice(0,n):o+=d.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const s=n.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?i+=d.textContent.slice(0,t):i+=d.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize();let i=t.bottom,o=t.left;const s=window.innerWidth,l=window.innerHeight;return o+n.width>s&&(o=s-n.width),i+n.height>l&&(i=t.top-n.height),{top:i,left:o,x:o,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{x:t,y:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle="",this.positionStyle+=`left:${t}px;`,this.positionStyle+=`top:${n}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),s=o.startOffset,l=o.startContainer;let d=s-t,c=l;if(d<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){d=f.textContent.length-t,c=f;break}f=f.previousSibling}}if(c.nodeType===Node.TEXT_NODE){c.replaceData(d,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const v=document.createElement("span");v.contentEditable=!0,v.innerHTML+="&nbsp;",v.classList.add("at-space");for(const b in e)f.dataset[b]=e[b];const g=document.createRange();g.setStart(c,d),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),v.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())}}};function D5(r,e,t,n,i,o){return Y(),se("span",{ref:"JMention",class:wn(["j-mention",["type-"+t.type]])},null,2)}const Wr=pt(T5,[["render",D5]]),L5={class:"ai-dialogue-node"},P5={class:"field-list"},R5={class:"field-item"},I5={class:"field-item-content"},B5={class:"field-value"},j5={class:"field-key"},H5={class:"field-type"},$5={class:"field-item"},F5={class:"field-item-content"},z5={class:"field-text"},W5={class:"right-arrow"},U5={class:"field-text2"},V5={class:"field-item"},X5={class:"field-item-content"},G5={class:"field-text"},Y5={class:"right-arrow"},q5={class:"field-text2"},K5={key:0,class:"field-item"},J5={class:"field-item-content"},Z5={class:"field-text"},Q5={class:"right-arrow"},eH={class:"field-text2"},tH={key:1,class:"field-item"},nH={class:"field-item-content"},rH={class:"field-list-item"},iH={class:"field-item"},oH={class:"field-item-content"},aH={class:"field-key"},sH={class:"field-type"},lH={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=Ce([]),l=Vt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function d(_){return _.forEach(x=>{x.cu_key=Math.random()*1e4,x.subs&&x.subs.length?d(x.subs):x.subs=[]}),_}const c=Ce([]),f=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let x={};try{x=JSON.parse(_).curl||{}}catch{x={}}g(),x=JSON.parse(JSON.stringify(x));for(let w in x){if(w=="headers"||w=="params"||w=="body"){x[w]&&x[w].length>0?l[w]=x[w].map(C=>({...C,cu_key:Math.random()*1e4})):l[w]=[];continue}if(w=="output"){l.output=d(x[w]);continue}l[w]=x[w]}_n(()=>{o()})},v=()=>{const _=JSON.stringify({curl:{...l}});t({...e.node,...l,node_params:_})},g=()=>{let _=i().getAllParentVariable();_.forEach(x=>{x.tags=x.tags||[]}),c.value=_},y=_=>{ps.includes(_.node_type)&&(g(),_n(()=>{l.body_raw_tags&&l.body_raw_tags.length>0&&l.body_raw_tags.forEach(w=>{if(w.node_id==_.node_id){let C=w.label.split("/");C[0]=_.node_name,w.label=C.join("/"),w.node_name=_.node_name}}),["headers","params","body"].forEach(w=>{l[w].forEach(k=>{k.tags&&k.tags.length>0&&k.tags.forEach(D=>{if(D.node_id==_.node_id){let I=D.label.split("/");I[0]=_.node_name,D.label=I.join("/"),D.node_name=_.node_name}})})}),v()}))},b=()=>{};return qt(()=>e.properties,f,{deep:!0}),Xt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",y)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",y)}),(_,x)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:b},{default:V(()=>[E("div",L5,[E("div",P5,[E("div",R5,[x[0]||(x[0]=E("div",{class:"field-item-label"},"请求地址",-1)),E("div",I5,[E("div",B5,[E("span",j5,De(l.method),1),E("span",H5,De(l.rawurl),1)])])]),E("div",$5,[x[1]||(x[1]=E("div",{class:"field-item-label"},"HEADERS",-1)),E("div",F5,[(Y(!0),se(it,null,ft(l.headers,w=>(Y(),se("div",{class:"field-list-item",key:w.cu_key},[E("div",z5,De(w.key),1),E("div",W5,[B(je(nl))]),E("div",U5,[B(Wr,{options:c.value,"default-value":w.value,defaultSelectedList:w.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),E("div",V5,[x[2]||(x[2]=E("div",{class:"field-item-label"},"PARAMS",-1)),E("div",X5,[(Y(!0),se(it,null,ft(l.params,w=>(Y(),se("div",{class:"field-list-item",key:w.cu_key},[E("div",G5,De(w.key),1),E("div",Y5,[B(je(nl))]),E("div",q5,[B(Wr,{options:c.value,"default-value":w.value,defaultSelectedList:w.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),l.type==1?(Y(),se("div",K5,[x[3]||(x[3]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",J5,[(Y(!0),se(it,null,ft(l.body,w=>(Y(),se("div",{class:"field-list-item",key:w.cu_key},[E("div",Z5,De(w.key),1),E("div",Q5,[B(je(nl))]),E("div",eH,[B(Wr,{options:c.value,"default-value":w.value,defaultSelectedList:w.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):Qe("",!0),l.type==2?(Y(),se("div",tH,[x[4]||(x[4]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",nH,[E("div",rH,De(l.body_raw),1)])])):Qe("",!0),E("div",iH,[x[5]||(x[5]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",oH,[(Y(!0),se(it,null,ft(l.output,w=>(Y(),se("div",{class:"field-value",key:w.cu_key},[E("span",aH,De(w.key),1),E("span",sH,De(w.typ),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},uH=pt(lH,[["__scopeId","data-v-e1b81924"]]);let dH=class extends Bn{constructor(e){super(e),this.renderVue(uH,e)}},cH=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+26,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+26,id:d+"-anchor_right",type:"right",nodeId:e}]}};const fH={type:"http-node",model:cH,view:dH},hH={class:"ai-dialogue-node"},pH={class:"field-list"},vH={class:"field-item"},gH={class:"field-item-content"},mH={class:"field-value"},yH={class:"field-item"},_H={class:"field-item-content"},bH={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=Ce(null),l=Ce([]),d=Vt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[]}),c=Ce([]);function f(C){if(C){let k=C.split("."),D=k[0],I=k.filter(($,R)=>R>0).join(".");return[D,I]}return["global","question"]}const v=()=>{const C=e.properties.dataRaw||e.properties.node_params||"{}";let k={};try{k=JSON.parse(C).libs||{}}catch{k={}}x(),k=JSON.parse(JSON.stringify(k));for(let D in k)D=="library_ids"?d[D]=k[D]?k[D].split(","):[]:D=="question_value"?d.question_value=f(k.question_value):d[D]=k[D];_n(()=>{o()})},g=()=>{const C=JSON.stringify({libs:{...d,rerank_model_config_id:d.rerank_model_config_id?+d.rerank_model_config_id:void 0,question_value:d.question_value.join("."),library_ids:d.library_ids.join(",")}});t({...e.node,...d,node_params:C})},y=Ce([]),b=Kt(()=>y.value.filter(C=>d.library_ids.includes(C.id))),_=async()=>{const C=await Th({type:""});C&&(y.value=C.data||[],_n(()=>{o()}))},x=()=>{let C=i().getAllParentVariable();c.value=C},w=()=>{x(),g(),s.value.refresh()};return qt(()=>e.properties,v,{deep:!0}),Xt(()=>{_(),v(),n().eventCenter.on("custom:setNodeName",w)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",w)}),(C,k)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:l.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",hH,[E("div",pH,[E("div",vH,[k[0]||(k[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",gH,[E("div",mH,[B(sa,{ref_key:"questionTextRef",ref:s,value:d.question_value},null,8,["value"])])])]),k[2]||(k[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出字段"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"知识库引用"),E("span",{class:"field-type"},"string")])])],-1)),E("div",yH,[k[1]||(k[1]=E("div",{class:"field-item-label"},"知识库",-1)),E("div",_H,[(Y(!0),se(it,null,ft(b.value,D=>(Y(),se("div",{class:"library-item",key:D.id},De(D.library_name),1))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},xH=pt(bH,[["__scopeId","data-v-95c1e3dd"]]);let wH=class extends Bn{constructor(e){super(e),this.renderVue(xH,e)}},SH=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const EH={type:"knowledge-base-node",model:SH,view:wH},CH={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:Hn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function OH(r,e,t,n,i,o){const s=kn("node-common");return Y(),Fe(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu,style:{width:"420px",height:"94px"}},{default:V(()=>e[0]||(e[0]=[E("div",{class:"end-node"},[E("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])),_:1,__:[0]},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const kH=pt(CH,[["render",OH],["__scopeId","data-v-81c60081"]]);let NH=class extends Bn{constructor(e){super(e),this.renderVue(kH,e)}},MH=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}]}};const AH={type:"end-node",model:MH,view:NH},TH={name:"EndNode",inject:["getNode","getGraph","setData"],components:{NodeCommon:Hn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{observer:null,menus:[],formState:{content:"",height:88}}},computed:{},mounted(){var t;let r=JSON.parse(this.properties.node_params);this.formState={...this.formState,...r};const e=(t=this.$refs.textareaRef)==null?void 0:t.querySelector("textarea");e&&(this.observer=new ResizeObserver(n=>{for(const i of n){const{height:o}=i.contentRect;this.formState.height=o+8,this.updateContent()}}),this.observer.observe(e))},beforeUnmount(){this.observer&&this.observer.disconnect()},methods:{getHeight(){return 68+this.formState.height},updateContent(){this.setData({node_params:JSON.stringify(this.formState),height:this.getHeight()})},handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}};function DH(r,e,t,n,i,o){const s=Kd,l=kn("node-common");return Y(),Fe(l,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu},{default:V(()=>[E("div",{class:"explain-node",onMousedown:e[3]||(e[3]=dn(()=>{},["stop"])),ref:"textareaRef"},[B(s,{style:Si({height:`${i.formState.height}px`}),onWheel:e[0]||(e[0]=dn(()=>{},["stop"])),bordered:!1,class:"explain-textarea",value:i.formState.content,"onUpdate:value":e[1]||(e[1]=d=>i.formState.content=d),placeholder:"请输入注释",onInput:e[2]||(e[2]=d=>o.updateContent(d.target.value))},null,8,["style","value"])],544)]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const LH=pt(TH,[["render",DH],["__scopeId","data-v-b1301a55"]]);let PH=class extends Bn{constructor(e){super(e),this.renderVue(LH,e)}},RH=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[]}};const IH={type:"explain-node",model:RH,view:PH},BH={class:"ai-dialogue-node"},jH={class:"field-list"},HH={class:"field-item"},$H={class:"field-item-content"},FH={class:"field-text"},zH={class:"right-arrow"},WH={class:"field-text"},UH={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=Ce([]),l=Vt({list:[]}),d=Ce([]),c=Ce([]),f=()=>{const x=e.properties.dataRaw||e.properties.node_params||"{}";let w=[];try{w=JSON.parse(x).assign||[]}catch(C){}b(),y(),w.forEach(C=>{C.tags=C.tags||[]}),l.list=w,_n(()=>{o()})},v=()=>{let x=JSON.parse(e.properties.node_params);x.assign=[...l.list],t({...e.node,node_params:JSON.stringify(x)})};function g(x){return x?x.split(".")[1]:""}const y=()=>{let w=i().getGlobalVariable().diy_global||[];w.forEach(C=>{C.label=C.key,C.value="global."+C.key}),d.value=w||[]},b=()=>{let x=i().getAllParentVariable();x.forEach(w=>{w.tags=w.tags||[]}),c.value=x},_=x=>{ps.includes(x.node_type)&&(b(),_n(()=>{l.list.forEach(w=>{w.tags&&w.tags.length>0&&w.tags.forEach(C=>{if(C.node_id==x.node_id){let k=C.label.split("/");k[0]=x.node_name,C.label=k.join("/"),C.node_name=x.node_name}})}),v()}))};return qt(()=>e.properties,f,{deep:!0}),Xt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",_)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",_)}),(x,w)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",BH,[E("div",jH,[E("div",HH,[w[0]||(w[0]=E("div",{class:"field-item-label"},"变量",-1)),E("div",$H,[(Y(!0),se(it,null,ft(l.list,(C,k)=>(Y(),se("div",{class:"field-list-item",key:k},[E("div",FH,[B(Wr,{options:c.value,"default-value":C.value,defaultSelectedList:C.tags},null,8,["options","default-value","defaultSelectedList"])]),E("div",zH,[B(je(nl))]),E("div",WH,De(g(C.variable)),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},VH=pt(UH,[["__scopeId","data-v-f1e94366"]]);let XH=class extends Bn{constructor(e){super(e),this.renderVue(VH,e)}},GH=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const YH={type:"variable-assignment-node",model:GH,view:XH},qH={class:"judge-node"},KH={class:"if-box-label"},JH={class:"if-box-content"},ZH={class:"condition-box"},QH={key:0,class:"condition-left-box"},e6={class:"connection-text"},t6={key:1,class:"condition-line"},n6={class:"condition-body"},r6={class:"field-items"},i6={class:"field-name"},o6={class:"field-rule"},a6={class:"field-value"},s6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("resetSize"),n=wt("getNode"),i=wt("updateAnchorList");let o=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const s=Vt({term:[]}),l=Ce([]),d=Ce([]);function c(){let C=n().getAllParentVariable();l.value=f(C)}function f(C){return C.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=f(k.children))}),C}let v=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],g=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function y(C){let k="";if(C.variable&&C.variable.length>0){let D=l.value.filter(I=>I.key==C.variable[0]);D&&D.length&&(k=D[0].typ),k=="object"&&(D[0]&&D[0].children&&(D=D[0].subs.filter(I=>I.key==C.variable[1])),D&&D.length&&(k=D[0].typ),k=="object"&&(D[0]&&D[0].children&&(D=D[0].subs.filter(I=>I.key==C.variable[2])),D&&D.length&&(k=D[0].typ)))}return k}function b(C){if(!C.variable)return[];let k=y(C);return k==""?C.is_mult?g:v:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?g:v}const _=C=>{let k=b(C),D=k.findIndex(I=>I.value==C.type);return k[D].label},x=()=>{try{let C=JSON.parse(e.properties.node_params).term||[];C=C.map(k=>{let D=k.terms.map(I=>{let $="";for(let R=0;R<o.length;R++)if(I.variable.indexOf(o[R])>-1){$=o[R];break}if($!=""){let R=I.variable.split(".");I.variable=[R[0],$]}else I.variable=I.variable.split(".");return{...I,type:I.type>0?I.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:D,key:Math.random()*1e4}}),s.term=C,_n(()=>{t(),w()})}catch(C){}},w=()=>{const C=e.properties.nodeSortKey;let k=[],D=56;for(let I=0;I<s.term.length;I++){let $=s.term[I];if($){let R=0,F=D,z=8,ie=2,G=24,Q=$.terms.length;R=Q*G+z*2+ie*(Q-1),I>0&&I<s.term.length&&(F+=8),D=F+R,k.push({id:C+"-anchor_"+I,offsetHeight:R,offsetTop:F})}}k.length>0&&k.push({id:C+"-anchor_right",offsetHeight:24,offsetTop:D+8}),i(k)};return qt(()=>e.properties.node_params,(C,k)=>{C!=k&&x()},{deep:!0}),Xt(()=>{c(),x()}),(C,k)=>(Y(),Fe(Hn,{title:r.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",qH,[(Y(!0),se(it,null,ft(s.term,(D,I)=>(Y(),se("div",{class:"if-box",ref_for:!0,ref:$=>d.value[I]=$,key:I},[E("div",KH,De(I==0?"if":"else if"),1),E("div",JH,[E("div",ZH,[D.terms.length>1?(Y(),se("div",QH,[E("span",e6,De(D.is_or==1?"or":"and"),1)])):Qe("",!0),D.terms.length>1?(Y(),se("div",t6)):Qe("",!0),E("div",n6,[E("div",r6,[(Y(!0),se(it,null,ft(D.terms,($,R)=>(Y(),se("div",{class:"field-item",key:R},[E("span",i6,[B(sa,{value:$.variable},null,8,["value"])]),E("span",o6,De(_($)),1),E("span",a6,De($.value),1)]))),128))])])])])]))),128)),k[0]||(k[0]=E("div",{class:"else-box"},[E("div",{class:"else-box-label"},"else"),E("div",{class:"else-box-content"},[E("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},l6=pt(s6,[["__scopeId","data-v-2ebf8ae4"]]);let u6=class extends Bn{constructor(e){super(e),this.renderVue(l6,e)}},d6=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const s=n.graphModel.edges.map(d=>d.sourceAnchorId),l=o.id;return o.type==="right"&&!s.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:s,anchorList:l}=this.properties;let d=[{x:t-i/2,y:n-o/2+24,id:s+"-anchor_left",type:"left",nodeId:e}];if(l)for(let c=0;c<l.length;c++){let{offsetTop:f,offsetHeight:v}=l[c],g=n-o/2;d.push({id:l[c].id,x:t+i/2,y:g+f+v/2,type:"right"})}return d}};const c6={type:"judge-node",model:d6,view:u6},f6={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:Hn,AtText:Wr},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(r,e){r.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let r=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(r).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(r){ps.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh(),this.update()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.properties.node_params);r.reply={...this.formState},this.setData({node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()}}},h6={class:"specify-reply-node"},p6={class:"static-field-list"},v6={class:"static-field-item"},g6={class:"static-field-item-content"},m6={class:"static-field-value"},y6={key:1};function _6(r,e,t,n,i,o){const s=kn("at-text"),l=kn("node-common");return Y(),Fe(l,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:V(()=>[E("div",h6,[E("div",p6,[E("div",v6,[e[0]||(e[0]=E("div",{class:"static-field-item-label"},"消息内容",-1)),E("div",g6,[E("div",m6,[i.formState.content.length>0?(Y(),Fe(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(Y(),se("span",y6,"--"))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const b6=pt(f6,[["render",_6],["__scopeId","data-v-d8d9a604"]]);let x6=class extends Bn{constructor(e){super(e),this.renderVue(b6,e)}},w6=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const s=n.graphModel.edges.map(d=>d.sourceAnchorId),l=o.id;return o.type==="right"&&!s.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const S6={type:"specify-reply-node",model:w6,view:x6},E6={class:"ai-dialogue-node"},C6={class:"field-list"},O6={class:"field-item"},k6={class:"field-item-content"},N6={class:"field-value"},M6={class:"field-item"},A6={class:"field-item-content"},T6={class:"field-value"},D6={class:"field-key"},L6={class:"field-item"},P6={class:"field-item-content"},R6={class:"field-key"},I6={class:"field-type"},B6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=ri(),{modelList:l}=Il(s),d=Ce(null),c=Ce([]),f=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),v=Ce([]),g=Ce([]);function y(I){if(I){let $=I.split("."),R=$[0],F=$.filter((z,ie)=>ie>0).join(".");return[R,F]}return["global","question"]}function b(I){return I.forEach($=>{$.cu_key=Math.random()*1e4,$.subs&&$.subs.length?b($.subs):$.subs=[]}),I}const _=()=>{const I=e.properties.dataRaw||e.properties.node_params||"{}";let $={};try{$=JSON.parse(I).params_extractor||{}}catch{$={}}$=JSON.parse(JSON.stringify($)),w(),C();for(let R in $){if(R=="output"){f.output=b($[R]);continue}if(R=="question_value"){f.question_value=y($[R]);continue}f[R]=$[R]}!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),_n(()=>{o()})},x=()=>{const I=JSON.stringify({params_extractor:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:I})},w=()=>{let I=i().getAllParentVariable();I.forEach($=>{$.tags=$.tags||[]}),v.value=I};function C(){let I=i().getAllParentVariable();g.value=k(I)}function k(I){return I.forEach($=>{$.typ=="node"?$.node_type==1?$.value="global":$.value=$.node_id:$.value=$.key,$.children&&$.children.length>0&&($.children=k($.children))}),I}const D=I=>{ps.includes(I.node_type)&&(w(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach($=>{if($.node_id==I.node_id){let R=$.label.split("/");R[0]=I.node_name,$.label=R.join("/"),$.node_name=I.node_name}}),x(),d.value.refresh())};return qt(()=>e.properties.dataRaw,(I,$)=>{I!=$&&_()},{deep:!0}),Xt(()=>{_(),o(),n().eventCenter.on("custom:setNodeName",D)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",D)}),(I,$)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",E6,[E("div",C6,[E("div",O6,[$[0]||($[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",k6,[E("div",N6,[B(sa,{ref_key:"questionTextRef",ref:d,value:f.question_value},null,8,["value"])])])]),E("div",M6,[$[1]||($[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",A6,[E("div",T6,[E("span",D6,[B(hc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",L6,[$[2]||($[2]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",P6,[(Y(!0),se(it,null,ft(f.output,R=>(Y(),se("div",{class:wn(["field-value",{"is-required":R.required}]),key:R.cu_key},[E("span",R6,De(R.key),1),E("span",I6,De(R.typ),1)],2))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},j6=pt(B6,[["__scopeId","data-v-8e3eba93"]]);let H6=class extends Bn{constructor(e){super(e),this.renderVue(j6,e)}},$6=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const F6={type:"parameter-extraction-node",model:$6,view:H6},z6={class:"ai-dialogue-node"},W6={class:"static-field-list"},U6={class:"static-field-item"},V6={class:"static-field-item-content"},X6={class:"static-field-value"},G6={class:"static-field-item"},Y6={class:"static-field-item-content"},q6={class:"static-field-value"},K6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Ce(null),n=wt("setData"),i=wt("getGraph"),o=wt("getNode"),s=wt("resetSize"),l=ri(),{modelList:d}=Il(l),c=Ce([]),f=Vt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),v=Ce([]);function g(w){if(w){let C=w.split("."),k=C[0],D=C.filter((I,$)=>$>0).join(".");return[k,D]}return["global","question"]}const y=()=>{const w=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(w).question_optimize||{}}catch{C={}}_();const{model_config_id:k,use_model:D,context_pair:I,temperature:$,max_token:R,prompt:F,prompt_tags:z,question_value:ie,enable_thinking:G}=JSON.parse(JSON.stringify(C));f.model_config_id=k,f.use_model=D,f.context_pair=I||0,f.temperature=$,f.max_token=R,f.prompt=F,f.enable_thinking=G,f.prompt_tags=z||[],f.question_value=g(ie),!f.model_config_id&&d.value.length>0&&(f.model_config_id=d.value[0].id,f.use_model=d.value[0].children[0].name),_n(()=>{s()})},b=()=>{const w={...f,node_params:JSON.stringify({question_optimize:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}})};n(w)},_=()=>{let w=o().getAllParentVariable();v.value=w},x=w=>{_(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(C=>{if(C.node_id==w.node_id){let k=C.label.split("/");k[0]=w.node_name,C.label=k.join("/"),C.node_name=w.node_name}}),b(),t.value.refresh()};return qt(()=>e.properties,y,{deep:!0}),Xt(()=>{y(),_n(()=>{s()}),i().eventCenter.on("custom:setNodeName",x)}),Ei(()=>{i().eventCenter.off("custom:setNodeName",x)}),(w,C)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",z6,[E("div",W6,[E("div",U6,[C[0]||(C[0]=E("div",{class:"static-field-item-label"},"用户问题",-1)),E("div",V6,[E("div",X6,[B(sa,{ref_key:"questionTextRef",ref:t,value:f.question_value},null,8,["value"])])])]),E("div",G6,[C[1]||(C[1]=E("div",{class:"static-field-item-label"},"LLM模型",-1)),E("div",Y6,[E("div",q6,[B(hc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])]),C[2]||(C[2]=E("div",{class:"static-field-item"},[E("div",{class:"static-field-item-label"},"输出"),E("div",{class:"static-field-item-content"},[E("div",{class:"static-field-value"},[E("span",{class:"static-field-key"},"问题优化结果"),E("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},J6=pt(K6,[["__scopeId","data-v-9d510192"]]);let Z6=class extends Bn{constructor(e){super(e),this.renderVue(J6,e)}},Q6=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const e$={type:"problem-optimization-node",model:Q6,view:Z6},Fw="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",t$={class:"add-data-node"},n$={class:"static-field-list"},r$={class:"static-field-item"},i$={class:"static-field-item-content"},o$={class:"static-field-value"},a$={class:"static-field-item"},s$={class:"static-field-item-content"},l$={key:0,class:"static-field-value"},u$={class:"field-name"},d$={class:"field-name"},c$={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("resetSize"),i=wt("getNode");let o={};const s=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=Ce([]),d=()=>{let v=i().getAllParentVariable();l.value=v||[]},c=()=>{let v=e.properties.dataRaw||e.properties.node_params||"{}";o=JSON.parse(v),d(),s.formData=o.form_insert,f(),_n(()=>{n()})},f=()=>{o.form_insert=zi(s.formData),t({...e.node,node_params:JSON.stringify(o)})};return qt(()=>e.properties.dataRaw,(v,g)=>{v!==g&&c()}),Xt(()=>{c()}),(v,g)=>(Y(),Fe(Hn,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",t$,[E("div",n$,[E("div",r$,[g[0]||(g[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",i$,[E("div",o$,De(s.formData.form_name||"--"),1)])]),E("div",a$,[g[2]||(g[2]=E("div",{class:"static-field-item-label"},"插入数据",-1)),E("div",s$,[s.formData.datas.length==0?(Y(),se("div",l$,"--")):Qe("",!0),(Y(!0),se(it,null,ft(s.formData.datas,y=>(Y(),se("div",{class:"static-field-value",key:y.id},[E("span",u$,[B(Wr,{options:l.value,"default-value":y.value,defaultSelectedList:y.atTags},null,8,["options","default-value","defaultSelectedList"])]),g[1]||(g[1]=E("span",{class:"field-arrow"},[E("img",{src:Fw,alt:""})],-1)),E("span",d$,De(y.name),1)]))),128))])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},f$=pt(c$,[["__scopeId","data-v-c21dd32b"]]);let h$=class extends Bn{constructor(e){super(e),this.renderVue(f$,e)}},p$=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const v$={type:"add-data-node",model:p$,view:h$},g$={class:"node-box"},m$={class:"static-field-list"},y$={class:"static-field-item"},_$={class:"static-field-item-content"},b$={class:"static-field-value"},x$={class:"static-field-item",style:{"align-items":"center"}},w$={class:"static-field-item-content"},S$={key:0,class:"static-field-value"},E$={class:"condition-box"},C$={key:0,class:"condition-left-box"},O$={class:"connection-text"},k$={key:1,class:"condition-line"},N$={class:"condition-body"},M$={class:"field-items"},A$={class:"field-name"},T$={class:"field-rule"},D$={class:"field-value"},L$={class:"static-field-item"},P$={class:"static-field-item-content"},R$={class:"options-list"},I$={class:"option-label"},B$={class:"option-label"},j$={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("resetSize"),i=wt("getNode"),o=Oo();let s={};const l=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),d=Ce([]),c=()=>{let x=i().getAllParentVariable();d.value=x||[]},f=()=>{let x=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(x),c();let w=g(s.form_update.where||[]);s.form_update.where=w,l.formData=s.form_update,l.formData.form_id&&b(l.formData.form_id),v(),_n(()=>{n()})},v=()=>{let x={...zi(l.formData)};x.where=y(x.where),s.form_update=x,t({...e.node,node_params:JSON.stringify(s)})},g=x=>{let w=[];return x.forEach(C=>{let k=JSON.parse(JSON.stringify(C)),D=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=D[0],D.shift(),k.rule=D.join("_"),w.push(k)}),w},y=x=>{let w=[];return x.forEach(C=>{let k=JSON.parse(JSON.stringify(C));k.form_field_id=k.form_field_id*1,k.rule=C.field_type+"_"+C.rule,w.push(k)}),w},b=async x=>{o.getFormFieldList({form_id:x}).then(w=>{w.forEach(C=>{C.id=C.id*1}),l.fieldList=w}).catch(()=>{})},_=(x,w)=>$h(w,x);return qt(()=>e.properties.dataRaw,(x,w)=>{x!==w&&f()}),Xt(()=>{f()}),(x,w)=>(Y(),Fe(Hn,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:V(()=>[E("div",g$,[E("div",m$,[E("div",y$,[w[0]||(w[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",_$,[E("div",b$,De(l.formData.form_name||"--"),1)])]),E("div",x$,[w[2]||(w[2]=E("div",{class:"static-field-item-label"},"更新条件",-1)),E("div",w$,[l.formData.where.length==0?(Y(),se("span",S$,"--")):Qe("",!0),E("div",E$,[l.formData.where.length>1?(Y(),se("div",C$,[E("span",O$,De(l.formData.typ==1?"且":"或"),1)])):Qe("",!0),l.formData.where.length>1?(Y(),se("div",k$)):Qe("",!0),E("div",N$,[E("div",M$,[(Y(!0),se(it,null,ft(l.formData.where,C=>(Y(),se("div",{class:"field-item",key:C.id},[E("span",A$,De(C.field_name),1),E("span",T$,De(_(C.field_type,C.rule)),1),E("span",D$,[B(Wr,{options:d.value,"default-value":C.rule_value1,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"]),C.rule_value2?(Y(),se(it,{key:0},[w[1]||(w[1]=E("span",null,"-",-1)),B(Wr,{options:d.value,"default-value":C.rule_value2,defaultSelectedList:C.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Qe("",!0)])]))),128))])])])])]),E("div",L$,[w[4]||(w[4]=E("div",{class:"static-field-item-label"},"更新数据",-1)),E("div",P$,[E("div",R$,[(Y(!0),se(it,null,ft(l.formData.datas,C=>(Y(),se("div",{class:"options-item",key:C.key},[E("div",I$,[B(Wr,{options:d.value,"default-value":C.value,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"])]),w[3]||(w[3]=E("span",{class:"field-arrow"},[E("img",{src:Fw,alt:""})],-1)),E("div",B$,De(C.name),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},H$=pt(j$,[["__scopeId","data-v-456935d2"]]);let $$=class extends Bn{constructor(e){super(e),this.renderVue(H$,e)}},F$=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const z$={type:"update-data-node",model:F$,view:$$},W$={class:"node-box"},U$={class:"static-field-list"},V$={class:"static-field-item"},X$={class:"static-field-item-content"},G$={class:"static-field-value"},Y$={class:"static-field-item",style:{"align-items":"center"}},q$={class:"static-field-item-content"},K$={key:0,class:"static-field-value"},J$={class:"condition-box"},Z$={key:0,class:"condition-left-box"},Q$={class:"connection-text"},eF={key:1,class:"condition-line"},tF={class:"condition-body"},nF={class:"field-items"},rF={class:"field-name"},iF={class:"field-rule"},oF={class:"field-value"},aF={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("resetSize"),n=wt("setData"),i=wt("getNode"),o=Oo();let s={};const l=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),d=Ce([]),c=()=>{let x=i().getAllParentVariable();d.value=x||[]},f=()=>{let x=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(x),c();let w=y(s.form_delete.where||[]);s.form_delete.where=w,l.formData=s.form_delete,l.formData.form_id&&b(l.formData.form_id),v(),_n(()=>{t()})},v=()=>{let x={...zi(l.formData)};x.where=g(x.where),s.form_delete=x,n({...e.node,node_params:JSON.stringify(s)})},g=x=>{let w=[];return x.forEach(C=>{let k=JSON.parse(JSON.stringify(C));k.form_field_id=k.form_field_id*1,k.rule=C.field_type+"_"+C.rule,w.push(k)}),w},y=x=>{let w=[];return x.forEach(C=>{let k=JSON.parse(JSON.stringify(C)),D=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=D[0],D.shift(),k.rule=D.join("_"),w.push(k)}),w},b=async x=>{o.getFormFieldList({form_id:x}).then(w=>{w.forEach(C=>{C.id=C.id*1}),l.fieldList=w,_n(()=>{t()})}).catch(()=>{})},_=(x,w)=>$h(w,x);return qt(()=>e.properties.dataRaw,(x,w)=>{x!==w&&f()}),Xt(()=>{f()}),(x,w)=>(Y(),Fe(Hn,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:V(()=>[E("div",W$,[E("div",U$,[E("div",V$,[w[0]||(w[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",X$,[E("div",G$,De(l.formData.form_name||"--"),1)])]),E("div",Y$,[w[2]||(w[2]=E("div",{class:"static-field-item-label"},"删除条件",-1)),E("div",q$,[l.formData.where.length==0?(Y(),se("span",K$,"--")):Qe("",!0),E("div",J$,[l.formData.where.length>1?(Y(),se("div",Z$,[E("span",Q$,De(l.formData.typ==1?"且":"或"),1)])):Qe("",!0),l.formData.where.length>1?(Y(),se("div",eF)):Qe("",!0),E("div",tF,[E("div",nF,[(Y(!0),se(it,null,ft(l.formData.where,C=>(Y(),se("div",{class:"field-item",key:C.id},[E("span",rF,De(C.field_name),1),E("span",iF,De(_(C.field_type,C.rule)),1),E("span",oF,[B(Wr,{options:d.value,"default-value":C.rule_value1,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"]),C.rule_value2?(Y(),se(it,{key:0},[w[1]||(w[1]=E("span",null,"-",-1)),B(Wr,{options:d.value,"default-value":C.rule_value2,defaultSelectedList:C.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Qe("",!0)])]))),128))])])])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},sF=pt(aF,[["__scopeId","data-v-30f0bc82"]]);let lF=class extends Bn{constructor(e){super(e),this.renderVue(sF,e)}},uF=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const dF={type:"delete-data-node",model:uF,view:lF},cF={class:"node-box"},fF={class:"static-field-list"},hF={class:"static-field-item"},pF={class:"static-field-item-content"},vF={class:"static-field-value"},gF={class:"static-field-item",style:{"align-items":"center"}},mF={class:"static-field-item-content"},yF={key:0,class:"static-field-value"},_F={class:"condition-box"},bF={key:0,class:"condition-left-box"},xF={class:"connection-text"},wF={key:1,class:"condition-line"},SF={class:"condition-body"},EF={class:"field-items"},CF={class:"field-name"},OF={class:"field-rule"},kF={class:"field-value"},NF={class:"static-field-item"},MF={class:"static-field-item-content"},AF={class:"options-list"},TF={class:"option-label"},DF={class:"option-type"},LF={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("resetSize"),i=wt("getNode"),o=wt("getGraph"),s=Oo();let l={};const d=Vt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),c=Ce([]),f=()=>{let k=i().getAllParentVariable();c.value=k||[]},v=()=>{let k=e.properties.dataRaw||e.properties.node_params||"{}";l=JSON.parse(k),f();let D=y(l.form_select.where||[]);l.form_select.where=D,d.formData=l.form_select,d.formData.form_id&&x(d.formData.form_id),g(),_n(()=>{n()})},g=()=>{let k={...zi(d.formData)};k.where=b(k.where),l.form_select=k,t({...e.node,node_params:JSON.stringify(l)})},y=k=>{let D=[];return k.forEach(I=>{let $=JSON.parse(JSON.stringify(I)),R=$.rule.split("_");$.form_field_id=$.form_field_id*1,$.field_type=R[0],R.shift(),$.rule=R.join("_"),D.push($)}),D},b=k=>{let D=[];return k.forEach(I=>{let $=JSON.parse(JSON.stringify(I));$.form_field_id=$.form_field_id*1,$.rule=I.field_type+"_"+I.rule,D.push($)}),D},_=async()=>{const k=await s.getFormList();k&&(d.tableList=k)},x=async k=>{s.getFormFieldList({form_id:k}).then(D=>{D.forEach(I=>{I.id=I.id*1}),d.fieldList=D}).catch(()=>{})},w=(k,D)=>$h(D,k),C=()=>{v()};return qt(()=>e.properties.dataRaw,(k,D)=>{k!==D&&v()}),Xt(()=>{_(),v(),o().eventCenter.on("custom:setNodeName",C)}),Ei(()=>{o().eventCenter.off("custom:setNodeName",C)}),(k,D)=>(Y(),Fe(Hn,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:V(()=>[E("div",cF,[E("div",fF,[E("div",hF,[D[0]||(D[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",pF,[E("div",vF,De(d.formData.form_name||"--"),1)])]),E("div",gF,[D[2]||(D[2]=E("div",{class:"static-field-item-label"},"查询条件",-1)),E("div",mF,[d.formData.where.length==0?(Y(),se("span",yF,"--")):Qe("",!0),E("div",_F,[d.formData.where.length>1?(Y(),se("div",bF,[E("span",xF,De(d.formData.typ==1?"且":"或"),1)])):Qe("",!0),d.formData.where.length>1?(Y(),se("div",wF)):Qe("",!0),E("div",SF,[E("div",EF,[(Y(!0),se(it,null,ft(d.formData.where,I=>(Y(),se("div",{class:"field-item",key:I.id},[E("span",CF,De(I.field_name),1),E("span",OF,De(w(I.field_type,I.rule)),1),E("span",kF,[B(Wr,{options:c.value,"default-value":I.rule_value1,defaultSelectedList:I.atTags},null,8,["options","default-value","defaultSelectedList"]),I.rule_value2?(Y(),se(it,{key:0},[D[1]||(D[1]=E("span",null,"-",-1)),B(Wr,{options:c.value,"default-value":I.rule_value2,defaultSelectedList:I.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):Qe("",!0)])]))),128))])])])])]),E("div",NF,[D[3]||(D[3]=E("div",{class:"static-field-item-label"},"查询字段",-1)),E("div",MF,[E("div",AF,[(Y(!0),se(it,null,ft(d.formData.fields,I=>(Y(),se("div",{class:"options-item",key:I.key},[E("div",TF,De(I.name),1),E("div",DF,De(I.type),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},PF=pt(LF,[["__scopeId","data-v-730526a7"]]);let RF=class extends Bn{constructor(e){super(e),this.renderVue(PF,e)}},IF=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const BF={type:"select-data-node",model:IF,view:RF},jF={class:"ai-dialogue-node"},HF={class:"field-list"},$F={class:"field-item"},FF={class:"field-item-content"},zF={class:"field-text"},WF={class:"right-arrow"},UF={class:"field-text"},VF={class:"field-item"},XF={class:"field-item-content"},GF={class:"field-key"},YF={class:"field-type"},qF=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,KF={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=wt("setData"),n=wt("getGraph"),i=wt("getNode"),o=wt("resetSize"),s=Ce([]),l=Vt({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),d=Ce([]);let c=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function f(x){return x.forEach(w=>{w.cu_key=Math.random()*1e4,w.subs&&w.subs.length?f(w.subs):w.subs=[]}),x}const v=()=>{const x=e.properties.dataRaw||e.properties.node_params||"{}";let w={};try{w=JSON.parse(x).code_run||{}}catch{w={}}b(),w=JSON.parse(JSON.stringify(w));for(let C in w){if(C=="params"){w[C]&&w[C].length>0?l[C]=w[C].map(k=>({...k,cu_key:Math.random()*1e4})):l[C]=[];continue}if(C=="output"){l.output=f(w[C]);continue}l[C]=w[C]}l.main_func=l.main_func||qF,l.params=l.params.map(C=>{let k="";for(let D=0;D<c.length;D++)if(C.variable.indexOf(c[D])>-1){k=c[D];break}if(k!=""){let D=C.variable.split(".");C.variable=[D[0],k]}else C.variable=C.variable.split(".");return{...C,key:Math.random()*1e4}}),_n(()=>{o()})},g=()=>{const x=JSON.stringify({code_run:{...l,params:y()}});t({...e.node,...l,node_params:x})};function y(){let x=[];return l.params.forEach(w=>{x.push({field:w.field,variable:w.variable&&w.variable.length>0?w.variable.join("."):""})}),x}const b=()=>{let x=i().getAllParentVariable();d.value=x},_=x=>{ps.includes(x.node_type)&&(b(),_n(()=>{g()}))};return qt(()=>e.properties,v,{deep:!0}),Xt(()=>{v(),o(),n().eventCenter.on("custom:setNodeName",_)}),Ei(()=>{n().eventCenter.off("custom:setNodeName",_)}),(x,w)=>(Y(),Fe(Hn,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:V(()=>[E("div",jF,[E("div",HF,[E("div",$F,[w[0]||(w[0]=E("div",{class:"field-item-label"},"输入参数",-1)),E("div",FF,[(Y(!0),se(it,null,ft(l.params,C=>(Y(),se("div",{class:"field-list-item",key:C.cu_key},[E("div",zF,[B(sa,{value:C.variable},null,8,["value"])]),E("div",WF,[B(je(nl))]),E("div",UF,De(C.field),1)]))),128))])]),E("div",VF,[w[1]||(w[1]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",XF,[(Y(!0),se(it,null,ft(l.output,C=>(Y(),se("div",{class:"field-value",key:C.cu_key},[E("span",GF,De(C.key),1),E("span",YF,De(C.typ),1)]))),128))])]),w[2]||(w[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"异常处理"),E("div",{class:"field-item-content"},[E("div",{class:"field-value"},[E("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},JF=pt(KF,[["__scopeId","data-v-10b0e2d5"]]);let ZF=class extends Bn{constructor(e){super(e),this.renderVue(JF,e)}},QF=class extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+28,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+28,id:d+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:n+o/2-28,id:d+"-anchor_right_exception",type:"right",nodeId:e}]}};const e7={type:"code-run-node",model:QF,view:ZF},t7={name:"QuestionNode",components:{NodeCommon:Hn},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}}}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.loadProvider()},methods:{loadProvider(){var r;Gx({provider_id:((r=this.nodeParams)==null?void 0:r.mcp.provider_id)||""}).then(e=>{var n;this.mcpInfo=(e==null?void 0:e.data)||{};let t=Fy((n=this.mcpInfo)==null?void 0:n.tools,{});this.toolInfo=t.find(i=>{var o;return i.name==((o=this.nodeParams)==null?void 0:o.mcp.tool_name)})})},update(r){let e=this.nodeParams;e.mcp.arguments=r.arguments,e.mcp.tag_map=r.tag_map,this.setData({node_params:JSON.stringify(e)})}}},n7={class:"mcp-node"};function r7(r,e,t,n,i,o){var d;const s=i_,l=kn("node-common");return Y(),Fe(l,{title:(d=i.toolInfo)==null?void 0:d.name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:V(()=>[E("div",n7,[e[1]||(e[1]=He(" MCP插件： ")),i.toolInfo===null?(Y(),Fe(s,{key:0,color:"red"},{default:V(()=>e[0]||(e[0]=[He("工具不存在或工具异常")])),_:1,__:[0]})):(Y(),Fe(s,{key:1},{default:V(()=>[He(De(t.properties.node_name),1)]),_:1}))])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key"])}const i7=pt(t7,[["render",r7]]);class o7 extends Bn{constructor(e){super(e),this.renderVue(i7,e)}}class a7 extends jn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}}const s7={type:"mcp-node",model:a7,view:o7},l7={name:"QuestionNode",components:{PopupMenu:Yx},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{}},mounted(){},methods:{handleAddNode(r){this.$emit("click-item",r)}}};function u7(r,e,t,n,i,o){const s=kn("PopupMenu");return Y(),Fe(s,{onAddNode:o.handleAddNode,type:"node"},null,8,["onAddNode"])}const d7=pt(l7,[["render",u7]]),c7=130,f7=440;class h7{constructor({lf:e}){ag(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${c7}px`,this.__menuDOM.style.height=`${f7}px`,this.isMounted=!1,this.r=Dn(d7,{properties:{},isSelected:!1,isHovered:!1,onClickItem:t=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{data:t,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=qd({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:n,model:i})=>{this._activeData=i,this._activeAnchorData=n,this.createMenu()}),e.on("node:click",({data:n})=>{this.hideMenu()}),e.on("edge:click",({data:n})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,n=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,n])}showMenu(){const[e,t]=this.getContextMenuPosition();this.__menuDOM.style.display="flex",this.__menuDOM.style.top=`${t}px`,this.__menuDOM.style.left=`${e+10}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}const p7={class:"logic-flow-wrapper"},v7={__name:"workflow-canvas",emits:["selectNode","deleteNode","runTest","blankClick"],setup(r,{expose:e,emit:t}){const n=t;let i=null;const o=Ce(null),s=Ce(!1),l=Ce(null),d=Ce(null),c=tj(),f=Ce(""),v={nodes:[]},g={width:160,height:140,bottomPosition:24,rightPosition:16};function y(){if(d.value){i=new O4({container:d.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[$B,zB,h7],pluginsOptions:{miniMap:g}}),An(fj,i),An(Ij,i),An(e5,i),An(l5,i),An(fH,i),An(g5,i),An(A5,i),An(EH,i),An(AH,i),An(IH,i),An(c6,i),An(YH,i),An(S6,i),An(F6,i),An(e$,i),An(v$,i),An(z$,i),An(dF,i),An(BF,i),An(e7,i),An(s7,i),i.setDefaultEdgeType("custom-edge"),i.on("graph:rendered",({graphModel:ie})=>{f.value=ie.flowId});let z=1;i.on("node:dragstart",({data:ie})=>{let G=i.graphModel.getElement(ie.id);z=G.zIndex,G.setZIndex(999999)}),i.on("node:drop",({data:ie})=>{i.graphModel.getElement(ie.id).setZIndex(z)}),i.on("custom:addNode",({data:ie,model:G,anchorData:Q})=>{x(ie,G,Q)}),i.on("node:click",({data:ie})=>{k(ie)}),i.on("blank:click",()=>{F()}),i.on("node:delete",({data:ie})=>{let G=JSON.parse(JSON.stringify(ie));$(G)}),i.render(v),i.setZoomMiniSize(.01),i.setZoomMaxSize(8),i.container.addEventListener("wheel",ie=>{if(ie.shiftKey){ie.preventDefault();const G=i.getTransform();let Q=G.SCALE_X,T=G.SCALE_Y;ie.deltaY>0?i.translate(-100*Q,100*T):i.translate(100*Q,-100*T)}},{passive:!1}),i.extension.miniMap.show()}}const b=()=>i.getGraphRawData(),_=z=>{let ie=IC();z.nodes.forEach(G=>{let Q=ie[G.type];G.properties.node_icon_name=Q.properties.node_icon_name,G.properties.width||(G.properties.width=Q.width),G.properties.height||(G.properties.height=Q.height)}),i.clearData(),i.graphModel.graphDataToModel(z),i.graphModel.translateCenter()},x=(z,ie,G)=>{if(z.id=Pl(z.type),z.nodeSortKey=z.id.substring(0,8)+z.id.substring(z.id.length-8),z.properties.width=z.width,z.properties.height=z.height,z.properties.nodeSortKey=z.nodeSortKey,G)z.x=G.x+z.width+100,z.y=G.y+z.height/2-24;else{const{transformModel:W}=i.graphModel,P=W.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);z.x=P[0],z.y=P[1]}let Q=0;i.graphModel.nodes.forEach(W=>{W.zIndex>Q&&(Q=W.zIndex)}),Q=Q+1;let T=i.addNode(z);G&&i.graphModel.addEdge({type:"custom-edge",sourceNodeId:ie.id,targetNodeId:T.id,sourceAnchorId:G.id,startPoint:{x:G.x,y:G.y}}),T.setZIndex(Q),i.graphModel.clearSelectElements(),T.setSelected(!0)},w=z=>{z.height&&(z.properties.height=z.height);let ie=i.getNodeModelById(z.id);ie.height=z.properties.height||z.height||ie.height,ie.properties=z.properties,z.properties.node_type==2&&z.properties.node_sub_type==21&&ie.graphModel.getNodeEdges(z.id).forEach(Q=>{Q.sourceNodeId==ie.id&&(ie.getAnchorInfo(Q.sourceAnchorId)||ie.graphModel.deleteEdgeById(Q.id))}),ie.refreshBranch()},C=["explain-node","end-node"],k=z=>{const ie=JSON.parse(JSON.stringify(z));ie.properties.dataRaw=ie.properties.dataRaw||ie.properties.node_params,n("selectNode",ie),!C.includes(z.type)&&(l.value=ie,s.value=!0)},D=z=>{l.value.properties=z,l.value,w(JSON.parse(JSON.stringify(l.value)))},I=z=>{l.value.properties.node_name=z,l.value,w(JSON.parse(JSON.stringify(l.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:z,node_id:l.value.id,node_type:l.value.type})},$=z=>{n("deleteNode",z),l.value&&z.id===l.value.id&&(s.value=!1,setTimeout(()=>{l.value=null},350))},R=()=>{n("runTest")},F=()=>{n("blankClick"),s.value&&(s.value=!1)};return Xt(()=>{y()}),e({setData:_,getData:b,updateNode:w}),(z,ie)=>(Y(),se("div",p7,[E("div",{ref_key:"containerRef",ref:d,class:"logic-flow-container"},null,512),B(je(c),{"flow-id":f.value},null,8,["flow-id"]),je(i)?(Y(),Fe(GO,{key:0,lf:je(i),onRunTest:R,onAddNode:x},null,8,["lf"])):Qe("",!0),l.value?(Y(),Fe(rP,{key:1,ref_key:"nodeFormDrawerRef",ref:o,open:s.value,"onUpdate:open":ie[0]||(ie[0]=G=>s.value=G),destroyOnClose:!0,"node-id":l.value.id,node:l.value.properties,"node-type":l.value.type,lf:je(i),onUpdateNode:D,onChangeTitle:I},null,8,["open","node-id","node","node-type","lf"])):Qe("",!0)]))}},g7={class:"flex-content-box"},m7={class:"test-model-box"},y7={key:2,class:"input-list-box"},_7={class:"add-btn-box"},b7={key:0,class:"result-list-box loading-box"},x7={key:1,class:"result-list-box"},w7=["onClick"],S7={class:"status-block"},E7={class:"icon-name-box"},C7=["src"],O7={class:"node-name"},k7={key:0,class:"time-tag"},N7={class:"right-active-icon"},M7={class:"save-btn-box"},A7={class:"preview-box"},T7={class:"preview-title"},D7={class:"icon-name-box"},L7=["src"],P7={class:"node-name"},R7={key:0,class:"time-tag"},I7={class:"preview-content-block"},B7={class:"title-block"},j7={class:"preview-code-box"},H7={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object}},emits:["save","getGlobal"],setup(r,{expose:e,emit:t}){const n=r,i=Kt(()=>n.start_node_params.diy_global||[]),o=t,s=Rl().query,l=Ce(!1),d=Ce(""),c=Ce([]),f=Kt(()=>d.value?c.value.filter(F=>F.node_key==d.value)[0]:null),v=Ce(!1),g=Vt({is_draft:!0,robot_key:s.robot_key,question:"",openid:"",global:"",globalState:{}}),y=()=>{o("save","automatic");let F=localStorage.getItem("workflow_run_test_data")||"{}";F=JSON.parse(F),g.question=F.question||"",g.openid=F.openid||"",g.global=F.global||"",c.value=[],d.value="",o("getGlobal"),_n(()=>{i.value.forEach(z=>{g.globalState[z.key]=b(z)});try{let z=F.global?JSON.parse(F.global):{};for(let ie in g.globalState)z[ie]&&(Array.isArray(z[ie])?g.globalState[ie]=z[ie].map(G=>({value:G,key:Math.random()*1e3})):g.globalState[ie]=z[ie])}catch(z){}}),l.value=!0};function b(F){return F.typ=="string"||F.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function _(){let F={};return i.value.forEach(z=>{if(z.typ=="string"&&(F[z.key]=g.globalState[z.key]),z.typ=="number"&&(F[z.key]=g.globalState[z.key]?+g.globalState[z.key]:""),z.typ=="array<string>"){let ie=g.globalState[z.key].map(G=>G.value).filter(G=>G);F[z.key]=ie}}),JSON.stringify(F)}const x=(F,z)=>{g.globalState[F].splice(z,1)},w=F=>{g.globalState[F].push({value:"",key:Math.random()*1e4})},C=Ce(null),k=()=>{C.value.validate().then(()=>{let F={...g};F.global=_(),delete F.globalState,v.value=!0,c.value=[],localStorage.setItem("workflow_run_test_data",JSON.stringify({...F})),XE({...F}).then(z=>{no.success("测试结果生成完成"),D(z.data||[])}).catch(z=>{c.value=[],z.data&&z.data.length&&D(z.data)}).finally(()=>{v.value=!1})})},D=F=>{var z;c.value=F.map(ie=>({...ie,is_success:ie.error_msg==="<nil>",node_icon:jC(ie.node_type)})),d.value=(z=c.value[0])==null?void 0:z.node_key},I=F=>{d.value=F.node_key},$=()=>{WE(JSON.stringify(f.value.output)),no.success("复制成功")};return e({open:()=>{y()}}),(F,z)=>{const ie=i_,G=fs,Q=Sr,T=Wi,W=Ui,P=aa,le=In,me=Oi,he=Jy,Ne=ii;return Y(),se("div",null,[B(Ne,{open:l.value,"onUpdate:open":z[2]||(z[2]=ye=>l.value=ye),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:V(()=>[E("div",g7,[E("div",m7,[z[9]||(z[9]=E("div",{class:"top-title"},"开始节点参数",-1)),B(me,{model:g,ref_key:"formRef",ref:C,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:V(()=>[B(T,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:V(()=>[B(G,{gap:4},{default:V(()=>[z[4]||(z[4]=He("question ")),B(ie,{style:{margin:"0"}},{default:V(()=>z[3]||(z[3]=[He("string")])),_:1,__:[3]})]),_:1,__:[4]})]),default:V(()=>[B(Q,{placeholder:"请输入",value:g.question,"onUpdate:value":z[0]||(z[0]=ye=>g.question=ye)},null,8,["value"])]),_:1}),B(T,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:V(()=>[B(G,{gap:4},{default:V(()=>[z[6]||(z[6]=He("openid ")),B(ie,{style:{margin:"0"}},{default:V(()=>z[5]||(z[5]=[He("string")])),_:1,__:[5]})]),_:1,__:[6]})]),default:V(()=>[B(Q,{placeholder:"请输入",value:g.openid,"onUpdate:value":z[1]||(z[1]=ye=>g.openid=ye)},null,8,["value"])]),_:1}),(Y(!0),se(it,null,ft(i.value,ye=>(Y(),Fe(T,{name:["globalState",ye.key],key:ye.key,rules:[{required:ye.required,message:`请输入${ye.key}`}]},{label:V(()=>[B(G,{gap:4},{default:V(()=>[He(De(ye.key)+" ",1),B(ie,{style:{margin:"0"}},{default:V(()=>[He(De(ye.typ),1)]),_:2},1024)]),_:2},1024)]),default:V(()=>[ye.typ=="string"?(Y(),Fe(Q,{key:0,placeholder:"请输入",value:g.globalState[ye.key],"onUpdate:value":ae=>g.globalState[ye.key]=ae},null,8,["value","onUpdate:value"])):Qe("",!0),ye.typ=="number"?(Y(),Fe(W,{key:1,style:{width:"100%"},placeholder:"请输入",value:g.globalState[ye.key],"onUpdate:value":ae=>g.globalState[ye.key]=ae},null,8,["value","onUpdate:value"])):Qe("",!0),ye.typ=="array<string>"?(Y(),se("div",y7,[(Y(!0),se(it,null,ft(g.globalState[ye.key],(ae,Re)=>(Y(),se("div",{class:"input-list-item",key:Re},[B(P,null,{default:V(()=>[B(Q,{placeholder:"请输入",value:ae.value,"onUpdate:value":Le=>ae.value=Le},null,8,["value","onUpdate:value"])]),_:2},1024),g.globalState[ye.key].length>1?(Y(),Fe(je(cr),{key:0,onClick:Le=>x(ye.key,Re)},null,8,["onClick"])):Qe("",!0)]))),128)),E("div",_7,[B(le,{onClick:ae=>w(ye.key),block:"",type:"dashed"},{default:V(()=>z[7]||(z[7]=[He("添加")])),_:2,__:[7]},1032,["onClick"])])])):Qe("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),v.value?(Y(),se("div",b7,[v.value?(Y(),Fe(he,{key:0,tip:"测试结果生成中..."})):Qe("",!0)])):Qe("",!0),c.value.length>0?(Y(),se("div",x7,[(Y(!0),se(it,null,ft(c.value,(ye,ae)=>(Y(),se("div",{class:wn(["list-item-block",{active:d.value==ye.node_key}]),onClick:Re=>I(ye),key:ae},[E("div",S7,[ye.is_success?(Y(),Fe(je(o_),{key:0,style:{color:"#138b1b"}})):(Y(),Fe(je(SC),{key:1,style:{color:"#d81e06"}}))]),E("div",E7,[E("img",{src:ye.node_icon,alt:""},null,8,C7),E("div",O7,De(ye.node_name),1)]),ye.is_success?(Y(),se("div",k7,De(ye.use_time)+"ms",1)):Qe("",!0),E("div",N7,[B(je(EC))])],10,w7))),128))])):Qe("",!0),E("div",M7,[B(le,{loading:v.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:V(()=>[B(je(Gy)),z[8]||(z[8]=He("运行测试"))]),_:1,__:[8]},8,["loading"])])]),E("div",A7,[f.value?(Y(),se(it,{key:0},[E("div",T7,[z[10]||(z[10]=E("div",{class:"title-text"},"日志详情",-1)),E("div",D7,[E("img",{src:f.value.node_icon,alt:""},null,8,L7),E("div",P7,De(f.value.node_name),1)]),f.value.is_success?(Y(),se("div",R7,De(f.value.use_time)+"ms",1)):Qe("",!0)]),E("div",I7,[E("div",B7,[z[11]||(z[11]=He("运行日志")),B(je(CC),{onClick:$})]),E("div",j7,[B(je(BC),{data:f.value.output},null,8,["data"])])])],64)):Qe("",!0)])])]),_:1},8,["open"])])}}},$7=pt(H7,[["__scopeId","data-v-011a310b"]]),F7={class:"page-header"},z7={class:"header-content"},W7={key:1,class:"robot-status-box status-0"},U7={key:0,class:"header-right"},V7={key:0,class:"last-save-time"},X7={__name:"page-header",props:{saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(r,{expose:e,emit:t}){const n=ri(),i=Kt(()=>n.robotInfo),o=Kt(()=>n.draftSaveTime);Uy();const s=t,l=r,d=Ce(null),c=()=>{s("edit")},f=(_="handle")=>{s("save",_)},v=()=>{s("release")},g=()=>{s("getGlobal")},y=()=>{s("getVersionRecord")};return e({openRunTest:()=>{d.value.open()}}),(_,x)=>{const w=In,C=Ci;return Y(),se("div",F7,[E("div",z7,[B(WC),i.value.start_node_key!=""?(Y(),se("div",{key:0,class:"robot-status-box status-1",onClick:c},[B(je(o_),{class:"robot-status-icon"}),x[1]||(x[1]=E("div",{class:"robot-status-text"},"已发布",-1))])):(Y(),se("div",W7,[B(je(OC),{class:"robot-status-icon"}),x[2]||(x[2]=E("div",{class:"robot-status-text"},"未发布",-1))]))]),l.showRight?(Y(),se("div",U7,[r.currentVersion==""?(Y(),se(it,{key:0},[o.value&&o.value.time?(Y(),se("div",V7,De(o.value.time)+" "+De(o.value.type=="handle"?"手动":"自动")+"保存草稿 ",1)):Qe("",!0),B(w,{class:"save-draft",onClick:f},{default:V(()=>x[3]||(x[3]=[He("保存草稿")])),_:1,__:[3]}),B(w,{type:"primary",loading:l.saveLoading,class:"publish-robot",onClick:v},{default:V(()=>x[4]||(x[4]=[He("发布机器人")])),_:1,__:[4]},8,["loading"])],64)):Qe("",!0),B(C,{title:"历史发布详情"},{default:V(()=>[B(w,{onClick:x[0]||(x[0]=k=>y())},{default:V(()=>[B(je(kC))]),_:1})]),_:1})])):Qe("",!0),B($7,{ref_key:"runTestRef",ref:d,start_node_params:r.start_node_params,onGetGlobal:g,onSave:f},null,8,["start_node_params"])])}}},G7=pt(X7,[["__scopeId","data-v-3ea2377d"]]),Y7={class:"form-box"},q7={class:"form-item"},K7={class:"form-content"},J7={class:"version-input-box"},Z7={class:"form-item"},Q7={class:"form-content"},e9={__name:"version-model",emits:["ok"],setup(r,{expose:e,emit:t}){const n=Rl().query,i=Ce(!1);let o="";const s=Ce(""),l=Ce(""),d=Ce(""),c=Ce(""),f=Ce(!1),v=t,g=_=>{b(),c.value="",o=_,i.value=!0},y=()=>{f.value=!0,YE({robot_key:n.robot_key,node_list:o,version:`${s.value}.${l.value}.${d.value}`,version_desc:c.value}).then(_=>{i.value=!1,_&&_.res==0&&(no.success("发布成功"),v("ok"))}).finally(()=>{f.value=!1})},b=()=>{GE({robot_key:n.robot_key}).then(_=>{let x=_.data.version_params||[];s.value=x[0],l.value=x[1],d.value=x[2]})};return e({show:g}),(_,x)=>{const w=Ui,C=Kd,k=ii;return Y(),se("div",null,[B(k,{open:i.value,"onUpdate:open":x[4]||(x[4]=D=>i.value=D),title:"发布","ok-text":"立即发布",onOk:y,confirmLoading:f.value,width:600},{default:V(()=>[E("div",Y7,[E("div",q7,[x[8]||(x[8]=E("div",{class:"form-label"},"版本号：",-1)),E("div",K7,[E("div",J7,[x[5]||(x[5]=He(" v ")),B(w,{value:s.value,"onUpdate:value":x[0]||(x[0]=D=>s.value=D),precision:0,min:0,max:1e3},null,8,["value"]),x[6]||(x[6]=E("span",null,".",-1)),B(w,{value:l.value,"onUpdate:value":x[1]||(x[1]=D=>l.value=D),precision:0,min:0,max:1e3},null,8,["value"]),x[7]||(x[7]=E("span",null,".",-1)),B(w,{value:d.value,"onUpdate:value":x[2]||(x[2]=D=>d.value=D),precision:0,min:0,max:1e3},null,8,["value"])])])]),E("div",Z7,[x[9]||(x[9]=E("div",{class:"form-label"},"版本描述：",-1)),E("div",Q7,[B(C,{value:c.value,"onUpdate:value":x[3]||(x[3]=D=>c.value=D),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},t9=pt(e9,[["__scopeId","data-v-ab469fca"]]),n9={class:"version-detail"},r9={key:0,class:"version-desc"},i9=["onClick"],o9={class:"version-header"},a9={class:"version-title"},s9={class:"time-text"},l9={class:"version-desc"},u9={__name:"publish-detail",emits:["setVersion","preview"],setup(r,{expose:e,emit:t}){const n=Rl().query,i=Ce(!1),o=t,s=ri(),l=Kt(()=>s.draftSaveTime),d=Ce([]),c=()=>{i.value=!0,f()},f=()=>{qE({robot_key:n.robot_key}).then(b=>{d.value=b.data.versions||[]})},v=b=>{ii.confirm({title:`确定要恢复到v${b.version}版吗`,icon:null,content:Dn("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){sg({robot_key:n.robot_key,version_id:b.version_id}).then(_=>{o("setVersion",_.data),i.value=!1,no.success("设置成功")})},onCancel(){}})},g=b=>{b==""?Wy({robot_key:n.robot_key,data_type:1}).then(_=>{o("preview",_.data,b),i.value=!1}):sg({robot_key:n.robot_key,version_id:b}).then(_=>{o("preview",_.data,b),i.value=!1})};function y(b){return b<=0?"--":a_(b*1e3).format("YYYY-MM-DD HH:mm:ss")}return e({showDrawer:c}),(b,_)=>{const x=Lh,w=Dh,C=Ph,k=MC;return Y(),se("div",null,[B(k,{open:i.value,"onUpdate:open":_[2]||(_[2]=D=>i.value=D),title:"发布详情",placement:"right",width:400},{default:V(()=>[E("div",n9,[E("div",{class:"version-list",onClick:_[0]||(_[0]=D=>g(""))},[_[3]||(_[3]=E("div",{class:"version-header"},[E("div",{class:"version-title"},"当前版本")],-1)),l.value&&l.value.time?(Y(),se("div",r9," 最近保存于"+De(l.value.time),1)):Qe("",!0)]),(Y(!0),se(it,null,ft(d.value,(D,I)=>(Y(),se("div",{class:"version-list",onClick:$=>g(D.version_id),key:D.version},[E("div",o9,[E("div",a9,[He(" v"+De(D.version)+" ",1),E("span",s9,De(y(D.create_time)),1)]),B(C,null,{overlay:V(()=>[B(w,null,{default:V(()=>[B(x,{onClick:$=>v(D)},{default:V(()=>_[4]||(_[4]=[He(" 恢复到此版本 ")])),_:2,__:[4]},1032,["onClick"])]),_:2},1024)]),default:V(()=>[E("div",{class:"hover-btn-box",onClick:_[1]||(_[1]=dn(()=>{},["stop"]))},[B(je(NC))])]),_:2},1024)]),E("div",l9,De(D.version_desc),1)],8,i9))),128))])]),_:1},8,["open"])])}}},d9=pt(u9,[["__scopeId","data-v-d2b76917"]]),c9={class:"workflow-page"},f9={class:"page-body"},h9={class:"page-left"},p9={class:"page-container"},v9={__name:"index",setup(r){const e=Rl(),t=Ce(e.query.robot_key),n=Ce(null),i=Ce(null),o=ri(),s=Ce(""),l=Ce(null),d=HC();function c(le){le=le||[];let me=[],he=[];le.forEach(Ne=>{if(Ne.node_type==0){let ye=JSON.parse(Ne.node_info_json);he.push(ye)}else{const ye=d[Ne.node_type];if(Ne.type=ye,Ne.node_type==1){let Re=JSON.parse(Ne.node_params);Re.start||(Re.start=[]),Ne.node_params=JSON.stringify(Re)}let ae=JSON.parse(Ne.node_info_json);Ne.node_type!=0&&(ae.type=d[Ne.node_type],ae.id=Ne.node_key||Pl(ae.type),ae.x=ae.x||0,ae.y=ae.y||0),Ne.node_type==-1&&(Ne.node_params=ae.dataRaw),ae.nodeSortKey?Ne.nodeSortKey=ae.nodeSortKey:Ne.nodeSortKey=ae.id.substring(0,8)+ae.id.substring(ae.id.length-8),Ne.dataRaw=ae.dataRaw||Ne.node_params,delete Ne.node_info_json,ae.properties=Ne,ae.properties.width=ae.width,ae.properties.height=ae.height,me.push(ae)}}),v({nodes:me,edges:he})}const f=le=>{n.value.open(le,!0)},v=le=>{i.value.setData(le)},g=()=>{let le=i.value.getData(),me=[],he={};return le.edges.forEach(Ne=>{let ye={node_key:Ne.id,node_name:"edge",node_type:0},ae={...Ne};ye.node_info_json=ae,me.push(ye),Ne.sourceAnchorId&&(he[Ne.sourceAnchorId]=Ne.targetNodeId),Ne.targetAnchorId&&(he[Ne.targetAnchorId]=Ne.sourceNodeId)}),le.nodes.forEach(Ne=>{let ye={...Ne.properties,node_type:+Ne.properties.node_type,node_key:Ne.id};ye.node_info_json={type:Ne.type,x:Ne.x,y:Ne.y,width:Ne.properties.width,height:Ne.properties.height,id:Ne.id,nodeSortKey:ye.nodeSortKey,dataRaw:Ne.properties.node_params},ye.next_node_key=he[ye.nodeSortKey+"-anchor_right"]||"",ye.prev_node_key=he[ye.nodeSortKey+"-anchor_left"]||"";let ae=JSON.parse(ye.node_params);if(ye.node_type==2&&ae.term&&ae.term.length>0&&ae.term.forEach((Re,Le)=>{let Ve=ye.nodeSortKey+"-anchor_"+Le;Re.next_node_key=he[Ve]||""}),ye.node_type==3&&ae.cate&&ae.cate.categorys&&ae.cate.categorys.length>0&&ae.cate.categorys.forEach((Re,Le)=>{let Ve=ye.nodeSortKey+"-anchor_"+Le;Re.next_node_key=he[Ve]||""}),ye.node_type==17){let Re=he[ye.nodeSortKey+"-anchor_right_exception"];Re&&(ae.code_run.exception=Re)}ye.node_params=ae,delete ye.dataRaw,me.push(ye)}),me},y=le=>{let me=g();lg({robot_key:t.value,data_type:1,node_list:JSON.stringify(me)}).then(()=>{le=="handle"&&no.success("保存成功"),o.setDrafSaveTime({type:le,time:a_().format("MM/DD HH:mm:ss")})})},b=()=>{f(1)};let _=null;const x=()=>{_=setInterval(()=>{y("automatic")},1*60*1e3)};nC(()=>{_&&clearInterval(_)});const w=Ce(null),C=Ce(!1),k=le=>{w.value.show(le)},D=async()=>{let le=g(),me=[];for(let he=0;he<le.length;he++){let Ne=le[he];Ne.node_type==0||Ne.node_type==-1||(Ne.node_type==1?Ne.next_node_key==""&&me.push(Ne):Ne.node_type==7||Ne.node_type==3?Ne.prev_node_key==""&&me.push(Ne):(Ne.next_node_key==""||Ne.prev_node_key=="")&&me.push(Ne))}if(me.length>0){no.error("存在未关联的节点，请先关联");return}try{await lg({robot_key:t.value,data_type:1,node_list:JSON.stringify(le)}),k(JSON.stringify(le))}catch{C.value=!1}},I=Ce(null),$=le=>{I.value=le,le.properties.node_sub_type!=51},R=()=>{},F=async()=>{let le=(me,he,Ne)=>{const ye=new Set(me.map(ae=>ae.model_define));return he.filter(ae=>{let Re=ae[Ne];ye.has(Re)&&me.filter(Le=>{if(Le.model_define==Re)return Le.children=VE(Le.children,ae.children),!1})}),me};return zy({model_type:"LLM"}).then(me=>{let he=me.data||[],Ne=[],ye=[];ye=he.map(ae=>{Ne=[];for(let Re=0;Re<ae.model_info.llm_model_list.length;Re++){const Le=ae.model_info.llm_model_list[Re];Ne.push({name:Le,deployment_name:ae.model_config.deployment_name,show_model_name:ae.model_config.show_model_name,id:ae.model_config.id,model_define:ae.model_info.model_define})}return{id:ae.model_config.id,name:ae.model_info.model_name,model_define:ae.model_info.model_define,icon:ae.model_info.model_icon_url,children:Ne,deployment_name:ae.model_config.deployment_name,show_model_name:ae.model_config.show_model_name}}),ye=le(UE(ye,"model_define"),ye,"model_define"),o.setModelList(ye)})},z=Ce({diy_global:[],sys_global:[]}),ie=()=>{let me=g().filter(he=>he.node_type==1);me.length>0&&(z.value=me[0].node_params.start)},G=Ce(null),Q=()=>{s.value==""&&y("automatic"),G.value.showDrawer()},T=le=>{s.value="",clearInterval(_),x(),c(le),y("automatic")},W=(le,me)=>{s.value=me,clearInterval(_),c(le)},P=()=>{l.value.openRunTest()};return Xt(async()=>{await F();const le=await Wy({robot_key:t.value,data_type:1});c(le.data),x(),e.query.show_tips&&no.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)}),(le,me)=>(Y(),se("div",c9,[B(G7,{ref_key:"pageHeaderRef",ref:l,onEdit:b,onSave:y,onRelease:D,onGetGlobal:ie,onGetVersionRecord:Q,currentVersion:s.value,start_node_params:z.value,saveLoading:C.value},null,8,["currentVersion","start_node_params","saveLoading"]),E("div",f9,[E("div",h9,[B(JC)]),E("div",p9,[B(v7,{ref_key:"workflowCanvasRef",ref:i,onSelectedNode:$,onDeleteNode:R,onRunTest:P},null,512)])]),B(UC,{ref_key:"addRobotAlertRef",ref:n},null,512),B(t9,{ref_key:"versionModelRef",ref:w},null,512),B(d9,{ref_key:"publishDetailRef",ref:G,onPreview:W,onSetVersion:T},null,512)]))}},wz=pt(v9,[["__scopeId","data-v-69edccb3"]]);export{wz as default};
