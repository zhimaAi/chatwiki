import{w as L}from"./index-DM5bNlEU.js";import{_ as F,a4 as V,j as G}from"../../index-C5-B0r5-.js";import{aw as O,f,e as J,r as U,ae as S,ad as _,ar as i,as as o,k as s,ac as m,az as h,G as k,F as z,ax as K,ai as j,u as g,at as q,o as H}from"./vue-chunks-CGLjTDrY.js";import{e as E,I as P,T as Q,as as X,F as A,ai as W,aR as Z,aS as ee,aM as te,M as oe,b as se,d as N,X as ae,G as ne,a0 as R}from"./ui-antd-B11sc9DP.js";import{P as le}from"./styles-B3AMWjFt.js";import{dN as ie}from"./util-BZzWiL8k.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./thirdMcp-DUEdPcdt.js";import"./index-y6Ut8zwU.js";const de={class:"flex-content-box"},re={class:"test-model-box"},ue={key:0,class:"result-list-box"},_e=["onClick"],ce={class:"status-block"},pe={class:"icon-name-box"},ve=["src"],me={class:"node-name"},ge={key:0,class:"time-tag"},fe={class:"right-active-icon"},ye={class:"preview-box"},ke={class:"preview-title"},he={class:"icon-name-box"},xe=["src"],be={class:"node-name"},we={key:0,class:"time-tag"},Ce={class:"preview-content-block"},qe={class:"title-block"},De={class:"preview-code-box"},Ye={__name:"logs-detail",emits:["save","getGlobal"],setup(T,{expose:D,emit:$}){const x=O().query,d=f(!1),c=f(""),t=f([]),p=J(()=>c.value?t.value.filter(u=>u.node_key==c.value)[0]:null),r=U({robot_key:x.robot_key,question:"",openid:""}),Y=u=>{r.question=u.question||"",r.openid=u.openid||"",t.value=[],c.value="",b(u.node_logs),d.value=!0},b=u=>{var e;t.value=u.map(a=>({...a,is_success:a.error_msg==="<nil>",node_icon:ie(a.node_type)})),c.value=(e=t.value[0])==null?void 0:e.node_key},w=u=>{c.value=u.node_key},M=()=>{V(JSON.stringify(p.value.output)),se.success("复制成功")};return D({show:Y}),(u,e)=>{const a=X,n=Q,y=P,C=E,v=A,I=oe;return _(),S(I,{open:d.value,"onUpdate:open":e[2]||(e[2]=l=>d.value=l),title:"日志详情",footer:null,width:880,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:i(()=>[o("div",de,[o("div",re,[e[7]||(e[7]=o("div",{class:"top-title"},"开始节点参数",-1)),s(v,{model:r,ref:"formRef",layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:i(()=>[s(C,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:i(()=>[s(n,{gap:4},{default:i(()=>[e[4]||(e[4]=k("question ",-1)),s(a,{style:{margin:"0"}},{default:i(()=>[...e[3]||(e[3]=[k("string",-1)])]),_:1})]),_:1})]),default:i(()=>[s(y,{readonly:"",placeholder:"请输入",value:r.question,"onUpdate:value":e[0]||(e[0]=l=>r.question=l)},null,8,["value"])]),_:1}),s(C,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:i(()=>[s(n,{gap:4},{default:i(()=>[e[6]||(e[6]=k("openid ",-1)),s(a,{style:{margin:"0"}},{default:i(()=>[...e[5]||(e[5]=[k("string",-1)])]),_:1})]),_:1})]),default:i(()=>[s(y,{readonly:"",placeholder:"请输入",value:r.openid,"onUpdate:value":e[1]||(e[1]=l=>r.openid=l)},null,8,["value"])]),_:1})]),_:1},8,["model"]),t.value.length>0?(_(),m("div",ue,[(_(!0),m(z,null,K(t.value,(l,B)=>(_(),m("div",{class:j(["list-item-block",{active:c.value==l.node_key}]),onClick:Fe=>w(l),key:B},[o("div",ce,[l.is_success?(_(),S(g(W),{key:0,style:{color:"#138b1b"}})):(_(),S(g(Z),{key:1,style:{color:"#d81e06"}}))]),o("div",pe,[o("img",{src:l.node_icon,alt:""},null,8,ve),o("div",me,q(l.node_name),1)]),l.is_success?(_(),m("div",ge,q(l.use_time)+"ms",1)):h("",!0),o("div",fe,[s(g(ee))])],10,_e))),128))])):h("",!0)]),o("div",ye,[p.value?(_(),m(z,{key:0},[o("div",ke,[e[8]||(e[8]=o("div",{class:"title-text"},"日志详情",-1)),o("div",he,[o("img",{src:p.value.node_icon,alt:""},null,8,xe),o("div",be,q(p.value.node_name),1)]),p.value.is_success?(_(),m("div",we,q(p.value.use_time)+"ms",1)):h("",!0)]),o("div",Ce,[o("div",qe,[e[9]||(e[9]=k("运行日志",-1)),s(g(te),{onClick:M})]),o("div",De,[s(g(le),{data:p.value.output},null,8,["data"])])])],64)):h("",!0)])])]),_:1},8,["open"])}}},Me=F(Ye,[["__scopeId","data-v-9ba79c48"]]),Ie={class:"user-model-page"},Se={class:"list-wrapper"},Ne={class:"content-wrapper"},$e={class:"search-block"},ze=["onClick"],Re={__name:"index",setup(T){const D=O().query,$=G(),x=f([]),d=f([N().subtract(6,"day"),N()]),c=f(!1),t=U({robot_id:D.id,page:1,size:20,total:0,openid:"",question:"",start_date:d.value[0].format("YYYY-MM-DD"),end_date:d.value[1].format("YYYY-MM-DD")}),p=e=>{t.page=e.current,t.size=e.pageSize,b()},r=()=>{t.page=1,b()},Y=e=>{t.start_date="",t.end_date="",d.value&&d.value.length>0&&(t.start_date=d.value[0].format("YYYY-MM-DD"),t.end_date=d.value[1].format("YYYY-MM-DD")),r()},b=()=>{c.value=!0,L({...t}).then(e=>{let a=e.data.list||[];x.value=a.map(n=>(n.duration_mills_desc=`${n.duration_mills}ms`,n.total_token_desc=`${(n.total_token/1e3).toFixed(3)}`,n.create_time_desc=N(n.create_time*1e3).format("YYYY-MM-DD HH:mm:ss"),n.node_logs=n.node_logs?JSON.parse(n.node_logs):[],n)),t.total=+e.data.total||0}).finally(()=>{c.value=!1})},w=f(null),M=e=>{w.value.show({...e})},u=[{title:"openid",dataIndex:"openid",key:"openid",width:150},{title:"question",dataIndex:"question",key:"question",width:250},{title:"工作流版本",key:"version",dataIndex:"version",width:130},{title:"耗时",key:"duration_mills_desc",dataIndex:"duration_mills_desc",width:130},{title:"token消耗（K）",key:"total_token_desc",dataIndex:"total_token_desc",width:130},{title:"调用时间",key:"create_time_desc",dataIndex:"create_time_desc",width:150},{title:"操作",key:"action",width:100}];return H(()=>{r()}),(e,a)=>{const n=ae,y=P,C=ne;return _(),m("div",Ie,[a[3]||(a[3]=o("div",{class:"page-title"},"调用日志",-1)),o("div",Se,[o("div",Ne,[o("div",$e,[s(n,{value:d.value,"onUpdate:value":a[0]||(a[0]=v=>d.value=v),allowClear:!1,onChange:Y,style:{width:"256px"},presets:g($)},null,8,["value","presets"]),s(y,{style:{width:"256px"},value:t.openid,"onUpdate:value":a[1]||(a[1]=v=>t.openid=v),onChange:r,placeholder:"请输入openid"},{suffix:i(()=>[s(g(R))]),_:1},8,["value"]),s(y,{style:{width:"256px"},value:t.question,"onUpdate:value":a[2]||(a[2]=v=>t.question=v),onChange:r,placeholder:"请输入问题"},{suffix:i(()=>[s(g(R))]),_:1},8,["value"])]),s(C,{class:"table-list",columns:u,"data-source":x.value,loading:c.value,sticky:"",pagination:{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:p},{bodyCell:i(({column:v,record:I})=>[v.key==="action"?(_(),m("a",{key:0,onClick:l=>M(I)},"查看明细",8,ze)):h("",!0)]),_:1},8,["data-source","loading","pagination"])]),s(Me,{ref_key:"logsDetailRef",ref:w},null,512)])])}}},He=F(Re,[["__scopeId","data-v-f1b4f5ab"]]);export{He as default};
