import{u as Pe,_ as Ye,bG as Sn,b0 as Pt,aB as Ft,a$ as zt,aC as Dt,aO as wn,aD as xn,bw as Nt,bL as $n,bx as Cn,by as qn,bA as Ln,bM as On,c as Ht,bN as En,d as Mn,bO as In,aH as Mt,bP as Tn,bQ as Rn,bz as Pn}from"../../index-DSFcP5NQ.js";import{a as y,b as r,p as s,v as u,u as l,y as t,t as i,r as p,E as Oe,j as je,q as J,F as fe,l as xe,i as Qe,ah as Ge,c as ke,J as At,V as it,_ as O,n as Ae,Y as ye,h as rt,z as ct,e as G,ag as Bt,x as Fn}from"./vue-chunks-BdaA73Wf.js";import{_ as zn}from"./empty-CzGZrENG.js";import{_ as Le}from"./emoji-mart-BBMRoEa3.js";import{a1 as Ut,B as Jt,at as Dn,ag as Ve,M as be,a0 as Nn,O as Re,q as et,a4 as Hn,b0 as Ke,b1 as jt,f as _t,g as ut,ah as Gt,i as dt,au as Vt,a6 as Wt,b as ve,F as An,c as Bn,u as Zt,v as Qt,w as Un,b5 as Jn,ad as jn,aO as Gn,x as Vn,j as Wn,e as Zn,b9 as Qn,r as Kn,Z as Xn,k as Yn,I as ea,D as It,T as ta,$ as na}from"./ui-antd-Dl1wwwCD.js";import{C as Kt,S as aa}from"./classification-mark-modal-hssoOOCi.js";import{h as oa,Z as sa,P as la,H as ia,C as ra}from"./neo4j-MWxXN7EM.js";import{Z as ca,C as _a}from"./cu-scroll-Tp3oWL3G.js";import{c as Xe,E as ua}from"./edit-subsection-BwSyKVRx.js";import{u as da}from"./useMathJax-6Oa0Io1D.js";import{_ as Je}from"./cu-scroll-CpIj948h.js";import{R as pa,M as ma}from"./rename-modal-WfG-X_fj.js";import{V as Tt}from"./vue-pdf-embed-C94fDaAA.js";import{S as fa,a as ga,D as ha,E as va}from"./edit-fragment-alert-D8mTY6SS.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./editor-cherry-CFIsbKoN.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./index-XVLbk3qE.js";import"./index-B_UHbFfL.js";import"./model-select-CMPvMrAQ.js";import"./index-MT9fcN3v.js";import"./editor-code-DlsHKXTn.js";const ka={class:"empty-box"},ya={class:"title"},ba={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(ce,{emit:n}){const{t:z}=Pe("views.library.library-preview.components.empty"),o=n,q=()=>{o("openEditSubscription",{})};return(g,c)=>{const x=Jt;return r(),y("div",ka,[c[0]||(c[0]=s("img",{src:zn,alt:""},null,-1)),s("div",ya,u(l(z)("msg_empty")),1),s("div",null,[t(x,{type:"primary",onClick:q},{icon:i(()=>[t(l(Ut))]),default:i(()=>[s("span",null,u(l(z)("btn_add_segment")),1)]),_:1})])])}}},lt=Le(ba,[["__scopeId","data-v-be1a7f4f"]]),Sa={class:"chart-wrapper"},wa={class:"zoom-toolbar-wrapper"},xa={__name:"chart-box",emits:["nodeClick"],setup(ce,{expose:n,emit:z}){const o=z,q=p(null);let g=null;const c=Oe({nodes:[],edges:[]}),x=p(1),j={},V=()=>{g&&g.destroy();const C={layout:"forceDirected",initialZoom:x.value,disableTelemetry:!0,maxZoom:10,minZoom:.1,minimapContainer:document.getElementById("chatMap"),styling:{minimapViewportBoxColor:"#4399FF",selectedBorderColor:"rgba(255, 255, 255, 1)"}},h=document.getElementById("chartBox");g=new oa(h,c.nodes,c.edges,C,j);const te=new sa(g);new la(g),te.updateCallback("onZoom",_=>{x.value=Number(_.toFixed(1))}),new ia(g,{drawShadowOnHover:!0}),new ra(g,{selectOnClick:!0}).updateCallback("onNodeClick",_=>{o("nodeClick",_)})},W=C=>{x.value=C,g&&g.setZoom(C)},D=({nodes:C,edges:h})=>{c.nodes=[c.nodes,...C],c.edges=[c.edges,...h],g&&g.addElementsToGraph(C,h)},P=({nodes:C,edges:h})=>{c.nodes=[c.nodes,...C],c.edges=[c.edges,...h],g&&g.addAndUpdateElementsInGraph(C,h)},N=({nodes:C,edges:h})=>{c.nodes=C,c.edges=h,g&&g.updateElementsInGraph(C,h)},S=()=>{g&&g.destroy()},T=({nodes:C,edges:h})=>{c.nodes=C,c.edges=h,V()};return je(()=>{}),n({render:T,add:D,addAndUpdate:P,update:N,destroy:S}),(C,h)=>(r(),y("div",Sa,[s("div",{class:"chart",id:"chartBox",ref_key:"chartBox",ref:q},null,512),h[0]||(h[0]=s("div",{class:"chart-mini-map",id:"chatMap"},null,-1)),s("div",wa,[t(ca,{value:x.value,onChange:W},null,8,["value"])])]))}},$a=Le(xa,[["__scopeId","data-v-f0ead6c0"]]),Ca={key:0,class:"popup-wrapper entity-details-wrapper"},qa={class:"popup-header"},La={key:0,class:"popup-body"},Oa={class:"popup-content"},Ea={class:"entity-details"},Ma={class:"entity-item"},Ia={class:"entity-name"},Ta={class:"entity-item",style:{"margin-bottom":"8px"}},Ra={class:"file-info"},Pa={class:"file-name"},Fa={class:"entity-item"},za={class:"doc-item"},Da={class:"fragment-content"},Na={class:"entity-item"},Ha={key:0,class:""},Aa={class:"fragment-content"},Ba={__name:"entity-details",setup(ce,{expose:n}){const z=Oe({show:!1,node:null,fromNodes:[]}),o=()=>{z.show=!1};return n({open:(g,c)=>{z.node=g,z.fromNodes=c,z.show?(z.show=!1,Qe(()=>{z.show=!0})):z.show=!0},close:o}),(g,c)=>{const x=Ye;return z.show?(r(),y("div",Ca,[s("div",qa,[c[0]||(c[0]=s("div",{class:"popup-title"},"实体详情",-1)),t(l(Dn),{class:"close-btn",onClick:o})]),z.node?(r(),y("div",La,[t(_a,null,{default:i(()=>[s("div",Oa,[s("div",Ea,[s("div",Ma,[c[1]||(c[1]=s("div",{class:"entity-item-header"},[s("div",{class:"entity-item-label"},"实体")],-1)),s("div",Ia,u(z.node.name),1)]),s("div",Ta,[c[2]||(c[2]=s("div",{class:"entity-item-header"},[s("div",{class:"entity-item-label"},"归属文档")],-1)),s("div",Ra,[t(x,{class:"file-icon",name:"doc-file",style:{}}),s("span",Pa,u(z.node.file_name),1)])]),s("div",Fa,[c[3]||(c[3]=s("div",{class:"entity-item-header"},[s("div",{class:"entity-item-label"},"分段")],-1)),s("div",null,[s("div",za,[s("div",Da,u(z.node.content),1)])])]),s("div",Na,[c[4]||(c[4]=s("div",{class:"entity-item-header"},[s("div",{class:"entity-item-label"},"子图")],-1)),s("div",null,[z.fromNodes.length==0?(r(),y("div",Ha,"无")):J("",!0),(r(!0),y(fe,null,xe(z.fromNodes,j=>(r(),y("div",{class:"subgraph-item",key:j.id},[s("div",Aa,u(j.name),1)]))),128))])])])])]),_:1})])):J("",!0)])):J("",!0)}}},Ua=Le(Ba,[["__scopeId","data-v-bb7b1011"]]),Ja={class:"graph-model-body"},ja={key:0,class:"loading-wrapper"},Ga={class:"right-box"},Va={__name:"index",setup(ce,{expose:n}){const z=p(!1),o=p(null),q=p(null),g=p(null),c=p(!1),x=Oe({file_id:"",data_id:""}),j=Oe({edges:[],nodes:[]});let V={};const W=()=>{D()},D=()=>{c.value=!0,Sn({file_id:x.file_id,data_id:x.data_id,search_term:x.search_term}).then(C=>{c.value=!1;let h=C.data.edges||[],te=C.data.nodes||[];const $=new Map;h=h.filter(b=>{const _e=`${b.from_id}_${b.to_id}`,ge=`${b.to_id}_${b.from_id}`;return $.has(_e)||$.has(ge)?!1:($.set(_e,!0),!0)}),h.forEach(b=>{b.id=b.id.toString(),b.from=b.from_id.toString(),b.to=b.to_id.toString(),b.caption=b.label});const _=new Set(h.map(b=>b.from)),ne=new Set(h.map(b=>b.to));te.forEach(b=>{b.caption=b.name,b.id=b.id.toString(),b.nodeType=_.has(b.id)&&ne.has(b.id)?"both":_.has(b.id)?"from":ne.has(b.id)?"to":"normal",b.nodeType==="from"?(b.size=35,b.color="#FFB1B2"):b.nodeType==="to"?(b.size=45,b.color="#005AFF"):(b.size=30,b.color="#69E9BE")});let L={edges:h,nodes:te};j.edges=L.edges,j.nodes=L.nodes,setTimeout(()=>{q.value.render(L)},0),V={},h.forEach(b=>{V[b.to]||(V[b.to]=[]),V[b.to].push(b.from)})}).catch(C=>{c.value=!1})},P=C=>{let h=V[C.id]||[],te=[];for(let $=0;$<j.nodes.length;$++)h.indexOf(j.nodes[$].id)>-1&&te.push(j.nodes[$]);g.value.open(C,te)},N=()=>{q.value.destroy(),z.value=!1},S=()=>{z.value=!1};return n({open:C=>{x.file_id=C.file_id,x.data_id=C.id,z.value=!0,setTimeout(()=>{W()},350)}}),(C,h)=>{const te=Ve,$=be;return r(),y("div",{ref_key:"mymodal",ref:o},[t($,{wrapClassName:"graph-model-wrapper",zIndex:99999,centered:"",open:z.value,"onUpdate:open":h[0]||(h[0]=_=>z.value=_),title:"知识图谱",width:"90vw",footer:null,onOk:S,onCancel:N},{default:i(()=>[s("div",Ja,[c.value?(r(),y("div",ja,[t(te)])):J("",!0),t($a,{ref_key:"chartBoxRef",ref:q,loading:c.value,onNodeClick:P},null,8,["loading"]),s("div",Ga,[t(Ua,{ref_key:"entityDetailsRef",ref:g},null,512)])])]),_:1},8,["open"])],512)}}},Wa=Le(Va,[["__scopeId","data-v-56e1b6be"]]),Za={class:"subsection-box-title"},Qa=["onClick"],Ka={class:"top-block"},Xa={class:"title"},Ya={class:"title-block"},eo={class:"status-box"},to={class:"cfb363f"},no={class:"split-err"},ao={key:2},oo={class:"cfb363f"},so={class:"right-opration"},lo={class:"hover-btn-box"},io=["onClick"],ro=["onClick"],co=["onClick"],_o={class:"hover-btn-box"},uo={class:"hover-btn-box"},po=["onClick"],mo=["onClick"],fo={key:0,class:"content-box"},go=["innerHTML"],ho={key:1,class:"content-box"},vo=["innerHTML"],ko=["onMouseup","innerHTML"],yo={key:2,class:"fragment-img"},bo=["src"],So={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},search:{type:String,default:""},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList","handleSplit","handleSplitNext","handleSplitUp","handleSplitDelete","handleSegmentation"],setup(ce,{expose:n,emit:z}){const{t:o}=Pe("views.library.library-preview.components.subsection-box"),q=Ge(),g=z,c=ce,{renderMath:x}=da(),j=(d,f)=>{let{id:K,title:I,content:de,question:Y,answer:U,images:ee,category_id:v}=d,ie=d.similar_questions||[];be.confirm({title:o("re_convert_confirm_title"),icon:null,content:o("re_convert_confirm_content",{index:f+1}),onOk(){return new Promise(A=>{zt({id:K,title:I,content:de,question:Y,answer:U,images:ee,category_id:v,similar_questions:JSON.stringify(ie)}).then(()=>{g("handleConvert",d),A()}).catch(()=>{A()})})},onCancel(){}})},V=d=>{g("openEditSubscription",d)},W=d=>{be.confirm({title:o("confirm_delete_title"),icon:t(Re),content:o("confirm_delete_content"),onOk(){return new Promise(f=>{Dt({id:d}).then(()=>{ve.success(o("delete_success")),g("handleDelParagraph",d),f()}).catch(()=>{f()})})},onCancel(){}})},D=(d,f,K)=>{window.getSelection().toString().trim()||(g("handleScrollTargetPage",{page_num:d.page_num,index:f}),Me(K))},P=d=>{g("handleSegmentation",d)},N=p([]),S=()=>{let d={file_id:q.query.id};Pt(d).then(f=>{N.value=f.data||[],g("getStatrList",f.data||[])})};S();const T=p(null),C=()=>{T.value.show()},h=d=>{var K;let f=(K=N.value.filter(I=>I.id==d.category_id)[0])==null?void 0:K.type;return f?Xe[f]:""},te=(d,f={})=>{Ft({id:d.id,category_id:f.id||0}).then(()=>{ve.success(o("set_success")),d.category_id=f.id,S()})},$=p(null),_=d=>{$.value.open(d)},ne=p(null),L=p(!1),b=p({x:0,y:0}),_e=p(""),ge=p(null),re=p({text:"",parentIndex:-1,originalHtml:""}),he=ke(()=>{if(!L.value)return{};const d=162;let f=b.value.x,K=b.value.y;const I=ne.value.getBoundingClientRect(),de=window.innerWidth;f<10?f=10:f+d>de-50&&(f=de-d-50);const Y=f-I.left,U=K;return{left:`${Y}px`,top:`${U}px`}}),Z=(d,f)=>{setTimeout(()=>{const K=window.getSelection(),I=K.toString().trim();if(I){d.stopPropagation(),re.value={text:I,parentIndex:f,originalHtml:c.paragraphLists[f].content},_e.value=I,ge.value=K.getRangeAt(0).cloneRange();const Y=K.getRangeAt(0).getBoundingClientRect(),U=ne.value.getBoundingClientRect();b.value={x:Y.left+Y.width/2,y:Y.top-U.top-50},L.value=!0}else L.value=!1},50)},R=d=>{const{parentIndex:f}=re.value;switch(d){case"separate":ue(f);break;case"merge-next":Ee(f);break;case"merge-prev":H(f);break;case"delete":$e(f);break}L.value=!1,window.getSelection().removeAllRanges()},Q=(d,f,K)=>{if(f===0&&K===d.textContent.length&&d.textContent.trim().length>0)return["",d.innerHTML,""];const de=document.createTreeWalker(d,NodeFilter.SHOW_TEXT);let Y,U=0,ee,v,ie,A;for(;Y=de.nextNode();){const oe=Y.nodeValue.length;if(!ee&&U+oe>=f&&(ee=Y,ie=f-U),!v&&U+oe>=K){v=Y,A=K-U;break}U+=oe}const qe=document.createRange();qe.setStart(ee,ie),qe.setEnd(v,A);const a=document.createRange();a.setStart(d,0),a.setEnd(ee,ie);const M=document.createRange();return M.setStart(v,A),M.setEnd(d,d.childNodes.length),[ae(a),ae(qe),ae(M)]},ae=d=>{const f=document.createElement("div");return f.appendChild(d.cloneContents()),f.innerHTML},ue=d=>{const f=c.paragraphLists[d].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:o("separate_title"),icon:t(Re),content:o("separate_content"),onOk(){const Y=document.createElement("div");Y.innerHTML=f;const[U,ee,v]=Q(Y,I.startOffset,I.endOffset),ie=U.replace(/<[^>]+>/g,"").trim()==="",A=v.replace(/<[^>]+>/g,"").trim()==="";ie&&A?g("handleSplit",{index:d,beforeContent:"",selectedContent:ee,afterContent:"",isFullSelection:!0}):g("handleSplit",{index:d,beforeContent:U,selectedContent:ee,afterContent:v,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:d}})}})},Ee=d=>{if(d>=c.paragraphLists.length-1)return ve.error(o("no_next_segment"));const f=c.paragraphLists[d].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:o("merge_next_title"),icon:t(Re),content:o("merge_next_content"),onOk(){const Y=document.createElement("div");Y.innerHTML=f;const[U,ee,v]=Q(Y,I.startOffset,I.endOffset),ie=U.replace(/<[^>]+>/g,"").trim()==="",A=v.replace(/<[^>]+>/g,"").trim()==="";ie&&A?g("handleSplitNext",{index:d,beforeContent:"",selectedContent:ee,afterContent:"",isFullSelection:!0}):g("handleSplitNext",{index:d,beforeContent:U,selectedContent:ee,afterContent:v,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:d}})}})},H=d=>{if(d<=0)return ve.error(o("no_prev_segment"));const f=c.paragraphLists[d].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:o("merge_prev_title"),icon:t(Re),content:o("merge_prev_content"),onOk(){const Y=document.createElement("div");Y.innerHTML=f;const[U,ee,v]=Q(Y,I.startOffset,I.endOffset),ie=U.replace(/<[^>]+>/g,"").trim()==="",A=v.replace(/<[^>]+>/g,"").trim()==="";ie&&A?g("handleSplitUp",{index:d,beforeContent:"",selectedContent:ee,afterContent:"",isFullSelection:!0}):g("handleSplitUp",{index:d,beforeContent:U,selectedContent:ee,afterContent:v,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:d}})}})},$e=d=>{const f=c.paragraphLists[d].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:o("delete_content_title"),icon:t(Re),content:o("delete_content_content"),onOk(){const Y=document.createElement("div");Y.innerHTML=f;const[U,ee,v]=Q(Y,I.startOffset,I.endOffset),ie=U.replace(/<[^>]+>/g,"").trim()==="",A=v.replace(/<[^>]+>/g,"").trim()==="";ie&&A?g("handleSplitDelete",{index:d,beforeContent:"",selectedContent:"",afterContent:"",isFullSelection:!0}):g("handleSplitDelete",{index:d,beforeContent:U,selectedContent:"",afterContent:v,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:d}})}})},Me=d=>{L.value&&!d.target.closest(".bubble-card")&&(L.value=!1)};function Ce(d,f){if(c.detailsInfo.chunk_type!=4||f==0)return!1;let K=c.paragraphLists[f-1];return d.father_chunk_paragraph_number==K.father_chunk_paragraph_number}function De(d,f,K={}){if(!f||!d)return d;const{highlightClass:I="highlight",caseSensitive:de=!1,wholeWord:Y=!1}=K,U=de?"g":"gi";let ee;return Y?ee=new RegExp(`\\b${Ne(f)}\\b`,U):ee=new RegExp(Ne(f),U),d.replace(ee,v=>`<span class="${I}">${v}</span>`)}function Ne(d){return d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return je(()=>{document.addEventListener("click",Me),setTimeout(()=>{x()},100)}),At(()=>{document.removeEventListener("click",Me)}),n({handleOpenEditModal:V}),(d,f)=>{const K=et,I=ut,de=_t,Y=dt,U=Ye,ee=it("viewer");return r(),y("div",{class:"subsection-box content-container",ref_key:"containerRef",ref:ne},[s("div",Za,[O(u(l(o)("segmentation_preview"))+" ",1),s("span",null,u(l(o)("total_segments",{count:c.total})),1)]),(r(!0),y(fe,null,xe(c.paragraphLists,(v,ie)=>(r(),y("div",{class:rt(["list-item",{"fragment-father-son-item":c.detailsInfo.chunk_type==4,"dashed-line":Ce(v,ie),mt8:c.detailsInfo.chunk_type==4&&!Ce(v,ie)}]),key:v.id,onClick:ye(A=>D(v,ie,A),["stop"]),style:Ae({"--status-color":h(v)})},[s("div",Ka,[s("div",Xa,[O(u(l(o)("segment"))+" ",1),c.detailsInfo.chunk_type==4?(r(),y(fe,{key:0},[O(u(l(o)("segment_father_child",{father:v.father_chunk_paragraph_number,child:v.number})),1)],64)):(r(),y(fe,{key:1},[O(u(v.number),1)],64)),s("div",Ya,u(v.title),1),s("span",null,u(l(o)("total_characters",{count:v.word_total})),1),s("span",eo,[O(u(l(o)("embedding_status"))+"："+u(v.status_text),1),v.status==3?(r(),G(l(Nn),{key:0})):J("",!0),v.status==2&&v.errmsg?(r(),G(K,{key:1,title:v.errmsg},{default:i(()=>[s("strong",to,[O(u(l(o)("reason")),1),t(l(Re),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):J("",!0),v.split_status==4&&v.split_err_msg?(r(),G(K,{key:2,title:v.split_err_msg},{default:i(()=>[s("div",no,[t(l(Hn),{style:{"margin-left":"0"},class:"cfb363f"}),O(" "+u(l(o)("segmentation_failed")),1)])]),_:1},8,["title"])):J("",!0)]),ce.detailsInfo.graph_switch?(r(),y("span",ao,[O(u(l(o)("knowledge_graph_status"))+"："+u(v.graph_status_text)+" ",1),v.graph_status==3&&v.graph_err_msg?(r(),G(K,{key:0,title:v.graph_err_msg},{default:i(()=>[s("strong",oo,[O(u(l(o)("reason")),1),t(l(Re),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):J("",!0)])):J("",!0)]),s("div",so,[t(Y,null,{overlay:i(()=>[t(de,null,{default:i(()=>[(r(!0),y(fe,null,xe(N.value,A=>(r(),G(I,{key:A.id},{default:i(()=>[s("div",{class:"start-item",onClick:ye(qe=>te(v,A),["stop"])},[t(l(Ke),{style:Ae({color:l(Xe)[A.type]})},null,8,["style"]),s("div",null,u(A.name||"-"),1)],8,io)]),_:2},1024))),128)),t(I,null,{default:i(()=>[s("div",{class:"start-item",onClick:ye(C,["stop"])},[t(l(Gt)),s("div",null,u(l(o)("featured_settings")),1)])]),_:1})]),_:2},1024)]),default:i(()=>[s("div",lo,[v.category_id>0?(r(),G(l(Ke),{key:0,onClick:ye(A=>te(v,{}),["stop"]),style:Ae({color:h(v),"font-size":"16px"})},null,8,["onClick","style"])):(r(),G(l(jt),{key:1,onClick:A=>te(v,N.value[0]),style:{"font-size":"16px",color:"#595959"}},null,8,["onClick"]))])]),_:2},1024),t(K,null,{title:i(()=>[O(u(l(o)("re_segment")),1)]),default:i(()=>[s("div",{class:"hover-btn-box",onClick:ye(A=>P(v),["stop"])},[t(U,{name:"segmentation-icon",style:{"font-size":"16px"}})],8,ro)]),_:2},1024),ce.detailsInfo.graph_switch?(r(),G(K,{key:0},{title:i(()=>[O(u(l(o)("knowledge_graph")),1)]),default:i(()=>[s("div",{class:"hover-btn-box",onClick:A=>_(v)},[t(U,{name:"graph-icon",style:{"font-size":"16px",color:"#595959"}})],8,co)]),_:2},1024)):J("",!0),t(K,null,{title:i(()=>[O(u(l(o)("re_convert")),1)]),default:i(()=>[s("div",_o,[t(l(Vt),{onClick:ye(A=>j(v,ie),["stop"])},null,8,["onClick"])])]),_:2},1024),t(Y,{placement:"bottomRight"},{overlay:i(()=>[t(de,null,{default:i(()=>[t(I,null,{default:i(()=>[s("div",{onClick:ye(A=>V(v),["stop"])},u(l(o)("edit")),9,po)]),_:2},1024),t(I,null,{default:i(()=>[s("div",{onClick:ye(A=>W(v.id),["stop"])},u(l(o)("delete")),9,mo)]),_:2},1024)]),_:2},1024)]),default:i(()=>[s("div",uo,[t(l(Wt),{style:{"font-size":"16px",color:"#595959"}})])]),_:2},1024)])]),v.question?(r(),y("div",fo,[O(u(l(o)("question_prefix"))+" ",1),s("span",{innerHTML:De(v.question,c.search)},null,8,go)])):J("",!0),v.answer?(r(),y("div",ho,[O(u(l(o)("answer_prefix")),1),s("span",{innerHTML:De(v.answer,c.search)},null,8,vo)])):J("",!0),s("div",{class:"content-box",onMouseup:ye(A=>Z(A,ie),["stop"]),innerHTML:De(v.content,c.search)},null,40,ko),v.images.length>0?ct((r(),y("div",yo,[(r(!0),y(fe,null,xe(v.images,(A,qe)=>(r(),y("img",{key:qe,src:A,alt:""},null,8,bo))),128))])),[[ee]]):J("",!0)],14,Qa))),128)),t(Kt,{onOk:S,ref_key:"classificationMarkModalRef",ref:T},null,512),t(Wa,{ref_key:"graphModelRef",ref:$},null,512),L.value?(r(),y("div",{key:0,class:"bubble-card",style:Ae(he.value)},[s("button",{class:"bubble-item",onClick:f[0]||(f[0]=ye(v=>R("separate"),["stop"]))},[t(U,{name:"segmentation",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),O(" "+u(l(o)("separate")),1)]),s("button",{class:"bubble-item",onClick:f[1]||(f[1]=ye(v=>R("merge-prev"),["stop"]))},[t(U,{name:"segmentation-up",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),O(" "+u(l(o)("merge_prev")),1)]),s("button",{class:"bubble-item",onClick:f[2]||(f[2]=ye(v=>R("merge-next"),["stop"]))},[t(U,{name:"segmentation-down",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),O(" "+u(l(o)("merge_next")),1)]),s("button",{class:"bubble-item",onClick:f[3]||(f[3]=ye(v=>R("delete"),["stop"]))},[t(U,{name:"delete",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),O(" "+u(l(o)("delete_content")),1)])],4)):J("",!0)],512)}}},Rt=Le(So,[["__scopeId","data-v-3be00b70"]]),wo={class:"mode-box"},xo=["innerHTML"],$o={class:"tag-item"},Co={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(ce){const{t:n}=Pe("views.library.library-preview.components.segmentation-mode"),z=ce,o=p(""),q=ke(()=>{const{is_table_file:g,is_qa_doc:c,is_diy_split:x,question_lable:j,answer_lable:V,separators:W,chunk_size:D,chunk_overlap:P,question_column:N,answer_column:S,qa_index_type:T,doc_type:C}=z.detailsInfo;if(g!=1&&c!=1&&x!=1)return C==3?(o.value=`${n("msg_segmentation_mode")}：${n("msg_manual_segmentation")}
${n("msg_doc_type")}：${n("msg_normal_doc")}`,`${n("msg_custom")}：${n("msg_normal_doc")}`):(o.value=`${n("msg_segmentation_mode")}：${n("msg_smart_segmentation")}
${n("msg_doc_type")}：${n("msg_normal_doc")}`,`${n("msg_smart_segmentation")}：${n("msg_normal_doc")}`);if(g!=1&&c==1)return C==3?(o.value=`${n("msg_segmentation_mode")}：${n("msg_manual_segmentation")}
${n("msg_doc_type")}：${n("msg_qa_doc")}`,`${n("msg_custom")}：${n("msg_qa_doc")}`):(o.value=`${n("msg_segmentation_mode")}：${n("msg_smart_segmentation")}
${n("msg_doc_type")}：${n("msg_qa_doc")}
${n("msg_question_start_marker")}"${j}"
${n("msg_answer_start_marker")}"${V}"`,`${n("msg_smart_segmentation")}：${n("msg_qa_doc")}`);if(g!=1&&c!=1&&x==1)return o.value=`${n("msg_segmentation_mode")}：${n("msg_custom_segmentation")}
${n("msg_doc_marker")}：${W}
${n("msg_chunk_max_length")}：${D}${n("msg_characters")}
${n("msg_chunk_overlap_length")}：${P}${n("msg_characters")}`,n("msg_custom_segmentation");if(g==1&&c!=1)return o.value=`${n("msg_segmentation_mode")}：${n("msg_smart_segmentation")}
${n("msg_doc_type")}：${n("msg_normal_table")}`,`${n("msg_smart_segmentation")}：${n("msg_normal_table")}`;if(g==1&&c==1){let h=T==1?n("msg_qa_generate_index_together"):n("msg_question_only_index");return o.value=`${n("msg_segmentation_mode")}：${n("msg_smart_segmentation")}
${n("msg_doc_type")}：${n("msg_qa_doc")}
${n("msg_question_column")}"${N}"
${n("msg_answer_column")}"${S}"
${n("msg_index_method")}：${h}`,`${n("msg_smart_segmentation")}：${n("msg_qa_doc")}`}});return(g,c)=>{const x=et;return r(),y("div",wo,[t(x,null,{title:i(()=>[s("div",{class:"tooltip-text-box",innerHTML:o.value},null,8,xo)]),default:i(()=>[s("div",$o,u(q.value),1)]),_:1})])}}},qo=Le(Co,[["__scopeId","data-v-6aa003c3"]]),Lo={__name:"update-frequency",emits:["ok"],setup(ce,{expose:n,emit:z}){const{t:o}=Pe("views.library.library-preview.components.update-frequency"),q=z,g=p(!1),c=p(!1),x=Oe({doc_auto_renew_frequency:1,id:""}),j=W=>{let{doc_auto_renew_frequency:D,id:P}=W;x.doc_auto_renew_frequency=+D,x.id=P,g.value=!0},V=()=>{c.value=!0,wn({...x}).then(W=>{q("ok",x.doc_auto_renew_frequency),g.value=!1,ve.success(o("msg_set_success"))}).finally(()=>{c.value=!1})};return n({open:j}),(W,D)=>{const P=Qt,N=Zt,S=Bn,T=An,C=be;return r(),y("div",null,[t(C,{open:g.value,"onUpdate:open":D[1]||(D[1]=h=>g.value=h),"confirm-loading":c.value,maskClosable:!1,title:l(o)("modal_title"),onOk:V},{default:i(()=>[t(T,{style:{margin:"32px 0"},layout:"vertical",model:x},{default:i(()=>[t(S,{name:"doc_auto_renew_frequency",label:l(o)("label_update_frequency"),required:""},{default:i(()=>[t(N,{value:x.doc_auto_renew_frequency,"onUpdate:value":D[0]||(D[0]=h=>x.doc_auto_renew_frequency=h),style:{width:"100%"}},{default:i(()=>[t(P,{value:1},{default:i(()=>[O(u(l(o)("option_not_auto_update")),1)]),_:1}),t(P,{value:2},{default:i(()=>[O(u(l(o)("option_daily")),1)]),_:1}),t(P,{value:3},{default:i(()=>[O(u(l(o)("option_every_3_days")),1)]),_:1}),t(P,{value:4},{default:i(()=>[O(u(l(o)("option_every_7_days")),1)]),_:1}),t(P,{value:5},{default:i(()=>[O(u(l(o)("option_every_30_days")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","confirm-loading","title"])])}}},Oo={class:"loading"},Eo={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(ce,{expose:n,emit:z}){const o=ce,q=z,g=p(null),c=p([]),x=p(0),j=p(!1),V=ke(()=>j.value?null:{"border-bottom":"2px solid #d9d9d9"}),W=p({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});je(async()=>{const h=await Tt.getDocument(o.source).promise;x.value=h.numPages,q("getTotalPage",x.value),D()});const D=(h=null)=>{const te=c.value.length;if(te>=x.value||j.value)return;j.value=!0;const $=[];for(let _=1;_<=o.pageSize&&te+_<=x.value;_++)$.push(te+_);c.value.push(...$),Qe(()=>{typeof h=="function"&&h()})},P=h=>{D(),q("onScrollEnd",h)},N=h=>{Qe(()=>{h===c.value[c.value.length-1]&&(j.value=!1,q("rendered",h,x.value))})},S=h=>{q("select",h)},T=()=>g.value,C=h=>{q("scroll",h)};return n({loadMore:D,getScrollInstance:T}),(h,te)=>{const $=Ve;return r(),G(Je,{scrollbar:W.value,ref_key:"scrollRef",ref:g,onScroll:C,onOnScrollEnd:P},{default:i(()=>[(r(!0),y(fe,null,xe(c.value,_=>(r(),G(l(Tt),{onClick:ne=>S(_),key:_,source:ce.source,page:_,onRendered:()=>N(_),style:Ae(V.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),s("div",Oo,[j.value?(r(),G($,{key:0})):J("",!0)])]),_:1},8,["scrollbar"])}}},Mo=Le(Eo,[["__scopeId","data-v-8520f2eb"]]),Io={key:0,class:"loading-wrap"},To={class:"document-segmentation"},Ro={class:"page-container"},Po={class:"page-left"},Fo={class:"page-right"},zo={class:"document-fragment-preview"},Do={class:"preview-header"},No={class:"label-text"},Ho={class:"fragment-number"},Ao={key:1,class:"loading-box"},Bo="defaultAiChunkPrumpt",Uo={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}},currentData:{type:Object,default:()=>{}},paragraphType:{type:String,default:""}},emits:["ok","finish","loading"],setup(ce,{expose:n,emit:z}){const o=xn(),{t:q}=Pe("views.library.document-segmentation.document-segmentation-model"),{setInitDocumentFragmentList:g}=o,c=Ge(),x=z,{id:j}=c.query,V=p(!0),W=p(1);let D=!1;const P=ce,N=p(1);let S={id:j,separators_no:"",chunk_size:512,not_merged_text:!1,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Bo,ai_chunk_task_id:"",father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512};const T=p(null),C=a=>{typeof a.separators_no=="object"&&(a.separators_no=JSON.stringify(a.separators_no)),typeof a.father_chunk_separators_no=="object"&&(a.father_chunk_separators_no=JSON.stringify(a.father_chunk_separators_no)),typeof a.son_chunk_separators_no=="object"&&(a.son_chunk_separators_no=JSON.stringify(a.son_chunk_separators_no)),S={...S,...a},D?be.confirm({title:q("reminder"),icon:t(Re),content:q("reFetchConfirm"),okText:q("confirm"),okType:"danger",cancelText:q("cancel"),onOk(){D=!1,Ee("create")},onCancel(){}}):(D=!1,Ee("create"))};let h=600,te=0;const $=p({}),_=p(0),ne=()=>{V.value||(V.value=!0),Nt({id:j}).then(async a=>{const{status:M}=a.data;if(_.value=a.data.library_type,$.value=a.data,S={...S,separators_no:a.data.separators_no||"[12,11]",chunk_size:+a.data.chunk_size||512,not_merged_text:a.data.not_merged_text=="true",ai_chunk_size:+a.data.ai_chunk_size||5e3,chunk_overlap:+a.data.chunk_overlap||50,is_qa_doc:_.value==2?1:0,question_lable:a.data.question_lable,answer_lable:a.data.answer_lable,question_column:a.data.question_column,answer_column:a.data.answer_column,enable_extract_image:a.data.enable_extract_image=="true",qa_index_type:+a.data.qa_index_type,chunk_type:+a.data.chunk_type,semantic_chunk_size:+a.data.semantic_chunk_size||512,semantic_chunk_overlap:+a.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+a.data.semantic_chunk_threshold||90,semantic_chunk_use_model:a.data.semantic_chunk_use_model||"",ai_chunk_prumpt:a.data.ai_chunk_prumpt||q("defaultAiChunkPrumpt"),ai_chunk_model:a.data.ai_chunk_model||"",semantic_chunk_model_config_id:a.data.semantic_chunk_model_config_id>0?a.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:a.data.ai_chunk_model_config_id>0?a.data.ai_chunk_model_config_id:"",ai_chunk_task_id:a.data.ai_chunk_task_id||"",father_chunk_paragraph_type:+a.data.father_chunk_paragraph_type||2,father_chunk_separators_no:a.data.father_chunk_separators_no||"[12,11]",father_chunk_chunk_size:+a.data.father_chunk_chunk_size||1024,son_chunk_separators_no:a.data.son_chunk_separators_no||"[8,10]",son_chunk_chunk_size:+a.data.son_chunk_chunk_size||512},a.data.chunk_type==0&&(S={...S,separators_no:a.data.normal_chunk_default_separators_no,chunk_size:a.data.normal_chunk_default_chunk_size,not_merged_text:a.data.normal_chunk_default_not_merged_text=="true",chunk_overlap:a.data.normal_chunk_default_chunk_overlap,chunk_type:+a.data.default_chunk_type,semantic_chunk_size:+a.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+a.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+a.data.semantic_chunk_default_threshold,semantic_chunk_use_model:a.data.default_use_model||"",semantic_chunk_model_config_id:a.data.default_model_config_id>0?a.data.default_model_config_id:""}),M==0){if(te++,te>h){be.error({title:q("reminder"),content:q("documentParsingSlow")});return}setTimeout(()=>{ne()},1e3)}else(M==4||M==2)&&(V.value=!1,W.value=parseInt(a.data.is_table_file),a.data.library_id,_.value==2?(S.question_lable||S.question_column)&&Ee():Ee());a.data.is_table_file==1&&b()})};je(async()=>{await ne()});const L=p([]),b=()=>{qn({id:j}).then(a=>{let M=[];for(let oe in a.data)M.push({lable:a.data[oe],value:oe});L.value=M})},_e=p([]),ge=p(!1),re=p(!1),he=p(""),Z=p(null);let R=null;const Q=p([]),ae=p(0),ue=ke(()=>ae.value<=0),Ee=a=>{var pe;x("loading",!0);let M={...S,semantic_chunk_model_config_id:S.semantic_chunk_model_config_id?+S.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:S.ai_chunk_model_config_id?+S.ai_chunk_model_config_id:0,...P.pdfState};S.chunk_type==3&&(S.ai_chunk_task_id&&!a&&(M.ai_chunk_task_id=S.ai_chunk_task_id),M.ai_chunk_task_id&&a&&a==="create"&&delete M.ai_chunk_task_id);let oe=Cn;return P.paragraphType&&P.paragraphType==="paragraphsSegmented"&&a=="create"&&(oe=On,delete M.id),P.paragraphType&&P.paragraphType==="paragraphsSegmented"&&!a?(Q.value=P.currentData.list||[],ae.value=P.currentData.list.length,S.chunk_type==3&&(he.value=((pe=P.currentData.split_params)==null?void 0:pe.ai_chunk_task_id)||"",re.value=!0,T.value.reLoading=!0,Z.value=null,!S.ai_chunk_task_id&&W.value!=1||a&&a==="create"?(Q.value=[],ae.value=0,Ce()):(re.value=!1,T.value.reLoading=!1)),S.chunk_type!=3&&(T.value.reLoading=!1,T.value.saveLoading=!1),x("loading",!1),!1):oe(M).then(Se=>{var Ie;_e.value=Se.data.list||[],g(_e.value),Q.value=Se.data.list||[],ae.value=Se.data.list.length||0,S.chunk_type==3&&(he.value=((Ie=Se.data.split_params)==null?void 0:Ie.ai_chunk_task_id)||"",re.value=!0,T.value.reLoading=!0,T.value.saveLoading=!0,Z.value=null,!S.ai_chunk_task_id&&W.value!=1||a&&a==="create"?(Q.value=[],ae.value=0,Ce()):(re.value=!1,T.value.reLoading=!1,T.value.saveLoading=!1))}).finally(()=>{S.chunk_type!=3&&(T.value.reLoading=!1,T.value.saveLoading=!1),x("loading",!1)})},H=a=>{N.value=a},$e=async()=>{var a;try{const M=await De();return M.data.err_msg?(Z.value=M.data.err_msg,!0):((a=M.data.list)==null?void 0:a.length)>0?(_e.value=M.data.list||[],g(_e.value),Q.value=M.data.list||[],ae.value=M.data.list.length||0,!0):!1}catch{return Z.value="请求异常，停止轮询",!0}};function Me(a){return a.split("message:")[1]}const Ce=()=>{const a=async()=>{if(!await $e())R=setTimeout(a,3e3);else if(re.value=!1,T.value.reLoading=!1,T.value.saveLoading=!1,R!==null&&(clearTimeout(R),R=null),ge.value&&ie(),Z.value){let oe=Me(Z.value);be.error({title:q("segmentationFailed"),content:oe?q("modelCallFailedWithReason",{reason:oe}):q("modelCallFailed")})}};a()},De=()=>Ln({id:S.id,task_id:he.value}),Ne=p(null);let d=null;const f=({title:a,content:M,question:oe,answer:pe,images:Se},Ie)=>{d=Ie,Ne.value.open({title:a,content:M,question:oe,answer:pe,images:Se})},K=({title:a,content:M,question:oe,answer:pe,images:Se})=>{(Q.value[d].title!=a||Q.value[d].content!=M||Q.value[d].question!=oe||Q.value[d].answer!=pe)&&(D=!0),Q.value[d].title=a,Q.value[d].content=M,Q.value[d].question=oe,Q.value[d].answer=pe,Q.value[d].images=Se,Q.value[d].word_total=pe.length+oe.length+M.length},I=a=>{be.confirm({title:q("reminder"),icon:t(Re),content:q("deleteSegmentConfirm"),okText:q("confirm"),okType:"danger",cancelText:q("cancel"),onOk(){D=!0,Q.value.splice(a,1)},onCancel(){}})},de=p(""),Y=a=>{de.value=a},U=p(!1),ee=()=>{let a=T.value.formState;a=JSON.parse(JSON.stringify(a)),typeof a.separators_no=="object"&&(a.separators_no=JSON.stringify(a.separators_no)),typeof a.father_chunk_separators_no=="object"&&(a.father_chunk_separators_no=JSON.stringify(a.father_chunk_separators_no)),typeof a.son_chunk_separators_no=="object"&&(a.son_chunk_separators_no=JSON.stringify(a.son_chunk_separators_no)),S={...S,...a}},v=a=>{let M=0;return a.forEach(oe=>{M+=parseInt(oe.word_total)}),M},ie=async()=>{if((ae.value<=0||S.chunk_type!=N.value)&&(ee(),await Ee()),ee(),de.value)return ve.error(de.value);if(S.chunk_type==3&&!Q.value.length)return ge.value=!0,!1;he.value&&(S.ai_chunk_task_id=he.value);let a={...S,semantic_chunk_model_config_id:S.semantic_chunk_model_config_id?+S.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:S.ai_chunk_model_config_id?+S.ai_chunk_model_config_id:0,is_table_file:W.value,...P.pdfState};delete a.id;let M={file_id:j,word_total:v(Q.value),split_params:JSON.stringify(a),list:JSON.stringify(Q.value),...P.pdfState};a.is_qa_doc==1&&(M.qa_index_type=a.qa_index_type),U.value=!0,P.paragraphType&&P.paragraphType==="paragraphsSegmented"&&(M.data_id=M.data_ids,delete M.data_ids),$n(M).then(()=>{x("ok"),x("finish")}).finally(()=>{U.value=!1}).catch(oe=>{oe.data&&oe.data.index&&qe(oe.data.index),x("finish")})},A=p(null),qe=a=>{a=a-1;let M=A.value.querySelectorAll(".fragment-item");M.length>=a&&M[a].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return At(()=>{R&&(clearTimeout(R),R=null)}),n({handleSaveLibFileSplit:ie}),(a,M)=>{const oe=Ve;return r(),y(fe,null,[V.value?(r(),y("div",Io,[t(oe)])):J("",!0),s("div",To,[s("div",Ro,[s("div",Po,[t(fa,{excellQaLists:L.value,libFileInfo:$.value,library_type:_.value,mode:W.value,hideSave:!0,status:"paragraphsSegmented",ref_key:"segmentationSettingRef",ref:T,onChange:C,onChangeChunkType:H,onSave:ie,onValidate:Y},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),s("div",Fo,[s("div",zo,[s("div",Do,[s("span",No,u(l(q)("segmentationPreview")),1),s("span",Ho,u(l(q)("totalSegments",{count:ae.value})),1)]),ue.value&&!re.value?(r(),G(ga,{key:0})):J("",!0),re.value?(r(),y("div",Ao,[t(oe),O(u(l(q)("processingData")),1)])):J("",!0),s("div",{class:"preview-box",ref_key:"previewBoxRef",ref:A},[(r(!0),y(fe,null,xe(Q.value,(pe,Se)=>(r(),y("div",{class:"fragment-item",key:Se},[t(ha,{status:"paragraphsSegmented",chunk_type:l(S).chunk_type,father_chunk_paragraph_number:pe.father_chunk_paragraph_number,currentData:ce.currentData,number:pe.number,title:pe.title,content:pe.content,total:pe.word_total,question:pe.question,answer:pe.answer,images:pe.images,onDelete:Ie=>I(Se),onEdit:Ie=>f(pe,Se)},null,8,["chunk_type","father_chunk_paragraph_number","currentData","number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),t(va,{ref_key:"editFragmentAlertRef",ref:Ne,onOk:K},null,512)])],64)}}},Xt=Le(Uo,[["__scopeId","data-v-81b6627b"]]),Jo={class:"select-box"},jo=["onClick"],Go={class:"title"},Vo={class:"desc"},Wo={key:0,class:"card-switch"},Zo={class:"main-content-box"},Qo={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(ce,{expose:n,emit:z}){const{t:o}=Pe("views.library.library-preview.components.re-segmentation-page"),q=Ht(),g=ke(()=>{var Z;return((Z=q.companyInfo)==null?void 0:Z.ali_ocr_switch)=="1"}),c=Ge().query,x=Bt(),j=ce,V=p(!1),W=p(!1),D=p(""),P=z;let N={};const S=p([{title:o("image_text_ocr"),desc:o("image_text_ocr_desc"),icon:"pdf-ocr",pdf_parse_type:2},{title:o("text_only"),desc:o("text_only_desc"),icon:"pdf-text",pdf_parse_type:1},{title:o("image_text"),desc:o("image_text_desc"),icon:"pdf-img",pdf_parse_type:3}]),T=Oe({pdf_parse_type:2,pdf_page_num:0}),C=()=>{S.value=S.value.filter(Z=>Z.pdf_parse_type!=4),P("enable")},h=p(!1),te=Z=>{h.value=Z},$=Z=>{N={...Z},T.pdf_parse_type=2,T.pdf_page_num=Z.pdf_page_num,Z.type==1&&(D.value=o("resegment_current_page",{page:Z.pdf_page_num})),Z.type==2&&(D.value=o("resegment_document")),Z.type==3&&(D.value=o("restudy_document"),S.value.push({title:o("ali_cloud_ocr"),desc:o("ali_cloud_ocr_desc"),icon:"ali-ocr",pdf_parse_type:4})),V.value=!0},_=()=>{window.open("#/user/aliocr")},ne=Z=>{if(Z.pdf_parse_type==4&&!g.value)return!1;T.pdf_parse_type=Z.pdf_parse_type},L=p(!1),b=()=>{if(N.type==3){if(T.pdf_parse_type==1){x.push("/library/document-segmentation?document_id="+c.id+"&source=preview");return}L.value=!0,En({id:c.id,pdf_parse_type:T.pdf_parse_type}).then(Z=>{ve.success(o("restudy_success")),(T.pdf_parse_type==2||T.pdf_parse_type==3||T.pdf_parse_type==4)&&x.push({path:"/library/details/knowledge-document",query:{id:j.detailsInfo.library_id}}),T.pdf_parse_type==1&&x.push("/library/document-segmentation?document_id="+c.id+"&source=preview"),V.value=!1}).finally(()=>{L.value=!1});return}V.value=!1,W.value=!0},_e=p(null),ge=()=>{L.value=!0,_e.value.handleSaveLibFileSplit()},re=()=>{ve.success(o("save_success")),W.value=!1,P("ok",N.type)},he=()=>{L.value=!1};return n({show:$}),(Z,R)=>{const Q=Ye,ae=be;return r(),y("div",null,[t(ae,{open:V.value,"onUpdate:open":R[0]||(R[0]=ue=>V.value=ue),title:D.value,onOk:b,onCancel:C,width:720,confirmLoading:L.value},{default:i(()=>[s("div",Jo,[(r(!0),y(fe,null,xe(S.value,ue=>(r(),y("div",{class:rt(["select-list-item",{active:ue.pdf_parse_type==T.pdf_parse_type},{disabled:ue.pdf_parse_type==4&&!g.value}]),onClick:Ee=>ne(ue),key:ue.pdf_parse_type},[s("div",Go,[t(Q,{name:ue.icon,style:{"font-size":"16px"}},null,8,["name"]),O(" "+u(ue.title),1)]),s("div",Vo,u(ue.desc),1),ue.pdf_parse_type==4&&!g.value?(r(),y("div",Wo,[O(u(l(o)("ali_ocr_not_enabled"))+" ",1),s("div",{class:"card-switch-btn",onClick:ye(_,["stop"])},u(l(o)("go_to_enable")),1)])):J("",!0)],10,jo))),128))])]),_:1},8,["open","title","confirmLoading"]),t(ae,{open:W.value,"onUpdate:open":R[1]||(R[1]=ue=>W.value=ue),onCancel:C,title:D.value,maskClosable:!1,"ok-text":h.value?l(o)("document_parsing_please_wait"):l(o)("confirm"),confirmLoading:L.value||h.value,onOk:ge,width:1e3},{default:i(()=>[s("div",Zo,[W.value?(r(),G(Xt,{key:0,onOk:re,onFinish:he,onLoading:te,pdfState:T,ref_key:"documentSegmentationModalRef",ref:_e},null,8,["pdfState"])):J("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},Ko=Le(Qo,[["__scopeId","data-v-a87a9401"]]),Xo={class:"subsection-box"},Yo={class:"qa-list-box"},es={class:"list-item"},ts={class:"list-label"},ns=["innerHTML"],as={key:0,class:"list-item"},os={class:"list-label"},ss=["innerHTML"],ls={class:"list-item"},is={class:"list-label"},rs=["innerHTML"],cs={class:"fragment-img"},_s=["src"],us={key:0,class:"status-tag"},ds={key:1,class:"status-tag complete"},ps={class:"status-tag status-error"},ms={key:3,class:"status-tag running"},fs={class:"right-opration"},gs={class:"hover-btn-box"},hs=["onClick"],vs=["onClick"],ks={class:"hover-btn-box"},ys=["onClick"],bs=["onClick"],Ss={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},search:{type:String,default:""},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(ce,{expose:n,emit:z}){const{t:o}=Pe("views.library.library-preview.components.qa-subsection-box"),g=Ge().query,c=z,x=ce,j=($,_)=>{let{id:ne,title:L,content:b,question:_e,answer:ge,images:re,category_id:he}=$,Z=$.similar_questions||[];be.confirm({title:o("title_confirm_re_convert"),icon:null,content:o("msg_confirm_re_convert",{index:_+1}),onOk(){return new Promise((R,Q)=>{zt({id:ne,title:L,content:b,question:_e,answer:ge,images:re,category_id:he,similar_questions:JSON.stringify(Z)}).then(ae=>{c("handleConvert",$),R()}).catch(()=>{R()})})},onCancel(){}})},V=$=>{c("openEditSubscription",$)},W=$=>{be.confirm({title:o("title_tip"),icon:t(Re),content:o("msg_confirm_delete"),onOk(){return new Promise((_,ne)=>{Dt({id:$}).then(L=>{ve.success(o("msg_delete_success")),c("handleDelParagraph",$),_()}).catch(()=>{_()})})},onCancel(){}})},D=p([]),P=()=>{let $={};g.id&&($.file_id=g.id),Pt($).then(_=>{D.value=_.data||[],c("getStatrList",_.data||[])})};P();const N=p(null),S=()=>{N.value.show()},T=$=>{var ne;let _=(ne=D.value.filter(L=>L.id==$.category_id)[0])==null?void 0:ne.type;return _?Xe[_]:"#F4EA2A"},C=($,_={})=>{Ft({id:$.id,category_id:_.id||0}).then(ne=>{ve.success(o("msg_set_success")),$.category_id=_.id,P()})};function h($,_,ne={}){if(!_||!$)return $;const{highlightClass:L="highlight",caseSensitive:b=!1,wholeWord:_e=!1}=ne,ge=b?"g":"gi";let re;return _e?re=new RegExp(`\\b${te(_)}\\b`,ge):re=new RegExp(te(_),ge),$.replace(re,he=>`<span class="${L}">${he}</span>`)}function te($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return n({handleOpenEditModal:V}),($,_)=>{const ne=Un,L=et,b=Ve,_e=ut,ge=_t,re=dt,he=Vn,Z=it("viewer");return r(),y("div",Xo,[t(he,{"data-source":ce.paragraphLists,pagination:!1},{default:i(()=>[t(ne,{key:"id","data-index":"id",width:1148},{title:i(()=>[O(u(l(o)("title_qa_total",{count:x.total})),1)]),default:i(({record:R})=>[s("div",Yo,[s("div",es,[s("div",ts,u(l(o)("label_question")),1),s("div",{class:"list-content",innerHTML:h(R.question,x.search)},null,8,ns)]),R.similar_questions&&R.similar_questions.length?(r(),y("div",as,[s("div",os,u(l(o)("label_similar_questions")),1),s("div",{class:"list-content",innerHTML:h(R.similar_questions.join("/"),x.search)},null,8,ss)])):J("",!0),s("div",ls,[s("div",is,u(l(o)("label_answer")),1),s("div",{class:"list-content",innerHTML:h(R.answer,x.search)},null,8,rs)]),ct((r(),y("div",cs,[(r(!0),y(fe,null,xe(R.images,(Q,ae)=>(r(),y("img",{key:ae,src:Q,alt:""},null,8,_s))),128))])),[[Z]])])]),_:1}),t(ne,{title:l(o)("title_embed_status"),key:"status_text","data-index":"status_text",width:128},{default:i(({record:R})=>[R.status==0?(r(),y("span",us,[t(l(Jn)),O(" "+u(l(o)("status_not_converted")),1)])):J("",!0),R.status==1?(r(),y("span",ds,[t(l(jn)),O(" "+u(l(o)("status_converted")),1)])):J("",!0),R.status==2?(r(),G(L,{key:2,placement:"top"},{title:i(()=>[s("span",null,u(R.errmsg),1)]),default:i(()=>[s("span",null,[s("span",ps,[t(l(Gn)),O(" "+u(l(o)("status_convert_error")),1)])])]),_:2},1024)):J("",!0),R.status==3?(r(),y("span",ms,[t(b,{size:"small"}),O(" "+u(l(o)("status_converting")),1)])):J("",!0)]),_:1},8,["title"]),t(ne,{title:l(o)("title_operation"),key:"action","data-index":"action",width:120},{default:i(({record:R,index:Q})=>[s("div",fs,[t(re,null,{overlay:i(()=>[t(ge,null,{default:i(()=>[(r(!0),y(fe,null,xe(D.value,ae=>(r(),G(_e,{key:ae.id},{default:i(()=>[s("div",{class:"start-item",onClick:ue=>C(R,ae)},[t(l(Ke),{style:Ae({color:l(Xe)[ae.type]})},null,8,["style"]),s("div",null,u(ae.name||"-"),1)],8,hs)]),_:2},1024))),128)),t(_e,null,{default:i(()=>[s("div",{class:"start-item",onClick:S},[t(l(Gt)),s("div",null,u(l(o)("btn_mark_settings")),1)])]),_:1})]),_:2},1024)]),default:i(()=>[s("div",gs,[R.category_id>0?(r(),G(l(Ke),{key:0,onClick:ae=>C(R,{}),style:Ae({color:T(R),"font-size":"16px"})},null,8,["onClick","style"])):(r(),G(l(jt),{key:1,onClick:ae=>C(R,D.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),t(L,null,{title:i(()=>[O(u(l(o)("tooltip_re_convert")),1)]),default:i(()=>[s("div",{class:"hover-btn-box",onClick:ae=>j(R,Q)},[t(l(Vt))],8,vs)]),_:2},1024),t(re,{placement:"bottomRight"},{overlay:i(()=>[t(ge,null,{default:i(()=>[t(_e,null,{default:i(()=>[s("div",{onClick:ye(ae=>V(R),["stop"])},u(l(o)("btn_edit")),9,ys)]),_:2},1024),t(_e,null,{default:i(()=>[s("div",{onClick:ye(ae=>W(R.id),["stop"])},u(l(o)("btn_delete")),9,bs)]),_:2},1024)]),_:2},1024)]),default:i(()=>[s("div",ks,[t(l(Wt))])]),_:2},1024)])]),_:1},8,["title"])]),_:1},8,["data-source"]),t(Kt,{onOk:P,ref_key:"classificationMarkModalRef",ref:N},null,512)])}}},ws=Le(Ss,[["__scopeId","data-v-9197ad8d"]]),xs={class:"main-content-box"},$s={__name:"segmentation-setting-modal",emits:["ok","enable"],setup(ce,{expose:n,emit:z}){const{t:o}=Pe("views.library.library-preview.components.segmentation-setting-modal"),q=p(!1),g=p(o("modal_title")),c=z;let x={};const j=Oe({data_ids:0,file_id:0}),V=()=>({0:o("status_not_converted"),1:o("status_converted"),2:o("status_conversion_exception"),3:o("status_converting"),4:o("tab_segmentation_failed"),10:o("status_segmenting")}),W=Oe({status:"",errmsg:"",status_text:""}),D=()=>{c("enable")},P=p(!1),N=_=>{P.value=_},S=_=>{q.value=!0,j.data_ids=_.id,j.file_id=_.file_id,W.list=[{father_chunk_paragraph_number:+_.father_chunk_paragraph_number,content:_.content,number:+_.number,title:_.title,word_total:+_.word_total,question:_.question,answer:_.answer,images:_.images}],W.status=_.status,W.errmsg=_.errmsg,W.status_text=V()[_.status]},T=p(!1),C=p(null),h=()=>{T.value=!0,C.value.handleSaveLibFileSplit()},te=()=>{ve.success(o("msg_save_success")),q.value=!1,c("ok",x.type)},$=()=>{T.value=!1};return n({show:S}),(_,ne)=>{const L=be;return r(),y("div",null,[t(L,{open:q.value,"onUpdate:open":ne[0]||(ne[0]=b=>q.value=b),onCancel:D,title:g.value,maskClosable:!1,"ok-text":P.value?l(o)("btn_ok_parsing"):l(o)("btn_ok"),confirmLoading:T.value||P.value,onOk:h,width:1084},{default:i(()=>[s("div",xs,[q.value?(r(),G(Xt,{key:0,onOk:te,onFinish:$,onLoading:N,paragraphType:"paragraphsSegmented",pdfState:j,currentData:W,ref_key:"documentSegmentationModalRef",ref:C},null,8,["pdfState","currentData"])):J("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},Cs=Le($s,[["__scopeId","data-v-0c2d6381"]]),qs={class:"library-preview-page"},Ls={class:"breadcrumb-block"},Os={class:"library-line1"},Es={class:"selct-star-box"},Ms={class:"document-title-block",style:{height:"22px"}},Is={class:"title"},Ts={class:"search-content-block"},Rs={class:"preview-box"},Ps={key:0,class:"page-loading-box"},Fs={class:"content-block"},zs={class:"content-block"},Ds={key:1,class:"pdf-view-box"},Ns={key:0,class:"pdf-mode-switch"},Hs={key:0},As={key:1,class:"segmentation-btn"},Bs={class:"view-content-box",style:{"padding-top":"60px"}},Us=["onClick"],Js={key:0,class:"content-box"},js={key:1,class:"content-box"},Gs=["innerHTML"],Vs={class:"fragment-img"},Ws=["src"],Zs={class:"right-contnt-box"},Qs={key:0,class:"right-tabs-box"},Ks={class:"content-block"},Xs={__name:"library-preview",setup(ce){const{t:n}=Pe("views.library.library-preview.index"),z=Ht(),o=ke(()=>{var e;return((e=z.companyInfo)==null?void 0:e.neo4j_status)=="true"}),q=p(!1),g=p(!1),c=p(null),x=p(0),j=p(0),V={0:n("status_pending_generation"),4:n("status_generating"),2:n("status_generation_success"),3:n("status_generation_failed")},W=p([]),D=e=>{W.value=e},P=p({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),N=Ge(),S=Bt(),T=Mn(),C=ke(()=>_.value.is_table_file=="1"),h=ke(()=>_.value.doc_type),te=ke(()=>{let e=_.value.status;return!(e=="1"||e=="2")||H.value.length==0}),$=ke(()=>_.value.is_qa_doc=="1"),_=p({}),ne=p([]),L=Oe({status:-1,graph_status:-1,category_id:-1,search:""}),b=p(1),_e=ke(()=>"/manage/getLibRawFile?id="+N.query.id+"&token="+T.getToken),ge=()=>{S.back()},re=p(null),he=p(null);let Z=-1;const R=(e,m=1)=>{let k,E;m==1?(k=".subsection-box .list-item",E=he.value):(k=".view-content-box .list-item",E=re.value);const B=document.querySelectorAll(k)[e];B.classList.add("flash-border"),Z>=0&&document.querySelectorAll(k)[Z].classList.remove("flash-border"),setTimeout(()=>{Z=-1,B.classList.remove("flash-border")},2500),Z=e,E.scrollToElement({el:B,time:1e3})},Q=p(!0),ae=p(0),ue=p({page:1,size:1e3}),Ee=p({}),H=p([]),$e=p(0),Me={0:n("status_not_converted"),1:n("status_converted"),2:n("status_conversion_exception"),3:n("status_converting")},Ce=Oe({split_status_exception:0,total:0,vector_status_converted:0,vector_status_converting:0,vector_status_exception:0,vector_status_initial:0}),De=Oe([{value:-1,label:n("tab_all"),num:ke(()=>Ce.total)},{value:4,label:n("tab_segmentation_failed"),num:ke(()=>Ce.split_status_exception)},{value:0,label:n("tab_not_converted"),num:ke(()=>Ce.vector_status_initial)},{value:3,label:n("tab_converting"),num:ke(()=>Ce.vector_status_converting)},{value:2,label:n("tab_conversion_exception"),num:ke(()=>Ce.vector_status_exception)},{value:1,label:n("tab_converted"),num:ke(()=>Ce.vector_status_converted)}]),Ne=n("default_ai_chunk_prompt"),d=p(1);let f={id:N.query.id,separators_no:"",chunk_size:512,not_merged_text:!1,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Ne,ai_chunk_task_id:"",father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512};const K=p(!1);let I=!0;(async()=>{Nt({id:N.query.id}).then(e=>{var k;ae.value=e.data.library_type,_.value={...e.data,graph_switch:e.data.graph_switch=="1"&&o.value},ne.value=((k=e==null?void 0:e.data)==null?void 0:k.meta_list)||[];let m=e.data.status;m==1||m==2?A():Q.value=!1,f={...f,separators_no:e.data.separators_no||"[12,11]",chunk_size:+e.data.chunk_size||512,not_merged_text:e.data.not_merged_text=="true",ai_chunk_size:+e.data.ai_chunk_size||5e3,chunk_overlap:+e.data.chunk_overlap||50,is_qa_doc:ae.value==2?1:0,question_lable:e.data.question_lable,similar_label:e.data.similar_label,answer_lable:e.data.answer_lable,question_column:e.data.question_column,similar_column:e.data.similar_column,answer_column:e.data.answer_column,enable_extract_image:e.data.enable_extract_image=="true",qa_index_type:+e.data.qa_index_type,chunk_type:+e.data.chunk_type,semantic_chunk_size:+e.data.semantic_chunk_size||512,semantic_chunk_overlap:+e.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+e.data.semantic_chunk_threshold||90,semantic_chunk_use_model:e.data.semantic_chunk_use_model||"",ai_chunk_prumpt:e.data.ai_chunk_prumpt||"",ai_chunk_model:e.data.ai_chunk_model||"",semantic_chunk_model_config_id:e.data.semantic_chunk_model_config_id>0?e.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:e.data.ai_chunk_model_config_id>0?e.data.ai_chunk_model_config_id:"",ai_chunk_task_id:e.data.ai_chunk_task_id||"",father_chunk_paragraph_type:+e.data.father_chunk_paragraph_type||2,father_chunk_separators_no:e.data.father_chunk_separators_no||"[12,11]",father_chunk_chunk_size:+e.data.father_chunk_chunk_size||1024,son_chunk_separators_no:e.data.son_chunk_separators_no||"[8,10]",son_chunk_chunk_size:+e.data.son_chunk_chunk_size||512},e.data.chunk_type==0&&(f={...f,separators_no:e.data.normal_chunk_default_separators_no,chunk_size:+e.data.normal_chunk_default_chunk_size,not_merged_text:e.data.normal_chunk_default_not_merged_text=="true",chunk_overlap:+e.data.normal_chunk_default_chunk_overlap,chunk_type:+e.data.default_chunk_type,semantic_chunk_size:+e.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+e.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+e.data.semantic_chunk_default_threshold,semantic_chunk_use_model:e.data.default_use_model||"",semantic_chunk_model_config_id:e.data.default_model_config_id>0?e.data.default_model_config_id:""}),(m==4||m==2)&&(d.value=parseInt(e.data.is_table_file))})})();const Y=()=>{In({file_id:N.query.id,search:L.search}).then(e=>{Object.assign(Ce,e.data)})},U=()=>{window.location.reload()},ee=()=>{ue.value.page=1,$e.value=0,H.value=[],A(),Y()},v=e=>{L.category_id=e,ee()},ie=(e=null)=>{ue.value.page++,A(e)},A=(e=null)=>{I=!0,Mt({file_id:N.query.id,...ue.value,...L}).then(m=>{var w,F;Q.value=!1,I=!1;let k=m.data,E=k.list||[],B=((w=k.info)==null?void 0:w.is_qa_doc)=="1"&&((F=k.info)==null?void 0:F.is_table_file)=="1";E.forEach(we=>{we.status_text=Me[we.status],we.graph_status_text=V[we.graph_status],we.isExcelQa=B,we.similar_questions&&(we.similar_questions=JSON.parse(we.similar_questions))}),Ee.value=k.info,ue.value.page==1&&(H.value=[]),H.value=[...H.value,...E],$e.value=k.total,typeof e=="function"&&e()})},qe=()=>{I||H.value.length>=$e.value||(ie(),c.value&&c.value.loadMore())},a=()=>{pe()};let M=null;function oe(){clearInterval(M),H.value.filter(m=>m.status==3).length?M=setInterval(()=>{pe()},5e3):clearInterval(M)}const pe=()=>{Mt({file_id:N.query.id,page:1,size:H.value.length,...L}).then(e=>{var B,w;let m=e.data,k=m.list||[],E=((B=m.info)==null?void 0:B.is_qa_doc)=="1"&&((w=m.info)==null?void 0:w.is_table_file)=="1";k.forEach(F=>{F.status_text=Me[F.status],F.graph_status_text=V[F.graph_status],F.isExcelQa=E,F.similar_questions&&(F.similar_questions=JSON.parse(F.similar_questions))}),H.value=k,oe()})},Se=e=>{if(!e.id){ue.value.page=1,A();return}let m=H.value,k=m.findIndex(E=>E.id==e.id);if(k>-1){let E=m[k];E.title=e.title,E.content=e.content,E.question=e.question,E.answer=e.answer,E.images=e.images,E.category_id=e.category_id,E.word_total=e.question.length+e.answer.length+e.content.length,E.similar_questions=e.similar_questions.length?JSON.parse(e.similar_questions):[],m.splice(k,1,E),H.value=m}},Ie=e=>{let m=H.value,k=m.findIndex(E=>E.id==e);k>-1&&(m.splice(k,1),H.value=m,$e.value=$e.value--)},pt=p(null),He=e=>{pt.value.showModal(JSON.parse(JSON.stringify(e)))},mt=p(null),Yt=()=>{Tn({id:N.query.id}).then(()=>ve.success(n("msg_operation_completed")))},en=()=>{Rn({id:N.query.id}).then(()=>ve.success(n("msg_operation_completed")))},ft=p(null),tn=()=>{ft.value.show(_.value)},gt=()=>{S.push("/library/document-segmentation?document_id="+N.query.id+"&source=preview")},nn=()=>{mt.value.open({id:N.query.id,doc_auto_renew_frequency:_.value.doc_auto_renew_frequency})},an=e=>{_.value.doc_auto_renew_frequency=e},on=e=>{_.value.file_name=e},sn=e=>{const m=()=>{for(let k in H.value)if(H.value[k].page_num==e){R(k);return}};if(e>H.value[H.value.length-1].page_num){ve.warning(n("msg_segment_data_loading"));const k=()=>{e<=H.value[H.value.length-1].page_num?(ve.success(n("msg_loading_completed")),Qe(()=>{m()})):ie(k)};ie(k)}else m()},ln=(e,m)=>{j.value=m,x.value=e,H.value[H.value.length-1].page_num<e&&ie()},ht=e=>{var m;if(((m=_.value)==null?void 0:m.file_ext)=="pdf"&&b.value==1){const k=e.page_num-1,E=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[k],B=()=>{const F=E();F.classList.add("flash-border"),setTimeout(()=>F.classList.remove("flash-border"),2500),c.value.getScrollInstance().scrollToElement({el:F,time:1e3})};if(E())B();else{ve.warning(n("msg_pdf_loading"));const F=()=>{E()?(ve.success(n("msg_loading_completed")),B()):c.value&&c.value.loadMore()};c.value&&c.value.loadMore(F)}}else R(e.index,2)},tt=p(1);let nt=null;const We=p(0),rn=e=>{We.value=e},cn=({y:e})=>{if(!nt){const k=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];nt=k&&k.clientHeight}let m=Math.floor(Math.abs(e)/nt)+1;tt.value=Math.max(m,1)},at=p(null),ot=p(null),_n=e=>{let{key:m}=e;c.value&&c.value.getScrollInstance().disable(),m==1&&at.value.show({type:m,pdf_page_num:tt.value}),m==2&&gt(),m==3&&at.value.show({type:m,pdf_page_num:0})},vt=e=>{ot.value&&ot.value.show(e)},kt=()=>{c.value&&c.value.getScrollInstance().enable()},un=()=>{kt(),ee()},yt=()=>{g.value=!g.value},st=(e,m)=>{let k=JSON.parse(JSON.stringify(e));return k.content=m,k.word_total=m.length,k},Fe=p(!1),ze=p(1),bt=({index:e,beforeContent:m,selectedContent:k,afterContent:E,isFullSelection:B})=>{const w=[...H.value];Fe.value=B,ze.value=1,B?(w.splice(e+1,0,st(w[e],k)),w.splice(e,1)):(w[e].content=m||"",w[e].word_total=m.length||0,E.trim()&&w.splice(e+1,0,st(w[e],E)),w.splice(e+1,0,st(w[e],k)),w[e+1].images=[],w.splice(e,1)),H.value=w,Be(w,e)},St=({index:e,beforeContent:m,selectedContent:k,afterContent:E,isFullSelection:B})=>{const w=[...H.value];Fe.value=B,ze.value=2;let F=w[e+1].word_total;B?(w[e+1].content=+k,w[e+1].word_total=parseInt(F)+k.length,w.splice(e,1),H.value=w,Be(w,e)):(w[e].content=m||"",w[e].word_total=m.length||0,w[e+1].content+=k,w[e+1].word_total=parseInt(F)+k.length,E.trim()&&(w[e].content+=E||"",w[e].word_total+=E.length||0),H.value=w,Be(w,e+1))},wt=({index:e,beforeContent:m,selectedContent:k,afterContent:E,isFullSelection:B})=>{const w=[...H.value];Fe.value=B,ze.value=3;let F=w[e-1].word_total;B?(w[e-1].content+=k,w[e-1].word_total=parseInt(F)+k.length,w.splice(e,1),H.value=w,Be(w,e)):(w[e].content=m||"",w[e].word_total=m.length||0,w[e-1].content+=k,w[e-1].word_total=parseInt(F)+k.length,E.trim()&&(w[e].content+=E||"",w[e].word_total+=E.length||0),H.value=w,Be(w,e-1))},xt=({index:e,beforeContent:m,afterContent:k,isFullSelection:E})=>{const B=[...H.value];Fe.value=E,ze.value=4,E?B.splice(e,1):(B[e].content=m||"",B[e].word_total=m.length||0,k.trim()&&(B[e].content+=k||"",B[e].word_total+=k.length||0)),H.value=B,Be(B,e)};function dn(e,m,k={},E){let B=E+1;if(!Array.isArray(e)||!Array.isArray(m))return JSON.stringify([]);const w=e.map((F,we)=>{const X={};for(const se of m){const Te=k[se]||se,me=F[Te];if(Object.prototype.hasOwnProperty.call(F,Te))if(se==="number")X[se]=we+1;else if(se==="father_chunk_paragraph_number")X[se]=+me;else if(se==="page_num"||se==="word_total")X[se]=+me;else if(se==="content"){if(!me)return null;X[se]=me}else se==="images"?ze.value==1?Fe.value?(B==X.number,X[se]=me):B+1==X.number?X[se]=[]:X[se]=me:ze.value==2?(Fe.value,B==X.number,X[se]=me):ze.value==3?Fe.value?(B-1==X.number,X[se]=me):(B==X.number,X[se]=me):ze.value==4&&(Fe.value,X[se]=me):X[se]=me}return X}).filter(F=>F!==null&&F.content!==void 0&&F.content!=="");return JSON.stringify(w)}const pn={similar_question_list:"similar_questions"},Be=async(e,m)=>{let k={...f,semantic_chunk_model_config_id:f.semantic_chunk_model_config_id?+f.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:f.ai_chunk_model_config_id?+f.ai_chunk_model_config_id:0,is_table_file:d.value};delete k.id;let E={id:N.query.id,word_total:$e.value,split_params:JSON.stringify(k),list:dn(e,["number","father_chunk_paragraph_number","page_num","title","content","question","similar_question_list","answer","word_total","images"],pn,m)};k.is_qa_doc==1&&(E.qa_index_type=k.qa_index_type),K.value=!0,Pn(E).then(B=>{ve.success(n("msg_operation_success"));const w=B.data;for(let F=0;F<w.length;F++){const we=w[F],X=H.value[F];if(F<H.value.length)X.id=we.toString(),X.status="0",X.status_text=Me[X.status];else break}}).finally(()=>{K.value=!1})};function mn(){q.value.show(!0,ne.value)}return je(()=>{Y(),N.query.graph_status&&(L.graph_status=N.query.graph_status,ee())}),(e,m)=>{var qt,Lt,Ot;const k=Fn("router-link"),E=Yn,B=Wn,w=Ye,F=Jt,we=ea,X=Qt,se=Zt,Te=ut,me=_t,$t=dt,fn=Qn,gn=Ve,Ze=et,Ct=ta,hn=Kn,vn=na,kn=Xn,yn=it("viewer");return r(),y("div",qs,[s("div",Ls,[t(B,null,{default:i(()=>[t(E,null,{default:i(()=>[t(k,{to:"/library/list"},{default:i(()=>[O(u(l(n)("breadcrumb_library_management")),1)]),_:1})]),_:1}),t(E,null,{default:i(()=>[t(k,{to:{path:"/library/details/knowledge-document",query:{id:_.value.library_id}}},{default:i(()=>[s("div",Os,u(_.value.library_name)+u(l(n)("breadcrumb_knowledge_base")),1)]),_:1},8,["to"])]),_:1}),t(E,null,{default:i(()=>[O(u(l(n)("breadcrumb_knowledge_base_details")),1)]),_:1})]),_:1}),s("div",Es,[t(aa,{startLists:W.value,onChange:v},null,8,["startLists"])])]),s("div",Ms,[t(l(Zn),{onClick:ge}),s("span",Is,u(_.value.file_name),1),t(qo,{detailsInfo:_.value},null,8,["detailsInfo"])]),s("div",Ts,[s("div",Rs,[g.value?(r(),G(F,{key:1,onClick:m[1]||(m[1]=le=>yt())},{default:i(()=>[t(w,{class:"preview-box-icon",name:"expand"}),O(" "+u(l(n)("btn_expand_preview")),1)]),_:1})):(r(),G(F,{key:0,onClick:m[0]||(m[0]=le=>yt())},{default:i(()=>[t(w,{class:"preview-box-icon",name:"put-away"}),O(" "+u(l(n)("btn_collapse_preview")),1)]),_:1}))]),t(fn,null,{default:i(()=>[t(we,{value:L.search,"onUpdate:value":m[2]||(m[2]=le=>L.search=le),placeholder:l(n)("ph_search_content"),style:{width:"200px"},allowClear:"",onChange:ee},null,8,["value","placeholder"]),$.value?(r(),G(se,{key:0,value:L.status,"onUpdate:value":m[3]||(m[3]=le=>L.status=le),placeholder:l(n)("ph_select"),style:{width:"160px"},onChange:ee},{default:i(()=>[t(X,{value:-1},{default:i(()=>[O(u(l(n)("select_all_embed_status")),1)]),_:1}),(r(),y(fe,null,xe(Me,(le,Ue)=>t(X,{key:le,value:Ue},{default:i(()=>[O(u(le),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])):J("",!0),_.value.graph_switch?(r(),G(se,{key:1,value:L.graph_status,"onUpdate:value":m[4]||(m[4]=le=>L.graph_status=le),placeholder:l(n)("ph_select"),onChange:ee,style:{width:"160px"}},{default:i(()=>[t(X,{value:-1},{default:i(()=>[O(u(l(n)("select_all_graph_status")),1)]),_:1}),(r(),y(fe,null,xe(V,(le,Ue)=>t(X,{key:le,value:Ue},{default:i(()=>[O(u(le),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])):J("",!0),t(F,{onClick:mn},{default:i(()=>[O(u(l(n)("btn_modify_metadata")),1)]),_:1}),t($t,null,{overlay:i(()=>[t(me,null,{default:i(()=>[t(Te,{onClick:Yt},{default:i(()=>[O(u(l(n)("btn_re_embed_vectors")),1)]),_:1}),_.value.graph_switch?(r(),G(Te,{key:0,onClick:en},{default:i(()=>[O(u(l(n)("btn_re_extract_graph")),1)]),_:1})):J("",!0),t(Te,{onClick:tn},{default:i(()=>[O(u(l(n)("btn_rename")),1)]),_:1}),h.value==2?(r(),G(Te,{key:1,onClick:nn},{default:i(()=>[O(u(l(n)("btn_set_update_frequency")),1)]),_:1})):J("",!0)]),_:1})]),default:i(()=>[t(F,null,{default:i(()=>[O(u(l(n)("btn_other_operations"))+" ",1),t(l(It))]),_:1})]),_:1}),h.value!=3?(r(),G(F,{key:2,onClick:gt},{default:i(()=>[O(u(l(n)("btn_re_segment")),1)]),_:1})):J("",!0),t(F,{onClick:m[5]||(m[5]=le=>He({})),type:"primary"},{icon:i(()=>[t(l(Ut))]),default:i(()=>[s("span",null,u(l(n)("btn_add_section")),1)]),_:1})]),_:1})]),Q.value?(r(),y("div",Ps,[t(gn)])):(r(),y(fe,{key:1},[$.value?(r(),y(fe,{key:0},[te.value?(r(),G(lt,{key:0,onOpenEditSubscription:He})):(r(),G(Je,{key:1,scrollbar:{minSize:0},onOnScrollEnd:qe},{default:i(()=>[s("div",Fs,[t(ws,{ref:"subsectionBoxRef",total:$e.value,paragraphLists:H.value,search:L.search,detailsInfo:_.value,onOpenEditSubscription:He,onHandleDelParagraph:Ie,onHandleConvert:a,onGetStatrList:D},null,8,["total","paragraphLists","search","detailsInfo"])])]),_:1}))],64)):(r(),y(fe,{key:1},[C.value||h.value==3?(r(),y(fe,{key:0},[te.value?(r(),G(lt,{key:0,onOpenEditSubscription:He})):(r(),G(Je,{key:1,scrollbar:{minSize:0},onOnScrollEnd:qe,disableMouse:!0},{default:i(()=>[s("div",zs,[t(Rt,{ref:"subsectionBoxRef",total:$e.value,detailsInfo:_.value,paragraphLists:H.value,search:L.search,onOpenEditSubscription:He,onHandleDelParagraph:Ie,onHandleConvert:a,onHandleScrollTargetPage:ht,onGetStatrList:D,onHandleSplit:bt,onHandleSplitNext:St,onHandleSplitUp:wt,onHandleSplitDelete:xt,onHandleSegmentation:vt},null,8,["total","detailsInfo","paragraphLists","search"])])]),_:1}))],64)):(r(),y("div",Ds,[s("div",{class:rt(["view-content-wrap",{collapsed:g.value}])},[((qt=_.value)==null?void 0:qt.file_ext)=="pdf"?(r(),y("div",Ns,[t(hn,{value:b.value,"onUpdate:value":m[6]||(m[6]=le=>b.value=le)},{default:i(()=>[t(Ct,{value:1},{default:i(()=>[t(Ze,{placement:"right",title:l(n)("tooltip_original_preview")},{default:i(()=>[O(u(l(n)("radio_original_preview"))+" ",1),b.value==1&&We.value>0?(r(),y("span",Hs,"("+u(tt.value)+" / "+u(We.value)+")",1)):J("",!0)]),_:1},8,["title"])]),_:1}),t(Ct,{value:2},{default:i(()=>[O(u(l(n)("radio_plain_text_preview")),1)]),_:1})]),_:1},8,["value"])])):J("",!0),((Lt=_.value)==null?void 0:Lt.file_ext)=="pdf"?(r(),y("div",As,[t($t,null,{overlay:i(()=>[t(me,{onClick:_n},{default:i(()=>[b.value==1&&We.value>0?(r(),G(Te,{key:1},{default:i(()=>[t(Ze,{placement:"right",title:l(n)("tooltip_re_segment_current_page")},{default:i(()=>[s("div",null,u(l(n)("menu_re_segment_current_page")),1)]),_:1},8,["title"])]),_:1})):J("",!0),(r(),G(Te,{key:2},{default:i(()=>[t(Ze,{placement:"right",title:l(n)("tooltip_re_segment_document")},{default:i(()=>[s("div",null,u(l(n)("menu_re_segment_document")),1)]),_:1},8,["title"])]),_:1})),(r(),G(Te,{key:3},{default:i(()=>[t(Ze,{placement:"right",title:l(n)("tooltip_re_learn_document")},{default:i(()=>[s("div",null,u(l(n)("menu_re_learn_document")),1)]),_:1},8,["title"])]),_:1}))]),_:1})]),default:i(()=>[t(F,null,{default:i(()=>[O(u(l(n)("btn_re_segment"))+" ",1),t(l(It))]),_:1})]),_:1})])):J("",!0),((Ot=_.value)==null?void 0:Ot.file_ext)=="pdf"&&b.value==1?(r(),G(Mo,{key:2,ref_key:"pdfRef",ref:c,class:"scroll-box pdf-render-box",source:_e.value,onSelect:sn,onScroll:cn,onRendered:ln,onGetTotalPage:rn},null,8,["source"])):(r(),G(Je,{key:3,scrollbar:P.value,ref_key:"leftScrollRef",ref:re,class:"scroll-box",onOnScrollEnd:qe},{default:i(()=>[s("div",Bs,[(r(!0),y(fe,null,xe(H.value,(le,Ue)=>(r(),y("div",{class:"list-item",onClick:Et=>R(Ue),key:Ue},[le.question?(r(),y("div",Js,u(le.question),1)):J("",!0),le.answer?(r(),y("div",js,u(le.answer),1)):J("",!0),s("div",{class:"content-box",innerHTML:le.content},null,8,Gs),ct((r(),y("div",Vs,[(r(!0),y(fe,null,xe(le.images,(Et,bn)=>(r(),y("img",{key:bn,src:Et,alt:""},null,8,Ws))),128))])),[[yn]])],8,Us))),128))])]),_:1},8,["scrollbar"]))],2),s("div",Zs,[$.value?J("",!0):(r(),y("div",Qs,[t(kn,{activeKey:L.status,"onUpdate:activeKey":m[7]||(m[7]=le=>L.status=le),style:{"background-color":"#f2f4f7",padding:"0px 16px","border-radius":"6px"},onChange:ee},{default:i(()=>[(r(!0),y(fe,null,xe(De,le=>(r(),G(vn,{key:le.value,tab:`${le.label} (${le.num})`},null,8,["tab"]))),128))]),_:1},8,["activeKey"])])),te.value?(r(),G(lt,{key:1,onOpenEditSubscription:He})):(r(),G(Je,{key:2,scrollbar:P.value,disableMouse:!0,ref_key:"rightScrollRef",ref:he,onOnScrollEnd:qe},{default:i(()=>[s("div",Ks,[t(Rt,{ref:"subsectionBoxRef",total:$e.value,detailsInfo:_.value,paragraphLists:H.value,search:L.search,onOpenEditSubscription:He,onHandleDelParagraph:Ie,onHandleConvert:a,onHandleScrollTargetPage:ht,onGetStatrList:D,onHandleSplit:bt,onHandleSplitNext:St,onHandleSplitUp:wt,onHandleSplitDelete:xt,onHandleSegmentation:vt},null,8,["total","detailsInfo","paragraphLists","search"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),t(ua,{detailsInfo:_.value,onHandleEdit:Se,ref_key:"editSubscriptionRef",ref:pt},null,8,["detailsInfo"]),t(Lo,{onOk:an,ref_key:"updateFrequencyRef",ref:mt},null,512),t(pa,{onOk:on,ref_key:"renameModalRef",ref:ft},null,512),t(Ko,{onOk:un,onEnable:kt,detailsInfo:_.value,ref_key:"reSegmentationPageRef",ref:at},null,8,["detailsInfo"]),t(Cs,{ref_key:"segmentationSettingModalRef",ref:ot,onOk:U},null,512),t(ma,{ref_key:"metaRef",ref:q,"library-id":_.value.library_id,"file-id":l(N).query.id},null,8,["library-id","file-id"])])}}},$l=Le(Xs,[["__scopeId","data-v-dee02a76"]]);export{$l as default};
//# sourceMappingURL=library-preview-Boo6hNMO.js.map
