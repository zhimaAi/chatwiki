import{j as t,N as m,O as i,X as e,a6 as R,Z as C,_ as U,V as ve,S as V,U as l,Y as ct,a5 as we,d as S,a as W,z as F,b as oe,H as ce,I as ue,u as x,G as Z,a3 as Ge,F as B,a1 as K,w as _e,k as He,q as ke,o as ut,h as qe,ae as me,af as ye,W as Ke,D as pt,a0 as mt,x as We,aa as vt,a8 as ft,p as bt}from"./vue-chunks-BRsu9_To.js";import{I as ht,b as J,d as pe,B as ie,aC as yt,ac as Be,W as kt,M as te,k as Y,aq as gt,au as xt,at as fe,aD as $t,aE as wt,e as qt,a1 as St,aF as Ue,E as Oe,h as Ct,aB as Lt}from"../../index-CzPebXix.js";import{_ as ge}from"./index-BhUXTHsq.js";import{C as It}from"./cu-upload-5lnT3jd_.js";import{u as Ze}from"./robot-CF9aQwVH.js";import{_ as Ut}from"./index-BFhVTGQQ.js";import{I as xe}from"./Input-DFtZp9vk.js";import{_ as $e}from"./TextArea-DrgXbuSS.js";import{j as Rt,k as Et,g as Ot,l as jt}from"./index-jmRHMddk.js";import{T as Mt}from"./index-BukWVUqX.js";import{S as Ye}from"./index-0UwCX3b0.js";import{I as At}from"./index-DgmRyc91.js";import{F as je,_ as Xe}from"./index-BgVvqN-n.js";import{S as Me,a as Ae,i as Vt}from"./index-6HDf6TPN.js";import{_ as et,T as tt}from"./index-YQhVm4Ni.js";import{D as zt}from"./DownloadOutlined-CeWsYko2.js";import{P as Re}from"./PlusOutlined-BlmIiILr.js";import{D as ot}from"./DownOutlined-DXKkgIsm.js";import{U as Dt}from"./UpOutlined-B_3G2J2r.js";import{_ as se}from"./index-BwqnaIPU.js";import{_ as ne}from"./index-Bpi-EtQQ.js";import{h as st}from"./index-BfxXXGE8.js";import{C as Pt}from"./index-DGkdJwWs.js";import"./index-Di5l0R3t.js";import{_ as Ve,R as ze}from"./RadioButton-h1wW1k6O.js";import{Q as ee}from"./QuestionCircleOutlined-DTfTQPH4.js";import{_ as nt}from"./index-BYnTYknl.js";import{_ as Se}from"./index-B_XKw_Lk.js";import{_ as Nt,a as Tt}from"./index-C5-M_Gan.js";import{L as Bt}from"./library-select-alert-DTzpsc35.js";import{_ as Ft}from"./recommendation-AQ4_FPQ9.js";import{_ as it}from"./cu-scroll-ufyFyI_5.js";import{R as Jt}from"./RightOutlined-DH_YROnp.js";import{_ as Qt}from"./index-CBmR-lHY.js";import{g as lt}from"./index-B9BKV930.js";import{_ as Gt}from"./empty-CzGZrENG.js";import{_ as Ht,C as Kt}from"./index-DLRiQ5Ho.js";import{d as De}from"./vuedraggable.umd-CIIT_a56.js";import{M as Wt}from"./model-select-BRz1sNBY.js";import{E as at}from"./EditOutlined-D08WQbiX.js";import{_ as Zt}from"./index-Bd3BpNCC.js";import{i as Yt,e as Xt,f as eo}from"./index-8giw5C6U.js";import{A as to}from"./add-collaborator-BR7hw7EX.js";import{A as oo}from"./index-D__t4QkP.js";import{U as Fe}from"./UserOutlined-E0XEmwFB.js";import{C as Ee}from"./CheckOutlined-Mk6nTpyE.js";import{E as so}from"./Password-fnCqxsm2.js";import{_ as no}from"./index-Dhmpqx9n.js";import{a as io}from"./index-Bh3NMpRp.js";import{R as lo}from"./robot-select-alert-BGvPic04.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-B2RmG14m.js";import"./index-Bxqtz4sn.js";import"./Search-Cf7bcOZJ.js";import"./SearchOutlined-a_gTycfl.js";import"./isPlainObject-OEy0Jz8l.js";import"./inputProps-jdR54afw.js";import"./index-Bhf8G0AA.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./colors-DfoziJR7.js";import"./SyncOutlined-BnnoShgX.js";import"./Trigger-Bvakuge0.js";import"./Col-CFxRRwN8.js";import"./responsiveObserve-DqAe0rZk.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-CsbPJG8I.js";import"./List-D7uk7Chm.js";import"./useMergedState-C0iIHNGF.js";import"./move-CkiYyFmr.js";import"./index-DlQVT6K6.js";import"./shallowequal-C0xnIuy8.js";import"./dropdown-DTOAy9tU.js";import"./useRefs-CRRjy_qY.js";import"./pick-Sm8BXOZJ.js";import"./Checkbox-oqMTsvET.js";import"./LeftOutlined-BKUTcRtP.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-BhHQj-ne.js";import"./index-BYVEo4R0.js";import"./CaretDownFilled-DSht_iiA.js";import"./index-BSz5XTfh.js";import"./CaretDownOutlined-Byn8iz8T.js";var ao={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function Je(A){for(var _=1;_<arguments.length;_++){var k=arguments[_]!=null?Object(arguments[_]):{},d=Object.keys(k);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(k).filter(function(r){return Object.getOwnPropertyDescriptor(k,r).enumerable}))),d.forEach(function(r){ro(A,r,k[r])})}return A}function ro(A,_,k){return _ in A?Object.defineProperty(A,_,{value:k,enumerable:!0,configurable:!0,writable:!0}):A[_]=k,A}var Pe=function(_,k){var d=Je({},_,k.attrs);return t(ht,Je({},d,{icon:ao}),null)};Pe.displayName="ToTopOutlined";Pe.inheritAttrs=!1;const _o={class:"edit-box-header"},co={class:"left-box"},uo={class:"edit-box-title"},po={key:0},mo={key:0,class:"title-tip"},vo={class:"right-box"},fo={class:"extra-box"},bo={class:"actions-box"},ho={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(A,{emit:_}){const k=_,d=A,r=n=>{k("edit"),k("update:isEdit",n)},s=()=>{k("save")};return(n,f)=>{const b=pe,a=ie,$=ge;return i(),m("div",{class:we(["edit-box",{"is-edit":A.isEdit}])},[e("div",_o,[e("div",co,[t(b,{class:"edit-box-icon",name:d.iconName},null,8,["name"]),e("span",uo,[C(U(d.title)+" ",1),n.$slots.icon?(i(),m("span",po,[ve(n.$slots,"icon",{},void 0,!0)])):R("",!0)]),n.$slots.tip?(i(),m("span",mo,[ve(n.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",vo,[e("div",fo,[ve(n.$slots,"extra",{},()=>[e("div",bo,[d.isEdit?(i(),V($,{key:0,gap:8},{default:l(()=>[t(a,{onClick:s,size:"small",type:"primary"},{default:l(()=>f[2]||(f[2]=[C("保存")])),_:1,__:[2]}),t(a,{onClick:f[0]||(f[0]=c=>r(!1)),size:"small"},{default:l(()=>f[3]||(f[3]=[C("取消")])),_:1,__:[3]})]),_:1})):(i(),V(a,{key:1,onClick:f[1]||(f[1]=c=>r(!0)),size:"small"},{default:l(()=>f[4]||(f[4]=[C("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:ct({...A.bodyStyle})},[ve(n.$slots,"default",{},void 0,!0)],4)],2)}}},X=J(ho,[["__scopeId","data-v-dbe09743"]]),yo={class:"robot-form-box"},ko={class:"form-item"},go={class:"form-item-body robot-name-item"},xo={class:"robot-avetar-upload"},$o=["src"],wo={class:"robot-name-box"},qo={class:"form-item"},So={class:"form-item-body"},Co={class:"robot-info-box"},Lo={class:"robot-name-box"},Io=["src"],Uo={class:"robot-name"},Ro={class:"robot-intro"},Eo={__name:"basic-config",setup(A){const _=Ze(),k=S(!1),{robotInfo:d,updateRobotInfo:r}=W("robotInfo"),s=F({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=oe(()=>_.robotList||[]),f=oe(()=>_.robotGroupList||[]),b=oe(()=>{let u="未分组",o=n.value.find(p=>p.id==d.id)||{};if(o.group_id>0){let p=f.value.find(y=>y.id==o.group_id);p&&(u=p.group_name)}return u}),a=()=>{r({...Z(s)}),k.value=!1},$=u=>{let o=u[0];return s.robot_avatar=o,yt(o).then(p=>{s.robot_avatar_url=p}),!1},c=()=>{s.robot_name=d.robot_name,s.robot_intro=d.robot_intro,s.robot_avatar=d.robot_avatar,s.robot_avatar_url=d.robot_avatar_url};return(u,o)=>{const p=xe,y=$e;return i(),V(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:k.value,"onUpdate:isEdit":o[2]||(o[2]=L=>k.value=L),onSave:a,onEdit:c},{default:l(()=>[ce(e("div",yo,[e("div",ko,[o[3]||(o[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",go,[t(It,{accept:"image/*",onChange:$},{default:l(()=>[e("div",xo,[s.robot_avatar_url?(i(),m("img",{key:0,class:"robot-avetar",src:s.robot_avatar_url},null,8,$o)):R("",!0)])]),_:1}),e("div",wo,[t(p,{value:s.robot_name,"onUpdate:value":o[0]||(o[0]=L=>s.robot_name=L),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",qo,[o[4]||(o[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",So,[t(y,{rows:3,value:s.robot_intro,"onUpdate:value":o[1]||(o[1]=L=>s.robot_intro=L),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ue,k.value]]),ce(e("div",Co,[e("div",Lo,[e("img",{class:"robot-avatar",src:x(d).robot_avatar_url,alt:""},null,8,Io),e("span",Uo,U(x(d).robot_name),1)]),e("div",Ro,[e("span",null,"分组："+U(b.value),1),e("span",null,"简介："+U(x(d).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[ue,!k.value]])]),_:1},8,["isEdit"])}}},Oo=J(Eo,[["__scopeId","data-v-7fc4a51d"]]),jo={class:"ai-create-box"},Mo={class:"input-box"},Ao={key:1},Vo={key:2},zo={class:"quick-tags-box"},Do={class:"ai-list-box"},Po={key:0,class:"loading-box"},No={key:0,class:"prompt-list-box"},To={class:"prompt-list"},Bo={class:"prompt-header"},Fo={class:"prompt-title"},Jo={class:"prompt-content"},Qo={class:"prompt-list"},Go={class:"prompt-header"},Ho={class:"prompt-title"},Ko={class:"prompt-content"},Wo={class:"prompt-list"},Zo={class:"prompt-header"},Yo={class:"prompt-title"},Xo={class:"prompt-content"},es={class:"prompt-list"},ts={class:"prompt-header"},os={class:"prompt-title"},ss={class:"prompt-content"},ns={class:"prompt-list"},is={class:"prompt-header"},ls={class:"prompt-title"},as={class:"prompt-content"},rs={class:"prompt-header"},ds={class:"prompt-title"},_s={class:"prompt-content"},cs={key:1,class:"empty-box"},us={__name:"ai-create-prompt",emits:["handleAiSave"],setup(A,{expose:_,emit:k}){const d=Be.PRESENTED_IMAGE_SIMPLE,r=S(!1),s=S(!1),n=Ge().query,f=k,b=S(""),a=S(!1),$=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],c=S("在上方输入框输入要求，点击生成提示词"),u=()=>{o.value=!1,y.promptStruct=p,b.value="",c.value="在上方输入框输入要求，点击生成提示词",r.value=!0},o=S(!1),p={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},y=F({promptStruct:p}),L=j=>{b.value=j},h=()=>{if(!b.value)return Y.error("请输入AI 生成提示词");if(a.value)return Y.error("正在生成中...");a.value=!0,Rt({id:n.id,demand:b.value}).then(j=>{y.promptStruct=JSON.parse(j.data.promptStruct),o.value=!0}).finally(()=>{a.value=!1}).catch(j=>{o.value=!1,c.value=j.msg})},I=()=>{if(!o.value)return Y.error("请先生成提示词");f("handleAiSave",y.promptStruct),r.value=!1};return _({show:u}),(j,v)=>{const q=ie,P=$e,z=pe,w=Mt,H=Ye,O=Be,D=te;return i(),m("div",null,[t(D,{open:r.value,"onUpdate:open":v[1]||(v[1]=E=>r.value=E),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:l(()=>[t(q,{type:"primary",loading:s.value,onClick:I},{default:l(()=>v[2]||(v[2]=[C("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:l(()=>[e("div",jo,[e("div",Mo,[t(P,{style:{width:"100%"},value:b.value,"onUpdate:value":v[0]||(v[0]=E=>b.value=E),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:we(["btn-box",{"disabed-status":a.value}]),onClick:h},[a.value?(i(),V(x(kt),{key:0})):R("",!0),t(z,{name:"ai-mark"}),a.value?(i(),m("span",Ao,"生成中...")):(i(),m("span",Vo,"生成"))],2)]),e("div",zo,[v[3]||(v[3]=e("div",{class:"quick-label"},"快捷生成：",-1)),(i(),m(B,null,K($,E=>t(w,{key:E.title,onClick:Q=>L(E.title),color:"blue"},{default:l(()=>[C(U(E.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Do,[a.value?(i(),m("div",Po,[t(H,{tip:"正在生成中..."})])):(i(),m(B,{key:1},[o.value?(i(),m("div",No,[e("div",To,[e("div",Bo,[e("div",Fo,U(y.promptStruct.role.subject),1)]),e("div",Jo,U(y.promptStruct.role.describe),1)]),e("div",Qo,[e("div",Go,[e("div",Ho,U(y.promptStruct.task.subject),1)]),e("div",Ko,U(y.promptStruct.task.describe),1)]),e("div",Wo,[e("div",Zo,[e("div",Yo,U(y.promptStruct.constraints.subject),1)]),e("div",Xo,U(y.promptStruct.constraints.describe),1)]),e("div",es,[e("div",ts,[e("div",os,U(y.promptStruct.output.subject),1)]),e("div",ss,U(y.promptStruct.output.describe),1)]),e("div",ns,[e("div",is,[e("div",ls,U(y.promptStruct.tone.subject),1)]),e("div",as,U(y.promptStruct.tone.describe),1)]),(i(!0),m(B,null,K(y.promptStruct.custom,(E,Q)=>(i(),m("div",{class:"prompt-list",key:Q+E.key?E.key:""},[e("div",rs,[e("div",ds,U(E.subject),1)]),e("div",_s,U(E.describe),1)]))),128))])):(i(),m("div",cs,[t(O,{image:x(d),description:c.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},ps=J(us,[["__scopeId","data-v-abe0e674"]]),ms={__name:"upload-prompt",setup(A,{expose:_}){const k=S(!1),d=F({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),r=S(null),s=$=>{if($.prompt_type==0&&!$.prompt)return Y.error("自定义提示为空,无法上传");r.value&&r.value.resetFields();let c={...$};d.title="",d.group_id=0,d.prompt="",d.prompt_struct={},d.prompt_type=c.prompt_type,c.prompt_type==0?d.prompt=c.prompt:d.prompt_struct=JSON.stringify(c.prompt_struct),k.value=!0},n=S([]);(()=>{gt().then($=>{n.value=[{id:0,group_name:"默认分组"},...$.data]})})();const b=S(!1),a=()=>{r.value.validate().then(()=>{let $={...d};b.value=!0,xt({...$}).then(()=>{Y.success("保存成功"),k.value=!1}).finally(()=>{b.value=!1})})};return _({show:s}),($,c)=>{const u=xe,o=Xe,p=Ae,y=Me,L=je,h=te;return i(),m("div",null,[t(h,{open:k.value,"onUpdate:open":c[2]||(c[2]=I=>k.value=I),title:"保存到提示词库",width:580,onOk:a,confirmLoading:b.value},{default:l(()=>[t(L,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:r,model:d},{default:l(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:l(()=>[t(u,{value:d.title,"onUpdate:value":c[0]||(c[0]=I=>d.title=I),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:l(()=>[t(y,{value:d.group_id,"onUpdate:value":c[1]||(c[1]=I=>d.group_id=I),style:{width:"100%"}},{default:l(()=>[(i(!0),m(B,null,K(n.value,I=>(i(),V(p,{value:I.id},{default:l(()=>[C(U(I.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},vs={class:"prompt-box"},fs={class:"tab-header"},bs={key:0,class:"opt-block"},hs={key:1,class:"opt-block"},ys={class:"tip-text"},ks={key:0,class:"prompt-list-box"},gs={class:"prompt-list"},xs={class:"prompt-header"},$s={class:"prompt-title"},ws={key:0,class:"btn-wrapper-box"},qs={class:"prompt-content"},Ss={class:"prompt-list"},Cs={class:"prompt-header"},Ls={class:"prompt-title"},Is={key:0,class:"btn-wrapper-box"},Us={class:"prompt-content"},Rs={class:"prompt-list"},Es={class:"prompt-header"},Os={class:"prompt-title"},js={key:0,class:"btn-wrapper-box"},Ms={class:"prompt-content"},As={class:"prompt-list"},Vs={class:"prompt-header"},zs={class:"prompt-title"},Ds={key:0,class:"btn-wrapper-box"},Ps={class:"prompt-content"},Ns={class:"prompt-list"},Ts={class:"prompt-header"},Bs={class:"prompt-title"},Fs={key:0,class:"btn-wrapper-box"},Js={class:"swich-item"},Qs={class:"swich-item"},Gs={class:"prompt-content"},Hs={class:"prompt-list"},Ks={class:"prompt-header"},Ws={class:"prompt-title"},Zs={key:0,class:"btn-wrapper-box"},Ys={class:"prompt-content"},Xs={class:"prompt-header"},en={class:"prompt-title",style:{flex:"1"}},tn={key:0,class:"btn-wrapper-box"},on=["onClick"],sn={class:"prompt-content"},nn={key:0,class:"add-theme-block"},ln={class:"show-more-block"},an={key:1,class:"diy-prompt-box"},rn={key:0,class:"diy-switch-box"},dn={class:"swich-item"},_n={class:"swich-item"},re="- 请使用markdown格式回答问题。",de="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",cn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(A){const _=S(!1),{robotInfo:k,updateRobotInfo:d}=W("robotInfo"),r=A;let s={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const n=S({}),f=S(!1),b=S(!1),a=S(!1),$=S(!1),c=F({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),u=S(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{u.value=!u.value,localStorage.setItem("system_prompt_words_ishide",u.value?1:0)},p=(T,g)=>T.includes(g),y=S(k.prompt_type);_e(()=>k,()=>{c.prompt=k.prompt,c.prompt_struct=k.prompt_struct,n.value=k.prompt_struct_default},{immediate:!0,deep:!0}),_e(()=>c.prompt_struct.output.describe,T=>{f.value=p(T,re),b.value=p(T,de)},{immediate:!0,deep:!0}),_e(()=>c.prompt,T=>{a.value=p(T,re),$.value=p(T,de)},{immediate:!0,deep:!0});const L=(T,g)=>{T?(g=="outSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+re:c.prompt_struct.output.describe+=re),g=="imgSwitch"&&(c.prompt_struct.output.describe?c.prompt_struct.output.describe+=`
`+de:c.prompt_struct.output.describe+=de)):(g=="outSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(re,"g"),"")),g=="imgSwitch"&&(c.prompt_struct.output.describe=c.prompt_struct.output.describe.replace(new RegExp(de,"g"),"")),c.prompt_struct.output.describe=c.prompt_struct.output.describe.trim())},h=(T,g)=>{T?(g=="outDiySwitch"&&(c.prompt?c.prompt+=`
`+re:c.prompt+=re),g=="imgDiySwitch"&&(c.prompt?c.prompt+=`
`+de:c.prompt+=de)):(g=="outDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(re,"g"),"")),g=="imgDiySwitch"&&(c.prompt=c.prompt.replace(new RegExp(de,"g"),"")),c.prompt=c.prompt.trim())},I=T=>{c.prompt_struct[T].describe=n.value[T].describe},j=()=>{let T=k.work_flow_ids.split(","),g=r.robotList.filter(he=>T.includes(he.id)),N=[];N=g.map(he=>`- ${he.robot_name} ${he.robot_intro}`).join(`
`),c.prompt_struct.skill.describe=N},v=()=>{c.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),y.value=1},q=T=>{c.prompt_struct.custom.splice(T,1)},P=()=>{d({...Z(c),prompt_type:y.value}),_.value=!1},z=T=>{y.value=1,d({prompt_type:y.value,prompt:c.prompt,prompt_struct:T}),_.value=!1},w=()=>{_.value=!0},H=()=>{_.value=!1},O=S(null),D=()=>{O.value.show()},E=S(null),Q=()=>{E.value.show()},G=S(null),le=()=>{G.value.show({...c,prompt_type:y.value})},be=T=>{T.prompt_type==1?(y.value=1,c.prompt_struct=T.prompt_struct):(y.value=0,c.prompt=T.prompt),P()};return(T,g)=>{const N=et,he=tt,Ne=se,rt=pe,Ce=ie,dt=ge,ae=$e,Le=ne,_t=xe;return i(),m("div",vs,[e("div",fs,[t(he,{activeKey:y.value,"onUpdate:activeKey":g[0]||(g[0]=M=>y.value=M)},{default:l(()=>[(i(),V(N,{key:1,tab:"结构化提示词"})),(i(),V(N,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),_.value?(i(),m("div",bs,[t(Ne,null,{title:l(()=>g[22]||(g[22]=[C("将当前编辑的提示词保存到提示词库中")])),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:le},[t(x(Pe)),g[23]||(g[23]=C("上传 "))])]),_:1}),t(Ne,null,{title:l(()=>g[24]||(g[24]=[C("从提示词库导入提示词")])),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Q},[t(x(zt)),g[25]||(g[25]=C("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:D},[t(rt,{name:"ai-mark"}),g[26]||(g[26]=C(" AI自动生成 "))]),t(dt,{gap:8},{default:l(()=>[t(Ce,{size:"small",type:"primary",onClick:P},{default:l(()=>g[27]||(g[27]=[C("保存")])),_:1,__:[27]}),t(Ce,{size:"small",onClick:H},{default:l(()=>g[28]||(g[28]=[C("取消")])),_:1,__:[28]})]),_:1})])):(i(),m("div",hs,[e("span",ys,"当前类型："+U(y.value==1?"结构化提示词":"自定义提示词"),1),t(Ce,{size:"small",onClick:w},{default:l(()=>g[29]||(g[29]=[C("修改")])),_:1,__:[29]})]))]),y.value==1?(i(),m("div",ks,[e("div",gs,[e("div",xs,[e("div",$s,U(c.prompt_struct.role.subject),1),_.value?(i(),m("div",ws,[e("a",{onClick:g[1]||(g[1]=M=>I("role"))},"恢复默认")])):R("",!0)]),e("div",qs,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.role.describe,"onUpdate:value":g[2]||(g[2]=M=>c.prompt_struct.role.describe=M),placeholder:x(s).role},null,8,["disabled","value","placeholder"])])]),e("div",Ss,[e("div",Cs,[e("div",Ls,U(c.prompt_struct.task.subject),1),_.value?(i(),m("div",Is,[e("a",{onClick:g[3]||(g[3]=M=>I("task"))},"恢复默认")])):R("",!0)]),e("div",Us,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.task.describe,"onUpdate:value":g[4]||(g[4]=M=>c.prompt_struct.task.describe=M),placeholder:x(s).task},null,8,["disabled","value","placeholder"])])]),u.value?(i(),m(B,{key:0},[e("div",Rs,[e("div",Es,[e("div",Os,U(c.prompt_struct.constraints.subject),1),_.value?(i(),m("div",js,[e("a",{onClick:g[5]||(g[5]=M=>I("constraints"))},"恢复默认")])):R("",!0)]),e("div",Ms,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.constraints.describe,"onUpdate:value":g[6]||(g[6]=M=>c.prompt_struct.constraints.describe=M),placeholder:x(s).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",As,[e("div",Vs,[e("div",zs,U(c.prompt_struct.skill.subject),1),_.value?(i(),m("div",Ds,[e("a",{onClick:g[7]||(g[7]=M=>j())},"自动导入技能")])):R("",!0)]),e("div",Ps,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.skill.describe,"onUpdate:value":g[8]||(g[8]=M=>c.prompt_struct.skill.describe=M),placeholder:x(s).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",Ns,[e("div",Ts,[e("div",Bs,U(c.prompt_struct.output.subject),1),_.value?(i(),m("div",Fs,[e("div",Js,[g[30]||(g[30]=C(" 输出markdown： ")),t(Le,{onChange:g[9]||(g[9]=M=>L(M,"outSwitch")),checked:f.value,"onUpdate:checked":g[10]||(g[10]=M=>f.value=M),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Qs,[g[31]||(g[31]=C(" 回复图片： ")),t(Le,{onChange:g[11]||(g[11]=M=>L(M,"imgSwitch")),checked:b.value,"onUpdate:checked":g[12]||(g[12]=M=>b.value=M),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:g[13]||(g[13]=M=>I("output"))},"恢复默认")])):R("",!0)]),e("div",Gs,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.output.describe,"onUpdate:value":g[14]||(g[14]=M=>c.prompt_struct.output.describe=M),placeholder:x(s).output},null,8,["disabled","value","placeholder"])])]),e("div",Hs,[e("div",Ks,[e("div",Ws,U(c.prompt_struct.tone.subject),1),_.value?(i(),m("div",Zs,[e("a",{onClick:g[15]||(g[15]=M=>I("tone"))},"恢复默认")])):R("",!0)]),e("div",Ys,[t(ae,{bordered:!1,disabled:!_.value,value:c.prompt_struct.tone.describe,"onUpdate:value":g[16]||(g[16]=M=>c.prompt_struct.tone.describe=M),placeholder:x(s).tone},null,8,["disabled","value","placeholder"])])]),(i(!0),m(B,null,K(c.prompt_struct.custom,(M,Te)=>(i(),m("div",{class:"prompt-list",key:Te+M.key?M.key:""},[e("div",Xs,[e("div",en,[t(_t,{bordered:!1,disabled:!_.value,style:{width:"100%"},value:M.subject,"onUpdate:value":Ie=>M.subject=Ie,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),_.value?(i(),m("div",tn,[e("div",{class:"hover-btn-box",onClick:Ie=>q(Te)},[t(x(fe))],8,on)])):R("",!0)]),e("div",sn,[t(ae,{bordered:!1,disabled:!_.value,value:M.describe,"onUpdate:value":Ie=>M.describe=Ie,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),_.value?(i(),m("div",nn,[t(Ce,{onClick:v,block:"",icon:He(x(Re))},{default:l(()=>g[32]||(g[32]=[C("添加主题")])),_:1,__:[32]},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",ln,[e("div",{class:"btn-item",onClick:o},[u.value?(i(),m(B,{key:1},[g[34]||(g[34]=C("收起")),t(x(Dt))],64)):(i(),m(B,{key:0},[g[33]||(g[33]=C("展开")),t(x(ot))],64))])])])):(i(),m("div",an,[_.value?(i(),m("div",rn,[e("div",dn,[g[35]||(g[35]=C(" 输出markdown： ")),t(Le,{size:"small",onChange:g[17]||(g[17]=M=>h(M,"outDiySwitch")),checked:a.value,"onUpdate:checked":g[18]||(g[18]=M=>a.value=M),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",_n,[g[36]||(g[36]=C(" 回复图片： ")),t(Le,{size:"small",onChange:g[19]||(g[19]=M=>h(M,"imgDiySwitch")),checked:$.value,"onUpdate:checked":g[20]||(g[20]=M=>$.value=M),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):R("",!0),t(ae,{bordered:_.value,value:c.prompt,"onUpdate:value":g[21]||(g[21]=M=>c.prompt=M),disabled:!_.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(ps,{onHandleAiSave:z,ref_key:"aiCreatePromptRef",ref:O},null,512),t(At,{onOk:be,ref_key:"importPromptRef",ref:E},null,512),t(ms,{ref_key:"uploadPromptRef",ref:G},null,512)])}}},un=J(cn,[["__scopeId","data-v-c1235ef1"]]),pn={class:"actions-box"},mn={class:"setting-info-block"},vn={class:"set-item w-100"},fn={key:0,class:"set-item-content"},bn=["src"],hn={key:1},yn={class:"set-item"},kn={class:"set-item"},gn={class:"set-item"},xn={class:"set-item"},$n={class:"form-box"},wn={class:"form-item"},qn={class:"form-item-body"},Sn={class:"form-item",style:{display:"flex","align-items":"center"}},Cn={class:"form-item"},Ln={class:"form-item-label"},In={class:"form-item-body"},Un={class:"number-box"},Rn={class:"number-slider-box"},En={class:"number-input-box"},On={class:"form-item"},jn={class:"form-item-label"},Mn={class:"form-item-body"},An={class:"number-box"},Vn={class:"number-slider-box"},zn={class:"number-input-box"},Dn={class:"form-item"},Pn={class:"form-item-label"},Nn={class:"form-item-body"},Tn={class:"number-box"},Bn={class:"number-slider-box"},Fn={class:"number-input-box"},Jn={class:"form-item justify-between"},Qn={class:"form-item-label"},Gn={class:"form-item justify-between"},Hn={class:"form-item-label"},Kn={__name:"model-settings",setup(A){const _=["azure","ollama","xinference","openaiAgent","doubao"],k=["doubao"],d=["azure"],r=F({sm:24,md:24,lg:12,xl:24,xxl:24}),s=S([]),n=S(!1),{robotInfo:f,updateRobotInfo:b}=W("robotInfo"),a=F({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0}),$=S(""),c=S(""),u=S(""),o=z=>{a.use_model=_.includes(z.rawData.model_define)&&z.rawData.deployment_name?z.rawData.show_model_name||z.rawData.deployment_name:z.rawData.name,a.use_model_icon=z.icon,a.use_model_name=z.use_model_name,a.model_config_id=z.rawData.id,$.value=z.rawData.model_define,a.use_model&&a.use_model.toLowerCase().includes("deepseek-r1")?a.prompt_role_type="1":a.prompt_role_type="0"},p=S({}),y=(z,w)=>{p.value=w},L=oe(()=>{if(!a.model_config_id)return!1;let z=a.model_config_id+"#"+a.use_model;return p.value[z]}),h=S(!1),I=z=>{z.target.closest(".custom-select")||(h.value=!1)};ke(()=>{_.indexOf($.value)>-1?a.use_model=u.value:a.use_model=f.use_model,document.addEventListener("click",I)}),ut(()=>{document.removeEventListener("click",I)});const j=()=>{u.value=a.use_model;let z={...Z(a)};d.indexOf($.value)>-1&&(z.use_model="默认"),b(z),n.value=!1},v=z=>{_.indexOf($.value)>-1?a.use_model=u.value:a.use_model=f.use_model,a.model_config_id=f.model_config_id,a.temperature=f.temperature,a.max_token=f.max_token,a.context_pair=f.context_pair,a.think_switch=Number(f.think_switch),a.prompt_role_type=f.prompt_role_type,a.enable_thinking=f.enable_thinking,n.value=z};qe(()=>{a.model_config_id=f.model_config_id,a.temperature=f.temperature,a.max_token=f.max_token,a.context_pair=f.context_pair,a.think_switch=Number(f.think_switch),a.prompt_role_type=f.prompt_role_type,a.enable_thinking=f.enable_thinking});function q(z,w,H){const O=new Set(z.map(D=>D.model_define));return w.filter(D=>{let E=D[H];O.has(E)&&z.filter(Q=>{if(Q.model_define==E)return Q.children=wt(Q.children,D.children),!1})}),z}return(()=>{st({model_type:"LLM"}).then(z=>{u.value=f.use_model;let w=z.data||[],H=[];s.value=w.map(O=>{H=[];for(let D=0;D<O.model_info.llm_model_list.length;D++){const E=O.model_info.llm_model_list[D];_.indexOf(O.model_info.model_define)>-1&&f.model_config_id==O.model_config.id&&(u.value=O.model_config.show_model_name||O.model_config.deployment_name,$.value=O.model_info.model_define,c.value=O.model_info.model_define),H.push({name:E,deployment_name:O.model_config.deployment_name,show_model_name:k.includes(O.model_info.model_define)?O.model_config.show_model_name:"",id:O.model_config.id,model_define:O.model_info.model_define,icon:O.model_info.model_icon_url,use_model_name:O.model_info.model_name})}return{id:O.model_config.id,name:O.model_info.model_name,model_define:O.model_info.model_define,icon:O.model_info.model_icon_url,children:H,deployment_name:O.model_config.deployment_name}}),s.value=q($t(s.value,"model_define"),s.value,"model_define"),f.use_model&&f.model_config_id&&s.value.some(O=>O.children.some(D=>{const E=_.includes(D.model_define)&&D.deployment_name?D.deployment_name:D.name;if(_.includes(D.model_define)&&D.deployment_name&&D.id===f.model_config_id)return a.use_model_icon=D.icon,a.use_model_name=D.use_model_name,a.use_model=D.show_model_name||D.deployment_name,!0;if(E===f.use_model&&D.id===f.model_config_id)return a.use_model_icon=D.icon,a.use_model_name=D.use_model_name,!0}))})})(),(z,w)=>{const H=ie,O=Tt,D=ze,E=Ve,Q=se,G=nt,le=Se,be=ne,T=Nt,g=te;return i(),V(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:n.value,"onUpdate:isEdit":w[12]||(w[12]=N=>n.value=N)},{extra:l(()=>[e("div",pn,[t(H,{onClick:w[0]||(w[0]=N=>v(!0)),size:"small"},{default:l(()=>w[13]||(w[13]=[C("修改")])),_:1,__:[13]})])]),default:l(()=>[e("div",mn,[e("div",vn,[w[14]||(w[14]=C(" LLM模型： ")),a.use_model_icon&&a.use_model_name?(i(),m("span",fn,[e("img",{src:a.use_model_icon,class:"model-icon"},null,8,bn),C(U(a.use_model_name)+" "+U(a.use_model),1)])):(i(),m("span",hn,U(a.use_model),1))]),e("div",yn,[w[15]||(w[15]=C(" 温度： ")),e("span",null,U(a.temperature),1)]),e("div",kn,[w[16]||(w[16]=C(" 最大token： ")),e("span",null,U(a.max_token),1)]),e("div",gn,[w[17]||(w[17]=C(" 上下文数量： ")),e("span",null,U(a.context_pair),1)]),e("div",xn,[w[18]||(w[18]=C(" 显示推理过程： ")),e("span",null,U(a.think_switch==1?"开":"关"),1)])]),t(g,{open:n.value,"onUpdate:open":w[11]||(w[11]=N=>n.value=N),width:672,title:"模型设置",onOk:j},{default:l(()=>[e("div",$n,[t(T,{gutter:[32,24]},{default:l(()=>[t(O,me(ye(r)),{default:l(()=>[e("div",wn,[w[19]||(w[19]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",qn,[t(Pt,{modelValue:a.use_model,"onUpdate:modelValue":w[1]||(w[1]=N=>a.use_model=N),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:o,onLoaded:y},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(O,me(ye(r)),{default:l(()=>[e("div",Sn,[w[22]||(w[22]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[t(E,{value:a.prompt_role_type,"onUpdate:value":w[2]||(w[2]=N=>a.prompt_role_type=N)},{default:l(()=>[t(D,{value:"0"},{default:l(()=>w[20]||(w[20]=[C("系统角色（System）")])),_:1,__:[20]}),t(D,{value:"1"},{default:l(()=>w[21]||(w[21]=[C("用户角色（User）")])),_:1,__:[21]})]),_:1},8,["value"])])])]),_:1},16),t(O,me(ye(r)),{default:l(()=>[e("div",Cn,[e("div",Ln,[w[24]||(w[24]=e("span",null,"温度 ",-1)),t(Q,null,{title:l(()=>w[23]||(w[23]=[C("温度越低，回答越严谨。温度越高，回答越发散。")])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",In,[e("div",Un,[e("div",Rn,[t(G,{class:"custom-slider",value:a.temperature,"onUpdate:value":w[3]||(w[3]=N=>a.temperature=N),min:0,max:2,step:.1},null,8,["value"])]),e("div",En,[t(le,{value:a.temperature,"onUpdate:value":w[4]||(w[4]=N=>a.temperature=N),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(O,me(ye(r)),{default:l(()=>[e("div",On,[e("div",jn,[w[26]||(w[26]=e("span",null,"最大token ",-1)),t(Q,null,{title:l(()=>w[25]||(w[25]=[C("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",Mn,[e("div",An,[e("div",Vn,[t(G,{class:"custom-slider",value:a.max_token,"onUpdate:value":w[5]||(w[5]=N=>a.max_token=N),min:0,max:100*1024},null,8,["value"])]),e("div",zn,[t(le,{value:a.max_token,"onUpdate:value":w[6]||(w[6]=N=>a.max_token=N),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(O,me(ye(r)),{default:l(()=>[e("div",Dn,[e("div",Pn,[w[28]||(w[28]=e("span",null,"上下文数量 ",-1)),t(Q,null,{title:l(()=>w[27]||(w[27]=[C("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",Nn,[e("div",Tn,[e("div",Bn,[t(G,{class:"custom-slider",value:a.context_pair,"onUpdate:value":w[7]||(w[7]=N=>a.context_pair=N),min:0,max:50},null,8,["value"])]),e("div",Fn,[t(le,{value:a.context_pair,"onUpdate:value":w[8]||(w[8]=N=>a.context_pair=N),min:0,max:50},null,8,["value"])])])])])]),_:1},16),L.value?(i(),V(O,me(Ke({key:0},r)),{default:l(()=>[e("div",Jn,[e("div",Qn,[w[30]||(w[30]=e("span",null,"深度思考 ",-1)),t(Q,null,{title:l(()=>w[29]||(w[29]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.enable_thinking,"onUpdate:checked":w[9]||(w[9]=N=>a.enable_thinking=N),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):R("",!0),t(O,me(ye(r)),{default:l(()=>[e("div",Gn,[e("div",Hn,[w[32]||(w[32]=e("span",null,"显示推理过程 ",-1)),t(Q,null,{title:l(()=>w[31]||(w[31]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.think_switch,"onUpdate:checked":w[10]||(w[10]=N=>a.think_switch=N),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Wn=J(Kn,[["__scopeId","data-v-6e25e8b5"]]),Zn={class:"recall-settings-box"},Yn={class:"form-box"},Xn={class:"form-item is-required"},ei={class:"form-item-body"},ti={class:"retrieval-mode-items"},oi=["onClick"],si={class:"retrieval-mode-title"},ni={class:"title-text"},ii={key:0,style:{width:"32px"},src:Ft,alt:""},li={class:"retrieval-mode-desc"},ai={class:"form-item"},ri={class:"form-item-label"},di={class:"form-item-body"},_i={class:"number-box"},ci={class:"number-slider-box"},ui={class:"number-input-box"},pi={key:0,class:"form-item"},mi={class:"form-item-label"},vi={class:"form-item-body"},fi={class:"number-box"},bi={class:"number-slider-box"},hi={class:"number-input-box"},yi={class:"form-item"},ki={class:"form-item-label"},gi={key:0,class:"form-item-body"},xi=["src"],$i={__name:"recall-settings-alert",emits:["change"],setup(A,{expose:_,emit:k}){const d=k,r=S([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=F({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),n=S(!1),f=L=>{y(),s.rerank_status=L.rerank_status||0,s.rerank_use_model=L.rerank_use_model||void 0,s.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",s.top_k=L.top_k,s.similarity=L.similarity,s.search_type=L.search_type,n.value=!0},b=(L,h)=>{if(!L||!h){s.rerank_model_config_id="";return}s.rerank_model_config_id=h.rerank_model_config_id},a=L=>{L==0&&(s.rerank_model_config_id="",s.rerank_use_model="")},$=L=>{s.search_type=L},c=()=>s.rerank_status==1&&!s.rerank_model_config_id,u=()=>{if(c())return Y.error("请选择Rerank模型");n.value=!1,o()},o=()=>{d("change",Z(s))},p=S([]),y=()=>{st({model_type:"RERANK"}).then(L=>{let h=L.data||[];p.value=h.map(I=>({id:I.model_config.id,name:I.model_info.model_name,icon:I.model_info.model_icon_url,children:I.model_info.rerank_model_list}))})};return _({open:f}),(L,h)=>{const I=pe,j=se,v=nt,q=Se,P=ne,z=ge,w=Ae,H=Vt,O=Me,D=te;return i(),V(D,{width:"746px",open:n.value,"onUpdate:open":h[6]||(h[6]=E=>n.value=E),title:"召回设置",onOk:u},{default:l(()=>[e("div",Zn,[e("div",Yn,[e("div",Xn,[h[7]||(h[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",ei,[e("div",ti,[(i(!0),m(B,null,K(r.value,E=>(i(),m("div",{class:we(["retrieval-mode-item",{active:s.search_type==E.value}]),key:E.value,onClick:Q=>$(E.value)},[s.search_type==E.value?(i(),V(I,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",si,[t(I,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",ni,U(E.title),1),E.isRecommendation?(i(),m("img",ii)):R("",!0)]),e("div",li,U(E.desc),1)],10,oi))),128))])])]),e("div",ai,[e("div",ri,[h[9]||(h[9]=e("span",null,"Top K ",-1)),t(j,null,{title:l(()=>h[8]||(h[8]=[C("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",di,[e("div",_i,[e("div",ci,[t(v,{class:"custom-slider",value:s.top_k,"onUpdate:value":h[0]||(h[0]=E=>s.top_k=E),min:1,max:10},null,8,["value"])]),e("div",ui,[t(q,{value:s.top_k,"onUpdate:value":h[1]||(h[1]=E=>s.top_k=E),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(i(),m("div",pi,[e("div",mi,[h[11]||(h[11]=e("span",null,"相似度阈值 ",-1)),t(j,null,{title:l(()=>h[10]||(h[10]=[C("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:l(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",vi,[e("div",fi,[e("div",bi,[t(v,{class:"custom-slider",value:s.similarity,"onUpdate:value":h[2]||(h[2]=E=>s.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",hi,[t(q,{value:s.similarity,"onUpdate:value":h[3]||(h[3]=E=>s.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",yi,[e("div",ki,[h[12]||(h[12]=e("span",null,"Rerank模型",-1)),h[13]||(h[13]=C("   ")),t(P,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":h[4]||(h[4]=E=>s.rerank_status=E),onChange:a},null,8,["checked"])]),s.rerank_status==1?(i(),m("div",gi,[t(O,{allowClear:"",value:s.rerank_use_model,"onUpdate:value":h[5]||(h[5]=E=>s.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:b,style:{width:"60%"}},{default:l(()=>[(i(!0),m(B,null,K(p.value,E=>(i(),V(H,{key:E.id},{label:l(()=>[t(z,{align:"center",gap:8},{default:l(()=>[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,xi),C(U(E.name),1)]),_:2},1024)]),default:l(()=>[(i(!0),m(B,null,K(E.children,Q=>(i(),V(w,{value:Q,rerank_model_config_id:E.id,key:Q},{default:l(()=>[e("span",null,U(Q),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):R("",!0)])])])]),_:1},8,["open"])}}},wi=J($i,[["__scopeId","data-v-00131927"]]),qi={class:"list-box"},Si=["onClick"],Ci={class:"avater-box"},Li=["src"],Ii={class:"content-box"},Ui={class:"title-block"},Ri={class:"title-text"},Ei={class:"desc-box"},Oi={class:"right-icon"},ji={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(A,{expose:_,emit:k}){const d=k,r=A,s=S(!1);_e(()=>r.list,()=>{r.list.length==0&&(s.value=!1)},{});const n=()=>{s.value=!0},f=()=>{document.visibilityState==="visible"&&d("refreshList")};ke(()=>{document.addEventListener("visibilitychange",f)}),pt(()=>{document.removeEventListener("visibilitychange",f)});const b=a=>{window.open(`/#/library/details/knowledge-config?id=${a.id}`)};return _({show:n}),(a,$)=>{const c=Qt,u=it,o=te;return i(),m("div",null,[t(o,{open:s.value,"onUpdate:open":$[0]||($[0]=p=>s.value=p),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:l(()=>[t(c,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(u,{scrollbar:!1,style:{height:"400px"}},{default:l(()=>[e("div",qi,[(i(!0),m(B,null,K(r.list,p=>(i(),m("div",{class:"list-item",onClick:y=>b(p),key:p.id},[e("div",Ci,[e("img",{src:p.avatar,alt:""},null,8,Li)]),e("div",Ii,[e("div",Ui,[$[1]||($[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ri,U(p.library_name),1)]),e("div",Ei,U(p.library_intro),1)]),e("div",Oi,[t(x(Jt))])],8,Si))),128))])]),_:1})]),_:1},8,["open"])])}}},Mi=J(ji,[["__scopeId","data-v-a87bd0fa"]]),Ai={class:"actions-box"},Vi={key:0,class:"library-list"},zi=["onClick"],Di=["onClick"],Pi={class:"library-name"},Ni={class:"library-name-text"},Ti={class:"library-intro"},Bi={class:"setting-info-block"},Fi={class:"set-item"},Ji={key:0},Qi={key:1},Gi={key:2},Hi={key:3},Ki={class:"set-item"},Wi={key:0,class:"set-item"},Zi={class:"set-item"},Yi={key:0},Xi={key:1},el={__name:"index",setup(A){const _=qt(),k=oe(()=>{var q;return((q=_.companyInfo)==null?void 0:q.neo4j_status)=="true"}),d=S(!1),{robotInfo:r,updateRobotInfo:s}=W("robotInfo"),n=F({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),f=S([]),b=S(null),a=oe(()=>f.value.filter(q=>n.library_ids.includes(q.id))),$=oe(()=>a.value.filter(q=>q.graph_switch==0)),c=q=>{let P=n.library_ids.indexOf(q.id);n.library_ids.splice(P,1),I()},u=q=>{n.library_ids=[...q],I()},o=()=>{b.value.open([...n.library_ids])},p=S(null),y=()=>{p.value.open(Z(n))},L=S(null),h=q=>{n.rerank_status=q.rerank_status,n.rerank_use_model=q.rerank_use_model,n.rerank_model_config_id=q.rerank_model_config_id,n.top_k=q.top_k,n.similarity=q.similarity,n.search_type=q.search_type,(q.search_type==1||q.search_type==4)&&$.value.length>0&&L.value.show(),I()},I=()=>{let q={...Z(n)};q.library_ids=q.library_ids.join(","),s({...q})},j=async()=>{const q=await St({type:"",show_open_docs:1});q&&(f.value=q.data||[])};n.rerank_use_model=r.rerank_use_model||void 0,qe(()=>{n.library_ids=r.library_ids.split(","),n.rerank_status=r.rerank_status||0,n.rerank_use_model=r.rerank_use_model||void 0,n.rerank_model_config_id=r.rerank_model_config_id||"",n.top_k=r.top_k,n.similarity=r.similarity,n.search_type=r.search_type});const v=q=>{window.open(`#/library/details/knowledge-document?id=${q.id}`)};return ke(()=>{j()}),(q,P)=>{const z=ie,w=ge,H=se;return i(),V(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:d.value,"onUpdate:isEdit":P[0]||(P[0]=O=>d.value=O),bodyStyle:{padding:0}},{extra:l(()=>[e("div",Ai,[t(w,{gap:8},{default:l(()=>[t(z,{size:"small",onClick:y},{default:l(()=>P[1]||(P[1]=[C("召回设置")])),_:1,__:[1]}),t(z,{size:"small",onClick:o},{default:l(()=>P[2]||(P[2]=[C("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[a.value.length>0?(i(),m("div",Vi,[(i(!0),m(B,null,K(a.value,O=>(i(),m("div",{class:"library-item",key:O.id,onClick:D=>v(O)},[O.id!=x(r).default_library_id?(i(),m("span",{key:0,class:"close-btn",onClick:mt(D=>c(O),["stop"])},[t(x(fe))],8,Di)):R("",!0),e("div",Pi,[k.value?(i(),V(H,{key:0},{title:l(()=>[C(U(O.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:l(()=>[e("div",{class:we(["graph-tag",{active:O.graph_switch==1}])},"Graph",2)]),_:2},1024)):R("",!0),e("div",Ni,U(O.library_name),1)]),e("div",Ti,U(O.library_intro),1)],8,zi))),128))])):R("",!0),e("div",Bi,[e("div",Fi,[P[3]||(P[3]=C(" 检索模式： ")),n.search_type==1?(i(),m("span",Ji,"混合检索")):R("",!0),n.search_type==2?(i(),m("span",Qi,"向量检索")):R("",!0),n.search_type==3?(i(),m("span",Gi,"全文检索")):R("",!0),n.search_type==4?(i(),m("span",Hi,"知识图谱检索")):R("",!0)]),e("div",Ki,[P[4]||(P[4]=C(" Top K： ")),e("span",null,U(n.top_k),1)]),n.search_type<=2?(i(),m("div",Wi,[P[5]||(P[5]=C(" 相似度阈值： ")),e("span",null,U(n.similarity),1)])):R("",!0),e("div",Zi,[P[6]||(P[6]=C(" Rerank模型： ")),n.rerank_status==0?(i(),m("span",Yi,"关")):(i(),m("span",Xi,U(n.rerank_use_model),1))])]),t(Bt,{ref_key:"librarySelectAlertRef",ref:b,onChange:u},null,512),t(wi,{ref_key:"recallSettingsAlertRef",ref:p,onChange:h},null,512),t(Mi,{list:$.value,onRefreshList:j,ref_key:"noOpenGraphModalRef",ref:L},null,8,["list"])]),_:1},8,["isEdit"])}}},tl=J(el,[["__scopeId","data-v-d7abace9"]]),ol={class:"library-checkbox-box"},sl={class:"list-box",ref:"scrollContainer"},nl={class:"library-name"},il={class:"library-desc"},ll={key:0,class:"empty-box"},al={__name:"library-select-alert",emits:["change"],setup(A,{expose:_,emit:k}){const d=k,r=F({indeterminate:!1,checkAll:!1,checkedList:[]}),s=S(!1),n=o=>{$(),r.checkedList=o,s.value=!0},f=()=>{s.value=!1,a()};S("");const b=S([]),a=()=>{d("change",[...r.checkedList])},$=async()=>{const o=await lt();if(o){let p=o.data||[];b.value=p}},c=S(!1),u=()=>{window.open("/#/database/list")};return _({open:n}),(o,p)=>{const y=Kt,L=Ht,h=Ye,I=te;return i(),V(I,{width:"746px",open:s.value,"onUpdate:open":p[1]||(p[1]=j=>s.value=j),title:"关联数据表",onOk:f},{default:l(()=>[e("div",ol,[t(h,{spinning:c.value,delay:100},{default:l(()=>[t(L,{value:r.checkedList,"onUpdate:value":p[0]||(p[0]=j=>r.checkedList=j),style:{width:"100%"}},{default:l(()=>[e("div",sl,[(i(!0),m(B,null,K(b.value,j=>(i(),m("div",{class:"list-item-wraapper",key:j.id},[t(y,{class:"list-item",value:j.id},{default:l(()=>[e("div",nl,U(j.name),1),e("div",il,U(j.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!c.value&&!b.value.length?(i(),m("div",ll,[p[3]||(p[3]=e("img",{src:Gt,alt:""},null,-1)),e("div",null,[p[2]||(p[2]=C(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:u}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},rl=J(al,[["__scopeId","data-v-b559dd08"]]),dl={class:"actions-box"},_l={key:0,class:"library-list"},cl=["onClick"],ul={class:"library-name"},pl={class:"library-intro"},ml={__name:"index",setup(A){const _=S(!1),{robotInfo:k,updateRobotInfo:d}=W("robotInfo"),r=F({form_ids:[]}),s=S([]),n=S(null),f=oe(()=>s.value.filter(o=>r.form_ids.includes(o.id))),b=o=>{let p=r.form_ids.indexOf(o.id);r.form_ids.splice(p,1),c()},a=o=>{r.form_ids=[...o],c()},$=()=>{n.value.open([...r.form_ids])},c=()=>{let o={...Z(r)};o.form_ids=o.form_ids.join(","),d({...o})};return(async()=>{const o=await lt();o&&(s.value=o.data||[])})(),qe(()=>{r.form_ids=k.form_ids.split(",")}),(o,p)=>{const y=se,L=ie,h=ge;return i(),V(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:_.value,"onUpdate:isEdit":p[0]||(p[0]=I=>_.value=I),bodyStyle:{padding:0}},{tip:l(()=>[t(y,{placement:"top"},{title:l(()=>p[1]||(p[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:l(()=>[t(x(ee))]),_:1})]),extra:l(()=>[e("div",dl,[t(h,{gap:8},{default:l(()=>[t(L,{size:"small",onClick:$},{default:l(()=>p[2]||(p[2]=[C("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[f.value.length>0?(i(),m("div",_l,[(i(!0),m(B,null,K(f.value,I=>(i(),m("div",{class:"library-item",key:I.id},[e("span",{class:"close-btn",onClick:j=>b(I)},[t(x(fe))],8,cl),e("div",ul,U(I.name),1),e("div",pl,U(I.description),1)]))),128))])):R("",!0),t(rl,{ref_key:"librarySelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},vl=J(ml,[["__scopeId","data-v-c40914ca"]]),fl={class:"form-box"},bl={class:"question-title"},hl={class:"question-options"},yl={class:"question-option"},kl={class:"drag-btn"},gl={class:"action-box"},xl={class:"robot-info-box"},$l={class:"robot-welcome-content"},wl={class:"robot-welcome-question"},ql={__name:"welcome-words",setup(A){const _=S(!1),k=S(!1),{robotInfo:d,updateRobotInfo:r,scrollBoxToBottom:s}=W("robotInfo"),n=F({welcomes:{content:"",question:[]}}),f=()=>{let u=!1;if(n.welcomes.question.length>0){for(let o=0;o<n.welcomes.question.length;o++)if(!n.welcomes.question[o].content){u=o+1;break}}return u},b=()=>{n.welcomes.question.push({content:"",id:Ue(8)})},a=u=>{n.welcomes.question.splice(u,1)},$=()=>{if(!n.welcomes.content)return Y.error("请输入欢迎语");if(f())return Y.error("引导问题内容不能为空");r({...Z(n)}),_.value=!1},c=()=>{let u={...d.welcomes},o=[];u.question.forEach(({content:p,id:y})=>{let L={id:y,content:p};L.id||(L.id=Ue(6)),o.push(L)}),n.welcomes.content=u.content,n.welcomes.question=o};return(u,o)=>{const p=$e,y=pe,L=xe;return i(),V(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:_.value,"onUpdate:isEdit":o[4]||(o[4]=h=>_.value=h),onSave:$,onEdit:c},{default:l(()=>[ce(e("div",fl,[e("div",bl,[t(p,{value:n.welcomes.content,"onUpdate:value":o[0]||(o[0]=h=>n.welcomes.content=h),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",hl,[t(x(De),{modelValue:n.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=h=>n.welcomes.question=h),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=h=>k.value=!0),onEnd:o[3]||(o[3]=h=>k.value=!1)},{item:l(({element:h,index:I})=>[e("div",yl,[e("span",kl,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":j=>h.content=j,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",gl,[t(x(fe),{class:"del-btn",onClick:j=>a(I)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:b},[t(x(Re),{class:"add-btn-icon"}),o[5]||(o[5]=C("添加引导问题 "))])])],512),[[ue,_.value]]),ce(e("div",xl,[e("div",$l,U(x(d).welcomes.content),1),e("div",wl,[(i(!0),m(B,null,K(x(d).welcomes.question,(h,I)=>(i(),m("div",{class:"question-item",key:I},U(h.content),1))),128))])],512),[[ue,!_.value]])]),_:1},8,["isEdit"])}}},Sl=J(ql,[["__scopeId","data-v-ea227a87"]]),Cl={class:"form-box"},Ll={class:"question-title"},Il={class:"question-options"},Ul={class:"question-option"},Rl={class:"drag-btn"},El={class:"action-box"},Ol={class:"robot-info-box"},jl={class:"robot-unknown-content"},Ml={class:"robot-unknown-question"},Al={__name:"unknown-problem-prompt",setup(A){const _=S(!1),k=S(!1),{robotInfo:d,updateRobotInfo:r,scrollBoxToBottom:s}=W("robotInfo"),n=F({unknown_question_prompt:{content:"",question:[]}}),f=()=>{n.unknown_question_prompt.question.push({content:"",id:Ue(8)}),We(()=>{s()})},b=c=>{n.unknown_question_prompt.question.splice(c,1)},a=()=>{r({...Z(n)}),_.value=!1},$=()=>{let c={...d.unknown_question_prompt},u=[];c.question&&c.question.forEach(({content:o,id:p})=>{let y={id:p,content:o};y.id||(y.id=Ue(6)),u.push(y)}),c.content&&(n.unknown_question_prompt.content=c.content),u&&(n.unknown_question_prompt.question=u)};return ke(()=>{}),(c,u)=>{const o=se,p=$e,y=pe,L=xe;return i(),V(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:_.value,"onUpdate:isEdit":u[4]||(u[4]=h=>_.value=h),onSave:a,onEdit:$},{tip:l(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>u[5]||(u[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:l(()=>[t(x(ee))]),_:1})]),default:l(()=>[ce(e("div",Cl,[e("div",Ll,[t(p,{value:n.unknown_question_prompt.content,"onUpdate:value":u[0]||(u[0]=h=>n.unknown_question_prompt.content=h),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Il,[t(x(De),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":u[1]||(u[1]=h=>n.unknown_question_prompt.question=h),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=h=>k.value=!0),onEnd:u[3]||(u[3]=h=>k.value=!1)},{item:l(({element:h,index:I})=>[e("div",Ul,[e("span",Rl,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:h.content,"onUpdate:value":j=>h.content=j,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",El,[t(x(fe),{class:"del-btn",onClick:j=>b(I)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:f},[t(x(Re),{class:"add-btn-icon"}),u[6]||(u[6]=C("添加引导问题 "))])])],512),[[ue,_.value]]),ce(e("div",Ol,[e("div",jl,U(x(d).unknown_question_prompt.content),1),e("div",Ml,[(i(!0),m(B,null,K(x(d).unknown_question_prompt.question,(h,I)=>(i(),m("div",{class:"question-item",key:I},U(h.content),1))),128))])],512),[[ue,!_.value]])]),_:1},8,["isEdit"])}}},Vl=J(Al,[["__scopeId","data-v-bc797bf6"]]),zl={class:"robot-info-box"},Dl={class:"modal-box",ref:"modalBoxRef"},Pl={class:"modal-item-box"},Nl={class:"modal-item"},Tl={class:"modal-item"},Bl={__name:"problem-optimization",setup(A){const _=S(!1);S(!1);const{robotInfo:k,updateRobotInfo:d}=W("robotInfo"),r=S("0"),s=F({optimize_question_use_model:"",optimize_question_model_config_id:""});ke(()=>{r.value=k.optimize_question_model_config_id!=0?"1":"0",s.optimize_question_use_model=k.optimize_question_use_model,s.optimize_question_model_config_id=k.optimize_question_model_config_id});const n=S([]),f=u=>{n.value=u,We(()=>{(!s.optimize_question_use_model||!Number(s.optimize_question_model_config_id))&&b()})},b=()=>{if(n.value.length>0){let u=null,o=null;for(let p of n.value)if(p.model_define==="tongyi"){u=p;for(let y of u.children)if(y.name==="qwen-max"){o=y;break}break}u||(u=n.value[0],o=u.children[0]),u&&o&&(s.optimize_question_use_model=o.name,s.optimize_question_model_config_id=o.model_config_id)}},a=()=>{_.value=!1,d({...Z(s)})},$=u=>{u!=1&&(s.optimize_question_use_model="",s.optimize_question_model_config_id=0)},c=u=>{d({})};return(u,o)=>{const p=se,y=ne,L=ze,h=Ve,I=$e,j=te;return i(),V(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:l(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:l(()=>[e("div",zl,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(p,null,{title:l(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:l(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=v=>_.value=!0)}," 对话背景设置 ")]),_:1})]),t(y,{onChange:c,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(k).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=v=>x(k).enable_question_optimize=v),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Dl,[t(j,{getContainer:()=>u.$refs.modalBoxRef,open:_.value,"onUpdate:open":o[6]||(o[6]=v=>_.value=v),width:472,title:"用户问题建议设置",onOk:a},{default:l(()=>[e("div",Pl,[e("div",Nl,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(h,{value:r.value,"onUpdate:value":o[2]||(o[2]=v=>r.value=v),onChange:$},{default:l(()=>[t(L,{value:"0"},{default:l(()=>o[10]||(o[10]=[C("跟随机器人")])),_:1,__:[10]}),t(L,{value:"1"},{default:l(()=>o[11]||(o[11]=[C("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),r.value=="1"?(i(),V(Wt,{key:0,modelType:"LLM",modeName:s.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=v=>s.optimize_question_use_model=v),modeId:s.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=v=>s.optimize_question_model_config_id=v),style:{width:"100%","margin-top":"8px"},onLoaded:f},null,8,["modeName","modeId"])):R("",!0)]),e("div",Tl,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(I,{style:{height:"120px"},value:x(k).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=v=>x(k).optimize_question_dialogue_background=v),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Fl=J(Bl,[["__scopeId","data-v-a42248ec"]]),Jl={class:"robot-info-box"},Ql={class:"robot-prompt"},Gl={__name:"suggested-issues",setup(A){S(!1);const{robotInfo:_,updateRobotInfo:k}=W("robotInfo"),d=r=>{k({})};return(r,s)=>{const n=Se,f=ne;return i(),V(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:l(()=>s[2]||(s[2]=[e("span",null,null,-1)])),default:l(()=>[e("div",Jl,[e("div",Ql,[s[3]||(s[3]=C(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(n,{value:x(_).question_guide_num,"onUpdate:value":s[0]||(s[0]=b=>x(_).question_guide_num=b),style:{width:"80px"},precision:0,min:1,max:10,onBlur:d},null,8,["value"]),s[4]||(s[4]=C(" 条用户提问建议，最大不超过10条。 "))])]),t(f,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(_).enable_question_guide,"onUpdate:checked":s[1]||(s[1]=b=>x(_).enable_question_guide=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Hl=J(Gl,[["__scopeId","data-v-f6a291d4"]]),Kl={__name:"sensitive-words",setup(A){S(!1);const{robotInfo:_,updateRobotInfo:k}=W("robotInfo");F({prompt:""});const d=()=>{window.open("/#/user/sensitive-words")},r=s=>{k({})};return(s,n)=>{const f=ne;return i(),V(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:l(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:l(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[n[2]||(n[2]=C(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:d,style:{cursor:"pointer"}},"设置敏词 >")])]),t(f,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:x(_).sensitive_words_switch,"onUpdate:checked":n[0]||(n[0]=b=>x(_).sensitive_words_switch=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Wl=J(Kl,[["__scopeId","data-v-56c388e6"]]),Zl={class:"direct-title"},Yl={class:"direct-desc"},Xl={class:"qa"},ea={class:"prompt-form-item-label"},ta={class:"direct-switch"},oa={class:"similarity"},sa={class:"number-input-box"},na={__name:"chat-edit-alert",emits:["save"],setup(A,{expose:_,emit:k}){const d=k,r=S(1),s=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=F(s()),f=S(!1),b=F({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),a=()=>{b.chat_type=r.value.toString(),n.forEach(u=>{u.chat_type==r.value&&(b.chat_type=="3"?(b.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch==1?"true":"false",b.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score.toString()):b.chat_type=="1"&&(b.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch==1?"true":"false",b.library_qa_direct_reply_score=u.library_qa_direct_reply_score.toString()))}),$(),Object.assign(n,s()),f.value=!1},$=()=>{d("save",Z(b))};ke(()=>{});const c=u=>{r.value=parseInt(u.chat_type),b.chat_type=u.chat_type,b.library_qa_direct_reply_score=u.library_qa_direct_reply_score,b.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch,b.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,b.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch,n.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=u.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch=="true"?1:0)}),f.value=!0};return _e(()=>f.value,u=>{u===!1&&Object.assign(n,s())},{immediate:!0}),_({open:c}),(u,o)=>{const p=se,y=ne,L=Se,h=ze,I=Ve,j=te;return i(),V(j,{width:"746px",open:f.value,"onUpdate:open":o[1]||(o[1]=v=>f.value=v),title:"聊天模式设置",onOk:a},{default:l(()=>[t(I,{class:"direct-box",value:r.value,"onUpdate:value":o[0]||(o[0]=v=>r.value=v)},{default:l(()=>[(i(!0),m(B,null,K(n,v=>(i(),V(h,{class:we(["direct-item",{active:r.value==v.direct_id}]),value:v.direct_id,key:v.direct_id},{default:l(()=>[e("div",Zl,U(v.direct_title),1),e("div",Yl,U(v.direct_desc),1),ce(e("div",Xl,[e("div",ea,[o[4]||(o[4]=e("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),t(p,null,vt({default:l(()=>[t(x(ee),{class:"question-icon"})]),_:2},[v.chat_type=="1"?{name:"title",fn:l(()=>[o[2]||(o[2]=C("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:v.chat_type=="3"?{name:"title",fn:l(()=>[o[3]||(o[3]=C("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",ta,[v.chat_type=="1"?(i(),V(y,{key:0,checkedValue:1,unCheckedValue:0,checked:v.library_qa_direct_reply_switch,"onUpdate:checked":q=>v.library_qa_direct_reply_switch=q},null,8,["checked","onUpdate:checked"])):v.chat_type=="3"?(i(),V(y,{key:1,checkedValue:1,unCheckedValue:0,checked:v.mixture_qa_direct_reply_switch,"onUpdate:checked":q=>v.mixture_qa_direct_reply_switch=q},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[ue,v.isQaDirectReply&&r.value==v.direct_id]]),ce(e("div",oa,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",sa,[v.chat_type=="1"?(i(),V(L,{key:0,value:v.library_qa_direct_reply_score,"onUpdate:value":q=>v.library_qa_direct_reply_score=q,disabled:!v.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):v.chat_type=="3"?(i(),V(L,{key:1,value:v.mixture_qa_direct_reply_score,"onUpdate:value":q=>v.mixture_qa_direct_reply_score=q,disabled:!v.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[ue,v.isQaDirectReply&&r.value==v.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ia=J(na,[["__scopeId","data-v-ba2922ca"]]),la={class:"actions-box"},aa={class:"setting-info-block"},ra={class:"set-item"},da={key:0},_a={key:1},ca={key:2},ua={class:"set-item"},pa={key:0,class:"set-item"},ma={class:"set-item"},va={key:0,class:"set-item"},fa={class:"form-box"},ba={__name:"index",setup(A){const _=S(!1),k=S(null),{robotInfo:d,updateRobotInfo:r}=W("robotInfo"),s=F({chat_type:d.chat_type,library_qa_direct_reply_score:d.library_qa_direct_reply_score,library_qa_direct_reply_switch:d.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:d.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:d.mixture_qa_direct_reply_switch}),n=a=>{s.chat_type=a.chat_type,s.library_qa_direct_reply_score=a.library_qa_direct_reply_score,s.library_qa_direct_reply_switch=a.library_qa_direct_reply_switch,s.mixture_qa_direct_reply_score=a.mixture_qa_direct_reply_score,s.mixture_qa_direct_reply_switch=a.mixture_qa_direct_reply_switch,f()},f=()=>{r({...Z(s)}),_.value=!1},b=()=>{k.value.open(Z(s)),_.value=!0};return(a,$)=>{const c=se,u=ie;return i(),V(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:_.value,"onUpdate:isEdit":$[1]||($[1]=o=>_.value=o),bodyStyle:{padding:0}},{tip:l(()=>[t(c,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>$[2]||($[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:l(()=>[t(x(ee))]),_:1})]),extra:l(()=>[e("div",la,[t(u,{size:"small",onClick:$[0]||($[0]=o=>b(!0))},{default:l(()=>$[3]||($[3]=[C("修改")])),_:1,__:[3]})])]),default:l(()=>[e("div",aa,[e("div",ra,[$[4]||($[4]=C(" 聊天模式： ")),x(d).chat_type=="1"?(i(),m("span",da,"仅知识库")):R("",!0),x(d).chat_type=="2"?(i(),m("span",_a,"直连模式")):R("",!0),x(d).chat_type=="3"?(i(),m("span",ca,"混合模式")):R("",!0)]),x(d).chat_type=="1"?(i(),m(B,{key:0},[e("div",ua,[$[5]||($[5]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U(x(d).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),x(d).library_qa_direct_reply_switch=="true"?(i(),m("div",pa,[$[6]||($[6]=C(" 相似度阈值： ")),e("span",null,U(x(d).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),x(d).chat_type=="3"?(i(),m(B,{key:1},[e("div",ma,[$[7]||($[7]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U(x(d).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),x(d).mixture_qa_direct_reply_switch=="true"?(i(),m("div",va,[$[8]||($[8]=C(" 相似度阈值： ")),e("span",null,U(x(d).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",fa,[t(ia,{ref_key:"ChatEditAlertRef",ref:k,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},ha=J(ba,[["__scopeId","data-v-eafe1264"]]),ya={class:"switch-box"},ka={class:"switch-box-body"},ga={class:"switch-box-header"},xa={class:"left-box"},$a={class:"switch-box-title"},wa={key:0,class:"title-tip"},qa={class:"right-box"},Sa={class:"extra-box"},Ca={class:"switch-desc"},La={class:"switch-box-right"},Ia={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(A,{emit:_}){const k=_,d=A,r=S(d.value),s=n=>{k("update:value",n),k("change",n)};return(n,f)=>{const b=pe,a=ne;return i(),m("div",ya,[e("div",ka,[e("div",ga,[e("div",xa,[t(b,{class:"switch-box-icon",name:d.iconName},null,8,["name"]),e("span",$a,U(d.title),1),n.$slots.tip?(i(),m("span",wa,[ve(n.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",qa,[e("div",Sa,[ve(n.$slots,"extra",{},()=>[f[1]||(f[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",Ca,[ve(n.$slots,"default",{},void 0,!0)])]),e("div",La,[t(a,{checked:r.value,"onUpdate:checked":f[0]||(f[0]=$=>r.value=$),onChange:s,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ua=J(Ia,[["__scopeId","data-v-8d185d5f"]]),Ra="/assets/img/empty-Bx9z1cwf.png",Ea="/assets/img/phone-head-CDwwPhYa.png",Oa="/assets/img/phone-body-CbEf8GZP.png",ja="/assets/img/phone-footer-ClQtNpln.png",Ma={class:"common-problem-box"},Aa={class:"left-content-box"},Va={key:0,class:"empty-box"},za={key:1,class:"lists-box"},Da={class:"drag-btn"},Pa={class:"title"},Na={class:"opration-box"},Ta={class:"preview-box"},Ba={class:"phone-body"},Fa={key:0,class:"question-box"},Ja={__name:"common-problem",setup(A){S(!1);const{robotInfo:_,updateRobotInfo:k}=W("robotInfo"),d=oe(()=>_.common_question_list?JSON.parse(_.common_question_list):[]),r=S([]);r.value=d.value,_e(d,()=>{r.value=d.value});const s=je.useForm,n=S(!1),f=S("添加问题"),b=F({question:"",index:-1}),a=F({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:$,validate:c,validateInfos:u}=s(b,a),o=()=>{if(d.value.length>=10)return Y.error("最多设置10条常用问题");n.value=!0,$(),b.question="",b.index=-1},p=(j,v)=>{n.value=!0,$(),b.question=j,b.index=v},y=j=>{let v=[];v=d.value.filter((q,P)=>j!=P),te.confirm({title:"提醒",icon:t(Oe),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){k({common_question_list:JSON.stringify(v)})},onCancel(){}})},L=()=>{c().then(()=>{let j=[];b.index>=0?j=d.value.map((v,q)=>q===b.index?b.question:v):j=[b.question,...d.value],k({common_question_list:JSON.stringify(j)}),n.value=!1})},h=j=>{k({})},I=j=>{k({common_question_list:JSON.stringify(r.value)})};return(j,v)=>{const q=se,P=ne,z=Zt,w=ie,H=pe,O=xe,D=Xe,E=je,Q=te;return i(),m("div",Ma,[e("div",Aa,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:l(()=>[t(q,null,{title:l(()=>v[4]||(v[4]=[C("最多10条。开启后，常见问题会显示在每条问答后面")])),default:l(()=>[t(x(ee),{class:"quess-icon"})]),_:1})]),extra:l(()=>[t(P,{onChange:h,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(_).enable_common_question,"onUpdate:checked":v[0]||(v[0]=G=>x(_).enable_common_question=G),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(z,{type:"vertical"}),t(w,{type:"primary",size:"small",onClick:o},{default:l(()=>v[5]||(v[5]=[C("添加")])),_:1,__:[5]})]),default:l(()=>[d.value.length==0?(i(),m("div",Va,[v[7]||(v[7]=e("img",{src:Ra,alt:""},null,-1)),v[8]||(v[8]=e("div",{class:"title"},"暂无数据",-1)),v[9]||(v[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(w,{onClick:o,type:"primary"},{default:l(()=>v[6]||(v[6]=[C("立即添加")])),_:1,__:[6]})])):(i(),m("div",za,[t(x(De),{modelValue:r.value,"onUpdate:modelValue":v[1]||(v[1]=G=>r.value=G),handle:".drag-btn","item-key":"index",onEnd:I},{item:l(({element:G,index:le})=>[(i(),m("div",{class:"list-item",key:le},[e("span",Da,[t(H,{name:"drag"})]),e("div",Pa,U(G),1),e("div",Na,[t(x(at),{onClick:be=>p(G,le)},null,8,["onClick"]),t(x(fe),{onClick:be=>y(le)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Ta,[v[12]||(v[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ea,alt:""})],-1)),e("div",Ba,[v[11]||(v[11]=e("div",null,[e("img",{class:"body-img",src:Oa,alt:""})],-1)),d.value.length&&x(_).enable_common_question=="true"?(i(),m("div",Fa,[v[10]||(v[10]=e("div",{class:"name"},"常见问题",-1)),(i(!0),m(B,null,K(d.value,G=>(i(),m("div",{class:"list-item",key:G},U(G),1))),128))])):R("",!0)]),v[13]||(v[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:ja,alt:""})],-1))]),t(Q,{open:n.value,"onUpdate:open":v[3]||(v[3]=G=>n.value=G),title:f.value,onOk:L,width:"476px"},{default:l(()=>[t(E,{class:"form-box",layout:"vertical"},{default:l(()=>[t(D,Ke({label:"问题名称"},x(u).question),{default:l(()=>[t(O,{maxLength:100,value:b.question,"onUpdate:value":v[2]||(v[2]=G=>b.question=G),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Qa=J(Ja,[["__scopeId","data-v-5125783f"]]),Ga={__name:"display-aitations",setup(A){const{robotInfo:_,updateRobotInfo:k}=W("robotInfo"),d=S(!1);_e(()=>_.answer_source_switch,s=>{d.value=s=="true"},{immediate:!0});const r=()=>{k({answer_source_switch:d.value?"true":"false"})};return(s,n)=>(i(),V(Ua,{title:"显示引文","icon-name":"jibenpeizhi",value:d.value,"onUpdate:value":n[0]||(n[0]=f=>d.value=f),onChange:r},{extra:l(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:l(()=>[n[2]||(n[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Ha={__name:"show-like",setup(A){const{robotInfo:_,updateRobotInfo:k}=W("robotInfo"),d=r=>{k({})};return(r,s)=>{const n=ne;return i(),V(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:l(()=>s[1]||(s[1]=[e("span",null,null,-1)])),default:l(()=>[s[2]||(s[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(n,{onChange:d,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:x(_).feedback_switch,"onUpdate:checked":s[0]||(s[0]=f=>x(_).feedback_switch=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Ka=J(Ha,[["__scopeId","data-v-4948feb9"]]),Wa={class:"content-box"},Za={key:0,class:"add-btn-block"},Ya={class:"list-content"},Xa={key:0,class:"user-block"},er={class:"name-box"},tr={class:"name"},or={class:"remark-text"},sr={key:0,class:"hover-btn-box"},nr={key:0},ir={key:1},lr={key:2},ar={key:1,class:"hover-btn-box"},rr={class:"role-menu-box"},dr=["onClick"],_r={class:"menu-header"},cr={key:0,class:"check-box"},ur=["onClick"],pr={class:"menu-header"},mr={key:0,class:"check-box"},vr=["onClick"],fr={class:"menu-header"},br={key:0,class:"check-box"},hr={class:"hover-btn-box"},yr={key:0},kr={key:1},gr={key:2},xr=["onClick"],$r={__name:"role-permission",setup(A){const _=Ct(),k=oe(()=>_.user_name),d=Ge().query,r=S(Lt(d.id)),s=S([]),n=F({object_id:d.id,object_type:1}),f=()=>{Yt({...n}).then(o=>{let p=o.data||[];s.value=p})};f();const b=S(null),a=()=>{b.value.show(s.value,[{object_id:+d.id,object_type:1,operate_rights:4}])},$=(o,p)=>{let y=p==4?"管理":p==2?"编辑":"查看";te.confirm({title:"提示?",icon:t(Oe),content:"确认修改该协作者权限为【"+y+"】",okText:"确认",cancelText:"取消",onOk:()=>{let L=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+p}];Xt({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(L)}).then(h=>{Y.success("修改成功"),f()})},onCancel(){}})},c=o=>{te.confirm({title:"提示?",icon:t(Oe),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{eo({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(p=>{Y.success("删除成功"),f()})},onCancel(){}})},u=S([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,p)=>{const y=ie,L=oo,h=no,I=io,j=it;return i(),V(j,null,{default:l(()=>[e("div",Wa,[r.value==4?(i(),m("div",Za,[t(y,{type:"primary",onClick:a,icon:He(x(Re))},{default:l(()=>p[0]||(p[0]=[C("添加协助者")])),_:1,__:[0]},8,["icon"])])):R("",!0),e("div",Ya,[t(I,{columns:u.value,"data-source":s.value,pagination:!1},{bodyCell:l(({column:v,record:q})=>[v.key==="name"?(i(),m("div",Xa,[t(L,{shape:"square",src:q.avatar,size:40},{icon:l(()=>[q.avatar?R("",!0):(i(),V(x(Fe),{key:0}))]),_:2},1032,["src"]),e("div",er,[e("div",tr,U(q.user_name),1),e("div",or,U(q.name),1)])])):R("",!0),v.key==="operate_rights"?(i(),m(B,{key:1},[r.value==2||q.user_name==k.value?(i(),m("div",sr,[q.operate_rights==4?(i(),m("span",nr,"管理")):R("",!0),q.operate_rights==2?(i(),m("span",ir,"编辑")):R("",!0),q.operate_rights==1?(i(),m("span",lr,"查看")):R("",!0)])):q.role_type==1||q.is_creator==1?(i(),m("div",ar,"管理")):(i(),V(h,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[e("div",rr,[e("div",{class:"role-menu",onClick:P=>$(q,4)},[e("div",_r,[t(x(Fe)),p[1]||(p[1]=e("span",{class:"title"},"管理",-1))]),p[2]||(p[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),q.operate_rights==4?(i(),m("div",cr,[t(x(Ee))])):R("",!0)],8,dr),e("div",{class:"role-menu",onClick:P=>$(q,2)},[e("div",pr,[t(x(at)),p[3]||(p[3]=e("span",{class:"title"},"编辑",-1))]),p[4]||(p[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),q.operate_rights==2?(i(),m("div",mr,[t(x(Ee))])):R("",!0)],8,ur),e("div",{class:"role-menu",onClick:P=>$(q,1)},[e("div",fr,[t(x(so)),p[5]||(p[5]=e("span",{class:"title"},"查看",-1))]),p[6]||(p[6]=e("div",{class:"desc"},"仅查看",-1)),q.operate_rights==1?(i(),m("div",br,[t(x(Ee))])):R("",!0)],8,vr)])]),default:l(()=>[e("div",hr,[q.operate_rights==4?(i(),m("span",yr,"管理")):R("",!0),q.operate_rights==2?(i(),m("span",kr,"编辑")):R("",!0),q.operate_rights==1?(i(),m("span",gr,"查看")):R("",!0),t(x(ot))])]),_:2},1024))],64)):R("",!0),v.key==="action"?(i(),m(B,{key:2},[r.value==4&&q.user_name!=k.value?(i(),m(B,{key:0},[q.role_type!=1&&q.is_creator!=1?(i(),m("a",{key:0,onClick:P=>c(q)},"移除",8,xr)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),t(to,{onOk:f,ref_key:"addCollaboratorRef",ref:b},null,512)]),_:1})}}},wr=J($r,[["__scopeId","data-v-3b4cded6"]]),qr={class:"actions-box"},Sr={key:0,class:"library-list"},Cr=["onClick"],Lr={class:"library-name"},Ir={class:"library-intro"},Ur={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(A){const _=S(!1),{robotInfo:k,getRobot:d}=W("robotInfo"),r=A,s=F({work_flow_ids:[]}),n=S(null),f=oe(()=>r.robotList.filter(u=>s.work_flow_ids.includes(u.id))),b=u=>{let o=s.work_flow_ids.indexOf(u.id);s.work_flow_ids.splice(o,1),c()},a=u=>{s.work_flow_ids=[...u],c()},$=()=>{n.value.open([...s.work_flow_ids])},c=()=>{let u={...Z(s)};u.work_flow_ids=u.work_flow_ids.join(","),Et({id:k.id,...u}).then(o=>{Y.success("保存成功"),d(k.id)})};return qe(()=>{s.work_flow_ids=k.work_flow_ids.split(",")}),(u,o)=>{const p=se,y=ie,L=ge;return i(),V(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:_.value,"onUpdate:isEdit":o[0]||(o[0]=h=>_.value=h),bodyStyle:{padding:0}},{tip:l(()=>[t(p,{placement:"top"},{title:l(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:l(()=>[t(x(ee))]),_:1})]),extra:l(()=>[e("div",qr,[t(L,{gap:8},{default:l(()=>[t(y,{size:"small",onClick:$},{default:l(()=>o[2]||(o[2]=[C("添加技能")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[f.value.length>0?(i(),m("div",Sr,[(i(!0),m(B,null,K(f.value,h=>(i(),m("div",{class:"library-item",key:h.id},[e("span",{class:"close-btn",onClick:I=>b(h)},[t(x(fe))],8,Cr),e("div",Lr,U(h.robot_name),1),e("div",Ir,U(h.robot_intro),1)]))),128))])):R("",!0),t(lo,{ref_key:"robotSelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},Rr=J(Ur,[["__scopeId","data-v-13cb67dc"]]),Er={class:"robot-info-box"},Or={class:"set-block"},jr={__name:"chat-cache",setup(A){const{robotInfo:_,updateRobotInfo:k}=W("robotInfo"),d=F({valid_time:"",cache_switch:0}),r=F({unix:"h",hValue:24,mValue:1440}),s=()=>{r.unix==="h"?d.valid_time=r.hValue*3600:d.valid_time=r.mValue*60,k({cache_config:{...d}})},n=()=>{s()},f=()=>{r.unix=="h"?r.hValue=parseInt(r.mValue/60):r.mValue=parseInt(r.hValue*60)};return _e(()=>_.cache_config,()=>{let b=_.cache_config||{};b=JSON.parse(JSON.stringify(b)),_.cache_config,d.cache_switch=b.cache_switch,d.valid_time=b.valid_time,b.valid_time%3600==0?(r.unix="h",r.hValue=b.valid_time/3600):(r.unix="m",r.mValue=parseInt(b.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(b,a)=>{const $=Se,c=Ae,u=Me,o=Ut,p=ne;return i(),V(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:l(()=>a[4]||(a[4]=[e("span",null,null,-1)])),default:l(()=>[e("div",Er,[a[7]||(a[7]=C(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ")),e("div",Or,[t(o,{compact:""},{default:l(()=>[r.unix=="h"?(i(),V($,{key:0,onBlur:s,precision:0,value:r.hValue,"onUpdate:value":a[0]||(a[0]=y=>r.hValue=y),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(i(),V($,{key:1,onBlur:s,precision:0,value:r.mValue,"onUpdate:value":a[1]||(a[1]=y=>r.mValue=y),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),t(u,{value:r.unix,"onUpdate:value":a[2]||(a[2]=y=>r.unix=y),style:{width:"70px"},onChange:f},{default:l(()=>[t(c,{value:"h"},{default:l(()=>a[5]||(a[5]=[C("小时")])),_:1,__:[5]}),t(c,{value:"m"},{default:l(()=>a[6]||(a[6]=[C("分钟")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})])]),t(p,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:d.cache_switch,"onUpdate:checked":a[3]||(a[3]=y=>d.cache_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Mr=J(jr,[["__scopeId","data-v-e6c2742e"]]),Ar={key:0,class:"robot-config-page"},Vr={class:"setting-box"},zr={class:"setting-box"},Dr={class:"setting-box"},Pr={class:"setting-box"},Nr={class:"setting-box"},Tr={class:"setting-box"},Br={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Qr={class:"setting-box"},Gr={class:"setting-box"},Hr={class:"setting-box"},Kr={class:"setting-box"},Wr={class:"setting-box"},Zr={class:"setting-box"},Yr={key:1,class:"robot-config-page"},Xr={key:2,class:"robot-config-page"},Qe="/robot/config/basic-config/activeKey",ed={__name:"index",setup(A){const _=Ze(),k=S(null),{robotInfo:d}=ft(_),{getRobot:r}=_,s=()=>{k.value.scrollTop=k.value.scrollHeight},n=S(+localStorage.getItem(Qe)||1),f=S(!1),b=F(d.value),a=p=>{let y=JSON.parse(JSON.stringify(p));p.robot_avatar&&(y.robot_avatar=new File([p.robot_avatar],p.robot_avatar.name)),Object.assign(b,y),u()},$=S([]);(()=>{Ot({application_type:1}).then(p=>{$.value=p.data||[]})})(),bt("robotInfo",{robotInfo:b,updateRobotInfo:a,scrollBoxToBottom:s,getRobot:r});const u=()=>{let p;b.robot_avatar&&(p=new File([b.robot_avatar],b.robot_avatar.name));let y=JSON.parse(JSON.stringify(Z(b)));p&&(y.robot_avatar=p);let L=y.welcomes;L.question=L.question.map(I=>I.content),y.welcomes=JSON.stringify(L),y.prompt_struct=JSON.stringify(y.prompt_struct);let h=y.unknown_question_prompt;h.question=h.question.map(I=>I.content),y.unknown_question_prompt=JSON.stringify(h),y.cache_config=JSON.stringify(y.cache_config),delete y.robot_avatar_url,f.value=!0,jt(y).then(I=>{if(I.res!=0)return Y.error(I.msg);f.value=!1,Y.success("保存成功"),r(b.id)}).catch(()=>{f.value=!1})},o=()=>{localStorage.setItem(Qe,n.value)};return(p,y)=>{const L=et,h=tt;return i(),m(B,null,[t(h,{class:"tab-wrapper",onChange:o,activeKey:n.value,"onUpdate:activeKey":y[0]||(y[0]=I=>n.value=I)},{default:l(()=>[(i(),V(L,{key:1,tab:"基础配置"})),R("",!0),(i(),V(L,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),n.value==1?(i(),m("div",Ar,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:k},[e("div",Vr,[t(Oo)]),e("div",zr,[t(tl)]),e("div",Dr,[t(Wn)]),e("div",Pr,[t(ha)]),e("div",Nr,[t(Mr)]),e("div",Tr,[t(un,{robotList:$.value},null,8,["robotList"])]),e("div",Br,[t(Rr,{robotList:$.value},null,8,["robotList"])]),e("div",Fr,[t(vl)]),e("div",Jr,[t(Sl)]),e("div",Qr,[t(Vl)]),e("div",Gr,[t(Wl)]),e("div",Hr,[t(Fl)]),e("div",Kr,[t(Hl)]),e("div",Wr,[t(Ga)]),e("div",Zr,[t(Ka)])],512)])):R("",!0),n.value==2?(i(),m("div",Yr,[t(Qa)])):R("",!0),n.value==3?(i(),m("div",Xr,[t(wr)])):R("",!0)],64)}}},O_=J(ed,[["__scopeId","data-v-400b4aaf"]]);export{O_ as default};
