import{am as ce,r as Y,f as S,d as pe,e as ve,o as oe,ac as p,ad as c,F as X,ae as G,az as K,k as n,ar as f,G as R,l as he,u as E,as as t,n as fe,A as ge,ax as te,ai as ue,at as F,ah as ye,ak as ke,w as ne,aI as be,aB as re,b as xe}from"./vue-chunks-CGLjTDrY.js";import{ae as we,bL as Se,b5 as $e,bM as Le,f as Ae,d as ie,bN as Ce,_ as Z,bx as Ne,ba as ee,A as Ue,au as Ie,av as Me,aw as Re}from"../../index-C5-B0r5-.js";import{W as Te}from"./index-CpUVYSJF.js";import{u as qe}from"./useEventBus-CB_rGuu7.js";import{M as de}from"./model-select-DkFuDwQt.js";import{am as Be,B as Oe,aA as Fe,T as ze,v as me,ah as H,Q as Ee,w as Ve,x as Ke,$ as je,aF as Pe,O as Je,M as He,b as ae,I as We,V as Qe,N as Ge,bn as Ye}from"./ui-antd-B11sc9DP.js";import{M as Xe}from"./editor-code-DDvPSeJb.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./index-Btdd0zUd.js";const Ze=ce("searchStore",{state:()=>({indeterminate:!1,checkAll:!1,checkedList:[],activeKey:"all"}),getters:{getIndeterminate(){return this.indeterminate},getCheckAll(){return this.checkAll},getCheckedList(){return this.checkedList},getActiveKey(){return this.activeKey}},actions:{setIndeterminate(y){this.indeterminate=y},setCheckAll(y){this.checkAll=y},setCheckedList(y){this.checkedList=y},setActiveKey(y){this.activeKey=y}},persist:{enabled:!0,strategies:[{key:"searchStore",storage:localStorage,paths:["indeterminate","checkAll","checkedList","activeKey"]}]}}),_e=ce("search-lirary",()=>{const y=qe(),i=Y({reasoning_content:"",show_reasoning:!1,content:"",quote_file:[],id:"",finish:!1,debug:[],error:[],recall_time:0,request_time:0,loading:!1});let $=null;const T=S(0),L=S(""),U=Y({context_pair:"",create_time:"",id:"",max_token:"",model_config_id:"",rerank_model_config_id:"",rerank_status:"",rerank_use_model:"",search_type:"",similarity:"",size:"",temperature:"",update_time:"",use_model:"",user_id:"",summary_switch:0}),A=(v,o)=>{if(v=="reasoning_content"){let d=i.reasoning_content||"";i.reasoning_content=d+o,i.show_reasoning=!0}if(v=="sending"){let d=i.content||"";i.content=d+o}if(v=="quote_file"&&(i.quote_file=o.length>0?o:[]),v=="ai_message"){if(o.menu_json&&o.msg_type==2){let d=JSON.parse(o.menu_json);i.question=d.question}i.id=o.id,i.content=o.content,o.quote_file&&typeof o.quote_file=="string"&&(i.quote_file=JSON.parse(o.quote_file))}v=="finish"&&(i.finish=!0),v=="debug"&&(i.debug=o.length>0?o:[]),v=="error"&&(i.error=o.length>0?o:[]),v=="recall_time"&&(i.recall_time=o||0),v=="request_time"&&(i.request_time=o||0),y.emit("updateAiMessage",i)},k=()=>{i.loading=!1};return{searchFormState:U,dialogue_id:T,openid:L,messageObj:i,getLibrarySearchFn:async()=>{$&&($.abort(),$=null);const v=await Le();try{let o=v.data;Object.assign(U,{...o})}catch(o){Promise.reject(o)}return v},searchMessage:(v,o,d)=>{we(32),i.content="",i.finish=!1;let q={model_config_id:d.model_config_id,use_model:d.use_model,temperature:d.temperature,max_token:d.max_token,size:d.size,similarity:d.similarity,search_type:d.search_type,question:v,id:o.join(","),recall_type:1,summary_switch:d.summary_switch};d.rerank_status&&(q.rerank_status=d.rerank_status),d.rerank_use_model&&(q.rerank_use_model=d.rerank_use_model),d.prompt&&(q.prompt=d.prompt),d.rerank_status==1&&(q.rerank_model_config_id=d.rerank_model_config_id),$=Se(q),$.onMessage=h=>{if(h.event!=="sending"&&$e(h),h.event=="dialogue_id"&&(T.value=h.data),h.event=="reasoning_content"&&A("reasoning_content",h.data),h.event=="sending"&&A("sending",h.data),h.event=="ai_message"){let w=JSON.parse(h.data);A("ai_message",w)}if(h.event=="quote_file"){let w=JSON.parse(h.data);A("quote_file",w)}if(h.event=="finish"&&A("finish",h.data),h.event=="debug"){let w=JSON.parse(h.data);A("debug",w)}if(h.event=="error"){let w=h.data;A("error",w)}if(h.event=="recall_time"){let w=h.data;A("recall_time",w)}},$.onClose=()=>{k(),$=null}}}}),De={class:"prompt-form"},et={class:"form-item"},tt={class:"form-item-label"},st={class:"prompt-form-item"},at={class:"prompt-form-item"},nt={class:"prompt-form-item-content"},ot={key:0,class:"prompt-form-item-tip"},it={class:"prompt-form-item"},lt={class:"prompt-form-item-label"},rt={class:"form-item-body"},dt={class:"number-box"},ct={class:"number-slider-box"},ut={class:"number-input-box"},mt={class:"prompt-form-item"},_t={class:"prompt-form-item-label"},pt={class:"form-item-body"},vt={class:"number-box"},ht={class:"number-slider-box"},ft={class:"number-input-box"},gt={class:"recall-settings-box"},yt={class:"form-box prompt-form"},kt={class:"form-item is-required"},bt={class:"form-item-body"},xt={class:"retrieval-mode-items"},wt=["onClick"],St={class:"retrieval-mode-title"},$t={class:"title-text"},Lt={class:"retrieval-mode-desc"},At={key:0,class:"form-item"},Ct={class:"form-item"},Nt={class:"form-item-label"},Ut={class:"form-item-body"},It={class:"number-box"},Mt={class:"number-slider-box"},Rt={class:"number-input-box"},Tt={key:1,class:"form-item"},qt={class:"form-item-label"},Bt={class:"form-item-body"},Ot={class:"number-box"},Ft={class:"number-slider-box"},zt={class:"number-input-box"},Et={class:"form-item"},Vt={class:"form-item-label"},Kt={key:0,class:"form-item-body"},jt=pe({__name:"search-drawer",setup(y){let{role_permission:i,role_type:$}=Ae();const T=ve(()=>$==1||i.includes("SearchSets")),L=_e(),{getLibrarySearchFn:U}=L,A=S([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),k=S(!1),s=Y({use_model:"",model_config_id:"",prompt_type:"0",prompt:"",temperature:.5,max_token:2e3,context_pair:0,search_type:1,top_k:5,size:0,similarity:.4,rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,summary_switch:0,rrf_weight:{}}),j=()=>{b()},v=S([]),o=x=>{if(v.value=x,(!s.model_config_id||!s.use_model)&&v.value.length>0){let e=v.value[0];if(e){let I=e.children[0];s.use_model=I.name,s.model_config_id=I.model_config_id}}},d=x=>{s.search_type=x,b()},q=x=>{let e={...x};e.max_token=parseFloat(e.max_token),e.temperature=parseFloat(e.temperature),e.context_pair=parseFloat(e.context_pair),e.search_type=parseFloat(e.search_type),e.rerank_status=parseFloat(e.rerank_status),e.similarity=parseFloat(e.similarity),e.top_k=parseFloat(e.size),e.summary_switch=+e.summary_switch,e.rerank_use_model===""&&(e.rerank_use_model=void 0),e.rrf_weight=e.rrf_weight?JSON.parse(e.rrf_weight):e.rrf_weight,Object.keys(e).forEach(I=>{s[I]=e[I]})},u=((x,e)=>{let I;return function(...g){const N=()=>{clearTimeout(I),x(...g)};clearTimeout(I),I=setTimeout(N,e)}})(()=>{b()},500),b=()=>{let x={...s};if(!x.prompt&&s.prompt_type=="1")return ae.error("请输入自定义提示词");x.rrf_weight=JSON.stringify(s.rrf_weight),(s.search_type==3||s.search_type==4)&&delete x.similarity,s.prompt_type=="0"&&delete x.prompt,x.size=x.top_k,Ce(x).then(e=>{ae.success("保存成功")})},O=S(!1),l=S(""),m=()=>{s.prompt_type=="1"?(l.value=s.prompt,O.value=!0):b()},B=()=>{if(l.value)s.prompt=l.value,O.value=!1,b();else return ae.error("请输入提示语")},V=()=>{s.prompt_type="0",O.value=!1},W=x=>{},C=async()=>{let x=await U();q(x.data),k.value=!0};return oe(()=>{}),(x,e)=>{const I=Oe,r=me,g=Ee,N=ze,M=Ke,P=Ve,_=je,z=Pe,J=Je,Q=ie,le=He,D=Fe;return c(),p(X,null,[T.value?(c(),G(I,{key:0,onClick:C,icon:he(E(Be))},{default:f(()=>[...e[20]||(e[20]=[R("搜索设置",-1)])]),_:1},8,["icon"])):K("",!0),n(D,{open:k.value,"onUpdate:open":e[19]||(e[19]=a=>k.value=a),class:"custom-class","root-class-name":"root-class-name",title:"搜索设置",width:"472",placement:"right",onAfterOpenChange:W},{default:f(()=>[t("div",De,[e[31]||(e[31]=t("div",{class:"prompt-form-label"},"模型设置",-1)),t("div",et,[t("div",tt,[n(N,{align:"center"},{default:f(()=>[e[22]||(e[22]=t("span",null,"AI智能总结",-1)),n(r,null,{title:f(()=>[...e[21]||(e[21]=[R("开启后，搜索知识库时，由大模型自动总结文档，并给出总结后的结果",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1}),n(g,{style:{"margin-left":"24px"},onChange:b,checked:s.summary_switch,"onUpdate:checked":e[0]||(e[0]=a=>s.summary_switch=a),checkedValue:1,unCheckedValue:0,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})])]),fe(t("div",null,[t("div",st,[e[23]||(e[23]=t("div",{class:"prompt-form-item-label"},[t("span",{style:{color:"red"}},"* "),t("span",null,"模型选择")],-1)),n(de,{modelType:"LLM",modeName:s.use_model,"onUpdate:modeName":e[1]||(e[1]=a=>s.use_model=a),modeId:s.model_config_id,"onUpdate:modeId":e[2]||(e[2]=a=>s.model_config_id=a),style:{width:"100%"},onLoaded:o,onChange:j},null,8,["modeName","modeId"])]),t("div",at,[e[26]||(e[26]=t("div",{class:"prompt-form-item-label"},[t("span",{style:{color:"red"}},"* "),t("span",null,"提示词")],-1)),n(P,{value:s.prompt_type,"onUpdate:value":e[3]||(e[3]=a=>s.prompt_type=a),onChange:m},{default:f(()=>[n(M,{value:"0"},{default:f(()=>[...e[24]||(e[24]=[R("默认提示词",-1)])]),_:1}),n(M,{value:"1"},{default:f(()=>[...e[25]||(e[25]=[R("自定义提示词",-1)])]),_:1})]),_:1},8,["value"]),t("div",nt,[s.prompt_type=="0"?(c(),p("div",ot," 将提交的内容进行智能总结,不要随意发挥 ")):(c(),G(_,{key:1,onBlur:b,maxLength:500,style:{height:"80px"},value:s.prompt,"onUpdate:value":e[4]||(e[4]=a=>s.prompt=a),placeholder:"请输入自定义提示词"},null,8,["value"]))])]),t("div",it,[t("div",lt,[e[28]||(e[28]=t("span",null,"温度",-1)),n(r,null,{title:f(()=>[...e[27]||(e[27]=[R("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1})]),t("div",rt,[t("div",dt,[t("div",ct,[n(z,{onBlur:b,class:"custom-slider",value:s.temperature,"onUpdate:value":e[5]||(e[5]=a=>s.temperature=a),min:0,max:2,step:.1},null,8,["value"])]),t("div",ut,[n(J,{onBlur:b,value:s.temperature,"onUpdate:value":e[6]||(e[6]=a=>s.temperature=a),min:0,max:2,step:.1},null,8,["value"])])])])]),t("div",mt,[t("div",_t,[e[30]||(e[30]=t("span",null,"最大token",-1)),n(r,null,{title:f(()=>[...e[29]||(e[29]=[t("div",null,"问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1})]),t("div",pt,[t("div",vt,[t("div",ht,[n(z,{onBlur:b,class:"custom-slider",value:s.max_token,"onUpdate:value":e[7]||(e[7]=a=>s.max_token=a),min:0,max:100*1024},null,8,["value"])]),t("div",ft,[n(J,{onBlur:b,value:s.max_token,"onUpdate:value":e[8]||(e[8]=a=>s.max_token=a),min:0,max:100*1024},null,8,["value"])])])])])],512),[[ge,s.summary_switch==1]])]),t("div",gt,[t("div",yt,[e[39]||(e[39]=t("div",{class:"prompt-form-label"},"召回设置",-1)),t("div",kt,[e[32]||(e[32]=t("div",{class:"form-item-label"},[t("span",null,"检索模式")],-1)),t("div",bt,[t("div",xt,[(c(!0),p(X,null,te(A.value,a=>(c(),p("div",{class:ue(["retrieval-mode-item",{active:s.search_type==a.value}]),key:a.value,onClick:se=>d(a.value)},[s.search_type==a.value?(c(),G(Q,{key:0,class:"check-arrow",name:"check-arrow-filled"})):K("",!0),t("div",St,[n(Q,{name:a.iconName,class:"title-icon"},null,8,["name"]),t("span",$t,F(a.title),1),a.isRecommendation?(c(),G(Q,{key:0,class:"recommendation-icon",name:"recommendation"})):K("",!0)]),t("div",Lt,F(a.desc),1)],10,wt))),128))])])]),s.search_type==1?(c(),p("div",At,[n(Te,{onSave:E(u),rrf_weight:s.rrf_weight,"onUpdate:rrf_weight":e[9]||(e[9]=a=>s.rrf_weight=a)},null,8,["onSave","rrf_weight"])])):K("",!0),t("div",Ct,[t("div",Nt,[e[34]||(e[34]=t("span",null,"Top K ",-1)),n(r,null,{title:f(()=>[...e[33]||(e[33]=[R("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1})]),t("div",Ut,[t("div",It,[t("div",Mt,[n(z,{onBlur:b,class:"custom-slider",value:s.top_k,"onUpdate:value":e[10]||(e[10]=a=>s.top_k=a),min:1,max:500},null,8,["value"])]),t("div",Rt,[n(J,{onBlur:b,value:s.top_k,"onUpdate:value":e[11]||(e[11]=a=>s.top_k=a),min:1,max:500},null,8,["value"])])])])]),s.search_type!=3&&s.search_type!=4?(c(),p("div",Tt,[t("div",qt,[e[36]||(e[36]=t("span",null,"相似度阈值 ",-1)),n(r,null,{title:f(()=>[...e[35]||(e[35]=[R("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1})]),t("div",Bt,[t("div",Ot,[t("div",Ft,[n(z,{onBlur:b,class:"custom-slider",value:s.similarity,"onUpdate:value":e[12]||(e[12]=a=>s.similarity=a),min:0,max:1,step:.01},null,8,["value"])]),t("div",zt,[n(J,{onBlur:b,value:s.similarity,"onUpdate:value":e[13]||(e[13]=a=>s.similarity=a),min:0,max:1,step:.01},null,8,["value"])])])])])):K("",!0),t("div",Et,[t("div",Vt,[e[38]||(e[38]=t("span",null,"Rerank模型 ",-1)),n(r,null,{title:f(()=>[...e[37]||(e[37]=[R("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:f(()=>[n(E(H),{class:"question-icon"})]),_:1}),n(g,{onChange:b,style:{float:"right"},checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":e[14]||(e[14]=a=>s.rerank_status=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),s.rerank_status==1?(c(),p("div",Kt,[n(de,{modelType:"RERANK",modeName:s.rerank_use_model,"onUpdate:modeName":e[15]||(e[15]=a=>s.rerank_use_model=a),modeId:s.rerank_model_config_id,"onUpdate:modeId":e[16]||(e[16]=a=>s.rerank_model_config_id=a),style:{width:"100%"},placeholder:"请选择Rerank模型",onChange:b},null,8,["modeName","modeId"])])):K("",!0)])])]),n(le,{open:O.value,"onUpdate:open":e[18]||(e[18]=a=>O.value=a),onCancel:V,title:"请输入自定义提示词",onOk:B},{default:f(()=>[n(_,{value:l.value,"onUpdate:value":e[17]||(e[17]=a=>l.value=a),placeholder:"请输入",style:{"min-height":"300px"},"allow-clear":""},null,8,["value"])]),_:1},8,["open"])]),_:1},8,["open"])],64)}}}),Pt=Z(jt,[["__scopeId","data-v-df5025b6"]]),Jt={class:"no-data"},Ht={class:"no-data-text"},Wt={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(y){const i=y;return($,T)=>{const L=ie;return c(),p("div",Jt,[n(L,{name:"empty-document",style:ye({"font-size":`${i.size}px`,color:"white"})},null,8,["style"]),t("div",Ht,[ke($.$slots,"default",{},()=>[R(F(i.text),1)],!0)])])}}},Qt=Z(Wt,[["__scopeId","data-v-f4fa2763"]]),Gt={class:"search-box-warpper"},Yt={class:"search-box-content"},Xt={class:"search-set-box"},Zt={key:0,class:"search-content"},Dt={class:"search-input-box"},es={key:1,class:"search-content search-main"},ts={class:"search-input-box"},ss={key:1,class:"search-content-box"},as={class:"search-tip-box"},ns={key:0,class:"tip"},os={key:1,class:"tip complete"},is={key:0,class:"container"},ls={key:1,class:"intelligent-answer"},rs=["innerHTML"],ds={key:1},cs={class:"section-box"},us={key:0,class:"section-label"},ms={class:"section-item-nav"},_s={class:"section-item-nav-left"},ps=["onClick"],vs={key:0},hs={class:"section-item-nav-right"},fs=["innerHTML"],gs={__name:"search-box",props:{librarySearchData:{type:Object,default:null},messageObj:{type:Object,default:null},library_ids:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1}},emits:["search","defaultParmas"],setup(y,{expose:i,emit:$}){const T=$,L=y,U=new Xe({html:!0,linkify:!0,typographer:!0}),A=S(""),k=S(""),s=S(!1),j=S(!1),v=S({});ne(()=>L.messageObj.content,()=>{A.value=U.render(L.messageObj.content)}),ne(()=>L.messageObj.error,l=>{l&&ee(l)});const o=async()=>{if(!L.library_ids.length)return ee("请在左侧的知识库选择项内至少选择一个知识库");if(!k.value)return ee("请输入消息内容");T("search",k.value),s.value=!0};function d(l){return l.match(/^-?\d+(?:\.\d{0,2})?/)[0]}const q=(l,m)=>{if(!l||!m.trim())return l;const B=m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),V=new RegExp(`(${B})`,"gi");return l.replace(V,'<span class="highlight">$1</span>')},h=l=>{if(!l.file_name){window.open(`#/library/details/categary-manage?id=${l.library_id}`);return}window.open(`#/library/preview?id=${l.file_id}`)},w=S(L.librarySearchData),u=Y({rerank_status:"",rerank_use_model:"",prompt:"",model_config_id:"",use_model:"",temperature:.5,max_token:2e3,similarity:.4,search_type:1,summary_switch:0}),b=S({}),O=l=>{w.value=l;let m={model_config_id:l.model_config_id||u.model_config_id,use_model:l.use_model||u.use_model,temperature:l.temperature||u.temperature,max_token:l.max_token||u.max_token,size:200,similarity:l.similarity||u.similarity,search_type:l.search_type||u.search_type,summary_switch:l.summary_switch||u.summary_switch,question:k.value,id:L.library_ids.join(","),recall_type:1,rrf_weight:l.rrf_weight};l.rerank_status&&(m.rerank_status=l.rerank_status),l.rerank_use_model&&(m.rerank_use_model=l.rerank_use_model),l.prompt&&(m.prompt=l.prompt),l.rerank_status==1&&(m.rerank_model_config_id=l.rerank_model_config_id),j.value=!0,b.value=Object.assign(m),T("defaultParmas",b.value),Ne(m).then(B=>{v.value=B.data}).catch(()=>{}).finally(()=>{j.value=!1})};return oe(async()=>{}),i({handleRecallTest:O}),(l,m)=>{const B=ie,V=We,W=me;return c(),p("div",Gt,[t("div",Yt,[t("div",Xt,[n(Pt)]),s.value?(c(),p("div",es,[t("div",ts,[n(V,{class:"search-input",onPressEnter:o,value:k.value,"onUpdate:value":m[1]||(m[1]=C=>k.value=C),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:f(()=>[t("div",{class:"search-icon-box",onClick:o},[n(B,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])]),!A.value&&y.messageObj.finish&&!v.value.length?(c(),G(Qt,{key:0,style:{"margin-top":"100px"},size:"250"},{default:f(()=>[...m[4]||(m[4]=[t("div",null,[t("p",{style:{color:"#262626","font-size":"16px","font-weight":"600","line-height":"24px"}},"暂无任何内容")],-1)])]),_:1})):(c(),p("div",ss,[t("div",as,[n(B,{class:"nav-icon",name:"search-tip"}),y.messageObj.finish?(c(),p("span",os,"智能回答生成完毕")):(c(),p("span",ns,"智能回答生成中..."))]),!y.messageObj.content&&!y.messageObj.finish&&!y.isError?(c(),p("div",is,[...m[5]||(m[5]=[be('<div class="rect-container rect1" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div><div class="rect-container rect2" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div><div class="rect-container rect3" data-v-ed22a746><div class="rect" data-v-ed22a746></div></div>',3)])])):(c(),p("div",ls,[A.value?(c(),p("div",{key:0,innerHTML:A.value},null,8,rs)):(c(),p("div",ds,"暂无任何内容"))])),t("div",cs,[m[7]||(m[7]=t("div",{class:"tips"},[t("div",{class:"tips-text"},"以上内容由大模型生成"),t("div",{class:"tips-line"})],-1)),v.value.length?(c(),p("div",us,[m[6]||(m[6]=R("相关分段 ",-1)),t("div",null,"("+F(v.value.length)+")",1)])):K("",!0),(c(!0),p(X,null,te(v.value,C=>(c(),p("div",{class:"section-item",key:C.id},[t("div",ms,[t("div",_s,[n(B,{class:"section-item-icon",name:"document"}),t("div",{class:"section-item-label",onClick:x=>h(C)},[R(F(C.file_name),1),C.file_name?K("",!0):(c(),p("span",vs,F(C.library_name)+"-精选",1))],8,ps)]),t("div",hs,"相似度："+F(d(C.similarity)),1)]),n(W,{overlayClassName:"search-content-tip",placement:"top"},{title:f(()=>[R(F(C.content),1)]),default:f(()=>[t("div",{class:"section-item-content",innerHTML:q(C.content,k.value)},null,8,fs)]),_:2},1024)]))),128))])]))])):(c(),p("div",Zt,[m[2]||(m[2]=t("div",{class:"search-label"},"知识搜索",-1)),m[3]||(m[3]=t("div",{class:"search-tip"},"快速搜索所选择的知识库中内容",-1)),t("div",Dt,[n(V,{class:"search-input",onPressEnter:o,value:k.value,"onUpdate:value":m[0]||(m[0]=C=>k.value=C),"allow-clear":"",placeholder:"输入关键词搜索"},{suffix:f(()=>[t("div",{class:"search-icon-box",onClick:o},[n(B,{class:"search-icon",name:"search-right"})])]),_:1},8,["value"])])]))])])}}},ys=Z(gs,[["__scopeId","data-v-ed22a746"]]),ks={class:"cu-tabs"},bs=["onClick"],xs={__name:"contain-tabs",props:{value:{type:[Number,String],required:!0},tabs:{type:Array,required:!0,default:()=>[]}},emits:["update:value","change"],setup(y,{emit:i}){const $=i,T=y,L=U=>{$("update:value",U),$("change",U)};return(U,A)=>(c(),p("div",ks,[(c(!0),p(X,null,te(y.tabs,k=>(c(),p("div",{class:ue(["tab-item",{active:T.value===k.value}]),onClick:s=>L(k.value),key:k.value},F(k.title),11,bs))),128))]))}},ws=Z(xs,[["__scopeId","data-v-a6e0ef08"]]),Ss={class:"chat-monitor-page"},$s={class:"page-left"},Ls={class:"toolbar-box"},As={class:"library-checkbox-box"},Cs={class:"app-list-box"},Ns={class:"list-box",ref:"scrollContainer"},Us={class:"list-item"},Is={class:"list-item-box"},Ms={class:"library-icon"},Rs=["onClick"],Ts={class:"page-body"},qs={__name:"index",setup(y){const i=Ze();let{getIndeterminate:$,getCheckAll:T,getCheckedList:L,getActiveKey:U}=re(i);const A=_e(),{getLibrarySearchFn:k,searchMessage:s}=A,{messageObj:j}=re(A),v=S(null),o=S(null),d=S("all"),q=S([{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]),h=S({}),w=S([]),u=Y({indeterminate:!1,checkAll:!1,checkedList:[]}),b=r=>{h.value=r},O=S(!1),l=async r=>{var N;O.value=!1;let g=await k();if(o.value=g.data,o.value.id||(o.value=Object.assign(h.value)),o.value,!o.value.model_config_id||!o.value.use_model)return O.value=!0,ee("请在搜索设置中配置好相应配置后再使用");(N=v.value)==null||N.handleRecallTest(o.value),s(r,u.checkedList,o.value)},m=r=>{Object.assign(u,{checkedList:r.target.checked?w.value.map(g=>g.id):[],indeterminate:!!u.checkedList.length&&u.checkedList.length<w.value.length}),i.setCheckedList(u.checkedList),i.setIndeterminate(u.indeterminate)},B=r=>{i.setCheckedList(r)},V=r=>{window.open(`#/library/details/knowledge-document?id=${r}`)};ne(()=>u.checkedList,r=>{u.indeterminate=!!r.length&&r.length<w.value.length,u.checkAll=r.length>=w.value.length,i.setIndeterminate(u.indeterminate),i.setCheckAll(u.checkAll)});const W=()=>{w.value.forEach(r=>{r.type==0,r.type==2}),q.value=[{title:"全部",value:"all"},{title:"普通",value:"0"},{title:"问答",value:"2"}]},C=(r,g)=>{if(g.length===0)return!1;const N=new Set(r);return g.every(M=>N.has(M))},x=(r,g)=>!g.some(N=>r.includes(N)),e=async()=>{let r=d.value==="all"?"":d.value;await Ue({type:r}).then(g=>{var P;let N=g.data||[];N.forEach(_=>{_.file_size_str=Ie(_.file_size),_.avatar||(_.avatar=_.type==0?Me:Re)}),w.value=N;const M=w.value.map(_=>_.id);if((P=L.value)!=null&&P.length&&(M!=null&&M.length)){const _=L.value,z=M,J=C(_,z),Q=x(_,z),D=_.length>=z.length&&J,se={checkAll:D,indeterminate:!D&&!Q};i.$patch(se),Object.assign(u,se)}else{const _={checkAll:!1,indeterminate:!1};i.$patch(_),Object.assign(u,_)}u.checkedList=L.value,u.indeterminate=$.value,!T.value&&L.value.length==0&&!$.value&&U.value=="all"&&(i.setCheckAll(!0),u.checkedList=M,i.setCheckedList(M)),d.value==="all"&&W()})},I=r=>{i.setActiveKey(r),e()};return oe(async()=>{U.value&&(d.value=U.value),await e();let r=await k();o.value=r.data}),xe(()=>{}),(r,g)=>{const N=Qe,M=Ye,P=Ge;return c(),p("div",Ss,[t("div",$s,[t("div",Ls,[n(ws,{tabs:q.value,value:d.value,"onUpdate:value":g[0]||(g[0]=_=>d.value=_),onChange:I},null,8,["tabs","value"])]),t("div",As,[t("div",Cs,[n(N,{checked:u.checkAll,"onUpdate:checked":g[1]||(g[1]=_=>u.checkAll=_),indeterminate:u.indeterminate,onChange:m},{default:f(()=>[...g[3]||(g[3]=[R(" 全选/取消 ",-1)])]),_:1},8,["checked","indeterminate"])]),n(P,{value:u.checkedList,"onUpdate:value":g[2]||(g[2]=_=>u.checkedList=_),onChange:B},{default:f(()=>[t("div",Ns,[(c(!0),p(X,null,te(w.value,_=>(c(),p("div",{class:"list-item-wraapper",key:_.id},[t("div",Us,[n(N,{value:_.id},null,8,["value"]),t("div",Is,[t("div",Ms,[n(M,{preview:!1,width:32,src:_.avatar},null,8,["src"])]),t("div",{class:"library-name",onClick:z=>V(_.id)},F(_.library_name),9,Rs)])])]))),128))],512)]),_:1},8,["value"])])]),t("div",Ts,[n(ys,{ref_key:"searchBoxRef",ref:v,onDefaultParmas:b,onSearch:l,isError:O.value,messageObj:E(j),librarySearchData:o.value,library_ids:u.checkedList},null,8,["isError","messageObj","librarySearchData","library_ids"])])])}}},Ws=Z(qs,[["__scopeId","data-v-23754b52"]]);export{Ws as default};
