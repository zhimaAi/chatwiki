{"version":3,"file":"model-select-CMPvMrAQ.js","sources":["../../../../front-end/chat-ai-admin-vue/src/stores/modules/model.js","../../../../front-end/chat-ai-admin-vue/src/components/model-select/index.js","../../../../front-end/chat-ai-admin-vue/src/components/model-select/model-select.vue"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { getModelConfigList } from '@/api/model/index'\r\n\r\nexport const useModelStore = defineStore('model', () => {\r\n  const allModelList = ref([])\r\n\r\n  const getAllmodelList = async () => {\r\n    try {\r\n      if (allModelList.value.length == 0) {\r\n        const res = await getModelConfigList()\r\n        allModelList.value = res.data\r\n      }\r\n      return allModelList.value\r\n    } catch (error) {\r\n      console.log(error)\r\n    }\r\n  }\r\n\r\n  return {\r\n    allModelList,\r\n    getAllmodelList\r\n  }\r\n})\r\n","import { useModelStore } from '@/stores/modules/model'\r\n\r\nexport function getModelOptionsList(data) {\r\n  let newList = data || []\r\n  let choosableThinking = {}\r\n  newList.forEach((item) => {\r\n    item.key = item.config_info.id\r\n    item.id = item.config_info.id\r\n    item.config_name = item.config_info.config_name\r\n    item.model_config_id = item.config_info.id\r\n    item.children = item.use_model_configs.map((it) => {\r\n      if (it.thinking_type == 2) {\r\n        choosableThinking[item.config_info.id + '#' + it.use_model_name] = true\r\n      }\r\n      return {\r\n        ...it,\r\n        key: item.config_info.id + '_' + it.use_model_name,\r\n        value: item.config_info.id + '_' + it.use_model_name,\r\n        model_config_id: item.config_info.id,\r\n        name: it.use_model_name,\r\n        label: it.show_model_name\r\n      }\r\n    })\r\n  })\r\n\r\n  return {\r\n    newList,\r\n    choosableThinking\r\n  }\r\n}\r\n\r\nexport function getModelNameText(model_config_id, use_model_name, model_type = 'LLM') {\r\n  if (!model_config_id || !use_model_name) {\r\n    return ''\r\n  }\r\n  let modelStore = useModelStore()\r\n  if (modelStore.allModelList.length == 0) {\r\n    // modelStore.getAllmodelList()\r\n    return ''\r\n  }\r\n  let allModelList = modelStore.allModelList\r\n  allModelList = allModelList.map((item) => {\r\n    return {\r\n      ...item,\r\n      use_model_configs: item.use_model_configs.filter((it) => it.model_type == model_type)\r\n    }\r\n  })\r\n\r\n  let findConfig = allModelList.find((item) => item.config_info.id == model_config_id)\r\n  let findModel = null\r\n  if (findConfig) {\r\n    findModel = findConfig.use_model_configs.find((item) => item.use_model_name == use_model_name)\r\n  }\r\n  if (findModel) {\r\n    return `${findConfig.config_info.config_name || findConfig.config_info.show_model_name || findConfig.model_name}  ${findModel.show_model_name || findModel.use_model_name}`\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function getCurrentModelConfig(model_config_id, use_model_name, model_type = 'LLM') {\r\n  if (!model_config_id || !use_model_name) {\r\n    return null\r\n  }\r\n  let modelStore = useModelStore()\r\n  if (modelStore.allModelList.length == 0) {\r\n    return null\r\n  }\r\n  let allModelList = modelStore.allModelList\r\n  allModelList = allModelList.map((item) => {\r\n    return {\r\n      ...item,\r\n      use_model_configs: item.use_model_configs.filter((it) => it.model_type == model_type)\r\n    }\r\n  })\r\n\r\n  let findConfig = allModelList.find((item) => item.config_info.id == model_config_id)\r\n  let findModel = null\r\n  if (findConfig) {\r\n    findModel = findConfig.use_model_configs.find((item) => item.use_model_name == use_model_name)\r\n  }\r\n  if (findModel) {\r\n    return findModel\r\n  }\r\n  return null\r\n}\r\n","<template>\r\n  <!-- ph_select_model -->\r\n  <a-select\r\n    :value=\"value\"\r\n    :placeholder=\"placeholder || t('ph_select_model')\"\r\n    @change=\"handleChangeModel\"\r\n    style=\"width: 100%\"\r\n    :allowClear=\"true\"\r\n    class=\"modal-seclet-new\"\r\n  >\r\n    <template #clearIcon>\r\n      <div class=\"model-show-block\" v-if=\"selectItem && selectChildItem\">\r\n        <img class=\"icon\" :src=\"selectItem.model_icon_url\" alt=\"\" />\r\n        <div class=\"name-text\">\r\n          {{ selectItem.config_name || selectItem.model_name }}\r\n          {{ selectChildItem.show_model_name || selectChildItem.use_model_name }}\r\n        </div>\r\n      </div>\r\n    </template>\r\n    <a-select-opt-group v-for=\"item in modelList\" :key=\"item.key\">\r\n      <template #label>\r\n        <a-flex align=\"center\" :gap=\"6\">\r\n          <img class=\"model-icon\" :src=\"item.model_icon_url\" alt=\"\" />\r\n          <span>{{ item.config_name || item.model_name }}</span>\r\n        </a-flex>\r\n      </template>\r\n      <a-select-option\r\n        v-for=\"sub in item.children\"\r\n        :value=\"sub.value\"\r\n        :modelId=\"sub.model_config_id\"\r\n        :modelName=\"sub.name\"\r\n        :useConfigId=\"sub.id\"\r\n        :key=\"sub.key\"\r\n        v-bind:attrs=\"sub\"\r\n      >\r\n        {{ sub.show_model_name || sub.name }}\r\n      </a-select-option>\r\n    </a-select-opt-group>\r\n  </a-select>\r\n</template>\r\n\r\n<script setup>\r\nimport { getModelConfigOption } from '@/api/model/index'\r\nimport { ref, onMounted, watch, computed } from 'vue'\r\nimport { getModelOptionsList } from '@/components/model-select/index.js'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('components.model-select.model-select')\r\n\r\nconst emit = defineEmits(['change', 'update:modeName', 'update:modeId', 'update:useConfigId', 'loaded'])\r\nconst props = defineProps({\r\n  modelType: {\r\n    type: String,\r\n    validator: (value) => {\r\n      return ['TEXT EMBEDDING', 'RERANK', 'LLM', 'IMAGE', 'TTS'].includes(value)\r\n    },\r\n    required: true\r\n  },\r\n  modeName: {\r\n    type: [String, Number],\r\n    default: ''\r\n  },\r\n  modeId: {\r\n    type: [String, Number],\r\n    default: ''\r\n  },\r\n  useConfigId: {\r\n    type: [String, Number],\r\n    default: ''\r\n  },\r\n  placeholder: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst value = ref()\r\n\r\nwatch(\r\n  [() => props.modeId, () => props.modeName],\r\n  ([newModeId, newModeName]) => {\r\n    if (!newModeId || !newModeName) {\r\n      value.value = undefined\r\n    } else {\r\n      value.value = newModeId + '-' + newModeName\r\n    }\r\n  },\r\n  {\r\n    immediate: true\r\n  }\r\n)\r\n\r\nconst modelList = ref([])\r\n\r\nconst selectItem = computed(() => {\r\n  if (props.modeId) {\r\n    return modelList.value.find((item) => item.key == props.modeId)\r\n  }\r\n  return {}\r\n})\r\n\r\nconst selectChildItem = computed(() => {\r\n  if (selectItem.value.children && selectItem.value.children.length) {\r\n    return selectItem.value.children.find((item) => item.use_model_name == props.modeName)\r\n  }\r\n  return {}\r\n})\r\n\r\nconst handleChangeModel = (val, option) => {\r\n  if (!option) {\r\n    return\r\n  }\r\n  emit('update:modeName', option.modelName)\r\n  emit('update:modeId', option.modelId)\r\n  emit('update:useConfigId', option.useConfigId)\r\n  emit('change', val, option)\r\n}\r\nconst getModelList = () => {\r\n  getModelConfigOption({\r\n    model_type: props.modelType\r\n  }).then((res) => {\r\n    let list = res.data || []\r\n    let { newList, choosableThinking } = getModelOptionsList(list, props.modeIdType)\r\n    modelList.value = newList\r\n    emit('loaded', modelList.value, choosableThinking)\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  getModelList(false)\r\n\r\n  if (props.modeId && props.modeName) {\r\n    value.value = props.modeId + '-' + props.modeName\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.model-icon {\r\n  width: 18px;\r\n}\r\n.modal-seclet-new.ant-select {\r\n  &::v-deep(.ant-select-selection-item) {\r\n    opacity: 0;\r\n    position: relative;\r\n    z-index: 9;\r\n  }\r\n  &::v-deep(.ant-select-clear) {\r\n    opacity: 1 !important;\r\n    width: fit-content;\r\n    height: 22px;\r\n    left: 12px;\r\n    top: 5px;\r\n    margin: 0;\r\n    left: 0;\r\n    right: 0;\r\n    width: 100%;\r\n    text-align: left;\r\n    background: unset;\r\n    font-size: 14px;\r\n    padding: 0 12px;\r\n    .model-show-block {\r\n      width: 100%;\r\n      height: 100%;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 6px;\r\n      .icon {\r\n        height: 100%;\r\n        width: auto;\r\n      }\r\n      .name-text {\r\n        flex: 1;\r\n        font-size: 14px;\r\n        line-height: 22px;\r\n        color: #000;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        white-space: nowrap;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["useModelStore","defineStore","allModelList","ref","res","getModelConfigList","error","getModelOptionsList","data","newList","choosableThinking","item","it","getModelNameText","model_config_id","use_model_name","model_type","modelStore","findConfig","findModel","getCurrentModelConfig","t","useI18n","emit","__emit","props","__props","value","watch","newModeId","newModeName","modelList","selectItem","computed","selectChildItem","handleChangeModel","val","option","getModelList","getModelConfigOption","list","onMounted","_createBlock","_component_a_select","_unref","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_3","_toDisplayString","_Fragment","_renderList","_component_a_select_opt_group","_createVNode","_component_a_flex","sub","_component_a_select_option","_createTextVNode"],"mappings":"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"}