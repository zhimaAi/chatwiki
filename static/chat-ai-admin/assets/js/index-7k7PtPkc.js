import{c8 as I,c9 as H,b as K,n as W,F as X,ca as Z,cb as tt,cc as et}from"../../index-BZRrEp3V.js";import{P as at}from"./page-tabs-Bo5Jwmm1.js";import{y as F,w as N,E as O,M as lt,d as B,J as st,a2 as nt,u as it,ay as z,v as ot}from"./ui-antd-BWf8LxGy.js";import{f as u,Y as f,_ as p,k as l,a2 as i,G as m,a7 as o,a5 as s,r as P,o as dt,u as L,a1 as R,ae as M,F as _t,a9 as rt}from"./vue-chunks-Ci-XTWEs.js";import"./utils-ChQO-_r6.js";const ut={__name:"detail-modal",setup(U,{expose:S}){const h=u(!1),y=u(!1),d=u([]),r=(t,c)=>{h.value=!0,y.value=!0,c==1?w(t):_(t)},w=t=>{I({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id,data_id:t.data_id}).then(c=>{d.value=c.data||[]}).finally(()=>{y.value=!1})},_=t=>{H({begin_date_ymd:t.begin_date_ymd,end_date_ymd:t.end_date_ymd,library_id:t.library_id}).then(c=>{d.value=c.data||[]}).finally(()=>{y.value=!1})};return S({show:r}),(t,c)=>{const g=N,b=O,D=F,Y=lt;return p(),f("div",null,[l(Y,{open:h.value,"onUpdate:open":c[0]||(c[0]=v=>h.value=v),title:"机器人分布详情",width:624,footer:null},{default:i(()=>[l(D,{"data-source":d.value,loading:y.value,pagination:!1,scroll:{y:500}},{default:i(()=>[l(g,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:v})=>[m(o(v+1),1)]),_:1}),l(g,{key:"robot_name",title:"机器人",width:140},{default:i(({record:v})=>[m(o(v.robot_name),1)]),_:1}),l(g,{key:"tip",title:"触发次数",width:120},{default:i(({record:v})=>[l(b,{gap:12},{default:i(()=>[s("span",null,o(v.tip),1)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),_:1},8,["open"])])}}},ct={class:"library-page"},pt={class:"statics-block"},vt={class:"statics-item"},mt={class:"num"},yt={class:"search-box"},gt={class:"tab-box"},bt={class:"library-page-body"},ft={class:"list-box"},ht={key:0},xt={key:1,class:"qa-list-box"},kt={class:"list-item"},wt={class:"list-content"},Dt={class:"list-item",style:{color:"#8c8c8c"}},Yt={class:"list-content"},Ct={key:0},Lt={key:0},Mt=["onClick"],St={__name:"index",setup(U){const S=W(),h=u([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),y=u(0),d=u([B().startOf("month"),B()]),r=u(1),w=u([]),_=P({begin_date_ymd:d.value[0].format("YYYYMMDD"),end_date_ymd:d.value[1].format("YYYYMMDD"),library_id:void 0}),t=P({page:1,size:100,total:0}),c=[{label:"按内容",value:1},{label:"按知识库",value:2}],g=u([]),b=u(!1),D=()=>{b.value=!0,tt({..._,...t}).then(n=>{let a=n.data.list||[];a=a.map(x=>({...x})),g.value=a,t.total=+n.data.total}).finally(()=>{b.value=!1})},Y=()=>{b.value=!0,et({..._,...t}).then(n=>{let a=n.data.list||[];a=a.map(x=>({...x})),g.value=a,t.total=+n.data.total}).finally(()=>{b.value=!1})},v=()=>{t.total=0,r.value==1?t.size=100:t.size=20,C()},V=n=>{t.page=n.current,t.size=n.pageSize,r.value==1?D():Y()},C=()=>{t.page=1,r.value==1?D():Y()},q=()=>{_.begin_date_ymd="",_.end_date_ymd="",d.value&&d.value.length>0&&(_.begin_date_ymd=d.value[0].format("YYYYMMDD"),_.end_date_ymd=d.value[1].format("YYYYMMDD")),C()},T=u(null),E=n=>{T.value.show({begin_date_ymd:_.begin_date_ymd,end_date_ymd:_.end_date_ymd,library_id:n.library_id,data_id:n.data_id},r.value)},J=()=>{Z().then(n=>{y.value=n.data.tip_total})};return dt(()=>{C(),J(),X().then(n=>{w.value=n.data})}),(n,a)=>{const x=st,Q=nt,$=ot,j=it,k=N,A=O,G=F;return p(),f("div",ct,[l(at,{class:"mb-16",tabs:h.value,active:"/trigger-statics/list"},null,8,["tabs"]),s("div",pt,[s("div",vt,[a[3]||(a[3]=s("div",{class:"title"},"合计触发次数",-1)),s("div",mt,o(y.value),1)])]),s("div",yt,[l(x,{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e),allowClear:!1,onChange:q,style:{width:"256px"},presets:L(S)},null,8,["value","presets"])]),s("div",gt,[a[4]||(a[4]=s("div",{class:"main-title"},"触发次数排行榜",-1)),l(Q,{onChange:v,value:r.value,"onUpdate:value":a[1]||(a[1]=e=>r.value=e),options:c},null,8,["value"]),r.value==1?(p(),R(j,{key:0,placeholder:"全部知识库",allowClear:"",onChange:C,value:_.library_id,"onUpdate:value":a[2]||(a[2]=e=>_.library_id=e),style:{width:"220px"}},{default:i(()=>[(p(!0),f(_t,null,rt(w.value,e=>(p(),R($,{value:e.id},{default:i(()=>[m(o(e.library_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])):M("",!0)]),s("div",bt,[s("div",ft,[l(G,{"data-source":g.value,sticky:"",loading:b.value,pagination:{current:t.page,total:t.total,pageSize:t.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V,scroll:{x:800}},{default:i(()=>[l(k,{key:"index","data-index":"index",title:"排名",width:100},{default:i(({index:e})=>[m(o(e+(t.page-1)*t.size+1),1)]),_:1}),r.value==1?(p(),R(k,{key:"content","data-index":"content",title:"知识内容",width:380},{default:i(({record:e})=>[e.content?(p(),f("div",ht,o(e.content),1)):(p(),f("div",xt,[s("div",kt,[a[5]||(a[5]=s("div",{class:"list-label"},"问题",-1)),s("div",wt,o(e.question),1)]),s("div",Dt,[a[6]||(a[6]=s("div",{class:"list-label"},"答案",-1)),s("div",Yt,o(e.answer),1)])]))]),_:1})):M("",!0),l(k,{key:"library_name",title:"所属知识库",width:140},{default:i(({record:e})=>[m(o(e.library_name)+" ",1),r.value==1?(p(),f("span",Ct,[l(L(z)),m(" "+o(e.group_name||"未分组")+" ",1),e.library_file_name?(p(),f("span",Lt,[l(L(z)),m(" "+o(e.library_file_name),1)])):M("",!0)])):M("",!0)]),_:1}),l(k,{key:"tip",title:"触发次数",width:100},{default:i(({record:e})=>[l(A,{gap:12},{default:i(()=>[s("span",null,o(e.tip),1),s("a",{onClick:zt=>E(e)},[a[7]||(a[7]=m("详情")),l(L(z))],8,Mt)]),_:2},1024)]),_:1}),l(k,{key:"percentage",title:"占比",width:100},{default:i(({record:e})=>[m(o(e.percentage)+"% ",1)]),_:1})]),_:1},8,["data-source","loading","pagination"])])]),l(ut,{ref_key:"detailModalRef",ref:T},null,512)])}}},Nt=K(St,[["__scopeId","data-v-71f27aae"]]);export{Nt as default};
