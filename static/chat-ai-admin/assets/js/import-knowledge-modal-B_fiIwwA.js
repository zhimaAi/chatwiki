import{u as R,bl as W,az as E,bm as Z,A as ee,cm as ae}from"../../index-DSFcP5NQ.js";import{r,w as te,a as k,b as c,y as l,t as i,e as B,p as f,u as o,v as d,E as j,j as ne,z as oe,m as M,_ as b,F as A,D as le,q as _e,l as se,i as re}from"./vue-chunks-BdaA73Wf.js";import{_ as V}from"./emoji-mart-BBMRoEa3.js";import{F as P,a0 as ie,a1 as ue,p as de,M as J,b as S,c as ce,I as pe,V as me,ah as ve,D as he,aq as fe,q as ge,ac as ke,r as ye,T as be,z as we,a5 as xe,B as Ie,au as Le,ai as qe,s as Ce}from"./ui-antd-Dl1wwwCD.js";import{t as Oe}from"./validate-8MtiUsxW.js";import{M as $e}from"./model-select-CMPvMrAQ.js";const ze={class:"avatar-uploader"},Ue=["src"],Se={key:1},Fe={class:"ant-upload-text"},De=["src"],Ne={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(F,{emit:D}){function q(n){return new Promise((a,_)=>{const s=new FileReader;s.readAsDataURL(n),s.onload=()=>a(s.result),s.onerror=L=>_(L)})}const{t}=R("views.ai-extract-faq.list.components.avatar-input"),C=D,g=F,p=r([]),y=r(!1),e=r("");te(()=>g.value,n=>{e.value=n},{immediate:!0});const O=P.useInjectFormItemContext(),$=()=>{let n={imageUrl:e.value,file:p.value[0].originFileObj};C("change",n),C("update:value",n.imageUrl),O.onFieldChange()},I=n=>n.type==="image/jpeg"||n.type==="image/png"?n.size/1024<100?(p.value=[n],q(n).then(s=>{e.value=s,y.value=!1,$()}),!1):(S.error(t("image_size_error")),!1):(S.error(t("image_format_error")),!1),w=r(!1),z=r(""),x=r(""),N=()=>{w.value=!1,x.value=""},T=async n=>{!n.url&&!n.preview&&(n.preview=await q(n.originFileObj)),z.value=n.url||n.preview,w.value=!0,x.value=n.name||n.url.substring(n.url.lastIndexOf("/")+1)};return(n,a)=>{const _=de,s=J;return c(),k("div",ze,[l(_,{class:"upload-upload","file-list":p.value,"onUpdate:fileList":a[0]||(a[0]=L=>p.value=L),"list-type":"picture-card","show-upload-list":!1,"before-upload":I,accept:".jpg,.png,.jpeg",onPreview:T},{default:i(()=>[F.value?(c(),k("img",{key:0,class:"avatar",src:F.value,alt:"avatar"},null,8,Ue)):(c(),k("div",Se,[y.value?(c(),B(o(ie),{key:0})):(c(),B(o(ue),{key:1})),f("div",Fe,d(o(t)("upload_photo")),1)]))]),_:1},8,["file-list"]),l(s,{open:w.value,title:x.value,footer:null,onCancel:N},{default:i(()=>[f("img",{alt:"example",style:{width:"100%"},src:z.value},null,8,De)]),_:1},8,["open","title"])])}}},Te=V(Ne,[["__scopeId","data-v-1d95f309"]]),Ae={class:"form-box"},Me={class:"form-item-tip"},Be={class:"hight-set-text"},je={class:"title-block"},Pe={__name:"add-qa-library",emits:"ok",setup(F,{expose:D,emit:q}){const{t}=R("views.ai-extract-faq.list.components.add-qa-library"),C=q,g=r(!0),p=P.useForm,y=t("ai_chunk_prumpt_default"),e=j({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_not_merged_text:0,normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:y}),O=j({library_name:[{required:!0,message:t("library_name_required"),trigger:"change"}]}),{validate:$,validateInfos:I}=p(e,O),w=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},z=r([]);W().then(a=>{z.value=a.data.map(_=>({label:_.name,value:_.no}))});const x=a=>{a.length&&(e.use_model=a[0].children[0].name,e.model_config_id=a[0].model_config_id)},N=()=>{$().then(()=>{T()}).catch(a=>{})},T=()=>{let a=new FormData,_=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",_.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(Oe(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),a.append("chunk_type",e.chunk_type),a.append("normal_chunk_default_separators_no",e.normal_chunk_default_separators_no.join(",")),a.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),a.append("normal_chunk_default_not_merged_text",e.normal_chunk_default_not_merged_text),a.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),a.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),a.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),a.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),a.append("graph_switch",e.graph_switch?1:0),a.append("graph_model_config_id",e.graph_model_config_id),a.append("graph_use_model",e.graph_use_model),a.append("ai_chunk_size",e.ai_chunk_size),a.append("ai_chunk_model",e.ai_chunk_model),a.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),a.append("ai_chunk_prumpt",e.ai_chunk_prumpt),a.append("is_default",2),Z(a).then(s=>{S.success(t("create_success")),C("ok",s.data.id)})};return D({show:()=>{e.type=2,e.avatar=E,e.avatar_file=E,e.library_name="",e.library_intro="",e.chunk_type=1,e.normal_chunk_default_separators_no=[12,11],e.normal_chunk_default_not_merged_text=0,e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=y},handleOk:N}),ne(()=>{}),(a,_)=>{const s=ce,L=pe,m=me,u=ge,U=P;return c(),k("div",Ae,[l(U,{layout:"vertical"},{default:i(()=>[l(s,M({ref:"name",label:!1},o(I).avatar),{default:i(()=>[l(Te,{value:e.avatar,"onUpdate:value":_[0]||(_[0]=h=>e.avatar=h),onChange:w},null,8,["value"]),f("div",Me,d(o(t)("avatar_tip")),1)]),_:1},16),l(s,M({ref:"name",label:o(t)("library_name_label")},o(I).library_name),{default:i(()=>[l(L,{value:e.library_name,"onUpdate:value":_[1]||(_[1]=h=>e.library_name=h),placeholder:o(t)("library_name_placeholder"),maxlength:20},null,8,["value","placeholder"])]),_:1},16,["label"]),l(s,M({label:o(t)("library_intro_label")},o(I).library_intro),{default:i(()=>[l(m,{maxlength:1e3,value:e.library_intro,"onUpdate:value":_[2]||(_[2]=h=>e.library_intro=h),placeholder:o(t)("library_intro_placeholder")},null,8,["value","placeholder"])]),_:1},16,["label"]),f("div",Be,[f("div",je,[l(o(ve)),b(d(o(t)("advanced_settings")),1)]),f("div",{class:"right-btn-box",onClick:_[3]||(_[3]=h=>g.value=!g.value)},[g.value?(c(),k(A,{key:0},[b(d(o(t)("expand"))+" ",1),l(o(he))],64)):(c(),k(A,{key:1},[b(d(o(t)("collapse"))+" ",1),l(o(fe))],64))])]),oe(l(s,null,{label:i(()=>[b(d(o(t)("document_vector_model"))+" ",1),l(u,null,{title:i(()=>[b(d(o(t)("vector_model_tooltip")),1)]),default:i(()=>[l(o(ke),{class:"ml4"})]),_:1})]),default:i(()=>[l($e,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":_[4]||(_[4]=h=>e.use_model=h),modeId:e.model_config_id,"onUpdate:modeId":_[5]||(_[5]=h=>e.model_config_id=h),onLoaded:x,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[le,!g.value]])]),_:1})])}}},Re=V(Pe,[["__scopeId","data-v-333ec0c8"]]),Ve={class:"modal-box"},Ee={class:"filter-block"},Je={key:0,class:"empty-block"},Qe={class:"list-box"},Ge=["onClick"],He={class:"info-block"},Ke={class:"title"},Xe={class:"desc"},Ye={__name:"import-knowledge-modal",emits:["ok"],setup(F,{expose:D,emit:q}){const{t}=R("views.ai-extract-faq.list.components.import-knowledge-modal"),C=q;j({});const g=r(!1),p=r(1),y=r(""),e=r(""),O=r(""),$=r(""),I=m=>{O.value=m.id,$.value=m.ids||"",p.value=1,y.value="",e.value="",g.value=!0,a()},w=r(!1),z=()=>{p.value==1?N():s.value.handleOk()},x=m=>{w.value=!0,ae({library_id:m,file_id:O.value,ids:$.value}).then(u=>{S.success(t("import_success")),g.value=!1,C("ok")}).finally(()=>{w.value=!1})},N=()=>{if(!e.value)return S.error(t("select_library_error"));x(e.value)},T=m=>{x(m)},n=r([]),a=m=>{ee({library_name:y.value,show_open_docs:1}).then(u=>{n.value=u.data.filter(U=>U.type==2),m&&S.success(t("refresh_success"))})},_=m=>{e.value=m.id},s=r(null),L=()=>{p.value==2&&re(()=>{s.value&&s.value.show()})};return D({show:I}),(m,u)=>{const U=be,h=ye,Q=we,G=xe,H=Ie,K=qe,X=Ce,Y=J;return c(),k("div",null,[l(Y,{open:g.value,"onUpdate:open":u[4]||(u[4]=v=>g.value=v),"confirm-loading":w.value,title:o(t)("modal_title"),width:"746px",wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onOk:z},{default:i(()=>[f("div",Ve,[l(h,{value:p.value,"onUpdate:value":u[0]||(u[0]=v=>p.value=v),onChange:L},{default:i(()=>[l(U,{value:1},{default:i(()=>[b(d(o(t)("import_to_existing_library")),1)]),_:1}),l(U,{value:2},{default:i(()=>[b(d(o(t)("create_and_import_library")),1)]),_:1})]),_:1},8,["value"]),p.value==1?(c(),k(A,{key:0},[l(Q,{style:{"font-size":"14px",color:"#8c8c8c","font-weight":"400"},orientation:"left","orientation-margin":"0px"},{default:i(()=>[b(d(o(t)("select_library_title")),1)]),_:1}),f("div",Ee,[l(G,{value:y.value,"onUpdate:value":u[1]||(u[1]=v=>y.value=v),placeholder:o(t)("search_library_placeholder"),style:{width:"240px"},onSearch:u[2]||(u[2]=v=>a())},null,8,["value","placeholder"]),l(H,{onClick:u[3]||(u[3]=v=>a(!0)),icon:l(o(Le))},{default:i(()=>[b(d(o(t)("refresh_button")),1)]),_:1},8,["icon"])]),n.value.length==0?(c(),k("div",Je,[l(K,null,{default:i(()=>[b(d(o(t)("no_data")),1)]),_:1})])):_e("",!0),f("div",Qe,[(c(!0),k(A,null,se(n.value,v=>(c(),k("div",{class:"list-item",onClick:We=>_(v),key:v.id},[l(X,{checked:e.value==v.id},null,8,["checked"]),f("div",He,[f("div",Ke,d(v.library_name),1),f("div",Xe,d(v.library_intro),1)])],8,Ge))),128))])],64)):(c(),B(Re,{key:1,ref_key:"addQaLibraryRef",ref:s,onOk:T},null,512))])]),_:1},8,["open","confirm-loading","title"])])}}},la=V(Ye,[["__scopeId","data-v-348bcf9a"]]);export{la as I};
//# sourceMappingURL=import-knowledge-modal-B_fiIwwA.js.map
