import{ac as p,ad as r,as as t,k as e,az as L,G as C,at as U,ak as mt,ae as V,ar as a,ah as ce,ai as Ut,f as q,c as J,r as B,e as Z,n as dt,A as _t,u as k,J as G,aw as Ft,F as D,ax as X,w as rt,l as Jt,h as $t,aE as it,aF as pt,af as Qt,o as yt,b as ue,B as pe,y as Kt,aC as me,aB as ve,p as be}from"./vue-chunks-CGLjTDrY.js";import{_ as P,d as ct,a3 as fe,X as he,$ as ye,af as ke,a as ge,A as $e,ag as It,c as xe,ae as we}from"../../index-WMhSApoa.js";import{B as et,T as xt,I as vt,$ as kt,an as Dt,a5 as qe,as as Se,al as Wt,M as Y,b as W,F as At,e as Gt,y as Ht,z as Zt,a4 as Xt,a3 as Yt,aD as Ce,v as st,aE as Ie,Q as tt,at as bt,a6 as Rt,D as te,av as Le,aj as Ue,ak as Re,w as jt,x as Vt,ah as K,aF as ee,O as wt,o as Ee,R as Oe,N as Ae,V as je,af as oe,J as Ve,W as Lt,a1 as Ne,U as Bt,ae as Me,j as Ot,ag as ze,G as Pe,ao as De}from"./ui-antd-BDReVt-O.js";import{C as Be}from"./cu-upload-Cky6AbCI.js";import{u as se}from"./robot-j5RxAo6l.js";import{q as Te,t as Fe,u as Je,g as Qe,v as Ke}from"./index-CtAh6k0_.js";import{_ as We,a as Ge,M as He}from"./meta-filter-box-DNrlmi6K.js";import{g as ne,M as Nt,u as Ze}from"./model-select-DEPDrkCY.js";import{L as Xe}from"./library-select-alert-BviOL6e-.js";import{_ as Ye}from"./recommendation-AQ4_FPQ9.js";import{W as to}from"./index-DfzSnOgM.js";import{_ as ie}from"./cu-scroll-D6f5DzhK.js";import{a as eo}from"./index-CHNVlDjk.js";import{g as le}from"./index-BOfoaUzR.js";import{_ as oo}from"./empty-CzGZrENG.js";import{d as Mt}from"./vuedraggable.umd--yFJy9Bz.js";import{_ as so}from"./empty-BFmzY9bl.js";import{i as no,e as io,f as lo}from"./index-DmGhxQJp.js";import{A as ao}from"./add-collaborator-CQGDiZar.js";import{R as ro}from"./robot-select-alert-Bv0YOR8B.js";import"./neo4j-CK9lNpyi.js";import"./utils-DXEytJvC.js";import"./other-BrZCAsTs.js";import"./index-BafABkdm.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-CmVBwGXE.js";const _o={class:"edit-box-header"},co={class:"left-box"},uo={class:"edit-box-title"},po={key:0},mo={key:0,class:"title-tip"},vo={class:"right-box"},bo={class:"extra-box"},fo={class:"actions-box"},ho={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(M,{emit:_}){const h=_,l=M,u=s=>{h("edit"),h("update:isEdit",s)},o=()=>{h("save")};return(s,g)=>{const y=ct,x=et,f=xt;return r(),p("div",{class:Ut(["edit-box",{"is-edit":M.isEdit}])},[t("div",_o,[t("div",co,[e(y,{class:"edit-box-icon",name:l.iconName},null,8,["name"]),t("span",uo,[C(U(l.title)+" ",1),s.$slots.icon?(r(),p("span",po,[mt(s.$slots,"icon",{},void 0,!0)])):L("",!0)]),s.$slots.tip?(r(),p("span",mo,[mt(s.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",vo,[t("div",bo,[mt(s.$slots,"extra",{},()=>[t("div",fo,[l.isEdit?(r(),V(f,{key:0,gap:8},{default:a(()=>[e(x,{onClick:o,size:"small",type:"primary"},{default:a(()=>[...g[2]||(g[2]=[C("保存",-1)])]),_:1}),e(x,{onClick:g[0]||(g[0]=d=>u(!1)),size:"small"},{default:a(()=>[...g[3]||(g[3]=[C("取消",-1)])]),_:1})]),_:1})):(r(),V(x,{key:1,onClick:g[1]||(g[1]=d=>u(!0)),size:"small"},{default:a(()=>[...g[4]||(g[4]=[C("修改",-1)])]),_:1}))])],!0)])])]),t("div",{class:"edit-box-body",style:ce({...M.bodyStyle})},[mt(s.$slots,"default",{},void 0,!0)],4)],2)}}},H=P(ho,[["__scopeId","data-v-1b63f826"]]),yo={class:"robot-form-box"},ko={class:"form-item"},go={class:"form-item-body robot-name-item"},$o={class:"robot-avetar-upload"},xo=["src"],wo={class:"robot-name-box"},qo={class:"form-item"},So={class:"form-item-body"},Co={class:"robot-info-box"},Io={class:"robot-name-box"},Lo=["src"],Uo={class:"robot-name"},Ro={class:"robot-intro"},Eo={__name:"basic-config",setup(M){const _=se(),h=q(!1),{robotInfo:l,updateRobotInfo:u}=J("robotInfo"),o=B({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),s=Z(()=>_.robotList||[]),g=Z(()=>_.robotGroupList||[]),y=Z(()=>{let c="未分组",n=s.value.find(b=>b.id==l.id)||{};if(n.group_id>0){let b=g.value.find(w=>w.id==n.group_id);b&&(c=b.group_name)}return c}),x=()=>{u({...G(o)}),h.value=!1},f=c=>{let n=c[0];return o.robot_avatar=n,fe(n).then(b=>{o.robot_avatar_url=b}),!1},d=()=>{o.robot_name=l.robot_name,o.robot_intro=l.robot_intro,o.robot_avatar=l.robot_avatar,o.robot_avatar_url=l.robot_avatar_url};return(c,n)=>{const b=vt,w=kt;return r(),V(H,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:h.value,"onUpdate:isEdit":n[2]||(n[2]=S=>h.value=S),onSave:x,onEdit:d},{default:a(()=>[dt(t("div",yo,[t("div",ko,[n[3]||(n[3]=t("div",{class:"form-item-label"},"机器人名称/头像",-1)),t("div",go,[e(Be,{accept:"image/*",onChange:f},{default:a(()=>[t("div",$o,[o.robot_avatar_url?(r(),p("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,xo)):L("",!0)])]),_:1}),t("div",wo,[e(b,{value:o.robot_name,"onUpdate:value":n[0]||(n[0]=S=>o.robot_name=S),placeholder:"请输入机器人名称"},null,8,["value"])])])]),t("div",qo,[n[4]||(n[4]=t("div",{class:"form-item-label"},"简介",-1)),t("div",So,[e(w,{rows:3,value:o.robot_intro,"onUpdate:value":n[1]||(n[1]=S=>o.robot_intro=S),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[_t,h.value]]),dt(t("div",Co,[t("div",Io,[t("img",{class:"robot-avatar",src:k(l).robot_avatar_url,alt:""},null,8,Lo),t("span",Uo,U(k(l).robot_name),1)]),t("div",Ro,[t("span",null,"分组："+U(y.value),1),t("span",null,"简介："+U(k(l).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[_t,!h.value]])]),_:1},8,["isEdit"])}}},Oo=P(Eo,[["__scopeId","data-v-0adbabe6"]]),Ao={class:"ai-create-box"},jo={class:"input-box"},Vo={key:1},No={key:2},Mo={class:"quick-tags-box"},zo={class:"ai-list-box"},Po={key:0,class:"loading-box"},Do={key:0,class:"prompt-list-box"},Bo={class:"prompt-list"},To={class:"prompt-header"},Fo={class:"prompt-title"},Jo={class:"prompt-content"},Qo={class:"prompt-list"},Ko={class:"prompt-header"},Wo={class:"prompt-title"},Go={class:"prompt-content"},Ho={class:"prompt-list"},Zo={class:"prompt-header"},Xo={class:"prompt-title"},Yo={class:"prompt-content"},ts={class:"prompt-list"},es={class:"prompt-header"},os={class:"prompt-title"},ss={class:"prompt-content"},ns={class:"prompt-list"},is={class:"prompt-header"},ls={class:"prompt-title"},as={class:"prompt-content"},rs={class:"prompt-header"},ds={class:"prompt-title"},_s={class:"prompt-content"},cs={key:1,class:"empty-box"},us={__name:"ai-create-prompt",emits:["handleAiSave"],setup(M,{expose:_,emit:h}){const l=Dt.PRESENTED_IMAGE_SIMPLE,u=q(!1),o=q(!1),s=Ft().query,g=h,y=q(""),x=q(!1),f=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],d=q("在上方输入框输入要求，点击生成提示词"),c=()=>{n.value=!1,w.promptStruct=b,y.value="",d.value="在上方输入框输入要求，点击生成提示词",u.value=!0},n=q(!1),b={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},w=B({promptStruct:b}),S=I=>{y.value=I},i=()=>{if(!y.value)return W.error("请输入AI 生成提示词");if(x.value)return W.error("正在生成中...");x.value=!0,Te({id:s.id,demand:y.value}).then(I=>{w.promptStruct=JSON.parse(I.data.promptStruct),n.value=!0}).finally(()=>{x.value=!1}).catch(I=>{n.value=!1,d.value=I.msg})},v=()=>{if(!n.value)return W.error("请先生成提示词");g("handleAiSave",w.promptStruct),u.value=!1};return _({show:c}),(I,m)=>{const O=et,T=kt,R=ct,N=Se,E=Wt,ot=Dt,F=Y;return r(),p("div",null,[e(F,{open:u.value,"onUpdate:open":m[1]||(m[1]=A=>u.value=A),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:a(()=>[e(O,{type:"primary",loading:o.value,onClick:v},{default:a(()=>[...m[2]||(m[2]=[C("使用该提示",-1)])]),_:1},8,["loading"])]),default:a(()=>[t("div",Ao,[t("div",jo,[e(T,{style:{width:"100%"},value:y.value,"onUpdate:value":m[0]||(m[0]=A=>y.value=A),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),t("div",{class:Ut(["btn-box",{"disabed-status":x.value}]),onClick:i},[x.value?(r(),V(k(qe),{key:0})):L("",!0),e(R,{name:"ai-mark"}),x.value?(r(),p("span",Vo,"生成中...")):(r(),p("span",No,"生成"))],2)]),t("div",Mo,[m[3]||(m[3]=t("div",{class:"quick-label"},"快捷生成：",-1)),(r(),p(D,null,X(f,A=>e(N,{key:A.title,onClick:ut=>S(A.title),color:"blue"},{default:a(()=>[C(U(A.title),1)]),_:2},1032,["onClick"])),64))]),t("div",zo,[x.value?(r(),p("div",Po,[e(E,{tip:"正在生成中..."})])):(r(),p(D,{key:1},[n.value?(r(),p("div",Do,[t("div",Bo,[t("div",To,[t("div",Fo,U(w.promptStruct.role.subject),1)]),t("div",Jo,U(w.promptStruct.role.describe),1)]),t("div",Qo,[t("div",Ko,[t("div",Wo,U(w.promptStruct.task.subject),1)]),t("div",Go,U(w.promptStruct.task.describe),1)]),t("div",Ho,[t("div",Zo,[t("div",Xo,U(w.promptStruct.constraints.subject),1)]),t("div",Yo,U(w.promptStruct.constraints.describe),1)]),t("div",ts,[t("div",es,[t("div",os,U(w.promptStruct.output.subject),1)]),t("div",ss,U(w.promptStruct.output.describe),1)]),t("div",ns,[t("div",is,[t("div",ls,U(w.promptStruct.tone.subject),1)]),t("div",as,U(w.promptStruct.tone.describe),1)]),(r(!0),p(D,null,X(w.promptStruct.custom,(A,ut)=>(r(),p("div",{class:"prompt-list",key:ut+A.key?A.key:""},[t("div",rs,[t("div",ds,U(A.subject),1)]),t("div",_s,U(A.describe),1)]))),128))])):(r(),p("div",cs,[e(ot,{image:k(l),description:d.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},ps=P(us,[["__scopeId","data-v-1dd9dabe"]]),ms={__name:"upload-prompt",setup(M,{expose:_}){const h=q(!1),l=B({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),u=q(null),o=f=>{if(f.prompt_type==0&&!f.prompt)return W.error("自定义提示为空,无法上传");u.value&&u.value.resetFields();let d={...f};l.title="",l.group_id=0,l.prompt="",l.prompt_struct={},l.prompt_type=d.prompt_type,d.prompt_type==0?l.prompt=d.prompt:l.prompt_struct=JSON.stringify(d.prompt_struct),h.value=!0},s=q([]);(()=>{he().then(f=>{s.value=[{id:0,group_name:"默认分组"},...f.data]})})();const y=q(!1),x=()=>{u.value.validate().then(()=>{let f={...l};y.value=!0,ye({...f}).then(()=>{W.success("保存成功"),h.value=!1}).finally(()=>{y.value=!1})})};return _({show:o}),(f,d)=>{const c=vt,n=Gt,b=Zt,w=Ht,S=At,i=Y;return r(),p("div",null,[e(i,{open:h.value,"onUpdate:open":d[2]||(d[2]=v=>h.value=v),title:"保存到提示词库",width:580,onOk:x,confirmLoading:y.value},{default:a(()=>[e(S,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:u,model:l},{default:a(()=>[e(n,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:a(()=>[e(c,{value:l.title,"onUpdate:value":d[0]||(d[0]=v=>l.title=v),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),e(n,{name:"group_id",label:"分组"},{default:a(()=>[e(w,{value:l.group_id,"onUpdate:value":d[1]||(d[1]=v=>l.group_id=v),style:{width:"100%"}},{default:a(()=>[(r(!0),p(D,null,X(s.value,v=>(r(),V(b,{value:v.id},{default:a(()=>[C(U(v.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},vs={class:"prompt-box"},bs={class:"tab-header"},fs={key:0,class:"opt-block"},hs={key:1,class:"opt-block"},ys={class:"tip-text"},ks={key:0,class:"prompt-list-box"},gs={class:"prompt-list"},$s={class:"prompt-header"},xs={class:"prompt-title"},ws={key:0,class:"btn-wrapper-box"},qs={class:"prompt-content"},Ss={class:"prompt-list"},Cs={class:"prompt-header"},Is={class:"prompt-title"},Ls={key:0,class:"btn-wrapper-box"},Us={class:"prompt-content"},Rs={class:"prompt-list"},Es={class:"prompt-header"},Os={class:"prompt-title"},As={key:0,class:"btn-wrapper-box"},js={class:"prompt-content"},Vs={class:"prompt-list"},Ns={class:"prompt-header"},Ms={class:"prompt-title"},zs={key:0,class:"btn-wrapper-box"},Ps={class:"prompt-content"},Ds={class:"prompt-list"},Bs={class:"prompt-header"},Ts={class:"prompt-title"},Fs={key:0,class:"btn-wrapper-box"},Js={class:"swich-item"},Qs={class:"swich-item"},Ks={class:"prompt-content"},Ws={class:"prompt-list"},Gs={class:"prompt-header"},Hs={class:"prompt-title"},Zs={key:0,class:"btn-wrapper-box"},Xs={class:"prompt-content"},Ys={class:"prompt-header"},tn={class:"prompt-title",style:{flex:"1"}},en={key:0,class:"btn-wrapper-box"},on=["onClick"],sn={class:"prompt-content"},nn={key:0,class:"add-theme-block"},ln={class:"show-more-block"},an={key:1,class:"diy-prompt-box"},rn={key:0,class:"diy-switch-box"},dn={class:"swich-item"},_n={class:"swich-item"},lt="- 请使用markdown格式回答问题。",at="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",cn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(M){const _=q(!1),{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),u=M;let o={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const s=q({}),g=q(!1),y=q(!1),x=q(!1),f=q(!1),d=B({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),c=q(localStorage.getItem("system_prompt_words_ishide")=="1"),n=()=>{c.value=!c.value,localStorage.setItem("system_prompt_words_ishide",c.value?1:0)},b=(z,$)=>z.includes($),w=q(h.prompt_type),S=Z(()=>h.prompt_type);rt(()=>h,()=>{d.prompt=h.prompt,d.prompt_struct=h.prompt_struct,s.value=h.prompt_struct_default},{immediate:!0,deep:!0}),rt(()=>d.prompt_struct.output.describe,z=>{g.value=b(z,lt),y.value=b(z,at)},{immediate:!0,deep:!0}),rt(()=>d.prompt,z=>{x.value=b(z,lt),f.value=b(z,at)},{immediate:!0,deep:!0});const i=(z,$)=>{z?($=="outSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+lt:d.prompt_struct.output.describe+=lt),$=="imgSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+at:d.prompt_struct.output.describe+=at)):($=="outSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(lt,"g"),"")),$=="imgSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(at,"g"),"")),d.prompt_struct.output.describe=d.prompt_struct.output.describe.trim())},v=(z,$)=>{z?($=="outDiySwitch"&&(d.prompt?d.prompt+=`
`+lt:d.prompt+=lt),$=="imgDiySwitch"&&(d.prompt?d.prompt+=`
`+at:d.prompt+=at)):($=="outDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(lt,"g"),"")),$=="imgDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(at,"g"),"")),d.prompt=d.prompt.trim())},I=z=>{d.prompt_struct[z].describe=s.value[z].describe},m=()=>{let z=h.work_flow_ids.split(","),$=u.robotList.filter(ht=>z.includes(ht.id)),gt=[];gt=$.map(ht=>`- ${ht.robot_name} ${ht.robot_intro}`).join(`
`),d.prompt_struct.skill.describe=gt},O=()=>{d.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),w.value=1},T=z=>{d.prompt_struct.custom.splice(z,1)},R=()=>{l({...G(d),prompt_type:w.value}),_.value=!1},N=z=>{w.value=1,l({prompt_type:w.value,prompt:d.prompt,prompt_struct:z}),_.value=!1},E=()=>{_.value=!0},ot=()=>{_.value=!1},F=q(null),A=()=>{F.value.show()},ut=q(null),Q=()=>{ut.value.show()},ft=q(null),Et=()=>{ft.value.show({...d,prompt_type:w.value})},ae=z=>{z.prompt_type==1?(w.value=1,d.prompt_struct=z.prompt_struct):(w.value=0,d.prompt=z.prompt),R()};return(z,$)=>{const gt=Xt,ht=Yt,zt=st,re=ct,qt=et,de=xt,nt=kt,St=tt,_e=vt;return r(),p("div",vs,[t("div",bs,[e(ht,{activeKey:w.value,"onUpdate:activeKey":$[0]||($[0]=j=>w.value=j)},{default:a(()=>[(r(),V(gt,{key:1,tab:"结构化提示词"})),(r(),V(gt,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),_.value?(r(),p("div",fs,[e(zt,null,{title:a(()=>[...$[22]||($[22]=[C("将当前编辑的提示词保存到提示词库中",-1)])]),default:a(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Et},[e(k(Ce)),$[23]||($[23]=C("上传 ",-1))])]),_:1}),e(zt,null,{title:a(()=>[...$[24]||($[24]=[C("从提示词库导入提示词",-1)])]),default:a(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Q},[e(k(Ie)),$[25]||($[25]=C("导入 ",-1))])]),_:1}),t("div",{class:"ai-mark-box hover-btn-box",onClick:A},[e(re,{name:"ai-mark"}),$[26]||($[26]=C(" AI自动生成 ",-1))]),e(de,{gap:8},{default:a(()=>[e(qt,{size:"small",type:"primary",onClick:R},{default:a(()=>[...$[27]||($[27]=[C("保存",-1)])]),_:1}),e(qt,{size:"small",onClick:ot},{default:a(()=>[...$[28]||($[28]=[C("取消",-1)])]),_:1})]),_:1})])):(r(),p("div",hs,[t("span",ys,"当前类型："+U(S.value==1?"结构化提示词":"自定义提示词"),1),e(qt,{size:"small",onClick:E},{default:a(()=>[...$[29]||($[29]=[C("修改",-1)])]),_:1})]))]),w.value==1?(r(),p("div",ks,[t("div",gs,[t("div",$s,[t("div",xs,U(d.prompt_struct.role.subject),1),_.value?(r(),p("div",ws,[t("a",{onClick:$[1]||($[1]=j=>I("role"))},"恢复默认")])):L("",!0)]),t("div",qs,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.role.describe,"onUpdate:value":$[2]||($[2]=j=>d.prompt_struct.role.describe=j),placeholder:k(o).role},null,8,["disabled","value","placeholder"])])]),t("div",Ss,[t("div",Cs,[t("div",Is,U(d.prompt_struct.task.subject),1),_.value?(r(),p("div",Ls,[t("a",{onClick:$[3]||($[3]=j=>I("task"))},"恢复默认")])):L("",!0)]),t("div",Us,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.task.describe,"onUpdate:value":$[4]||($[4]=j=>d.prompt_struct.task.describe=j),placeholder:k(o).task},null,8,["disabled","value","placeholder"])])]),c.value?(r(),p(D,{key:0},[t("div",Rs,[t("div",Es,[t("div",Os,U(d.prompt_struct.constraints.subject),1),_.value?(r(),p("div",As,[t("a",{onClick:$[5]||($[5]=j=>I("constraints"))},"恢复默认")])):L("",!0)]),t("div",js,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.constraints.describe,"onUpdate:value":$[6]||($[6]=j=>d.prompt_struct.constraints.describe=j),placeholder:k(o).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),t("div",Vs,[t("div",Ns,[t("div",Ms,U(d.prompt_struct.skill.subject),1),_.value?(r(),p("div",zs,[t("a",{onClick:$[7]||($[7]=j=>m())},"自动导入技能")])):L("",!0)]),t("div",Ps,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.skill.describe,"onUpdate:value":$[8]||($[8]=j=>d.prompt_struct.skill.describe=j),placeholder:k(o).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),t("div",Ds,[t("div",Bs,[t("div",Ts,U(d.prompt_struct.output.subject),1),_.value?(r(),p("div",Fs,[t("div",Js,[$[30]||($[30]=C(" 输出markdown： ",-1)),e(St,{onChange:$[9]||($[9]=j=>i(j,"outSwitch")),checked:g.value,"onUpdate:checked":$[10]||($[10]=j=>g.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",Qs,[$[31]||($[31]=C(" 回复图片： ",-1)),e(St,{onChange:$[11]||($[11]=j=>i(j,"imgSwitch")),checked:y.value,"onUpdate:checked":$[12]||($[12]=j=>y.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("a",{onClick:$[13]||($[13]=j=>I("output"))},"恢复默认")])):L("",!0)]),t("div",Ks,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.output.describe,"onUpdate:value":$[14]||($[14]=j=>d.prompt_struct.output.describe=j),placeholder:k(o).output},null,8,["disabled","value","placeholder"])])]),t("div",Ws,[t("div",Gs,[t("div",Hs,U(d.prompt_struct.tone.subject),1),_.value?(r(),p("div",Zs,[t("a",{onClick:$[15]||($[15]=j=>I("tone"))},"恢复默认")])):L("",!0)]),t("div",Xs,[e(nt,{bordered:!1,disabled:!_.value,value:d.prompt_struct.tone.describe,"onUpdate:value":$[16]||($[16]=j=>d.prompt_struct.tone.describe=j),placeholder:k(o).tone},null,8,["disabled","value","placeholder"])])]),(r(!0),p(D,null,X(d.prompt_struct.custom,(j,Pt)=>(r(),p("div",{class:"prompt-list",key:Pt+j.key?j.key:""},[t("div",Ys,[t("div",tn,[e(_e,{bordered:!1,disabled:!_.value,style:{width:"100%"},value:j.subject,"onUpdate:value":Ct=>j.subject=Ct,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),_.value?(r(),p("div",en,[t("div",{class:"hover-btn-box",onClick:Ct=>T(Pt)},[e(k(bt))],8,on)])):L("",!0)]),t("div",sn,[e(nt,{bordered:!1,disabled:!_.value,value:j.describe,"onUpdate:value":Ct=>j.describe=Ct,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),_.value?(r(),p("div",nn,[e(qt,{onClick:O,block:"",icon:Jt(k(Rt))},{default:a(()=>[...$[32]||($[32]=[C("添加主题",-1)])]),_:1},8,["icon"])])):L("",!0)],64)):L("",!0),t("div",ln,[t("div",{class:"btn-item",onClick:n},[c.value?(r(),p(D,{key:1},[$[34]||($[34]=C("收起",-1)),e(k(Le))],64)):(r(),p(D,{key:0},[$[33]||($[33]=C("展开",-1)),e(k(te))],64))])])])):(r(),p("div",an,[_.value?(r(),p("div",rn,[t("div",dn,[$[35]||($[35]=C(" 输出markdown： ",-1)),e(St,{size:"small",onChange:$[17]||($[17]=j=>v(j,"outDiySwitch")),checked:x.value,"onUpdate:checked":$[18]||($[18]=j=>x.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",_n,[$[36]||($[36]=C(" 回复图片： ",-1)),e(St,{size:"small",onChange:$[19]||($[19]=j=>v(j,"imgDiySwitch")),checked:f.value,"onUpdate:checked":$[20]||($[20]=j=>f.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):L("",!0),e(nt,{bordered:_.value,value:d.prompt,"onUpdate:value":$[21]||($[21]=j=>d.prompt=j),disabled:!_.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),e(ps,{onHandleAiSave:N,ref_key:"aiCreatePromptRef",ref:F},null,512),e(We,{onOk:ae,ref_key:"importPromptRef",ref:ut},null,512),e(ms,{ref_key:"uploadPromptRef",ref:ft},null,512)])}}},un=P(cn,[["__scopeId","data-v-ba912067"]]),pn={class:"actions-box"},mn={class:"setting-info-block"},vn={class:"set-item w-100"},bn={class:"set-item"},fn={class:"set-item"},hn={class:"set-item"},yn={class:"set-item"},kn={class:"form-box"},gn={class:"form-item"},$n={class:"form-item-body"},xn={class:"form-item",style:{display:"flex","align-items":"center"}},wn={class:"form-item"},qn={class:"form-item-label"},Sn={class:"form-item-body"},Cn={class:"number-box"},In={class:"number-slider-box"},Ln={class:"number-input-box"},Un={class:"form-item"},Rn={class:"form-item-label"},En={class:"form-item-body"},On={class:"number-box"},An={class:"number-slider-box"},jn={class:"number-input-box"},Vn={class:"form-item"},Nn={class:"form-item-label"},Mn={class:"form-item-body"},zn={class:"number-box"},Pn={class:"number-slider-box"},Dn={class:"number-input-box"},Bn={class:"form-item justify-between"},Tn={class:"form-item-label"},Fn={class:"form-item justify-between"},Jn={class:"form-item-label"},Qn={class:"form-item justify-between"},Kn={class:"form-item-label"},Wn={__name:"model-settings",setup(M){const _=B({sm:24,md:24,lg:12,xl:24,xxl:24});q([]);const h=q(!1),{robotInfo:l,updateRobotInfo:u,getRobot:o}=J("robotInfo"),s=B({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0,question_multiple_switch:1}),g=q(!1),y=(S,i)=>{const v=i.attrs;s.question_multiple_switch=Number(v.input_image)||0,v&&v.input_image==1?g.value=!1:g.value=!0,s.use_model&&s.use_model.toLowerCase().includes("deepseek-r1")?s.prompt_role_type="1":s.prompt_role_type="0"},x=q({}),f=(S,i)=>{x.value=i},d=Z(()=>{if(!s.model_config_id)return!1;let S=s.model_config_id+"#"+s.use_model;return x.value[S]}),c=()=>{let S={...G(s)};u(S),h.value=!1},n=()=>{o(l.id).then(S=>{s.model_config_id=S.data.model_config_id,s.use_model=S.data.use_model})},b=S=>{s.use_model=l.use_model,s.model_config_id=l.model_config_id,s.temperature=l.temperature,s.max_token=l.max_token,s.context_pair=l.context_pair,s.think_switch=Number(l.think_switch),s.prompt_role_type=l.prompt_role_type,s.enable_thinking=l.enable_thinking,s.question_multiple_switch=Number(l.question_multiple_switch)||0,h.value=S};$t(()=>{s.use_model=l.use_model,s.model_config_id=l.model_config_id,s.temperature=l.temperature,s.max_token=l.max_token,s.context_pair=l.context_pair,s.think_switch=Number(l.think_switch),s.prompt_role_type=l.prompt_role_type,s.enable_thinking=l.enable_thinking,s.question_multiple_switch=Number(l.question_multiple_switch)||0});const w=Z(()=>ne(s.model_config_id,s.use_model));return(S,i)=>{const v=et,I=Re,m=Vt,O=jt,T=st,R=ee,N=wt,E=tt,ot=Ue,F=Y;return r(),V(H,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:h.value,"onUpdate:isEdit":i[14]||(i[14]=A=>h.value=A)},{extra:a(()=>[t("div",pn,[e(v,{onClick:i[0]||(i[0]=A=>b(!0)),size:"small"},{default:a(()=>[...i[15]||(i[15]=[C("修改",-1)])]),_:1})])]),default:a(()=>[t("div",mn,[t("div",vn,[i[16]||(i[16]=C(" LLM模型： ",-1)),t("span",null,U(w.value),1)]),t("div",bn,[i[17]||(i[17]=C(" 温度： ",-1)),t("span",null,U(s.temperature),1)]),t("div",fn,[i[18]||(i[18]=C(" 最大token： ",-1)),t("span",null,U(s.max_token),1)]),t("div",hn,[i[19]||(i[19]=C(" 上下文数量： ",-1)),t("span",null,U(s.context_pair),1)]),t("div",yn,[i[20]||(i[20]=C(" 显示推理过程： ",-1)),t("span",null,U(s.think_switch==1?"开":"关"),1)])]),e(F,{open:h.value,"onUpdate:open":i[13]||(i[13]=A=>h.value=A),width:672,title:"模型设置",onCancel:n,onOk:c},{default:a(()=>[t("div",kn,[e(ot,{gutter:[32,24]},{default:a(()=>[e(I,it(pt(_)),{default:a(()=>[t("div",gn,[i[21]||(i[21]=t("div",{class:"form-item-label mb12"},[t("span",null,"LLM模型 ")],-1)),t("div",$n,[e(Nt,{modelType:"LLM",modeName:s.use_model,"onUpdate:modeName":i[1]||(i[1]=A=>s.use_model=A),modeId:s.model_config_id,"onUpdate:modeId":i[2]||(i[2]=A=>s.model_config_id=A),onChange:y,onLoaded:f},null,8,["modeName","modeId"])])])]),_:1},16),e(I,it(pt(_)),{default:a(()=>[t("div",xn,[i[24]||(i[24]=t("div",{class:"form-item-label mb12"},[t("span",null,"提示词所属角色： ")],-1)),t("div",null,[e(O,{value:s.prompt_role_type,"onUpdate:value":i[3]||(i[3]=A=>s.prompt_role_type=A)},{default:a(()=>[e(m,{value:"0"},{default:a(()=>[...i[22]||(i[22]=[C("系统角色（System）",-1)])]),_:1}),e(m,{value:"1"},{default:a(()=>[...i[23]||(i[23]=[C("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])])])]),_:1},16),e(I,it(pt(_)),{default:a(()=>[t("div",wn,[t("div",qn,[i[26]||(i[26]=t("span",null,"温度 ",-1)),e(T,null,{title:a(()=>[...i[25]||(i[25]=[C("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),t("div",Sn,[t("div",Cn,[t("div",In,[e(R,{class:"custom-slider",value:s.temperature,"onUpdate:value":i[4]||(i[4]=A=>s.temperature=A),min:0,max:2,step:.1},null,8,["value"])]),t("div",Ln,[e(N,{value:s.temperature,"onUpdate:value":i[5]||(i[5]=A=>s.temperature=A),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),e(I,it(pt(_)),{default:a(()=>[t("div",Un,[t("div",Rn,[i[28]||(i[28]=t("span",null,"最大token ",-1)),e(T,null,{title:a(()=>[...i[27]||(i[27]=[C("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),t("div",En,[t("div",On,[t("div",An,[e(R,{class:"custom-slider",value:s.max_token,"onUpdate:value":i[6]||(i[6]=A=>s.max_token=A),min:0,max:100*1024},null,8,["value"])]),t("div",jn,[e(N,{value:s.max_token,"onUpdate:value":i[7]||(i[7]=A=>s.max_token=A),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),e(I,it(pt(_)),{default:a(()=>[t("div",Vn,[t("div",Nn,[i[30]||(i[30]=t("span",null,"上下文数量 ",-1)),e(T,null,{title:a(()=>[...i[29]||(i[29]=[C("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),t("div",Mn,[t("div",zn,[t("div",Pn,[e(R,{class:"custom-slider",value:s.context_pair,"onUpdate:value":i[8]||(i[8]=A=>s.context_pair=A),min:0,max:50},null,8,["value"])]),t("div",Dn,[e(N,{value:s.context_pair,"onUpdate:value":i[9]||(i[9]=A=>s.context_pair=A),min:0,max:50},null,8,["value"])])])])])]),_:1},16),e(I,it(pt(_)),{default:a(()=>[t("div",Bn,[t("div",Tn,[i[32]||(i[32]=t("span",null,"多模态输入 ",-1)),e(T,null,{title:a(()=>[...i[31]||(i[31]=[t("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),e(Ge,{title:"当前选择的模型不支持多模态输入",disabled:!g.value},{default:a(()=>[e(E,{checked:s.question_multiple_switch,"onUpdate:checked":i[10]||(i[10]=A=>s.question_multiple_switch=A),checkedValue:1,unCheckedValue:0,disabled:g.value},null,8,["checked","disabled"])]),_:1},8,["disabled"])])]),_:1},16),d.value?(r(),V(I,it(Qt({key:0},_)),{default:a(()=>[t("div",Fn,[t("div",Jn,[i[34]||(i[34]=t("span",null,"深度思考 ",-1)),e(T,null,{title:a(()=>[...i[33]||(i[33]=[t("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),e(E,{checked:s.enable_thinking,"onUpdate:checked":i[11]||(i[11]=A=>s.enable_thinking=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):L("",!0),e(I,it(pt(_)),{default:a(()=>[t("div",Qn,[t("div",Kn,[i[36]||(i[36]=t("span",null,"显示推理过程 ",-1)),e(T,null,{title:a(()=>[...i[35]||(i[35]=[t("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),e(E,{checked:s.think_switch,"onUpdate:checked":i[12]||(i[12]=A=>s.think_switch=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Gn=P(Wn,[["__scopeId","data-v-5cd8b1bd"]]),Hn={class:"recall-settings-box"},Zn={class:"form-box"},Xn={class:"form-item is-required"},Yn={class:"form-item-body"},ti={class:"retrieval-mode-items"},ei=["onClick"],oi={class:"retrieval-mode-title"},si={class:"title-text"},ni={key:0,style:{width:"32px"},src:Ye,alt:""},ii={class:"retrieval-mode-desc"},li={key:0,class:"form-item"},ai={class:"form-item"},ri={class:"form-item-label"},di={class:"form-item-body"},_i={class:"number-box"},ci={class:"number-slider-box"},ui={class:"number-input-box"},pi={key:1,class:"form-item"},mi={class:"form-item-label"},vi={class:"form-item-body"},bi={class:"number-box"},fi={class:"number-slider-box"},hi={class:"number-input-box"},yi={class:"form-item"},ki={class:"form-item-label"},gi={key:0,class:"form-item-body"},$i={class:"form-item"},xi={class:"form-item-label"},wi={key:0,class:"form-item-body"},qi={__name:"recall-settings-alert",emits:["change"],setup(M,{expose:_,emit:h}){const l=h,u=q([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=B({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{}}),s=q(null),g=q(!1),y=q({}),x=q([]),f=(i,v=null)=>{y.value=v,d(),o.rerank_status=i.rerank_status||0,o.rerank_use_model=i.rerank_use_model||void 0,o.rerank_model_config_id=i.rerank_model_config_id>0?i.rerank_model_config_id:"",o.top_k=i.top_k,o.similarity=i.similarity,o.search_type=i.search_type,o.meta_search_switch=Number(i.meta_search_switch),o.meta_search_type=Number(i.meta_search_type),o.meta_search_condition_list=i.meta_search_condition_list,o.rrf_weight=i.rrf_weight,g.value=!0},d=()=>{ke({id:y.value.id}).then(i=>{x.value=(i==null?void 0:i.data)||[]})},c=i=>{i==0&&(o.rerank_model_config_id="",o.rerank_use_model="")},n=i=>{o.search_type=i},b=()=>o.rerank_status==1&&!o.rerank_model_config_id,w=()=>{if(b())return W.error("请选择Rerank模型");o.meta_search_switch==1&&!s.value.verify()||(g.value=!1,S())},S=()=>{l("change",G(o))};return _({open:f}),(i,v)=>{const I=ct,m=st,O=ee,T=wt,R=tt,N=Y;return r(),V(N,{width:"746px",open:g.value,"onUpdate:open":v[11]||(v[11]=E=>g.value=E),title:"召回设置",onOk:w},{default:a(()=>[t("div",Hn,[t("div",Zn,[t("div",Xn,[v[12]||(v[12]=t("div",{class:"form-item-label"},[t("span",null,"检索模式")],-1)),t("div",Yn,[t("div",ti,[(r(!0),p(D,null,X(u.value,E=>(r(),p("div",{class:Ut(["retrieval-mode-item",{active:o.search_type==E.value}]),key:E.value,onClick:ot=>n(E.value)},[o.search_type==E.value?(r(),V(I,{key:0,class:"check-arrow",name:"check-arrow-filled"})):L("",!0),t("div",oi,[e(I,{name:E.iconName,class:"title-icon"},null,8,["name"]),t("span",si,U(E.title),1),E.isRecommendation?(r(),p("img",ni)):L("",!0)]),t("div",ii,U(E.desc),1)],10,ei))),128))])])]),o.search_type==1?(r(),p("div",li,[e(to,{rrf_weight:o.rrf_weight,"onUpdate:rrf_weight":v[0]||(v[0]=E=>o.rrf_weight=E)},null,8,["rrf_weight"])])):L("",!0),t("div",ai,[t("div",ri,[v[14]||(v[14]=t("span",null,"Top K ",-1)),e(m,null,{title:a(()=>[...v[13]||(v[13]=[C("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),t("div",di,[t("div",_i,[t("div",ci,[e(O,{class:"custom-slider",value:o.top_k,"onUpdate:value":v[1]||(v[1]=E=>o.top_k=E),min:1,max:500},null,8,["value"])]),t("div",ui,[e(T,{value:o.top_k,"onUpdate:value":v[2]||(v[2]=E=>o.top_k=E),min:1,max:500},null,8,["value"])])])])]),o.search_type<=2?(r(),p("div",pi,[t("div",mi,[v[16]||(v[16]=t("span",null,"相似度阈值 ",-1)),e(m,null,{title:a(()=>[...v[15]||(v[15]=[C("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:a(()=>[e(k(K),{class:"question-icon"})]),_:1})]),t("div",vi,[t("div",bi,[t("div",fi,[e(O,{class:"custom-slider",value:o.similarity,"onUpdate:value":v[3]||(v[3]=E=>o.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),t("div",hi,[e(T,{value:o.similarity,"onUpdate:value":v[4]||(v[4]=E=>o.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])])):L("",!0),t("div",yi,[t("div",ki,[v[17]||(v[17]=t("span",null,"Rerank模型",-1)),v[18]||(v[18]=C("   ",-1)),e(R,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":v[5]||(v[5]=E=>o.rerank_status=E),onChange:c},null,8,["checked"])]),o.rerank_status==1?(r(),p("div",gi,[e(Nt,{modelType:"RERANK",modeName:o.rerank_use_model,"onUpdate:modeName":v[6]||(v[6]=E=>o.rerank_use_model=E),modeId:o.rerank_model_config_id,"onUpdate:modeId":v[7]||(v[7]=E=>o.rerank_model_config_id=E),style:{width:"60%"}},null,8,["modeName","modeId"])])):L("",!0)]),t("div",$i,[t("div",xi,[e(m,{title:"元数据过滤是使用元数据属性（例如分组，知识创建时间等）来细化和控制系統内相关信息的检索过程。召回时仅会召回满足要求的知识。"},{default:a(()=>[t("span",null,[v[19]||(v[19]=C("元数据过滤 ",-1)),e(k(K))])]),_:1}),v[20]||(v[20]=C("   ",-1)),e(R,{checkedValue:1,unCheckedValue:0,checked:o.meta_search_switch,"onUpdate:checked":v[8]||(v[8]=E=>o.meta_search_switch=E)},null,8,["checked"])]),o.meta_search_switch==1?(r(),p("div",wi,[e(He,{rule:o.meta_search_condition_list,"onUpdate:rule":v[9]||(v[9]=E=>o.meta_search_condition_list=E),type:o.meta_search_type,"onUpdate:type":v[10]||(v[10]=E=>o.meta_search_type=E),ref_key:"metaFilterRef",ref:s,class:"meta-box","meta-data":x.value},null,8,["rule","type","meta-data"])])):L("",!0)])])])]),_:1},8,["open"])}}},Si=P(qi,[["__scopeId","data-v-b31e732f"]]),Ci={class:"list-box"},Ii=["onClick"],Li={class:"avater-box"},Ui=["src"],Ri={class:"content-box"},Ei={class:"title-block"},Oi={class:"title-text"},Ai={class:"desc-box"},ji={class:"right-icon"},Vi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(M,{expose:_,emit:h}){const l=h,u=M,o=q(!1);rt(()=>u.list,()=>{u.list.length==0&&(o.value=!1)},{});const s=()=>{o.value=!0},g=()=>{document.visibilityState==="visible"&&l("refreshList")};yt(()=>{document.addEventListener("visibilitychange",g)}),ue(()=>{document.removeEventListener("visibilitychange",g)});const y=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return _({show:s}),(x,f)=>{const d=Ee,c=ie,n=Y;return r(),p("div",null,[e(n,{open:o.value,"onUpdate:open":f[0]||(f[0]=b=>o.value=b),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:a(()=>[e(d,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),e(c,{scrollbar:!1,style:{height:"400px"}},{default:a(()=>[t("div",Ci,[(r(!0),p(D,null,X(u.list,b=>(r(),p("div",{class:"list-item",onClick:w=>y(b),key:b.id},[t("div",Li,[t("img",{src:b.avatar,alt:""},null,8,Ui)]),t("div",Ri,[t("div",Ei,[f[1]||(f[1]=t("div",{class:"tag-icon"},"Graph",-1)),t("div",Oi,U(b.library_name),1)]),t("div",Ai,U(b.library_intro),1)]),t("div",ji,[e(k(Oe))])],8,Ii))),128))])]),_:1})]),_:1},8,["open"])])}}},Ni=P(Vi,[["__scopeId","data-v-0ebe0aeb"]]),Mi={class:"actions-box"},zi={key:0,class:"library-list"},Pi=["onClick"],Di={class:"library-avatar"},Bi=["src"],Ti={class:"info-content-box"},Fi={class:"library-title-block"},Ji={class:"title-text"},Qi={class:"desc-info-block"},Ki=["onClick"],Wi={class:"setting-info-block"},Gi={class:"set-item"},Hi={key:0},Zi={key:1},Xi={key:2},Yi={key:3},tl={class:"set-item"},el={key:0,class:"set-item"},ol={class:"set-item"},sl={key:0},nl={key:1},il={__name:"index",setup(M){const _=ge();Z(()=>{var R;return((R=_.companyInfo)==null?void 0:R.neo4j_status)=="true"});const h=q(!1),{robotInfo:l,updateRobotInfo:u}=J("robotInfo"),o=B({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{}}),s=q([]),g=q(null),y=q(null),x=Z(()=>s.value.filter(R=>y.value?o.library_ids.includes(R.id):o.library_ids.includes(R.id)&&R.type!=3)),f=Z(()=>x.value.filter(R=>R.graph_switch==0)),d=R=>{let N=o.library_ids.indexOf(R.id);o.library_ids.splice(N,1),v()},c=R=>{o.library_ids=[...R],v()},n=()=>{g.value.open([...o.library_ids])},b=q(null),w=()=>{b.value.open(G(o),l)},S=q(null),i=R=>{o.rerank_status=R.rerank_status,o.rerank_use_model=R.rerank_use_model,o.rerank_model_config_id=R.rerank_model_config_id,o.top_k=R.top_k,o.similarity=R.similarity,o.search_type=R.search_type,o.meta_search_switch=R.meta_search_switch,o.meta_search_type=R.meta_search_type,o.meta_search_condition_list=R.meta_search_condition_list,o.rrf_weight=R.rrf_weight,(R.search_type==1||R.search_type==4)&&f.value.length>0&&S.value.show(),v()},v=()=>{let R={...G(o)};R.library_ids=R.library_ids.join(","),R.op_type_relation_library=1,R.rrf_weight=JSON.stringify(R.rrf_weight),u({...R})},I=async()=>{const R=await $e({type:"",show_open_docs:1});R&&(s.value=R.data||[])},m=()=>{eo({ability_type:"library_ability_official_account"}).then(R=>{var E;let N=(R==null?void 0:R.data)||{};((E=N==null?void 0:N.user_config)==null?void 0:E.switch_status)==1&&(y.value=N)})};o.rerank_use_model=l.rerank_use_model||void 0,$t(()=>{o.library_ids=l.library_ids.split(","),o.rerank_status=l.rerank_status||0,o.rerank_use_model=l.rerank_use_model||void 0,o.rerank_model_config_id=l.rerank_model_config_id||"",o.top_k=l.top_k,o.similarity=l.similarity,o.search_type=l.search_type,o.meta_search_switch=l.meta_search_switch,o.meta_search_type=l.meta_search_type,o.meta_search_condition_list=l.meta_search_condition_list,o.rrf_weight=l.rrf_weight!=""?JSON.parse(l.rrf_weight):{vector:0,search:0,graph:0}});const O=R=>{window.open(`#/library/details/knowledge-document?id=${R.id}`)},T=Z(()=>ne(o.rerank_model_config_id,o.rerank_use_model,"RERANK"));return yt(()=>{m(),I()}),(R,N)=>{const E=et,ot=xt;return r(),V(H,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:h.value,"onUpdate:isEdit":N[0]||(N[0]=F=>h.value=F),bodyStyle:{padding:0}},{extra:a(()=>[t("div",Mi,[e(ot,{gap:8},{default:a(()=>[e(E,{size:"small",onClick:w},{default:a(()=>[...N[1]||(N[1]=[C("召回设置",-1)])]),_:1}),e(E,{size:"small",onClick:n},{default:a(()=>[...N[2]||(N[2]=[C("关联知识库",-1)])]),_:1})]),_:1})])]),default:a(()=>[x.value.length>0?(r(),p("div",zi,[(r(!0),p(D,null,X(x.value,F=>(r(),p("div",{class:"library-item",key:F.id,onClick:A=>O(F)},[t("div",Di,[t("img",{src:F.avatar,alt:""},null,8,Bi)]),t("div",Ti,[t("div",Fi,[t("div",Ji,U(F.library_name),1)]),t("div",Qi,U(F.library_intro),1)]),F.id!=k(l).default_library_id?(r(),p("div",{key:0,class:"close-btn",onClick:pe(A=>d(F),["stop"])},[e(k(bt))],8,Ki)):L("",!0)],8,Pi))),128))])):L("",!0),t("div",Wi,[t("div",Gi,[N[3]||(N[3]=C(" 检索模式： ",-1)),o.search_type==1?(r(),p("span",Hi,"混合检索")):L("",!0),o.search_type==2?(r(),p("span",Zi,"向量检索")):L("",!0),o.search_type==3?(r(),p("span",Xi,"全文检索")):L("",!0),o.search_type==4?(r(),p("span",Yi,"知识图谱检索")):L("",!0)]),t("div",tl,[N[4]||(N[4]=C(" Top K： ",-1)),t("span",null,U(o.top_k),1)]),o.search_type<=2?(r(),p("div",el,[N[5]||(N[5]=C(" 相似度阈值： ",-1)),t("span",null,U(o.similarity),1)])):L("",!0),t("div",ol,[N[6]||(N[6]=C(" Rerank模型： ",-1)),o.rerank_status==0?(r(),p("span",sl,"关")):(r(),p("span",nl,U(T.value),1))])]),e(Xe,{ref_key:"librarySelectAlertRef",ref:g,onChange:c,showWxType:!!y.value},null,8,["showWxType"]),e(Si,{ref_key:"recallSettingsAlertRef",ref:b,onChange:i},null,512),e(Ni,{list:f.value,onRefreshList:I,ref_key:"noOpenGraphModalRef",ref:S},null,8,["list"])]),_:1},8,["isEdit"])}}},ll=P(il,[["__scopeId","data-v-0d28b5b9"]]),al={class:"library-checkbox-box"},rl={class:"list-box",ref:"scrollContainer"},dl={class:"library-name"},_l={class:"library-desc"},cl={key:0,class:"empty-box"},ul={__name:"library-select-alert",emits:["change"],setup(M,{expose:_,emit:h}){const l=h,u=B({indeterminate:!1,checkAll:!1,checkedList:[]}),o=q(!1),s=n=>{f(),u.checkedList=n,o.value=!0},g=()=>{o.value=!1,x()};q("");const y=q([]),x=()=>{l("change",[...u.checkedList])},f=async()=>{const n=await le();if(n){let b=n.data||[];y.value=b}},d=q(!1),c=()=>{window.open("/#/database/list")};return _({open:s}),(n,b)=>{const w=je,S=Ae,i=Wt,v=Y;return r(),V(v,{width:"746px",open:o.value,"onUpdate:open":b[1]||(b[1]=I=>o.value=I),title:"关联数据表",onOk:g},{default:a(()=>[t("div",al,[e(i,{spinning:d.value,delay:100},{default:a(()=>[e(S,{value:u.checkedList,"onUpdate:value":b[0]||(b[0]=I=>u.checkedList=I),style:{width:"100%"}},{default:a(()=>[t("div",rl,[(r(!0),p(D,null,X(y.value,I=>(r(),p("div",{class:"list-item-wraapper",key:I.id},[e(w,{class:"list-item",value:I.id},{default:a(()=>[t("div",dl,U(I.name),1),t("div",_l,U(I.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!d.value&&!y.value.length?(r(),p("div",cl,[b[3]||(b[3]=t("img",{src:oo,alt:""},null,-1)),t("div",null,[b[2]||(b[2]=C(" 暂无数据表, 请先去添加数据表 ",-1)),t("a",{onClick:c}," 去添加")])])):L("",!0)])]),_:1},8,["open"])}}},pl=P(ul,[["__scopeId","data-v-890ab853"]]),ml={class:"actions-box"},vl={key:0,class:"library-list"},bl=["onClick"],fl={class:"library-name"},hl={class:"library-intro"},yl={__name:"index",setup(M){const _=q(!1),{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),u=B({form_ids:[]}),o=q([]),s=q(null),g=Z(()=>o.value.filter(n=>u.form_ids.includes(n.id))),y=n=>{let b=u.form_ids.indexOf(n.id);u.form_ids.splice(b,1),d()},x=n=>{u.form_ids=[...n],d()},f=()=>{s.value.open([...u.form_ids])},d=()=>{let n={...G(u)};n.form_ids=n.form_ids.join(","),l({...n})};return(async()=>{const n=await le();n&&(o.value=n.data||[])})(),$t(()=>{u.form_ids=h.form_ids.split(",")}),(n,b)=>{const w=st,S=et,i=xt;return r(),V(H,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:_.value,"onUpdate:isEdit":b[0]||(b[0]=v=>_.value=v),bodyStyle:{padding:0}},{tip:a(()=>[e(w,{placement:"top"},{title:a(()=>[...b[1]||(b[1]=[t("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])]),default:a(()=>[e(k(K))]),_:1})]),extra:a(()=>[t("div",ml,[e(i,{gap:8},{default:a(()=>[e(S,{size:"small",onClick:f},{default:a(()=>[...b[2]||(b[2]=[C("关联数据表",-1)])]),_:1})]),_:1})])]),default:a(()=>[g.value.length>0?(r(),p("div",vl,[(r(!0),p(D,null,X(g.value,v=>(r(),p("div",{class:"library-item",key:v.id},[t("span",{class:"close-btn",onClick:I=>y(v)},[e(k(bt))],8,bl),t("div",fl,U(v.name),1),t("div",hl,U(v.description),1)]))),128))])):L("",!0),e(pl,{ref_key:"librarySelectAlertRef",ref:s,onChange:x},null,512)]),_:1},8,["isEdit"])}}},kl=P(yl,[["__scopeId","data-v-077d8df6"]]),gl={class:"form-box"},$l={class:"question-title"},xl={class:"question-options"},wl={class:"question-option"},ql={class:"drag-btn"},Sl={class:"action-box"},Cl={class:"robot-info-box"},Il={class:"robot-welcome-content"},Ll={class:"robot-welcome-question"},Ul={__name:"welcome-words",setup(M){const _=q(!1),h=q(!1),{robotInfo:l,updateRobotInfo:u,scrollBoxToBottom:o}=J("robotInfo"),s=B({welcomes:{content:"",question:[]}}),g=()=>{let c=!1;if(s.welcomes.question.length>0){for(let n=0;n<s.welcomes.question.length;n++)if(!s.welcomes.question[n].content){c=n+1;break}}return c},y=()=>{s.welcomes.question.push({content:"",id:It(8)})},x=c=>{s.welcomes.question.splice(c,1)},f=()=>{if(!s.welcomes.content)return W.error("请输入欢迎语");if(g())return W.error("引导问题内容不能为空");u({...G(s)}),_.value=!1},d=()=>{let c={...l.welcomes},n=[];c.question.forEach(({content:b,id:w})=>{let S={id:w,content:b};S.id||(S.id=It(6)),n.push(S)}),s.welcomes.content=c.content,s.welcomes.question=n};return(c,n)=>{const b=kt,w=ct,S=vt;return r(),V(H,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:_.value,"onUpdate:isEdit":n[4]||(n[4]=i=>_.value=i),onSave:f,onEdit:d},{default:a(()=>[dt(t("div",gl,[t("div",$l,[e(b,{value:s.welcomes.content,"onUpdate:value":n[0]||(n[0]=i=>s.welcomes.content=i),placeholder:"请输入欢迎语"},null,8,["value"])]),t("div",xl,[e(k(Mt),{modelValue:s.welcomes.question,"onUpdate:modelValue":n[1]||(n[1]=i=>s.welcomes.question=i),"item-key":"id",handle:".drag-btn",onStart:n[2]||(n[2]=i=>h.value=!0),onEnd:n[3]||(n[3]=i=>h.value=!1)},{item:a(({element:i,index:v})=>[t("div",wl,[t("span",ql,[e(w,{name:"drag"})]),e(S,{class:"question-option-content",value:i.content,"onUpdate:value":I=>i.content=I,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",Sl,[e(k(bt),{class:"del-btn",onClick:I=>x(v)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:y},[e(k(Rt),{class:"add-btn-icon"}),n[5]||(n[5]=C("添加引导问题 ",-1))])])],512),[[_t,_.value]]),dt(t("div",Cl,[t("div",Il,U(k(l).welcomes.content),1),t("div",Ll,[(r(!0),p(D,null,X(k(l).welcomes.question,(i,v)=>(r(),p("div",{class:"question-item",key:v},U(i.content),1))),128))])],512),[[_t,!_.value]])]),_:1},8,["isEdit"])}}},Rl=P(Ul,[["__scopeId","data-v-9b840ded"]]),El={class:"form-box"},Ol={class:"question-title"},Al={class:"question-options"},jl={class:"question-option"},Vl={class:"drag-btn"},Nl={class:"action-box"},Ml={class:"robot-info-box"},zl={class:"robot-unknown-content"},Pl={class:"robot-unknown-question"},Dl={__name:"unknown-problem-prompt",setup(M){const _=q(!1),h=q(!1),{robotInfo:l,updateRobotInfo:u,scrollBoxToBottom:o}=J("robotInfo"),s=B({unknown_question_prompt:{content:"",question:[]}}),g=()=>{s.unknown_question_prompt.question.push({content:"",id:It(8)}),Kt(()=>{o()})},y=d=>{s.unknown_question_prompt.question.splice(d,1)},x=()=>{u({...G(s)}),_.value=!1},f=()=>{let d={...l.unknown_question_prompt},c=[];d.question&&d.question.forEach(({content:n,id:b})=>{let w={id:b,content:n};w.id||(w.id=It(6)),c.push(w)}),d.content&&(s.unknown_question_prompt.content=d.content),c&&(s.unknown_question_prompt.question=c)};return yt(()=>{}),(d,c)=>{const n=st,b=kt,w=ct,S=vt;return r(),V(H,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:_.value,"onUpdate:isEdit":c[4]||(c[4]=i=>_.value=i),onSave:x,onEdit:f},{tip:a(()=>[e(n,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:a(()=>[...c[5]||(c[5]=[t("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])]),default:a(()=>[e(k(K))]),_:1})]),default:a(()=>[dt(t("div",El,[t("div",Ol,[e(b,{value:s.unknown_question_prompt.content,"onUpdate:value":c[0]||(c[0]=i=>s.unknown_question_prompt.content=i),placeholder:"请输入未知问题提示语"},null,8,["value"])]),t("div",Al,[e(k(Mt),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":c[1]||(c[1]=i=>s.unknown_question_prompt.question=i),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=i=>h.value=!0),onEnd:c[3]||(c[3]=i=>h.value=!1)},{item:a(({element:i,index:v})=>[t("div",jl,[t("span",Vl,[e(w,{name:"drag"})]),e(S,{class:"question-option-content",value:i.content,"onUpdate:value":I=>i.content=I,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",Nl,[e(k(bt),{class:"del-btn",onClick:I=>y(v)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:g},[e(k(Rt),{class:"add-btn-icon"}),c[6]||(c[6]=C("添加引导问题 ",-1))])])],512),[[_t,_.value]]),dt(t("div",Ml,[t("div",zl,U(k(l).unknown_question_prompt.content),1),t("div",Pl,[(r(!0),p(D,null,X(k(l).unknown_question_prompt.question,(i,v)=>(r(),p("div",{class:"question-item",key:v},U(i.content),1))),128))])],512),[[_t,!_.value]])]),_:1},8,["isEdit"])}}},Bl=P(Dl,[["__scopeId","data-v-aca01d0e"]]),Tl={class:"robot-info-box"},Fl={class:"modal-box",ref:"modalBoxRef"},Jl={class:"modal-item-box"},Ql={class:"modal-item"},Kl={class:"modal-item"},Wl={__name:"problem-optimization",setup(M){const _=q(!1);q(!1);const{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),u=q("0"),o=B({optimize_question_use_model:"",optimize_question_model_config_id:""});yt(()=>{u.value=h.optimize_question_model_config_id!=0?"1":"0",o.optimize_question_use_model=h.optimize_question_use_model,o.optimize_question_model_config_id=h.optimize_question_model_config_id});const s=q([]),g=c=>{s.value=c,Kt(()=>{(!o.optimize_question_use_model||!Number(o.optimize_question_model_config_id))&&y()})},y=()=>{if(s.value.length>0){let c=null,n=null;for(let b of s.value)if(b.model_define==="tongyi"){c=b;for(let w of c.children)if(w.name==="qwen-max"){n=w;break}break}c||(c=s.value[0],n=c.children[0]),c&&n&&(o.optimize_question_use_model=n.name,o.optimize_question_model_config_id=n.model_config_id)}},x=()=>{_.value=!1,l({...G(o)})},f=c=>{c!=1&&(o.optimize_question_use_model="",o.optimize_question_model_config_id=0)},d=c=>{l({})};return(c,n)=>{const b=st,w=tt,S=Vt,i=jt,v=kt,I=Y;return r(),V(H,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:a(()=>[...n[7]||(n[7]=[t("span",null,null,-1)])]),default:a(()=>[t("div",Tl,[n[9]||(n[9]=t("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),e(b,null,{title:a(()=>[...n[8]||(n[8]=[t("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])]),default:a(()=>[t("div",{class:"dialog-bg-set",onClick:n[0]||(n[0]=m=>_.value=!0)}," 对话背景设置 ")]),_:1})]),e(w,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(h).enable_question_optimize,"onUpdate:checked":n[1]||(n[1]=m=>k(h).enable_question_optimize=m),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t("div",Fl,[e(I,{getContainer:()=>c.$refs.modalBoxRef,open:_.value,"onUpdate:open":n[6]||(n[6]=m=>_.value=m),width:472,title:"用户问题建议设置",onOk:x},{default:a(()=>[t("div",Jl,[t("div",Ql,[n[12]||(n[12]=t("div",{class:"label"},"模型",-1)),e(i,{value:u.value,"onUpdate:value":n[2]||(n[2]=m=>u.value=m),onChange:f},{default:a(()=>[e(S,{value:"0"},{default:a(()=>[...n[10]||(n[10]=[C("跟随机器人",-1)])]),_:1}),e(S,{value:"1"},{default:a(()=>[...n[11]||(n[11]=[C("指定模型",-1)])]),_:1})]),_:1},8,["value"]),u.value=="1"?(r(),V(Nt,{key:0,modelType:"LLM",modeName:o.optimize_question_use_model,"onUpdate:modeName":n[3]||(n[3]=m=>o.optimize_question_use_model=m),modeId:o.optimize_question_model_config_id,"onUpdate:modeId":n[4]||(n[4]=m=>o.optimize_question_model_config_id=m),style:{width:"100%","margin-top":"8px"},onLoaded:g},null,8,["modeName","modeId"])):L("",!0)]),t("div",Kl,[n[13]||(n[13]=t("div",{class:"label"},"对话背景",-1)),e(v,{style:{height:"120px"},value:k(h).optimize_question_dialogue_background,"onUpdate:value":n[5]||(n[5]=m=>k(h).optimize_question_dialogue_background=m),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Gl=P(Wl,[["__scopeId","data-v-13ab9369"]]),Hl={class:"robot-info-box"},Zl={class:"robot-prompt"},Xl={__name:"suggested-issues",setup(M){q(!1);const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=u=>{h({})};return(u,o)=>{const s=wt,g=tt;return r(),V(H,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:a(()=>[...o[2]||(o[2]=[t("span",null,null,-1)])]),default:a(()=>[t("div",Hl,[t("div",Zl,[o[3]||(o[3]=C(" 开启后，机器人回答问题后，自动根据对话内容提供 ",-1)),e(s,{value:k(_).question_guide_num,"onUpdate:value":o[0]||(o[0]=y=>k(_).question_guide_num=y),style:{width:"80px"},precision:0,min:1,max:10,onBlur:l},null,8,["value"]),o[4]||(o[4]=C(" 条用户提问建议，最大不超过10条。 ",-1))])]),e(g,{onChange:l,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(_).enable_question_guide,"onUpdate:checked":o[1]||(o[1]=y=>k(_).enable_question_guide=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Yl=P(Xl,[["__scopeId","data-v-bec632a5"]]),ta={__name:"sensitive-words",setup(M){q(!1);const{robotInfo:_,updateRobotInfo:h}=J("robotInfo");B({prompt:""});const l=()=>{window.open("/#/user/sensitive-words")},u=o=>{h({})};return(o,s)=>{const g=tt;return r(),V(H,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:a(()=>[...s[1]||(s[1]=[t("span",null,null,-1)])]),default:a(()=>[t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},[s[2]||(s[2]=C(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，",-1)),t("span",{onClick:l,style:{cursor:"pointer"}},"设置敏词 >")])]),e(g,{onChange:u,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(_).sensitive_words_switch,"onUpdate:checked":s[0]||(s[0]=y=>k(_).sensitive_words_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ea=P(ta,[["__scopeId","data-v-f1e5ad50"]]),oa={class:"direct-title"},sa={class:"direct-desc"},na={class:"qa"},ia={class:"prompt-form-item-label"},la={class:"direct-switch"},aa={class:"similarity"},ra={class:"number-input-box"},da={__name:"chat-edit-alert",emits:["save"],setup(M,{expose:_,emit:h}){const l=h,u=q(1),o=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],s=B(o()),g=q(!1),y=B({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{y.chat_type=u.value.toString(),s.forEach(c=>{c.chat_type==u.value&&(y.chat_type=="3"?(y.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch==1?"true":"false",y.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score.toString()):y.chat_type=="1"&&(y.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch==1?"true":"false",y.library_qa_direct_reply_score=c.library_qa_direct_reply_score.toString()))}),f(),Object.assign(s,o()),g.value=!1},f=()=>{l("save",G(y))};yt(()=>{});const d=c=>{u.value=parseInt(c.chat_type),y.chat_type=c.chat_type,y.library_qa_direct_reply_score=c.library_qa_direct_reply_score,y.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch,y.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,y.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch,s.forEach(n=>{n.chat_type=="3"?(n.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch=="true"?1:0):n.chat_type=="1"&&(n.library_qa_direct_reply_score=c.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch=="true"?1:0)}),g.value=!0};return rt(()=>g.value,c=>{c===!1&&Object.assign(s,o())},{immediate:!0}),_({open:d}),(c,n)=>{const b=st,w=tt,S=wt,i=Vt,v=jt,I=Y;return r(),V(I,{width:"746px",open:g.value,"onUpdate:open":n[1]||(n[1]=m=>g.value=m),title:"聊天模式设置",onOk:x},{default:a(()=>[e(v,{class:"direct-box",value:u.value,"onUpdate:value":n[0]||(n[0]=m=>u.value=m)},{default:a(()=>[(r(!0),p(D,null,X(s,m=>(r(),V(i,{class:Ut(["direct-item",{active:u.value==m.direct_id}]),value:m.direct_id,key:m.direct_id},{default:a(()=>[t("div",oa,U(m.direct_title),1),t("div",sa,U(m.direct_desc),1),dt(t("div",na,[t("div",ia,[n[4]||(n[4]=t("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),e(b,null,me({default:a(()=>[e(k(K),{class:"question-icon"})]),_:2},[m.chat_type=="1"?{name:"title",fn:a(()=>[n[2]||(n[2]=C("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"0"}:m.chat_type=="3"?{name:"title",fn:a(()=>[n[3]||(n[3]=C("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"1"}:void 0]),1024),t("div",la,[m.chat_type=="1"?(r(),V(w,{key:0,checkedValue:1,unCheckedValue:0,checked:m.library_qa_direct_reply_switch,"onUpdate:checked":O=>m.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):m.chat_type=="3"?(r(),V(w,{key:1,checkedValue:1,unCheckedValue:0,checked:m.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>m.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):L("",!0)])])],512),[[_t,m.isQaDirectReply&&u.value==m.direct_id]]),dt(t("div",aa,[n[5]||(n[5]=t("span",null,"相似度超过",-1)),t("div",ra,[m.chat_type=="1"?(r(),V(S,{key:0,value:m.library_qa_direct_reply_score,"onUpdate:value":O=>m.library_qa_direct_reply_score=O,disabled:!m.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):m.chat_type=="3"?(r(),V(S,{key:1,value:m.mixture_qa_direct_reply_score,"onUpdate:value":O=>m.mixture_qa_direct_reply_score=O,disabled:!m.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):L("",!0)]),n[6]||(n[6]=t("span",null,"时直接回复答案",-1))],512),[[_t,m.isQaDirectReply&&u.value==m.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},_a=P(da,[["__scopeId","data-v-96e9d8b8"]]),ca={class:"actions-box"},ua={class:"setting-info-block"},pa={class:"set-item"},ma={key:0},va={key:1},ba={key:2},fa={class:"set-item"},ha={key:0,class:"set-item"},ya={class:"set-item"},ka={key:0,class:"set-item"},ga={class:"form-box"},$a={__name:"index",setup(M){const _=q(!1),h=q(null),{robotInfo:l,updateRobotInfo:u}=J("robotInfo"),o=B({chat_type:l.chat_type,library_qa_direct_reply_score:l.library_qa_direct_reply_score,library_qa_direct_reply_switch:l.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:l.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:l.mixture_qa_direct_reply_switch}),s=x=>{o.chat_type=x.chat_type,o.library_qa_direct_reply_score=x.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,g()},g=()=>{u({...G(o)}),_.value=!1},y=()=>{h.value.open(G(o)),_.value=!0};return(x,f)=>{const d=st,c=et;return r(),V(H,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:_.value,"onUpdate:isEdit":f[1]||(f[1]=n=>_.value=n),bodyStyle:{padding:0}},{tip:a(()=>[e(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:a(()=>[...f[2]||(f[2]=[t("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),t("br",null,null,-1),t("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])]),default:a(()=>[e(k(K))]),_:1})]),extra:a(()=>[t("div",ca,[e(c,{size:"small",onClick:f[0]||(f[0]=n=>y(!0))},{default:a(()=>[...f[3]||(f[3]=[C("修改",-1)])]),_:1})])]),default:a(()=>[t("div",ua,[t("div",pa,[f[4]||(f[4]=C(" 聊天模式： ",-1)),k(l).chat_type=="1"?(r(),p("span",ma,"仅知识库")):L("",!0),k(l).chat_type=="2"?(r(),p("span",va,"直连模式")):L("",!0),k(l).chat_type=="3"?(r(),p("span",ba,"混合模式")):L("",!0)]),k(l).chat_type=="1"?(r(),p(D,{key:0},[t("div",fa,[f[5]||(f[5]=C(" 命中问答知识时直接回复答案： ",-1)),t("span",null,U(k(l).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(l).library_qa_direct_reply_switch=="true"?(r(),p("div",ha,[f[6]||(f[6]=C(" 相似度阈值： ",-1)),t("span",null,U(k(l).library_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0),k(l).chat_type=="3"?(r(),p(D,{key:1},[t("div",ya,[f[7]||(f[7]=C(" 命中问答知识时直接回复答案： ",-1)),t("span",null,U(k(l).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(l).mixture_qa_direct_reply_switch=="true"?(r(),p("div",ka,[f[8]||(f[8]=C(" 相似度阈值： ",-1)),t("span",null,U(k(l).mixture_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0)]),t("div",ga,[e(_a,{ref_key:"ChatEditAlertRef",ref:h,onSave:s},null,512)])]),_:1},8,["isEdit"])}}},xa=P($a,[["__scopeId","data-v-ed6b923e"]]),wa={class:"switch-box"},qa={class:"switch-box-body"},Sa={class:"switch-box-header"},Ca={class:"left-box"},Ia={class:"switch-box-title"},La={key:0,class:"title-tip"},Ua={class:"right-box"},Ra={class:"extra-box"},Ea={class:"switch-desc"},Oa={class:"switch-box-right"},Aa={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(M,{emit:_}){const h=_,l=M,u=q(l.value),o=s=>{h("update:value",s),h("change",s)};return(s,g)=>{const y=ct,x=tt;return r(),p("div",wa,[t("div",qa,[t("div",Sa,[t("div",Ca,[e(y,{class:"switch-box-icon",name:l.iconName},null,8,["name"]),t("span",Ia,U(l.title),1),s.$slots.tip?(r(),p("span",La,[mt(s.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",Ua,[t("div",Ra,[mt(s.$slots,"extra",{},()=>[g[1]||(g[1]=t("div",{class:"extra-box"},null,-1))],!0)])])]),t("div",Ea,[mt(s.$slots,"default",{},void 0,!0)])]),t("div",Oa,[e(x,{checked:u.value,"onUpdate:checked":g[0]||(g[0]=f=>u.value=f),onChange:o,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},ja=P(Aa,[["__scopeId","data-v-0548f52d"]]),Va="/assets/img/phone-head-CDwwPhYa.png",Na="/assets/img/phone-body-CbEf8GZP.png",Ma="/assets/img/phone-footer-ClQtNpln.png",za={class:"common-problem-box"},Pa={class:"left-content-box"},Da={key:0,class:"empty-box"},Ba={key:1,class:"lists-box"},Ta={class:"drag-btn"},Fa={class:"title"},Ja={class:"opration-box"},Qa={class:"preview-box"},Ka={class:"phone-body"},Wa={key:0,class:"question-box"},Ga={__name:"common-problem",setup(M){q(!1);const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=Z(()=>_.common_question_list?JSON.parse(_.common_question_list):[]),u=q([]);u.value=l.value,rt(l,()=>{u.value=l.value});const o=At.useForm,s=q(!1),g=q("添加问题"),y=B({question:"",index:-1}),x=B({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:f,validate:d,validateInfos:c}=o(y,x),n=()=>{if(l.value.length>=10)return W.error("最多设置10条常用问题");s.value=!0,f(),y.question="",y.index=-1},b=(I,m)=>{s.value=!0,f(),y.question=I,y.index=m},w=I=>{let m=[];m=l.value.filter((O,T)=>I!=T),Y.confirm({title:"提醒",icon:e(Lt),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){h({common_question_list:JSON.stringify(m)})},onCancel(){}})},S=()=>{d().then(()=>{let I=[];y.index>=0?I=l.value.map((m,O)=>O===y.index?y.question:m):I=[y.question,...l.value],h({common_question_list:JSON.stringify(I)}),s.value=!1})},i=I=>{h({})},v=I=>{h({common_question_list:JSON.stringify(u.value)})};return(I,m)=>{const O=st,T=tt,R=Ve,N=et,E=ct,ot=vt,F=Gt,A=At,ut=Y;return r(),p("div",za,[t("div",Pa,[e(H,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:a(()=>[e(O,null,{title:a(()=>[...m[4]||(m[4]=[C("最多10条。开启后，常见问题会显示在每条问答后面",-1)])]),default:a(()=>[e(k(K),{class:"quess-icon"})]),_:1})]),extra:a(()=>[e(T,{onChange:i,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(_).enable_common_question,"onUpdate:checked":m[0]||(m[0]=Q=>k(_).enable_common_question=Q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e(R,{type:"vertical"}),e(N,{type:"primary",size:"small",onClick:n},{default:a(()=>[...m[5]||(m[5]=[C("添加",-1)])]),_:1})]),default:a(()=>[l.value.length==0?(r(),p("div",Da,[m[7]||(m[7]=t("img",{src:so,alt:""},null,-1)),m[8]||(m[8]=t("div",{class:"title"},"暂无数据",-1)),m[9]||(m[9]=t("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),e(N,{onClick:n,type:"primary"},{default:a(()=>[...m[6]||(m[6]=[C("立即添加",-1)])]),_:1})])):(r(),p("div",Ba,[e(k(Mt),{modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=Q=>u.value=Q),handle:".drag-btn","item-key":"index",onEnd:v},{item:a(({element:Q,index:ft})=>[(r(),p("div",{class:"list-item",key:ft},[t("span",Ta,[e(E,{name:"drag"})]),t("div",Fa,U(Q),1),t("div",Ja,[e(k(oe),{onClick:Et=>b(Q,ft)},null,8,["onClick"]),e(k(bt),{onClick:Et=>w(ft)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),t("div",Qa,[m[12]||(m[12]=t("div",{class:"phone-head"},[t("img",{class:"head-img",src:Va,alt:""})],-1)),t("div",Ka,[m[11]||(m[11]=t("div",null,[t("img",{class:"body-img",src:Na,alt:""})],-1)),l.value.length&&k(_).enable_common_question=="true"?(r(),p("div",Wa,[m[10]||(m[10]=t("div",{class:"name"},"常见问题",-1)),(r(!0),p(D,null,X(l.value,Q=>(r(),p("div",{class:"list-item",key:Q},U(Q),1))),128))])):L("",!0)]),m[13]||(m[13]=t("div",{class:"phone-footer"},[t("img",{class:"footer-img",src:Ma,alt:""})],-1))]),e(ut,{open:s.value,"onUpdate:open":m[3]||(m[3]=Q=>s.value=Q),title:g.value,onOk:S,width:"476px"},{default:a(()=>[e(A,{class:"form-box",layout:"vertical"},{default:a(()=>[e(F,Qt({label:"问题名称"},k(c).question),{default:a(()=>[e(ot,{maxLength:100,value:y.question,"onUpdate:value":m[2]||(m[2]=Q=>y.question=Q),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ha=P(Ga,[["__scopeId","data-v-dce83f0d"]]),Za={__name:"display-aitations",setup(M){const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=q(!1);rt(()=>_.answer_source_switch,o=>{l.value=o=="true"},{immediate:!0});const u=()=>{h({answer_source_switch:l.value?"true":"false"})};return(o,s)=>(r(),V(ja,{title:"显示引文","icon-name":"jibenpeizhi",value:l.value,"onUpdate:value":s[0]||(s[0]=g=>l.value=g),onChange:u},{extra:a(()=>[...s[1]||(s[1]=[t("span",null,null,-1)])]),default:a(()=>[s[2]||(s[2]=t("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1},8,["value"]))}},Xa={__name:"show-like",setup(M){const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=u=>{h({})};return(u,o)=>{const s=tt;return r(),V(H,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:a(()=>[...o[1]||(o[1]=[t("span",null,null,-1)])]),default:a(()=>[o[2]||(o[2]=t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),e(s,{onChange:l,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(_).feedback_switch,"onUpdate:checked":o[0]||(o[0]=g=>k(_).feedback_switch=g),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ya=P(Xa,[["__scopeId","data-v-73894b10"]]),tr={class:"content-box"},er={key:0,class:"add-btn-block"},or={class:"list-content"},sr={key:0,class:"user-block"},nr={class:"name-box"},ir={class:"name"},lr={class:"remark-text"},ar={key:0,class:"hover-btn-box"},rr={key:0},dr={key:1},_r={key:2},cr={key:1,class:"hover-btn-box"},ur={class:"role-menu-box"},pr=["onClick"],mr={class:"menu-header"},vr={key:0,class:"check-box"},br=["onClick"],fr={class:"menu-header"},hr={key:0,class:"check-box"},yr=["onClick"],kr={class:"menu-header"},gr={key:0,class:"check-box"},$r={class:"hover-btn-box"},xr={key:0},wr={key:1},qr={key:2},Sr=["onClick"],Cr={__name:"role-permission",setup(M){const _=xe(),h=Z(()=>_.user_name),l=Ft().query,u=q(we(l.id)),o=q([]),s=B({object_id:l.id,object_type:1}),g=()=>{no({...s}).then(n=>{let b=n.data||[];o.value=b})};g();const y=q(null),x=()=>{y.value.show(o.value,[{object_id:+l.id,object_type:1,operate_rights:4}])},f=(n,b)=>{let w=b==4?"管理":b==2?"编辑":"查看";Y.confirm({title:"提示?",icon:e(Lt),content:"确认修改该协作者权限为【"+w+"】",okText:"确认",cancelText:"取消",onOk:()=>{let S=[{object_id:+n.object_id,object_type:+n.object_type,operate_rights:+b}];io({identity_ids:n.identity_id,identity_type:n.identity_type,object_array:JSON.stringify(S)}).then(i=>{W.success("修改成功"),g()})},onCancel(){}})},d=n=>{Y.confirm({title:"提示?",icon:e(Lt),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{lo({identity_id:n.identity_id,identity_type:n.identity_type,object_id:n.object_id,object_type:n.object_type}).then(b=>{W.success("删除成功"),g()})},onCancel(){}})},c=q([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(n,b)=>{const w=et,S=Ne,i=Me,v=Pe,I=ie;return r(),V(I,null,{default:a(()=>[t("div",tr,[u.value==4?(r(),p("div",er,[e(w,{type:"primary",onClick:x,icon:Jt(k(Rt))},{default:a(()=>[...b[0]||(b[0]=[C("添加协助者",-1)])]),_:1},8,["icon"])])):L("",!0),t("div",or,[e(v,{columns:c.value,"data-source":o.value,pagination:!1},{bodyCell:a(({column:m,record:O})=>[m.key==="name"?(r(),p("div",sr,[e(S,{shape:"square",src:O.avatar,size:40},{icon:a(()=>[O.avatar?L("",!0):(r(),V(k(Bt),{key:0}))]),_:2},1032,["src"]),t("div",nr,[t("div",ir,U(O.user_name),1),t("div",lr,U(O.name),1)])])):L("",!0),m.key==="operate_rights"?(r(),p(D,{key:1},[u.value==2||O.user_name==h.value?(r(),p("div",ar,[O.operate_rights==4?(r(),p("span",rr,"管理")):L("",!0),O.operate_rights==2?(r(),p("span",dr,"编辑")):L("",!0),O.operate_rights==1?(r(),p("span",_r,"查看")):L("",!0)])):O.role_type==1||O.is_creator==1?(r(),p("div",cr,"管理")):(r(),V(i,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:a(()=>[t("div",ur,[t("div",{class:"role-menu",onClick:T=>f(O,4)},[t("div",mr,[e(k(Bt)),b[1]||(b[1]=t("span",{class:"title"},"管理",-1))]),b[2]||(b[2]=t("div",{class:"desc"},"可编辑，可删除，可查看",-1)),O.operate_rights==4?(r(),p("div",vr,[e(k(Ot))])):L("",!0)],8,pr),t("div",{class:"role-menu",onClick:T=>f(O,2)},[t("div",fr,[e(k(oe)),b[3]||(b[3]=t("span",{class:"title"},"编辑",-1))]),b[4]||(b[4]=t("div",{class:"desc"},"可编辑，可查看",-1)),O.operate_rights==2?(r(),p("div",hr,[e(k(Ot))])):L("",!0)],8,br),t("div",{class:"role-menu",onClick:T=>f(O,1)},[t("div",kr,[e(k(ze)),b[5]||(b[5]=t("span",{class:"title"},"查看",-1))]),b[6]||(b[6]=t("div",{class:"desc"},"仅查看",-1)),O.operate_rights==1?(r(),p("div",gr,[e(k(Ot))])):L("",!0)],8,yr)])]),default:a(()=>[t("div",$r,[O.operate_rights==4?(r(),p("span",xr,"管理")):L("",!0),O.operate_rights==2?(r(),p("span",wr,"编辑")):L("",!0),O.operate_rights==1?(r(),p("span",qr,"查看")):L("",!0),e(k(te))])]),_:2},1024))],64)):L("",!0),m.key==="action"?(r(),p(D,{key:2},[u.value==4&&O.user_name!=h.value?(r(),p(D,{key:0},[O.role_type!=1&&O.is_creator!=1?(r(),p("a",{key:0,onClick:T=>d(O)},"移除",8,Sr)):L("",!0)],64)):L("",!0)],64)):L("",!0)]),_:1},8,["columns","data-source"])])]),e(ao,{onOk:g,ref_key:"addCollaboratorRef",ref:y},null,512)]),_:1})}}},Ir=P(Cr,[["__scopeId","data-v-64f2a2fa"]]),Lr={class:"actions-box"},Ur={key:0,class:"library-list"},Rr=["onClick"],Er={class:"library-name"},Or={class:"library-intro"},Ar={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(M){const _=q(!1),{robotInfo:h,getRobot:l}=J("robotInfo"),u=M,o=B({work_flow_ids:[]}),s=q(null),g=Z(()=>u.robotList.filter(c=>o.work_flow_ids.includes(c.id))),y=c=>{let n=o.work_flow_ids.indexOf(c.id);o.work_flow_ids.splice(n,1),d()},x=c=>{o.work_flow_ids=[...c],d()},f=()=>{s.value.open([...o.work_flow_ids])},d=()=>{let c={...G(o)};c.work_flow_ids=c.work_flow_ids.join(","),Fe({id:h.id,...c}).then(n=>{W.success("保存成功"),l(h.id)})};return $t(()=>{o.work_flow_ids=h.work_flow_ids.split(",")}),(c,n)=>{const b=st,w=et,S=xt;return r(),V(H,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:_.value,"onUpdate:isEdit":n[0]||(n[0]=i=>_.value=i),bodyStyle:{padding:0}},{tip:a(()=>[e(b,{placement:"top"},{title:a(()=>[...n[1]||(n[1]=[t("span",null,"支持关联工作流",-1)])]),default:a(()=>[e(k(K))]),_:1})]),extra:a(()=>[t("div",Lr,[e(S,{gap:8},{default:a(()=>[e(w,{size:"small",onClick:f},{default:a(()=>[...n[2]||(n[2]=[C("添加技能",-1)])]),_:1})]),_:1})])]),default:a(()=>[g.value.length>0?(r(),p("div",Ur,[(r(!0),p(D,null,X(g.value,i=>(r(),p("div",{class:"library-item",key:i.id},[t("span",{class:"close-btn",onClick:v=>y(i)},[e(k(bt))],8,Rr),t("div",Er,U(i.robot_name),1),t("div",Or,U(i.robot_intro),1)]))),128))])):L("",!0),e(ro,{ref_key:"robotSelectAlertRef",ref:s,onChange:x},null,512)]),_:1},8,["isEdit"])}}},jr=P(Ar,[["__scopeId","data-v-e0ced8ed"]]),Vr={class:"robot-info-box"},Nr={class:"set-block"},Mr={class:"switch-item"},zr={__name:"chat-cache",setup(M){const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=B({valid_time:"",cache_switch:0}),u=B({unix:"h",hValue:24,mValue:1440}),o=()=>{u.unix==="h"?l.valid_time=u.hValue*3600:l.valid_time=u.mValue*60,h({cache_config:{...l}})},s=()=>{o()},g=()=>{u.unix=="h"?u.hValue=parseInt(u.mValue/60):u.mValue=parseInt(u.hValue*60)},y=()=>{Y.confirm({title:"确定清空缓存?",icon:e(Lt),content:"确定操作清空缓存吗？",onOk(){Je({id:_.id,robot_key:_.robot_key}).then(x=>{W.success("清空成功")})}})};return rt(()=>_.cache_config,()=>{let x=_.cache_config||{};x=JSON.parse(JSON.stringify(x)),l.cache_switch=x.cache_switch,l.valid_time=x.valid_time,x.valid_time%3600==0?(u.unix="h",u.hValue=x.valid_time/3600):(u.unix="m",u.mValue=parseInt(x.valid_time/60)||1440)},{immediate:!0,deep:!0}),$t(()=>{}),(x,f)=>{const d=wt,c=Zt,n=Ht,b=De,w=et,S=tt;return r(),V(H,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:a(()=>[...f[4]||(f[4]=[t("span",null,null,-1)])]),default:a(()=>[t("div",Vr,[f[7]||(f[7]=C(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ",-1)),t("div",Nr,[e(b,{compact:""},{default:a(()=>[u.unix=="h"?(r(),V(d,{key:0,onBlur:o,precision:0,value:u.hValue,"onUpdate:value":f[0]||(f[0]=i=>u.hValue=i),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(r(),V(d,{key:1,onBlur:o,precision:0,value:u.mValue,"onUpdate:value":f[1]||(f[1]=i=>u.mValue=i),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),e(n,{value:u.unix,"onUpdate:value":f[2]||(f[2]=i=>u.unix=i),style:{width:"70px"},onChange:g},{default:a(()=>[e(c,{value:"h"},{default:a(()=>[...f[5]||(f[5]=[C("小时",-1)])]),_:1}),e(c,{value:"m"},{default:a(()=>[...f[6]||(f[6]=[C("分钟",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])]),t("div",Mr,[e(w,{onClick:y,size:"small"},{default:a(()=>[...f[8]||(f[8]=[C("清空缓存",-1)])]),_:1}),e(S,{onChange:s,checkedValue:1,unCheckedValue:0,checked:l.cache_switch,"onUpdate:checked":f[3]||(f[3]=i=>l.cache_switch=i),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])]),_:1})}}},Pr=P(zr,[["__scopeId","data-v-e779aa9b"]]),Dr={class:"robot-info-box"},Br={class:"robot-prompt"},Tr={__name:"answer-prompt",setup(M){q(!1);const{robotInfo:_,updateRobotInfo:h}=J("robotInfo"),l=o=>{h({})},u=()=>{_.tips_before_answer_content,_.tips_before_answer_content==""&&(_.tips_before_answer_content="思考中、请稍等"),l()};return(o,s)=>{const g=vt,y=tt;return r(),V(H,{class:"setting-box",title:"答案生成中提示语","icon-name":"suggested-issues"},{extra:a(()=>[...s[2]||(s[2]=[t("span",null,null,-1)])]),default:a(()=>[t("div",Dr,[t("div",Br,[s[3]||(s[3]=C(" 开启后，WebAPP、嵌入网站对外服务中，答案生成前会显示提示语 ",-1)),e(g,{value:k(_).tips_before_answer_content,"onUpdate:value":s[0]||(s[0]=x=>k(_).tips_before_answer_content=x),style:{width:"280px"},maxLength:10,placeholder:"请输入",onBlur:u},null,8,["value"])])]),e(y,{onChange:l,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(_).tips_before_answer_switch,"onUpdate:checked":s[1]||(s[1]=x=>k(_).tips_before_answer_switch=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Fr=P(Tr,[["__scopeId","data-v-a03407ec"]]),Jr={key:0,class:"robot-config-page"},Qr={class:"setting-box"},Kr={class:"setting-box"},Wr={class:"setting-box"},Gr={class:"setting-box"},Hr={class:"setting-box"},Zr={class:"setting-box"},Xr={class:"setting-box"},Yr={class:"setting-box"},td={class:"setting-box"},ed={class:"setting-box"},od={class:"setting-box"},sd={class:"setting-box"},nd={class:"setting-box"},id={class:"setting-box"},ld={class:"setting-box"},ad={class:"setting-box"},rd={key:1,class:"robot-config-page"},dd={key:2,class:"robot-config-page"},Tt="/robot/config/basic-config/activeKey",_d={__name:"index",setup(M){const _=se(),h=q(null),{robotInfo:l}=ve(_),{getRobot:u}=_,o=Ze(),s=()=>{h.value.scrollTop=h.value.scrollHeight},g=q(+localStorage.getItem(Tt)||1),y=q(!1),x=B(l.value),f=w=>{let S=JSON.parse(JSON.stringify(w));w.robot_avatar&&(S.robot_avatar=new File([w.robot_avatar],w.robot_avatar.name)),!S.op_type_relation_library&&x.op_type_relation_library&&delete x.op_type_relation_library,Object.assign(x,S),n()},d=q([]),c=()=>{Qe({application_type:1}).then(w=>{d.value=w.data||[]})};be("robotInfo",{robotInfo:x,updateRobotInfo:f,scrollBoxToBottom:s,getRobot:u});const n=()=>{let w;x.robot_avatar&&(w=new File([x.robot_avatar],x.robot_avatar.name));let S=JSON.parse(JSON.stringify(G(x)));w&&(S.robot_avatar=w);let i=S.welcomes;i.question=i.question.map(I=>I.content),S.welcomes=JSON.stringify(i),S.prompt_struct=JSON.stringify(S.prompt_struct);let v=S.unknown_question_prompt;v.question=v.question.map(I=>I.content),S.unknown_question_prompt=JSON.stringify(v),S.cache_config=JSON.stringify(S.cache_config),delete S.robot_avatar_url,y.value=!0,Ke(S).then(I=>{if(I.res!=0)return W.error(I.msg);y.value=!1,W.success("保存成功"),u(x.id)}).catch(()=>{y.value=!1})},b=()=>{localStorage.setItem(Tt,g.value)};return yt(()=>{c(),o.getAllmodelList()}),(w,S)=>{const i=Xt,v=Yt;return r(),p(D,null,[e(v,{class:"tab-wrapper",onChange:b,activeKey:g.value,"onUpdate:activeKey":S[0]||(S[0]=I=>g.value=I)},{default:a(()=>[(r(),V(i,{key:1,tab:"基础配置"})),L("",!0),(r(),V(i,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),g.value==1?(r(),p("div",Jr,[t("div",{class:"scroll-box",ref_key:"scrollBox",ref:h},[t("div",Qr,[e(Oo)]),t("div",Kr,[e(ll)]),t("div",Wr,[e(Gn)]),t("div",Gr,[e(xa)]),t("div",Hr,[e(Pr)]),t("div",Zr,[e(un,{robotList:d.value},null,8,["robotList"])]),t("div",Xr,[e(jr,{robotList:d.value},null,8,["robotList"])]),t("div",Yr,[e(kl)]),t("div",td,[e(Rl)]),t("div",ed,[e(Bl)]),t("div",od,[e(ea)]),t("div",sd,[e(Gl)]),t("div",nd,[e(Yl)]),t("div",id,[e(Za)]),t("div",ld,[e(Fr)]),t("div",ad,[e(Ya)])],512)])):L("",!0),g.value==2?(r(),p("div",rd,[e(Ha)])):L("",!0),g.value==3?(r(),p("div",dd,[e(Ir)])):L("",!0)],64)}}},Md=P(_d,[["__scopeId","data-v-ada7aac7"]]);export{Md as default};
