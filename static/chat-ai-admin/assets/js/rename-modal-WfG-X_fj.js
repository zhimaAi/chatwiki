import{d as te}from"./utils-CvB22N-W.js";import{u as R,b1 as se,b2 as le,b3 as ne,b4 as oe,b5 as ie,aO as _e}from"../../index-DSFcP5NQ.js";import{_ as j}from"./emoji-mart-BBMRoEa3.js";import{N as ce,ab as q,b8 as E,q as ue,a3 as de,G as pe,I as G,a1 as re,B as ve,u as me,aa as he,ao as fe,M as V,b}from"./ui-antd-Dl1wwwCD.js";import{r as x,e as m,b as o,t as v,p as i,a as d,F as M,l as J,y as _,u as l,v as u,q as P,_ as U}from"./vue-chunks-BdaA73Wf.js";const be={class:"title"},ye={class:"desc"},ke={class:"_main"},ge={key:0,class:"meta-card edit-box"},Ce={class:"left"},we=["onClick"],xe={class:"meta-name"},Me={class:"meta-type"},Ue={class:"mt16"},Ie={key:0,class:"meta-card"},Oe={key:0,class:"meta-edit-item"},Ne={class:"action-box"},Se={key:1,class:"meta-item"},$e={class:"left"},De=["onClick"],Le={class:"meta-name"},Be={class:"meta-type"},qe={class:"right"},Ee={class:"meta-card"},Je={class:"meta-tit"},Ve={class:"left"},Fe=["onClick"],Ye={class:"meta-name"},Ae={class:"meta-type"},Te={__name:"metadata-manage-modal",props:{libraryId:{type:[String,Number]},fileId:{type:[String,Number]},qaIds:{type:Array,default:()=>[]}},emits:["change"],setup(F,{expose:D,emit:L}){const{t:a}=R("views.library.library-details.components.metadata-manage-modal"),S=L,p=F,y=[{value:1,label:a("label_list_show")},{value:0,label:a("label_list_hide")}],$=[{value:0,label:a("label_type_string")},{value:1,label:a("label_type_time")},{value:2,label:a("label_type_number")}],I={0:a("label_type_string"),1:a("label_type_time"),2:a("label_type_number")},g=x(!1),k=x(!1),h=x(!1),r=x([]),O=x([]);function N(t=!1,s=null){Array.isArray(s)?Y(s):Q(),h.value=t,g.value=!0}function Q(){se({library_id:p.libraryId}).then(t=>{Y((t==null?void 0:t.data)||[])})}function Y(t){r.value=[],O.value=[];for(let s of t)s.is_builtin==1?O.value.push(s):(s.backup=JSON.parse(JSON.stringify(s)),s.type==1&&s.value>0&&(s.value=te(s.value*1e3)),s.is_edit=!1,s.checked=!1,r.value.push(s))}function z(){r.value.unshift({id:"",is_edit:!0,is_builtin:0,is_show:0,name:"",type:0,library_id:p.libraryId,backup:{}})}function K(t,s){V.confirm({title:a("title_tip"),content:a("msg_confirm_delete"),okText:a("btn_delete"),cancelText:a("btn_cancel"),onOk:()=>{ne({id:t.id}).then(()=>{r.value.splice(s,1),b.success(a("msg_deleted"))})}})}function W(t,s){if(!t.id)r.value.splice(s,1);else{const{name:c,type:f,is_show:C}=t.backup;t.name=c,t.type=f,t.is_show=C,t.is_edit=!1}}function B(t){t.is_show=t.is_show==1?0:1,A(t)}function A(t){if(!t.name)return b.warning(a("msg_please_enter_metadata_name"));le({...t,is_show:Number(t.is_show),library_id:p.libraryId}).then(s=>{const{name:c,type:f,is_show:C}=t;t.id=s==null?void 0:s.data,t.is_edit=!1,t.backup={name:c,type:f,is_show:C},b.success(a("msg_saved")),S("change")})}function X(){if(!r.value.length)return b.error(a("msg_no_available_metadata"));let t=[];for(let c of r.value){if(!c.checked)continue;let f=c.value;c.type==1&&(c.value?f=c.value.startOf("minute").unix():f=""),t.push({key:c.key,value:f})}if(!t.length)return b.error(a("msg_please_select_data"));let s;if(p.qaIds.length)s=oe({ids:p.qaIds.toString(),list:JSON.stringify(t)});else if(p.fileId)s=ie({file_id:p.fileId,list:JSON.stringify(t)});else return b.error(a("msg_missing_library_info"));s.then(()=>{b.success(a("msg_saved")),S("change"),g.value=!1})}return D({show:N}),(t,s)=>{const c=ve,f=ce,C=ue,Z=de,ee=pe,T=G,H=me,ae=V;return o(),m(ae,{open:g.value,"onUpdate:open":s[1]||(s[1]=e=>g.value=e),width:"746px","confirm-loading":k.value},{title:v(()=>[i("div",be,[U(u(h.value?l(a)("title_edit_metadata"):l(a)("title_metadata_manage"))+" ",1),i("span",ye,u(l(a)("desc_metadata")),1)])]),footer:v(()=>[h.value?(o(),d(M,{key:0},[_(c,{onClick:s[0]||(s[0]=e=>g.value=!1)},{default:v(()=>[U(u(l(a)("btn_cancel")),1)]),_:1}),_(c,{type:"primary",onClick:X},{default:v(()=>[U(u(l(a)("btn_save")),1)]),_:1})],64)):P("",!0)]),default:v(()=>[i("div",ke,[h.value?(o(),d("div",ge,[(o(!0),d(M,null,J(r.value,(e,w)=>(o(),d("div",{key:w,class:"meta-item"},[i("div",Ce,[_(f,{checked:e.checked,"onUpdate:checked":n=>e.checked=n},null,8,["checked","onUpdate:checked"]),_(C,{title:e.is_show==1?l(a)("label_list_show"):l(a)("label_list_hide")},{default:v(()=>[i("span",{onClick:n=>B(e)},[e.is_show==1?(o(),m(l(q),{key:0,class:"icon"})):(o(),m(l(E),{key:1,class:"icon"}))],8,we)]),_:2},1032,["title"]),i("span",xe,u(e.name),1),i("span",Me,u(I[e.type]),1)]),e.type==1?(o(),m(Z,{key:0,value:e.value,"onUpdate:value":n=>e.value=n,format:"YYYY-MM-DD HH:mm",class:"input-box",onChange:n=>e.checked=!0},null,8,["value","onUpdate:value","onChange"])):e.type===2?(o(),m(ee,{key:1,value:e.value,"onUpdate:value":n=>e.value=n,placeholder:l(a)("ph_please_input"),maxlength:20,class:"input-box",onChange:n=>e.checked=!0},null,8,["value","onUpdate:value","placeholder","onChange"])):(o(),m(T,{key:2,value:e.value,"onUpdate:value":n=>e.value=n,valueModifiers:{trim:!0},placeholder:l(a)("ph_please_input"),maxlength:20,class:"input-box",onChange:n=>e.checked=!0},null,8,["value","onUpdate:value","placeholder","onChange"]))]))),128))])):(o(),d(M,{key:1},[i("div",Ue,[_(c,{type:"primary",ghost:"",onClick:z},{default:v(()=>[_(l(re)),U(" "+u(l(a)("btn_add_metadata")),1)]),_:1})]),r.value.length?(o(),d("div",Ie,[(o(!0),d(M,null,J(r.value,(e,w)=>(o(),d(M,{key:w},[e.is_edit?(o(),d("div",Oe,[_(T,{value:e.name,"onUpdate:value":n=>e.name=n,valueModifiers:{trim:!0},placeholder:l(a)("ph_please_input"),maxlength:20},null,8,["value","onUpdate:value","placeholder"]),_(H,{value:e.type,"onUpdate:value":n=>e.type=n,options:$,class:"min",disabled:e.id>0},null,8,["value","onUpdate:value","disabled"]),_(H,{value:e.is_show,"onUpdate:value":n=>e.is_show=n,options:y,class:"min"},null,8,["value","onUpdate:value"]),i("div",Ne,[_(c,{onClick:n=>W(e,w)},{default:v(()=>[U(u(l(a)("btn_cancel")),1)]),_:1},8,["onClick"]),_(c,{type:"primary",onClick:n=>A(e)},{default:v(()=>[U(u(l(a)("btn_save")),1)]),_:1},8,["onClick"])])])):(o(),d("div",Se,[i("div",$e,[_(C,{title:e.is_show==1?l(a)("label_list_show"):l(a)("label_list_hide")},{default:v(()=>[i("span",{onClick:n=>B(e)},[e.is_show==1?(o(),m(l(q),{key:0,class:"icon"})):(o(),m(l(E),{key:1,class:"icon"}))],8,De)]),_:2},1032,["title"]),i("span",Le,u(e.name),1),i("span",Be,u(I[e.type]),1)]),i("div",qe,[_(l(he),{class:"icon",onClick:n=>e.is_edit=!0},null,8,["onClick"]),_(l(fe),{class:"icon",onClick:n=>K(e,w)},null,8,["onClick"])])]))],64))),128))])):P("",!0),i("div",Ee,[i("div",Je,u(l(a)("label_builtin")),1),(o(!0),d(M,null,J(O.value,(e,w)=>(o(),d("div",{key:w,class:"meta-item"},[i("div",Ve,[_(C,{title:e.is_show==1?l(a)("label_list_show"):l(a)("label_list_hide")},{default:v(()=>[i("span",{onClick:n=>B(e)},[e.is_show==1?(o(),m(l(q),{key:0,class:"icon"})):(o(),m(l(E),{key:1,class:"icon"}))],8,Fe)]),_:2},1032,["title"]),i("span",Ye,u(e.name),1),i("span",Ae,u(I[e.type]),1)])]))),128))])],64))])]),_:1},8,["open","confirm-loading"])}}},Ke=j(Te,[["__scopeId","data-v-819baff2"]]),He={class:"rename-input"},Pe={__name:"rename-modal",emits:["ok"],setup(F,{expose:D,emit:L}){const{t:a}=R("views.library.library-details.components.rename-modal"),S=L,p=x(!1),y=x("");let $="";const I=(k={})=>{k=JSON.parse(JSON.stringify(k)),y.value=k.file_name,$=k.id,p.value=!0},g=()=>{y.value||b.error(a("msg_input_document_name")),_e({id:$,file_name:y.value}).then(k=>{b.success(a("msg_rename_success")),S("ok",y.value),p.value=!1})};return D({show:I}),(k,h)=>{const r=G,O=V;return o(),d("div",null,[_(O,{open:p.value,"onUpdate:open":h[1]||(h[1]=N=>p.value=N),title:l(a)("title_rename"),onOk:g},{default:v(()=>[i("div",He,[_(r,{value:y.value,"onUpdate:value":h[0]||(h[0]=N=>y.value=N),placeholder:l(a)("ph_input_document_name")},null,8,["value","placeholder"])])]),_:1},8,["open","title"])])}}},We=j(Pe,[["__scopeId","data-v-57514ee3"]]);export{Ke as M,We as R};
//# sourceMappingURL=rename-modal-WfG-X_fj.js.map
