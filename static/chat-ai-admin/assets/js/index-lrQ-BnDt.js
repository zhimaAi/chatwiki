var Fm=Object.defineProperty;var jm=(n,e,t)=>e in n?Fm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ii=(n,e,t)=>jm(n,typeof e!="symbol"?e+"":e,t);import{am as sg,f as X,e as Xe,aw as Ds,o as ut,ac as P,ad as w,az as ie,as as d,k as y,ar as x,G as z,at as j,F as ae,ax as ye,ai as Ct,av as Vm,n as Ni,aG as Hm,B as St,A as Zi,ae as Z,u as ee,w as gt,j as no,ak as Oi,c as He,aA as Nt,ah as In,E as ag,r as Je,y as Pt,J as Bn,l as Tt,ag as $u,s as Vf,aC as Um,p as ji,aH as zm,m as qm,d as lg,aj as Gm,au as er,aB as Ia,b as qc,aI as Xm}from"./vue-chunks-CGLjTDrY.js";import{a5 as Gc,A as Fa,_ as $e,d as Nn,a7 as To,af as Wm,a4 as As,ae as _n,ag as ns,ah as Xc,a3 as Ym,ai as Km,aj as Jm,ak as Gi,al as Zm,am as Qm,an as od,c as ey}from"../../index-C5-B0r5-.js";import{g as ty,v as ny,w as Hf,x as oy,y as iy,e as Tr,z as ry,A as sy,B as ug,C as ay,D as ly,E as uy,F as dy,G as cy,H as fy,I as py,J as Fd,K as dg,L as Uf,M as hy,N as dr}from"./index-AgSL8KLK.js";import{u as jn}from"./robot-jPE-s270.js";import{v as Qt,aa as Wc,D as $o,R as qi,ae as ja,a6 as Ht,B as Jt,aG as Qo,aH as vy,I as ln,h as $r,i as Pr,k as Rr,ay as cg,ah as yt,M as gn,F as wn,e as kn,y as It,z as Vt,Q as Ti,$ as $i,b as xt,av as Va,aI as Vn,aF as Os,O as $n,Y as ei,T as ti,aE as gy,aJ as Br,G as Ns,w as Pi,x as Ri,a0 as fg,o as Lr,az as _y,al as mo,V as pg,at as Kt,am as Yc,aK as Fn,as as mi,aL as my,aM as rs,a as Ms,aN as yy,aO as by,af as wr,aP as Kc,ad as Jc,a9 as Zc,X as xy,d as ho,aQ as wy,aR as Pu,ai as Ru,aS as Bu,H as Qc,aj as Cy,ak as Sy,ao as ky,aT as Ey,aU as an,aV as Dt,aW as ss,aX as Ha,aY as id,aZ as Kr,a_ as Lt,a$ as tr,b0 as Zo,b1 as Er,b2 as as,b3 as Qn,s as Dy,b4 as Ay,b5 as _a,b6 as jd,b7 as Oy,b8 as hg,b9 as Ny,ba as My,bb as zf,bc as Ty,bd as Vd,be as vg,bf as $y,bg as gg,bh as Qa,bi as Py,bj as Ry,bk as ea,bl as By,bm as Ly,bn as Iy,bo as Fy,bp as jy,ar as Vy,aA as Hy}from"./ui-antd-B11sc9DP.js";import{u as Uy}from"./global-CNyN0DwS.js";import{a as zy,_ as _g}from"./index-DgHaYNQX.js";import{_ as Bl}from"./empty-BFmzY9bl.js";import{c as Hd,a as qy,b as Gy,d as Xy,e as Wy,f as Vs,h as Yy,p as ma,i as Ky,_ as Jy,j as Zy,k as Qy,l as e0,m as t0,n as n0,o as o0,q as i0,r as r0,s as s0,t as a0,u as l0,v as u0,w as d0,x as c0,y as f0,z as p0,A as h0,B as v0,C as g0,D as _0,E as m0,F as y0,G as b0,H as x0,I as w0,J as C0,K as S0,L as k0,M as E0,N as D0,O as A0,P as O0,Q as N0,R as M0,S as T0,T as $0,U as P0,V as R0,W as B0,X as L0,Y as I0,Z as F0,$ as j0,a0 as V0,a1 as H0,a2 as U0,a3 as z0,a4 as q0,a5 as G0,a6 as X0,a7 as W0,a8 as Y0,a9 as K0,aa as J0,ab as Z0,ac as Q0,ad as e1,ae as t1,af as n1,ag as o1,ah as i1,ai as r1,aj as s1,ak as a1,al as l1,am as u1,an as d1,ao as c1,ap as f1,aq as p1,ar as h1,as as v1,at as g1,au as _1,av as m1,aw as y1,ax as b1,ay as x1,az as w1,aA as C1,aB as S1,aC as k1,aD as E1,aE as D1,aF as A1,aG as O1,aH as N1,aI as M1,aJ as T1,aK as $1,aL as P1,aM as R1,aN as B1,aO as L1,aP as I1,aQ as F1,aR as j1,aS as V1,aT as H1,aU as U1,aV as z1,aW as q1,aX as G1,aY as X1,aZ as W1,a_ as Y1,a$ as K1,b0 as J1,b1 as Z1,b2 as Q1,b3 as eb,b4 as tb,b5 as nb,b6 as ob,b7 as ib,b8 as rb,b9 as sb,ba as ab,bb as lb,bc as ub,bd as db,be as cb,bf as fb,bg as pb,bh as hb,bi as vb,bj as gb,bk as _b,bl as mb,bm as yb,bn as bb,bo as xb,bp as wb,bq as Cb,br as Sb,bs as kb,bt as Eb,bu as Db,bv as Ab,bw as Ob,bx as Nb,by as Mb,bz as Tb,bA as $b,bB as Pb,bC as Rb,bD as Bb,bE as Lb,bF as Ib,bG as Fb,bH as jb,bI as Vb,bJ as Hb,bK as Ub,bL as zb,bM as qb,bN as Gb,bO as Xb,bP as Wb,bQ as Yb,bR as Kb,bS as Jb,bT as Zb,bU as Qb,bV as e2,bW as t2,bX as n2,bY as o2,bZ as i2,b_ as r2,b$ as s2,c0 as a2,c1 as l2,c2 as u2,c3 as d2,c4 as c2,c5 as f2,c6 as p2,c7 as h2,c8 as v2,c9 as g2,ca as _2,cb as m2,cc as y2,cd as b2,ce as x2,cf as w2,cg as C2,ch as S2,ci as k2,cj as E2,ck as D2,cl as A2,cm as O2,cn as N2,co as M2,cp as T2,cq as $2,cr as P2,cs as R2,ct as B2,cu as L2,cv as I2,cw as F2,cx as j2,cy as V2,cz as H2,cA as U2,cB as z2,cC as q2,cD as G2,cE as X2,cF as W2,cG as Y2,cH as K2,cI as J2,cJ as Z2,cK as Q2,cL as ex,cM as tx,cN as nx,cO as ox,cP as ix,cQ as rx,cR as sx,cS as ax,cT as lx,cU as ux,cV as dx,cW as cx,cX as fx,cY as px,cZ as hx,c_ as vx,c$ as gx,d0 as _x,d1 as mx,d2 as yx,d3 as bx,d4 as xx,d5 as wx,d6 as Cx,d7 as Sx,d8 as kx,d9 as Ex,da as Dx,db as Ax,dc as Ox,dd as Nx,de as Mx,df as Tx,dg as $x,dh as Px,di as Rx,dj as Bx,dk as Lx,dl as Ix,dm as Fx,dn as jx,dp as Vx,dq as Hx,dr as Ux,ds as zx,dt as qx,du as Gx,dv as Xx,dw as Wx,dx as Yx,dy as Kx,dz as Jx,dA as Zx,dB as Qx,dC as ew,dD as tw,dE as nw,dF as ow,dG as iw,dH as Oo,dI as yo,dJ as mg,dK as yi,dL as yg,dM as ef,dN as Lu,g as rw,dO as bg,dP as ls,dQ as sw,dR as aw,dS as qf,dT as lw}from"./util-BZzWiL8k.js";import{M as nr,a as uw,u as xg,b as wg}from"./model-select-DkFuDwQt.js";import{_ as Ua}from"./empty-CzGZrENG.js";import{a as dw,g as cw}from"./index-Dg6gjwQb.js";import{_ as fw}from"./cu-scroll-C_QJcxx1.js";import{W as pw}from"./index-CpUVYSJF.js";import{a as Cg}from"./index-BB_LiM3a.js";import{r as Sg,R as hw}from"./editor-code-DDvPSeJb.js";import{P as us}from"./styles-B3AMWjFt.js";import{d as vw}from"./vuedraggable.umd-u2TvJqwU.js";import{g as kg}from"./thirdMcp-DUEdPcdt.js";import{r as Po,g as Eg,o as gw,d as _w}from"./index-y6Ut8zwU.js";import{F as mw,P as yw}from"./plugin-config-modal-Cf1BePkr.js";import{i as Ud}from"./validate-8MtiUsxW.js";import{u as ds}from"./useEventBus-CB_rGuu7.js";import{Z as ko}from"./zm-radio-group-C5lNymg1.js";import{T as bw,E as xw}from"./wange-ditor-Dfk_SQJx.js";import{S as ww}from"./select-wechat-app-BXaQglV5.js";import{r as Cw}from"./elkjs-DtH5Wp6f.js";import{T as Sw}from"./top-header-BOdm9TcW.js";import{a as kw}from"./add-group-CjnR-f-1.js";import{j as Ew}from"./index-Btdd0zUd.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-DYPuxmVf.js";import"./loading-box-CAF9T3Ud.js";import"./empty-box-C5iAwHZS.js";function Dw(n={}){return Gc.get({url:"/manage/getTriggerConfigList",params:n})}function Aw(n={}){return Gc.get({url:"/manage/getTriggerOfficialMessage",params:n})}const Ts=sg("workflow",()=>{const n=X([]),e=X([]),t=X([]),o=X([]);return{triggerList:n,getTriggerList:async(a,l)=>{try{if(n.value.length===0||l){const u=await Dw({robot_key:a});n.value=u.data.map(c=>(c.subMenus=[],c.expend=!1,c.trigger_type==4&&(c.subMenus=[{title:"私信消息",value:"message"},{title:"关注/取消关注事件",value:"subscribe_unsubscribe"},{title:"扫描带参数二维码事件",value:"qrcode_scan"},{title:"自定义菜单事件",value:"menu_click"}]),c))}return n.value}catch(u){}},officialList:e,getTriggerOfficialMsg:a=>{Aw({robot_key:a}).then(l=>{t.value=l.data.messages||[],e.value=l.data.apps||[]})},triggerOfficialList:t,getAllLibraryList:()=>{Fa().then(a=>{o.value=a.data})},libraryLists:o}}),Ow={key:0,class:"sidebar-handle-wrapper"},Nw={class:"sidebar-container"},Mw={class:"sidebar-menus"},Tw=["onClick"],$w={class:"menu-name"},Pw={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(n){const e=Uy(),t=Vm(),o=Ds(),i=Xe(()=>o.path.split("/")[3]),r=X(!0),s=X(!0);function a(){r.value=!r.value,s.value=!1,e.setHideLayoutTopAndBottom(r.value)}const l=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],u=c=>{if(c.isNewWindowOpen){window.open(`/#${c.path}?robot_key=${o.query.robot_key}&id=${o.query.id}`);return}t.push({path:c.path,query:o.query})};return ut(()=>{setTimeout(()=>{s.value=!1},3e3)}),(c,f)=>{const p=Qt,h=Nn;return w(),P("div",{class:Ct(["sidebar-wrapper",{"is-hide":r.value}])},[n.showSidebarBtn?(w(),P("div",Ow,[y(p,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:s.value,"onUpdate:open":f[0]||(f[0]=v=>s.value=v),arrow:!1},{title:x(()=>[z(j(r.value?"展开":"收起"),1)]),default:x(()=>[d("span",{class:"sidebar-handle",onClick:a},[...f[1]||(f[1]=[d("span",{class:"handle-line handle-line01"},null,-1),d("span",{class:"handle-line handle-line02"},null,-1)])])]),_:1},8,["open"])])):ie("",!0),d("div",Nw,[d("div",Mw,[(w(),P(ae,null,ye(l,v=>y(zy,{key:v.value,disabled:!r.value,title:v.label,placement:"bottom"},{default:x(()=>[d("div",{class:Ct(["sidebar-menu",{active:i.value==v.value}]),onClick:_=>u(v)},[y(h,{name:v.iconName,class:"menu-icon",size:"16"},null,8,["name"]),d("span",$w,j(v.label),1)],10,Tw)]),_:2},1032,["disabled","title"])),64))])])],2)}}},Rw=$e(Pw,[["__scopeId","data-v-5c34bb83"]]),Bw={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(n){n!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${n}%`,this.previousValue=n)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.$emit("update:modelValue",n.value),this.$emit("zoom-change",n.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const n=this.currentValue.replace("%","").trim(),e=parseInt(n.replace(/[^\d]/g,""),10);if(!n){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const n=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(n)&&n>=1&&n<=800?(this.$emit("update:modelValue",n),this.$emit("zoom-change",n),this.currentValue=`${n}%`,this.previousValue=n):this.currentValue=`${this.previousValue}%`},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(n.target)&&n.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},Lw={class:"zoom-select"},Iw={class:"zoom-select-options"},Fw=["onClick"];function jw(n,e,t,o,i,r){return w(),P("div",Lw,[d("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=St(()=>{},["stop"]))},[Ni(d("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.currentValue=s),onInput:e[1]||(e[1]=(...s)=>r.handleInput&&r.handleInput(...s)),onFocus:e[2]||(e[2]=(...s)=>r.showMenu&&r.showMenu(...s)),onBlur:e[3]||(e[3]=(...s)=>r.handleBlur&&r.handleBlur(...s))},null,544),[[Hm,i.currentValue]])]),Ni(d("div",Iw,[(w(!0),P(ae,null,ye(i.menus,s=>(w(),P("div",{class:"zoom-select-option",key:s.value,onClick:a=>r.handleMenu(s)},j(s.label),9,Fw))),128)),e[6]||(e[6]=d("div",{class:"option-line"},null,-1)),d("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=s=>r.handleFitView())},"全览")],512),[[Zi,i.isShowMenu]])])}const Vw=$e(Bw,[["render",jw],["__scopeId","data-v-be70cfde"]]),Hw={class:"trigger-list-box"},Uw={key:0,class:"trigger-list"},zw=["onClick"],qw={class:"trigger-info"},Gw=["src"],Xw={class:"info"},Ww={class:"name"},Yw={key:0,class:"right-icon"},Kw={key:0,class:"sub-menu-list"},Jw=["onClick"],Zw={key:1,class:"empty-box"},Qw={href:"/#/plugins/index?active=2",target:"_blank"},eC={__name:"trigger-list",emits:["add"],setup(n,{emit:e}){const t=e,o=Ts(),i=Xe(()=>o.triggerOfficialList),r=X(""),s=Xe(()=>{let u=o.triggerList;return r.value?u.filter(c=>c.trigger_name.includes(r.value)):u}),a=u=>{if(u.subMenus&&u.subMenus.length){u.expend=!u.expend;return}let c=Hd(u);t("add",c)},l=(u,c)=>{u.trigger_type==4&&(u.trigger_official_config.msg_type=c.value,i.value,u.outputs=i.value.find(p=>p.msg_type==c.value).fields);let f=Hd(u);t("add",f)};return(u,c)=>{const f=Wc;return w(),P("div",Hw,[d("div",{class:"search-box",onClick:c[1]||(c[1]=St(()=>{},["stop"]))},[y(f,{value:r.value,"onUpdate:value":c[0]||(c[0]=p=>r.value=p),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),P("div",Uw,[(w(!0),P(ae,null,ye(s.value,p=>(w(),P("div",{class:"trigger-item",onClick:h=>a(p),key:p.type},[d("div",qw,[d("img",{class:"avatar",src:p.trigger_icon},null,8,Gw),d("div",Xw,[d("span",Ww,j(p.trigger_name),1)]),p.subMenus&&p.subMenus.length?(w(),P("div",Yw,[p.expend?(w(),Z(ee($o),{key:0})):(w(),Z(ee(qi),{key:1}))])):ie("",!0)]),p.expend&&p.subMenus&&p.subMenus.length?(w(),P("div",Kw,[(w(!0),P(ae,null,ye(p.subMenus,h=>(w(),P("div",{class:"sub-item",onClick:St(v=>l(p,h),["stop"]),key:h.value},j(h.title),9,Jw))),128))])):ie("",!0)],8,zw))),128))])):(w(),P("div",Zw,[c[3]||(c[3]=d("img",{style:{height:"200px"},src:Bl},null,-1)),c[4]||(c[4]=d("div",null,"暂无可用插件",-1)),d("a",Qw,[c[2]||(c[2]=z("去添加 ",-1)),y(ee(qi))])]))])}}},tC=$e(eC,[["__scopeId","data-v-17e64728"]]),nC={class:"trigger-list-box"},oC={key:0,class:"trigger-list"},iC=["onClick"],rC={class:"trigger-info"},sC=["src"],aC={class:"info"},lC={class:"name"},uC={key:1,class:"empty-box"},dC={href:"/#/robot/list?active=1",target:"_blank"},cC={__name:"workflow-list",emits:["add"],setup(n,{emit:e}){const t=e,o=X([]),i=X("");ut(()=>{r()});function r(){ty({application_type:1}).then(l=>{let u=l.data||[];o.value=u.filter(c=>c.has_published==1)})}const s=Xe(()=>i.value?o.value.filter(l=>l.robot_name.includes(i.value)):o.value),a=l=>{let u=qy(l);t("add",u)};return(l,u)=>{const c=Wc;return w(),P("div",nC,[d("div",{class:"search-box",onClick:u[1]||(u[1]=St(()=>{},["stop"]))},[y(c,{value:i.value,"onUpdate:value":u[0]||(u[0]=f=>i.value=f),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),P("div",oC,[(w(!0),P(ae,null,ye(s.value,f=>(w(),P("div",{class:"trigger-item",onClick:p=>a(f),key:f.id},[d("div",rC,[d("img",{class:"avatar",src:f.robot_avatar},null,8,sC),d("div",aC,[d("span",lC,j(f.robot_name),1)])])],8,iC))),128))])):(w(),P("div",uC,[u[3]||(u[3]=d("img",{style:{height:"200px"},src:Bl},null,-1)),u[4]||(u[4]=d("div",null,"暂无可用工作流",-1)),d("a",dC,[u[2]||(u[2]=z("去添加 ",-1)),y(ee(qi))])]))])}}},fC=$e(cC,[["__scopeId","data-v-f65de8f8"]]),pC={class:"node-list-popup"},hC={class:"tabs-box"},vC={class:"node-list-popup-content"},gC={key:0,class:"node-list"},_C={class:"node-type"},mC={class:"node-flex-box"},yC=["onMousedown"],bC=["src","alt"],xC={class:"node-name"},wC={key:1,class:"node-box"},CC={class:"search-box"},SC={key:0,class:"node-list"},kC={class:"node-info-pop"},EC={class:"info"},DC=["src"],AC={class:"name"},OC={class:"extra"},NC=["onClick"],MC=["src"],TC={class:"info"},$C={class:"name"},PC={class:"total"},RC={class:"node-tools"},BC={class:"params-box"},LC={class:"param-item"},IC={class:"field"},FC={class:"name"},jC={class:"desc"},VC={class:"field"},HC={class:"name"},UC={class:"type"},zC={key:0,class:"required"},qC={class:"desc"},GC=["onMousedown"],XC={key:1,class:"empty-box"},WC={key:2,class:"node-box"},YC={class:"node-list"},KC=["onClick"],JC={class:"node-info"},ZC=["src"],QC={class:"info"},eS={class:"name"},tS={key:0,class:"node-item"},nS={class:"node-info-pop"},oS={class:"info"},iS=["src"],rS={class:"name"},sS={class:"extra"},aS=["onClick"],lS=["src"],uS={class:"info"},dS={class:"name"},cS={class:"total"},fS={class:"node-tools"},pS={class:"params-box"},hS={class:"param-item"},vS={class:"field"},gS={class:"name"},_S={class:"desc"},mS={class:"field"},yS={class:"name"},bS={class:"type"},xS={key:0,class:"required"},wS={class:"desc"},CS=["onMousedown"],SS=["onClick"],kS={class:"node-info"},ES=["src"],DS={class:"info"},AS={class:"name"},OS={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},NS={key:1,class:"empty-box"},MS={href:"/#/plugins/index?active=2",target:"_blank"},TS={key:3,class:"node-box"},$S={key:4,class:"node-box"},PS={__name:"index",props:{type:{type:String,default:""},active:{type:Number,default:1},excludedNodeTypes:{type:Array,default:()=>[]}},emits:["addNode","addTrigger","mouseMove","update:active"],setup(n,{emit:e}){const t=e,o=n,i=X(o.active);gt(()=>o.active,C=>{i.value=C});const r=X([]),s=X([]),a=X([]),l=X("");gt(()=>o.excludedNodeTypes,()=>{r.value=Gy({excludedNodeTypes:o.excludedNodeTypes})},{immediate:!0}),ut(()=>{Xy().then(C=>{a.value=C}),Wy().then(C=>{s.value=C})});const u=Xe(()=>l.value?a.value.filter(C=>(C.description+C.name).indexOf(l.value)>-1):a.value),c=(C,D)=>{C.preventDefault();let T=!1;const O=C.clientX,k=C.clientY,S=JSON.parse(JSON.stringify(D)),N=document.createElement("div");N.classList.add("node-item-ghost"),N.innerHTML=C.currentTarget.innerHTML,document.body.appendChild(N);const L=E=>{N.style.left=`${E.clientX+5}px`,N.style.top=`${E.clientY+5}px`};L(C);const $=E=>{!T&&(Math.abs(E.clientX-O)>5||Math.abs(E.clientY-k)>5)&&(T=!0),L(E),t("mouseMove")},B=E=>{document.body.removeChild(N),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",B),T?t("addNode",{node:S,event:E}):f(S)};window.addEventListener("mousemove",$),window.addEventListener("mouseup",B,{once:!0})},f=C=>{C=JSON.parse(JSON.stringify(C)),t("addNode",{node:C})},p=(C,D,T)=>{let O=Yy(D,T);c(C,O)},h=C=>{t("addNode",{node:C,isTriggerNode:!0})},v=C=>{t("addNode",{node:C})},_=(C,D,T,O)=>{D=Ky(D,T,O),C?c(C,D):t("addNode",{node:D})};function m(C){i.value=C,t("update:active",C)}function g(){window.open("/#/robot/list?active=3&mcp=2","_blank")}function b(C){var T,O,k;let D=To((T=C==null?void 0:C.properties)==null?void 0:T.node_params,{});return ma((O=D==null?void 0:D.plugin)==null?void 0:O.name)||((k=D==null?void 0:D.plugin)==null?void 0:k.multiNode)}return(C,D)=>{const T=Nn,O=Wc,k=ja;return w(),P("div",pC,[d("div",hC,[d("div",{class:Ct(["tab-item",{active:i.value==1}]),onClick:D[0]||(D[0]=S=>m(1))},[y(T,{name:"base-node-type"}),D[6]||(D[6]=z()),D[7]||(D[7]=d("span",null,"基础功能",-1))],2),d("div",{class:Ct(["tab-item",{active:i.value==3}]),onClick:D[1]||(D[1]=S=>m(3))},[y(T,{name:"plugin-node-type"}),D[8]||(D[8]=z()),D[9]||(D[9]=d("span",null,"插件",-1))],2),d("div",{class:Ct(["tab-item",{active:i.value==2}]),onClick:D[2]||(D[2]=S=>m(2))},[y(T,{name:"mcp-node-type"}),D[10]||(D[10]=z()),D[11]||(D[11]=d("span",null,"MCP",-1))],2),o.type=="float-btn"?(w(),P("div",{key:0,class:Ct(["tab-item",{active:o.active==4}]),onClick:D[3]||(D[3]=S=>m(4))},[y(T,{name:"mcp-node-type"}),D[12]||(D[12]=z()),D[13]||(D[13]=d("span",null,"触发器",-1))],2)):ie("",!0),d("div",{class:Ct(["tab-item",{active:i.value==5}]),onClick:D[4]||(D[4]=S=>m(5))},[y(T,{name:"workflow"}),D[14]||(D[14]=z()),D[15]||(D[15]=d("span",null,"工作流",-1))],2)]),d("div",vC,[i.value==1?(w(!0),P(ae,{key:0},ye(r.value,S=>(w(),P(ae,{key:S.key},[S.hidden?ie("",!0):(w(),P("div",gC,[d("div",_C,j(S.name),1),d("div",mC,[(w(!0),P(ae,null,ye(S.nodes,N=>(w(),P(ae,{key:N.type},[N.hidden?ie("",!0):(w(),P("div",{key:0,class:"node-item",onMousedown:L=>c(L,N)},[d("img",{src:N.properties.node_icon,alt:N.properties.node_name},null,8,bC),d("div",xC,j(N.properties.node_name),1)],40,yC))],64))),128))])]))],64))),128)):i.value==2?(w(),P("div",wC,[d("div",CC,[y(O,{value:l.value,"onUpdate:value":D[5]||(D[5]=S=>l.value=S),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),u.value.length?(w(),P("div",SC,[(w(!0),P(ae,null,ye(u.value,(S,N)=>(w(),P("div",{key:N,class:"node-item"},[y(k,{placement:"right"},{content:x(()=>[d("div",kC,[d("div",EC,[d("img",{class:"avatar",src:S.avatar},null,8,DC),d("div",AC,j(S.name),1)]),d("div",null,j(S.url),1),d("div",OC,"可用工具："+j(S.tools.length),1)])]),default:x(()=>[d("div",{class:"node-info",onClick:L=>S.expand=!S.expand},[d("img",{class:"avatar",src:S.avatar},null,8,MC),d("div",TC,[d("span",$C,j(S.name),1),d("span",PC,[z(j(S.tools.length)+" ",1),S.expand?(w(),Z(ee($o),{key:0})):(w(),Z(ee(qi),{key:1}))])])],8,NC)]),_:2},1024),Ni(d("div",RC,[(w(!0),P(ae,null,ye(S.tools,(L,$)=>(w(),Z(k,{key:$,placement:"right"},{content:x(()=>[d("div",BC,[d("div",LC,[d("div",IC,[d("span",FC,j(L.name),1)]),d("div",jC,j(L.description),1)]),(w(!0),P(ae,null,ye(L.inputSchema.properties,(B,E)=>(w(),P("div",{key:E,class:"param-item"},[d("div",VC,[d("span",HC,j(E),1),d("span",UC,j(B.type),1),L.inputSchema.required&&L.inputSchema.required.includes(E)?(w(),P("span",zC,"必填")):ie("",!0)]),d("div",qC,j(B.description),1)]))),128))])]),default:x(()=>[d("div",{class:"node-tool-item",onMousedown:B=>p(B,S,L)},j(L.name),41,GC)]),_:2},1024))),128))],512),[[Zi,S.expand]])]))),128))])):(w(),P("div",XC,[D[17]||(D[17]=d("img",{style:{height:"200px"},src:Bl},null,-1)),D[18]||(D[18]=d("div",null,"暂无可用MCP插件",-1)),d("a",{onClick:g},[D[16]||(D[16]=z("去添加",-1)),y(ee(qi))])]))])):i.value==3?(w(),P("div",WC,[s.value.length?(w(),P(ae,{key:0},[d("div",YC,[(w(!0),P(ae,null,ye(s.value,S=>(w(),P(ae,{key:S.type},[b(S)?(w(),P(ae,{key:1},[ee(Vs)(S.plugin_name).length>1?(w(),P("div",tS,[y(k,{placement:"right"},{content:x(()=>[d("div",nS,[d("div",oS,[d("img",{class:"avatar",src:S.properties.node_icon},null,8,iS),d("div",rS,j(S.properties.node_name),1)]),d("div",null,j(S.properties.node_desc),1),d("div",sS,"可用工具："+j(ee(Vs)(S.plugin_name).length),1)])]),default:x(()=>[d("div",{class:"node-info",onClick:N=>S.expand=!S.expand},[d("img",{class:"avatar",src:S.properties.node_icon},null,8,lS),d("div",uS,[d("span",dS,j(S.properties.node_name),1),d("span",cS,[z(j(ee(Vs)(S.plugin_name).length)+" ",1),S.expand?(w(),Z(ee($o),{key:0})):(w(),Z(ee(qi),{key:1}))])])],8,aS)]),_:2},1024),Ni(d("div",fS,[(w(!0),P(ae,null,ye(ee(Vs)(S.plugin_name),N=>(w(),Z(k,{key:N.name,placement:"right"},{content:x(()=>[d("div",pS,[d("div",hS,[d("div",vS,[d("span",gS,j(N.title),1)]),d("div",_S,j(N.desc),1)]),(w(!0),P(ae,null,ye(N.params,(L,$)=>(w(),P("div",{key:$,class:"param-item"},[d("div",mS,[d("span",yS,j($),1),d("span",bS,j(L.type),1),L.required?(w(),P("span",xS,"必填")):ie("",!0)]),d("div",wS,j(L.desc),1)]))),128))])]),default:x(()=>[d("div",{class:"node-tool-item",onMousedown:L=>_(L,S,N,N.name)},j(N.title),41,CS)]),_:2},1024))),128))],512),[[Zi,S.expand]])])):(w(!0),P(ae,{key:1},ye(ee(Vs)(S.plugin_name),N=>(w(),P("div",{onClick:L=>_(null,S,N,N.name),class:"node-item"},[d("div",kS,[d("img",{class:"avatar",src:S.properties.node_icon},null,8,ES),d("div",DS,[d("span",AS,j(S.properties.node_name),1)])])],8,SS))),256))],64)):(w(),P("div",{key:0,onClick:N=>f(S),class:"node-item"},[d("div",JC,[d("img",{class:"avatar",src:S.properties.node_icon},null,8,ZC),d("div",QC,[d("span",eS,j(S.properties.node_name),1)])])],8,KC))],64))),128))]),d("a",OS,[D[19]||(D[19]=z("更多插件 ",-1)),y(ee(qi))])],64)):(w(),P("div",NS,[D[21]||(D[21]=d("img",{style:{height:"200px"},src:Bl},null,-1)),D[22]||(D[22]=d("div",null,"暂无可用插件",-1)),d("a",MS,[D[20]||(D[20]=z("去添加",-1)),y(ee(qi))])]))])):i.value==4?(w(),P("div",TS,[y(tC,{onAdd:h})])):i.value==5?(w(),P("div",$S,[y(fC,{onAdd:v})])):ie("",!0)])])}}},Iu=$e(PS,[["__scopeId","data-v-6e785183"]]),RS={class:"custom-control-warpper"},BS={class:"custom-control-body"},LS={class:"custom-control"},IS={class:"control-item zoom-control"},FS={class:"control-item"},jS={class:"control-item"},VS={class:"control-item"},HS={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(n,{emit:e}){const t=e,o=n,i=X(["terminate-node"]),{eventCenter:r}=o.lf.graphModel,s=X(100),a=()=>{o.lf.fitView()},l=()=>{let k=s.value/100;o.lf.zoom(k),t("zoomChange",k)},u=k=>{s.value=k,l()},c=()=>{let k=s.value-10;k<1&&(k=1),s.value=k,l()},f=()=>{let k=s.value+10;k>800&&(k=800),s.value=k,l()},p=k=>{let S=Math.floor(k.transform.SCALE_X*100);s.value=S},h=X(!1),v=X(null),_=X(1),m=()=>{_.value=1,h.value=!0},g=()=>{t("runTest")},b=()=>{t("autoLayout")},C=k=>{h.value&&(v.value.contains(k.target)||(h.value=!1))},D=()=>{h.value&&(h.value=!1)},T=k=>{t("addNode",k),h.value=!1},O=()=>{_.value=4,h.value=!0};return ut(()=>{document.addEventListener("click",C),r.on("graph:transform",p),r.on("custom:showTriggerLit",O)}),no(()=>{document.removeEventListener("click",C),r.off("graph:transform",p),r.off("custom:showTriggerLit",O)}),(k,S)=>{const N=Nn,L=Jt;return w(),P("div",RS,[d("div",BS,[d("div",LS,[d("div",IS,[d("div",{class:"action-btn zoom-btn",onClick:c},[y(N,{name:"minus",size:"16"})]),y(Vw,{modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=$=>s.value=$),onZoomChange:u,onFitView:a},null,8,["modelValue"]),d("div",{class:"action-btn zoom-btn",onClick:f},[y(N,{name:"plus",size:"16"})])]),S[5]||(S[5]=d("i",{class:"control-line"},null,-1)),d("div",FS,[y(L,{type:"primary",onClick:St(m,["stop"])},{icon:x(()=>[y(ee(Ht))]),default:x(()=>[S[2]||(S[2]=d("span",null,"新建节点",-1))]),_:1})]),d("div",jS,[y(L,{onClick:g,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(ee(Qo)),S[3]||(S[3]=d("span",null,"运行测试",-1))]),_:1})]),d("div",VS,[y(L,{onClick:b,type:"default"},{default:x(()=>[y(ee(vy)),S[4]||(S[4]=d("span",null,"整理画布",-1))]),_:1})])]),Ni(d("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:v},[y(Iu,{excludedNodeTypes:i.value,onAddNode:T,type:"float-btn",onMouseMove:D,active:_.value,"onUpdate:active":S[1]||(S[1]=$=>_.value=$)},null,8,["excludedNodeTypes","active"])],512),[[Zi,h.value]])])])}}},US=$e(HS,[["__scopeId","data-v-e8762f74"]]),zS={},qS={class:"node-form-layout"},GS={class:"layout-header"},XS={class:"layout-body"};function WS(n,e){return w(),P("div",qS,[d("div",GS,[Oi(n.$slots,"header",{},void 0,!0)]),d("div",XS,[Oi(n.$slots,"default",{},void 0,!0)])])}const cn=$e(zS,[["render",WS],["__scopeId","data-v-1df44d93"]]),YS={class:"node-form-header"},KS={class:"node-title"},JS={class:"title-left"},ZS=["src"],QS={class:"title-conttent"},ek={class:"title-right"},tk={class:"node-desc"},nk={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},emits:["changeTitle","deleteNode","close"],setup(n,{emit:e}){const t=He("changeTitle"),o=He("deleteNode"),i=He("close"),r=e,s=n;let a=null;const l=v=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":iw,"../../../../assets/svg/ai-generate-white.svg":ow,"../../../../assets/svg/ai-generate.svg":nw,"../../../../assets/svg/ai-mark.svg":tw,"../../../../assets/svg/ai.svg":ew,"../../../../assets/svg/alarm-clock.svg":Qx,"../../../../assets/svg/alert-icon.svg":Zx,"../../../../assets/svg/ali-ocr.svg":Jx,"../../../../assets/svg/analysis.svg":Kx,"../../../../assets/svg/anthrop.svg":Yx,"../../../../assets/svg/applet.svg":Wx,"../../../../assets/svg/arrow-down.svg":Xx,"../../../../assets/svg/arrow-left.svg":Gx,"../../../../assets/svg/arrow-right.svg":qx,"../../../../assets/svg/attachment.svg":zx,"../../../../assets/svg/auth.svg":Ux,"../../../../assets/svg/auto-reply.svg":Hx,"../../../../assets/svg/azure.svg":Vx,"../../../../assets/svg/back.svg":jx,"../../../../assets/svg/baichuan.svg":Fx,"../../../../assets/svg/base-node-type.svg":Ix,"../../../../assets/svg/batch-group-node.svg":Lx,"../../../../assets/svg/book.svg":Bx,"../../../../assets/svg/chat-cache.svg":Rx,"../../../../assets/svg/chat-mode.svg":Px,"../../../../assets/svg/chat-robot-icon.svg":$x,"../../../../assets/svg/chat.svg":Tx,"../../../../assets/svg/check-arrow-filled.svg":Mx,"../../../../assets/svg/circular-needle2.svg":Nx,"../../../../assets/svg/circularNeedle.svg":Ox,"../../../../assets/svg/client.svg":Ax,"../../../../assets/svg/close-circle.svg":Dx,"../../../../assets/svg/cmd.svg":Ex,"../../../../assets/svg/code-run-node.svg":kx,"../../../../assets/svg/cohere.svg":Sx,"../../../../assets/svg/collaborator.svg":Cx,"../../../../assets/svg/collapse-close.svg":wx,"../../../../assets/svg/collapse-open.svg":xx,"../../../../assets/svg/colour-edit.svg":bx,"../../../../assets/svg/comment-delete.svg":yx,"../../../../assets/svg/comment-reply.svg":mx,"../../../../assets/svg/comment-search.svg":_x,"../../../../assets/svg/comment-selected.svg":gx,"../../../../assets/svg/comment.svg":vx,"../../../../assets/svg/common-quession.svg":hx,"../../../../assets/svg/create_library.svg":px,"../../../../assets/svg/create_robot.svg":fx,"../../../../assets/svg/cu-doc-active.svg":cx,"../../../../assets/svg/cu-doc-icon.svg":dx,"../../../../assets/svg/custom-group-node.svg":ux,"../../../../assets/svg/data-node.svg":lx,"../../../../assets/svg/data-security.svg":ax,"../../../../assets/svg/database-menu-icon.svg":sx,"../../../../assets/svg/deepseek.svg":rx,"../../../../assets/svg/delete-line.svg":ix,"../../../../assets/svg/delete.svg":ox,"../../../../assets/svg/ding-group-node.svg":nx,"../../../../assets/svg/direct-connection.svg":tx,"../../../../assets/svg/dislike-active.svg":ex,"../../../../assets/svg/dislike.svg":Q2,"../../../../assets/svg/doc-active-menu-icon.svg":Z2,"../../../../assets/svg/doc-directory.svg":J2,"../../../../assets/svg/doc-draft.svg":K2,"../../../../assets/svg/doc-file.svg":Y2,"../../../../assets/svg/doc-file2.svg":W2,"../../../../assets/svg/doc-icon-active.svg":X2,"../../../../assets/svg/doc-icon.svg":G2,"../../../../assets/svg/doc-menu-icon.svg":q2,"../../../../assets/svg/document.svg":z2,"../../../../assets/svg/download.svg":U2,"../../../../assets/svg/drag.svg":H2,"../../../../assets/svg/dragv2.svg":V2,"../../../../assets/svg/duiwaifuwu.svg":j2,"../../../../assets/svg/economic-active.svg":F2,"../../../../assets/svg/economic.svg":I2,"../../../../assets/svg/edit-02.svg":L2,"../../../../assets/svg/edit.svg":B2,"../../../../assets/svg/empty-document.svg":R2,"../../../../assets/svg/empty.svg":P2,"../../../../assets/svg/end-node.svg":$2,"../../../../assets/svg/enterprise-active.svg":T2,"../../../../assets/svg/enterprise.svg":M2,"../../../../assets/svg/enterprise2.svg":N2,"../../../../assets/svg/execute.svg":O2,"../../../../assets/svg/execute_array.svg":A2,"../../../../assets/svg/expand.svg":D2,"../../../../assets/svg/explain-node.svg":E2,"../../../../assets/svg/export-record.svg":k2,"../../../../assets/svg/eye-open.svg":S2,"../../../../assets/svg/feishu-doc.svg":C2,"../../../../assets/svg/field-menu-icon.svg":w2,"../../../../assets/svg/file-icon.svg":x2,"../../../../assets/svg/file-search.svg":b2,"../../../../assets/svg/finance.svg":y2,"../../../../assets/svg/function-center.svg":m2,"../../../../assets/svg/gemini.svg":_2,"../../../../assets/svg/generate-icon.svg":g2,"../../../../assets/svg/gou.svg":v2,"../../../../assets/svg/government.svg":h2,"../../../../assets/svg/graph-icon.svg":p2,"../../../../assets/svg/group-send.svg":f2,"../../../../assets/svg/guanlianzhishiku.svg":c2,"../../../../assets/svg/guide.svg":d2,"../../../../assets/svg/high-active.svg":u2,"../../../../assets/svg/high.svg":l2,"../../../../assets/svg/http-node.svg":a2,"../../../../assets/svg/huanyingyu.svg":s2,"../../../../assets/svg/huoshanyinqin.svg":r2,"../../../../assets/svg/icon-all.svg":i2,"../../../../assets/svg/icon-rocket.svg":o2,"../../../../assets/svg/image-generation-node.svg":n2,"../../../../assets/svg/img-icon.svg":t2,"../../../../assets/svg/input.svg":e2,"../../../../assets/svg/jibenpeizhi.svg":Qb,"../../../../assets/svg/jichupeizhi.svg":Zb,"../../../../assets/svg/jina.svg":Jb,"../../../../assets/svg/json-node.svg":Kb,"../../../../assets/svg/json-reverse-node.svg":Yb,"../../../../assets/svg/judge-node.svg":Wb,"../../../../assets/svg/knowledge-base-node.svg":Xb,"../../../../assets/svg/knowledge-config-active-icon.svg":Gb,"../../../../assets/svg/knowledge-config-icon.svg":qb,"../../../../assets/svg/lang.svg":zb,"../../../../assets/svg/law.svg":Ub,"../../../../assets/svg/liaotianceshi.svg":Hb,"../../../../assets/svg/library_ability_official_account.svg":Vb,"../../../../assets/svg/like-active.svg":jb,"../../../../assets/svg/like-icon.svg":Fb,"../../../../assets/svg/like.svg":Ib,"../../../../assets/svg/lingyiwanwu.svg":Lb,"../../../../assets/svg/link-icon-active.svg":Bb,"../../../../assets/svg/link-icon.svg":Rb,"../../../../assets/svg/link-left.svg":Pb,"../../../../assets/svg/lock-icon.svg":$b,"../../../../assets/svg/login-success.svg":Tb,"../../../../assets/svg/logout.svg":Mb,"../../../../assets/svg/loop-2.svg":Nb,"../../../../assets/svg/loop-3.svg":Ob,"../../../../assets/svg/loop-icon.svg":Ab,"../../../../assets/svg/manufacture.svg":Db,"../../../../assets/svg/mcp-node-type.svg":Eb,"../../../../assets/svg/mcp-node.svg":kb,"../../../../assets/svg/medical-treatment.svg":Sb,"../../../../assets/svg/menu-expand.svg":Cb,"../../../../assets/svg/message.svg":wb,"../../../../assets/svg/minus.svg":xb,"../../../../assets/svg/mix-icon.svg":bb,"../../../../assets/svg/more-compatible.svg":yb,"../../../../assets/svg/moxingshezhi.svg":mb,"../../../../assets/svg/multimode-box.svg":_b,"../../../../assets/svg/nav-chat.svg":gb,"../../../../assets/svg/nav-doc.svg":vb,"../../../../assets/svg/nav-explore.svg":hb,"../../../../assets/svg/nav-find.svg":pb,"../../../../assets/svg/nav-library.svg":fb,"../../../../assets/svg/nav-robot.svg":cb,"../../../../assets/svg/nav-search.svg":db,"../../../../assets/svg/network.svg":ub,"../../../../assets/svg/official-trigger-node.svg":lb,"../../../../assets/svg/official_account_ai_comment.svg":ab,"../../../../assets/svg/official_account_batch_send.svg":sb,"../../../../assets/svg/official_custom_menu.svg":rb,"../../../../assets/svg/open-ai.svg":ib,"../../../../assets/svg/ordinary-segmentation.svg":ob,"../../../../assets/svg/out-the-box.svg":nb,"../../../../assets/svg/output.svg":tb,"../../../../assets/svg/paper-airplane-new.svg":eb,"../../../../assets/svg/paper-airplane.svg":Q1,"../../../../assets/svg/parameter-extraction-node.svg":Z1,"../../../../assets/svg/payment.svg":J1,"../../../../assets/svg/pc.svg":K1,"../../../../assets/svg/pdf-img.svg":Y1,"../../../../assets/svg/pdf-ocr.svg":W1,"../../../../assets/svg/pdf-text.svg":X1,"../../../../assets/svg/phone.svg":G1,"../../../../assets/svg/plugin-node-type.svg":q1,"../../../../assets/svg/plus.svg":z1,"../../../../assets/svg/point-h.svg":U1,"../../../../assets/svg/problem-optimization-node.svg":H1,"../../../../assets/svg/problem-optimization.svg":V1,"../../../../assets/svg/prompt-icon.svg":j1,"../../../../assets/svg/put-away.svg":F1,"../../../../assets/svg/qa-feedback.svg":I1,"../../../../assets/svg/question-node.svg":L1,"../../../../assets/svg/quick-Instruction.svg":B1,"../../../../assets/svg/quote-file.svg":R1,"../../../../assets/svg/quotes.svg":P1,"../../../../assets/svg/recommendation.svg":$1,"../../../../assets/svg/reply-content-image-text.svg":T1,"../../../../assets/svg/reply-content-image.svg":M1,"../../../../assets/svg/reply-content-link.svg":N1,"../../../../assets/svg/reply-content-smart.svg":O1,"../../../../assets/svg/reply-content-text.svg":A1,"../../../../assets/svg/reply-content.svg":D1,"../../../../assets/svg/reply-settings.svg":E1,"../../../../assets/svg/retail.svg":k1,"../../../../assets/svg/reward-points.svg":S1,"../../../../assets/svg/right-fork-icon.svg":C1,"../../../../assets/svg/robot_auto_reply.svg":w1,"../../../../assets/svg/robot_payment.svg":x1,"../../../../assets/svg/robot_smart_menu.svg":b1,"../../../../assets/svg/robot_subscribe_reply.svg":y1,"../../../../assets/svg/save-draft.svg":m1,"../../../../assets/svg/sdk.svg":_1,"../../../../assets/svg/search-check-icon.svg":g1,"../../../../assets/svg/search-right.svg":v1,"../../../../assets/svg/search-tip.svg":h1,"../../../../assets/svg/search.svg":p1,"../../../../assets/svg/segmentation-down.svg":f1,"../../../../assets/svg/segmentation-icon.svg":c1,"../../../../assets/svg/segmentation-up.svg":d1,"../../../../assets/svg/segmentation.svg":u1,"../../../../assets/svg/select-disabled.svg":l1,"../../../../assets/svg/semantic-segmentation.svg":a1,"../../../../assets/svg/sensitive-icon.svg":s1,"../../../../assets/svg/seo-gray.svg":r1,"../../../../assets/svg/seo-highlight.svg":i1,"../../../../assets/svg/seo-light.svg":o1,"../../../../assets/svg/session-record.svg":n1,"../../../../assets/svg/session-trigger-node.svg":t1,"../../../../assets/svg/session.svg":e1,"../../../../assets/svg/set-keywords.svg":Q0,"../../../../assets/svg/set_model.svg":Z0,"../../../../assets/svg/setting.svg":J0,"../../../../assets/svg/share.svg":K0,"../../../../assets/svg/similarity.svg":Y0,"../../../../assets/svg/skii.svg":W0,"../../../../assets/svg/smart-add.svg":X0,"../../../../assets/svg/smart-delete.svg":G0,"../../../../assets/svg/smart-menu.svg":q0,"../../../../assets/svg/source-energy.svg":z0,"../../../../assets/svg/specify-reply-node.svg":U0,"../../../../assets/svg/start-node.svg":H0,"../../../../assets/svg/statistical-analysis.svg":V0,"../../../../assets/svg/status-fail.svg":j0,"../../../../assets/svg/status-sending.svg":F0,"../../../../assets/svg/status-success.svg":I0,"../../../../assets/svg/steps-success-icon.svg":L0,"../../../../assets/svg/subscribe-reply.svg":B0,"../../../../assets/svg/success.svg":R0,"../../../../assets/svg/suggested-issues.svg":P0,"../../../../assets/svg/support.svg":$0,"../../../../assets/svg/switch-mobile.svg":T0,"../../../../assets/svg/system-setting.svg":M0,"../../../../assets/svg/table-expand.svg":N0,"../../../../assets/svg/table-hide.svg":O0,"../../../../assets/svg/team-manage-active.svg":A0,"../../../../assets/svg/team-manage.svg":D0,"../../../../assets/svg/team-manage2.svg":E0,"../../../../assets/svg/tengxunhunyuan.svg":k0,"../../../../assets/svg/test-active-menu-icon.svg":S0,"../../../../assets/svg/test-menu-icon.svg":C0,"../../../../assets/svg/test_robot.svg":w0,"../../../../assets/svg/think.svg":x0,"../../../../assets/svg/timing-trigger-node.svg":b0,"../../../../assets/svg/tip-icon.svg":y0,"../../../../assets/svg/tongyiqianwen.svg":m0,"../../../../assets/svg/unit.svg":_0,"../../../../assets/svg/unknown-issue.svg":g0,"../../../../assets/svg/unknown-prompt.svg":v0,"../../../../assets/svg/use-token-active.svg":h0,"../../../../assets/svg/use-token.svg":p0,"../../../../assets/svg/user-icon.svg":f0,"../../../../assets/svg/variable-assignment-node.svg":c0,"../../../../assets/svg/vector-icon.svg":d0,"../../../../assets/svg/voice-clone-node.svg":u0,"../../../../assets/svg/voice-synthesis-node.svg":l0,"../../../../assets/svg/webhook-trigger-node.svg":a0,"../../../../assets/svg/wenxinyiyan.svg":s0,"../../../../assets/svg/workflow-robot-icon.svg":r0,"../../../../assets/svg/workflow.svg":i0,"../../../../assets/svg/wx-app-icon.svg":o0,"../../../../assets/svg/xitongtishici.svg":n0,"../../../../assets/svg/xunfeixinghuo.svg":t0,"../../../../assets/svg/yuezhianmian.svg":e0,"../../../../assets/svg/zhipuai.svg":Qy,"../../../../assets/svg/zm-plugins-node.svg":Zy,"../../../../assets/svg/zm-workflow-node.svg":Jy})[`../../../../assets/svg/${v}.svg`],import.meta.url).href,u=Xe(()=>l(s.iconName)),c=X(s.title),f=()=>{a&&clearTimeout(a),a=setTimeout(()=>{t(c.value),r("changeTitle")},250)},p=()=>{o(),r("deleteNode")},h=()=>{i()};return(v,_)=>{const m=ln,g=Nn,b=Pr,C=$r,D=Rr;return w(),P("div",YS,[d("div",KS,[d("div",JS,[Oi(v.$slots,"node-icon",{},()=>[u.value?(w(),P("img",{key:0,class:"node-icon",src:u.value},null,8,ZS)):ie("",!0)],!0)]),d("div",QS,[y(m,{class:"node-name-input",value:c.value,"onUpdate:value":_[0]||(_[0]=T=>c.value=T),placeholder:"请输入节点名称",onChange:St(f,["stop"])},null,8,["value"])]),d("div",ek,[Oi(v.$slots,"runBtn",{},void 0,!0),n.hideMenus?ie("",!0):(w(),Z(D,{key:0},{overlay:x(()=>[y(C,{style:{width:"100px"}},{default:x(()=>[y(b,{onClick:_[2]||(_[2]=T=>p())},{default:x(()=>[..._[3]||(_[3]=[d("a",{href:"javascript:;"},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"action-btn delete-btn",onClick:_[1]||(_[1]=St(()=>{},["prevent"]))},[y(g,{name:"point-h",class:"btn-icon"})])]),_:1})),d("div",{class:"action-btn close-btn",onClick:h},[y(ee(cg),{class:"btn-icon",style:{"font-size":"12px"}})])])]),d("div",tk,[Oi(v.$slots,"desc",{},()=>[z(j(s.desc),1)],!0)])])}}},fn=$e(nk,[["__scopeId","data-v-83dd8b33"]]),ok="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",ik=Ts(),rk=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}],sk={emits:["close","update-node"],inject:["getGraph"],components:{NodeFormLayout:cn,NodeFormHeader:fn,QuestionCircleOutlined:yt,PlusOutlined:Ht},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1,typOptions:[...rk],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let n=JSON.parse(this.node.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list},methods:{update(){let n=JSON.parse(this.node.node_params);n.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(n)};this.$emit("update-node",e)},handleAddTrigger(){ik.getTriggerList(this.$route.query.robot_key,!0),this.getGraph().eventCenter.emit("custom:showTriggerLit")},getTriggerVariables(){let n={};return this.trigger_list.forEach(e=>{(e.outputs||[]).forEach(o=>{n[o.variable]={...o}})}),n},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(n,e){this.formState={...n},this.editIndex=e,this.show=!0},handleDel(n){this.getTriggerVariables();let e=this.getTriggerVariables(),t=this.diy_global[n];if(e["global."+t.key])return xt.error("该变量被触发器关联，请先解除关联");this.diy_global.splice(n,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},ak={class:"start-node-form"},lk={class:"add-trigger-box"},uk={class:"node-form-content"},dk={class:"start-node"},ck={class:"start-node-options"},fk={class:"options-title"},pk={class:"options-item-body"},hk={class:"option-label"},vk={class:"option-type"},gk={class:"item-actions-box"},_k={class:"action-items-box"};function mk(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("PlusOutlined"),l=Jt,u=Nt("QuestionCircleOutlined"),c=Qt,f=Nn,p=ln,h=kn,v=Vt,_=It,m=Ti,g=$i,b=wn,C=gn,D=Nt("NodeFormLayout");return w(),Z(D,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:x(()=>[...e[5]||(e[5]=[d("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",ak,[d("div",lk,[y(l,{type:"primary",ghost:"",onClick:St(r.handleAddTrigger,["stop"])},{icon:x(()=>[y(a)]),default:x(()=>[e[6]||(e[6]=d("span",null,"添加触发器",-1))]),_:1},8,["onClick"]),e[7]||(e[7]=d("div",{class:"add-trigger-desc"},"添加触发器后支持定时或者外部事件触发工作流",-1))]),d("div",uk,[d("div",dk,[d("div",ck,[d("div",fk,[e[9]||(e[9]=d("div",null,[d("img",{src:ok,alt:"",class:"title-icon"}),d("span",null,"自定义全局变量")],-1)),d("div",null,[y(c,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:x(()=>[...e[8]||(e[8]=[d("div",null,[z(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),d("br"),z(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),d("br"),z(" 2、通过api访问时，可以再API中传递参数值"),d("br"),z(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])]),default:x(()=>[y(u,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(w(!0),P(ae,null,ye(i.diy_global,(T,O)=>(w(),P("div",{class:Ct(["options-item diy-options-item",{"is-required":T.required}]),key:T.key},[d("div",pk,[d("div",hk,j(T.key),1),d("div",vk,j(T.typ),1)]),d("div",gk,[y(f,{class:"action-btn",name:"edit-02",onClick:k=>r.handleEdit(T,O)},null,8,["onClick"]),y(f,{class:"action-btn",name:"close-circle",onClick:k=>r.handleDel(O)},null,8,["onClick"])])],2))),128)),d("div",_k,[y(l,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:r.handleAdd},{icon:x(()=>[y(a)]),default:x(()=>[e[10]||(e[10]=z(" 添加全局变量 ",-1))]),_:1},8,["onClick"])])]),y(C,{open:i.show,"onUpdate:open":e[4]||(e[4]=T=>i.show=T),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:r.handleOk},{default:x(()=>[y(b,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:x(()=>[y(h,{label:"变量名",name:"key"},{default:x(()=>[y(p,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=T=>i.formState.key=T),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),y(h,{label:"类型",name:"typ"},{default:x(()=>[y(_,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=T=>i.formState.typ=T)},{default:x(()=>[(w(!0),P(ae,null,ye(i.typOptions,T=>(w(),Z(v,{value:T.value,key:T.value},{default:x(()=>[d("span",null,j(T.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),y(h,{label:"必填",name:"required"},{default:x(()=>[y(m,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=T=>i.formState.required=T)},null,8,["checked"])]),_:1}),y(h,{label:"描述",name:"desc"},{default:x(()=>[y(g,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=T=>i.formState.desc=T),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const yk=$e(sk,[["render",mk],["__scopeId","data-v-85b27f7a"]]),bk={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(n){n&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(n){const e=[],t=[],o=(i,r)=>{if(!i||i.length===0)return!1;for(let s=0;s<i.length;s++){const a=i[s],l=a[this.valueKey];if(l===n)return e[r]=a,t[r]=l,!0;if(a[this.childrenKey]&&a[this.childrenKey].length>0){if(e[r]=a,t[r]=l,o(a[this.childrenKey],r+1))return!0;e[r]=null,t[r]=null}}return!1};o(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(n){if(!n||n.length===0)return;const e=[];let t=this.options;for(let o=0;o<n.length;o++){const i=n[o],r=t.find(s=>s[this.valueKey]===i);if(r)e.push(r),t=r[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let n=0;n<this.selectedPath.length;n++){const e=this.selectedPath[n];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:n+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(n,e,t){this.hasChildren(n)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(n),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(n[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(n)&&this.activePath.push({title:n[this.labelKey],options:n[this.childrenKey],level:e+1}),this.$emit("select",n,this.selectedPath,e),(this.checkAnyLevel&&!this.isClickRight&&e>0||!this.hasChildren(n))&&(this.$emit("change",n[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:n[this.valueKey])),this.isClickRight=!1},isActive(n,e){return!this.selectedPath||this.selectedPath.length<=e?!1:n[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(n){return n[this.childrenKey]&&n[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const n=this.$el;if(!n)return;const e=n.getBoundingClientRect(),t=window.innerWidth,o=180;e.right+o>t&&e.left>o?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",o)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",o))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},xk={class:"cascade-panel"},wk={class:"cascade-panel-body"},Ck=["onClick"],Sk={class:"item-content"},kk={class:"item-label"},Ek={key:0,class:"cascade-panel-empty"};function Dk(n,e,t,o,i,r){return w(),P("div",xk,[d("div",{class:Ct(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(w(!0),P(ae,null,ye(i.activePath,(s,a)=>(w(),P("div",{class:"cascade-panel-list",key:a},[d("div",wk,[(w(!0),P(ae,null,ye(s.options,l=>(w(),P("div",{class:Ct(["cascade-panel-item",{active:r.isActive(l,a)}]),key:l.value,onClick:u=>r.handleSelect(l,a,u)},[d("div",Sk,[d("span",kk,j(l.label),1),r.hasChildren(l)?(w(),P("span",{key:0,class:"item-icon",onClick:e[0]||(e[0]=(...u)=>r.handleRightClick&&r.handleRightClick(...u))},[...e[1]||(e[1]=[d("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[d("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):ie("",!0)])],10,Ck))),128)),s.options&&s.options.length===0?(w(),P("div",Ek," 暂无数据 ")):ie("",!0)])]))),128))],2)])}const Dg=$e(bk,[["render",Dk],["__scopeId","data-v-fcafed74"]]),Ag=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...Ag(t.children)):e.push(t)}),e},Ak={name:"JMention",components:{CascadePanel:Dg},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(n){n.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(n){n.target.closest(".dropdown-list")&&n.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(n){this.$emit("open",n)},getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){const n=this.$refs.JMention;if(!n)return;let e=n.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t.trim(),i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=Ag(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize(),i=window.innerWidth,r=window.innerHeight;let s=t.bottom,a=t.left;return s+o.height>r&&(s=t.top-o.height),a+o.width>i&&(a=t.right-o.width),s<0&&(s=0),a<0&&(a=0),{top:s,left:a}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(n){this.handleDropdownLogic(n),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(n){const e=this.getLastChar();if(n.inputType==="deleteContentBackward"&&!this.atText)e!="/"&&(this.showDropdown=!1);else if(e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const r=this.checkStartWith(i);i&&(this.showDropdown=r)}if(!this.showDropdown)return;const{top:t,left:o}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${o}px; top:${t}px;`},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,u=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,u=c;break}c=c.previousSibling}}if(u.nodeType===Node.TEXT_NODE){u.replaceData(l,t,"");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const p in e)c.dataset[p]=e[p];const f=document.createRange();f.setStart(u,l),f.insertNode(c),r.setStartAfter(c),r.setEndAfter(c),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())},handleDirectionChange(n,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),o=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!o)return;const i=parseFloat(t[1]),r=parseFloat(o[1]);let s;n==="left"?s=i-e:s=i+e,this.positionStyle=`left:${s}px; top:${r}px;`}}},Ok={style:{width:"100%",position:"relative"}},Nk={class:"mention-input-warpper",ref:"JMentionContainer"},Mk=["placeholder"],Tk={key:0,class:"placeholder"};function $k(n,e,t,o,i,r){const s=Nt("CascadePanel");return w(),P("div",Ok,[e[4]||(e[4]=d("div",null,null,-1)),(w(),Z(ag,{to:"body"},[i.showDropdown?(w(),P("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:In(i.positionStyle)},[y(s,{options:i.showOptions,checkAnyLevel:t.checkAnyLevel,onChange:r.onSelectOption,onDirectionChange:r.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):ie("",!0)])),d("div",Nk,[d("div",{ref:"JMention",style:In([t.inputStyle]),class:Ct(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onFocus:e[0]||(e[0]=(...a)=>r.onFocus&&r.onFocus(...a)),onInput:e[1]||(e[1]=(...a)=>r.debouncedUpdate&&r.debouncedUpdate(...a)),onClick:e[2]||(e[2]=(...a)=>r.clickJMention&&r.clickJMention(...a)),onBlur:e[3]||(e[3]=(...a)=>r.handleBlur&&r.handleBlur(...a))},null,46,Mk),i.localValue.length==0?(w(),P("span",Tk,j(t.placeholder),1)):ie("",!0)],512)])}const ot=$e(Ak,[["render",$k],["__scopeId","data-v-af84a704"]]),Pk={class:"problem-optimization-form"},Rk={class:"gray-block"},Bk={class:"flex-block-item"},Lk={class:"number-box"},Ik={class:"number-slider-box"},Fk={class:"number-input-box"},jk={class:"number-box"},Vk={class:"number-slider-box"},Hk={class:"number-input-box"},Uk={class:"number-box"},zk={class:"number-box"},qk={class:"number-slider-box"},Gk={class:"number-input-box"},Xk={class:"field-list-item"},Wk={class:"field-label"},Yk={class:"field-type"},Kk={class:"diy-form-item"},Jk={class:"form-content"},Zk={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=jn(),r=X(null),s=Xe(()=>i.modelList),a=X([]),l=X([]),u=X(!1),c=()=>{u.value=!u.value},f=($,B)=>{g.prompt=$,g.prompt_tags=B};function p(){const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();l.value=h(B)}}function h($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=h(B.children))}),$}const v=()=>{const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();a.value=B}};function _($){if($){let B=$.split("."),E=B[0],A=B.filter((M,F)=>F>0).join(".");return[E,A]}return["global","question"]}const m=X(),g=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),b=()=>{const $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.stringify({question_optimize:JSON.parse($).question_optimize||{}}),E=JSON.stringify({question_optimize:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});B!=E&&t("update-node",{...o.node,...g,node_params:E})},C=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).question_optimize||{};B=JSON.parse(JSON.stringify(B));let{model_config_id:E,use_model:A,context_pair:M,temperature:F,max_token:H,prompt:R,prompt_tags:G,question_value:oe,enable_thinking:V}=B;v(),p(),g.model_config_id=E,g.use_model=A,g.context_pair=M||0,g.temperature=F,g.max_token=H,g.prompt=R,g.enable_thinking=V,g.prompt_tags=G||[],g.question_value=_(oe),!g.model_config_id&&s.value.length>0&&(g.model_config_id=s.value[0].id,g.use_model=s.value[0].children[0].name)}catch($){}};gt(()=>g,()=>{b()},{deep:!0});const D=X(null),T=$=>{g.prompt="",$.prompt_type==1?g.prompt=$.markdown:g.prompt=$.prompt,Pt(()=>{r.value.initData()})},O=$=>{$||p()},k=X({}),S=($,B)=>{k.value=B},N=Xe(()=>{if(!g.model_config_id)return!1;let $=g.model_config_id+"#"+g.use_model;return k.value[$]}),L=()=>{t("close")};return ut(()=>{C()}),($,B)=>{const E=Jt,A=kn,M=Qt,F=Os,H=Vn,R=$n,G=Ti,oe=ei,V=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",Pk,[d("div",{class:"node-form-content",onMousedown:B[11]||(B[11]=St(()=>{},["stop"]))},[y(V,{ref_key:"formRef",ref:m,layout:"vertical",model:g},{default:x(()=>[d("div",Rk,[B[24]||(B[24]=d("div",{class:"gray-block-title"},"输入",-1)),y(A,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",Bk,[y(nr,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":B[0]||(B[0]=Y=>g.use_model=Y),modeId:g.model_config_id,"onUpdate:modeId":B[1]||(B[1]=Y=>g.model_config_id=Y),onLoaded:S,style:{width:"348px"}},null,8,["modeName","modeId"]),y(E,{onClick:c},{default:x(()=>[B[12]||(B[12]=z("高级设置 ",-1)),u.value?(w(),Z(ee($o),{key:0})):(w(),Z(ee(Va),{key:1}))]),_:1})])]),_:1}),u.value?(w(),Z(A,{key:0,name:"temperature"},{label:x(()=>[B[14]||(B[14]=d("span",null,"温度 ",-1)),y(M,null,{title:x(()=>[...B[13]||(B[13]=[z("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Lk,[d("div",Ik,[y(H,null,{default:x(()=>[y(F,{class:"custom-slider",value:g.temperature,"onUpdate:value":B[2]||(B[2]=Y=>g.temperature=Y),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",Fk,[y(R,{value:g.temperature,"onUpdate:value":B[3]||(B[3]=Y=>g.temperature=Y),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),u.value?(w(),Z(A,{key:1,name:"max_token"},{label:x(()=>[B[16]||(B[16]=d("span",null,"最大token ",-1)),y(M,null,{title:x(()=>[...B[15]||(B[15]=[z("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",jk,[d("div",Vk,[y(H,null,{default:x(()=>[y(F,{class:"custom-slider",value:g.max_token,"onUpdate:value":B[4]||(B[4]=Y=>g.max_token=Y),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",Hk,[y(R,{value:g.max_token,"onUpdate:value":B[5]||(B[5]=Y=>g.max_token=Y),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),u.value&&N.value?(w(),Z(A,{key:2,name:"enable_thinking"},{label:x(()=>[B[18]||(B[18]=d("span",null,"深度思考 ",-1)),y(M,null,{title:x(()=>[...B[17]||(B[17]=[z("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Uk,[y(G,{checked:g.enable_thinking,"onUpdate:checked":B[6]||(B[6]=Y=>g.enable_thinking=Y)},null,8,["checked"])])]),_:1})):ie("",!0),y(A,{name:"context_pair"},{label:x(()=>[B[20]||(B[20]=d("span",null,"上下文数量 ",-1)),y(M,null,{title:x(()=>[...B[19]||(B[19]=[z("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",zk,[d("div",qk,[y(H,null,{default:x(()=>[y(F,{class:"custom-slider",value:g.context_pair,"onUpdate:value":B[7]||(B[7]=Y=>g.context_pair=Y),min:0,max:50},null,8,["value"])]),_:1})]),d("div",Gk,[y(R,{value:g.context_pair,"onUpdate:value":B[8]||(B[8]=Y=>g.context_pair=Y),min:0,max:50},null,8,["value"])])])]),_:1}),y(A,{name:"prompt",class:"width-100"},{label:x(()=>[...B[21]||(B[21]=[d("div",{class:"space-between-box"},[d("div",null,"对话背景")],-1)])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:r,onOpen:v,onChange:B[9]||(B[9]=(Y,Q)=>f(Y,Q)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:x(({label:Y,payload:Q})=>[d("div",Xk,[d("div",Wk,j(Y),1),d("div",Yk,j(Q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),B[22]||(B[22]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",Kk,[B[23]||(B[23]=d("div",{class:"form-label"},"用户问题",-1)),d("div",Jk,[y(oe,{value:g.question_value,"onUpdate:value":B[10]||(B[10]=Y=>g.question_value=Y),onDropdownVisibleChange:O,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:Y})=>Y.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),B[25]||(B[25]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"问题优化结果"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),y(_g,{onOk:T,ref_key:"importPromptRef",ref:D},null,512)],32)])]),_:1})}}},Qk=$e(Zk,[["__scopeId","data-v-2f37db05"]]),eE={class:"input-box"},tE={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(n,{expose:e,emit:t}){const o=X(!1),i=t;gt(()=>o.value,f=>{f||i("ok")});const r=n,s=X(null),a=()=>{o.value=!0,Pt(()=>{s.value.refresh()})},l=f=>{i("open",f)},u=(f,p)=>{i("change",f,p)},c=()=>{o.value=!1};return e({show:a}),(f,p)=>{const h=Jt,v=gn;return w(),P("div",null,[y(v,{open:o.value,"onUpdate:open":p[1]||(p[1]=_=>o.value=_),title:"字段详情",width:746},{footer:x(()=>[y(h,{type:"primary",onClick:c},{default:x(()=>[...p[2]||(p[2]=[z("确定",-1)])]),_:1})]),default:x(()=>[d("div",eE,[y(ot,{inputStyle:"height: 550px;",options:r.options,defaultSelectedList:r.defaultSelectedList,defaultValue:r.defaultValue,placeholder:r.placeholder,type:r.type,ref_key:"atInputRef",ref:s,onOpen:l,onChange:p[0]||(p[0]=(_,m)=>u(_,m))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},za=$e(tE,[["__scopeId","data-v-1f67dd47"]]),nE={class:"problem-optimization-form"},oE={class:"gray-block"},iE={class:"flex-block-item"},rE={class:"number-box"},sE={class:"number-slider-box"},aE={class:"number-input-box"},lE={class:"number-box"},uE={class:"number-slider-box"},dE={class:"number-input-box"},cE={class:"number-box"},fE={class:"number-box"},pE={class:"number-slider-box"},hE={class:"number-input-box"},vE={class:"space-between-box"},gE={class:"field-list-item"},_E={class:"field-label"},mE={class:"field-type"},yE={class:"diy-form-item mt12"},bE={class:"form-content"},xE={class:"gray-block mt16"},wE={class:"diy-form-item question-value-item"},CE={class:"form-content"},SE={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=jn(),s=X(null),a=Xe(()=>r.modelList),l=X([]),u=X([]),c=X(!1),f=X(),p=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),h=()=>{c.value=!c.value},v=(H,R)=>{p.prompt=H,p.prompt_tags=R};function _(){let H=i().getAllParentVariable();u.value=g(H)}const m=Xe(()=>u.value.filter(R=>R.node_type==5));function g(H){return H.forEach(R=>{R.typ=="node"?R.node_type==1?R.value="global":R.value=R.node_id:R.value=R.key,R.children&&R.children.length>0&&(R.children=g(R.children))}),H}const b=()=>{let H=i().getAllParentVariable();l.value=H};function C(H){if(H){let R=H.split("."),G=R[0],oe=R.filter((V,Y)=>Y>0).join(".");return[G,oe]}return["global","question"]}const D=X(null),T=()=>{D.value.show()},O=H=>{p.prompt="",H.prompt_type==1?p.prompt=H.markdown:p.prompt=H.prompt,Pt(()=>{s.value.initData()})},k=X(null),S=()=>{k.value.show()},N=()=>{s.value.refresh()},L=()=>{const H=JSON.stringify({llm:{...p,question_value:p.question_value.join("."),model_config_id:p.model_config_id?+p.model_config_id:p.model_config_id}});t("update-node",{...o.node,...p,node_params:H})},$=()=>{try{let H=o.node.dataRaw||o.node.node_params||"{}",R=JSON.parse(H).llm||{};R=JSON.parse(JSON.stringify(R));let{model_config_id:G,use_model:oe,context_pair:V,temperature:Y,max_token:Q,prompt:ue,prompt_tags:te,question_value:q,enable_thinking:re,libs_node_key:ce}=R;b(),_(),p.model_config_id=G,p.use_model=oe,p.context_pair=V||0,p.temperature=Y,p.max_token=Q,p.prompt=ue,p.enable_thinking=re,p.prompt_tags=te||[],p.libs_node_key=ce,p.question_value=C(q),!p.model_config_id&&a.value.length>0&&(p.model_config_id=a.value[0].id,p.use_model=a.value[0].children[0].name)}catch(H){}};gt(()=>p,()=>{L()},{deep:!0});const B=H=>{H||_()},E=X({}),A=(H,R)=>{E.value=R},M=Xe(()=>{if(!p.model_config_id)return!1;let H=p.model_config_id+"#"+p.use_model;return E.value[H]}),F=()=>{t("close")};return ut(()=>{$()}),(H,R)=>{const G=Jt,oe=kn,V=Qt,Y=Os,Q=Vn,ue=$n,te=Ti,q=ti,re=Vt,ce=It,ve=ei,Ne=wn,ge=_g;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:F},null,8,["title","iconName"])]),default:x(()=>[d("div",nE,[d("div",{class:"node-form-content",onMousedown:R[12]||(R[12]=St(()=>{},["stop"]))},[y(Ne,{ref_key:"formRef",ref:f,layout:"vertical",model:p},{default:x(()=>[d("div",oE,[R[27]||(R[27]=d("div",{class:"gray-block-title"},"大模型设置",-1)),y(oe,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",iE,[y(nr,{modelType:"LLM",modeName:p.use_model,"onUpdate:modeName":R[0]||(R[0]=_e=>p.use_model=_e),modeId:p.model_config_id,"onUpdate:modeId":R[1]||(R[1]=_e=>p.model_config_id=_e),onLoaded:A,style:{width:"348px"}},null,8,["modeName","modeId"]),y(G,{onClick:h},{default:x(()=>[R[14]||(R[14]=z("高级设置 ",-1)),c.value?(w(),Z(ee($o),{key:0})):(w(),Z(ee(Va),{key:1}))]),_:1})])]),_:1}),c.value?(w(),Z(oe,{key:0,name:"temperature"},{label:x(()=>[R[16]||(R[16]=d("span",null,"温度 ",-1)),y(V,null,{title:x(()=>[...R[15]||(R[15]=[z("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",rE,[d("div",sE,[y(Q,null,{default:x(()=>[y(Y,{class:"custom-slider",value:p.temperature,"onUpdate:value":R[2]||(R[2]=_e=>p.temperature=_e),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",aE,[y(ue,{value:p.temperature,"onUpdate:value":R[3]||(R[3]=_e=>p.temperature=_e),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),c.value?(w(),Z(oe,{key:1,name:"max_token"},{label:x(()=>[R[18]||(R[18]=d("span",null,"最大token ",-1)),y(V,null,{title:x(()=>[...R[17]||(R[17]=[z("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",lE,[d("div",uE,[y(Q,null,{default:x(()=>[y(Y,{class:"custom-slider",value:p.max_token,"onUpdate:value":R[4]||(R[4]=_e=>p.max_token=_e),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",dE,[y(ue,{value:p.max_token,"onUpdate:value":R[5]||(R[5]=_e=>p.max_token=_e),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),c.value&&M.value?(w(),Z(oe,{key:2,name:"enable_thinking"},{label:x(()=>[R[20]||(R[20]=d("span",null,"深度思考 ",-1)),y(V,null,{title:x(()=>[...R[19]||(R[19]=[z("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",cE,[y(te,{checked:p.enable_thinking,"onUpdate:checked":R[6]||(R[6]=_e=>p.enable_thinking=_e)},null,8,["checked"])])]),_:1})):ie("",!0),y(oe,{name:"context_pair"},{label:x(()=>[R[22]||(R[22]=d("span",null,"上下文数量 ",-1)),y(V,null,{title:x(()=>[...R[21]||(R[21]=[z("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",fE,[d("div",pE,[y(Q,null,{default:x(()=>[y(Y,{class:"custom-slider",value:p.context_pair,"onUpdate:value":R[7]||(R[7]=_e=>p.context_pair=_e),min:0,max:50},null,8,["value"])]),_:1})]),d("div",hE,[y(ue,{value:p.context_pair,"onUpdate:value":R[8]||(R[8]=_e=>p.context_pair=_e),min:0,max:50},null,8,["value"])])])]),_:1}),y(oe,{name:"prompt",class:"width-100"},{label:x(()=>[d("div",vE,[R[24]||(R[24]=d("div",null,"提示词",-1)),y(q,{gap:8},{default:x(()=>[d("div",{class:"btn-hover-wrap",onClick:T},[y(ee(gy)),R[23]||(R[23]=z("从提示词库导入 ",-1))]),d("div",{class:"btn-hover-wrap",onClick:S},[y(ee(Br))])]),_:1})])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,ref_key:"atInputRef",ref:s,onOpen:b,onChange:R[9]||(R[9]=(_e,st)=>v(_e,st)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:_e,payload:st})=>[d("div",gE,[d("div",_E,j(_e),1),d("div",mE,j(st.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),R[25]||(R[25]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",yE,[R[26]||(R[26]=d("div",{class:"form-label"},"知识库引用",-1)),d("div",bE,[y(ce,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:B,value:p.libs_node_key,"onUpdate:value":R[10]||(R[10]=_e=>p.libs_node_key=_e),style:{width:"220px"}},{default:x(()=>[(w(!0),P(ae,null,ye(m.value,_e=>(w(),Z(re,{value:_e.node_id,key:_e.node_id},{default:x(()=>[z(j(_e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),d("div",xE,[R[29]||(R[29]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",wE,[R[28]||(R[28]=d("div",{class:"form-label"},"输入",-1)),d("div",CE,[y(ve,{value:p.question_value,"onUpdate:value":R[11]||(R[11]=_e=>p.question_value=_e),onDropdownVisibleChange:B,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),R[30]||(R[30]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"AI回复内容"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"])],32),y(ge,{onOk:O,ref_key:"importPromptRef",ref:D},null,512),y(za,{options:l.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:b,onChange:R[13]||(R[13]=(_e,st)=>v(_e,st)),onOk:N,ref_key:"fullAtInputRef",ref:k},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},kE=$e(SE,[["__scopeId","data-v-9b5efbf1"]]),Zn="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",or=sg("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(n=>{this.formListQueue.push(n)});this.formListLoading=!0;try{const n=await cw();this.formList=n.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(n){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:n}){if(this.formFieldListMap[n]&&this.formFieldListMap[n].length>0)return[...this.formFieldListMap[n]];if(this.formFieldListLoadingMap[n])return new Promise(e=>{this.formFieldListQueueMap[n]||(this.formFieldListQueueMap[n]=[]),this.formFieldListQueueMap[n].push(e)});this.formFieldListLoadingMap[n]=!0;try{const e=await dw({form_id:n});this.formFieldListMap[n]=e.data||[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}catch(e){this.formFieldListMap[n]=[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}finally{this.formFieldListLoadingMap[n]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:n}){return this.formFieldListMap[n]=[],this.formFieldListLoadingMap[n]=!1,this.formFieldListQueueMap[n]=[],await this.getFormFieldList({form_id:n})}}}),EE={class:"field-select-box"},DE={key:0,class:"field-list-box"},AE={key:1,class:"empty-box"},OE={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=or(),r=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),s=X([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),a=X([]),l=(v,_)=>{r.selectedRowKeys=v,r.selectedRows=_},u=({formId:v,selectedRowKeys:_,selectedRows:m})=>{r.formId=v,r.selectedRowKeys=_,r.selectedRows=m,h(),r.show=!0},c=()=>{window.open("/#/database/details/field-manage?form_id="+r.formId)},f=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1},p=X(!1),h=()=>{p.value=!0,i.getFormFieldList({form_id:r.formId}).then(v=>{p.value=!1,v.forEach(_=>{_.value="",_.id=_.id*1}),a.value=v}).catch(()=>{p.value=!1})};return e({open:u}),(v,_)=>{const m=Ns,g=gn;return w(),Z(g,{width:"746px",open:r.show,"onUpdate:open":_[0]||(_[0]=b=>r.show=b),title:"关联数据表",onOk:f,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",EE,[a.value.length?(w(),P("div",DE,[y(m,{rowKey:"name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:l},dataSource:a.value,columns:s.value,loading:p.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ie("",!0),a.value.length?ie("",!0):(w(),P("div",AE,[_[2]||(_[2]=d("img",{src:Ua,alt:""},null,-1)),d("div",null,[_[1]||(_[1]=z(" 暂无字段, 请先去数据表添加 ",-1)),d("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},NE=$e(OE,[["__scopeId","data-v-0e3939aa"]]),ME={class:"field-list"},TE={class:"field-list-row"},$E={key:0,class:"field-list-col field-list-col-head field-value-head"},PE={key:1,class:"field-list-col field-list-col-head field-del-head"},RE={key:0,class:"field-list-row"},BE={class:"field-list-col field-value-col"},LE={class:"field-list-col field-name-col"},IE={class:"field-list-col field-type-col"},FE={key:0,class:"field-list-col field-value-col"},jE={key:1,class:"field-list-col field-del-col"},VE=["onClick"],HE={key:0,class:"add-btn-box"},UE={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:o.list});gt(()=>o.list,_=>{r.list=_});const s=X([]),a=()=>{let _=i().getAllParentVariable();s.value=_||[]},l=()=>{a()},u=(_,m,g,b)=>{r.list[b].value=_,r.list[b].atTags=m,p()},c=(_,m)=>{r.list=[...m],p()},f=_=>{r.list.splice(_,1),p()},p=()=>{t("change",[...r.list])},h=X(),v=()=>{h.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(_=>_.name)})};return ut(()=>{a()}),(_,m)=>{const g=ln,b=Qt,C=Nn,D=Jt;return w(),P("div",null,[d("div",ME,[d("div",TE,[m[0]||(m[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),m[1]||(m[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),P("div",$E,"字段值")):ie("",!0),o.showDelete?(w(),P("div",PE)):ie("",!0)]),n.showEmptyFieldRow?(w(),P("div",RE,[m[2]||(m[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),m[3]||(m[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",BE,[y(b,{title:"请先选择数据库"},{default:x(()=>[y(g,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),P(ae,null,ye(r.list,(T,O)=>(w(),P("div",{class:"field-list-row",key:T.name},[d("div",LE,j(T.name),1),d("div",IE,j(T.type),1),n.showInput?(w(),P("div",FE,[y(ot,{options:s.value,defaultValue:T.value,defaultSelectedList:T.atTags,onOpen:l,onChange:(k,S)=>u(k,S,T,O),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):ie("",!0),o.showDelete?(w(),P("div",jE,[d("span",{class:"del-btn",onClick:k=>f(O)},[y(C,{class:"del-icon",name:"close-circle"})],8,VE)])):ie("",!0)]))),128))]),o.showAdd?(w(),P("div",HE,[y(D,{class:"add-btn",type:"dashed",block:"",onClick:v},{default:x(()=>[y(ee(Ht)),m[4]||(m[4]=z(" 添加更新字段",-1))]),_:1})])):ie("",!0),y(NE,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:h,onOk:c},null,8,["formId"])])}}},tf=$e(UE,[["__scopeId","data-v-7a244ed7"]]),zE={class:"library-checkbox-box"},qE={class:"list-box",ref:"scrollContainer"},GE={class:"library-name"},XE={class:"library-desc"},WE={key:1,class:"empty-box"},YE={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(),s=X(!1),a=f=>{r.value=f,s.value=!0},l=()=>{s.value=!1,u()},u=()=>{let f=i.options.filter(p=>p.id===r.value);o("ok",r.value,JSON.parse(JSON.stringify(f[0])))},c=()=>{window.open("/#/database/list")};return e({open:a}),(f,p)=>{const h=Ri,v=Pi,_=gn;return w(),Z(_,{width:"746px",open:s.value,"onUpdate:open":p[1]||(p[1]=m=>s.value=m),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:l},{default:x(()=>[d("div",zE,[n.options.length?(w(),Z(v,{key:0,value:r.value,"onUpdate:value":p[0]||(p[0]=m=>r.value=m),style:{width:"100%"}},{default:x(()=>[d("div",qE,[(w(!0),P(ae,null,ye(i.options,m=>(w(),P("div",{class:"list-item-wraapper",key:m.id},[y(h,{class:"list-item",value:m.id},{default:x(()=>[d("div",GE,j(m.name),1),d("div",XE,j(m.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):ie("",!0),n.options.length?ie("",!0):(w(),P("div",WE,[p[3]||(p[3]=d("img",{src:Ua,alt:""},null,-1)),d("div",null,[p[2]||(p[2]=z(" 暂无数据表, 请先去添加数据表 ",-1)),d("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},KE=$e(YE,[["__scopeId","data-v-ee44bfef"]]),JE={class:""},ZE={key:0,class:"data-table-info"},QE={class:"data-table-name"},e3={class:"data-table-desc"},t3={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:e}){const t=e,o=n,i=X(null),r=Xe(()=>{let u=o.options.filter(c=>c.id===o.value);return u.length?u[0]:null}),s=()=>{i.value.open()},a=(u,c)=>{t("update:value",u),t("change",u,c)},l=()=>{t("update:value",""),t("change","")};return(u,c)=>{const f=Nn,p=Jt;return w(),P("div",JE,[o.value?(w(),P("div",ZE,[d("div",QE,j(r.value?r.value.name:o.title),1),d("div",e3,j(r.value?r.value.description:o.description),1),y(f,{class:"del-btn",name:"close-circle",onClick:l})])):(w(),Z(p,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:s},{default:x(()=>[y(ee(Ht)),c[0]||(c[0]=z(" 选择数据表",-1))]),_:1})),y(KE,{ref_key:"tableSelectAlertRef",ref:i,onOk:a,options:n.options},null,8,["options"])])}}},Fu=$e(t3,[["__scopeId","data-v-550ecdef"]]),n3={class:"add-data-form"},o3={class:"node-box-content"},i3={class:"setting-box"},r3={class:"setting-box"},s3={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=or();let r={};const s=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),a=(h,v)=>{v?(s.formData.form_name=v.name,s.formData.form_description=v.description,p(v.id)):(s.formData.form_name="",s.formData.form_description="",s.formData.datas=[]),c()},l=h=>{s.formData.datas=h,c()},u=()=>{let h=o.node.dataRaw||o.node.node_params||"{}";r=JSON.parse(h),s.formData=r.form_insert,c()},c=()=>{r.form_insert=Bn(s.formData),t("update-node",{...o.node,node_params:JSON.stringify(r)})},f=async()=>{const h=await i.getFormList();s.tableList=h},p=async h=>{i.getFormFieldList({form_id:h}).then(v=>{v.forEach(_=>{_.id=_.id*1}),s.formData.datas=v,c()}).catch(()=>{})};return ut(()=>{f(),u()}),(h,v)=>(w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...v[1]||(v[1]=[d("span",null,[z("在指定数据表中插入数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",n3,[d("div",o3,[v[2]||(v[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),v[3]||(v[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",i3,[y(Fu,{options:s.tableList,title:s.formData.form_name,description:s.formData.form_description,value:s.formData.form_id,"onUpdate:value":v[0]||(v[0]=_=>s.formData.form_id=_),onChange:a},null,8,["options","title","description","value"])]),v[4]||(v[4]=d("div",{class:"setting-label"},[d("span",null,"插入数据"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",r3,[y(tf,{"form-id":s.formData.form_id,showEmptyFieldRow:s.formData.form_id=="",list:s.formData.datas,showAdd:!1,showDelete:!1,onChange:l},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},a3=$e(s3,[["__scopeId","data-v-b11302f4"]]),l3={class:"library-checkbox-box"},u3={class:"list-group-box"},d3={class:"group-list-box"},c3={style:{"margin-bottom":"16px"}},f3={class:"classify-box"},p3=["onClick"],h3={class:"classify-title"},v3={class:"right-content"},g3={class:"list-item-box"},_3={class:"alert-box"},m3={class:"btn-box"},y3=["onClick"],b3={class:"avatar-box"},x3=["src"],w3={class:"info-content-box"},C3={class:"title-info-block"},S3={key:0,class:"type-tag"},k3={key:1,class:"type-tag"},E3={key:2,class:"type-tag"},D3={key:3,class:"type-tag"},A3={class:"desc-info-block"},O3={class:"check-block"},N3={class:"footer-box"},M3={__name:"library-select-alert",props:{showWxType:{type:Boolean,default:!1},select_type:{type:String,default:"checkbox"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=jn(),{robotInfo:i}=o,r=t,s=n,a=Je({indeterminate:!1,checkAll:!1,checkedList:[]}),l=X(""),u=X([]),c=()=>{Wm().then(N=>{let L=N.data||[],$=0;L.forEach(B=>{$+=+B.total}),u.value=[{group_name:"全部",total:$,id:""},...L]})},f=N=>{l.value=N.id,D()},p=X(!1),h=N=>{l.value="",D(),c(),a.checkedList=N,p.value=!0},v=()=>{p.value=!1,C()},_=X(""),m=()=>{D()},g=X([]),b=Xe(()=>s.showWxType?g.value:g.value.filter(N=>N.type!=3)),C=()=>{r("change",[...a.checkedList])},D=async()=>{O.value=!0;const N=await Fa({library_name:_.value,type:"",show_open_docs:1});if(O.value=!1,N){let L=N.data||[];l.value!=""&&(L=L.filter($=>$.group_id==l.value)),g.value=L}},T=N=>{let L=N.id;a.checkedList.includes(L)?a.checkedList=a.checkedList.filter($=>$!=L):s.select_type=="radio"&&a.checkedList.length>0?a.checkedList=[L]:a.checkedList.push(L)},O=X(!1),k=async()=>{O.value=!0,await D(),O.value=!1,xt.success("刷新完成")},S=()=>{window.open("/#/library/list")};return e({open:h}),(N,L)=>{const $=ln,B=fw,E=Lr,A=Jt,M=pg,F=mo,H=gn;return w(),Z(H,{width:916,open:p.value,"onUpdate:open":L[2]||(L[2]=R=>p.value=R),wrapClassName:"correlation-library-modal",title:null,footer:null},{default:x(()=>[d("div",l3,[d("div",u3,[d("div",d3,[L[3]||(L[3]=d("div",{class:"main-title-block"},"关联知识库",-1)),d("div",c3,[y($,{style:{width:"216px"},value:_.value,"onUpdate:value":L[0]||(L[0]=R=>_.value=R),placeholder:"请输入知识库名称搜索",onChange:m},{suffix:x(()=>[y(ee(fg),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),y(B,{style:{"padding-right":"16px",height:"480px"}},{default:x(()=>[d("div",f3,[(w(!0),P(ae,null,ye(u.value,R=>(w(),P("div",{class:Ct(["classify-item",{active:R.id==l.value}]),onClick:G=>f(R),key:R.id},[d("div",h3,j(R.group_name),1),d("div",v3,[d("div",{class:Ct(["num",{"num-block":R.id<=0}])},j(R.total),3)])],10,p3))),128))])]),_:1})]),d("div",g3,[d("div",_3,[y(E,{class:"zm-alert-info",message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"})]),d("div",m3,[y(A,{onClick:k},{default:x(()=>[y(ee(_y)),L[4]||(L[4]=z(" 刷新 ",-1))]),_:1}),y(A,{type:"primary",ghost:"",onClick:S},{default:x(()=>[...L[5]||(L[5]=[z("新建知识库",-1)])]),_:1})]),y(F,{spinning:O.value,delay:100},{default:x(()=>[y(B,{style:{padding:"0 16px",height:"414px"}},{default:x(()=>[(w(!0),P(ae,null,ye(b.value,R=>(w(),P("div",{class:"library-list-item",onClick:G=>T(R),key:R.id},[d("div",b3,[d("img",{src:R.avatar,alt:""},null,8,x3)]),d("div",w3,[d("div",C3,[z(j(R.library_name)+" ",1),d("span",{class:Ct(["type-tag",{"gray-tag":R.graph_switch==0}])},"Graph",2),R.type==0?(w(),P("span",S3,"普通知识库")):ie("",!0),R.type==1?(w(),P("span",k3,"对外知识库")):ie("",!0),R.type==2?(w(),P("span",E3,"问答知识库")):ie("",!0),R.type==3?(w(),P("span",D3,"公众号知识库")):ie("",!0)]),d("div",A3,j(R.library_intro),1)]),d("div",O3,[y(M,{checked:a.checkedList.includes(R.id)},null,8,["checked"])])],8,y3))),128))]),_:1})]),_:1},8,["spinning"]),d("div",N3,[y(A,{onClick:L[1]||(L[1]=R=>p.value=!1)},{default:x(()=>[...L[6]||(L[6]=[z("取消",-1)])]),_:1}),y(A,{type:"primary",onClick:v},{default:x(()=>[z(" ("+j(a.checkedList.length)+") 确定",1)]),_:1})])])])])]),_:1},8,["open"])}}},Og=$e(M3,[["__scopeId","data-v-bf8208a4"]]),T3={class:"recall-settings-box"},$3={class:"form-box"},P3={class:"form-item is-required"},R3={class:"form-item-body"},B3={class:"retrieval-mode-items"},L3=["onClick"],I3={class:"retrieval-mode-title"},F3={class:"title-text"},j3={class:"retrieval-mode-desc"},V3={key:0,class:"form-item"},H3={class:"form-item"},U3={class:"form-item-label"},z3={class:"form-item-body"},q3={class:"number-box"},G3={class:"number-slider-box"},X3={class:"number-input-box"},W3={class:"form-item"},Y3={class:"form-item-label"},K3={class:"form-item-body"},J3={class:"number-box"},Z3={class:"number-slider-box"},Q3={class:"number-input-box"},eD={class:"form-item"},tD={class:"form-item-label"},nD={class:"form-item-body"},oD={__name:"recall-settings-alert",emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=X([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),r=Je({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,rrf_weight:{}}),s=X(!1),a=p=>{r.rerank_status=p.rerank_status||0,r.rerank_use_model=p.rerank_use_model||void 0,r.rerank_model_config_id=p.rerank_model_config_id||"",r.top_k=p.top_k,r.similarity=p.similarity,r.search_type=p.search_type,r.rrf_weight=p.rrf_weight,s.value=!0},l=p=>{r.search_type=p},u=()=>r.rerank_status==1&&!r.rerank_model_config_id,c=()=>{if(u())return xt.error("请选择Rerank模型");s.value=!1,f()},f=()=>{o("change",Bn(r))};return e({open:a}),(p,h)=>{const v=Nn,_=Qt,m=Os,g=$n,b=Ti,C=gn;return w(),Z(C,{width:"472px",open:s.value,"onUpdate:open":h[8]||(h[8]=D=>s.value=D),title:"召回设置",onOk:c,okText:"确定",cancelText:"取消"},{default:x(()=>[d("div",T3,[d("div",$3,[d("div",P3,[h[9]||(h[9]=d("div",{class:"form-item-label"},[d("span",null,"检索模式")],-1)),d("div",R3,[d("div",B3,[(w(!0),P(ae,null,ye(i.value,D=>(w(),P("div",{class:Ct(["retrieval-mode-item",{active:r.search_type==D.value}]),key:D.value,onClick:T=>l(D.value)},[r.search_type==D.value?(w(),Z(v,{key:0,class:"check-arrow",name:"check-arrow-filled"})):ie("",!0),d("div",I3,[y(v,{name:D.iconName,class:"title-icon"},null,8,["name"]),d("span",F3,j(D.title),1),D.isRecommendation?(w(),Z(v,{key:0,class:"recommendation-icon",name:"recommendation"})):ie("",!0)]),d("div",j3,j(D.desc),1)],10,L3))),128))])])]),r.search_type==1?(w(),P("div",V3,[y(pw,{rrf_weight:r.rrf_weight,"onUpdate:rrf_weight":h[0]||(h[0]=D=>r.rrf_weight=D)},null,8,["rrf_weight"])])):ie("",!0),d("div",H3,[d("div",U3,[h[11]||(h[11]=d("span",null,"Top K ",-1)),y(_,null,{title:x(()=>[...h[10]||(h[10]=[z("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),d("div",z3,[d("div",q3,[d("div",G3,[y(m,{class:"custom-slider",value:r.top_k,"onUpdate:value":h[1]||(h[1]=D=>r.top_k=D),min:1,max:500},null,8,["value"])]),d("div",X3,[y(g,{value:r.top_k,"onUpdate:value":h[2]||(h[2]=D=>r.top_k=D),min:1,max:500},null,8,["value"])])])])]),d("div",W3,[d("div",Y3,[h[13]||(h[13]=d("span",null,"相似度阈值 ",-1)),y(_,null,{title:x(()=>[...h[12]||(h[12]=[z("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),d("div",K3,[d("div",J3,[d("div",Z3,[y(m,{class:"custom-slider",value:r.similarity,"onUpdate:value":h[3]||(h[3]=D=>r.similarity=D),min:0,max:1,step:.01},null,8,["value"])]),d("div",Q3,[y(g,{value:r.similarity,"onUpdate:value":h[4]||(h[4]=D=>r.similarity=D),min:0,max:1,step:.01},null,8,["value"])])])])]),d("div",eD,[d("div",tD,[h[14]||(h[14]=d("span",null,"Rerank模型",-1)),h[15]||(h[15]=z("   ",-1)),y(b,{checkedValue:1,unCheckedValue:0,checked:r.rerank_status,"onUpdate:checked":h[5]||(h[5]=D=>r.rerank_status=D)},null,8,["checked"])]),d("div",nD,[y(nr,{modelType:"RERANK",modeName:r.rerank_use_model,"onUpdate:modeName":h[6]||(h[6]=D=>r.rerank_use_model=D),modeId:r.rerank_model_config_id,"onUpdate:modeId":h[7]||(h[7]=D=>r.rerank_model_config_id=D),style:{width:"320px"}},null,8,["modeName","modeId"])])])])])]),_:1},8,["open"])}}},iD=$e(oD,[["__scopeId","data-v-2577e533"]]),rD={class:"problem-optimization-form"},sD={class:"node-form-content"},aD={class:"gray-block"},lD={class:"avatar-box"},uD=["src"],dD={class:"content-box"},cD={class:"list-name"},fD={class:"list-intro"},pD=["onClick"],hD={class:"btn-block"},vD={class:"diy-form-item"},gD={class:"form-content"},_D={class:"form-content"},mD={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=jn(),o=Xe(()=>t.robotInfo.rrf_weight?JSON.parse(t.robotInfo.rrf_weight):{vector:0,search:0,graph:0}),i=e,r=n,s=X([]);function a(){const $=r.lf.getNodeModelById(r.nodeId);if($){let B=$.getAllParentVariable();s.value=l(B)}}function l($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=l(B.children))}),$}function u($){if($){let B=$.split("."),E=B[0],A=B.filter((M,F)=>F>0).join(".");return[E,A]}return["global","question"]}const c=X(),f=X(null),p=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:"",rrf_weight:{}}),h=()=>{const $=JSON.stringify({libs:{...p,rerank_model_config_id:p.rerank_model_config_id?+p.rerank_model_config_id:void 0,question_value:p.question_value.join("."),library_ids:p.library_ids.join(","),rrf_weight:JSON.stringify(p.rrf_weight)}});i("update-node",{...r.node,node_params:$})},v=()=>{try{let $=r.node.dataRaw||r.node.node_params||"{}",B=JSON.parse($).libs||{};a(),B=JSON.parse(JSON.stringify(B));for(let E in B)E=="library_ids"?p[E]=B[E]?B[E].split(","):[]:E=="question_value"?p.question_value=u(B.question_value):E=="rrf_weight"?p.rrf_weight=B[E]?JSON.parse(B[E]):B[E]:p[E]=B[E];B.rrf_weight||(p.rrf_weight=o.value),Cg({ability_type:"library_ability_official_account"}).then(E=>{var M;let A=(E==null?void 0:E.data)||{};((M=A==null?void 0:A.user_config)==null?void 0:M.switch_status)==1&&(f.value=A)})}catch($){}},_=X([]),m=X(null),g=Xe(()=>_.value.filter($=>f.value?p.library_ids.includes($.id):p.library_ids.includes($.id)&&$.type!=3)),b=$=>{let B=p.library_ids.indexOf($.id);p.library_ids.splice(B,1)},C=$=>{S(),p.library_ids=[...$]},D=()=>{m.value.open([...p.library_ids])},T=X(null),O=()=>{T.value.open(Bn(p))},k=$=>{p.rerank_status=$.rerank_status,p.rerank_use_model=$.rerank_use_model,p.rerank_model_config_id=$.rerank_model_config_id,p.top_k=$.top_k,p.similarity=$.similarity,p.search_type=$.search_type,p.rrf_weight=$.rrf_weight},S=async()=>{const $=await Fa({type:""});$&&(_.value=$.data||[])};gt(()=>p,()=>{h()},{deep:!0});const N=$=>{$||a()},L=()=>{i("close")};return ut(()=>{v(),S()}),($,B)=>{const E=Jt,A=kn,M=ei,F=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",rD,[d("div",sD,[y(F,{ref_key:"formRef",ref:c,layout:"vertical",model:p},{default:x(()=>[d("div",aD,[B[4]||(B[4]=d("div",{class:"gray-block-title"},"输入",-1)),y(A,{label:"关联知识库"},{default:x(()=>[(w(!0),P(ae,null,ye(g.value,H=>(w(),P("div",{class:"konwledge-list-item",key:H.id},[d("div",lD,[d("img",{src:H.avatar,alt:""},null,8,uD)]),d("div",dD,[d("div",cD,j(H.library_name),1),d("div",fD,j(H.library_intro),1)]),d("div",{class:"btn-hover-wrap",onClick:R=>b(H)},[y(ee(Kt))],8,pD)]))),128)),d("div",hD,[d("div",null,[y(E,{onClick:D,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[1]||(B[1]=[z("添加知识库",-1)])]),_:1},8,["icon"])]),d("div",null,[y(E,{onClick:O,icon:Tt(ee(Yc)),block:"",type:"dashed"},{default:x(()=>[...B[2]||(B[2]=[z("召回设置",-1)])]),_:1},8,["icon"])])])]),_:1}),d("div",vD,[B[3]||(B[3]=d("div",{class:"form-label"},"用户问题",-1)),d("div",gD,[d("div",_D,[y(M,{value:p.question_value,"onUpdate:value":B[0]||(B[0]=H=>p.question_value=H),onDropdownVisibleChange:N,style:{width:"220px"},options:s.value,allowClear:!1,displayRender:({labels:H})=>H.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),B[5]||(B[5]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"知识库引用"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),y(Og,{ref_key:"librarySelectAlertRef",ref:m,showWxType:!!f.value,onClose:S,onChange:C},null,8,["showWxType"]),y(iD,{ref_key:"recallSettingsAlertRef",ref:T,onChange:k},null,512)])])]),_:1})}}},yD=$e(mD,[["__scopeId","data-v-7abd3184"]]),Ro="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",bD={class:"sub-field-item"},xD=["onClick"],wD=["onClick"],CD={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),P(ae,null,ye(e.data,(v,_)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[d("div",bD,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:v.key,"onUpdate:value":m=>v.key=m,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(p,{class:"mr12",onChange:m=>s(v),value:v.typ,"onUpdate:value":m=>v.typ=m,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,m=>(w(),Z(f,{value:m.value},{default:x(()=>[z(j(m.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),P("div",{key:0,class:"btn-hover-wrap mr12",onClick:m=>i(_,e.data)},[y(ee(Fn))],8,xD)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:m=>r(_,e.data)},[y(ee(Kt))],8,wD)]),v.subs&&v.subs.length>0?(w(),Z(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},SD=$e(CD,[["__scopeId","data-v-9125a152"]]);var Gf={exports:{}},Xf;function kD(){return Xf||(Xf=1,(function(n,e){(function(t){t(Sg())})(function(t){t.defineMode("javascript",function(o,i){var r=o.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,u=i.trackScope!==!1,c=i.typescript,f=i.wordCharacters||/[\w$\xa1-\uffff]/,p=(function(){function I(ft){return{type:ft,style:"keyword"}}var W=I("keyword a"),me=I("keyword b"),Oe=I("keyword c"),rt=I("keyword d"),je=I("operator"),Qe={type:"atom",style:"atom"};return{if:I("if"),while:W,with:W,else:me,do:me,try:me,finally:me,return:rt,break:rt,continue:rt,new:I("new"),delete:Oe,void:Oe,throw:Oe,debugger:I("debugger"),var:I("var"),const:I("var"),let:I("var"),function:I("function"),catch:I("catch"),for:I("for"),switch:I("switch"),case:I("case"),default:I("default"),in:je,typeof:je,instanceof:je,true:Qe,false:Qe,null:Qe,undefined:Qe,NaN:Qe,Infinity:Qe,this:I("this"),class:I("class"),super:I("atom"),yield:Oe,export:I("export"),import:I("import"),extends:Oe,await:Oe}})(),h=/[+\-*&%=<>!?|~^@]/,v=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function _(I){for(var W=!1,me,Oe=!1;(me=I.next())!=null;){if(!W){if(me=="/"&&!Oe)return;me=="["?Oe=!0:Oe&&me=="]"&&(Oe=!1)}W=!W&&me=="\\"}}var m,g;function b(I,W,me){return m=I,g=me,W}function C(I,W){var me=I.next();if(me=='"'||me=="'")return W.tokenize=D(me),W.tokenize(I,W);if(me=="."&&I.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return b("number","number");if(me=="."&&I.match(".."))return b("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(me))return b(me);if(me=="="&&I.eat(">"))return b("=>","operator");if(me=="0"&&I.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return b("number","number");if(/\d/.test(me))return I.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),b("number","number");if(me=="/")return I.eat("*")?(W.tokenize=T,T(I,W)):I.eat("/")?(I.skipToEnd(),b("comment","comment")):J(I,W,1)?(_(I),I.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),b("regexp","string-2")):(I.eat("="),b("operator","operator",I.current()));if(me=="`")return W.tokenize=O,O(I,W);if(me=="#"&&I.peek()=="!")return I.skipToEnd(),b("meta","meta");if(me=="#"&&I.eatWhile(f))return b("variable","property");if(me=="<"&&I.match("!--")||me=="-"&&I.match("->")&&!/\S/.test(I.string.slice(0,I.start)))return I.skipToEnd(),b("comment","comment");if(h.test(me))return(me!=">"||!W.lexical||W.lexical.type!=">")&&(I.eat("=")?(me=="!"||me=="=")&&I.eat("="):/[<>*+\-|&?]/.test(me)&&(I.eat(me),me==">"&&I.eat(me))),me=="?"&&I.eat(".")?b("."):b("operator","operator",I.current());if(f.test(me)){I.eatWhile(f);var Oe=I.current();if(W.lastType!="."){if(p.propertyIsEnumerable(Oe)){var rt=p[Oe];return b(rt.type,rt.style,Oe)}if(Oe=="async"&&I.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return b("async","keyword",Oe)}return b("variable","variable",Oe)}}function D(I){return function(W,me){var Oe=!1,rt;if(a&&W.peek()=="@"&&W.match(v))return me.tokenize=C,b("jsonld-keyword","meta");for(;(rt=W.next())!=null&&!(rt==I&&!Oe);)Oe=!Oe&&rt=="\\";return Oe||(me.tokenize=C),b("string","string")}}function T(I,W){for(var me=!1,Oe;Oe=I.next();){if(Oe=="/"&&me){W.tokenize=C;break}me=Oe=="*"}return b("comment","comment")}function O(I,W){for(var me=!1,Oe;(Oe=I.next())!=null;){if(!me&&(Oe=="`"||Oe=="$"&&I.eat("{"))){W.tokenize=C;break}me=!me&&Oe=="\\"}return b("quasi","string-2",I.current())}var k="([{}])";function S(I,W){W.fatArrowAt&&(W.fatArrowAt=null);var me=I.string.indexOf("=>",I.start);if(!(me<0)){if(c){var Oe=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(I.string.slice(I.start,me));Oe&&(me=Oe.index)}for(var rt=0,je=!1,Qe=me-1;Qe>=0;--Qe){var ft=I.string.charAt(Qe),Ot=k.indexOf(ft);if(Ot>=0&&Ot<3){if(!rt){++Qe;break}if(--rt==0){ft=="("&&(je=!0);break}}else if(Ot>=3&&Ot<6)++rt;else if(f.test(ft))je=!0;else if(/["'\/`]/.test(ft))for(;;--Qe){if(Qe==0)return;var Un=I.string.charAt(Qe-1);if(Un==ft&&I.string.charAt(Qe-2)!="\\"){Qe--;break}}else if(je&&!rt){++Qe;break}}je&&!rt&&(W.fatArrowAt=Qe)}}var N={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function L(I,W,me,Oe,rt,je){this.indented=I,this.column=W,this.type=me,this.prev=rt,this.info=je,Oe!=null&&(this.align=Oe)}function $(I,W){if(!u)return!1;for(var me=I.localVars;me;me=me.next)if(me.name==W)return!0;for(var Oe=I.context;Oe;Oe=Oe.prev)for(var me=Oe.vars;me;me=me.next)if(me.name==W)return!0}function B(I,W,me,Oe,rt){var je=I.cc;for(E.state=I,E.stream=rt,E.marked=null,E.cc=je,E.style=W,I.lexical.hasOwnProperty("align")||(I.lexical.align=!0);;){var Qe=je.length?je.pop():l?ge:ve;if(Qe(me,Oe)){for(;je.length&&je[je.length-1].lex;)je.pop()();return E.marked?E.marked:me=="variable"&&$(I,Oe)?"variable-2":W}}}var E={state:null,marked:null,cc:null};function A(){for(var I=arguments.length-1;I>=0;I--)E.cc.push(arguments[I])}function M(){return A.apply(null,arguments),!0}function F(I,W){for(var me=W;me;me=me.next)if(me.name==I)return!0;return!1}function H(I){var W=E.state;if(E.marked="def",!!u){if(W.context){if(W.lexical.info=="var"&&W.context&&W.context.block){var me=R(I,W.context);if(me!=null){W.context=me;return}}else if(!F(I,W.localVars)){W.localVars=new V(I,W.localVars);return}}i.globalVars&&!F(I,W.globalVars)&&(W.globalVars=new V(I,W.globalVars))}}function R(I,W){if(W)if(W.block){var me=R(I,W.prev);return me?me==W.prev?W:new oe(me,W.vars,!0):null}else return F(I,W.vars)?W:new oe(W.prev,new V(I,W.vars),!1);else return null}function G(I){return I=="public"||I=="private"||I=="protected"||I=="abstract"||I=="readonly"}function oe(I,W,me){this.prev=I,this.vars=W,this.block=me}function V(I,W){this.name=I,this.next=W}var Y=new V("this",new V("arguments",null));function Q(){E.state.context=new oe(E.state.context,E.state.localVars,!1),E.state.localVars=Y}function ue(){E.state.context=new oe(E.state.context,E.state.localVars,!0),E.state.localVars=null}Q.lex=ue.lex=!0;function te(){E.state.localVars=E.state.context.vars,E.state.context=E.state.context.prev}te.lex=!0;function q(I,W){var me=function(){var Oe=E.state,rt=Oe.indented;if(Oe.lexical.type=="stat")rt=Oe.lexical.indented;else for(var je=Oe.lexical;je&&je.type==")"&&je.align;je=je.prev)rt=je.indented;Oe.lexical=new L(rt,E.stream.column(),I,null,Oe.lexical,W)};return me.lex=!0,me}function re(){var I=E.state;I.lexical.prev&&(I.lexical.type==")"&&(I.indented=I.lexical.indented),I.lexical=I.lexical.prev)}re.lex=!0;function ce(I){function W(me){return me==I?M():I==";"||me=="}"||me==")"||me=="]"?A():M(W)}return W}function ve(I,W){return I=="var"?M(q("vardef",W),Be,ce(";"),re):I=="keyword a"?M(q("form"),st,ve,re):I=="keyword b"?M(q("form"),ve,re):I=="keyword d"?E.stream.match(/^\s*$/,!1)?M():M(q("stat"),ke,ce(";"),re):I=="debugger"?M(ce(";")):I=="{"?M(q("}"),ue,pe,re,te):I==";"?M():I=="if"?(E.state.lexical.info=="else"&&E.state.cc[E.state.cc.length-1]==re&&E.state.cc.pop()(),M(q("form"),st,ve,re,bn)):I=="function"?M(Mn):I=="for"?M(q("form"),ue,En,ve,te,re):I=="class"||c&&W=="interface"?(E.marked="keyword",M(q("form",I=="class"?I:W),wi,re)):I=="variable"?c&&W=="declare"?(E.marked="keyword",M(ve)):c&&(W=="module"||W=="enum"||W=="type")&&E.stream.match(/^\s*\w/,!1)?(E.marked="keyword",W=="enum"?M(At):W=="type"?M(xi,ce("operator"),qe,ce(";")):M(q("form"),Ke,ce("{"),q("}"),pe,re,re)):c&&W=="namespace"?(E.marked="keyword",M(q("form"),ge,ve,re)):c&&W=="abstract"?(E.marked="keyword",M(ve)):M(q("stat"),Ie):I=="switch"?M(q("form"),st,ce("{"),q("}","switch"),ue,pe,re,re,te):I=="case"?M(ge,ce(":")):I=="default"?M(ce(":")):I=="catch"?M(q("form"),Q,Ne,ve,re,te):I=="export"?M(q("stat"),Ci,re):I=="import"?M(q("stat"),ur,re):I=="async"?M(ve):W=="@"?M(ge,ve):A(q("stat"),ge,ce(";"),re)}function Ne(I){if(I=="(")return M(kt,ce(")"))}function ge(I,W){return tt(I,W,!1)}function _e(I,W){return tt(I,W,!0)}function st(I){return I!="("?A():M(q(")"),ke,ce(")"),re)}function tt(I,W,me){if(E.state.fatArrowAt==E.stream.start){var Oe=me?se:ne;if(I=="(")return M(Q,q(")"),lt(kt,")"),re,ce("=>"),Oe,te);if(I=="variable")return A(Q,Ke,ce("=>"),Oe,te)}var rt=me?De:he;return N.hasOwnProperty(I)?M(rt):I=="function"?M(Mn,rt):I=="class"||c&&W=="interface"?(E.marked="keyword",M(q("form"),Ii,re)):I=="keyword c"||I=="async"?M(me?_e:ge):I=="("?M(q(")"),ke,ce(")"),re,rt):I=="operator"||I=="spread"?M(me?_e:ge):I=="["?M(q("]"),ct,re,rt):I=="{"?de(et,"}",null,rt):I=="quasi"?A(Me,rt):I=="new"?M(Ee(me)):M()}function ke(I){return I.match(/[;\}\)\],]/)?A():A(ge)}function he(I,W){return I==","?M(ke):De(I,W,!1)}function De(I,W,me){var Oe=me==!1?he:De,rt=me==!1?ge:_e;if(I=="=>")return M(Q,me?se:ne,te);if(I=="operator")return/\+\+|--/.test(W)||c&&W=="!"?M(Oe):c&&W=="<"&&E.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?M(q(">"),lt(qe,">"),re,Oe):W=="?"?M(ge,ce(":"),rt):M(rt);if(I=="quasi")return A(Me,Oe);if(I!=";"){if(I=="(")return de(_e,")","call",Oe);if(I==".")return M(Ve,Oe);if(I=="[")return M(q("]"),ke,ce("]"),re,Oe);if(c&&W=="as")return E.marked="keyword",M(qe,Oe);if(I=="regexp")return E.state.lastType=E.marked="operator",E.stream.backUp(E.stream.pos-E.stream.start-1),M(rt)}}function Me(I,W){return I!="quasi"?A():W.slice(W.length-2)!="${"?M(Me):M(ke,U)}function U(I){if(I=="}")return E.marked="string-2",E.state.tokenize=O,M(Me)}function ne(I){return S(E.stream,E.state),A(I=="{"?ve:ge)}function se(I){return S(E.stream,E.state),A(I=="{"?ve:_e)}function Ee(I){return function(W){return W=="."?M(I?Le:fe):W=="variable"&&c?M(Se,I?De:he):A(I?_e:ge)}}function fe(I,W){if(W=="target")return E.marked="keyword",M(he)}function Le(I,W){if(W=="target")return E.marked="keyword",M(De)}function Ie(I){return I==":"?M(re,ve):A(he,ce(";"),re)}function Ve(I){if(I=="variable")return E.marked="property",M()}function et(I,W){if(I=="async")return E.marked="property",M(et);if(I=="variable"||E.style=="keyword"){if(E.marked="property",W=="get"||W=="set")return M(nt);var me;return c&&E.state.fatArrowAt==E.stream.start&&(me=E.stream.match(/^\s*:\s*/,!1))&&(E.state.fatArrowAt=E.stream.pos+me[0].length),M(We)}else{if(I=="number"||I=="string")return E.marked=a?"property":E.style+" property",M(We);if(I=="jsonld-keyword")return M(We);if(c&&G(W))return E.marked="keyword",M(et);if(I=="[")return M(ge,xe,ce("]"),We);if(I=="spread")return M(_e,We);if(W=="*")return E.marked="keyword",M(et);if(I==":")return A(We)}}function nt(I){return I!="variable"?A(We):(E.marked="property",M(Mn))}function We(I){if(I==":")return M(_e);if(I=="(")return A(Mn)}function lt(I,W,me){function Oe(rt,je){if(me?me.indexOf(rt)>-1:rt==","){var Qe=E.state.lexical;return Qe.info=="call"&&(Qe.pos=(Qe.pos||0)+1),M(function(ft,Ot){return ft==W||Ot==W?A():A(I)},Oe)}return rt==W||je==W?M():me&&me.indexOf(";")>-1?A(I):M(ce(W))}return function(rt,je){return rt==W||je==W?M():A(I,Oe)}}function de(I,W,me){for(var Oe=3;Oe<arguments.length;Oe++)E.cc.push(arguments[Oe]);return M(q(W,me),lt(I,W),re)}function pe(I){return I=="}"?M():A(ve,pe)}function xe(I,W){if(c){if(I==":")return M(qe);if(W=="?")return M(xe)}}function Ce(I,W){if(c&&(I==":"||W=="in"))return M(qe)}function Fe(I){if(c&&I==":")return E.stream.match(/^\s*\w+\s+is\b/,!1)?M(ge,Ue,qe):M(qe)}function Ue(I,W){if(W=="is")return E.marked="keyword",M()}function qe(I,W){if(W=="keyof"||W=="typeof"||W=="infer"||W=="readonly")return E.marked="keyword",M(W=="typeof"?_e:qe);if(I=="variable"||W=="void")return E.marked="type",M(Rt);if(W=="|"||W=="&")return M(qe);if(I=="string"||I=="number"||I=="atom")return M(Rt);if(I=="[")return M(q("]"),lt(qe,"]",","),re,Rt);if(I=="{")return M(q("}"),bt,re,Rt);if(I=="(")return M(lt(vn,")"),at,Rt);if(I=="<")return M(lt(qe,">"),qe);if(I=="quasi")return A(Ft,Rt)}function at(I){if(I=="=>")return M(qe)}function bt(I){return I.match(/[\}\)\]]/)?M():I==","||I==";"?M(bt):A(Xt,bt)}function Xt(I,W){if(I=="variable"||E.style=="keyword")return E.marked="property",M(Xt);if(W=="?"||I=="number"||I=="string")return M(Xt);if(I==":")return M(qe);if(I=="[")return M(ce("variable"),Ce,ce("]"),Xt);if(I=="(")return A(bo,Xt);if(!I.match(/[;\}\)\],]/))return M()}function Ft(I,W){return I!="quasi"?A():W.slice(W.length-2)!="${"?M(Ft):M(qe,pn)}function pn(I){if(I=="}")return E.marked="string-2",E.state.tokenize=O,M(Ft)}function vn(I,W){return I=="variable"&&E.stream.match(/^\s*[?:]/,!1)||W=="?"?M(vn):I==":"?M(qe):I=="spread"?M(vn):A(qe)}function Rt(I,W){if(W=="<")return M(q(">"),lt(qe,">"),re,Rt);if(W=="|"||I=="."||W=="&")return M(qe);if(I=="[")return M(qe,ce("]"),Rt);if(W=="extends"||W=="implements")return E.marked="keyword",M(qe);if(W=="?")return M(qe,ce(":"),qe)}function Se(I,W){if(W=="<")return M(q(">"),lt(qe,">"),re,Rt)}function Ye(){return A(qe,be)}function be(I,W){if(W=="=")return M(qe)}function Be(I,W){return W=="enum"?(E.marked="keyword",M(At)):A(Ke,xe,dt,Ut)}function Ke(I,W){if(c&&G(W))return E.marked="keyword",M(Ke);if(I=="variable")return H(W),M();if(I=="spread")return M(Ke);if(I=="[")return de(ht,"]");if(I=="{")return de(ze,"}")}function ze(I,W){return I=="variable"&&!E.stream.match(/^\s*:/,!1)?(H(W),M(dt)):(I=="variable"&&(E.marked="property"),I=="spread"?M(Ke):I=="}"?A():I=="["?M(ge,ce("]"),ce(":"),ze):M(ce(":"),Ke,dt))}function ht(){return A(Ke,dt)}function dt(I,W){if(W=="=")return M(_e)}function Ut(I){if(I==",")return M(Be)}function bn(I,W){if(I=="keyword b"&&W=="else")return M(q("form","else"),ve,re)}function En(I,W){if(W=="await")return M(En);if(I=="(")return M(q(")"),qt,re)}function qt(I){return I=="var"?M(Be,Hn):I=="variable"?M(Hn):A(Hn)}function Hn(I,W){return I==")"?M():I==";"?M(Hn):W=="in"||W=="of"?(E.marked="keyword",M(ge,Hn)):A(ge,Hn)}function Mn(I,W){if(W=="*")return E.marked="keyword",M(Mn);if(I=="variable")return H(W),M(Mn);if(I=="(")return M(Q,q(")"),lt(kt,")"),re,Fe,ve,te);if(c&&W=="<")return M(q(">"),lt(Ye,">"),re,Mn)}function bo(I,W){if(W=="*")return E.marked="keyword",M(bo);if(I=="variable")return H(W),M(bo);if(I=="(")return M(Q,q(")"),lt(kt,")"),re,Fe,te);if(c&&W=="<")return M(q(">"),lt(Ye,">"),re,bo)}function xi(I,W){if(I=="keyword"||I=="variable")return E.marked="type",M(xi);if(W=="<")return M(q(">"),lt(Ye,">"),re)}function kt(I,W){return W=="@"&&M(ge,kt),I=="spread"?M(kt):c&&G(W)?(E.marked="keyword",M(kt)):c&&I=="this"?M(xe,dt):A(Ke,xe,dt)}function Ii(I,W){return I=="variable"?wi(I,W):xo(I,W)}function wi(I,W){if(I=="variable")return H(W),M(xo)}function xo(I,W){if(W=="<")return M(q(">"),lt(Ye,">"),re,xo);if(W=="extends"||W=="implements"||c&&I==",")return W=="implements"&&(E.marked="keyword"),M(c?qe:ge,xo);if(I=="{")return M(q("}"),ro,re)}function ro(I,W){if(I=="async"||I=="variable"&&(W=="static"||W=="get"||W=="set"||c&&G(W))&&E.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return E.marked="keyword",M(ro);if(I=="variable"||E.style=="keyword")return E.marked="property",M(so,ro);if(I=="number"||I=="string")return M(so,ro);if(I=="[")return M(ge,xe,ce("]"),so,ro);if(W=="*")return E.marked="keyword",M(ro);if(c&&I=="(")return A(bo,ro);if(I==";"||I==",")return M(ro);if(I=="}")return M();if(W=="@")return M(ge,ro)}function so(I,W){if(W=="!"||W=="?")return M(so);if(I==":")return M(qe,dt);if(W=="=")return M(_e);var me=E.state.lexical.prev,Oe=me&&me.info=="interface";return A(Oe?bo:Mn)}function Ci(I,W){return W=="*"?(E.marked="keyword",M(Ge,ce(";"))):W=="default"?(E.marked="keyword",M(ge,ce(";"))):I=="{"?M(lt(Fi,"}"),Ge,ce(";")):A(ve)}function Fi(I,W){if(W=="as")return E.marked="keyword",M(ce("variable"));if(I=="variable")return A(_e,Fi)}function ur(I){return I=="string"?M():I=="("?A(ge):I=="."?A(he):A(Io,K,Ge)}function Io(I,W){return I=="{"?de(Io,"}"):(I=="variable"&&H(W),W=="*"&&(E.marked="keyword"),M(we))}function K(I){if(I==",")return M(Io,K)}function we(I,W){if(W=="as")return E.marked="keyword",M(Io)}function Ge(I,W){if(W=="from")return E.marked="keyword",M(ge)}function ct(I){return I=="]"?M():A(lt(_e,"]"))}function At(){return A(q("form"),Ke,ce("{"),q("}"),lt(Zt,"}"),re,re)}function Zt(){return A(Ke,dt)}function Dn(I,W){return I.lastType=="operator"||I.lastType==","||h.test(W.charAt(0))||/[,.]/.test(W.charAt(0))}function J(I,W,me){return W.tokenize==C&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(W.lastType)||W.lastType=="quasi"&&/\{\s*$/.test(I.string.slice(0,I.pos-(me||0)))}return{startState:function(I){var W={tokenize:C,lastType:"sof",cc:[],lexical:new L((I||0)-r,0,"block",!1),localVars:i.localVars,context:i.localVars&&new oe(null,null,!1),indented:I||0};return i.globalVars&&typeof i.globalVars=="object"&&(W.globalVars=i.globalVars),W},token:function(I,W){if(I.sol()&&(W.lexical.hasOwnProperty("align")||(W.lexical.align=!1),W.indented=I.indentation(),S(I,W)),W.tokenize!=T&&I.eatSpace())return null;var me=W.tokenize(I,W);return m=="comment"?me:(W.lastType=m=="operator"&&(g=="++"||g=="--")?"incdec":m,B(W,me,m,g,I))},indent:function(I,W){if(I.tokenize==T||I.tokenize==O)return t.Pass;if(I.tokenize!=C)return 0;var me=W&&W.charAt(0),Oe=I.lexical,rt;if(!/^\s*else\b/.test(W))for(var je=I.cc.length-1;je>=0;--je){var Qe=I.cc[je];if(Qe==re)Oe=Oe.prev;else if(Qe!=bn&&Qe!=te)break}for(;(Oe.type=="stat"||Oe.type=="form")&&(me=="}"||(rt=I.cc[I.cc.length-1])&&(rt==he||rt==De)&&!/^[,\.=+\-*:?[\(]/.test(W));)Oe=Oe.prev;s&&Oe.type==")"&&Oe.prev.type=="stat"&&(Oe=Oe.prev);var ft=Oe.type,Ot=me==ft;return ft=="vardef"?Oe.indented+(I.lastType=="operator"||I.lastType==","?Oe.info.length+1:0):ft=="form"&&me=="{"?Oe.indented:ft=="form"?Oe.indented+r:ft=="stat"?Oe.indented+(Dn(I,W)?s||r:0):Oe.info=="switch"&&!Ot&&i.doubleIndentSwitch!=!1?Oe.indented+(/^(?:case|default)\b/.test(W)?r:2*r):Oe.align?Oe.column+(Ot?0:1):Oe.indented+(Ot?0:r)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:J,skipExpression:function(I){B(I,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})})()),Gf.exports}kD();const Wf={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(n,{expose:e,emit:t}){const o=t,i=X(""),r=n;gt(()=>r.value,p=>{i.value=p},{immediate:!0});const s={mode:"text/javascript",theme:"dracula"},a=X(null),l=p=>{o("update:value",p)},u=()=>{a.value.refresh()},c=()=>{},f=()=>{};return e({handleRefresh:u}),(p,h)=>(w(),P("div",null,[y(ee(hw),{onWheel:h[0]||(h[0]=St(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":h[1]||(h[1]=v=>i.value=v),options:s,ref_key:"cmRef",ref:a,height:r.height,width:r.width,onChange:l,onInput:f,onReady:c},null,8,["value","height","width"])]))}},ED={class:"flex-content-box"},DD={class:"test-model-box"},AD=["onClick"],OD={key:2,class:"input-list-box"},ND={class:"add-btn-box"},MD={class:"save-btn-box"},TD={class:"preview-box"},$D={class:"preview-content-block"},PD={class:"title-block"},RD={class:"preview-code-box"},BD={class:"preview-content-block"},LD={class:"error-box",style:{"margin-top":"12px"}},ID={key:0,style:{color:"#f50"}},FD={__name:"run-test",props:{variableOptions:{type:Array,default:()=>[]}},emits:["save"],setup(n,{expose:e,emit:t}){const o=n,i=X(!1),r=X(!1);let s=!1;const a=Je({language:"javaScript",main_func:"",test_params:[]});function l(E){if(typeof E!="string")return null;const A=/<([^<>]+)>/,M=E.match(A);return M?M[1]:null}function u(E){var A;if(E&&E.length==2){let M=o.variableOptions.filter(F=>F.value==E[0]);if(M.length>0){let F=((A=M[0].children.filter(H=>H.value==E[1])[0])==null?void 0:A.typ)||"string";return F.includes("array")&&s?l(F):F}}return"string"}let c=[];const f=async E=>{m.value="",a.main_func=E.main_func;let A=localStorage.getItem("code_run_node_test_modal_data")||"{}";c=JSON.parse(A).test_params||[];let M=E.params.filter(F=>F.field&&F.variable&&F.variable.length>0);a.test_params=M.map(F=>{let H=u(F.variable);return{key:Math.random()*1e3,field:F.field,typ:H,value:p(H,F)}}),i.value=!0};function p(E,A){let M=c.filter(F=>F.field==A.field);return E.includes("array")?M.length&&typeof M[0].value=="object"?M[0].value:[{value:"",key:Math.random()*1e4}]:M.length&&typeof M[0].value=="string"?M[0].value:""}const h=(E,A)=>{E.splice(A,1)},v=E=>{E.push({value:"",key:Math.random()*1e4})},_=X(null),m=X(""),g=X(!1),b=X(""),C=()=>{_.value.validate().then(()=>{let E={...a},A=JSON.parse(JSON.stringify(a.test_params)),M={};A.forEach(F=>{M[F.field]=F.value,F.typ.includes("array")&&(M[F.field]=F.value.map(H=>(H.value=H.value.trim(),D(H.value)?JSON.parse(H.value):H.value)),M[F.field]=M[F.field].filter(H=>H)),F.typ==="object"&&D(F.value)&&(M[F.field]=JSON.parse(F.value))}),E.params=JSON.stringify(M),delete E.test_params,localStorage.setItem("code_run_node_test_modal_data",JSON.stringify(a)),r.value=!0,g.value=!1,ny({...E}).then(F=>{xt.success("测试结果生成完成"),m.value=JSON.parse(F.data)}).catch(F=>{g.value=!0,b.value=F.msg}).finally(()=>{r.value=!1})})};function D(E){if(typeof E!="string")return!1;const A=E.trim();if(!(A.startsWith("{")&&A.endsWith("}")||A.startsWith("[")&&A.endsWith("]")))return!1;try{const F=JSON.parse(A);return typeof F=="object"&&F!==null}catch{return!1}}const T=()=>{As(JSON.stringify(m.value)),xt.success("复制成功")},O=(E,A)=>{g.value=!1,s=A,f(E)},k=X(!1),S=X(!1),N=X(null),L=X(""),$=E=>{N.value=E,S.value=!1,k.value=!0},B=()=>{if(D(L.value)){let E=JSON.parse(L.value).map(F=>({value:typeof F=="string"?F:JSON.stringify(F)})),A=a.test_params[N.value],M={...A,value:[...A.value.filter(F=>F.value!=""),...E]};a.test_params.splice(N.value,1,M),k.value=!1}else S.value=!0};return e({open:O}),(E,A)=>{const M=mi,F=ti,H=ln,R=$n,G=Vn,oe=Jt,V=kn,Y=wn,Q=Lr,ue=gn,te=$i;return w(),P("div",null,[y(ue,{open:i.value,"onUpdate:open":A[0]||(A[0]=q=>i.value=q),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal"},{default:x(()=>[d("div",ED,[d("div",DD,[d("div",{class:"top-title",onClick:$},"运行参数"),y(Y,{model:a,ref_key:"formRef",ref:_,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),P(ae,null,ye(a.test_params,(q,re)=>(w(),Z(V,{key:q.key,name:["test_params",re,"value"],rules:[{required:!0,message:`请输入${q.field}`}]},{label:x(()=>[y(F,{gap:8},{default:x(()=>[z(j(q.field),1),y(M,{style:{margin:"0"}},{default:x(()=>[z(j(q.typ),1)]),_:2},1024),q.typ.includes("array")?(w(),P("a",{key:0,onClick:ce=>$(re)},[y(ee(my)),A[3]||(A[3]=z(" 一键导入 ",-1))],8,AD)):ie("",!0)]),_:2},1024)]),default:x(()=>[q.typ!="number"&&!q.typ.includes("array")?(w(),Z(H,{key:0,placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])):ie("",!0),q.typ=="number"?(w(),Z(R,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])):ie("",!0),q.typ.includes("array")?(w(),P("div",OD,[(w(!0),P(ae,null,ye(q.value,(ce,ve)=>(w(),P("div",{class:"input-list-item",key:ve},[y(G,null,{default:x(()=>[y(H,{placeholder:"请输入",value:ce.value,"onUpdate:value":Ne=>ce.value=Ne},null,8,["value","onUpdate:value"])]),_:2},1024),q.value.length>1?(w(),Z(ee(Kt),{key:0,onClick:Ne=>h(q.value,ve)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",ND,[y(oe,{onClick:ce=>v(q.value),block:"",type:"dashed"},{default:x(()=>[...A[4]||(A[4]=[z("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),d("div",MD,[y(oe,{loading:r.value,onClick:C,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(ee(Qo)),A[5]||(A[5]=z("运行测试",-1))]),_:1},8,["loading"])])]),d("div",TD,[m.value?(w(),P(ae,{key:0},[A[7]||(A[7]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",$D,[d("div",PD,[A[6]||(A[6]=z("运行日志",-1)),y(ee(rs),{onClick:T})]),d("div",RD,[y(ee(us),{data:m.value},null,8,["data"])])])],64)):ie("",!0),g.value?(w(),P(ae,{key:1},[A[9]||(A[9]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",BD,[A[8]||(A[8]=d("div",{class:"title-block"},"错误日志",-1)),d("div",LD,[y(Q,{message:b.value,type:"error"},null,8,["message"])])])],64)):ie("",!0)])])]),_:1},8,["open"]),y(ue,{open:k.value,"onUpdate:open":A[2]||(A[2]=q=>k.value=q),width:820,title:"批量导入字段值",onOk:B},{default:x(()=>[y(te,{value:L.value,"onUpdate:value":A[1]||(A[1]=q=>L.value=q),valueModifiers:{trim:!0},placeholder:"请输入JSON字符串",style:{"min-height":"200px"}},null,8,["value"]),S.value?(w(),P("div",ID,' json格式错误 请输入正确的json字符串 列如 [{"xxx":"11","id":48985},{"brand":"aaa","id":48986}] ')):ie("",!0)]),_:1},8,["open"])])}}},jD=$e(FD,[["__scopeId","data-v-167ebf77"]]),VD={class:"problem-optimization-form"},HD={class:"node-form-content"},UD={class:"gray-block"},zD={class:"array-form-box"},qD={class:"flex-block-item"},GD=["onClick"],XD={class:"code-edit-box"},WD={class:"title-block"},YD={class:"code-box"},KD={class:"flex-block-item"},JD={class:"gray-block mt16"},ZD={class:"output-box"},QD={class:"flex-block-item",style:{gap:"12px"}},eA=["onClick"],tA=["onClick"],nA={key:0,class:"sub-field-box"},oA={style:{margin:"40px 0 24px 0"}},Yf=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,iA={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const E=o.lf.getNodeModelById(o.nodeId);if(E){let A=E.getAllParentVariable();i.value=s(A)}i.value}function s(E){return E.forEach(A=>{A.typ=="node"?A.node_type==1?A.value="global":A.value=A.node_id:A.value=A.key,A.children&&A.children.length>0&&(A.children=s(A.children))}),E}const a=X(),l=Je({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),u=()=>{gn.confirm({title:"确认还原为模板？",content:"还原后即被覆盖，不能撤销",okText:"确认",cancelText:"取消",onOk:()=>{l.main_func=Yf}})};function c(E){return E.forEach(A=>{A.cu_key=Math.random()*1e4,A.subs&&A.subs.length?c(A.subs):A.subs=[]}),E}const f=()=>{const E=JSON.stringify({code_run:{...l,params:p()}});t("update-node",{...o.node,...l,node_params:E})};function p(){let E=[];return l.params.forEach(A=>{E.push({field:A.field,variable:A.variable&&A.variable.length>0?A.variable.join("."):""})}),E}const h=()=>{try{let E=o.node.dataRaw||o.node.node_params||"{}",A=JSON.parse(E).code_run||{};A=JSON.parse(JSON.stringify(A)),r();for(let M in A){if(M=="params"){A[M]&&A[M].length>0?l[M]=A[M].map(F=>({...F,cu_key:Math.random()*1e4})):l[M]=[];continue}if(M=="output"){l.output=c(A[M]);continue}l[M]=A[M]}l.main_func=l.main_func||Yf,l.params=l.params.map(M=>{let F="";for(let H=0;H<Oo.length;H++)if(M.variable.indexOf(Oo[H])>-1){F=Oo[H];break}if(F!=""){let H=M.variable.split(".");M.variable=[H[0],F]}else M.variable=M.variable.split(".");return{...M,key:Math.random()*1e4}})}catch(E){}};gt(()=>l,()=>{f()},{deep:!0});const v=()=>{l.params.push({key:"",value:"",cu_key:Math.random()*1e4})},_=E=>{l.params.splice(E,1)},m=()=>{l.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},g=E=>{l.output.splice(E,1)},b=E=>{E.subs=[]},C=E=>{l.output[E].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},D=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],T=E=>{E||r()},O=X(!1),k=X(null),S=()=>{O.value=!0,k.value&&k.value.handleRefresh()},N=()=>{O.value=!1},L=()=>{t("close")},$=X(null),B=()=>{$.value.open(JSON.parse(JSON.stringify(l)),o.node.loop_parent_key!="")};return ut(()=>{h()}),(E,A)=>{const M=Qt,F=ln,H=Vn,R=ei,G=kn,oe=Jt,V=ti,Y=$n,Q=Vt,ue=It,te=gn,q=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:L},{runBtn:x(()=>[y(M,null,{title:x(()=>[...A[5]||(A[5]=[z("运行测试",-1)])]),default:x(()=>[d("div",{class:"action-btn",onClick:B},[y(ee(Qo),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",VD,[d("div",HD,[y(q,{ref_key:"formRef",ref:a,layout:"vertical",model:l},{default:x(()=>[d("div",UD,[A[11]||(A[11]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",zD,[A[7]||(A[7]=d("div",{class:"form-item-label"},"自定义输入参数",-1)),(w(!0),P(ae,null,ye(l.params,(re,ce)=>(w(),P("div",{class:"form-item-list",key:ce},[y(G,{label:null,name:["params",ce,"variable"]},{default:x(()=>[d("div",qD,[y(H,null,{default:x(()=>[y(F,{style:{width:"190px"},value:re.field,"onUpdate:value":ve=>re.field=ve,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),y(R,{value:re.variable,"onUpdate:value":ve=>re.variable=ve,onDropdownVisibleChange:T,style:{width:"400px","max-width":"calc(100% - 190px)"},options:i.value,allowClear:!1,displayRender:({labels:ve})=>ve.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),d("div",{class:"btn-hover-wrap",onClick:ve=>_(ce)},[y(ee(Kt))],8,GD)])]),_:2},1032,["name"])]))),128)),y(oe,{onClick:v,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...A[6]||(A[6]=[z("添加参数",-1)])]),_:1},8,["icon"])]),d("div",XD,[d("div",WD,[A[8]||(A[8]=d("div",null,"JavaScript 代码",-1)),y(V,{gap:16,align:"center"},{default:x(()=>[d("a",{onClick:u},"还原为模板"),d("div",{class:"btn-hover-wrap",onClick:S},[y(ee(Br))])]),_:1})]),d("div",YD,[y(Wf,{value:l.main_func,"onUpdate:value":A[0]||(A[0]=re=>l.main_func=re),width:410,height:170},null,8,["value"])])]),y(G,{name:"timeout",class:"mt16"},{label:x(()=>[y(V,{gap:2},{default:x(()=>[...A[9]||(A[9]=[z("超时时长",-1)])]),_:1})]),default:x(()=>[d("div",KD,[y(Y,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:l.timeout,"onUpdate:value":A[1]||(A[1]=re=>l.timeout=re),min:0,max:3e3},null,8,["value"]),A[10]||(A[10]=z(" 秒 ",-1))])]),_:1})]),d("div",JD,[A[14]||(A[14]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",ZD,[A[13]||(A[13]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:A[2]||(A[2]=St(()=>{},["stop"]))},[(w(!0),P(ae,null,ye(l.output,(re,ce)=>(w(),P("div",{class:"form-item-list",key:ce},[y(G,{label:null,name:["output",ce,"key"]},{default:x(()=>[d("div",QD,[y(F,{style:{width:"214px"},value:re.key,"onUpdate:value":ve=>re.key=ve,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(H,null,{default:x(()=>[y(ue,{onChange:ve=>b(re),value:re.typ,"onUpdate:value":ve=>re.typ=ve,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),P(ae,null,ye(D,ve=>y(Q,{value:ve.value,key:ve.value},{default:x(()=>[z(j(ve.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),re.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:ve=>C(ce)},[y(ee(Fn))],8,eA)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:ve=>g(ce)},[y(ee(Kt))],8,tA)]),re.subs&&re.subs.length>0?(w(),P("div",nA,[y(H,null,{default:x(()=>[y(SD,{data:re.subs,level:2,typOptions:D},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(oe,{onClick:m,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...A[12]||(A[12]=[z("添加参数",-1)])]),_:1},8,["icon"])],32)])]),A[16]||(A[16]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"异常处理"),d("div",null,"运行代码报错时执行该分支")],-1)),y(te,{open:O.value,"onUpdate:open":A[4]||(A[4]=re=>O.value=re),title:"编辑代码",width:746},{footer:x(()=>[y(oe,{type:"primary",onClick:N},{default:x(()=>[...A[15]||(A[15]=[z("确定",-1)])]),_:1})]),default:x(()=>[d("div",oA,[y(Wf,{ref_key:"codeEditBoxRef",ref:k,value:l.main_func,"onUpdate:value":A[3]||(A[3]=re=>l.main_func=re),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1},8,["model"])])]),y(jD,{variableOptions:i.value,ref_key:"runTestRef",ref:$},null,8,["variableOptions"])]),_:1})}}},rA=$e(iA,[["__scopeId","data-v-958444e3"]]),sA={class:"sub-field-item"},aA=["onClick"],lA=["onClick"],uA={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),P(ae,null,ye(e.data,(v,_)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[d("div",sA,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:v.key,"onUpdate:value":m=>v.key=m,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(p,{class:"mr12",onChange:m=>s(v),value:v.typ,"onUpdate:value":m=>v.typ=m,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,m=>(w(),Z(f,{value:m.value},{default:x(()=>[z(j(m.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),P("div",{key:0,class:"btn-hover-wrap mr12",onClick:m=>i(_,e.data)},[y(ee(Fn))],8,aA)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:m=>r(_,e.data)},[y(ee(Kt))],8,lA)]),v.subs&&v.subs.length>0?(w(),Z(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},dA=$e(uA,[["__scopeId","data-v-b8acefd2"]]);var el={exports:{}},rd,Kf;function cA(){if(Kf)return rd;Kf=1;function n(o,i){var r=o;i.slice(0,-1).forEach(function(a){r=r[a]||{}});var s=i[i.length-1];return s in r}function e(o){return typeof o=="number"||/^0x[0-9a-f]+$/i.test(o)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(o)}function t(o,i){return i==="constructor"&&typeof o[i]=="function"||i==="__proto__"}return rd=function(o,i){i||(i={});var r={bools:{},strings:{},unknownFn:null};typeof i.unknown=="function"&&(r.unknownFn=i.unknown),typeof i.boolean=="boolean"&&i.boolean?r.allBools=!0:[].concat(i.boolean).filter(Boolean).forEach(function(k){r.bools[k]=!0});var s={};function a(k){return s[k].some(function(S){return r.bools[S]})}Object.keys(i.alias||{}).forEach(function(k){s[k]=[].concat(i.alias[k]),s[k].forEach(function(S){s[S]=[k].concat(s[k].filter(function(N){return S!==N}))})}),[].concat(i.string).filter(Boolean).forEach(function(k){r.strings[k]=!0,s[k]&&[].concat(s[k]).forEach(function(S){r.strings[S]=!0})});var l=i.default||{},u={_:[]};function c(k,S){return r.allBools&&/^--[^=]+$/.test(S)||r.strings[k]||r.bools[k]||s[k]}function f(k,S,N){for(var L=k,$=0;$<S.length-1;$++){var B=S[$];if(t(L,B))return;L[B]===void 0&&(L[B]={}),(L[B]===Object.prototype||L[B]===Number.prototype||L[B]===String.prototype)&&(L[B]={}),L[B]===Array.prototype&&(L[B]=[]),L=L[B]}var E=S[S.length-1];t(L,E)||((L===Object.prototype||L===Number.prototype||L===String.prototype)&&(L={}),L===Array.prototype&&(L=[]),L[E]===void 0||r.bools[E]||typeof L[E]=="boolean"?L[E]=N:Array.isArray(L[E])?L[E].push(N):L[E]=[L[E],N])}function p(k,S,N){if(!(N&&r.unknownFn&&!c(k,N)&&r.unknownFn(N)===!1)){var L=!r.strings[k]&&e(S)?Number(S):S;f(u,k.split("."),L),(s[k]||[]).forEach(function($){f(u,$.split("."),L)})}}Object.keys(r.bools).forEach(function(k){p(k,l[k]===void 0?!1:l[k])});var h=[];o.indexOf("--")!==-1&&(h=o.slice(o.indexOf("--")+1),o=o.slice(0,o.indexOf("--")));for(var v=0;v<o.length;v++){var _=o[v],m,g;if(/^--.+=/.test(_)){var b=_.match(/^--([^=]+)=([\s\S]*)$/);m=b[1];var C=b[2];r.bools[m]&&(C=C!=="false"),p(m,C,_)}else if(/^--no-.+/.test(_))m=_.match(/^--no-(.+)/)[1],p(m,!1,_);else if(/^--.+/.test(_))m=_.match(/^--(.+)/)[1],g=o[v+1],g!==void 0&&!/^(-|--)[^-]/.test(g)&&!r.bools[m]&&!r.allBools&&(!s[m]||!a(m))?(p(m,g,_),v+=1):/^(true|false)$/.test(g)?(p(m,g==="true",_),v+=1):p(m,r.strings[m]?"":!0,_);else if(/^-[^-]+/.test(_)){for(var D=_.slice(1,-1).split(""),T=!1,O=0;O<D.length;O++){if(g=_.slice(O+2),g==="-"){p(D[O],g,_);continue}if(/[A-Za-z]/.test(D[O])&&g[0]==="="){p(D[O],g.slice(1),_),T=!0;break}if(/[A-Za-z]/.test(D[O])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(g)){p(D[O],g,_),T=!0;break}if(D[O+1]&&D[O+1].match(/\W/)){p(D[O],_.slice(O+2),_),T=!0;break}else p(D[O],r.strings[D[O]]?"":!0,_)}m=_.slice(-1)[0],!T&&m!=="-"&&(o[v+1]&&!/^(-|--)[^-]/.test(o[v+1])&&!r.bools[m]&&(!s[m]||!a(m))?(p(m,o[v+1],_),v+=1):o[v+1]&&/^(true|false)$/.test(o[v+1])?(p(m,o[v+1]==="true",_),v+=1):p(m,r.strings[m]?"":!0,_))}else if((!r.unknownFn||r.unknownFn(_)!==!1)&&u._.push(r.strings._||!e(_)?_:Number(_)),i.stopEarly){u._.push.apply(u._,o.slice(v+1));break}}return Object.keys(l).forEach(function(k){n(u,k.split("."))||(f(u,k.split("."),l[k]),(s[k]||[]).forEach(function(S){f(u,S.split("."),l[k])}))}),i["--"]?u["--"]=h.slice():h.forEach(function(k){u._.push(k)}),u},rd}var sd,Jf;function Ng(){if(Jf)return sd;Jf=1;function n(i){return i.split(/:(.+)/).map(r=>r.trim())}function e(i){return i.split(/=(.+)/)}function t(i,r=n){let s={};var a=r(i);return s[a[0]]=a[1],s}function o(i){if(i==="")return null;let r={};return i.split(/&/).forEach(a=>{const l=a.split(/=/);r[l[0]]=l[1]}),r}return sd={header:i=>{let r={};if(typeof i=="string")r=t(i);else return i.forEach(s=>{r={...r,...t(s,n)}}),r;return r},body:i=>{if(typeof i=="string")try{return JSON.parse(i)}catch{try{return o(i)}catch{return i}}else{let r={};return i.forEach(s=>{r={...r,...t(s,e)}}),r}},parseParamsField:o},sd}var ad,Zf;function fA(){if(Zf)return ad;Zf=1;const n=Ng();return ad=[{name:"url",alias:["url","curl"],description:"Url request",convertor:null},{name:"cookie",alias:["b","cookie"],description:"<name=data> Supply cookie with request. If no =, then specifies the cookie file to use (see -c).",convertor:null},{name:"cookie-jar",alias:["c","cookie-jar"],description:"<file name> File to save response cookies to.",convertor:null},{name:"data",alias:["d","data","data-raw","data-urlencode","data-binary"],description:"<data> Send specified data in POST request. Details provided below.",convertor:n.body},{name:"fail",alias:["f","fail"],description:"Fail silently (don't output HTML error form if returned).",convertor:null},{name:"form",alias:["F","form"],description:"<name=content> Submit form data.",convertor:null},{name:"header",alias:["H","header"],description:"<header> Headers to supply with request.",convertor:n.header},{name:"include",alias:["i","include"],description:"Include HTTP headers in the output.",convertor:null},{name:"head",alias:["I","head"],description:"Fetch headers only.",convertor:null},{name:"insecure",alias:["k","insecure"],description:"Allow insecure connections to succeed.",convertor:null},{name:"location",alias:["L","location"],description:"v",convertor:null},{name:"output",alias:["o","output"],description:"<file> Write output to . Can use --create-dirs in conjunction with this to create any directories specified in the -o path.",convertor:null},{name:"remote-name",alias:["remote-name","O"],description:"Write output to file named like the remote file (only writes to current directory).",convertor:null},{name:"silent",alias:["s","silent"],description:"Silent (quiet) mode. Use with -S to force it to show errors.",convertor:null},{name:"verbose",alias:["v","verbose"],description:"Provide more information (useful for debugging).",convertor:null},{name:"write-out",alias:["write-out","w"],description:`<format> Make curl display information on stdout after a completed transfer. See man page for more details on available variables. Convenient way to force curl to append a newline to output: -w "
" (can add to ~/.curlrc).`,convertor:null},{name:"method",alias:["X","request"],description:"The request method to use.",convertor:null},{name:"user-agent",alias:["A","user-agent"],description:"Specify the User-Agent send to the HTTP server.",convertor:null},{name:"referer",alias:["e","referer"],description:'Sends the "Referrer Page" information to the HTTP server.',convertor:null}],ad}var ld,Qf;function pA(){return Qf||(Qf=1,ld={matchArgv:function(n){return n.replace(/\\\n/g," ").match(/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|[^\s]+/g).map(e=>e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1):e)}}),ld}var ep;function hA(){return ep||(ep=1,(function(n,e){const t=cA(),o=Ng(),i=fA(),r=pA();n.exports=e.default=function(s){(typeof s=="string"||s instanceof String)&&(s=r.matchArgv(s));const a=t(s);let l={};if(a._[1]&&(l.url=a._[1].replace(/'/g,"")),i.forEach(u=>{let f=u.alias.map(p=>a[p]).filter(p=>p)[0];f&&(u.convertor?l[u.name]=u.convertor(f):l[u.name]=f)}),l.url){let u=new URL(l.url);l.url=u.origin+u.pathname;let c=new URLSearchParams(u.search);Array.from(c).length&&(l.params=o.parseParamsField(c.toString()))}return l.method||(l.method=l.data?"POST":"GET"),l}})(el,el.exports)),el.exports}var vA=hA();const gA=Ms(vA),_A={class:"parse-curl-modal"},mA={key:0,class:"parse-error"},yA={__name:"parse-curl-modal",emits:["parse","close"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X(!1),s=X(""),a=X(""),l=X(`请粘贴 cURL 命令，例如：curl -X POST https://api.example.com/data -H 'Content-Type: application/json' -d '{"key":"value"}'`),u=()=>{i.value=!0,s.value="",a.value="",r.value=!1},c=()=>{i.value=!1,s.value="",a.value="",o("close")},f=async()=>{if(!s.value.trim()){a.value="请输入 cURL 命令";return}a.value="";try{let p=s.value.trim();const h="__SINGLE_QUOTE_PLACEHOLDER__";let v=p.replace(/'\\''/g,h);v=v.replace(/\\\n/g," ").replace(/\\/g,"");let _=gA(decodeURIComponent(v));if(_.params){const m={};for(const[g,b]of Object.entries(_.params)){const C=decodeURIComponent(g),D=typeof b=="string"?decodeURIComponent(b):b;m[C]=D}_.params=m}if(_.data&&(_.header&&_.header["Content-Type"]?_.header["Content-Type"].toLowerCase():"").includes("application/x-www-form-urlencoded")&&typeof _.data=="object"){const b={};for(const[C,D]of Object.entries(_.data)){const T=decodeURIComponent(C),O=typeof D=="string"?decodeURIComponent(D):D;b[T]=O}_.data=b}if(_=JSON.stringify(_).split(h).join("'"),_=JSON.parse(_),_.method!=="GET"&&_.method!=="POST"){a.value="只支持 GET、POST 请求";return}o("parse",_)}catch(p){a.value=p.message}};return e({show:u,handleClose:c}),(p,h)=>{const v=Lr,_=$i,m=kn,g=gn;return w(),Z(g,{open:i.value,"onUpdate:open":h[2]||(h[2]=b=>i.value=b),title:"解析 cURL",width:680,"confirm-loading":r.value,onOk:f,onCancel:c,okText:"解析",cancelText:"取消"},{default:x(()=>[d("div",_A,[y(v,{message:"请粘贴 cURL 命令，系统将自动解析并填充到 HTTP 请求配置中。只支持 GET、POST 请求。",type:"info","show-icon":"",class:"mb16"}),y(m,{label:""},{default:x(()=>[y(_,{class:"curl-textarea",value:s.value,"onUpdate:value":h[0]||(h[0]=b=>s.value=b),placeholder:l.value,"auto-size":{minRows:8,maxRows:8},maxlength:5e4,"show-count":""},null,8,["value","placeholder"])]),_:1}),a.value?(w(),P("div",mA,[y(v,{message:a.value,type:"error","show-icon":"",closable:"",onClose:h[1]||(h[1]=b=>a.value="")},null,8,["message"])])):ie("",!0)])]),_:1},8,["open","confirm-loading"])}}},bA=$e(yA,[["__scopeId","data-v-dfc639b3"]]),xA={class:"mt24"},wA={class:"add-btn-block"},CA={class:"list-box"},SA={__name:"add-authentication-modal",emits:["ok"],setup(n,{expose:e,emit:t}){const o=X(!1),i=X([]),r=t,s=[{title:"Key",dataIndex:"auth_key"},{title:"Value",dataIndex:"auth_value"},{title:"Add To",dataIndex:"auth_value_addto"},{title:"备注",dataIndex:"auth_remark"},{title:"操作",dataIndex:"action",width:80}],a=Je({selectedRowKeys:[]}),l=m=>{a.selectedRowKeys=m},u=()=>{o.value=!0,a.selectedRowKeys=[],p()},c=()=>{if(i.value.length>=100)return xt.error("最多添加100条");i.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:_n(16)})},f=m=>{i.value=i.value.filter(g=>g.uni_key!==m.uni_key)},p=()=>{oy().then(m=>{let g=m.data||[];i.value=g.map(b=>({...b,uni_key:_n(16)}))})};function h(){let m=[],g=[];return i.value.forEach((b,C)=>{g.push({auth_key:b.auth_key,auth_value:b.auth_value,auth_value_addto:b.auth_value_addto,auth_remark:b.auth_remark}),(b.auth_key==""||b.auth_value=="")&&m.push(C+1)}),m.length>0?(xt.error(`请填写第${m.join(",")}行参数`),!1):g.length==0?(xt.error("请添加参数"),!1):g}const v=()=>{let m=h();if(m==!1)return;let g=[];a.selectedRowKeys.forEach(b=>{g.push(i.value.find(C=>C.uni_key==b))}),r("ok",g),Hf({http_auth_config_list:JSON.stringify(m)}).then(b=>{xt.success("保存成功")}).finally(()=>{a.selectedRowKeys=[],o.value=!1})},_=()=>{let m=h();m!=!1&&Hf({http_auth_config_list:JSON.stringify(m)}).then(g=>{xt.success("保存成功")})};return e({show:u}),(m,g)=>{const b=Lr,C=Jt,D=ln,T=Vt,O=It,k=yy,S=Ns,N=gn;return w(),P("div",null,[y(N,{open:o.value,"onUpdate:open":g[1]||(g[1]=L=>o.value=L),title:"鉴权参数",width:700},{footer:x(()=>[y(C,{onClick:g[0]||(g[0]=L=>o.value=!1)},{default:x(()=>[...g[7]||(g[7]=[z("取消",-1)])]),_:1}),y(C,{onClick:_},{default:x(()=>[...g[8]||(g[8]=[z("仅保存参数",-1)])]),_:1}),y(C,{type:"primary",onClick:v},{default:x(()=>[...g[9]||(g[9]=[z("保存并添加",-1)])]),_:1})]),default:x(()=>[d("div",xA,[y(b,{class:"zm-alert-info",message:"选择的参数会自动填充到http节点，鉴权参数在导出CSL或上架模板时会自动清空",type:"info"})]),d("div",wA,[y(C,{type:"primary",icon:Tt(ee(Ht)),ghost:"",onClick:c},{default:x(()=>[...g[2]||(g[2]=[z("添加参数",-1)])]),_:1},8,["icon"])]),d("div",CA,[y(S,{"row-selection":{selectedRowKeys:a.selectedRowKeys,onChange:l},columns:s,pagination:!1,"data-source":i.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:x(({column:L,record:$})=>[L.dataIndex==="auth_key"?(w(),Z(D,{key:0,value:$.auth_key,"onUpdate:value":B=>$.auth_key=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_value"?(w(),Z(D,{key:1,value:$.auth_value,"onUpdate:value":B=>$.auth_value=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_value_addto"?(w(),Z(O,{key:2,value:$.auth_value_addto,"onUpdate:value":B=>$.auth_value_addto=B,style:{width:"100%"}},{default:x(()=>[y(T,{value:"HEADERS"},{default:x(()=>[...g[3]||(g[3]=[z("HEADERS",-1)])]),_:1}),y(T,{value:"PARAMS"},{default:x(()=>[...g[4]||(g[4]=[z("PARAMS",-1)])]),_:1}),y(T,{value:"BODY"},{default:x(()=>[...g[5]||(g[5]=[z("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_remark"?(w(),Z(D,{key:3,maxLength:10,value:$.auth_remark,"onUpdate:value":B=>$.auth_remark=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="action"?(w(),Z(k,{key:4,title:"确认删除该字段?","ok-text":"确定","cancel-text":"取消",onConfirm:B=>f($)},{default:x(()=>[...g[6]||(g[6]=[d("a",null,"删除",-1)])]),_:1},8,["onConfirm"])):ie("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open"])])}}},kA=$e(SA,[["__scopeId","data-v-5db652a9"]]),EA={class:"flex-content-box"},DA={class:"test-model-box"},AA={class:"auto-extract-tip"},OA={key:2,class:"input-list-box"},NA={class:"add-btn-box"},MA={class:"save-btn-box"},TA={key:0},$A={key:1},PA={class:"preview-box"},RA={class:"preview-content-block"},BA={class:"title-block"},LA={class:"preview-code-box"},IA={class:"preview-content-block"},FA={class:"title-block"},jA={class:"preview-code-box"},VA={__name:"run-test",props:{node_key:{type:String,default:""}},emits:["save","autoExtract"],setup(n,{expose:e,emit:t}){const o=n,i=t,r=jn(),s=Xe(()=>r.robotInfo.isLockedByOther),a=X(!1),l=X([]),u=X({fields:[],output:{},result:{}}),c=X(!1),f=X(""),p=Je({is_draft:!0,robot_key:r.robotInfo.robot_key}),h=async T=>{if(s.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}u.value={fields:[],output:{},result:{}},f.value="",l.value=T,a.value=!0,l.value.forEach(O=>{O.field.typ.includes("array")&&_(O.field.Vals)})},v=(T,O)=>{T.splice(O,1)},_=T=>{T.push({value:"",key:ns(16)})},m=X(null),g=()=>{m.value.validate().then(()=>{const T={...p,curl_node_key:o.node_key},O=JSON.parse(JSON.stringify(l.value));O.forEach(k=>{k.field.typ.includes("array")&&(k.field.Vals=k.field.Vals.map(S=>S.value))}),T.test_params=JSON.stringify(O),c.value=!0,f.value="loading",iy({...T}).then(k=>{xt.success("测试结果生成完成"),u.value=k.data,f.value="success"}).catch(k=>{xt.error("测试结果生成失败"),f.value="error"}).finally(()=>{c.value=!1})})},b=T=>{As(JSON.stringify(u.value[T])),xt.success("复制成功")},C=()=>{i("autoExtract",JSON.parse(JSON.stringify(u.value.fields)))};return e({open:T=>{h(T)}}),(T,O)=>{const k=Lr,S=mi,N=ti,L=ln,$=$n,B=Vn,E=Jt,A=kn,M=wn,F=gn;return w(),P("div",null,[y(F,{open:a.value,"onUpdate:open":O[2]||(O[2]=H=>a.value=H),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[...O[3]||(O[3]=[d("div",{class:"modal-title-block"},[d("span",null,"运行测试")],-1)])]),default:x(()=>[d("div",EA,[d("div",DA,[d("div",AA,[y(k,{message:"运行测试成功后，支持自动填充输出参数",type:"info","show-icon":""})]),y(M,{model:p,ref_key:"formRef",ref:m,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),P(ae,null,ye(l.value,H=>(w(),Z(A,{key:H.node_key,rules:[{required:H.field.required,message:`请输入${H.field.label}`}]},{label:x(()=>[y(N,{gap:4},{default:x(()=>[d("span",null,j(H.field.label),1),y(S,{style:{margin:"0"}},{default:x(()=>[z(j(H.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[H.field.typ=="string"?(w(),Z(L,{key:0,placeholder:"请输入",value:H.field.Vals,"onUpdate:value":R=>H.field.Vals=R},null,8,["value","onUpdate:value"])):ie("",!0),H.field.typ=="number"?(w(),Z($,{key:1,style:{width:"100%"},placeholder:"请输入",value:H.field.Vals,"onUpdate:value":R=>H.field.Vals=R},null,8,["value","onUpdate:value"])):ie("",!0),H.field.typ.includes("array")?(w(),P("div",OA,[(w(!0),P(ae,null,ye(H.field.Vals,(R,G)=>(w(),P("div",{class:"input-list-item",key:G},[y(B,null,{default:x(()=>[y(L,{placeholder:"请输入",value:R.value,"onUpdate:value":oe=>R.value=oe},null,8,["value","onUpdate:value"])]),_:2},1024),H.field.Vals.length>1?(w(),Z(ee(Kt),{key:0,onClick:oe=>v(H.field.Vals,G)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",NA,[y(E,{onClick:R=>_(H.field.Vals),block:"",type:"dashed"},{default:x(()=>[...O[4]||(O[4]=[z("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),d("div",MA,[y(E,{loading:c.value,onClick:g,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[c.value?ie("",!0):(w(),P("span",TA,[y(ee(Qo)),O[5]||(O[5]=z("运行测试",-1))])),c.value?(w(),P("span",$A,"测试结果生成中...")):ie("",!0)]),_:1},8,["loading"]),f.value==="success"?(w(),Z(E,{key:0,style:{"margin-left":"16px"},type:"primary",onClick:C},{default:x(()=>[...O[6]||(O[6]=[z("自动提取输出参数",-1)])]),_:1})):ie("",!0)])]),d("div",PA,[f.value==="success"?(w(),P(ae,{key:0},[O[9]||(O[9]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",RA,[d("div",BA,[O[7]||(O[7]=z("原始输出",-1)),y(ee(rs),{onClick:O[0]||(O[0]=H=>b("result"))})]),d("div",LA,[y(ee(us),{data:u.value.result},null,8,["data"])])]),d("div",IA,[d("div",FA,[O[8]||(O[8]=z("运行日志",-1)),y(ee(rs),{onClick:O[1]||(O[1]=H=>b("output"))})]),d("div",jA,[y(ee(us),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},HA=$e(VA,[["__scopeId","data-v-74ef5dd6"]]),UA={class:"problem-optimization-form"},zA={class:"node-form-content"},qA={class:"gray-block"},GA={class:"gray-block-title export-curl-title"},XA={class:"flex-block-item"},WA={class:"array-form-box"},YA={class:"flex-block-item"},KA={class:"at-input-flex1"},JA={class:"field-list-item"},ZA={class:"field-label"},QA={class:"field-type"},eO=["onClick"],tO={class:"array-form-box"},nO={class:"flex-block-item"},oO={class:"at-input-flex1"},iO={class:"field-list-item"},rO={class:"field-label"},sO={class:"field-type"},aO=["onClick"],lO={key:0},uO={key:0,class:"array-form-box"},dO={class:"flex-block-item"},cO={class:"at-input-flex1"},fO={class:"field-list-item"},pO={class:"field-label"},hO={class:"field-type"},vO=["onClick"],gO={class:"field-list-item"},_O={class:"field-label"},mO={class:"field-type"},yO={class:"flex-block-item"},bO={class:"gray-block mt16"},xO={class:"gray-block-title"},wO={class:"output-box"},CO={class:"flex-block-item",style:{gap:"12px"}},SO=["onClick"],kO={class:"gray-block mt16"},EO={class:"output-box"},DO={class:"flex-block-item",style:{gap:"12px"}},AO=["onClick"],OO=["onClick"],NO={key:0,class:"sub-field-box"},MO={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("handleAutoSaveDraft"),r=X([]),s=Je({}),a=X(null),l=X(),u=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[],http_auth:[]}),c=X(),f=()=>{c.value.show()},p=Y=>{let Q=[{key:"",value:""}],ue=[{key:"",value:""}],te=[],q="",re=!1;u.method=Y.method,u.rawurl=Y.url;function ce(ve){return typeof ve=="string"?ve:JSON.stringify(ve)}Y.header&&typeof Y.header=="object"&&(Q=Object.keys(Y.header).map(ve=>(ve.toLowerCase()=="content-type"&&Y.header[ve].indexOf("application/json")!==-1&&(re=!0),{key:ve,value:ce(Y.header[ve]),cu_key:_n(16)})),Q=Q.filter(ve=>ve.key.toLowerCase()!=="content-type")),Y.data&&typeof Y.data=="object"&&(te=Object.keys(Y.data).map(ve=>({key:ve,value:ce(Y.data[ve]),cu_key:_n(16)})),q=JSON.stringify(Y.data)),Y.params&&typeof Y.params=="object"&&(ue=Object.keys(Y.params).map(ve=>({key:ve,value:ce(Y.params[ve]),cu_key:_n(16)}))),re?(u.type=2,u.body_raw=q):(u.type=1,u.body=te),u.headers=Q,u.params=ue};function h(Y){return Y.forEach(Q=>{Q.cu_key=_n(16),Q.subs&&Q.subs.length?h(Q.subs):Q.subs=[]}),Y}function v(Y){return Y.typ.includes("array")?[]:null}const _=async()=>{var ue;let Y=JSON.parse(JSON.stringify(u));await i();let Q=[];Y.headers.forEach(te=>{te.tags&&te.tags.length&&(Q=Q.concat(te.tags))}),Y.params.forEach(te=>{te.tags&&te.tags.length&&(Q=Q.concat(te.tags))}),u.type==1?Y.body.forEach(te=>{te.tags&&te.tags.length&&(Q=Q.concat(te.tags))}):u.type==2&&Y.body_raw_tags.length&&(Q=Q.concat(Y.body_raw_tags)),Q=Q.map(te=>({node_key:te.node_id,field:{key:te.original_value,label:te.label,typ:te.typ,Vals:v(te),required:!1,sys:!1}})),(ue=a.value)==null||ue.open(Q)},m=Y=>{u.output=Y,xt.success("自动提取成功")},g=(Y,Q,ue)=>{if(Y){let te=`at_input_${Q}_${ue}`;s[te]=Y}},b=(Y,Q,ue,te)=>{Y=="body_raw"?(u.body_raw=Q,u.body_raw_tags=ue):(te.tags=ue,te.value=Q)},C=()=>{const Y=o.lf.getNodeModelById(o.nodeId);if(Y){let Q=Y.getAllParentVariable();Q.forEach(ue=>{ue.tags=ue.tags||[]}),r.value=Q}},D=()=>{const Y=JSON.stringify({curl:{...u}});t("update-node",{...o.node,...u,node_params:Y})},T=()=>{try{let Y=o.node.dataRaw||o.node.node_params||"{}",Q=JSON.parse(Y).curl||{};Q=JSON.parse(JSON.stringify(Q)),C();for(let ue in Q){if(ue=="headers"||ue=="params"||ue=="body"){Q[ue]&&Q[ue].length>0?u[ue]=Q[ue].map(te=>({...te,cu_key:_n(16)})):u[ue]=[];continue}if(ue=="output"){u.output=h(Q[ue]);continue}u[ue]=Q[ue]}u.http_auth=Q.http_auth||[]}catch(Y){}};gt(()=>u,()=>{D()},{deep:!0});const O=()=>{u.headers.push({key:"",value:"",cu_key:_n(16)})},k=Y=>{u.headers.splice(Y,1)},S=()=>{u.params.push({key:"",value:"",cu_key:_n(16)})},N=Y=>{u.params.splice(Y,1)},L=()=>{u.body.push({key:"",value:"",cu_key:_n(16)})},$=Y=>{u.body.splice(Y,1)},B=()=>{u.output.push({key:"",typ:"string",subs:[],cu_key:_n(16)})},E=Y=>{u.output.splice(Y,1)},A=Y=>{Y.subs=[]},M=Y=>{(!u.output[Y].subs||!Array.isArray(u.output[Y].subs))&&(u.output[Y].subs=[]),u.output[Y].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],H=X(null),R=()=>{H.value.show()},G=Y=>{let Q=Y.map(ue=>({key:ue.auth_key,value:ue.auth_value,add_to:ue.auth_value_addto}));u.http_auth=[...u.http_auth,...Q]},oe=Y=>{u.http_auth.splice(Y,1)},V=()=>{t("close")};return ut(()=>{T()}),(Y,Q)=>{const ue=Qt,te=Jt,q=Vt,re=It,ce=Vn,ve=ln,Ne=kn,ge=Ri,_e=Pi,st=ti,tt=$n,ke=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:V},{runBtn:x(()=>[y(ue,null,{title:x(()=>[...Q[8]||(Q[8]=[z("运行测试",-1)])]),default:x(()=>[d("div",{class:"run-test-btn",onClick:_},[y(ee(Qo),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",UA,[d("div",zA,[y(ke,{ref_key:"formRef",ref:l,layout:"vertical",model:u},{default:x(()=>[d("div",qA,[d("div",GA,[Q[10]||(Q[10]=d("span",null," 输入",-1)),y(te,{ghost:"",type:"primary",size:"small",onClick:f},{default:x(()=>[y(ee(by)),Q[9]||(Q[9]=z(" 导入cURL ",-1))]),_:1})]),y(Ne,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:x(()=>[d("div",XA,[y(ce,null,{default:x(()=>[y(re,{value:u.method,"onUpdate:value":Q[0]||(Q[0]=he=>u.method=he),style:{width:"120px"}},{default:x(()=>[y(q,{value:"POST"},{default:x(()=>[...Q[11]||(Q[11]=[z("POST",-1)])]),_:1}),y(q,{value:"GET"},{default:x(()=>[...Q[12]||(Q[12]=[z("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),y(ve,{class:"flex1",value:u.rawurl,"onUpdate:value":Q[1]||(Q[1]=he=>u.rawurl=he),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),d("div",WA,[Q[14]||(Q[14]=d("div",{class:"form-item-label"},"HEADERS",-1)),(w(!0),P(ae,null,ye(u.headers,(he,De)=>(w(),P("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["headers",De,"value"]},{default:x(()=>[d("div",YA,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",KA,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>g(Me,"headers",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,U)=>b("headers",Me,U,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:U})=>[d("div",JA,[d("div",ZA,j(Me),1),d("div",QA,j(U.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>k(De)},[y(ee(Kt))],8,eO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:O,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...Q[13]||(Q[13]=[z("添加参数",-1)])]),_:1},8,["icon"])]),d("div",tO,[Q[16]||(Q[16]=d("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),P(ae,null,ye(u.params,(he,De)=>(w(),P("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["params",De,"value"]},{default:x(()=>[d("div",nO,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",oO,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>g(Me,"params",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,U)=>b("params",Me,U,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:U})=>[d("div",iO,[d("div",rO,j(Me),1),d("div",sO,j(U.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>N(De)},[y(ee(Kt))],8,aO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:S,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...Q[15]||(Q[15]=[z("添加参数",-1)])]),_:1},8,["icon"])]),u.method=="POST"?(w(),P("div",lO,[y(Ne,{label:"BODY",name:"type",class:"line-height-22"},{default:x(()=>[y(_e,{value:u.type,"onUpdate:value":Q[2]||(Q[2]=he=>u.type=he)},{default:x(()=>[y(ge,{value:0},{default:x(()=>[...Q[17]||(Q[17]=[z("none",-1)])]),_:1}),y(ge,{value:1},{default:x(()=>[...Q[18]||(Q[18]=[z("x-www-form-urlencoded",-1)])]),_:1}),y(ge,{value:2},{default:x(()=>[...Q[19]||(Q[19]=[z("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),u.type==1?(w(),P("div",uO,[(w(!0),P(ae,null,ye(u.body,(he,De)=>(w(),P("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["body",De,"value"],rules:{required:!0}},{default:x(()=>[d("div",dO,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",cO,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>g(Me,"body",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,U)=>b("body",Me,U,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:U})=>[d("div",fO,[d("div",pO,j(Me),1),d("div",hO,j(U.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>$(De)},[y(ee(Kt))],8,vO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:L,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...Q[20]||(Q[20]=[z("添加参数",-1)])]),_:1},8,["icon"])])):ie("",!0),u.type==2?(w(),Z(Ne,{key:1,label:null,name:"body_raw"},{default:x(()=>[y(ot,{type:"textarea",options:r.value,defaultSelectedList:u.body_raw_tags,defaultValue:u.body_raw,ref:he=>g(he,"body","body_raw"),onOpen:C,onChange:Q[3]||(Q[3]=(he,De)=>b("body_raw",he,De)),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:he,payload:De})=>[d("div",gO,[d("div",_O,j(he),1),d("div",mO,j(De.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):ie("",!0)])):ie("",!0),y(Ne,{name:"timeout"},{label:x(()=>[y(st,{gap:2},{default:x(()=>[...Q[21]||(Q[21]=[z("超时时长",-1)])]),_:1})]),default:x(()=>[d("div",yO,[y(tt,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:u.timeout,"onUpdate:value":Q[4]||(Q[4]=he=>u.timeout=he),min:0,max:3e3},null,8,["value"]),Q[22]||(Q[22]=z(" 秒 ",-1))])]),_:1})]),d("div",bO,[d("div",xO,[Q[24]||(Q[24]=z("鉴权 ",-1)),y(ue,null,{title:x(()=>[...Q[23]||(Q[23]=[z("鉴权参数：导出模板CSL文件，或者上架模板时，自动清空参数值",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",wO,[Q[29]||(Q[29]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"124px"}},"Key"),d("div",{class:"output-item",style:{width:"124px"}},"Value"),d("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),d("div",{class:"array-form-box",onMousedown:Q[5]||(Q[5]=St(()=>{},["stop"]))},[(w(!0),P(ae,null,ye(u.http_auth,(he,De)=>(w(),P("div",{class:"form-item-list",key:De},[y(Ne,{label:null},{default:x(()=>[d("div",CO,[y(ve,{style:{width:"124px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(ce,null,{default:x(()=>[y(ve,{style:{width:"124px"},value:he.value,"onUpdate:value":Me=>he.value=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(re,{value:he.add_to,"onUpdate:value":Me=>he.add_to=Me,style:{width:"124px"}},{default:x(()=>[y(q,{value:"HEADERS"},{default:x(()=>[...Q[25]||(Q[25]=[z("HEADERS",-1)])]),_:1}),y(q,{value:"PARAMS"},{default:x(()=>[...Q[26]||(Q[26]=[z("PARAMS",-1)])]),_:1}),y(q,{value:"BODY"},{default:x(()=>[...Q[27]||(Q[27]=[z("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:Me=>oe(De)},[y(ee(Kt))],8,SO)])]),_:2},1024)]))),128)),y(te,{onClick:R,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...Q[28]||(Q[28]=[z("添加参数",-1)])]),_:1},8,["icon"])],32)])]),d("div",kO,[d("div",{class:"gray-block-title output-title",onClick:Q[6]||(Q[6]=(...he)=>Y.test&&Y.test(...he))},[Q[31]||(Q[31]=d("span",null,"输出 (输出字段提取)",-1)),y(te,{type:"primary",size:"small",onClick:_},{default:x(()=>[...Q[30]||(Q[30]=[z("自动提取输出参数",-1)])]),_:1})]),d("div",EO,[Q[33]||(Q[33]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:Q[7]||(Q[7]=St(()=>{},["stop"]))},[(w(!0),P(ae,null,ye(u.output,(he,De)=>(w(),P("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["output",De,"key"]},{default:x(()=>[d("div",DO,[y(ve,{style:{width:"214px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(ce,null,{default:x(()=>[y(re,{onChange:Me=>A(he),value:he.typ,"onUpdate:value":Me=>he.typ=Me,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),P(ae,null,ye(F,Me=>y(q,{value:Me.value,key:Me.value},{default:x(()=>[z(j(Me.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),he.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:Me=>M(De)},[y(ee(Fn))],8,AO)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:Me=>E(De)},[y(ee(Kt))],8,OO)]),he.subs&&he.subs.length>0?(w(),P("div",NO,[y(ce,null,{default:x(()=>[y(dA,{data:he.subs,level:2,typOptions:F},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(te,{onClick:B,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...Q[32]||(Q[32]=[z("添加参数",-1)])]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),y(bA,{ref_key:"parseCurlModalRef",ref:c,onParse:p},null,512),y(kA,{onOk:G,ref_key:"addAuthenticationModalRef",ref:H},null,512),y(HA,{ref_key:"runTestRef",ref:a,node_key:n.nodeId,onAutoExtract:m},null,8,["node_key"])]),_:1})}}},TO=$e(MO,[["__scopeId","data-v-0f39a53b"]]),Tn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},Mg={string:[Tn.EQUALITY.IS,Tn.EQUALITY.IS_NOT,Tn.TEXT.CONTAIN,Tn.TEXT.NOT_CONTAIN,Tn.NULLABILITY.EMPTY,Tn.NULLABILITY.NOT_EMPTY],integer:[Tn.COMPARISON.GT,Tn.COMPARISON.LT,Tn.COMPARISON.GTE,Tn.COMPARISON.LTE,Tn.EQUALITY.EQ,Tn.COMPARISON.BETWEEN],number:[Tn.COMPARISON.GT,Tn.COMPARISON.LT,Tn.COMPARISON.GTE,Tn.COMPARISON.LTE,Tn.EQUALITY.EQ,Tn.COMPARISON.BETWEEN],boolean:[Tn.BOOLEAN.TRUE,Tn.BOOLEAN.FALSE]},Tg=n=>Mg[n]||[],nf=(n,e)=>{const o=Tg(e).find(i=>i.value===n);return(o==null?void 0:o.label)||n},$O={class:"query-condition-filter"},PO={class:"condition-select-box"},RO={class:"select-wrapper"},BO={class:"field-items"},LO={class:"field-select-box"},IO={class:"operator-select-box"},FO={class:"field-value-box"},jO={key:0,class:"site-input-group-wrapper"},VO={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},HO={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},UO=["onClick"],zO={class:"add-btn-box"},qO={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:o.where,type:o.type});gt(()=>o.where,C=>{r.list=C}),gt(()=>o.type,C=>{r.type=C});const s=Xe(()=>o.where.length>1),a=Xe(()=>Mg),l=X([]),u=()=>{let C=i().getAllParentVariable();l.value=C||[]},c=()=>{u()},f=()=>{let C={type:r.type,list:r.list};t("change",C)},p=(C,D,T,O)=>{r.list[O].rule_value1=C,r.list[O].atTags=D,f()},h=(C,D,T,O)=>{r.list[O].rule_value2=C,r.list[O].atTags2=D,f()},v=()=>{let C={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list.push(C),f()},_=C=>{r.list.splice(C,1),f()},m=(C,D)=>{let T=Tg(D.type),O={form_field_id:D.value,field_name:D.name,field_type:D.type,rule:T[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list[C]=O,f()},g=(C,D)=>{let T=r.list[C];T.rule=D.value,T.rule_value1="",T.rule_value2="",T.atTags=[],T.atTags2=[],f()},b=({key:C})=>{r.type=C,t("changeType",C),f()};return ut(()=>{u()}),(C,D)=>{const T=Pr,O=$r,k=Rr,S=Vt,N=It,L=ln,$=Nn,B=Jt,E=Qt;return w(),P("div",{class:Ct(["query-condition-filter-warpper",{"is-multiple":s.value}])},[d("div",$O,[D[5]||(D[5]=d("div",{class:"auxiliary-line"},null,-1)),d("div",PO,[d("div",RO,[y(k,null,{overlay:x(()=>[y(O,{style:{width:"100px"},onClick:b},{default:x(()=>[(w(),Z(T,{key:1},{default:x(()=>[...D[1]||(D[1]=[d("a",{href:"javascript:;"},"且",-1)])]),_:1})),(w(),Z(T,{key:2},{default:x(()=>[...D[2]||(D[2]=[d("a",{href:"javascript:;"},"或",-1)])]),_:1}))]),_:1})]),default:x(()=>[d("a",{class:"ant-dropdown-link",onClick:D[0]||(D[0]=St(()=>{},["prevent"]))},[z(j(r.type==1?"且":"或")+" ",1),y(ee($o))])]),_:1})])]),d("div",BO,[(w(!0),P(ae,null,ye(r.list,(A,M)=>(w(),P("div",{class:"field-item",key:A.field},[d("div",LO,[y(N,{style:{width:"100px"},value:A.form_field_id,"onUpdate:value":F=>A.form_field_id=F,onChange:(F,H)=>m(M,H)},{default:x(()=>[y(S,{value:0,type:"integer",name:"ID",key:"id"},{default:x(()=>[...D[3]||(D[3]=[z("ID",-1)])]),_:1}),(w(!0),P(ae,null,ye(o.fieldOptions,F=>(w(),Z(S,{value:F.id,type:F.type,name:F.name,key:F.id},{default:x(()=>[z(j(F.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),d("div",IO,[y(N,{value:A.rule,"onUpdate:value":F=>A.rule=F,style:{width:"100px"},onChange:(F,H)=>g(M,H)},{default:x(()=>[(w(!0),P(ae,null,ye(a.value[A.field_type],F=>(w(),Z(S,{value:F.value,key:F.value},{default:x(()=>[z(j(F.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),d("div",FO,[A.rule==="between"?(w(),P("div",jO,[d("div",VO,[y(ot,{options:l.value,defaultValue:A.rule_value1,defaultSelectedList:A.atTags,onOpen:c,onChange:(F,H)=>p(F,H,A,M),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),D[4]||(D[4]=d("span",{class:"site-input-split"},"~",-1)),d("div",HO,[y(ot,{options:l.value,defaultValue:A.rule_value2,defaultSelectedList:A.atTags2,onOpen:c,onChange:(F,H)=>h(F,H,A,M),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(A.field_type)?(w(),Z(L,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(A.field_type)?(w(),Z(ot,{key:2,options:l.value,defaultValue:A.rule_value1,defaultSelectedList:A.atTags,onOpen:c,onChange:(F,H)=>p(F,H,A,M),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(w(),Z(ot,{key:3,options:l.value,defaultValue:A.rule_value1,defaultSelectedList:A.atTags,onOpen:c,onChange:(F,H)=>p(F,H,A,M),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),d("span",{class:"field-del-btn",onClick:F=>_(M)},[y($,{class:"del-icon",name:"close-circle"})],8,UO)]))),128))])]),d("div",zO,[n.disabled?(w(),Z(E,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(B,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(ee(Ht)),D[6]||(D[6]=z(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Z(B,{key:1,class:"add-btn",type:"dashed",block:"",onClick:v},{default:x(()=>[y(ee(Ht)),D[7]||(D[7]=z(" 添加条件 ",-1))]),_:1}))])],2)}}},of=$e(qO,[["__scopeId","data-v-d18ef387"]]),GO={class:"delete-data-form"},XO={class:"node-box-content"},WO={class:"setting-box"},YO={class:"setting-box"},KO={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("setData"),o=or();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),s=({type:v,list:_})=>{r.formData.typ=v,r.formData.where=_,u()},a=(v,_)=>{_?(r.formData.form_name=_.name,r.formData.form_description=_.description,h(_.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.where=[]),u()},l=()=>{let v=e.node.dataRaw||"{}";i=JSON.parse(v);let _=c(i.form_delete.where||[]);i.form_delete.where=_,r.formData=i.form_delete,r.formData.form_id&&h(r.formData.form_id),u()},u=()=>{let v={...Bn(r.formData)};v.where=f(v.where),i.form_delete=v,t({...e.node,node_params:JSON.stringify(i)})},c=v=>{let _=[];return v.forEach(m=>{let g=JSON.parse(JSON.stringify(m)),b=g.rule.split("_");g.form_field_id=g.form_field_id*1,g.field_type=b[0],b.shift(),g.rule=b.join("_"),_.push(g)}),_},f=v=>{let _=[];return v.forEach(m=>{let g=JSON.parse(JSON.stringify(m));g.form_field_id=g.form_field_id*1,g.rule=m.field_type+"_"+m.rule,_.push(g)}),_},p=async()=>{const v=await o.getFormList();v&&(r.tableList=v)},h=async v=>{o.getFormFieldList({form_id:v}).then(_=>{_.forEach(m=>{m.id=m.id*1}),r.fieldList=_}).catch(()=>{})};return ut(()=>{p(),l()}),(v,_)=>(w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[..._[1]||(_[1]=[d("span",null,[z("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",GO,[d("div",XO,[_[2]||(_[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),_[3]||(_[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",WO,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":_[0]||(_[0]=m=>r.formData.form_id=m),onChange:a},null,8,["options","title","description","value"])]),_[4]||(_[4]=d("div",{class:"setting-label"},[d("span",null,"删除条件")],-1)),d("div",YO,[y(of,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},JO=$e(KO,[["__scopeId","data-v-c1b21ded"]]),ZO={class:"variable-node"},QO={class:"node-form-content"},eN={class:"gray-block"},tN={class:"field-items"},nN={class:"field-name-box"},oN={class:"field-value-box"},iN={class:"field-value-option"},rN={class:"option-label"},sN={class:"option-type"},aN={class:"field-actions"},lN={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]),r=X([]);function s(){const g=o.lf.getNodeModelById(o.nodeId);if(g){let b=g.properties.loop_parent_key;if(b){const T=o.lf.getNodeModelById(b);if(T){let O=T.properties.dataRaw||T.properties.node_params||"{}",k=JSON.parse(O).loop||{};r.value=k.intermediate_params.map(S=>({label:S.key,value:b+"."+S.key}));return}}let D=g.getGlobalVariable().diy_global||[];D.forEach(T=>{T.label=T.key,T.value="global."+T.key}),r.value=D||[]}}function a(){const g=o.lf.getNodeModelById(o.nodeId);if(g){let b=g.getAllParentVariable();i.value=b}}const l=X([]),u=()=>{let g=JSON.parse(o.node.node_params);g.assign=[...l.value],t("update-node",{...o.node,node_params:JSON.stringify(g)})},c=()=>{try{let g=o.node.dataRaw||o.node.node_params||"{}",b=JSON.parse(g).assign||[];b=JSON.parse(JSON.stringify(b)),b.forEach(C=>{C.tags=C.tags||[]}),l.value=b,s()}catch(g){}},f=g=>{g&&a()},p=(g,b,C)=>{C.tags=b,C.value=g,u()},h=()=>{l.value.push({variable:void 0,value:""}),u()},v=g=>{l.value.splice(g,1),u()},_=g=>{g&&s()},m=()=>{t("close")};return ut(()=>{c()}),(g,b)=>{const C=Vt,D=It,T=Jt;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:m},null,8,["title","iconName"])]),default:x(()=>[d("div",ZO,[d("div",QO,[d("div",eN,[d("div",tN,[(w(!0),P(ae,null,ye(l.value,(O,k)=>(w(),P("div",{class:"field-item",key:k},[d("div",nN,[y(D,{style:{width:"100%"},placeholder:"请输入选择变量",value:O.variable,"onUpdate:value":S=>O.variable=S,onDropdownVisibleChange:_,onChange:u},{default:x(()=>[(w(!0),P(ae,null,ye(r.value,S=>(w(),Z(C,{value:S.value,key:S.key},{default:x(()=>[d("span",null,j(S.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),d("div",oN,[y(ot,{ref_for:!0,ref:"atInput"+k,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:O.tags,defaultValue:O.value,onOpen:f,onChange:(S,N)=>p(S,N,O,k),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:S,payload:N})=>[d("div",iN,[d("div",rN,j(S),1),d("div",sN,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",aN,[y(ee(Kt),{class:"action-btn",onClick:S=>v(k)},null,8,["onClick"])])]))),128))]),d("div",null,[y(T,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:h},{icon:x(()=>[y(ee(Ht))]),default:x(()=>[b[0]||(b[0]=z(" 添加赋值变量 ",-1))]),_:1})])])])])]),_:1})}}},uN=$e(lN,[["__scopeId","data-v-3526d6a8"]]),dN={class:"update-data-form"},cN={class:"node-box-content"},fN={class:"setting-box"},pN={class:"setting-box"},hN={class:"setting-box"},vN={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=or();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),s=({type:_,list:m})=>{r.formData.typ=_,r.formData.where=m,c()},a=(_,m)=>{m?(r.formData.form_name=m.name,r.formData.form_description=m.description,v(m.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.datas=[],r.formData.where=[],r.formData.typ=1),c()},l=_=>{r.formData.datas=_,c()},u=()=>{let _=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(_);let m=f(i.form_update.where||[]);i.form_update.where=m,r.formData=i.form_update,r.formData.form_id&&v(r.formData.form_id),c()},c=()=>{let _={...Bn(r.formData)};_.where=p(_.where),i.form_update=_,t({...e.node,node_params:JSON.stringify(i)})},f=_=>{let m=[];return _.forEach(g=>{let b=JSON.parse(JSON.stringify(g)),C=b.rule.split("_");b.form_field_id=b.form_field_id*1,b.field_type=C[0],C.shift(),b.rule=C.join("_"),m.push(b)}),m},p=_=>{let m=[];return _.forEach(g=>{let b=JSON.parse(JSON.stringify(g));b.form_field_id=b.form_field_id*1,b.rule=g.field_type+"_"+g.rule,m.push(b)}),m},h=async()=>{const _=await o.getFormList();_&&(r.tableList=_)},v=async _=>{o.getFormFieldList({form_id:_}).then(m=>{m.forEach(g=>{g.id=g.id*1}),r.fieldList=m}).catch(()=>{})};return ut(()=>{h(),u()}),(_,m)=>(w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...m[1]||(m[1]=[d("span",null,[z("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",dN,[d("div",cN,[m[2]||(m[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),m[3]||(m[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",fN,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":m[0]||(m[0]=g=>r.formData.form_id=g),onChange:a},null,8,["options","title","description","value"])]),m[4]||(m[4]=d("div",{class:"setting-label"},[d("span",null,"更新条件")],-1)),d("div",pN,[y(of,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])]),m[5]||(m[5]=d("div",{class:"setting-label"},[d("span",null,"更新数据")],-1)),d("div",hN,[y(tf,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showEmptyFieldRow:r.formData.form_id=="",list:r.formData.datas,onChange:l},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},gN=$e(vN,[["__scopeId","data-v-9cb10cb8"]]),$g={__name:"add-params-modal",emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X("新增参数");let s="add";const a=(g,b)=>b?/^[a-zA-Z_]+$/.test(b)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let l=0;const u=Je({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),c=()=>{i.value=!0},f=()=>{Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="add",r.value="新增参数",i.value=!0},p=g=>{l=g,Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="addSub",r.value="新增参数",i.value=!0},h=(g,b)=>{l=b,Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(u,{...g}),s="edit",r.value="编辑参数",i.value=!0},v=X(null),_=()=>{v.value.validate().then(()=>{s=="add"&&o("add",{...u}),s=="addSub"&&o("addSub",{...u},l),s=="edit"&&o("edit",{...u},l),i.value=!1})},m=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:c,add:f,edit:h,addSub:p}),(g,b)=>{const C=ln,D=kn,T=Vt,O=It,k=Ti,S=$i,N=wn,L=gn;return w(),P("div",null,[y(L,{open:i.value,"onUpdate:open":b[5]||(b[5]=$=>i.value=$),title:r.value,onOk:_,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[y(N,{ref_key:"formRef",ref:v,layout:"vertical",model:u,style:{margin:"24px 0"}},{default:x(()=>[y(D,{label:"参数key",name:"key",rules:[{required:!0,validator:($,B)=>a($,B)}]},{default:x(()=>[y(C,{value:u.key,"onUpdate:value":b[0]||(b[0]=$=>u.key=$),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),y(D,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[y(O,{value:u.typ,"onUpdate:value":b[1]||(b[1]=$=>u.typ=$),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),P(ae,null,ye(m,$=>y(T,{value:$.value},{default:x(()=>[z(j($.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),y(D,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:x(()=>[y(k,{checked:u.required,"onUpdate:checked":b[2]||(b[2]=$=>u.required=$)},null,8,["checked"])]),_:1}),y(D,{label:"默认值",name:"default",rules:[{required:u.required,message:"请输入默认值"}]},{default:x(()=>[y(C,{value:u.default,"onUpdate:value":b[3]||(b[3]=$=>u.default=$),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),y(D,{label:"枚举值",name:"enum"},{default:x(()=>[y(S,{style:{height:"80px"},value:u.enum,"onUpdate:value":b[4]||(b[4]=$=>u.enum=$),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},_N={class:"sub-field-item"},mN=["onClick"],yN=["onClick"],bN=["onClick"],xN={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(h=>h.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px");let i=0;const r=(h,v)=>{v.splice(h,1)},s=h=>{h.subs=[]},a=X(null),l=h=>{i=h,a.value.add()},u=(h,v)=>{a.value.edit(h,v)},c=h=>{e.data[i].subs.push(h)},f=(h,v)=>{e.data.splice(v,1,h)},p=h=>h.typ=="object"&&e.level<=2;return(h,v)=>{const _=ln,m=Vt,g=It,b=Nt("SubsKey",!0);return w(),P(ae,null,[(w(!0),P(ae,null,ye(e.data,(C,D)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:C.cu_key},[d("div",_N,[v[0]||(v[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(_,{class:"mr12",style:In({width:o.value}),value:C.key,"onUpdate:value":T=>C.key=T,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),v[1]||(v[1]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(g,{class:"mr12",onChange:T=>s(C),value:C.typ,"onUpdate:value":T=>C.typ=T,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,T=>(w(),Z(m,{value:T.value},{default:x(()=>[z(j(T.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),p(C)?(w(),P("div",{key:0,class:"btn-hover-wrap mr12",onClick:T=>l(D,e.data)},[y(ee(Fn))],8,mN)):ie("",!0),d("div",{class:"btn-hover-wrap mr12",onClick:T=>u(C,D)},[y(ee(wr))],8,yN),d("div",{class:"btn-hover-wrap",onClick:T=>r(D,e.data)},[y(ee(Kt))],8,bN)]),C.subs&&C.subs.length>0?(w(),Z(b,{key:0,level:e.level+1,typOptions:e.typOptions,data:C.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)),y($g,{onAdd:c,onEdit:f,ref_key:"addParamsModalRef",ref:a},null,512)],64)}}},wN=$e(xN,[["__scopeId","data-v-30c2ddb1"]]),CN={class:"problem-optimization-form"},SN={class:"node-form-content"},kN={class:"gray-block"},EN={class:"flex-block-item"},DN={class:"number-box"},AN={class:"number-slider-box"},ON={class:"number-input-box"},NN={class:"number-box"},MN={class:"number-slider-box"},TN={class:"number-input-box"},$N={class:"number-box"},PN={class:"number-box"},RN={class:"number-slider-box"},BN={class:"number-input-box"},LN={class:"field-list-item"},IN={class:"field-label"},FN={class:"field-type"},jN={class:"diy-form-item"},VN={class:"form-content"},HN={class:"gray-block mt16"},UN={class:"output-box"},zN={class:"array-form-box"},qN={class:"flex-block-item",style:{gap:"12px"}},GN=["onClick"],XN=["onClick"],WN=["onClick"],YN={key:0,class:"sub-field-box"},KN={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=jn(),r=X(null),s=Xe(()=>i.modelList),a=X([]),l=X([]),u=X(!1),c=()=>{u.value=!u.value},f=(oe,V)=>{g.prompt=oe,g.prompt_tags=V};function p(){const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let V=oe.getAllParentVariable();l.value=h(V)}}function h(oe){return oe.forEach(V=>{V.typ=="node"?V.node_type==1?V.value="global":V.value=V.node_id:V.value=V.key,V.children&&V.children.length>0&&(V.children=h(V.children))}),oe}const v=()=>{const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let V=oe.getAllParentVariable();a.value=V}};function _(oe){if(oe){let V=oe.split("."),Y=V[0],Q=V.filter((ue,te)=>te>0).join(".");return[Y,Q]}return["global","question"]}const m=X(),g=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),b=()=>{const oe=JSON.stringify({params_extractor:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});t("update-node",{...o.node,...g,node_params:oe})},C=()=>{try{let oe=o.node.dataRaw||o.node.node_params||"{}",V=JSON.parse(oe).params_extractor||{};V=JSON.parse(JSON.stringify(V)),v(),p();for(let Y in V){if(Y=="output"){g.output=D(V[Y]);continue}if(Y=="question_value"){g.question_value=_(V[Y]);continue}g[Y]=V[Y]}!g.model_config_id&&s.value.length>0&&(g.model_config_id=s.value[0].id,g.use_model=s.value[0].children[0].name)}catch(oe){}};gt(()=>g,()=>{b()},{deep:!0});function D(oe){return oe.forEach(V=>{V.cu_key=Math.random()*1e4,V.subs&&V.subs.length?D(V.subs):V.subs=[]}),oe}const T=X(null),O=()=>{T.value.add()},k=(oe,V)=>{T.value.edit(oe,V)},S=oe=>{g.output.push(oe)},N=(oe,V)=>{g.output.splice(V,1,oe)},L=oe=>{g.output.splice(oe,1)},$=oe=>{oe.subs=[]},B=oe=>{T.value.addSub(oe)},E=(oe,V)=>{g.output[V].subs.push(oe)},A=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],M=oe=>{oe||p()},F=X({}),H=(oe,V)=>{F.value=V},R=Xe(()=>{if(!g.model_config_id)return!1;let oe=g.model_config_id+"#"+g.use_model;return F.value[oe]}),G=()=>{t("close")};return ut(()=>{C()}),(oe,V)=>{const Y=Jt,Q=kn,ue=Qt,te=Os,q=Vn,re=$n,ce=Ti,ve=ei,Ne=ln,ge=Vt,_e=It,st=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:G},null,8,["title","iconName"])]),default:x(()=>[d("div",CN,[d("div",SN,[y(st,{ref_key:"formRef",ref:m,layout:"vertical",model:g},{default:x(()=>[d("div",kN,[V[24]||(V[24]=d("div",{class:"gray-block-title"},"输入",-1)),y(Q,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",EN,[y(nr,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":V[0]||(V[0]=tt=>g.use_model=tt),modeId:g.model_config_id,"onUpdate:modeId":V[1]||(V[1]=tt=>g.model_config_id=tt),onLoaded:H,style:{width:"348px"}},null,8,["modeName","modeId"]),y(Y,{onClick:c},{default:x(()=>[V[12]||(V[12]=z("高级设置 ",-1)),u.value?(w(),Z(ee($o),{key:0})):(w(),Z(ee(Va),{key:1}))]),_:1})])]),_:1}),u.value?(w(),Z(Q,{key:0,name:"temperature"},{label:x(()=>[V[14]||(V[14]=d("span",null,"温度 ",-1)),y(ue,null,{title:x(()=>[...V[13]||(V[13]=[z("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",DN,[d("div",AN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:g.temperature,"onUpdate:value":V[2]||(V[2]=tt=>g.temperature=tt),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",ON,[y(re,{value:g.temperature,"onUpdate:value":V[3]||(V[3]=tt=>g.temperature=tt),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),u.value?(w(),Z(Q,{key:1,name:"max_token"},{label:x(()=>[V[16]||(V[16]=d("span",null,"最大token ",-1)),y(ue,null,{title:x(()=>[...V[15]||(V[15]=[z("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",NN,[d("div",MN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:g.max_token,"onUpdate:value":V[4]||(V[4]=tt=>g.max_token=tt),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",TN,[y(re,{value:g.max_token,"onUpdate:value":V[5]||(V[5]=tt=>g.max_token=tt),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),u.value&&R.value?(w(),Z(Q,{key:2,name:"enable_thinking"},{label:x(()=>[V[18]||(V[18]=d("span",null,"深度思考 ",-1)),y(ue,null,{title:x(()=>[...V[17]||(V[17]=[z("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",$N,[y(ce,{checked:g.enable_thinking,"onUpdate:checked":V[6]||(V[6]=tt=>g.enable_thinking=tt)},null,8,["checked"])])]),_:1})):ie("",!0),y(Q,{name:"context_pair"},{label:x(()=>[V[20]||(V[20]=d("span",null,"上下文数量 ",-1)),y(ue,null,{title:x(()=>[...V[19]||(V[19]=[z("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",PN,[d("div",RN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:g.context_pair,"onUpdate:value":V[7]||(V[7]=tt=>g.context_pair=tt),min:0,max:50},null,8,["value"])]),_:1})]),d("div",BN,[y(re,{value:g.context_pair,"onUpdate:value":V[8]||(V[8]=tt=>g.context_pair=tt),min:0,max:50},null,8,["value"])])])]),_:1}),y(Q,{name:"prompt",class:"width-100"},{label:x(()=>[...V[21]||(V[21]=[d("div",{class:"space-between-box"},[d("div",null,"提示词")],-1)])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:r,onOpen:v,onChange:V[9]||(V[9]=(tt,ke)=>f(tt,ke)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:tt,payload:ke})=>[d("div",LN,[d("div",IN,j(tt),1),d("div",FN,j(ke.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),V[22]||(V[22]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",jN,[V[23]||(V[23]=d("div",{class:"form-label"},"用户问题",-1)),d("div",VN,[y(ve,{value:g.question_value,"onUpdate:value":V[10]||(V[10]=tt=>g.question_value=tt),onDropdownVisibleChange:M,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:tt})=>tt.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),d("div",HN,[d("div",{class:"gray-block-title",onClick:V[11]||(V[11]=(...tt)=>oe.test&&oe.test(...tt))},"输出 (输出字段提取)"),d("div",UN,[V[26]||(V[26]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",zN,[(w(!0),P(ae,null,ye(g.output,(tt,ke)=>(w(),P("div",{class:"form-item-list",key:ke},[y(Q,{label:null,name:["output",ke,"key"]},{default:x(()=>[d("div",qN,[y(Ne,{style:{width:"214px"},value:tt.key,"onUpdate:value":he=>tt.key=he,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(_e,{onChange:he=>$(tt),value:tt.typ,"onUpdate:value":he=>tt.typ=he,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),P(ae,null,ye(A,he=>y(ge,{value:he.value,key:he.value},{default:x(()=>[z(j(he.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),tt.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:he=>B(ke)},[y(ee(Fn))],8,GN)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:he=>k(tt,ke)},[y(ee(wr))],8,XN),d("div",{class:"btn-hover-wrap",onClick:he=>L(ke)},[y(ee(Kt))],8,WN)]),tt.subs&&tt.subs.length>0?(w(),P("div",YN,[y(q,null,{default:x(()=>[y(wN,{data:tt.subs,level:2,typOptions:A},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(Y,{onClick:O,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...V[25]||(V[25]=[z("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])]),y($g,{onAdd:S,onEdit:N,onAddSub:E,ref_key:"addParamsModalRef",ref:T},null,512)])]),_:1})}}},JN=$e(KN,[["__scopeId","data-v-abc4a683"]]),lo="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ZN={class:"collapse-panel-warpper"},QN={class:"collapse-panel-header"},e8={class:"title-text"},t8={class:"collapse-panel-body"},n8={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(n){const t=X(n.defaultCollapsed),o=()=>{t.value=!t.value};return(i,r)=>{const s=Nn;return w(),P("div",ZN,[d("div",QN,[d("div",{class:"collapse-panel-title",onClick:St(o,["stop"])},[d("span",e8,[z(j(n.title)+" ",1),n.count?(w(),P(ae,{key:0},[z("（"+j(n.count)+"）",1)],64)):ie("",!0)]),y(s,{name:"arrow-down",class:Ct(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])]),d("div",null,[Oi(i.$slots,"extra",{},void 0,!0)])]),Ni(d("div",t8,[Oi(i.$slots,"default",{},void 0,!0)],512),[[Zi,!t.value]])])}}},os=$e(n8,[["__scopeId","data-v-bc81dac5"]]),o8={class:"field-select-box"},i8={key:0,class:"field-list-box"},r8={key:1,class:"empty-box"},s8={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),r=X([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),s=X([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),a=(c,f)=>{i.selectedRowKeys=c,i.selectedRows=f},l=({formId:c,selectedRowKeys:f,selectedRows:p})=>{i.formId=c,i.selectedRowKeys=f,i.selectedRows=p,i.show=!0},u=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:l}),(c,f)=>{const p=Ns,h=gn;return w(),Z(h,{width:"746px",open:i.show,"onUpdate:open":f[1]||(f[1]=v=>i.show=v),title:"关联数据表",onOk:u,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",o8,[s.value.length?(w(),P("div",i8,[y(p,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:a},dataSource:s.value,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ie("",!0),s.value.length?ie("",!0):(w(),P("div",r8,[f[3]||(f[3]=d("img",{src:Ua,alt:""},null,-1)),d("div",null,[f[2]||(f[2]=z(" 暂无字段, 请先去数据表添加 ",-1)),d("a",{onClick:f[0]||(f[0]=(...v)=>c.openAddLibrary&&c.openAddLibrary(...v))}," 去添加")])]))])]),_:1},8,["open"])}}},a8=$e(s8,[["__scopeId","data-v-fca59186"]]),l8={class:"field-list"},u8={class:"field-list-col field-drag-col"},d8={class:"drag-btn"},c8={class:"field-list-col field-name-col"},f8={class:"field-name-box"},p8={class:"field-name"},h8={class:"field-type-tag"},v8={class:"field-list-col field-value-col"},g8={key:0,class:"field-list-col field-del-col"},_8={class:"add-btn-box"},m8={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=X([]);gt(()=>o.list,p=>{r.value=p.map(h=>({...h,is_asc:h.is_asc?1:0}))});const s=p=>{r.value.splice(p,1),u()},a=(p,h)=>{r.value=h.map(v=>({...v})),u()},l=()=>{u()},u=()=>{let p=r.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",p)},c=X(),f=()=>{c.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(p=>p.name)})};return(p,h)=>{const v=Vt,_=It,m=Nn,g=Jt,b=Qt;return w(),P("div",null,[d("div",l8,[(w(!0),P(ae,null,ye(r.value,C=>(w(),P("div",{class:"field-list-row",key:C.name},[d("div",u8,[d("span",d8,[y(ee(Kc))])]),d("div",c8,[d("div",f8,[d("span",p8,j(C.name),1),d("span",h8,j(C.type),1)])]),d("div",v8,[y(_,{value:C.is_asc,"onUpdate:value":D=>C.is_asc=D,style:{width:"100%"},onChange:l},{default:x(()=>[(w(),P(ae,null,ye(i,D=>y(v,{value:D.value,key:D.key},{default:x(()=>[z(j(D.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),P("div",g8,[d("span",{class:"del-btn",onClick:h[0]||(h[0]=D=>s(p.index))},[y(m,{class:"del-icon",name:"close-circle"})])])):ie("",!0)]))),128))]),d("div",_8,[n.disabled?(w(),Z(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(g,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(ee(Ht)),h[1]||(h[1]=z(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Z(g,{key:1,class:"add-btn",type:"dashed",block:"",onClick:f},{default:x(()=>[y(ee(Ht)),h[2]||(h[2]=z(" 添加排序字段 ",-1))]),_:1}))]),y(a8,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:c,onOk:a},null,8,["formId"])])}}},y8=$e(m8,[["__scopeId","data-v-d239001f"]]),b8={class:"field-item"},x8={class:"field-name"},w8={class:"field-type"},C8={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=Nn,s=Jc;return w(),P("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(s,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=a=>t.value=a),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:x(({switcherCls:a})=>[d("span",{class:Ct(a)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:a})=>[d("div",b8,[d("span",x8,j(a.title),1),d("span",w8,j(a.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},S8=$e(C8,[["__scopeId","data-v-29131f6c"]]),k8={class:"select-data-form"},E8={class:"node-box-content"},D8={class:"setting-box"},A8={class:"setting-box"},O8={class:"node-box-content"},N8={class:"setting-box"},M8={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("setData"),o=or();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),s=Xe(()=>[{title:"output_list",key:"output_list",type:"array<object>",children:r.formData.fields.map(C=>({title:C.name,key:C.name,type:C.type}))},{title:"row_num",key:"row_num",type:"integer"}]),a=({type:b,list:C})=>{r.formData.typ=b,r.formData.where=C,h()},l=b=>{r.formData.order=[...b],h()},u=(b,C)=>{C?(r.formData.form_name=C.name,r.formData.form_description=C.description,g(C.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.typ=1,r.formData.fields=[],r.formData.where=[],r.formData.order=[],r.formData.limit=100),h()},c=b=>{r.formData.fields=b,h()},f=()=>{h()},p=()=>{let b=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(b);let C=v(i.form_select.where||[]);i.form_select.where=C,r.formData=i.form_select,r.formData.form_id&&g(r.formData.form_id),h()},h=()=>{let b={...Bn(r.formData)};b.where=_(b.where),i.form_select=b,t({...e.node,node_params:JSON.stringify(i)})},v=b=>{let C=[];return b.forEach(D=>{let T=JSON.parse(JSON.stringify(D)),O=T.rule.split("_");T.form_field_id=T.form_field_id*1,T.field_type=O[0],O.shift(),T.rule=O.join("_"),C.push(T)}),C},_=b=>{let C=[];return b.forEach(D=>{let T=JSON.parse(JSON.stringify(D));T.form_field_id=T.form_field_id*1,T.rule=D.field_type+"_"+D.rule,C.push(T)}),C},m=async()=>{const b=await o.getFormList();b&&(r.tableList=b)},g=async b=>{o.getFormFieldList({form_id:b}).then(C=>{C.forEach(D=>{D.id=D.id*1}),r.fieldList=C}).catch(()=>{})};return ut(()=>{m(),p()}),(b,C)=>{const D=$n;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...C[8]||(C[8]=[d("span",null,[z("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",k8,[d("div",E8,[C[9]||(C[9]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),C[10]||(C[10]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",D8,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":C[0]||(C[0]=T=>r.formData.form_id=T),onChange:u},null,8,["options","title","description","value"])]),d("div",A8,[y(os,{title:"查询条件",count:r.formData.where.length},{default:x(()=>[y(of,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),d("div",{class:"setting-box",onWheel:C[1]||(C[1]=St(()=>{},["stop"])),onTouchmove:C[2]||(C[2]=St(()=>{},["stop"]))},[y(os,{title:"查询字段",count:r.formData.fields.length},{default:x(()=>[y(tf,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showInput:!1,showEmptyFieldRow:r.formData.form_id=="",list:r.formData.fields,onChange:c},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),d("div",{class:"setting-box",onWheel:C[3]||(C[3]=St(()=>{},["stop"])),onTouchmove:C[4]||(C[4]=St(()=>{},["stop"]))},[y(os,{title:"排序",count:r.formData.order.length},{default:x(()=>[y(y8,{"form-id":r.formData.form_id,disabled:!r.formData.form_id,list:r.formData.order,onChange:l},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),C[11]||(C[11]=d("div",{class:"setting-label"},[d("span",null,"查询数量")],-1)),d("div",{class:"setting-box",onWheel:C[6]||(C[6]=St(()=>{},["stop"])),onTouchmove:C[7]||(C[7]=St(()=>{},["stop"]))},[y(D,{min:1,max:1e3,value:r.formData.limit,"onUpdate:value":C[5]||(C[5]=T=>r.formData.limit=T),disabled:!r.formData.form_id,style:{width:"205px"},onChange:f},null,8,["value","disabled"])],32)]),d("div",O8,[C[12]||(C[12]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:lo,alt:""}),d("span",{class:"text"},"输出")],-1)),d("div",N8,[y(S8,{treeData:s.value},null,8,["treeData"])])])])]),_:1})}}},T8=$e(M8,[["__scopeId","data-v-ac5462ad"]]),$8={class:"problem-optimization-form"},P8={class:"gray-block"},R8={class:"flex-block-item"},B8={class:"number-box"},L8={class:"number-slider-box"},I8={class:"number-input-box"},F8={class:"number-box"},j8={class:"number-slider-box"},V8={class:"number-input-box"},H8={class:"number-box"},U8={class:"number-box"},z8={class:"number-slider-box"},q8={class:"number-input-box"},G8={class:"diy-form-item"},X8={class:"form-content"},W8={class:"gray-block mt16"},Y8={class:"array-form-box"},K8={class:"flex-block-item"},J8=["onClick"],Z8={class:"form-item-list"},Q8={class:"flex-block-item"},eM={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=jn(),s=Xe(()=>r.modelList),a=X(!1),l=()=>{a.value=!a.value},u=X(),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,categorys:[]}),f=X([]);function p(){let N=i().getAllParentVariable();f.value=h(N)}function h(N){return N.forEach(L=>{L.typ=="node"?L.node_type==1?L.value="global":L.value=L.node_id:L.value=L.key,L.children&&L.children.length>0&&(L.children=h(L.children))}),N}const v=N=>{N||p()};function _(N){if(N){let L=N.split("."),$=L[0],B=L.filter((E,A)=>A>0).join(".");return[$,B]}return["global","question"]}const m=()=>{const N=c.model_config_id?+c.model_config_id:c.model_config_id,L=JSON.stringify({cate:{...c,question_value:c.question_value.join("."),model_config_id:N}});t("update-node",{...o.node,...c,node_params:L})},g=()=>{p();try{let N=o.node.dataRaw||o.node.node_params||"{}",L=JSON.parse(N).cate||{};L=JSON.parse(JSON.stringify(L));for(let $ in L)if($==="question_value")c.question_value=_(L.question_value);else if($=="categorys")if(L.categorys&&L.categorys.length>0){let B=L.categorys.map(E=>({...E}));c[$]=B}else c[$]=[{category:"",next_node_key:"",key:_n(16)}];else c[$]=L[$];!c.model_config_id&&s.value.length>0&&(c.model_config_id=s.value[0].id,c.use_model=s.value[0].children[0].name)}catch(N){}};gt(()=>c,()=>{m()},{deep:!0});const b=()=>{c.categorys.push({category:"",next_node_key:"",key:_n(16)})},C=N=>{c.categorys.splice(N,1)},D=()=>Promise.resolve(),T=X({}),O=(N,L)=>{T.value=L},k=Xe(()=>{if(!c.model_config_id)return!1;let N=c.model_config_id+"#"+c.use_model;return T.value[N]}),S=()=>{t("close")};return ut(()=>{g()}),(N,L)=>{const $=Jt,B=kn,E=Qt,A=Os,M=Vn,F=$n,H=Ti,R=ei,G=ln,oe=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:S},null,8,["title","iconName"])]),default:x(()=>[d("div",$8,[d("div",{class:"node-form-content",onMousedown:L[10]||(L[10]=St(()=>{},["stop"]))},[y(oe,{ref_key:"formRef",ref:u,layout:"vertical",model:c},{default:x(()=>[d("div",P8,[L[21]||(L[21]=d("div",{class:"gray-block-title"},"输入",-1)),y(B,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",R8,[y(nr,{modelType:"LLM",modeName:c.use_model,"onUpdate:modeName":L[0]||(L[0]=V=>c.use_model=V),modeId:c.model_config_id,"onUpdate:modeId":L[1]||(L[1]=V=>c.model_config_id=V),onLoaded:O,style:{width:"348px"}},null,8,["modeName","modeId"]),y($,{onClick:l},{default:x(()=>[L[11]||(L[11]=z("高级设置 ",-1)),a.value?(w(),Z(ee($o),{key:0})):(w(),Z(ee(Va),{key:1}))]),_:1})])]),_:1}),a.value?(w(),Z(B,{key:0,name:"temperature"},{label:x(()=>[L[13]||(L[13]=d("span",null,"温度 ",-1)),y(E,null,{title:x(()=>[...L[12]||(L[12]=[z("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",B8,[d("div",L8,[y(M,null,{default:x(()=>[y(A,{class:"custom-slider",value:c.temperature,"onUpdate:value":L[2]||(L[2]=V=>c.temperature=V),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",I8,[y(F,{value:c.temperature,"onUpdate:value":L[3]||(L[3]=V=>c.temperature=V),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),a.value?(w(),Z(B,{key:1,name:"max_token"},{label:x(()=>[L[15]||(L[15]=d("span",null,"最大token ",-1)),y(E,null,{title:x(()=>[...L[14]||(L[14]=[z("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",F8,[d("div",j8,[y(M,null,{default:x(()=>[y(A,{class:"custom-slider",value:c.max_token,"onUpdate:value":L[4]||(L[4]=V=>c.max_token=V),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",V8,[y(F,{value:c.max_token,"onUpdate:value":L[5]||(L[5]=V=>c.max_token=V),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),a.value&&k.value?(w(),Z(B,{key:2,name:"enable_thinking"},{label:x(()=>[L[17]||(L[17]=d("span",null,"深度思考 ",-1)),y(E,null,{title:x(()=>[...L[16]||(L[16]=[z("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",H8,[y(H,{checked:c.enable_thinking,"onUpdate:checked":L[6]||(L[6]=V=>c.enable_thinking=V)},null,8,["checked"])])]),_:1})):ie("",!0),y(B,{name:"context_pair"},{label:x(()=>[L[19]||(L[19]=d("span",null,"上下文数量 ",-1)),y(E,null,{title:x(()=>[...L[18]||(L[18]=[z("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(ee(yt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",U8,[d("div",z8,[y(M,null,{default:x(()=>[y(A,{class:"custom-slider",value:c.context_pair,"onUpdate:value":L[7]||(L[7]=V=>c.context_pair=V),min:0,max:50},null,8,["value"])]),_:1})]),d("div",q8,[y(F,{value:c.context_pair,"onUpdate:value":L[8]||(L[8]=V=>c.context_pair=V),min:0,max:50},null,8,["value"])])])]),_:1}),d("div",G8,[L[20]||(L[20]=d("div",{class:"form-label"},"用户问题",-1)),d("div",X8,[y(R,{value:c.question_value,"onUpdate:value":L[9]||(L[9]=V=>c.question_value=V),onDropdownVisibleChange:v,style:{width:"220px"},options:f.value,allowClear:!1,displayRender:({labels:V})=>V.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),d("div",W8,[L[23]||(L[23]=d("div",{class:"gray-block-title"},"问题分类设置",-1)),d("div",Y8,[(w(!0),P(ae,null,ye(c.categorys,(V,Y)=>(w(),P("div",{class:"form-item-list",key:V.key},[y(B,{label:null,name:["categorys",Y,"category"],rules:{required:!0,validator:(Q,ue)=>D(Q,ue)}},{default:x(()=>[d("div",K8,[y(G,{class:"flex1",value:V.category,"onUpdate:value":Q=>V.category=Q,placeholder:"请输入"},null,8,["value","onUpdate:value"]),d("div",{class:"btn-hover-wrap",onClick:Q=>C(Y)},[y(ee(Kt))],8,J8)])]),_:2},1032,["name","rules"])]))),128)),d("div",Z8,[y(B,{label:null},{default:x(()=>[d("div",Q8,[y(G,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),y($,{onClick:b,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...L[22]||(L[22]=[z("添加问题分类",-1)])]),_:1},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},tM=$e(eM,[["__scopeId","data-v-73512ce7"]]),nM={class:"judge-node-form"},oM={class:"gray-block-title"},iM=["onClick"],rM={class:"condition-list-box"},sM={class:"left-select-box"},aM={class:"condition-body"},lM=["onClick"],uM={class:"btn-wrap"},dM={class:"add-btn-block"},cM={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})},nodeId:{type:String,default:""},lf:{type:Object,default:null}},setup(n){const e=n,t=He("getNode"),o=He("setData"),i=X(),r=Je({term:[]}),s=X([]);function a(){let O=t().getAllParentVariable(),S=e.lf.getNodeModelById(e.nodeId).properties.loop_parent_key,N=l(O);if(S){O=O.filter($=>$.node_type!="25"),N=l(O);const L=e.lf.getNodeModelById(S);if(L){let $=L.properties.dataRaw||L.properties.node_params||"{}",B=JSON.parse($).loop||{};const E=u(B.intermediate_params,L),A=N.find(M=>(M.node_id||M.value)==L.id);if(A){const M=[],F=new Set;[...A.children||[],...E].forEach(H=>{const R=H.original_value||H.value||H.key;F.has(R)||(F.add(R),M.push(H))}),A.children=M}else N.push({label:L.properties.node_name,node_id:L.id,node_type:L.properties.node_type,typ:"node",value:L.id,children:E})}}s.value=N}function l(O){return O.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=l(k.children))}),O}function u(O,k){let S=[];return O&&O.length&&O.forEach(N=>{N.key&&S.push({id:k.id,key:N.key,value:N.key,label:N.key,node_id:k.id,node_name:k.properties.node_name,node_type:k.properties.node_type,original_value:k.id+"."+N.key,text:N.key,typ:N.typ})}),S}const c=O=>{O||a()},f=()=>{try{let O=JSON.parse(e.node.node_params).term||[];O=O.map(k=>{let S=k.terms.map(N=>{let L="";for(let $=0;$<Oo.length;$++)if(N.variable.indexOf(Oo[$])>-1){L=Oo[$];break}if(L!=""){let $=N.variable.split(".");N.variable=[$[0],L]}else N.variable=N.variable.split(".");return{...N,type:N.type>0?N.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:S,key:Math.random()*1e4}}),r.term=O,p()}catch(O){}},p=()=>{let O=JSON.parse(JSON.stringify(r.term));O=O.map(k=>({is_or:k.is_or==1,next_node_key:k.next_node_key,terms:k.terms.map(S=>({variable:S.variable.join("."),is_mult:S.is_mult,type:S.type,value:S.value}))})),o({...e.node,term:O,node_params:JSON.stringify({term:O})})},h=O=>{r.term[O].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},v=(O,k)=>{r.term[O].terms.splice(k,1)},_=()=>{r.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},m=O=>{r.term.splice(O,1)},g=O=>{let k=D(O);O.is_mult=k.includes("array"),O.type=void 0};let b=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],C=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function D(O){let k="";if(O.variable&&O.variable.length>0){let S=s.value.filter(N=>N.key==O.variable[0]);S&&S.length&&(k=S[0].typ),k=="object"&&(S[0]&&S[0].children&&(S=S[0].subs.filter(N=>N.key==O.variable[1])),S&&S.length&&(k=S[0].typ),k=="object"&&(S[0]&&S[0].children&&(S=S[0].subs.filter(N=>N.key==O.variable[2])),S&&S.length&&(k=S[0].typ)))}return k}function T(O){if(!O.variable)return[];let k=D(O);return k==""?O.is_mult?C:b:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?C:b}return gt(()=>r,()=>{p()},{deep:!0}),ut(()=>{a(),f()}),(O,k)=>{const S=ti,N=Vt,L=It,$=ei,B=ln,E=Jt,A=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...k[2]||(k[2]=[d("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",nM,[d("div",{class:"form-block",onMousedown:k[1]||(k[1]=St(()=>{},["stop"]))},[y(A,{ref_key:"formRef",ref:i,layout:"vertical",model:r},{default:x(()=>[y(ee(vw),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:r.term,"onUpdate:modelValue":k[0]||(k[0]=M=>r.term=M),"item-key":"key"},{item:x(({element:M,index:F})=>[(w(),P("div",{class:"gray-block",key:M.key},[d("div",oM,[y(S,{gap:8},{default:x(()=>[y(ee(Kc),{class:"icon drag-btn"}),z(j(F==0?"if":"else if"),1)]),_:2},1024),r.term.length>1?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:H=>m(F)},[y(ee(Kt))],8,iM)):ie("",!0)]),d("div",rM,[d("div",sM,[y(L,{size:"small",value:M.is_or,"onUpdate:value":H=>M.is_or=H,bordered:!1,style:{width:"64px"}},{default:x(()=>[y(N,{value:0},{default:x(()=>[...k[3]||(k[3]=[z("and",-1)])]),_:1}),y(N,{value:1},{default:x(()=>[...k[4]||(k[4]=[z("or",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),d("div",aM,[(w(!0),P(ae,null,ye(M.terms,(H,R)=>(w(),P("div",{class:"condition-item",key:H.key},[y($,{value:H.variable,"onUpdate:value":G=>H.variable=G,onChange:G=>g(H),onDropdownVisibleChange:c,style:{width:"160px"},options:s.value,allowClear:!1,displayRender:({labels:G})=>G.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),y(L,{value:H.type,"onUpdate:value":G=>H.type=G,style:{width:"120px"},placeholder:"请选择"},{default:x(()=>[(w(!0),P(ae,null,ye(T(H),G=>(w(),Z(N,{value:G.value,key:G.value},{default:x(()=>[z(j(G.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),H.type!=5&&H.type!=6?(w(),Z(B,{key:0,placeholder:"请输入",value:H.value,"onUpdate:value":G=>H.value=G,style:{width:"150px"}},null,8,["value","onUpdate:value"])):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:G=>v(F,R)},[y(ee(Kt))],8,lM)]))),128))])]),d("div",uM,[y(E,{onClick:H=>h(F),icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...k[5]||(k[5]=[z("添加条件",-1)])]),_:1},8,["onClick","icon"])])]))]),_:1},8,["modelValue"]),d("div",dM,[y(E,{onClick:_,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...k[6]||(k[6]=[z("添加分支",-1)])]),_:1},8,["icon"])]),k[7]||(k[7]=d("div",{class:"gray-block mt8"},[d("div",{class:"gray-block-title"},"else"),d("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1},8,["model"])],32)])]),_:1})}}},fM=$e(cM,[["__scopeId","data-v-1fd40441"]]),pM={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:fn,AtInput:ot,FullscreenOutlined:Br,FullAtInput:za,NodeFormLayout:cn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},hM={class:"specify-reply-form"},vM={class:"node-content"},gM={class:"form-item-label"},_M={class:"flex-between-box"},mM={class:"form-item-body"};function yM(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("FullscreenOutlined"),l=Nt("AtInput"),u=Nt("FullAtInput"),c=Nt("NodeFormLayout");return w(),Z(c,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[d("div",hM,[d("div",vM,[e[5]||(e[5]=d("div",{class:"form-label"},"输出",-1)),d("div",{class:"form-item",onMousedown:e[2]||(e[2]=St(()=>{},["stop"]))},[d("div",gM,[d("div",_M,[e[4]||(e[4]=d("div",null,"消息内容",-1)),d("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...f)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...f))},[y(a)])])]),d("div",mM,[y(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(f,p)=>r.changeValue(f,p))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),y(u,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(f,p)=>r.changeValue(f,p)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const bM=$e(pM,[["render",yM],["__scopeId","data-v-0ea98966"]]),xM={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:fn,AtInput:ot,FullscreenOutlined:Br,FullAtInput:za,NodeFormLayout:cn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).immediately_reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.immediately_reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},wM={class:"specify-reply-form"},CM={class:"node-content"},SM={class:"form-item-label"},kM={class:"flex-between-box"},EM={class:"form-item-body"};function DM(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("FullscreenOutlined"),l=Nt("AtInput"),u=Nt("FullAtInput"),c=Nt("NodeFormLayout");return w(),Z(c,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将立即给用户回复一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[d("div",wM,[d("div",CM,[e[5]||(e[5]=d("div",{class:"form-label"},"输出",-1)),d("div",{class:"form-item",onMousedown:e[2]||(e[2]=St(()=>{},["stop"]))},[d("div",SM,[d("div",kM,[e[4]||(e[4]=d("div",null,"消息内容",-1)),d("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...f)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...f))},[y(a)])])]),d("div",EM,[y(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(f,p)=>r.changeValue(f,p))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),y(u,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(f,p)=>r.changeValue(f,p)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const AM=$e(xM,[["render",DM],["__scopeId","data-v-f2c2a31f"]]),OM=["src"],NM={class:"mcp-form"},MM={class:"node-options"},TM={class:"options-item-tit"},$M={class:"option-label"},PM={class:"option-type"},RM={class:"field-list-item"},BM={class:"field-label"},LM={class:"field-type"},IM={class:"desc"},FM={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i=Je({mcpInfo:{},toolInfo:{}}),r=Je({params:{}}),s=X([]),a=Je({mcp:{}});function l(){u();const h=JSON.parse(o.node.node_params);Object.assign(a,h),p()}function u(){s.value=e().getAllParentVariable()}function c(h,v,_){h.value=v,h.tags=_,f()}function f(){let h={arguments:{},tag_map:{}};for(let v in r.params){let _=r.params[v].value,m=i.toolInfo.inputSchema.properties[v]||{};m.type=="string"?_=String(_):["number","integer"].includes(m.type)&&(_=Number(_)),h.arguments[v]=_,h.tag_map[v]=r.params[v].tags}a.mcp.arguments=h.arguments,a.mcp.tag_map=h.tag_map||[],t({...o.node,node_params:JSON.stringify(a)})}const p=()=>{kg({provider_id:a.mcp.provider_id}).then(h=>{var b;i.mcpInfo=(h==null?void 0:h.data)||{};let v=To((b=i.mcpInfo)==null?void 0:b.tools,[]);i.toolInfo=v.find(C=>C.name==a.mcp.tool_name);let _=i.toolInfo.inputSchema||{},m=(_==null?void 0:_.properties)||{},g=(_==null?void 0:_.required)||[];m=JSON.parse(JSON.stringify(m));for(let C in m)m[C].value=String(a.mcp.arguments[C]||""),m[C].tags=a.mcp.tag_map?a.mcp.tag_map[C]:[],m[C].required=g.includes(C);r.params=m})};return ut(()=>{l()}),(h,v)=>(w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{"node-icon":x(()=>[d("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,OM)]),desc:x(()=>[d("span",null,j(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",NM,[d("div",MM,[v[0]||(v[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),(w(!0),P(ae,null,ye(r.params,(_,m)=>(w(),P("div",{key:m,class:Ct(["options-item",{"is-required":_.required}])},[d("div",TM,[d("div",$M,j(m),1),d("div",PM,j(_.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"min-height: 32px;",options:s.value,defaultSelectedList:_.tags,defaultValue:_.value,ref_for:!0,ref:"atInputRef",onOpen:u,onChange:(g,b)=>c(_,g,b),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:b})=>[d("div",RM,[d("div",BM,j(g),1),d("div",LM,j(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",IM,j(_.description),1)],2))),128))]),v[1]||(v[1]=d("div",{class:"node-options"},[d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])]),d("div",{class:"options-item"},[d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"输出")]),d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"text"),d("div",{class:"option-type"},"string")]),d("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},jM=$e(FM,[["__scopeId","data-v-ab8d9b2d"]]),VM="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%2331gmof37u__clip0_10933_119689)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M4.33325%2011.6719H2.33325V13.6719'/%3e%3cpath%20d='M13.6667%2013.6719H11.6667V11.6719'/%3e%3cpath%20d='M11.6667%204.32813H13.6667V2.32812'/%3e%3cpath%20d='M2.33325%202.32812H4.33325V4.32813'/%3e%3cpath%20d='M4.33325%202.42969C2.52585%203.62217%201.33325%205.67097%201.33325%207.99834C1.33325%208.3382%201.35869%208.67214%201.40775%208.99834'/%3e%3cpath%20d='M9.00005%2014.5974C8.67385%2014.6464%208.33991%2014.6719%208.00005%2014.6719C5.67268%2014.6719%203.62388%2013.4793%202.4314%2011.6719'/%3e%3cpath%20d='M14.5922%207C14.6413%207.3262%2014.6667%207.66013%2014.6667%208C14.6667%2010.3274%2013.4741%2012.3762%2011.6667%2013.5687'/%3e%3cpath%20d='M7%201.40262C7.3262%201.35356%207.66013%201.32812%208%201.32812C10.3274%201.32812%2012.3762%202.52072%2013.5687%204.32813'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='31gmof37u__clip0_10933_119689'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",HM="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_12353_121923)'%3e%3cpath%20d='M3.99992%201.33594H1.33325V4.0026H3.99992V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%2012H12V14.6667H14.6667V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M3.99992%2012H1.33325V14.6667H3.99992V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%201.33594H12V4.0026H14.6667V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.66675%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M13.3333%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%202.66406H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%2013.3359H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.33325%205.33594H8.53325V7.46927H10.6666V10.6693H7.46659V8.53594H5.33325V5.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_12353_121923'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",UM="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2010.3307H12.6667V1.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.99992%207H3.33325V14.3333'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%203.66406L12.6667%201.66406L10.6667%203.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.33325%2012.3359L3.33325%2014.3359L1.33325%2012.3359'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ju="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",zM={class:"problem-optimization-form"},qM={class:"node-form-content"},GM={class:"gray-block"},XM={class:"gray-block-title"},WM={class:"flex-form-item"},YM={key:0,class:"gray-block"},KM={class:"gray-block-title"},JM={class:"output-box"},ZM={class:"array-form-box"},QM={class:"flex-block-item",style:{gap:"12px"}};const e4={class:"gray-block"},t4={class:"gray-block-title"},n4={class:"output-box"},o4={class:"array-form-box"},i4={class:"flex-block-item",style:{gap:"12px"}},r4={style:{width:"40%"}},s4={class:"field-list-item"},a4={class:"field-label"},l4={class:"field-type"},u4=["onClick"],d4={class:"gray-block"},c4={class:"gray-block-title"},f4={class:"output-box"},p4={class:"array-form-box"},h4={class:"flex-block-item",style:{gap:"12px"}},v4=["onClick"],g4={__name:"custom-group-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=X([]),s=X([]);X([]);const a=Je({}),l=(R,G,oe)=>{if(R){let V=`at_input_${G}_${oe}`;a[V]=R}},u=(R,G,oe)=>{oe.tags=G,oe.value=R};function c(R){return R.forEach(G=>{G.typ=="node"?G.node_type==1?G.value="global":G.value=G.node_id:G.value=G.key,G.children&&G.children.length>0&&(G.children=c(G.children))}),R}const f=()=>{let R=i().getAllParentVariable();R.forEach(G=>{G.tags=G.tags||[]}),R=R.filter(G=>G.group_node_key!=G.loop_parent_key).filter(G=>G.node_id!=G.group_node_key),r.value=R};function p(){let R=i().getAllParentVariable();R=c(R),R=R.filter(G=>G.group_node_key!=G.loop_parent_key).filter(G=>G.node_id!=G.group_node_key),s.value=h(R)}function h(R){const G=oe=>!oe||oe.length===0?[]:oe.map(V=>{const Y=G(V.children);return V.typ.includes("array")||Y&&Y.length>0?{...V,children:Y}:null}).filter(Boolean);return G(R)}const v=R=>{R||p()},_=X(),m={key:"",typ:"",value:"",cu_key:Math.random()*1e4},g={key:"",typ:"",value:"",cu_key:Math.random()*1e4},b={key:"",typ:"",value:"",cu_key:Math.random()*1e4},C=Je({loop_type:"array",loop_number:"",loop_arrays:[],intermediate_params:[],output:[]}),D=Xe(()=>{let R=C.intermediate_params,G=[];return R.forEach(oe=>{oe.key&&G.push({children:[],id:o.nodeId,key:oe.key,label:oe.key,node_id:o.nodeId,node_name:o.node.node_name,node_type:"25",original_value:o.nodeId+"."+oe.key,text:oe.key,typ:oe.typ,value:oe.key})}),G.length>0?[{label:o.node.node_name,node_id:o.nodeId,node_type:"25",typ:"node",value:o.nodeId,children:G}]:[]}),T=()=>{const R=JSON.stringify({loop:{...C,loop_arrays:C.loop_arrays.map(G=>({...G,value:G.value?G.value.join("."):""})),output:C.output.map(G=>({...G,value:G.value?G.value.join("."):""}))}});t("update-node",{...o.node,...C,node_params:R})};function O(R){if(R){let G=R.split("."),oe=G[0],V=G.filter((Y,Q)=>Q>0).join(".");return[oe,V]}return[]}const k=()=>{try{let R=o.node.dataRaw||o.node.node_params||"{}",G=JSON.parse(R).loop||{};G=JSON.parse(JSON.stringify(G)),f(),p(),C.loop_type=G.loop_type,C.loop_number=G.loop_number,C.loop_arrays=G.loop_arrays.map(oe=>({...oe,value:O(oe.value)})),C.intermediate_params=G.intermediate_params.map(oe=>({...oe})),C.output=G.output.map(oe=>({...oe,value:O(oe.value)})),C.loop_arrays.length==0&&(C.loop_arrays=[m]),C.intermediate_params.length==0&&(C.intermediate_params=[g]),C.output.length==0&&(C.output=[b])}catch(R){}};gt(()=>C,()=>{T()},{deep:!0});const S=()=>{C.loop_arrays.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},N=R=>{C.loop_arrays.splice(R,1)},L=(R,G,oe)=>{oe?G.typ=oe[oe.length-1].typ:G.typ=""},$=()=>{C.intermediate_params.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},B=R=>{C.intermediate_params.splice(R,1)},E=()=>{C.output.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},A=R=>{C.output.splice(R,1)},M=(R,G)=>{if(R&&R.length){let oe=D.value.filter(V=>V.value==R[0])[0].children;oe&&oe.length&&(G.typ=oe.filter(V=>V.value==R[1])[0].typ)}else G.typ=""},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],H=()=>{t("close")};return ut(()=>{k()}),(R,G)=>{const oe=Qt,V=Vt,Y=It,Q=$n,ue=ln,te=ei,q=Vn,re=kn,ce=Jt,ve=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于通过设定循环次数和逻辑，重复执行一系列任务",onClose:H},null,8,["title","iconName"])]),default:x(()=>[d("div",zM,[d("div",qM,[y(ve,{ref_key:"formRef",ref:_,layout:"vertical",model:C},{default:x(()=>[d("div",GM,[d("div",XM,[G[3]||(G[3]=d("img",{src:VM,alt:""},null,-1)),G[4]||(G[4]=z(" 循环设置 ",-1)),y(oe,null,{title:x(()=>[...G[2]||(G[2]=[z("如果引用数组，循环次数为数组的长度；如果指定次数，循环次数为指定的次数；",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",WM,[G[7]||(G[7]=d("div",{class:"form-label"},"循环类型",-1)),y(Y,{value:C.loop_type,"onUpdate:value":G[0]||(G[0]=Ne=>C.loop_type=Ne),style:{width:"170px"}},{default:x(()=>[y(V,{value:"array"},{default:x(()=>[...G[5]||(G[5]=[z("使用数组循环",-1)])]),_:1}),y(V,{value:"number"},{default:x(()=>[...G[6]||(G[6]=[z("指定循环次数",-1)])]),_:1})]),_:1},8,["value"]),C.loop_type=="number"?(w(),Z(Q,{key:0,placeholder:"请输入",style:{flex:"1"},value:C.loop_number,"onUpdate:value":G[1]||(G[1]=Ne=>C.loop_number=Ne),min:1,max:100},null,8,["value"])):ie("",!0)])]),C.loop_type=="array"?(w(),P("div",YM,[d("div",KM,[G[9]||(G[9]=d("img",{src:HM,alt:""},null,-1)),G[10]||(G[10]=z(" 循环数组 ",-1)),y(oe,null,{title:x(()=>[...G[8]||(G[8]=[z("仅支持引用数组，循环次数为数组的长度",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",JM,[G[12]||(G[12]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型"),d("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),d("div",ZM,[(w(!0),P(ae,null,ye(C.loop_arrays,(Ne,ge)=>(w(),P("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",QM,[y(ue,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(ue,{style:{width:"25%"},value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(te,{value:Ne.value,"onUpdate:value":_e=>Ne.value=_e,onChange:(_e,st)=>L(_e,Ne,st),onDropdownVisibleChange:v,style:{width:"50%"},options:s.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"])]),_:2},1024),ie("",!0)])]),_:2},1024)]))),128)),C.loop_arrays.length==0?(w(),Z(ce,{key:0,onClick:S,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...G[11]||(G[11]=[z("添加参数",-1)])]),_:1},8,["icon"])):ie("",!0)])])])):ie("",!0),d("div",e4,[d("div",t4,[G[14]||(G[14]=d("img",{src:UM,alt:""},null,-1)),G[15]||(G[15]=z(" 中间变量 ",-1)),y(oe,null,{title:x(()=>[...G[13]||(G[13]=[z("变量可在多次循环中实现共享，可用于在多次循环中传递变量",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",n4,[G[17]||(G[17]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),d("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),d("div",o4,[(w(!0),P(ae,null,ye(C.intermediate_params,(Ne,ge)=>(w(),P("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",i4,[y(ue,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(Y,{value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"请选择",style:{width:"25%"}},{default:x(()=>[(w(),P(ae,null,ye(F,_e=>y(V,{value:_e.value,key:_e.value},{default:x(()=>[z(j(_e.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"]),d("div",r4,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:_e=>l(_e,"intermediate_params",ge),options:r.value,defaultSelectedList:Ne.tags,defaultValue:Ne.value,onOpen:f,onChange:(_e,st)=>u(_e,st,Ne,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:_e,payload:st})=>[d("div",s4,[d("div",a4,j(_e),1),d("div",l4,j(st.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:_e=>B(ge)},[y(ee(Kt))],8,u4)])]),_:2},1024)]))),128)),y(ce,{onClick:$,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...G[16]||(G[16]=[z("添加参数",-1)])]),_:1},8,["icon"])])])]),d("div",d4,[d("div",c4,[G[19]||(G[19]=d("img",{src:ju,alt:""},null,-1)),G[20]||(G[20]=z(" 输出 ",-1)),y(oe,null,{title:x(()=>[...G[18]||(G[18]=[z("循环完成后输出的内容，仅支持引用循环体中节点的输出变量",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",f4,[G[22]||(G[22]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),d("div",{class:"output-item",style:{width:"38%"}},"参数值")],-1)),d("div",p4,[(w(!0),P(ae,null,ye(C.output,(Ne,ge)=>(w(),P("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",h4,[y(ue,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(ue,{style:{width:"25%"},value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(te,{onChange:_e=>M(_e,Ne),value:Ne.value,"onUpdate:value":_e=>Ne.value=_e,onDropdownVisibleChange:v,style:{width:"40%"},options:D.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:_e=>A(ge)},[y(ee(Kt))],8,v4)])]),_:2},1024)]))),128)),y(ce,{onClick:St(E,["stop"]),icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...G[21]||(G[21]=[z("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])])]),_:1})}}},_4=$e(g4,[["__scopeId","data-v-4ce910cb"]]),m4={class:"field-select-box"},y4={key:0,class:"field-list-box"},b4={key:1,class:"empty-box"},x4={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),s=X([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]);X([]);const a=(c,f)=>{r.selectedRowKeys=c,r.selectedRows=f},l=({selectedRowKeys:c,selectedRows:f})=>{r.selectedRowKeys=c,r.selectedRows=f,r.show=!0},u=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1};return e({open:l}),(c,f)=>{const p=Ns,h=gn;return w(),Z(h,{width:"746px",open:r.show,"onUpdate:open":f[0]||(f[0]=v=>r.show=v),title:"关联数据表",onOk:u,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",m4,[n.fields.length?(w(),P("div",y4,[y(p,{rowKey:"field_name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:a},dataSource:n.fields,columns:s.value,loading:i.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ie("",!0),n.fields.length?ie("",!0):(w(),P("div",b4,[...f[1]||(f[1]=[d("img",{src:Ua,alt:""},null,-1),d("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},w4=$e(x4,[["__scopeId","data-v-cec4faec"]]),C4={class:"field-list"},S4={class:"field-list-row"},k4={key:0,class:"field-list-col field-list-col-head field-value-head"},E4={key:1,class:"field-list-col field-list-col-head field-del-head"},D4={key:0,class:"field-list-row"},A4={class:"field-list-col field-value-col"},O4={class:"field-list-col field-name-col"},N4={class:"field-list-col field-type-col"},M4={key:0,class:"field-list-col field-value-col"},T4={key:1,class:"field-list-col field-del-col"},$4=["onClick"],P4={key:0,class:"add-btn-box"},R4={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:[],keys:[]});gt(()=>o.list,m=>{r.list=m,r.keys=m.map(g=>g.field_name)},{immediate:!0});const s=X([]),a=()=>{let m=i().getAllParentVariable();s.value=m||[]},l=()=>{a()},u=(m,g,b,C)=>{r.list[C].value=m,r.list[C].atTags=g,p()},c=(m,g)=>{r.list=[...g],r.keys=[...m],p()},f=m=>{r.list.splice(m,1),p()},p=()=>{t("change",[...r.list],[...r.keys])},h=X(),v=()=>{h.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(m=>m.field_name)})},_=m=>{switch(m.ui_type){case"Checkbox":return"请输入true或false，键入“/”插入变量";case"MultiSelect":return"多个选项“,”分割，键入“/”插入变量"}return"请输入参数值，键入“/”插入变量"};return ut(()=>{a()}),(m,g)=>{const b=ln,C=Qt,D=Nn,T=Jt;return w(),P("div",null,[d("div",C4,[d("div",S4,[g[0]||(g[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),g[1]||(g[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),P("div",k4,"字段值")):ie("",!0),o.showDelete?(w(),P("div",E4)):ie("",!0)]),n.showEmptyFieldRow?(w(),P("div",D4,[g[2]||(g[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),g[3]||(g[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",A4,[y(C,{title:"请先选择数据库"},{default:x(()=>[y(b,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),P(ae,null,ye(r.list,(O,k)=>(w(),P("div",{class:"field-list-row",key:O.field_name},[d("div",O4,j(O.field_name),1),d("div",N4,j(O.ui_type),1),n.showInput?(w(),P("div",M4,[y(ot,{options:s.value,defaultValue:O.value,defaultSelectedList:O.atTags,onOpen:l,onChange:(S,N)=>u(S,N,O,k),placeholder:_(O)},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])):ie("",!0),o.showDelete?(w(),P("div",T4,[d("span",{class:"del-btn",onClick:S=>f(k)},[y(D,{class:"del-icon",name:"close-circle"})],8,$4)])):ie("",!0)]))),128))]),o.showAdd?(w(),P("div",P4,[y(T,{class:"add-btn",type:"dashed",block:"",onClick:v},{default:x(()=>[y(ee(Ht)),g[4]||(g[4]=z(" 添加字段 ",-1))]),_:1})])):ie("",!0),y(w4,{ref_key:"fieldSelectAlertRef",ref:h,fields:n.fields,onOk:c},null,8,["fields"])])}}},rf=$e(R4,[["__scopeId","data-v-8e38218b"]]),B4={class:"add-data-form"},L4={class:"node-box-content"},I4={class:"setting-box"},F4={__name:"feishu-insert-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X([]);function s(u=null){var c,f,p;r.value=[],Array.isArray((p=(f=(c=u==null?void 0:u.plugin)==null?void 0:c.params)==null?void 0:f.arguments)==null?void 0:p.fields)&&u.plugin.params.arguments.fields.length?(u.plugin.params.arguments.fields.map(h=>{h.value=h.value?h.value.toString():""}),r.value=u.plugin.params.arguments.fields):i.fields.map(h=>{r.value.push({value:"",atTags:[],...h})})}const a=u=>{r.value=u,l()},l=()=>{o("update",{fields:Bn(r.value)})};return e({init:s}),(u,c)=>(w(),P("div",B4,[d("div",L4,[c[0]||(c[0]=d("div",{class:"setting-label"},[d("span",null,"插入数据"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",I4,[y(rf,{showEmptyFieldRow:!n.tableId,list:r.value,fields:n.fields,showAdd:!1,showDelete:!1,onChange:a},null,8,["showEmptyFieldRow","list","fields"])])])]))}},j4=$e(F4,[["__scopeId","data-v-f6427818"]]),V4={class:"add-data-form"},H4={class:"node-box-content"},U4={class:"options-item is-required"},z4={class:"field-list-item"},q4={class:"field-label"},G4={class:"field-type"},X4={class:"setting-box"},W4={__name:"feishu-update-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X([]),r=Je({tags:[],value:""});function s(c=null){var f,p,h,v,_,m;i.value=[],Array.isArray((h=(p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)==null?void 0:p.arguments)==null?void 0:h.fields)&&c.plugin.params.arguments.fields.length&&(c.plugin.params.arguments.fields.map(g=>{g.value=g.value?g.value.toString():""}),i.value=c.plugin.params.arguments.fields),c&&((m=(_=(v=c==null?void 0:c.plugin)==null?void 0:v.params)==null?void 0:_.arguments)!=null&&m.record_id)&&(r.value=c.plugin.params.arguments.record_id,r.tags=c.plugin.params.arguments.record_tags||[])}const a=c=>{i.value=c,u()};function l(c,f){r.value=c,r.tags=f,u()}const u=()=>{o("update",{record_id:r.value,record_tags:r.tags,fields:Bn(i.value)})};return e({init:s}),(c,f)=>(w(),P("div",V4,[d("div",H4,[d("div",U4,[f[1]||(f[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"record_id"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:r.tags,defaultValue:r.value,ref:"atInputRef",onOpen:f[0]||(f[0]=p=>o("updateVar")),onChange:l,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:p,payload:h})=>[d("div",z4,[d("div",q4,j(p),1),d("div",G4,j(h.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[2]||(f[2]=d("div",{class:"desc"},'待更新的记录ID；示例值："reCWNXZPQv"',-1))]),d("div",X4,[y(rf,{showEmptyFieldRow:!n.tableId,list:i.value,fields:n.fields,showAdd:!0,showDelete:!0,onChange:a},null,8,["showEmptyFieldRow","list","fields"])])])]))}},Y4=$e(W4,[["__scopeId","data-v-15fd9788"]]),K4={class:"options-item is-required"},J4={class:"field-list-item"},Z4={class:"field-label"},Q4={class:"field-type"},eT={__name:"feishu-del-data",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tags:[],value:""});function r(a=null){var l,u,c;a&&((c=(u=(l=a==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)!=null&&c.record_id)&&(i.value=a.plugin.params.arguments.record_id,i.tags=a.plugin.params.arguments.record_tags||[])}function s(a,l){i.value=a,i.tags=l,o("update",{record_id:a,record_tags:l})}return e({init:r}),(a,l)=>(w(),P("div",K4,[l[1]||(l[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"record_id"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:i.tags,defaultValue:i.value,ref:"atInputRef",onOpen:l[0]||(l[0]=u=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:u,payload:c})=>[d("div",J4,[d("div",Z4,j(u),1),d("div",Q4,j(c.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),l[2]||(l[2]=d("div",{class:"desc"},'待删除的记录ID；示例值："reCWNXZPQv"',-1))]))}},tT=$e(eT,[["__scopeId","data-v-17c9a3b0"]]),Pg=[{key:"is",label:"是"},{key:"isNot",label:"不是"},{key:"contains",label:"包含"},{key:"doesNotContain",label:"不包含"},{key:"isEmpty",label:"为空"},{key:"isNotEmpty",label:"不为空"},{key:"isGreater",label:"大于"},{key:"isGreaterEqual",label:"大于等于"},{key:"isLess",label:"小于"},{key:"isLessEqual",label:"小于等于"}];function Rg(){let n={};for(let e of Pg)n[e.key]=e;return n}const nT=["Text","SingleSelect","MultiSelect","DateTime","Number","Checkbox"],oT={Text:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],Number:["is","isNot","isEmpty","isNotEmpty","isGreater","isGreaterEqual","isLess","isLessEqual"],SingleSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],MultiSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],DateTime:["is","isEmpty","isNotEmpty","isGreater","isLess"],Checkbox:["is"]};function iT(n){let e=oT[n]||[];return Pg.filter(t=>e.includes(t.key))}const zd=["batch_create_record","batch_delete_record","batch_get_record","batch_update_record"];function Bg(n){const e=["app_id","app_secret","app_token","table_id"],t={};for(let o in n)!e.includes(o)&&n[o].required&&(t[o]=JSON.parse(JSON.stringify(n[o])));return t}const rT={class:"query-condition-filter"},sT={class:"condition-select-box"},aT={class:"select-wrapper"},lT={class:"field-items"},uT={class:"field-select-box"},dT={class:"operator-select-box"},cT={class:"field-value-box"},fT=["onClick"],pT={class:"add-btn-box"},hT={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},conjunction:{type:String,default:"and"}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:[],conjunction:"and"});gt(()=>o.where,g=>{r.list=g},{immediate:!0}),gt(()=>o.conjunction,g=>{r.conjunction=g},{immediate:!0});const s=Xe(()=>o.where.length>1),a=X([]),l=()=>{let g=i().getAllParentVariable();a.value=g||[]},u=()=>{l()},c=()=>{let g={conjunction:r.conjunction,list:r.list};t("change",g)},f=(g,b,C,D)=>{r.list[D].value=g,r.list[D].atTags=b,c()},p=(g,b)=>{r.list[b].value="",c()},h=()=>{let g={field_id:"",field_name:"",field_type:"",operator:void 0,value:"",atTags:[]};r.list.push(g),c()},v=g=>{r.list.splice(g,1),c()},_=(g,b)=>{let C={field_id:b.key,field_name:b.value,field_type:b.type,operator:void 0,value:"",atTags:[]};r.list[g]=C,c()},m=({key:g})=>{r.conjunction=g,c()};return ut(()=>{l()}),(g,b)=>{const C=Pr,D=$r,T=Rr,O=Vt,k=It,S=ln,N=Nn,L=Jt,$=Qt;return w(),P("div",{class:Ct(["query-condition-filter-warpper",{"is-multiple":s.value}])},[d("div",rT,[b[3]||(b[3]=d("div",{class:"auxiliary-line"},null,-1)),d("div",sT,[d("div",aT,[y(T,null,{overlay:x(()=>[y(D,{style:{width:"100px"},onClick:m},{default:x(()=>[y(C,{key:"and"},{default:x(()=>[...b[1]||(b[1]=[d("a",{href:"javascript:;"},"且",-1)])]),_:1}),y(C,{key:"or"},{default:x(()=>[...b[2]||(b[2]=[d("a",{href:"javascript:;"},"或",-1)])]),_:1})]),_:1})]),default:x(()=>[d("a",{class:"ant-dropdown-link",onClick:b[0]||(b[0]=St(()=>{},["prevent"]))},[z(j(r.conjunction=="and"?"且":"或")+" ",1),y(ee($o))])]),_:1})])]),d("div",lT,[(w(!0),P(ae,null,ye(r.list,(B,E)=>(w(),P("div",{class:"field-item",key:B.field},[d("div",uT,[y(k,{style:{width:"100px"},value:B.field_name,"onUpdate:value":A=>B.field_name=A,onChange:(A,M)=>_(E,M)},{default:x(()=>[(w(!0),P(ae,null,ye(o.fieldOptions,A=>(w(),Z(O,{value:A.field_name,type:A.ui_type,key:A.field_id},{default:x(()=>[z(j(A.field_name),1)]),_:2},1032,["value","type"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),d("div",dT,[y(k,{value:B.operator,"onUpdate:value":A=>B.operator=A,style:{width:"100px"},onChange:()=>p(B,E)},{default:x(()=>[(w(!0),P(ae,null,ye(ee(iT)(B.field_type),A=>(w(),Z(O,{value:A.key,key:A.key},{default:x(()=>[z(j(A.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),d("div",cT,[["isEmpty","isNotEmpty"].includes(B.operator)?(w(),Z(S,{key:0,placeholder:"无需输入值",disabled:""})):(w(),Z(ot,{key:1,options:a.value,defaultValue:B.value,defaultSelectedList:B.atTags,onOpen:u,onChange:(A,M)=>f(A,M,B,E),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),d("span",{class:"field-del-btn",onClick:A=>v(E)},[y(N,{class:"del-icon",name:"close-circle"})],8,fT)]))),128))])]),d("div",pT,[n.disabled?(w(),Z($,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(L,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(ee(Ht)),b[4]||(b[4]=z(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Z(L,{key:1,class:"add-btn",type:"dashed",block:"",onClick:h},{default:x(()=>[y(ee(Ht)),b[5]||(b[5]=z(" 添加条件 ",-1))]),_:1}))])],2)}}},vT=$e(hT,[["__scopeId","data-v-503e3c45"]]),gT={class:"field-select-box"},_T={key:0,class:"field-list-box"},mT={key:1,class:"empty-box"},yT={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),r=X([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]),s=(u,c)=>{i.selectedRowKeys=u,i.selectedRows=c},a=({selectedRowKeys:u,selectedRows:c})=>{i.selectedRowKeys=u,i.selectedRows=c,i.show=!0},l=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:a}),(u,c)=>{const f=Ns,p=gn;return w(),Z(p,{width:"746px",open:i.show,"onUpdate:open":c[0]||(c[0]=h=>i.show=h),title:"关联数据表",onOk:l,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",gT,[n.fields.length?(w(),P("div",_T,[y(f,{rowKey:"field_name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:s},dataSource:n.fields,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ie("",!0),n.fields.length?ie("",!0):(w(),P("div",mT,[...c[1]||(c[1]=[d("img",{src:Ua,alt:""},null,-1),d("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},bT=$e(yT,[["__scopeId","data-v-41ac4319"]]),xT={class:"field-list"},wT={class:"field-list-col field-drag-col"},CT={class:"drag-btn"},ST={class:"field-list-col field-name-col"},kT={class:"field-name-box"},ET={class:"field-name"},DT={class:"field-type-tag"},AT={class:"field-list-col field-value-col"},OT={key:0,class:"field-list-col field-del-col"},NT={class:"add-btn-box"},MT={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=X(),s=X([]);gt(()=>o.list,p=>{s.value=p.map(h=>({...h,is_asc:h.is_asc?1:0}))});const a=p=>{s.value.splice(p,1),c()},l=(p,h)=>{s.value=h.map(v=>({...v})),c()},u=()=>{c()},c=()=>{let p=s.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",p)},f=()=>{r.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(p=>p.field_name)})};return(p,h)=>{const v=Vt,_=It,m=Nn,g=Jt,b=Qt;return w(),P("div",null,[d("div",xT,[(w(!0),P(ae,null,ye(s.value,C=>(w(),P("div",{class:"field-list-row",key:C.name},[d("div",wT,[d("span",CT,[y(ee(Kc))])]),d("div",ST,[d("div",kT,[d("span",ET,j(C.field_name),1),d("span",DT,j(C.ui_type),1)])]),d("div",AT,[y(_,{value:C.is_asc,"onUpdate:value":D=>C.is_asc=D,style:{width:"100%"},onChange:u},{default:x(()=>[(w(),P(ae,null,ye(i,D=>y(v,{value:D.value,key:D.key},{default:x(()=>[z(j(D.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),P("div",OT,[d("span",{class:"del-btn",onClick:h[0]||(h[0]=D=>a(p.index))},[y(m,{class:"del-icon",name:"close-circle"})])])):ie("",!0)]))),128))]),d("div",NT,[n.disabled?(w(),Z(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(g,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(ee(Ht)),h[1]||(h[1]=z(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Z(g,{key:1,class:"add-btn",type:"dashed",block:"",onClick:f},{default:x(()=>[y(ee(Ht)),h[2]||(h[2]=z(" 添加排序字段 ",-1))]),_:1}))]),y(bT,{fields:n.fields,ref_key:"fieldSelectAlertRef",ref:r,onOk:l},null,8,["fields"])])}}},TT=$e(MT,[["__scopeId","data-v-eb691a7b"]]),$T={class:"select-data-form"},PT={class:"node-box-content"},RT={class:"setting-box"},BT={class:"field-list-item"},LT={class:"field-label"},IT={class:"field-type"},FT={class:"field-list-item"},jT={class:"field-label"},VT={class:"field-type"},HT={class:"field-list-item"},UT={class:"field-label"},zT={class:"field-type"},qT={__name:"feishu-search-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r={field_names:[],filter:{conjunction:"and",conditions:[]},sort:[],page_size:100,field_names_json:"",filter_json:"",sort_json:"",input_type_map:{field_names:1,filter:1,sort:1},tag_map:{}},s=Je(JSON.parse(JSON.stringify(r)));function a(h=null){var v,_,m,g;if(!h)Object.assign(s,JSON.parse(JSON.stringify(r)));else{let{field_names:b,filter:C,sort:D,page_size:T,input_type_map:O,tag_map:k}=((_=(v=h==null?void 0:h.plugin)==null?void 0:v.params)==null?void 0:_.arguments)||{};if(Array.isArray(C.conditions)&&C.conditions.length){for(let S of C.conditions)S.field_type==="DateTime"&&(S.value=S.value.replace(/\D/g,""));s.filter=C}else s.filter={conjunction:"and",conditions:[]};Array.isArray(b)&&(O==null?void 0:O.field_names)!=2?b.map(S=>{let N=i.fields.find(L=>L.field_name==S);N&&s.field_names.push(N)}):s.field_names=Array.isArray(b)?b:[],Array.isArray(D)&&(O==null?void 0:O.sort)!=2?s.sort=D.map(S=>({...i.fields.find(L=>L.field_name==S.field_name),is_asc:S.desc?0:1})):s.sort=Array.isArray(D)?D:[],O&&(s.input_type_map=O);for(let S in O)if(O[S]==2){let N=JSON.stringify(s[S]);Array.isArray(s[S])?s[S].length||(N=""):(g=(m=s[S])==null?void 0:m.conditions)!=null&&g.length||(N=""),s[`${S}_json`]=N}s.tag_map=k||{},s.page_size=T||100}}const l=({conjunction:h,list:v})=>{s.filter.conjunction=h,s.filter.conditions=v,p()},u=h=>{s.sort=[...h],p()},c=h=>{s.field_names=h,p()};function f(h,v,_){s[h]=v,s.tag_map[h]=_,p()}function p(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a}),(h,v)=>{const _=Vt,m=It,g=$n;return w(),P("div",$T,[d("div",PT,[d("div",RT,[y(os,{title:"查询条件",count:s.filter.conditions.length},{extra:x(()=>[y(m,{value:s.input_type_map.filter,"onUpdate:value":v[0]||(v[0]=b=>s.input_type_map.filter=b),style:{width:"130px"},onChange:p},{default:x(()=>[y(_,{value:1},{default:x(()=>[...v[16]||(v[16]=[z("选择查询条件",-1)])]),_:1}),y(_,{value:2},{default:x(()=>[...v[17]||(v[17]=[z("输入变量",-1)])]),_:1})]),_:1},8,["value"])]),default:x(()=>{var b;return[s.input_type_map.filter!=1?(w(),P(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((b=s.tag_map)==null?void 0:b.filter_json)||[],defaultValue:s.filter_json,ref:"atInputRef",onOpen:v[1]||(v[1]=C=>o("updateVar")),onChange:v[2]||(v[2]=(C,D)=>f("filter_json",C,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:C,payload:D})=>[d("div",BT,[d("div",LT,j(C),1),d("div",IT,j(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),v[18]||(v[18]=d("div",{class:"desc"},'内容示例：{"conditions":[{"field_name":"文章ID","operator":"is","value":"123"}],"conjunction":"and"}',-1))],64)):(w(),Z(vT,{key:1,disabled:!n.tableId,where:s.filter.conditions,"field-options":n.fields,conjunction:s.filter.conjunction,onChange:l},null,8,["disabled","where","field-options","conjunction"]))]}),_:1},8,["count"])]),d("div",{class:"setting-box",onWheel:v[6]||(v[6]=St(()=>{},["stop"])),onTouchmove:v[7]||(v[7]=St(()=>{},["stop"]))},[y(os,{title:"查询字段",count:s.field_names.length},{extra:x(()=>[y(m,{value:s.input_type_map.field_names,"onUpdate:value":v[3]||(v[3]=b=>s.input_type_map.field_names=b),style:{width:"130px"},onChange:p},{default:x(()=>[y(_,{value:1},{default:x(()=>[...v[19]||(v[19]=[z("选择查询字段",-1)])]),_:1}),y(_,{value:2},{default:x(()=>[...v[20]||(v[20]=[z("输入变量",-1)])]),_:1})]),_:1},8,["value"])]),default:x(()=>{var b;return[s.input_type_map.field_names!=1?(w(),P(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((b=s.tag_map)==null?void 0:b.field_names_json)||[],defaultValue:s.field_names_json,ref:"atInputRef",onOpen:v[4]||(v[4]=C=>o("updateVar")),onChange:v[5]||(v[5]=(C,D)=>f("field_names_json",C,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:C,payload:D})=>[d("div",FT,[d("div",jT,j(C),1),d("div",VT,j(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),v[21]||(v[21]=d("div",{class:"desc"},'内容示例：["文章ID","封面图","创建时间","介绍"]',-1))],64)):(w(),Z(rf,{key:1,showAdd:!!n.tableId,showInput:!1,showEmptyFieldRow:!n.tableId,list:s.field_names,fields:n.fields,onChange:c},null,8,["showAdd","showEmptyFieldRow","list","fields"]))]}),_:1},8,["count"])],32),d("div",{class:"setting-box",onWheel:v[11]||(v[11]=St(()=>{},["stop"])),onTouchmove:v[12]||(v[12]=St(()=>{},["stop"]))},[y(os,{title:"排序",count:s.sort.length},{extra:x(()=>[y(m,{value:s.input_type_map.sort,"onUpdate:value":v[8]||(v[8]=b=>s.input_type_map.sort=b),style:{width:"130px"},onChange:p},{default:x(()=>[y(_,{value:1},{default:x(()=>[...v[22]||(v[22]=[z("选择排序",-1)])]),_:1}),y(_,{value:2},{default:x(()=>[...v[23]||(v[23]=[z("输入变量",-1)])]),_:1})]),_:1},8,["value"])]),default:x(()=>{var b;return[s.input_type_map.sort!=1?(w(),P(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((b=s.tag_map)==null?void 0:b.sort_json)||[],defaultValue:s.sort_json,ref:"atInputRef",onOpen:v[9]||(v[9]=C=>o("updateVar")),onChange:v[10]||(v[10]=(C,D)=>f("sort_json",C,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:C,payload:D})=>[d("div",HT,[d("div",UT,j(C),1),d("div",zT,j(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),v[24]||(v[24]=d("div",{class:"desc"},'内容示例：[{"desc":false,"field_name":"文章ID"},{"desc":true,"field_name":"更新时间"}]',-1))],64)):(w(),Z(TT,{key:1,disabled:!n.tableId,list:s.sort,fields:n.fields,onChange:u},null,8,["disabled","list","fields"]))]}),_:1},8,["count"])],32),v[25]||(v[25]=d("div",{class:"setting-label"},[d("span",null,"查询数量")],-1)),d("div",{class:"setting-box",onWheel:v[14]||(v[14]=St(()=>{},["stop"])),onTouchmove:v[15]||(v[15]=St(()=>{},["stop"]))},[y(g,{value:s.page_size,"onUpdate:value":v[13]||(v[13]=b=>s.page_size=b),disabled:!n.tableId,min:20,max:500,style:{width:"205px"},onChange:p},null,8,["value","disabled"])],32)])])}}},GT=$e(qT,[["__scopeId","data-v-044a8110"]]),XT={class:"field-item"},WT={class:"field-key"},YT={class:"tip-content"},KT={class:"field-type"},JT={class:"field-name"},ZT={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=Nn,s=Qt,a=Jc;return w(),P("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[d("span",{class:Ct(l)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[d("div",XT,[d("span",WT,j(l.key),1),l.tip?(w(),Z(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[d("div",YT,j(l.tip),1)]),default:x(()=>[y(ee(yt),{style:{"margin-left":"4px"}})]),_:2},1024)):ie("",!0),d("span",KT,j(l.typ),1),d("span",JT,j(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},Bi=$e(ZT,[["__scopeId","data-v-5086883a"]]),QT={class:"add-data-form"},e6={class:"node-box-content"},t6={class:"options-item-tit"},n6={class:"option-label"},o6={class:"option-type"},i6={class:"field-list-item"},r6={class:"field-label"},s6={class:"field-type"},a6={class:"desc"},l6={__name:"feishu-batch-box",props:{actionName:{type:String},action:{type:Object},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Je({});ut(()=>{s()});function s(u=null){var c,f,p;if(Object.assign(r,Bg(((c=i.action)==null?void 0:c.params)||{})),u){let h=((p=(f=u==null?void 0:u.plugin)==null?void 0:f.params)==null?void 0:p.arguments)||{},v=(h==null?void 0:h.tag_map)||{};for(let _ in r)r[_].value=h[_]||"",r[_].tags=v[_]||[]}}function a(u,c,f){u.value=c,u.tags=f,l()}const l=()=>{let u={tag_map:{}};for(let c in r)u[c]=r[c].value,u.tag_map[c]=r[c].tags;o("update",u)};return e({init:s}),(u,c)=>(w(),P("div",QT,[d("div",e6,[(w(!0),P(ae,null,ye(r,(f,p)=>(w(),P("div",{key:p,class:"options-item is-required"},[d("div",t6,[d("div",n6,j(f.name||p),1),d("div",o6,j(f.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:f.tags,defaultValue:f.value,ref_for:!0,ref:"atInputRef",onOpen:c[0]||(c[0]=h=>o("updateVar")),onChange:(h,v)=>a(f,h,v),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:h,payload:v})=>[d("div",i6,[d("div",r6,j(h),1),d("div",s6,j(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",a6,j(f.desc),1)]))),128))])]))}},u6={class:"options-item is-required"},d6={class:"min-input"},c6={class:"field-list-item"},f6={class:"field-label"},p6={class:"field-type"},h6={__name:"feishu-create-bitable",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tag_map:{},name:""});function r(l=null){var u,c,f;l&&((f=(c=(u=l==null?void 0:l.plugin)==null?void 0:u.params)==null?void 0:c.arguments)!=null&&f.name)&&(i.name=l.plugin.params.arguments.name,i.tag_map=l.plugin.params.arguments.tag_map||{})}function s(l,u){i.name=l,i.tag_map.name=u,a()}function a(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:r,update:a}),(l,u)=>(w(),P("div",u6,[u[1]||(u[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表格名称"),d("div",{class:"option-type"},"string")],-1)),d("div",d6,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:i.tag_map.name||[],defaultValue:i.name,ref:"atInputRef",onOpen:u[0]||(u[0]=c=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:c,payload:f})=>[d("div",c6,[d("div",f6,j(c),1),d("div",p6,j(f.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),u[2]||(u[2]=d("div",{class:"desc"},'多维表格 App 名称。最长为 255 个字符。 示例值："一篇新的多维表格"',-1))]))}},v6=$e(h6,[["__scopeId","data-v-6b8b4adc"]]),g6={class:"options-item is-required"},_6={class:"min-input"},m6={class:"field-list-item"},y6={class:"field-label"},b6={class:"field-type"},x6={class:"options-item"},w6={class:"min-input"},C6={class:"field-list-item"},S6={class:"field-label"},k6={class:"field-type"},E6={class:"options-item"},D6={class:"options-item-tit flex-between"},A6={class:"field-list-item"},O6={class:"field-label"},N6={class:"field-type"},M6={__name:"feishu-create-table",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(null),r=X(null),s=Je({name:"",default_view_name:"",fields:"",tag_map:{}});function a(p=null){var h,v,_,m,g,b;p&&((v=(h=p==null?void 0:p.plugin)==null?void 0:h.params)!=null&&v.arguments)&&(s.name=((_=p.plugin.params.arguments)==null?void 0:_.name)||"",s.default_view_name=((m=p.plugin.params.arguments)==null?void 0:m.default_view_name)||"",s.fields=((g=p.plugin.params.arguments)==null?void 0:g.fields)||"",s.tag_map=((b=p.plugin.params.arguments)==null?void 0:b.tag_map)||{})}function l(p,h,v){s[p]=h,s.tag_map[p]=v,f()}function u(){i.value.show()}function c(){r.value.refresh()}function f(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:f}),(p,h)=>{var v,_,m,g;return w(),P("div",null,[d("div",g6,[h[8]||(h[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"数据表名称"),d("div",{class:"option-type"},"string")],-1)),d("div",_6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((v=s==null?void 0:s.tag_map)==null?void 0:v.name)||[],defaultValue:s.name,ref_key:"atInputRef",ref:r,onOpen:h[0]||(h[0]=b=>o("updateVar")),onChange:h[1]||(h[1]=(b,C)=>l("name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",m6,[d("div",y6,j(b),1),d("div",b6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[9]||(h[9]=d("div",{class:"desc"},'数据表名称；名称中的首尾空格将会被默认去除，不可以包含 / \\\\ ? * : [ ] 等特殊字符"；1 字符 ～ 100 字符 ',-1))]),d("div",x6,[h[10]||(h[10]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"表格视图的名称"),d("div",{class:"option-type"},"string")],-1)),d("div",w6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((_=s==null?void 0:s.tag_map)==null?void 0:_.default_view_name)||[],defaultValue:s.default_view_name,ref_key:"atInputRef",ref:r,onOpen:h[2]||(h[2]=b=>o("updateVar")),onChange:h[3]||(h[3]=(b,C)=>l("default_view_name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",C6,[d("div",S6,j(b),1),d("div",k6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[11]||(h[11]=d("div",{class:"desc"},"表格视图的名称；名称中的首尾空格将会被默认去除，名称中不允许包含 [ ] 两个字符",-1))]),d("div",E6,[d("div",D6,[h[12]||(h[12]=d("div",{class:"flex-between"},[d("div",{class:"option-label"},"数据表的初始字段"),d("div",{class:"option-type"},"jsonString")],-1)),d("div",{class:"btn-hover-wrap",onClick:u},[y(ee(Br))])]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((m=s==null?void 0:s.tag_map)==null?void 0:m.fields)||[],defaultValue:s.fields,ref_key:"atInputRef",ref:r,onOpen:h[4]||(h[4]=b=>o("updateVar")),onChange:h[5]||(h[5]=(b,C)=>l("fields",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",A6,[d("div",O6,j(b),1),d("div",N6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[13]||(h[13]=d("div",{class:"desc"},'如果传入了 表格视图的名称，则必须传入 数据表的初始字段。示例：[{"field_name":"索引字段","type":1},{"field_name":"单选","type":3,"ui_type":"SingleSelect","property":{"options":[{"name":"Enabled"},{"name":"Disabled"}]}}] ',-1))]),y(za,{options:n.variableOptions,defaultSelectedList:((g=s==null?void 0:s.tag_map)==null?void 0:g.fields)||[],defaultValue:s.fields,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:h[6]||(h[6]=b=>o("updateVar")),onChange:h[7]||(h[7]=(b,C)=>l("fields",b,C)),onOk:c,ref_key:"fullAtInputRef",ref:i},null,8,["options","defaultSelectedList","defaultValue"])])}}},T6=$e(M6,[["__scopeId","data-v-20965464"]]),$6={class:"options-item is-required"},P6={class:"min-input"},R6={class:"field-list-item"},B6={class:"field-label"},L6={class:"field-type"},I6={class:"options-item"},F6={class:"min-input"},j6={__name:"feishu-create-view",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({view_name:"",view_type:"grid",tag_map:{}}),r=[{label:"表格视图",value:"grid"},{label:"看板视图",value:"kanban"},{label:"画册视图",value:"gallery"},{label:"甘特视图",value:"gantt"},{label:"表单视图",value:"form"}];function s(u=null){var c,f,p,h,v;u&&((f=(c=u==null?void 0:u.plugin)==null?void 0:c.params)!=null&&f.arguments)&&(i.name=((p=u.plugin.params.arguments)==null?void 0:p.name)||"",i.view_name=((h=u.plugin.params.arguments)==null?void 0:h.view_name)||"",i.tag_map=((v=u.plugin.params.arguments)==null?void 0:v.tag_map)||{})}function a(u,c,f){i[u]=c,i.tag_map[u]=f,l()}function l(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:s,update:l}),(u,c)=>{var p;const f=It;return w(),P("div",null,[d("div",$6,[c[3]||(c[3]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"视图名称"),d("div",{class:"option-type"},"string")],-1)),d("div",P6,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((p=i==null?void 0:i.tag_map)==null?void 0:p.view_name)||[],defaultValue:i.view_name,ref:"atInputRef",onOpen:c[0]||(c[0]=h=>o("updateVar")),onChange:c[1]||(c[1]=(h,v)=>a("view_name",h,v)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:h,payload:v})=>[d("div",R6,[d("div",B6,j(h),1),d("div",L6,j(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),c[4]||(c[4]=d("div",{class:"desc"},"视图名称。名称不能包含特殊字符；不可以包含 [ ] 等特殊字符；1 字符 ～ 100 字符",-1))]),d("div",I6,[c[5]||(c[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"视图类型"),d("div",{class:"option-type"},"string")],-1)),d("div",F6,[y(f,{value:i.view_type,"onUpdate:value":c[2]||(c[2]=h=>i.view_type=h),options:r,placeholder:"选择视图",style:{width:"100%"}},null,8,["value"])]),c[6]||(c[6]=d("div",{class:"desc"},"视图类型，默认为表格视图。",-1))])])}}},V6=$e(j6,[["__scopeId","data-v-94374f0f"]]),H6={class:"options-item is-required"},U6={class:"min-input"},z6={class:"field-list-item"},q6={class:"field-label"},G6={class:"field-type"},X6={class:"options-item is-required"},W6={class:"min-input"},Y6={class:"options-item is-required"},K6={class:"min-input"},J6={class:"field-list-item"},Z6={class:"field-label"},Q6={class:"field-type"},e$={__name:"feishu-add-members",props:{config:{type:Object,default:()=>({app_id:"",app_secret:"",app_token:""})},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=["user_id"],r=X(null);X([]);const s=Je({member_id:"",role_id:void 0,role_name:"",member_id_type:"user_id",tag_map:{}});function a(c=null){var f,p;c&&((p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)!=null&&p.arguments)&&Object.assign(s,c.plugin.params.arguments)}function l(c,f,p){s[c]=f,s.tag_map[c]=p,u()}function u(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:u}),(c,f)=>{var v,_;const p=Vt,h=It;return w(),P("div",null,[d("div",H6,[f[5]||(f[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择角色"),d("div",{class:"option-type"},"string")],-1)),d("div",U6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((v=s==null?void 0:s.tag_map)==null?void 0:v.role_id)||[],defaultValue:s.role_id,ref_key:"atInputRef",ref:r,onOpen:f[0]||(f[0]=m=>o("updateVar")),onChange:f[1]||(f[1]=(m,g)=>l("role_id",m,g)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:m,payload:g})=>[d("div",z6,[d("div",q6,j(m),1),d("div",G6,j(g.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",X6,[f[6]||(f[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"协作者ID的类型"),d("div",{class:"option-type"},"string")],-1)),d("div",W6,[y(h,{value:s.member_id_type,"onUpdate:value":f[2]||(f[2]=m=>s.member_id_type=m),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),P(ae,null,ye(i,m=>y(p,{key:m},{default:x(()=>[z(j(m),1)]),_:2},1024)),64))]),_:1},8,["value"])]),f[7]||(f[7]=d("div",{class:"desc"},"协作者ID的类型，仅支持 user_id",-1))]),d("div",Y6,[f[8]||(f[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"协作者ID"),d("div",{class:"option-type"},"string")],-1)),d("div",K6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((_=s==null?void 0:s.tag_map)==null?void 0:_.member_id)||[],defaultValue:s.member_id,ref_key:"atInputRef",ref:r,onOpen:f[3]||(f[3]=m=>o("updateVar")),onChange:f[4]||(f[4]=(m,g)=>l("member_id",m,g)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:m,payload:g})=>[d("div",J6,[d("div",Z6,j(m),1),d("div",Q6,j(g.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[9]||(f[9]=d("div",{class:"desc"},[z("协作者ID，"),d("a",{href:"https://open.feishu.cn/document/platform-overveiw/basic-concepts/user-identity-introduction/open-id",target:"_blank"},"如何获取协作者ID")],-1))])])}}},t$=$e(e$,[["__scopeId","data-v-cfbe8e15"]]),n$={class:"options-item is-required"},o$={class:"min-input"},i$={class:"field-list-item"},r$={class:"field-label"},s$={class:"field-type"},a$={class:"options-item is-required"},l$={class:"flex-between"},u$={class:"min-input"},d$={__name:"feishu-update-advanced",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(null),r=Je({name:"",is_advanced:"0",tag_map:{}});function s(c=null){var f,p;c&&((p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)!=null&&p.arguments)&&Object.assign(r,c.plugin.params.arguments)}function a(c,f,p){r[c]=f,r.tag_map[c]=p,u()}function l(c){r.is_advanced=c?"1":"0",u()}function u(){o("update",JSON.parse(JSON.stringify(r)))}return e({init:s,update:u}),(c,f)=>{var _;const p=Ti,h=Ri,v=Pi;return w(),P("div",null,[d("div",n$,[f[3]||(f[3]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表格的名称"),d("div",{class:"option-type"},"string")],-1)),d("div",o$,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((_=r==null?void 0:r.tag_map)==null?void 0:_.name)||[],defaultValue:r.name,ref_key:"atInputRef",ref:i,onOpen:f[0]||(f[0]=m=>o("updateVar")),onChange:f[1]||(f[1]=(m,g)=>a("name",m,g)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:m,payload:g})=>[d("div",i$,[d("div",r$,j(m),1),d("div",s$,j(g.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[4]||(f[4]=d("div",{class:"desc"},"更新多维表格的名称",-1))]),d("div",a$,[d("div",l$,[f[5]||(f[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"开启高级权限"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(p,{checked:r.is_advanced>0,onChange:l},null,8,["checked"])])]),d("div",u$,[y(v,{value:r.is_advanced,"onUpdate:value":f[2]||(f[2]=m=>r.is_advanced=m),disabled:r.is_advanced<1,onChange:u},{default:x(()=>[y(h,{value:"1"},{default:x(()=>[...f[6]||(f[6]=[z("开启",-1)])]),_:1}),y(h,{value:"2"},{default:x(()=>[...f[7]||(f[7]=[z("关闭",-1)])]),_:1})]),_:1},8,["value","disabled"])]),f[8]||(f[8]=d("div",{class:"desc"},"多维表格是否已开启高级权限，开关关闭则不更新设置",-1))])])}}},c$=$e(d$,[["__scopeId","data-v-8de342e2"]]),f$={class:"main-box"},p$={key:0,class:"loading-box"},h$={class:"node-options"},v$={class:"options-title"},g$={class:"options-item is-required"},_$={class:"min-input"},m$={class:"field-list-item"},y$={class:"field-label"},b$={class:"field-type"},x$={key:0,class:"options-item is-required"},w$={class:"flex-center min-input"},C$={class:"field-list-item"},S$={class:"field-label"},k$={class:"field-type"},E$={class:"node-options"},D$={class:"options-item"},tp="feishu_bitable",A$={__name:"feishu-bittable-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r={search_records:GT,create_record:j4,update_record:Y4,delete_record:tT,create_bitable:v6,create_tables:T6,create_views:V6,table_add_members:t$,update_advanced:c$},s=X(null),a=X(null),l=X({}),u=X(null),c=Je({app_token:"",table_id:void 0,tag_map:{},table_set_type:"1"}),f=X(!1),p=X(!1),h=X({}),v=X([]),_=X([]),m=Xe(()=>{var H;return((H=l.value)==null?void 0:H[u.value])||{}}),g=X([]);ut(()=>{b()});async function b(){await D(),S(),F()}function C(){a.value.show(l.value)}async function D(H=!1){await mg(tp,H).then(R=>{l.value=R||{};for(let G in l.value)if(l.value[G].is_default){u.value=G;break}u.value||(u.value=Object.keys(l.value)[0])})}function T(){return f.value=!0,h.value={},v.value=[],Ud(c.app_token)?Po({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_tables",arguments:{app_id:m.value.appid,app_secret:m.value.app_secret,app_token:c.app_token}})}).then(H=>(h.value=(H==null?void 0:H.data)||{},v.value=h.value.items||[],!c.table_id&&v.value.length==1&&(c.table_id=v.value[0].table_id,E()),H)).finally(()=>{f.value=!1}):(f.value=!1,Promise.resolve(null))}function O(){var H,R;return p.value=!0,_.value=[],!Ud(c.app_token)||!c.table_id||(R=(H=c.tag_map)==null?void 0:H.table_id)!=null&&R.length?(p.value=!1,Promise.resolve(null)):Po({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_table_fields",arguments:{app_id:m.value.appid,app_secret:m.value.app_secret,app_token:c.app_token,table_id:c.table_id}})}).then(G=>{var V;let oe=((V=G==null?void 0:G.data)==null?void 0:V.items)||[];return _.value=oe.filter(Y=>nT.includes(Y.ui_type)),G}).finally(()=>{p.value=!1})}function k(H){var R,G,oe;if(!H)return yg(tp,o.actionName);H=JSON.parse(JSON.stringify(H));for(let V in H)switch(V){case"filter":if(Array.isArray(H.filter.conditions)&&H.filter.conditions.length)for(let Y of H.filter.conditions)Y.field_type==="DateTime"&&Y.value&&(Y.value<1e11&&(Y.value*=1e3),Y.value=["ExactDate",Y.value].join(","));break;case"fields":for(let Y of H.fields)(R=Y==null?void 0:Y.atTags)!=null&&R.length||(Y.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(Y.ui_type)&&(Y.value=Number(Y.value)),Y.ui_type==="Currency"&&(Y.value=Y.value.toFixed(2))),Y.ui_type==="Checkbox"&&(Y.value=Y.value=="true"),Y.ui_type==="MultiSelect"&&(Y.value=Y.value.replace(/，/g,",").split(",")),Y.ui_type==="DateTime"&&Y.value<1e11&&(Y.value*=1e3));break;case"field_names":H.field_names=H.field_names.map(Y=>Y.field_name);break;case"sort":H.sort=H.sort.map(Y=>({field_name:Y.field_name,desc:Y.is_asc!=1}));break;case"input_type_map":for(let Y in H[V])H[V][Y]==2&&(H[Y]=To(H[`${Y}_json`],Y=="filter"?{}:[]));break}return H.tag_map&&(c.tag_map={...H.tag_map,app_token:((G=c==null?void 0:c.tag_map)==null?void 0:G.app_token)||[],table_id:((oe=c==null?void 0:c.tag_map)==null?void 0:oe.table_id)||[]}),delete H.field_names_json,delete H.filter_json,delete H.sort_json,H}function S(){var G,oe;let H=JSON.parse(o.node.node_params),R=((oe=(G=H==null?void 0:H.plugin)==null?void 0:G.params)==null?void 0:oe.arguments)||{};if(R.table_set_type&&(c.table_set_type=R.table_set_type),R.tag_map&&(c.tag_map=R.tag_map),R.app_token&&(c.app_token=R.app_token),R.table_id&&(c.table_id=R.table_id),R.app_id&&R.app_secret)for(let V in l.value){let Y=l.value[V];Y.appid==R.app_id&&Y.app_secret==R.app_secret&&(u.value=V)}A(H),c.app_token&&!["table_add_members","update_advanced"].includes(o.actionName)&&T(),c.table_id&&O().then(()=>A(H))}function N(){var H,R;c.table_set_type==1?(c.table_id=((R=(H=v.value)==null?void 0:H[0])==null?void 0:R.table_id)||void 0,c.tag_map.table_id=[]):c.table_id="",E()}function L(H,R,G){c[H]=R,c.tag_map[H]=G,H==="app_token"?B():H==="table_id"?E():M()}function $(){c.app_token="",c.table_id=void 0,h.value={},v.value=[],_.value=[],A(),M()}function B(){h.value={},v.value=[],_.value=[],c.table_id=void 0,c.app_token?T().then(()=>A()):A(),M()}function E(){_.value=[],O().then(()=>A()),M()}function A(H=null){Pt(()=>{var R;typeof((R=s.value)==null?void 0:R.init)=="function"&&s.value.init(H)})}function M(H=null){if(!H&&s.value.update)return s.value.update();let R=JSON.parse(o.node.node_params),G=v.value.find(oe=>oe.table_id==c.table_id);R.plugin.output_obj=g.value,Object.assign(R.plugin.params,{config_name:u.value,table_name:(G==null?void 0:G.name)||"",arguments:{...k(H),...c,app_id:m.value.appid,app_secret:m.value.app_secret}}),i({...o.node,node_params:JSON.stringify(R)})}function F(){g.value=yi(o.action.output)}return(H,R)=>{var Q,ue;const G=mo,oe=Vt,V=It,Y=Jt;return w(),P("div",f$,[p.value||f.value?(w(),P("div",p$,[y(G)])):ie("",!0),d("div",h$,[d("div",v$,[R[11]||(R[11]=d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")],-1)),Object.keys(l.value).length?(w(),Z(V,{key:0,value:u.value,"onUpdate:value":R[0]||(R[0]=te=>u.value=te),onChange:$},{default:x(()=>[(w(!0),P(ae,null,ye(l.value,te=>(w(),Z(oe,{key:te.name,value:te.name},{default:x(()=>[z(j(te.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Z(Y,{key:1,onClick:C},{default:x(()=>[R[10]||(R[10]=z("未授权 ",-1)),y(ee($o))]),_:1}))]),n.actionName!="create_bitable"?(w(),P(ae,{key:0},[d("div",g$,[R[12]||(R[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表")],-1)),d("div",_$,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Q=c.tag_map)==null?void 0:Q.app_token)||[],defaultValue:c.app_token,ref:"atInputRef",onOpen:R[1]||(R[1]=te=>t("updateVar")),onChange:R[2]||(R[2]=(te,q)=>L("app_token",te,q)),placeholder:"请输入文档url，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",m$,[d("div",y$,j(te),1),d("div",b$,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),R[13]||(R[13]=d("div",{class:"desc"},"多维表格的唯一标识符，支持输入文档 url",-1))]),["table_add_members","update_advanced","roles_list","create_tables"].includes(n.actionName)?ie("",!0):(w(),P("div",x$,[R[16]||(R[16]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择数据表")],-1)),d("div",w$,[y(V,{value:c.table_set_type,"onUpdate:value":R[3]||(R[3]=te=>c.table_set_type=te),onChange:N,style:{width:"112px","flex-shrink":"0"}},{default:x(()=>[y(oe,{value:"1"},{default:x(()=>[...R[14]||(R[14]=[z("选择数据表",-1)])]),_:1}),y(oe,{value:"2"},{default:x(()=>[...R[15]||(R[15]=[z("插入变量",-1)])]),_:1})]),_:1},8,["value"]),c.table_set_type==1?(w(),Z(V,{key:0,value:c.table_id,"onUpdate:value":R[4]||(R[4]=te=>c.table_id=te),onChange:E,placeholder:c.app_token?"请选择数据表":"请先输入多维表文档url",style:{width:"100%"}},{default:x(()=>[(w(!0),P(ae,null,ye(v.value,te=>(w(),Z(oe,{key:te.table_id,value:te.table_id},{default:x(()=>[z(j(te.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(w(),Z(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ue=c.tag_map)==null?void 0:ue.table_id)||[],defaultValue:c.table_id,ref:"atInputRef",onOpen:R[5]||(R[5]=te=>t("updateVar")),onChange:R[6]||(R[6]=(te,q)=>L("table_id",te,q)),placeholder:"请输入表格id，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",C$,[d("div",S$,j(te),1),d("div",k$,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))]),R[17]||(R[17]=d("div",{class:"desc"},"输入表格id，table_id 例如：tblz2wmlWiB1JGxS",-1))]))],64)):ie("",!0),ee(zd).includes(n.actionName)?(w(),Z(l6,{key:1,ref_key:"childRef",ref:s,variableOptions:n.variableOptions,actionName:n.actionName,action:n.action,onUpdateVar:R[7]||(R[7]=te=>t("updateVar")),onUpdate:M},null,8,["variableOptions","actionName","action"])):(w(),Z($u(r[n.actionName]),{key:2,ref_key:"childRef",ref:s,tableId:c.table_id,fields:_.value,variableOptions:n.variableOptions,config:{...m.value,...c},onUpdate:M,onUpdateVar:R[8]||(R[8]=te=>t("updateVar"))},null,40,["tableId","fields","variableOptions","config"]))]),d("div",E$,[R[18]||(R[18]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",D$,[y(Bi,{"tree-data":g.value},null,8,["tree-data"])])]),y(mw,{ref_key:"configModalRef",ref:a,onChange:R[9]||(R[9]=te=>D(!0))},null,512)])}}},O$=$e(A$,[["__scopeId","data-v-19382c44"]]),N$={class:"node-options"},M$={class:"options-item-tit"},T$={class:"option-label"},$$={class:"option-type"},P$={class:"field-list-item"},R$={class:"field-label"},B$={class:"field-type"},L$={class:"desc"},I$={key:0,class:"desc",style:{color:"#FB363F"}},F$={class:"node-options"},j$={class:"options-item"},sf={__name:"pluginFormRender",props:{node:{type:Object,default:()=>({})},params:{type:Object},output:{type:Object},variableOptions:{type:Array},keepFormatField:{type:Array,default:()=>[]}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=Je({}),s=X([]),a=JSON.parse(o.node.node_params),l={url:{label:(v,_)=>(v==null?void 0:v.name)||_,placeholder:"键入/选择参数，或者输入文本，以https:/开头",validate:v=>{if(Array.isArray(v.tags)&&v.tags.length>0)return v.__error=null,!0;const g=String(v.value||"").trim().startsWith("https:/");return v.__error=g?null:"请输入以https:/开头的网址",g}}};gt(r,v=>{h()},{deep:!0}),gt(()=>o.params,v=>{var g,b,C;Object.assign(r,JSON.parse(JSON.stringify(v||"{}")));let _=((b=(g=a==null?void 0:a.plugin)==null?void 0:g.params)==null?void 0:b.arguments)||{},m;for(let D in r)m=_[D]||"",!m&&Object.hasOwn(r[D],"default")&&(m=r[D].default),o.keepFormatField.includes(D)||(m=String(m)),m==="null"&&(m=null),r[D].value=m,r[D].tags=((C=_==null?void 0:_.tag_map)==null?void 0:C[D])||[]},{deep:!0,immediate:!0}),gt(()=>o.output,v=>{s.value=yi(JSON.parse(JSON.stringify(o.output||"{}")))},{deep:!0,immediate:!0});function u(v,_,m,g){v.value=_,v.tags=m,p(g,v),h()}function c(v,_){const m=l[_];return m&&m.label?m.label(v,_):(v==null?void 0:v.name)||_}function f(v){const _=l[v];return _&&_.placeholder?_.placeholder:"请输入内容，键入“/”可以插入变量"}function p(v,_){const m=l[v];return m&&m.validate?m.validate(_):(_.__error=null,!0)}function h(){let v=JSON.parse(o.node.node_params);v.plugin.output_obj=s.value;let _={tag_map:{}},m;for(let g in r)m=r[g].value,r[g].tags.length||(r[g].type=="string"?m=String(m):["number","integer"].includes(r[g].type)&&(m=Number(m))),_[g]=m,_.tag_map[g]=r[g].tags;Object.assign(v.plugin.params,{arguments:{..._}}),i({...o.node,node_params:JSON.stringify(v)})}return(v,_)=>(w(),P("div",null,[d("div",N$,[_[1]||(_[1]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),(w(!0),P(ae,null,ye(r,(m,g)=>(w(),P(ae,{key:g},[v.$slots[g]?Oi(v.$slots,g,{key:0,state:r,item:m,keyName:g}):(w(),P("div",{key:1,class:Ct(["options-item",{"is-required":m.required}])},[d("div",M$,[d("div",T$,j(c(m,g)),1),d("div",$$,j(m.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:m.tags,defaultValue:m.value,ref_for:!0,ref:"atInputRef",onOpen:_[0]||(_[0]=b=>t("updateVar")),onChange:(b,C)=>u(m,b,C,g),placeholder:f(g)},{option:x(({label:b,payload:C})=>[d("div",P$,[d("div",R$,j(b),1),d("div",B$,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),d("div",L$,j(m.desc),1),m.__error?(w(),P("div",I$,j(m.__error),1)):ie("",!0)],2))],64))),128))]),d("div",F$,[_[2]||(_[2]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",j$,[y(Bi,{"tree-data":s.value},null,8,["tree-data"])])])]))}},V$={class:"options-item is-required"},H$={class:"options-item is-required"},U$={class:"options-item-tit"},z$={class:"tag-box"},q$={class:"field-list-item"},G$={class:"field-label"},X$={class:"field-type"},W$={__name:"official-account-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=X([]),r=X([]),s=X({}),a=X(!1),l=X({app_id:"",app_secret:""});ut(()=>{var b,C,D;if(c(),u(),o.actionName==="getTagFans"){let T=To((b=o.node)==null?void 0:b.node_params);if(T){let O=((D=(C=T==null?void 0:T.plugin)==null?void 0:C.params)==null?void 0:D.arguments)||{};const{app_id:k,app_secret:S}=O;k&&S&&(l.value={app_id:k,app_secret:S},p())}}});function u(){const b={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};o.actionName==="getTagFans"?(Object.assign(b,{tagid:{...o.action.params.tagid,default:null},tag_name:{desc:"标签名称",type:"string"},tag_type:{desc:"标签类型",type:"number",default:1}}),s.value=Xc(b,["app_id","tagid"])):s.value=b}function c(){Tr({app_type:"official_account"}).then(b=>{i.value=(b==null?void 0:b.data)||[]})}function f(){if(!l.value.app_secret||!l.value.app_id)return xt.warning("请先选择公众号");a.value||(a.value=!0,p().then(()=>{xt.success("同步完成")}).finally(()=>{a.value=!1}))}function p(){return Po({name:"official_account_profile",action:"default/exec",params:JSON.stringify({business:"getTags",arguments:l.value})}).then(b=>{var C;return r.value=((C=b==null?void 0:b.data)==null?void 0:C.tags)||[],b})}function h(b,C){b.app_secret.value=C.secret,b.app_name.value=C.name,o.actionName==="getTagFans"&&(l.value={app_id:C.key,app_secret:C.secret},p())}function v(b){b.tag_name.value="",b.tag_type.value==1?b.tagid.value=null:b.tagid.value=""}function _(b,C,D){b.tag_name.value=D.name}function m(b,C,D){b.value=C,b.tags=D}const g=(b,C)=>C.name.toLowerCase().indexOf(b.toLowerCase())>=0;return(b,C)=>{const D=Vt,T=It,O=mo,k=Qt;return w(),Z(sf,{node:n.node,params:s.value,output:n.action.output,variableOptions:n.variableOptions,keepFormatField:["tagid","tag_type"],onUpdateVar:C[1]||(C[1]=S=>t("updateVar"))},{tag_name:x(()=>[...C[2]||(C[2]=[])]),tag_type:x(()=>[...C[3]||(C[3]=[])]),app_name:x(()=>[...C[4]||(C[4]=[])]),app_secret:x(()=>[...C[5]||(C[5]=[])]),app_id:x(({state:S,item:N,keyName:L})=>[d("div",V$,[C[6]||(C[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(T,{value:N.value,"onUpdate:value":$=>N.value=$,placeholder:"请选择公众号",style:{width:"100%"},onChange:($,B)=>h(S,B)},{default:x(()=>[(w(!0),P(ae,null,ye(i.value,$=>(w(),Z(D,{key:$.app_id,value:$.app_id,name:$.app_name,secret:$.app_secret},{default:x(()=>[z(j($.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])])])]),tagid:x(({state:S,item:N,keyName:L})=>[d("div",H$,[d("div",U$,[C[8]||(C[8]=d("div",{class:"option-label"},"公众号标签",-1)),y(k,{title:"同步最新的公众号标签"},{default:x(()=>[d("a",{onClick:f},[C[7]||(C[7]=z("同步 ",-1)),a.value?(w(),Z(O,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",z$,[y(T,{value:S.tag_type.value,"onUpdate:value":$=>S.tag_type.value=$,onChange:$=>v(S),style:{width:"120px"}},{default:x(()=>[y(D,{value:1},{default:x(()=>[...C[9]||(C[9]=[z("选择标签",-1)])]),_:1}),y(D,{value:2},{default:x(()=>[...C[10]||(C[10]=[z("插入变量",-1)])]),_:1})]),_:1},8,["value","onUpdate:value","onChange"]),S.tag_type.value==1?(w(),Z(T,{key:0,value:N.value,"onUpdate:value":$=>N.value=$,placeholder:"请选择标签","show-search":"","filter-option":g,style:{width:"100%"},onChange:($,B)=>_(S,$,B)},{default:x(()=>[(w(!0),P(ae,null,ye(r.value,$=>(w(),Z(D,{key:$.id,value:$.id,name:$.name},{default:x(()=>[z(j($.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):(w(),Z(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:N.tags||[],defaultValue:N.value,ref:"atInputRef",onOpen:C[0]||(C[0]=$=>t("updateVar")),onChange:($,B)=>m(N,$,B),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:$,payload:B})=>[d("div",q$,[d("div",G$,j($),1),d("div",X$,j(B.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))])])]),_:1},8,["node","params","output","variableOptions"])}}},Y$=$e(W$,[["__scopeId","data-v-67cbcad3"]]),K$={class:"tpl-container"},J$={class:"node-options"},Z$={class:"options-item is-required"},Q$={class:"options-item is-required"},eP={class:"options-item-tit"},tP={class:"options-item is-required"},nP={class:"field-list-item"},oP={class:"field-label"},iP={class:"field-type"},rP={class:"options-item-tit"},sP={class:"option-label"},aP={class:"field-list-item"},lP={class:"field-label"},uP={class:"field-type"},dP={class:"options-item is-required"},cP={key:0,class:"options-item is-required"},fP={class:"field-list-item"},pP={class:"field-label"},hP={class:"field-type"},vP={class:"options-item is-required"},gP={class:"field-list-item"},_P={class:"field-label"},mP={class:"field-type"},yP={class:"options-item is-required"},bP={class:"field-list-item"},xP={class:"field-label"},wP={class:"field-type"},CP={class:"node-options"},SP={class:"options-item"},kP="official_send_template_message",EP={__name:"official-template-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=X([]),s=X([]),a=X(!1),l=X([]),u=Je({app_id:void 0,template_id:void 0,app_secret:"",touser:"",url:"",data:{},miniprogram:{appid:{value:"",tags:[]},pagepath:{value:"",tags:[]}},link_type:0,tag_map:{}}),c={thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20个以内字符,可汉字、数字、字母或符号组合"},short_thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,5}$/,txt:"5个以内字符,可汉字、数字、字母或符号组合"},number:{reg:/^\d{1,32}(.\d{1,2})?$/,txt:"32位以内数字,只能数字，可带小数"},const:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20位以内字符，超过无法下发注"},letter:{reg:/^[a-zA-Z]{1,32}$/,txt:"32位以内字母，只能字母"},symbol:{reg:/^[\W_]{1,5}$/,txt:"5位以内符号，只能符号"},character_string:{reg:/^[a-zA-Z0-9\W_]{1,32}$/,txt:"32位以内数字、字母或符号，可数字、字母或符号组合"},time:{reg:/^\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"24小时制时间格式（支持+年月日），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},date:{reg:/^\d{4}年\d{1,2}月\d{1,2}日(\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"年月日格式（支持+24小时制时间），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},amount:{reg:/^[$¥]?\d{1,10}(.\d{1,2})?[元]?$/,txt:"金额，1个币种符号+10位以内纯数字，可带小数，结尾可带“元”	可带小数 例如：¥200元、$200"},phone_number:{reg:/^[0-9-+*# ]{5,17}$/,txt:"电话，17位以内，数字、符号"},car_number:{reg:/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[a-zA-Z0-9]{6,7}[\u4e00-\u9fa5]{0,1}$/,txt:"车牌，8位以内，第一位与最后一位可为汉字，其余为字母或数字"},name:{reg:/^(?:[\u4e00-\u9fa5]{1,10}|[a-zA-Z\p{P}]{1,20})$/,txt:"10个以内纯汉字或20个以内纯字母或符号"},phrase:{reg:/^[\u4e00-\u9fa5]{1,5}$/,txt:"汉字，5个以内汉字"}};ut(()=>{f()}),gt(()=>o.action,()=>{var S;r.value=yi(JSON.parse(JSON.stringify(((S=o.action)==null?void 0:S.output)||"{}")))},{deep:!0,immediate:!0});function f(){p(),h()}function p(){Tr({app_type:"official_account"}).then(S=>{s.value=(S==null?void 0:S.data)||[]})}function h(){var L,$;let S=JSON.parse(o.node.node_params),N=(($=(L=S==null?void 0:S.plugin)==null?void 0:L.params)==null?void 0:$.arguments)||{};Object.assign(u,N),u.template_id&&g()}function v(S,N){const{key:L,secret:$,name:B}=N;u.app_secret=$,u.app_name=B,g()}function _(S,N){const{name:L,content:$}=N;u.template_name=L,u.data=O($)}function m(){if(!u.app_secret||!u.app_id)return xt.warning("请先选择公众号");a.value||(a.value=!0,g().then(()=>{xt.success("同步完成")}).finally(()=>{a.value=!1}))}function g(){return Po({name:kP,action:"default/exec",params:JSON.stringify({business:"getAllTemplates",arguments:{app_id:u.app_id,app_secret:u.app_secret}})}).then(S=>{var N;l.value=((N=S==null?void 0:S.data)==null?void 0:N.template_list)||[]})}function b(S,N,L,$=null){S.value=N,S.tags=L,$&&(L.length?S.format_err=!1:k($,S)),T()}function C(S,N,L){u[S]=N,u.tag_map[S]=L,T()}function D(){switch(u.link_type){case 0:u.miniprogram.appid={value:"",tags:[]},u.miniprogram.pagepath={value:"",tags:[]},u.url="";break;case 1:u.miniprogram.appid={value:"",tags:[]},u.miniprogram.pagepath={value:"",tags:[]};break;case 2:u.url="";break}T()}function T(){let S=JSON.parse(o.node.node_params);S.plugin.output_obj=r.value,Object.assign(S.plugin.params,{arguments:{...u}}),i({...o.node,node_params:JSON.stringify(S)})}function O(S){var $;const N={},L=S.split(`
`).map(B=>B.trim()).filter(Boolean);for(const B of L){let E=B.match(/^(.*?):\s*\{\{([\w]+)\.DATA\}\}$/);if(E){let A=E[2].replace(/\d/g,"");N[E[2]]={title:E[1],value:"",tags:[],desc:(($=c[A])==null?void 0:$.txt)||"",format_err:!1};continue}if(E=B.match(/^\{\{([\w]+)\.DATA\}\}$/),E){N[E[1]]={title:E[1],value:"",tags:[]};continue}}return N}function k(S,N){let L=S.replace(/\d/g,"");c[L]&&!c[L].reg.test(N.value)?N.format_err=!0:N.format_err=!1}return(S,N)=>{var F,H;const L=Vt,$=It,B=mo,E=Qt,A=Ri,M=Pi;return w(),P("div",K$,[d("div",J$,[N[25]||(N[25]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),d("div",Z$,[N[12]||(N[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y($,{value:u.app_id,"onUpdate:value":N[0]||(N[0]=R=>u.app_id=R),placeholder:"请选择公众号",style:{width:"100%"},onChange:v},{default:x(()=>[(w(!0),P(ae,null,ye(s.value,R=>(w(),Z(L,{key:R.app_id,name:R.app_name,secret:R.app_secret},{default:x(()=>[z(j(R.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",Q$,[d("div",eP,[N[14]||(N[14]=d("div",{class:"option-label"},"公众号模板",-1)),y(E,{title:"同步最新的公众号模板"},{default:x(()=>[d("a",{onClick:m},[N[13]||(N[13]=z("同步 ",-1)),a.value?(w(),Z(B,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",null,[y($,{value:u.template_id,"onUpdate:value":N[1]||(N[1]=R=>u.template_id=R),placeholder:"请选择模板",style:{width:"100%"},onChange:_},{default:x(()=>[(w(!0),P(ae,null,ye(l.value,R=>(w(),Z(L,{key:R.template_id,name:R.title,content:R.content},{default:x(()=>[z(j(R.title),1)]),_:2},1032,["name","content"]))),128))]),_:1},8,["value"])])]),d("div",tP,[N[15]||(N[15]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"接收者（用户）openid"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",options:n.variableOptions,defaultSelectedList:((F=u.tag_map)==null?void 0:F.touser)||[],defaultValue:u.touser,ref:"atInputRef",onOpen:N[2]||(N[2]=R=>t("updateVar")),onChange:N[3]||(N[3]=(R,G)=>C("touser",R,G)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:R,payload:G})=>[d("div",nP,[d("div",oP,j(R),1),d("div",iP,j(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),N[16]||(N[16]=d("div",{class:"desc"},"普通用户的标识，对当前公众号唯一",-1))]),(w(!0),P(ae,null,ye(u.data,(R,G)=>(w(),P("div",{class:"options-item is-required",key:G},[d("div",rP,[d("div",sP,j(R.title),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:R.tags,defaultValue:R.value,ref_for:!0,ref:"atInputRef",onOpen:N[4]||(N[4]=oe=>t("updateVar")),onChange:(oe,V)=>b(R,oe,V,G),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:oe,payload:V})=>[d("div",aP,[d("div",lP,j(oe),1),d("div",uP,j(V.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),R.desc?(w(),P("div",{key:0,class:Ct(["desc",{error:R.format_err}])},j(R.desc),3)):ie("",!0)]))),128)),d("div",dP,[N[20]||(N[20]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"跳转方式")],-1)),d("div",null,[y(M,{value:u.link_type,"onUpdate:value":N[5]||(N[5]=R=>u.link_type=R),onChange:D},{default:x(()=>[y(A,{value:0},{default:x(()=>[...N[17]||(N[17]=[z("不跳转",-1)])]),_:1}),y(A,{value:1},{default:x(()=>[...N[18]||(N[18]=[z("链接",-1)])]),_:1}),y(A,{value:2},{default:x(()=>[...N[19]||(N[19]=[z("小程序",-1)])]),_:1})]),_:1},8,["value"])])]),u.link_type==1?(w(),P("div",cP,[N[21]||(N[21]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"链接")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((H=u.tag_map)==null?void 0:H.url)||[],defaultValue:u.url,ref:"atInputRef",onOpen:N[6]||(N[6]=R=>t("updateVar")),onChange:N[7]||(N[7]=(R,G)=>C("url",R,G)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:R,payload:G})=>[d("div",fP,[d("div",pP,j(R),1),d("div",hP,j(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])):u.link_type==2?(w(),P(ae,{key:1},[d("div",vP,[N[22]||(N[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"小程序APPID")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:u.miniprogram.appid.value,defaultSelectedList:u.miniprogram.appid.tags,ref:"atInputRef",onOpen:N[8]||(N[8]=R=>t("updateVar")),onChange:N[9]||(N[9]=(R,G)=>b(u.miniprogram.appid,R,G)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:R,payload:G})=>[d("div",gP,[d("div",_P,j(R),1),d("div",mP,j(G.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])]),N[23]||(N[23]=d("div",{class:"desc"},"小程序appid必须与发模板消息的公众号是关联关系",-1))]),d("div",yP,[N[24]||(N[24]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"小程序路径")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:u.miniprogram.pagepath.value,defaultSelectedList:u.miniprogram.pagepath.tags,ref:"atInputRef",onOpen:N[10]||(N[10]=R=>t("updateVar")),onChange:N[11]||(N[11]=(R,G)=>b(u.miniprogram.pagepath,R,G)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:R,payload:G})=>[d("div",bP,[d("div",xP,j(R),1),d("div",wP,j(G.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])])])],64)):ie("",!0)]),d("div",CP,[N[26]||(N[26]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",SP,[y(Bi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},DP=$e(EP,[["__scopeId","data-v-d1566931"]]),AP={class:"tag-container"},OP={class:"node-options"},NP={class:"options-item is-required"},MP={class:"options-item is-required"},TP={class:"options-item-tit"},$P={class:"tag-box"},PP={class:"field-list-item"},RP={class:"field-label"},BP={class:"field-type"},LP={class:"options-item is-required"},IP={class:"field-list-item"},FP={class:"field-label"},jP={class:"field-type"},VP={class:"node-options"},HP={class:"options-item"},UP="official_batch_tag",zP={__name:"official-tag-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=X([]),s=X([]),a=X([]),l=Je({app_id:void 0,app_secret:"",openid_list:"",tagid:"",tag_type:1,tag_name:1,tag_map:{}}),u=X(!1);ut(()=>{c()}),gt(()=>o.action,()=>{var T;r.value=yi(JSON.parse(JSON.stringify(((T=o.action)==null?void 0:T.output)||"{}")))},{deep:!0,immediate:!0});function c(){f(),p()}function f(){Tr({app_type:"official_account"}).then(T=>{s.value=(T==null?void 0:T.data)||[]})}function p(){var k,S;let T=JSON.parse(o.node.node_params),O=((S=(k=T==null?void 0:T.plugin)==null?void 0:k.params)==null?void 0:S.arguments)||{};Object.assign(l,O),l.tagid&&(l.tagid>0?l.tag_type=1:l.tag_type=2,_())}function h(T,O){const{key:k,secret:S,name:N}=O;l.app_secret=S,l.app_name=N,_()}function v(){if(!l.app_secret||!l.app_id)return xt.warning("请先选择公众号");u.value||(u.value=!0,_().then(()=>{xt.success("同步完成")}).finally(()=>{u.value=!1}))}function _(){return Po({name:UP,action:"default/exec",params:JSON.stringify({business:"getTags",arguments:{app_id:l.app_id,app_secret:l.app_secret}})}).then(T=>{var O;return a.value=((O=T==null?void 0:T.data)==null?void 0:O.tags)||[],T})}function m(T,O,k){T==="openid_list"&&(O=O.trim(),O=O.replace(/，/g,",")),l[T]=O,l.tag_map[T]=k,C()}function g(T,O){l.tag_name=O.name,C()}function b(){l.tag_name="",l.tag_type==1?l.tagid=null:l.tagid=""}function C(){let T=JSON.parse(o.node.node_params);T.plugin.output_obj=r.value,Object.assign(T.plugin.params,{arguments:{...l}}),i({...o.node,node_params:JSON.stringify(T)})}const D=(T,O)=>O.name.toLowerCase().indexOf(T.toLowerCase())>=0;return(T,O)=>{var $,B;const k=Vt,S=It,N=mo,L=Qt;return w(),P("div",AP,[d("div",OP,[O[14]||(O[14]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),d("div",NP,[O[7]||(O[7]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(S,{value:l.app_id,"onUpdate:value":O[0]||(O[0]=E=>l.app_id=E),placeholder:"请选择公众号",style:{width:"100%"},onChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(s.value,E=>(w(),Z(k,{key:E.app_id,name:E.app_name,secret:E.app_secret},{default:x(()=>[z(j(E.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",MP,[d("div",TP,[O[9]||(O[9]=d("div",{class:"option-label"},"公众号标签",-1)),y(L,{title:"同步最新的公众号标签"},{default:x(()=>[d("a",{onClick:v},[O[8]||(O[8]=z("同步 ",-1)),u.value?(w(),Z(N,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",$P,[y(S,{value:l.tag_type,"onUpdate:value":O[1]||(O[1]=E=>l.tag_type=E),onChange:b,style:{width:"120px"}},{default:x(()=>[y(k,{value:1},{default:x(()=>[...O[10]||(O[10]=[z("选择标签",-1)])]),_:1}),y(k,{value:2},{default:x(()=>[...O[11]||(O[11]=[z("插入变量",-1)])]),_:1})]),_:1},8,["value"]),l.tag_type==1?(w(),Z(S,{key:0,value:l.tagid,"onUpdate:value":O[2]||(O[2]=E=>l.tagid=E),placeholder:"请选择标签",style:{width:"100%"},onChange:g,"show-search":"","filter-option":D},{default:x(()=>[(w(!0),P(ae,null,ye(a.value,E=>(w(),Z(k,{key:E.id,value:E.id,name:E.name},{default:x(()=>[z(j(E.name),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["value"])):(w(),Z(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:(($=l.tag_map)==null?void 0:$.tagid)||[],defaultValue:l.tagid,ref:"atInputRef",onOpen:O[3]||(O[3]=E=>t("updateVar")),onChange:O[4]||(O[4]=(E,A)=>m("tagid",E,A)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:E,payload:A})=>[d("div",PP,[d("div",RP,j(E),1),d("div",BP,j(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),d("div",LP,[O[12]||(O[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"粉丝openid列表"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((B=l.tag_map)==null?void 0:B.openid_list)||[],defaultValue:l.openid_list,ref:"atInputRef",onOpen:O[5]||(O[5]=E=>t("updateVar")),onChange:O[6]||(O[6]=(E,A)=>m("openid_list",E,A)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:E,payload:A})=>[d("div",IP,[d("div",FP,j(E),1),d("div",jP,j(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),O[13]||(O[13]=d("div",{class:"desc"},"粉丝openid列表，最多50个，逗号分割",-1))])]),d("div",VP,[O[15]||(O[15]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",HP,[y(Bi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},qP=$e(zP,[["__scopeId","data-v-bf89af1e"]]),GP={class:"field-list-row"},XP={key:0,class:"field-list-col field-list-col-head field-value-head"},WP={key:1,class:"field-list-col field-list-col-head field-del-head"},YP={key:0,class:"field-list-row"},KP={class:"field-list-col field-value-col"},JP={class:"field-list-col field-name-col"},ZP={key:0,style:{color:"#FB363F","margin-right":"2px"}},QP={class:"field-list-col field-type-col"},eR={key:0,class:"field-list-col field-value-col"},tR={key:0,class:"field-value-inline"},nR={class:"inline-input"},oR={key:2,style:{color:"#FB363F","margin-top":"4px"}},iR={key:1,class:"field-list-col field-del-col"},rR=["onClick"],sR={__name:"index",props:{showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},msgtype:{type:String,default:""}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=He("getNode"),s=Je({list:[],keys:[]}),a=Xe(()=>s.list.some(k=>b(k)));function l(){const k=String(i.msgtype||"").toLowerCase();return k==="link"?"imageText":k==="miniprogrampage"?"card":["text","image","url"].includes(k)?k:"text"}const u={imageText:{url:{required:!0,validator:k=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(k||""))?!0:/^https?:\/\//.test(String(k||"")),validationTip:"链接需以http或https开头",functionalTip:"跳转到外链，支持插入变量，链接需以http或https开头。"},title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入标题",functionalTip:"展示在链接卡片的标题位置"},description:{required:!0,validator:k=>String(k||"").trim().length>0&&String(k||"").length<=300,validationTip:"请输入描述，最多300字",functionalTip:"展示在链接卡片的描述位置"},thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传链接图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},text:{content:{required:!0,validator:k=>String(k||"").trim().length>0&&String(k||"").length<=300,validationTip:"请输入文本内容，最多300字",functionalTip:"支持插入变量，最多300字"}},image:{thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},url:{title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入标题",functionalTip:"展示在卡片标题位置"},url:{required:!0,validator:k=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(k||""))?!0:/^https?:\/\//.test(String(k||"")),validationTip:"链接需以http或https开头",functionalTip:"点击后跳转的链接，链接需以http或https开头。"}},card:{title:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入小程序标题",functionalTip:"展示在卡片标题位置"},appid:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请输入小程序appID",functionalTip:"小程序右上角>名字>更多资料>AppID；公众号需与小程序关联"},page_path:{required:!0,validator:k=>/^\//.test(String(k||"")),validationTip:"请输入以/开头的小程序路径",functionalTip:"向开发者获取路径，如/pages/index/index"},thumb_url:{required:!0,validator:k=>!!String(k||"").trim(),validationTip:"请上传小程序封面",functionalTip:"支持png/jpg/jpeg，建议≤2M"}}};function c(){const k=l(),S=u[k]||{};s.list.forEach((N,L)=>{var F;const $=(N.field_name||"").toLowerCase(),B=S[$]||{};let E={};(typeof N.description<"u"||typeof N.desc<"u"||typeof N.required<"u")&&(E={functionalTip:N.description||N.desc,required:N.required});let A={};if(b(N)){const H=(F=N.properties)==null?void 0:F[N.current_properties_key];H&&(typeof H.description<"u"||typeof H.desc<"u"||typeof H.required<"u")&&(A={functionalTip:H.description||H.desc,required:H.required})}const M={functionalTip:A.functionalTip??E.functionalTip??B.functionalTip??"",required:!!(A.required??E.required??B.required??N.required)};s.list[L].__functionalTip=M.functionalTip,s.list[L].__required=!!M.required,s.list[L].__error=null})}function f(k){var A,M,F,H,R;const S=l(),N=u[S]||{},L=(k.field_name||"").toLowerCase();let $=N[L];if(!$&&b(k)){const G=(A=k.properties)==null?void 0:A[k.current_properties_key];G&&($={required:!!G.required})}const B=b(k)?((F=(M=k.properties)==null?void 0:M[k.current_properties_key])==null?void 0:F.value)??"":k.value;if(!$)return k.__error=null,!0;const E=b(k)?((R=(H=k.properties)==null?void 0:H[k.current_properties_key])==null?void 0:R.atTags)??[]:k.atTags;return $.required&&!String(B||"").trim()&&(!Array.isArray(E)||E.length===0)||$.validator&&!$.validator(B)?(k.__error=$.validationTip,!1):(k.__error=null,!0)}gt(()=>i.list,k=>{s.list=k,s.keys=k.map(S=>S.field_name),s.list.forEach(D),c()},{immediate:!0});const p=X([]),h=()=>{let k=r().getAllParentVariable();p.value=k||[]},v=()=>{h()},_=(k,S,N,L)=>{if(b(N)){const $=N.current_properties_key;N.properties[$]||(N.properties[$]={}),N.properties[$].value=k,N.properties[$].atTags=S}else s.list[L].value=k,s.list[L].atTags=S;g()},m=k=>{s.list.splice(k,1),g()},g=()=>{s.keys=s.list.map(k=>k.field_name),o("change",[...s.list],[...s.keys])};ut(()=>{h()});function b(k){return k.media_component}function C(k,S){var L;const N=(L=k.properties)==null?void 0:L[S];k.current_properties_key=S,k.ui_type=T(N==null?void 0:N.type),k.__functionalTip=(N==null?void 0:N.desc)||"",k.__required=!!(N!=null&&N.required),k.properties[S]||(k.properties[S]={}),k.properties[S].value=k.properties[S].value??"",k.properties[S].atTags=k.properties[S].atTags??[],g()}function D(k){if(!b(k))return;const S=Object.keys(k.properties);if(!k.current_properties_key){const N=S[0];C(k,N)}}function T(k){switch((k||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return k||"Text"}}function O(){let k=!0;const S=[];return s.list.forEach(N=>{var L;if(!f(N)){k=!1;const $=b(N)?((L=N.properties)==null?void 0:L[N.current_properties_key])||{}:null;S.push({field_name:($==null?void 0:$.name)||N.name||N.field_name,message:($==null?void 0:$.error)||N.__error,functionalTip:($==null?void 0:$.desc)||N.__functionalTip})}}),{ok:k,errors:S}}return e({validateAll:O}),(k,S)=>{const N=ln,L=Qt,$=Vt,B=It,E=Nn;return w(),P("div",null,[d("div",{class:Ct(["field-list",{"wide-value-col":a.value}])},[d("div",GP,[S[0]||(S[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),S[1]||(S[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),P("div",XP,"字段值")):ie("",!0),i.showDelete?(w(),P("div",WP)):ie("",!0)]),n.showEmptyFieldRow?(w(),P("div",YP,[S[2]||(S[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),S[3]||(S[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",KP,[y(L,{title:"请先选择数据库"},{default:x(()=>[y(N,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),P(ae,null,ye(s.list,(A,M)=>{var F,H,R,G,oe,V;return w(),P("div",{class:"field-list-row",key:A.field_name},[d("div",JP,[A.__required?(w(),P("span",ZP,"*")):ie("",!0),z(" "+j(((H=(F=A.properties)==null?void 0:F[A.current_properties_key])==null?void 0:H.name)||A.name)+" ",1),A.__functionalTip?(w(),Z(L,{key:1,title:A.__functionalTip},{default:x(()=>[y(ee(yt),{style:{cursor:"pointer"}})]),_:1},8,["title"])):ie("",!0)]),d("div",QP,j(A.ui_type),1),n.showInput?(w(),P("div",eR,[b(A)?(w(),P("div",tR,[y(B,{value:A.current_properties_key,"onUpdate:value":Y=>A.current_properties_key=Y,onChange:Y=>C(A,Y)},{default:x(()=>[(w(!0),P(ae,null,ye(A.properties||{},(Y,Q)=>(w(),Z($,{key:Q,value:Q},{default:x(()=>[z(j(Y.name||Q),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"]),d("div",nR,[y(ot,{options:p.value,defaultValue:((G=(R=A.properties)==null?void 0:R[A.current_properties_key])==null?void 0:G.value)??"",defaultSelectedList:((V=(oe=A.properties)==null?void 0:oe[A.current_properties_key])==null?void 0:V.atTags)??[],onOpen:v,onChange:(Y,Q)=>_(Y,Q,A,M),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):(w(),Z(ot,{key:1,options:p.value,defaultValue:A.value,defaultSelectedList:A.atTags,onOpen:v,onChange:(Y,Q)=>_(Y,Q,A,M),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])),A.__error?(w(),P("div",oR,j(A.__error),1)):ie("",!0)])):ie("",!0),i.showDelete?(w(),P("div",iR,[d("span",{class:"del-btn",onClick:Y=>m(M)},[y(E,{class:"del-icon",name:"close-circle"})],8,rR)])):ie("",!0)])}),128))],2)])}}},aR=$e(sR,[["__scopeId","data-v-12aa06c2"]]),lR={class:"add-data-form"},uR={class:"node-box-content"},dR={class:"setting-box"},cR={__name:"reply-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X([]),s=X(null);function a(f=null){var p,h,v;r.value=[],Array.isArray((v=(h=(p=f==null?void 0:f.plugin)==null?void 0:p.params)==null?void 0:h.arguments)==null?void 0:v.fields)&&f.plugin.params.arguments.fields.length?(f.plugin.params.arguments.fields.map(_=>{_.value=_.value.toString()}),r.value=f.plugin.params.arguments.fields):i.fields.map(_=>{r.value.push({value:"",atTags:[],..._})})}const l=f=>{r.value=f,u()},u=()=>{o("update",{fields:Bn(r.value)})};function c(){var f,p;return(p=(f=s.value)==null?void 0:f.validateAll)==null?void 0:p.call(f)}return e({init:a,validateAll:c}),(f,p)=>(w(),P("div",lR,[d("div",uR,[p[0]||(p[0]=d("div",{class:"setting-label"},[d("span",null,"回复内容"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",dR,[y(aR,{ref_key:"fieldRef",ref:s,showEmptyFieldRow:!n.tableId,list:r.value,fields:n.fields,msgtype:n.tableId,showAdd:!1,showDelete:!1,onChange:l},null,8,["showEmptyFieldRow","list","fields","msgtype"])])])]))}},fR=$e(cR,[["__scopeId","data-v-78a8acab"]]),pR={class:"main-box"},hR={key:0,class:"loading-box"},vR={class:"node-options"},gR={class:"options-item is-required"},_R={class:"options-item is-required"},mR={class:"options-item-tit"},yR={class:"option-label"},bR={class:"field-list-item"},xR={class:"field-label"},wR={class:"field-type"},CR={class:"options-item is-required"},SR={class:"node-options"},kR={class:"options-item"},np="official_send_message",ER={__name:"official-send-message-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=X(null),s=Je({app_id:null,msgtype:void 0,receiver:"",receiver_tags:[],app_secret:"",app_name:""}),a=X(!1),l=X(!1),u=X({}),c=X([]),f=X([]),p=X([]),h=X([]);ut(()=>{v(),ds({name:"workflow:validate",callback:S})});async function v(){await _(),D(),$()}function _(){return Tr({app_type:"official_account"}).then(B=>{c.value=(B==null?void 0:B.data)||[]})}function m(){return a.value=!0,Po({name:np,action:"default/exec",params:JSON.stringify({business:"getMsgType",arguments:{app_id:s.app_id}})}).then(B=>(u.value=(B==null?void 0:B.data)||{},f.value=u.value.items||[],!s.msgtype&&f.value.length==1&&(s.msgtype=f.value[0].msgtype,O()),B)).finally(()=>{a.value=!1})}function g(){return l.value=!0,Po({name:np,action:"default/exec",params:JSON.stringify({business:"getMsgInput",arguments:{app_id:s.app_id,app_secret:s.app_secret,msgtype:s.msgtype}})}).then(B=>{var A;let E=((A=B==null?void 0:B.data)==null?void 0:A.items)||[];return p.value=E.map(M=>({field_name:M.field||M.name,ui_type:b(M.type),name:M.name,description:M.desc,required:!!M.required,media_component:!!M.media_component,properties:M.properties||null})),B}).finally(()=>{l.value=!1})}function b(B){switch((B||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return B||"Text"}}function C(B){if(!B)return yg(o.actionName);B=JSON.parse(JSON.stringify(B));for(let E in B)switch(E){case"filter":if(Array.isArray(B.filter.conditions)&&B.filter.conditions.length)for(let A of B.filter.conditions)A.field_type==="DateTime"&&A.value&&(A.value<1e11&&(A.value*=1e3),A.value=["ExactDate",A.value].join(","));break;case"fields":for(let A of B.fields)A.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(A.ui_type)&&(A.value=Number(A.value)),A.ui_type==="Currency"&&(A.value=A.value.toFixed(2))),A.ui_type==="Checkbox"&&(A.value=A.value=="true"),A.ui_type==="MultiSelect"&&(A.value=A.value.replace(/，/g,",").split(",")),A.ui_type==="DateTime"&&A.value<1e11&&(A.value*=1e3);break;case"field_names":B.field_names=B.field_names.map(A=>A.field_name);break;case"sort":B.sort=B.sort.map(A=>({field_name:A.field_name,desc:A.is_asc!=1}));break}return B}function D(){var A,M;let B=JSON.parse(o.node.node_params),E=((M=(A=B==null?void 0:B.plugin)==null?void 0:A.params)==null?void 0:M.arguments)||{};E.app_id&&(s.app_id=E.app_id),E.msgtype&&(s.msgtype=E.msgtype),E.receiver&&(s.receiver=String(E.receiver)),E.openid&&(s.receiver=String(E.openid)),E.touser&&(s.receiver=String(E.touser)),E.tag_map&&E.tag_map.receiver&&(s.receiver_tags=E.tag_map.receiver),E.app_secret&&(s.app_secret=String(E.app_secret)),E.app_name&&(s.app_name=String(E.app_name)),s.app_id&&m(),s.msgtype&&g().then(()=>k(B))}function T(B,E){u.value={},f.value=[],p.value=[],s.msgtype=void 0,E&&E.app_secret&&(s.app_secret=E.app_secret),E&&E.name&&(s.app_name=E.name),s.app_id?m().then(()=>k()):k(),N()}function O(){p.value=[],g().then(()=>k()),N()}function k(B=null){Pt(()=>{r.value&&typeof r.value.init=="function"&&r.value.init(B)})}function S(){const B=ds();if(r.value&&typeof r.value.validateAll=="function"){const E=r.value.validateAll(),A=f.value.find(M=>M.msgtype==s.msgtype);E&&E.ok===!1&&B.emit&&B.emit("workflow:validate:error",{component:"公众号发送消息",type:s.msgtype,typeDisplay:(A==null?void 0:A.name)||s.msgtype,message:"请完善发送消息的必填项",errors:E.errors||[]})}}function N(B=null){let E=JSON.parse(o.node.node_params),A=f.value.find(M=>M.msgtype==s.msgtype);E.plugin.output_obj=h.value,Object.assign(E.plugin.params,{arguments:{app_id:String(s.app_id||""),app_secret:String(s.app_secret||""),msgtype:String(s.msgtype||""),touser:String(s.receiver||""),fields:(C(B)||{}).fields||[],app_name:String(s.app_name||""),msg_type_name:String((A==null?void 0:A.name)||"")}}),i({...o.node,node_params:JSON.stringify(E)})}function L(B,E){s.receiver=B,s.receiver_tags=E,N()}function $(){h.value=yi(o.action.output)}return(B,E)=>{const A=mo,M=Vt,F=It,H=Qt;return w(),P("div",pR,[l.value||a.value?(w(),P("div",hR,[y(A)])):ie("",!0),d("div",vR,[E[9]||(E[9]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),d("div",gR,[E[6]||(E[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(F,{value:s.app_id,"onUpdate:value":E[0]||(E[0]=R=>s.app_id=R),placeholder:"请选择公众号",style:{width:"100%"},onChange:E[1]||(E[1]=(R,G)=>T(R,G))},{default:x(()=>[(w(!0),P(ae,null,ye(c.value,R=>(w(),Z(M,{key:R.app_id,value:R.app_id,name:R.app_name,app_secret:R.app_secret},{default:x(()=>[z(j(R.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"])])]),d("div",_R,[d("div",mR,[d("div",yR,[E[7]||(E[7]=z(" 接收人 ",-1)),y(H,{title:"用户的openid"},{default:x(()=>[y(ee(yt))]),_:1})])]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:s.receiver_tags,defaultValue:s.receiver,onOpen:E[2]||(E[2]=R=>t("updateVar")),onChange:E[3]||(E[3]=(R,G)=>L(R,G)),placeholder:"请输入接收人，键入“/”可以插入变量"},{option:x(({label:R,payload:G})=>[d("div",bR,[d("div",xR,j(R),1),d("div",wR,j(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",CR,[E[8]||(E[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"消息类型")],-1)),d("div",null,[y(F,{value:s.msgtype,"onUpdate:value":E[4]||(E[4]=R=>s.msgtype=R),onChange:O,placeholder:s.app_id?"请选择消息类型":"请先选择公众号",style:{width:"100%"}},{default:x(()=>[(w(!0),P(ae,null,ye(f.value,R=>(w(),Z(M,{key:R.msgtype,value:R.msgtype},{default:x(()=>[z(j(R.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),y(fR,{ref_key:"childRef",ref:r,tableId:s.msgtype,fields:p.value,variableOptions:n.variableOptions,onUpdate:N,onUpdateVar:E[5]||(E[5]=R=>t("updateVar"))},null,8,["tableId","fields","variableOptions"])]),d("div",SR,[E[10]||(E[10]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",kR,[y(Bi,{"tree-data":h.value},null,8,["tree-data"])])])])}}},DR=$e(ER,[["__scopeId","data-v-eee8fbc4"]]),Lg="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.0946%2014.4079C4.97757%2014.0753%203.98327%2013.4579%203.19596%2012.6398C3.48967%2012.2917%203.66667%2011.8419%203.66667%2011.3508C3.66667%2010.2462%202.77124%209.35078%201.66667%209.35078C1.59985%209.35078%201.5338%209.35408%201.46867%209.36048C1.37993%208.92665%201.33334%208.47752%201.33334%208.01745C1.33334%207.32058%201.44026%206.64868%201.6386%206.01725C1.64794%206.01738%201.6573%206.01745%201.66667%206.01745C2.77124%206.01745%203.66667%205.12202%203.66667%204.01745C3.66667%203.70035%203.59287%203.40052%203.46154%203.13412C4.2325%202.41725%205.1735%201.88076%206.21737%201.5918C6.54814%202.24015%207.22224%202.68413%208%202.68413C8.77777%202.68413%209.45187%202.24015%209.78264%201.5918C10.8265%201.88076%2011.7675%202.41725%2012.5385%203.13412C12.4071%203.40052%2012.3333%203.70035%2012.3333%204.01745C12.3333%205.12202%2013.2288%206.01745%2014.3333%206.01745C14.3427%206.01745%2014.3521%206.01738%2014.3614%206.01725C14.5597%206.64868%2014.6667%207.32058%2014.6667%208.01745C14.6667%208.47752%2014.6201%208.92665%2014.5313%209.36048C14.4662%209.35408%2014.4002%209.35078%2014.3333%209.35078C13.2288%209.35078%2012.3333%2010.2462%2012.3333%2011.3508C12.3333%2011.8419%2012.5103%2012.2917%2012.804%2012.6398C12.0167%2013.4579%2011.0224%2014.0753%209.9054%2014.4079C9.6476%2013.6014%208.892%2013.0175%208%2013.0175C7.108%2013.0175%206.3524%2013.6014%206.0946%2014.4079Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M8%2010.3503C9.28866%2010.3503%2010.3333%209.30559%2010.3333%208.01693C10.3333%206.72826%209.28866%205.68359%208%205.68359C6.71133%205.68359%205.66666%206.72826%205.66666%208.01693C5.66666%209.30559%206.71133%2010.3503%208%2010.3503Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e";/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function op(n){return Object.prototype.toString.call(n)==="[object Object]"}function Yn(n){var e,t;return op(n)===!1?!1:(e=n.constructor,e===void 0?!0:(t=e.prototype,!(op(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}function qo(n){for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Dr(n){return!!n&&!!n[go]}function Ar(n){var e;return!!n&&((function(t){if(!t||typeof t!="object")return!1;var o=Object.getPrototypeOf(t);if(o===null)return!0;var i=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===RR})(n)||Array.isArray(n)||!!n[cp]||!!(!((e=n.constructor)===null||e===void 0)&&e[cp])||af(n)||lf(n))}function ya(n,e,t){t===void 0&&(t=!1),$s(n)===0?(t?Object.keys:pf)(n).forEach((function(o){t&&typeof o=="symbol"||e(o,n[o],n)})):n.forEach((function(o,i){return e(i,o,n)}))}function $s(n){var e=n[go];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:af(n)?2:lf(n)?3:0}function qd(n,e){return $s(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function AR(n,e){return $s(n)===2?n.get(e):n[e]}function Ig(n,e,t){var o=$s(n);o===2?n.set(e,t):o===3?n.add(t):n[e]=t}function OR(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function af(n){return $R&&n instanceof Map}function lf(n){return PR&&n instanceof Set}function hr(n){return n.o||n.t}function uf(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=BR(n);delete e[go];for(var t=pf(e),o=0;o<t.length;o++){var i=t[o],r=e[i];r.writable===!1&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(e[i]={configurable:!0,writable:!0,enumerable:r.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function df(n,e){return e===void 0&&(e=!1),cf(n)||Dr(n)||!Ar(n)||($s(n)>1&&(n.set=n.add=n.clear=n.delete=NR),Object.freeze(n),e&&ya(n,(function(t,o){return df(o,!0)}),!0)),n}function NR(){qo(2)}function cf(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function pi(n){var e=LR[n];return e||qo(18,n),e}function ip(){return ba}function ud(n,e){e&&(pi("Patches"),n.u=[],n.s=[],n.v=e)}function Ll(n){Gd(n),n.p.forEach(MR),n.p=null}function Gd(n){n===ba&&(ba=n.l)}function rp(n){return ba={p:[],l:ba,h:n,m:!0,_:0}}function MR(n){var e=n[go];e.i===0||e.i===1?e.j():e.g=!0}function dd(n,e){e._=e.p.length;var t=e.p[0],o=n!==void 0&&n!==t;return e.h.O||pi("ES5").S(e,n,o),o?(t[go].P&&(Ll(e),qo(4)),Ar(n)&&(n=Il(e,n),e.l||Fl(e,n)),e.u&&pi("Patches").M(t[go].t,n,e.u,e.s)):n=Il(e,t,[]),Ll(e),e.u&&e.v(e.u,e.s),n!==Fg?n:void 0}function Il(n,e,t){if(cf(e))return e;var o=e[go];if(!o)return ya(e,(function(a,l){return sp(n,o,e,a,l,t)}),!0),e;if(o.A!==n)return e;if(!o.P)return Fl(n,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var i=o.i===4||o.i===5?o.o=uf(o.k):o.o,r=i,s=!1;o.i===3&&(r=new Set(i),i.clear(),s=!0),ya(r,(function(a,l){return sp(n,o,i,a,l,t,s)})),Fl(n,i,!1),t&&n.u&&pi("Patches").N(o,t,n.u,n.s)}return o.o}function sp(n,e,t,o,i,r,s){if(Dr(i)){var a=Il(n,i,r&&e&&e.i!==3&&!qd(e.R,o)?r.concat(o):void 0);if(Ig(t,o,a),!Dr(a))return;n.m=!1}else s&&t.add(i);if(Ar(i)&&!cf(i)){if(!n.h.D&&n._<1)return;Il(n,i),e&&e.A.l||Fl(n,i)}}function Fl(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&df(e,t)}function cd(n,e){var t=n[go];return(t?hr(t):n)[e]}function ap(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var o=Object.getOwnPropertyDescriptor(t,e);if(o)return o;t=Object.getPrototypeOf(t)}}function Xd(n){n.P||(n.P=!0,n.l&&Xd(n.l))}function fd(n){n.o||(n.o=uf(n.t))}function Wd(n,e,t){var o=af(e)?pi("MapSet").F(e,t):lf(e)?pi("MapSet").T(e,t):n.O?(function(i,r){var s=Array.isArray(i),a={i:s?1:0,A:r?r.A:ip(),P:!1,I:!1,R:{},l:r,t:i,k:null,o:null,j:null,C:!1},l=a,u=Yd;s&&(l=[a],u=Ws);var c=Proxy.revocable(l,u),f=c.revoke,p=c.proxy;return a.k=p,a.j=f,p})(e,t):pi("ES5").J(e,t);return(t?t.A:ip()).p.push(o),o}function TR(n){return Dr(n)||qo(22,n),(function e(t){if(!Ar(t))return t;var o,i=t[go],r=$s(t);if(i){if(!i.P&&(i.i<4||!pi("ES5").K(i)))return i.t;i.I=!0,o=lp(t,r),i.I=!1}else o=lp(t,r);return ya(o,(function(s,a){i&&AR(i.t,s)===a||Ig(o,s,e(a))})),r===3?new Set(o):o})(n)}function lp(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return uf(n)}var up,ba,ff=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",$R=typeof Map<"u",PR=typeof Set<"u",dp=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Fg=ff?Symbol.for("immer-nothing"):((up={})["immer-nothing"]=!0,up),cp=ff?Symbol.for("immer-draftable"):"__$immer_draftable",go=ff?Symbol.for("immer-state"):"__$immer_state",RR=""+Object.prototype.constructor,pf=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,BR=Object.getOwnPropertyDescriptors||function(n){var e={};return pf(n).forEach((function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)})),e},LR={},Yd={get:function(n,e){if(e===go)return n;var t=hr(n);if(!qd(t,e))return(function(i,r,s){var a,l=ap(r,s);return l?"value"in l?l.value:(a=l.get)===null||a===void 0?void 0:a.call(i.k):void 0})(n,t,e);var o=t[e];return n.I||!Ar(o)?o:o===cd(n.t,e)?(fd(n),n.o[e]=Wd(n.A.h,o,n)):o},has:function(n,e){return e in hr(n)},ownKeys:function(n){return Reflect.ownKeys(hr(n))},set:function(n,e,t){var o=ap(hr(n),e);if(o!=null&&o.set)return o.set.call(n.k,t),!0;if(!n.P){var i=cd(hr(n),e),r=i==null?void 0:i[go];if(r&&r.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(OR(t,i)&&(t!==void 0||qd(n.t,e)))return!0;fd(n),Xd(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return cd(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,fd(n),Xd(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=hr(n),o=Reflect.getOwnPropertyDescriptor(t,e);return o&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:o.enumerable,value:t[e]}},defineProperty:function(){qo(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){qo(12)}},Ws={};ya(Yd,(function(n,e){Ws[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),Ws.deleteProperty=function(n,e){return Ws.set.call(this,n,e,void 0)},Ws.set=function(n,e,t){return Yd.set.call(this,n[0],e,t,n[0])};var IR=(function(){function n(t){var o=this;this.O=dp,this.D=!0,this.produce=function(i,r,s){if(typeof i=="function"&&typeof r!="function"){var a=r;r=i;var l=o;return function(_){var m=this;_===void 0&&(_=a);for(var g=arguments.length,b=Array(g>1?g-1:0),C=1;C<g;C++)b[C-1]=arguments[C];return l.produce(_,(function(D){var T;return(T=r).call.apply(T,[m,D].concat(b))}))}}var u;if(typeof r!="function"&&qo(6),s!==void 0&&typeof s!="function"&&qo(7),Ar(i)){var c=rp(o),f=Wd(o,i,void 0),p=!0;try{u=r(f),p=!1}finally{p?Ll(c):Gd(c)}return typeof Promise<"u"&&u instanceof Promise?u.then((function(_){return ud(c,s),dd(_,c)}),(function(_){throw Ll(c),_})):(ud(c,s),dd(u,c))}if(!i||typeof i!="object"){if((u=r(i))===void 0&&(u=i),u===Fg&&(u=void 0),o.D&&df(u,!0),s){var h=[],v=[];pi("Patches").M(i,u,h,v),s(h,v)}return u}qo(21,i)},this.produceWithPatches=function(i,r){if(typeof i=="function")return function(u){for(var c=arguments.length,f=Array(c>1?c-1:0),p=1;p<c;p++)f[p-1]=arguments[p];return o.produceWithPatches(u,(function(h){return i.apply(void 0,[h].concat(f))}))};var s,a,l=o.produce(i,r,(function(u,c){s=u,a=c}));return typeof Promise<"u"&&l instanceof Promise?l.then((function(u){return[u,s,a]})):[l,s,a]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){Ar(t)||qo(8),Dr(t)&&(t=TR(t));var o=rp(this),i=Wd(this,t,void 0);return i[go].C=!0,Gd(o),i},e.finishDraft=function(t,o){var i=t&&t[go],r=i.A;return ud(r,o),dd(void 0,r)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!dp&&qo(20),this.O=t},e.applyPatches=function(t,o){var i;for(i=o.length-1;i>=0;i--){var r=o[i];if(r.path.length===0&&r.op==="replace"){t=r.value;break}}i>-1&&(o=o.slice(i+1));var s=pi("Patches").$;return Dr(t)?s(t,o):this.produce(t,(function(a){return s(a,o)}))},n})(),_o=new IR,Vu=_o.produce;_o.produceWithPatches.bind(_o);_o.setAutoFreeze.bind(_o);_o.setUseProxies.bind(_o);_o.applyPatches.bind(_o);var fp=_o.createDraft.bind(_o),pp=_o.finishDraft.bind(_o);function Li(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var hp=new WeakMap,vp=new WeakMap,gp=new WeakMap,_p=new WeakMap,mp=new WeakMap,yp=new WeakMap;function FR(n,e){if(n==null)return{};var t={},o=Object.keys(n),i,r;for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function Mi(n,e){if(n==null)return{};var t=FR(n,e),o,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(t[o]=n[o])}return t}var hf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=!t,i=t?qR(e):e,r=Bt.None,s=Bt.None,a=0,l=null,u=null;for(var c of i){var f=c.codePointAt(0);if(!f)break;var p=o5(c,f);if([r,s]=o?[s,p]:[p,r],Jr(r,Bt.ZWJ)&&Jr(s,Bt.ExtPict)&&(o?l=bp(e.substring(0,a)):l=bp(e.substring(0,e.length-a)),!l)||Jr(r,Bt.RI)&&Jr(s,Bt.RI)&&(u!==null?u=!u:o?u=!0:u=l5(e.substring(0,e.length-a)),!u)||r!==Bt.None&&s!==Bt.None&&r5(r,s))break;a+=c.length}return a||1},jR=/\s/,VR=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,HR=/['\u2018\u2019]/,UR=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=0,i=!1;e.length>0;){var r=hf(e,t),[s,a]=vf(e,r,t);if(zR(s,a,t))i=!0,o+=r;else if(!i)o+=r;else break;e=a}return o},vf=(n,e,t)=>{if(t){var o=n.length-e;return[n.slice(o,n.length),n.slice(0,o)]}return[n.slice(0,e),n.slice(e)]},zR=function n(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(jR.test(e))return!1;if(HR.test(e)){var i=hf(t,o),[r,s]=vf(t,i,o);if(n(r,s,o))return!0}return!VR.test(e)},qR=function*(e){for(var t=e.length-1,o=0;o<e.length;o++){var i=e.charAt(t-o);if(XR(i.charCodeAt(0))){var r=e.charAt(t-o-1);if(GR(r.charCodeAt(0))){yield r+i,o++;continue}}yield i}},GR=n=>n>=55296&&n<=56319,XR=n=>n>=56320&&n<=57343,Bt;(function(n){n[n.None=0]="None",n[n.Extend=1]="Extend",n[n.ZWJ=2]="ZWJ",n[n.RI=4]="RI",n[n.Prepend=8]="Prepend",n[n.SpacingMark=16]="SpacingMark",n[n.L=32]="L",n[n.V=64]="V",n[n.T=128]="T",n[n.LV=256]="LV",n[n.LVT=512]="LVT",n[n.ExtPict=1024]="ExtPict",n[n.Any=2048]="Any"})(Bt||(Bt={}));var WR=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,YR=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,KR=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,JR=/^[\u1100-\u115F\uA960-\uA97C]$/,ZR=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,QR=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,e5=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,t5=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,n5=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,o5=(n,e)=>{var t=Bt.Any;return n.search(WR)!==-1&&(t|=Bt.Extend),e===8205&&(t|=Bt.ZWJ),e>=127462&&e<=127487&&(t|=Bt.RI),n.search(YR)!==-1&&(t|=Bt.Prepend),n.search(KR)!==-1&&(t|=Bt.SpacingMark),n.search(JR)!==-1&&(t|=Bt.L),n.search(ZR)!==-1&&(t|=Bt.V),n.search(QR)!==-1&&(t|=Bt.T),n.search(e5)!==-1&&(t|=Bt.LV),n.search(t5)!==-1&&(t|=Bt.LVT),n.search(n5)!==-1&&(t|=Bt.ExtPict),t};function Jr(n,e){return(n&e)!==0}var i5=[[Bt.L,Bt.L|Bt.V|Bt.LV|Bt.LVT],[Bt.LV|Bt.V,Bt.V|Bt.T],[Bt.LVT|Bt.T,Bt.T],[Bt.Any,Bt.Extend|Bt.ZWJ],[Bt.Any,Bt.SpacingMark],[Bt.Prepend,Bt.Any],[Bt.ZWJ,Bt.ExtPict],[Bt.RI,Bt.RI]];function r5(n,e){return i5.findIndex(t=>Jr(n,t[0])&&Jr(e,t[1]))===-1}var s5=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,bp=n=>n.search(s5)!==-1,a5=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,l5=n=>{var e=n.match(a5);if(e===null)return!1;var t=e[0].length/2;return t%2===1},xp=n=>Yn(n)&&_t.isNodeList(n.children)&&!le.isEditor(n),An={isAncestor(n){return Yn(n)&&_t.isNodeList(n.children)},isElement:xp,isElementList(n){return Array.isArray(n)&&n.every(e=>An.isElement(e))},isElementProps(n){return n.children!==void 0},isElementType:function(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return xp(e)&&e[o]===t},matches(n,e){for(var t in e)if(t!=="children"&&n[t]!==e[t])return!1;return!0}},u5=["text"],d5=["text"];function wp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Ir(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wp(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var Cp=new WeakMap,le={above(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:t=!1,mode:o="lowest",at:i=n.selection,match:r}=e;if(i){var s=le.path(n,i),a=o==="lowest";for(var[l,u]of le.levels(n,{at:s,voids:t,match:r,reverse:a}))if(!jt.isText(l)&&!Ae.equals(s,u))return[l,u]}},addMark(n,e,t){n.addMark(e,t)},after(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=le.point(n,e,{edge:"end"}),i=le.end(n,[]),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var u of le.positions(n,Ir(Ir({},t),{},{at:r}))){if(a>s)break;a!==0&&(l=u),a++}return l},before(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=le.start(n,[]),i=le.point(n,e,{edge:"start"}),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var u of le.positions(n,Ir(Ir({},t),{},{at:r,reverse:!0}))){if(a>s)break;a!==0&&(l=u),a++}return l},deleteBackward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteBackward(t)},deleteForward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteForward(t)},deleteFragment(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:t="forward"}=e;n.deleteFragment(t)},edges(n,e){return[le.start(n,e),le.end(n,e)]},end(n,e){return le.point(n,e,{edge:"end"})},first(n,e){var t=le.path(n,e,{edge:"start"});return le.node(n,t)},fragment(n,e){var t=le.range(n,e),o=_t.fragment(n,t);return o},hasBlocks(n,e){return e.children.some(t=>le.isBlock(n,t))},hasInlines(n,e){return e.children.some(t=>jt.isText(t)||le.isInline(n,t))},hasTexts(n,e){return e.children.every(t=>jt.isText(t))},insertBreak(n){n.insertBreak()},insertFragment(n,e){n.insertFragment(e)},insertNode(n,e){n.insertNode(e)},insertText(n,e){n.insertText(e)},isBlock(n,e){return An.isElement(e)&&!n.isInline(e)},isEditor(n){if(!Yn(n))return!1;var e=Cp.get(n);if(e!==void 0)return e;var t=typeof n.addMark=="function"&&typeof n.apply=="function"&&typeof n.deleteBackward=="function"&&typeof n.deleteForward=="function"&&typeof n.deleteFragment=="function"&&typeof n.insertBreak=="function"&&typeof n.insertFragment=="function"&&typeof n.insertNode=="function"&&typeof n.insertText=="function"&&typeof n.isInline=="function"&&typeof n.isVoid=="function"&&typeof n.normalizeNode=="function"&&typeof n.onChange=="function"&&typeof n.removeMark=="function"&&(n.marks===null||Yn(n.marks))&&(n.selection===null||it.isRange(n.selection))&&_t.isNodeList(n.children)&&Ys.isOperationList(n.operations);return Cp.set(n,t),t},isEnd(n,e,t){var o=le.end(n,t);return un.equals(e,o)},isEdge(n,e,t){return le.isStart(n,e,t)||le.isEnd(n,e,t)},isEmpty(n,e){var{children:t}=e,[o]=t;return t.length===0||t.length===1&&jt.isText(o)&&o.text===""&&!n.isVoid(e)},isInline(n,e){return An.isElement(e)&&n.isInline(e)},isNormalizing(n){var e=gp.get(n);return e===void 0?!0:e},isStart(n,e,t){if(e.offset!==0)return!1;var o=le.start(n,t);return un.equals(e,o)},isVoid(n,e){return An.isElement(e)&&n.isVoid(e)},last(n,e){var t=le.path(n,e,{edge:"end"});return le.node(n,t)},leaf(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=le.path(n,e,t),i=_t.leaf(n,o);return[i,o]},*levels(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,reverse:o=!1,voids:i=!1}=e,{match:r}=e;if(r==null&&(r=()=>!0),!!t){var s=[],a=le.path(n,t);for(var[l,u]of _t.levels(n,a))if(r(l,u)&&(s.push([l,u]),!i&&le.isVoid(n,l)))break;o&&s.reverse(),yield*s}},marks(n){var{marks:e,selection:t}=n;if(!t)return null;if(e)return e;if(it.isExpanded(t)){var[o]=le.nodes(n,{match:jt.isText});if(o){var[i]=o,r=Mi(i,u5);return r}else return{}}var{anchor:s}=t,{path:a}=s,[l]=le.leaf(n,a);if(s.offset===0){var u=le.previous(n,{at:a,match:jt.isText}),c=le.above(n,{match:_=>le.isBlock(n,_)});if(u&&c){var[f,p]=u,[,h]=c;Ae.isAncestor(h,p)&&(l=f)}}var v=Mi(l,d5);return v},next(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=le.after(n,r,{voids:o});if(s){var[,a]=le.last(n,[]),l=[s.path,a];if(Ae.isPath(r)&&r.length===0)throw new Error("Cannot get the next node from the root node!");if(i==null)if(Ae.isPath(r)){var[u]=le.parent(n,r);i=f=>u.children.includes(f)}else i=()=>!0;var[c]=le.nodes(n,{at:l,match:i,mode:t,voids:o});return c}}},node(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=le.path(n,e,t),i=_t.get(n,o);return[i,o]},*nodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,mode:o="all",universal:i=!1,reverse:r=!1,voids:s=!1}=e,{match:a}=e;if(a||(a=()=>!0),!!t){var l,u;if(c5.isSpan(t))l=t[0],u=t[1];else{var c=le.path(n,t,{edge:"start"}),f=le.path(n,t,{edge:"end"});l=r?f:c,u=r?c:f}var p=_t.nodes(n,{reverse:r,from:l,to:u,pass:C=>{var[D]=C;return s?!1:le.isVoid(n,D)}}),h=[],v;for(var[_,m]of p){var g=v&&Ae.compare(m,v[1])===0;if(!(o==="highest"&&g)){if(!a(_,m)){if(i&&!g&&jt.isText(_))return;continue}if(o==="lowest"&&g){v=[_,m];continue}var b=o==="lowest"?v:[_,m];b&&(i?h.push(b):yield b),v=[_,m]}}o==="lowest"&&v&&(i?h.push(v):yield v),i&&(yield*h)}},normalize(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:t=!1}=e,o=l=>hp.get(l)||[],i=l=>vp.get(l)||new Set,r=l=>{var u=o(l).pop(),c=u.join(",");return i(l).delete(c),u};if(le.isNormalizing(n)){if(t){var s=Array.from(_t.nodes(n),l=>{var[,u]=l;return u}),a=new Set(s.map(l=>l.join(",")));hp.set(n,s),vp.set(n,a)}o(n).length!==0&&le.withoutNormalizing(n,()=>{for(var l of o(n))if(_t.has(n,l)){var u=le.node(n,l),[c,f]=u;An.isElement(c)&&c.children.length===0&&n.normalizeNode(u)}for(var p=o(n).length*42,h=0;o(n).length!==0;){if(h>p)throw new Error(`
            Could not completely normalize the editor after `.concat(p,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var v=r(n);if(_t.has(n,v)){var _=le.node(n,v);n.normalizeNode(_)}h++}})}},parent(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=le.path(n,e,t),i=Ae.parent(o),r=le.node(n,i);return r},path(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:o,edge:i}=t;if(Ae.isPath(e)){if(i==="start"){var[,r]=_t.first(n,e);e=r}else if(i==="end"){var[,s]=_t.last(n,e);e=s}}return it.isRange(e)&&(i==="start"?e=it.start(e):i==="end"?e=it.end(e):e=Ae.common(e.anchor.path,e.focus.path)),un.isPoint(e)&&(e=e.path),o!=null&&(e=e.slice(0,o)),e},hasPath(n,e){return _t.has(n,e)},pathRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=le.pathRefs(n);return a.delete(i),i.current=null,s}},r=le.pathRefs(n);return r.add(i),i},pathRefs(n){var e=_p.get(n);return e||(e=new Set,_p.set(n,e)),e},point(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:o="start"}=t;if(Ae.isPath(e)){var i;if(o==="end"){var[,r]=_t.last(n,e);i=r}else{var[,s]=_t.first(n,e);i=s}var a=_t.get(n,i);if(!jt.isText(a))throw new Error("Cannot get the ".concat(o," point in the node at path [").concat(e,"] because it has no ").concat(o," text node."));return{path:i,offset:o==="end"?a.text.length:0}}if(it.isRange(e)){var[l,u]=it.edges(e);return o==="start"?l:u}return e},pointRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=le.pointRefs(n);return a.delete(i),i.current=null,s}},r=le.pointRefs(n);return r.add(i),i},pointRefs(n){var e=mp.get(n);return e||(e=new Set,mp.set(n,e)),e},*positions(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,unit:o="offset",reverse:i=!1,voids:r=!1}=e;if(!t)return;var s=le.range(n,t),[a,l]=it.edges(s),u=i?l:a,c=!1,f="",p=0,h=0,v=0;for(var[_,m]of le.nodes(n,{at:t,reverse:i,voids:r})){if(An.isElement(_)){if(!r&&n.isVoid(_)){yield le.start(n,m);continue}if(n.isInline(_))continue;if(le.hasInlines(n,_)){var g=Ae.isAncestor(m,l.path)?l:le.end(n,m),b=Ae.isAncestor(m,a.path)?a:le.start(n,m);f=le.string(n,{anchor:b,focus:g},{voids:r}),c=!0}}if(jt.isText(_)){var C=Ae.equals(m,u.path);for(C?(h=i?u.offset:_.text.length-u.offset,v=u.offset):(h=_.text.length,v=i?h:0),(C||c||o==="offset")&&(yield{path:m,offset:v},c=!1);;){if(p===0){if(f==="")break;p=D(f,o,i),f=vf(f,p,i)[1]}if(v=i?v-p:v+p,h=h-p,h<0){p=-h;break}p=0,yield{path:m,offset:v}}}}function D(T,O,k){return O==="character"?hf(T,k):O==="word"?UR(T,k):O==="line"||O==="block"?T.length:1}},previous(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=le.before(n,r,{voids:o});if(s){var[,a]=le.first(n,[]),l=[s.path,a];if(Ae.isPath(r)&&r.length===0)throw new Error("Cannot get the previous node from the root node!");if(i==null)if(Ae.isPath(r)){var[u]=le.parent(n,r);i=f=>u.children.includes(f)}else i=()=>!0;var[c]=le.nodes(n,{reverse:!0,at:l,match:i,mode:t,voids:o});return c}}},range(n,e,t){if(it.isRange(e)&&!t)return e;var o=le.start(n,e),i=le.end(n,t||e);return{anchor:o,focus:i}},rangeRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=le.rangeRefs(n);return a.delete(i),i.current=null,s}},r=le.rangeRefs(n);return r.add(i),i},rangeRefs(n){var e=yp.get(n);return e||(e=new Set,yp.set(n,e)),e},removeMark(n,e){n.removeMark(e)},setNormalizing(n,e){gp.set(n,e)},start(n,e){return le.point(n,e,{edge:"start"})},string(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,i=le.range(n,e),[r,s]=it.edges(i),a="";for(var[l,u]of le.nodes(n,{at:i,match:jt.isText,voids:o})){var c=l.text;Ae.equals(u,s.path)&&(c=c.slice(0,s.offset)),Ae.equals(u,r.path)&&(c=c.slice(r.offset)),a+=c}return a},unhangRange(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,[i,r]=it.edges(e);if(i.offset!==0||r.offset!==0||it.isCollapsed(e))return e;var s=le.above(n,{at:r,match:h=>le.isBlock(n,h)}),a=s?s[1]:[],l=le.start(n,i),u={anchor:l,focus:r},c=!0;for(var[f,p]of le.nodes(n,{at:u,match:jt.isText,reverse:!0,voids:o})){if(c){c=!1;continue}if(f.text!==""||Ae.isBefore(p,a)){r={path:p,offset:f.text.length};break}}return{anchor:i,focus:r}},void(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return le.above(n,Ir(Ir({},e),{},{match:t=>le.isVoid(n,t)}))},withoutNormalizing(n,e){var t=le.isNormalizing(n);le.setNormalizing(n,!1);try{e()}finally{le.setNormalizing(n,t)}le.normalize(n)}},c5={isSpan(n){return Array.isArray(n)&&n.length===2&&n.every(Ae.isPath)}},f5=["children"],p5=["text"],Sp=new WeakMap,_t={ancestor(n,e){var t=_t.get(n,e);if(jt.isText(t))throw new Error("Cannot get the ancestor node at path [".concat(e,"] because it refers to a text node instead: ").concat(t));return t},*ancestors(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Ae.ancestors(e,t)){var i=_t.ancestor(n,o),r=[i,o];yield r}},child(n,e){if(jt.isText(n))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(n)));var t=n.children[e];if(t==null)throw new Error("Cannot get child at index `".concat(e,"` in node: ").concat(JSON.stringify(n)));return t},*children(n,e){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:o=!1}=t,i=_t.ancestor(n,e),{children:r}=i,s=o?r.length-1:0;o?s>=0:s<r.length;){var a=_t.child(i,s),l=e.concat(s);yield[a,l],s=o?s-1:s+1}},common(n,e,t){var o=Ae.common(e,t),i=_t.get(n,o);return[i,o]},descendant(n,e){var t=_t.get(n,e);if(le.isEditor(t))throw new Error("Cannot get the descendant node at path [".concat(e,"] because it refers to the root editor node instead: ").concat(t));return t},*descendants(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))o.length!==0&&(yield[t,o])},*elements(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))An.isElement(t)&&(yield[t,o])},extractProps(n){if(An.isAncestor(n)){var e=Mi(n,f5);return e}else{var e=Mi(n,p5);return e}},first(n,e){for(var t=e.slice(),o=_t.get(n,t);o&&!(jt.isText(o)||o.children.length===0);)o=o.children[0],t.push(0);return[o,t]},fragment(n,e){if(jt.isText(n))throw new Error("Cannot get a fragment starting from a root text node: ".concat(JSON.stringify(n)));var t=Vu({children:n.children},o=>{var[i,r]=it.edges(e),s=_t.nodes(o,{reverse:!0,pass:p=>{var[,h]=p;return!it.includes(e,h)}});for(var[,a]of s){if(!it.includes(e,a)){var l=_t.parent(o,a),u=a[a.length-1];l.children.splice(u,1)}if(Ae.equals(a,r.path)){var c=_t.leaf(o,a);c.text=c.text.slice(0,r.offset)}if(Ae.equals(a,i.path)){var f=_t.leaf(o,a);f.text=f.text.slice(i.offset)}}le.isEditor(o)&&(o.selection=null)});return t.children},get(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(jt.isText(t)||!t.children[i])throw new Error("Cannot find a descendant at path [".concat(e,"] in node: ").concat(JSON.stringify(n)));t=t.children[i]}return t},has(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(jt.isText(t)||!t.children[i])return!1;t=t.children[i]}return!0},isNode(n){return jt.isText(n)||An.isElement(n)||le.isEditor(n)},isNodeList(n){if(!Array.isArray(n))return!1;var e=Sp.get(n);if(e!==void 0)return e;var t=n.every(o=>_t.isNode(o));return Sp.set(n,t),t},last(n,e){for(var t=e.slice(),o=_t.get(n,t);o&&!(jt.isText(o)||o.children.length===0);){var i=o.children.length-1;o=o.children[i],t.push(i)}return[o,t]},leaf(n,e){var t=_t.get(n,e);if(!jt.isText(t))throw new Error("Cannot get the leaf node at path [".concat(e,"] because it refers to a non-leaf node: ").concat(t));return t},*levels(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Ae.levels(e,t)){var i=_t.get(n,o);yield[i,o]}},matches(n,e){return An.isElement(n)&&An.isElementProps(e)&&An.matches(n,e)||jt.isText(n)&&jt.isTextProps(e)&&jt.matches(n,e)},*nodes(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:t,reverse:o=!1}=e,{from:i=[],to:r}=e,s=new Set,a=[],l=n;!(r&&(o?Ae.isBefore(a,r):Ae.isAfter(a,r)));){if(s.has(l)||(yield[l,a]),!s.has(l)&&!jt.isText(l)&&l.children.length!==0&&(t==null||t([l,a])===!1)){s.add(l);var u=o?l.children.length-1:0;Ae.isAncestor(a,i)&&(u=i[a.length]),a=a.concat(u),l=_t.get(n,a);continue}if(a.length===0)break;if(!o){var c=Ae.next(a);if(_t.has(n,c)){a=c,l=_t.get(n,a);continue}}if(o&&a[a.length-1]!==0){var f=Ae.previous(a);a=f,l=_t.get(n,a);continue}a=Ae.parent(a),l=_t.get(n,a),s.add(l)}},parent(n,e){var t=Ae.parent(e),o=_t.get(n,t);if(jt.isText(o))throw new Error("Cannot get the parent of path [".concat(e,"] because it does not exist in the root."));return o},string(n){return jt.isText(n)?n.text:n.children.map(_t.string).join("")},*texts(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))jt.isText(t)&&(yield[t,o])}};function kp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Cn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?kp(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):kp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var Ys={isNodeOperation(n){return Ys.isOperation(n)&&n.type.endsWith("_node")},isOperation(n){if(!Yn(n))return!1;switch(n.type){case"insert_node":return Ae.isPath(n.path)&&_t.isNode(n.node);case"insert_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Ae.isPath(n.path);case"merge_node":return typeof n.position=="number"&&Ae.isPath(n.path)&&Yn(n.properties);case"move_node":return Ae.isPath(n.path)&&Ae.isPath(n.newPath);case"remove_node":return Ae.isPath(n.path)&&_t.isNode(n.node);case"remove_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Ae.isPath(n.path);case"set_node":return Ae.isPath(n.path)&&Yn(n.properties)&&Yn(n.newProperties);case"set_selection":return n.properties===null&&it.isRange(n.newProperties)||n.newProperties===null&&it.isRange(n.properties)||Yn(n.properties)&&Yn(n.newProperties);case"split_node":return Ae.isPath(n.path)&&typeof n.position=="number"&&Yn(n.properties);default:return!1}},isOperationList(n){return Array.isArray(n)&&n.every(e=>Ys.isOperation(e))},isSelectionOperation(n){return Ys.isOperation(n)&&n.type.endsWith("_selection")},isTextOperation(n){return Ys.isOperation(n)&&n.type.endsWith("_text")},inverse(n){switch(n.type){case"insert_node":return Cn(Cn({},n),{},{type:"remove_node"});case"insert_text":return Cn(Cn({},n),{},{type:"remove_text"});case"merge_node":return Cn(Cn({},n),{},{type:"split_node",path:Ae.previous(n.path)});case"move_node":{var{newPath:e,path:t}=n;if(Ae.equals(e,t))return n;if(Ae.isSibling(t,e))return Cn(Cn({},n),{},{path:e,newPath:t});var o=Ae.transform(t,n),i=Ae.transform(Ae.next(t),n);return Cn(Cn({},n),{},{path:o,newPath:i})}case"remove_node":return Cn(Cn({},n),{},{type:"insert_node"});case"remove_text":return Cn(Cn({},n),{},{type:"insert_text"});case"set_node":{var{properties:r,newProperties:s}=n;return Cn(Cn({},n),{},{properties:s,newProperties:r})}case"set_selection":{var{properties:a,newProperties:l}=n;return a==null?Cn(Cn({},n),{},{properties:l,newProperties:null}):l==null?Cn(Cn({},n),{},{properties:null,newProperties:a}):Cn(Cn({},n),{},{properties:l,newProperties:a})}case"split_node":return Cn(Cn({},n),{},{type:"merge_node",path:Ae.next(n.path)})}}},Ae={ancestors(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=Ae.levels(n,e);return t?o=o.slice(1):o=o.slice(0,-1),o},common(n,e){for(var t=[],o=0;o<n.length&&o<e.length;o++){var i=n[o],r=e[o];if(i!==r)break;t.push(i)}return t},compare(n,e){for(var t=Math.min(n.length,e.length),o=0;o<t;o++){if(n[o]<e[o])return-1;if(n[o]>e[o])return 1}return 0},endsAfter(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Ae.equals(o,i)&&r>s},endsAt(n,e){var t=n.length,o=n.slice(0,t),i=e.slice(0,t);return Ae.equals(o,i)},endsBefore(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Ae.equals(o,i)&&r<s},equals(n,e){return n.length===e.length&&n.every((t,o)=>t===e[o])},hasPrevious(n){return n[n.length-1]>0},isAfter(n,e){return Ae.compare(n,e)===1},isAncestor(n,e){return n.length<e.length&&Ae.compare(n,e)===0},isBefore(n,e){return Ae.compare(n,e)===-1},isChild(n,e){return n.length===e.length+1&&Ae.compare(n,e)===0},isCommon(n,e){return n.length<=e.length&&Ae.compare(n,e)===0},isDescendant(n,e){return n.length>e.length&&Ae.compare(n,e)===0},isParent(n,e){return n.length+1===e.length&&Ae.compare(n,e)===0},isPath(n){return Array.isArray(n)&&(n.length===0||typeof n[0]=="number")},isSibling(n,e){if(n.length!==e.length)return!1;var t=n.slice(0,-1),o=e.slice(0,-1),i=n[n.length-1],r=e[e.length-1];return i!==r&&Ae.equals(t,o)},levels(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=[],i=0;i<=n.length;i++)o.push(n.slice(0,i));return t&&o.reverse(),o},next(n){if(n.length===0)throw new Error("Cannot get the next path of a root path [".concat(n,"], because it has no next index."));var e=n[n.length-1];return n.slice(0,-1).concat(e+1)},operationCanTransformPath(n){switch(n.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(n){if(n.length===0)throw new Error("Cannot get the parent path of the root path [".concat(n,"]."));return n.slice(0,-1)},previous(n){if(n.length===0)throw new Error("Cannot get the previous path of a root path [".concat(n,"], because it has no previous index."));var e=n[n.length-1];if(e<=0)throw new Error("Cannot get the previous path of a first child path [".concat(n,"] because it would result in a negative index."));return n.slice(0,-1).concat(e-1)},relative(n,e){if(!Ae.isAncestor(e,n)&&!Ae.equals(n,e))throw new Error("Cannot get the relative path of [".concat(n,"] inside ancestor [").concat(e,"], because it is not above or equal to the path."));return n.slice(e.length)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Vu(n,o=>{var{affinity:i="forward"}=t;if(!(!n||(n==null?void 0:n.length)===0)){if(o===null)return null;switch(e.type){case"insert_node":{var{path:r}=e;(Ae.equals(r,o)||Ae.endsBefore(r,o)||Ae.isAncestor(r,o))&&(o[r.length-1]+=1);break}case"remove_node":{var{path:s}=e;if(Ae.equals(s,o)||Ae.isAncestor(s,o))return null;Ae.endsBefore(s,o)&&(o[s.length-1]-=1);break}case"merge_node":{var{path:a,position:l}=e;Ae.equals(a,o)||Ae.endsBefore(a,o)?o[a.length-1]-=1:Ae.isAncestor(a,o)&&(o[a.length-1]-=1,o[a.length]+=l);break}case"split_node":{var{path:u,position:c}=e;if(Ae.equals(u,o)){if(i==="forward")o[o.length-1]+=1;else if(i!=="backward")return null}else Ae.endsBefore(u,o)?o[u.length-1]+=1:Ae.isAncestor(u,o)&&n[u.length]>=c&&(o[u.length-1]+=1,o[u.length]-=c);break}case"move_node":{var{path:f,newPath:p}=e;if(Ae.equals(f,p))return;if(Ae.isAncestor(f,o)||Ae.equals(f,o)){var h=p.slice();return Ae.endsBefore(f,p)&&f.length<p.length&&(h[f.length-1]-=1),h.concat(o.slice(f.length))}else Ae.isSibling(f,p)&&(Ae.isAncestor(p,o)||Ae.equals(p,o))?Ae.endsBefore(f,o)?o[f.length-1]-=1:o[f.length-1]+=1:Ae.endsBefore(p,o)||Ae.equals(p,o)||Ae.isAncestor(p,o)?(Ae.endsBefore(f,o)&&(o[f.length-1]-=1),o[p.length-1]+=1):Ae.endsBefore(f,o)&&(Ae.equals(p,o)&&(o[p.length-1]+=1),o[f.length-1]-=1);break}}}})}};function Ep(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Dp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ep(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ep(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var un={compare(n,e){var t=Ae.compare(n.path,e.path);return t===0?n.offset<e.offset?-1:n.offset>e.offset?1:0:t},isAfter(n,e){return un.compare(n,e)===1},isBefore(n,e){return un.compare(n,e)===-1},equals(n,e){return n.offset===e.offset&&Ae.equals(n.path,e.path)},isPoint(n){return Yn(n)&&typeof n.offset=="number"&&Ae.isPath(n.path)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Vu(n,o=>{if(o===null)return null;var{affinity:i="forward"}=t,{path:r,offset:s}=o;switch(e.type){case"insert_node":case"move_node":{o.path=Ae.transform(r,e,t);break}case"insert_text":{Ae.equals(e.path,r)&&e.offset<=s&&(o.offset+=e.text.length);break}case"merge_node":{Ae.equals(e.path,r)&&(o.offset+=e.position),o.path=Ae.transform(r,e,t);break}case"remove_text":{Ae.equals(e.path,r)&&e.offset<=s&&(o.offset-=Math.min(s-e.offset,e.text.length));break}case"remove_node":{if(Ae.equals(e.path,r)||Ae.isAncestor(e.path,r))return null;o.path=Ae.transform(r,e,t);break}case"split_node":{if(Ae.equals(e.path,r)){if(e.position===s&&i==null)return null;(e.position<s||e.position===s&&i==="forward")&&(o.offset-=e.position,o.path=Ae.transform(r,e,Dp(Dp({},t),{},{affinity:"forward"})))}else o.path=Ae.transform(r,e,t);break}}})}},h5=["anchor","focus"];function Ap(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function v5(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ap(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ap(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var it={edges(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,{anchor:o,focus:i}=n;return it.isBackward(n)===t?[o,i]:[i,o]},end(n){var[,e]=it.edges(n);return e},equals(n,e){return un.equals(n.anchor,e.anchor)&&un.equals(n.focus,e.focus)},includes(n,e){if(it.isRange(e)){if(it.includes(n,e.anchor)||it.includes(n,e.focus))return!0;var[t,o]=it.edges(n),[i,r]=it.edges(e);return un.isBefore(t,i)&&un.isAfter(o,r)}var[s,a]=it.edges(n),l=!1,u=!1;return un.isPoint(e)?(l=un.compare(e,s)>=0,u=un.compare(e,a)<=0):(l=Ae.compare(e,s.path)>=0,u=Ae.compare(e,a.path)<=0),l&&u},intersection(n,e){var t=Mi(n,h5),[o,i]=it.edges(n),[r,s]=it.edges(e),a=un.isBefore(o,r)?r:o,l=un.isBefore(i,s)?i:s;return un.isBefore(l,a)?null:v5({anchor:a,focus:l},t)},isBackward(n){var{anchor:e,focus:t}=n;return un.isAfter(e,t)},isCollapsed(n){var{anchor:e,focus:t}=n;return un.equals(e,t)},isExpanded(n){return!it.isCollapsed(n)},isForward(n){return!it.isBackward(n)},isRange(n){return Yn(n)&&un.isPoint(n.anchor)&&un.isPoint(n.focus)},*points(n){yield[n.anchor,"anchor"],yield[n.focus,"focus"]},start(n){var[e]=it.edges(n);return e},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Vu(n,o=>{if(o===null)return null;var{affinity:i="inward"}=t,r,s;if(i==="inward"){var a=it.isCollapsed(o);it.isForward(o)?(r="forward",s=a?r:"backward"):(r="backward",s=a?r:"forward")}else i==="outward"?it.isForward(o)?(r="backward",s="forward"):(r="forward",s="backward"):(r=i,s=i);var l=un.transform(o.anchor,e,{affinity:r}),u=un.transform(o.focus,e,{affinity:s});if(!l||!u)return null;o.anchor=l,o.focus=u})}},jg=(n,e)=>{for(var t in n){var o=n[t],i=e[t];if(Yn(o)&&Yn(i)){if(!jg(o,i))return!1}else if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;for(var r=0;r<o.length;r++)if(o[r]!==i[r])return!1}else if(o!==i)return!1}for(var s in e)if(n[s]===void 0&&e[s]!==void 0)return!1;return!0},g5=["text"],_5=["anchor","focus"];function Op(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Si(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Op(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Op(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var jt={equals(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:o=!1}=t;function i(r){var s=Mi(r,g5);return s}return jg(o?i(n):n,o?i(e):e)},isText(n){return Yn(n)&&typeof n.text=="string"},isTextList(n){return Array.isArray(n)&&n.every(e=>jt.isText(e))},isTextProps(n){return n.text!==void 0},matches(n,e){for(var t in e)if(t!=="text"&&(!n.hasOwnProperty(t)||n[t]!==e[t]))return!1;return!0},decorations(n,e){var t=[Si({},n)];for(var o of e){var i=Mi(o,_5),[r,s]=it.edges(o),a=[],l=0;for(var u of t){var{length:c}=u.text,f=l;if(l+=c,r.offset<=f&&s.offset>=l){Object.assign(u,i),a.push(u);continue}if(r.offset!==s.offset&&(r.offset===l||s.offset===f)||r.offset>l||s.offset<f||s.offset===f&&f!==0){a.push(u);continue}var p=u,h=void 0,v=void 0;if(s.offset<l){var _=s.offset-f;v=Si(Si({},p),{},{text:p.text.slice(_)}),p=Si(Si({},p),{},{text:p.text.slice(0,_)})}if(r.offset>f){var m=r.offset-f;h=Si(Si({},p),{},{text:p.text.slice(0,m)}),p=Si(Si({},p),{},{text:p.text.slice(m)})}Object.assign(p,i),h&&a.push(h),a.push(p),v&&a.push(v)}t=a}return t}};function Np(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Hs(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Np(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Np(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var m5=(n,e,t)=>{switch(t.type){case"insert_node":{var{path:o,node:i}=t,r=_t.parent(n,o),s=o[o.length-1];if(s>r.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(o,"] because the destination is past the end of the node."));if(r.children.splice(s,0,i),e)for(var[a,l]of it.points(e))e[l]=un.transform(a,t);break}case"insert_text":{var{path:u,offset:c,text:f}=t;if(f.length===0)break;var p=_t.leaf(n,u),h=p.text.slice(0,c),v=p.text.slice(c);if(p.text=h+f+v,e)for(var[_,m]of it.points(e))e[m]=un.transform(_,t);break}case"merge_node":{var{path:g}=t,b=_t.get(n,g),C=Ae.previous(g),D=_t.get(n,C),T=_t.parent(n,g),O=g[g.length-1];if(jt.isText(b)&&jt.isText(D))D.text+=b.text;else if(!jt.isText(b)&&!jt.isText(D))D.children.push(...b.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(g,"] to nodes of different interfaces: ").concat(b," ").concat(D));if(T.children.splice(O,1),e)for(var[k,S]of it.points(e))e[S]=un.transform(k,t);break}case"move_node":{var{path:N,newPath:L}=t;if(Ae.isAncestor(N,L))throw new Error("Cannot move a path [".concat(N,"] to new path [").concat(L,"] because the destination is inside itself."));var $=_t.get(n,N),B=_t.parent(n,N),E=N[N.length-1];B.children.splice(E,1);var A=Ae.transform(N,t),M=_t.get(n,Ae.parent(A)),F=A[A.length-1];if(M.children.splice(F,0,$),e)for(var[H,R]of it.points(e))e[R]=un.transform(H,t);break}case"remove_node":{var{path:G}=t,oe=G[G.length-1],V=_t.parent(n,G);if(V.children.splice(oe,1),e)for(var[Y,Q]of it.points(e)){var ue=un.transform(Y,t);if(e!=null&&ue!=null)e[Q]=ue;else{var te=void 0,q=void 0;for(var[re,ce]of _t.texts(n))if(Ae.compare(ce,G)===-1)te=[re,ce];else{q=[re,ce];break}var ve=!1;te&&q&&(Ae.equals(q[1],G)?ve=!Ae.hasPrevious(q[1]):ve=Ae.common(te[1],G).length<Ae.common(q[1],G).length),te&&!ve?(Y.path=te[1],Y.offset=te[0].text.length):q?(Y.path=q[1],Y.offset=0):e=null}}break}case"remove_text":{var{path:Ne,offset:ge,text:_e}=t;if(_e.length===0)break;var st=_t.leaf(n,Ne),tt=st.text.slice(0,ge),ke=st.text.slice(ge+_e.length);if(st.text=tt+ke,e)for(var[he,De]of it.points(e))e[De]=un.transform(he,t);break}case"set_node":{var{path:Me,properties:U,newProperties:ne}=t;if(Me.length===0)throw new Error("Cannot set properties on the root node!");var se=_t.get(n,Me);for(var Ee in ne){if(Ee==="children"||Ee==="text")throw new Error('Cannot set the "'.concat(Ee,'" property of nodes!'));var fe=ne[Ee];fe==null?delete se[Ee]:se[Ee]=fe}for(var Le in U)ne.hasOwnProperty(Le)||delete se[Le];break}case"set_selection":{var{newProperties:Ie}=t;if(Ie==null)e=Ie;else{if(e==null){if(!it.isRange(Ie))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(JSON.stringify(Ie)," when there is no current selection."));e=Hs({},Ie)}for(var Ve in Ie){var et=Ie[Ve];if(et==null){if(Ve==="anchor"||Ve==="focus")throw new Error('Cannot remove the "'.concat(Ve,'" selection property'));delete e[Ve]}else e[Ve]=et}}break}case"split_node":{var{path:nt,position:We,properties:lt}=t;if(nt.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(nt,"] because the root node cannot be split."));var de=_t.get(n,nt),pe=_t.parent(n,nt),xe=nt[nt.length-1],Ce;if(jt.isText(de)){var Fe=de.text.slice(0,We),Ue=de.text.slice(We);de.text=Fe,Ce=Hs(Hs({},lt),{},{text:Ue})}else{var qe=de.children.slice(0,We),at=de.children.slice(We);de.children=qe,Ce=Hs(Hs({},lt),{},{children:at})}if(pe.children.splice(xe+1,0,Ce),e)for(var[bt,Xt]of it.points(e))e[Xt]=un.transform(bt,t);break}}return e},y5={transform(n,e){n.children=fp(n.children);var t=n.selection&&fp(n.selection);try{t=m5(n,t,e)}finally{n.children=pp(n.children),t?n.selection=Dr(t)?pp(t):t:n.selection=null}}},b5=["text"],x5=["children"];function Mp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Tp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mp(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Mp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var w5={insertNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1,mode:r="lowest"}=t,{at:s,match:a,select:l}=t;if(_t.isNode(e)&&(e=[e]),e.length!==0){var[u]=e;if(s||(n.selection?s=n.selection:n.children.length>0?s=le.end(n,[]):s=[0],l=!0),l==null&&(l=!1),it.isRange(s))if(o||(s=le.unhangRange(n,s)),it.isCollapsed(s))s=s.anchor;else{var[,c]=it.edges(s),f=le.pointRef(n,c);$t.delete(n,{at:s}),s=f.unref()}if(un.isPoint(s)){a==null&&(jt.isText(u)?a=O=>jt.isText(O):n.isInline(u)?a=O=>jt.isText(O)||le.isInline(n,O):a=O=>le.isBlock(n,O));var[p]=le.nodes(n,{at:s.path,match:a,mode:r,voids:i});if(p){var[,h]=p,v=le.pathRef(n,h),_=le.isEnd(n,s,h);$t.splitNodes(n,{at:s,match:a,mode:r,voids:i});var m=v.unref();s=_?Ae.next(m):m}else return}var g=Ae.parent(s),b=s[s.length-1];if(!(!i&&le.void(n,{at:g}))){for(var C of e){var D=g.concat(b);b++,n.apply({type:"insert_node",path:D,node:C}),s=Ae.next(s)}if(s=Ae.previous(s),l){var T=le.end(n,s);T&&$t.select(n,T)}}}})},liftNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{at:t=n.selection,mode:o="lowest",voids:i=!1}=e,{match:r}=e;if(r==null&&(r=Ae.isPath(t)?Fr(n,t):C=>le.isBlock(n,C)),!!t){var s=le.nodes(n,{at:t,match:r,mode:o,voids:i}),a=Array.from(s,C=>{var[,D]=C;return le.pathRef(n,D)});for(var l of a){var u=l.unref();if(u.length<2)throw new Error("Cannot lift node at a path [".concat(u,"] because it has a depth of less than `2`."));var c=le.node(n,Ae.parent(u)),[f,p]=c,h=u[u.length-1],{length:v}=f.children;if(v===1){var _=Ae.next(p);$t.moveNodes(n,{at:u,to:_,voids:i}),$t.removeNodes(n,{at:p,voids:i})}else if(h===0)$t.moveNodes(n,{at:u,to:p,voids:i});else if(h===v-1){var m=Ae.next(p);$t.moveNodes(n,{at:u,to:m,voids:i})}else{var g=Ae.next(u),b=Ae.next(p);$t.splitNodes(n,{at:g,voids:i}),$t.moveNodes(n,{at:u,to:b,voids:i})}}}})},mergeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{match:t,at:o=n.selection}=e,{hanging:i=!1,voids:r=!1,mode:s="lowest"}=e;if(o){if(t==null)if(Ae.isPath(o)){var[a]=le.parent(n,o);t=N=>a.children.includes(N)}else t=N=>le.isBlock(n,N);if(!i&&it.isRange(o)&&(o=le.unhangRange(n,o)),it.isRange(o))if(it.isCollapsed(o))o=o.anchor;else{var[,l]=it.edges(o),u=le.pointRef(n,l);$t.delete(n,{at:o}),o=u.unref(),e.at==null&&$t.select(n,o)}var[c]=le.nodes(n,{at:o,match:t,voids:r,mode:s}),f=le.previous(n,{at:o,match:t,voids:r,mode:s});if(!(!c||!f)){var[p,h]=c,[v,_]=f;if(!(h.length===0||_.length===0)){var m=Ae.next(_),g=Ae.common(h,_),b=Ae.isSibling(h,_),C=Array.from(le.levels(n,{at:h}),N=>{var[L]=N;return L}).slice(g.length).slice(0,-1),D=le.above(n,{at:h,mode:"highest",match:N=>C.includes(N)&&Vg(n,N)}),T=D&&le.pathRef(n,D[1]),O,k;if(jt.isText(p)&&jt.isText(v)){var S=Mi(p,b5);k=v.text.length,O=S}else if(An.isElement(p)&&An.isElement(v)){var S=Mi(p,x5);k=v.children.length,O=S}else throw new Error("Cannot merge the node at path [".concat(h,"] with the previous sibling because it is not the same kind: ").concat(JSON.stringify(p)," ").concat(JSON.stringify(v)));b||$t.moveNodes(n,{at:h,to:m,voids:r}),T&&$t.removeNodes(n,{at:T.current,voids:r}),An.isElement(v)&&le.isEmpty(n,v)||jt.isText(v)&&v.text===""&&_[_.length-1]!==0?$t.removeNodes(n,{at:_,voids:r}):n.apply({type:"merge_node",path:m,position:k,properties:O}),T&&T.unref()}}}})},moveNodes(n,e){le.withoutNormalizing(n,()=>{var{to:t,at:o=n.selection,mode:i="lowest",voids:r=!1}=e,{match:s}=e;if(o){s==null&&(s=Ae.isPath(o)?Fr(n,o):h=>le.isBlock(n,h));var a=le.pathRef(n,t),l=le.nodes(n,{at:o,match:s,mode:i,voids:r}),u=Array.from(l,h=>{var[,v]=h;return le.pathRef(n,v)});for(var c of u){var f=c.unref(),p=a.current;f.length!==0&&n.apply({type:"move_node",path:f,newPath:p}),a.current&&Ae.isSibling(p,f)&&Ae.isAfter(p,f)&&(a.current=Ae.next(a.current))}a.unref()}})},removeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{hanging:t=!1,voids:o=!1,mode:i="lowest"}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Ae.isPath(r)?Fr(n,r):p=>le.isBlock(n,p)),!t&&it.isRange(r)&&(r=le.unhangRange(n,r));var a=le.nodes(n,{at:r,match:s,mode:i,voids:o}),l=Array.from(a,p=>{var[,h]=p;return le.pathRef(n,h)});for(var u of l){var c=u.unref();if(c){var[f]=le.node(n,c);n.apply({type:"remove_node",path:c,node:f})}}}})},setNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.withoutNormalizing(n,()=>{var{match:o,at:i=n.selection}=t,{hanging:r=!1,mode:s="lowest",split:a=!1,voids:l=!1}=t;if(i){if(o==null&&(o=Ae.isPath(i)?Fr(n,i):T=>le.isBlock(n,T)),!r&&it.isRange(i)&&(i=le.unhangRange(n,i)),a&&it.isRange(i)){if(it.isCollapsed(i)&&le.leaf(n,i.anchor)[0].text.length>0)return;var u=le.rangeRef(n,i,{affinity:"inward"}),[c,f]=it.edges(i),p=s==="lowest"?"lowest":"highest",h=le.isEnd(n,f,f.path);$t.splitNodes(n,{at:f,match:o,mode:p,voids:l,always:!h});var v=le.isStart(n,c,c.path);$t.splitNodes(n,{at:c,match:o,mode:p,voids:l,always:!v}),i=u.unref(),t.at==null&&$t.select(n,i)}for(var[_,m]of le.nodes(n,{at:i,match:o,mode:s,voids:l})){var g={},b={};if(m.length!==0){var C=!1;for(var D in e)D==="children"||D==="text"||e[D]!==_[D]&&(C=!0,_.hasOwnProperty(D)&&(g[D]=_[D]),e[D]!=null&&(b[D]=e[D]));C&&n.apply({type:"set_node",path:m,properties:g,newProperties:b})}}}})},splitNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection,height:s=0,always:a=!1}=e;if(i==null&&(i=H=>le.isBlock(n,H)),it.isRange(r)&&(r=C5(n,r)),Ae.isPath(r)){var l=r,u=le.point(n,l),[c]=le.parent(n,l);i=H=>H===c,s=u.path.length-l.length+1,r=u,a=!0}if(r){var f=le.pointRef(n,r,{affinity:"backward"}),[p]=le.nodes(n,{at:r,match:i,mode:t,voids:o});if(p){var h=le.void(n,{at:r,mode:"highest"}),v=0;if(!o&&h){var[_,m]=h;if(An.isElement(_)&&n.isInline(_)){var g=le.after(n,m);if(!g){var b={text:""},C=Ae.next(m);$t.insertNodes(n,b,{at:C,voids:o}),g=le.point(n,C)}r=g,a=!0}var D=r.path.length-m.length;s=D+1,a=!0}var T=le.pointRef(n,r),O=r.path.length-s,[,k]=p,S=r.path.slice(0,O),N=s===0?r.offset:r.path[O]+v;for(var[L,$]of le.levels(n,{at:S,reverse:!0,voids:o})){var B=!1;if($.length<k.length||$.length===0||!o&&le.isVoid(n,L))break;var E=f.current,A=le.isEnd(n,E,$);if(a||!f||!le.isEdge(n,E,$)){B=!0;var M=_t.extractProps(L);n.apply({type:"split_node",path:$,position:N,properties:M})}N=$[$.length-1]+(B||A?1:0)}if(e.at==null){var F=T.current||le.end(n,[]);$t.select(n,F)}f.unref(),T.unref()}}})},unsetNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(e)||(e=[e]);var o={};for(var i of e)o[i]=null;$t.setNodes(n,o,t)},unwrapNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{mode:t="lowest",split:o=!1,voids:i=!1}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Ae.isPath(r)?Fr(n,r):p=>le.isBlock(n,p)),Ae.isPath(r)&&(r=le.range(n,r));var a=it.isRange(r)?le.rangeRef(n,r):null,l=le.nodes(n,{at:r,match:s,mode:t,voids:i}),u=Array.from(l,p=>{var[,h]=p;return le.pathRef(n,h)}).reverse(),c=function(h){var v=h.unref(),[_]=le.node(n,v),m=le.range(n,v);o&&a&&(m=it.intersection(a.current,m)),$t.liftNodes(n,{at:m,match:g=>An.isAncestor(_)&&_.children.includes(g),voids:i})};for(var f of u)c(f);a&&a.unref()}})},wrapNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.withoutNormalizing(n,()=>{var{mode:o="lowest",split:i=!1,voids:r=!1}=t,{match:s,at:a=n.selection}=t;if(a){if(s==null&&(Ae.isPath(a)?s=Fr(n,a):n.isInline(e)?s=m=>le.isInline(n,m)||jt.isText(m):s=m=>le.isBlock(n,m)),i&&it.isRange(a)){var[l,u]=it.edges(a),c=le.rangeRef(n,a,{affinity:"inward"});$t.splitNodes(n,{at:u,match:s,voids:r}),$t.splitNodes(n,{at:l,match:s,voids:r}),a=c.unref(),t.at==null&&$t.select(n,a)}var f=Array.from(le.nodes(n,{at:a,match:n.isInline(e)?m=>le.isBlock(n,m):m=>le.isEditor(m),mode:"lowest",voids:r}));for(var[,p]of f){var h=it.isRange(a)?it.intersection(a,le.range(n,p)):a;if(h){var v=Array.from(le.nodes(n,{at:h,match:s,mode:o,voids:r}));if(v.length>0){var _=(function(){var[m]=v,g=v[v.length-1],[,b]=m,[,C]=g;if(b.length===0&&C.length===0)return"continue";var D=Ae.equals(b,C)?Ae.parent(b):Ae.common(b,C),T=le.range(n,b,C),O=le.node(n,D),[k]=O,S=D.length+1,N=Ae.next(C.slice(0,S)),L=Tp(Tp({},e),{},{children:[]});$t.insertNodes(n,L,{at:N,voids:r}),$t.moveNodes(n,{at:T,match:$=>An.isAncestor(k)&&k.children.includes($),to:N.concat(0),voids:r})})();if(_==="continue")continue}}}}})}},Vg=(n,e)=>{if(An.isElement(e)){var t=e;return le.isVoid(n,e)?!0:t.children.length===1?Vg(n,t.children[0]):!1}else return!le.isEditor(e)},C5=(n,e)=>{if(it.isCollapsed(e))return e.anchor;var[,t]=it.edges(e),o=le.pointRef(n,t);return $t.delete(n,{at:e}),o.unref()},Fr=(n,e)=>{var[t]=le.node(n,e);return o=>o===t};function $p(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Pp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$p(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$p(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var S5={collapse(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:t="anchor"}=e,{selection:o}=n;if(o){if(t==="anchor")$t.select(n,o.anchor);else if(t==="focus")$t.select(n,o.focus);else if(t==="start"){var[i]=it.edges(o);$t.select(n,i)}else if(t==="end"){var[,r]=it.edges(o);$t.select(n,r)}}else return},deselect(n){var{selection:e}=n;e&&n.apply({type:"set_selection",properties:e,newProperties:null})},move(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:t}=n,{distance:o=1,unit:i="character",reverse:r=!1}=e,{edge:s=null}=e;if(t){s==="start"&&(s=it.isBackward(t)?"focus":"anchor"),s==="end"&&(s=it.isBackward(t)?"anchor":"focus");var{anchor:a,focus:l}=t,u={distance:o,unit:i},c={};if(s==null||s==="anchor"){var f=r?le.before(n,a,u):le.after(n,a,u);f&&(c.anchor=f)}if(s==null||s==="focus"){var p=r?le.before(n,l,u):le.after(n,l,u);p&&(c.focus=p)}$t.setSelection(n,c)}},select(n,e){var{selection:t}=n;if(e=le.range(n,e),t){$t.setSelection(n,e);return}if(!it.isRange(e))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(JSON.stringify(e)));n.apply({type:"set_selection",properties:t,newProperties:e})},setPoint(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:o}=n,{edge:i="both"}=t;if(o){i==="start"&&(i=it.isBackward(o)?"focus":"anchor"),i==="end"&&(i=it.isBackward(o)?"anchor":"focus");var{anchor:r,focus:s}=o,a=i==="anchor"?r:s;$t.setSelection(n,{[i==="anchor"?"anchor":"focus"]:Pp(Pp({},a),e)})}},setSelection(n,e){var{selection:t}=n,o={},i={};if(t){for(var r in e)(r==="anchor"&&e.anchor!=null&&!un.equals(e.anchor,t.anchor)||r==="focus"&&e.focus!=null&&!un.equals(e.focus,t.focus)||r!=="anchor"&&r!=="focus"&&e[r]!==t[r])&&(o[r]=t[r],i[r]=e[r]);Object.keys(o).length>0&&n.apply({type:"set_selection",properties:o,newProperties:i})}}},k5={delete(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};le.withoutNormalizing(n,()=>{var{reverse:t=!1,unit:o="character",distance:i=1,voids:r=!1}=e,{at:s=n.selection,hanging:a=!1}=e;if(s){if(it.isRange(s)&&it.isCollapsed(s)&&(s=s.anchor),un.isPoint(s)){var l=le.void(n,{at:s,mode:"highest"});if(!r&&l){var[,u]=l;s=u}else{var c={unit:o,distance:i},f=t?le.before(n,s,c)||le.start(n,[]):le.after(n,s,c)||le.end(n,[]);s={anchor:s,focus:f},a=!0}}if(Ae.isPath(s)){$t.removeNodes(n,{at:s,voids:r});return}if(!it.isCollapsed(s)){if(!a){var[,p]=it.edges(s),h=le.end(n,[]);un.equals(p,h)||(s=le.unhangRange(n,s,{voids:r}))}var[v,_]=it.edges(s),m=le.above(n,{match:ve=>le.isBlock(n,ve),at:v,voids:r}),g=le.above(n,{match:ve=>le.isBlock(n,ve),at:_,voids:r}),b=m&&g&&!Ae.equals(m[1],g[1]),C=Ae.equals(v.path,_.path),D=r?null:le.void(n,{at:v,mode:"highest"}),T=r?null:le.void(n,{at:_,mode:"highest"});if(D){var O=le.before(n,v);O&&m&&Ae.isAncestor(m[1],O.path)&&(v=O)}if(T){var k=le.after(n,_);k&&g&&Ae.isAncestor(g[1],k.path)&&(_=k)}var S=[],N;for(var L of le.nodes(n,{at:s,voids:r})){var[$,B]=L;N&&Ae.compare(B,N)===0||(!r&&le.isVoid(n,$)||!Ae.isCommon(B,v.path)&&!Ae.isCommon(B,_.path))&&(S.push(L),N=B)}var E=Array.from(S,ve=>{var[,Ne]=ve;return le.pathRef(n,Ne)}),A=le.pointRef(n,v),M=le.pointRef(n,_);if(!C&&!D){var F=A.current,[H]=le.leaf(n,F),{path:R}=F,{offset:G}=v,oe=H.text.slice(G);oe.length>0&&n.apply({type:"remove_text",path:R,offset:G,text:oe})}for(var V of E){var Y=V.unref();$t.removeNodes(n,{at:Y,voids:r})}if(!T){var Q=M.current,[ue]=le.leaf(n,Q),{path:te}=Q,q=C?v.offset:0,re=ue.text.slice(q,_.offset);re.length>0&&n.apply({type:"remove_text",path:te,offset:q,text:re})}!C&&b&&M.current&&A.current&&$t.mergeNodes(n,{at:M.current,hanging:!0,voids:r});var ce=t?A.unref()||M.unref():M.unref()||A.unref();e.at==null&&ce&&$t.select(n,ce)}}})},insertFragment(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1}=t,{at:r=n.selection}=t;if(e.length){if(r)if(it.isRange(r))if(o||(r=le.unhangRange(n,r)),it.isCollapsed(r))r=r.anchor;else{var[,s]=it.edges(r);if(!i&&le.void(n,{at:s}))return;var a=le.pointRef(n,s);$t.delete(n,{at:r}),r=a.unref()}else Ae.isPath(r)&&(r=le.start(n,r));else return;if(!(!i&&le.void(n,{at:r}))){var l=le.above(n,{at:r,match:ue=>le.isInline(n,ue),mode:"highest",voids:i});if(l){var[,u]=l;if(le.isEnd(n,r,u)){var c=le.after(n,u);r=c}else if(le.isStart(n,r,u)){var f=le.before(n,u);r=f}}var p=le.above(n,{match:ue=>le.isBlock(n,ue),at:r,voids:i}),[,h]=p,v=le.isStart(n,r,h),_=le.isEnd(n,r,h),m=v&&_,g=!v||v&&_,b=!_,[,C]=_t.first({children:e},[]),[,D]=_t.last({children:e},[]),T=[],O=ue=>{var[te,q]=ue,re=q.length===0;return re?!1:m?!0:!(g&&Ae.isAncestor(q,C)&&An.isElement(te)&&!n.isVoid(te)&&!n.isInline(te)||b&&Ae.isAncestor(q,D)&&An.isElement(te)&&!n.isVoid(te)&&!n.isInline(te))};for(var k of _t.nodes({children:e},{pass:O}))O(k)&&T.push(k);var S=[],N=[],L=[],$=!0,B=!1;for(var[E]of T)An.isElement(E)&&!n.isInline(E)?($=!1,B=!0,N.push(E)):$?S.push(E):L.push(E);var[A]=le.nodes(n,{at:r,match:ue=>jt.isText(ue)||le.isInline(n,ue),mode:"highest",voids:i}),[,M]=A,F=le.isStart(n,r,M),H=le.isEnd(n,r,M),R=le.pathRef(n,_?Ae.next(h):h),G=le.pathRef(n,H?Ae.next(M):M),oe=le.pathRef(n,h);$t.splitNodes(n,{at:r,match:ue=>B?le.isBlock(n,ue):jt.isText(ue)||le.isInline(n,ue),mode:B?"lowest":"highest",voids:i});var V=le.pathRef(n,!F||F&&H?Ae.next(M):M);if($t.insertNodes(n,S,{at:V.current,match:ue=>jt.isText(ue)||le.isInline(n,ue),mode:"highest",voids:i}),m&&N.length&&$t.delete(n,{at:oe.unref(),voids:i}),$t.insertNodes(n,N,{at:R.current,match:ue=>le.isBlock(n,ue),mode:"lowest",voids:i}),$t.insertNodes(n,L,{at:G.current,match:ue=>jt.isText(ue)||le.isInline(n,ue),mode:"highest",voids:i}),!t.at){var Y;L.length>0?Y=Ae.previous(G.current):N.length>0?Y=Ae.previous(R.current):Y=Ae.previous(V.current);var Q=le.end(n,Y);$t.select(n,Q)}V.unref(),R.unref(),G.unref()}}})},insertText(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.withoutNormalizing(n,()=>{var{voids:o=!1}=t,{at:i=n.selection}=t;if(i){if(Ae.isPath(i)&&(i=le.range(n,i)),it.isRange(i))if(it.isCollapsed(i))i=i.anchor;else{var r=it.end(i);if(!o&&le.void(n,{at:r}))return;var s=it.start(i),a=le.pointRef(n,s);$t.delete(n,{at:i,voids:o}),i=a.unref(),$t.setSelection(n,{anchor:i,focus:i})}if(!(!o&&le.void(n,{at:i}))){var{path:l,offset:u}=i;e.length>0&&n.apply({type:"insert_text",path:l,offset:u,text:e})}}})}};function Rp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function tl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rp(Object(t),!0).forEach(function(o){Li(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var $t=tl(tl(tl(tl({},y5),w5),S5),k5);const E5={class:"editor-box"},D5={class:"field-list-item"},A5={class:"field-label"},O5={class:"field-type"},N5={__name:"draft-news-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(!1),s=Vf(),a=Vf(null),l=X("default"),u=X(""),c=X({excludeKeys:["insertTable","codeBlock","uploadVideo","group-video"]}),f={placeholder:"请输入内容，键入“/”可以插入变量",MENU_CONF:{uploadImage:{async customUpload(A,M){var R;const F=await Ym(A),H=await Po({name:"official_draft",action:"default/exec",params:JSON.stringify({business:"upload_image",arguments:{...i.appData,media:F}})});M((R=H==null?void 0:H.data)==null?void 0:R.url)}}}},p=X(!1),h=X({});X([]);const v=X([]),_=X([]),m=X(new Set);no(()=>{const A=s.value;A!=null&&A.destroy()});function g(A="",M=[]){b(A,M),r.value=!0}function b(A,M){let F=Km(i.variableOptions);_.value=M,v.value=[...M,...F].filter(R=>R&&R.value&&R.value!=""&&R.typ!=="node");const H=new Set;for(let R of v.value)A=C(A,R,H);u.value=A}function C(A,M,F){const H=new RegExp(`(${M.value})`,"g");if(!F.has(M.value)&&H.test(A)){let R=M.node_name+"."+M.text;R=R.replace(/\./g,"/"),A=A.replace(H,`<a href="zm-variable:${M.value}" target="_blank"><strong>${R}</strong></a>`),F.add(M.value)}return A}function D(A){s.value=A}function T(A){const{selection:M}=A;if(!M||!it.isCollapsed(M)){p.value=!1;return}const F=M.focus.path,H=M.focus.offset;le.string(A,F)[H-1]==="/"?(a.value=A,p.value=!0,k()):p.value=!1}function O(){const A=window.getSelection();if(!A||A.rangeCount===0)return null;const M=A.getRangeAt(0);if(!M.collapsed)return null;let F=M.getClientRects()[0];if(F)return F;const H=document.createElement("span");return H.textContent="​",H.style.display="inline-block",M.insertNode(H),F=H.getBoundingClientRect(),H.remove(),F}function k(A){const M=O();if(!M)return;const F=M.left+window.scrollX,H=M.bottom+window.scrollY+6;h.value=`left:${F}px; top:${H}px;`}function S(A,M,F){let H=F[F.length-1];delete H.children,N(H)}function N(A,M=!1){if(!A)return;p.value=!1;let F=A.node_name+"."+A.text;F=F.replace(/\./g,"/");const H={id:A.id,label:A.label,value:A.value,text:A.text,index:_.value.length};_.value.push(A);const R=new Set(m.value);R.add(A.value),m.value=R,M||L(F,H)}function L(A,M){const F=a.value,{selection:H}=F;H&&(it.isCollapsed(H)||le.deleteFragment(F),le.deleteBackward(F,"character"),le.insertNode(F,{type:"link",url:`zm-variable:${M.value}`,children:[{text:A,bold:!0}]}),le.insertText(F," "))}function $(A,M){const F=h.value.match(/left:\s*(-?\d+\.?\d*)px/),H=h.value.match(/top:\s*(-?\d+\.?\d*)px/);if(!F||!H)return;const R=parseFloat(F[1]),G=parseFloat(H[1]);let oe;A==="left"?oe=R-M:oe=R+M,h.value=`left:${oe}px; top:${G}px;`}function B(A){if(typeof A!="string")return"";const M=A.match(/^<div[^>]*class=["'][^"']*\bzm-editor-root\b[^"']*["'][^>]*>([\s\S]*)<\/div>$/);return M?M[1]:A}function E(){let A=Bn(u.value),M={};_.value.forEach(H=>{!M[H.value]&&A.indexOf(H.value)>-1&&(M[H.value]=H)});let F=Object.values(M);A=B(A),A=A.replace(/<a[^>]*href="zm-variable:([^"]+)"[^>]*>[\s\S]*?<\/a>/g,"$1"),o("change",A,Bn(F)),r.value=!1}return e({show:g}),(A,M)=>{const F=Lr,H=gn;return w(),Z(H,{title:"正文内容",width:"880px",open:r.value,"onUpdate:open":M[1]||(M[1]=R=>r.value=R),onOk:E},{default:x(()=>[y(F,{type:"info",class:"zm-alert-info"},{message:x(()=>[...M[2]||(M[2]=[z(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),d("div",E5,[y(ee(bw),{style:{"border-bottom":"1px solid #ccc"},editor:s.value,defaultConfig:c.value,mode:l.value},null,8,["editor","defaultConfig","mode"]),y(ee(xw),{style:{height:"480px","overflow-y":"hidden"},modelValue:u.value,"onUpdate:modelValue":M[0]||(M[0]=R=>u.value=R),defaultConfig:f,mode:l.value,onOnCreated:D,onOnChange:T},null,8,["modelValue","mode"])]),p.value?(w(),P("div",{key:0,style:In(h.value),class:"dropdown-list",ref:"dropdownList"},[y(Dg,{options:n.variableOptions,onChange:S,onDirectionChange:$},{option:x(({label:R,payload:G})=>[d("div",D5,[d("div",A5,j(R),1),d("div",O5,j(G.typ),1)])]),_:1},8,["options"])],4)):ie("",!0)]),_:1},8,["open"])}}},M5=$e(N5,[["__scopeId","data-v-f9ef811d"]]),T5={class:"field-list-item"},$5={class:"field-label"},P5={class:"field-type"},R5={__name:"draft-newspic-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=X(!1),r=X(""),s=X([]);function a(c="",f=[]){r.value=c,s.value=f,i.value=!0}function l(c,f){r.value=c,s.value=f}function u(){o("change",Bn(r.value),Bn(s.value)),i.value=!1}return e({show:a}),(c,f)=>{const p=Lr,h=gn;return w(),Z(h,{title:"正文内容",width:"880px",open:i.value,"onUpdate:open":f[1]||(f[1]=v=>i.value=v),onOk:u},{default:x(()=>[y(p,{type:"info",class:"zm-alert-info"},{message:x(()=>[...f[2]||(f[2]=[z(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),y(ot,{style:{"margin-top":"16px"},type:"textarea",inputStyle:"height: 420px;",options:n.variableOptions,defaultSelectedList:s.value||[],defaultValue:r.value,ref:"atInputRef",onOpen:f[0]||(f[0]=v=>o("updateVar")),onChange:l,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:v,payload:_})=>[d("div",T5,[d("div",$5,j(v),1),d("div",P5,j(_.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1},8,["open"])}}},B5={class:"article-container"},L5={class:"node-options"},I5={class:"options-item is-required"},F5={class:"options-item is-required"},j5={class:"node-options article-form-box"},V5={key:0,class:"options-item"},H5={class:"news-tabs"},U5=["onClick"],z5={class:"options-item baseline is-required"},q5={style:{width:"100%"}},G5={class:"field-list-item"},X5={class:"field-label"},W5={class:"field-type"},Y5={class:"options-item baseline is-required"},K5={class:"field-list-item"},J5={class:"field-label"},Z5={class:"field-type"},Q5={class:"options-item is-required"},eB={class:"field-list-item"},tB={class:"field-label"},nB={class:"field-type"},oB={class:"options-item"},iB={class:"field-list-item"},rB={class:"field-label"},sB={class:"field-type"},aB={class:"options-item"},lB={class:"field-list-item"},uB={class:"field-label"},dB={class:"field-type"},cB={class:"options-item is-required"},fB={class:"cont-box"},pB={class:"field-list-item"},hB={class:"field-label"},vB={class:"field-type"},gB={class:"options-item"},_B={class:"field-list-item"},mB={class:"field-label"},yB={class:"field-type"},bB={class:"options-item is-required baseline"},xB={style:{flex:"1"}},wB={class:"field-list-item"},CB={class:"field-label"},SB={class:"field-type"},kB={class:"options-item"},EB={class:"options-item"},DB={class:"options-item is-required baseline"},AB={class:"img-box"},OB={class:"field-list-item"},NB={class:"field-label"},MB={class:"field-type"},TB={class:"options-item baseline"},$B={class:"img-box"},PB={class:"field-list-item"},RB={class:"field-label"},BB={class:"field-type"},LB={class:"node-options"},IB={class:"options-item"},FB={__name:"official-draft-store",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=X(null),s=X([]),a=X([]),l={title:"",article_type:"",author:"",digest:"",content:"",content_source_url:"",need_open_comment:0,only_fans_can_comment:0,pic_crop_235_1:"",pic_crop_1_1:"",thumb_type:1,thumb_media_id:"",image_info:[{value:"",tags:[]}],product_info:[{value:"",tags:[]}],cover_info:[{value:"",tags:[]}],tag_map:{}},u=Je({app_id:void 0,app_secret:"",app_name:"",article_type:"news",articles:[],media_id:"",index:0,tag_map:{}}),c=X(0),f=Xe(()=>u.articles[c.value]||l),p=[{label:"素材url",value:1},{label:"素材MedialD",value:2}],h=[{label:"关闭",value:0},{label:"打开",value:1}],v=[{label:"所有人可评论",value:0},{label:"粉丝才可评论",value:1}];ut(()=>{_()}),gt(()=>o.action,()=>{var M;s.value=yi(JSON.parse(JSON.stringify(((M=o.action)==null?void 0:M.output)||"{}")))},{deep:!0,immediate:!0});function _(){m(),L(),g()}function m(){Tr({app_type:"official_account"}).then(M=>{a.value=(M==null?void 0:M.data)||[]})}function g(){var H,R;let M=JSON.parse(o.node.node_params),F=((R=(H=M==null?void 0:M.plugin)==null?void 0:H.params)==null?void 0:R.arguments)||{};if(o.actionName==="update_draft"&&F.articles&&Object.keys(F.articles).length&&(F.articles=[F.articles]),Object.assign(u,F),!u.app_id){let G=To(window.localStorage.getItem("zm:ai:draft:last:app"));G&&(Object.assign(u,G),A())}}function b(M,F){const{key:H,secret:R,name:G}=F;u.app_secret=R,u.app_name=G,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:H,app_secret:R,app_name:G})),A()}function C(){u.articles=[],L()}function D(M,F){c.value=F}function T(M,F,H){u[M]=F,u.tag_map[M]=H,A()}function O(M,F,H){f.value[M]=F,f.value.tag_map[M]=H,A()}function k(M,F,H){M.value=F,M.tags=H,A()}function S(){r.value.show(f.value.content,f.value.tag_map.content||[])}function N(M,F){f.value.content=M,f.value.tag_map.content=F||[],A()}function L(){let M=JSON.parse(JSON.stringify(l));M.article_type=u.article_type,u.articles.push(M)}function $(M){u.articles.splice(M,1),A()}function B(M){u.articles[c.value][M].push({value:"",tags:[]})}function E(M,F){u.articles[c.value][M].splice(F,1)}function A(){Pt(()=>{let M=JSON.parse(o.node.node_params);M.plugin.output_obj=s.value;let F={...u};o.actionName==="update_draft"&&(F.articles=F.articles[0]),Object.assign(M.plugin.params,{arguments:{...F}}),i({...o.node,node_params:JSON.stringify(M)})})}return(M,F)=>{var Q,ue,te,q,re,ce,ve,Ne;const H=Vt,R=It,G=Ri,oe=Pi,V=Qt,Y=Jt;return w(),P("div",B5,[d("div",L5,[F[29]||(F[29]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Lg,class:"title-icon"}),z(" 基础信息")])],-1)),d("div",I5,[F[25]||(F[25]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(R,{value:u.app_id,"onUpdate:value":F[0]||(F[0]=ge=>u.app_id=ge),placeholder:"请选择公众号",style:{width:"100%"},onChange:b},{default:x(()=>[(w(!0),P(ae,null,ye(a.value,ge=>(w(),Z(H,{key:ge.app_id,name:ge.app_name,secret:ge.app_secret},{default:x(()=>[z(j(ge.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",F5,[F[28]||(F[28]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章类型")],-1)),d("div",null,[y(oe,{value:u.article_type,"onUpdate:value":F[1]||(F[1]=ge=>u.article_type=ge),onChange:C},{default:x(()=>[y(G,{value:"news"},{default:x(()=>[...F[26]||(F[26]=[z("图文消息",-1)])]),_:1}),y(G,{value:"newspic"},{default:x(()=>[...F[27]||(F[27]=[z("图片消息",-1)])]),_:1})]),_:1},8,["value"])])])]),d("div",j5,[F[46]||(F[46]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")]),d("a",{href:"https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_add.html",style:{"font-weight":"400"},target:"_blank"},"查看帮助文档")],-1)),n.actionName==="add_draft"?(w(),P("div",V5,[d("div",H5,[(w(!0),P(ae,null,ye(u.articles,(ge,_e)=>(w(),P("div",{key:_e,class:Ct(["news-item",{active:_e==c.value}]),onClick:st=>D(ge,_e)},[z(j(_e==0?"主图文":`副图文${_e}`)+" ",1),u.articles.length>1?(w(),Z(ee(cg),{key:0,class:"del-icon",onClick:St(st=>$(_e),["stop"])},null,8,["onClick"])):ie("",!0)],10,U5))),128)),u.articles.length<8?(w(),P("div",{key:0,class:"news-item",onClick:L},[y(ee(Ht))])):ie("",!0)])])):(w(),P(ae,{key:1},[d("div",z5,[F[31]||(F[31]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章ID")],-1)),d("div",q5,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Q=u.tag_map)==null?void 0:Q.media_id)||[],defaultValue:u.media_id,ref:"atInputRef",onOpen:F[2]||(F[2]=ge=>t("updateVar")),onChange:F[3]||(F[3]=(ge,_e)=>T("media_id",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",G5,[d("div",X5,j(ge),1),d("div",W5,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[30]||(F[30]=d("div",{class:"desc"},"文章media_id",-1))])]),d("div",Y5,[F[33]||(F[33]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章位置")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ue=u.tag_map)==null?void 0:ue.index)||[],defaultValue:u.index,ref:"atInputRef",onOpen:F[4]||(F[4]=ge=>t("updateVar")),onChange:F[5]||(F[5]=(ge,_e)=>T("index",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",K5,[d("div",J5,j(ge),1),d("div",Z5,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[32]||(F[32]=d("div",{class:"desc"},"要更新的文章在图文消息中的位置（多图文消息时，此字段才有意义），第一篇为0（输入0~7的正整数）",-1))])])],64)),d("div",Q5,[F[34]||(F[34]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"标题")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((te=f.value.tag_map)==null?void 0:te.title)||[],defaultValue:f.value.title,ref:"atInputRef",onOpen:F[6]||(F[6]=ge=>t("updateVar")),onChange:F[7]||(F[7]=(ge,_e)=>O("title",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",eB,[d("div",tB,j(ge),1),d("div",nB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f.value.article_type==="news"?(w(),P(ae,{key:2},[d("div",oB,[F[35]||(F[35]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"作者")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((q=f.value.tag_map)==null?void 0:q.author)||[],defaultValue:f.value.author,ref:"atInputRef",onOpen:F[8]||(F[8]=ge=>t("updateVar")),onChange:F[9]||(F[9]=(ge,_e)=>O("author",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",iB,[d("div",rB,j(ge),1),d("div",sB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),d("div",aB,[F[36]||(F[36]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"摘要")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((re=f.value.tag_map)==null?void 0:re.digest)||[],defaultValue:f.value.digest,ref:"atInputRef",onOpen:F[10]||(F[10]=ge=>t("updateVar")),onChange:F[11]||(F[11]=(ge,_e)=>O("digest",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",lB,[d("div",uB,j(ge),1),d("div",dB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])],64)):ie("",!0),d("div",cB,[F[37]||(F[37]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"正文内容")],-1)),d("div",fB,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ce=f.value.tag_map)==null?void 0:ce.content)||[],defaultValue:f.value.content,ref:"atInputRef",onOpen:F[12]||(F[12]=ge=>t("updateVar")),onChange:F[13]||(F[13]=(ge,_e)=>O("content",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",pB,[d("div",hB,j(ge),1),d("div",vB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),y(V,{title:"编辑窗口"},{default:x(()=>[y(ee(Br),{class:"edit-icon",onClick:S})]),_:1})])]),f.value.article_type==="news"?(w(),P(ae,{key:3},[d("div",gB,[F[38]||(F[38]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"原文地址")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ve=f.value.tag_map)==null?void 0:ve.content_source_url)||[],defaultValue:f.value.content_source_url,ref:"atInputRef",onOpen:F[14]||(F[14]=ge=>t("updateVar")),onChange:F[15]||(F[15]=(ge,_e)=>O("content_source_url",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",_B,[d("div",mB,j(ge),1),d("div",yB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),d("div",bB,[F[39]||(F[39]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"封面素材")],-1)),d("div",xB,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Ne=f.value.tag_map)==null?void 0:Ne.thumb_media_id)||[],defaultValue:f.value.thumb_media_id,ref:"atInputRef",onOpen:F[16]||(F[16]=ge=>t("updateVar")),onChange:F[17]||(F[17]=(ge,_e)=>O("thumb_media_id",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",wB,[d("div",CB,j(ge),1),d("div",SB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),y(ko,{class:"mt4",value:f.value.thumb_type,"onUpdate:value":F[18]||(F[18]=ge=>f.value.thumb_type=ge),options:p,onChange:A},null,8,["value"])])])],64)):ie("",!0),d("div",kB,[F[40]||(F[40]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章评论")],-1)),y(ko,{value:f.value.need_open_comment,"onUpdate:value":F[19]||(F[19]=ge=>f.value.need_open_comment=ge),options:h,onChange:A},null,8,["value"])]),d("div",EB,[F[41]||(F[41]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"评论人群")],-1)),y(ko,{value:f.value.only_fans_can_comment,"onUpdate:value":F[20]||(F[20]=ge=>f.value.only_fans_can_comment=ge),options:v,onChange:A},null,8,["value"])]),f.value.article_type==="news"?(w(),P(ae,{key:4},[],64)):(w(),P(ae,{key:5},[d("div",DB,[F[43]||(F[43]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"图片")],-1)),d("div",AB,[(w(!0),P(ae,null,ye(f.value.image_info,(ge,_e)=>(w(),P("div",{key:_e,class:"img-item"},[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:ge.tags||[],defaultValue:ge.value,ref_for:!0,ref:"atInputRef",onOpen:F[21]||(F[21]=st=>t("updateVar")),onChange:(st,tt)=>k(ge,st,tt),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:st,payload:tt})=>[d("div",OB,[d("div",NB,j(st),1),d("div",MB,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),y(ee(Kt),{onClick:st=>E("image_info",_e)},null,8,["onClick"])]))),128)),f.value.image_info.length<20?(w(),Z(Y,{key:0,type:"dashed",icon:Tt(ee(Ht)),onClick:F[22]||(F[22]=ge=>B("image_info"))},{default:x(()=>[...F[42]||(F[42]=[z("新增图片 ",-1)])]),_:1},8,["icon"])):ie("",!0)])]),d("div",TB,[F[45]||(F[45]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"封面信息")],-1)),d("div",$B,[(w(!0),P(ae,null,ye(f.value.cover_info,(ge,_e)=>(w(),P("div",{key:_e,class:"img-item"},[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:ge.tags||[],defaultValue:ge.value,ref_for:!0,ref:"atInputRef",onOpen:F[23]||(F[23]=st=>t("updateVar")),onChange:(st,tt)=>k(ge,st,tt),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:st,payload:tt})=>[d("div",PB,[d("div",RB,j(st),1),d("div",BB,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),y(ee(Kt),{onClick:st=>E("cover_info",_e)},null,8,["onClick"])]))),128)),f.value.cover_info.length<5?(w(),Z(Y,{key:0,type:"dashed",icon:Tt(ee(Ht)),onClick:F[24]||(F[24]=ge=>B("cover_info"))},{default:x(()=>[...F[44]||(F[44]=[z("新增封面 ",-1)])]),_:1},8,["icon"])):ie("",!0)])])],64))]),d("div",LB,[F[47]||(F[47]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",IB,[y(Bi,{"tree-data":s.value},null,8,["tree-data"])])]),u.article_type==="news"?(w(),Z(M5,{key:0,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,appData:{app_id:u.app_id,app_secret:u.app_secret},onChange:N},null,8,["variable-options","appData"])):(w(),Z(R5,{key:1,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,onChange:N},null,8,["variable-options"]))])}}},Bp=$e(FB,[["__scopeId","data-v-0acf2e46"]]),jB={class:"options-item is-required"},VB={key:0,class:"desc"},HB={class:"options-item is-required"},Us={__name:"official-draft-operate",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=X({}),r=X([]);ut(()=>{a(),s()});function s(){const u={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};let c=To(window.localStorage.getItem("zm:ai:draft:last:app"));c&&(u.app_id.default=c.app_id,u.app_name.default=c.app_name,u.app_secret.default=c.app_secret),o.actionName==="preview_message"?(u.type={...o.action.params.type,default:"touser"},i.value=Xc(u,["app_id","media_id","type","account"])):i.value=u}function a(){Tr({app_type:"official_account"}).then(u=>{r.value=(u==null?void 0:u.data)||[]})}function l(u,c){const{key:f,secret:p,name:h}=c;u.app_secret.value=p,u.app_name.value=h,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:f,app_secret:p,app_name:h}))}return(u,c)=>{const f=Vt,p=It,h=Ri,v=Pi;return w(),Z(sf,{node:n.node,params:i.value,output:n.action.output,variableOptions:n.variableOptions,onUpdateVar:c[0]||(c[0]=_=>t("updateVar"))},Um({app_name:x(()=>[]),app_secret:x(()=>[]),app_id:x(({state:_,item:m,keyName:g})=>[d("div",jB,[c[2]||(c[2]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(p,{value:m.value,"onUpdate:value":b=>m.value=b,placeholder:"请选择公众号",style:{width:"100%"},onChange:(b,C)=>l(_,C)},{default:x(()=>[(w(!0),P(ae,null,ye(r.value,b=>(w(),Z(f,{key:b.app_id,value:b.app_id,name:b.app_name,secret:b.app_secret},{default:x(()=>[z(j(b.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),["publish_draft","preview_message"].includes(n.actionName)?(w(),P("div",VB,[y(ee(Zc)),c[1]||(c[1]=z(" 暂不支持未认证公众号、服务号 ",-1))])):ie("",!0)])]),_:2},[n.actionName==="preview_message"?{name:"type",fn:x(({state:_,item:m})=>[d("div",HB,[c[5]||(c[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"接受消息用户类型")],-1)),d("div",null,[y(v,{value:m.value,"onUpdate:value":g=>m.value=g},{default:x(()=>[y(h,{value:"touser"},{default:x(()=>[...c[3]||(c[3]=[z("公众号用户openid",-1)])]),_:1}),y(h,{value:"towxname"},{default:x(()=>[...c[4]||(c[4]=[z("用户微信号（每日最高100次）",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])])])]),key:"0"}:void 0]),1032,["node","params","output","variableOptions"])}}},UB={__name:"official-draft-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t={add_draft:Bp,update_draft:Bp,delete_draft:Us,publish_draft:Us,preview_message:Us,get_draft:Us},o=e,i=n,r=Xe(()=>t[i.actionName]||Us);return(s,a)=>(w(),Z($u(r.value),{action:n.action,actionName:n.actionName,variableOptions:n.variableOptions,node:n.node,onUpdateVar:a[0]||(a[0]=l=>o("updateVar"))},null,40,["action","actionName","variableOptions","node"]))}},zB={class:"field-item"},qB={class:"field-key"},GB={class:"tip-content"},XB={class:"field-type"},WB={class:"field-name"},YB={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=X([]);return(o,i)=>{const r=Nn,s=Qt,a=Jc;return w(),P("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[d("span",{class:Ct(l)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[d("div",zB,[d("span",qB,j(l.key),1),l.tip?(w(),Z(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[d("div",GB,j(l.tip),1)]),default:x(()=>[y(ee(yt),{style:{"margin-left":"4px"}})]),_:2},1024)):ie("",!0),d("span",XB,j(l.typ),1),d("span",WB,j(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},KB=$e(YB,[["__scopeId","data-v-aabfe7ac"]]),JB={class:"options-item-tit"},ZB={class:"option-label"},QB=["onClick"],eL={class:"tip-content"},tL={class:"option-type"},nL={key:1,style:{"margin-left":"auto","margin-bottom":"4px"}},oL={key:0},iL={class:"desc"},rL={key:0,class:"desc",style:{color:"#FB363F"}},sL={key:1},aL={class:"desc"},lL={key:0,class:"desc",style:{color:"#FB363F"}},uL={key:2},dL={class:"desc"},cL={key:0,class:"desc",style:{color:"#FB363F"}},fL={key:3},pL={class:"desc"},hL={key:0,class:"desc",style:{color:"#FB363F"}},vL={key:4},gL={class:"tag-box"},_L={class:"field-list-item"},mL={class:"field-label"},yL={class:"field-type"},bL={class:"field-list-item"},xL={class:"field-label"},wL={class:"field-type"},CL={class:"desc"},SL={key:0,class:"desc",style:{color:"#FB363F"}},kL={key:5},EL={class:"tag-box"},DL={class:"field-list-item"},AL={class:"field-label"},OL={class:"field-type"},NL={class:"desc"},ML={key:0,class:"desc",style:{color:"#FB363F"}},TL={key:6},$L={class:"field-list-item"},PL={class:"field-label"},RL={class:"field-type"},BL={class:"desc"},LL={key:0,class:"desc",style:{color:"#FB363F"}},IL={__name:"field-list",props:{items:{type:Array,default:()=>[]},formState:{type:Object,default:()=>({})},errors:{type:Object,default:()=>({})},apps:{type:Array,default:()=>[]},variableOptions:{type:Array,default:()=>[]},tagTypes:{type:Object,default:()=>({})},tagLists:{type:Object,default:()=>({})},showTagComponents:{type:Boolean,default:!1},sortedEnum:{type:Function},appChange:{type:Function},update:{type:Function},onFieldChange:{type:Function},onChangeDynamic:{type:Function},filterOption:{type:Function},tagTypeChange:{type:Function},tagChange:{type:Function},syncFieldTags:{type:Function},syncingTags:{type:Object,default:()=>({})},dateRangeTypes:{type:Object,default:()=>({})},dateRangeTypeChange:{type:Function},getRangeValue:{type:Function},onDateRangeCalendarChange:{type:Function},onDateRangeChange:{type:Function},getDisabledDateForRange:{type:Function},onOpenVar:{type:Function},onToggleAdvanced:{type:Function}},setup(n){const e=[{label:"开启",value:"true"},{label:"关闭",value:"false"}];return(t,o)=>{const i=mo,r=Qt,s=Vt,a=It,l=Ri,u=Pi,c=xy;return w(!0),P(ae,null,ye(n.items,f=>{var p,h,v,_,m,g,b,C,D,T,O,k,S,N,L,$,B,E,A,M,F,H,R,G,oe,V,Y,Q,ue;return w(),P("div",{key:f.key,class:Ct(["options-item",{"is-required":(p=f.meta)==null?void 0:p.required}])},[d("div",JB,[d("div",ZB,[z(j(((h=f.meta)==null?void 0:h.name)||f.key)+" ",1),(v=f.meta)!=null&&v.tag_component?(w(),Z(r,{key:0,title:"同步最新的标签",overlayStyle:{maxWidth:"600px"},placement:"top"},{default:x(()=>[d("a",{onClick:te=>n.syncFieldTags&&n.syncFieldTags(f.key,f.meta)},[o[6]||(o[6]=z(" 同步 ",-1)),n.syncingTags&&n.syncingTags[f.key]?(w(),Z(i,{key:0,size:"small"})):ie("",!0)],8,QB)]),_:2},1024)):ie("",!0),(_=f.meta)!=null&&_.tip?(w(),Z(r,{key:1,overlayStyle:{maxWidth:"600px"},placement:"top"},{title:x(()=>{var te;return[d("div",eL,j((te=f.meta)==null?void 0:te.tip),1)]}),default:x(()=>[y(ee(yt))]),_:2},1024)):ie("",!0)]),d("div",tL,j(((m=f.meta)==null?void 0:m.type)||"string"),1),(g=f.meta)!=null&&g.switch_component?(w(),Z(ko,{key:0,style:{"margin-left":"8px"},value:String(n.formState[f.key]||"").toLowerCase()==="true"?"true":"false",options:e,onChange:te=>{n.onFieldChange&&n.onFieldChange(f.key,te),n.update&&n.update()}},null,8,["value","onChange"])):ie("",!0),(b=f.meta)!=null&&b.show_advanced_settings_icon?(w(),P("div",nL,[y(r,{title:"高级设置"},{default:x(()=>[d("span",{onClick:o[0]||(o[0]=te=>n.onToggleAdvanced&&n.onToggleAdvanced()),style:{color:"#2475FC",padding:"4px 8px",borderRadius:"24px",border:"1px solid #D9D9D9",background:"#E5EFFF",cursor:"pointer"}},[y(ee(Yc))])]),_:1})])):ie("",!0)]),(C=f.meta)!=null&&C.select_official_component?(w(),P("div",oL,[y(a,{value:n.formState.app_id,placeholder:"请选择公众号",style:{width:"100%"},onChange:o[1]||(o[1]=(te,q)=>{n.onFieldChange&&n.onFieldChange("app_id",te),n.appChange&&n.appChange(te,q)})},{default:x(()=>[(w(!0),P(ae,null,ye(n.apps,te=>(w(),Z(s,{key:te.app_id,value:te.app_id,name:te.app_name,app_secret:te.app_secret},{default:x(()=>[z(j(te.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"]),d("div",iL,j((D=f.meta)==null?void 0:D.desc),1),n.errors[f.key]?(w(),P("div",rL,j(n.errors[f.key]),1)):ie("",!0)])):(T=f.meta)!=null&&T.enum_component?(w(),P("div",sL,[y(a,{value:n.formState[f.key],placeholder:(O=f.meta)!=null&&O.required?"请选择":"请选择（非必填）",style:{width:"100%"},onChange:te=>{n.onFieldChange&&n.onFieldChange(f.key,te),n.update&&n.update()}},{default:x(()=>{var te,q;return[(w(!0),P(ae,null,ye(n.sortedEnum?n.sortedEnum((te=f.meta)==null?void 0:te.enum):((q=f.meta)==null?void 0:q.enum)||[],re=>(w(),Z(s,{key:re.value,value:re.value},{default:x(()=>[z(j(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","placeholder","onChange"]),d("div",aL,j((k=f.meta)==null?void 0:k.desc),1),n.errors[f.key]?(w(),P("div",lL,j(n.errors[f.key]),1)):ie("",!0)])):(S=f.meta)!=null&&S.radio_component?(w(),P("div",uL,[y(u,{value:n.formState[f.key],onChange:te=>{var re;const q=((re=te==null?void 0:te.target)==null?void 0:re.value)??te;n.onFieldChange&&n.onFieldChange(f.key,q),n.update&&n.update()}},{default:x(()=>{var te,q;return[(w(!0),P(ae,null,ye(n.sortedEnum?n.sortedEnum((te=f.meta)==null?void 0:te.enum):((q=f.meta)==null?void 0:q.enum)||[],re=>(w(),Z(l,{key:re.value,value:re.value},{default:x(()=>[z(j(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","onChange"]),d("div",dL,j((N=f.meta)==null?void 0:N.desc),1),n.errors[f.key]?(w(),P("div",cL,j(n.errors[f.key]),1)):ie("",!0)])):(L=f.meta)!=null&&L.switch_component?(w(),P("div",fL,[d("div",pL,j(($=f.meta)==null?void 0:$.desc),1),n.errors[f.key]?(w(),P("div",hL,j(n.errors[f.key]),1)):ie("",!0)])):(B=f.meta)!=null&&B.date_range_begin_component?(w(),P("div",vL,[d("div",gL,[y(a,{value:n.dateRangeTypes[(E=f.meta)==null?void 0:E.begin_date_key],onChange:te=>n.dateRangeTypeChange&&n.dateRangeTypeChange(f.meta,te),style:{width:"120px","padding-right":"4px"}},{default:x(()=>[y(s,{value:1},{default:x(()=>[...o[7]||(o[7]=[z("选择日期",-1)])]),_:1}),y(s,{value:2},{default:x(()=>[...o[8]||(o[8]=[z("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.dateRangeTypes[(A=f.meta)==null?void 0:A.begin_date_key]==1?(w(),Z(c,{key:0,value:n.getRangeValue?n.getRangeValue(f.meta):null,format:"YYYY-MM-DD",style:{width:"100%"},onCalendarChange:te=>n.onDateRangeCalendarChange&&n.onDateRangeCalendarChange(f.meta,te),onChange:(te,q)=>n.onDateRangeChange&&n.onDateRangeChange(f.meta,te,q),"disabled-date":te=>n.getDisabledDateForRange?n.getDisabledDateForRange(f.meta,te):!1},null,8,["value","onCalendarChange","onChange","disabled-date"])):(w(),P(ae,{key:1},[y(ot,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((M=f.meta)==null?void 0:M.begin_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(F=f.meta)==null?void 0:F.begin_date_key]||"",onOpen:o[2]||(o[2]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=f.meta)==null?void 0:re.begin_date_key,te,q)},placeholder:"请输入开始日期，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",_L,[d("div",mL,j(te),1),d("div",yL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),o[9]||(o[9]=d("div",{class:"date-range-separator"},"-",-1)),y(ot,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((H=f.meta)==null?void 0:H.end_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(R=f.meta)==null?void 0:R.end_date_key]||"",onOpen:o[3]||(o[3]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=f.meta)==null?void 0:re.end_date_key,te,q)},placeholder:"请输入结束日期，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",bL,[d("div",xL,j(te),1),d("div",wL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])],64))]),d("div",CL,j((G=f.meta)==null?void 0:G.desc),1),n.errors[f.key]?(w(),P("div",SL,j(n.errors[f.key]),1)):ie("",!0)])):(oe=f.meta)!=null&&oe.tag_component&&n.showTagComponents?(w(),P("div",kL,[d("div",EL,[y(a,{value:n.tagTypes[f.key],onChange:te=>n.tagTypeChange&&n.tagTypeChange(f.key,te,f.meta),style:{width:"120px"}},{default:x(()=>[y(s,{value:1},{default:x(()=>[...o[10]||(o[10]=[z("选择标签",-1)])]),_:1}),y(s,{value:2},{default:x(()=>[...o[11]||(o[11]=[z("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.tagTypes[f.key]==1?(w(),Z(a,{key:0,value:n.formState[f.key],placeholder:"请选择标签",style:{width:"100%"},onChange:(te,q)=>n.tagChange&&n.tagChange(f.key,te,q),"show-search":"","filter-option":n.filterOption},{default:x(()=>[(w(!0),P(ae,null,ye(n.tagLists[f.key]||[],te=>(w(),Z(s,{key:te.id,value:te.id,name:te.name},{default:x(()=>[z(j(te.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onChange","filter-option"])):(w(),Z(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:n.formState[f.key+"_tags"]||[],defaultValue:n.formState[f.key]||"",onOpen:o[4]||(o[4]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>n.onChangeDynamic&&n.onChangeDynamic(f.key,te,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",DL,[d("div",AL,j(te),1),d("div",OL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))]),d("div",NL,j((V=f.meta)==null?void 0:V.desc),1),n.errors[f.key]?(w(),P("div",ML,j(n.errors[f.key]),1)):ie("",!0)])):(w(),P("div",TL,[y(ot,{type:((Y=f.meta)==null?void 0:Y.in)==="body"?"textarea":void 0,inputStyle:((Q=f.meta)==null?void 0:Q.in)==="body"?"height: 64px;":void 0,options:n.variableOptions,defaultSelectedList:n.formState[f.key+"_tags"]||[],defaultValue:n.formState[f.key]||"",onOpen:o[5]||(o[5]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>n.onChangeDynamic&&n.onChangeDynamic(f.key,te,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",$L,[d("div",PL,j(te),1),d("div",RL,j(q.typ),1)])]),_:1},8,["type","inputStyle","options","defaultSelectedList","defaultValue","onChange"]),d("div",BL,j((ue=f.meta)==null?void 0:ue.desc),1),n.errors[f.key]?(w(),P("div",LL,j(n.errors[f.key]),1)):ie("",!0)]))],2)}),128)}}},pd=$e(IL,[["__scopeId","data-v-2ebec9c8"]]),FL={class:"main-box"},jL={key:0,class:"loading-box"},VL={key:1,class:"node-options"},HL={class:"options-title"},UL={key:0,class:"acton-box"},zL=["href"],qL={class:"node-options"},GL={class:"options-title"},XL={class:"node-options"},WL={class:"options-item"},YL={__name:"dynamic-api-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=Ds();let s="";const a=Xe(()=>(p.value||[]).some(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.setting_cache_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),l=Xe(()=>String(v.click_url||"").trim()),u=Xe(()=>String(v.click_title||"").trim()),c=Xe(()=>{var de;return((de=o.action)==null?void 0:de.params)||{}}),f=Xe(()=>!!(c.value.app_id&&c.value.app_secret)),p=Xe(()=>Object.entries(c.value||{}).map(([pe,xe])=>({key:pe,meta:xe})).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.hide_official_component)}).sort((pe,xe)=>{var Ce,Fe;return+(((Ce=pe.meta)==null?void 0:Ce.sort_num)||0)-+(((Fe=xe.meta)==null?void 0:Fe.sort_num)||0)}));function h(de){return(de||[]).slice().sort((pe,xe)=>+(pe.sort_num||0)-+(xe.sort_num||0))}const v=Je({app_id:"",app_secret:"",app_name:""}),_=X(!1),m=X(!1),g=X([]),b=Je({}),C=X([]),D=Je({}),T=Je({}),O=Je({}),k=Je({}),S=Je({}),N=X(null),L=X({}),$=X(null),B=X(!1),E=Xe(()=>p.value.some(pe=>{var xe;return(xe=pe.meta)==null?void 0:xe.tag_component})?p.value.some(pe=>{const xe=pe.meta||{},Ce=Array.isArray(xe.enum)?xe.enum:[];if(!(xe.enum_component||xe.radio_component||xe.switch_component)||Ce.length===0)return!1;const Fe=String(v[pe.key]??""),Ue=Ce.find(at=>String(at==null?void 0:at.value)===Fe),qe=Ue==null?void 0:Ue.related_tags;return qe===!0||qe===1||qe==="true"||qe==="1"}):!1),A=Xe(()=>(p.value||[]).some(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.plugin_config_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),M=Xe(()=>{var xe;const de=(xe=o.action)==null?void 0:xe.use_advanced_settings,pe=(p.value||[]).some(Ce=>{var Ue;const Fe=(Ue=Ce.meta)==null?void 0:Ue.advanced_settings;return Fe===!0||Fe===1||Fe==="true"||Fe==="1"});return de===!0||de===1||de==="true"||de==="1"||pe}),F=Xe(()=>{const de=pe=>{const xe=pe==null?void 0:pe.setting_cache_component;return xe===!0||xe===1||xe==="true"||xe==="1"};return(p.value||[]).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.tag_component&&!E.value)}).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.plugin_config_component)}).filter(pe=>{var Fe;const xe=(Fe=pe.meta)==null?void 0:Fe.advanced_settings;return!(xe===!0||xe===1||xe==="true"||xe==="1")}).filter(pe=>!de(pe.meta))}),H=Xe(()=>(p.value||[]).filter(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.setting_cache_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),R=Xe(()=>(p.value||[]).filter(de=>{var Ue,qe;const pe=(Ue=de.meta)==null?void 0:Ue.advanced_settings,xe=pe===!0||pe===1||pe==="true"||pe==="1",Ce=(qe=de.meta)==null?void 0:qe.plugin_config_component;return xe&&!(Ce===!0||Ce===1||Ce==="true"||Ce==="1")}));gt(E,de=>{if(!de){let pe=!1;p.value.forEach(xe=>{var Ce;(Ce=xe.meta)!=null&&Ce.tag_component&&(v[xe.key]&&(v[xe.key]="",pe=!0),Array.isArray(v[xe.key+"_tags"])&&v[xe.key+"_tags"].length&&(v[xe.key+"_tags"]=[],pe=!0))}),pe&&ue()}}),ut(()=>{G(),ds({name:"workflow:validate",callback:Q})});async function G(){f.value&&await oe(),V(),A.value&&await Ve(),p.value.forEach(async de=>{var xe,Ce,Fe,Ue,qe,at;const pe=String(((xe=de.meta)==null?void 0:xe.enum_default)||"").trim();((Ce=de.meta)!=null&&Ce.radio_component||(Fe=de.meta)!=null&&Fe.enum_component||(Ue=de.meta)!=null&&Ue.switch_component)&&!String(v[de.key]||"").trim()&&pe&&(v[de.key]=pe),(qe=de.meta)!=null&&qe.tag_component&&(T[de.key]=typeof T[de.key]=="number"?T[de.key]:1,await Me(de.key,(at=de.meta)==null?void 0:at.query_tag_service))}),ve(),tt()}function oe(){return Tr({app_type:"official_account"}).then(de=>{g.value=(de==null?void 0:de.data)||[]})}function V(){var xe,Ce,Fe;let de=JSON.parse(o.node.node_params);s=((xe=de==null?void 0:de.plugin)==null?void 0:xe.name)||"";let pe=((Fe=(Ce=de==null?void 0:de.plugin)==null?void 0:Ce.params)==null?void 0:Fe.arguments)||{};p.value.forEach(Ue=>{var at,bt,Xt,Ft,pn,vn;v[Ue.key]=Ue.key!=="app_id"?String(pe[Ue.key]||"").trim():pe[Ue.key];const qe=(pe==null?void 0:pe.tag_map)||{};if(v[Ue.key+"_tags"]=Array.isArray(qe[Ue.key])?qe[Ue.key]:[],(at=Ue.meta)!=null&&at.date_range_begin_component){const Rt=(bt=Ue.meta)==null?void 0:bt.end_date_key,Se=(Xt=Ue.meta)==null?void 0:Xt.date_type_key;v[Rt]=String(pe[Rt]||"").trim(),v[Rt+"_tags"]=Array.isArray(qe[Rt])?qe[Rt]:[];const Ye=pe[Se];k[(Ft=Ue.meta)==null?void 0:Ft.begin_date_key]=typeof k[(pn=Ue.meta)==null?void 0:pn.begin_date_key]=="number"?k[(vn=Ue.meta)==null?void 0:vn.begin_date_key]:Ye==null?1:Number(Ye)||1}}),pe.app_secret&&(v.app_secret=String(pe.app_secret)),pe.app_name&&(v.app_name=String(pe.app_name))}function Y(de,pe){pe&&pe.app_secret&&(v.app_secret=pe.app_secret),pe&&pe.name&&(v.app_name=pe.name),ue(),p.value.forEach(async xe=>{var Ce,Fe;(Ce=xe.meta)!=null&&Ce.tag_component&&await Me(xe.key,(Fe=xe.meta)==null?void 0:Fe.query_tag_service)})}function Q(){const de=ds(),pe=ke();pe&&pe.ok===!1&&de.emit&&de.emit("workflow:validate:error",{component:"公众号智能API",type:"",typeDisplay:"",message:"请完善字段后再继续",errors:pe.errors||[]})}function ue(de=null){let pe=JSON.parse(o.node.node_params);pe.plugin.output_obj=C.value;const xe=st();lt(xe),Object.assign(pe.plugin.params,{arguments:{...xe,tag_map:{..._e()}},rendering:ge()}),A.value&&(pe.plugin.params.config_name=$.value||""),pe.plugin.params.use_plugin_config=!!A.value,i({...o.node,node_params:JSON.stringify(pe)}),Ne()}function te(de,pe,xe){v[de]=pe,v[de+"_tags"]=xe,ue()}function q(de,pe){v[de]=pe,ue()}function re(de){return String(de||"").replace(/`/g,"").trim()}function ce(de){return`${String(r.query.id||"")}:${s}:${de}`}function ve(){var xe,Ce,Fe;if(!a.value)return;let de="",pe="";for(const Ue of p.value||[]){const qe=(xe=Ue.meta)==null?void 0:xe.setting_cache_component;if(!(qe===!0||qe===1||qe==="true"||qe==="1"))continue;if(!de){const Ft=re((Ce=Ue.meta)==null?void 0:Ce.click_url),pn=re((Fe=Ue.meta)==null?void 0:Fe.click_title);Ft&&(de=Ft,pe=pn)}const bt=Ue.key;if(!String(v[bt]==null?"":v[bt]).trim()){const Ft=localStorage.getItem(ce(bt));Ft!=null&&(v[bt]=Ue.key==="app_id"?Ft:String(Ft))}}de&&(v.click_url=de),pe&&(v.click_title=pe)}function Ne(){a.value&&p.value.forEach(de=>{var Ue;const pe=(Ue=de.meta)==null?void 0:Ue.setting_cache_component;if(!(pe===!0||pe===1||pe==="true"||pe==="1"))return;const Ce=de.key,Fe=String(v[Ce]==null?"":v[Ce]);localStorage.setItem(ce(Ce),Fe)})}function ge(){return p.value.filter(de=>{var Ce,Fe,Ue,qe;if((Ce=de.meta)!=null&&Ce.tag_component&&!E.value)return!1;const pe=(Fe=de.meta)==null?void 0:Fe.setting_cache_component;return!(pe===!0||pe===1||pe==="true"||pe==="1"||(Ue=de.meta)!=null&&Ue.plugin_config_component||(qe=de.meta)!=null&&qe.advanced_settings)}).map(de=>{var Fe,Ue,qe,at,bt,Xt,Ft,pn,vn;let pe=((Fe=de.meta)==null?void 0:Fe.name)||de.key,xe=String(v[de.key]??"");const Ce=Array.isArray(v[de.key+"_tags"])?v[de.key+"_tags"]:[];if(de.key==="app_id"&&(pe="公众号名称",xe=String(v.app_name??"")),(Ue=de.meta)!=null&&Ue.enum_component||(qe=de.meta)!=null&&qe.radio_component||(at=de.meta)!=null&&at.switch_component){const Rt=(((bt=de.meta)==null?void 0:bt.enum)||[]).find(Se=>String(Se==null?void 0:Se.value)===xe);Rt&&Rt.name&&(xe=String(Rt.name))}if((Xt=de.meta)!=null&&Xt.tag_component&&T[de.key]==1){const Rt=(D[de.key]||[]).find(Se=>String(Se.id)===String(xe));Rt&&Rt.name&&(xe=String(Rt.name))}if((Ft=de.meta)!=null&&Ft.date_range_begin_component){const Rt=(pn=de.meta)==null?void 0:pn.begin_date_key,Se=(vn=de.meta)==null?void 0:vn.end_date_key,Ye=String(v[Rt]||""),be=String(v[Se]||""),Be=Array.isArray(v[Rt+"_tags"])?v[Rt+"_tags"]:[],Ke=Array.isArray(v[Se+"_tags"])?v[Se+"_tags"]:[];xe=[Ye,be].filter(Boolean).join(" ~ ");const ze=[...Be,...Ke];return{label:pe,value:xe,key:de.key,tags:ze}}return{label:pe,value:xe,key:de.key,tags:Ce}})}function _e(){const de={};return p.value.forEach(pe=>{var Ce,Fe,Ue,qe;if((Ce=pe.meta)!=null&&Ce.plugin_config_component||(Fe=pe.meta)!=null&&Fe.tag_component&&!E.value)return;const xe=Array.isArray(v[pe.key+"_tags"])?v[pe.key+"_tags"]:[];if(xe.length&&(de[pe.key]=xe),(Ue=pe.meta)!=null&&Ue.date_range_begin_component){const at=(qe=pe.meta)==null?void 0:qe.end_date_key,bt=Array.isArray(v[at+"_tags"])?v[at+"_tags"]:[];bt.length&&(de[at]=bt)}}),de}function st(){const de={};return p.value.forEach(pe=>{var xe,Ce,Fe,Ue,qe,at;if(!((xe=pe.meta)!=null&&xe.plugin_config_component)&&!((Ce=pe.meta)!=null&&Ce.tag_component&&!E.value)&&(de[pe.key]=String(v[pe.key]||""),(Fe=pe.meta)!=null&&Fe.date_range_begin_component)){const bt=(Ue=pe.meta)==null?void 0:Ue.end_date_key,Xt=(qe=pe.meta)==null?void 0:qe.date_type_key;de[bt]=String(v[bt]||"");const Ft=k[(at=pe.meta)==null?void 0:at.begin_date_key]||1;de[Xt]=String(Ft)}}),v.app_secret&&(de.app_secret=String(v.app_secret||"")),v.app_name&&(de.app_name=String(v.app_name||"")),de}function tt(){C.value=yi(o.action.output),ue()}function ke(){Object.keys(b).forEach(pe=>{b[pe]=""});const de={ok:!0,errors:[]};return p.value.forEach(pe=>{const xe=pe.key,Ce=pe.meta||{},Fe=v[xe],Ue=String(Fe??"").trim(),qe=Array.isArray(v[xe+"_tags"])?v[xe+"_tags"]:[];if(!Ce.plugin_config_component){if(Ce.select_official_component){if(Ce.required&&!Ue){const at=Ce.error||"请选择公众号";b[xe]=at,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:at})}return}if(Ce.enum_component||Ce.radio_component||Ce.switch_component){const at=(Ce.enum||[]).map(bt=>String(bt.value));if(Ce.required&&!Ue){const bt=Ce.error||"请选择";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}else if(Ue&&at.length&&!at.includes(Ue)){const bt=Ce.error||"选择不合法";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}return}if(Ce.date_range_begin_component){const at=Ce.begin_date_key,bt=Ce.end_date_key,Xt=String(v[at]||"").trim(),Ft=String(v[bt]||"").trim(),pn=Array.isArray(v[at+"_tags"])?v[at+"_tags"]:[],vn=Array.isArray(v[bt+"_tags"])?v[bt+"_tags"]:[];if(Ce.required&&(!Xt&&pn.length===0||!Ft&&vn.length===0)){const Se=Ce.error||"请选择起止时间";b[xe]=Se,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Se});return}if(k[at]===2){const Se=Ye=>/^\d{4}-\d{2}-\d{2}$/.test(Ye)?ho(Ye).isValid():!1;if(Xt&&pn.length===0&&!Se(Xt)){const Ye=Ce.error||"开始日期格式需为YYYY-MM-DD";b[xe]=Ye,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ye});return}if(Ft&&vn.length===0&&!Se(Ft)){const Ye=Ce.error||"结束日期格式需为YYYY-MM-DD";b[xe]=Ye,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ye});return}}if(Xt&&Ft){const Se=ho(Xt),Ye=ho(Ft);if(Ye.isBefore(Se)){const Ke=Ce.error||"结束时间不能早于开始时间";b[xe]=Ke,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ke});return}const be=Ye.diff(Se,"day"),Be=Number(Ce.date_range_max_interval||0);if(Be>0&&be+1>Be){const Ke=Ce.error||`时间跨度不能超过${Be}天`;b[xe]=Ke,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ke});return}}return}if(Ce.required&&!Ue&&(!Array.isArray(qe)||qe.length===0)){const at=Ce.error||"请输入内容";b[xe]=at,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:at})}else if(xe.toLowerCase().includes("url")&&Ue&&(!Array.isArray(qe)||qe.length===0)&&!(/^https?:\/\//.test(Ue)||Ud(Ue))){const bt=Ce.error||"请输入正确的URL";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}}}),de}function he(de,pe,xe){T[de]=pe,pe==1&&Me(de,xe==null?void 0:xe.query_tag_service)}function De(de,pe,xe){v[de]=pe,v[de+"_name"]=(xe==null?void 0:xe.name)||"",ue()}function Me(de,pe){var Fe;const xe=JSON.parse(o.node.node_params),Ce=(Fe=xe==null?void 0:xe.plugin)==null?void 0:Fe.name;return!Ce||!pe?(D[de]=[],Promise.resolve([])):!v.app_id||!v.app_secret?(D[de]=[],Promise.resolve([])):Po({name:Ce,action:"default/exec",params:JSON.stringify({business:pe,arguments:{app_id:v.app_id,app_secret:v.app_secret}})}).then(Ue=>{var qe;return D[de]=((qe=Ue==null?void 0:Ue.data)==null?void 0:qe.tags)||[],Ue})}function U(de,pe){if(!v.app_id||!v.app_secret)return xt.warning("请先选择公众号");O[de]||(O[de]=!0,Me(de,pe==null?void 0:pe.query_tag_service).then(()=>{xt.success("同步完成")}).finally(()=>{O[de]=!1}))}const ne=(de,pe)=>pe.name.toLowerCase().indexOf(de.toLowerCase())>=0;function se(de,pe){k[de.begin_date_key]=pe;const xe=de==null?void 0:de.date_type_key;xe&&(v[xe]=String(pe));const Ce=de.begin_date_key,Fe=de.end_date_key;pe===1?(v[Ce]="",v[Fe]="",v[Ce+"_tags"]=[],v[Fe+"_tags"]=[],S[Ce]=null):pe===2&&(v[Ce]="",v[Fe]="",S[Ce]=null),ue()}function Ee(de){const pe=v[de.begin_date_key],xe=v[de.end_date_key];return[pe?ho(pe):null,xe?ho(xe):null]}function fe(de,pe){const xe=de.begin_date_key;Array.isArray(pe)&&pe[0]?S[xe]=pe[0]:S[xe]=null}function Le(de,pe,xe){v[de.begin_date_key]=xe[0]||"",v[de.end_date_key]=xe[1]||"",!xe[0]&&!xe[1]&&(S[de.begin_date_key]=null),ue()}function Ie(de,pe){if(!pe)return!1;const xe=de.end_date_max?ho(de.end_date_max):null;if(xe&&pe.isAfter(xe,"day"))return!0;const Ce=S[de.begin_date_key],Fe=Number(de.date_range_max_interval||0);if(Ce&&Fe>0){const Ue=ho(Ce).add(Fe-1,"day");return pe.isAfter(Ue,"day")}return!1}function Ve(de=!1){return mg(s,de).then(pe=>{var Ue,qe;L.value=pe||{};const xe=Object.keys(L.value),Ce=xe.find(at=>{var bt;return(bt=L.value[at])==null?void 0:bt.is_default});let Fe=null;try{const at=JSON.parse(o.node.node_params);Fe=((qe=(Ue=at==null?void 0:at.plugin)==null?void 0:Ue.params)==null?void 0:qe.config_name)||""}catch{}Fe&&xe.includes(Fe)?$.value=Fe:$.value=Ce||xe[0]||null})}function et(){const de={[o.actionName||"default"]:o.action||{}};N.value&&N.value.show(L.value,s,de)}function nt(){ue()}function We(){B.value=!B.value}function lt(de){var pe;try{const xe=$.value||"",Ce=xe?((pe=L.value)==null?void 0:pe[xe])||{}:{};if(!Ce||Object.keys(Ce).length===0)return;p.value.forEach(Fe=>{const Ue=Fe.meta||{};if(!(Ue.plugin_config_component===!0||Ue.plugin_config_component===1||Ue.plugin_config_component==="true"||Ue.plugin_config_component==="1"))return;const at=Fe.key,bt=Ce[at];bt!=null&&(de[at]=re(bt))})}catch{}}return(de,pe)=>{const xe=mo,Ce=Vt,Fe=It,Ue=Jt;return w(),P("div",FL,[m.value||_.value?(w(),P("div",jL,[y(xe)])):ie("",!0),a.value?(w(),P("div",VL,[d("div",HL,[pe[2]||(pe[2]=d("div",null,[d("img",{src:Lg,class:"title-icon"}),z("设置")],-1)),l.value?(w(),P("div",UL,[d("a",{href:l.value,target:"_blank",rel:"noopener noreferrer"},j(u.value||l.value),9,zL)])):ie("",!0)]),y(pd,{items:H.value,formState:v,errors:b,apps:g.value,variableOptions:n.variableOptions,tagTypes:T,tagLists:D,showTagComponents:E.value,sortedEnum:h,appChange:Y,onFieldChange:q,update:ue,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:U,syncingTags:O,dateRangeTypes:k,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])])):ie("",!0),d("div",qL,[d("div",GL,[pe[4]||(pe[4]=d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")],-1)),A.value?(w(),P(ae,{key:0},[Object.keys(L.value).length?(w(),Z(Fe,{key:0,value:$.value,"onUpdate:value":pe[0]||(pe[0]=qe=>$.value=qe),onChange:nt,style:{"min-width":"160px"}},{default:x(()=>[(w(!0),P(ae,null,ye(L.value,(qe,at)=>(w(),Z(Ce,{key:at,value:at},{default:x(()=>[z(j(qe.name||at),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Z(Ue,{key:1,onClick:et},{default:x(()=>[pe[3]||(pe[3]=z("未授权 ",-1)),y(ee($o))]),_:1}))],64)):ie("",!0)]),y(pd,{items:F.value,formState:v,errors:b,apps:g.value,variableOptions:n.variableOptions,tagTypes:T,tagLists:D,showTagComponents:E.value,sortedEnum:h,appChange:Y,onFieldChange:q,update:ue,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:U,syncingTags:O,dateRangeTypes:k,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"]),M.value&&B.value?(w(),Z(pd,{key:0,items:R.value,formState:v,errors:b,apps:g.value,variableOptions:n.variableOptions,tagTypes:T,tagLists:D,showTagComponents:E.value,sortedEnum:h,appChange:Y,onFieldChange:q,update:ue,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:U,syncingTags:O,dateRangeTypes:k,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])):ie("",!0)]),d("div",XL,[pe[5]||(pe[5]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",WL,[y(KB,{"tree-data":C.value},null,8,["tree-data"])])]),y(yw,{ref_key:"configModalRef",ref:N,onChange:pe[1]||(pe[1]=qe=>Ve(!0))},null,512)])}}},KL=$e(YL,[["__scopeId","data-v-71a1dbeb"]]),JL=["src"],ZL={key:2,class:"node-options"},QL={class:"options-item-tit"},e7={class:"option-label"},t7={class:"option-type"},n7={class:"field-list-item"},o7={class:"field-label"},i7={class:"field-type"},r7={class:"desc"},s7={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i={feishu_bitable:O$,official_account_profile:Y$,official_batch_tag:qP,official_send_template_message:DP,official_send_message:DR,official_draft:UB},r={"official_article:get_official_article":["url","number"]},s=Je({}),a=X({}),l=X(null),u=X([]),c=X(!1),f=X({}),p=Xe(()=>l.value?l.value.desc:a.value.description);let h={};async function v(){g(),h=JSON.parse(o.node.node_params),await _(),await m()}function _(){var D;return Eg({name:(D=h==null?void 0:h.plugin)==null?void 0:D.name}).then(T=>{var k;let O=(T==null?void 0:T.data)||{};f.value=O.remote,c.value=((k=O==null?void 0:O.local)==null?void 0:k.multiNode)||!1})}function m(){var D;return Po({name:((D=h==null?void 0:h.plugin)==null?void 0:D.name)||"",action:"default/get-schema",params:{}}).then(T=>{var S,N,L;let O=(T==null?void 0:T.data)||{};a.value=f.value;const k=(S=h==null?void 0:h.plugin)==null?void 0:S.name;if(ma(k)||c.value){const $=h.plugin.params.business;l.value=O[$];let B=r[`${k}:${$}`];Array.isArray(B)&&(l.value.params=Xc(l.value.params,B))}else{Object.assign(s,O);for(let $ in s)s[$].value=String((h==null?void 0:h.plugin.params[$])||""),s[$].tags=((L=(N=h==null?void 0:h.plugin)==null?void 0:N.tag_map)==null?void 0:L[$])||[]}})}function g(){u.value=e().getAllParentVariable()}function b(D,T,O){D.value=T,D.tags=O,C()}function C(){let D={params:{},tag_map:{}};for(let T in s){let O=s[T].value;s[T].type=="string"?O=String(O):["number","integer"].includes(s[T].type)&&(O=Number(O)),D.params[T]=O,D.tag_map[T]=s[T].tags}h.plugin.params=D.params,h.plugin.tag_map=D.tag_map,t({...o.node,node_params:JSON.stringify(h)})}return ut(()=>{v()}),(D,T)=>{const O=mo;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,desc:p.value},{"node-icon":x(()=>[a.value.icon?(w(),P("img",{key:0,class:"node-icon",src:a.value.icon},null,8,JL)):(w(),Z(O,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:x(()=>{var k,S,N;return[(k=l.value)!=null&&k.common_template?(w(),Z(KL,{key:0,node:n.node,action:l.value,actionName:ee(h).plugin.params.business,variableOptions:u.value,onUpdateVar:g},null,8,["node","action","actionName","variableOptions"])):ee(ma)((N=(S=ee(h))==null?void 0:S.plugin)==null?void 0:N.name)?(w(),P(ae,{key:1},[i[ee(h).plugin.name]?(w(),Z($u(i[ee(h).plugin.name]),{key:0,node:n.node,action:l.value,actionName:ee(h).plugin.params.business,variableOptions:u.value,onUpdateVar:g},null,40,["node","action","actionName","variableOptions"])):(w(),Z(sf,{key:1,node:n.node,params:l.value.params,output:l.value.output,variableOptions:u.value,onUpdateVar:g},null,8,["node","params","output","variableOptions"]))],64)):(w(),P("div",ZL,[T[0]||(T[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),(w(!0),P(ae,null,ye(s,(L,$)=>(w(),P("div",{key:$,class:Ct(["options-item",{"is-required":L.required}])},[d("div",QL,[d("div",e7,j($),1),d("div",t7,j(L.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:u.value,defaultSelectedList:L.tags,defaultValue:L.value,ref_for:!0,ref:"atInputRef",onOpen:g,onChange:(B,E)=>b(L,B,E),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:B,payload:E})=>[d("div",n7,[d("div",o7,j(B),1),d("div",i7,j(E.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",r7,j(L.description),1)],2))),128))]))]}),_:1})}}},a7=$e(s7,[["__scopeId","data-v-147dbc9b"]]),l7={class:"variable-node"},u7={class:"node-form-content"},d7={class:"gray-block multi-modal-box"},c7={class:"output-label"},f7={class:"multi-modal-input"},p7={style:{color:"#8c8c8c"}},h7={class:"gray-block"},v7={class:"field-items"},g7={class:"field-name-box"},_7={class:"field-name"},m7={class:"field-value-box"},y7={__name:"session-trigger-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=He("getGraph"),s=X([]),a=X([]),l=Je({question_multiple_switch:!1}),u=Xe(()=>s.value.map(g=>g.variable)),c=g=>{_()};function f(){const g=i();if(g){let C=g.getGlobalVariable().diy_global||[];C.forEach(D=>{D.label=D.key,D.value="global."+D.key}),a.value=C||[]}}function p(g){g&&f()}const h=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},v=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},_=()=>{let g=JSON.parse(o.node.node_params);g.trigger.outputs=[...s.value],g.trigger.chat_config={...l};let b={...o.node,node_params:JSON.stringify(g)};t("update-node",b),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",b)},10)},m=()=>{f();try{let g=o.node.dataRaw||o.node.node_params||"{}";g=JSON.parse(g);const b=g.trigger||{outputs:[],chat_config:{question_multiple_switch:!1}};l.question_multiple_switch=b.chat_config.question_multiple_switch,s.value=b.outputs.map(C=>(C.tags=C.tags||[],C))}catch(g){}};return ut(()=>{m()}),(g,b)=>{const C=Ti,D=Qt,T=Vt,O=It;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:h,onDeleteNode:v,desc:"chatwiki对外服务，用户发起会话时触发工作流"},null,8,["title","iconName"])]),default:x(()=>[d("div",l7,[d("div",u7,[d("div",d7,[d("div",c7,[b[1]||(b[1]=d("img",{src:lo,alt:"",class:"output-label-icon"},null,-1)),b[2]||(b[2]=d("span",{class:"output-label-text"},"多模态输入",-1)),b[3]||(b[3]=z("    ",-1)),y(C,{checked:l.question_multiple_switch,"onUpdate:checked":b[0]||(b[0]=k=>l.question_multiple_switch=k),onChange:c},null,8,["checked"])]),d("div",f7,[d("div",p7,[b[5]||(b[5]=z("开启后，支持用户输入文字+图片消息。用户输入的文字消息依然会作为question变量输出，还会额外增加一个变量question_multiple ",-1)),y(D,{placement:"left"},{title:x(()=>[...b[4]||(b[4]=[d("div",null,"question_multiple是一个对象数组，包含用户输入的文字和图片消息示例如下：",-1),d("pre",null,[d("code",null,`"question_multiple":[
  {
    "type":"text",
    "text":"这是什么"
  },{
    "type":"image_url",
    "image_url":{
      "url":"这里是图片的ur"
    }
  }
]
              `)],-1)])]),default:x(()=>[y(ee(yt))]),_:1})])])]),d("div",h7,[b[6]||(b[6]=d("div",{class:"output-label"},[d("img",{src:lo,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"输出"),d("span",{class:"output-desc"},"（输出参数已自动映射到开始节点）")],-1)),d("div",v7,[(w(!0),P(ae,null,ye(s.value,(k,S)=>(w(),P("div",{class:"field-item",key:S},[d("div",g7,[d("span",_7,j(k.key),1),y(D,null,{title:x(()=>[z(j(k.desc),1)]),default:x(()=>[y(ee(yt))]),_:2},1024)]),d("div",m7,[y(O,{style:{width:"200px"},placeholder:"请输入选择变量",value:k.variable,"onUpdate:value":N=>k.variable=N,allowClear:"",onDropdownVisibleChange:p,onChange:_},{default:x(()=>[(w(!0),P(ae,null,ye(a.value,N=>(w(),Z(T,{disabled:u.value.includes(N.value),value:N.value,key:N.key},{default:x(()=>[d("span",null,j(N.label),1)]),_:2},1032,["disabled","value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])])])]),_:1})}}},b7=$e(y7,[["__scopeId","data-v-1a9fe274"]]),x7="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23hp676wcw9__clip0_12661_41280)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'%3e%3cpath%20d='M7.99993%2014.7779C11.375%2014.7779%2014.1111%2012.0418%2014.1111%208.66678C14.1111%205.29171%2011.375%202.55566%207.99993%202.55566C4.62487%202.55566%201.88883%205.29171%201.88883%208.66678C1.88883%2012.0418%204.62487%2014.7779%207.99993%2014.7779Z'/%3e%3cpath%20d='M7.9198%205.11768L7.9194%208.78728L10.5102%2011.378'%20stroke-linecap='round'/%3e%3cpath%20d='M1.33334%203.00016L3.66667%201.3335'%20stroke-linecap='round'/%3e%3cpath%20d='M14.6667%203.00016L12.3333%201.3335'%20stroke-linecap='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='hp676wcw9__clip0_12661_41280'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";var Lp={exports:{}},Ip;function w7(){return Ip||(Ip=1,(function(n,e){(function(t){t(Sg())})(function(t){t.defineMode("shell",function(){var o={};function i(v,_){for(var m=0;m<_.length;m++)o[_[m]]=v}var r=["true","false"],s=["if","then","do","else","elif","while","until","for","in","esac","fi","fin","fil","done","exit","set","unset","export","function"],a=["ab","awk","bash","beep","cat","cc","cd","chown","chmod","chroot","clear","cp","curl","cut","diff","echo","find","gawk","gcc","get","git","grep","hg","kill","killall","ln","ls","make","mkdir","openssl","mv","nc","nl","node","npm","ping","ps","restart","rm","rmdir","sed","service","sh","shopt","shred","source","sort","sleep","ssh","start","stop","su","sudo","svn","tee","telnet","top","touch","vi","vim","wall","wc","wget","who","write","yes","zsh"];t.registerHelper("hintWords","shell",r.concat(s,a)),i("atom",r),i("keyword",s),i("builtin",a);function l(v,_){if(v.eatSpace())return null;var m=v.sol(),g=v.next();if(g==="\\")return v.next(),null;if(g==="'"||g==='"'||g==="`")return _.tokens.unshift(u(g,g==="`"?"quote":"string")),h(v,_);if(g==="#")return m&&v.eat("!")?(v.skipToEnd(),"meta"):(v.skipToEnd(),"comment");if(g==="$")return _.tokens.unshift(f),h(v,_);if(g==="+"||g==="=")return"operator";if(g==="-")return v.eat("-"),v.eatWhile(/\w/),"attribute";if(g=="<"){if(v.match("<<"))return"operator";var b=v.match(/^<-?\s*['"]?([^'"]*)['"]?/);if(b)return _.tokens.unshift(p(b[1])),"string-2"}if(/\d/.test(g)&&(v.eatWhile(/\d/),v.eol()||!/\w/.test(v.peek())))return"number";v.eatWhile(/[\w-]/);var C=v.current();return v.peek()==="="&&/\w+/.test(C)?"def":o.hasOwnProperty(C)?o[C]:null}function u(v,_){var m=v=="("?")":v=="{"?"}":v;return function(g,b){for(var C,D=!1;(C=g.next())!=null;){if(C===m&&!D){b.tokens.shift();break}else if(C==="$"&&!D&&v!=="'"&&g.peek()!=m){D=!0,g.backUp(1),b.tokens.unshift(f);break}else{if(!D&&v!==m&&C===v)return b.tokens.unshift(u(v,_)),h(g,b);if(!D&&/['"]/.test(C)&&!/['"]/.test(v)){b.tokens.unshift(c(C,"string")),g.backUp(1);break}}D=!D&&C==="\\"}return _}}function c(v,_){return function(m,g){return g.tokens[0]=u(v,_),m.next(),h(m,g)}}var f=function(v,_){_.tokens.length>1&&v.eat("$");var m=v.next();return/['"({]/.test(m)?(_.tokens[0]=u(m,m=="("?"quote":m=="{"?"def":"string"),h(v,_)):(/\d/.test(m)||v.eatWhile(/\w/),_.tokens.shift(),"def")};function p(v){return function(_,m){return _.sol()&&_.string==v&&m.tokens.shift(),_.skipToEnd(),"string-2"}}function h(v,_){return(_.tokens[0]||l)(v,_)}return{startState:function(){return{tokens:[]}},token:function(v,_){return h(v,_)},closeBrackets:"()[]{}''\"\"``",lineComment:"#",fold:"brace"}}),t.defineMIME("text/x-sh","shell"),t.defineMIME("application/x-sh","shell")})})()),Lp.exports}w7();const C7={class:"variable-node"},S7={class:"node-form-content"},k7={class:"gray-block"},E7={class:"form-item"},D7={key:0,class:"form-item"},A7={key:1,class:"form-item custom-textarea"},O7={__name:"timing-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n;function i(){let p=[];for(let h=0;h<31;h++)p.push({label:h+1+"号",value:h+1+""});return p}const r=[{value:"day",label:"每天执行"},{value:"week",label:"每周执行",children:[{value:"0",label:"星期日"},{value:"1",label:"星期一"},{value:"2",label:"星期二"},{value:"3",label:"星期三"},{value:"4",label:"星期四"},{value:"5",label:"星期五"},{value:"6",label:"星期六"}]},{value:"month",label:"每月执行",children:i()}],s=Je({type:"select_time",time_value:[],every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""});gt(()=>s,()=>{c()},{deep:!0}),He("getNode");const a=He("getGraph"),l=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",{...o.node})},10)},u=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",null)},10)},c=()=>{let p=JSON.parse(o.node.node_params),h="",v="",_="";s.time_value&&s.time_value.length&&(h=s.time_value[0],s.time_value[0]=="week"&&(v=s.time_value[1]),s.time_value[0]=="month"&&(_=s.time_value[1])),p.trigger.cron_config={...s,every_type:h,week_number:v,month_day:_};let m={...o.node,node_params:JSON.stringify(p)};t("update-node",m),setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",m)},10)},f=()=>{try{let p=o.node.dataRaw||o.node.node_params||"{}";p=JSON.parse(p);let h=p.trigger.cron_config;s.type=h.type,s.linux_crontab=h.linux_crontab,s.every_type=h.every_type,s.week_number=h.week_number,s.month_day=h.month_day,s.hour_minute=h.hour_minute;let v=h.every_type;v=="day"&&(s.time_value=["day"]),v=="week"&&(s.time_value=["week",h.week_number]),v=="month"&&(s.time_value=["month",h.month_day])}catch(p){}};return ut(()=>{f()}),(p,h)=>{const v=Ri,_=Pi,m=ei,g=wy,b=ti,C=$i;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:l,onDeleteNode:u,desc:"在设定的时间点，自动执行工作流"},null,8,["title","iconName"])]),default:x(()=>[d("div",C7,[d("div",S7,[d("div",k7,[h[6]||(h[6]=d("div",{class:"output-label"},[d("img",{src:x7,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"触发时间")],-1)),d("div",E7,[y(_,{value:s.type,"onUpdate:value":h[0]||(h[0]=D=>s.type=D)},{default:x(()=>[y(v,{value:"select_time"},{default:x(()=>[...h[4]||(h[4]=[z("选择触发时间",-1)])]),_:1}),y(v,{value:"linux_crontab"},{default:x(()=>[...h[5]||(h[5]=[z("Linux Crontab 代码",-1)])]),_:1})]),_:1},8,["value"])]),s.type==="select_time"?(w(),P("div",D7,[y(b,{gap:8},{default:x(()=>[y(m,{value:s.time_value,"onUpdate:value":h[1]||(h[1]=D=>s.time_value=D),options:r,placeholder:"请选择",style:{width:"194px"}},null,8,["value"]),y(g,{allowClear:!1,value:s.hour_minute,"onUpdate:value":h[2]||(h[2]=D=>s.hour_minute=D),valueFormat:"HH:mm",format:"HH:mm",style:{width:"124px"}},null,8,["value"])]),_:1})])):(w(),P("div",A7,[y(C,{value:s.linux_crontab,"onUpdate:value":h[3]||(h[3]=D=>s.linux_crontab=D),placeholder:"请输入代码",style:{"min-height":"142px",background:"#262626",color:"#bfbfbf"}},null,8,["value"])]))])])])]),_:1})}}},N7=$e(O7,[["__scopeId","data-v-7fd426e0"]]),M7="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1763712774665'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='300'%20height='300'%3e%3cpath%20d='M692.352%20335.04c11.712%200.128%2023.36%200.96%2034.944%202.432-31.232-156.8-186.88-273.152-365.184-273.152C163.008%2064.32%200%20210.048%200%20394.88c0%20106.944%2054.336%20194.688%20144.768%20262.784l-36.096%20117.12%20126.592-68.224c41.536%2011.2%2084.032%2017.728%20126.848%2019.584h33.856a312%20312%200%200%201-11.136-81.6%20306.88%20306.88%200%200%201%20307.84-308.032l-0.32-1.536z%20m-194.56-105.408a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312c-27.328%202.176-51.328-19.328-54.4-48.64%202.88-29.312%2027.008-50.816%2054.4-48.512z%20m-253.44%2097.152c-27.456%202.304-51.648-19.2-54.656-48.64%203.008-29.312%2027.2-50.88%2054.656-48.512a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312z'%20fill='currentColor'%20p-id='1850'%3e%3c/path%3e%3cpath%20d='M1024%20638.464c0-155.52-145.92-283.52-308.608-283.52-172.416%200-308.096%20126.784-308.096%20282.304%200%20155.52%20135.68%20282.368%20308.096%20282.368a426.176%20426.176%200%200%200%20109.44-18.304L924.16%20960l-28.416-97.216C968.832%20803.84%201024%20726.208%201024%20638.464z%20m-408.448-48.832c-19.968%200-36.16-17.408-36.16-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.56%2042.56%2014.72%2045.184%2038.784-2.624%2024.064-22.784%2041.344-45.184%2038.848z%20m199.04%200c-19.84%200-36.096-17.408-36.096-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.368%2042.432%2014.848%2045.248%2038.784-2.688%2024.064-22.848%2041.344-45.248%2038.848z'%20fill='currentColor'%20p-id='1851'%3e%3c/path%3e%3c/svg%3e",T7={class:"variable-node"},$7={class:"node-form-content"},P7={class:"gray-block"},R7={class:"app-item-list"},B7=["onClick"],L7={class:"form-item"},I7={class:"form-item-content"},F7={class:"gray-block"},j7={class:"field-items"},V7={class:"field-name-box"},H7={class:"field-name"},U7={class:"field-value-box"},z7={__name:"official-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=Ts(),o=Xe(()=>t.officialList),i=Xe(()=>t.triggerOfficialList),r=e,s=n,a=He("getNode"),l=He("getGraph"),u=X([{label:"私信消息",value:"message"},{label:"关注/取消关注事件",value:"subscribe_unsubscribe"},{label:"扫描带参数二维码事件",value:"qrcode_scan"},{label:"自定义菜单事件",value:"menu_click"}]),c=Je({msg_type:"",app_ids:[]}),f=Xe(()=>c.app_ids.map(S=>o.value.find(N=>N.app_id==S)).filter(Boolean)),p=X([]),h=X([]);Xe(()=>p.value.map(S=>S.variable));function v(){const S=a();if(S){let L=S.getGlobalVariable().diy_global||[];L.forEach($=>{$.label=$.key,$.value="global."+$.key}),h.value=L||[]}}function _(S){S&&v()}const m=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",{...s.node})},10)},g=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",null)},10)},b=()=>{let S=JSON.parse(s.node.node_params);S.trigger.outputs=[...p.value],S.trigger.trigger_official_config={msg_type:c.msg_type,app_ids:c.app_ids.join(",")};let N={...s.node,node_params:JSON.stringify(S)};r("update-node",N),setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",N)},10)},C=()=>{v();try{let S=s.node.dataRaw||s.node.node_params||"{}";S=JSON.parse(S);const N=S.trigger||{outputs:[]};let L=N.trigger_official_config;c.msg_type=L.msg_type,c.app_ids=L.app_ids?L.app_ids.split(","):[];let $=N.outputs;$||($=i.value.find(B=>B.msg_type==L.msg_type).fields),p.value=$.map(B=>(B.tags=B.tags||[],B))}catch(S){}},D=()=>{T.value.open({},JSON.parse(JSON.stringify(c.app_ids)))},T=X(null),O=S=>{c.app_ids=S||[],T.value.close(),b()},k=S=>{c.app_ids=c.app_ids.filter(N=>N!=S.app_id),b()};return ut(()=>{C()}),(S,N)=>{const L=Jt,$=It,B=Qt,E=Vt;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:m,onDeleteNode:g,desc:"当对接的公众号触发相关事件时，自动触发流程"},null,8,["title","iconName"])]),default:x(()=>[d("div",T7,[d("div",$7,[d("div",P7,[N[3]||(N[3]=d("div",{class:"output-label"},[d("img",{src:M7,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"公众号")],-1)),d("div",null,[y(L,{onClick:D,type:"dashed"},{default:x(()=>[y(ee(Ht)),N[1]||(N[1]=z("添加公众号",-1))]),_:1}),d("div",R7,[(w(!0),P(ae,null,ye(f.value,A=>(w(),P("div",{class:"app-item",key:A.app_id},[z(j(A.app_name)+" ",1),d("span",{onClick:M=>k(A),class:"close-icon"},[y(ee(Pu))],8,B7)]))),128))])]),d("div",L7,[N[2]||(N[2]=d("div",{class:"form-item-label"},"触发事件",-1)),d("div",I7,[y($,{options:u.value,value:c.msg_type,"onUpdate:value":N[0]||(N[0]=A=>c.msg_type=A),style:{width:"100%"},showArrow:!1,disabled:""},null,8,["options","value"])])])]),d("div",F7,[N[4]||(N[4]=d("div",{class:"output-label"},[d("img",{src:ju,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"输出"),d("a",{class:"ml8",href:"https://developers.weixin.qq.com/doc/subscription/guide/product/message/Receiving_standard_messages.html",target:"_blank"},"查看官方接口文档")],-1)),d("div",j7,[(w(!0),P(ae,null,ye(p.value,(A,M)=>(w(),P("div",{class:"field-item",key:M},[d("div",V7,[d("span",H7,j(A.key),1),y(B,null,{title:x(()=>[z(j(A.desc),1)]),default:x(()=>[y(ee(yt))]),_:2},1024)]),d("div",U7,[y($,{style:{width:"200px"},placeholder:"请输入选择变量",value:A.variable,"onUpdate:value":F=>A.variable=F,allowClear:"",onDropdownVisibleChange:_,onChange:b},{default:x(()=>[(w(!0),P(ae,null,ye(h.value,F=>(w(),Z(E,{value:F.value,key:F.key},{default:x(()=>[d("span",null,j(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])]),y(ww,{ref_key:"wxAppRef",ref:T,title:"添加公众号",onOk:O},null,512)])]),_:1})}}},q7=$e(z7,[["__scopeId","data-v-2ff5bbf5"]]),G7="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%234f9846fr4__clip0_12833_126304)'%20stroke='%23262626'%20stroke-width='1.33333'%3e%3cpath%20d='M4%203.30905V2.33337C4%201.78109%204.4477%201.33337%205%201.33337H13.6667C14.219%201.33337%2014.6667%201.78109%2014.6667%202.33337V11C14.6667%2011.5523%2014.219%2012%2013.6667%2012H12.6725'/%3e%3cpath%20d='M11.6667%203.33337H2.33337C1.78109%203.33337%201.33337%203.78109%201.33337%204.33337V13.6667C1.33337%2014.219%201.78109%2014.6667%202.33337%2014.6667H11.6667C12.219%2014.6667%2012.6667%2014.219%2012.6667%2013.6667V4.33337C12.6667%203.78109%2012.219%203.33337%2011.6667%203.33337Z'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%209L10%209'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%206L10%209L7%2012'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='4f9846fr4__clip0_12833_126304'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",X7="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M8%201.66663H2V12.3333H8V1.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%203.66663H8V14.3333H14V3.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4.33337%205.66663L5.66671%206.92979L4.44447%208.33329'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.3334%207.66663L11.6667%208.92979L10.4445%2010.3333'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",W7={class:"modal-title-block"},Y7={key:0,class:"run-detail"},K7={class:"flex-content-box"},J7={class:"test-model-box"},Z7={key:2,class:"input-list-box"},Q7={class:"add-btn-box"},eI={key:0,class:"result-list-box loading-box"},tI={key:1,class:"result-list-box"},nI=["onClick"],oI={class:"status-block"},iI={class:"icon-name-box"},rI=["src"],sI={class:"node-name"},aI={key:0,class:"time-tag"},lI={class:"right-active-icon"},uI={class:"save-btn-box"},dI={class:"preview-box"},cI={class:"preview-title"},fI={class:"icon-name-box"},pI=["src"],hI={class:"node-name"},vI={key:0,class:"time-tag"},gI={class:"preview-content-block"},_I={class:"title-block"},mI={class:"preview-code-box"},yI={__name:"run-test",props:{batch_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo.isLockedByOther),r=n;Xe(()=>[]);const s=X(!1),a=X(""),l=X([]),u=Xe(()=>a.value?l.value.filter(E=>E.node_key==a.value)[0]:null),c=X(!1),f=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),p=async()=>{if(i.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Pt();let E=localStorage.getItem("workflow_batch_run_test_data")||"{}";E=JSON.parse(E),f.question=E.question||"",f.openid=E.openid||"",f.global=E.global||"",l.value=[],a.value="",setTimeout(()=>{m()},1e3),s.value=!0},h=X([]),v=X(!1),_=X(!1),m=()=>{sy({robot_key:f.robot_key,batch_node_key:r.batch_node_key}).then(E=>{v.value=E.data.is_need_question,_.value=E.data.is_need_openid,v.value||(f.question=""),h.value=E.data.loop_test_params.map(A=>({...A,field:{...A.field,Vals:g(A.field)}}))})};function g(E){return E.typ=="string"||E.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const b=(E,A)=>{E.splice(A,1)},C=E=>{E.push({value:"",key:Math.random()*1e4})},D=X(null),T=X(0),O=X(0),k=()=>{D.value.validate().then(()=>{let E={...f,batch_node_key:r.batch_node_key},A=JSON.parse(JSON.stringify(h.value));A.forEach(M=>{M.field.typ.includes("array")&&(M.field.Vals=M.field.Vals.map(F=>F.value))}),E.batch_test_params=JSON.stringify(A),c.value=!0,l.value=[],localStorage.setItem("workflow_batch_run_test_data",JSON.stringify({...E})),ry({...E}).then(M=>{xt.success("测试结果生成完成");let F=M.data.node_logs||[];T.value=M.data.use_token,O.value=M.data.use_mills,S(F)}).catch(M=>{l.value=[];let F=M.data.node_logs||[];F&&F.length&&S(F)}).finally(()=>{c.value=!1})})},S=E=>{var A;l.value=E.map(M=>({...M,is_success:M.error_msg==="<nil>",node_icon:Lu(M.node_type)})),a.value=(A=l.value[0])==null?void 0:A.node_key},N=E=>{a.value=E.node_key},L=()=>{As(JSON.stringify(u.value.output)),xt.success("复制成功")};function $(E){return E.field.key.replace(E.node_key+".","")}return e({open:()=>{p()}}),(E,A)=>{const M=mi,F=ti,H=ln,R=kn,G=$n,oe=Vn,V=Jt,Y=wn,Q=mo,ue=gn;return w(),P("div",null,[y(ue,{open:s.value,"onUpdate:open":A[2]||(A[2]=te=>s.value=te),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",W7,[A[3]||(A[3]=z("运行测试 ",-1)),l.value.length?(w(),P("div",Y7,[d("span",null,"总耗时："+j(ee(ef)(O.value)),1),d("span",null,"token消耗："+j(T.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",K7,[d("div",J7,[A[10]||(A[10]=d("div",{class:"top-title"},"开始节点参数",-1)),y(Y,{model:f,ref_key:"formRef",ref:D,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[v.value?(w(),Z(R,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[A[5]||(A[5]=z("question ",-1)),y(M,{style:{margin:"0"}},{default:x(()=>[...A[4]||(A[4]=[z("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(H,{placeholder:"请输入",value:f.question,"onUpdate:value":A[0]||(A[0]=te=>f.question=te)},null,8,["value"])]),_:1})):ie("",!0),_.value?(w(),Z(R,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[A[7]||(A[7]=z("openid ",-1)),y(M,{style:{margin:"0"}},{default:x(()=>[...A[6]||(A[6]=[z("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(H,{placeholder:"请输入",value:f.openid,"onUpdate:value":A[1]||(A[1]=te=>f.openid=te)},null,8,["value"])]),_:1})):ie("",!0),(w(!0),P(ae,null,ye(h.value,te=>(w(),Z(R,{key:te.node_key,rules:[{required:te.field.required,message:`请输入${te.node_name}`}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[z(j(te.node_name)+" "+j($(te)),1),y(M,{style:{margin:"0"}},{default:x(()=>[z(j(te.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[te.field.typ=="string"?(w(),Z(H,{key:0,placeholder:"请输入",value:te.field.Vals,"onUpdate:value":q=>te.field.Vals=q},null,8,["value","onUpdate:value"])):ie("",!0),te.field.typ=="number"?(w(),Z(G,{key:1,style:{width:"100%"},placeholder:"请输入",value:te.field.Vals,"onUpdate:value":q=>te.field.Vals=q},null,8,["value","onUpdate:value"])):ie("",!0),te.field.typ.includes("array")?(w(),P("div",Z7,[(w(!0),P(ae,null,ye(te.field.Vals,(q,re)=>(w(),P("div",{class:"input-list-item",key:re},[y(oe,null,{default:x(()=>[y(H,{placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])]),_:2},1024),te.field.Vals.length>1?(w(),Z(ee(Kt),{key:0,onClick:ce=>b(te.field.Vals,re)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",Q7,[y(V,{onClick:q=>C(te.field.Vals),block:"",type:"dashed"},{default:x(()=>[...A[8]||(A[8]=[z("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),c.value?(w(),P("div",eI,[c.value?(w(),Z(Q,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),l.value.length>0?(w(),P("div",tI,[(w(!0),P(ae,null,ye(l.value,(te,q)=>(w(),P("div",{class:Ct(["list-item-block",{active:a.value==te.node_key}]),onClick:re=>N(te),key:q},[d("div",oI,[te.is_success?(w(),Z(ee(Ru),{key:0,style:{color:"#138b1b"}})):(w(),Z(ee(Pu),{key:1,style:{color:"#d81e06"}}))]),d("div",iI,[d("img",{src:te.node_icon,alt:""},null,8,rI),d("div",sI,j(te.node_name),1)]),te.is_success?(w(),P("div",aI,j(te.use_time)+"ms",1)):ie("",!0),d("div",lI,[y(ee(Bu))])],10,nI))),128))])):ie("",!0),d("div",uI,[y(V,{loading:c.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(ee(Qo)),A[9]||(A[9]=z("运行测试",-1))]),_:1},8,["loading"])])]),d("div",dI,[u.value?(w(),P(ae,{key:0},[d("div",cI,[A[11]||(A[11]=d("div",{class:"title-text"},"日志详情",-1)),d("div",fI,[d("img",{src:u.value.node_icon,alt:""},null,8,pI),d("div",hI,j(u.value.node_name),1)]),u.value.is_success?(w(),P("div",vI,j(u.value.use_time)+"ms",1)):ie("",!0)]),d("div",gI,[d("div",_I,[A[12]||(A[12]=z("运行日志",-1)),y(ee(rs),{onClick:L})]),d("div",mI,[y(ee(us),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},Hg=$e(yI,[["__scopeId","data-v-941eece4"]]),bI={class:"problem-optimization-form"},xI={class:"node-form-content"},wI={class:"gray-block"},CI={class:"row-form-item"},SI={class:"form-label"},kI={class:"row-form-item"},EI={class:"form-label"},DI={class:"gray-block"},AI={class:"gray-block-title"},OI={class:"output-box"},NI={class:"array-form-box"},MI={class:"flex-block-item",style:{gap:"12px"}},TI={class:"gray-block"},$I={class:"gray-block-title"},PI={class:"output-box"},RI={class:"array-form-box"},BI={class:"flex-block-item",style:{gap:"12px"}},LI=["onClick"],II={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=X([]),s=X([]),a=X(null);function l($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=l(B.children))}),$}function u(){let $=i().getAllParentVariable();$=l($),$=$.filter(B=>B.group_node_key!=B.loop_parent_key).filter(B=>B.node_id!=B.group_node_key),r.value=c($)}function c($){const B=E=>!E||E.length===0?[]:E.map(A=>{const M=B(A.children);return A.typ.includes("array")||M&&M.length>0?{...A,children:M}:null}).filter(Boolean);return B($)}const f=()=>{let $=i().getAllParentVariable();$.forEach(B=>{B.tags=B.tags||[]}),$=$.filter(B=>B.group_node_key==B.loop_parent_key),s.value=l($)},p=$=>{$||f()},h=X(),v={key:"",typ:"",value:"",_id:ns(16)},_={key:"",typ:"",value:"",_id:ns(16)},m=Je({chan_number:10,max_run_number:500,batch_arrays:[],output:[]});function g($){if($){let B=$.split("."),E=B[0],A=B.filter((M,F)=>F>0).join(".");return[E,A]}return[]}const b=$=>{$&&u()},C=($,B,E)=>{E?B.typ=E[E.length-1].typ:B.typ=""},D=()=>{m.output.push({key:"",typ:"",value:"",_id:ns(16)})},T=$=>{m.output.splice($,1)},O=($,B)=>{if($&&$.length){let E=s.value.filter(A=>A.value==$[0])[0].children;if(E&&E.length){let A=E.filter(M=>M.value==$[1])[0].typ;B.typ=B.typ=A.startsWith("array")?A:`array<${A}>`}}else B.typ=""},k=()=>{t("close")},S=()=>{var B;let $=m.batch_arrays[0];$&&$.key&&$.typ&&$.value?(B=a.value)==null||B.open():xt.error("请填写执行数组")},N=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).batch||{};u(),f(),m.chan_number=B.chan_number,m.max_run_number=B.max_run_number,m.batch_arrays=B.batch_arrays.map(E=>({...E,value:g(E.value)})),m.output=B.output.map(E=>({...E,value:g(E.value)})),m.batch_arrays.length==0&&(m.batch_arrays=[v]),m.output.length==0&&(m.output=[_])}catch($){}},L=()=>{const $=JSON.stringify({batch:{...m,batch_arrays:m.batch_arrays.map(B=>({...B,value:B.value?B.value.join("."):""})),chan_number:m.chan_number,max_run_number:m.max_run_number,output:m.output.map(B=>{let E=B.value?B.value.join("."):"";return{...B,value:E}})}});t("update-node",{...o.node,node_params:$})};return gt(()=>m,()=>{L()},{deep:!0}),ut(()=>{N()}),($,B)=>{const E=Qt,A=$n,M=ln,F=ei,H=Vn,R=kn,G=Jt,oe=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过设定批量运行次数和逻辑，运行批处理体内的任务",onClose:k},{runBtn:x(()=>[y(E,null,{title:x(()=>[...B[2]||(B[2]=[z("运行测试",-1)])]),default:x(()=>[d("div",{class:"action-btn",onClick:S},[y(ee(Qo),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",bI,[d("div",xI,[y(oe,{ref_key:"formRef",ref:h,layout:"vertical",model:m},{default:x(()=>[d("div",wI,[B[7]||(B[7]=d("div",{class:"gray-block-title"},[d("img",{src:G7,alt:""}),d("span",null,"执行设置")],-1)),d("div",CI,[d("div",SI,[B[4]||(B[4]=d("span",null,"并行运行数量",-1)),y(E,null,{title:x(()=>[...B[3]||(B[3]=[z("并行运行数量，最大一次执行10个",-1)])]),default:x(()=>[y(ee(yt),{class:"tip-icon"})]),_:1})]),d("div",null,[y(A,{style:{width:"300px"},max:10,min:1,precision:0,step:1,placeholder:"请输入",value:m.chan_number,"onUpdate:value":B[0]||(B[0]=V=>m.chan_number=V)},null,8,["value"])])]),d("div",kI,[d("div",EI,[B[6]||(B[6]=d("span",null,"最大执行次数",-1)),y(E,null,{title:x(()=>[...B[5]||(B[5]=[z("批量执行运行总次数不超过该上限，超过时会直接进入下一个节点",-1)])]),default:x(()=>[y(ee(yt),{class:"tip-icon"})]),_:1})]),d("div",null,[y(A,{style:{width:"300px"},max:500,min:1,precision:0,step:1,placeholder:"请输入",value:m.max_run_number,"onUpdate:value":B[1]||(B[1]=V=>m.max_run_number=V)},null,8,["value"])])])]),d("div",DI,[d("div",AI,[B[9]||(B[9]=d("img",{src:X7,alt:""},null,-1)),B[10]||(B[10]=z(" 执行数组 ",-1)),y(E,null,{title:x(()=>[...B[8]||(B[8]=[z("批处理体中节点要使用的变量，仅支持引用数组，循环次数为数组的长度，执行时会按顺序输出单个数组",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",OI,[B[11]||(B[11]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"25%"}},"参数Key"),d("div",{class:"output-item",style:{width:"30%"}},"类型"),d("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),d("div",NI,[(w(!0),P(ae,null,ye(m.batch_arrays,(V,Y)=>(w(),P("div",{class:"form-item-list",key:V._id},[y(R,{label:null},{default:x(()=>[d("div",MI,[y(M,{style:{width:"25%"},value:V.key,"onUpdate:value":Q=>V.key=Q,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(H,null,{default:x(()=>[y(M,{style:{width:"30%"},value:V.typ,"onUpdate:value":Q=>V.typ=Q,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(F,{onChange:(Q,ue)=>C(Q,V,ue),value:V.value,"onUpdate:value":Q=>V.value=Q,onDropdownVisibleChange:b,style:{width:"45%"},options:r.value,allowClear:!1,displayRender:({labels:Q})=>Q.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024)])]),_:2},1024)]))),128))])])]),d("div",TI,[d("div",$I,[B[13]||(B[13]=d("img",{src:ju,alt:""},null,-1)),B[14]||(B[14]=z(" 输出 ",-1)),y(E,null,{title:x(()=>[...B[12]||(B[12]=[z("循环完成后输出的内容，仅支持引用循环体中节点的输出变量，输出的内容会自动组装为数组类型",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",PI,[B[16]||(B[16]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"23%"}},"参数Key"),d("div",{class:"output-item",style:{width:"27%"}},"类型"),d("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),d("div",RI,[(w(!0),P(ae,null,ye(m.output,(V,Y)=>(w(),P("div",{class:"form-item-list",key:V._id},[y(R,{label:null},{default:x(()=>[d("div",BI,[y(M,{style:{width:"25%"},value:V.key,"onUpdate:value":Q=>V.key=Q,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(H,null,{default:x(()=>[y(M,{style:{width:"30%"},value:V.typ,"onUpdate:value":Q=>V.typ=Q,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(F,{onChange:Q=>O(Q,V),value:V.value,"onUpdate:value":Q=>V.value=Q,onDropdownVisibleChange:p,style:{width:"45%"},options:s.value,allowClear:!1,displayRender:({labels:Q})=>Q.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:Q=>T(Y)},[y(ee(Kt))],8,LI)])]),_:2},1024)]))),128)),y(G,{onClick:St(D,["stop"]),icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[15]||(B[15]=[z("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])]),y(Hg,{batch_node_key:n.nodeId,ref_key:"runTestRef",ref:a},null,8,["batch_node_key"])]),_:1})}}},FI=$e(II,[["__scopeId","data-v-302df825"]]),jI={class:"sub-field-item"},VI={style:{width:"200px"}},HI={class:"field-list-item"},UI={class:"field-label"},zI={class:"field-type"},qI=["onClick"],GI={key:1,class:"btn-hover-wrap",style:{opacity:"0"}},XI=["onClick"],WI={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array},variableOptions:{type:Array,default:()=>[]}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"165px":"130px"),i=(u,c)=>{c[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(u,c)=>{c.splice(u,1)},s=u=>{u.subs=[]},a=u=>u.typ=="object"&&e.level<=2,l=(u,c,f)=>{f.tags=c,f.desc=u};return(u,c)=>{const f=ln,p=ti,h=Vt,v=It,_=Nt("SubsKey",!0);return w(!0),P(ae,null,ye(e.data,(m,g)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:m.cu_key},[d("div",jI,[y(p,null,{default:x(()=>[c[0]||(c[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(f,{style:In({width:o.value}),value:m.key,"onUpdate:value":b=>m.key=b,placeholder:"请输入"},null,8,["style","value","onUpdate:value"])]),_:2},1024),y(v,{onChange:b=>s(m),value:m.typ,"onUpdate:value":b=>m.typ=b,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,b=>(w(),Z(h,{value:b.value},{default:x(()=>[z(j(b.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value"]),d("div",VI,[m.typ!="object"?(w(),Z(ot,{key:0,options:n.variableOptions,defaultSelectedList:m.tags,defaultValue:m.desc,onChange:(b,C)=>l(b,C,m),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:b,payload:C})=>[d("div",HI,[d("div",UI,j(b),1),d("div",zI,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ie("",!0)]),a(m)?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:b=>i(g,e.data)},[y(ee(Fn))],8,qI)):(w(),P("div",GI,[y(ee(Fn))])),d("div",{class:"btn-hover-wrap",onClick:b=>r(g,e.data)},[y(ee(Kt))],8,XI)]),m.subs&&m.subs.length>0?(w(),Z(_,{key:0,level:e.level+1,typOptions:e.typOptions,variableOptions:e.variableOptions,data:m.subs},null,8,["level","typOptions","variableOptions","data"])):ie("",!0)],2))),128)}}},YI=$e(WI,[["__scopeId","data-v-e519726c"]]),KI={class:"problem-optimization-form"},JI={class:"node-form-content"},ZI={class:"gray-block"},QI={key:0,class:"gray-block",style:{"margin-top":"12px"}},e9={class:"array-form-box"},t9={class:"form-item-list"},n9={class:"flex-block-item",style:{gap:"8px"}},o9={class:"flex-block-item",style:{gap:"8px"}},i9={style:{width:"200px"}},r9={class:"field-list-item"},s9={class:"field-label"},a9={class:"field-type"},l9=["onClick"],u9=["onClick"],d9={key:0,class:"sub-field-box"},c9={class:"gray-block",style:{"margin-top":"12px"}},f9={class:"array-form-box"},p9={class:"input-block-item"},h9={class:"input-header"},v9={key:0},g9={key:1},_9={key:2},m9=["onClick"],y9={class:"field-list-item"},b9={class:"field-label"},x9={class:"field-type"},w9={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i={text:"请输入文本消息内容，键入/可以插入变量",image:"请输入图片消息的url（系统发送时会自动转成图片发送），键入/可插入变量",voice:"请输入语音的url（系统发送时会自动转成语音发送），键入/可插入变量"},r=[{label:"返回消息",value:"message"},{label:"返回消息和变量",value:"variable"}],s=X([]),a=Je({}),l=(N,L)=>{if(N){let $=`at_input_${L}`;a[$]=N}},u=(N,L,$)=>{$.tags=L,$.content=N},c=(N,L,$)=>{$.tags=L,$.desc=N},f=()=>{const N=o.lf.getNodeModelById(o.nodeId);if(N){let L=N.getAllParentVariable();L.forEach($=>{$.tags=$.tags||[]}),s.value=L}};function p(N){return N.typ?h(s.value,N.typ):s.value}function h(N,L){function $(B){const E=[];for(const A of B)if(A.children&&A.children.length>0){const M=$(A.children);if(M.length>0){const F={...A,children:M};E.push(F)}}else A.typ&&A.typ===L&&E.push({...A});return E}return $(N)}const v=Je({out_type:"message",messages:[{key:_n(16),type:"text",content:""}],outputs:[{key:"",typ:"",subs:[]}]}),_=()=>{const N=JSON.stringify({finish:{...v}});t("update-node",{...o.node,node_params:N})},m=()=>{try{let N=o.node.dataRaw||o.node.node_params||"{}",L=JSON.parse(N).finish||{};L=JSON.parse(JSON.stringify(L)),f(),v.out_type=L.out_type||"message",v.messages=L.messages||[],v.messages.length==0&&(v.messages=[{key:_n(16),type:"text",content:""}]),v.outputs=L.outputs||[]}catch(N){}};gt(()=>v,()=>{_()},{deep:!0});const g=N=>{if(v.messages.length>=5)return xt.warning("最多添加5条消息");v.messages.push({key:_n(16),type:N,content:""})},b=N=>{if(v.messages.length<=1)return xt.warning("最少添加1条消息");v.messages.splice(N,1)},C=()=>{t("close")},D=()=>{v.outputs.push({key:"",typ:"string",subs:[],cu_key:_n(16)})},T=N=>{v.outputs.splice(N,1)},O=N=>{N.subs=[],N.desc=void 0,N.tags=[]},k=N=>{v.outputs[N].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},S=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return ut(()=>{m()}),(N,L)=>{const $=Qc,B=ln,E=Vt,A=It,M=Vn,F=kn,H=Jt,R=Pr,G=$r,oe=Rr,V=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"工作流完结的节点，在此节点可以定义工作流返回的信息",onClose:C},null,8,["title","iconName"])]),default:x(()=>[d("div",KI,[d("div",JI,[y(V,{ref:"formRef",layout:"vertical",model:v},{default:x(()=>[d("div",ZI,[L[4]||(L[4]=d("div",{class:"gray-block-title"},"输出类型",-1)),y($,{class:"customer-segmented",value:v.out_type,"onUpdate:value":L[0]||(L[0]=Y=>v.out_type=Y),options:r},null,8,["value"])]),v.out_type=="variable"?(w(),P("div",QI,[L[8]||(L[8]=d("div",{class:"gray-block-title"},"输出变量",-1)),d("div",e9,[L[7]||(L[7]=d("div",{class:"field-key-title"},[d("div",{class:"field-key",style:{width:"200px"}},"参数key"),d("div",{class:"field-key",style:{width:"114px"}},"类型"),d("div",{class:"field-key",style:{flex:"1"}},"参数值")],-1)),d("div",t9,[y(F,{label:null},{default:x(()=>[d("div",n9,[y(B,{style:{width:"200px"},disabled:"",value:"content",placeholder:"请输入"}),y(M,null,{default:x(()=>[y(A,{value:"string",disabled:"",placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),P(ae,null,ye(S,Y=>y(E,{value:Y.value,key:Y.value},{default:x(()=>[z(j(Y.value),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1}),d("div",null,[y(ee(Zc),{style:{color:"#faad14"}}),L[5]||(L[5]=z(" content的返回值请在下方消息中设置 ",-1))])])]),_:1})]),(w(!0),P(ae,null,ye(v.outputs,(Y,Q)=>(w(),P("div",{class:"form-item-list",key:Q},[y(F,{label:null},{default:x(()=>[d("div",o9,[y(B,{style:{width:"200px"},value:Y.key,"onUpdate:value":ue=>Y.key=ue,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(M,null,{default:x(()=>[y(A,{onChange:ue=>O(Y),value:Y.typ,"onUpdate:value":ue=>Y.typ=ue,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),P(ae,null,ye(S,ue=>y(E,{value:ue.value,key:ue.value},{default:x(()=>[z(j(ue.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),d("div",i9,[Y.typ!="object"?(w(),Z(ot,{key:0,options:p(Y),defaultSelectedList:Y.tags,defaultValue:Y.desc,onOpen:f,onChange:(ue,te)=>c(ue,te,Y,Q),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:ue,payload:te})=>[d("div",r9,[d("div",s9,j(ue),1),d("div",a9,j(te.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ie("",!0)]),Y.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:ue=>k(Q)},[y(ee(Fn))],8,l9)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:ue=>T(Q)},[y(ee(Kt))],8,u9)]),Y.subs&&Y.subs.length>0?(w(),P("div",d9,[y(M,null,{default:x(()=>[y(YI,{data:Y.subs,level:2,typOptions:S,variableOptions:s.value},null,8,["data","variableOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128)),y(H,{onClick:D,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...L[6]||(L[6]=[z("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),d("div",c9,[L[13]||(L[13]=d("div",{class:"gray-block-title"},"自定义消息",-1)),d("div",f9,[L[12]||(L[12]=d("div",{class:"form-item-label",style:{"margin-bottom":"8px"}}," 未自定义消息内容，系统默认将结束节点的上一级大模型节点的输出或者指 定回复节点的输出作为消息返回。最多添加5条消息。 ",-1)),(w(!0),P(ae,null,ye(v.messages,(Y,Q)=>(w(),P("div",{class:"form-item-list",key:Q},[y(F,{label:null},{default:x(()=>[d("div",p9,[d("div",h9,[d("div",null,[z(j(Q+1)+"、 ",1),Y.type=="text"?(w(),P("span",v9,"文本消息")):ie("",!0),Y.type=="image"?(w(),P("span",g9,"图片消息")):ie("",!0),Y.type=="voice"?(w(),P("span",_9,"语音消息")):ie("",!0)]),d("div",{class:"btn-hover-wrap",onClick:ue=>b(Q)},[y(ee(Kt))],8,m9)]),y(ot,{inputStyle:"height: 100px;",ref_for:!0,ref:ue=>l(ue,Q),options:s.value,defaultSelectedList:Y.tags,defaultValue:Y.content,onOpen:f,type:"textarea",onChange:(ue,te)=>u(ue,te,Y,Q),placeholder:i[Y.type]},{option:x(({label:ue,payload:te})=>[d("div",y9,[d("div",b9,j(ue),1),d("div",x9,j(te.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])])]),_:2},1024)]))),128)),y(oe,null,{overlay:x(()=>[y(G,null,{default:x(()=>[y(R,{onClick:L[1]||(L[1]=Y=>g("text"))},{default:x(()=>[...L[9]||(L[9]=[d("a",null,"文本",-1)])]),_:1}),y(R,{onClick:L[2]||(L[2]=Y=>g("image"))},{default:x(()=>[...L[10]||(L[10]=[d("a",null,"图片",-1)])]),_:1}),y(R,{onClick:L[3]||(L[3]=Y=>g("voice"))},{default:x(()=>[...L[11]||(L[11]=[d("a",null,"语音",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",null,[y(H,{type:"dashed",block:""},{default:x(()=>[y(ee(Ht)),z("添加消息 （"+j(v.messages.length)+" / 5）",1)]),_:1})])]),_:1})])])]),_:1},8,["model"])])])]),_:1})}}},C9=$e(w9,[["__scopeId","data-v-1c1bd103"]]),xr=[{label:"关闭",value:!1},{label:"开启",value:!0}],nl=[{label:"男生",value:"male-qn-jingying"},{label:"女生",value:"female-chengshu"},{label:"男童",value:"clever_boy"},{label:"女童",value:"lovely_girl"}],S9={happy:"高兴",sad:"悲伤",angry:"愤怒",fearful:"害怕",disgusted:"厌恶",surprised:"惊讶",calm:"中性",fluent:"生动",whisper:"低语"},k9=[8e3,16e3,22050,24e3,32e3,44100],E9=[32e3,64e3,128e3,256e3],D9=["mp3","pcm","flac","wav"],A9=[{label:"单声道",value:1},{label:"双声道",value:2}],O9={url:"url",hex:"hex"},N9={spacious_echo:"空旷回音",auditorium_echo:"礼堂广播",lofi_telephone:"电话失真",robotic:"电音"},Ug={auto:"自动检测",Chinese:"中文",Yue:"粤语",English:"英语",Arabic:"阿拉伯语",Russian:"俄语",Spanish:"西班牙语",French:"法语",Portuguese:"葡萄牙语",German:"德语",Turkish:"土耳其语",Dutch:"荷兰语",Ukrainian:"乌克兰语",Vietnamese:"越南语",Indonesian:"印度尼西亚语",Japanese:"日语",Italian:"意大利语",Korean:"韩语",Thai:"泰语",Polish:"波兰语",Romanian:"罗马尼亚语",Greek:"希腊语",Czech:"捷克语",Finnish:"芬兰语",Hindi:"印地语",Bulgarian:"保加利亚语",Danish:"丹麦语",Hebrew:"希伯来语",Malay:"马来语",Persian:"波斯语",Slovak:"斯洛伐克语",Swedish:"瑞典语",Croatian:"克罗地亚语",Filipino:"菲律宾语",Hungarian:"匈牙利语",Norwegian:"挪威语",Slovenian:"斯洛文尼亚语",Catalan:"加泰罗尼亚语",Nynorsk:"新挪威语",Tamil:"泰米尔语",Afrikaans:"南非荷兰语"},ri={speed:{ui_type:"slider",key:"voice_setting.speed",label:"语速",type:"number",required:!0,tooltip:"合成音频的语速，取值范围 [0.5, 2]，默认值为 1.0",default:1,min:.5,max:2,step:.1,marks:{.5:"0.5",2:"2"}},vol:{ui_type:"slider",key:"voice_setting.vol",label:"音量",type:"number",required:!0,tooltip:"合成音频的音量，取值越大，音量越高。取值范围 (0,10]，默认值为 1",default:1,min:0,max:10,step:1,marks:{0:"0",10:"10"}},pitch:{ui_type:"slider",key:"voice_setting.pitch",label:"音高",type:"number",required:!0,tooltip:"合成音频的语调，取值范围 [-12,12]，默认值为 0，其中 0 为原音色输出",default:0,min:-12,max:12,step:1,marks:{"-12":"-12",12:"12"}}},si={pitch:{ui_type:"slider",key:"voice_modify.pitch",label:"音高",type:"number",tooltip:"音高调整（低沉/明亮），范围 [-100,100]，数值接近 -100，声音更低沉；接近 100，声音更明亮",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},intensity:{ui_type:"slider",key:"voice_modify.intensity",label:"强度",type:"number",tooltip:"强度调整（力量感/柔和），范围 [-100,100]，数值接近 -100，声音更刚劲；接近 100，声音更轻柔",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},timbre:{ui_type:"slider",key:"voice_modify.timbre",label:"音色",type:"number",tooltip:"音色调整（磁性/清脆），范围 [-100,100]，数值接近 -100，声音更浑厚；数值接近 100，声音更清脆",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}}},M9={data:{desc:"音频合成结果",type:"object",properties:{audio:{desc:"音频数据（hex 编码）",type:"string"},status:{desc:"音频合成状态",type:"number"}}},extra_info:{desc:"音频附加信息",type:"object",properties:{audio_length:{desc:"音频时长（毫秒）",type:"number"},audio_sample_rate:{desc:"音频采样率",type:"number"},audio_size:{desc:"音频大小（字节）",type:"number"},bitrate:{desc:"音频码率",type:"number"},word_count:{desc:"文本字数",type:"number"},invisible_character_ratio:{desc:"不可见字符比例",type:"number"},usage_characters:{desc:"实际消耗字符数",type:"number"},audio_format:{desc:"音频格式",type:"string"},audio_channel:{desc:"音频声道数",type:"number"}}},trace_id:{desc:"请求追踪 ID",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},T9={input_sensitive:{desc:"输入内容是否命中敏感信息",type:"boolean"},input_sensitive_type:{desc:"敏感类型标识（0 表示无敏感）",type:"number"},demo_audio:{desc:"示例音频数据",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},$9={class:"node-options"},P9={class:"options-item is-required"},R9={class:"field-list-item"},B9={class:"field-label"},L9={class:"field-type"},I9={class:"options-item is-required"},F9={class:"field-list-item"},j9={class:"field-label"},V9={class:"field-type"},H9={class:"options-item"},U9={class:"options-item-tit flex-between"},z9={class:"options-item"},q9={class:"form-box"},G9={class:"form-item"},X9={class:"form-tit"},W9={class:"form-cont"},Y9={class:"field-list-item"},K9={class:"field-label"},J9={class:"field-type"},Z9={class:"form-item"},Q9={class:"form-tit"},eF={class:"form-cont"},tF={class:"field-list-item"},nF={class:"field-label"},oF={class:"field-type"},iF={class:"options-item"},rF={class:"form-box"},sF={class:"form-item"},aF={class:"form-tit"},lF={class:"form-cont"},uF={class:"field-list-item"},dF={class:"field-label"},cF={class:"field-type"},fF={class:"form-item"},pF={class:"form-tit"},hF={class:"form-cont"},vF={class:"options-item"},gF={class:"form-box"},_F={class:"form-item"},mF={class:"form-tit c262626"},yF={class:"form-cont"},bF={class:"options-item"},xF={class:"form-box"},wF={class:"form-item"},CF={class:"form-tit"},SF={class:"form-cont"},kF={class:"form-item"},EF={class:"form-tit"},DF={class:"form-cont"},AF={class:"form-item"},OF={class:"form-tit"},NF={class:"form-cont"},MF={class:"node-options"},TF={class:"options-item"},$F={__name:"voice-clone-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("getNode"),o=He("setData");X(null);const i=X([]),r=X([]);X([]);const s=Je({model_id:0,model:"",model_config_id:0,file_url:"",voice_id:"",clone_prompt:{prompt_audio_url:"",prompt_text:"",tag_map:{}},text:"",language_boost:"auto",need_noise_reduction:!1,need_volume_normalization:!1,aigc_watermark:!1,tag_map:{}}),a=X(!1);ut(()=>{l()});function l(){c(),r.value=yi(T9),u()}function u(){var m;let v=JSON.parse(e.node.node_params),_=((m=v==null?void 0:v.voice_clone)==null?void 0:m.arguments)||{};_.tag_map=_.tag_map?_.tag_map:{},Object.assign(s,_)}function c(){i.value=t().getAllParentVariable()}function f(v,_,m,g=null){g=g||s,g[v]=_,s.tag_map[v]=m,h()}function p(){a.value=!a.value}function h(){let v=JSON.parse(e.node.node_params);s.model_id=Number(s.model_id||0),Object.assign(v.voice_clone,{model_config_id:s.model_config_id,arguments:s,output:r.value}),o({...e.node,node_params:JSON.stringify(v)})}return(v,_)=>{const m=Qt,g=Vt,b=It;return w(),Z(cn,null,{default:x(()=>{var C,D,T,O,k;return[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"支持音色快速复制"},null,8,["title","iconName"]),d("div",$9,[_[27]||(_[27]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),d("div",P9,[_[12]||(_[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"复刻音频文件"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((C=s.tag_map)==null?void 0:C.file_url)||[],defaultValue:s.file_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:_[0]||(_[0]=(S,N)=>f("file_url",S,N))},{option:x(({label:S,payload:N})=>[d("div",R9,[d("div",B9,j(S),1),d("div",L9,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_[13]||(_[13]=d("div",{class:"desc"},"待复刻音频",-1))]),d("div",I9,[_[14]||(_[14]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音频ID"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((D=s.tag_map)==null?void 0:D.voice_id)||[],defaultValue:s.voice_id,ref:"atInputRef",placeholder:"请输入参数值，键入/插入变量",onOpen:c,onChange:_[1]||(_[1]=(S,N)=>f("voice_id",S,N))},{option:x(({label:S,payload:N})=>[d("div",F9,[d("div",j9,j(S),1),d("div",V9,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_[15]||(_[15]=d("div",{class:"desc"},'克隆音色的 voice_id，正确示例：“MiniMax001"”，长度范围［8,256］，首字符必须为英文字母允许数字、字母、_未位字符不可为-._，不可与已有id 重复',-1))]),d("div",H9,[d("div",U9,[_[17]||(_[17]=d("div",{class:"option-label"},"复刻示例音频",-1)),d("a",{onClick:p},[_[16]||(_[16]=z("高级设置 ",-1)),a.value?(w(),Z(ee(Va),{key:1})):(w(),Z(ee($o),{key:0}))])])]),a.value?(w(),P(ae,{key:0},[d("div",z9,[d("div",q9,[d("div",G9,[d("div",X9,[y(m,{title:"音色复刻示例音频，提供本参数将有助于增强语音合成的音色相似度和稳定性"},{default:x(()=>[_[18]||(_[18]=z(" 音频文件 ",-1)),y(ee(yt))]),_:1})]),d("div",W9,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((T=s.tag_map)==null?void 0:T.prompt_audio_url)||[],defaultValue:s.clone_prompt.prompt_audio_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:_[2]||(_[2]=(S,N)=>f("prompt_audio_url",S,N,s.clone_prompt))},{option:x(({label:S,payload:N})=>[d("div",Y9,[d("div",K9,j(S),1),d("div",J9,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",Z9,[d("div",Q9,[y(m,{title:"示例音频的对应文本，需确保和音频内容一致，句末需有标点符号做结尾"},{default:x(()=>[_[19]||(_[19]=z(" 文本 ",-1)),y(ee(yt))]),_:1})]),d("div",eF,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((O=s.tag_map)==null?void 0:O.prompt_text)||[],defaultValue:s.clone_prompt.prompt_text,ref:"atInputRef",placeholder:"输入示例音频的对应文本，键入/插入变量",onOpen:c,onChange:_[3]||(_[3]=(S,N)=>f("prompt_text",S,N,s.clone_prompt))},{option:x(({label:S,payload:N})=>[d("div",tF,[d("div",nF,j(S),1),d("div",oF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])])]),d("div",iF,[_[22]||(_[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"复刻试听参数")],-1)),d("div",rF,[d("div",sF,[d("div",aF,[y(m,{title:"复刻试听参数，限制 1000 字符以内。模型将使用复刻后的音色朗读本段文本内容，并返回试听音频链接。"},{default:x(()=>[_[20]||(_[20]=z(" 文本 ",-1)),y(ee(yt))]),_:1})]),d("div",lF,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((k=s.tag_map)==null?void 0:k.text)||[],defaultValue:s.text,ref:"atInputRef",placeholder:"输入复刻试听的文本，键入/插入变量",onOpen:c,onChange:_[4]||(_[4]=(S,N)=>f("text",S,N))},{option:x(({label:S,payload:N})=>[d("div",uF,[d("div",dF,j(S),1),d("div",cF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",fF,[d("div",pF,[y(m,{title:"是否增强对指定的小语种和方言的识别能力。默认值为 null，可设置为 auto 让模型自主判断。"},{default:x(()=>[_[21]||(_[21]=z(" 小语种识别能力 ",-1)),y(ee(yt))]),_:1})]),d("div",hF,[y(b,{value:s.language_boost,"onUpdate:value":_[5]||(_[5]=S=>s.language_boost=S),placeholder:"请选择",onChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(ee(Ug),(S,N)=>(w(),Z(g,{key:N,value:N},{default:x(()=>[z(j(S),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",vF,[d("div",gF,[d("div",_F,[d("div",mF,[y(m,{title:"指定合成试听音频使用的语音模型，提供 text(文本) 字段时必传此字段"},{default:x(()=>[_[23]||(_[23]=z(" 试听音频语音模型 ",-1)),y(ee(yt))]),_:1})]),d("div",yF,[y(nr,{style:{width:"276px"},"model-type":"TTS",modeName:s.model,"onUpdate:modeName":_[6]||(_[6]=S=>s.model=S),modeId:s.model_id,"onUpdate:modeId":_[7]||(_[7]=S=>s.model_id=S),useConfigId:s.model_config_id,"onUpdate:useConfigId":_[8]||(_[8]=S=>s.model_config_id=S),onChange:h},null,8,["modeName","modeId","useConfigId"])])])])]),d("div",bF,[d("div",xF,[d("div",wF,[d("div",CF,[y(m,{title:"音频复刻参数，表示是否开启降噪"},{default:x(()=>[_[24]||(_[24]=z(" 降噪 ",-1)),y(ee(yt))]),_:1})]),d("div",SF,[y(ko,{value:s.need_noise_reduction,"onUpdate:value":_[9]||(_[9]=S=>s.need_noise_reduction=S),options:ee(xr),onChange:h},null,8,["value","options"])])]),d("div",kF,[d("div",EF,[y(m,{title:"音频复刻参数，是否开启音量归一化"},{default:x(()=>[_[25]||(_[25]=z(" 音量归一化 ",-1)),y(ee(yt))]),_:1})]),d("div",DF,[y(ko,{value:s.need_volume_normalization,"onUpdate:value":_[10]||(_[10]=S=>s.need_volume_normalization=S),options:ee(xr),onChange:h},null,8,["value","options"])])]),d("div",AF,[d("div",OF,[y(m,{title:"是否在合成试听音频的末尾添加音频节奏标识"},{default:x(()=>[_[26]||(_[26]=z(" 音频节奏标识 ",-1)),y(ee(yt))]),_:1})]),d("div",NF,[y(ko,{value:s.aigc_watermark,"onUpdate:value":_[11]||(_[11]=S=>s.aigc_watermark=S),options:ee(xr),onChange:h},null,8,["value","options"])])])])])],64)):ie("",!0)]),d("div",MF,[_[28]||(_[28]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",TF,[y(Bi,{"tree-data":r.value},null,8,["tree-data"])])])]}),_:1})}}},PF=$e($F,[["__scopeId","data-v-52befc87"]]);function RF(n={}){return Gc.get({url:"/manage/getMiniMaxVoiceList",params:n})}const BF={class:"zm-line2"},LF={__name:"select-voice-modal",props:{modelConfigId:{type:[Number,String]},voiceType:{type:String,default:"all"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=X(!1),s=X(!1),a=X(""),l=X([]),u=X([]),c=X([]),f=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"名称",dataIndex:"voice_name",width:120},{title:"ID",dataIndex:"voice_id",width:80},{title:"描述",dataIndex:"description",width:200}],p=Xe(()=>a.value?l.value.filter(g=>g.voice_name.indexOf(a.value)>-1||g.voice_id==a.value):l.value);function h(g=[]){u.value=g,v(),r.value=!0}function v(){s.value=!0,RF({model_config_id:i.modelConfigId,voice_type:i.voiceType}).then(g=>{l.value=(g==null?void 0:g.data)||[],l.value.forEach((b,C)=>{var D;b.index=C+1,b.description=((D=b==null?void 0:b.description)==null?void 0:D[0])||""}),c.value=l.value.filter(b=>u.value.includes(b.voice_id))}).finally(()=>{s.value=!1})}function _(g,b){u.value=g,c.value=b}function m(){o("change",Bn(u.value),Bn(c.value)),r.value=!1}return e({show:h}),(g,b)=>{const C=ln,D=Qt,T=Ns,O=gn;return w(),Z(O,{open:r.value,"onUpdate:open":b[1]||(b[1]=k=>r.value=k),title:"选择音色",width:"670px",onOk:m},{default:x(()=>[y(C,{value:a.value,"onUpdate:value":b[0]||(b[0]=k=>a.value=k),valueModifiers:{trim:!0},placeholder:"请输入音色名称/ID搜索","allow-clear":"",style:{width:"240px"}},{suffix:x(()=>[y(ee(fg))]),_:1},8,["value"]),y(T,{class:"mt16",loading:s.value,columns:f,"data-source":p.value,pagination:!1,"row-key":"voice_id","row-selection":{type:"radio",selectedRowKeys:u.value,onChange:_},scroll:{y:500}},{bodyCell:x(({column:k,record:S})=>[k.dataIndex==="description"?(w(),Z(D,{key:0,title:S.description},{default:x(()=>[d("div",BF,j(S.description),1)]),_:2},1032,["title"])):ie("",!0)]),_:1},8,["loading","data-source","row-selection"])]),_:1},8,["open"])}}},IF=$e(LF,[["__scopeId","data-v-3ba758a3"]]),FF={class:"node-options"},jF={class:"options-item is-required"},VF={class:"options-item is-required"},HF={class:"field-list-item"},UF={class:"field-label"},zF={class:"field-type"},qF={class:"options-item is-required"},GF={class:"flex-between"},XF={class:"options-item is-required"},WF={class:"flex-between"},YF={class:"field-list-item"},KF={class:"field-label"},JF={class:"field-type"},ZF={class:"options-item"},QF={class:"form-box"},ej={class:"option-type"},tj={class:"form-cont"},nj={class:"form-item"},oj={class:"form-tit required"},ij={class:"form-cont"},rj={class:"form-item"},sj={class:"form-tit required"},aj={class:"form-cont"},lj={class:"options-item"},uj={class:"form-box"},dj={class:"form-item"},cj={class:"form-tit"},fj={class:"form-cont"},pj={class:"form-item"},hj={class:"form-tit"},vj={class:"form-cont"},gj={class:"form-item"},_j={class:"form-tit"},mj={class:"form-cont"},yj={class:"form-item"},bj={class:"form-tit"},xj={class:"form-cont"},wj={class:"options-item"},Cj={class:"form-box"},Sj={class:"option-type"},kj={class:"form-cont"},Ej={class:"form-item"},Dj={class:"form-tit"},Aj={class:"form-cont"},Oj={class:"options-item"},Nj={class:"form-box"},Mj={class:"form-item"},Tj={class:"form-tit"},$j={class:"form-cont"},Pj={class:"form-item"},Rj={class:"form-tit"},Bj={class:"form-cont"},Lj={class:"form-item"},Ij={class:"form-tit"},Fj={class:"form-cont"},jj={class:"form-item"},Vj={class:"form-tit"},Hj={class:"form-cont"},Uj={class:"form-item"},zj={class:"form-tit"},qj={class:"form-cont"},Gj={class:"node-options"},Xj={class:"options-item"},Wj={__name:"voice-synthesis-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("getNode"),o=He("setData"),i=X(null),r=X([]),s=X([]),a=X([]),l=Je({model_id:0,use_model:"",model_config_id:0,text:"",voice_set_type:1,voice_setting:{voice_id:"male-qn-jingying",voice_name:"",speed:1,vol:1,pitch:0,emotion:"happy",text_normalization:!1},audio_setting:{sample_rate:32e3,bitrate:128e3,format:"mp3",channel:1,force_cbr:!1},voice_modify:{pitch:0,intensity:0,timbre:0,sound_effects:""},language_boost:"auto",output_format:"url",subtitle_enable:!1,aigc_watermark:!1,tag_map:{}}),u=X(!1),c=Xe(()=>{var L,$;const k=l.voice_setting.voice_id,N=nl.some(B=>B.value==k)?"-1":(($=(L=a.value)==null?void 0:L[0])==null?void 0:$.voice_id)??k;return[...nl,{label:"自定义",value:N}]}),f=Xe(()=>[...nl,...a.value.map(k=>({label:k.voice_name,value:k.voice_id}))]);ut(()=>{p()});function p(){v(),s.value=yi(M9),h()}function h(){var N,L;let k=JSON.parse(e.node.node_params),S=((N=k==null?void 0:k.text_to_audio)==null?void 0:N.arguments)||{};if(S.tag_map=S.tag_map?S.tag_map:{},Object.assign(l,S),(L=l.voice_setting)!=null&&L.voice_id&&nl.findIndex($=>{var B;return $.value==((B=l.voice_setting)==null?void 0:B.voice_id)})<0){const{voice_id:$,voice_name:B}=l.voice_setting;a.value=[{voice_id:$,voice_name:B}]}}function v(){r.value=t().getAllParentVariable()}function _(k,S,N){l[k]=S,l.tag_map[k]=N,O()}function m(k,S){l.voice_setting.voice_id=k,l.tag_map.voice_setting_voice_id=S,O()}function g(){if(!l.model_config_id)return xt.warning("请先选择语音模型");i.value.show([l.voice_setting.voice_id])}function b(){l.voice_setting.voice_id="male-qn-jingying",O()}function C(){O()}function D(k,S){l.voice_setting.voice_id=k[0],l.voice_setting.voice_name=S[0].voice_name,a.value=S,O()}function T(){u.value=!u.value}function O(){let k=JSON.parse(e.node.node_params);l.model_id=Number(l.model_id||0),Object.assign(k.text_to_audio,{voice_type:"all",model_config_id:l.model_config_id,arguments:l,output:s.value}),o({...e.node,node_params:JSON.stringify(k)})}return(k,S)=>{const N=Qt,L=Vt,$=It,B=Os,E=Sy,A=$n,M=Cy;return w(),Z(cn,null,{default:x(()=>{var F,H;return[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。"},null,8,["title","iconName"]),d("div",FF,[S[50]||(S[50]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),d("div",jF,[S[19]||(S[19]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"语音模型")],-1)),y(nr,{"model-type":"TTS",modeName:l.use_model,"onUpdate:modeName":S[0]||(S[0]=R=>l.use_model=R),modeId:l.model_id,"onUpdate:modeId":S[1]||(S[1]=R=>l.model_id=R),useConfigId:l.model_config_id,"onUpdate:useConfigId":S[2]||(S[2]=R=>l.model_config_id=R),onChange:b},null,8,["modeName","modeId","useConfigId"])]),d("div",VF,[S[20]||(S[20]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文本"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:((F=l.tag_map)==null?void 0:F.text)||[],defaultValue:l.text,ref:"atInputRef",onOpen:v,onChange:S[3]||(S[3]=(R,G)=>_("text",R,G))},{option:x(({label:R,payload:G})=>[d("div",HF,[d("div",UF,j(R),1),d("div",zF,j(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),S[21]||(S[21]=d("div",{class:"desc"},"需要合成语音的文本，长度限制小于 10000字符；文本长度尽量不要超过3000字，否则生成速度较慢",-1))]),d("div",qF,[S[22]||(S[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择音色")],-1)),d("div",GF,[y(ko,{value:l.voice_setting.voice_id,"onUpdate:value":S[4]||(S[4]=R=>l.voice_setting.voice_id=R),options:c.value,onChange:O},null,8,["value","options"]),y(N,{title:"高级设置"},{default:x(()=>[d("span",{class:"setting-icon",onClick:T},[y(ee(Yc))])]),_:1})])]),d("div",XF,[S[26]||(S[26]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音色设置"),d("div",{class:"option-type"},"string")],-1)),d("div",WF,[y($,{value:l.voice_set_type,"onUpdate:value":S[5]||(S[5]=R=>l.voice_set_type=R),onChange:C},{default:x(()=>[y(L,{value:1},{default:x(()=>[...S[23]||(S[23]=[z("选择音色",-1)])]),_:1}),y(L,{value:2},{default:x(()=>[...S[24]||(S[24]=[z("设置音色",-1)])]),_:1})]),_:1},8,["value"]),l.voice_set_type==1?(w(),Z($,{key:0,value:l.voice_setting.voice_id,"onUpdate:value":S[6]||(S[6]=R=>l.voice_setting.voice_id=R),open:!1,onDropdownVisibleChange:g,style:{width:"100%"}},{default:x(()=>[y(L,{value:"-1"},{default:x(()=>[...S[25]||(S[25]=[z("请选择",-1)])]),_:1}),(w(!0),P(ae,null,ye(f.value,R=>(w(),Z(L,{value:R.value,key:R.item},{default:x(()=>[z(j(R.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Z(ot,{key:1,type:"textarea",inputStyle:"height: 33px",options:r.value,defaultSelectedList:((H=l.tag_map)==null?void 0:H.voice_setting_voice_id)||[],defaultValue:l.voice_setting.voice_id,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:v,onChange:m},{option:x(({label:R,payload:G})=>[d("div",YF,[d("div",KF,j(R),1),d("div",JF,j(G.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),u.value?(w(),P(ae,{key:0},[d("div",ZF,[S[30]||(S[30]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"声音设置")],-1)),d("div",QF,[(w(),P(ae,null,ye(["speed","vol","pitch"],R=>d("div",{key:R,class:"form-item"},[d("div",{class:Ct(["form-tit",{required:ee(ri)[R]}.required])},[y(N,{title:ee(ri)[R].tooltip},{default:x(()=>[z(j(ee(ri)[R].label)+" ",1),y(ee(yt)),d("span",ej,j(ee(ri)[R].type),1)]),_:2},1032,["title"])],2),d("div",tj,[y(M,null,{default:x(()=>[y(E,{span:15},{default:x(()=>[y(B,{value:l.voice_setting[R],"onUpdate:value":G=>l.voice_setting[R]=G,step:ee(ri)[R].step,min:ee(ri)[R].min,max:ee(ri)[R].max,marks:ee(ri)[R].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),y(E,{span:7},{default:x(()=>[y(A,{value:l.voice_setting[R],"onUpdate:value":G=>l.voice_setting[R]=G,placeholder:"请输入",min:ee(ri)[R].min,max:ee(ri)[R].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),d("div",nj,[d("div",oj,[y(N,{title:"控制合成语音的情绪，模型会根据输入文本自动匹配合适的情绪，一般无需手动指定；该参数仅对 speech-2.6-hd, speech-2.6-turbo, speech-02-hd, speech-02-turbo, speech-01-hd, speech-01-turbo 模型生效"},{default:x(()=>[S[27]||(S[27]=z(" 情绪 ",-1)),y(ee(yt)),S[28]||(S[28]=d("span",{class:"option-type"},"string",-1))]),_:1})]),d("div",ij,[y($,{value:l.voice_setting.emotion,"onUpdate:value":S[7]||(S[7]=R=>l.voice_setting.emotion=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(S9),(R,G)=>(w(),Z(L,{key:G},{default:x(()=>[z(j(R),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",rj,[d("div",sj,[y(N,{title:"是否启用中文、英语文本规范化，开启后可提升数字阅读场景的性能，但会略微增加延迟，默认值为 false"},{default:x(()=>[S[29]||(S[29]=z(" 中/英文本规范化 ",-1)),y(ee(yt))]),_:1})]),d("div",aj,[y(ko,{value:l.voice_setting.text_normalization,"onUpdate:value":S[8]||(S[8]=R=>l.voice_setting.text_normalization=R),options:ee(xr),onChange:O},null,8,["value","options"])])])])]),d("div",lj,[S[39]||(S[39]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音频设置")],-1)),d("div",uj,[d("div",dj,[d("div",cj,[y(N,{title:"生成音频的采样率。可选范围[8000，16000，22050，24000，32000，44100]，默认为 32000"},{default:x(()=>[S[31]||(S[31]=z(" 采样率 ",-1)),y(ee(yt))]),_:1}),S[32]||(S[32]=d("span",{class:"option-type"},"Number",-1))]),d("div",fj,[y($,{value:l.audio_setting.sample_rate,"onUpdate:value":S[9]||(S[9]=R=>l.audio_setting.sample_rate=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(k9),R=>(w(),Z(L,{key:R},{default:x(()=>[z(j(R),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",pj,[d("div",hj,[y(N,{title:"生成音频的比特率。可选范围[32000，64000，128000，256000]，默认值为 128000。该参数仅对 mp3 格式的音频生效"},{default:x(()=>[S[33]||(S[33]=z(" 比特率 ",-1)),y(ee(yt))]),_:1}),S[34]||(S[34]=d("span",{class:"option-type"},"Number",-1))]),d("div",vj,[y($,{value:l.audio_setting.bitrate,"onUpdate:value":S[10]||(S[10]=R=>l.audio_setting.bitrate=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(E9),R=>(w(),Z(L,{key:R},{default:x(()=>[z(j(R),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",gj,[d("div",_j,[y(N,{title:"生成音频的格式，wav 仅在非流式输出下支持"},{default:x(()=>[S[35]||(S[35]=z(" 格式 ",-1)),y(ee(yt))]),_:1}),S[36]||(S[36]=d("span",{class:"option-type"},"string",-1))]),d("div",mj,[y($,{value:l.audio_setting.format,"onUpdate:value":S[11]||(S[11]=R=>l.audio_setting.format=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(D9),R=>(w(),Z(L,{key:R},{default:x(()=>[z(j(R),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",yj,[d("div",bj,[y(N,{title:"生成音频的声道数"},{default:x(()=>[S[37]||(S[37]=z(" 声道数 ",-1)),y(ee(yt))]),_:1}),S[38]||(S[38]=d("span",{class:"option-type"},"Number",-1))]),d("div",xj,[y($,{value:l.audio_setting.channel,"onUpdate:value":S[12]||(S[12]=R=>l.audio_setting.channel=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(A9),R=>(w(),Z(L,{key:R.value,value:R.value},{default:x(()=>[z(j(R.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",wj,[S[43]||(S[43]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"声音效果器设置")],-1)),d("div",Cj,[(w(),P(ae,null,ye(["pitch","intensity","timbre"],R=>d("div",{key:R,class:"form-item"},[d("div",{class:Ct(["form-tit",{required:ee(si)[R]}.required])},[y(N,{title:ee(si)[R].tooltip},{default:x(()=>[z(j(ee(si)[R].label)+" ",1),y(ee(yt)),d("span",Sj,j(ee(si)[R].type),1)]),_:2},1032,["title"])],2),d("div",kj,[y(M,null,{default:x(()=>[y(E,{span:15},{default:x(()=>[y(B,{value:l.voice_modify[R],"onUpdate:value":G=>l.voice_modify[R]=G,step:ee(si)[R].step,min:ee(si)[R].min,max:ee(si)[R].max,marks:ee(si)[R].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),y(E,{span:7},{default:x(()=>[y(A,{value:l.voice_modify[R],"onUpdate:value":G=>l.voice_modify[R]=G,placeholder:"请输入",min:ee(si)[R].min,max:ee(si)[R].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),d("div",Ej,[d("div",Dj,[y(N,{title:"音效设置，单次仅能选择一种，可选"},{default:x(()=>[S[40]||(S[40]=z(" 音效 ",-1)),y(ee(yt)),S[41]||(S[41]=d("span",{class:"option-type"},"string",-1))]),_:1})]),d("div",Aj,[y($,{value:l.voice_modify.sound_effects,"onUpdate:value":S[13]||(S[13]=R=>l.voice_modify.sound_effects=R),placeholder:"请选择",onChange:O},{default:x(()=>[y(L,{value:""},{default:x(()=>[...S[42]||(S[42]=[z("无",-1)])]),_:1}),(w(!0),P(ae,null,ye(ee(N9),(R,G)=>(w(),Z(L,{key:G,value:G},{default:x(()=>[z(j(R),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",Oj,[S[49]||(S[49]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"其他设置")],-1)),d("div",Nj,[d("div",Mj,[d("div",Tj,[y(N,{title:"是否增强对指定的小语种和方言的识别能力"},{default:x(()=>[S[44]||(S[44]=z(" 小语种识别能力 ",-1)),y(ee(yt))]),_:1})]),d("div",$j,[y($,{value:l.language_boost,"onUpdate:value":S[14]||(S[14]=R=>l.language_boost=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(Ug),(R,G)=>(w(),Z(L,{key:G,value:G},{default:x(()=>[z(j(R),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",Pj,[d("div",Rj,[y(N,{title:"控制输出结果形式的参数，可选值范围为[url, hex]。该参数仅在非流式场景生效，流式场景仅支持返回 hex 形式。返回的 url 有效期为 24 小时"},{default:x(()=>[S[45]||(S[45]=z(" 输出结果形式 ",-1)),y(ee(yt))]),_:1})]),d("div",Bj,[y($,{value:l.output_format,"onUpdate:value":S[15]||(S[15]=R=>l.output_format=R),placeholder:"请选择",onChange:O},{default:x(()=>[(w(!0),P(ae,null,ye(ee(O9),(R,G)=>(w(),Z(L,{key:G,value:G},{default:x(()=>[z(j(R),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",Lj,[d("div",Ij,[y(N,{title:"对于音频恒定比特率（cbr）控制，可选 false、 true。当此参数设置为 true，将以恒定比特率方式进行音频编码。注意：本参数仅当音频设置为流式输出，且音频格式为 mp3 时生效。"},{default:x(()=>[S[46]||(S[46]=z(" 恒定比特率控制 ",-1)),y(ee(yt))]),_:1})]),d("div",Fj,[y(ko,{value:l.audio_setting.force_cbr,"onUpdate:value":S[16]||(S[16]=R=>l.audio_setting.force_cbr=R),options:ee(xr),onChange:O},null,8,["value","options"])])]),d("div",jj,[d("div",Vj,[y(N,{title:"控制是否开启字幕服务，默认值为 false。此参数仅在非流式输出场景下有效，且仅对 speech-2.6-hd speech-2.6-turbo speech-02-turbo speech-02-hd speech-01-turbo speech-01-hd 模型有效"},{default:x(()=>[S[47]||(S[47]=z(" 开启字幕服务 ",-1)),y(ee(yt))]),_:1})]),d("div",Hj,[y(ko,{value:l.subtitle_enable,"onUpdate:value":S[17]||(S[17]=R=>l.subtitle_enable=R),options:ee(xr),onChange:O},null,8,["value","options"])])]),d("div",Uj,[d("div",zj,[y(N,{title:"控制在合成音频的末尾添加音频节奏标识，默认值为 False。该参数仅对非流式合成生效"},{default:x(()=>[S[48]||(S[48]=z(" 合成音频的末尾添加音频节奏标识 ",-1)),y(ee(yt))]),_:1})]),d("div",qj,[y(ko,{value:l.aigc_watermark,"onUpdate:value":S[18]||(S[18]=R=>l.aigc_watermark=R),options:ee(xr),onChange:O},null,8,["value","options"])])])])])],64)):ie("",!0)]),d("div",Gj,[S[51]||(S[51]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",Xj,[y(Bi,{"tree-data":s.value},null,8,["tree-data"])])]),y(IF,{ref_key:"voiceModalRef",ref:i,modelConfigId:l.model_config_id,onChange:D},null,8,["modelConfigId"])]}),_:1})}}},Yj=$e(Wj,[["__scopeId","data-v-8a1940f5"]]),Kj="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.09452%2014.4098C4.97749%2014.0772%203.98319%2013.4598%203.19588%2012.6417C3.48959%2012.2936%203.66659%2011.8438%203.66659%2011.3527C3.66659%2010.2482%202.77116%209.35274%201.66659%209.35274C1.59977%209.35274%201.53372%209.35604%201.46858%209.36244C1.37985%208.9286%201.33325%208.47947%201.33325%208.0194C1.33325%207.32254%201.44018%206.65064%201.63852%206.0192C1.64786%206.01934%201.65721%206.0194%201.66659%206.0194C2.77116%206.0194%203.66659%205.12397%203.66659%204.0194C3.66659%203.7023%203.59279%203.40247%203.46145%203.13607C4.23242%202.4192%205.17342%201.88271%206.21729%201.59375C6.54805%202.2421%207.22215%202.68608%207.99992%202.68608C8.77769%202.68608%209.45179%202.2421%209.78255%201.59375C10.8264%201.88271%2011.7674%202.4192%2012.5384%203.13607C12.4071%203.40247%2012.3333%203.7023%2012.3333%204.0194C12.3333%205.12397%2013.2287%206.0194%2014.3333%206.0194C14.3426%206.0194%2014.352%206.01934%2014.3613%206.0192C14.5597%206.65064%2014.6666%207.32254%2014.6666%208.0194C14.6666%208.47947%2014.62%208.9286%2014.5313%209.36244C14.4661%209.35604%2014.4001%209.35274%2014.3333%209.35274C13.2287%209.35274%2012.3333%2010.2482%2012.3333%2011.3527C12.3333%2011.8438%2012.5103%2012.2936%2012.804%2012.6417C12.0167%2013.4598%2011.0224%2014.0772%209.90532%2014.4098C9.64752%2013.6034%208.89192%2013.0194%207.99992%2013.0194C7.10792%2013.0194%206.35232%2013.6034%206.09452%2014.4098Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.99984%2010.3542C9.2885%2010.3542%2010.3332%209.3095%2010.3332%208.02083C10.3332%206.73217%209.2885%205.6875%207.99984%205.6875C6.71117%205.6875%205.6665%206.73217%205.6665%208.02083C5.6665%209.3095%206.71117%2010.3542%207.99984%2010.3542Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e",Jj="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Zj={class:"problem-optimization-form"},Qj={class:"node-form-content"},eV={class:"gray-block"},tV={class:"model-setting-form"},nV={class:"model-content"},oV={class:"model-setting-form"},iV={class:"model-content"},rV={class:"model-setting-form"},sV={class:"model-label"},aV={class:"model-content"},lV={key:0,class:"model-setting-form"},uV={class:"model-content"},dV={key:1,class:"model-setting-form"},cV={class:"model-content"},fV={key:0,class:"gray-block mt16"},pV={style:{width:"409px"},class:"flex-between-box"},hV={class:"array-form-box"},vV={class:"flex-block-item"},gV={class:"field-list-item"},_V={class:"field-label"},mV={class:"field-type"},yV=["onClick"],bV={class:"gray-block mt16"},xV={class:"key-label"},wV={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"显示",value:"1"},{label:"不显示",value:"0"}],r=[{label:"开启",value:"1"},{label:"关闭",value:"0"}],s=X([]),a=He("getNode"),l=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[{value:"",key:_n(16)}],image_watermark:"1",image_optimize_prompt:"1"}),u=X(null),c=X(null),f=()=>{u.value.refresh()},p=()=>{c.value.show()},h=Xe(()=>{let oe=[];if(l.image_num>0)for(let V=0;V<+l.image_num;V++){let Y=String.fromCharCode(97+V);oe.push(`picture_url_${Y}`)}return oe}),v=()=>{l.size=void 0,l.image_num="1",l.input_images=[{value:"",key:_n(16)}]},_=Xe(()=>uw(l.model_config_id,l.use_model,"IMAGE")||{}),m=Xe(()=>_.value.image_generation?JSON.parse(_.value.image_generation):{}),g=rw(),b=Xe(()=>m.value.image_sizes?m.value.image_sizes.split(",").map(oe=>g.find(V=>V.value==oe)):[]),C=Xe(()=>+m.value.image_max||1),D=Xe(()=>m.value.image_optimize_prompt=="1"),T=Xe(()=>m.value.image_watermark=="1"),O=Xe(()=>+m.value.image_inputs_image_max||1),k=()=>{let oe=[{key:"msg",typ:"string"}];h.value.forEach(Y=>{oe.push({key:Y,typ:"string"})});const V=JSON.stringify({image_generation:{...l,image_num:l.image_num>0?l.image_num+"":"1",input_images:l.input_images.map(Y=>Y.value).filter(Boolean),output:oe}});t("update-node",{...o.node,node_params:V})},S=()=>{try{let oe=o.node.dataRaw||o.node.node_params||"{}",V=JSON.parse(oe).image_generation||{};$(),E(),V=JSON.parse(JSON.stringify(V)),l.model_config_id=V.model_config_id,l.use_model=V.use_model,l.size=V.size,l.image_num=V.image_num,l.prompt=V.prompt,l.prompt_tags=V.prompt_tags,l.input_images=V.input_images.map(Y=>({value:Y,key:_n(16)})),l.image_watermark=V.image_watermark,l.image_optimize_prompt=V.image_optimize_prompt}catch(oe){}},N=X([]),L=oe=>{oe&&$()},$=()=>{let oe=a().getAllParentVariable();N.value=oe||[]},B=(oe,V)=>{l.prompt_tags=V,l.prompt=oe},E=()=>{const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let V=oe.getAllParentVariable();V.forEach(Y=>{Y.tags=Y.tags||[]}),s.value=V}},A=Je({}),M=(oe,V,Y)=>{if(oe){let Q=`at_input_${V}_${Y}`;A[Q]=oe}},F=(oe,V,Y)=>{Y.tags=V,Y.value=oe},H=()=>{if(l.input_images.length>=O.value)return xt.error("最多添加"+O.value+"张参考图");l.input_images.push({value:"",key:_n(16)})},R=oe=>{l.input_images.splice(oe,1)};gt(()=>l,()=>{k()},{deep:!0});const G=()=>{t("close")};return ut(()=>{S()}),(oe,V)=>{const Y=Vt,Q=It,ue=Qt,te=$n,q=Qc,re=kn,ce=Jt,ve=Vn,Ne=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过文字描述/添加参考图片生成图片",onClose:G},null,8,["title","iconName"])]),default:x(()=>[d("div",Zj,[d("div",Qj,[y(Ne,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",eV,[V[14]||(V[14]=d("div",{class:"gray-block-title"},[d("img",{src:Kj,alt:""}),z("模型设置 ")],-1)),d("div",tV,[V[8]||(V[8]=d("div",{class:"model-label"},"模型",-1)),d("div",nV,[y(nr,{modelType:"IMAGE",modeName:l.use_model,"onUpdate:modeName":V[0]||(V[0]=ge=>l.use_model=ge),modeId:l.model_config_id,"onUpdate:modeId":V[1]||(V[1]=ge=>l.model_config_id=ge),onChange:v},null,8,["modeName","modeId"])])]),d("div",oV,[V[9]||(V[9]=d("div",{class:"model-label"},"比例",-1)),d("div",iV,[y(Q,{placeholder:"请选择",value:l.size,"onUpdate:value":V[2]||(V[2]=ge=>l.size=ge),style:{width:"100%"}},{default:x(()=>[(w(!0),P(ae,null,ye(b.value,ge=>(w(),Z(Y,{value:ge.value,key:ge.value},{default:x(()=>[z(j(ge.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",rV,[d("div",sV,[V[11]||(V[11]=z(" 最大生成数量 ",-1)),y(ue,null,{title:x(()=>[...V[10]||(V[10]=[z("最多生成几张图片，实际生成图片数量请在提示词里面指定（比如：请生成4张图片），但是不会超过最大数量。",-1)])]),default:x(()=>[y(ee(yt))]),_:1})]),d("div",aV,[y(te,{placeholder:"请输入",style:{width:"100%"},value:l.image_num,"onUpdate:value":V[3]||(V[3]=ge=>l.image_num=ge),min:1,max:C.value},null,8,["value","max"])])]),T.value?(w(),P("div",lV,[V[12]||(V[12]=d("div",{class:"model-label"},"右下水印",-1)),d("div",uV,[y(q,{class:"customer-segmented",value:l.image_watermark,"onUpdate:value":V[4]||(V[4]=ge=>l.image_watermark=ge),options:i},null,8,["value"])])])):ie("",!0),D.value?(w(),P("div",dV,[V[13]||(V[13]=d("div",{class:"model-label"},"优化提示词",-1)),d("div",cV,[y(q,{class:"customer-segmented",value:l.image_optimize_prompt,"onUpdate:value":V[5]||(V[5]=ge=>l.image_optimize_prompt=ge),options:r},null,8,["value"])])])):ie("",!0)]),_.value.input_image==1||_.value.input_text==1?(w(),P("div",fV,[V[17]||(V[17]=d("div",{class:"gray-block-title"},[d("img",{src:Jj,alt:""}),z("输入")],-1)),_.value.input_text==1?(w(),Z(re,{key:0,name:"use_model"},{label:x(()=>[d("div",pV,[V[15]||(V[15]=d("div",null,"提示词",-1)),d("div",{class:"btn-hover-wrap",onClick:p},[y(ee(Br))])])]),default:x(()=>[y(ot,{options:N.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,ref_key:"promptInputRef",ref:u,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:L,onChange:V[6]||(V[6]=(ge,_e)=>B(ge,_e))},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):ie("",!0),_.value.input_image==1?(w(),Z(re,{key:1,label:"参考图URL",name:"use_model"},{default:x(()=>[y(ve,null,{default:x(()=>[d("div",hV,[(w(!0),P(ae,null,ye(l.input_images,(ge,_e)=>(w(),P("div",{class:"form-item-list",key:ge.key},[d("div",vV,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:st=>M(st,"input_images",_e),options:s.value,defaultSelectedList:ge.tags,defaultValue:ge.value,onOpen:E,onChange:(st,tt)=>F(st,tt,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:st,payload:tt})=>[d("div",gV,[d("div",_V,j(st),1),d("div",mV,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),d("div",{class:"btn-hover-wrap",onClick:st=>R(_e)},[y(ee(Kt))],8,yV)])]))),128)),y(ce,{onClick:H,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...V[16]||(V[16]=[z("新增参考图",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1})):ie("",!0)])):ie("",!0),d("div",bV,[V[19]||(V[19]=d("div",{class:"gray-block-title"},[d("img",{src:ju,alt:""}),z("输出")],-1)),V[20]||(V[20]=d("div",{class:"output-item"},[d("div",{class:"key-label"},"msg"),d("div",{class:"key-value"},"string")],-1)),(w(!0),P(ae,null,ye(h.value,ge=>(w(),P("div",{class:"output-item",key:ge},[d("div",xV,j(ge),1),V[18]||(V[18]=d("div",{class:"key-value"},"string",-1))]))),128))])]),_:1},8,["model"])])]),y(za,{options:N.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:L,onChange:V[7]||(V[7]=(ge,_e)=>B(ge,_e)),onOk:f,ref_key:"fullAtInputRef",ref:c},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})}}},CV=$e(wV,[["__scopeId","data-v-eca65362"]]),SV={class:"problem-optimization-form"},kV={class:"node-form-content"},EV={class:"gray-block"},DV={class:"model-setting-form"},AV={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({content:""}),r=()=>{const l=JSON.stringify({...i});t("update-node",{...o.node,node_params:l})},s=()=>{try{let l=o.node.dataRaw||o.node.node_params||"{}",u=JSON.parse(l);i.content=u.content}catch(l){}};gt(()=>i,()=>{r()},{deep:!0});const a=()=>{t("close")};return ut(()=>{s()}),(l,u)=>{const c=$i,f=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"",onClose:a},null,8,["title","iconName"])]),default:x(()=>[d("div",SV,[d("div",kV,[y(f,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[d("div",EV,[u[1]||(u[1]=d("div",{class:"gray-block-title"},null,-1)),d("div",DV,[y(c,{style:{"min-height":"300px"},value:i.content,"onUpdate:value":u[0]||(u[0]=p=>i.content=p),valueModifiers:{trim:!0},"auto-size":"",placeholder:"请输入注释"},null,8,["value"])])])]),_:1},8,["model"])])])]),_:1})}}},OV=$e(AV,[["__scopeId","data-v-eed0b52a"]]),zg={__name:"add-key-modal",props:{request_content_type:{type:String,default:""},level:{type:Number,default:1}},emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Xe(()=>{if(i.request_content_type=="multipart/form-data")return[{lable:"string",value:"string"},{lable:"file",value:"file"}];if(i.request_content_type=="application/x-www-form-urlencoded")return[{lable:"string",value:"string"}];if(i.request_content_type=="application/json"){let b=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return i.level>=2?b.filter(C=>C.value!="object"):b}return[{lable:"string",value:"string"}]}),s=X(!1),a=X("新增参数");let l="add";const u=(b,C)=>C?/^[a-zA-Z_]+$/.test(C)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let c=0;const f=Je({key:"",typ:"string",cu_key:"",desc:void 0,subs:[]}),p=()=>{f.typ="string",s.value=!0},h=()=>{Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),l="add",a.value="新增参数",s.value=!0},v=b=>{c=b,Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),l="addSub",a.value="新增参数",s.value=!0},_=(b,C)=>{c=C,Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),Object.assign(f,{...b}),l="edit",a.value="编辑参数",s.value=!0},m=X(null),g=()=>{m.value.validate().then(()=>{l=="add"&&o("add",{...f}),l=="addSub"&&o("addSub",{...f},c),l=="edit"&&o("edit",{...f},c),s.value=!1})};return e({show:p,add:h,edit:_,addSub:v}),(b,C)=>{const D=ln,T=kn,O=Vt,k=It,S=wn,N=gn;return w(),P("div",null,[y(N,{open:s.value,"onUpdate:open":C[2]||(C[2]=L=>s.value=L),title:a.value,onOk:g,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[y(S,{ref_key:"formRef",ref:m,layout:"vertical",model:f,style:{margin:"24px 0"}},{default:x(()=>[y(T,{label:"参数key",name:"key",rules:[{required:!0,validator:(L,$)=>u(L,$)}]},{default:x(()=>[y(D,{value:f.key,"onUpdate:value":C[0]||(C[0]=L=>f.key=L),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),y(T,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[y(k,{value:f.typ,"onUpdate:value":C[1]||(C[1]=L=>f.typ=L),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(!0),P(ae,null,ye(r.value,L=>(w(),Z(O,{value:L.value},{default:x(()=>[z(j(L.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},NV={class:"sub-field-item"},MV={class:"key-title-item"},TV={class:"typ-title-item"},$V={class:"value-title-item"},PV=["onClick"],RV=["onClick"],BV=["onClick"],LV={__name:"subs-key",props:{data:{},level:{type:Number},globalOptions:{type:Array},request_content_type:{type:String,default:""}},setup(n){const e=n;Xe(()=>e.level>2?f.filter(p=>p.value!="object"):f);let t=0;const o=(p,h)=>{h.splice(p,1)},i=X(null),r=p=>{t=p,i.value.add()},s=(p,h)=>{i.value.edit(p,h)},a=p=>{e.data[t].subs.push(p)},l=(p,h)=>{e.data[h].typ!=p.typ&&(p.desc=void 0),e.data.splice(h,1,p)},u=p=>p.typ=="object"&&e.level<=2,c=p=>{let h=p.typ;return h=="file"&&(h="string"),h?e.globalOptions.filter(v=>v.typ==h):e.globalOptions};let f=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return(p,h)=>{const v=Vt,_=It,m=Nt("SubsKey",!0);return w(),P(ae,null,[(w(!0),P(ae,null,ye(e.data,(g,b)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[d("div",NV,[h[0]||(h[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),d("div",MV,j(g.key),1),d("div",TV,j(g.typ),1),d("div",$V,[g.typ!="object"?(w(),Z(_,{key:0,placeholder:"请输入选择变量",value:g.desc,"onUpdate:value":C=>g.desc=C,style:{width:"90%"}},{default:x(()=>[(w(!0),P(ae,null,ye(c(g),C=>(w(),Z(v,{value:C.value,key:C.key},{default:x(()=>[d("span",null,j(C.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ie("",!0)]),u(g)?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:C=>r(b,e.data)},[y(ee(Fn))],8,PV)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:C=>s(g,b)},[y(ee(wr))],8,RV),d("div",{class:"btn-hover-wrap",onClick:C=>o(b,e.data)},[y(ee(Kt))],8,BV)]),g.subs&&g.subs.length>0?(w(),Z(m,{key:0,request_content_type:e.request_content_type,level:e.level+1,data:g.subs,globalOptions:e.globalOptions},null,8,["request_content_type","level","data","globalOptions"])):ie("",!0)],2))),128)),y(zg,{onAdd:a,level:e.level,request_content_type:e.request_content_type,onEdit:l,ref_key:"addParamsModalRef",ref:i},null,8,["level","request_content_type"])],64)}}},Fp=$e(LV,[["__scopeId","data-v-9e7f766c"]]),IV={class:"variable-node"},FV={class:"node-form-content"},jV={class:"gray-block"},VV={class:"mt8"},HV={class:"array-form-box"},UV={class:"flex-block-item"},zV={class:"at-input-flex1"},qV=["onClick"],GV={key:0,class:"array-form-box"},XV={class:"array-form-box"},WV={class:"key-block-item"},YV={class:"key-item",style:{width:"180px"}},KV={class:"key-item",style:{width:"90px"}},JV={class:"key-item",style:{width:"160px"}},ZV={class:"key-item btn-block",style:{flex:"1"}},QV=["onClick"],eH=["onClick"],tH=["onClick"],nH={key:0,class:"sub-field-box"},oH={class:"mt8"},iH={key:1,class:"array-form-box"},rH={class:"array-form-box"},sH={class:"key-block-item"},aH={class:"key-item",style:{width:"180px"}},lH={class:"key-item",style:{width:"90px"}},uH={class:"key-item",style:{width:"160px"}},dH={class:"key-item btn-block",style:{flex:"1"}},cH=["onClick"],fH=["onClick"],pH={class:"mt8"},hH={key:2,class:"array-form-box"},vH={class:"array-form-box"},gH={class:"key-block-item"},_H={class:"key-item",style:{width:"180px"}},mH={class:"key-item",style:{width:"90px"}},yH={class:"key-item",style:{width:"160px"}},bH={class:"key-item btn-block",style:{flex:"1"}},xH=["onClick"],wH=["onClick"],CH=["onClick"],SH={key:0,class:"sub-field-box"},kH={class:"mt8"},EH={class:"gray-block mt16"},DH={key:0,class:"mt8"},AH={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""});gt(()=>i,()=>{l()},{deep:!0}),He("getNode");const r=He("getGraph"),s=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},a=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},l=()=>{let L=JSON.parse(o.node.node_params);L.trigger.trigger_web_hook_config={...i};let $={...o.node,node_params:JSON.stringify(L)};t("update-node",$),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",$)},10)},u=()=>{try{let L=o.node.dataRaw||o.node.node_params||"{}";L=JSON.parse(L),f();let $=L.trigger.trigger_web_hook_config;i.url=$.url,i.method=$.method||"GET",i.switch_verify=$.switch_verify||"1",i.switch_allow_ip=$.switch_allow_ip||"0",i.allow_ips=$.allow_ips?$.allow_ips.split(",").join(`
`):"",i.params=$.params||[],i.form=$.form||[],i.x_form=$.x_form||[],i.json=$.json||[],i.request_content_type=$.request_content_type||"none",i.response_type=$.response_type||"now",i.response_now=$.response_now||""}catch(L){}},c=X([]);function f(){const L=o.lf.getNodeModelById(o.nodeId);if(L){let B=L.getGlobalVariable().diy_global||[];B.forEach(E=>{E.label=E.key,E.value="global."+E.key}),c.value=B||[]}c.value}const p=Xe(()=>c.value.filter(L=>L.typ=="string")),h=L=>{L&&f()},v=L=>{let $=L.typ;return $=="file"&&($="string"),$?c.value.filter(B=>B.typ==$):c.value},_=()=>{i.params.push({key:"",typ:"string",desc:void 0})},m=L=>{i.params.splice(L,1)},g=(L,$)=>{i[$].splice(L,1)},b=X(null),C=()=>{b.value.add()},D=L=>{b.value.addSub(L)},T=(L,$)=>{b.value.edit(L,$)},O=L=>{i.request_content_type=="multipart/form-data"&&i.form.push(L),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.push(L),i.request_content_type=="application/json"&&i.json.push(L)},k=(L,$)=>{i.request_content_type=="multipart/form-data"&&i.form.splice($,1,L),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.splice($,1,L),i.request_content_type=="application/json"&&i.json.splice($,1,L)},S=(L,$)=>{i.request_content_type=="multipart/form-data"&&(i.form[$].subs||(i.form[$].subs=[]),i.form[$].subs.push(L)),i.request_content_type=="application/x-www-form-urlencoded"&&(i.x_form[$].subs||(i.x_form[$].subs=[]),i.x_form[$].subs.push(L)),i.request_content_type=="application/json"&&(i.json[$].subs||(i.json[$].subs=[]),i.json[$].subs.push(L))},N=()=>{As(i.url),xt.success("复制成功")};return ut(()=>{u()}),(L,$)=>{const B=Vt,E=It,A=ln,M=Jt,F=ky,H=kn,R=Ri,G=Pi,oe=$i,V=Vn,Y=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:s,onDeleteNode:a,desc:"向服务器发送请求，触发工作流。"},null,8,["title","iconName"])]),default:x(()=>[d("div",IV,[d("div",FV,[y(Y,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[d("div",jV,[y(H,{label:"请求地址"},{default:x(()=>[y(F,{compact:""},{default:x(()=>[y(E,{value:i.method,"onUpdate:value":$[0]||($[0]=Q=>i.method=Q),style:{width:"20%"}},{default:x(()=>[y(B,{value:"POST"},{default:x(()=>[...$[9]||($[9]=[z("POST",-1)])]),_:1}),y(B,{value:"GET"},{default:x(()=>[...$[10]||($[10]=[z("GET",-1)])]),_:1})]),_:1},8,["value"]),y(A,{readonly:"",value:i.url,"onUpdate:value":$[1]||($[1]=Q=>i.url=Q),style:{width:"65%"}},null,8,["value"]),y(M,{onClick:$[2]||($[2]=Q=>N()),style:{width:"15%"},type:"primary"},{default:x(()=>[...$[11]||($[11]=[z("复制",-1)])]),_:1})]),_:1})]),_:1}),y(H,{label:"鉴权"},{default:x(()=>[y(G,{value:i.switch_verify,"onUpdate:value":$[3]||($[3]=Q=>i.switch_verify=Q)},{default:x(()=>[y(R,{value:"1"},{default:x(()=>[...$[12]||($[12]=[z("需要鉴权",-1)])]),_:1}),y(R,{value:"0"},{default:x(()=>[...$[13]||($[13]=[z("无需鉴权",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),y(H,{label:"IP白名单"},{default:x(()=>[y(G,{value:i.switch_allow_ip,"onUpdate:value":$[4]||($[4]=Q=>i.switch_allow_ip=Q)},{default:x(()=>[y(R,{value:"0"},{default:x(()=>[...$[14]||($[14]=[z("不启用",-1)])]),_:1}),y(R,{value:"1"},{default:x(()=>[...$[15]||($[15]=[z("启用",-1)])]),_:1})]),_:1},8,["value"]),d("div",VV,[y(oe,{value:i.allow_ips,"onUpdate:value":$[5]||($[5]=Q=>i.allow_ips=Q),style:{"min-height":"74px"},placeholder:"请输入ip，一行一个"},null,8,["value"])])]),_:1}),d("div",HV,[$[17]||($[17]=d("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),P(ae,null,ye(i.params,(Q,ue)=>(w(),P("div",{class:"form-item-list",key:ue},[y(H,{label:null},{default:x(()=>[d("div",UV,[y(V,null,{default:x(()=>[y(A,{style:{width:"120px"},value:Q.key,"onUpdate:value":te=>Q.key=te,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",zV,[y(E,{style:{width:"100%"},placeholder:"请输入选择变量",value:Q.desc,"onUpdate:value":te=>Q.desc=te,onDropdownVisibleChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(p.value,te=>(w(),Z(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),d("div",{class:"btn-hover-wrap",onClick:te=>m(ue)},[y(ee(Kt))],8,qV)])]),_:2},1024)]))),128)),y(M,{onClick:_,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[16]||($[16]=[z("添加参数",-1)])]),_:1},8,["icon"])]),i.method=="POST"?(w(),P(ae,{key:0},[y(H,{label:"BODY"},{default:x(()=>[y(G,{value:i.request_content_type,"onUpdate:value":$[6]||($[6]=Q=>i.request_content_type=Q)},{default:x(()=>[y(R,{value:"none"},{default:x(()=>[...$[18]||($[18]=[z("none",-1)])]),_:1}),y(R,{value:"multipart/form-data"},{default:x(()=>[...$[19]||($[19]=[z("form-data",-1)])]),_:1}),y(R,{value:"application/x-www-form-urlencoded"},{default:x(()=>[...$[20]||($[20]=[z("x-www-form-urlencoded",-1)])]),_:1}),y(R,{value:"application/json"},{default:x(()=>[...$[21]||($[21]=[z("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),i.request_content_type=="multipart/form-data"?(w(),P("div",GV,[d("div",XV,[$[22]||($[22]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),P(ae,null,ye(i.form,(Q,ue)=>(w(),P("div",{class:"form-item-list",key:ue},[y(H,{label:null},{default:x(()=>[d("div",WV,[d("div",YV,j(Q.key),1),d("div",KV,j(Q.typ),1),d("div",JV,[y(E,{placeholder:"请输入选择变量",value:Q.desc,"onUpdate:value":te=>Q.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(v(Q),te=>(w(),Z(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),d("div",ZV,[Q.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:te=>D(ue)},[y(ee(Fn))],8,QV)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:te=>T(Q,ue)},[y(ee(wr))],8,eH),d("div",{class:"btn-hover-wrap",onClick:te=>g(ue,"form")},[y(ee(Kt))],8,tH)])]),Q.subs&&Q.subs.length>0?(w(),P("div",nH,[y(V,null,{default:x(()=>[y(Fp,{data:Q.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128))]),d("div",oH,[y(M,{onClick:C,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[23]||($[23]=[z("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),i.request_content_type=="application/x-www-form-urlencoded"?(w(),P("div",iH,[d("div",rH,[$[24]||($[24]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),P(ae,null,ye(i.x_form,(Q,ue)=>(w(),P("div",{class:"form-item-list",key:ue},[y(H,{label:null},{default:x(()=>[d("div",sH,[d("div",aH,j(Q.key),1),d("div",lH,j(Q.typ),1),d("div",uH,[y(E,{placeholder:"请输入选择变量",value:Q.desc,"onUpdate:value":te=>Q.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(v(Q),te=>(w(),Z(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),d("div",dH,[d("div",{class:"btn-hover-wrap",onClick:te=>T(Q,ue)},[y(ee(wr))],8,cH),d("div",{class:"btn-hover-wrap",onClick:te=>g(ue,"x_form")},[y(ee(Kt))],8,fH)])])]),_:2},1024)]))),128))]),d("div",pH,[y(M,{onClick:C,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[25]||($[25]=[z("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),i.request_content_type=="application/json"?(w(),P("div",hH,[d("div",vH,[$[26]||($[26]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),P(ae,null,ye(i.json,(Q,ue)=>(w(),P("div",{class:"form-item-list",key:ue},[y(H,{label:null},{default:x(()=>[d("div",gH,[d("div",_H,j(Q.key),1),d("div",mH,j(Q.typ),1),d("div",yH,[Q.typ!="object"?(w(),Z(E,{key:0,placeholder:"请输入选择变量",value:Q.desc,"onUpdate:value":te=>Q.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),P(ae,null,ye(v(Q),te=>(w(),Z(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ie("",!0)]),d("div",bH,[Q.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:te=>D(ue)},[y(ee(Fn))],8,xH)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:te=>T(Q,ue)},[y(ee(wr))],8,wH),d("div",{class:"btn-hover-wrap",onClick:te=>g(ue,"json")},[y(ee(Kt))],8,CH)])]),Q.subs&&Q.subs.length>0?(w(),P("div",SH,[y(V,null,{default:x(()=>[y(Fp,{data:Q.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128))]),d("div",kH,[y(M,{onClick:C,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[27]||($[27]=[z("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0)],64)):ie("",!0)]),d("div",EH,[y(H,{label:"RESPONSE"},{default:x(()=>[y(G,{value:i.response_type,"onUpdate:value":$[7]||($[7]=Q=>i.response_type=Q)},{default:x(()=>[y(R,{value:"message_variable"},{default:x(()=>[...$[28]||($[28]=[z("工作流执行结束返回",-1)])]),_:1}),y(R,{value:"now"},{default:x(()=>[...$[29]||($[29]=[z("立即返回",-1)])]),_:1})]),_:1},8,["value"]),i.response_type=="now"?(w(),P("div",DH,[y(oe,{value:i.response_now,"onUpdate:value":$[8]||($[8]=Q=>i.response_now=Q),style:{"min-height":"74px"},placeholder:"请在这里输入返回的json"},null,8,["value"])])):ie("",!0)]),_:1})])]),_:1},8,["model"]),y(zg,{request_content_type:i.request_content_type,onAdd:O,onEdit:k,onAddSub:S,ref_key:"addKeyModalRef",ref:b},null,8,["request_content_type"])])])]),_:1})}}},OH=$e(AH,[["__scopeId","data-v-0f66c576"]]),NH={class:"problem-optimization-form"},MH={class:"node-form-content"},TH={class:"gray-block"},$H={class:"gray-block-title"},PH={class:"avatar-box"},RH=["src"],BH={class:"content-box"},LH={class:"list-name"},IH={class:"list-intro"},FH=["onClick"],jH={class:"btn-block"},VH={class:"gray-block mt16"},HH={class:"gray-block-title"},UH={key:0,class:"flex-block-item"},zH={class:"form-content-box flex1"},qH={class:"field-list-item"},GH={class:"field-label"},XH={class:"field-type"},WH={key:1,class:"flex-block-item"},YH={class:"form-content-box flex1"},KH={class:"field-list-item"},JH={class:"field-label"},ZH={class:"field-type"},QH={key:2,class:"flex-block-item"},eU={class:"form-content-box flex1"},tU={class:"field-list-item"},nU={class:"field-label"},oU={class:"field-type"},iU={class:"flex-block-item"},rU={class:"form-content-box flex1"},sU={class:"field-list-item"},aU={class:"field-label"},lU={class:"field-type"},uU={class:"flex-block-item"},dU={class:"form-content-box flex1"},cU={class:"field-list-item"},fU={class:"field-label"},pU={class:"field-type"},hU={class:"flex-block-item"},vU={class:"form-item-label"},gU={class:"form-content-box flex1"},_U={class:"field-list-item"},mU={class:"field-label"},yU={class:"field-type"},bU={class:"flex-block-item"},xU={class:"form-item-label"},wU={class:"form-content-box flex1"},CU={class:"field-list-item"},SU={class:"field-label"},kU={class:"field-type"},EU={class:"gray-block mt16"},DU={class:"gray-block-title"},AU={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"导入文档内容",value:"content"},{label:"导入url",value:"url"}],r=[{label:"依然导入",value:"import"},{label:"不导入",value:"not import"},{label:"更新内容",value:"update"}],s=X({}),a=X([]),l=X([]),u=()=>{const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();B.forEach(E=>{E.tags=E.tags||[]}),a.value=B,l.value=c(B)}};function c($){function B(E){const A=[];for(const M of E)if(M.children&&M.children.length>0){const F=B(M.children);if(F.length>0){const H={...M,children:F};A.push(H)}}else M.typ&&M.typ==="array<string>"&&A.push({...M});return A}return B($)}const f=X(null),p=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),h=()=>{const $=JSON.stringify({library_import:{...p,library_id:p.library_id.join(",")}});t("update-node",{...o.node,node_params:$})},v=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).library_import||{};u(),B=JSON.parse(JSON.stringify(B));for(let E in B)E=="library_id"?p.library_id=B[E]?B[E].split(","):[]:p[E]=B[E];Cg({ability_type:"library_ability_official_account"}).then(E=>{var M;let A=(E==null?void 0:E.data)||{};((M=A==null?void 0:A.user_config)==null?void 0:M.switch_status)==1&&(f.value=A)}),setTimeout(()=>{S()},300)}catch($){}},_=Xe(()=>{let $=p.library_id[0],B=[{group_name:"未分组",id:"0"}];return $&&s.value[$]||B}),m=X([]),g=X(null),b=Xe(()=>m.value.filter($=>f.value?p.library_id.includes($.id):p.library_id.includes($.id)&&$.type!=3)),C=Xe(()=>b.value&&b.value.length?b.value[0].type:-1),D=$=>{let B=p.library_id.indexOf($.id);p.library_id.splice(B,1)},T=$=>{k(),p.library_id=[...$],p.library_group_id="0",Pt(()=>{S()})},O=()=>{g.value.open([...p.library_id])},k=async()=>{const $=await Fa({type:""});$&&(m.value=$.data||[])},S=()=>{Pt(()=>{p.library_id.length!=0&&Jm({group_type:C.value==0?1:0,library_id:p.library_id[0]}).then($=>{s.value={...s.value,[p.library_id[0]]:$.data}})})},N=($,B,E)=>{p[E]=$};gt(()=>p,()=>{h()},{deep:!0}),gt(()=>p.library_id,()=>{S()},{deep:!0});const L=()=>{t("close")};return ut(()=>{v(),k()}),($,B)=>{const E=Nn,A=Jt,M=kn,F=Vt,H=It,R=Qc,G=Qt,oe=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"将相关内容导入到对应知识库",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",NH,[d("div",MH,[y(oe,{ref:"formRef",layout:"vertical",model:p},{default:x(()=>[d("div",TH,[d("div",$H,[y(E,{name:"nav-library",style:{"font-size":"14px",color:"#333"}}),B[11]||(B[11]=z(" 知识库 ",-1))]),y(M,{label:null},{default:x(()=>[(w(!0),P(ae,null,ye(b.value,V=>(w(),P("div",{class:"konwledge-list-item",key:V.id},[d("div",PH,[d("img",{src:V.avatar,alt:""},null,8,RH)]),d("div",BH,[d("div",LH,j(V.library_name),1),d("div",IH,j(V.library_intro),1)]),d("div",{class:"btn-hover-wrap",onClick:Y=>D(V)},[y(ee(Kt))],8,FH)]))),128)),d("div",jH,[d("div",null,[y(A,{onClick:O,icon:Tt(ee(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[12]||(B[12]=[z("添加知识库",-1)])]),_:1},8,["icon"])])])]),_:1}),y(M,{label:"知识分组"},{default:x(()=>[y(H,{value:p.library_group_id,"onUpdate:value":B[0]||(B[0]=V=>p.library_group_id=V),style:{width:"100%"},placeholder:"请选择"},{default:x(()=>[(w(!0),P(ae,null,ye(_.value,V=>(w(),Z(F,{value:V.id,key:V.id},{default:x(()=>[z(j(V.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),C.value!=2&&C.value>=0?(w(),Z(M,{key:0,label:"导入类型"},{default:x(()=>[y(R,{class:"customer-segmented",value:p.import_type,"onUpdate:value":B[1]||(B[1]=V=>p.import_type=V),options:i},null,8,["value"])]),_:1})):ie("",!0),C.value==2?(w(),Z(M,{key:1,label:"分段问题重复"},{default:x(()=>[y(R,{class:"customer-segmented",value:p.qa_repeat_op,"onUpdate:value":B[2]||(B[2]=V=>p.qa_repeat_op=V),options:r},null,8,["value"])]),_:1})):ie("",!0),C.value!=2&&C.value>=0&&p.import_type=="url"?(w(),Z(M,{key:2,label:"文档URL重复"},{default:x(()=>[y(R,{class:"customer-segmented",value:p.normal_url_repeat_op,"onUpdate:value":B[3]||(B[3]=V=>p.normal_url_repeat_op=V),options:r},null,8,["value"])]),_:1})):ie("",!0)]),d("div",VH,[d("div",HH,[y(E,{name:"input",style:{"font-size":"14px",color:"#333"}}),B[13]||(B[13]=z(" 输入 ",-1))]),C.value!=2&&C.value>=0?(w(),P(ae,{key:0},[p.import_type=="content"?(w(),P("div",UH,[B[14]||(B[14]=d("div",{class:"form-item-label required"},"文档标题",-1)),d("div",zH,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_title,onOpen:u,onChange:B[4]||(B[4]=(V,Y)=>N(V,Y,"normal_title")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",qH,[d("div",GH,j(V),1),d("div",XH,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0),p.import_type=="content"?(w(),P("div",WH,[B[15]||(B[15]=d("div",{class:"form-item-label required"},"文档内容",-1)),d("div",YH,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_content,onOpen:u,onChange:B[5]||(B[5]=(V,Y)=>N(V,Y,"normal_content")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",KH,[d("div",JH,j(V),1),d("div",ZH,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0),p.import_type=="url"?(w(),P("div",QH,[B[16]||(B[16]=d("div",{class:"form-item-label"},"文档URL",-1)),d("div",eU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_url,onOpen:u,onChange:B[6]||(B[6]=(V,Y)=>N(V,Y,"normal_url")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",tU,[d("div",nU,j(V),1),d("div",oU,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0)],64)):ie("",!0),C.value==2?(w(),P(ae,{key:1},[d("div",iU,[B[17]||(B[17]=d("div",{class:"form-item-label required"},"分段问题",-1)),d("div",rU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.qa_question,onOpen:u,onChange:B[7]||(B[7]=(V,Y)=>N(V,Y,"qa_question")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",sU,[d("div",aU,j(V),1),d("div",lU,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",uU,[B[18]||(B[18]=d("div",{class:"form-item-label required"},"分段答案",-1)),d("div",dU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.qa_answer,onOpen:u,onChange:B[8]||(B[8]=(V,Y)=>N(V,Y,"qa_answer")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",cU,[d("div",fU,j(V),1),d("div",pU,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",hU,[d("div",vU,[B[19]||(B[19]=z(" 答案附图 ",-1)),y(G,{title:"图片url，<array string>格式，支持传入多个"},{default:x(()=>[y(ee(yt))]),_:1})]),d("div",gU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:p.qa_images_variable,onOpen:u,onChange:B[9]||(B[9]=(V,Y)=>N(V,Y,"qa_images_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",_U,[d("div",mU,j(V),1),d("div",yU,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",bU,[d("div",xU,[B[20]||(B[20]=z(" 相似问法 ",-1)),y(G,{title:"<array string>格式，支持传入多个"},{default:x(()=>[y(ee(yt))]),_:1})]),d("div",wU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:p.qa_similar_question_variable,onOpen:u,onChange:B[10]||(B[10]=(V,Y)=>N(V,Y,"qa_similar_question_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:V,payload:Y})=>[d("div",CU,[d("div",SU,j(V),1),d("div",kU,j(Y.typ),1)])]),_:1},8,["options","defaultValue"])])])],64)):ie("",!0)]),d("div",EU,[d("div",DU,[y(E,{name:"output",style:{"font-size":"14px",color:"#333"}}),B[21]||(B[21]=z(" 输出 ",-1))]),B[22]||(B[22]=d("div",{class:"options-item"},[d("div",{class:"option-label"},"msg"),d("div",{class:"desc"},"ok表示成功，其他输出为报错日志")],-1))])]),_:1},8,["model"]),y(Og,{ref_key:"librarySelectAlertRef",ref:g,showWxType:!!f.value,select_type:"radio",onChange:T},null,8,["showWxType"])])])]),_:1})}}},OU=$e(AU,[["__scopeId","data-v-96613b60"]]),NU={class:"sub-field-item"},MU=["onClick"],TU=["onClick"],$U={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),P(ae,null,ye(e.data,(v,_)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[d("div",NU,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:v.key,"onUpdate:value":m=>v.key=m,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(p,{class:"mr12",onChange:m=>s(v),value:v.typ,"onUpdate:value":m=>v.typ=m,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,m=>(w(),Z(f,{value:m.value},{default:x(()=>[z(j(m.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),P("div",{key:0,class:"btn-hover-wrap mr12",onClick:m=>i(_,e.data)},[y(ee(Fn))],8,MU)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:m=>r(_,e.data)},[y(ee(Kt))],8,TU)]),v.subs&&v.subs.length>0?(w(),Z(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},PU=$e($U,[["__scopeId","data-v-f24f0649"]]),RU={class:"problem-optimization-form"},BU={class:"node-form-content"},LU={class:"gray-block"},IU={class:"array-form-box"},FU={class:"gray-block mt16"},jU={class:"output-box"},VU={class:"flex-block-item",style:{gap:"12px"}},HU=["onClick"],UU={key:0,class:"sub-field-box"},zU={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const m=o.lf.getNodeModelById(o.nodeId);if(m){let g=m.getAllParentVariable();i.value=s(g)}}function s(m){function g(b){const C=[];for(const D of b)if(D.children&&D.children.length>0){const T=g(D.children);if(T.length>0){const O={...D,children:T};C.push(O)}}else D.typ&&(D.typ.startsWith("array<")||D.typ==="object")&&C.push({...D});return C}return g(m)}const a=m=>{m&&r()},l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),u=()=>{const m=JSON.stringify({json_encode:{...l}});t("update-node",{...o.node,node_params:m})},c=(m,g)=>{l.input_tags=g,l.input_variable=m},f=()=>{try{let m=o.node.dataRaw||o.node.node_params||"{}",g=JSON.parse(m).json_encode||{};g=JSON.parse(JSON.stringify(g)),r(),l.input_variable=g.input_variable,g.output.length>0&&(l.output=g.output)}catch(m){}};gt(()=>l,()=>{u()},{deep:!0});const p=m=>{m.subs=[]},h=m=>{l.output[m].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},v=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],_=()=>{t("close")};return ut(()=>{f()}),(m,g)=>{const b=ln,C=Vt,D=It,T=Vn,O=kn,k=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把变量转化为JSON字符串",onClose:_},null,8,["title","iconName"])]),default:x(()=>[d("div",RU,[d("div",BU,[y(k,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",LU,[g[2]||(g[2]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",IU,[y(ot,{options:i.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,checkAnyLevel:!0,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量",onOpen:a,onChange:g[0]||(g[0]=(S,N)=>c(S,N))},null,8,["options","defaultSelectedList","defaultValue"])])]),d("div",FU,[g[4]||(g[4]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",jU,[g[3]||(g[3]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:g[1]||(g[1]=St(()=>{},["stop"]))},[(w(!0),P(ae,null,ye(l.output,(S,N)=>(w(),P("div",{class:"form-item-list",key:N},[y(O,{label:null,name:["output",N,"key"]},{default:x(()=>[d("div",VU,[y(b,{style:{width:"214px"},value:S.key,"onUpdate:value":L=>S.key=L,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(T,null,{default:x(()=>[y(D,{onChange:L=>p(S),value:S.typ,"onUpdate:value":L=>S.typ=L,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),P(ae,null,ye(v,L=>y(C,{value:L.value,key:L.value},{default:x(()=>[z(j(L.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),S.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:L=>h(N)},[y(ee(Fn))],8,HU)):ie("",!0)]),S.subs&&S.subs.length>0?(w(),P("div",UU,[y(T,null,{default:x(()=>[y(PU,{data:S.subs,level:2,typOptions:v},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},qU=$e(zU,[["__scopeId","data-v-206a2c21"]]),GU={class:"sub-field-item"},XU=["onClick"],WU=["onClick"],YU={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),P(ae,null,ye(e.data,(v,_)=>(w(),P("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[d("div",GU,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:v.key,"onUpdate:value":m=>v.key=m,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Ro,alt:""},null,-1)),y(p,{class:"mr12",onChange:m=>s(v),value:v.typ,"onUpdate:value":m=>v.typ=m,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),P(ae,null,ye(t.value,m=>(w(),Z(f,{value:m.value},{default:x(()=>[z(j(m.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(v)?(w(),P("div",{key:0,class:"btn-hover-wrap mr12",onClick:m=>i(_,e.data)},[y(ee(Fn))],8,XU)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:m=>r(_,e.data)},[y(ee(Kt))],8,WU)]),v.subs&&v.subs.length>0?(w(),Z(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:v.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},KU=$e(YU,[["__scopeId","data-v-70b4ff87"]]),JU={class:"problem-optimization-form"},ZU={class:"node-form-content"},QU={class:"gray-block"},ez={class:"array-form-box"},tz={class:"gray-block mt16"},nz={class:"output-box"},oz={class:"flex-block-item",style:{gap:"12px"}},iz=["onClick"],rz={key:0,class:"sub-field-box"},sz={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=X([]);function r(){const m=o.lf.getNodeModelById(o.nodeId);if(m){let g=m.getAllParentVariable();i.value=s(a(g)),i.value}}function s(m){return m.forEach(g=>{g.typ=="node"?g.node_type==1?g.value="global":g.value=g.node_id:g.value=g.key,g.children&&g.children.length>0&&(g.children=s(g.children))}),m}function a(m){function g(b){const C=[];for(const D of b)if(o.node,D.children&&D.children.length>0){const T=g(D.children);if(T.length>0){const O={...D,children:T};C.push(O)}}else D.typ&&(o.node.loop_parent_key&&(D.node_type==25||D.node_type==30)?(D.typ==="object"||D.typ=="string"||D.typ=="array<object>")&&C.push({...D}):(D.typ==="object"||D.typ=="string")&&C.push({...D}));return C}return g(m)}const l=Je({input_variable:[],input_tags:[],output:[{key:"",typ:"object",subs:[]}]}),u=()=>{const m=JSON.stringify({json_decode:{...l,input_variable:l.input_variable?l.input_variable.join("."):""}});t("update-node",{...o.node,node_params:m})},c=()=>{try{let m=o.node.dataRaw||o.node.node_params||"{}",g=JSON.parse(m).json_decode||{};g=JSON.parse(JSON.stringify(g)),r(),l.input_variable=bg(g.input_variable),g.output.length>0&&(l.output=g.output)}catch(m){}};gt(()=>l,()=>{u()},{deep:!0});const f=m=>{m.subs=[]},p=m=>{l.output[m].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},h=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],v=m=>{m||r()},_=()=>{t("close")};return ut(()=>{c()}),(m,g)=>{const b=ei,C=ln,D=Vt,T=It,O=Vn,k=kn,S=wn;return w(),Z(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把JSON字符串转化为变量",onClose:_},null,8,["title","iconName"])]),default:x(()=>[d("div",JU,[d("div",ZU,[y(S,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",QU,[g[2]||(g[2]=d("div",{class:"gray-block-title"},"输入 (string格式数据)",-1)),d("div",ez,[y(b,{value:l.input_variable,"onUpdate:value":g[0]||(g[0]=N=>l.input_variable=N),onDropdownVisibleChange:v,style:{width:"400px"},options:i.value,"change-on-select":"",allowClear:!1,displayRender:({labels:N})=>N.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),d("div",tz,[g[4]||(g[4]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",nz,[g[3]||(g[3]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:g[1]||(g[1]=St(()=>{},["stop"]))},[(w(!0),P(ae,null,ye(l.output,(N,L)=>(w(),P("div",{class:"form-item-list",key:L},[y(k,{label:null,name:["output",L,"key"]},{default:x(()=>[d("div",oz,[y(C,{style:{width:"214px"},value:N.key,"onUpdate:value":$=>N.key=$,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(O,null,{default:x(()=>[y(T,{onChange:$=>f(N),value:N.typ,"onUpdate:value":$=>N.typ=$,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),P(ae,null,ye(h,$=>y(D,{value:$.value,key:$.value},{default:x(()=>[z(j($.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),N.typ=="object"?(w(),P("div",{key:0,class:"btn-hover-wrap",onClick:$=>p(L)},[y(ee(Fn))],8,iz)):ie("",!0)]),N.subs&&N.subs.length>0?(w(),P("div",rz,[y(O,null,{default:x(()=>[y(KU,{data:N.subs,level:2,typOptions:h},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},az=$e(sz,[["__scopeId","data-v-b05d954b"]]),lz=["src"],uz={class:"workflow-form"},dz={class:"node-options"},cz={class:"options-item-tit"},fz={class:"option-label"},pz={class:"option-type"},hz={class:"field-list-item"},vz={class:"field-label"},gz={class:"field-type"},_z={class:"desc"},mz={class:"node-options"},yz={class:"options-item"},bz={__name:"zm-workflow-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i=X([]),r=X([]),s=X({}),a=X([]);let l={};async function u(){var v,_;f(),l=JSON.parse(o.node.node_params),a.value=((v=l==null?void 0:l.workflow)==null?void 0:v.output)||[],s.value=((_=l==null?void 0:l.workflow)==null?void 0:_.robot_info)||{},c()}function c(){var v;ug({robot_id:(v=l==null?void 0:l.workflow)==null?void 0:v.robot_id}).then(_=>{var b,C,D;let m=To((b=_==null?void 0:_.data)==null?void 0:b.node_params),g=((C=l==null?void 0:l.workflow)==null?void 0:C.params)||[];i.value=((D=m==null?void 0:m.start)==null?void 0:D.diy_global)||[];for(let T of i.value){let O=g.find(k=>T.key==k.key);T.variable=(O==null?void 0:O.variable)||"",T.tags=Array.isArray(O==null?void 0:O.tags)?O.tags:[]}})}function f(){r.value=e().getAllParentVariable()}function p(v,_,m){v.variable=_,v.tags=m,h()}function h(){let v=JSON.parse(JSON.stringify(i.value));for(let _ of v)_.variable=String(_.variable);l.workflow.params=v,t({...o.node,node_params:JSON.stringify(l)})}return ut(()=>{u()}),(v,_)=>{const m=mo;return w(),Z(cn,null,{header:x(()=>{var g;return[y(fn,{title:n.node.node_name,desc:(g=s.value)==null?void 0:g.robot_intro},{"node-icon":x(()=>[s.value.robot_avatar?(w(),P("img",{key:0,class:"node-icon",src:s.value.robot_avatar},null,8,lz)):(w(),Z(m,{key:1,size:"small"}))]),_:1},8,["title","desc"])]}),default:x(()=>[d("div",uz,[d("div",dz,[_[0]||(_[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),z("输入")])],-1)),(w(!0),P(ae,null,ye(i.value,g=>(w(),P("div",{key:g.key,class:Ct(["options-item",{"is-required":g.required}])},[d("div",cz,[d("div",fz,j(g.name||g.key),1),d("div",pz,j(g.typ),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:g.tags,defaultValue:g.variable,ref_for:!0,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:f,onChange:(b,C)=>p(g,b,C)},{option:x(({label:b,payload:C})=>[d("div",hz,[d("div",vz,j(b),1),d("div",gz,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",_z,j(g.desc),1)],2))),128))]),d("div",mz,[_[1]||(_[1]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),z("输出")])],-1)),d("div",yz,[y(Bi,{"tree-data":a.value},null,8,["tree-data"])])])])]),_:1})}}},xz=$e(bz,[["__scopeId","data-v-66653f32"]]),wz=["width"],Cz={class:"node-form-drawer-body"},Sz=["node-key"],kz={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(n,{expose:e,emit:t}){const o={"start-node":yk,"problem-optimization-node":Qk,"ai-dialogue-node":kE,"add-data-node":a3,"knowledge-base-node":yD,"code-run-node":rA,"http-node":TO,"delete-data-node":JO,"variable-assignment-node":uN,"update-data-node":gN,"parameter-extraction-node":JN,"select-data-node":T8,"question-node":tM,"judge-node":fM,"specify-reply-node":bM,"immediately-reply-node":AM,"mcp-node":jM,"custom-group":_4,"batch-group":FI,"zm-plugins-node":a7,"session-trigger-node":b7,"timing-trigger-node":N7,"end-node":C9,"official-trigger-node":q7,"image-generation-node":CV,"voice-clone-node":PF,"voice-synthesis-node":Yj,"explain-node":OV,"webhook-trigger-node":OH,"import-library-node":OU,"json-node":qU,"json-reverse-node":az,"zm-workflow-node":xz},i=t,r=n,s=Xe({get:()=>r.open,set:g=>i("update:open",g)}),a=()=>{s.value=!1},l=Xe(()=>{var D,T,O;let g=To((D=r.node)==null?void 0:D.node_params);return((T=g==null?void 0:g.plugin)==null?void 0:T.name)=="feishu_bitable"||((O=g==null?void 0:g.plugin)==null?void 0:O.name)=="official_send_message"?600:(()=>{var L;const k=(L=g==null?void 0:g.plugin)==null?void 0:L.params;if(!k)return!1;const S=k==null?void 0:k.params;if(S&&typeof S=="object")for(const $ in S){const B=S[$];if(B&&B.date_range_begin_component)return!0}const N=k==null?void 0:k.arguments;if(N&&typeof N=="object"){const $=Object.keys(N||{});if($.includes("date_type")||$.includes("begin_date")&&$.includes("end_date"))return!0}return!1})()?640:{"delete-data-node":600,"update-data-node":600,"select-data-node":600,"judge-node":600,"custom-group":640,"timing-trigger-node":420,"batch-group":640,"webhook-trigger-node":620,"end-node":650}[r.nodeType]||480}),u=()=>r.lf.getNodeModelById(r.nodeId),c=()=>r.lf.graphModel,f=g=>{_(g)},p=g=>{i("change-title",g)},h=()=>{s.value=!1;let g=u();c().eventCenter.emit("custom:node:delete",g)};ji("lf",r.lf),ji("getNode",u),ji("getGraph",c),ji("setData",f),ji("changeTitle",p),ji("deleteNode",h),ji("close",a);const v=Xe(()=>{const g=`${r.nodeType}`;return o[g]||null}),_=g=>{g.dataRaw=g.node_params,i("update-node",g)},m=()=>{s.value=!1};return e({open}),(g,b)=>{const C=Jt,D=Ey;return w(),Z(qm,{name:"slide-right",appear:""},{default:x(()=>[s.value?(w(),P("div",{key:0,width:l.value,style:In({width:l.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:zm(m,["esc"])},[d("div",Cz,[d("div",{class:"drawer-form","node-key":r.nodeType},[v.value?(w(),Z($u(v.value),{lf:r.lf,"node-id":r.nodeId,"node-type":r.nodeType,node:r.node,key:r.nodeId,onClose:m,onUpdateNode:_},null,40,["lf","node-id","node-type","node"])):(w(),Z(D,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:x(()=>[y(C,{type:"primary",onClick:m},{default:x(()=>[...b[0]||(b[0]=[z("关闭",-1)])]),_:1})]),_:1}))],8,Sz)])],44,wz)):ie("",!0)]),_:1})}}},Ez=$e(kz,[["__scopeId","data-v-725a79e3"]]);var Hu,Gt,qg,vr,jp,Gg,Xg,Wg,gf,Kd,Jd,xa={},Yg=[],Dz=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,qa=Array.isArray;function Di(n,e){for(var t in e)n[t]=e[t];return n}function _f(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Ze(n,e,t){var o,i,r,s={};for(r in e)r=="key"?o=e[r]:r=="ref"?i=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?Hu.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)s[r]===void 0&&(s[r]=n.defaultProps[r]);return Al(n,s,o,i,null)}function Al(n,e,t,o,i){var r={type:n,props:e,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++qg,__i:-1,__u:0};return i==null&&Gt.vnode!=null&&Gt.vnode(r),r}function Uu(){return{current:null}}function cs(n){return n.children}function Yt(n,e){this.props=n,this.context=e}function fs(n,e){if(e==null)return n.__?fs(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?fs(n):null}function Kg(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return Kg(n)}}function Vp(n){(!n.__d&&(n.__d=!0)&&vr.push(n)&&!jl.__r++||jp!=Gt.debounceRendering)&&((jp=Gt.debounceRendering)||Gg)(jl)}function jl(){for(var n,e,t,o,i,r,s,a=1;vr.length;)vr.length>a&&vr.sort(Xg),n=vr.shift(),a=vr.length,n.__d&&(t=void 0,o=void 0,i=(o=(e=n).__v).__e,r=[],s=[],e.__P&&((t=Di({},o)).__v=o.__v+1,Gt.vnode&&Gt.vnode(t),mf(e.__P,t,o,e.__n,e.__P.namespaceURI,32&o.__u?[i]:null,r,i??fs(o),!!(32&o.__u),s),t.__v=o.__v,t.__.__k[t.__i]=t,Qg(r,t,s),o.__e=o.__=null,t.__e!=i&&Kg(t)));jl.__r=0}function Jg(n,e,t,o,i,r,s,a,l,u,c){var f,p,h,v,_,m,g,b=o&&o.__k||Yg,C=e.length;for(l=Az(t,e,b,l,C),f=0;f<C;f++)(h=t.__k[f])!=null&&(p=h.__i==-1?xa:b[h.__i]||xa,h.__i=f,m=mf(n,h,p,i,r,s,a,l,u,c),v=h.__e,h.ref&&p.ref!=h.ref&&(p.ref&&yf(p.ref,null,h),c.push(h.ref,h.__c||v,h)),_==null&&v!=null&&(_=v),(g=!!(4&h.__u))||p.__k===h.__k?l=Zg(h,l,n,g):typeof h.type=="function"&&m!==void 0?l=m:v&&(l=v.nextSibling),h.__u&=-7);return t.__e=_,l}function Az(n,e,t,o,i){var r,s,a,l,u,c=t.length,f=c,p=0;for(n.__k=new Array(i),r=0;r<i;r++)(s=e[r])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=n.__k[r]=Al(null,s,null,null,null):qa(s)?s=n.__k[r]=Al(cs,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=n.__k[r]=Al(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):n.__k[r]=s,l=r+p,s.__=n,s.__b=n.__b+1,(u=s.__i=Oz(s,t,l,f))!=-1&&(f--,(a=t[u])&&(a.__u|=2)),a==null||a.__v==null?(u==-1&&(i>c?p--:i<c&&p++),typeof s.type!="function"&&(s.__u|=4)):u!=l&&(u==l-1?p--:u==l+1?p++:(u>l?p--:p++,s.__u|=4))):n.__k[r]=null;if(f)for(r=0;r<c;r++)(a=t[r])!=null&&(2&a.__u)==0&&(a.__e==o&&(o=fs(a)),t_(a,a));return o}function Zg(n,e,t,o){var i,r;if(typeof n.type=="function"){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,e=Zg(i[r],e,t,o));return e}n.__e!=e&&(o&&(e&&n.type&&!e.parentNode&&(e=fs(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Vl(n,e){return e=e||[],n==null||typeof n=="boolean"||(qa(n)?n.some(function(t){Vl(t,e)}):e.push(n)),e}function Oz(n,e,t,o){var i,r,s,a=n.key,l=n.type,u=e[t],c=u!=null&&(2&u.__u)==0;if(u===null&&a==null||c&&a==u.key&&l==u.type)return t;if(o>(c?1:0)){for(i=t-1,r=t+1;i>=0||r<e.length;)if((u=e[s=i>=0?i--:r++])!=null&&(2&u.__u)==0&&a==u.key&&l==u.type)return s}return-1}function Hp(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||Dz.test(e)?t:t+"px"}function ol(n,e,t,o,i){var r,s;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof o=="string"&&(n.style.cssText=o=""),o)for(e in o)t&&e in t||Hp(n.style,e,"");if(t)for(e in t)o&&t[e]==o[e]||Hp(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(Wg,"$1")),s=e.toLowerCase(),e=s in n||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?o?t.u=o.u:(t.u=gf,n.addEventListener(e,r?Jd:Kd,r)):n.removeEventListener(e,r?Jd:Kd,r);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Up(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=gf++;else if(e.t<t.u)return;return t(Gt.event?Gt.event(e):e)}}}function mf(n,e,t,o,i,r,s,a,l,u){var c,f,p,h,v,_,m,g,b,C,D,T,O,k,S,N,L,$=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(c=Gt.__b)&&c(e);e:if(typeof $=="function")try{if(g=e.props,b="prototype"in $&&$.prototype.render,C=(c=$.contextType)&&o[c.__c],D=c?C?C.props.value:c.__:o,t.__c?m=(f=e.__c=t.__c).__=f.__E:(b?e.__c=f=new $(g,D):(e.__c=f=new Yt(g,D),f.constructor=$,f.render=Mz),C&&C.sub(f),f.state||(f.state={}),f.__n=o,p=f.__d=!0,f.__h=[],f._sb=[]),b&&f.__s==null&&(f.__s=f.state),b&&$.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=Di({},f.__s)),Di(f.__s,$.getDerivedStateFromProps(g,f.__s))),h=f.props,v=f.state,f.__v=e,p)b&&$.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),b&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(b&&$.getDerivedStateFromProps==null&&g!==h&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(g,D),e.__v==t.__v||!f.__e&&f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(g,f.__s,D)===!1){for(e.__v!=t.__v&&(f.props=g,f.state=f.__s,f.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(B){B&&(B.__=e)}),T=0;T<f._sb.length;T++)f.__h.push(f._sb[T]);f._sb=[],f.__h.length&&s.push(f);break e}f.componentWillUpdate!=null&&f.componentWillUpdate(g,f.__s,D),b&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(h,v,_)})}if(f.context=D,f.props=g,f.__P=n,f.__e=!1,O=Gt.__r,k=0,b){for(f.state=f.__s,f.__d=!1,O&&O(e),c=f.render(f.props,f.state,f.context),S=0;S<f._sb.length;S++)f.__h.push(f._sb[S]);f._sb=[]}else do f.__d=!1,O&&O(e),c=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++k<25);f.state=f.__s,f.getChildContext!=null&&(o=Di(Di({},o),f.getChildContext())),b&&!p&&f.getSnapshotBeforeUpdate!=null&&(_=f.getSnapshotBeforeUpdate(h,v)),N=c,c!=null&&c.type===cs&&c.key==null&&(N=e_(c.props.children)),a=Jg(n,qa(N)?N:[N],e,t,o,i,r,s,a,l,u),f.base=e.__e,e.__u&=-161,f.__h.length&&s.push(f),m&&(f.__E=f.__=null)}catch(B){if(e.__v=null,l||r!=null)if(B.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else{for(L=r.length;L--;)_f(r[L]);Zd(e)}else e.__e=t.__e,e.__k=t.__k,B.then||Zd(e);Gt.__e(B,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=Nz(t.__e,e,t,o,i,r,s,l,u);return(c=Gt.diffed)&&c(e),128&e.__u?void 0:a}function Zd(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Zd)}function Qg(n,e,t){for(var o=0;o<t.length;o++)yf(t[o],t[++o],t[++o]);Gt.__c&&Gt.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(r){r.call(i)})}catch(r){Gt.__e(r,i.__v)}})}function e_(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:qa(n)?n.map(e_):Di({},n)}function Nz(n,e,t,o,i,r,s,a,l){var u,c,f,p,h,v,_,m=t.props||xa,g=e.props,b=e.type;if(b=="svg"?i="http://www.w3.org/2000/svg":b=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(u=0;u<r.length;u++)if((h=r[u])&&"setAttribute"in h==!!b&&(b?h.localName==b:h.nodeType==3)){n=h,r[u]=null;break}}if(n==null){if(b==null)return document.createTextNode(g);n=document.createElementNS(i,b,g.is&&g),a&&(Gt.__m&&Gt.__m(e,r),a=!1),r=null}if(b==null)m===g||a&&n.data==g||(n.data=g);else{if(r=r&&Hu.call(n.childNodes),!a&&r!=null)for(m={},u=0;u<n.attributes.length;u++)m[(h=n.attributes[u]).name]=h.value;for(u in m)if(h=m[u],u!="children"){if(u=="dangerouslySetInnerHTML")f=h;else if(!(u in g)){if(u=="value"&&"defaultValue"in g||u=="checked"&&"defaultChecked"in g)continue;ol(n,u,null,h,i)}}for(u in g)h=g[u],u=="children"?p=h:u=="dangerouslySetInnerHTML"?c=h:u=="value"?v=h:u=="checked"?_=h:a&&typeof h!="function"||m[u]===h||ol(n,u,h,m[u],i);if(c)a||f&&(c.__html==f.__html||c.__html==n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(f&&(n.innerHTML=""),Jg(e.type=="template"?n.content:n,qa(p)?p:[p],e,t,o,b=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,s,r?r[0]:t.__k&&fs(t,0),a,l),r!=null)for(u=r.length;u--;)_f(r[u]);a||(u="value",b=="progress"&&v==null?n.removeAttribute("value"):v!=null&&(v!==n[u]||b=="progress"&&!v||b=="option"&&v!=m[u])&&ol(n,u,v,m[u],i),u="checked",_!=null&&_!=n[u]&&ol(n,u,_,m[u],i))}return n}function yf(n,e,t){try{if(typeof n=="function"){var o=typeof n.__u=="function";o&&n.__u(),o&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Gt.__e(i,t)}}function t_(n,e,t){var o,i;if(Gt.unmount&&Gt.unmount(n),(o=n.ref)&&(o.current&&o.current!=n.__e||yf(o,null,e)),(o=n.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(r){Gt.__e(r,e)}o.base=o.__P=null}if(o=n.__k)for(i=0;i<o.length;i++)o[i]&&t_(o[i],e,t||typeof n.type!="function");t||_f(n.__e),n.__c=n.__=n.__e=void 0}function Mz(n,e,t){return this.constructor(n,t)}function Tz(n,e,t){var o,i,r,s;e==document&&(e=document.documentElement),Gt.__&&Gt.__(n,e),i=(o=!1)?null:e.__k,r=[],s=[],mf(e,n=e.__k=Ze(cs,null,[n]),i||xa,xa,e.namespaceURI,i?null:e.firstChild?Hu.call(e.childNodes):null,r,i?i.__e:e.firstChild,o,s),Qg(r,n,s)}Hu=Yg.slice,Gt={__e:function(n,e,t,o){for(var i,r,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(n)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,o||{}),s=i.__d),s)return i.__E=i}catch(a){n=a}throw n}},qg=0,Yt.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Di({},this.state),typeof n=="function"&&(n=n(Di({},t),this.props)),n&&Di(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Vp(this))},Yt.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Vp(this))},Yt.prototype.render=cs,vr=[],Gg=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Xg=function(n,e){return n.__v.__b-e.__v.__b},jl.__r=0,Wg=/(PointerCapture)$|Capture$/i,gf=0,Kd=Up(!1),Jd=Up(!0);var $z="An invariant failed, however the error is obfuscated because this is a production build.",Hl=[];Object.freeze(Hl);var bf={};Object.freeze(bf);function uo(){return++mt.mobxGuid}function dn(n){throw Cr(!1,n),"X"}function Cr(n,e){if(!n)throw new Error("[mobx] "+(e||$z))}function n_(n){var e=!1;return function(){if(!e)return e=!0,n.apply(this,arguments)}}var il=function(){};function Pz(n){var e=[];return n.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function xf(n){return n!==null&&typeof n=="object"}function Ps(n){if(n===null||typeof n!="object")return!1;var e=Object.getPrototypeOf(n);return e===Object.prototype||e===null}function Rz(n){if(Bs(n)||co(n))return n;if(Array.isArray(n))return new Map(n);if(Ps(n)){var e=new Map;for(var t in n)e.set(t,n[t]);return e}else return dn("Cannot convert to map from '"+n+"'")}function Rs(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function Bz(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function Lz(n,e){var t=Object.getOwnPropertyDescriptor(n,e);return!t||t.configurable!==!1&&t.writable!==!1}function ir(n,e){var t="isMobX"+n;return e.prototype[t]=!0,function(o){return xf(o)&&o[t]===!0}}function Bs(n){return n instanceof Map}function Ga(n){return n instanceof Set}function o_(n){var e=new Set;for(var t in n)e.add(t);return Object.getOwnPropertySymbols(n).forEach(function(o){Object.getOwnPropertyDescriptor(n,o).enumerable&&e.add(o)}),Array.from(e)}function Xi(n){return n&&n.toString?n.toString():new String(n).toString()}function i_(n){return n===null?null:typeof n=="object"?""+n:n}var Iz=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Mt=Symbol("mobx administration"),Ls=(function(){function n(e){e===void 0&&(e="Atom@"+uo()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=hn.NOT_TRACKING}return n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.reportObserved=function(){return v_(this)},n.prototype.reportChanged=function(){Wo(),sq(this),Yo()},n.prototype.toString=function(){return this.name},n})(),wf=ir("Atom",Ls);function Cf(n,e,t){e===void 0&&(e=il),t===void 0&&(t=il);var o=new Ls(n);return e!==il&&yq(o,e),t!==il&&x_(o,t),o}function Fz(n,e){return M_(n,e)}function jz(n,e){return Object.is(n,e)}var ps={structural:Fz,default:jz};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Qd=function(n,e){return Qd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])},Qd(n,e)};function Vz(n,e){Qd(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ul=function(){return Ul=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++){t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},Ul.apply(this,arguments)};function fi(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}function Zr(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r}function Sf(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Zr(arguments[e]));return n}var zl=Symbol("mobx did run lazy initializers"),Ks=Symbol("mobx pending decorators"),Hz={},Uz={};function zz(n,e){var t=e?Hz:Uz;return t[n]||(t[n]={configurable:!0,enumerable:e,get:function(){return Or(this),this[n]},set:function(o){Or(this),this[n]=o}})}function Or(n){var e,t;if(n[zl]!==!0){var o=n[Ks];if(o){Rs(n,zl,!0);var i=Sf(Object.getOwnPropertySymbols(o),Object.keys(o));try{for(var r=fi(i),s=r.next();!s.done;s=r.next()){var a=s.value,l=o[a];l.propertyCreator(n,l.prop,l.descriptor,l.decoratorTarget,l.decoratorArguments)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}}}function r_(n,e){return function(){var o,i=function(s,a,l,u){if(u===!0)return e(s,a,l,s,o),null;if(!Object.prototype.hasOwnProperty.call(s,Ks)){var c=s[Ks];Rs(s,Ks,Ul({},c))}return s[Ks][a]={prop:a,propertyCreator:e,descriptor:l,decoratorTarget:s,decoratorArguments:o},zz(a,n)};return qz(arguments)?(o=Hl,i.apply(null,arguments)):(o=Array.prototype.slice.call(arguments),i)}}function qz(n){return(n.length===2||n.length===3)&&(typeof n[1]=="string"||typeof n[1]=="symbol")||n.length===4&&n[3]===!0}function Xa(n,e,t){return _s(n)?n:Array.isArray(n)?Pe.array(n,{name:t}):Ps(n)?Pe.object(n,void 0,{name:t}):Bs(n)?Pe.map(n,{name:t}):Ga(n)?Pe.set(n,{name:t}):n}function Gz(n,e,t){return n==null||ni(n)||bi(n)||co(n)||Bo(n)?n:Array.isArray(n)?Pe.array(n,{name:t,deep:!1}):Ps(n)?Pe.object(n,void 0,{name:t,deep:!1}):Bs(n)?Pe.map(n,{name:t,deep:!1}):Ga(n)?Pe.set(n,{name:t,deep:!1}):dn(!1)}function zu(n){return n}function Xz(n,e,t){return M_(n,e)?e:n}function qu(n){Cr(n);var e=r_(!0,function(o,i,r,s,a){var l=r?r.initializer?r.initializer.call(o):r.value:void 0;Of(o).addObservableProp(i,l,n)}),t=e;return t.enhancer=n,t}var s_={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(s_);function Yr(n){return n==null?s_:typeof n=="string"?{name:n,deep:!0,proxy:!0}:n}var kf=qu(Xa),Wz=qu(Gz),a_=qu(zu),Yz=qu(Xz);function rl(n){return n.defaultDecorator?n.defaultDecorator.enhancer:n.deep===!1?zu:Xa}function Kz(n,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return kf.apply(null,arguments);if(_s(n))return n;var o=Ps(n)?Pe.object(n,e,t):Array.isArray(n)?Pe.array(n,e):Bs(n)?Pe.map(n,e):Ga(n)?Pe.set(n,e):n;if(o!==n)return o;dn(!1)}var zp={box:function(n,e){arguments.length>2&&zs("box");var t=Yr(e);return new kr(n,rl(t),t.name,!0,t.equals)},array:function(n,e){arguments.length>2&&zs("array");var t=Yr(e);return Pq(n,rl(t),t.name)},map:function(n,e){arguments.length>2&&zs("map");var t=Yr(e);return new Af(n,rl(t),t.name)},set:function(n,e){arguments.length>2&&zs("set");var t=Yr(e);return new O_(n,rl(t),t.name)},object:function(n,e,t){typeof arguments[1]=="string"&&zs("object");var o=Yr(t);if(o.proxy===!1)return rc({},n,e,o);var i=C_(o),r=rc({},void 0,void 0,o),s=Mq(r);return S_(s,n,e,i),s},ref:a_,shallow:Wz,deep:kf,struct:Yz},Pe=Kz;Object.keys(zp).forEach(function(n){return Pe[n]=zp[n]});function zs(n){dn("Expected one or two arguments to observable."+n+". Did you accidentally try to use observable."+n+" as decorator?")}var ql=r_(!1,function(n,e,t,o,i){var r=t.get,s=t.set,a=i[0]||{};Of(n).addComputedProp(n,e,Ul({get:r,set:s,context:n},a))}),Jz=ql({equals:ps.structural}),mn=function(e,t,o){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return ql.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new vs(i)};mn.struct=Jz;var hn;(function(n){n[n.NOT_TRACKING=-1]="NOT_TRACKING",n[n.UP_TO_DATE=0]="UP_TO_DATE",n[n.POSSIBLY_STALE=1]="POSSIBLY_STALE",n[n.STALE=2]="STALE"})(hn||(hn={}));var hi;(function(n){n[n.NONE=0]="NONE",n[n.LOG=1]="LOG",n[n.BREAK=2]="BREAK"})(hi||(hi={}));var Gl=(function(){function n(e){this.cause=e}return n})();function Js(n){return n instanceof Gl}function ec(n){switch(n.dependenciesState){case hn.UP_TO_DATE:return!1;case hn.NOT_TRACKING:case hn.STALE:return!0;case hn.POSSIBLY_STALE:{for(var e=Ef(!0),t=Is(),o=n.observing,i=o.length,r=0;r<i;r++){var s=o[r];if(gs(s)){if(mt.disableErrorBoundaries)s.get();else try{s.get()}catch{return Ki(t),ta(e),!0}if(n.dependenciesState===hn.STALE)return Ki(t),ta(e),!0}}return d_(n),Ki(t),ta(e),!1}}}function hs(n){var e=n.observers.size>0;mt.computationDepth>0&&e&&dn(!1),!mt.allowStateChanges&&(e||mt.enforceActions==="strict")&&dn(!1)}function l_(n,e,t){var o=Ef(!0);d_(n),n.newObserving=new Array(n.observing.length+100),n.unboundDepsCount=0,n.runId=++mt.runId;var i=mt.trackingDerivation;mt.trackingDerivation=n;var r;if(mt.disableErrorBoundaries===!0)r=e.call(t);else try{r=e.call(t)}catch(s){r=new Gl(s)}return mt.trackingDerivation=i,Zz(n),ta(o),r}function Zz(n){for(var e=n.observing,t=n.observing=n.newObserving,o=hn.UP_TO_DATE,i=0,r=n.unboundDepsCount,s=0;s<r;s++){var a=t[s];a.diffValue===0&&(a.diffValue=1,i!==s&&(t[i]=a),i++),a.dependenciesState>o&&(o=a.dependenciesState)}for(t.length=i,n.newObserving=null,r=e.length;r--;){var a=e[r];a.diffValue===0&&p_(a,n),a.diffValue=0}for(;i--;){var a=t[i];a.diffValue===1&&(a.diffValue=0,rq(a,n))}o!==hn.UP_TO_DATE&&(n.dependenciesState=o,n.onBecomeStale())}function tc(n){var e=n.observing;n.observing=[];for(var t=e.length;t--;)p_(e[t],n);n.dependenciesState=hn.NOT_TRACKING}function u_(n){var e=Is();try{return n()}finally{Ki(e)}}function Is(){var n=mt.trackingDerivation;return mt.trackingDerivation=null,n}function Ki(n){mt.trackingDerivation=n}function Ef(n){var e=mt.allowStateReads;return mt.allowStateReads=n,e}function ta(n){mt.allowStateReads=n}function d_(n){if(n.dependenciesState!==hn.UP_TO_DATE){n.dependenciesState=hn.UP_TO_DATE;for(var e=n.observing,t=e.length;t--;)e[t].lowestObserverState=hn.UP_TO_DATE}}var Xl=0,Qz=1,qp=Object.getOwnPropertyDescriptor(function(){},"name");qp&&qp.configurable;function Sr(n,e,t){var o=function(){return c_(n,e,t||this,arguments)};return o.isMobxAction=!0,o}function c_(n,e,t,o){var i=eq();try{return e.apply(t,o)}catch(r){throw i.error=r,r}finally{tq(i)}}function eq(n,e,t){var o=No(),i=0,r=Is();Wo();var s=Gu(!0),a=Ef(!0),l={prevDerivation:r,prevAllowStateChanges:s,prevAllowStateReads:a,notifySpy:o,startTime:i,actionId:Qz++,parentActionId:Xl};return Xl=l.actionId,l}function tq(n){Xl!==n.actionId&&dn("invalid action stack. did you forget to finish an action?"),Xl=n.parentActionId,n.error!==void 0&&(mt.suppressReactionErrors=!0),Xu(n.prevAllowStateChanges),ta(n.prevAllowStateReads),Yo(),Ki(n.prevDerivation),n.notifySpy,mt.suppressReactionErrors=!1}function Gu(n){var e=mt.allowStateChanges;return mt.allowStateChanges=n,e}function Xu(n){mt.allowStateChanges=n}var kr=(function(n){Vz(e,n);function e(t,o,i,r,s){i===void 0&&(i="ObservableValue@"+uo()),s===void 0&&(s=ps.default);var a=n.call(this,i)||this;return a.enhancer=o,a.name=i,a.equals=s,a.hasUnreportedChange=!1,a.value=o(t,void 0,i),a}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==mt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(hs(this),vi(this)){var o=gi(this,{object:this,type:"update",newValue:t});if(!o)return mt.UNCHANGED;t=o.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?mt.UNCHANGED:t},e.prototype.setNewValue=function(t){var o=this.value;this.value=t,this.reportChanged(),Ko(this)&&Jo(this,{type:"update",object:this,newValue:t,oldValue:o})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return Wa(this,t)},e.prototype.observe=function(t,o){return o&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),Ya(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return i_(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e})(Ls),nq=ir("ObservableValue",kr),vs=(function(){function n(e){this.dependenciesState=hn.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=hn.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+uo(),this.value=new Gl(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=hi.NONE,Cr(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+uo(),e.set&&(this.setter=Sr(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?ps.structural:ps.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return n.prototype.onBecomeStale=function(){lq(this)},n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.get=function(){this.isComputing&&dn("Cycle detected in computation "+this.name+": "+this.derivation),mt.inBatch===0&&this.observers.size===0&&!this.keepAlive?ec(this)&&(this.warnAboutUntrackedRead(),Wo(),this.value=this.computeValue(!1),Yo()):(v_(this),ec(this)&&this.trackAndCompute()&&aq(this));var e=this.value;if(Js(e))throw e.cause;return e},n.prototype.peek=function(){var e=this.computeValue(!1);if(Js(e))throw e.cause;return e},n.prototype.set=function(e){if(this.setter){Cr(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else Cr(!1,!1)},n.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===hn.NOT_TRACKING,o=this.computeValue(!0),i=t||Js(e)||Js(o)||!this.equals(e,o);return i&&(this.value=o),i},n.prototype.computeValue=function(e){this.isComputing=!0,mt.computationDepth++;var t;if(e)t=l_(this,this.derivation,this.scope);else if(mt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(o){t=new Gl(o)}return mt.computationDepth--,this.isComputing=!1,t},n.prototype.suspend=function(){this.keepAlive||(tc(this),this.value=void 0)},n.prototype.observe=function(e,t){var o=this,i=!0,r=void 0;return gq(function(){var s=o.get();if(!i||t){var a=Is();e({type:"update",object:o,newValue:s,oldValue:r}),Ki(a)}i=!1,r=s})},n.prototype.warnAboutUntrackedRead=function(){},n.prototype.toJSON=function(){return this.get()},n.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},n.prototype.valueOf=function(){return i_(this.get())},n.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},n})(),gs=ir("ComputedValue",vs),Ol=(function(){function n(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return n})(),oq={};function nc(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:oq}var Nl=!0,f_=!1,mt=(function(){var n=nc();return n.__mobxInstanceCount>0&&!n.__mobxGlobals&&(Nl=!1),n.__mobxGlobals&&n.__mobxGlobals.version!==new Ol().version&&(Nl=!1),Nl?n.__mobxGlobals?(n.__mobxInstanceCount+=1,n.__mobxGlobals.UNCHANGED||(n.__mobxGlobals.UNCHANGED={}),n.__mobxGlobals):(n.__mobxInstanceCount=1,n.__mobxGlobals=new Ol):(setTimeout(function(){f_||dn("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new Ol)})();function iq(){(mt.pendingReactions.length||mt.inBatch||mt.isRunningReactions)&&dn("isolateGlobalState should be called before MobX is running any reactions"),f_=!0,Nl&&(--nc().__mobxInstanceCount===0&&(nc().__mobxGlobals=void 0),mt=new Ol)}function oc(){return mt}function rq(n,e){n.observers.add(e),n.lowestObserverState>e.dependenciesState&&(n.lowestObserverState=e.dependenciesState)}function p_(n,e){n.observers.delete(e),n.observers.size===0&&h_(n)}function h_(n){n.isPendingUnobservation===!1&&(n.isPendingUnobservation=!0,mt.pendingUnobservations.push(n))}function Wo(){mt.inBatch++}function Yo(){if(--mt.inBatch===0){m_();for(var n=mt.pendingUnobservations,e=0;e<n.length;e++){var t=n[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof vs&&t.suspend())}mt.pendingUnobservations=[]}}function v_(n){var e=mt.trackingDerivation;return e!==null?(e.runId!==n.lastAccessedBy&&(n.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=n,n.isBeingObserved||(n.isBeingObserved=!0,n.onBecomeObserved())),!0):(n.observers.size===0&&mt.inBatch>0&&h_(n),!1)}function sq(n){n.lowestObserverState!==hn.STALE&&(n.lowestObserverState=hn.STALE,n.observers.forEach(function(e){e.dependenciesState===hn.UP_TO_DATE&&(e.isTracing!==hi.NONE&&g_(e,n),e.onBecomeStale()),e.dependenciesState=hn.STALE}))}function aq(n){n.lowestObserverState!==hn.STALE&&(n.lowestObserverState=hn.STALE,n.observers.forEach(function(e){e.dependenciesState===hn.POSSIBLY_STALE?e.dependenciesState=hn.STALE:e.dependenciesState===hn.UP_TO_DATE&&(n.lowestObserverState=hn.UP_TO_DATE)}))}function lq(n){n.lowestObserverState===hn.UP_TO_DATE&&(n.lowestObserverState=hn.POSSIBLY_STALE,n.observers.forEach(function(e){e.dependenciesState===hn.UP_TO_DATE&&(e.dependenciesState=hn.POSSIBLY_STALE,e.isTracing!==hi.NONE&&g_(e,n),e.onBecomeStale())}))}function g_(n,e){if(""+n.name+e.name,n.isTracing===hi.BREAK){var t=[];__(xq(n),t,1),new Function(`debugger;
/*
Tracing '`+n.name+`'

You are entering this break point because derivation '`+n.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(n instanceof vs?n.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function __(n,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+n.name),n.dependencies&&n.dependencies.forEach(function(o){return __(o,e,t+1)})}var wa=(function(){function n(e,t,o,i){e===void 0&&(e="Reaction@"+uo()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=o,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=hn.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+uo(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=hi.NONE}return n.prototype.onBecomeStale=function(){this.schedule()},n.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,mt.pendingReactions.push(this),m_())},n.prototype.isScheduled=function(){return this._isScheduled},n.prototype.runReaction=function(){if(!this.isDisposed){if(Wo(),this._isScheduled=!1,ec(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&No()}catch(e){this.reportExceptionInDerivation(e)}}Yo()}},n.prototype.track=function(e){if(!this.isDisposed){Wo(),this._isRunning=!0;var t=l_(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&tc(this),Js(t)&&this.reportExceptionInDerivation(t.cause),Yo()}},n.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(mt.disableErrorBoundaries)throw e;var o="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";mt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(o,e),mt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(Wo(),tc(this),Yo()))},n.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[Mt]=this,e},n.prototype.toString=function(){return"Reaction["+this.name+"]"},n.prototype.trace=function(e){e===void 0&&(e=!1),Aq(this,e)},n})(),Gp=100,ic=function(n){return n()};function m_(){mt.inBatch>0||mt.isRunningReactions||ic(uq)}function uq(){mt.isRunningReactions=!0;for(var n=mt.pendingReactions,e=0;n.length>0;){++e===Gp&&(console.error("Reaction doesn't converge to a stable state after "+Gp+" iterations."+(" Probably there is a cycle in the reactive function: "+n[0])),n.splice(0));for(var t=n.splice(0),o=0,i=t.length;o<i;o++)t[o].runReaction()}mt.isRunningReactions=!1}var Wl=ir("Reaction",wa);function dq(n){var e=ic;ic=function(t){return n(function(){return e(t)})}}function No(){return!1}function cq(n){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function fq(){dn(!1)}function Xp(n){return function(e,t,o){if(o){if(o.value)return{value:Sr(n,o.value),enumerable:!1,configurable:!0,writable:!0};var i=o.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return Sr(n,i.call(this))}}}return pq(n).apply(this,arguments)}}function pq(n){return function(e,t,o){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){Rs(this,t,Te(n,i))}})}}function hq(n,e,t,o){return o===!0?(hd(n,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return hd(this,e,t.value||t.initializer.call(this)),this[e]},set:fq}:{enumerable:!1,configurable:!0,set:function(i){hd(this,e,i)},get:function(){}}}var Te=function(e,t,o,i){if(arguments.length===1&&typeof e=="function")return Sr(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return Sr(e,t);if(arguments.length===1&&typeof e=="string")return Xp(e);if(i===!0)Rs(e,t,Sr(e.name||t,o.value,this));else return Xp(t).apply(null,arguments)};Te.bound=hq;function vq(n,e){var t=typeof n=="string"?n:n.name||"<unnamed action>",o=typeof n=="function"?n:e;return c_(t,o,this,void 0)}function hd(n,e,t){Rs(n,e,Sr(e,t.bind(n)))}function gq(n,e){e===void 0&&(e=bf);var t=e&&e.name||n.name||"Autorun@"+uo(),o=!e.scheduler&&!e.delay,i;if(o)i=new wa(t,function(){this.track(a)},e.onError,e.requiresObservable);else{var r=y_(e),s=!1;i=new wa(t,function(){s||(s=!0,r(function(){s=!1,i.isDisposed||i.track(a)}))},e.onError,e.requiresObservable)}function a(){n(i)}return i.schedule(),i.getDisposer()}var _q=function(n){return n()};function y_(n){return n.scheduler?n.scheduler:n.delay?function(e){return setTimeout(e,n.delay)}:_q}function b_(n,e,t){t===void 0&&(t=bf);var o=t.name||"Reaction@"+uo(),i=Te(o,t.onError?mq(t.onError,e):e),r=!t.scheduler&&!t.delay,s=y_(t),a=!0,l=!1,u,c=t.compareStructural?ps.structural:t.equals||ps.default,f=new wa(o,function(){a||r?p():l||(l=!0,s(p))},t.onError,t.requiresObservable);function p(){if(l=!1,!f.isDisposed){var h=!1;f.track(function(){var v=n(f);h=a||!c(u,v),u=v}),a&&t.fireImmediately&&i(u,f),!a&&h===!0&&i(u,f),a&&(a=!1)}}return f.schedule(),f.getDisposer()}function mq(n,e){return function(){try{return e.apply(this,arguments)}catch(t){n.call(this,t)}}}function yq(n,e,t){return w_("onBecomeObserved",n,e)}function x_(n,e,t){return w_("onBecomeUnobserved",n,e)}function w_(n,e,t,o){var i=Qi(e),r=t,s=n+"Listeners";i[s]?i[s].add(r):i[s]=new Set([r]);var a=i[n];return typeof a!="function"?dn(!1):function(){var l=i[s];l&&(l.delete(r),l.size===0&&delete i[s])}}function bq(n){var e=n.enforceActions,t=n.computedRequiresReaction,o=n.computedConfigurable,i=n.disableErrorBoundaries,r=n.reactionScheduler,s=n.reactionRequiresObservable,a=n.observableRequiresReaction;if(iq(),e!==void 0){var l=void 0;switch(e){case!0:case"observed":l=!0;break;case!1:case"never":l=!1;break;case"strict":case"always":l="strict";break;default:dn("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}mt.enforceActions=l,mt.allowStateChanges=!(l===!0||l==="strict")}t!==void 0&&(mt.computedRequiresReaction=!!t),s!==void 0&&(mt.reactionRequiresObservable=!!s),a!==void 0&&(mt.observableRequiresReaction=!!a,mt.allowStateReads=!mt.observableRequiresReaction),o!==void 0&&(mt.computedConfigurable=!!o),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),mt.disableErrorBoundaries=!!i),r&&dq(r)}function rc(n,e,t,o){o=Yr(o);var i=C_(o);return Or(n),Of(n,o.name,i.enhancer),e&&S_(n,e,t,i),n}function C_(n){return n.defaultDecorator||(n.deep===!1?a_:kf)}function S_(n,e,t,o){var i,r,s,a,l,u;Wo();try{var s=Iz(e);try{for(var c=fi(s),f=c.next();!f.done;f=c.next()){var u=f.value,p=Object.getOwnPropertyDescriptor(e,u),h=t&&u in t?t[u]:p.get?ql:o,v=h(n,u,p,!0);v&&Object.defineProperty(n,u,v)}}catch(m){i={error:m}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}finally{Yo()}}function xq(n,e){return k_(Qi(n,e))}function k_(n){var e={name:n.name};return n.observing&&n.observing.length>0&&(e.dependencies=Pz(n.observing).map(k_)),e}function E_(n,e){if(n==null)return!1;if(e!==void 0){if(ni(n)===!1||!n[Mt].values.has(e))return!1;var t=Qi(n,e);return gs(t)}return gs(n)}function wq(n){return arguments.length>1?dn(!1):E_(n)}function Wp(n,e){return typeof e!="string"?dn(!1):E_(n,e)}function Cq(n,e){return n==null?!1:ni(n)||!!n[Mt]||wf(n)||Wl(n)||gs(n)}function _s(n){return arguments.length!==1&&dn(!1),Cq(n)}function ms(n){return ni(n)?n[Mt].getKeys():co(n)||Bo(n)?Array.from(n.keys()):bi(n)?n.map(function(e,t){return t}):dn(!1)}function Sq(n){return ni(n)?ms(n).map(function(e){return n[e]}):co(n)?ms(n).map(function(e){return n.get(e)}):Bo(n)?Array.from(n.values()):bi(n)?n.slice():dn(!1)}function kq(n){return ni(n)?ms(n).map(function(e){return[e,n[e]]}):co(n)?ms(n).map(function(e){return[e,n.get(e)]}):Bo(n)?Array.from(n.entries()):bi(n)?n.map(function(e,t){return[t,e]}):dn(!1)}function Df(n,e,t){if(arguments.length===2&&!Bo(n)){Wo();var o=e;try{for(var i in o)Df(n,i,o[i])}finally{Yo()}return}if(ni(n)){var r=n[Mt],s=r.values.get(e);s?r.write(e,t):r.addObservableProp(e,t,r.defaultEnhancer)}else if(co(n))n.set(e,t);else if(Bo(n))n.add(e);else if(bi(n))typeof e!="number"&&(e=parseInt(e,10)),Cr(e>=0,"Not a valid index: '"+e+"'"),Wo(),e>=n.length&&(n.length=e+1),n[e]=t,Yo();else return dn(!1)}function D_(n,e,t,o){return Eq(n,e,t)}function Eq(n,e,t){return Wu(n).observe(e,t)}var Dq={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function jr(n,e,t,o){return o.detectCycles&&n.set(e,t),t}function Vi(n,e,t){if(!e.recurseEverything&&!_s(n)||typeof n!="object")return n;if(n===null)return null;if(n instanceof Date)return n;if(nq(n))return Vi(n.get(),e,t);_s(n)&&ms(n);var o=e.detectCycles===!0;if(o&&n!==null&&t.has(n))return t.get(n);if(bi(n)||Array.isArray(n)){var i=jr(t,n,[],e),r=n.map(function(h){return Vi(h,e,t)});i.length=r.length;for(var s=0,a=r.length;s<a;s++)i[s]=r[s];return i}if(Bo(n)||Object.getPrototypeOf(n)===Set.prototype)if(e.exportMapsAsObjects===!1){var l=jr(t,n,new Set,e);return n.forEach(function(h){l.add(Vi(h,e,t))}),l}else{var u=jr(t,n,[],e);return n.forEach(function(h){u.push(Vi(h,e,t))}),u}if(co(n)||Object.getPrototypeOf(n)===Map.prototype)if(e.exportMapsAsObjects===!1){var c=jr(t,n,new Map,e);return n.forEach(function(h,v){c.set(v,Vi(h,e,t))}),c}else{var f=jr(t,n,{},e);return n.forEach(function(h,v){f[v]=Vi(h,e,t)}),f}var p=jr(t,n,{},e);return o_(n).forEach(function(h){p[h]=Vi(n[h],e,t)}),p}function Uo(n,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=Dq),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),Vi(n,e,t)}function Aq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=!1;typeof n[n.length-1]=="boolean"&&(t=n.pop());var o=Oq(n);if(!o)return dn(!1);o.isTracing===hi.NONE&&""+o.name,o.isTracing=t?hi.BREAK:hi.LOG}function Oq(n){switch(n.length){case 0:return mt.trackingDerivation;case 1:return Qi(n[0]);case 2:return Qi(n[0],n[1])}}function Go(n,e){e===void 0&&(e=void 0),Wo();try{return n.apply(e)}finally{Yo()}}function sl(n){return n[Mt]}function al(n){return typeof n=="string"||typeof n=="number"||typeof n=="symbol"}var Nq={has:function(n,e){if(e===Mt||e==="constructor"||e===zl)return!0;var t=sl(n);return al(e)?t.has(e):e in n},get:function(n,e){if(e===Mt||e==="constructor"||e===zl)return n[e];var t=sl(n),o=t.values.get(e);if(o instanceof Ls){var i=o.get();return i===void 0&&t.has(e),i}return al(e)&&t.has(e),n[e]},set:function(n,e,t){return al(e)?(Df(n,e,t),!0):!1},deleteProperty:function(n,e){if(!al(e))return!1;var t=sl(n);return t.remove(e),!0},ownKeys:function(n){var e=sl(n);return e.keysAtom.reportObserved(),Reflect.ownKeys(n)},preventExtensions:function(n){return dn("Dynamic observable objects cannot be frozen"),!1}};function Mq(n){var e=new Proxy(n,Nq);return n[Mt].proxy=e,e}function vi(n){return n.interceptors!==void 0&&n.interceptors.length>0}function Wa(n,e){var t=n.interceptors||(n.interceptors=[]);return t.push(e),n_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function gi(n,e){var t=Is();try{for(var o=Sf(n.interceptors||[]),i=0,r=o.length;i<r&&(e=o[i](e),Cr(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{Ki(t)}}function Ko(n){return n.changeListeners!==void 0&&n.changeListeners.length>0}function Ya(n,e){var t=n.changeListeners||(n.changeListeners=[]);return t.push(e),n_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function Jo(n,e){var t=Is(),o=n.changeListeners;if(o){o=o.slice();for(var i=0,r=o.length;i<r;i++)o[i](e);Ki(t)}}var Tq=1e4,$q={get:function(n,e){return e===Mt?n[Mt]:e==="length"?n[Mt].getArrayLength():typeof e=="number"?Ei.get.call(n,e):typeof e=="string"&&!isNaN(e)?Ei.get.call(n,parseInt(e)):Ei.hasOwnProperty(e)?Ei[e]:n[e]},set:function(n,e,t){return e==="length"&&n[Mt].setArrayLength(t),typeof e=="number"&&Ei.set.call(n,e,t),typeof e=="symbol"||isNaN(e)?n[e]=t:Ei.set.call(n,parseInt(e),t),!0},preventExtensions:function(n){return dn("Observable arrays cannot be frozen"),!1}};function Pq(n,e,t,o){t===void 0&&(t="ObservableArray@"+uo()),o===void 0&&(o=!1);var i=new A_(t,e,o);Bz(i.values,Mt,i);var r=new Proxy(i.values,$q);if(i.proxy=r,n&&n.length){var s=Gu(!0);i.spliceWithArray(0,0,n),Xu(s)}return r}var A_=(function(){function n(e,t,o){this.owned=o,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new Ls(e||"ObservableArray@"+uo()),this.enhancer=function(i,r){return t(i,r,e+"[..]")}}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},n.prototype.intercept=function(e){return Wa(this,e)},n.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),Ya(this,e)},n.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},n.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var o=new Array(e-t),i=0;i<e-t;i++)o[i]=void 0;this.spliceWithArray(t,0,o)}else this.spliceWithArray(e,t-e)},n.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},n.prototype.spliceWithArray=function(e,t,o){var i=this;hs(this.atom);var r=this.values.length;if(e===void 0?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),arguments.length===1?t=r-e:t==null?t=0:t=Math.max(0,Math.min(t,r-e)),o===void 0&&(o=Hl),vi(this)){var s=gi(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:o});if(!s)return Hl;t=s.removedCount,o=s.added}o=o.length===0?o:o.map(function(l){return i.enhancer(l,void 0)});var a=this.spliceItemsIntoValues(e,t,o);return(t!==0||o.length!==0)&&this.notifyArraySplice(e,o,a),this.dehanceValues(a)},n.prototype.spliceItemsIntoValues=function(e,t,o){var i;if(o.length<Tq)return(i=this.values).splice.apply(i,Sf([e,t],o));var r=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(o,this.values.slice(e+t)),r},n.prototype.notifyArrayChildUpdate=function(e,t,o){var i=!this.owned&&No(),r=Ko(this),s=r||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:o}:null;this.atom.reportChanged(),r&&Jo(this,s)},n.prototype.notifyArraySplice=function(e,t,o){var i=!this.owned&&No(),r=Ko(this),s=r||i?{object:this.proxy,type:"splice",index:e,removed:o,added:t,removedCount:o.length,addedCount:t.length}:null;this.atom.reportChanged(),r&&Jo(this,s)},n})(),Ei={intercept:function(n){return this[Mt].intercept(n)},observe:function(n,e){e===void 0&&(e=!1);var t=this[Mt];return t.observe(n,e)},clear:function(){return this.splice(0)},replace:function(n){var e=this[Mt];return e.spliceWithArray(0,e.values.length,n)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(n,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var i=this[Mt];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(n);case 2:return i.spliceWithArray(n,e)}return i.spliceWithArray(n,e,t)},spliceWithArray:function(n,e,t){var o=this[Mt];return o.spliceWithArray(n,e,t)},push:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Mt];return t.spliceWithArray(t.values.length,0,n),t.values.length},pop:function(){return this.splice(Math.max(this[Mt].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Mt];return t.spliceWithArray(0,0,n),t.values.length},reverse:function(){var n=this.slice();return n.reverse.apply(n,arguments)},sort:function(n){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(n){var e=this[Mt],t=e.dehanceValues(e.values).indexOf(n);return t>-1?(this.splice(t,1),!0):!1},get:function(n){var e=this[Mt];if(e){if(n<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[n]);console.warn("[mobx.array] Attempt to read an array index ("+n+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(n,e){var t=this[Mt],o=t.values;if(n<o.length){hs(t.atom);var i=o[n];if(vi(t)){var r=gi(t,{type:"update",object:t.proxy,index:n,newValue:e});if(!r)return;e=r.newValue}e=t.enhancer(e,i);var s=e!==i;s&&(o[n]=e,t.notifyArrayChildUpdate(n,e,i))}else if(n===o.length)t.spliceWithArray(n,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+n+" is larger than "+o.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Ei[n]=function(){var e=this[Mt];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[n].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Ei[n]=function(e,t){var o=this,i=this[Mt];i.atom.reportObserved();var r=i.dehanceValues(i.values);return r[n](function(s,a){return e.call(t,s,a,o)},t)})});["reduce","reduceRight"].forEach(function(n){Ei[n]=function(){var e=this,t=this[Mt];t.atom.reportObserved();var o=arguments[0];return arguments[0]=function(i,r,s){return r=t.dehanceValue(r),o(i,r,s,e)},t.values[n].apply(t.values,arguments)}});var Rq=ir("ObservableArrayAdministration",A_);function bi(n){return xf(n)&&Rq(n[Mt])}var Yp,Bq={},Af=(function(){function n(e,t,o){if(t===void 0&&(t=Xa),o===void 0&&(o="ObservableMap@"+uo()),this.enhancer=t,this.name=o,this[Yp]=Bq,this._keysAtom=Cf(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return n.prototype._has=function(e){return this._data.has(e)},n.prototype.has=function(e){var t=this;if(!mt.trackingDerivation)return this._has(e);var o=this._hasMap.get(e);if(!o){var i=o=new kr(this._has(e),zu,this.name+"."+Xi(e)+"?",!1);this._hasMap.set(e,i),x_(i,function(){return t._hasMap.delete(e)})}return o.get()},n.prototype.set=function(e,t){var o=this._has(e);if(vi(this)){var i=gi(this,{type:o?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return o?this._updateValue(e,t):this._addValue(e,t),this},n.prototype.delete=function(e){var t=this;if(hs(this._keysAtom),vi(this)){var o=gi(this,{type:"delete",object:this,name:e});if(!o)return!1}if(this._has(e)){var i=No(),r=Ko(this),o=r||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return Go(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var a=t._data.get(e);a.setNewValue(void 0),t._data.delete(e)}),r&&Jo(this,o),!0}return!1},n.prototype._updateHasMapEntry=function(e,t){var o=this._hasMap.get(e);o&&o.setNewValue(t)},n.prototype._updateValue=function(e,t){var o=this._data.get(e);if(t=o.prepareNewValue(t),t!==mt.UNCHANGED){var i=No(),r=Ko(this),s=r||i?{type:"update",object:this,oldValue:o.value,name:e,newValue:t}:null;o.setNewValue(t),r&&Jo(this,s)}},n.prototype._addValue=function(e,t){var o=this;hs(this._keysAtom),Go(function(){var a=new kr(t,o.enhancer,o.name+"."+Xi(e),!1);o._data.set(e,a),t=a.value,o._updateHasMapEntry(e,!0),o._keysAtom.reportChanged()});var i=No(),r=Ko(this),s=r||i?{type:"add",object:this,name:e,newValue:t}:null;r&&Jo(this,s)},n.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},n.prototype.values=function(){var e=this,t=this.keys();return Yl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:e.get(r)}}})},n.prototype.entries=function(){var e=this,t=this.keys();return Yl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:[r,e.get(r)]}}})},n.prototype[Yp=Mt,Symbol.iterator]=function(){return this.entries()},n.prototype.forEach=function(e,t){var o,i;try{for(var r=fi(this),s=r.next();!s.done;s=r.next()){var a=Zr(s.value,2),l=a[0],u=a[1];e.call(t,u,l,this)}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},n.prototype.merge=function(e){var t=this;return co(e)&&(e=e.toJS()),Go(function(){var o=Gu(!0);try{Ps(e)?o_(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var r=Zr(i,2),s=r[0],a=r[1];return t.set(s,a)}):Bs(e)?(e.constructor!==Map&&dn("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,r){return t.set(r,i)})):e!=null&&dn("Cannot initialize map from "+e)}finally{Xu(o)}}),this},n.prototype.clear=function(){var e=this;Go(function(){u_(function(){var t,o;try{for(var i=fi(e.keys()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.replace=function(e){var t=this;return Go(function(){var o,i,r,s,a=Rz(e),l=new Map,u=!1;try{for(var c=fi(t._data.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;if(!a.has(p)){var h=t.delete(p);if(h)u=!0;else{var v=t._data.get(p);l.set(p,v)}}}}catch(S){o={error:S}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}try{for(var _=fi(a.entries()),m=_.next();!m.done;m=_.next()){var g=Zr(m.value,2),p=g[0],v=g[1],b=t._data.has(p);if(t.set(p,v),t._data.has(p)){var C=t._data.get(p);l.set(p,C),b||(u=!0)}}}catch(S){r={error:S}}finally{try{m&&!m.done&&(s=_.return)&&s.call(_)}finally{if(r)throw r.error}}if(!u)if(t._data.size!==l.size)t._keysAtom.reportChanged();else for(var D=t._data.keys(),T=l.keys(),O=D.next(),k=T.next();!O.done;){if(O.value!==k.value){t._keysAtom.reportChanged();break}O=D.next(),k=T.next()}t._data=l}),this},Object.defineProperty(n.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.toPOJO=function(){var e,t,o={};try{for(var i=fi(this),r=i.next();!r.done;r=i.next()){var s=Zr(r.value,2),a=s[0],l=s[1];o[typeof a=="symbol"?a:Xi(a)]=l}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n.prototype.toJS=function(){return new Map(this)},n.prototype.toJSON=function(){return this.toPOJO()},n.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return Xi(t)+": "+(""+e.get(t))}).join(", ")+" }]"},n.prototype.observe=function(e,t){return Ya(this,e)},n.prototype.intercept=function(e){return Wa(this,e)},n})(),co=ir("ObservableMap",Af),Kp,Lq={},O_=(function(){function n(e,t,o){if(t===void 0&&(t=Xa),o===void 0&&(o="ObservableSet@"+uo()),this.name=o,this[Kp]=Lq,this._data=new Set,this._atom=Cf(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,r){return t(i,r,o)},e&&this.replace(e)}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.clear=function(){var e=this;Go(function(){u_(function(){var t,o;try{for(var i=fi(e._data.values()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.forEach=function(e,t){var o,i;try{for(var r=fi(this),s=r.next();!s.done;s=r.next()){var a=s.value;e.call(t,a,a,this)}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},Object.defineProperty(n.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.add=function(e){var t=this;if(hs(this._atom),vi(this)){var o=gi(this,{type:"add",object:this,newValue:e});if(!o)return this}if(!this.has(e)){Go(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=No(),r=Ko(this),o=r||i?{type:"add",object:this,newValue:e}:null;r&&Jo(this,o)}return this},n.prototype.delete=function(e){var t=this;if(vi(this)){var o=gi(this,{type:"delete",object:this,oldValue:e});if(!o)return!1}if(this.has(e)){var i=No(),r=Ko(this),o=r||i?{type:"delete",object:this,oldValue:e}:null;return Go(function(){t._atom.reportChanged(),t._data.delete(e)}),r&&Jo(this,o),!0}return!1},n.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},n.prototype.entries=function(){var e=0,t=Array.from(this.keys()),o=Array.from(this.values());return Yl({next:function(){var i=e;return e+=1,i<o.length?{value:[t[i],o[i]],done:!1}:{done:!0}}})},n.prototype.keys=function(){return this.values()},n.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,o=Array.from(this._data.values());return Yl({next:function(){return t<o.length?{value:e.dehanceValue(o[t++]),done:!1}:{done:!0}}})},n.prototype.replace=function(e){var t=this;return Bo(e)&&(e=e.toJS()),Go(function(){var o=Gu(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):Ga(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&dn("Cannot initialize set from "+e)}finally{Xu(o)}}),this},n.prototype.observe=function(e,t){return Ya(this,e)},n.prototype.intercept=function(e){return Wa(this,e)},n.prototype.toJS=function(){return new Set(this)},n.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},n.prototype[Kp=Mt,Symbol.iterator]=function(){return this.values()},n})(),Bo=ir("ObservableSet",O_),N_=(function(){function n(e,t,o,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=o,this.defaultEnhancer=i,this.keysAtom=new Ls(o+".keys")}return n.prototype.read=function(e){return this.values.get(e).get()},n.prototype.write=function(e,t){var o=this.target,i=this.values.get(e);if(i instanceof vs){i.set(t);return}if(vi(this)){var r=gi(this,{type:"update",object:this.proxy||o,name:e,newValue:t});if(!r)return;t=r.newValue}if(t=i.prepareNewValue(t),t!==mt.UNCHANGED){var s=Ko(this),a=No(),r=s||a?{type:"update",object:this.proxy||o,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),s&&Jo(this,r)}},n.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),o=t.get(e);if(o)return o.get();var i=!!this.values.get(e);return o=new kr(i,zu,this.name+"."+Xi(e)+"?",!1),t.set(e,o),o.get()},n.prototype.addObservableProp=function(e,t,o){o===void 0&&(o=this.defaultEnhancer);var i=this.target;if(vi(this)){var r=gi(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!r)return;t=r.newValue}var s=new kr(t,o,this.name+"."+Xi(e),!1);this.values.set(e,s),t=s.value,Object.defineProperty(i,e,Iq(e)),this.notifyPropertyAddition(e,t)},n.prototype.addComputedProp=function(e,t,o){var i=this.target;o.name=o.name||this.name+"."+Xi(t),this.values.set(t,new vs(o)),(e===i||Lz(e,t))&&Object.defineProperty(e,t,Fq(t))},n.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(vi(this)){var o=gi(this,{object:this.proxy||t,name:e,type:"remove"});if(!o)return}try{Wo();var i=Ko(this),r=No(),s=this.values.get(e),a=s&&s.get();if(s&&s.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var l=this.pendingKeys.get(e);l&&l.set(!1)}delete this.target[e];var o=i||r?{type:"remove",object:this.proxy||t,oldValue:a,name:e}:null;i&&Jo(this,o)}finally{Yo()}}},n.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},n.prototype.observe=function(e,t){return Ya(this,e)},n.prototype.intercept=function(e){return Wa(this,e)},n.prototype.notifyPropertyAddition=function(e,t){var o=Ko(this),i=No(),r=o||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(o&&Jo(this,r),this.pendingKeys){var s=this.pendingKeys.get(e);s&&s.set(!0)}this.keysAtom.reportChanged()},n.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var o=[];try{for(var i=fi(this.values),r=i.next();!r.done;r=i.next()){var s=Zr(r.value,2),a=s[0],l=s[1];l instanceof kr&&o.push(a)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n})();function Of(n,e,t){if(e===void 0&&(e=""),t===void 0&&(t=Xa),Object.prototype.hasOwnProperty.call(n,Mt))return n[Mt];Ps(n)||(e=(n.constructor.name||"ObservableObject")+"@"+uo()),e||(e="ObservableObject@"+uo());var o=new N_(n,new Map,Xi(e),t);return Rs(n,Mt,o),o}var Jp=Object.create(null),Zp=Object.create(null);function Iq(n){return Jp[n]||(Jp[n]={configurable:!0,enumerable:!0,get:function(){return this[Mt].read(n)},set:function(e){this[Mt].write(n,e)}})}function Qp(n){var e=n[Mt];return e||(Or(n),n[Mt])}function Fq(n){return Zp[n]||(Zp[n]={configurable:mt.computedConfigurable,enumerable:!1,get:function(){return Qp(this).read(n)},set:function(e){Qp(this).write(n,e)}})}var jq=ir("ObservableObjectAdministration",N_);function ni(n){return xf(n)?(Or(n),jq(n[Mt])):!1}function Qi(n,e){if(typeof n=="object"&&n!==null){if(bi(n))return e!==void 0&&dn(!1),n[Mt].atom;if(Bo(n))return n[Mt];if(co(n)){var t=n;if(e===void 0)return t._keysAtom;var o=t._data.get(e)||t._hasMap.get(e);return o||dn(!1),o}if(Or(n),e&&!n[Mt]&&n[e],ni(n)){if(!e)return dn(!1);var o=n[Mt].values.get(e);return o||dn(!1),o}if(wf(n)||gs(n)||Wl(n))return n}else if(typeof n=="function"&&Wl(n[Mt]))return n[Mt];return dn(!1)}function Wu(n,e){if(n||dn("Expecting some object"),e!==void 0)return Wu(Qi(n,e));if(wf(n)||gs(n)||Wl(n)||co(n)||Bo(n))return n;if(Or(n),n[Mt])return n[Mt];dn(!1)}function Vq(n,e){var t;return e!==void 0?t=Qi(n,e):ni(n)||co(n)||Bo(n)?t=Wu(n):t=Qi(n),t.name}var eh=Object.prototype.toString;function M_(n,e,t){return t===void 0&&(t=-1),sc(n,e,t)}function sc(n,e,t,o,i){if(n===e)return n!==0||1/n===1/e;if(n==null||e==null)return!1;if(n!==n)return e!==e;var r=typeof n;if(r!=="function"&&r!=="object"&&typeof e!="object")return!1;var s=eh.call(n);if(s!==eh.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+n==""+e;case"[object Number]":return+n!=+n?+e!=+e:+n==0?1/+n===1/e:+n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(n)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}n=th(n),e=th(e);var a=s==="[object Array]";if(!a){if(typeof n!="object"||typeof e!="object")return!1;var l=n.constructor,u=e.constructor;if(l!==u&&!(typeof l=="function"&&l instanceof l&&typeof u=="function"&&u instanceof u)&&"constructor"in n&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),o=o||[],i=i||[];for(var c=o.length;c--;)if(o[c]===n)return i[c]===e;if(o.push(n),i.push(e),a){if(c=n.length,c!==e.length)return!1;for(;c--;)if(!sc(n[c],e[c],t-1,o,i))return!1}else{var f=Object.keys(n),p=void 0;if(c=f.length,Object.keys(e).length!==c)return!1;for(;c--;)if(p=f[c],!(Hq(e,p)&&sc(n[p],e[p],t-1,o,i)))return!1}return o.pop(),i.pop(),!0}function th(n){return bi(n)?n.slice():Bs(n)||co(n)||Ga(n)||Bo(n)?Array.from(n.entries()):n}function Hq(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Yl(n){return n[Symbol.iterator]=Uq,n}function Uq(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:cq,extras:{getDebugName:Vq},$mobx:Mt});function zq(n){return!(n.prototype&&n.prototype.render)&&!Yt.isPrototypeOf(n)}function T_(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,o=t===void 0?"":t,i=e.suffix,r=i===void 0?"":i,s=n.displayName||n.name||n.constructor&&n.constructor.name||"<component>";return o+s+r}var nh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$_=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},P_=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),R_=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},B_=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},oh=console;function qq(n){var e=oc().allowStateChanges;return oc().allowStateChanges=n,e}function Gq(n){oc().allowStateChanges=n}function Xq(n,e,t,o,i){var r=qq(n),s=void 0;try{s=e(t,o,i)}finally{Gq(r)}return s}function ih(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=n[e],i=L_[e],r=o?t===!0?function(){i.apply(this,arguments),o.apply(this,arguments)}:function(){o.apply(this,arguments),i.apply(this,arguments)}:i;n[e]=r}function rh(n,e){if(n==null||e==null||(typeof n>"u"?"undefined":nh(n))!=="object"||(typeof e>"u"?"undefined":nh(e))!=="object")return n!==e;var t=Object.keys(n);if(t.length!==Object.keys(e).length)return!0;for(var o=void 0,i=t.length-1;o=t[i];i--)if(e[o]!==n[o])return!0;return!1}var L_={componentWillMount:function(){var e=this,t=T_(this),o=!1,i=!1;function r(f){var p=this[f],h=Cf("reactive "+f);Object.defineProperty(this,f,{configurable:!0,enumerable:!0,get:function(){return h.reportObserved(),p},set:function(_){!i&&rh(p,_)?(p=_,o=!0,h.reportChanged(),o=!1):p=_}})}r.call(this,"props"),r.call(this,"state");var s=this.render.bind(this),a=null,l=!1,u=function(){return a=new wa(t+".render()",function(){if(!l&&(l=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var p=!0;try{i=!0,o||Yt.prototype.forceUpdate.call(e),p=!1}finally{i=!1,p&&a.dispose()}}}),a.reactComponent=e,c.$mobx=a,e.render=c,c(e.props,e.state,e.context)},c=function(p,h,v){l=!1;var _=void 0,m=void 0;if(a.track(function(){try{m=Xq(!1,s,p,h,v)}catch(g){_=g}}),_)throw _;return m};this.render=u},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:rh(this.props,e)}};function Nf(n){if(arguments.length>1&&oh.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),n.isMobxInjector===!0&&oh.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),zq(n)){var e,t;return Nf((t=e=(function(i){R_(r,i);function r(){return $_(this,r),B_(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return P_(r,[{key:"render",value:function(){return n.call(this,this.props,this.context)}}]),r})(Yt),e.displayName=T_(n),t))}if(!n)throw new Error("Please pass a valid component to 'observer'");var o=n.prototype||n;return Wq(o),n.isMobXReactObserver=!0,n}function Wq(n){ih(n,"componentWillMount",!0),ih(n,"componentDidMount"),n.shouldComponentUpdate||(n.shouldComponentUpdate=L_.shouldComponentUpdate)}var Yq=Nf(function(n){var e=n.children;return e[0]()});Yq.displayName="Observer";var Kq=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jq(n,e){return e={exports:{}},n(e,e.exports),e.exports}Jq(function(n,e){(function(t,o){n.exports=o()})(Kq,(function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,r=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,u=l&&l(Object);return function c(f,p,h){if(typeof p!="string"){if(u){var v=l(p);v&&v!==u&&c(f,v,h)}var _=r(p);s&&(_=_.concat(s(p)));for(var m=0;m<_.length;++m){var g=_[m];if(!t[g]&&!o[g]&&(!h||!h[g])){var b=a(p,g);try{i(f,g,b)}catch{}}}return f}return f}}))});var sh={children:!0,key:!0,ref:!0},ah=console;(function(n){R_(e,n);function e(){return $_(this,e),B_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return P_(e,[{key:"render",value:function(o){var i=o.children;return i.length>1?Ze("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var o={},i=this.context.mobxStores;if(i)for(var r in i)o[r]=i[r];for(var s in this.props)!sh[s]&&s!=="suppressChangedStoreWarning"&&(o[s]=this.props[s]);return{mobxStores:o}}},{key:"componentWillReceiveProps",value:function(o){if(Object.keys(o).length!==Object.keys(this.props).length&&ah.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!o.suppressChangedStoreWarning)for(var i in o)!sh[i]&&this.props[i]!==o[i]&&ah.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Yt);if(!Yt)throw new Error("mobx-preact requires Preact to be available");var di,vd,lh,I_=[],Gn=Gt,uh=Gn.__b,dh=Gn.__r,ch=Gn.diffed,fh=Gn.__c,ph=Gn.unmount,hh=Gn.__;function Zq(){for(var n;n=I_.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Ml),n.__H.__h.forEach(ac),n.__H.__h=[]}catch(e){n.__H.__h=[],Gn.__e(e,n.__v)}}Gn.__b=function(n){di=null,uh&&uh(n)},Gn.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),hh&&hh(n,e)},Gn.__r=function(n){dh&&dh(n);var e=(di=n.__c).__H;e&&(vd===di?(e.__h=[],di.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(Ml),e.__h.forEach(ac),e.__h=[])),vd=di},Gn.diffed=function(n){ch&&ch(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(I_.push(e)!==1&&lh===Gn.requestAnimationFrame||((lh=Gn.requestAnimationFrame)||Qq)(Zq)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),vd=di=null},Gn.__c=function(n,e){e.some(function(t){try{t.__h.forEach(Ml),t.__h=t.__h.filter(function(o){return!o.__||ac(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Gn.__e(o,t.__v)}}),fh&&fh(n,e)},Gn.unmount=function(n){ph&&ph(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(o){try{Ml(o)}catch(i){e=i}}),t.__H=void 0,e&&Gn.__e(e,t.__v))};var vh=typeof requestAnimationFrame=="function";function Qq(n){var e,t=function(){clearTimeout(o),vh&&cancelAnimationFrame(e),setTimeout(n)},o=setTimeout(t,35);vh&&(e=requestAnimationFrame(t))}function Ml(n){var e=di,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),di=e}function ac(n){var e=di;n.__c=n.__(),di=e}function eG(n,e){for(var t in e)n[t]=e[t];return n}function gh(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var o in e)if(o!=="__source"&&n[o]!==e[o])return!0;return!1}function _h(n,e){this.props=n,this.context=e}(_h.prototype=new Yt).isPureReactComponent=!0,_h.prototype.shouldComponentUpdate=function(n,e){return gh(this.props,n)||gh(this.state,e)};var mh=Gt.__b;Gt.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),mh&&mh(n)};var tG=Gt.__e;Gt.__e=function(n,e,t,o){if(n.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}tG(n,e,t,o)};var yh=Gt.unmount;function F_(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(o){typeof o.__c=="function"&&o.__c()}),n.__c.__H=null),(n=eG({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c.__e=!0,n.__c=null),n.__k=n.__k&&n.__k.map(function(o){return F_(o,e,t)})),n}function j_(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(o){return j_(o,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function gd(){this.__u=0,this.o=null,this.__b=null}function V_(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function ll(){this.i=null,this.l=null}Gt.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),yh&&yh(n)},(gd.prototype=new Yt).__c=function(n,e){var t=e.__c,o=this;o.o==null&&(o.o=[]),o.o.push(t);var i=V_(o.__v),r=!1,s=function(){r||(r=!0,t.__R=null,i?i(a):a())};t.__R=s;var a=function(){if(!--o.__u){if(o.state.__a){var l=o.state.__a;o.__v.__k[0]=j_(l,l.__c.__P,l.__c.__O)}var u;for(o.setState({__a:o.__b=null});u=o.o.pop();)u.forceUpdate()}};o.__u++||32&e.__u||o.setState({__a:o.__b=o.__v.__k[0]}),n.then(s,s)},gd.prototype.componentWillUnmount=function(){this.o=[]},gd.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),o=this.__v.__k[0].__c;this.__v.__k[0]=F_(this.__b,t,o.__O=o.__P)}this.__b=null}var i=e.__a&&Ze(cs,null,n.fallback);return i&&(i.__u&=-33),[Ze(cs,null,e.__a?null:n.children),i]};var bh=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(ll.prototype=new Yt).__a=function(n){var e=this,t=V_(e.__v),o=e.l.get(n);return o[0]++,function(i){var r=function(){e.props.revealOrder?(o.push(i),bh(e,n,o)):i()};t?t(r):r()}},ll.prototype.render=function(n){this.i=null,this.l=new Map;var e=Vl(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},ll.prototype.componentDidUpdate=ll.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){bh(n,t,e)})};var nG=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,oG=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,iG=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,rG=/[A-Z0-9]/g,sG=typeof document<"u",aG=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};function xh(n,e,t){return e.__k==null&&(e.textContent=""),Tz(n,e),typeof t=="function"&&t(),n?n.__c:null}Yt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Yt.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var wh=Gt.event;function lG(){}function uG(){return this.cancelBubble}function dG(){return this.defaultPrevented}Gt.event=function(n){return wh&&(n=wh(n)),n.persist=lG,n.isPropagationStopped=uG,n.isDefaultPrevented=dG,n.nativeEvent=n};var cG={enumerable:!1,configurable:!0,get:function(){return this.class}},Ch=Gt.vnode;Gt.vnode=function(n){typeof n.type=="string"&&(function(e){var t=e.props,o=e.type,i={},r=o.indexOf("-")===-1;for(var s in t){var a=t[s];if(!(s==="value"&&"defaultValue"in t&&a==null||sG&&s==="children"&&o==="noscript"||s==="class"||s==="className")){var l=s.toLowerCase();s==="defaultValue"&&"value"in t&&t.value==null?s="value":s==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?s="ondblclick":l!=="onchange"||o!=="input"&&o!=="textarea"||aG(t.type)?l==="onfocus"?s="onfocusin":l==="onblur"?s="onfocusout":iG.test(s)&&(s=l):l=s="oninput":r&&oG.test(s)?s=s.replace(rG,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[s=l]&&(s="oninputCapture"),i[s]=a}}o=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Vl(t.children).forEach(function(u){u.props.selected=i.value.indexOf(u.props.value)!=-1})),o=="select"&&i.defaultValue!=null&&(i.value=Vl(t.children).forEach(function(u){u.props.selected=i.multiple?i.defaultValue.indexOf(u.props.value)!=-1:i.defaultValue==u.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",cG)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i})(n),n.$$typeof=nG,Ch&&Ch(n)};var Sh=Gt.__r;Gt.__r=function(n){Sh&&Sh(n),n.__c};var kh=Gt.diffed;Gt.diffed=function(n){kh&&kh(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var fG=0;function Re(n,e,t,o,i,r){e||(e={});var s,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?s=e[a]:l[a]=e[a];var u={type:n,props:l,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--fG,__i:-1,__u:0,__source:i,__self:r};if(typeof n=="function"&&(s=n.defaultProps))for(a in s)l[a]===void 0&&(l[a]=s[a]);return Gt.vnode&&Gt.vnode(u),u}var pG=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Ca;(function(n){function e(t){var o=pG(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return an({},n.defaults,o)}n.get=e})(Ca||(Ca={}));(function(n){n.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Ca||(Ca={}));var Eh={node:!1,edge:!1},hG={node:!0,edge:!0},vG=function(n){return!n||typeof n=="boolean"?n===!0?Dt(hG):Dt(Eh):ss(Dt(Eh),n)},gG=function(){return Ha(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function Jn(n){try{return JSON.parse(JSON.stringify(n))}catch{return n}}var ul=200,_G=9999,mG=10,en;(function(n){n[n.DEFAULT=1]="DEFAULT",n[n.TEXT_EDIT=2]="TEXT_EDIT",n[n.SHOW_MENU=3]="SHOW_MENU",n[n.ALLOW_CONNECT=4]="ALLOW_CONNECT",n[n.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(en||(en={}));var Sn;(function(n){n.NODE="node",n.EDGE="edge",n.GRAPH="graph"})(Sn||(Sn={}));var zt;(function(n){n.NODE="node",n.CIRCLE_NODE="circle-node",n.POLYGON_NODE="polygon-node",n.RECT_NODE="rect-node",n.TEXT_NODE="text-node",n.ELLIPSE_NODE="ellipse-node",n.DIAMOND_NODE="diamond-node",n.HTML_NODE="html-node",n.CUSTOM_HTML_NODE="custom-html-node",n.EDGE="edge",n.LINE_EDGE="line-edge",n.POLYLINE_EDGE="polyline-edge",n.BEZIER_EDGE="bezier-edge",n.GRAPH="graph"})(zt||(zt={}));var pt;(function(n){n.ELEMENT_CLICK="element:click",n.NODE_ADD="node:add",n.NODE_DELETE="node:delete",n.NODE_CLICK="node:click",n.NODE_DBCLICK="node:dbclick",n.NODE_GROUP_COPY="node:group-copy-add",n.NODE_DND_ADD="node:dnd-add",n.NODE_DND_DRAG="node:dnd-drag",n.NODE_MOUSEDOWN="node:mousedown",n.NODE_DRAGSTART="node:dragstart",n.NODE_DRAG="node:drag",n.NODE_DROP="node:drop",n.NODE_MOUSEUP="node:mouseup",n.NODE_MOUSEMOVE="node:mousemove",n.NODE_MOUSEENTER="node:mouseenter",n.NODE_MOUSELEAVE="node:mouseleave",n.NODE_CONTEXTMENU="node:contextmenu",n.NODE_ROTATE="node:rotate",n.NODE_RESIZE="node:resize",n.NODE_FOCUS="node:focus",n.NODE_BLUR="node:blur",n.NODE_PROPERTIES_CHANGE="node:properties-change",n.NODE_PROPERTIES_DELETE="node:properties-delete",n.EDGE_ADD="edge:add",n.EDGE_DELETE="edge:delete",n.EDGE_CLICK="edge:click",n.EDGE_DBCLICK="edge:dbclick",n.EDGE_FOCUS="edge:focus",n.EDGE_BLUR="edge:blur",n.EDGE_MOUSEENTER="edge:mouseenter",n.EDGE_MOUSELEAVE="edge:mouseleave",n.EDGE_CONTEXTMENU="edge:contextmenu",n.EDGE_ADJUST="edge:adjust",n.EDGE_EXCHANGE_NODE="edge:exchange-node",n.ANCHOR_CLICK="anchor:click",n.ANCHOR_MOUSEDOWN="anchor:mousedown",n.ANCHOR_DRAGSTART="anchor:dragstart",n.ANCHOR_DRAG="anchor:drag",n.ANCHOR_DROP="anchor:drop",n.ANCHOR_DRAGEND="anchor:dragend",n.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",n.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",n.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",n.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",n.ADJUST_POINT_DRAG="adjustPoint:drag",n.ADJUST_POINT_DROP="adjustPoint:drop",n.ADJUST_POINT_DRAGEND="adjustPoint:dragend",n.BLANK_MOUSEDOWN="blank:mousedown",n.BLANK_DRAGSTART="blank:dragstart",n.BLANK_DRAG="blank:drag",n.BLANK_DROP="blank:drop",n.BLANK_MOUSEMOVE="blank:mousemove",n.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",n.BLANK_MOUSEUP="blank:mouseup",n.BLANK_CLICK="blank:click",n.BLANK_CONTEXTMENU="blank:contextmenu",n.SELECTION_MOUSEDOWN="selection:mousedown",n.SELECTION_DRAGSTART="selection:dragstart",n.SELECTION_DRAG="selection:drag",n.SELECTION_DROP="selection:drop",n.SELECTION_MOUSEMOVE="selection:mousemove",n.SELECTION_MOUSEUP="selection:mouseup",n.SELECTION_CONTEXTMENU="selection:contextmenu",n.CONNECTION_NOT_ALLOWED="connection:not-allowed",n.TEXT_MOUSEDOWN="text:mousedown",n.TEXT_DRAGSTART="text:dragstart",n.TEXT_DRAG="text:drag",n.TEXT_DROP="text:drop",n.TEXT_CLICK="text:click",n.TEXT_DBCLICK="text:dbclick",n.TEXT_BLUR="text:blur",n.TEXT_MOUSEMOVE="text:mousemove",n.TEXT_MOUSEUP="text:mouseup",n.TEXT_FOCUS="text:focus",n.TEXT_ADD="text:add",n.TEXT_UPDATE="text:update",n.TEXT_CLEAR="text:clear",n.LABEL_MOUSEDOWN="label:mousedown",n.LABEL_DRAGSTART="label:dragstart",n.LABEL_DRAG="label:drag",n.LABEL_DROP="label:drop",n.LABEL_CLICK="label:click",n.LABEL_DBCLICK="label:dbclick",n.LABEL_BLUR="label:blur",n.LABEL_MOUSEMOVE="label:mousemove",n.LABEL_MOUSEUP="label:mouseup",n.LABEL_FOCUS="label:focus",n.LABEL_ADD="label:add",n.LABEL_UPDATE="label:update",n.LABEL_CLEAR="label:clear",n.LABEL_DELETE="label:delete",n.LABEL_SHOULD_ADD="label:should-add",n.LABEL_BATCH_ADD="label:batch-add",n.LABEL_SHOULD_UPDATE="label:should-update",n.LABEL_SHOULD_DELETE="label:should-delete",n.LABEL_BATCH_DELETE="label:batch-delete",n.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",n.HISTORY_CHANGE="history:change",n.GRAPH_TRANSFORM="graph:transform",n.GRAPH_RENDERED="graph:rendered",n.GRAPH_UPDATED="graph:updated",n.EDIT_CONFIG_CHANGED="editConfig:changed"})(pt||(pt={}));var Ln;(function(n){n[n.STATIC=-1]="STATIC",n[n.DEFAULT=0]="DEFAULT",n[n.INCREASE=1]="INCREASE",n[n.EDGE_TOP=2]="EDGE_TOP"})(Ln||(Ln={}));var xn;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(xn||(xn={}));var Mo;(function(n){n.TEXT="text",n.LABEL="label"})(Mo||(Mo={}));var yG=0,Lo=(function(){function n(e){var t=e.onDragStart,o=t===void 0?id:t,i=e.onDragging,r=i===void 0?id:i,s=e.onDragEnd,a=s===void 0?id:s,l=e.eventType,u=l===void 0?"":l,c=e.eventCenter,f=e.step,p=f===void 0?1:f,h=e.isStopPropagation,v=h===void 0?!0:h,_=e.model,m=e.data,g=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(b){var C,D,T=window==null?void 0:window.document;if(b.button===yG){g.isStopPropagation&&b.stopPropagation(),b.preventDefault(),g.isStartDragging=!0,g.startX=b.clientX,g.startY=b.clientY,T.addEventListener("pointermove",g.handleMouseMove,!1),T.addEventListener("pointerup",g.handleMouseUp,!1);var O=(C=g.model)===null||C===void 0?void 0:C.getData();(D=g.eventCenter)===null||D===void 0||D.emit(pt["".concat(g.eventType,"_MOUSEDOWN")],{e:b,data:g.data||O}),g.startTime=new Date().getTime()}},this.handleMouseMove=function(b){var C,D;if(g.isStopPropagation&&b.stopPropagation(),b.preventDefault(),!!g.isStartDragging&&(g.sumDeltaX+=b.clientX-g.startX,g.sumDeltaY+=b.clientY-g.startY,g.startX=b.clientX,g.startY=b.clientY,g.step<=1||Math.abs(g.sumDeltaX)>g.step||Math.abs(g.sumDeltaY)>g.step)){var T=g.sumDeltaX%g.step,O=g.sumDeltaY%g.step,k=g.sumDeltaX-T,S=g.sumDeltaY-O;g.sumDeltaX=T,g.sumDeltaY=O;var N=(C=g.model)===null||C===void 0?void 0:C.getData();g.isDragging||((D=g.eventCenter)===null||D===void 0||D.emit(pt["".concat(g.eventType,"_DRAGSTART")],{e:b,data:g.data||N}),g.onDragStart({event:b})),g.isDragging=!0,Promise.resolve().then(function(){var L,$;g.onDragging({deltaX:k,deltaY:S,event:b}),(L=g.eventCenter)===null||L===void 0||L.emit(pt["".concat(g.eventType,"_MOUSEMOVE")],{deltaX:k,deltaY:S,e:b,data:g.data||N}),($=g.eventCenter)===null||$===void 0||$.emit(pt["".concat(g.eventType,"_DRAG")],{e:b,data:g.data||N})})}},this.handleMouseUp=function(b){var C=window.document;g.isStartDragging=!1,g.isStopPropagation&&b.stopPropagation();var D=b.target;D&&typeof D.releasePointerCapture=="function"&&D.releasePointerCapture(b.pointerId),Promise.resolve().then(function(){var T,O,k;C.removeEventListener("pointermove",g.handleMouseMove,!1),C.removeEventListener("pointerup",g.handleMouseUp,!1);var S=(T=g.model)===null||T===void 0?void 0:T.getData();(O=g.eventCenter)===null||O===void 0||O.emit(pt["".concat(g.eventType,"_MOUSEUP")],{e:b,data:g.data||S}),g.isDragging&&(g.isDragging=!1,g.onDragEnd({event:b}),(k=g.eventCenter)===null||k===void 0||k.emit(pt["".concat(g.eventType,"_DROP")],{e:b,data:g.data||S}))})},this.cancelDrag=function(){var b=window==null?void 0:window.document;b.removeEventListener("pointermove",g.handleMouseMove,!1),b.removeEventListener("pointerup",g.handleMouseUp,!1),g.onDragEnd({event:void 0}),g.isDragging=!1},this.destroy=function(){g.isStartDragging&&g.cancelDrag()},this.onDragStart=o,this.onDragging=r,this.onDragEnd=a,this.step=p,this.isStopPropagation=v,this.eventType=u,this.eventCenter=c,this.model=_,this.data=m}return n.prototype.setStep=function(e){this.step=e},n.prototype.setModel=function(e){this.model=e},n})(),bG=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{x:e-o/2,y:t-i/2,x1:e+o/2,y1:t+i/2}},xG=function(n){var e=n.startPoint,t=n.endPoint,o=(e.x+t.x)/2,i=(e.y+t.y)/2,r=Math.abs(e.x-t.x)+10,s=Math.abs(e.y-t.y)+10;return{x:o-r/2,y:i-s/2,x1:o+r/2,y1:i+s/2}},wG=function(n){var e=n.points,t=Nr(e),o=Ea(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},CG=function(n){var e=n.path,t=Mf(e),o=Ea(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},SG=function(n){if(n.modelType===zt.LINE_EDGE)return xG(n);if(n.modelType===zt.POLYLINE_EDGE)return wG(n);if(n.modelType===zt.BEZIER_EDGE)return CG(n)},kG=function(n,e,t,o){var i=(e.y-n.y)*(o.x-t.x)-(n.x-e.x)*(t.y-o.y);if(i===0)return!1;var r=((e.x-n.x)*(o.x-t.x)*(t.y-n.y)+(e.y-n.y)*(o.x-t.x)*n.x-(o.y-t.y)*(e.x-n.x)*t.x)/i,s=-((e.y-n.y)*(o.y-t.y)*(t.x-n.x)+(e.x-n.x)*(o.y-t.y)*n.y-(o.x-t.x)*(e.y-n.y)*t.y)/i;return(r-n.x)*(r-e.x)<=0&&(s-n.y)*(s-e.y)<=0&&(r-t.x)*(r-o.x)<=0&&(s-t.y)*(s-o.y)<=0?{x:r,y:s}:!1},Sa=function(n,e,t){var o=n.x,i=n.y,r=e.x,s=e.y,a=t.x,l=t.y,u=(l-s)/(a-r),c=s-u*r;return(o>=r&&o<=a||o<=r&&o>=a)&&(i>=s&&i<=l||i<=s&&i>=l)&&Math.abs(i-u*o-c)<Number.EPSILON},ka=function(n){var e=n.start,t=n.end,o=n.offset,i=n.verticalLength,r=n.type,s={leftX:0,leftY:0,rightX:0,rightY:0},a=Math.atan((t.y-e.y)/(t.x-e.x)),l=Math.atan(o/i),u=Math.sqrt(i*i+o*o);return r==="start"?t.x>=e.x?(s.leftX=e.x+u*Math.sin(a+l),s.leftY=e.y-u*Math.cos(a+l),s.rightX=e.x-u*Math.sin(a-l),s.rightY=e.y+u*Math.cos(a-l)):(s.leftX=e.x-u*Math.sin(a+l),s.leftY=e.y+u*Math.cos(a+l),s.rightX=e.x+u*Math.sin(a-l),s.rightY=e.y-u*Math.cos(a-l)):r==="end"&&(t.x>=e.x?(s.leftX=t.x+u*Math.sin(a-l),s.leftY=t.y-u*Math.cos(a-l),s.rightX=t.x-u*Math.sin(a+l),s.rightY=t.y+u*Math.cos(a+l)):(s.leftX=t.x-u*Math.sin(a-l),s.leftY=t.y+u*Math.cos(a-l),s.rightX=t.x+u*Math.sin(a+l),s.rightY=t.y-u*Math.cos(a+l))),s},Qr=function(){return Qr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Qr.apply(this,arguments)},Do=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Wi=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},EG=function(n,e){return Math.abs(n.centerX-e.centerX)*2<n.width+e.width&&Math.abs(n.centerY-e.centerY)*2<n.height+e.height},lc=function(n){var e=[],t={};return n.forEach(function(o){var i="".concat(o.x,"-").concat(o.y);o.id=i,t[i]=o}),Object.keys(t).forEach(function(o){e.push(t[o])}),e},Kl=function(n,e){return n.width===0&&n.height===0?n:{x:n.x,y:n.y,centerX:n.centerX,centerY:n.centerY,minX:n.minX-e,minY:n.minY-e,maxX:n.maxX+e,maxY:n.maxY+e,height:n.height+2*e,width:n.width+2*e}},DG=function(n,e){var t=Math.abs(n.x-e.centerX),o=Math.abs(n.y-e.centerY);return t/e.width>o/e.height?xn.HORIZONTAL:xn.VERTICAL},Jl=function(n,e,t){var o=DG(t,e);return o===xn.HORIZONTAL?{x:t.x>n.centerX?n.maxX:n.minX,y:t.y}:{x:t.x,y:t.y>n.centerY?n.maxY:n.minY}},Dh=function(n,e){var t=Math.min(n.minX,e.minX),o=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),r=Math.max(n.maxY,e.maxY);return{x:(t+i)/2,y:(o+r)/2,centerX:(t+i)/2,centerY:(o+r)/2,minX:t,minY:o,maxX:i,maxY:r,height:r-o,width:i-t}},Ea=function(n,e){n===void 0&&(n=[]);var t=[],o=[];n.forEach(function(c){t.push(c.x),o.push(c.y)});var i=Math.min.apply(Math,Wi([],Do(t),!1)),r=Math.max.apply(Math,Wi([],Do(t),!1)),s=Math.min.apply(Math,Wi([],Do(o),!1)),a=Math.max.apply(Math,Wi([],Do(o),!1)),l=r-i,u=a-s;return e&&(l+=e,u+=e),{centerX:(i+r)/2,centerY:(s+a)/2,maxX:r,maxY:a,minX:i,minY:s,x:(i+r)/2,y:(s+a)/2,height:u,width:l}},Zl=function(n){var e=n.minX,t=n.minY,o=n.maxX,i=n.maxY;return[{x:e,y:t},{x:o,y:t},{x:o,y:i},{x:e,y:i}]},dl=function(n,e){var t=n.x,o=n.y;return t<e.minX||t>e.maxX||o<e.minY||o>e.maxY},AG=function(n,e){return e<n.minX||e>n.maxX?[]:[{x:e,y:n.minY},{x:e,y:n.maxY}]},OG=function(n,e){return e<n.minY||e>n.maxY?[]:[{x:n.minX,y:e},{x:n.maxX,y:e}]},NG=function(n,e){return Wi(Wi([],Do(AG(n,e.x)),!1),Do(OG(n,e.y)),!1)},uc=function(n,e){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},MG=function(n,e){var t=-2,o=0;return e.forEach(function(i){i&&(n.x===i.x&&(o+=t),n.y===i.y&&(o+=t))}),o},Ah=function(n,e,t,o,i){return uc(n,e)+uc(n,t)+MG(n,[e,t,o,i])},H_=function(n,e,t,o,i){i||(i=0),n.unshift(e[o]),t[o]&&t[o]!==o&&i<=100&&H_(n,e,t,t[o],i+1)},TG=function(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)},Zs=function(n,e,t,o){var i=e.x-n.x,r=e.y-n.y,s=o.x-t.x,a=o.y-t.y,l=(-r*(n.x-t.x)+i*(n.y-t.y))/(-s*r+i*a),u=(s*(n.y-t.y)-a*(n.x-t.x))/(-s*r+i*a);return l>=0&&l<=1&&u>=0&&u<=1},Oh=function(n,e,t){if(t.width===0&&t.height===0)return!1;var o=Do(Zl(t),4),i=o[0],r=o[1],s=o[2],a=o[3];return Zs(n,e,i,r)||Zs(n,e,i,a)||Zs(n,e,r,s)||Zs(n,e,s,a)},$G=function(n,e,t,o){var i=[];return n.forEach(function(r){r!==e&&(r.x===e.x||r.y===e.y)&&!Oh(r,e,t)&&!Oh(r,e,o)&&i.push(r)}),lc(i)},PG=function(n,e,t,o,i,r,s){var a=[],l=[e],u={},c={},f={};e.id&&(c[e.id]=0,f[e.id]=Ah(e,t,e));var p={};n.forEach(function(_){_.id&&(p[_.id]=_)});for(var h=function(){var _,m=1/0;if(l.forEach(function(b){b.id&&f[b.id]<m&&(m=f[b.id],_=b)}),_===t&&t.id){var g=[];return H_(g,p,u,t.id),{value:g}}if(!_)return{value:[e,t]};TG(l,_),a.push(_),$G(n,_,o,i).forEach(function(b){if(a.indexOf(b)===-1&&(l.indexOf(b)===-1&&l.push(b),_!=null&&_.id&&(b!=null&&b.id))){var C=f[_.id]+uc(_,b);if(c[b.id]&&C>=c[b.id])return;u[b.id]=_.id,c[b.id]=C,f[b.id]=c[b.id]+Ah(b,t,e,r,s)}})};l.length;){var v=h();if(typeof v=="object")return v.value}return[e,t]},Nh=function(n){return vo(n)},U_=function(n){for(var e=1;e<n.length-1;){var t=n[e-1],o=n[e],i=n[e+1];t.x===o.x&&o.x===i.x||t.y===o.y&&o.y===i.y?n.splice(e,1):e++}return n},Mh=function(n,e,t,o,i){var r=Nh(t),s=Nh(o),a=Kl(r,i),l=Kl(s,i),u=Jl(a,r,n),c=Jl(l,s,e);if(EG(a,l)){var f=BG(n,e,u,c);return Wi(Wi([n,u],Do(f),!1),[c,e],!1)}var p=Ea([u,c]),h=Dh(a,p),v=Dh(l,p),_=[];_=_.concat(Zl(h)),_=_.concat(Zl(v));var m={x:(n.x+e.x)/2,y:(n.y+e.y)/2};[p,h,v].forEach(function(b){_=_.concat(NG(b,m).filter(function(C){return dl(C,a)&&dl(C,l)}))}),[{x:u.x,y:c.y},{x:c.x,y:u.y}].forEach(function(b){dl(b,a)&&dl(b,l)&&_.push(b)}),_.unshift(u),_.push(c),_=lc(_);var g=PG(_,u,c,r,s,n,e);return g.unshift(n),g.push(e),g.length>2&&(g=U_(g)),lc(g)},RG=function(n){if(n.length===1){var e=Do(n,1),t=e[0];return[t,t]}else{for(var o=n[0],i=n[1],r=Xo(o.x,o.y,i.x,i.y),s=1;s<n.length-1;s++){var a=n[s],l=n[s+1],u=Xo(a.x,a.y,l.x,l.y);u>r&&(r=u,o=a,i=l)}return[o,i]}},Th=function(n,e,t){var o=Ai(n,t),i=Ai(e,t);return o&&i},$h=function(n,e,t){var o=Ai(n,t),i=Ai(e,t),r=o&&i,s=o||i;return!r&&s},Ph=function(n,e,t){for(var o=void 0,i=vo(t),r=Zl(i),s=0;s<r.length;s++){var a=Zs(n,e,r[s],r[(s+1)%r.length]);a&&(o=[r[s],r[(s+1)%r.length]])}if(o)return kG(n,e,o[0],o[1])},Ql=function(n,e){var t=void 0;return n.x===e.x?t=xn.VERTICAL:n.y===e.y&&(t=xn.HORIZONTAL),t},Nr=function(n){var e=n.split(" "),t=[];return e&&e.forEach(function(o){var i=Do(o.split(","),2),r=i[0],s=i[1];t.push({x:Number(r),y:Number(s)})}),t},BG=function(n,e,t,o){var i=[],r=Ql(n,t),s=Ql(e,o);if(r===s)n.y===t.y?(i.push({x:t.x,y:(t.y+o.y)/2}),i.push({x:o.x,y:(t.y+o.y)/2})):(i.push({x:(t.x+o.x)/2,y:t.y}),i.push({x:(t.x+o.x)/2,y:o.y}));else{var a={x:t.x,y:o.y},l=Sa(a,n,t),u=Sa(a,e,o);if(l||u)a={x:o.x,y:t.y};else{var c=Rh(a,n,t),f=Rh(a,e,o);c&&f&&(a={x:o.x,y:t.y})}i.push(a)}return i},Rh=function(n,e,t){return n.x===e.x&&n.x===t.x||n.y===e.y&&n.y===t.y},z_=function(n){if(!n)return 0;for(var e=0,t=0;t<n.length;t++){var o=n.charCodeAt(t);n.match(/[A-Z]/)?e+=1.5:o>=1&&o<=126||o>=65376&&o<=65439?e+=1:e+=2}return e},LG=function(n){var e=n.start,t=n.end,o;if(e.x===t.x&&e.y===t.y)o="";else{var i={start:e,end:t,offset:10,verticalLength:5},r=ka(Qr(Qr({},i),{type:"start"})),s=ka(Qr(Qr({},i),{type:"end"}));o="M".concat(r.leftX," ").concat(r.leftY,`
    L`).concat(r.rightX," ").concat(r.rightY,`
    L`).concat(s.rightX," ").concat(s.rightY,`
    L`).concat(s.leftX," ").concat(s.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},Bh=function(n){var e=n.start,t=n.end,o=n.sourceNode,i=n.targetNode,r=n.offset,s=vo(o),a=vo(i),l=Kl(s,r),u=Kl(a,r),c=Jl(l,s,e),f=Jl(u,a,t);return{sNext:c,ePre:f}},Mf=function(n){var e=n.replace(/M/g,"").replace(/C/g,",").split(","),t=cl(e[0]),o=cl(e[1]),i=cl(e[2]),r=cl(e[3]);return[t,o,i,r]},cl=function(n){var e=Do(n.replace(/(^\s*)/g,"").split(" "),2),t=e[0],o=e[1];return{x:+t,y:+o}},Lh=function(n,e){var t=Do(n,4),o=t[0],i=t[1],r=t[2],s=t[3],a=DX(o,i,r,s,e);return[a,n[3]]},q_=function(n,e){for(var t=n.x,o=n.y,i=Nr(e),r=Number.MAX_SAFE_INTEGER,s,a=[],l=0;l<i.length;l++)a.push({start:i[l],end:i[(l+1)%i.length]});if(a.forEach(function(p){var h=p.start,v=p.end;if(h.x===v.x){var _={x:h.x,y:o},m=Sa(_,h,v);if(m){var g=Math.abs(h.x-t);g<r&&(r=g,s=_)}}else if(h.y===v.y){var _={x:t,y:h.y},m=Sa(_,h,v);if(m){var g=Math.abs(h.y-o);g<r&&(r=g,s=_)}}}),!s){var u=a[0],c=u.start,f=u.end;s={x:c.x+(f.x-c.x)/2,y:c.y+(f.y-c.y)/2}}return s},IG=function(n){return Kr(n,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},Ih=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};function FG(n,e){return typeof e!="function"?function(t,o,i){return Object.assign({type:n.edgeType},i)}:function(t,o,i){var r=e(t,o,i);return r?typeof r=="string"?Object.assign({},i,{type:r}):Object.assign({type:r},i):{type:n.edgeType}}}var jG=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return Lt(e,function(r){var s=z_(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},Vr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},fl=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};function ys(n,e,t){return t&&e*Math.round(n/e)||n}function VG(n,e,t){if(!n)return[];var o=Math.min.apply(Math,fl([],Vr(n.map(function(_){return _[0]})),!1)),i=Math.max.apply(Math,fl([],Vr(n.map(function(_){return _[0]})),!1)),r=Math.min.apply(Math,fl([],Vr(n.map(function(_){return _[1]})),!1)),s=Math.max.apply(Math,fl([],Vr(n.map(function(_){return _[1]})),!1)),a=-o,l=-r,u=n.map(function(_){var m=Vr(_,2),g=m[0],b=m[1];return[g+a,b+l]}),c=i-o,f=s-r,p=e?e/c:1,h=t?t/f:1,v=Math.min(p,h);return u.map(function(_){var m=Vr(_,2),g=m[0],b=m[1];return[g*v,b*v]})}var _d=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},md=function(n,e,t){var o=_d(n,2),i=o[0],r=o[1],s=_d(e,2),a=s[0],l=s[1],u=_d(t,2),c=u[0],f=u[1];return i>a&&i<c&&r>l&&r<f},G_=function(n,e){var t=e.multipleSelectKey,o=!1;switch(t){case"meta":o=n.metaKey;break;case"alt":o=n.altKey;break;case"shift":o=n.shiftKey;break;case"ctrl":o=n.ctrlKey;break;default:o=!1;break}return o},Tf=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();function Fh(n,e){return n instanceof Xn&&e instanceof Xn}var X_=(function(n){Tf(e,n);function e(t,o,i){var r=n.call(this,3)||this;return r[0]=t,r[1]=o,r[2]=i,r.x=t,r.y=o,r.z=i,Object.setPrototypeOf(r,e.prototype),r}return e.prototype.add=function(t){if(Fh(this,t))return new Xn(this.x+t.x,this.y+t.y);var o=this.z+t.z;return new dc((this.x+t.x)/o,(this.y+t.y)/o)},e.prototype.subtract=function(t){if(Fh(this,t))return new Xn(this.x-t.x,this.y-t.y);var o=this.z-t.z;return o===0?new Xn(this.x-t.x,this.y-t.y):new dc((this.x-t.x)/o,(this.y-t.y)/o)},e})(Array),Xn=(function(n){Tf(e,n);function e(t,o,i){var r=n.call(this,t,o,i??0)||this;return Object.setPrototypeOf(r,e.prototype),r}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var o=this;return t.reduce(function(i,r,s){return i+r*o[s]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var o=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return o>=0?i:-i},e})(X_),dc=(function(n){Tf(e,n);function e(t,o){var i=n.call(this,t,o,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e})(X_),Yu=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Hr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},yd=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Ka=(function(n){Yu(e,n);function e(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var i=n.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(r,s){i[s]=r}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return yd([],Hr(this.map(function(o){return o[t]})),!1)},e.prototype.transpose=function(){for(var t=[],o=0;o<this.columns;o++)t.push(this.getColumn(o));return new(e.bind.apply(e,yd([void 0],Hr(t),!1)))},e.prototype.cross=function(t){var o=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var r=this.getRow(i),s=function(l){var u=t.getColumn(l);o[i][l]=r.reduce(function(c,f,p){return c+f*u[p]},0)},a=0;a<t.columns;a++)s(a);return new(e.bind.apply(e,yd([void 0],Hr(o),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new dc(t[0],t[1])})},e.prototype.toString=function(){var t=Hr(this[0],2),o=t[0],i=t[1],r=Hr(this[1],2),s=r[0],a=r[1],l=Hr(this[2],2),u=l[0],c=l[1];return"matrix(".concat(o," ").concat(i," ").concat(s," ").concat(a," ").concat(u," ").concat(c,")")},e.prototype.translate=function(t,o){return this.cross(new eu(t,o))},e.prototype.rotate=function(t){return this.cross(new HG(t))},e.prototype.scale=function(t,o){return this.cross(new UG(t,o))},e})(Array),HG=(function(n){Yu(e,n);function e(t){var o=n.call(this,new Xn(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new Xn(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new Xn(0,0,1))||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return this.transpose()},e})(Ka),UG=(function(n){Yu(e,n);function e(t,o){var i=n.call(this,new Xn(t,0,0),new Xn(0,o,0),new Xn(0,0,1))||this;return i.sx=t,i.sy=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e})(Ka),eu=(function(n){Yu(e,n);function e(t,o){var i=n.call(this,new Xn(1,0,0),new Xn(0,1,0),new Xn(t,o,1))||this;return i.tx=t,i.ty=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e})(Ka);bq({});var tu=function(){return tu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},tu.apply(this,arguments)},zG=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},cc=function(n){var e=n.anchors;return e},nu=function(n,e){for(var t=e.nodes,o,i=t.length-1;i>=0;i--){var r=t[i],s=XG(n,r);if(s){var a=r.getTargetAnchor(n);if(a){var l={node:r,anchorIndex:a.index,anchor:a.anchor};(!o||qG(r,o.node,e))&&(o=l)}}}return o},qG=function(n,e,t){return n.zIndex>e.zIndex?!0:t.nodesMap[n.id].index>t.nodesMap[e.id].index},GG=function(n,e){for(var t=cc(e),o,i=Number.MAX_SAFE_INTEGER,r=0;r<t.length;r++){var s=Xo(n.x,n.y,t[r].x,t[r].y);s<i&&(i=s,o={index:r,anchor:tu(tu({},t[r]),{x:t[r].x,y:t[r].y,id:t[r].id})})}return o},Xo=function(n,e,t,o){return Math.hypot(n-t,e-o)},Ai=function(n,e,t){t===void 0&&(t=0);var o=!1,i=vo(e),r=zG(new Ka([n.x,n.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),s=r[0],a=r[1],l={x:s,y:a};return l.x>=i.minX-t&&l.x<=i.maxX+t&&l.y>=i.minY-t&&l.y<=i.maxY+t&&(o=!0),o},XG=function(n,e){return Ai(n,e,5)},vo=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{minX:e-o/2,minY:t-i/2,maxX:e+o/2,maxY:t+i/2,x:e,y:t,width:o,height:i,centerX:e,centerY:t}},WG=function(n){var e=n,t=e.x,o=e.y,i=e.width,r=e.height,s=e.radius;return[{x:t-i/2+s,y:o-r/2+s,r:s},{x:t+i/2-s,y:o-r/2+s,r:s},{x:t-i/2+s,y:o+r/2-s,r:s},{x:t+i/2-s,y:o+r/2-s,r:s}]},jh=function(n,e,t){var o=WG(t),i,r=Number.MAX_SAFE_INTEGER;return o.forEach(function(s){var a=Xo(n.x,n.y,s.x,s.y);a<r&&(r=a,i=s)}),fc(n,e,i)},fc=function(n,e,t){var o,i=t.x,r=t.y,s=t.r;if(e===xn.HORIZONTAL){var a=i-Math.sqrt(s*s-(n.y-r)*(n.y-r)),l=i+Math.sqrt(s*s-(n.y-r)*(n.y-r)),u=Math.abs(a-n.x)<Math.abs(l-n.x)?a:l;o={x:u,y:n.y}}else if(e===xn.VERTICAL){var c=r-Math.sqrt(s*s-(n.x-i)*(n.x-i)),f=r+Math.sqrt(s*s-(n.x-i)*(n.x-i)),p=Math.abs(c-n.y)<Math.abs(f-n.y)?c:f;o={x:n.x,y:p}}return o},Vh=function(n,e){var t=e,o=!1,i=t.x,r=t.y,s=t.width,a=t.height,l=t.radius,u={minX:i-s/2+l,maxX:i+s/2-l,minY:r-a/2+l,maxY:r+a/2-l};return n.y===r+a/2||n.y===r-a/2?o=n.x>u.minX&&n.x<u.maxX:(n.x===i+s/2||n.x===i-s/2)&&(o=n.y>u.minY&&n.y<u.maxY),o},Hh=function(n,e,t){var o,i=t,r=i.x,s=i.y,a=i.rx,l=i.ry;if(e===xn.HORIZONTAL){var u=r-Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),c=r+Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),f=Math.abs(u-n.x)<Math.abs(c-n.x)?u:c;o={x:f,y:n.y}}else if(e===xn.VERTICAL){var p=s-Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),h=s+Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),v=Math.abs(p-n.y)<Math.abs(h-n.y)?p:h;o={x:n.x,y:v}}return o},pl=function(n,e,t){for(var o=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,r,s=[],a=0;a<o.length;a++)s.push({start:o[a],end:o[(a+1)%o.length]});return s.forEach(function(l){var u=l.start,c=l.end,f=u,p=c;u.x>c.x&&(f=c,p=u);var h={x:n.x,y:n.y};if(f.x===p.x&&e===xn.HORIZONTAL&&(h={x:f.x,y:n.y}),f.y===p.y&&e===xn.VERTICAL&&(h={x:n.x,y:f.y}),f.x!==p.x&&f.y!==p.y){var v=(p.y-f.y)/(p.x-f.x),_=(f.x*p.y-p.x*f.y)/(f.x-p.x);e===xn.HORIZONTAL?h={x:(n.y-_)/v,y:n.y}:e===xn.VERTICAL&&(h={x:n.x,y:v*n.x+_})}var m=Sa(h,u,c);if(m){var g=Xo(h.x,h.y,n.x,n.y);g<i&&(i=g,r=h)}}),r},YG=function(n){var e=Kr(n,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},Uh=function(n,e,t,o){var i=n.x,r=n.y;return e.x>n.x?i=n.x+t/2:e.x<n.x&&(i=n.x-t/2),e.y>n.y?r=n.y+o/2:e.y<n.y&&(r=n.y-o/2),{x:i,y:r}},W_=function(n){var e=n.rows,t=n.style,o=n.rowsLength,i=n.className,r=document.createElement("div");r.className=i,r.style.fontSize="".concat(t.fontSize),r.style.width="".concat(t.width),r.style.lineHeight="".concat(t.lineHeight),r.style.padding="".concat(t.padding),t.fontFamily&&(r.style.fontFamily="".concat(t.fontFamily)),o>1?e.forEach(function(a){var l=document.createElement("div");l.textContent=a,r.appendChild(l)}):r.textContent=e[0],document.body.appendChild(r);var s=r.clientHeight;return document.body.removeChild(r),s},zh=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return e&&e.forEach(function(r){var s=z_(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},ou=function(n){return typeof n!="object"?{isAllPass:!!n,msg:n?"":"不允许连接"}:n};let hl;const KG=new Uint8Array(16);function JG(){if(!hl&&(hl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!hl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return hl(KG)}const qn=[];for(let n=0;n<256;++n)qn.push((n+256).toString(16).slice(1));function ZG(n,e=0){return qn[n[e+0]]+qn[n[e+1]]+qn[n[e+2]]+qn[n[e+3]]+"-"+qn[n[e+4]]+qn[n[e+5]]+"-"+qn[n[e+6]]+qn[n[e+7]]+"-"+qn[n[e+8]]+qn[n[e+9]]+"-"+qn[n[e+10]]+qn[n[e+11]]+qn[n[e+12]]+qn[n[e+13]]+qn[n[e+14]]+qn[n[e+15]]}const QG=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qh={randomUUID:QG};function eX(n,e,t){if(qh.randomUUID&&!n)return qh.randomUUID();n=n||{};const o=n.random||(n.rng||JG)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,ZG(o)}var Ji=function(){return eX()},na=new Map,Y_=function(n){var e=Ji();function t(){n();var i=na.get(e);if(i){var r=window.requestAnimationFrame(t);na.set(e,r)}}var o=window.requestAnimationFrame(t);return na.set(e,o),e},iu=function(n){var e=na.get(n);e&&(window.cancelAnimationFrame(e),na.delete(n))},Da=function(){return Da=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Da.apply(this,arguments)},tX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function K_(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.value,s=n.fontSize,a=s===void 0?12:s,l=n.fill,u=l===void 0?"currentColor":l,c=n.overflowMode,f=c===void 0?"default":c,p=n.textWidth,h=p===void 0?void 0:p,v=n.model,_={x:t,y:i,fill:u,fontSize:a,textAnchor:"middle",dominantBaseline:"central"};if(Lt(tr(n),function(T){var O=tX(T,2),k=O[0],S=O[1];typeof S!="object"&&(_[k]=S)}),r){var m=String(r).split(/[\r\n]/g),g=m.length;if(f!=="default"){var b=v.BaseType,C=v.modelType;if(b===Sn.NODE&&C!==zt.TEXT_NODE||b===Sn.EDGE&&h)return nX(n)}if(g>1){var D=m.map(function(T,O){var k=a+2,S=(O-(g-1)/2)*k;return Re("tspan",{className:"lf-text-tspan",x:t,y:i+S,children:T})});return Re("text",Da({},_,{children:D}))}return Re("text",Da({},_,{children:r}))}return null}function nX(n){var e=n.x,t=n.y,o=n.value,i=n.model,r=n.textWidth,s=n.fontSize,a=s===void 0?12:s,l=n.lineHeight,u=n.fontFamily,c=u===void 0?"":u,f=n.wrapPadding,p=f===void 0?"0, 0":f,h=n.overflowMode,v=i.width,_=i.height,m=i.textHeight,g=r||v,b=String(o).split(/[\r\n]/g),C=b.length,D=W_({rows:b,style:{fontSize:"".concat(a,"px"),width:"".concat(g,"px"),fontFamily:c,lineHeight:l,padding:p},rowsLength:C,className:"lf-get-text-height"}),T=_>D?_:D;m&&(T=m);var O=h==="ellipsis";return O&&(T=a+2),Re("g",{children:Re("foreignObject",{width:g,height:T,x:e-g/2,y:t-T/2,style:{overflow:"visible",textAlign:"left"},children:Re("div",{className:"lf-node-text-auto-wrap",style:{minHeight:T,width:g,padding:p},children:Re("div",{className:O?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:O?b.join(""):"",style:Da({},n),children:b.map(function(k){return Re("div",{className:"lf-node-text--auto-wrap-inner",children:k})})})})})})}var pc=function(){return pc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pc.apply(this,arguments)},oX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function bs(n){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return Lt(tr(n),function(t){var o=oX(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Re("line",pc({},e))}var hc=function(){return hc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},hc.apply(this,arguments)},iX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Ao(n){var e=n.x,t=n.y,o=n.width,i=n.height,r=n.className,s=n.strokeWidth,a=n.radius,l=a===void 0?0:a,u=e-o/2,c=t-i/2,f={};return f["stroke-width"]=s,Lt(tr(n),function(p){var h=iX(p,2),v=h[0],_=h[1];typeof _!="object"&&(f[v]=_)}),r?f.className="lf-basic-shape ".concat(r):f.className="lf-basic-shape",l&&(f.rx=l,f.ry=l),f.x=u,f.y=c,Re("rect",hc({},f))}var vc=function(){return vc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vc.apply(this,arguments)},rX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Aa(n){var e={d:""};return Lt(tr(n),function(t){var o=rX(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Re("path",vc({},e))}var gc=function(){return gc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gc.apply(this,arguments)},sX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function xs(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.r,s=r===void 0?4:r,a=n.className,l={cx:t,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Lt(tr(n),function(u){var c=sX(u,2),f=c[0],p=c[1];typeof p!="object"&&(l[f]=p)}),a?l.className="lf-basic-shape ".concat(a):l.className="lf-basic-shape",Re("circle",gc({},l))}var _c=function(){return _c=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_c.apply(this,arguments)},aX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function lX(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.rx,s=r===void 0?4:r,a=n.ry,l=a===void 0?4:a,u=n.className,c={cx:t,cy:i,rx:s,ry:l,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Lt(tr(n),function(f){var p=aX(f,2),h=p[0],v=p[1];typeof v!="object"&&(c[h]=v)}),u?c.className="lf-basic-shape ".concat(u):c.className="lf-basic-shape",Re("ellipse",_c({},c))}var ru=function(){return ru=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ru.apply(this,arguments)},uX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function dX(n,e){var t=n.map(function(b){return{x:b[0],y:b[1]}}),o=t.length;if(o<3)return"";for(var i=Math.abs(e),r="",s=0;s<o;s++){var a=t[(s-1+o)%o],l=t[s],u=t[(s+1)%o],c={x:l.x-a.x,y:l.y-a.y},f={x:u.x-l.x,y:u.y-l.y},p=Math.hypot(c.x,c.y),h=Math.hypot(f.x,f.y),v={x:c.x/p,y:c.y/p},_={x:f.x/h,y:f.y/h},m={x:l.x-v.x*i,y:l.y-v.y*i},g={x:l.x+_.x*i,y:l.y+_.y*i};s===0?r+="M ".concat(m.x," ").concat(m.y," "):r+="L ".concat(m.x," ").concat(m.y," "),r+="Q ".concat(l.x," ").concat(l.y," ").concat(g.x," ").concat(g.y," ")}return r+="Z",r}function $f(n){var e=n.points,t=e===void 0?[]:e,o=n.className,i=n.radius,r={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(Lt(tr(n),function(a){var l=uX(a,2),u=l[0],c=l[1];typeof c!="object"&&(r[u]=c)}),o?r.classNmae="lf-basic-shape ".concat(o):r.className="lf-basic-shape",i){var s=dX(t,i);return r.d=s,Re("path",ru({},r))}else return r.points=t.map(function(a){return a.join(",")}).join(" "),Re("polygon",ru({},r))}var mc=function(){return mc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mc.apply(this,arguments)},cX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function fX(n){var e=n.className,t={points:"",fill:"none"};return Lt(tr(n),function(o){var i=cX(o,2),r=i[0],s=i[1];(r==="style"||typeof s!="object")&&(t[r]=s)}),e&&(t.className="".concat(e)),Re("polyline",mc({},t))}var J_=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Oa=function(){return Oa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Oa.apply(this,arguments)},pX=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},hX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},sn;(function(n){n[n.LEFT_TOP=0]="LEFT_TOP",n[n.RIGHT_TOP=1]="RIGHT_TOP",n[n.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(sn||(sn={}));var vX=(function(n){J_(e,n);function e(t){var o=n.call(this)||this;o.isShiftPressed=!1,o.bindKeyboardEvents=function(){document.addEventListener("keydown",o.handleKeyDown),document.addEventListener("keyup",o.handleKeyUp)},o.handleKeyDown=function(a){a.key==="Shift"&&(o.isShiftPressed=!0)},o.handleKeyUp=function(a){a.key==="Shift"&&(o.isShiftPressed=!1)},o.updateEdgePointByAnchors=function(){var a=o.nodeModel,l=a.id,u=a.anchors,c=o.graphModel.getNodeEdges(l);Lt(c,function(f){if(f.sourceNodeId===l){var p=Er(u,function(h){return h.id===f.sourceAnchorId});p&&f.updateStartPoint({x:p.x,y:p.y})}else if(f.targetNodeId===l){var p=Er(u,function(v){return v.id===f.targetAnchorId});p&&f.updateEndPoint({x:p.x,y:p.y})}})},o.triggerResizeEvent=function(a,l,u,c,f,p){o.graphModel.eventCenter.emit(pt.NODE_RESIZE,{preData:a,data:l,deltaX:u,deltaY:c,index:f,model:p})},o.recalcResizeInfo=function(a,l,u,c,f){u===void 0&&(u=1),c===void 0&&(c=!1),f===void 0&&(f=!1);var p=Dt(l),h=p.deltaX,v=p.deltaY,_=p.width,m=p.height,g=p.PCTResizeInfo;if(g){var b=4,C=0,D=0;switch(a){case sn.LEFT_TOP:D=(h*-1-v)/b;break;case sn.RIGHT_TOP:D=(h-v)/b;break;case sn.RIGHT_BOTTOM:D=(h+v)/b;break;case sn.LEFT_BOTTOM:D=(h*-1+v)/b;break}D!==0&&(C=Math.round(D/g.ResizeBasis.basisHeight*1e5)/1e3),g.ResizePCT.widthPCT=Math.max(Math.min(g.ResizePCT.widthPCT+C,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit),g.ResizePCT.heightPCT=Math.max(Math.min(g.ResizePCT.heightPCT+C,g.ScaleLimit.maxScaleLimit),g.ScaleLimit.minScaleLimit);var T=Math.round(g.ResizePCT.widthPCT*g.ResizeBasis.basisWidth/100),O=Math.round(g.ResizePCT.heightPCT*g.ResizeBasis.basisHeight/100);switch(a){case sn.LEFT_TOP:h=_-T,v=m-O;break;case sn.RIGHT_TOP:h=T-_,v=m-O;break;case sn.RIGHT_BOTTOM:h=T-_,v=O-m;break;case sn.LEFT_BOTTOM:h=_-T,v=O-m;break}return p}switch(a){case sn.LEFT_TOP:p.width=c?_:_-h*u,p.height=f?m:m-v*u;break;case sn.RIGHT_TOP:p.width=c?_:_+h*u,p.height=f?m:m-v*u;break;case sn.RIGHT_BOTTOM:p.width=c?_:_+h*u,p.height=f?m:m+v*u;break;case sn.LEFT_BOTTOM:p.width=c?_:_-h*u,p.height=f?m:m+v*u;break}return p},o.resizeNode=function(a){var l=a.deltaX,u=a.deltaY,c=o.index,f=o.props,p=f.model,h=f.graphModel,v=f.x,_=f.y;Z_({x:v,y:_,deltaX:l,deltaY:u,index:c,nodeModel:p,graphModel:h,forceProportional:o.isShiftPressed,cancelCallback:function(){o.dragHandler.cancelDrag()}})},o.onDragStart=function(){o.graphModel.selectNodeById(o.nodeModel.id)},o.onDragging=function(a){var l=a.deltaX,u=a.deltaY,c=o.graphModel.transformModel,f=hX(c.fixDeltaXY(l,u),2),p=f[0],h=f[1];o.resizeNode({deltaX:p,deltaY:h})},o.onDragEnd=function(){var a=o.nodeModel.x,l=o.nodeModel.y;o.nodeModel.moveTo(a,l),o.updateEdgePointByAnchors()};var i=t.index,r=t.model,s=t.graphModel;return o.index=i,o.nodeModel=r,o.graphModel=s,o.dragHandler=new Lo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:s.gridSize}),o.bindKeyboardEvents(),o}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.direction,s=t.model,a=s.getResizeControlStyle(),l=a.width,u=a.height,c=pX(a,["width","height"]);return Re("g",{className:"lf-resize-control lf-resize-control-".concat(r),children:[Re(Ao,Oa({className:"lf-resize-control-content",x:o,y:i,width:l??7,height:u??7},c)),Re(Ao,{className:"lf-resize-control-content",x:o,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onPointerDown:this.dragHandler.handleMouseDown})]})},e})(Yt),gX=(function(n){J_(e,n);function e(){return n.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=vo(o),s=r.minX,a=r.minY,l=r.maxX,u=r.maxY,c=[{index:sn.LEFT_TOP,direction:"nw",x:s,y:a},{index:sn.RIGHT_TOP,direction:"ne",x:l,y:a},{index:sn.RIGHT_BOTTOM,direction:"se",x:l,y:u},{index:sn.LEFT_BOTTOM,direction:"sw",x:s,y:u}];return Zo(c,function(f){return Re(vX,Oa({},f,{model:o,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Re(Ao,Oa({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Re("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e})(Yt);function _X(n,e){var t=n.x,o=n.y,i=e.x,r=e.y,s={x:t+(i-t)/2,y:o+(r-o)/2};return s}function Qs(n,e,t){var o=mX(t),i=n.x-e.x,r=n.y-e.y,s=i*Math.cos(o)-r*Math.sin(o)+e.x,a=i*Math.sin(o)+r*Math.cos(o)+e.y;return{x:s,y:a}}function mX(n){return n*Math.PI/180}function yX(n){return n/Math.PI*180}function bX(n,e,t,o,i,r,s,a){i===void 0&&(i=!1),r===void 0&&(r=!1);var l={x:t.x-(n.x-t.x),y:t.y-(n.y-t.y)},u=_X(l,e),c=Qs(e,u,-o),f=Qs(l,u,-o);if(i){var p=Math.abs(c.x-f.x),h=p-s;u.x>c.x?u.x=u.x+h/2:u.x=u.x-h/2}if(r){var v=Math.abs(c.y-f.y),_=v-a;u.y>c.y?u.y=u.y+_/2:u.y=u.y-_/2}if(i||r){var m=Qs(f,u,o),g=m.x-l.x,b=m.y-l.y;u.x=u.x-g,u.y=u.y-b,f=Qs(l,u,-o),c={x:u.x-(f.x-u.x),y:u.y-(f.y-u.y)}}var C=Math.abs(c.x-f.x),D=Math.abs(c.y-f.y);return i&&(C=s),r&&(D=a),{width:C,height:D,center:u}}function xX(n,e,t,o,i,r,s,a,l){a===void 0&&(a=!1),l===void 0&&(l=!1);var u=e.deltaX,c=e.deltaY,f=e.width,p=e.height,h=yX(t),v={x:o,y:i},_={x:r,y:s},m=Qs(v,_,h),g={x:m.x+u,y:m.y+c},b=bX(m,g,_,h,a,l,f,p),C=b.width,D=b.height,T=b.center;return e.width=C*n,e.height=D*n,e.deltaX=(T.x-_.x)*2,e.deltaY=(T.y-_.y)*2,e}var wX=function(n,e,t,o,i,r,s,a,l,u,c){t===void 0&&(t=1),o===void 0&&(o=!1),i===void 0&&(i=!1),r===void 0&&(r=0),c===void 0&&(c=!1);var f=Dt(e),p=f.deltaX,h=f.deltaY,v=f.width,_=f.height,m=f.PCTResizeInfo;if(m){var g=4,b=0,C=0;switch(n){case sn.LEFT_TOP:C=(p*-1-h)/g;break;case sn.RIGHT_TOP:C=(p-h)/g;break;case sn.RIGHT_BOTTOM:C=(p+h)/g;break;case sn.LEFT_BOTTOM:C=(p*-1+h)/g;break}C!==0&&(b=Math.round(C/m.ResizeBasis.basisHeight*1e5)/1e3),m.ResizePCT.widthPCT=Math.max(Math.min(m.ResizePCT.widthPCT+b,m.ScaleLimit.maxScaleLimit),m.ScaleLimit.minScaleLimit),m.ResizePCT.heightPCT=Math.max(Math.min(m.ResizePCT.heightPCT+b,m.ScaleLimit.maxScaleLimit),m.ScaleLimit.minScaleLimit);var D=Math.round(m.ResizePCT.widthPCT*m.ResizeBasis.basisWidth/100),T=Math.round(m.ResizePCT.heightPCT*m.ResizeBasis.basisHeight/100);switch(n){case sn.LEFT_TOP:p=v-D,h=_-T;break;case sn.RIGHT_TOP:p=D-v,h=_-T;break;case sn.RIGHT_BOTTOM:p=D-v,h=T-_;break;case sn.LEFT_BOTTOM:p=v-D,h=T-_;break}return f}if(r%(2*Math.PI)!==0&&s!==void 0&&a!==void 0)return xX(t,f,r,s,a,l,u,o,i);if(c){var O=v/_,k=0,S=v,N=_;switch(n){case sn.LEFT_TOP:k=Math.abs(p)>Math.abs(h)?-p:-h,O>=1?(S=v+k,N=S/O):(N=_+k,S=N*O),f.width=S,f.height=N,f.deltaX=v-S,f.deltaY=_-N;break;case sn.RIGHT_TOP:k=Math.abs(p)>Math.abs(h)?p:-h,O>=1?(S=v+k,N=S/O):(N=_-k,S=N*O),f.width=S,f.height=N,f.deltaX=S-v,f.deltaY=_-N;break;case sn.RIGHT_BOTTOM:k=Math.abs(p)>Math.abs(h)?p:h,O>=1?(S=v+k,N=S/O):(N=_+k,S=N*O),f.width=S,f.height=N,f.deltaX=S-v,f.deltaY=N-_;break;case sn.LEFT_BOTTOM:k=Math.abs(p)>Math.abs(h)?-p:h,O>=1?(S=v-k,N=S/O):(N=_+k,S=N*O),f.width=S,f.height=N,f.deltaX=v-S,f.deltaY=N-_;break}return f}switch(n){case sn.LEFT_TOP:f.width=o?v:v-p*t,f.height=i?_:_-h*t;break;case sn.RIGHT_TOP:f.width=o?v:v+p*t,f.height=i?_:_-h*t;break;case sn.RIGHT_BOTTOM:f.width=o?v:v+p*t,f.height=i?_:_+h*t;break;case sn.LEFT_BOTTOM:f.width=o?v:v-p*t,f.height=i?_:_+h*t;break}return f},CX=function(n,e){var t=n.id,o=n.anchors,i=e.getNodeEdges(t);Lt(i,function(r){if(r.sourceNodeId===t){var s=Er(o,function(a){return a.id===r.sourceAnchorId});s&&r.updateStartPoint({x:s.x,y:s.y})}else if(r.targetNodeId===t){var s=Er(o,function(l){return l.id===r.targetAnchorId});s&&r.updateEndPoint({x:s.x,y:s.y})}})},SX=function(n,e,t,o,i,r,s){s.eventCenter.emit(pt.NODE_RESIZE,{preData:n,data:e,deltaX:t,deltaY:o,index:i,model:r})},Z_=function(n){var e=n.x,t=n.y,o=n.deltaX,i=n.deltaY,r=n.index,s=n.nodeModel,a=n.graphModel,l=n.cancelCallback,u=n.forceProportional,c=u===void 0?!1:u,f=s.r,p=s.rx,h=s.ry,v=s.width,_=s.height,m=s.PCTResizeInfo,g=s.minWidth,b=s.minHeight,C=s.maxWidth,D=s.maxHeight,T=s.rotate,O=s.x,k=s.y,S=g===C,N=b===D,L={width:f||p||v,height:f||h||_,deltaX:o,deltaY:i,PCTResizeInfo:m},$=f||p&&h?1/2:1,B=e,E=t,A=wX(r,L,$,S,N,T,B,E,O,k,c);if(A.width<g||A.width>C||A.height<b||A.height>D){l==null||l();return}(T%(2*Math.PI)==0||m||B===void 0||E===void 0)&&(A.deltaX=S?0:A.deltaX,A.deltaY=N?0:A.deltaY);var M=s.getData(),F=s.resize(A);M.x===F.x&&M.y===F.y||(CX(s,a),SX(M,F,o,i,r,s,a))},kX=100,EX={x:1,y:0};function DX(n,e,t,o,i){for(var r=function(h){if(h<0||h>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:n.x*Math.pow(1-h,3)+3*e.x*h*Math.pow(1-h,2)+3*t.x*Math.pow(h,2)*(1-h)+o.x*Math.pow(h,3),y:n.y*Math.pow(1-h,3)+3*e.y*h*Math.pow(1-h,2)+3*t.y*Math.pow(h,2)*(1-h)+o.y*Math.pow(h,3)}},s=0,a=2,l=o.x,u=o.y,c=o;s<i&&a<50;){c=r(1-a/kX);var f=c.x,p=c.y;s=Xo(l,u,f,p),a++}return c}function AX(n,e){return n.x*e.y-n.y*e.x}function OX(n,e){var t=[n.x,n.y,n.z],o=[e.x,e.y,e.z];return o.reduce(function(i,r,s){return i+r*t[s]})}function NX(n,e){var t=AX(n,e),o=Math.acos(OX(Gh(n),Gh(e)));return t>=0?o:-o}function Gh(n){var e=Math.hypot(n.x,n.y);return{x:n.x/e,y:n.y/e,z:0}}function MX(n){return NX(EX,n)}function TX(n){return n*(180/Math.PI)}var Q_={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},$X={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},PX={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},RX={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Na={colorful:RX,dark:PX,radius:$X,default:Q_},BX={background:"#23272e"},LX={background:"#fefeff"},yc={background:"#ffffff"},Ma={colorful:LX,dark:BX,radius:yc,default:yc},IX={color:"#66676a",thickness:1},FX={color:"#dadada",thickness:1},bc={color:"#acacac",thickness:1},Ta={colorful:FX,dark:IX,radius:bc,default:bc},em=function(n,e){var t=Dt(Q_);return e&&(t=ss(t,Na[e])),n&&(t=ss(t,n)),t},jX=function(n,e){if(Na[n]){console.warn("theme mode ".concat(n," already exists"));return}Na[n]=e,Ma[n]=e.background||yc,Ta[n]=e.grid||bc},VX=function(n){delete Na[n],delete Ma[n],delete Ta[n]},Xh=function(){var n={colorful:{},dark:{},radius:{},default:{}};an(Na,n),an(Ma,n),an(Ta,n)},HX=em,UX=1e3,zX=999,$a=function(){return++UX},qX=function(){return--zX},On=function(){return On=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},On.apply(this,arguments)},wt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Ku=(function(){function n(e,t){var o;this.BaseType=Sn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=Mo.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=en.DEFAULT,this.modelType=zt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initEdgeData(e),this.setAttributes()}return n.prototype.initEdgeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||Ji()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var s=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=s,an(this,IG(e));var a=this.graphModel,l=a.overlapMode,u=a.eventCenter;this.updateZIndexByOverlap(l,e.zIndex||$a()),this.setAnchors(),this.initPoints(),this.formatText(e),u.on("overlap:change",function(c){var f=c.overlapMode;t.updateZIndexByOverlap(f,t.zIndex||$a())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.getEdgeStyle=function(){return On(On({},this.graphModel.theme.baseEdge),this.style)},n.prototype.getAdjustPointStyle=function(){return On({},this.graphModel.theme.edgeAdjust)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Dt(e)},n.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Dt(e)},n.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),o=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return On(On(On({},e),{fill:i,stroke:i}),o)},n.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Dt(t)},n.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(n.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),n.prototype.getBeginAnchor=function(e,t,o){var i,r,s=cc(e);if(o){if(i=Er(s,function(a){return a.id===o}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(o,"，已使用默认锚点作为起点"))}return s.forEach(function(a){var l=Ih(a,t);(r===void 0||l<r)&&(r=l,i=a)}),i},n.prototype.getEndAnchor=function(e,t){var o=this,i,r,s=cc(e);if(t){if(i=Er(s,function(a){return a.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return s.forEach(function(a){if(o.startPoint){var l=Ih(a,o.startPoint);(r===void 0||l<r)&&(r=l,i=a)}}),i},n.prototype.getProperties=function(){return Uo(this.properties)},n.prototype.getData=function(){var e=this.properties;_s(e)&&(e=Uo(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:an({},this.startPoint),endPoint:an({},this.endPoint)};[Ln.INCREASE,Ln.STATIC].includes(this.graphModel.overlapMode)&&(t.zIndex=this.zIndex);var o=this.text,i=o.x,r=o.y,s=o.value;return s&&(t.text={x:i,y:r,value:s}),t},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.setProperty=function(e,t){Df(this.properties,e,Jn(t)),this.setAttributes()},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setProperties=function(e){this.properties=On(On({},Uo(this.properties)),Jn(e)),this.setAttributes()},n.prototype.changeEdgeId=function(e){var t=this.arrowConfig,o=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),o&&o==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},n.prototype.setStyle=function(e,t){var o;this.style=On(On({},this.style),(o={},o[e]=Jn(t),o))},n.prototype.setStyles=function(e){this.style=On(On({},this.style),Jn(e))},n.prototype.updateStyles=function(e){this.style=On({},Jn(e))},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.edgeTextDraggable,a=r.edgeTextEdit,l=this.textPosition,u=l.x,c=l.y,f=e.text,p={value:"",x:u,y:c,draggable:s,editable:a};f&&(typeof f=="string"?p=On(On({},p),{value:f}):(p=On(On({},p),{x:(t=f.x)!==null&&t!==void 0?t:u,y:(o=f.y)!==null&&o!==void 0?o:c,value:(i=f.value)!==null&&i!==void 0?i:""}),as(f.draggable)||(p.draggable=f.draggable),as(f.editable)||(p.editable=f.editable))),this.text=p},n.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,o=e.y;this.text.x=t,this.text.y=o},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.setText=function(e){e&&an(this.text,e)},n.prototype.updateText=function(e){this.text=On(On({},Uo(this.text)),{value:e})},n.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.openEdgeAnimation=function(){this.isAnimation=!0},n.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateStartPoint=function(e){this.startPoint=e},n.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},n.prototype.updateEndPoint=function(e){this.endPoint=e},n.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},n.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},n.prototype.initPoints=function(){},n.prototype.updateAttributes=function(e){an(this,e)},n.prototype.getAdjustStart=function(){return this.startPoint},n.prototype.getAdjustEnd=function(){return this.endPoint},n.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,o=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:o.x,y:o.y})},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case Ln.DEFAULT:this.zIndex=0;break;case Ln.EDGE_TOP:this.zIndex=1;break;case Ln.INCREASE:this.zIndex=t;break}},n.BaseType=Sn.EDGE,wt([Pe],n.prototype,"type",void 0),wt([Pe],n.prototype,"sourceNodeId",void 0),wt([Pe],n.prototype,"targetNodeId",void 0),wt([Pe],n.prototype,"startPoint",void 0),wt([Pe],n.prototype,"endPoint",void 0),wt([Pe],n.prototype,"textMode",void 0),wt([Pe],n.prototype,"text",void 0),wt([Pe],n.prototype,"properties",void 0),wt([Pe],n.prototype,"points",void 0),wt([Pe],n.prototype,"pointsList",void 0),wt([Pe],n.prototype,"isSelected",void 0),wt([Pe],n.prototype,"isHovered",void 0),wt([Pe],n.prototype,"isHitable",void 0),wt([Pe],n.prototype,"isHittable",void 0),wt([Pe],n.prototype,"draggable",void 0),wt([Pe],n.prototype,"visible",void 0),wt([Pe],n.prototype,"isAnimation",void 0),wt([Pe],n.prototype,"isShowAdjustPoint",void 0),wt([Pe],n.prototype,"zIndex",void 0),wt([Pe],n.prototype,"state",void 0),wt([Pe],n.prototype,"style",void 0),wt([Pe],n.prototype,"arrowConfig",void 0),wt([mn],n.prototype,"sourceNode",null),wt([mn],n.prototype,"targetNode",null),wt([mn],n.prototype,"textPosition",null),wt([Te],n.prototype,"setProperty",null),wt([Te],n.prototype,"deleteProperty",null),wt([Te],n.prototype,"setProperties",null),wt([Te],n.prototype,"changeEdgeId",null),wt([Te],n.prototype,"setStyle",null),wt([Te],n.prototype,"setStyles",null),wt([Te],n.prototype,"updateStyles",null),wt([Te],n.prototype,"setTextMode",null),wt([Te],n.prototype,"formatText",null),wt([Te],n.prototype,"resetTextPosition",null),wt([Te],n.prototype,"moveText",null),wt([Te],n.prototype,"setText",null),wt([Te],n.prototype,"updateText",null),wt([Te],n.prototype,"setAnchors",null),wt([Te],n.prototype,"setSelected",null),wt([Te],n.prototype,"setHovered",null),wt([Te],n.prototype,"setHitable",null),wt([Te],n.prototype,"setHittable",null),wt([Te],n.prototype,"openEdgeAnimation",null),wt([Te],n.prototype,"closeEdgeAnimation",null),wt([Te],n.prototype,"setElementState",null),wt([Te],n.prototype,"updateStartPoint",null),wt([Te],n.prototype,"moveStartPoint",null),wt([Te],n.prototype,"updateEndPoint",null),wt([Te],n.prototype,"moveEndPoint",null),wt([Te],n.prototype,"setZIndex",null),wt([Te],n.prototype,"initPoints",null),wt([Te],n.prototype,"updateAttributes",null),wt([Te],n.prototype,"getAdjustStart",null),wt([Te],n.prototype,"getAdjustEnd",null),wt([Te],n.prototype,"updateAfterAdjustStartAndEnd",null),wt([Te],n.prototype,"updateZIndexByOverlap",null),n})(),GX=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),gr=function(){return gr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gr.apply(this,arguments)},Co=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},xc=(function(n){GX(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=Ha(t,"properties.offset",100),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return gr(gr(gr({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,o=0;return this.pointsList.forEach(function(i){var r=i.x,s=i.y;t+=r,o+=s}),{x:t/this.pointsList.length,y:o/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return gr(gr({},t),{pointsList:o})},e.prototype.getControls=function(){var t=this.startPoint,o=this.endPoint,i=Bh({start:t,end:o,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var o=bd(t,4),i=o[0],r=o[1],s=o[2],a=o[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(r.x," ").concat(r.y,`,
    `).concat(s.x," ").concat(s.y,`,
    `).concat(a.x," ").concat(a.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),o=t.sNext,i=t.ePre;this.updatePath(o,i)},e.prototype.updatePath=function(t,o){t=Dt(t),o=Dt(o);var i={x:this.startPoint.x,y:this.startPoint.y},r={x:this.endPoint.x,y:this.endPoint.y};if(!t||!o){var s=this.getControls();t=s.sNext,o=s.ePre}this.pointsList=[i,t,o,r],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o;var i=bd(this.pointsList,3),r=i[1],s=i[2];r.x+=t,r.y+=o,this.updatePath(r,s)},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o;var i=bd(this.pointsList,3),r=i[1],s=i[2];s.x+=t,s.y+=o,this.updatePath(r,s)},e.prototype.updateAdjustAnchor=function(t,o){var i;o==="sNext"?this.pointsList[1]=t:o==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode,a=Bh({start:o,end:i,sourceNode:r,targetNode:s,offset:this.offset}),l=a.sNext,u=a.ePre;this.pointsList=[o,l,u,i],this.initPoints()},Co([Pe],e.prototype,"offset",void 0),Co([Pe],e.prototype,"path",void 0),Co([Te],e.prototype,"initPoints",null),Co([Te],e.prototype,"updatePoints",null),Co([Te],e.prototype,"updateStartPoint",null),Co([Te],e.prototype,"updateEndPoint",null),Co([Te],e.prototype,"moveStartPoint",null),Co([Te],e.prototype,"moveEndPoint",null),Co([Te],e.prototype,"updateAdjustAnchor",null),Co([Te],e.prototype,"getAdjustStart",null),Co([Te],e.prototype,"getAdjustEnd",null),Co([Te],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ku),XX=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),oa=function(){return oa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},oa.apply(this,arguments)},Wh=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},WX=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Yh=(function(n){XX(e,n);function e(){var t=n.apply(this,WX([],Wh(arguments),!1))||this;return t.modelType=zt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return oa(oa(oa({},o),Dt(t)),Dt(r))},e.prototype.initEdgeData=function(t){n.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var o=Wh(t,2),i=o[0],r=o[1];return"".concat(i.x,",").concat(i.y," ").concat(r.x,",").concat(r.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e})(Ku),YX=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ia=function(){return ia=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ia.apply(this,arguments)},zn=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Kh=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},KX=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},ws=(function(n){YX(e,n);function e(){var t=n.apply(this,KX([],Kh(arguments),!1))||this;return t.modelType=zt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=Ha(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return ia(ia(ia({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){var t,o=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!o){var i=this.dbClickPosition,r=i.x,s=i.y;return{x:r,y:s}}var a=Nr(this.points),l=Kh(RG(a),2),u=l[0],c=l[1];return{x:(u.x+c.x)/2,y:(u.y+c.y)/2}},e.prototype.getAfterAnchor=function(t,o,i){var r,s;return i.forEach(function(a){var l;t===xn.HORIZONTAL?l=Math.abs(o.y-a.y):t===xn.VERTICAL&&(l=Math.abs(o.x-a.x)),(!s||s>l)&&(s=l,r=a)}),r},e.prototype.getCrossPoint=function(t,o,i){var r;return t===xn.HORIZONTAL?r={x:i.x,y:o.y}:t===xn.VERTICAL&&(r={x:o.x,y:i.y}),r},e.prototype.removeCrossPoints=function(t,o,i){var r=i.map(function(g){return g});if(t===1){var s=r[t],a=r[o],l=r[t-1],u=Th(l,s,this.sourceNode);if(u){var c=$h(s,a,this.sourceNode);if(c){var f=Ph(s,a,this.sourceNode);f&&(r[t]=f,r.splice(t-1,1),t--,o--)}}else{var p=this.sourceNode.anchors;p.forEach(function(g){if(g.x===l.x&&g.x===s.x||g.y===l.y&&g.y===s.y){var b=Xo(g.x,g.y,s.x,s.y),C=Xo(l.x,l.y,s.x,s.y);b<C&&(r[t-1]=g)}})}}if(o===i.length-2){var h=r[t],v=r[o],_=r[o+1],m=Th(v,_,this.targetNode);if(m){var c=$h(h,v,this.targetNode);if(c){var f=Ph(h,v,this.targetNode);f&&(r[o]=f,r.splice(o+1,1))}}else{var p=this.targetNode.anchors;p.forEach(function(b){if(b.x===_.x&&b.x===v.x||b.y===_.y&&b.y===v.y){var C=Xo(b.x,b.y,v.x,v.y),D=Xo(_.x,_.y,v.x,v.y);C<D&&(r[o+1]=b)}})}}return r},e.prototype.getDraggingPoints=function(t,o,i,r,s){var a=s.map(function(c){return c}),l=this.getAfterAnchor(t,i,r),u=this.getCrossPoint(t,i,l);return o==="start"?(a.unshift(u),a.unshift(l)):(a.push(u),a.push(l)),a},e.prototype.updateCrossPoints=function(t){var o=t.map(function(b){return b}),i=t[0],r=t[1],s=t[o.length-2],a=t[o.length-1],l=this,u=l.sourceNode,c=l.targetNode,f=u.modelType,p=c.modelType,h=Ql(i,r),v=o[0];switch(f){case zt.RECT_NODE:if(u.radius!==0){var _=Vh(i,u);_||(v=jh(i,h,u))}break;case zt.CIRCLE_NODE:v=fc(i,h,u);break;case zt.ELLIPSE_NODE:v=Hh(i,h,u);break;case zt.DIAMOND_NODE:v=pl(i,h,u);break;case zt.POLYGON_NODE:v=pl(i,h,u);break}v&&(o[0]=v);var m=Ql(s,a),g=o[o.length-1];switch(p){case zt.RECT_NODE:if(c.radius!==0){var _=Vh(a,c);_||(g=jh(a,m,c))}break;case zt.CIRCLE_NODE:g=fc(a,m,c);break;case zt.ELLIPSE_NODE:g=Hh(a,m,c);break;case zt.DIAMOND_NODE:g=pl(a,m,c);break;case zt.POLYGON_NODE:g=pl(a,m,c);break}return g&&(o[o.length-1]=g),o},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return Object.assign({},t,{pointsList:o})},e.prototype.getPath=function(t){return t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=Mh({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o,this.updatePoints()},e.prototype.updatePointsList=function(t,o){this.pointsList.forEach(function(s){s.x+=t,s.y+=o});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var r=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},r),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,u=t.direction,c=this.pointsList,f=c;return u===xn.HORIZONTAL?(c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y},f=this.pointsList.map(function(p){return p})):u===xn.VERTICAL&&(c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y},f=this.pointsList.map(function(p){return p})),this.updatePointsAfterDrag(f),this.draggingPointList=f,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition)),{start:an({},c[a]),end:an({},c[l]),startIndex:a,endIndex:l,direction:u}},e.prototype.dragAppend=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,u=t.direction,c=this.pointsList;if(u===xn.HORIZONTAL){c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y};var f=this.pointsList.map(function(m){return m});if(a!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(a,l,f)),a===0){var p={x:r.x,y:r.y+o.y},h=Ai(p,this.sourceNode);if(!h){var v=this.sourceNode.anchors;f=this.getDraggingPoints(u,"start",p,v,f)}}if(l===this.pointsList.length-1){var _={x:s.x,y:s.y+o.y},h=Ai(_,this.targetNode);if(!h){var v=this.targetNode.anchors;f=this.getDraggingPoints(u,"end",_,v,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}else if(u===xn.VERTICAL){c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y};var f=this.pointsList.map(function(g){return g});if(a!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(a,l,f)),a===0){var p={x:r.x+o.x,y:r.y},h=Ai(p,this.sourceNode);if(!h){var v=this.sourceNode.anchors;f=this.getDraggingPoints(u,"start",p,v,f)}}if(l===this.pointsList.length-1){var _={x:s.x+o.x,y:s.y},h=Ai(_,this.targetNode);if(!h){var v=this.targetNode.anchors;f=this.getDraggingPoints(u,"end",_,v,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition)),{start:an({},c[a]),end:an({},c[l]),startIndex:a,endIndex:l,direction:u}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=U_(Nr(this.points));this.pointsList=t.map(function(r){return r}),this.draggingPointList=[];var o=t[0];this.startPoint=an({},o);var i=t[t.length-1];this.endPoint=an({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var o=this.updateCrossPoints(t);this.points=o.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode;this.pointsList=Mh({x:o.x,y:o.y},{x:i.x,y:i.y},r,s,this.offset||0),this.initPoints()},zn([Pe],e.prototype,"offset",void 0),zn([Pe],e.prototype,"dbClickPosition",void 0),zn([Te],e.prototype,"initPoints",null),zn([Te],e.prototype,"updatePoints",null),zn([Te],e.prototype,"updateStartPoint",null),zn([Te],e.prototype,"moveStartPoint",null),zn([Te],e.prototype,"updateEndPoint",null),zn([Te],e.prototype,"moveEndPoint",null),zn([Te],e.prototype,"updatePointsList",null),zn([Te],e.prototype,"dragAppendStart",null),zn([Te],e.prototype,"dragAppendSimple",null),zn([Te],e.prototype,"dragAppend",null),zn([Te],e.prototype,"dragAppendEnd",null),zn([Te],e.prototype,"updatePointsAfterDrag",null),zn([Te],e.prototype,"getAdjustStart",null),zn([Te],e.prototype,"getAdjustEnd",null),zn([Te],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ku),Rn=function(){return Rn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Rn.apply(this,arguments)},Et=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Jh=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},JX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},rr=(function(){function n(e,t){var o;this.BaseType=Sn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=Mo.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=en.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=zt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,o=t.x,i=o===void 0?0:o,r=t.y,s=r===void 0?0:r;this.transform=new eu(-i,-s).rotate(e).translate(i,s).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),n.prototype.initNodeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||Ji()}this.formatText(e),an(this,YG(e));var s=this.graphModel,a=s.overlapMode,l=s.eventCenter;this.updateZIndexByOverlap(a,e.zIndex||$a()),l.on("overlap:change",function(u){var c=u.overlapMode;t.updateZIndexByOverlap(c,t.zIndex||$a())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.nodeTextDraggable,a=r.nodeTextEdit,l=e.x,u=e.y,c=e.text,f={value:"",x:l,y:u,draggable:s,editable:a};c&&(typeof c=="string"?f.value=c:(f=Rn(Rn({},f),{x:(t=c.x)!==null&&t!==void 0?t:l,y:(o=c.y)!==null&&o!==void 0?o:u,value:(i=c.value)!==null&&i!==void 0?i:""}),as(c.draggable)||(f.draggable=c.draggable),as(c.editable)||(f.editable=c.editable))),e.text=f},n.prototype.resize=function(e){var t=e.width,o=e.height,i=e.deltaX,r=e.deltaY,s=this.isAllowResizeNode(i,r,t,o);return s?(this.move(i/2,r/2),this.width=t,this.height=o,this.setProperties({width:t,height:o}),this.getData()):this.getData()},n.prototype.proportionalResize=function(){},n.prototype.getData=function(){var e=this.text,t=e.x,o=e.y,i=e.value,r=this.properties;_s(r)&&(r=Uo(r)),Qn(r.width)&&(r.width=this.width),Qn(r.height)&&(r.height=this.height);var s={id:this.id,type:this.type,x:this.x,y:this.y,properties:r};return this.rotate&&(s.rotate=this.rotate),[Ln.INCREASE,Ln.STATIC].includes(this.graphModel.overlapMode)&&(s.zIndex=this.zIndex),i&&(s.text={x:t,y:o,value:i}),s},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.getProperties=function(){return Uo(this.properties)},n.prototype.getOuterGAttributes=function(){return{className:""}},n.prototype.getNodeStyle=function(){return Rn(Rn({},this.graphModel.theme.baseNode),this.style)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,o=t===void 0?{}:t;return Rn(Rn({},Dt(e)),Dt(o))},n.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Dt(e)},n.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Dt(e)},n.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Dt(e)},n.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Dt(t)},n.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Dt(t)},n.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Dt(e)},n.prototype.isAllowConnectedAsSource=function(e,t,o,i){var r=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var u=r[l];if(!u.validate.call(this,this,e,t,o,i)){s=!1,a=u.message;break}}return{isAllPass:s,msg:a}},n.prototype.getConnectedSourceRules=function(){return this.sourceRules},n.prototype.isAllowConnectedAsTarget=function(e,t,o,i){var r=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var u=r[l];if(!u.validate.call(this,e,this,t,o,i)){s=!1,a=u.message;break}}return{isAllPass:s,msg:a}},n.prototype.isAllowMoveNode=function(e,t){var o,i,r=!0,s=!0,a=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var l=Jh(a),u=l.next();!u.done;u=l.next()){var c=u.value,f=c(this,e,t);if(!f)return!1;if(typeof f=="object"){var p=f;if(!p.x&&!p.y)return!1;r=r&&p.x,s=s&&p.y}}}catch(h){o={error:h}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}return{x:r,y:s}},n.prototype.getConnectedTargetRules=function(){return this.targetRules},n.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,o=e.id,i=e.x,r=e.y;return t&&t.length>0?t.map(function(s,a){return s.length?(s=s,{id:"".concat(o,"_").concat(a),x:i+s[0],y:r+s[1]}):(s=s,Rn(Rn({},s),{x:i+s.x,y:r+s.y,id:s.id||"".concat(o,"_").concat(a)}))}):this.getDefaultAnchor()},n.prototype.getDefaultAnchor=function(){return[]},n.prototype.getTargetAnchor=function(e){return GG(e,this)},n.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(n.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,o=t.x,i=t.y,r=t.rotate;return e.forEach(function(s){var a=s.x,l=s.y,u=JX(new Ka([a,l,1]).translate(-o,-i).rotate(r).translate(o,i)[0],2),c=u[0],f=u[1];s.x=c,s.y=f}),e},enumerable:!1,configurable:!0}),n.prototype.getAnchorInfo=function(e){if(!Qn(e))for(var t=0;t<this.anchors.length;t++){var o=this.anchors[t];if(o.id===e)return o}},n.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},n.prototype.isAllowMoveByXORY=function(e,t,o){var i,r;if(o)i=!0,r=!0;else{var s=this.isAllowMoveNode(e,t);typeof s=="boolean"?(i=s,r=s):(i=s.x,r=s.y)}return{isAllowMoveX:i,isAllowMoveY:r}},n.prototype.move=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY;return r&&(this.x=this.x+e,this.text&&this.moveText(e,0)),s&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(r||s)&&(this.rotate=this._rotate),r||s},n.prototype.getMoveDistance=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY,a=0,l=0;return r&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),a=e),s&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),l=t),this.transform=new eu(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[a,l]},n.prototype.moveTo=function(e,t,o){o===void 0&&(o=!1);var i=e-this.x,r=t-this.y;return!o&&!this.isAllowMoveNode(i,r)?!1:(this.text&&this.moveText(i,r),this.x=e,this.y=t,!0)},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.updateText=function(e){this.text=Rn(Rn({},Uo(this.text)),{value:e})},n.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},n.prototype.isAllowResizeNode=function(e,t,o,i){var r,s,a=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var l=Jh(a),u=l.next();!u.done;u=l.next()){var c=u.value,f=c(this,e,t,o,i);if(!f)return!1}}catch(p){r={error:p}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}return!0},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},n.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},n.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},n.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateProperties=function(e,t){var o=Uo(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(pt.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:o,properties:e})},n.prototype.setProperty=function(e,t){var o=Uo(this.properties),i=Dt(o);Dy(i,e,Jn(t)),this.updateProperties(i,[e])},n.prototype.setProperties=function(e){var t=Uo(this.properties),o=Rn(Rn({},t),Jn(e)),i=[];Ay(e,function(r,s){(_a(t,s)&&t[s]!==r||!_a(t,s))&&i.push(s)}),this.updateProperties(o,i)},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setStyle=function(e,t){var o;this.style=Rn(Rn({},this.style),(o={},o[e]=Jn(t),o))},n.prototype.setStyles=function(e){this.style=Rn(Rn({},this.style),Jn(e))},n.prototype.updateStyles=function(e){this.style=Rn({},Jn(e))},n.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},n.prototype.updateAttributes=function(e){an(this,e)},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case Ln.DEFAULT:this.zIndex=1;break;case Ln.EDGE_TOP:this.zIndex=0;break;case Ln.INCREASE:this.zIndex=t;break}},n.BaseType=Sn.NODE,Et([Pe],n.prototype,"type",void 0),Et([Pe],n.prototype,"x",void 0),Et([Pe],n.prototype,"y",void 0),Et([Pe],n.prototype,"textMode",void 0),Et([Pe],n.prototype,"text",void 0),Et([Pe],n.prototype,"properties",void 0),Et([Pe],n.prototype,"_width",void 0),Et([Pe],n.prototype,"_height",void 0),Et([Pe],n.prototype,"anchorsOffset",void 0),Et([Pe],n.prototype,"isSelected",void 0),Et([Pe],n.prototype,"isHovered",void 0),Et([Pe],n.prototype,"isShowAnchor",void 0),Et([Pe],n.prototype,"isDragging",void 0),Et([Pe],n.prototype,"isHitable",void 0),Et([Pe],n.prototype,"isHittable",void 0),Et([Pe],n.prototype,"draggable",void 0),Et([Pe],n.prototype,"visible",void 0),Et([Pe],n.prototype,"rotatable",void 0),Et([Pe],n.prototype,"resizable",void 0),Et([Pe],n.prototype,"zIndex",void 0),Et([Pe],n.prototype,"state",void 0),Et([Pe],n.prototype,"autoToFront",void 0),Et([Pe],n.prototype,"style",void 0),Et([Pe],n.prototype,"transform",void 0),Et([Pe],n.prototype,"_rotate",void 0),Et([mn],n.prototype,"incoming",null),Et([mn],n.prototype,"outgoing",null),Et([Te],n.prototype,"setTextMode",null),Et([Te],n.prototype,"addNodeMoveRules",null),Et([Te],n.prototype,"move",null),Et([Te],n.prototype,"getMoveDistance",null),Et([Te],n.prototype,"moveTo",null),Et([Te],n.prototype,"moveText",null),Et([Te],n.prototype,"updateText",null),Et([Te],n.prototype,"addNodeResizeRules",null),Et([Te],n.prototype,"setSelected",null),Et([Te],n.prototype,"setHovered",null),Et([Te],n.prototype,"setIsShowAnchor",null),Et([Te],n.prototype,"setRotatable",null),Et([Te],n.prototype,"setResizable",null),Et([Te],n.prototype,"setHitable",null),Et([Te],n.prototype,"setHittable",null),Et([Te],n.prototype,"setElementState",null),Et([Te],n.prototype,"setProperty",null),Et([Te],n.prototype,"setProperties",null),Et([Te],n.prototype,"deleteProperty",null),Et([Te],n.prototype,"setStyle",null),Et([Te],n.prototype,"setStyles",null),Et([Te],n.prototype,"updateStyles",null),Et([Te],n.prototype,"setZIndex",null),Et([Te],n.prototype,"updateAttributes",null),Et([Te],n.prototype,"updateZIndexByOverlap",null),n})(),ZX=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ra=function(){return ra=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ra.apply(this,arguments)},xd=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},su=(function(n){ZX(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.circle,i=this.properties.style,r=i===void 0?{}:i;return ra(ra(ra({},t),Dt(o)),Dt(r))},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.r;return[{x:o,y:i-r,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+r,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.deltaX,r=t.deltaY;return this.move(i/2,r/2),this.r=o,this.setProperties({r:o}),this.getData()},xd([Pe],e.prototype,"r",void 0),xd([mn],e.prototype,"width",null),xd([mn],e.prototype,"height",null),e})(rr),QX=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),sa=function(){return sa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},sa.apply(this,arguments)},Ur=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},vl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},wc=(function(n){QX(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.diamond,i=this.properties.style,r=i===void 0?{}:i;return sa(sa(sa({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[[o,i-s],[o+r,i],[o,i+s],[o-r,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return Zo(this.points,function(t){var o=vl(t,2),i=o[0],r=o[1];return{x:i,y:r}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Lt(this.points,function(i){var r=vl(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Lt(this.points,function(i){var r=vl(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return Zo(this.points,function(o,i){var r=vl(o,2),s=r[0],a=r[1];return{x:s,y:a,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},Ur([Pe],e.prototype,"rx",void 0),Ur([Pe],e.prototype,"ry",void 0),Ur([mn],e.prototype,"points",null),Ur([mn],e.prototype,"pointsPosition",null),Ur([mn],e.prototype,"width",null),Ur([mn],e.prototype,"height",null),e})(rr),eW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),aa=function(){return aa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},aa.apply(this,arguments)},gl=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Cc=(function(n){eW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.ellipse,i=this.properties.style,r=i===void 0?{}:i;return aa(aa(aa({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[{x:o,y:i-s,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},gl([Pe],e.prototype,"rx",void 0),gl([Pe],e.prototype,"ry",void 0),gl([mn],e.prototype,"width",null),gl([mn],e.prototype,"height",null),e})(rr),tW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),la=function(){return la=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},la.apply(this,arguments)},_l=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},ml=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},au=(function(n){tW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.points,i=t.width,r=t.height,s=o||this.points;this.points=VG(s,i,r)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.polygon,i=this.properties.style,r=i===void 0?{}:i;return la(la(la({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return this.points.map(function(a){return{x:a[0]+o-r/2,y:a[1]+i-s/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=ml(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=ml(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=this,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points;return l.map(function(u,c){var f=ml(u,2),p=f[0],h=f[1];return{x:i+p-s/2,y:r+h-a/2,id:"".concat(t.id,"_").concat(c)}})},e.prototype.resize=function(t){var o=this,i=t.width,r=t.height,s=t.deltaX,a=t.deltaY;this.move(s/2,a/2);var l=Zo(this.points,function(u){var c=ml(u,2),f=c[0],p=c[1];return[f*i/o.width,p*r/o.height]});return this.points=l,this.properties.points=l,this.getData()},_l([Pe],e.prototype,"points",void 0),_l([mn],e.prototype,"pointsPosition",null),_l([mn],e.prototype,"width",null),_l([mn],e.prototype,"height",null),e})(rr),nW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ua=function(){return ua=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ua.apply(this,arguments)},oW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Cs=(function(n){nW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height,r=t.radius,s=this.getNodeStyle().radius;Qn(o)||(this.width=o),Qn(i)||(this.height=i),Qn(r)||(this.radius=r),Qn(s)||(this.radius=s)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.rect,i=this.properties.style,r=i===void 0?{}:i;return ua(ua(ua({},t),Dt(o)),Dt(r))},oW([Pe],e.prototype,"radius",void 0),e})(rr),iW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),da=function(){return da=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},da.apply(this,arguments)},Zh=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},rW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},sW=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Qh=(function(n){iW(e,n);function e(){var t=n.apply(this,sW([],rW(arguments),!1))||this;return t.modelType=zt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=n.prototype.getTextStyle.call(this),o=this.graphModel.theme.text,i=this.properties.textStyle;return da(da(da({},t),Dt(o)),Dt(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=zh({rows:t,fontSize:o,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=zh({rows:t,fontSize:o,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),Zh([mn],e.prototype,"width",null),Zh([mn],e.prototype,"height",null),e})(rr),aW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Pa=(function(n){aW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height;o&&(this.width=o),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e})(rr),rn=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},lW={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},yl=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical","isPinching"],uW=(function(){function n(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.isPinching=!1,this.textMode=Mo.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=Mo.TEXT,this.edgeTextMode=Mo.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",an(this,this.computeConfig(e))}return n.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);an(this,t)},n.prototype.computeConfig=function(e){var t=e.isSilentMode,o=e.textDraggable,i=e.textMode,r=e.textEdit,s=e.adjustEdgeStartAndEnd,a={};if(t===!1&&an(a,this.stagedConfig),t===!0&&t!==this.isSilentMode){var l=Kr(lW,yl);this.stagedConfig=Kr(this,yl),an(a,l)}as(r)||an(a,{nodeTextEdit:r,edgeTextEdit:r}),as(o)||an(a,{nodeTextDraggable:o,edgeTextDraggable:o}),i&&an(a,{nodeTextMode:i,edgeTextMode:i}),jd(s)&&an(a,{adjustEdgeStart:s,adjustEdgeEnd:s});var u=Kr(e,yl);return an(a,u)},n.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},n.prototype.getConfig=function(){return Kr(this,yl)},rn([Pe],n.prototype,"isSilentMode",void 0),rn([Pe],n.prototype,"stopZoomGraph",void 0),rn([Pe],n.prototype,"stopMoveGraph",void 0),rn([Pe],n.prototype,"stopScrollGraph",void 0),rn([Pe],n.prototype,"snapGrid",void 0),rn([Pe],n.prototype,"isPinching",void 0),rn([Pe],n.prototype,"textMode",void 0),rn([Pe],n.prototype,"textEdit",void 0),rn([Pe],n.prototype,"textDraggable",void 0),rn([Pe],n.prototype,"nodeTextEdit",void 0),rn([Pe],n.prototype,"nodeTextDraggable",void 0),rn([Pe],n.prototype,"nodeTextMultiple",void 0),rn([Pe],n.prototype,"nodeTextVertical",void 0),rn([Pe],n.prototype,"nodeTextMode",void 0),rn([Pe],n.prototype,"edgeTextMode",void 0),rn([Pe],n.prototype,"edgeTextEdit",void 0),rn([Pe],n.prototype,"edgeTextDraggable",void 0),rn([Pe],n.prototype,"edgeTextMultiple",void 0),rn([Pe],n.prototype,"edgeTextVertical",void 0),rn([Pe],n.prototype,"hideAnchors",void 0),rn([Pe],n.prototype,"allowRotate",void 0),rn([Pe],n.prototype,"allowResize",void 0),rn([Pe],n.prototype,"hoverOutline",void 0),rn([Pe],n.prototype,"nodeSelectedOutline",void 0),rn([Pe],n.prototype,"adjustNodePosition",void 0),rn([Pe],n.prototype,"autoExpand",void 0),rn([Pe],n.prototype,"adjustEdge",void 0),rn([Pe],n.prototype,"adjustEdgeMiddle",void 0),rn([Pe],n.prototype,"adjustEdgeStartAndEnd",void 0),rn([Pe],n.prototype,"adjustEdgeStart",void 0),rn([Pe],n.prototype,"adjustEdgeEnd",void 0),rn([Pe],n.prototype,"edgeSelectedOutline",void 0),rn([Te],n.prototype,"updateEditConfig",null),rn([Te],n.prototype,"updateTextMode",null),n})(),dW="*",cW=(function(){function n(){this._events={}}return n.prototype.on=function(e,t,o){var i=this;e==null||e.split(",").forEach(function(r){r=r.trim(),i._events[r]||(i._events[r]=[]),i._events[r].push({callback:t,once:!!o})})},n.prototype.once=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){i=i.trim(),o.on(i,t,!0)})},n.prototype.emit=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){var r=o._events[i]||[],s=o._events[dW]||[],a=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var f=l[c],p=f.callback,h=f.once;h&&(l.splice(c,1),l.length===0&&delete o._events[i],u--,c--),p.apply(o,[t])}};a(r),a(s)})},n.prototype.off=function(e,t){var o=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete o._events[i];else{for(var r=o._events[i]||[],s=r.length,a=0;a<s;a++)r[a].callback===t&&(r.splice(a,1),s--,a--);r.length===0&&delete o._events[i]}})},n.prototype.getEvents=function(){return this._events},n.prototype.destroy=function(){this._events={}},n})(),fW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},hW=(function(n){fW(e,n);function e(t){var o=n.call(this)||this;o.stepScrollX=0,o.stepScrollY=0,o.pointers=new Map,o.onDragging=function(a){var l=a.deltaX,u=a.deltaY;o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.setState({isDragging:!0});var c=o.props.graphModel,f=c.transformModel,p=c.editConfigModel;p.stopMoveGraph!==!0&&f.translate(l,u)},o.onDragEnd=function(){o.setState({isDragging:!1})},o.zoomHandler=function(a){var l=o.props,u=l.graphModel,c=u.editConfigModel,f=u.transformModel,p=u.gridSize,h=l.graphModel,v=a.deltaX,_=a.deltaY,m=c.stopScrollGraph,g=c.stopZoomGraph;if(!m&&!a.ctrlKey&&!a.metaKey){if(a.preventDefault(),o.stepScrollX+=v,o.stepScrollY+=_,Math.abs(o.stepScrollX)>=p){var b=o.stepScrollX%p,C=o.stepScrollX-b;f.translate(-C*f.SCALE_X,0),o.stepScrollX=b}if(Math.abs(o.stepScrollY)>=p){var D=o.stepScrollY%p,T=o.stepScrollY-D;f.translate(0,-T*f.SCALE_Y),o.stepScrollY=D}return}if(!g){a.preventDefault();var O=h.getPointByClient({x:a.clientX,y:a.clientY}),k=O.canvasOverlayPosition,S=k.x,N=k.y;f.zoom(a.deltaY<0,[S,N])}},o.clickHandler=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){var u=o.props.graphModel,c=u.selectElements;c.size>0&&u.clearSelectElements(),u.eventCenter.emit(pt.BLANK_CLICK,{e:a})}},o.handleContextMenu=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){a.preventDefault();var u=o.props.graphModel,c=u.getPointByClient({x:a.clientX,y:a.clientY});u.eventCenter.emit(pt.BLANK_CONTEXTMENU,{e:a,position:c})}},o.pointerDownHandler=function(a){var l=o.props.graphModel,u=l.eventCenter,c=l.editConfigModel,f=l.transformModel.SCALE_X,p=l.gridSize;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.longPressTimer&&clearTimeout(o.longPressTimer),a.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.handleContextMenu(a)},500)),o.pointers.size===2){var h=o.props.graphModel,v=h.transformModel,_=h.editConfigModel,m=Array.from(o.pointers.values()),g=m[0].x-m[1].x,b=m[0].y-m[1].y,C=(m[0].x+m[1].x)/2,D=(m[0].y+m[1].y)/2;o.pinchStartDistance=Math.hypot(g,b),o.pinchStartScale=v.SCALE_X,o.stepDrag.cancelDrag(),o.pinchLastCenterX=C,o.pinchLastCenterY=D,_.updateEditConfig({isPinching:!0});return}var T=c.adjustEdge,O=c.adjustNodePosition,k=c.stopMoveGraph,S=a.target,N=!T&&!O;(S.getAttribute("name")==="canvas-overlay"||N)&&(k!==!0?(o.stepDrag.setStep(p*f),o.stepDrag.handleMouseDown(a)):u.emit(pt.BLANK_MOUSEDOWN,{e:a}),o.clickHandler(a))},o.pointerMoveHandler=function(a){var l;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.pinchStartDistance&&o.pointers.size>=2){var u=o.props,c=u.graphModel,f=u.graphModel,p=f.editConfigModel,h=f.transformModel;if(p.stopZoomGraph)return;o.longPressTimer&&clearTimeout(o.longPressTimer);var v=Array.from(o.pointers.values()),_=v[0].x-v[1].x,m=v[0].y-v[1].y,g=Math.hypot(_,m),b=((l=o.pinchStartScale)!==null&&l!==void 0?l:h.SCALE_X)*(g/o.pinchStartDistance),C=(v[0].x+v[1].x)/2,D=(v[0].y+v[1].y)/2,T=c.getPointByClient({x:C,y:D}),O=T.canvasOverlayPosition,k=O.x,S=O.y;if(h.zoom(b,[k,S]),!p.stopMoveGraph||p.isPinching){var N=o.pinchLastCenterX===void 0?0:C-o.pinchLastCenterX,L=o.pinchLastCenterY===void 0?0:D-o.pinchLastCenterY;h.translate(N,L),o.pinchLastCenterX=C,o.pinchLastCenterY=D}a.preventDefault()}},o.pointerUpHandler=function(a){if(o.pointers.delete(a.pointerId),o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.pointers.size<2){o.pinchStartDistance=void 0,o.pinchStartScale=void 0,o.pinchLastCenterX=void 0,o.pinchLastCenterY=void 0;var l=o.props.graphModel.editConfigModel;l.updateEditConfig({isPinching:!1})}};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new Lo({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"BLANK",isStopPropagation:!1,eventCenter:s,model:void 0}),o.state={isDragging:!1},o}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children,r=this.state.isDragging;return Re("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onPointerDown:this.pointerDownHandler,onPointerMove:this.pointerMoveHandler,onPointerUp:this.pointerUpHandler,onPointerCancel:this.pointerUpHandler,onContextMenu:this.handleContextMenu,style:{touchAction:"none",WebkitUserSelect:"none"},className:r?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able",children:Re("g",{transform:o,children:i})})},e=pW([eo],e),e})(Yt),tm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ra=function(){return Ra=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ra.apply(this,arguments)},vW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},gW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},ev=(function(n){tm(e,n);function e(){var t=n.call(this)||this;return t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.bezierModel,l=r.type,u=s.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,c=u.x,f=u.y;a.updateAdjustAnchor({x:c,y:f},l),s.eventCenter.emit(pt.EDGE_ADJUST,{data:a.getData()})},t.onDragEnd=function(){var o=t.props.bezierModel;o.isDragging=!1},t.dragHandler=new Lo({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,o=this.props.position,i=o.x,r=o.y,s=this.props.bezierModel,a=s.getEdgeStyle().adjustAnchor;return Re(xs,Ra({className:"lf-bezier-adjust-anchor",x:i,y:r},a,{onPointerDown:function(l){t.dragHandler.handleMouseDown(l)}}))},e})(Yt),_W=(function(n){tm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,o){var i=t.path,r=t.id,s=Mf(i),a=gW(s,4),l=a[0],u=a[1],c=a[2],f=a[3],p=t.getEdgeStyle().adjustLine,h=[];return h.push(Re(bs,Ra({x1:l.x,y1:l.y,x2:u.x,y2:u.y},p))),h.push(Re(ev,{position:u,bezierModel:t,graphModel:o,type:"sNext"},"".concat(r,"_ePre"))),h.push(Re(bs,Ra({x1:f.x,y1:f.y,x2:c.x,y2:c.y},p))),h.push(Re(ev,{position:c,bezierModel:t,graphModel:o,type:"ePre"},"".concat(r,"_sNext"))),h},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,o=t.edges,i=[],r=0;r<o.length;r++){var s=o[r];s.isSelected&&s.modelType===zt.BEZIER_EDGE&&s.draggable&&i.push(this.getBezierAdjust(s,t))}return i},e.prototype.render=function(){return Re("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=vW([eo],e),e})(Yt),mW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),yW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bW=(function(n){mW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return Re("div",{className:"lf-background",children:Re("div",{style:Oy(t)?t:{},className:"lf-background-area"})})},e=yW([eo],e),e})(Yt),xW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},is=(function(n){xW(e,n);function e(t){var o=n.call(this,t)||this;return o.id=Ji(),o.gridOptions=o.props.graphModel.grid,o}return e.prototype.renderDot=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,u=a.thickness,c=u===void 0?2:u,f=Math.min(Math.max(2,c),r/4),p=s?1:0;return Re("g",{fill:l,opacity:p,children:[Re("circle",{cx:0,cy:0,r:f/2}),Re("circle",{cx:0,cy:r,r:f/2}),Re("circle",{cx:r,cy:0,r:f/2}),Re("circle",{cx:r,cy:r,r:f/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,u=a.thickness,c=u===void 0?1:u,f=Math.min(Math.max(1,c),r/2),p="M 0 0 H ".concat(r," V ").concat(r," H 0 Z"),h=s?1:0;return Re("path",{d:p,stroke:l,strokeWidth:f/2,opacity:h,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,o=t.transformModel,i=t.grid;this.gridOptions=i;var r=this.gridOptions,s=r.type,a=r.size,l=a===void 0?1:a,u=o.SCALE_X,c=o.SKEW_Y,f=o.SKEW_X,p=o.SCALE_Y,h=o.TRANSLATE_X,v=o.TRANSLATE_Y,_=[u,c,f,p,h,v].join(","),m="matrix(".concat(_,")");return Re("div",{className:"lf-grid",children:Re("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[Re("defs",{children:Re("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:m,x:"0",y:"0",width:l,height:l,children:[s==="dot"&&this.renderDot(),s==="mesh"&&this.renderMesh()]})}),Re("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=wW([eo],e),e})(Yt);(function(n){n.defaultProps={size:mG,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var o=Dt(n.defaultProps);return typeof t=="number"?an(o,{size:t}):typeof t=="boolean"?an(o,{visible:t}):an(o,t)}n.getGridOptions=e})(is||(is={}));var CW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),SW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},kW=(function(n){CW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children;return Re("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:Re("g",{transform:o,children:i})})},e=SW([eo],e),e})(Yt),EW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Hi=function(){return Hi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Hi.apply(this,arguments)},DW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},AW=(function(n){EW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,o=t.nodes,i=t.editConfigModel,r=i.hoverOutline,s=i.nodeSelectedOutline,a=[];return o.forEach(function(l){if(l.isHovered||l.isSelected){var u=l.isHovered,c=l.isSelected,f=l.x,p=l.y,h=l.width,v=l.height;if(s&&c||r&&u){var _=l.getOutlineStyle(),m={};if(Object.keys(_).forEach(function(b){b!=="hover"&&(m[b]=_[b])}),u){var g=_.hover;m=Hi(Hi({},m),g)}a.push(Re(Ao,Hi({transform:l.transform,className:"lf-outline-node",x:f,y:p,width:h+10,height:v+10},m)))}}}),a},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,o=t.edges,i=t.editConfigModel,r=i.edgeSelectedOutline,s=i.hoverOutline,a=[],l=0;l<o.length;l++){var u=o[l];(r&&u.isSelected||s&&u.isHovered)&&(u.modelType===zt.LINE_EDGE?a.push(this.getLineOutline(u)):u.modelType===zt.POLYLINE_EDGE?a.push(this.getPolylineOutline(u)):u.modelType===zt.BEZIER_EDGE&&a.push(this.getBezierOutline(u)))}return a},e.prototype.getLineOutline=function(t){var o=t.startPoint,i=t.endPoint,r=(o.x+i.x)/2,s=(o.y+i.y)/2,a=Math.abs(o.x-i.x)+10,l=Math.abs(o.y-i.y)+10,u=t.getOutlineStyle();return Re(Ao,Hi({className:"lf-outline-edge",x:r,y:s,width:a,height:l},u))},e.prototype.getPolylineOutline=function(t){var o=t.points,i=Nr(o),r=Ea(i,8),s=r.x,a=r.y,l=r.width,u=r.height,c=t.getOutlineStyle();return Re(Ao,Hi({className:"lf-outline",x:s,y:a,width:l,height:u},c))},e.prototype.getBezierOutline=function(t){var o=t.path,i=Mf(o),r=Ea(i,8),s=r.x,a=r.y,l=r.width,u=r.height,c=t.getOutlineStyle();return Re(Ao,Hi({className:"lf-outline",x:s,y:a,width:l,height:u},c))},e.prototype.render=function(){return Re("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=DW([eo],e),e})(Yt),OW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ui=function(){return Ui=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ui.apply(this,arguments)},NW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},MW=(function(n){OW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,o=t??{},i=o.position,r=o.isShowHorizontal,s=o.isShowVertical,a=t==null?void 0:t.getStyle(),l=i??{},u=l.x,c=u===void 0?0:u,f=l.y,p=f===void 0?0:f,h=Ui(Ui({x1:-1e5,y1:p,x2:1e5,y2:p},a),{stroke:r?a==null?void 0:a.stroke:"none"}),v=Ui(Ui({x1:c,y1:-1e5,x2:c,y2:1e5},a),{stroke:s?a==null?void 0:a.stroke:"none"});return Re("g",{className:"lf-snapline",children:[Re(bs,Ui({},h)),Re(bs,Ui({},v))]})},e=NW([eo],e),e})(Yt),TW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),$W=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},PW=(function(n){TW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,o=t.tool,i=t.graphModel,r=i.textEditElement,s=o.getTools(),a=s.map(function(l){return Ze(l,{textEditElement:r,graphModel:i,lf:o.instance})});return o.components=a,a},e.prototype.triggerToolRender=function(){var t=this.props,o=t.tool,i=t.graphModel,r=document.querySelector("#ToolOverlay_".concat(i.flowId)),s=o.getInstance();s.components.forEach(function(a){return a(s,r)}),s.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return Re("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=$W([eo],e),e})(Yt),Fo=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},zr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},RW={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},BW=(function(){function n(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var o=t.stopMoveGraph,i=o===void 0?!1:o;this.updateTranslateLimits(i)}return n.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},n.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},n.prototype.HtmlPointToCanvasPoint=function(e){var t=zr(e,2),o=t[0],i=t[1];return[(o-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},n.prototype.CanvasPointToHtmlPoint=function(e){var t=zr(e,2),o=t[0],i=t[1];return[o*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},n.prototype.moveCanvasPointByHtml=function(e,t,o){var i=zr(e,2),r=i[0],s=i[1];return[r+t/this.SCALE_X,s+o/this.SCALE_Y]},n.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},n.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},n.prototype.zoom=function(e,t){e===void 0&&(e=!1);var o=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(o=e,i=e):e?(o+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(o-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),o<this.MINI_SCALE_SIZE||o>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(o-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=o,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},n.prototype.emitGraphTransform=function(e){this.eventCenter.emit(pt.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},n.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},n.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},n.prototype.focusOn=function(e,t,o,i){var r=zr(this.CanvasPointToHtmlPoint([e,t]),2),s=r[0],a=r[1],l=zr([o/2-s,i/2-a],2),u=l[0],c=l[1];this.TRANSLATE_X+=u,this.TRANSLATE_Y+=c,this.emitGraphTransform("focusOn")},n.prototype.updateTranslateLimits=function(e){var t;t=zr(Array.isArray(e)&&e.length===4?e:RW[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},Fo([Pe],n.prototype,"SCALE_X",void 0),Fo([Pe],n.prototype,"SKEW_Y",void 0),Fo([Pe],n.prototype,"SKEW_X",void 0),Fo([Pe],n.prototype,"SCALE_Y",void 0),Fo([Pe],n.prototype,"TRANSLATE_X",void 0),Fo([Pe],n.prototype,"TRANSLATE_Y",void 0),Fo([Pe],n.prototype,"ZOOM_SIZE",void 0),Fo([Te],n.prototype,"zoom",null),Fo([Te],n.prototype,"resetZoom",null),Fo([Te],n.prototype,"translate",null),Fo([Te],n.prototype,"focusOn",null),n})(),LW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},IW=(function(n){LW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.parentTransform=o.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,o=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,o*=i.scaleY}else t*=this.parentTransform.SCALE_X,o*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:o}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,o=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),r=i.scaleX,s=i.scaleY;t=r*t,o=s*o}return{translateX:t,translateY:o}},e.prototype.HtmlPointToCanvasPoint=function(t){var o=wd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,u=this.getCumulativeTranslate(),c=u.translateX,f=u.translateY;return[(i-c)/a,(r-f)/l]},e.prototype.CanvasPointToHtmlPoint=function(t){var o=wd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,u=this.getCumulativeTranslate(),c=u.translateX,f=u.translateY;return[i*a+c,r*l+f]},e.prototype.moveCanvasPointByHtml=function(t,o,i){var r=wd(t,2),s=r[0],a=r[1],l=this.getCumulativeScale(),u=l.scaleX,c=l.scaleY;return[s+o/u,a+i/c]},e.prototype.fixDeltaXY=function(t,o){var i=this.getCumulativeScale(),r=i.scaleX,s=i.scaleY;return[t/r,o/s]},e})(BW),Wn=function(){return Wn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wn.apply(this,arguments)},vt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},FW=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Pn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},po=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},jW=(function(){function n(e){var t=this,o,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=Ln.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var r=e.container,s=e.partial,a=e.background,l=a===void 0?{}:a,u=e.grid,c=e.idGenerator,f=e.edgeGenerator,p=e.animation,h=e.customTrajectory;this.rootEl=r,this.partial=!!s,this.background=l,typeof u=="object"&&e.snapGrid&&(this.gridSize=u.size||1),this.customStyles=e.style||{},this.grid=is.getGridOptions(u??!1),this.theme=em(e.style,e.themeMode),this.theme.grid=Dt(this.grid),this.theme.background=Dt(this.background),this.edgeType=e.edgeType||"polyline",this.animation=vG(p),this.overlapMode=e.overlapMode||Ln.DEFAULT,this.isMiniMap=e.isMiniMap||!1,this.width=(o=e.width)!==null&&o!==void 0?o:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Qn(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Qn(e.height);var v=new ResizeObserver(hg((function(_){var m,g;try{for(var b=FW(_),C=b.next();!C.done;C=b.next()){var D=C.value;D.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:D.contentRect}))}}catch(T){m={error:T}}finally{try{C&&!C.done&&(g=b.return)&&g.call(b)}finally{if(m)throw m.error}}}),16));v.observe(this.rootEl),this.waitCleanEffects.push(function(){v.disconnect()}),this.eventCenter=new cW,this.editConfigModel=new uW(e),this.transformModel=new IW(this.eventCenter,e),this.flowId=Ji(),this.idGenerator=c,this.edgeGenerator=FG(this,f),this.customTrajectory=h}return Object.defineProperty(n.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelsMap",{get:function(){return po(po([],Pn(this.nodes),!1),Pn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortElements",{get:function(){for(var e=function(l){return po([],Pn(l),!1).sort(function(u,c){return u.zIndex-c.zIndex})},t=e(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1)),o=[],i=[-ul,-ul],r=[this.width+ul,this.height+ul],s=0;s<t.length;s++){var a=t[s];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,i,r,!1,!1))&&o.push(a)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(o){return o.state===en.TEXT_EDIT}),t=this.edges.find(function(o){return o.state===en.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),n.prototype.getAreaElement=function(e,t,o,i,r){var s=this;o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1);var a=[];return Lt(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1),function(l){var u=s.isElementInArea(l,e,t,o,i);(!r||l.visible)&&u&&a.push(l)}),a},n.prototype.getModel=function(e){return this.modelMap.get(e)},n.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getPointByClient=function(e){var t=e.x,o=e.y,i=this.rootEl.getBoundingClientRect(),r={x:t-i.left,y:o-i.top},s=Pn(this.transformModel.HtmlPointToCanvasPoint([r.x,r.y]),2),a=s[0],l=s[1],u={x:a,y:l};return{domOverlayPosition:r,canvasOverlayPosition:u}},n.prototype.isElementInArea=function(e,t,o,i,r){var s;if(i===void 0&&(i=!0),r===void 0&&(r=!0),e.BaseType===Sn.NODE){e=e;for(var a=vo(e),l=a.minX,u=a.minY,c=a.maxX,f=a.maxY,p=[{x:l,y:u},{x:c,y:u},{x:c,y:f},{x:l,y:f}],h=r,v=0;v<p.length;v++){var _=p[v],m=_.x,g=_.y;if(s=Pn(this.transformModel.CanvasPointToHtmlPoint([m,g]),2),m=s[0],g=s[1],md([m,g],t,o)!==r){h=!r;break}}return h}if(e.BaseType===Sn.EDGE){e=e;var b=e.startPoint,C=e.endPoint,D=this.transformModel.CanvasPointToHtmlPoint([b.x,b.y]),T=this.transformModel.CanvasPointToHtmlPoint([C.x,C.y]),O=md(D,t,o),k=md(T,t,o);return i?O&&k:O||k}return!1},n.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=Zo(e.nodes,function(i){var r=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(r.id,r),t.nodeModelMap.set(r.id,r),r}):this.nodes=[],e.edges){var o=this.edgeType;this.edges=Zo(e.edges,function(i){var r,s=t.getModel((r=i.type)!==null&&r!==void 0?r:o);if(!s)throw new Error("找不到".concat(i.type,"对应的边。"));var a=new s(i,t);return t.edgeModelMap.set(a.id,a),t.elementsModelMap.set(a.id,a),a})}else this.edges=[]},n.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(o){var i=o.getData();i&&!o.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(o){var i=o.getData();i&&!o.virtual&&t.push(i)}),{nodes:t,edges:e}},n.prototype.modelToHistoryData=function(){for(var e=!1,t=[],o=0;o<this.nodes.length;o++){var i=this.nodes[o];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var r=!1,s=[],a=0;a<this.edges.length;a++){var l=this.edges[a];if(l.isDragging){r=!0;break}else s.push(l.getHistoryData())}return r?!1:{nodes:t,edges:s}},n.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getElement=function(e){return this.modelsMap[e]},n.prototype.getNodeEdges=function(e){for(var t=[],o=0;o<this.edges.length;o++){var i=this.edges[o],r=i.sourceNodeId===e,s=i.targetNodeId===e;(r||s)&&t.push(i)}return t},n.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,o={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===Sn.NODE&&o.nodes.push(i.getData()),i.BaseType===Sn.EDGE){var r=i.getData(),s=t.get(r.sourceNodeId)&&t.get(r.targetNodeId);(e||s)&&o.edges.push(r)}}),o},n.prototype.updateAttributes=function(e,t){var o=this.getElement(e);o==null||o.updateAttributes(t)},n.prototype.changeNodeId=function(e,t){return t||(t=Ji()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(o){o.sourceNodeId===e&&(o.sourceNodeId=t),o.targetNodeId===e&&(o.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},n.prototype.changeEdgeId=function(e,t){return t||(t=Ji()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(o){o.id===e&&o.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},n.prototype.getTextModel=function(e){var t=this.editConfigModel,o=t.textMode,i=t.nodeTextMode,r=t.edgeTextMode;if(e.BaseType===Sn.NODE)return e.textMode||i||o||Mo.TEXT;if(e.BaseType===Sn.EDGE)return e.textMode||r||o||Mo.TEXT},n.prototype.setOverlapMode=function(e){this.overlapMode=e,this.eventCenter.emit("overlap:change",{overlapMode:e})},n.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},n.prototype.setFakeNode=function(e){this.fakeNode=e},n.prototype.removeFakeNode=function(){this.fakeNode=null},n.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},n.prototype.toFront=function(e){var t,o,i,r=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((o=this.edgesMap[e])===null||o===void 0?void 0:o.model);if(r){if(this.overlapMode===Ln.STATIC)return;if(this.overlapMode===Ln.INCREASE){this.setElementZIndex(e,"top");return}(i=this.topElement)===null||i===void 0||i.setZIndex(),r.setZIndex(_G),this.topElement=r}},n.prototype.setElementZIndex=function(e,t){var o,i,r=((o=this.nodesMap[e])===null||o===void 0?void 0:o.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(r){var s=void 0;typeof t=="number"?s=t:(t==="top"&&(s=$a()),t==="bottom"&&(s=qX())),r.setZIndex(s)}},n.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,o=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(pt.NODE_DELETE,{data:o,model:t})},n.prototype.addNode=function(e,t,o){t===void 0&&(t=pt.NODE_ADD);var i=Jn(e),r=i.id;r&&this.nodesMap[r]&&delete i.id;var s=this.getModelAfterSnapToGrid(i);this.nodes.push(s);var a=s.getData(),l={data:a};return o&&(l.e=o),this.eventCenter.emit(t,l),s},n.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),o=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,r=e.y;i&&r&&(e.x=ys(i,this.gridSize,o),e.y=ys(r,this.gridSize,o),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-r));var s=new t(e,this);return this.nodeModelMap.set(s.id,s),this.elementsModelMap.set(s.id,s),s},n.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){o.x+=30,o.y+=30,o.id="",typeof o.text=="object"&&o.text!==null&&(o.text.x+=30,o.text.y+=30);var i=this.addNode(o);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},n.prototype.moveNode=function(e,t,o,i){var r;i===void 0&&(i=!1);var s=this.nodesMap[e];if(!s){console.warn("不存在id为".concat(e,"的节点"));return}var a=s.model;r=Pn(a.getMoveDistance(t,o,i),2),t=r[0],o=r[1],this.moveEdge(e,t,o)},n.prototype.moveNode2Coordinate=function(e,t,o,i){i===void 0&&(i=!1);var r=this.nodesMap[e];if(!r){console.warn("不存在id为".concat(e,"的节点"));return}var s=r.model,a=s.x,l=s.y,u=t-a,c=o-l;this.moveNode(e,u,c,i)},n.prototype.editText=function(e){this.setElementStateById(e,en.TEXT_EDIT)},n.prototype.addEdge=function(e){var t=Jn(e),o=t.type;o||(o=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(o);if(!i)throw new Error("找不到".concat(o,"对应的边，请确认是否已注册此类型边。"));var r=new i(Wn(Wn({},t),{type:o}),this);this.edgeModelMap.set(r.id,r),this.elementsModelMap.set(r.id,r);var s=r.getData();return this.edges.push(r),this.eventCenter.emit(pt.EDGE_ADD,{data:s}),r},n.prototype.moveEdge=function(e,t,o){for(var i=0;i<this.edges.length;i++){var r=this.edges[i],s=r.textPosition,a=s.x,l=s.y,u=this.edges[i].sourceNodeId===e,c=this.edges[i].targetNodeId===e;u&&r.moveStartPoint(t,o),c&&r.moveEndPoint(t,o),(u||c)&&this.handleEdgeTextMove(r,a,l)}},n.prototype.handleEdgeTextMove=function(e,t,o){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===zt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var r=e.text,s=q_(r,e.points);e.moveText(s.x-r.x,s.y-r.y)}var a=e.textPosition,l=a.x,u=a.y;e.moveText(l-t,u-o)},n.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var o=0;o<this.edges.length;o++)if(this.edges[o].sourceNodeId===e&&this.edges[o].targetNodeId===t){var i=this.edges[o].getData();this.edges.splice(o,1),o--,this.eventCenter.emit(pt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var o=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(o,1),this.eventCenter.emit(pt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(pt.EDGE_DELETE,{data:o})}},n.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(pt.EDGE_DELETE,{data:o})}},n.prototype.setElementStateById=function(e,t,o){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(en.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(en.DEFAULT)})},n.prototype.updateText=function(e,t){var o=Er(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1),function(i){return i.id===e});o==null||o.updateText(t)},n.prototype.selectNodeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.nodesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectEdgeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.edgesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var o=this.getElement(e);o==null||o.setSelected(!0)},n.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},n.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1),t==null||t.setHovered(!1)}),this.selectElements.clear(),[Ln.DEFAULT,Ln.EDGE_TOP].includes(this.overlapMode)&&((e=this.topElement)===null||e===void 0||e.setZIndex())},n.prototype.moveNodes=function(e,t,o,i){var r,s,a,l=this;i===void 0&&(i=!1);for(var u=e.reduce(function(C,D){var T,O=(T=l.nodesMap[D])===null||T===void 0?void 0:T.model;return O&&(C[D]=O.getMoveDistance(t,o,i)),C},{}),c=0;c<this.edges.length;c++){var f=this.edges[c],p=f.textPosition,h=p.x,v=p.y,_=u[f.sourceNodeId],m=u[f.targetNodeId],g=void 0,b=void 0;_&&m&&f.modelType===zt.POLYLINE_EDGE?(r=Pn(_,2),g=r[0],b=r[1],f.updatePointsList(g,b)):(_&&(s=Pn(_,2),g=s[0],b=s[1],f.moveStartPoint(g,b)),m&&(a=Pn(m,2),g=a[0],b=a[1],f.moveEndPoint(g,b))),(_||m)&&this.handleEdgeTextMove(f,h,v)}},n.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},n.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},n.prototype.setDefaultEdgeType=function(e){this.edgeType=e},n.prototype.changeNodeType=function(e,t){var o=this.getNodeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的节点"));return}var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var s=new r(i,this);this.nodes.splice(this.nodesMap[e].index,1,s);var a=this.getNodeEdges(e);a.forEach(function(l){if(l.sourceNodeId===e){var u=Uh(s,l.startPoint,s.width,s.height);l.updateStartPoint(u)}if(l.targetNodeId===e){var u=Uh(s,l.endPoint,s.width,s.height);l.updateEndPoint(u)}})},n.prototype.changeEdgeType=function(e,t){var o=this.getEdgeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的边"));return}if(o.type!==t){var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var s=new r(i,this);this.edges.splice(this.edgesMap[e].index,1,s)}},n.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetNodeId===e&&t.push(o)}),t},n.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceNodeId===e&&t.push(o)}),t},n.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetAnchorId===e&&t.push(o)}),t},n.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceAnchorId===e&&t.push(o)}),t},n.prototype.getNodeIncomingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){var r;i.targetNodeId===e&&o.push((r=t.nodesMap[i.sourceNodeId])===null||r===void 0?void 0:r.model)}),o},n.prototype.getNodeOutgoingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&o.push(t.nodesMap[i.targetNodeId].model)}),o},n.prototype.setTheme=function(e,t){var o;if(t&&(Ma[t]&&this.updateBackgroundOptions(Wn(Wn({},typeof this.background=="object"?this.background:{}),Ma[t])),Ta[t]&&this.updateGridOptions(is.getGridOptions(Wn(Wn({},this.grid),Ta[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=is.getGridOptions((o=e.grid)!==null&&o!==void 0?o:!1);this.updateGridOptions(i)}this.theme=HX(Wn(Wn({},this.customStyles),e),t),this.customStyles=Wn(Wn({},this.customStyles),e)},n.prototype.getTheme=function(){var e=this,t=e.background,o=e.grid,i=Wn(Wn({},Dt(this.theme)),{background:t,grid:o});return i},n.prototype.updateGridOptions=function(e){ss(this.grid,e)},n.prototype.updateGridSize=function(e){this.gridSize=e},n.prototype.updateBackgroundOptions=function(e){jd(e)||jd(this.background)?this.background=e:this.background=Wn(Wn({},this.background),e)},n.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Qn(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Qn(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},n.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},n.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],o=[];e.forEach(function(p){var h=p.x,v=p.y,_=p.width,m=p.height,g=p.getNodeStyle().strokeWidth,b=g===void 0?0:g,C=h+_/2+b,D=h-_/2-b,T=v+m/2+b,O=v-m/2-b;t=t.concat([C,D].filter(function(k){return!Number.isNaN(k)})),o=o.concat([T,O].filter(function(k){return!Number.isNaN(k)}))});var i=Math.min.apply(Math,po([],Pn(t),!1)),r=Math.max.apply(Math,po([],Pn(t),!1)),s=Math.min.apply(Math,po([],Pn(o),!1)),a=Math.max.apply(Math,po([],Pn(o),!1)),l=r-i||0,u=a-s||0,c=i+l/2,f=s+u/2;return{width:l,height:u,x:c,y:f}},n.prototype.translateCenter=function(){var e=this,t=e.nodes,o=e.width,i=e.height,r=e.rootEl,s=e.transformModel;if(t.length){var a=o||r.clientWidth,l=i||r.clientHeight,u=this.getVirtualRectSize(),c=u.x,f=u.y;s.focusOn(c,f,a,l)}},n.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var o=this,i=o.nodes,r=o.width,s=o.height,a=o.rootEl,l=o.transformModel;if(i.length){var u=r||a.clientWidth,c=s||a.clientHeight,f=this.getVirtualRectSize(),p=f.width,h=f.height,v=f.x,_=f.y,m=(p+t)/u,g=(h+e)/c,b=1/Math.max(m,g),C=[u/2,c/2];l.zoom(b,C),l.focusOn(v,_,u,c)}},n.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},n.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},n.prototype.getPartial=function(){return this.partial},n.prototype.setPartial=function(e){this.partial=e},n.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},vt([Pe],n.prototype,"width",void 0),vt([Pe],n.prototype,"height",void 0),vt([Pe],n.prototype,"theme",void 0),vt([Pe],n.prototype,"grid",void 0),vt([Pe],n.prototype,"edgeType",void 0),vt([Pe],n.prototype,"nodes",void 0),vt([Pe],n.prototype,"edges",void 0),vt([Pe],n.prototype,"fakeNode",void 0),vt([Pe],n.prototype,"overlapMode",void 0),vt([Pe],n.prototype,"background",void 0),vt([Pe],n.prototype,"gridSize",void 0),vt([Pe],n.prototype,"transformModel",void 0),vt([Pe],n.prototype,"editConfigModel",void 0),vt([Pe],n.prototype,"partial",void 0),vt([mn],n.prototype,"nodesMap",null),vt([mn],n.prototype,"edgesMap",null),vt([mn],n.prototype,"modelsMap",null),vt([mn],n.prototype,"sortElements",null),vt([mn],n.prototype,"textEditElement",null),vt([mn],n.prototype,"selectElements",null),vt([mn],n.prototype,"selectNodes",null),vt([Te],n.prototype,"setOverlapMode",null),vt([Te],n.prototype,"setTextMode",null),vt([Te],n.prototype,"setFakeNode",null),vt([Te],n.prototype,"removeFakeNode",null),vt([Te],n.prototype,"setModel",null),vt([Te],n.prototype,"toFront",null),vt([Te],n.prototype,"setElementZIndex",null),vt([Te],n.prototype,"deleteNode",null),vt([Te],n.prototype,"addNode",null),vt([Te],n.prototype,"cloneNode",null),vt([Te],n.prototype,"moveNode",null),vt([Te],n.prototype,"moveNode2Coordinate",null),vt([Te],n.prototype,"editText",null),vt([Te],n.prototype,"addEdge",null),vt([Te],n.prototype,"moveEdge",null),vt([Te],n.prototype,"deleteEdgeBySourceAndTarget",null),vt([Te],n.prototype,"deleteEdgeById",null),vt([Te],n.prototype,"deleteEdgeBySource",null),vt([Te],n.prototype,"deleteEdgeByTarget",null),vt([Te],n.prototype,"setElementStateById",null),vt([Te],n.prototype,"updateText",null),vt([Te],n.prototype,"selectNodeById",null),vt([Te],n.prototype,"selectEdgeById",null),vt([Te],n.prototype,"selectElementById",null),vt([Te],n.prototype,"deselectElementById",null),vt([Te],n.prototype,"clearSelectElements",null),vt([Te],n.prototype,"moveNodes",null),vt([Te],n.prototype,"setDefaultEdgeType",null),vt([Te],n.prototype,"changeNodeType",null),vt([Te],n.prototype,"changeEdgeType",null),vt([Te],n.prototype,"getNodeIncomingEdge",null),vt([Te],n.prototype,"getNodeOutgoingEdge",null),vt([Te],n.prototype,"getAnchorIncomingEdge",null),vt([Te],n.prototype,"getAnchorOutgoingEdge",null),vt([Te],n.prototype,"getNodeIncomingNode",null),vt([Te],n.prototype,"getNodeOutgoingNode",null),vt([Te],n.prototype,"setTheme",null),vt([Te],n.prototype,"getTheme",null),vt([Te],n.prototype,"resize",null),vt([Te],n.prototype,"clearData",null),vt([Te],n.prototype,"translateCenter",null),vt([Te],n.prototype,"fitView",null),vt([Te],n.prototype,"openEdgeAnimation",null),vt([Te],n.prototype,"closeEdgeAnimation",null),vt([Te],n.prototype,"setPartial",null),n})(),_r=function(){return _r=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_r.apply(this,arguments)},qs=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},VW=(function(){function n(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return n.prototype.getStyle=function(){return _r({},this.graphModel.theme.snapline)},n.prototype.getCenterSnapLine=function(e,t){for(var o=e.x,i=e.y,r=!1,s=!1,a=0;a<t.length;a++){var l=t[a];if(l.id!==e.id&&(jo(o,l.x,this.epsilon)&&(r=!0),jo(i,l.y,this.epsilon)&&(s=!0),r&&s))break}return{isShowVertical:r,isShowHorizontal:s,position:{x:o,y:i}}},n.prototype.getHorizontalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=vo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=vo(l))}}for(var u=0;u<t.length;u++){var c=t[u];if(c.id!==e.id){var f=vo(c);if(jo(f.minY,s==null?void 0:s.minY,this.epsilon)||jo(f.maxY,s==null?void 0:s.minY,this.epsilon)){o=!0,i=s.minY;break}if(jo(f.minY,s==null?void 0:s.maxY,this.epsilon)||jo(f.maxY,s==null?void 0:s.maxY,this.epsilon)){o=!0,i=s.maxY;break}}}return{isShowHorizontal:o,isShowVertical:this.isShowVertical,position:_r(_r({},this.position),{y:i})}},n.prototype.getVerticalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=vo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=vo(l))}}for(var u=0;u<t.length;u++){var c=t[u];if(c.id!==e.id){var f=vo(c);if(jo(f.minX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(jo(f.minX,s==null?void 0:s.minX,this.epsilon)||jo(f.maxX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(jo(f.minX,s==null?void 0:s.maxX,this.epsilon)||jo(f.maxX,s==null?void 0:s.maxX,this.epsilon)){o=!0,i=s.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:o,position:_r(_r({},this.position),{x:i})}},n.prototype.getSnapLinePosition=function(e,t){var o=this.getCenterSnapLine(e,t),i=o.isShowHorizontal,r=o.isShowVertical;if(!i){var s=this.getHorizontalSnapline(e,t);s.isShowHorizontal&&(o.isShowHorizontal=s.isShowHorizontal,o.position.y=s.position.y)}if(!r){var a=this.getVerticalSnapline(e,t);a.isShowVertical&&(o.isShowVertical=a.isShowVertical,o.position.x=a.position.x)}return o},n.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,o=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=o},n.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},n.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,o=this.getSnapLinePosition(e,t);this.setSnaplineInfo(o)},qs([Pe],n.prototype,"isShowHorizontal",void 0),qs([Pe],n.prototype,"isShowVertical",void 0),qs([Pe],n.prototype,"position",void 0),qs([Te],n.prototype,"clearSnapline",null),qs([Te],n.prototype,"setNodeSnapLine",null),n})();function jo(n,e,t){return Math.abs(n-e)<=t}var HW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),UW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},zW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},qW=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},GW=(function(n){HW(e,n);function e(){var t=n.apply(this,qW([],zW(arguments),!1))||this;return t.handleResize=function(){var o=t.props,i=o.graphModel,r=o.options,s=i.width,a=i.height,l=i.isContainerWidth,u=i.isContainerHeight,c=s,f=a,p=!1;l&&(c=void 0,p=!0),u&&(f=void 0,p=!0),p&&i.resize(c,f),r.width=s,r.height=a},t.throttleResize=Ny(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(pt.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,o,i){i===void 0&&(i="canvas-overlay");var r=this.props.getView,s=r(t.type);return s?Re(s,{model:t,graphModel:o,overlay:i},t.id):null},e.prototype.render=function(){var t=this,o=this.props,i=o.graphModel,r=o.tool,s=o.options,a=o.dnd,l=o.snaplineModel,u={};s.width&&(u.width="".concat(i.width,"px")),s.height&&(u.height="".concat(i.height,"px"));var c=i.fakeNode,f=i.editConfigModel,p=i.background,h=f.adjustEdge;return Re("div",{className:"lf-graph","flow-id":i.flowId,style:u,children:[Re(hW,{graphModel:i,dnd:a,children:[Re("g",{className:"lf-base",children:Zo(i.sortElements,function(v){return t.getComponent(v,i)})}),c?this.getComponent(c,i):""]}),Re(kW,{graphModel:i,children:[Re(AW,{graphModel:i}),h?Re(_W,{graphModel:i}):"",s.snapline!==!1?Re(MW,{snaplineModel:l}):""]}),Re(PW,{graphModel:i,tool:r}),p&&Re(bW,{background:p}),Re(is,{graphModel:i})]})},e=UW([eo],e),e})(Yt),XW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ui=function(){return ui=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ui.apply(this,arguments)},WW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},YW=(function(n){XW(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(o){var i=o.event,r=t.props,s=r.anchorData,a=r.nodeModel,l=r.graphModel;l.selectNodeById(a.id),a.autoToFront&&l.toFront(a.id),l.eventCenter.emit(pt.ANCHOR_DRAGSTART,{data:s,e:i,nodeModel:a}),t.setState({startX:s.x,startY:s.y,endX:s.x,endY:s.y})},t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,u=s.transformModel,c=s.eventCenter,f=s.width,p=s.height,h=s.editConfigModel,v=h.autoExpand,_=h.stopMoveGraph;if(i){var m=i.clientX,g=i.clientY,b=s.getPointByClient({x:m,y:g}),C=b.domOverlayPosition,D=C.x,T=C.y,O=b.canvasOverlayPosition,k=O.x,S=O.y;t.t&&iu(t.t);var N=[],L=10;D<10?N=[L,0]:D+10>f?N=[-L,0]:T<10?N=[0,L]:T+10>p&&(N=[0,-L]),t.setState({endX:k,endY:S,dragging:!0}),t.moveAnchorEnd(k,S,i),N.length>0&&!_&&v&&(t.t=Y_(function(){var $=WW(N,2),B=$[0],E=$[1];u.translate(B,E);var A=t.state,M=A.endX,F=A.endY;t.setState({endX:M-B,endY:F-E}),t.moveAnchorEnd(M-B,F-E,i)})),c.emit(pt.ANCHOR_DRAG,{data:l,e:i,nodeModel:a})}},t.onDragEnd=function(o){var i=o.event;t.t&&iu(t.t);var r=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var s=t.props,a=s.graphModel,l=s.nodeModel,u=s.anchorData;t.preTargetNode&&(t.preTargetNode.setHovered(!1),t.preTargetNode=void 0),a.eventCenter.emit(pt.ANCHOR_DRAGEND,{data:u,e:i,nodeModel:l,edgeModel:r??void 0})},t.checkEnd=function(o){var i,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,u=l.x,c=l.y,f=l.id,p=t.state,h=p.endX,v=p.endY,_=p.dragging,m=nu({x:h,y:v},s);if(t.preTargetNode&&t.preTargetNode.state!==en.DEFAULT&&t.preTargetNode.setElementState(en.DEFAULT),!!_&&m&&m.node){var g=m.node,b=m.anchor.id,C="".concat(a.id,"_").concat(g.id,"_").concat(b,"_").concat(f),D=t.sourceRuleResults.get(C)||{},T=D.isAllPass,O=D.msg,k=t.targetRuleResults.get(C)||{},S=k.isAllPass,N=k.msg;if(T&&S){g.setElementState(en.DEFAULT);var L=s.getNodeModelById(m.node.id),$=(i=s.edgeGenerator)===null||i===void 0?void 0:i.call(s,a.getData(),L==null?void 0:L.getData()),B=s.addEdge(ui(ui({},$),{sourceNodeId:a.id,sourceAnchorId:f,startPoint:{x:u,y:c},targetNodeId:m.node.id,targetAnchorId:m.anchor.id,endPoint:{x:m.anchor.x,y:m.anchor.y}})),E=t.props.anchorData;return s.eventCenter.emit(pt.ANCHOR_DROP,{data:E,e:o,nodeModel:a,edgeModel:B}),B}var A=g.getData();return s.eventCenter.emit(pt.CONNECTION_NOT_ALLOWED,{data:A,msg:N||O||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new Lo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,o=t.anchorData,i=t.style,r=t.node,s=r.getAnchorShape(o);if(s)return s;var a=o.x,l=o.y,u=ui(ui({},i),i==null?void 0:i.hover);return Re("g",{children:[Re(xs,ui({className:"lf-node-anchor-hover"},u,{x:a,y:l})),Re(xs,ui({className:"lf-node-anchor"},i,{x:a,y:l}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,o=t.graphModel,i=o.getAnchorIncomingEdge,r=o.getAnchorOutgoingEdge,s=t.anchorData.id;return{incomingEdgeList:i(s),outgoingEdgeList:r(s)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,o,i){var r,s,a=this.props,l=a.graphModel,u=a.nodeModel,c=a.anchorData,f=nu({x:t,y:o},l);if(f){var p=f.node,h=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(en.DEFAULT),c.id===h)return;this.preTargetNode=p;var v="".concat(u.id,"_").concat(p.id,"_").concat(h,"_").concat(c.id);if(!this.targetRuleResults.has(v)){var _=f.anchor,m=u.isAllowConnectedAsSource(p,c,_),g=p.isAllowConnectedAsTarget(u,c,_);this.sourceRuleResults.set(v,ou(m)),this.targetRuleResults.set(v,ou(g))}var b=((r=this.sourceRuleResults.get(v))!==null&&r!==void 0?r:{}).isAllPass,C=((s=this.targetRuleResults.get(v))!==null&&s!==void 0?s:{}).isAllPass;if(b&&C?p.setElementState(en.ALLOW_CONNECT):p.setElementState(en.NOT_ALLOW_CONNECT),!p.isHovered){var D=p.getData();i&&l.eventCenter.emit(pt.NODE_MOUSEENTER,{data:D,e:i}),p.setHovered(!0)}}else if(this.preTargetNode&&this.preTargetNode.state!==en.DEFAULT){this.preTargetNode.setElementState(en.DEFAULT);var T=this.preTargetNode.getData();i&&l.eventCenter.emit(pt.NODE_MOUSELEAVE,{data:T,e:i}),this.preTargetNode.setHovered(!1),this.preTargetNode=void 0}},e.prototype.isShowLine=function(){var t=this.state,o=t.startX,i=t.startY,r=t.endX,s=t.endY,a=Xo(o,i,r,s);return a>10},e.prototype.render=function(){var t=this,o=this.state,i=o.startX,r=o.startY,s=o.endX,a=o.endY,l=this.props,u=l.anchorData,c=l.edgeStyle,f=l.nodeModel,p=l.graphModel,h=u.edgeAddable;return Re("g",{className:"lf-anchor",children:[Re("g",{onClick:function(v){v.stopPropagation(),p.eventCenter.emit(pt.ANCHOR_CLICK,{data:u,e:v,nodeModel:f})},onPointerDown:function(v){p.eventCenter.emit(pt.ANCHOR_MOUSEDOWN,{data:u,e:v,nodeModel:f}),h!==!1&&t.dragHandler.handleMouseDown(v)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(ui({sourcePoint:{x:i,y:r},targetPoint:{x:s,y:a}},c)):Re(bs,ui({x1:i,y1:r,x2:s,y2:a},c,{"pointer-events":"none"})))]})},e})(Yt),KW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Sc=function(){return Sc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Sc.apply(this,arguments)},JW=(function(n){KW(e,n);function e(t){var o=n.call(this,t)||this;return o.style={},o.onDragging=function(i){var r,s=i.event,a=o.props,l=a.graphModel,u=a.nodeModel,c=a.eventCenter,f=l.selectNodes,p=u.x,h=u.y,v=s.clientX,_=s.clientY,m=l.getPointByClient({x:v,y:_}).canvasOverlayPosition,g=m.x,b=m.y,C=new Xn(g-p,b-h),D=((r=o.normal)===null||r===void 0?void 0:r.angle(C))-o.defaultAngle,T=new eu(-p,-h).rotate(D).translate(p,h).toString();u.transform=T,u.rotate=D;var O=Zo(f,function(S){return S.id});O.indexOf(u.id)===-1&&(O=[u.id]);var k=My(O,function(S,N){var L=l.getNodeModelById(N);return S[N]=L==null?void 0:L.getMoveDistance(0,0,!1),S},{});O.forEach(function(S){var N=l.getNodeEdges(S);N.forEach(function(L){if(k[L.sourceNodeId]){var $=l.getNodeModelById(L.sourceNodeId),B=$.anchors.find(function(E){return E.id===L.sourceAnchorId});L.updateStartPoint(B)}if(k[L.targetNodeId]){var $=l.getNodeModelById(L.targetNodeId),B=$.anchors.find(function(M){return M.id===L.targetAnchorId});L.updateEndPoint(B)}})}),c.emit(pt.NODE_ROTATE,{e:s,model:u,data:u.getData()})},o.style=t.style,o.stepperDrag=new Lo({onDragging:o.onDragging}),o}return e.prototype.render=function(){var t=this,o=this.props.nodeModel,i=o.x,r=o.y,s=o.width,a=o.height,l=i+s/2+20,u=r-a/2-20;return this.normal=new Xn(1,0),this.defaultAngle=this.normal.angle(new Xn(l-i,u-r)),o.defaultAngle=this.defaultAngle,Re("g",{className:"lf-rotate-control",children:Re("g",{onPointerDown:function(c){t.stepperDrag.handleMouseDown(c)},children:Re(xs,Sc({},this.style,{cx:l,cy:u}))})})},e})(Yt),Cd={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var tv;function ZW(){return tv||(tv=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(r=i(r,o(a)))}return r}function o(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return t.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var s="";for(var a in r)e.call(r,a)&&r[a]&&(s=i(s,a));return s}function i(r,s){return s?r?r+" "+s:r+s:r}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(Cd)),Cd.exports}var QW=ZW();const kc=Ms(QW);var eY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ec=function(){return Ec=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ec.apply(this,arguments)},tY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},nm=(function(n){eY(e,n);function e(t){var o=n.call(this)||this;o.mouseDownHandler=function(r){var s=o.props,a=s.draggable,l=s.model,u=s.graphModel,c=u.editConfigModel.nodeTextDraggable;(a??c)&&(r.stopPropagation(),o.stepperDrag.model=l,o.stepperDrag.handleMouseDown(r))},o.onDragging=function(r){var s=r.deltaX,a=r.deltaY,l=o.props,u=l.model,c=l.graphModel.transformModel;if(s||a){var f=tY(c.fixDeltaXY(s,a),2),p=f[0],h=f[1];u.moveText(p,h)}},o.dbClickHandler=function(){var r=o.props,s=r.editable,a=r.graphModel.eventCenter,l=r.model;s&&l.setElementState(en.TEXT_EDIT),a.emit(pt.TEXT_DBCLICK,{data:l.text,model:l})};var i=t.draggable;return o.stepperDrag=new Lo({onDragging:o.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),o}return e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=o.text,a=s.value,l=s.x,u=s.y,c=s.editable,f=s.draggable,p={x:l,y:u,className:"",value:a},h=o.getTextStyle(),v=r.nodeTextDraggable||f;return Re(K_,Ec({},p,h,{className:kc({"lf-element-text":c,"lf-text-draggable":!c&&v,"lf-text-disabled":!c&&!v}),model:o}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return Re("g",{onPointerDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e})(Yt),nY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Vo=function(){return Vo=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Vo.apply(this,arguments)},bl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},oY=(function(n){nY(e,n);function e(t){var o=n.call(this,t)||this;return o.setHoverOn=function(){o.setState({isHovered:!0})},o.setHoverOff=function(){o.setState({isHovered:!1})},o.state={isHovered:!1},o}return e.prototype.getBackground=function(){var t=this.state.isHovered,o=this.props.model,i=o.text,r=o.getTextStyle(),s=r.background||{};if(t&&r.hover&&r.hover.background&&(s=Vo(Vo({},s),r.hover.background)),i!=null&&i.value&&(s==null?void 0:s.fill)!=="transparent"){var a=r.fontSize,l=r.textWidth,u=r.lineHeight,c=r.overflowMode,f=s.wrapPadding,p=i==null?void 0:i.value.split(/[\r\n]/g),h=p.length,v=i.x,_=i.y,m={};if(c==="autoWrap"&&l){var g=W_({rows:p,style:{fontSize:"".concat(a,"px"),width:"".concat(l,"px"),lineHeight:u,padding:f},rowsLength:h,className:"lf-get-text-height"});m=Vo(Vo({},s),{x:v,y:_,width:l,height:g})}else{var b=jG({rows:p,rowsLength:h,fontSize:a}),C=b.width,D=b.height;if(c==="ellipsis"&&(C=l,D=a+2),typeof s.wrapPadding=="string"){var T=s.wrapPadding.split(",").filter(function(G){return G.trim()}).map(function(G){return parseFloat(G.trim())});if(T.length>0&&T.length<=4){if(T.length===1){var O=bl(T,1),k=O[0];T=[k,k,k,k]}else if(T.length===2){var S=bl(T,2),N=S[0],L=S[1];T=[N,L,N,L]}else if(T.length===3){var $=bl(T,3),B=$[0],L=$[1],E=$[2];T=[B,L,E,L]}var A=bl(T,4),M=A[0],F=A[1],H=A[2],R=A[3];C+=F+R,D+=M+H,v=v+(F-R)/2,_=_+(H-M)/2}}m=Vo(Vo({},s),{x:v-1,y:_-1,width:C,height:D})}return Re(Ao,Vo({},m))}return null},e.prototype.getShape=function(){var t=this.props.model,o=t.text,i=o.x,r=o.y,s=o.value;if(!s)return null;var a=t.getTextStyle(),l=Vo({x:i,y:r,value:s,model:t,className:"lf-element-text"},a);return Re("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),Re(K_,Vo({},l))]})},e})(nm),iY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),lu=function(){return lu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},lu.apply(this,arguments)},rY=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},xl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},sr=(function(n){iY(e,n);function e(t){var o=n.call(this)||this;o.onDragStart=function(l){var u=l.event,c=o.props,f=c.model,p=c.graphModel;if(u){var h=p.getPointByClient({x:u.clientX,y:u.clientY}).canvasOverlayPosition,v=h.x,_=h.y;o.moveOffset={dx:f.x-v,dy:f.y-_}}},o.onDragging=function(l){var u,c,f,p,h=l.event,v=o.props,_=v.model,m=v.graphModel,g=m.editConfigModel,b=g.stopMoveGraph,C=g.autoExpand,D=g.snapGrid,T=m.transformModel,O=m.selectNodes,k=m.width,S=m.height,N=m.gridSize;_.isDragging=!0;var L=h,$=L.clientX,B=L.clientY,E=m.getPointByClient({x:$,y:B}).canvasOverlayPosition,A=E.x,M=E.y,F=xl(T.CanvasPointToHtmlPoint([A,M]),2),H=F[0],R=F[1];if(A=A+((c=(u=o.moveOffset)===null||u===void 0?void 0:u.dx)!==null&&c!==void 0?c:0),M=M+((p=(f=o.moveOffset)===null||f===void 0?void 0:f.dy)!==null&&p!==void 0?p:0),A=ys(A,N,D),M=ys(M,N,D),!k||!S){m.moveNode2Coordinate(_.id,A,M);return}var G=H<0||R<0||H>k||R>S;if(!(C&&!b&&G)){var oe=xl(T.CanvasPointToHtmlPoint([A-_.width/2,M-_.height/2]),2),V=oe[0],Y=oe[1],Q=xl(T.CanvasPointToHtmlPoint([A+_.width/2,M+_.height/2]),2),ue=Q[0],te=Q[1],q=Math.max(N,20),re=[];V<0?re=[q,0]:ue>m.width?re=[-q,0]:Y<0?re=[0,q]:te>m.height&&(re=[0,-q]),o.t&&iu(o.t);var ce=O.map(function(ve){return ve.id});ce.indexOf(_.id)===-1&&(ce=[_.id]),re.length>0&&!b&&C?o.t=Y_(function(){var ve=xl(re,2),Ne=ve[0],ge=ve[1];T.translate(Ne??0,ge??0);var _e=-(Ne??0)/T.SCALE_X,st=-(ge??0)/T.SCALE_X;m.moveNodes(ce,_e,st)}):m.moveNodes(ce,A-_.x,M-_.y)}},o.onDragEnd=function(){o.t&&iu(o.t);var l=o.props.model;l.isDragging=!1},o.onMouseOut=function(l){gG()&&o.setHoverOff(l)},o.handleMouseUp=function(){var l=o.props.model;o.mouseUpDrag=l.isDragging,o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0)},o.handleClick=function(l){var u=o.mouseUpDrag===!1,c=new Date().getTime();if(o.startTime){var f=c-o.startTime,p=o.props,h=p.model,v=p.graphModel;if(!(!u&&f>100)){u||(o.onDragEnd(),o.handleMouseUp());var _=h.getData(),m=v.getPointByClient({x:l.clientX,y:l.clientY}),g={data:_,e:l,position:m,isSelected:!1,isMultiple:!1},b=l.button===2,C=l.detail===2;if(!b){var D=v.editConfigModel,T=G_(l,D);g.isMultiple=T,h.isSelected&&!C&&T?(g.isSelected=!1,h.setSelected(!1)):(v.selectNodeById(h.id,T),g.isSelected=!0,D.isSilentMode||o.toFront()),C?(D.nodeTextEdit&&h.text.editable&&D.textMode===Mo.TEXT&&(h.setSelected(!1),v.setElementStateById(h.id,en.TEXT_EDIT)),v.eventCenter.emit(pt.NODE_DBCLICK,g)):(v.eventCenter.emit(pt.ELEMENT_CLICK,g),v.eventCenter.emit(pt.NODE_CLICK,g))}}}},o.handleContextMenu=function(l){l.preventDefault();var u=o.props,c=u.model,f=u.graphModel,p=f.editConfigModel,h=c.getData(),v=f.getPointByClient({x:l.clientX,y:l.clientY});f.setElementStateById(c.id,en.SHOW_MENU,v.domOverlayPosition),c.isSelected||f.selectNodeById(c.id),f.eventCenter.emit(pt.NODE_CONTEXTMENU,{data:h,e:l,position:v}),p.isSilentMode||o.toFront()},o.handleMouseDown=function(l){var u=o.props,c=u.model,f=u.graphModel;o.startTime=new Date().getTime();var p=f.editConfigModel;p.adjustNodePosition&&c.draggable&&o.stepDrag&&o.stepDrag.handleMouseDown(l),o.longPressTimer&&clearTimeout(o.longPressTimer),l.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.props.model.isDragging||o.handleContextMenu(l)},500))},o.handleFocus=function(){var l=o.props,u=l.model,c=l.graphModel;c.eventCenter.emit(pt.NODE_FOCUS,{data:u.getData()})},o.handleBlur=function(){if(o.props){var l=o.props,u=l.model,c=l.graphModel;c.eventCenter.emit(pt.NODE_BLUR,{data:u.getData()})}},o.setHoverOn=function(l){var u=o.props,c=u.model,f=u.graphModel;if(!c.isHovered){var p=c.getData();c.setHovered(!0),f.eventCenter.emit(pt.NODE_MOUSEENTER,{data:p,e:l})}},o.setHoverOff=function(l){var u=o.props,c=u.model,f=u.graphModel,p=c.getData();c.isHovered&&(c.setHovered(!1),f.eventCenter.emit(pt.NODE_MOUSELEAVE,{data:p,e:l}))};var i=t.graphModel,r=i.gridSize,s=i.eventCenter,a=t.model;return o.stepDrag=new Lo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"NODE",isStopPropagation:!1,eventCenter:s,model:a}),o.modelDisposer=b_(function(){return o.props},function(l){l&&l.model&&o.stepDrag.setModel(l.model)}),o}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.isSelected,a=i.isHitable,l=i.isDragging,u=i.isShowAnchor;return a&&(s||u)&&!l?Zo(i.anchors,function(c,f){var p=i.getAnchorLineStyle(c),h=i.getAnchorStyle(c);return Re(YW,{anchorData:c,node:t,style:h,edgeStyle:p,anchorIndex:f,nodeModel:i,graphModel:r,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowRotate,l=o.isSelected,u=o.isHitable,c=o.rotatable,f=o.isHovered,p=a&&c,h=o.getRotateControlStyle();if(!s&&u&&(l||f)&&p)return Re(JW,{graphModel:i,nodeModel:o,eventCenter:i.eventCenter,style:h})},e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowResize,l=o.isSelected,u=o.isHitable,c=o.resizable,f=o.isHovered,p=a&&c,h=o.getResizeControlStyle();return!s&&u&&(l||f)&&p?Re(gX,{style:h,model:o,graphModel:i}):null},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.nodeTextMode!==Mo.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var a=!1;return s.nodeTextDraggable&&i.text.draggable&&(a=!0),Re(nm,{editable:s.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,o=t.state,i=t.isDragging,r=t.isSelected,s="lf-node";switch(o){case en.ALLOW_CONNECT:s+=" lf-node-allow";break;case en.NOT_ALLOW_CONNECT:s+=" lf-node-not-allow";break;default:s+=" lf-node-default";break}return i&&(s+=" lf-dragging"),r&&(s+=" lf-node-selected"),s},e.prototype.toFront=function(){var t=this.props,o=t.model,i=t.graphModel;o.autoToFront&&i.toFront(o.id)},e.prototype.render=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.hideAnchors,a=r.adjustNodePosition,l=r.allowRotate,u=r.allowResize,c=i.gridSize,f=i.transformModel.SCALE_X,p=o.isHitable,h=o.draggable,v=o.transform,_=o.getOuterGAttributes(),m=_.className,g=m===void 0?"":m,b=rY(_,["className"]),C=Re("g",{className:"lf-node-content",children:[Re("g",{transform:v,children:[this.getShape(),this.getText(),l&&this.getRotateControl(),u&&this.getResizeControl()]}),!s&&this.getAnchors()]}),D;return p?(a&&h&&this.stepDrag.setStep(c*f),D=Re("g",lu({className:"".concat(this.getStateClassName()," ").concat(g),onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},b,{children:C}))):D=Re("g",lu({className:"".concat(this.getStateClassName()," ").concat(g)},b,{children:C})),D},e.isObserved=!1,e})(Yt),sY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Dc=function(){return Dc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Dc.apply(this,arguments)},Mr=(function(n){sY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re(Ao,Dc({},o,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e})(sr),aY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ac=function(){return Ac=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ac.apply(this,arguments)},uu=(function(n){aY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.r,s=t.getNodeStyle();return Re(xs,Ac({},s,{x:o,y:i,r}))},e})(sr),lY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),du=function(){return du=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},du.apply(this,arguments)},cu=(function(n){lY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,u=t.getNodeStyle(),c={transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")};return Re("g",du({},c,{children:Re($f,du({},u,{points:l,x:i,y:r}))}))},e})(sr),uY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Oc=function(){return Oc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Oc.apply(this,arguments)},Nc=(function(n){uY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re("g",{children:Re($f,Oc({},o,{points:t.points,x:t.x,y:t.y}))})},e})(sr),dY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Mc=function(){return Mc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mc.apply(this,arguments)},Tc=(function(n){dY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re(lX,Mc({},o,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e})(sr),cY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ca=function(){return ca=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ca.apply(this,arguments)},nv=(function(n){cY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,o=t.getTextStyle(),i=t.width,r=t.height,s=t.x,a=t.y,l=ca(ca({},o.background),{x:s,y:a,width:i,height:r});return Re(Ao,ca({},l))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return Re("g",{children:this.getBackground()})},e})(sr),fY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),$c=function(){return $c=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},$c.apply(this,arguments)},pY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},hY=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Ba=(function(n){fY(e,n);function e(){var t=n.apply(this,hY([],pY(arguments),!1))||this;return t.ref=Uu(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.height,s=t.width,a=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),Re("foreignObject",$c({},a,{x:o-s/2,y:i-r/2,width:s,height:r,ref:this.ref}))},e})(sr),vY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ho=function(){return Ho=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ho.apply(this,arguments)},gY=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},_Y=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},ci;(function(n){n.SOURCE="SOURCE",n.TARGET="TARGET"})(ci||(ci={}));var ov=(function(n){vY(e,n);function e(t){var o=n.call(this)||this;o.handleMouseDown=function(l){o.stepDrag&&o.stepDrag.handleMouseDown(l)},o.onDragStart=function(){var l=o.props,u=l.x,c=l.y,f=l.edgeModel,p=f.startPoint,h=f.endPoint,v=f.pointsList;o.oldEdge={startPoint:p,endPoint:h,pointsList:v},o.setState({endX:u,endY:c,dragging:!0})},o.onDragging=function(l){var u=l.deltaX,c=l.deltaY,f=o.state,p=f.endX,h=f.endY,v=o.props,_=v.graphModel,m=v.type,g=_.transformModel,b=_.editConfigModel,C=_Y(g.moveCanvasPointByHtml([p,h],u,c),2),D=C[0],T=C[1];o.setState({endX:D,endY:T,dragging:!0});var O=o.props.edgeModel,k=nu({x:p,y:h},_);if(k&&k.node&&o.isAllowAdjust(k).pass){var S=O.startPoint,N=O.endPoint,L=O.sourceNode,$=O.targetNode,B=m===ci.SOURCE?{startPoint:{x:k.anchor.x,y:k.anchor.y},endPoint:{x:N.x,y:N.y},sourceNode:k.node,targetNode:$}:{startPoint:{x:S.x,y:S.y},endPoint:{x:k.anchor.x,y:k.anchor.y},sourceNode:L,targetNode:k.node};O.updateAfterAdjustStartAndEnd(B)}else m===ci.SOURCE?O.updateStartPoint({x:D,y:T}):O.updateEndPoint({x:D,y:T});O.text.value&&b.adjustEdge&&O.setText(Object.assign({},O.text,O.textPosition))},o.onDragEnd=function(l){var u,c,f,p=l.event;try{o.setState({dragging:!1});var h=o.props,v=h.graphModel,_=h.edgeModel,m=h.type,g=o.state,b=g.endX,C=g.endY,D=g.dragging,T=nu({x:b,y:C},v);if(!D)return;var O=!1,k=void 0;if(T&&T.node){var S=o.isAllowAdjust(T),N=S.pass,L=S.msg,$=S.newTargetNode;if(N){var B=_.getData(),E=B.text,A=B.sourceAnchorId,M=A===void 0?"":A,F=B.targetAnchorId,H=F===void 0?"":F,R=gY(B,["text","sourceAnchorId","targetAnchorId"]);if(k=Ho(Ho({sourceAnchorId:M,targetAnchorId:H},R),{text:(E==null?void 0:E.value)||""}),m===ci.SOURCE){var G=v.getNodeModelById(T.node.id),oe=v.getNodeModelById(_.targetNodeId),V=(u=v.edgeGenerator)===null||u===void 0?void 0:u.call(v,G==null?void 0:G.getData(),oe==null?void 0:oe.getData(),k);k=Ho(Ho({},V),{sourceNodeId:T.node.id,sourceAnchorId:T.anchor.id,startPoint:{x:T.anchor.x,y:T.anchor.y},targetNodeId:_.targetNodeId,endPoint:Ho({},_.endPoint)}),_.sourceNodeId===T.node.id&&_.sourceAnchorId===T.anchor.id&&(O=!0)}else if(m===ci.TARGET){var G=v.getNodeModelById(_.sourceNodeId),oe=v.getNodeModelById(T.node.id),V=(c=v.edgeGenerator)===null||c===void 0?void 0:c.call(v,G==null?void 0:G.getData(),oe==null?void 0:oe.getData(),k);k=Ho(Ho({},V),{sourceNodeId:_.sourceNodeId,startPoint:Ho({},_.startPoint),targetNodeId:T.node.id,targetAnchorId:T.anchor.id,endPoint:{x:T.anchor.x,y:T.anchor.y}}),_.targetNodeId===T.node.id&&_.targetAnchorId===T.anchor.id&&(O=!0)}}else{O=!0;var Y=$.getData();v.eventCenter.emit(pt.CONNECTION_NOT_ALLOWED,{data:Y,msg:L})}}else O=!0;if(O)o.recoveryEdge();else{var Q=_.getData();v.deleteEdgeById(_.id);var ue=v.addEdge(Ho({},k));v.eventCenter.emit(pt.EDGE_EXCHANGE_NODE,{data:{newEdge:ue.getData(),oldEdge:Q}})}(f=o.preTargetNode)===null||f===void 0||f.setElementState(en.DEFAULT)}finally{var v=o.props.graphModel;v.eventCenter.emit(pt.ADJUST_POINT_DRAGEND,{e:p,data:o.stepDragData})}},o.recoveryEdge=function(){var l=o.props.edgeModel,u=o.oldEdge,c=u.startPoint,f=u.endPoint,p=u.pointsList;l.updateStartPoint(c),l.updateEndPoint(f),l.modelType!==zt.LINE_EDGE&&(l.pointsList=p??[],l.initPoints())},o.getAdjustPointStyle=function(){var l=o.props.graphModel.theme,u=l.edgeAdjust;return u},o.state={dragging:!1,endX:0,endY:0},o.targetRuleResults=new Map,o.sourceRuleResults=new Map;var i=t.type,r=t.edgeModel,s=t.graphModel,a=s.eventCenter;return o.stepDragData={type:i,edgeData:r.getData()},o.stepDrag=new Lo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:a,data:o.stepDragData}),o}return e.prototype.isAllowAdjust=function(t){var o=this.props,i=o.edgeModel,r=i.id,s=i.sourceNode,a=i.targetNode,l=i.sourceAnchorId,u=i.targetAnchorId,c=o.type,f,p,h,v;if(c===ci.SOURCE?(f=t.node,p=a,h=t.anchor,v=a.getAnchorInfo(u)):(f=s,p=t.node,v=t.anchor,h=s.getAnchorInfo(l)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(en.DEFAULT),this.preTargetNode=t.node,v.id===h.id)return{pass:!1,msg:"",newTargetNode:p};var _="".concat(f.id,"_").concat(p.id,"_").concat(h.id,"_").concat(v.id);if(!this.targetRuleResults.has(_)){var m=f.isAllowConnectedAsSource(p,h,v,r),g=p.isAllowConnectedAsTarget(f,h,v,r);this.sourceRuleResults.set(_,ou(m)),this.targetRuleResults.set(_,ou(g))}var b=this.sourceRuleResults.get(_),C=b.isAllPass,D=b.msg,T=this.targetRuleResults.get(_),O=T.isAllPass,k=T.msg,S=C&&O?en.ALLOW_CONNECT:en.NOT_ALLOW_CONNECT;return c===ci.SOURCE?f.setElementState(S):p.setElementState(S),{pass:C&&O,msg:k||D,newTargetNode:p}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.getAdjustPointShape,s=t.edgeModel,a=this.state.dragging;return Re("g",{pointerEvents:a?"none":"",onPointerDown:this.handleMouseDown,children:a?"":r(o,i,s)})},e})(Yt),mY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Pc=function(){return Pc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Pc.apply(this,arguments)};(function(n){mY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,o=t.arrowInfo,i=t.style,r=o.start,s=o.end,a={start:r,end:s,offset:i.offset,verticalLength:i.verticalLength,type:"end"},l=ka(a),u=l.leftX,c=l.leftY,f=l.rightX,p=l.rightY;return Pc({d:"M".concat(u," ").concat(c," L").concat(s.x," ").concat(s.y," L").concat(f," ").concat(p," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),o=t.d,i=t.strokeWidth,r=t.stroke,s=t.fill;return Re(Aa,{d:o,fill:s,strokeWidth:i,stroke:r})},e.prototype.render=function(){return Re("g",{className:"lf-arrow",children:this.getShape()})},e})(Yt);var yY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fa=function(){return fa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fa.apply(this,arguments)},bY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ju=(function(n){yY(e,n);function e(){var t=n.call(this)||this;return t.textRef=Uu(),t.handleHover=function(o,i){var r=t.props,s=r.model,a=r.graphModel.eventCenter;s.setHovered(o);var l=o?pt.EDGE_MOUSEENTER:pt.EDGE_MOUSELEAVE,u=s.getData();a.emit(l,{data:u,e:i})},t.setHoverOn=function(o){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,o))},t.setHoverOff=function(o){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,o))},t.handleContextMenu=function(o){o.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,r=i.model,s=i.graphModel,a=s.editConfigModel,l=s.getPointByClient({x:o.clientX,y:o.clientY});s.setElementStateById(r.id,en.SHOW_MENU,l.domOverlayPosition),a.isSilentMode||t.toFront(),r.isSelected||s.selectEdgeById(r.id);var u=r==null?void 0:r.getData();s.eventCenter.emit(pt.EDGE_CONTEXTMENU,{data:u,e:o,position:l})},t.handleMouseDown=function(o){o.stopPropagation(),t.startTime=new Date().getTime(),t.longPressTimer&&clearTimeout(t.longPressTimer),o.pointerType==="touch"&&(t.longPressTimer=window.setTimeout(function(){t.props.model.isDragging||t.handleContextMenu(o)},500))},t.handleMouseUp=function(){var o=t.props.model;t.mouseUpDrag=o.isDragging,t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=void 0)},t.handleClick=function(o){if(t.startTime&&!t.mouseUpDrag){var i=o.button===2;if(!i){var r=o.detail===2,s=t.props,a=s.model,l=s.graphModel,u=a==null?void 0:a.getData(),c=l.getPointByClient({x:o.clientX,y:o.clientY});if(r){var f=l.editConfigModel,p=l.textEditElement,h=a.id,v=a.text,_=a.modelType;if(p&&p.id===h&&l.setElementStateById(h,en.DEFAULT),f.edgeTextEdit&&v.editable&&(a.setSelected(!1),l.setElementStateById(h,en.TEXT_EDIT)),_===zt.POLYLINE_EDGE){var m=a,g=l.getPointByClient({x:o.x,y:o.y}).canvasOverlayPosition,b=g.x,C=g.y;m.dbClickPosition=q_({x:b,y:C},m.points)}l.eventCenter.emit(pt.EDGE_DBCLICK,{data:u,e:o,position:c})}else l.eventCenter.emit(pt.ELEMENT_CLICK,{data:u,e:o,position:c}),l.eventCenter.emit(pt.EDGE_CLICK,{data:u,e:o,position:c});var D=l.editConfigModel;l.selectEdgeById(a.id,G_(o,D)),D.isSilentMode||t.toFront()}}},t.handleFocus=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(pt.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(pt.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return Re("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.edgeTextMode!==Mo.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var a=!1;return s.edgeTextDraggable&&i.text.draggable&&(a=!0),Re(oY,{ref:this.textRef,editable:s.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isSelected,s=this.state.hover;return{start:o,end:i,hover:s,isSelected:r}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint;return[o,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,o=t.id,i=t.getArrowStyle(),r=i.refY,s=r===void 0?0:r,a=i.refX,l=a===void 0?2:a,u=bY(this.getLastTwoPoints(),2),c=u[0],f=u[1],p="auto";if(c&&f){var h=f.x-c.x,v=f.y-c.y;if(h!==0||v!==0){var _=TX(MX({x:h,y:v}));Number.isFinite(_)&&!Number.isNaN(_)&&(p=_)}}return Re("g",{children:Re("defs",{children:[Re("marker",{id:"marker-start-".concat(o),refX:-l,refY:s,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),Re("marker",{id:"marker-end-".concat(o),refX:l,refY:s,overflow:"visible",orient:p,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,o){var i=o.stroke,r=o.fill,s=r===void 0?i:r,a=o.strokeWidth,l=o.offset,u=l===void 0?10:l,c=o.verticalLength,f=o.strokeLinecap,p=o.strokeLinejoin,h=o.transform,v="";switch(t){case"solid":v="M".concat(-u/4,",0 L").concat(3*u/4,",").concat(c," L").concat(3*u/4,",-").concat(c," Z");break;case"hollow":v="M".concat(-u/4,",0 L").concat(3*u/4,",").concat(c," L").concat(-u/4,",0 L").concat(3*u/4,",-").concat(c," L").concat(-u/4,",0 Z");break;case"diamond":v="M".concat(-u/2,",0 L0,").concat(c," L").concat(u/2,",0 L0,-").concat(c," L").concat(-u/2,",0 Z");break;case"circle":v="M".concat(-u/2,",0 A").concat(u/4,",").concat(u/4," 0 1,0 ").concat(u/2,",0 A").concat(u/4,",").concat(u/4," 0 1,0 ").concat(-u/2,",0 Z");break;default:v="";break}return Re("path",{d:v,stroke:i,fill:s,strokeWidth:a,strokeLinecap:f,strokeLinejoin:p,transform:h})},e.prototype.getStartArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.startArrowType,u=l===void 0?"none":l,c=o.strokeLinecap,f=o.strokeLinejoin;return this.getArrowPath(u,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:f})},e.prototype.getEndArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.endArrowType,u=l===void 0?"solid":l,c=o.strokeLinecap,f=o.strokeLinejoin;return this.getArrowPath(u,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:f,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,o,i){var r=i.getAdjustPointStyle();return Re(xs,fa({className:"lf-edge-adjust-point"},r,{x:t,y:o}))},e.prototype.getAdjustPoints=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.adjustEdgeStartAndEnd,a=r.adjustEdgeStart,l=r.adjustEdgeEnd,u=o.getAdjustStart(),c=o.getAdjustEnd();return Re("g",{children:[s&&a&&Re(ov,fa({type:ci.SOURCE},u,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i})),s&&l&&Re(ov,fa({type:ci.TARGET},c,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return Re("g",{})},e.prototype.getAppend=function(){return Re("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,o=t.graphModel,i=t.model;o.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,o=t.isSelected,i=t.isHitable,r=t.isShowAdjustPoint;return Re("g",{children:[Re("g",{className:["lf-edge",!i&&"pointer-none",o&&"lf-edge-selected"].filter(Boolean).join(" "),style:{touchAction:"none",WebkitTouchCallout:"none"},onClick:this.handleClick,onContextMenu:this.handleContextMenu,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onPointerCancel:this.handleMouseUp,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),r&&o?this.getAdjustPoints():""]})},e.isObserved=!1,e})(Yt),xY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Rc=function(){return Rc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Rc.apply(this,arguments)},wY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Bc=(function(n){xY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.getEdgeStyle(),i=t,r=i.path,s=i.isAnimation,a=i.arrowConfig,l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,p=l.animationName,h=l.animationDuration,v=l.animationIterationCount,_=l.animationTimingFunction,m=l.animationDirection;return Re(Aa,Rc({d:r},o,a,s?{strokeDasharray:u,stroke:c,style:{strokeDashoffset:f,animationName:p,animationDuration:h,animationIterationCount:v,animationTimingFunction:_,animationDirection:m}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return Re(Aa,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,o=this.state.hover,i=t.isSelected,r=t.getArrowStyle().offset,s=t.pointsList.map(function(f){return{x:f.x,y:f.y}}),a=wY(Lh(s,r),2),l=a[0],u=a[1],c={start:l,end:u,hover:o,isSelected:i};return c},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.getArrowStyle().offset,i=t.pointsList.map(function(r){return{x:r.x,y:r.y}});return Lh(i,o)},e})(Ju),CY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Lc=function(){return Lc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Lc.apply(this,arguments)},iv=(function(n){CY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isAnimation,s=t.arrowConfig,a=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,p=l.animationName,h=l.animationDuration,v=l.animationIterationCount,_=l.animationTimingFunction,m=l.animationDirection;return Re(bs,Lc({},a,{x1:o.x,y1:o.y,x2:i.x,y2:i.y},s,r?{strokeDasharray:u,stroke:c,style:{strokeDashoffset:f,animationName:p,animationDuration:h,animationIterationCount:v,animationTimingFunction:_,animationDirection:m}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r={start:o,end:i},s=LG(r),a=s.d,l=s.strokeWidth,u=s.fill,c=s.strokeDasharray,f=s.stroke;return Re(Aa,{d:a,fill:u,strokeWidth:l,stroke:f,strokeDasharray:c})},e})(Ju),SY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),mr=function(){return mr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mr.apply(this,arguments)},kY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ss=(function(n){SY(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(){var o=t.props.model;o.dragAppendStart(),t.isShowAdjustPointTemp=o.isShowAdjustPoint,o.isShowAdjustPoint=!1},t.onDragging=function(o){var i=o.deltaX,r=o.deltaY,s=t.props,a=s.model,l=s.graphModel;t.isDragging=!0;var u=l.transformModel,c=l.editConfigModel,f=kY(u.fixDeltaXY(i,r),2),p=f[0],h=f[1],v=a,_=c.adjustEdgeMiddle;_?t.appendInfo=v.dragAppendSimple(t.appendInfo,{x:p,y:h}):t.appendInfo=v.dragAppend(t.appendInfo,{x:p,y:h})},t.onDragEnd=function(){var o,i=t.props,r=i.model,s=i.graphModel.eventCenter,a=r;a.dragAppendEnd(),t.isDragging=!1,a.isShowAdjustPoint=(o=t.isShowAdjustPointTemp)!==null&&o!==void 0?o:!1,t.appendInfo=void 0,s.emit(pt.EDGE_ADJUST,{data:a.getData()})},t.beforeDragStart=function(o,i){i.draggable&&t.drag.handleMouseDown(o),t.appendInfo=i},t.drag=new Lo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.getEdgeStyle(),a=t.getEdgeAnimationStyle(),l=a.strokeDasharray,u=a.stroke,c=a.strokeDashoffset,f=a.animationName,p=a.animationDuration,h=a.animationIterationCount,v=a.animationTimingFunction,_=a.animationDirection;return Re(fX,mr({points:o},s,r,i?{strokeDasharray:l,stroke:u,style:{strokeDashoffset:c,animationName:f,animationDuration:p,animationIterationCount:h,animationTimingFunction:v,animationDirection:_}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.points,i=t.isSelected,r=this.state.hover,s=Nr(o),a=s[0],l=s[0];return s.length>=2&&(a=s[s.length-2],l=s[s.length-1]),{start:a,end:l,hover:r,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.points,i=Nr(o),r=i[0],s=i[0];return i.length>=2&&(r=i[i.length-2],s=i[i.length-1]),[r,s]},e.prototype.getAppendAttributes=function(t){var o=t.start,i=t.end,r;if(o.x===i.x&&o.y===i.y)r="";else{var s={start:o,end:i,offset:10,verticalLength:5},a=ka(mr(mr({},s),{type:"start"})),l=ka(mr(mr({},s),{type:"end"}));r="M".concat(a.leftX," ").concat(a.leftY,`
      L`).concat(a.rightX," ").concat(a.rightY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(l.leftX," ").concat(l.leftY," z")}return{d:r,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var o=this.getAppendAttributes(t),i=o.d,r=o.strokeWidth,s=o.fill,a=o.strokeDasharray,l=o.stroke;return Re(Aa,{d:i,fill:s,strokeWidth:r,stroke:l,strokeDasharray:a})},e.prototype.getAppendWidth=function(){for(var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.pointsList,a=i.draggable,l=[],u=s.length,c=function(h){var v="lf-polyline-append",_={start:{x:s[h].x,y:s[h].y},end:{x:s[h+1].x,y:s[h+1].y},startIndex:h,endIndex:h+1,direction:xn.HORIZONTAL,draggable:!0},m=Re("g",{className:v,children:f.getAppendShape(_)}),g=r.editConfigModel,b=g.adjustEdge,C=g.adjustEdgeMiddle;if(b&&a){var D=_.startIndex,T=_.endIndex,O=C&&(D===0||T===u-1);_.draggable=!O,_.start.x===_.end.x?(_.draggable&&(v+="-ew-resize"),_.direction=xn.VERTICAL):_.start.y===_.end.y&&(_.draggable&&(v+="-ns-resize"),_.direction=xn.HORIZONTAL),m=Re("g",{className:f.isDragging?"lf-dragging":"lf-drag-able",onPointerDown:function(k){return t.beforeDragStart(k,_)},children:Re("g",{className:v,children:f.getAppendShape(_)})})}l.push(m)},f=this,p=0;p<u-1;p++)c(p);return Re("g",{children:l})},e})(Ju),es=function(){return es=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},es.apply(this,arguments)},EY=(function(){function n(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,t.docPointerMove&&window.document.removeEventListener("pointermove",t.docPointerMove),t.docPointerUp&&window.document.removeEventListener("pointerup",t.docPointerUp)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(es(es({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(pt.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var r=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),s=r.x,a=r.y;t.fakeNode.moveTo(s,a);var l=t.fakeNode.getData();t.lf.setNodeSnapLine(l),t.lf.graphModel.eventCenter.emit(pt.NODE_DND_DRAG,{data:l,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(es(es({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),pt.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var o=e.lf;this.lf=o}return n.prototype.clientToLocalPoint=function(e){var t=e.x,o=e.y,i=Ha(this.lf.options,["grid","size"]),r=this.lf.graphModel.getPointByClient({x:t,y:o}),s=r.canvasOverlayPosition,a=s.x,l=s.y,u=this.lf.graphModel.editConfigModel.snapGrid;return{x:ys(a,i,u),y:ys(l,i,u)}},n.prototype.isInsideCanvas=function(e){var t=this.lf.graphModel.rootEl.querySelector('[name="canvas-overlay"]'),o=window.document.elementFromPoint(e.clientX,e.clientY);return o===t||o!==null&&!!t&&t.contains(o)},n.prototype.startDrag=function(e){var t=this,o=this.lf.graphModel.editConfigModel;o!=null&&o.isSilentMode||(this.nodeConfig=e,this.docPointerMove=function(i){if(t.nodeConfig){if(!t.isInsideCanvas(i)){t.onDragLeave();return}if(!t.fakeNode){t.dragEnter(i);return}t.onDragOver(i)}},this.docPointerUp=function(i){t.nodeConfig&&(t.isInsideCanvas(i)?t.onDrop(i):t.onDragLeave(),i.preventDefault(),i.stopPropagation(),t.stopDrag())},window.document.addEventListener("pointermove",this.docPointerMove),window.document.addEventListener("pointerup",this.docPointerUp))},n})();function DY(n,e){n.on("node:mousemove",function(t){var o=t.data;e.setNodeSnapLine(o)}),n.on("node:mouseup",function(){e.clearSnapline()})}var AY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ki=function(){return ki=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ki.apply(this,arguments)},OY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},NY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},MY=(function(n){AY(e,n);function e(t){var o=n.call(this,t)||this;return o.ref=Uu(),o.__prevText={type:"",text:"",id:""},o.keyupHandler=function(i){var r=o.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(r==null||r.setElementState(en.DEFAULT))},o.inputHandler=function(i){var r=i.target.innerText,s=o.props.graphModel.textEditElement;s&&(o.__prevText={type:s.type,text:r.replace(/(\r\n)+$|(\n)+$/,""),id:s.id})},o.keydownHandler=function(i){i.stopPropagation()},o.state={style:{left:0,top:0}},o}return e.getDerivedStateFromProps=function(t){var o,i=t.textEditElement,r=t.graphModel,s=r.transformModel,a=r.theme,l=a.inputText,u;if(i){if(!(!((o=i.text)===null||o===void 0)&&o.value)&&i.BaseType===Sn.EDGE){var c=i.text,f=i.textPosition,p=f.x,h=f.y;c.x=p,c.y=h,i.setText(c)}var v={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===Sn.EDGE){var _=a.edgeText,m=_.overflowMode,g=_.lineHeight,b=_.wrapPadding,C=_.textWidth;C&&m==="autoWrap"&&(u=ki(ki({},v),{width:C,minWidth:C,lineHeight:g,padding:b}))}else if(i.BaseType===Sn.NODE){var D=a.nodeText,m=D.overflowMode,g=D.lineHeight,b=D.wrapPadding,C=D.textWidth,T=i.width,O=i.modelType,k=i.textWidth,S=k||C||T;(O!==zt.TEXT_NODE&&m==="autoWrap"||O===zt.TEXT_NODE&&C)&&(u=ki(ki({},v),{width:S,minWidth:S,lineHeight:g,padding:b}))}var N=i.text,L=N.x,$=N.y,B=NY(s.CanvasPointToHtmlPoint([L,$]),2),E=B[0],A=B[1];return{style:ki(ki({left:E,top:A},u),l)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var o=this.__prevText,i=o.text,r=o.id;t.updateText(r,i),t.eventCenter.emit(pt.TEXT_UPDATE,{data:ki({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var o=document.createRange();o.selectNodeContents(t),o.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(o)}},e.prototype.render=function(){var t,o=this.props.graphModel.textEditElement,i=this.state.style;return o?Re("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=o.text)===null||t===void 0?void 0:t.value},o.id):null},e.toolName="text-edit-tool",e=OY([eo],e),e})(Yt),TY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),$Y=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Sd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},PY=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},RY=(function(n){TY(e,n);function e(t){var o=n.call(this,t)||this;o.handleMouseDown=function(a){o.stepDrag.handleMouseDown(a)},o.handleWheelEvent=function(a){var l,u;a.preventDefault();var c=a.deltaX,f=a.deltaY,p=a.clientX,h=a.clientY,v=a.ctrlKey,_=new WheelEvent("wheel",{deltaX:c,deltaY:f,clientX:p,clientY:h,ctrlKey:v});(u=(l=o.props.lf.container)===null||l===void 0?void 0:l.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||u===void 0||u.dispatchEvent(_)},o.onDragging=function(a){var l=a.deltaX,u=a.deltaY,c=o.props,f=c.graphModel,p=c.lf,h=p.getTransform(),v=h.SCALE_X,_=h.SCALE_Y,m=f.getSelectElements(!0);f.moveNodes(m.nodes.map(function(g){return g.id}),l/v,u/_)},o.handleContextMenu=function(a){a.preventDefault();var l=o.props,u=l.graphModel,c=l.graphModel,f=c.eventCenter,p=c.selectElements,h=u.getPointByClient({x:a.clientX,y:a.clientY}),v={nodes:[],edges:[]},_=PY([],Sd(p.values()),!1);_.forEach(function(m){m.BaseType===Sn.NODE&&v.nodes.push(m.getData()),m.BaseType===Sn.EDGE&&v.edges.push(m.getData())}),f.emit(pt.SELECTION_CONTEXTMENU,{data:v,e:a,position:h})};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new Lo({onDragging:o.onDragging,step:r,eventType:"SELECTION",eventCenter:s}),o}return e.prototype.render=function(){var t,o,i=this.props.graphModel,r=i.selectElements,s=i.transformModel,a=this.props.lf.getTransform(),l=a.SCALE_X,u=a.SCALE_Y;if(!(r.size<=1)){var c=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;r.forEach(function(_){var m;_.BaseType===Sn.NODE&&(m=bG(_)),_.BaseType===Sn.EDGE&&(m=SG(_)),m!==void 0&&(c=Math.min(c,m.x),f=Math.min(f,m.y),p=Math.max(p,m.x1),h=Math.max(h,m.y1))}),t=Sd(s.CanvasPointToHtmlPoint([c,f]),2),c=t[0],f=t[1],o=Sd(s.CanvasPointToHtmlPoint([p,h]),2),p=o[0],h=o[1];var v={left:"".concat(c-20*l/2,"px"),top:"".concat(f-20*u/2,"px"),width:"".concat(p-c+20*l,"px"),height:"".concat(h-f+20*u,"px"),"border-width":"".concat(2*l,"px")};return Re("div",{className:"lf-multiple-select",style:v,onPointerDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=$Y([eo],e),e})(Yt),kd=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},BY=[MY,RY],LY=(function(){function n(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,Lt(BY,function(r){t.isDisabled(r.toolName)||t.registerTool(r.toolName,r)});var o=e.graphModel,i=o.eventCenter;i.on("".concat(pt.GRAPH_TRANSFORM,",").concat(pt.NODE_CLICK,",").concat(pt.BLANK_CLICK," "),function(){var r,s=o.textEditElement,a=o.editConfigModel,l=a.edgeTextEdit,u=a.nodeTextEdit;(l||u)&&s&&((r=o.textEditElement)===null||r===void 0||r.setElementState(en.DEFAULT))})}return n.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},n.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},n.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},n.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},n.prototype.getTools=function(){return Array.from(this.toolMap.values())},n.prototype.getInstance=function(){return this.instance},n.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},kd([Pe],n.prototype,"toolMap",void 0),kd([Te],n.prototype,"disableTool",null),kd([Te],n.prototype,"enableTool",null),n})();function IY(n){throw new Error("[mobx-utils] "+n)}function fu(n,e){e===void 0&&(e="Illegal state"),n||IY(e)}var om=function(n){return n&&n!==Object.prototype&&Object.getOwnPropertyNames(n).concat(om(Object.getPrototypeOf(n))||[])},FY=function(n){var e=om(n),t=e.filter(function(o,i){return e.indexOf(o)===i});return t},jY=function(n){return FY(n).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},im="pending",pu="fulfilled",Pf="rejected";function VY(n){switch(this.state){case im:return n.pending&&n.pending(this.value);case Pf:return n.rejected&&n.rejected(this.value);case pu:return n.fulfilled?n.fulfilled(this.value):this.value}}function rv(n,e){if(fu(arguments.length<=2,"fromPromise expects up to two arguments"),fu(typeof n=="function"||typeof n=="object"&&n&&typeof n.then=="function","Please pass a promise or function to fromPromise"),n.isPromiseBasedObservable===!0)return n;typeof n=="function"&&(n=new Promise(n));var t=n;n.then(Te("observableFromPromise-resolve",function(i){t.value=i,t.state=pu}),Te("observableFromPromise-reject",function(i){t.value=i,t.state=Pf})),t.isPromiseBasedObservable=!0,t.case=VY;var o=e&&e.state===pu?e.value:void 0;return rc(t,{value:o,state:im},{},{deep:!1}),t}(function(n){n.reject=Te("fromPromise.reject",function(t){var o=n(Promise.reject(t));return o.state=Pf,o.value=t,o});function e(t){t===void 0&&(t=void 0);var o=n(Promise.resolve(t));return o.state=pu,o.value=t,o}n.resolve=Te("fromPromise.resolve",e)})(rv||(rv={}));var wl=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r};(function(){function n(e,t){var o=this;vq(function(){o.current=t,o.subscription=e.subscribe(o)})}return n.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},n.prototype.next=function(e){this.current=e},n.prototype.complete=function(){this.dispose()},n.prototype.error=function(e){this.current=e,this.dispose()},wl([Pe.ref],n.prototype,"current",void 0),wl([Te.bound],n.prototype,"next",null),wl([Te.bound],n.prototype,"complete",null),wl([Te.bound],n.prototype,"error",null),n})();var hu=function(){return hu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},hu.apply(this,arguments)},Gs=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},HY=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function n(e){var t=this;this.model=e,this.localValues=Pe.map({}),this.localComputedValues=Pe.map({}),this.isPropertyDirty=function(o){return t.localValues.has(o)},fu(ni(e),"createViewModel expects an observable object"),jY(e).forEach(function(o){if(!(o===Mt||o==="__mobxDidRunLazyInitializers")){if(fu(HY.indexOf(o)===-1,"The propertyname "+o+" is reserved and cannot be used with viewModels"),Wp(e,o)){var i=Wu(e,o).derivation;t.localComputedValues.set(o,mn(i.bind(t)))}var r=Object.getOwnPropertyDescriptor(e,o),s=r?{enumerable:r.enumerable}:{};Object.defineProperty(t,o,hu(hu({},s),{configurable:!0,get:function(){return Wp(e,o)?t.localComputedValues.get(o).get():t.isPropertyDirty(o)?t.localValues.get(o):t.model[o]},set:Te(function(a){a!==t.model[o]?t.localValues.set(o,a):t.localValues.delete(o)})}))}})}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),n.prototype.submit=function(){var e=this;ms(this.localValues).forEach(function(t){var o=e.localValues.get(t),i=e.model[t];bi(i)?i.replace(o):co(i)?(i.clear(),i.merge(o)):wq(o)||(e.model[t]=o)}),this.localValues.clear()},n.prototype.reset=function(){this.localValues.clear()},n.prototype.resetProperty=function(e){this.localValues.delete(e)},Gs([mn],n.prototype,"isDirty",null),Gs([mn],n.prototype,"changedValues",null),Gs([Te.bound],n.prototype,"submit",null),Gs([Te.bound],n.prototype,"reset",null),Gs([Te.bound],n.prototype,"resetProperty",null),n})();function Ed(n){if(!n)return"ROOT";for(var e=[];n.parent;)e.push(n.path),n=n.parent;return e.reverse().join("/")}function Dd(n){return ni(n)||bi(n)||co(n)}function UY(n,e){var t=new WeakMap;function o(a){var l=t.get(a.object);i(a,l),e(a,Ed(l),n)}function i(a,l){switch(a.type){case"add":r(a.newValue,l,a.name);break;case"update":s(a.oldValue),r(a.newValue,l,a.name||""+a.index);break;case"remove":case"delete":s(a.oldValue);break;case"splice":a.removed.map(s),a.added.forEach(function(f,p){return r(f,l,""+(a.index+p))});for(var u=a.index+a.addedCount;u<a.object.length;u++)if(Dd(a.object[u])){var c=t.get(a.object[u]);c&&(c.path=""+u)}break}}function r(a,l,u){if(Dd(a)){var c=t.get(a);if(c){if(c.parent!==l||c.path!==u)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Ed(l)+"/"+u+"',")+(" but it already exists at '"+Ed(c.parent)+"/"+c.path+"'"))}else{var f={parent:l,path:u,dispose:D_(a,o)};t.set(a,f),kq(a).forEach(function(p){var h=p[0],v=p[1];return r(v,f,h)})}}}function s(a){if(Dd(a)){var l=t.get(a);if(!l)return;t.delete(a),l.dispose(),Sq(a).forEach(s)}}return r(n,void 0,""),function(){s(n)}}var zY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)i.hasOwnProperty(r)&&(o[r]=i[r])},n(e,t)};return function(e,t){n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){zY(e,n);function e(t,o,i){var r=i===void 0?{}:i,s=r.name,a=s===void 0?"ogm"+(Math.random()*1e3|0):s,l=r.keyToName,u=l===void 0?function(p){return""+p}:l,c=n.call(this)||this;c._keyToName=u,c._groupBy=o,c._ogmInfoKey=Symbol("ogmInfo"+a),c._base=t;for(var f=0;f<t.length;f++)c._addItem(t[f]);return c._disposeBaseObserver=D_(c._base,function(p){if(p.type==="splice")Go(function(){for(var h=0,v=p.removed;h<v.length;h++){var _=v[h];c._removeItem(_)}for(var m=0,g=p.added;m<g.length;m++){var b=g[m];c._addItem(b)}});else if(p.type==="update")Go(function(){c._removeItem(p.oldValue),c._addItem(p.newValue)});else throw new Error("illegal state")}),c}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,o){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var o=this._base[t],i=o[this._ogmInfoKey];i.reaction(),delete o[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var o=n.prototype.get.call(this,t);return o===void 0&&(o=Pe([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),n.prototype.set.call(this,t,o)),o},e.prototype._removeFromGroupArr=function(t,o){var i=n.prototype.get.call(this,t);i.length===1?n.prototype.delete.call(this,t):(o===i.length-1||(i[o]=i[i.length-1],i[o][this._ogmInfoKey].groupArrIndex=o),i.length--)},e.prototype._addItem=function(t){var o=this,i=this._groupBy(t),r=this._getGroupArr(i),s={groupByValue:i,groupArrIndex:r.length,reaction:b_(function(){return o._groupBy(t)},function(a,l){var u=t[o._ogmInfoKey];o._removeFromGroupArr(u.groupByValue,u.groupArrIndex);var c=o._getGroupArr(a),f=c.length;c.push(t),u.groupByValue=a,u.groupArrIndex=f})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:s}),r.push(t)},e.prototype._removeItem=function(t){var o=t[this._ogmInfoKey];this._removeFromGroupArr(o.groupByValue,o.groupArrIndex),o.reaction(),delete t[this._ogmInfoKey]},e})(Af);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var Ic=function(){return Ic=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ic.apply(this,arguments)},qY=(function(){function n(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return n.prototype.add=function(e){zf(Ty(this.undos),e)||(this.undos.push(e),zf(this.curData,e)||(this.redos=[]),this.eventCenter.emit(pt.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},n.prototype.undoAble=function(){return this.undos.length>1},n.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Dt(t),t}},n.prototype.redoAble=function(){return this.redos.length>0},n.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Dt(e),e}},n.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=UY(e,hg(function(){var o=e.modelToHistoryData();o&&t.add(Ic({},o))},this.waitTime))},n.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},n})(),Ad={exports:{}},sv;function GY(){return sv||(sv=1,(function(n){(function(e,t,o){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},a={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},l,u=1;u<20;++u)i[111+u]="f"+u;for(u=0;u<=9;++u)i[u+96]=u.toString();function c(k,S,N){if(k.addEventListener){k.addEventListener(S,N,!1);return}k.attachEvent("on"+S,N)}function f(k){if(k.type=="keypress"){var S=String.fromCharCode(k.which);return k.shiftKey||(S=S.toLowerCase()),S}return i[k.which]?i[k.which]:r[k.which]?r[k.which]:String.fromCharCode(k.which).toLowerCase()}function p(k,S){return k.sort().join(",")===S.sort().join(",")}function h(k){var S=[];return k.shiftKey&&S.push("shift"),k.altKey&&S.push("alt"),k.ctrlKey&&S.push("ctrl"),k.metaKey&&S.push("meta"),S}function v(k){if(k.preventDefault){k.preventDefault();return}k.returnValue=!1}function _(k){if(k.stopPropagation){k.stopPropagation();return}k.cancelBubble=!0}function m(k){return k=="shift"||k=="ctrl"||k=="alt"||k=="meta"}function g(){if(!l){l={};for(var k in i)k>95&&k<112||i.hasOwnProperty(k)&&(l[i[k]]=k)}return l}function b(k,S,N){return N||(N=g()[k]?"keydown":"keypress"),N=="keypress"&&S.length&&(N="keydown"),N}function C(k){return k==="+"?["+"]:(k=k.replace(/\+{2}/g,"+plus"),k.split("+"))}function D(k,S){var N,L,$,B=[];for(N=C(k),$=0;$<N.length;++$)L=N[$],a[L]&&(L=a[L]),S&&S!="keypress"&&s[L]&&(L=s[L],B.push("shift")),m(L)&&B.push(L);return S=b(L,B,S),{key:L,modifiers:B,action:S}}function T(k,S){return k===null||k===t?!1:k===S?!0:T(k.parentNode,S)}function O(k){var S=this;if(k=k||t,!(S instanceof O))return new O(k);S.target=k,S._callbacks={},S._directMap={};var N={},L,$=!1,B=!1,E=!1;function A(V){V=V||{};var Y=!1,Q;for(Q in N){if(V[Q]){Y=!0;continue}N[Q]=0}Y||(E=!1)}function M(V,Y,Q,ue,te,q){var re,ce,ve=[],Ne=Q.type;if(!S._callbacks[V])return[];for(Ne=="keyup"&&m(V)&&(Y=[V]),re=0;re<S._callbacks[V].length;++re)if(ce=S._callbacks[V][re],!(!ue&&ce.seq&&N[ce.seq]!=ce.level)&&Ne==ce.action&&(Ne=="keypress"&&!Q.metaKey&&!Q.ctrlKey||p(Y,ce.modifiers))){var ge=!ue&&ce.combo==te,_e=ue&&ce.seq==ue&&ce.level==q;(ge||_e)&&S._callbacks[V].splice(re,1),ve.push(ce)}return ve}function F(V,Y,Q,ue){S.stopCallback(Y,Y.target||Y.srcElement,Q,ue)||V(Y,Q)===!1&&(v(Y),_(Y))}S._handleKey=function(V,Y,Q){var ue=M(V,Y,Q),te,q={},re=0,ce=!1;for(te=0;te<ue.length;++te)ue[te].seq&&(re=Math.max(re,ue[te].level));for(te=0;te<ue.length;++te){if(ue[te].seq){if(ue[te].level!=re)continue;ce=!0,q[ue[te].seq]=1,F(ue[te].callback,Q,ue[te].combo,ue[te].seq);continue}ce||F(ue[te].callback,Q,ue[te].combo)}var ve=Q.type=="keypress"&&B;Q.type==E&&!m(V)&&!ve&&A(q),B=ce&&Q.type=="keydown"};function H(V){typeof V.which!="number"&&(V.which=V.keyCode);var Y=f(V);if(Y){if(V.type=="keyup"&&$===Y){$=!1;return}S.handleKey(Y,h(V),V)}}function R(){clearTimeout(L),L=setTimeout(A,1e3)}function G(V,Y,Q,ue){N[V]=0;function te(Ne){return function(){E=Ne,++N[V],R()}}function q(Ne){F(Q,Ne,V),ue!=="keyup"&&($=f(Ne)),setTimeout(A,10)}for(var re=0;re<Y.length;++re){var ce=re+1===Y.length,ve=ce?q:te(ue||D(Y[re+1]).action);oe(Y[re],ve,ue,V,re)}}function oe(V,Y,Q,ue,te){S._directMap[V+":"+Q]=Y,V=V.replace(/\s+/g," ");var q=V.split(" "),re;if(q.length>1){G(V,q,Y,Q);return}re=D(V,Q),S._callbacks[re.key]=S._callbacks[re.key]||[],M(re.key,re.modifiers,{type:re.action},ue,V,te),S._callbacks[re.key][ue?"unshift":"push"]({callback:Y,modifiers:re.modifiers,action:re.action,seq:ue,level:te,combo:V})}S._bindMultiple=function(V,Y,Q){for(var ue=0;ue<V.length;++ue)oe(V[ue],Y,Q)},c(k,"keypress",H),c(k,"keydown",H),c(k,"keyup",H)}O.prototype.bind=function(k,S,N){var L=this;return k=k instanceof Array?k:[k],L._bindMultiple.call(L,k,S,N),L},O.prototype.unbind=function(k,S){var N=this;return N.bind.call(N,k,function(){},S)},O.prototype.trigger=function(k,S){var N=this;return N._directMap[k+":"+S]&&N._directMap[k+":"+S]({},k),N},O.prototype.reset=function(){var k=this;return k._callbacks={},k._directMap={},k},O.prototype.stopCallback=function(k,S){var N=this;if((" "+S.className+" ").indexOf(" mousetrap ")>-1||T(S,N.target))return!1;if("composedPath"in k&&typeof k.composedPath=="function"){var L=k.composedPath()[0];L!==k.target&&(S=L)}return S.tagName=="INPUT"||S.tagName=="SELECT"||S.tagName=="TEXTAREA"||S.isContentEditable},O.prototype.handleKey=function(){var k=this;return k._handleKey.apply(k,arguments)},O.addKeycodes=function(k){for(var S in k)k.hasOwnProperty(S)&&(i[S]=k[S]);l=null},O.init=function(){var k=O(t);for(var S in k)S.charAt(0)!=="_"&&(O[S]=(function(N){return function(){return k[N].apply(k,arguments)}})(S))},O.init(),e.Mousetrap=O,n.exports&&(n.exports=O)})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(Ad)),Ad.exports}var XY=GY();const WY=Ms(XY);var Yi=function(){return Yi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Yi.apply(this,arguments)},YY=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},ai=null;function av(n,e){var t,o;return n.x+=e,n.y+=e,Vd(n.text)||(n.text.x+=e,n.text.y+=e),Vd((t=n.properties)===null||t===void 0?void 0:t._label)||(o=n.properties)===null||o===void 0||o._label.forEach(function(i){i.x+=e,i.y+=e}),n}function lv(n,e){return n.startPoint&&(n.startPoint.x+=e,n.startPoint.y+=e),n.endPoint&&(n.endPoint.x+=e,n.endPoint.y+=e),n.pointsList&&n.pointsList.length>0&&n.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Vd(n.text)||(n.text.x+=e,n.text.y+=e),n}function KY(n,e){var t=n.x,o=n.y,i=n.text,r=i?{x:i.x+e,y:i.y+e,value:i.value}:void 0;return Yi(Yi({},n),{id:"",x:t+e,y:o+e,text:r})}function JY(n,e){var t=n.startPoint,o=n.endPoint,i=n.pointsList,r=n.text,s=YY(n,["startPoint","endPoint","pointsList","text"]);s.id="";var a={x:t.x+e,y:t.y+e},l={x:o.x+e,y:o.y+e},u=Zo(i,function(f){return{x:f.x+e,y:f.y+e}}),c=r?Yi(Yi({},r),{x:r.x+e,y:r.y+e}):void 0;return Yi(Yi({},s),{startPoint:a,endPoint:l,pointsList:u,text:c})}var qr=40,Cl=40;function ZY(n,e){var t=n.keyboard,o=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Cl=qr,!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=n.options.guards,r=e.getSelectElements(!1),s=i&&i.beforeClone?i.beforeClone(r):!0;return!s||r.nodes.length===0&&r.edges.length===0?(ai=null,!0):(ai=r,ai.nodes.forEach(function(a){return av(a,qr)}),ai.edges.forEach(function(a){return lv(a,qr)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;if(ai&&(ai.nodes||ai.edges)){n.clearSelectElements();var i=n.addElements(ai,Cl);if(!i)return!0;i.nodes.forEach(function(r){return n.selectElementById(r.id,!0)}),i.edges.forEach(function(r){return n.selectElementById(r.id,!0)}),ai.nodes.forEach(function(r){return av(r,qr)}),ai.edges.forEach(function(r){return lv(r,qr)}),Cl=Cl+qr}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.redo(),!1)}),t.on(["backspace"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return n.clearSelectElements(),i.edges.forEach(function(r){return r.id&&n.deleteEdge(r.id)}),i.nodes.forEach(function(r){return r.id&&n.deleteNode(r.id)}),!1})}var QY=(function(){function n(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new WY(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return n.prototype.initShortcuts=function(){var e=this,t,o=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(o)if(vg(o))o.forEach(function(a){var l=a.keys,u=a.callback,c=a.action;return e.on(l,u,c)});else{var i=o.keys,r=o.callback,s=o.action;this.on(i,r,s)}},n.prototype.on=function(e,t,o){this.mousetrap.bind(this.getKeys(e),t,o)},Object.defineProperty(n.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),n.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},n.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},n.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},n.prototype.destroy=function(){this.mousetrap.reset()},n.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(o){return t.formatKey(o)})},n.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},n})(),zi=function(){return zi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zi.apply(this,arguments)},Sl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Od=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Nd=Symbol("plugin registered by Logicflow.use"),Fc=(function(){function n(e){var t=this,o;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(u,c){return t.viewMap.set(u,c)},this.getView=function(u){return t.viewMap.get(u)};var i=Ca.get(e),r=i.container,s=i.width,a=i.height;this.options=i,this.container=this.initContainer(r,s,a),this.graphModel=new jW(zi(zi({},i),{container:this.container})),this.plugins=(o=i.plugins)!==null&&o!==void 0?o:[];var l=this.graphModel.eventCenter;this.tool=new LY(this),this.dnd=new EY({lf:this}),this.history=new qY(l),this.keyboard=new QY({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new VW(this.graphModel,i.snaplineEpsilon),DY(l,this.snaplineModel)),i.isSilentMode||(ZY(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return n.prototype.initContainer=function(e,t,o){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=o?"".concat(o,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return n.toStringTag},enumerable:!1,configurable:!0}),n.prototype.register=function(e,t,o){if(o===void 0&&(o=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:Ju,BaseEdgeModel:Ku,BaseNode:sr,BaseNodeModel:rr,RectNode:Mr,RectNodeModel:Cs,CircleNode:uu,CircleNodeModel:su,PolygonNode:cu,PolygonNodeModel:au,TextNode:nv,TextNodeModel:Qh,LineEdge:iv,LineEdgeModel:Yh,DiamondNode:Nc,DiamondNodeModel:wc,PolylineEdge:Ss,PolylineEdgeModel:ws,BezierEdge:Bc,BezierEdgeModel:xc,EllipseNode:Tc,EllipseNodeModel:Cc,HtmlNode:Ba,HtmlNodeModel:Pa,h:Ze,type:e};if(this.viewMap.forEach(function(u){var c=u.extendKey;c&&(i[c]=u)}),this.graphModel.modelMap.forEach(function(u){var c=u.extendKey;c&&(i[c]=u)}),t){var r=t(i),s=r.view,a=r.model,l=s;o&&!l.isObserved&&(l.isObserved=!0,l=eo(l)),this.setView(e,l),this.graphModel.setModel(e,a)}},n.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=eo(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},n.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),Lt(e,function(o){t.registerElement(o)})},n.prototype.defaultRegister=function(){var e=[{type:"rect",view:Mr,model:Cs},{type:"circle",view:uu,model:su},{type:"polygon",view:cu,model:au},{type:"text",view:nv,model:Qh},{type:"ellipse",view:Tc,model:Cc},{type:"diamond",view:Nc,model:wc},{type:"html",view:Ba,model:Pa},{type:"line",view:iv,model:Yh},{type:"polyline",view:Ss,model:ws},{type:"bezier",view:Bc,model:xc}];this.batchRegister(e)},n.prototype.addNode=function(e,t,o){return t===void 0&&(t=pt.NODE_ADD),this.graphModel.addNode(e,t,o)},n.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteNode(e),r},n.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){var i=this.options.guards,r=i!=null&&i.beforeClone?i.beforeClone(o):!0;if(r)return this.graphModel.cloneNode(e)}},n.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},n.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},n.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},n.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},n.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},n.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},n.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},n.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},n.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var o=new t(zi(zi({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(o),o},n.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},n.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},n.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},n.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},n.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},n.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},n.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},n.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,o=e.targetNodeId,i=[],r=this.graphModel.edges;return t&&o?Lt(r,function(s){s.sourceNodeId===t&&s.targetNodeId===o&&i.push(s)}):t?Lt(r,function(s){s.sourceNodeId===t&&i.push(s)}):o&&Lt(r,function(s){s.targetNodeId===o&&i.push(s)}),i},n.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},n.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},n.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteEdgeById(e),r},n.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,o=e.targetNodeId;t&&o?this.graphModel.deleteEdgeBySourceAndTarget(t,o):t?this.graphModel.deleteEdgeBySource(t):o&&this.graphModel.deleteEdgeByTarget(o)},n.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},n.prototype.addElements=function(e,t){var o=this,i=e.nodes,r=e.edges;t===void 0&&(t=40);var s={},a={nodes:[],edges:[]};return Lt(i,function(l){var u=l.id,c=o.addNode(l);u&&(s[u]=c.id),a.nodes.push(c)}),Lt(r,function(l){var u=l.sourceNodeId,c=l.targetNodeId;s[u]&&(u=s[u]),s[c]&&(c=s[c]);var f=o.graphModel.addEdge(zi(zi({},l),{sourceNodeId:u,targetNodeId:c}));a.edges.push(f)}),a},n.prototype.selectElementById=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=!0),this.graphModel.selectElementById(e,t),!t&&o&&this.graphModel.toFront(e)},n.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},n.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},n.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},n.prototype.getModelById=function(e){return this.graphModel.getElement(e)},n.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},n.prototype.deleteElement=function(e){var t,o,i,r=this.getModelById(e);if(!r)return!1;var s=(t={},t[Sn.NODE]=this.deleteNode,t[Sn.EDGE]=this.deleteEdge,t);return(i=(o=s[r.BaseType])===null||o===void 0?void 0:o.call(this,e))!==null&&i!==void 0?i:!1},n.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},n.prototype.getAreaElement=function(e,t,o,i,r){return o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1),this.graphModel.getAreaElement(e,t,o,i,r).map(function(s){return s.getData()})},n.prototype.setProperties=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.setProperties(Jn(t))},n.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},n.prototype.deleteProperty=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.deleteProperty(t)},n.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},n.prototype.editText=function(e){this.graphModel.editText(e)},n.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},n.prototype.updateEditConfig=function(e){var t=this.graphModel,o=t.editConfigModel,i=t.transformModel,r=o.snapGrid;if(o.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!Qn(e==null?void 0:e.snapGrid)&&e.snapGrid!==r){var s=this.graphModel.grid.size,a=s===void 0?1:s;this.graphModel.updateGridSize(e.snapGrid?a:1)}this.emit(pt.EDIT_CONFIG_CHANGED,{data:o.getConfig()})},n.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},n.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},n.prototype.getTheme=function(){return this.graphModel.getTheme()},n.prototype.focusByElement=function(e){var t=void 0,o=this.getNodeModelById(e);if(o){var i=o.getData(),r=i.x,s=i.y;t={x:r,y:s}}var a=this.getEdgeModelById(e);if(a){var l=a.textPosition,r=l.x,s=l.y;t={x:r,y:s}}t&&this.focusByCoordinate(t)},n.prototype.focusByCoordinate=function(e){var t=this.graphModel,o=t.transformModel,i=t.width,r=t.height,s=e.x,a=e.y;o.focusOn(s,a,i,r)},n.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,o=e.coordinate;t&&this.focusByElement(t),o&&this.focusByCoordinate(o)}},n.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},n.prototype.toFront=function(e){this.graphModel.toFront(e)},n.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},n.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Od([o],Sl(e),!1)):o},n.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},n.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},n.prototype.setOverlapMode=function(e){this.graphModel.setOverlapMode(e)},n.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(Jn(e)),this.options.history!==!1&&this.history.watch(this.graphModel),xh(Re(GW,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(pt.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},n.prototype.render=function(e){var t=Dt(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},n.prototype.undo=function(){if(this.history.undoAble()){var e=Jn(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.redo=function(){if(this.history.redoAble()){var e=Jn(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.zoom=function(e,t){var o=this.graphModel.transformModel;return o.zoom(e,t)},n.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},n.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},n.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},n.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,o=e.SCALE_Y,i=e.TRANSLATE_X,r=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:o,TRANSLATE_X:i,TRANSLATE_Y:r}},n.prototype.translate=function(e,t){var o=this.graphModel.transformModel;o.translate(e,t)},n.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,o=e.TRANSLATE_Y;this.translate(-t,-o)},n.prototype.translateCenter=function(){this.graphModel.translateCenter()},n.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},n.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},n.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},n.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},n.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},n.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},n.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},n.use=function(e,t){var o,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(o={},o[Nd]=Nd,o.extension=e,o.props=t,o))},n.addThemeMode=function(e,t){jX(e,t)},n.removeThemeMode=function(e){VX(e)},n.clearThemeMode=function(){Xh()},n.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var o=Array.from(n.extensions,function(r){var s=Sl(r,2),a=s[1];return a}),i=Od(Od([],Sl(this.plugins),!1),Sl(o),!1);Lt(i,function(r){var s,a;Nd in r?(s=r.extension,a=r.props):s=r;var l=s==null?void 0:s.pluginName;$y(e,l)===-1&&t.installPlugin(s,a)})},n.prototype.installPlugin=function(e,t){var o,i;if("pluginName"in e&&"install"in e){var r=e.pluginName,s=e.install,a=e.render;r&&(s&&s.call(e,this,n),a&&this.components.push(a.bind(e)),this.extension[r]=e);return}var l=e,u=l.pluginName,c=new l({lf:this,LogicFlow:n,props:t,options:(i=(o=this.options.pluginsOptions)===null||o===void 0?void 0:o[u])!==null&&i!==void 0?i:{}});c.render&&this.components.push(c.render.bind(c)),this.extension[u]=c},n.prototype.destroy=function(){var e;this.clearData(),xh(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Xh();for(var t in this.extension){var o=this.extension[t];"destroy"in o&&((e=o.destroy)===null||e===void 0||e.call(o))}},n.extensions=new Map,n})();(function(n){n.toStringTag="LF.".concat(n.name)})(Fc||(Fc={}));const eK=Fc;function eo(n){return Nf(n)}var uv={width:40,height:40},dv={width:40,height:40},cv={width:40,height:40},fv={width:100,height:80},pv={width:100,height:80},tK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),nK=(globalThis==null?void 0:globalThis._ids)||new tK;function Fs(){return nK.next()}var rm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){rm(e,n);function e(t,o){return t.id||(t.id="Event_".concat(Fs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=n.prototype.getConnectedTargetRules.call(this),o={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(o),t},e.extendKey="StartEventModel",e})(su);(function(n){rm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(uu);var sm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),vu=function(){return vu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vu.apply(this,arguments)};(function(n){sm(e,n);function e(t,o){return t.id||(t.id="Event_".concat(Fs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=n.prototype.getConnectedSourceRules.call(this),o={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(o),t},e.extendKey="EndEventModel",e})(su);(function(n){sm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle(),i=t,r=i.x,s=i.y,a=i.r,l=n.prototype.getShape.call(this);return Ze("g",{},l,Ze("circle",vu(vu({},o),{cx:r,cy:s,r:a-5})))},e.extendKey="EndEventView",e})(uu);var am=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){am(e,n);function e(t,o){return t.id||(t.id="Flow_".concat(Fs())),n.call(this,t,o)||this}return e.extendKey="SequenceFlowModel",e})(ws);(function(n){am(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(Ss);var lm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pa=function(){return pa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pa.apply(this,arguments)};(function(n){lm(e,n);function e(t,o){var i=this;return t.id||(t.id="Gateway_".concat(Fs())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=n.call(this,t,o)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(au);(function(n){lm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,u=t.getNodeStyle();return Ze("g",{transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")},Ze("polygon",pa(pa({},u),{x:i,y:r,points:l})),Ze("path",pa({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},u)))},e.extendKey="ExclusiveGatewayNode",e})(cu);var um=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),jc=function(){return jc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},jc.apply(this,arguments)};(function(n){um(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(Fs())),n.call(this,t,o)||this}return e.extendKey="ServiceTaskModel",e})(Cs);(function(n){um(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return Ze("svg",{x:o-r/2+5,y:i-s/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},Ze("path",{fill:a.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return Ze("g",{},[Ze("rect",jc({x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s},l)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(Mr);var dm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),gu=function(){return gu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gu.apply(this,arguments)};(function(n){dm(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(Fs())),n.call(this,t,o)||this}return e.extendKey="UserTaskModel",e})(Cs);(function(n){dm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return Ze("svg",{x:o-r/2+5,y:i-s/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},Ze("path",{fill:a.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return Ze("g",{},[Ze("rect",gu(gu({},l),{x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(Mr);var oK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),iK=(globalThis==null?void 0:globalThis._ids)||new oK;function hv(){return iK.next()}function cm(n){return Object.prototype.toString.call(n)}function rK(n){return"  ".repeat(n)}function _u(n){var e=n;return cm(n)==="[object Object]"?(e={},Object.keys(n).forEach(function(t){var o=t;t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=_u(n[t])})):Array.isArray(n)&&(e=[],n.forEach(function(t,o){e[o]=_u(t)})),e}function mu(n){return n==null?"":n.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function sK(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(_u(n)).replace(/"/g,"'")}return mu(String(e))}var cr=`	
`;function Tl(n,e,t){var o=rK(t);if(n!==0&&n!==!1&&!n)return cr+o+"<".concat(e," />");var i="";if(e==="#text")return cr+o+mu(String(n));if(e==="#cdata-section")return cr+o+"<![CDATA["+n+"]]>";if(e==="#comment")return cr+o+"<!--"+n+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+sK(n)+'"';if(Array.isArray(n))n.forEach(function(l){i+=Tl(l,e,t+1)});else if(cm(n)==="[object Object]"){var r=Object.keys(n),s="",a="";i+=(t===0?"":cr+o)+"<"+e,r.forEach(function(l){l.charAt(0)==="-"?s+=Tl(n[l],l,t+1):a+=Tl(n[l],l,t+1)}),i+=s+(a!==""?">".concat(a).concat(cr+o,"</").concat(e,">"):" />")}else i+=cr+o+"<".concat(e,">").concat(mu(String(n)),"</").concat(e,">");return i}function aK(n){var e="";for(var t in n)e+=Tl(n[t],t,0);return e}var oo=function(){};oo.ObjTree=function(){return this};oo.ObjTree.VERSION="0.23";oo.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;oo.ObjTree.prototype.attr_prefix="-";oo.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e)return this.parseDOM(e)};oo.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var f;c&&c.responseXML&&c.responseXML.documentElement&&(f=r.parseDOM(c.responseXML.documentElement)),s(f,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var u=new HTTP.Request(o);u&&(l=u.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var u=new Ajax.Request(n,o);u&&(l=u.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};oo.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!=11){var o={};o[n.nodeName]=t,t=o}return t}};oo.ObjTree.prototype.parseElement=function(n){if(n.nodeType!=7){if(n.nodeType==3||n.nodeType==4||n.nodeType==8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l==3||l==4||l==8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};oo.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t==1&&(n[e]=[]),n[e][n[e].length]=o):t==1?n[e]=o:t==2?n[e]=[n[e],o]:n[e][n[e].length]=o};oo.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};oo.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];i.charAt(0)!=this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<"+i+" />":typeof r=="object"&&r.constructor==Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" "+i.substring(1)+'="'+this.xml_escape(r)+'"'}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<"+n+s+`>
`+a+"</"+n+`>
`:a="<"+n+s+">"+a+"</"+n+`>
`:a="<"+n+s+` />
`),a};oo.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<"+n+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};oo.ObjTree.prototype.scalar_to_xml=function(n,e){return n=="#text"?this.xml_escape(e):"<"+n+">"+this.xml_escape(e)+"</"+n+`>
`};oo.ObjTree.prototype.xml_escape=mu;var lK=function(n){return new oo.ObjTree().parseXML(n)},uK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Vc=function(){return Vc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Vc.apply(this,arguments)},Zu=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},_i;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow"})(_i||(_i={}));var fm=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],vv=["properties","startPoint","endPoint","pointsList"],pm=function(n){return String(n||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function gv(n){var e=n?vv.concat(n):vv;return function(t){function o(i){var r={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(s){return o(s)}):(Object.entries(i).forEach(function(s){var a=Zu(s,2),l=a[0],u=a[1];typeof u!="object"?l.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(l)?r[l]=u:r["-".concat(l)]=u:e.includes(l)?r["-".concat(l)]=o(u):r[l]=o(u)}),r)}return o(t)}}function yu(n){var e={};return Object.entries(n).forEach(function(t){var o=Zu(t,2),i=o[0],r=o[1];i.indexOf("-")===0?e[i.substring(1)]=_u(r):typeof r=="string"?e[i]=r:Object.prototype.toString.call(r)==="[object Object]"?e[i]=yu(r):Array.isArray(r)?e[i]=r.map(function(s){return yu(s)}):e[i]=r}),e}function dK(n,e,t){var o=new Map;e.nodes.forEach(function(r){var s,a={"-id":r.id};if(!((s=r.text)===null||s===void 0)&&s.value&&(a["-name"]=r.text.value),r.properties){var l=gv(t)(r.properties);Object.assign(a,l)}o.set(r.id,a),n[r.type]?Array.isArray(n[r.type])?n[r.type].push(a):n[r.type]=[n[r.type],a]:n[r.type]=a});var i=e.edges.map(function(r){var s,a,l=o.get(r.targetNodeId);l["bpmn:incoming"]?Array.isArray(l["bpmn:incoming"])?l["bpmn:incoming"].push(r.id):l["bpmn:incoming"]=[l["bpmn:incoming"],r.id]:l["bpmn:incoming"]=r.id;var u={"-id":r.id,"-sourceRef":r.sourceNodeId,"-targetRef":r.targetNodeId};if(!((s=r.text)===null||s===void 0)&&s.value&&(u["-name"]=(a=r.text)===null||a===void 0?void 0:a.value),r.properties){var c=gv(t)(r.properties);Object.assign(u,c)}return u});e.edges.forEach(function(r){var s=o.get(r.sourceNodeId);s["bpmn:outgoing"]?Array.isArray(s["bpmn:outgoing"])?s["bpmn:outgoing"].push(r.id):s["bpmn:outgoing"]=[s["bpmn:outgoing"],r.id]:s["bpmn:outgoing"]=r.id}),n[_i.FLOW]=i}function cK(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,u=a.y;return{"-x":l,"-y":u}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,u=ar.shapeConfigMap.get(t.type);u&&(r=u.width,s=u.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}function fK(n){var e=[],t=[],o=n["bpmn:definitions"];if(o){var i=o["bpmn:process"],r=o["bpmndi:BPMNDiagram"],s=r==null?void 0:r["bpmndi:BPMNPlane"];if(!i||!s)return{nodes:e,edges:t};Object.keys(i).forEach(function(a){if(a.indexOf("bpmn:")===0){var l=i[a];if(a===_i.FLOW){var u=s["bpmndi:BPMNEdge"],c=(Array.isArray(u),u);t=hK(l,c)}else{var f=s["bpmndi:BPMNShape"],p=(Array.isArray(f),f);e=e.concat(pK(l,p,a))}}})}return{nodes:e,edges:t}}function pK(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(u){return u["-bpmnElement"]===s["-id"]}):a=e;var l=_v(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=_v(i,t,n);o.push(r)}return o}function _v(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=pm(t["-name"]),s=ar.shapeConfigMap.get(e);s&&(o+=s.width/2,i+=s.height/2);var a;Object.entries(t).forEach(function(f){var p=Zu(f,2),h=p[0],v=p[1];fm.indexOf(h)===-1&&(a||(a={}),a[h]=v)}),a&&(a=yu(a));var l;if(r&&(l={x:o,y:i,value:r},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var u=n["bpmndi:BPMNLabel"]["dc:Bounds"];l.x=Number(u["-x"])+Number(u["-width"])/2,l.y=Number(u["-y"])+Number(u["-height"])/2}var c={id:n["-bpmnElement"],type:e,x:o,y:i,properties:a};return l&&(c.text=l),c}function hK(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(mv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(mv(o,n))}return t}function mv(n,e){var t,o=e["-name"]?pm("".concat(e["-name"])):"";if(o){var i=void 0;n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=n["bpmndi:BPMNLabel"]["dc:Bounds"]);var r=0;if(o.split(`
`).forEach(function(h){r<h.length&&(r=h.length)}),i)t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7};else{var s=n["di:waypoint"]||[],a=s[0],l=s[s.length-1]||a,u=(Number((a==null?void 0:a["-x"])||0)+Number((l==null?void 0:l["-x"])||0))/2,c=(Number((a==null?void 0:a["-y"])||0)+Number((l==null?void 0:l["-y"])||0))/2;t={value:o,x:u,y:c}}}var f;Object.entries(e).forEach(function(h){var v=Zu(h,2),_=v[0],m=v[1];fm.indexOf(_)===-1&&(f||(f={}),f[_]=m)}),f&&(f=yu(f));var p={id:e["-id"],type:_i.FLOW,pointsList:n["di:waypoint"].map(function(h){return{x:Number(h["-x"]),y:Number(h["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:f};return t&&(p.text=t),p}var ar=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s=Vc({},o.processAttributes);dK(s,i,r);var a={"-id":"BPMNPlane_1","-bpmnElement":s["-id"]};cK(a,i);var l=o.definitionAttributes;l["bpmn:process"]=s,l["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":a};var u={"bpmn:definitions":l};return u},this.adapterIn=function(i){if(i)return fK(i)},t.adapterIn=function(i){return o.adapterIn(i)},t.adapterOut=function(i,r){return o.adapterOut(i,r)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(hv())},this.definitionAttributes={"-id":"Definitions_".concat(hv()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();ar.shapeConfigMap.set(_i.START,{width:uv.width,height:uv.height});ar.shapeConfigMap.set(_i.END,{width:dv.width,height:dv.height});ar.shapeConfigMap.set(_i.GATEWAY,{width:cv.width,height:cv.height});ar.shapeConfigMap.set(_i.SYSTEM,{width:fv.width,height:fv.height});ar.shapeConfigMap.set(_i.USER,{width:pv.width,height:pv.height});(function(n){uK(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(r){var s=typeof r=="string"?o.sanitizeNameAttributes(r):r,a=lK(s);return o.adapterIn(a)},o.adapterXmlOut=function(r,s){var a=o.adapterOut(r,s);return aK(a)};var i=t.lf;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(o,i){var r=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(r,'"')})},e.pluginName="bpmnXmlAdapter",e})(ar);var vK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var o=Math.random()*16|0,i=t==="x"?o:o&3|8;return i.toString(16)});return e},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),gK=(globalThis==null?void 0:globalThis._ids)||new vK;function _K(){return gK.next()}Ze("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),Ze("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});Ze("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});Ze("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var mK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),yr=function(){return yr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},yr.apply(this,arguments)},yK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},bK=Lo,xK=(function(n){mK(e,n);function e(t){var o=n.call(this)||this;return o.updatePosition=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,u=a.y;o.nodeModel.x=l+r/2,o.nodeModel.y=u+s/2,o.nodeModel.moveText(r/2,s/2)},o.getResize=function(i){var r=i.index,s=i.deltaX,a=i.deltaY,l=i.width,u=i.height,c=i.PCTResizeInfo,f=i.pct,p=f===void 0?1:f,h=i.freezeWidth,v=h===void 0?!1:h,_=i.freezeHeight,m=_===void 0?!1:_,g={width:l,height:u,deltaX:s,deltaY:a};if(c){var b=4,C=0,D=0;switch(r){case 0:D=(s*-1-a)/b;break;case 1:D=(s-a)/b;break;case 2:D=(s+a)/b;break;case 3:D=(s*-1+a)/b;break}D!==0&&(C=Math.round(D/c.ResizeBasis.basisHeight*1e5)/1e3),c.ResizePCT.widthPCT=Math.max(Math.min(c.ResizePCT.widthPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit),c.ResizePCT.heightPCT=Math.max(Math.min(c.ResizePCT.heightPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit);var T=Math.round(c.ResizePCT.widthPCT*c.ResizeBasis.basisWidth/100),O=Math.round(c.ResizePCT.heightPCT*c.ResizeBasis.basisHeight/100);switch(r){case 0:s=l-T,a=u-O;break;case 1:s=T-l,a=u-O;break;case 2:s=T-l,a=O-u;break;case 3:s=l-T,a=O-u;break}return g.width=T,g.height=O,g.deltaX=s/p,g.deltaY=a/p,g}switch(r){case 0:g.width=v?l:l-s*p,g.height=m?u:u-a*p;break;case 1:g.width=v?l:l+s*p,g.height=m?u:u-a*p;break;case 2:g.width=v?l:l+s*p,g.height=m?u:u+a*p;break;case 3:g.width=v?l:l-s*p,g.height=m?u:u+a*p;break}return g},o.updateEdgePointByAnchors=function(){var i=o.nodeModel,r=i.id,s=i.anchors,a=o.getNodeEdges(r);a.sourceEdges.forEach(function(l){var u=s.find(function(c){return c.id===l.sourceAnchorId});u&&l.updateStartPoint({x:u.x,y:u.y})}),a.targetEdges.forEach(function(l){var u=s.find(function(c){return c.id===l.targetAnchorId});u&&l.updateEndPoint({x:u.x,y:u.y})})},o.updateRect=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,u=a.y,c=a.width,f=a.height,p=a.radius,h=a.PCTResizeInfo,v=o.nodeModel,_=v.minWidth,m=v.minHeight,g=v.maxWidth,b=v.maxHeight,C=o.index,D=_===g,T=m===b,O=o.getResize({index:C,deltaX:r,deltaY:s,width:c,height:f,PCTResizeInfo:h,pct:1,freezeWidth:D,freezeHeight:T});if(O.width<_||O.width>g||O.height<m||O.height>b){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:D?0:O.deltaX,deltaY:T?0:O.deltaY}),o.nodeModel.width=O.width,o.nodeModel.height=O.height,o.nodeModel.setProperties({nodeSize:{width:O.width,height:O.height}});var k={x:l,y:u,width:c,height:f,radius:p},S={x:o.nodeModel.x,y:o.nodeModel.y,width:o.nodeModel.width,height:o.nodeModel.height,radius:p};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:k,afterNode:S})},o.updateEllipse=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,u=a.ry,c=a.x,f=a.y,p=a.PCTResizeInfo,h=o.index,v=o.nodeModel,_=v.minWidth,m=v.minHeight,g=v.maxWidth,b=v.maxHeight,C=_===g,D=m===b,T=l,O=u,k=o.getResize({index:h,deltaX:r,deltaY:s,width:T,height:O,PCTResizeInfo:p,pct:1/2,freezeWidth:C,freezeHeight:D});if(k.width<_/2||k.width>g/2||k.height<m/2||k.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:k.deltaX,deltaY:D?0:k.deltaY}),o.nodeModel.rx=k.width,o.nodeModel.ry=k.height,o.nodeModel.setProperties({nodeSize:{rx:k.width,ry:k.height}});var S={x:c,y:f},N={rx:k.width,ry:k.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:yr(yr({},S),{rx:l,ry:u}),afterNode:N})},o.updateDiamond=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,u=a.ry,c=a.x,f=a.y,p=a.PCTResizeInfo,h=o.index,v=o.nodeModel,_=v.minWidth,m=v.minHeight,g=v.maxWidth,b=v.maxHeight,C=_===g,D=m===b,T=l,O=u,k=o.getResize({index:h,deltaX:r,deltaY:s,width:T,height:O,PCTResizeInfo:p,pct:1/2,freezeWidth:C,freezeHeight:D});if(k.width<_/2||k.width>g/2||k.height<m/2||k.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:k.deltaX,deltaY:D?0:k.deltaY}),o.nodeModel.rx=k.width,o.nodeModel.ry=k.height,o.nodeModel.setProperties({nodeSize:{rx:k.width,ry:k.height}});var S={x:c,y:f,rx:l,ry:u},N={rx:k.width,ry:k.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:S,afterNode:N})},o.eventEmit=function(i){var r=i.deltaX,s=i.deltaY,a=i.beforeNode,l=i.afterNode,u=o.nodeModel,c=u.id,f=u.modelType,p=u.type,h=yr({id:c,modelType:f,type:p},a),v=yr({id:c,modelType:f,type:p},l);o.graphModel.eventCenter.emit("node:resize",{preData:h,data:v,deltaX:r,deltaY:s,index:o.index,model:o.nodeModel})},o.onDragging=function(i){var r,s=i.deltaX,a=i.deltaY,l=o.graphModel.transformModel,u=o.nodeModel.modelType;r=yK(l.fixDeltaXY(s,a),2),s=r[0],a=r[1],u===zt.RECT_NODE||u===zt.HTML_NODE?o.updateRect({deltaX:s,deltaY:a}):u===zt.ELLIPSE_NODE?o.updateEllipse({deltaX:s,deltaY:a}):u===zt.DIAMOND_NODE&&o.updateDiamond({deltaX:s,deltaY:a})},o.onDragEnd=function(){var i=o.graphModel.gridSize,r=i===void 0?1:i,s=r*Math.round(o.nodeModel.x/r),a=r*Math.round(o.nodeModel.y/r);o.nodeModel.moveTo(s,a),o.updateEdgePointByAnchors()},o.index=t.index,o.nodeModel=t.model,o.graphModel=t.graphModel,o.dragHandler=new bK({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:1}),o}return e.prototype.getNodeEdges=function(t){for(var o=this.graphModel,i=o.edges,r=[],s=[],a=0;a<i.length;a++){var l=i[a];l.sourceNodeId===t?r.push(l):i[a].targetNodeId===t&&s.push(l)}return{sourceEdges:r,targetEdges:s}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.index,s=t.model,a=s.getControlPointStyle();return Re("g",{className:"lf-resize-control-".concat(r),children:Re(Ao,yr({className:"lf-node-control",x:o,y:i},a,{onMouseDown:this.dragHandler.handleMouseDown}))})},e})(Yt),wK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),bu=function(){return bu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},bu.apply(this,arguments)},Qu=(function(n){wK(e,n);function e(){var t=n.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=o.x,s=o.y,a=o.width,l=o.height,u={minX:r-a/2,minY:s-l/2,maxX:r+a/2,maxY:s+l/2},c=u.minX,f=u.minY,p=u.maxX,h=u.maxY,v=[{x:c,y:f},{x:p,y:f},{x:p,y:h},{x:c,y:h}];return v.map(function(_,m){return Re(xK,bu({index:m},_,{model:o,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Re(Ao,bu({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Re("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e})(Yt),hm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){hm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Cc);(function(n){hm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(Qu,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o.isSelected&&!i?this.getControlGroup():""]})},e})(Tc);var vm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Hc=function(){return Hc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Hc.apply(this,arguments)};(function(n){vm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(wc);(function(n){vm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(Qu,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,o=t.points,i=t.getNodeStyle();return Re("g",{children:Re($f,Hc({},i,{points:o}))})},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Nc);var gm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){gm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Pa);(function(n){gm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(Qu,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Ba);var _m=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),CK=(function(n){_m(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Cs),SK=(function(n){_m(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(Qu,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Mr),mm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xu=function(){return xu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xu.apply(this,arguments)},fr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},pr=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},yv=500,bv=300,kK=-1e4;(function(n){mm(e,n);function e(){var t=n.apply(this,pr([],fr(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=yv,t.unfoldedHeight=bv,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var o=this;n.prototype.initNodeData.call(this,t);var i=[];vg(t.children)&&(i=t.children),this.children=new Set(i),this.width=yv,this.height=bv,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=kK,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){o.isFolded&&o.foldGroup(o.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var o=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=pr(pr([],fr(this.incoming.edges),!1),fr(this.outgoing.edges),!1);this.children.forEach(function(r){var s=o.graphModel.getElement(r);if(s){var a=s.isFolded;if(s.isGroup&&!s.isFolded&&s.foldGroup(t),s.isGroup&&!t){var l=o.childrenLastFoldStatus[r];l!==void 0&&l!==s.isFolded&&s.foldGroup(l)}o.childrenLastFoldStatus[r]=!!a,s.visible=!t;var u=s.incoming.edges,c=s.outgoing.edges;i=pr(pr(pr([],fr(i),!1),fr(u),!1),fr(c),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var o=n.prototype.getAnchorStyle.call(this,t);return o.stroke="transparent",o.fill="transparent",o.hover.fill="transparent",o.hover.stroke="transparent",o},e.prototype.foldEdge=function(t,o){var i=this;o.forEach(function(r,s){var a=r.id,l=r.sourceNodeId,u=r.targetNodeId,c=r.startPoint,f=r.endPoint,p=r.type,h=r.text,v=r.getProperties(),_={id:"".concat(a,"__").concat(s),sourceNodeId:l,targetNodeId:u,startPoint:c,endPoint:f,type:p,properties:v,text:h==null?void 0:h.value};r.virtual&&i.graphModel.deleteEdgeById(r.id);var m=i.graphModel.group.getNodeGroup(u);m||(m=i.graphModel.getNodeModelById(u));var g=i.graphModel.group.getNodeGroup(l);g||(g=i.graphModel.getNodeModelById(l)),t&&r.visible!==!1&&(i.children.has(l)||i.id===l?(_.startPoint=void 0,_.sourceNodeId=i.id):(_.endPoint=void 0,_.targetNodeId=i.id),(m.id!==i.id||g.id!==i.id)&&i.createVirtualEdge(_),r.visible=!1),!t&&r.visible===!1&&(m&&m.isGroup&&m.isFolded?(_.targetNodeId=m.id,_.endPoint=void 0,i.createVirtualEdge(_)):g&&g.isGroup&&g.isFolded?(_.sourceNodeId=g.id,_.startPoint=void 0,i.createVirtualEdge(_)):r.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isFoldedEdge=!0},e.prototype.isInRange=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return o>=this.x-this.width/2&&r<=this.x+this.width/2&&i>=this.y-this.height/2&&s<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return{x:o>=this.x-this.width/2&&r<=this.x+this.width/2,y:i>=this.y-this.height/2&&s<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this);o.children=[],this.children.forEach(function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&o.children.push(r)});var i=o.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,o},e.prototype.getHistoryData=function(){var t=n.prototype.getData.call(this);t.children=pr([],fr(this.children),!1),t.isGroup=!0;var o=t.properties;return o==null||delete o.groupAddable,o!=null&&o.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(CK);(function(n){mm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,o=t.resizable,i=t.properties;return o&&!i.isFolded?n.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.properties,u=t.getAddableOutlineStyle;if(!l.groupAddable)return null;var c=this.props.model.getNodeStyle().strokeWidth,f=c===void 0?0:c,p=u(),h=o+f+8,v=i+f+8;return Ze("rect",xu(xu({},p),{width:h,height:v,x:r-h/2,y:s-v/2,rx:a,ry:a}))},e.prototype.getFoldIcon=function(){var t=this.props.model,o=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var r=Ze("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," M").concat(o+7,",").concat(i+2," ").concat(o+7,",").concat(i+10):"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," ")});return Ze("g",{},[Ze("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),r])},e.prototype.getResizeShape=function(){return Ze("g",{},[this.getAddableShape(),n.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(SK);var xv=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ha=function(){return ha=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ha.apply(this,arguments)};function EK(n){var e=(function(o){xv(i,o);function i(r,s){r.id||(r.id="Flow_".concat(_K()));var a=ha(ha(ha({},{}),r.properties),{isDefaultFlow:!1});return r.properties=a,o.call(this,r,s)||this}return i.extendKey="SequenceFlowModel",i})(ws),t=(function(o){xv(i,o);function i(){return o!==null&&o.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var r=this.props.model,s=r.properties.isDefaultFlow;return s?Ze("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):Ze("path",{d:""})},i.extendKey="SequenceFlowEdge",i})(Ss);return{type:"bpmn:sequenceFlow",view:t,model:e}}EK();var wv={width:40,height:40},Cv={width:40,height:40},Sv={width:100,height:80},wu={width:100,height:80},kv={width:100,height:80},Ev={width:100,height:80},Dv={width:100,height:80},Av={width:100,height:80},Ov={width:100,height:80},Nv={width:100,height:80},io=function(){};io.ObjTree=function(){return this};io.ObjTree.VERSION="0.23";io.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;io.ObjTree.prototype.attr_prefix="-";io.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};io.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var f;c&&c.responseXML&&c.responseXML.documentElement&&(f=r.parseDOM(c.responseXML.documentElement)),s(f,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var u=new HTTP.Request(o);u&&(l=u.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var u=new Ajax.Request(n,o);u&&(l=u.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};io.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!==11){var o={};o[n.nodeName]=t,t=o}return t}};io.ObjTree.prototype.parseElement=function(n){if(n.nodeType!==7){if(n.nodeType===3||n.nodeType===4||n.nodeType===8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s!=null&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l===3||l===4||l===8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};io.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t===1&&(n[e]=[]),n[e][n[e].length]=o):t===1?n[e]=o:t===2?n[e]=[n[e],o]:n[e][n[e].length]=o};io.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};io.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(_a(e,i)){var r=e[i];i.charAt(0)!==this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<".concat(i," />"):typeof r=="object"&&r.constructor===Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(r),'"')}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<".concat(n).concat(s,`>
`).concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,">").concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,` />
`)),a};io.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<".concat(n," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};io.ObjTree.prototype.scalar_to_xml=function(n,e){return n==="#text"?this.xml_escape(e):"<".concat(n,">").concat(this.xml_escape(e),"</").concat(n,`>
`)};io.ObjTree.prototype.xml_escape=function(n){return n.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var DK=function(n){return new io.ObjTree().parseXML(n)};function ym(n){return Object.prototype.toString.call(n)}function Mv(n){return"  ".repeat(n)}function Cu(n){return ym(n)==="[object Object]"?Object.keys(n).reduce(function(e,t){var o=t;return t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=Cu(n[t]),e},{}):Array.isArray(n)?n.map(function(e){return Cu(e)}):n}function AK(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(Cu(n)).replace(/"/g,"'")}return e}var Tv=`	
`;function $l(n,e,t){var o=Mv(t),i="",r=Tv+o;if(e==="-json")return"";if(e==="#text")return r+n;if(e==="#cdata-section")return"".concat(r,"<![CDATA[").concat(n,"]]>");if(e==="#comment")return"".concat(r,"<!--").concat(n,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(AK(n),'"');if(Array.isArray(n))i+=n.map(function(u){return $l(u,e,t+1)}).join("");else if(ym(n)==="[object Object]"){var s=Object.keys(n),a="",l=n["-json"]?Tv+Mv(t+1)+n["-json"]:"";i+="".concat(t===0?"":r,"<").concat(e),s.forEach(function(u){u.charAt(0)==="-"?a+=$l(n[u],u,t+1):l+=$l(n[u],u,t+1)}),i+=a+(l!==""?">".concat(l).concat(r,"</").concat(e,">"):" />")}else i+="".concat(r,"<").concat(e,">").concat(n.toString(),"</").concat(e,">");return i}function OK(n){var e="";for(var t in n)e+=$l(n[t],t,0);return e}var NK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Uc=function(){return Uc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Uc.apply(this,arguments)},$v=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Rf=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},zo=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},to;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",n.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",n.BOUNDARY="bpmn:boundaryEvent",n.PARALLEL_GATEWAY="bpmn:parallelGateway",n.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",n.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow",n.SUBPROCESS="bpmn:subProcess"})(to||(to={}));var bm=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],MK=["properties","startPoint","endPoint","pointsList"],Su={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},xm=function(n,e){var t=Object.keys(e||{});return t.forEach(function(o){if(n[o]){var i=e[o],r=i.in,s=i.out;r&&(n[o].in=r),s&&(n[o].out=s)}else n[o]=e[o]}),n},Eo={"bpmn:startEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateCatchEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateThrowEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:boundaryEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:sequenceFlow":{out:function(n){var e=n.properties,t=e.expressionType,o=e.condition;return o?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(o,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(o,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(n){var e=n.properties,t=e.timerType,o=e.timerValue,i=e.definitionId,r=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(o,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&o?">".concat(r(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(n,e){var t,o,i,r,s=n,a=e["-id"],l="",u="";try{for(var c=Rf(Object.keys(e)),f=c.next();!f.done;f=c.next()){var p=f.value;p.includes("bpmn:")&&(i=Kn(p.split(":"),2),l=i[1],u=(r=e[p])===null||r===void 0?void 0:r["#text"])}}catch(h){t={error:h}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(t)throw t.error}}return{"-definitionId":a,"-definitionType":s,"-timerType":l,"-timerValue":u}}},"bpmn:conditionExpression":{in:function(n,e){var t,o="",i="";return e["#cdata-section"]?(i="cdata",o=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",o=e["#text"]),{"-condition":o,"-expressionType":i}}}};function TK(n){var e=n??{},t=e.retainedAttrsFields,o=e.excludeFields,i=e.transformer,r=new Set(zo(zo([],Kn(MK),!1),Kn(t||[]),!1)),s={in:new Set(zo(zo([],Kn(Su.in),!1),Kn((o==null?void 0:o.in)||[]),!1)),out:new Set(zo(zo([],Kn(Su.out),!1),Kn((o==null?void 0:o.out)||[]),!1))};return Eo=xm(Eo,i),function(a){var l=a.nodes,u=a.edges;function c(f,p){var h,v;if((f==null?void 0:f.flag)!==1){var _;if((_=Eo[f.type])&&_.out){var m=_.out(f),g=Object.keys(m);g.length>0&&g.forEach(function(N){f[N]=m[N]})}f!=null&&f.children&&(f.children=f.children.map(function(N){var L=l.find(function($){return $.id===N})||u.find(function($){return $.id===N});return L||{}}));var b={};if(typeof f=="string")return f;if(Array.isArray(f))return f.map(function(N){return c(N,"")}).filter(function(N){return N!=null});try{for(var C=Rf(Object.entries(f)),D=C.next();!D.done;D=C.next()){var T=Kn(D.value,2),O=T[0],k=T[1];if((k==null?void 0:k.flag)===1)return;var S=[p,O].filter(function(N){return N}).join(".");s.out.has(S)||(typeof k!="object"?O.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(O)?b[O]=k:b["-".concat(O)]=k:r.has(S)?b["-".concat(O)]=c(k,S):b[O]=c(k,S))}}catch(N){h={error:N}}finally{try{D&&!D.done&&(v=C.return)&&v.call(C)}finally{if(h)throw h.error}}return b}}return c(a,"")}}function ku(n){var e,t,o={};try{for(var i=Rf(Object.entries(n)),r=i.next();!r.done;r=i.next()){var s=Kn(r.value,2),a=s[0],l=s[1];a.indexOf("-")===0?o[a.substring(1)]=Cu(l):typeof l=="string"?o[a]=l:Object.prototype.toString.call(l)==="[object Object]"?o[a]=ku(l):Array.isArray(l)?o[a]=l.map(function(u){return ku(u)}):o[a]=l}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o}function $K(n,e,t){var o,i=new Map,r=TK(t)(e);r.nodes.forEach(function(a){var l=a["-id"],u=a["-type"],c=a.text,f=a.children,p=$v(a,["-id","-type","text","children"]),h={"-id":l};c!=null&&c["-value"]&&(h["-name"]=c["-value"]),p["-json"]&&(h["-json"]=p["-json"]),p["-properties"]&&Object.assign(h,p["-properties"]),f&&(h.children=f),n[u]||(n[u]=[]),n[u].push(h),i.set(l,h)});var s=r.edges.map(function(a){var l=a["-id"],u=a["-sourceNodeId"],c=a["-targetNodeId"],f=a.text,p=$v(a,["-id","-sourceNodeId","-targetNodeId","text"]),h=i.get(c);h["bpmn:incoming"]||(h["bpmn:incoming"]=[]),h["bpmn:incoming"].push(l);var v={"-id":l,"-sourceRef":u,"-targetRef":c};return f!=null&&f["-value"]&&(v["-name"]=f["-value"]),p["-json"]&&(v["-json"]=p["-json"]),p["-properties"]&&Object.assign(v,p["-properties"]),v});return e.edges.forEach(function(a){var l=a.sourceNodeId,u=a.id,c=i.get(l);c["bpmn:outgoing"]||(c["bpmn:outgoing"]=[]),c["bpmn:outgoing"].push(u)}),(o=n["bpmn:subProcess"])===null||o===void 0||o.forEach(function(a){var l={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},u=[];a.children.forEach(function(_){var m,g=i.get(_["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(C){g[C]&&g[C].forEach(function(D){l[C].add(D)})});var b=(m=n[_["-type"]])===null||m===void 0?void 0:m.findIndex(function(C){return C["-id"]===_["-id"]});b>=0&&n[_["-type"]].splice(b,1),i.delete(_["-id"]),a[_["-type"]]||(a[_["-type"]]=[]),a[_["-type"]].push(g)});var c=l["bpmn:incoming"],f=l["bpmn:outgoing"];f.forEach(function(_){c.has(_)&&u.push(_)});for(var p=function(_){var m=s.findIndex(function(g){return g["-id"]===u[_]});m>=0?(a["bpmn:sequenceFlow"]||(a["bpmn:sequenceFlow"]=[]),a["bpmn:sequenceFlow"].push(s[m]),s.splice(m,1)):_++,h=_},h,v=0;v<u.length;)p(v),v=h;delete a.children}),n[to.FLOW]=s,n}function PK(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,u=a.y;return{"-x":l,"-y":u}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,u=fo.shapeConfigMap.get(t.type);u&&(r=u.width,s=u.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}var RK=["bpmn:incoming","bpmn:outgoing"];function BK(n,e){var t=[],o=[],i=new Map,r=e??{},s=r.transformer,a=r.excludeFields,l={in:new Set(zo(zo([],Kn(Su.in),!1),Kn((a==null?void 0:a.in)||[]),!1)),out:new Set(zo(zo([],Kn(Su.out),!1),Kn((a==null?void 0:a.out)||[]),!1))};Eo=xm(Eo,s);var u=n["bpmn:definitions"];if(u){var c=u["bpmn:process"];(function(p,h){h.forEach(function(v){try{Object.keys(p).forEach(function(_){try{v(_)}catch(m){console.error(m)}})}catch(_){console.error(_)}})})(c,[function(p){function h(_){_["-children"]||(_["-children"]=[]),Object.keys(_).forEach(function(m){var g;m.indexOf("bpmn:")===0&&!RK.includes(m)&&(c[m]||(c[m]=[]),!Array.isArray(c[m])&&(c[m]=[c[m]]),Array.isArray(_[m])?(g=c[m]).push.apply(g,zo([],Kn(_[m]),!1)):c[m].push(_[m]),Array.isArray(_[m])?_[m].forEach(function(b){!m.includes("Flow")&&_["-children"].push(b["-id"])}):!m.includes("Flow")&&_["-children"].push(_[m]["-id"]),delete _[m])})}if(p==="bpmn:subProcess"){var v=c[p];Array.isArray(v)?v.forEach(function(_){p==="bpmn:subProcess"&&h(_)}):h(v)}},function(p){var h=function(_){Object.keys(_).forEach(function(m){var g,b;if(m.includes("bpmn:")){var C={};Eo[m]&&Eo[m].in?(C=(b=(g=Eo[m]).in)===null||b===void 0?void 0:b.call(g,m,gg.cloneDeep(_[m])),delete _[m]):v(_[m]);var D=void 0;(D=Reflect.ownKeys(C)).length>0&&D.forEach(function(T){Reflect.set(_,T,C[T])})}})};function v(_){i.set(_["-id"],_),Array.isArray(_)?_.forEach(function(m){v(m)}):typeof _=="object"&&h(_)}v(c[p])},function(p){if(p.indexOf("bpmn:")===0){var h=c[p];if(p==="bpmn:sequenceFlow"){var v=u["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];o=IK(h,v)}else{var _=u["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(p==="bpmn:boundaryEvent"){var m=c[p],g=function(b){var C=b["-attachedToRef"],D=i.get(C);D["-boundaryEvents"]||(D["-boundaryEvents"]=[]),D["-boundaryEvents"].push(b["-id"])};Array.isArray(m)?m.forEach(function(b){g(b)}):g(m)}t=t.concat(LK(h,_,p))}}}])}var f=function(p,h,v){Object.keys(p).forEach(function(_){var m=v?"".concat(v,".").concat(_):_;h.has(m)?delete p[_]:typeof p[_]=="object"&&f(p[_],h,m)})};return t.forEach(function(p){var h,v;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var _=(v=e==null?void 0:e.mapping)===null||v===void 0?void 0:v.in,m=p.type;_[m]&&(p.type=_[m])}f(p,l.in,"")}),o.forEach(function(p){var h,v;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var _=(v=e==null?void 0:e.mapping)===null||v===void 0?void 0:v.in,m=p.type;_[m]&&(p.type=_[m])}f(p,l.in,"")}),{nodes:t,edges:o}}function LK(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(u){return u["-bpmnElement"]===s["-id"]}):a=e;var l=Pv(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=Pv(i,t,n);o.push(r)}return o}function Pv(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=t["-children"],s=t["-name"],a=fo.shapeConfigMap.get(e);a&&(o+=a.width/2,i+=a.height/2);var l={};Object.entries(t).forEach(function(p){var h=Kn(p,2),v=h[0],_=h[1];bm.includes(v)||(l[v]=_)}),l=ku(l);var u;if(s&&(u={x:o,y:i,value:s},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var c=n["bpmndi:BPMNLabel"]["dc:Bounds"];u.x=Number(c["-x"])+Number(c["-width"])/2,u.y=Number(c["-y"])+Number(c["-height"])/2}var f={id:n["-bpmnElement"],type:e,x:o,y:i,properties:l};return r&&(f.children=r),u&&(f.text=u),f}function IK(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(Rv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(Rv(o,n))}return t}function Rv(n,e){var t,o=e["-name"]?"".concat(e["-name"]):"";if(o){var i=n["bpmndi:BPMNLabel"]["dc:Bounds"],r=0;o.split(`
`).forEach(function(u){r<u.length&&(r=u.length)}),t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7}}var s={};Object.entries(e).forEach(function(u){var c=Kn(u,2),f=c[0],p=c[1];bm.includes(f)||(s[f]=p)}),s=ku(s);var a=n["di:waypoint"].map(function(u){return{x:Number(u["-x"]),y:Number(u["-y"])}}),l={id:e["-id"],type:to.FLOW,pointsList:a,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(l.text=t),l}var fo=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s,a,l=Uc({},o.processAttributes);$K(l,i,r);var u={"-id":"BPMNPlane_1","-bpmnElement":l["-id"]};PK(u,i);var c=o.definitionAttributes;c["bpmn:process"]=l,c["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":u};var f={"bpmn:definitions":c};if(!((s=r==null?void 0:r.mapping)===null||s===void 0)&&s.out){var p=(a=r==null?void 0:r.mapping)===null||a===void 0?void 0:a.out,h=function(v){Array.isArray(v)&&v.forEach(function(_){return h(_)}),typeof v=="object"&&Object.keys(v).forEach(function(_){var m;(m=p[_])?(v[m]=gg.cloneDeep(v[_]),delete v[_],h(v[m])):h(v[_])})};h(f)}return f},this.adapterIn=function(i,r){if(i)return BK(i,r)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();fo.shapeConfigMap.set(to.START,{width:wv.width,height:wv.height});fo.shapeConfigMap.set(to.END,{width:Cv.width,height:Cv.height});fo.shapeConfigMap.set(to.INTERMEDIATE_CATCH,{width:wu.width,height:wu.height});fo.shapeConfigMap.set(to.INTERMEDIATE_THROW,{width:wu.width,height:wu.height});fo.shapeConfigMap.set(to.BOUNDARY,{width:Sv.width,height:Sv.height});fo.shapeConfigMap.set(to.PARALLEL_GATEWAY,{width:kv.width,height:kv.height});fo.shapeConfigMap.set(to.INCLUSIVE_GATEWAY,{width:Ev.width,height:Ev.height});fo.shapeConfigMap.set(to.EXCLUSIVE_GATEWAY,{width:Dv.width,height:Dv.height});fo.shapeConfigMap.set(to.SYSTEM,{width:Av.width,height:Av.height});fo.shapeConfigMap.set(to.USER,{width:Ov.width,height:Ov.height});fo.shapeConfigMap.set(to.SUBPROCESS,{width:Nv.width,height:Nv.height});(function(n){NK(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(s){var a=DK(s);return o.adapterIn(a,o.props)},o.adapterXmlOut=function(s){var a=o.adapterOut(s,o.props);return OK(a)};var i=t.lf,r=t.props;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o.props=r,o}return e.pluginName="BPMNAdapter",e})(fo);function FK(n,e,t){var o=e.x,i=e.y,r=n.x,s=n.y,a=r-o,l=s-i,u=a*Math.cos(t)-l*Math.sin(t),c=a*Math.sin(t)+l*Math.cos(t),f=u+o,p=c+i;return{x:f,y:p}}var jK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Eu=function(){return Eu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Eu.apply(this,arguments)},VK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},HK=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},UK=(function(n){jK(e,n);function e(){var t=n.apply(this,HK([],VK(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(o){var i=o.model,r=t.props,s=r.model,a=r.graphModel,l=s.transformWithContainer,u=s.isRestrict,c=t.childrenPositionMap;if(!(!l||u)&&i.id===s.id){var f={x:s.x,y:s.y};Lt(Array.from(s.children),function(p){var h=a.getNodeModelById(p);if(h){var v={x:h.x,y:h.y};c.has(h.id)?v=c.get(h.id):c.set(h.id,v);var _=i.rotate*(180/Math.PI);_<0&&(_+=360);var m=_*(Math.PI/180),g=FK(v,f,m);h.moveTo(g.x,g.y),h.rotate=i.rotate}})}},t.onNodeResize=function(o){var i=o.deltaX,r=o.deltaY,s=o.index,a=o.model,l=o.preData,u=t.props,c=u.model,f=u.graphModel,p=c.transformWithContainer,h=c.isRestrict;if(!(!p||h)&&a.id===c.id){var v=l.properties,_=v||{},m=_.width,g=_.height;Lt(Array.from(c.children),function(b){var C=f.getNodeModelById(b);if(C){var D=C.width/m*i,T=C.height/g*r;Z_({deltaX:D,deltaY:T,index:s,nodeModel:C,graphModel:f,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var o=t.props.model;o.isCollapsed&&o.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,o){var i=this,r=[];return t.isGroup&&Lt(Array.from(t.children),function(s){r.push(s);var a=o.getNodeModelById(s);a!=null&&a.isGroup&&(r=r.concat(i.getNodesInGroup(a,o)))}),r},e.prototype.getResizeControl=function(){var t=this.props.model,o=t.resizable,i=t.isCollapsed,r=o&&!i;return r?n.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.groupAddable;if(!l)return null;var u=t.getNodeStyle().strokeWidth,c=u===void 0?0:u,f=t.getAddableOutlineStyle(),p=o+c+8,h=i+c+8;return Ze("rect",Eu(Eu({},f),{width:p,height:h,x:r-p/2,y:s-h/2,rx:a,ry:a}))},e.prototype.getCollapseIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," M").concat(t+7,",").concat(o+2," ").concat(t+7,",").concat(o+10)},e.prototype.getExpandIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=o-r/2+10,l=i-s/2+10;if(!t.collapsible)return null;var u=t!=null&&t.isCollapsed?this.getCollapseIcon(a,l):this.getExpandIcon(a,l),c=Ze("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:u});return Ze("g",{},[Ze("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:a,y:l,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),c])},e.prototype.getShape=function(){return Ze("g",{},[this.getAppendAreaShape(),n.prototype.getShape.call(this),this.getOperateIcon()])},e})(Mr),zK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Du=function(){return Du=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Du.apply(this,arguments)},Md=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Gr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Xs=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},qK=400,GK=230,XK=80,WK=60,YK=-1e4,KK=(function(n){zK(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var o;n.prototype.initNodeData.call(this,t);var i=(o=t.properties)!==null&&o!==void 0?o:{},r=i.children,s=i.width,a=i.height,l=i.collapsedWidth,u=i.collapsedHeight,c=i.collapsible,f=i.isCollapsed,p=i.zIndex,h=i.isRestrict,v=i.autoResize,_=i.autoToFront,m=i.transformWithContainer;this.children=r?new Set(r):new Set,this.zIndex=p??YK,this.isCollapsed=f??!1,this.setProperties({isCollapsed:f??!1});var g=s??qK,b=a??GK;this.width=g,this.height=b,this.expandWidth=g,this.expandHeight=b,this.collapsedWidth=l??XK,this.collapsedHeight=u??WK,this.isRestrict=h??!1,this.transformWithContainer=m??!1,this.autoResize=v??!1,this.collapsible=c??!0,this.autoToFront=_??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this),i=[];return Lt(Array.from(this.children),function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&i.push(r)}),o.children=i,o.properties&&(o.properties.children=i,o.properties.isCollapsed=this.isCollapsed),o},e.prototype.getNodesInGroup=function(t){var o=[];return t.isGroup&&Lt(Array.from(t.children),function(i){o.push(i)}),o},e.prototype.getMoveDistance=function(t,o,i){i===void 0&&(i=!1);var r=Gr(n.prototype.getMoveDistance.call(this,t,o,i),2),s=r[0],a=r[1],l=this.getNodesInGroup(this);return this.graphModel.moveNodes(l,t,o,i),[s,a]},e.prototype.getHistoryData=function(){var t=n.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var o=this,i=o.x,r=o.y,s=o.collapsedWidth,a=o.collapsedHeight,l=o.expandWidth,u=o.expandHeight,c=o.isCollapsed;return c&&(t.x=i+l/2-s/2,t.y=r+u/2-a/2,t.text&&(t.text.x=t.text.x+l/2-s/2,t.text.y=t.text.y+u/2-a/2)),t},e.prototype.toggleCollapse=function(t){var o=this,i=this.graphModel,r=!!t;this.isCollapsed=r,this.setProperties({isCollapsed:r}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:r,nodeModel:this}),r?this.collapse():this.expand();var s=Xs(Xs([],Gr(this.incoming.edges),!1),Gr(this.outgoing.edges),!1),a=Array.from(this.children);Lt(a,function(l){var u,c,f=o.graphModel.elementsModelMap.get(l);if(f){var p=f.isCollapsed;if(f.isGroup){var h=f;if(h.isCollapsed||h.toggleCollapse(t),!t){var v=(u=o.childrenLastCollapseStateDict)===null||u===void 0?void 0:u.get(l);v!==void 0&&v!==f.isCollapsed&&h.toggleCollapse(v)}}if((c=o.childrenLastCollapseStateDict)===null||c===void 0||c.set(l,!!p),f.visible=!t,f.BaseType===Sn.NODE){var _=f.incoming.edges,m=f.outgoing.edges;s=Xs(Xs(Xs([],Gr(s),!1),Gr(_),!1),Gr(m),!1)}}}),this.collapseEdge(r,s)},e.prototype.collapse=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.width,a=t.height,l=t.collapsedWidth,u=t.collapsedHeight;this.x=o-s/2+l/2,this.y=i-a/2+u/2,this.text.x=r.x-s/2+l/2,this.text.y=r.y-a/2+u/2,this.expandWidth=s,this.expandHeight=a,this.width=l,this.height=u},e.prototype.expand=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.expandWidth,a=t.expandHeight,l=t.collapsedWidth,u=t.collapsedHeight;this.width=s,this.height=a,this.x=o+this.width/2-l/2,this.y=i+this.height/2-u/2,this.text.x=r.x+this.width/2-l/2,this.text.y=r.y+this.height/2-u/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,o){var i=this,r=this.graphModel;Lt(o,function(s,a){var l,u=s.getData(),c=u.targetNodeId,f=u.sourceNodeId,p=Du(Du({},u),{id:"".concat(u.id,"__").concat(a),text:(l=u.text)===null||l===void 0?void 0:l.value});s.virtual&&r.deleteEdgeById(s.id);var h=r.dynamicGroup.getGroupByNodeId(c);h||(h=r.getNodeModelById(c));var v=r.dynamicGroup.getGroupByNodeId(f);v||(v=r.getNodeModelById(f)),t&&s.visible&&(i.children.has(f)||i.id===f?(p.startPoint=void 0,p.sourceNodeId=i.id):(p.endPoint=void 0,p.targetNodeId=i.id),(h.id!==i.id||v.id!==i.id)&&i.createVirtualEdge(p),s.visible=!1),!t&&!s.visible&&(h&&h.isGroup&&h.isCollapsed?(p.targetNodeId=h.id,p.endPoint=void 0,i.createVirtualEdge(p)):v&&v.isGroup&&v.isCollapsed?(p.sourceNodeId=v.id,p.startPoint=void 0,i.createVirtualEdge(p)):s.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var o=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:o,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var o=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:o})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=n.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Md([Pe],e.prototype,"isCollapsed",void 0),Md([Pe],e.prototype,"groupAddable",void 0),Md([Pe],e.prototype,"transformWithContainer",void 0),e})(Cs);function JK(n,e){var t=n.minX,o=n.minY,i=n.maxX,r=n.maxY,s=e.x,a=e.y,l=e.width,u=e.height;return t>=s-l/2&&i<=s+l/2&&o>=a-u/2&&r<=a+u/2}function ZK(n,e,t,o){var i=n.minX,r=n.minY,s=n.maxX,a=n.maxY,l=e.x,u=e.y,c=e.width,f=e.height,p=i+c/2,h=r+f/2,v=s-c/2,_=a-f/2;return{x:l+t>=p&&l+t<=v,y:u+o>=h&&u+o<=_}}var Au=function(){return Au=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Au.apply(this,arguments)},Xr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Wr=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Ja={type:"dynamic-group",view:UK,model:KK},QK=-1e3,kl=-1e4,eJ=(function(){function n(e){var t=e.lf,o=e.options,i=this;this.topGroupZIndex=kl,this.nodeGroupMap=new Map,this.onSelectionDrop=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.addNodeToGroup(s)})},this.onNodeAddOrDrop=function(r){var s=r.data;i.addNodeToGroup(s)},this.addNodeToGroup=function(r){var s=i.nodeGroupMap.get(r.id);if(s){var a=i.lf.getNodeModelById(s);a.removeChild(r.id),i.nodeGroupMap.delete(r.id),a.setAllowAppendChild(!1)}var l=i.lf.getNodeModelById(r.id),u=l==null?void 0:l.getBounds();if(l&&u){if(l.isGroup){var c=l;Lt(Array.from(c.children),function(h){i.nodeGroupMap.set(h,r.id)}),i.calibrateTopGroupZIndex([r]),i.onNodeSelect({data:r,isSelected:!1,isMultiple:!1})}var a=i.getGroupByBounds(u,r);if(a){var f=a.isAllowAppendIn(r);f?(a.addChild(r.id),a.setAllowAppendChild(!1)):i.lf.emit("group:not-allowed",{group:a.getData(),node:r})}}},this.onGroupAddNode=function(r){var s=r.data,a=r.childId;i.nodeGroupMap.set(a,s.id)},this.removeNodeFromGroup=function(r){var s=r.data,a=r.model;a.isGroup&&s.children&&Lt(Array.from(s.children),function(c){i.nodeGroupMap.delete(c),i.lf.deleteNode(c)});var l=i.nodeGroupMap.get(s.id);if(l){var u=i.lf.getNodeModelById(l);u&&u.removeChild(s.id),i.nodeGroupMap.delete(s.id)}},this.onSelectionDrag=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.setActiveGroup(s)})},this.onNodeDrag=function(r){var s=r.data;i.setActiveGroup(s)},this.setActiveGroup=function(r){var s=i.lf.getNodeModelById(r.id),a=s==null?void 0:s.getBounds();if(s&&a){var l=i.getGroupByBounds(a,r);if(i.activeGroup&&i.activeGroup.setAllowAppendChild(!1),!l||s.isGroup&&l.id===r.id)return;var u=l.isAllowAppendIn(r);if(!u)return;i.activeGroup=l,i.activeGroup.setAllowAppendChild(!0)}},this.onNodeSelect=function(r){var s=r.data,a=r.isMultiple,l=r.isSelected,u=i.lf.getNodeModelById(s.id);if(i.sendNodeToFront(u),i.topGroupZIndex>QK){var c=i.lf.graphModel.nodes;i.topGroupZIndex=kl;var f=Py(Qa(c,function(m){return!!m.isGroup}),"zIndex"),p=0;Lt(f,function(m){m.zIndex!==p&&(i.topGroupZIndex++,p=m.zIndex),m.setZIndex(i.topGroupZIndex)})}if(a&&l)if(u!=null&&u.isGroup){var h=u.children;Lt(Array.from(h),function(m){var g=i.lf.getNodeModelById(m);g==null||g.setSelected(!1)})}else{var v=i.nodeGroupMap.get(s.id);if(v){var _=i.lf.getNodeModelById(v);_!=null&&_.isSelected&&(u==null||u.setSelected(!1))}}},this.onNodeMove=function(r){var s=r.deltaX,a=r.deltaY,l=r.data,u=l.id,c=l.x,f=l.y,p=l.properties;if(p){var h=p.width,v=p.height,_=i.nodeGroupMap.get(u);if(_){var m=i.lf.getNodeModelById(_);if(!(!m||!m.isRestrict||!m.autoResize)){var g=c+s/2,b=f+a/2,C=g-h/2,D=b-v/2,T=g+h/2,O=b+v/2,k=!1,S=m.getBounds(),N=Object.assign({},S);if(C<N.minX&&(N.minX=C,k=!0),D<N.minY&&(N.minY=D,k=!0),T>N.maxX&&(N.maxX=T,k=!0),O>N.maxY&&(N.maxY=O,k=!0),!!k){var L=N.minX+(N.maxX-N.minX)/2,$=N.minY+(N.maxY-N.minY)/2,B=N.maxX-N.minX,E=N.maxY-N.minY;m.moveTo(L,$),m.width=B,m.height=E}}}}},this.onGraphRendered=function(r){var s=r.data;Lt(s.nodes,function(a){a.children&&Lt(a.children,function(l){i.nodeGroupMap.set(l,a.id)})}),i.calibrateTopGroupZIndex(s.nodes)},t.register(Ja),this.lf=t,an(this,o),this.init()}return n.prototype.getGroupByNodeId=function(e){var t=this.nodeGroupMap.get(e);if(t)return this.lf.getNodeModelById(t)},n.prototype.getGroupByBounds=function(e,t){var o=this.lf.graphModel.nodes,i=Qa(o,function(l){return!!l.isGroup&&JK(e,l)&&l.id!==t.id}),r=i.length;if(r<=1)return i[0];for(var s=i[r-1],a=r-2;a>=0;a--)i[a].zIndex>s.zIndex&&(s=i[a]);return s},n.prototype.sendNodeToFront=function(e){var t=this;if(!(!e||!e.isGroup)&&(this.topGroupZIndex++,e.setZIndex(this.topGroupZIndex),e.children)){var o=e.children;Lt(Array.from(o),function(i){var r=t.lf.getNodeModelById(i);t.sendNodeToFront(r)})}},n.prototype.getMaxZIndex=function(e){var t=this,o=kl;if(e.isGroup&&(o=Math.max(o,e.zIndex)),e.children){var i=e.children;Lt(Array.from(i),function(r){var s=t.lf.getNodeModelById(r);if(s!=null&&s.isGroup){var a=t.getMaxZIndex(s);o=Math.max(o,a)}})}return o},n.prototype.calibrateTopGroupZIndex=function(e){var t=this,o=kl;if(Lt(e,function(a){var l=t.lf.getNodeModelById(a.id);if(l){var u=t.getMaxZIndex(l);u>o&&(o=u)}}),!(this.topGroupZIndex>=o)){var i=this.lf.graphModel.nodes,r=Qa(i,function(a){return!!a.isGroup}),s=this.topGroupZIndex;Lt(r,function(a){a.zIndex>s&&(s=a.zIndex)}),this.topGroupZIndex=s}},n.prototype.removeChildrenInGroupNodeData=function(e){var t,o=Dt(e);return delete o.children,!((t=o.properties)===null||t===void 0)&&t.children&&delete o.properties.children,o},n.prototype.initGroupChildNodes=function(e,t,o,i){var r=this,s=[],a=[],l=[];Lt(Array.from(t),function(f){var p=r.lf.getNodeModelById(f);if(p){var h=p.children,v=p.getData(),_=pt.NODE_GROUP_COPY||"node:group-copy-add",m=KY(r.removeChildrenInGroupNodeData(v),i),g=r.lf.addNode(m,_);if(o.addChild(g.id),e[f]=g.id,s.push(g),l.push.apply(l,Wr([],Xr(Wr(Wr([],Xr(g.incoming.edges),!1),Xr(g.outgoing.edges),!1)),!1)),h instanceof Set){var b=r.initGroupChildNodes(e,h,g,i),C=b.childNodes,D=b.edgesData;s.push.apply(s,Wr([],Xr(C),!1)),a.push.apply(a,Wr([],Xr(D),!1))}}});var u=Qa(l,function(f){return _a(e,f.sourceNodeId)&&_a(e,f.targetNodeId)}),c=Zo(u,function(f){return f.getData()});return{childNodes:s,edgesData:a.concat(c)}},n.prototype.createEdge=function(e,t,o){var i,r,s=e.sourceNodeId,a=e.targetNodeId,l=(i=t[s])!==null&&i!==void 0?i:s,u=(r=t[a])!==null&&r!==void 0?r:a,c=Dt(e);return e.id&&typeof e.text=="object"&&e.text!==null&&(c=JY(e,o)),this.lf.graphModel.addEdge(Au(Au({},c),{sourceNodeId:l,targetNodeId:u}))},n.prototype.checkGroupBoundsWithChildren=function(e,t,o,i,r){if(e.children)for(var s=e.children,a=e.x,l=e.y,u=a+t/2,c=l+o/2,f=u-i/2,p=c-r/2,h=u+i/2,v=c+r/2,_=Array.from(s),m=0;m<_.length;m++){var g=_[m],b=this.lf.getNodeModelById(g);if(b){var C=b.getBounds(),D=C.minX,T=C.minY,O=C.maxX,k=C.maxY,S=f<=D&&p<=T&&h>=O&&v>=k;if(!S)return!1}}return!0},n.prototype.init=function(){var e=this,t=this.lf,o=t.graphModel;o.addNodeMoveRules(function(i,r,s){if(i.isGroup)return!0;var a=e.nodeGroupMap.get(i.id),l=e.lf.getNodeModelById(a);if(l&&l.isRestrict){if(l.autoResize)return!0;var u=l.getBounds();return ZK(u,i,r,s)}return!0}),o.addNodeResizeRules(function(i,r,s,a,l){return i.isGroup&&i.isRestrict?e.checkGroupBoundsWithChildren(i,r,s,a,l):!0}),o.dynamicGroup=this,t.on("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),t.on("selection:drop",this.onSelectionDrop),t.on("node:delete",this.removeNodeFromGroup),t.on("node:drag,node:dnd-drag",this.onNodeDrag),t.on("selection:drag",this.onSelectionDrag),t.on("node:click",this.onNodeSelect),t.on("node:mousemove",this.onNodeMove),t.on("graph:rendered",this.onGraphRendered),t.on("group:add-node",this.onGroupAddNode),t.addElements=function(i,r){var s=i.nodes,a=i.edges;r===void 0&&(r=40);var l={},u={nodes:[],edges:[]},c=[];return Lt(s,function(f){var p,h,v=f.id,_=(h=(p=f.properties)===null||p===void 0?void 0:p.children)!==null&&h!==void 0?h:f.children,m=t.addNode(e.removeChildrenInGroupNodeData(f));if(v&&(l[v]=m.id),u.nodes.push(m),m.isGroup){var g=e.initGroupChildNodes(l,_,m,r).edgesData;c.push.apply(c,Wr([],Xr(g),!1))}}),Lt(c,function(f){e.createEdge(f,l,r)}),Lt(a,function(f){u.edges.push(e.createEdge(f,l,r))}),u},this.render()},n.prototype.render=function(){},n.prototype.destroy=function(){this.lf.off("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),this.lf.off("selection:drop",this.onSelectionDrop),this.lf.off("node:delete",this.removeNodeFromGroup),this.lf.off("node:drag,node:dnd-drag",this.onNodeDrag),this.lf.off("selection:drag",this.onSelectionDrag),this.lf.off("node:click",this.onNodeSelect),this.lf.off("node:mousemove",this.onNodeMove),this.lf.off("graph:rendered",this.onGraphRendered),this.lf.off("group:add-node",this.onGroupAddNode)},n.pluginName="dynamicGroup",n})(),Bv;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(Bv||(Bv={}));var tJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),va=function(){return va=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},va.apply(this,arguments)},nJ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},oJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},iJ=(function(n){tJ(e,n);function e(t){var o=n.call(this,t)||this;o.textRef=Uu(),o.setHoverOn=function(){var l=o.props.element;l.isDragging||o.state.isHovered||(o.setState({isHovered:!0}),l.setHovered(!0))},o.setHoverOff=function(){var l=o.props.element;o.state.isHovered&&(o.setState({isHovered:!1}),l.setHovered(!1))},o.handleMouseDown=function(l){var u,c=o.props,f=c.label,p=c.graphModel,h=p.editConfigModel.nodeTextDraggable;((u=f.draggable)!==null&&u!==void 0?u:h)&&!o.state.isDragging&&!o.state.isEditing&&o.stepDrag.handleMouseDown(l)},o.handleMouseUp=function(l){o.state.isDragging&&o.stepDrag.handleMouseUp(l)},o.handleDragging=function(l){var u=l.deltaX,c=l.deltaY;o.state.isDragging||o.setState({isDragging:!0});var f=o.props,p=f.label,h=f.graphModel,v=h.transformModel,_=oJ(v.fixDeltaXY(u,c),2),m=_[0],g=_[1];o.setElementModelLabelInfo({x:p.x+m,y:p.y+g}),h.eventCenter.emit("label:drag",{data:p.getData(),model:p})},o.handleDragEnd=function(){o.setState({isDragging:!1})},o.handleClick=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel;f.setSelected(!o.state.isSelected),o.setState({isSelected:!o.state.isSelected}),o.setElementModelLabelInfo({isSelected:!0}),p.eventCenter.emit("label:click",{data:c.getData(),e:l,model:f})},o.handleDbClick=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel;if(p.eventCenter.emit("label:dblclick",{data:c.getData(),e:l,model:f}),!c.editable){f.setSelected(!0);return}if(f.setSelected(),f.setElementState(en.TEXT_EDIT),o.setState({isEditing:!0}),o.textRef.current){o.textRef.current.contentEditable="true",o.textRef.current.focus();var h=document.createRange(),v=window.getSelection();h.selectNodeContents(o.textRef.current),h.collapse(!1),v==null||v.removeAllRanges(),v==null||v.addRange(h)}},o.handleBlur=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel.eventCenter;p.emit("label:blur",{e:l,model:f,data:c.getData(),element:o.textRef.current}),o.setState({isDragging:!1,isHovered:!1,isSelected:!1})},o.handleInput=function(l){var u=o.props,c=u.label,f=u.graphModel;f.eventCenter.emit("label:input",{e:l,data:c.getData()})},o.reCalcLabelSize=function(){};var i=t.label,r=t.graphModel,s=r.gridSize,a=r.eventCenter;return o.stepDrag=new Lo({onDragging:o.handleDragging,onDragEnd:o.handleDragEnd,step:s,eventType:"LABEL",model:i,eventCenter:a}),o.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},o}return e.prototype.setElementModelLabelInfo=function(t){var o=this.props,i=o.label,r=o.element,s=o.graphModel,a=r.properties._label,l=a,u=Ry(l,function(p){return p.id===i.id}),c=l[u];l[u]=va(va({},c),t);var f=s.getElement(r.id);f==null||f.setProperty("_label",l)},e.prototype.componentDidMount=function(){var t=this,o=this.props,i=o.label,r=o.element,s=o.graphModel;s.eventCenter.on("blank:click,node:click,edge:click,label:click",function(a){var l,u,c,f,p=a.data;if(((p==null?void 0:p.type)!=="label"||p.type==="label"&&p.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((p==null?void 0:p.type)!=="label"||p.type=="label"&&p.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var h=(u=(l=t.textRef.current)===null||l===void 0?void 0:l.innerText)!==null&&u!==void 0?u:"",v=(f=(c=t.textRef.current)===null||c===void 0?void 0:c.innerHTML)!==null&&f!==void 0?f:"";t.setElementModelLabelInfo({value:h,content:v,isSelected:!1}),r.setElementState(en.DEFAULT)}((p==null?void 0:p.type)!=="label"||p.type=="label"&&p.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,o=this.props,i=o.label,r=o.element,s=o.graphModel,a=this.state,l=a.isDragging,u=a.isHovered,c=a.isSelected,f=a.isEditing,p=s.transformModel,h=p.getTransformStyle().transform,v=i.id,_=i.x,m=i.y,g=i.zIndex,b=i.vertical,C=i.style,D=i.rotate,T=i.content,O=i.labelWidth,k=i.textOverflowMode,S=O??(r.BaseType==="node"?r.width-20:80),N={left:"".concat(_-S/2,"px"),top:"".concat(m-10,"px"),width:"".concat(S,"px"),height:"20px",zIndex:g??1,transform:D?"".concat(h," rotate(").concat(D,"deg)"):"".concat(h," rotate(").concat(b?-.25:0,"turn)")};return Re("div",{id:"element-container-".concat(v),className:kc("lf-label-editor-container"),style:N,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:Re("div",{ref:this.textRef,id:"editor-container-".concat(v),className:kc("lf-label-editor",(t={"lf-label-editor-dragging":l,"lf-label-editor-editing":f,"lf-label-editor-hover":!f&&(u||c)},t["lf-label-editor-".concat(k)]=!f,t)),onInput:this.handleInput,style:va({maxWidth:"".concat(S,"px"),boxSizing:"border-box",display:"inline-block",background:f||r.BaseType==="edge"?"#fff":"transparent"},C),dangerouslySetInnerHTML:{__html:T}})})},e=nJ([eo],e),e})(Yt),So=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},rJ=Ji,sJ=(function(){function n(e,t,o){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=o,this.id=(i=e.id)!==null&&i!==void 0?i:rJ(),this.initLabelData(e)}return n.prototype.initLabelData=function(e){an(this,e)},n.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:Uo(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},So([Pe],n.prototype,"x",void 0),So([Pe],n.prototype,"y",void 0),So([Pe],n.prototype,"content",void 0),So([Pe],n.prototype,"value",void 0),So([Pe],n.prototype,"rotate",void 0),So([Pe],n.prototype,"style",void 0),So([Pe],n.prototype,"zIndex",void 0),So([Pe],n.prototype,"vertical",void 0),So([Pe],n.prototype,"editable",void 0),So([Pe],n.prototype,"draggable",void 0),So([Pe],n.prototype,"labelWidth",void 0),So([Pe],n.prototype,"textOverflowMode",void 0),n})(),Pl={exports:{}},Td=Pl.exports,Lv;function aJ(){return Lv||(Lv=1,(function(n){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||(function(e){if("Element"in e){var t="classList",o="prototype",i=e.Element[o],r=Object,s=String[o].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[o].indexOf||function(v){for(var _=0,m=this.length;_<m;_++)if(_ in this&&this[_]===v)return _;return-1},l=function(v,_){this.name=v,this.code=DOMException[v],this.message=_},u=function(v,_){if(_==="")throw new l("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(_))throw new l("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(v,_)},c=function(v){for(var _=s.call(v.getAttribute("class")||""),m=_?_.split(/\s+/):[],g=0,b=m.length;g<b;g++)this.push(m[g]);this._updateClassName=function(){v.setAttribute("class",this.toString())}},f=c[o]=[],p=function(){return new c(this)};if(l[o]=Error[o],f.item=function(v){return this[v]||null},f.contains=function(v){return v+="",u(this,v)!==-1},f.add=function(){var v=arguments,_=0,m=v.length,g,b=!1;do g=v[_]+"",u(this,g)===-1&&(this.push(g),b=!0);while(++_<m);b&&this._updateClassName()},f.remove=function(){var v=arguments,_=0,m=v.length,g,b=!1,C;do for(g=v[_]+"",C=u(this,g);C!==-1;)this.splice(C,1),b=!0,C=u(this,g);while(++_<m);b&&this._updateClassName()},f.toggle=function(v,_){v+="";var m=this.contains(v),g=m?_!==!0&&"remove":_!==!1&&"add";return g&&this[g](v),_===!0||_===!1?_:!m},f.toString=function(){return this.join(" ")},r.defineProperty){var h={get:p,enumerable:!0,configurable:!0};try{r.defineProperty(i,t,h)}catch(v){v.number===-2146823252&&(h.enumerable=!1,r.defineProperty(i,t,h))}}else r[o].__defineGetter__&&i.__defineGetter__(t,p)}})(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||(function(i){var r=function(k){return Object.prototype.toString.call(k).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},a=function(S,N,L){this.data=S,this.size=S.length,this.type=N,this.encoding=L},l=s.prototype,u=a.prototype,c=i.FileReaderSync,f=function(k){this.code=this[this.name=k]},p="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),h=p.length,v=i.URL||i.webkitURL||i,_=v.createObjectURL,m=v.revokeObjectURL,g=v,b=i.btoa,C=i.atob,D=i.ArrayBuffer,T=i.Uint8Array,O=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(a.fake=u.fake=!0;h--;)f.prototype[p[h]]=h+1;return v.createObjectURL||(g=i.URL=function(k){var S=document.createElementNS("http://www.w3.org/1999/xhtml","a"),N;return S.href=k,"origin"in S||(S.protocol.toLowerCase()==="data:"?S.origin=null:(N=k.match(O),S.origin=N&&N[1])),S}),g.createObjectURL=function(k){var S=k.type,N;if(S===null&&(S="application/octet-stream"),k instanceof a)return N="data:"+S,k.encoding==="base64"?N+";base64,"+k.data:k.encoding==="URI"?N+","+decodeURIComponent(k.data):b?N+";base64,"+b(k.data):N+","+encodeURIComponent(k.data);if(_)return _.call(v,k)},g.revokeObjectURL=function(k){k.substring(0,5)!=="data:"&&m&&m.call(v,k)},l.append=function(k){var S=this.data;if(T&&(k instanceof D||k instanceof T)){for(var N="",L=new T(k),$=0,B=L.length;$<B;$++)N+=String.fromCharCode(L[$]);S.push(N)}else if(r(k)==="Blob"||r(k)==="File")if(c){var E=new c;S.push(E.readAsBinaryString(k))}else throw new f("NOT_READABLE_ERR");else k instanceof a?k.encoding==="base64"&&C?S.push(C(k.data)):k.encoding==="URI"?S.push(decodeURIComponent(k.data)):k.encoding==="raw"&&S.push(k.data):(typeof k!="string"&&(k+=""),S.push(unescape(encodeURIComponent(k))))},l.getBlob=function(k){return arguments.length||(k=null),new a(this.data.join(""),k,"raw")},l.toString=function(){return"[object BlobBuilder]"},u.slice=function(k,S,N){var L=arguments.length;return L<3&&(N=null),new a(this.data.slice(k,L>1?S:this.data.length),N,this.encoding)},u.toString=function(){return"[object Blob]"},u.close=function(){this.size=0,delete this.data},s})(e);e.Blob=function(i,r){var s=r&&r.type||"",a=new t;if(i)for(var l=0,u=i.length;l<u;l++)Uint8Array&&i[l]instanceof Uint8Array?a.append(i[l].buffer):a.append(i[l]);var c=a.getBlob(s);return!c.slice&&c.webkitSlice&&(c.slice=c.webkitSlice),c};var o=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=o(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||Td.content||Td),(function(e,t){var o=typeof process<"u"&&process&&process.versions&&process.versions.electron;o?e.MediumEditor=t:n.exports=t})(Td,(function(){function e(t,o){return this.init(t,o)}return e.extensions={},(function(t){function o(l,u){var c,f=Array.prototype.slice.call(arguments,2);u=u||{};for(var p=0;p<f.length;p++){var h=f[p];if(h)for(c in h)h.hasOwnProperty(c)&&typeof h[c]<"u"&&(l||u.hasOwnProperty(c)===!1)&&(u[c]=h[c])}return u}var i=!1;try{var r=document.createElement("div"),s=document.createTextNode(" ");r.appendChild(s),i=r.contains(s)}catch{}var a={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(l){return!!(a.isMac&&l.metaKey||!a.isMac&&l.ctrlKey)},isKey:function(l,u){var c=a.getKeyCode(l);return Array.isArray(u)===!1?c===u:u.indexOf(c)!==-1},getKeyCode:function(l){var u=l.which;return u===null&&(u=l.charCode!==null?l.charCode:l.keyCode),u},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var u=[!0].concat(Array.prototype.slice.call(arguments));return o.apply(this,u)},defaults:function(){var u=[!1].concat(Array.prototype.slice.call(arguments));return o.apply(this,u)},createLink:function(l,u,c,f){var p=l.createElement("a");return a.moveTextRangeIntoElement(u[0],u[u.length-1],p),p.setAttribute("href",c),f&&(f==="_blank"&&p.setAttribute("rel","noopener noreferrer"),p.setAttribute("target",f)),p},findOrCreateMatchingTextNodes:function(l,u,c){for(var f=l.createTreeWalker(u,NodeFilter.SHOW_ALL,null,!1),p=[],h=0,v=!1,_=null,m=null;(_=f.nextNode())!==null;)if(!(_.nodeType>3))if(_.nodeType===3){if(!v&&c.start<h+_.nodeValue.length&&(v=!0,m=a.splitStartNodeIfNeeded(_,c.start,h)),v&&a.splitEndNodeIfNeeded(_,m,c.end,h),v&&h===c.end)break;if(v&&h>c.end+1)throw new Error("PerformLinking overshot the target!");v&&p.push(m||_),h+=_.nodeValue.length,m!==null&&(h+=m.nodeValue.length,f.nextNode()),m=null}else _.tagName.toLowerCase()==="img"&&(!v&&c.start<=h&&(v=!0),v&&p.push(_));return p},splitStartNodeIfNeeded:function(l,u,c){return u!==c?l.splitText(u-c):null},splitEndNodeIfNeeded:function(l,u,c,f){var p,h;p=f+l.nodeValue.length+(u?u.nodeValue.length:0)-1,h=c-f-(u?l.nodeValue.length:0),p>=c&&f!==p&&h!==0&&(u||l).splitText(h)},splitByBlockElements:function(l){if(l.nodeType!==3&&l.nodeType!==1)return[];var u=[],c=e.util.blockContainerElementNames.join(",");if(l.nodeType===3||l.querySelectorAll(c).length===0)return[l];for(var f=0;f<l.childNodes.length;f++){var p=l.childNodes[f];if(p.nodeType===3)u.push(p);else if(p.nodeType===1){var h=p.querySelectorAll(c);h.length===0?u.push(p):u=u.concat(e.util.splitByBlockElements(p))}}return u},findAdjacentTextNodeWithContent:function(u,c,f){var p=!1,h,v=f.createNodeIterator(u,NodeFilter.SHOW_TEXT,null,!1);for(h=v.nextNode();h;){if(h===c)p=!0;else if(p&&h.nodeType===3&&h.nodeValue&&h.nodeValue.trim().length>0)break;h=v.nextNode()}return h},findPreviousSibling:function(l){if(!l||a.isMediumEditorElement(l))return!1;for(var u=l.previousSibling;!u&&!a.isMediumEditorElement(l.parentNode);)l=l.parentNode,u=l.previousSibling;return u},isDescendant:function(u,c,f){if(!u||!c)return!1;if(u===c)return!!f;if(u.nodeType!==1)return!1;if(i||c.nodeType!==3)return u.contains(c);for(var p=c.parentNode;p!==null;){if(p===u)return!0;p=p.parentNode}return!1},isElement:function(u){return!!(u&&u.nodeType===1)},throttle:function(l,u){var c=50,f,p,h,v=null,_=0,m=function(){_=Date.now(),v=null,h=l.apply(f,p),v||(f=p=null)};return!u&&u!==0&&(u=c),function(){var g=Date.now(),b=u-(g-_);return f=this,p=arguments,b<=0||b>u?(v&&(clearTimeout(v),v=null),_=g,h=l.apply(f,p),v||(f=p=null)):v||(v=setTimeout(m,b)),h}},traverseUp:function(l,u){if(!l)return!1;do{if(l.nodeType===1){if(u(l))return l;if(a.isMediumEditorElement(l))return!1}l=l.parentNode}while(l);return!1},htmlEntities:function(l){return String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(l,u){var c,f,p,h,v,_,m,g=!1,b=["insertHTML",!1,u];if(!e.util.isEdge&&l.queryCommandSupported("insertHTML"))try{return l.execCommand.apply(l,b)}catch{}if(c=l.getSelection(),c.rangeCount){if(f=c.getRangeAt(0),m=f.commonAncestorContainer,a.isMediumEditorElement(m)&&!m.firstChild)f.selectNode(m.appendChild(l.createTextNode("")));else if(m.nodeType===3&&f.startOffset===0&&f.endOffset===m.nodeValue.length||m.nodeType!==3&&m.innerHTML===f.toString()){for(;!a.isMediumEditorElement(m)&&m.parentNode&&m.parentNode.childNodes.length===1&&!a.isMediumEditorElement(m.parentNode);)m=m.parentNode;f.selectNode(m)}for(f.deleteContents(),p=l.createElement("div"),p.innerHTML=u,h=l.createDocumentFragment();p.firstChild;)v=p.firstChild,_=h.appendChild(v);f.insertNode(h),_&&(f=f.cloneRange(),f.setStartAfter(_),f.collapse(!0),e.selection.selectRange(l,f)),g=!0}return l.execCommand.callListeners&&l.execCommand.callListeners(b,g),g},execFormatBlock:function(l,u){var c=a.getTopBlockContainer(e.selection.getSelectionStart(l)),f;if(u==="blockquote"){if(c&&(f=Array.prototype.slice.call(c.childNodes),f.some(function(p){return a.isBlockContainer(p)})))return l.execCommand("outdent",!1,null);if(a.isIE)return l.execCommand("indent",!1,u)}if(c&&u===c.nodeName.toLowerCase()&&(u="p"),a.isIE&&(u="<"+u+">"),c&&c.nodeName.toLowerCase()==="blockquote"){if(a.isIE&&u==="<p>")return l.execCommand("outdent",!1,u);if((a.isFF||a.isEdge)&&u==="p")return f=Array.prototype.slice.call(c.childNodes),f.some(function(p){return!a.isBlockContainer(p)})&&l.execCommand("formatBlock",!1,u),l.execCommand("outdent",!1,u)}return l.execCommand("formatBlock",!1,u)},setTargetBlank:function(l,u){var c,f=u||!1;if(l.nodeName.toLowerCase()==="a")l.target="_blank",l.rel="noopener noreferrer";else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)(f===!1||f===l[c].attributes.href.value)&&(l[c].target="_blank",l[c].rel="noopener noreferrer")},removeTargetBlank:function(l,u){var c;if(l.nodeName.toLowerCase()==="a")l.removeAttribute("target"),l.removeAttribute("rel");else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)u===l[c].attributes.href.value&&(l[c].removeAttribute("target"),l[c].removeAttribute("rel"))},addClassToAnchors:function(l,u){var c=u.split(" "),f,p;if(l.nodeName.toLowerCase()==="a")for(p=0;p<c.length;p+=1)l.classList.add(c[p]);else{var h=l.getElementsByTagName("a");if(h.length===0){var v=a.getClosestTag(l,"a");l=v?[v]:[]}else l=h;for(f=0;f<l.length;f+=1)for(p=0;p<c.length;p+=1)l[f].classList.add(c[p])}},isListItem:function(l){if(!l)return!1;if(l.nodeName.toLowerCase()==="li")return!0;for(var u=l.parentNode,c=u.nodeName.toLowerCase();c==="li"||!a.isBlockContainer(u)&&c!=="div";){if(c==="li")return!0;if(u=u.parentNode,u)c=u.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(l,u){if(u.nodeName.toLowerCase()==="li"){var c=u.parentElement;c.parentElement.nodeName.toLowerCase()==="p"&&(a.unwrap(c.parentElement,l),e.selection.moveCursor(l,u.firstChild,u.firstChild.textContent.length))}},splitOffDOMTree:function(l,u,c){for(var f=u,p=null,h=!c;f!==l;){var v=f.parentNode,_=v.cloneNode(!1),m=h?f:v.firstChild,g;for(p&&(h?_.appendChild(p):g=p),p=_;m;){var b=m.nextSibling;m===f?(m.hasChildNodes()?m=m.cloneNode(!1):m.parentNode.removeChild(m),m.textContent&&p.appendChild(m),m=h?b:null):(m.parentNode.removeChild(m),(m.hasChildNodes()||m.textContent)&&p.appendChild(m),m=b)}g&&p.appendChild(g),f=v}return p},moveTextRangeIntoElement:function(l,u,c){if(!l||!u)return!1;var f=a.findCommonRoot(l,u);if(!f)return!1;if(u===l){var p=l.parentNode,h=l.nextSibling;return p.removeChild(l),c.appendChild(l),h?p.insertBefore(c,h):p.appendChild(c),c.hasChildNodes()}for(var v=[],_,m,g,b=0;b<f.childNodes.length;b++)if(g=f.childNodes[b],!_)a.isDescendant(g,l,!0)&&(_=g);else if(a.isDescendant(g,u,!0)){m=g;break}else v.push(g);var C=m.nextSibling,D=f.ownerDocument.createDocumentFragment();return _===l?(_.parentNode.removeChild(_),D.appendChild(_)):D.appendChild(a.splitOffDOMTree(_,l)),v.forEach(function(T){T.parentNode.removeChild(T),D.appendChild(T)}),m===u?(m.parentNode.removeChild(m),D.appendChild(m)):D.appendChild(a.splitOffDOMTree(m,u,!0)),c.appendChild(D),m.parentNode===f?f.insertBefore(c,m):C?f.insertBefore(c,C):f.appendChild(c),c.hasChildNodes()},depthOfNode:function(l){for(var u=0,c=l;c.parentNode!==null;)c=c.parentNode,u++;return u},findCommonRoot:function(l,u){for(var c=a.depthOfNode(l),f=a.depthOfNode(u),p=l,h=u;c!==f;)c>f?(p=p.parentNode,c-=1):(h=h.parentNode,f-=1);for(;p!==h;)p=p.parentNode,h=h.parentNode;return p},isElementAtBeginningOfBlock:function(l){for(var u,c;!a.isBlockContainer(l)&&!a.isMediumEditorElement(l);){for(c=l;c=c.previousSibling;)if(u=c.nodeType===3?c.nodeValue:c.textContent,u.length>0)return!1;l=l.parentNode}return!0},isMediumEditorElement:function(l){return l&&l.getAttribute&&!!l.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(l){return a.traverseUp(l,function(u){return a.isMediumEditorElement(u)})},isBlockContainer:function(l){return l&&l.nodeType!==3&&a.blockContainerElementNames.indexOf(l.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(l){return a.traverseUp(l,function(u){return a.isBlockContainer(u)||a.isMediumEditorElement(u)})},getTopBlockContainer:function(l){var u=a.isBlockContainer(l)?l:!1;return a.traverseUp(l,function(c){return a.isBlockContainer(c)&&(u=c),!u&&a.isMediumEditorElement(c)?(u=c,!0):!1}),u},getFirstSelectableLeafNode:function(l){for(;l&&l.firstChild;)l=l.firstChild;if(l=a.traverseUp(l,function(c){return a.emptyElementNames.indexOf(c.nodeName.toLowerCase())===-1}),l.nodeName.toLowerCase()==="table"){var u=l.querySelector("th, td");u&&(l=u)}return l},getFirstTextNode:function(l){return a.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),a._getFirstTextNode(l)},_getFirstTextNode:function(l){if(l.nodeType===3)return l;for(var u=0;u<l.childNodes.length;u++){var c=a._getFirstTextNode(l.childNodes[u]);if(c!==null)return c}return null},ensureUrlHasProtocol:function(l){return l.indexOf("://")===-1?"http://"+l:l},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(l,u,c){var f=l+" is deprecated, please use "+u+" instead.";c&&(f+=" Will be removed in "+c),a.warn(f)},deprecatedMethod:function(l,u,c,f){a.deprecated(l,u,f),typeof this[u]=="function"&&this[u].apply(this,c)},cleanupAttrs:function(l,u){u.forEach(function(c){l.removeAttribute(c)})},cleanupTags:function(l,u){u.indexOf(l.nodeName.toLowerCase())!==-1&&l.parentNode.removeChild(l)},unwrapTags:function(l,u){u.indexOf(l.nodeName.toLowerCase())!==-1&&e.util.unwrap(l,document)},getClosestTag:function(l,u){return a.traverseUp(l,function(c){return c.nodeName.toLowerCase()===u.toLowerCase()})},unwrap:function(l,u){for(var c=u.createDocumentFragment(),f=Array.prototype.slice.call(l.childNodes),p=0;p<f.length;p++)c.appendChild(f[p]);c.childNodes.length?l.parentNode.replaceChild(c,l):l.parentNode.removeChild(l)},guid:function(){function l(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()}};e.util=a})(window),(function(){var t=function(o){e.util.extend(this,o)};t.extend=function(o){var i=this,r;o&&o.hasOwnProperty("constructor")?r=o.constructor:r=function(){return i.apply(this,arguments)},e.util.extend(r,i);var s=function(){this.constructor=r};return s.prototype=i.prototype,r.prototype=new s,o&&e.util.extend(r.prototype,o),r},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(o){return this.base.options[o]}},["execAction","on","off","subscribe","trigger"].forEach(function(o){t.prototype[o]=function(){return this.base[o].apply(this.base,arguments)}}),e.Extension=t})(),(function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var o={findMatchingSelectionParent:function(i,r){var s=r.getSelection(),a,l;return s.rangeCount===0?!1:(a=s.getRangeAt(0),l=a.commonAncestorContainer,e.util.traverseUp(l,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(r){return e.util.isMediumEditorElement(r)},i)},exportSelection:function(i,r){if(!i)return null;var s=null,a=r.getSelection();if(a.rangeCount>0){var l=a.getRangeAt(0),u=l.cloneRange(),c;u.selectNodeContents(i),u.setEnd(l.startContainer,l.startOffset),c=u.toString().length,s={start:c,end:c+l.toString().length},this.doesRangeStartWithImages(l,r)&&(s.startsWithImage=!0);var f=this.getTrailingImageCount(i,s,l.endContainer,l.endOffset);if(f&&(s.trailingImageCount=f),c!==0){var p=this.getIndexRelativeToAdjacentEmptyBlocks(r,i,l.startContainer,l.startOffset);p!==-1&&(s.emptyBlocksIndex=p)}}return s},importSelection:function(i,r,s,a){if(!(!i||!r)){var l=s.createRange();l.setStart(r,0),l.collapse(!0);var u=r,c=[],f=0,p=!1,h=!1,v=0,_=!1,m,g=!1,b=null;for((a||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(g=!0);!_&&u;){if(u.nodeType>3){u=c.pop();continue}if(u.nodeType===3&&!h)m=f+u.length,!p&&i.start>=f&&i.start<=m&&(g||i.start<m?(l.setStart(u,i.start-f),p=!0):b=u),p&&i.end>=f&&i.end<=m&&(i.trailingImageCount?h=!0:(l.setEnd(u,i.end-f),_=!0)),f=m;else{if(i.trailingImageCount&&h&&(u.nodeName.toLowerCase()==="img"&&v++,v===i.trailingImageCount)){for(var C=0;u.parentNode.childNodes[C]!==u;)C++;l.setEnd(u.parentNode,C+1),_=!0}if(!_&&u.nodeType===1)for(var D=u.childNodes.length-1;D>=0;)c.push(u.childNodes[D]),D-=1}_||(u=c.pop())}!p&&b&&(l.setStart(b,b.length),l.setEnd(b,b.length)),typeof i.emptyBlocksIndex<"u"&&(l=this.importSelectionMoveCursorPastBlocks(s,r,i.emptyBlocksIndex,l)),a&&(l=this.importSelectionMoveCursorPastAnchor(i,l)),this.selectRange(s,l)}},importSelectionMoveCursorPastAnchor:function(i,r){var s=function(f){return f.nodeName.toLowerCase()==="a"};if(i.start===i.end&&r.startContainer.nodeType===3&&r.startOffset===r.startContainer.nodeValue.length&&e.util.traverseUp(r.startContainer,s)){for(var a=r.startContainer,l=r.startContainer.parentNode;l!==null&&l.nodeName.toLowerCase()!=="a";)l.childNodes[l.childNodes.length-1]!==a?l=null:(a=l,l=l.parentNode);if(l!==null&&l.nodeName.toLowerCase()==="a"){for(var u=null,c=0;u===null&&c<l.parentNode.childNodes.length;c++)l.parentNode.childNodes[c]===l&&(u=c);r.setStart(l.parentNode,u+1),r.collapse(!0)}}return r},importSelectionMoveCursorPastBlocks:function(i,r,s,a){var l=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),u=a.startContainer,c,f,p=0;for(s=s||1,u.nodeType===3&&e.util.isBlockContainer(u.previousSibling)?c=u.previousSibling:c=e.util.getClosestBlockContainer(u);l.nextNode();)if(!f)c===l.currentNode&&(f=l.currentNode);else if(f=l.currentNode,p++,p===s||f.textContent.length>0)break;return f||(f=c),a.setStart(e.util.getFirstSelectableLeafNode(f),0),a},getIndexRelativeToAdjacentEmptyBlocks:function(i,r,s,a){if(s.textContent.length>0&&a>0)return-1;var l=s;if(l.nodeType!==3&&(l=s.childNodes[a]),l){if(!e.util.isElementAtBeginningOfBlock(l))return-1;var u=e.util.findPreviousSibling(l);if(u){if(u.nodeValue)return-1}else return-1}for(var c=e.util.getClosestBlockContainer(s),f=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),p=0;f.nextNode();){var h=f.currentNode.textContent==="";if((h||p>0)&&(p+=1),f.currentNode===c)return p;h||(p=0)}return p},doesRangeStartWithImages:function(i,r){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var s=i.startContainer.querySelector("img");if(!s)return!1;for(var a=r.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);a.nextNode();){var l=a.currentNode;if(l===s)break;if(l.nodeValue)return!1}return!0},getTrailingImageCount:function(i,r,s,a){if(a===0||s.nodeType!==1||s.nodeName.toLowerCase()!=="img"&&!s.querySelector("img"))return 0;for(var l=s.childNodes[a-1];l.hasChildNodes();)l=l.lastChild;for(var u=i,c=[],f=0,p=!1,h=!1,v=!1,_,m=0;!v&&u;){if(u.nodeType>3){u=c.pop();continue}if(u.nodeType===3&&!h)m=0,_=f+u.length,!p&&r.start>=f&&r.start<=_&&(p=!0),p&&r.end>=f&&r.end<=_&&(h=!0),f=_;else if(u.nodeName.toLowerCase()==="img"&&m++,u===l)v=!0;else if(u.nodeType===1)for(var g=u.childNodes.length-1;g>=0;)c.push(u.childNodes[g]),g-=1;v||(u=c.pop())}return m},selectionContainsContent:function(i){var r=i.getSelection();if(!r||r.isCollapsed||!r.rangeCount)return!1;if(r.toString().trim()!=="")return!0;var s=this.getSelectedParentElement(r.getRangeAt(0));return!!(s&&(s.nodeName.toLowerCase()==="img"||s.nodeType===1&&s.querySelector("img")))},selectionInContentEditableFalse:function(i){var r,s=this.findMatchingSelectionParent(function(a){var l=a&&a.getAttribute("contenteditable");return l==="true"&&(r=!0),a.nodeName!=="#text"&&l==="false"},i);return!r&&s},getSelectionHtml:function(r){var s,a="",l=r.getSelection(),u,c;if(l.rangeCount){for(c=r.createElement("div"),s=0,u=l.rangeCount;s<u;s+=1)c.appendChild(l.getRangeAt(s).cloneContents());a=c.innerHTML}return a},getCaretOffsets:function(r,s){var a,l;return s||(s=window.getSelection().getRangeAt(0)),a=s.cloneRange(),l=s.cloneRange(),a.selectNodeContents(r),a.setEnd(s.endContainer,s.endOffset),l.selectNodeContents(r),l.setStart(s.endContainer,s.endOffset),{left:a.toString().length,right:l.toString().length}},rangeSelectsSingleNode:function(i){var r=i.startContainer;return r===i.endContainer&&r.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var r=i.getSelection(),s,a,l;if(!r.rangeCount||r.isCollapsed||!r.getRangeAt(0).commonAncestorContainer)return[];if(s=r.getRangeAt(0),s.commonAncestorContainer.nodeType===3){for(a=[],l=s.commonAncestorContainer;l.parentNode&&l.parentNode.childNodes.length===1;)a.push(l.parentNode),l=l.parentNode;return a}return[].filter.call(s.commonAncestorContainer.getElementsByTagName("*"),function(u){return typeof r.containsNode=="function"?r.containsNode(u,!0):!0})},selectNode:function(i,r){var s=r.createRange();s.selectNodeContents(i),this.selectRange(r,s)},select:function(i,r,s,a,l){var u=i.createRange();return u.setStart(r,s),a?u.setEnd(a,l):u.collapse(!0),this.selectRange(i,u),u},clearSelection:function(i,r){r?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,r,s){this.select(i,r,s)},getSelectionRange:function(i){var r=i.getSelection();return r.rangeCount===0?null:r.getRangeAt(0)},selectRange:function(i,r){var s=i.getSelection();s.removeAllRanges(),s.addRange(r)},getSelectionStart:function(i){var r=i.getSelection().anchorNode,s=r&&r.nodeType===3?r.parentNode:r;return s}};e.selection=o})(),(function(){function t(i,r){return i?i.some(function(s){if(typeof s.getInteractionElements!="function")return!1;var a=s.getInteractionElements();return a?(Array.isArray(a)||(a=[a]),a.some(function(l){return e.util.isDescendant(l,r,!0)})):!1}):!1}var o=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};o.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,r,s,a){var l=this.base.options.contentWindow,u=this.base.options.ownerDocument;i=e.util.isElement(i)||[l,u].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(c){c.addEventListener(r,s,a),this.events.push([c,r,s,a])}).bind(this))},detachDOMEvent:function(i,r,s,a){var l,u,c=this.base.options.contentWindow,f=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[c,f].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(p){l=this.indexOfListener(p,r,s,a),l!==-1&&(u=this.events.splice(l,1)[0],u[0].removeEventListener(u[1],u[2],u[3]))}).bind(this)))},indexOfListener:function(i,r,s,a){var l,u,c;for(l=0,u=this.events.length;l<u;l=l+1)if(c=this.events[l],c[0]===i&&c[1]===r&&c[2]===s&&c[3]===a)return l;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var r=this.events.filter(function(u){return u&&u[0].getAttribute&&u[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),s=0,a=r.length;s<a;s++){var l=r[s];this.detachDOMEvent(l[0],l[1],l[2],l[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(r){this.attachDOMEvent(i,r.name,r.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,r){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(r)},detachCustomEvent:function(i,r){var s=this.indexOfCustomListener(i,r);s!==-1&&this.customEvents[i].splice(s,1)},indexOfCustomListener:function(i,r){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(r)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,r,s){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(a){a(r,s)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var r=i.execCommand.listeners.indexOf(this.execCommandListener);r!==-1&&i.execCommand.listeners.splice(r,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var r=function(a,l){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(u){u({command:a[0],value:a[2],args:a,result:l})})},s=function(){var a=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return a;var l=Array.prototype.slice.call(arguments);return r(l,a),a};s.orig=i.execCommand,s.listeners=[],s.callListeners=r,i.execCommand=s}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(r){this.contentCache[r.getAttribute("medium-editor-index")]=r.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,r){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(s){this.attachDOMEvent(s,i,r.bind(this))},this),this.eventsCache.push({name:i,handler:r})},cleanupElement:function(i){var r=i.getAttribute("medium-editor-index");r&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[r])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,r){var s=this.base.getFocusedElement(),a;s&&r.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(s,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(a=s),a||this.base.elements.some(function(u){return!a&&e.util.isDescendant(u,i,!0)&&(a=u),!!a},this);var l=!e.util.isDescendant(s,i,!0)&&!t(this.base.extensions,i);a!==s&&(s&&l&&(s.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",r,s)),a&&(a.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",r,a))),l&&this.triggerCustomEvent("externalInteraction",r)},updateInput:function(i,r){if(this.contentCache){var s=i.getAttribute("medium-editor-index"),a=i.innerHTML;a!==this.contentCache[s]&&this.triggerCustomEvent("editableInput",r,i),this.contentCache[s]=a}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var r=i.currentTarget.activeElement,s;this.base.elements.some(function(a){return e.util.isDescendant(a,r,!0)?(s=a,!0):!1},this),s&&this.updateInput(s,{target:r,currentTarget:s})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var r={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(r.currentTarget,r)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=o})(),(function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(o){t.isBuiltInButton(o)?e.Extension.call(this,this.defaults[o]):e.Extension.call(this,o)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var o=this.document.createElement("button"),i=this.contentDefault,r=this.getAria(),s=this.getEditorOption("buttonLabels");return o.classList.add("medium-editor-action"),o.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(a){o.classList.add(a)}),o.setAttribute("data-action",this.getAction()),r&&(o.setAttribute("title",r),o.setAttribute("aria-label",r)),this.attrs&&Object.keys(this.attrs).forEach(function(a){o.setAttribute(a,this.attrs[a])},this),s==="fontawesome"&&this.contentFA&&(i=this.contentFA),o.innerHTML=i,o},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var o=null;return this.useQueryState&&(o=this.base.queryCommandState(this.getAction())),o},isAlreadyApplied:function(o){var i=!1,r=this.getTagNames(),s,a;return this.knownState===!1||this.knownState===!0?this.knownState:(r&&r.length>0&&(i=r.indexOf(o.nodeName.toLowerCase())!==-1),!i&&this.style&&(s=this.style.value.split("|"),a=this.window.getComputedStyle(o,null).getPropertyValue(this.style.prop),s.forEach(function(l){this.knownState||(i=a.indexOf(l)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(o){return typeof o=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(o)},e.extensions.button=t})(),(function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}})(),(function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.hideToolbarDefaultActions()},setToolbarPosition:function(){var o=this.base.getExtensionByName("toolbar");o&&o.setToolbarPosition()}});e.extensions.form=t})(),(function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(o){e.util.isKey(o,e.util.keyCode.K)&&e.util.isMetaCtrlKey(o)&&!o.shiftKey&&this.handleClick(o)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var o=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return o.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),o.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),o.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(o){var i=this.getInput(),r=this.getAnchorTargetCheckbox(),s=this.getAnchorButtonCheckbox();if(o=o||{value:""},typeof o=="string"&&(o={value:o}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=o.value,i.focus(),r&&(r.checked=o.target==="_blank"),s){var a=o.buttonClass?o.buttonClass.split(" "):[];s.checked=a.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var o=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),r={value:this.getInput().value.trim()};return this.linkValidation&&(r.value=this.checkLinkFormat(r.value)),r.target="_self",o&&o.checked&&(r.target="_blank"),i&&i.checked&&(r.buttonClass=this.customClassOption),r},doFormSave:function(){var o=this.getFormOpts();this.completeFormSave(o)},completeFormSave:function(o){this.base.restoreSelection(),this.execAction(this.action,o),this.base.checkSelection()},ensureEncodedUri:function(o){return o===decodeURI(o)?encodeURI(o):o},ensureEncodedUriComponent:function(o){return o===decodeURIComponent(o)?encodeURIComponent(o):o},ensureEncodedParam:function(o){var i=o.split("="),r=i[0],s=i[1];return r+(s===void 0?"":"="+this.ensureEncodedUriComponent(s))},ensureEncodedQuery:function(o){return o.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(o){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,r=i.test(o),s="",a=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,l=o.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),u=l[1],c=l[2],f=l[3];if(a.test(o))return"tel:"+o;if(!r){var p=u.split("/")[0];(p.match(/.+(\.|:).+/)||p==="localhost")&&(s="http://")}return s+this.ensureEncodedUri(u)+(c===void 0?"":"?"+this.ensureEncodedQuery(c))+(f===void 0?"":"#"+f)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(o){var i=o.querySelector(".medium-editor-toolbar-close"),r=o.querySelector(".medium-editor-toolbar-save"),s=o.querySelector(".medium-editor-toolbar-input");this.on(o,"click",this.handleFormClick.bind(this)),this.on(s,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(r,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var o=this.document,i=o.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(o){if(o.keyCode===e.util.keyCode.ENTER){o.preventDefault(),this.doFormSave();return}o.keyCode===e.util.keyCode.ESCAPE&&(o.preventDefault(),this.doFormCancel())},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t})(),(function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var o=this.document.createElement("div");return o.id="medium-editor-anchor-preview-"+this.getEditorId(),o.className="medium-editor-anchor-preview",o.innerHTML=this.getTemplate(),this.on(o,"click",this.handleClick.bind(this)),o},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(o){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||o.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=o.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=o.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=o,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(o){o=o||this.activeAnchor;var i=this.window.innerWidth,r=this.anchorPreview.offsetHeight,s=o.getBoundingClientRect(),a=this.diffLeft,l=this.diffTop,u=this.getEditorOption("elementsContainer"),c=["absolute","fixed"].indexOf(window.getComputedStyle(u).getPropertyValue("position"))>-1,f={},p,h,v,_,m;p=this.anchorPreview.offsetWidth/2;var g=this.base.getExtensionByName("toolbar");g&&(a=g.diffLeft,l=g.diffTop),h=a-p,c?(_=u.getBoundingClientRect(),["top","left"].forEach(function(b){f[b]=s[b]-_[b]}),f.width=s.width,f.height=s.height,s=f,i=_.width,m=u.scrollTop):m=this.window.pageYOffset,v=s.left+s.width/2,m+=r+s.top+s.height-l-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(m)+"px",this.anchorPreview.style.right="initial",v<p?(this.anchorPreview.style.left=h+p+"px",this.anchorPreview.style.right="initial"):i-v<p?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=h+v+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(o){var i=this.base.getExtensionByName("anchor"),r=this.activeAnchor;i&&r&&(o.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(r){var s={value:r.attributes.href.value,target:r.getAttribute("target"),buttonClass:r.getAttribute("class")};i.showForm(s),r=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(o){var i=e.util.getClosestTag(o.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(o){(!o.relatedTarget||!/anchor-preview/.test(o.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var o=new Date().getTime()-this.lastOver;o>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t})(),(function(){var t,o,i,r,s;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],o="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+o+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+o+"))",r=new RegExp("^("+o+")$","i"),s=new RegExp(i,"gi");function a(u){return!e.util.getClosestTag(u,"a")}var l=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var u=0,c=0;c<this.window._mediumEditors.length;c++){var f=this.window._mediumEditors[c];f!==null&&f.getExtensionByName("autoLink")!==void 0&&u++}return u===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(u,c){this.performLinking(c)},onKeypress:function(u){this.disableEventHandling||e.util.isKey(u,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var c=this.base.exportSelection();this.performLinking(u.target)&&this.base.importSelection(c,!0)}catch(f){window.console&&window.console.error("Failed to perform linking",f),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(u){var c=e.util.splitByBlockElements(u),f=!1;c.length===0&&(c=[u]);for(var p=0;p<c.length;p++)f=this.removeObsoleteAutoLinkSpans(c[p])||f,f=this.performLinkingWithinElement(c[p])||f;return this.base.events.updateInput(u,{target:u,currentTarget:u}),f},removeObsoleteAutoLinkSpans:function(u){if(!u||u.nodeType===3)return!1;for(var c=u.querySelectorAll('span[data-auto-link="true"]'),f=!1,p=0;p<c.length;p++){var h=c[p].textContent;if(h.indexOf("://")===-1&&(h=e.util.ensureUrlHasProtocol(h)),c[p].getAttribute("data-href")!==h&&a(c[p])){f=!0;var v=h.replace(/\s+$/,"");if(c[p].getAttribute("data-href")===v){var _=h.length-v.length,m=e.util.splitOffDOMTree(c[p],this.splitTextBeforeEnd(c[p],_));c[p].parentNode.insertBefore(m,c[p].nextSibling)}else e.util.unwrap(c[p],this.document)}}return f},splitTextBeforeEnd:function(u,c){for(var f=this.document.createTreeWalker(u,NodeFilter.SHOW_TEXT,null,!1),p=!0;p;)p=f.lastChild()!==null;for(var h,v,_;c>0&&_!==null;)h=f.currentNode,v=h.nodeValue,v.length>c?(_=h.splitText(v.length-c),c=0):(_=f.previousNode(),c-=v.length);return _},performLinkingWithinElement:function(u){for(var c=this.findLinkableText(u),f=!1,p=0;p<c.length;p++){var h=e.util.findOrCreateMatchingTextNodes(this.document,u,c[p]);this.shouldNotLink(h)||this.createAutoLink(h,c[p].href)}return f},shouldNotLink:function(u){for(var c=!1,f=0;f<u.length&&c===!1;f++)c=!!e.util.traverseUp(u[f],function(p){return p.nodeName.toLowerCase()==="a"||p.getAttribute&&p.getAttribute("data-auto-link")==="true"});return c},findLinkableText:function(u){for(var c=u.textContent,f=null,p=[];(f=s.exec(c))!==null;){var h=!0,v=f.index+f[0].length;h=(f.index===0||t.indexOf(c[f.index-1])!==-1)&&(v===c.length||t.indexOf(c[v])!==-1),h=h&&(f[0].indexOf("/")!==-1||r.test(f[0].split(".").pop().split("?").shift())),h&&p.push({href:f[0],start:f.index,end:v})}return p},createAutoLink:function(u,c){c=e.util.ensureUrlHasProtocol(c);var f=e.util.createLink(this.document,u,c,this.getEditorOption("targetBlank")?"_blank":null),p=this.document.createElement("span");for(p.setAttribute("data-auto-link","true"),p.setAttribute("data-href",c),f.insertBefore(p,f.firstChild);f.childNodes.length>1;)p.appendChild(f.childNodes[1])}});e.extensions.autoLink=l})(),(function(){var t="medium-editor-dragover";function o(r){var s=e.util.getContainerEditorElement(r),a=Array.prototype.slice.call(s.parentElement.querySelectorAll("."+t));a.forEach(function(l){l.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(r){r.preventDefault(),r.dataTransfer.dropEffect="copy";var s=r.target.classList?r.target:r.target.parentElement;o(s),r.type==="dragover"&&s.classList.add(t)},handleDrop:function(r){r.preventDefault(),r.stopPropagation(),this.base.selectElement(r.target);var s=this.base.exportSelection();s.start=s.end,this.base.importSelection(s),r.dataTransfer.files&&Array.prototype.slice.call(r.dataTransfer.files).forEach(function(a){this.isAllowedFile(a)&&a.type.match("image")&&this.insertImageFile(a)},this),o(r.target)},isAllowedFile:function(r){return this.allowedTypes.some(function(s){return!!r.type.match(s)})},insertImageFile:function(r){if(typeof FileReader=="function"){var s=new FileReader;s.readAsDataURL(r),s.addEventListener("load",(function(a){var l=this.document.createElement("img");l.src=a.target.result,e.util.insertHTMLCommand(this.document,l.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i})(),(function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(o){var i=o.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(o)},this)},handleKeydown:function(o){var i=e.util.getKeyCode(o);if(this.keys[i]){var r=e.util.isMetaCtrlKey(o),s=!!o.shiftKey,a=!!o.altKey;this.keys[i].forEach(function(l){l.meta===r&&l.shift===s&&(l.alt===a||l.alt===void 0)&&(o.preventDefault(),o.stopPropagation(),typeof l.command=="function"?l.command.apply(this):l.command!==!1&&this.execAction(l.command))},this)}}});e.extensions.keyboardCommands=t})(),(function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(o){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("select"),s=o.createElement("a"),a=o.createElement("a"),l;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var u=0;u<this.fonts.length;u++)l=o.createElement("option"),l.innerHTML=this.fonts[u],l.value=this.fonts[u],r.appendChild(l);return r.className="medium-editor-toolbar-select",i.appendChild(r),this.on(r,"change",this.handleFontChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("face")&&o.removeAttribute("face")})},handleFontChange:function(){var o=this.getSelect().value;o===""?this.clearFontName():this.execAction("fontName",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t})(),(function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(o){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("input"),s=o.createElement("a"),a=o.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),r.setAttribute("type","range"),r.setAttribute("min","1"),r.setAttribute("max","7"),r.className="medium-editor-toolbar-input",i.appendChild(r),this.on(r,"change",this.handleSliderChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("size")&&o.removeAttribute("size")})},handleSliderChange:function(){var o=this.getInput().value;o==="4"?this.clearFontSize():this.execAction("fontSize",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t})(),(function(){var t="%ME_PASTEBIN%",o=null,i=null,r=function(u){u.stopPropagation()};function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function a(u,c,f){var p=u.clipboardData||c.clipboardData||f.dataTransfer,h={};if(!p)return h;if(p.getData){var v=p.getData("Text");v&&v.length>0&&(h["text/plain"]=v)}if(p.types)for(var _=0;_<p.types.length;_++){var m=p.types[_];h[m]=p.getData(m)}return h}var l=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(u){this.on(u,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(u,c){this.on(c,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(u,c){if(!u.defaultPrevented){var f=a(u,this.window,this.document),p=f["text/html"],h=f["text/plain"];this.window.clipboardData&&u.clipboardData===void 0&&!p&&(p=h),(p||h)&&(u.preventDefault(),this.doPaste(p,h,c))}},doPaste:function(u,c,f){var p,h="",v;if(this.cleanPastedHTML&&u)return this.cleanPaste(u);if(c){if(this.getEditorOption("disableReturn")||f&&f.getAttribute("data-disable-return"))h=e.util.htmlEntities(c);else if(p=c.split(/[\r\n]+/g),p.length>1)for(v=0;v<p.length;v+=1)p[v]!==""&&(h+="<p>"+e.util.htmlEntities(p[v])+"</p>");else h=e.util.htmlEntities(p[0]);e.util.insertHTMLCommand(this.document,h)}},handlePasteBinPaste:function(u){if(u.defaultPrevented){this.removePasteBin();return}var c=a(u,this.window,this.document),f=c["text/html"],p=c["text/plain"],h=i;if(!this.cleanPastedHTML||f){u.preventDefault(),this.removePasteBin(),this.doPaste(f,p,h),this.trigger("editablePaste",{currentTarget:h,target:h},h);return}setTimeout((function(){this.cleanPastedHTML&&(f=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(f,p,h),this.trigger("editablePaste",{currentTarget:h,target:h},h)}).bind(this),0)},handleKeydown:function(u,c){e.util.isKey(u,e.util.keyCode.V)&&e.util.isMetaCtrlKey(u)&&(u.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(c))},createPasteBin:function(u){var c,f=e.selection.getSelectionRange(this.document),p=this.window.pageYOffset;i=u,f&&(c=f.getClientRects(),c.length?p+=c[0].top:f.startContainer.getBoundingClientRect!==void 0?p+=f.startContainer.getBoundingClientRect().top:p+=f.getBoundingClientRect().top),o=f;var h=this.document.createElement("div");h.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),h.setAttribute("style","border: 1px red solid; position: absolute; top: "+p+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),h.setAttribute("contentEditable",!0),h.innerHTML=t,this.document.body.appendChild(h),this.on(h,"focus",r),this.on(h,"focusin",r),this.on(h,"focusout",r),h.focus(),e.selection.selectNode(h,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(h,"paste",this.boundHandlePaste)},removePasteBin:function(){o!==null&&(e.selection.selectRange(this.document,o),o=null),i!==null&&(i=null);var u=this.getPasteBin();u&&u&&(this.off(u,"focus",r),this.off(u,"focusin",r),this.off(u,"focusout",r),this.off(u,"paste",this.boundHandlePaste),u.parentElement.removeChild(u))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var u=this.getPasteBin();if(!u||u.firstChild&&u.firstChild.id==="mcepastebin")return!1;var c=u.innerHTML;return!c||c===t?!1:c},cleanPaste:function(u){var c,f,p,h,v=/<p|<br|<div/.test(u),_=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(c=0;c<_.length;c+=1)u=u.replace(_[c][0],_[c][1]);if(!v)return this.pasteHTML(u);for(p=this.document.createElement("div"),p.innerHTML="<p>"+u.split("<br><br>").join("</p><p>")+"</p>",f=p.querySelectorAll("a,p,div,br"),c=0;c<f.length;c+=1)switch(h=f[c],h.innerHTML=h.innerHTML.replace(/\n/gi," "),h.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(h);break;case"br":this.filterLineBreak(h);break}this.pasteHTML(p.innerHTML)},pasteHTML:function(u,c){c=e.util.defaults({},c,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var f,p,h,v,_=this.document.createDocumentFragment();for(_.appendChild(this.document.createElement("body")),v=_.querySelector("body"),v.innerHTML=u,this.cleanupSpans(v),f=v.querySelectorAll("*"),h=0;h<f.length;h+=1)p=f[h],p.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(p),e.util.cleanupAttrs(p,c.cleanAttrs),e.util.cleanupTags(p,c.cleanTags),e.util.unwrapTags(p,c.unwrapTags);e.util.insertHTMLCommand(this.document,v.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(u){return u&&(u.nodeName.toLowerCase()==="p"||u.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(u){/^\s*$/.test(u.textContent)&&u.parentNode&&u.parentNode.removeChild(u)},filterLineBreak:function(u){this.isCommonBlock(u.previousElementSibling)?this.removeWithParent(u):this.isCommonBlock(u.parentNode)&&(u.parentNode.firstChild===u||u.parentNode.lastChild===u)?this.removeWithParent(u):u.parentNode&&u.parentNode.childElementCount===1&&u.parentNode.textContent===""&&this.removeWithParent(u)},removeWithParent:function(u){u&&u.parentNode&&(u.parentNode.parentNode&&u.parentNode.childElementCount===1?u.parentNode.parentNode.removeChild(u.parentNode):u.parentNode.removeChild(u))},cleanupSpans:function(u){var c,f,p,h=u.querySelectorAll(".replace-with"),v=function(_){return _&&_.nodeName!=="#text"&&_.getAttribute("contenteditable")==="false"};for(c=0;c<h.length;c+=1)f=h[c],p=this.document.createElement(f.classList.contains("bold")?"b":"i"),f.classList.contains("bold")&&f.classList.contains("italic")?p.innerHTML="<i>"+f.innerHTML+"</i>":p.innerHTML=f.innerHTML,f.parentNode.replaceChild(p,f);for(h=u.querySelectorAll("span"),c=0;c<h.length;c+=1){if(f=h[c],e.util.traverseUp(f,v))return!1;e.util.unwrap(f,this.document)}}});e.extensions.paste=l})(),(function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(o,i){this.initElement(i)},initElement:function(o){o.getAttribute("data-placeholder")||o.setAttribute("data-placeholder",this.text),this.updatePlaceholder(o)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(o,i){this.cleanupElement(i)},cleanupElement:function(o){o.getAttribute("data-placeholder")===this.text&&o.removeAttribute("data-placeholder")},showPlaceholder:function(o){o&&(e.util.isFF&&o.childNodes.length===0?(o.classList.add("medium-editor-placeholder-relative"),o.classList.remove("medium-editor-placeholder")):(o.classList.add("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(o){o&&(o.classList.remove("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(o,i){if(o.querySelector("img, blockquote, ul, ol, table")||o.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(o);i||this.showPlaceholder(o)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(o,i){var r=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,r)},handleFocus:function(o,i){this.hidePlaceholder(i)},handleBlur:function(o,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t})(),(function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(o,i){return this.base.extensions.forEach(function(r){if(r!==this)return o.apply(i||this,arguments)},this)},createToolbar:function(){var o=this.document.createElement("div");return o.id="medium-editor-toolbar-"+this.getEditorId(),o.className="medium-editor-toolbar",this.static?o.className+=" static-toolbar":this.relativeContainer?o.className+=" medium-editor-relative-toolbar":o.className+=" medium-editor-stalker-toolbar",o.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&o.appendChild(i.getForm())}),this.attachEventHandlers(),o},createToolbarButtons:function(){var o=this.document.createElement("ul"),i,r,s,a,l,u;return o.id="medium-editor-toolbar-actions"+this.getEditorId(),o.className="medium-editor-toolbar-actions",o.style.display="block",this.buttons.forEach(function(c){typeof c=="string"?(l=c,u=null):(l=c.name,u=c),a=this.base.addBuiltInExtension(l,u),a&&typeof a.getButton=="function"&&(r=a.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(r)?i.appendChild(r):i.innerHTML=r,o.appendChild(i))},this),s=o.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),o},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(o){if(o&&o.target&&e.util.isDescendant(this.getToolbarElement(),o.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(o){o.hasForm&&o.isDisplayed()&&o.hideForm()})},multipleBlockElementsSelected:function(){var o=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),r=e.selection.getSelectionHtml(this.document).replace(o,""),s=r.match(i);return!!s&&s.length>1},modifySelection:function(){var o=this.window.getSelection(),i=o.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var r=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(r){for(var s=0;r.nodeValue.substr(s,1).trim().length===0;)s=s+1;i=e.selection.select(this.document,r,s,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var o=e.selection.getSelectionElement(this.window);if(!o||this.getEditorElements().indexOf(o)===-1||o.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(o){typeof o.isActive=="function"&&typeof o.setInactive=="function"&&o.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var o=[],i=null,r=e.selection.getSelectionRange(this.document),s,a=function(l){typeof l.checkState=="function"?l.checkState(s):typeof l.isActive=="function"&&typeof l.isAlreadyApplied=="function"&&typeof l.setActive=="function"&&!l.isActive()&&l.isAlreadyApplied(s)&&l.setActive()};if(r&&(this.forEachExtension(function(l){if(typeof l.queryCommandState=="function"&&(i=l.queryCommandState(),i!==null)){i&&typeof l.setActive=="function"&&l.setActive();return}o.push(l)}),s=e.selection.getSelectedParentElement(r),!!this.getEditorElements().some(function(l){return e.util.isDescendant(l,s,!0)})))for(;s&&(o.forEach(a),!e.util.isMediumEditorElement(s));)s=s.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var o=this.base.getFocusedElement(),i=this.window.getSelection();if(!o)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(o):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(o){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,r=this.window.innerWidth,s=this.getToolbarElement(),a=o.getBoundingClientRect(),l=a.top+i,u=a.left+a.width/2,c=s.offsetHeight,f=s.offsetWidth,p=f/2,h;switch(this.sticky?i>l+o.offsetHeight-c-this.stickyTopOffset?(s.style.top=l+o.offsetHeight-c+"px",s.classList.remove("medium-editor-sticky-toolbar")):i>l-c-this.stickyTopOffset?(s.classList.add("medium-editor-sticky-toolbar"),s.style.top=this.stickyTopOffset+"px"):(s.classList.remove("medium-editor-sticky-toolbar"),s.style.top=l-c+"px"):s.style.top=l-c+"px",this.align){case"left":h=a.left;break;case"right":h=a.right-f;break;case"center":h=u-p;break}h<0?h=0:h+f>r&&(h=r-Math.ceil(f)-1),s.style.left=h+"px"},positionToolbar:function(o){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=o.getRangeAt(0),r=i.getBoundingClientRect();(!r||r.height===0&&r.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?r=i.startContainer.querySelector("img").getBoundingClientRect():r=i.startContainer.getBoundingClientRect());var s=this.window.innerWidth,a=this.getToolbarElement(),l=a.offsetHeight,u=a.offsetWidth,c=u/2,f=50,p=this.diffLeft-c,h=this.getEditorOption("elementsContainer"),v=["absolute","fixed"].indexOf(window.getComputedStyle(h).getPropertyValue("position"))>-1,_={},m={},g,b;v?(b=h.getBoundingClientRect(),["top","left"].forEach(function(C){m[C]=r[C]-b[C]}),m.width=r.width,m.height=r.height,r=m,s=b.width,_.top=h.scrollTop):_.top=this.window.pageYOffset,g=r.left+r.width/2,_.top+=r.top-l,r.top<f?(a.classList.add("medium-toolbar-arrow-over"),a.classList.remove("medium-toolbar-arrow-under"),_.top+=f+r.height-this.diffTop):(a.classList.add("medium-toolbar-arrow-under"),a.classList.remove("medium-toolbar-arrow-over"),_.top+=this.diffTop),g<c?(_.left=p+c,_.right="initial"):s-g<c?(_.left="auto",_.right=0):(_.left=p+g,_.right="initial"),["top","left","right"].forEach(function(C){a.style[C]=_[C]+(isNaN(_[C])?"":"px")})}});e.extensions.toolbar=t})(),(function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){var i="medium-editor-dragover";o.preventDefault(),o.dataTransfer.dropEffect="copy",o.type==="dragover"?o.target.classList.add(i):o.type==="dragleave"&&o.target.classList.remove(i)},handleDrop:function(o){var i="medium-editor-dragover",r;o.preventDefault(),o.stopPropagation(),o.dataTransfer.files&&(r=Array.prototype.slice.call(o.dataTransfer.files,0),r.some((function(s){if(s.type.match("image")){var a,l;a=new FileReader,a.readAsDataURL(s),l="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+l+'" />'),a.onload=(function(){var u=this.document.getElementById(l);u&&(u.removeAttribute("id"),u.removeAttribute("class"),u.src=a.result)}).bind(this)}}).bind(this))),o.target.classList.remove(i)}});e.extensions.imageDragging=t})(),(function(){function t(E){var A=e.selection.getSelectionStart(this.options.ownerDocument),M=A.textContent,F=e.selection.getCaretOffsets(A);(M[F.left-1]===void 0||M[F.left-1].trim()===""||M[F.left]!==void 0&&M[F.left].trim()==="")&&E.preventDefault()}function o(E,A){if(this.options.disableReturn||A.getAttribute("data-disable-return"))E.preventDefault();else if(this.options.disableDoubleReturn||A.getAttribute("data-disable-double-return")){var M=e.selection.getSelectionStart(this.options.ownerDocument);(M&&M.textContent.trim()===""&&M.nodeName.toLowerCase()!=="li"||M.previousElementSibling&&M.previousElementSibling.nodeName.toLowerCase()!=="br"&&M.previousElementSibling.textContent.trim()==="")&&E.preventDefault()}}function i(E){var A=e.selection.getSelectionStart(this.options.ownerDocument),M=A&&A.nodeName.toLowerCase();M==="pre"&&(E.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(A)&&(E.preventDefault(),E.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function r(E){var A,M=e.selection.getSelectionStart(this.options.ownerDocument),F=M.nodeName.toLowerCase(),H=/^(\s+|<br\/?>)?$/i,R=/h\d/i;e.util.isKey(E,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&M.previousElementSibling&&R.test(F)&&e.selection.getCaretOffsets(M).left===0?e.util.isKey(E,e.util.keyCode.BACKSPACE)&&H.test(M.previousElementSibling.innerHTML)?(M.previousElementSibling.parentNode.removeChild(M.previousElementSibling),E.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(E,e.util.keyCode.ENTER)&&(A=this.options.ownerDocument.createElement("p"),A.innerHTML="<br>",M.previousElementSibling.parentNode.insertBefore(A,M),E.preventDefault()):e.util.isKey(E,e.util.keyCode.DELETE)&&M.nextElementSibling&&M.previousElementSibling&&!R.test(F)&&H.test(M.innerHTML)&&R.test(M.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,M.nextElementSibling),M.previousElementSibling.parentNode.removeChild(M),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&F==="li"&&H.test(M.innerHTML)&&!M.previousElementSibling&&!M.parentElement.previousElementSibling&&M.nextElementSibling&&M.nextElementSibling.nodeName.toLowerCase()==="li"?(A=this.options.ownerDocument.createElement("p"),A.innerHTML="<br>",M.parentElement.parentElement.insertBefore(A,M.parentElement),e.selection.moveCursor(this.options.ownerDocument,A),M.parentElement.removeChild(M),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(M,"blockquote")!==!1&&e.selection.getCaretOffsets(M).left===0?(E.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(E,e.util.keyCode.ENTER)&&e.util.getClosestTag(M,"blockquote")!==!1&&e.selection.getCaretOffsets(M).right===0?(A=this.options.ownerDocument.createElement("p"),A.innerHTML="<br>",M.parentElement.insertBefore(A,M.nextSibling),e.selection.moveCursor(this.options.ownerDocument,A),E.preventDefault()):e.util.isKey(E,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(M.parentElement)&&!M.previousElementSibling&&M.nextElementSibling&&H.test(M.innerHTML)&&(E.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,M.nextSibling),M.parentElement.removeChild(M))}function s(E){var A=e.selection.getSelectionStart(this.options.ownerDocument),M;A&&(e.util.isMediumEditorElement(A)&&A.children.length===0&&!e.util.isBlockContainer(A)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(E,e.util.keyCode.ENTER)&&!e.util.isListItem(A)&&!e.util.isBlockContainer(A)&&(M=A.nodeName.toLowerCase(),M==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!E.shiftKey&&!E.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function a(E,A){var M=A.parentNode.querySelector('textarea[medium-editor-textarea-id="'+A.getAttribute("medium-editor-textarea-id")+'"]');M&&(M.value=A.innerHTML.trim())}function l(E){E._mediumEditors||(E._mediumEditors=[null]),this.id||(this.id=E._mediumEditors.length),E._mediumEditors[this.id]=this}function u(E){!E._mediumEditors||!E._mediumEditors[this.id]||(E._mediumEditors[this.id]=null)}function c(E,A,M){var F=[];if(E||(E=[]),typeof E=="string"&&(E=A.querySelectorAll(E)),e.util.isElement(E)&&(E=[E]),M)for(var H=0;H<E.length;H++){var R=E[H];e.util.isElement(R)&&!R.getAttribute("data-medium-editor-element")&&!R.getAttribute("medium-editor-textarea-id")&&F.push(R)}else F=Array.prototype.slice.apply(E);return F}function f(E){var A=E.parentNode.querySelector('textarea[medium-editor-textarea-id="'+E.getAttribute("medium-editor-textarea-id")+'"]');A&&(A.classList.remove("medium-editor-hidden"),A.removeAttribute("medium-editor-textarea-id")),E.parentNode&&E.parentNode.removeChild(E)}function p(E,A){return Object.keys(A).forEach(function(M){E[M]===void 0&&(E[M]=A[M])}),E}function h(E,A,M){var F={window:M.options.contentWindow,document:M.options.ownerDocument,base:M};return E=p(E,F),typeof E.init=="function"&&E.init(),E.name||(E.name=A),E}function v(){return this.elements.every(function(E){return!!E.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function _(){return v.call(this)?this.options.anchorPreview!==!1:!1}function m(){return this.options.placeholder!==!1}function g(){return this.options.autoLink!==!1}function b(){return this.options.imageDragging!==!1}function C(){return this.options.keyboardCommands!==!1}function D(){return!this.options.extensions.imageDragging}function T(E){for(var A=this.options.ownerDocument.createElement("div"),M=Date.now(),F="medium-editor-"+M,H=E.attributes;this.options.ownerDocument.getElementById(F);)M++,F="medium-editor-"+M;A.className=E.className,A.id=F,A.innerHTML=E.value,E.setAttribute("medium-editor-textarea-id",F);for(var R=0,G=H.length;R<G;R++)A.hasAttribute(H[R].nodeName)||A.setAttribute(H[R].nodeName,H[R].value);return E.form&&this.on(E.form,"reset",(function(oe){oe.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(F))}).bind(this)),E.classList.add("medium-editor-hidden"),E.parentNode.insertBefore(A,E),A}function O(E,A){if(!E.getAttribute("data-medium-editor-element")){E.nodeName.toLowerCase()==="textarea"&&(E=T.call(this,E),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=a.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!E.getAttribute("data-disable-editing")&&(E.setAttribute("contentEditable",!0),E.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(E.getAttribute("data-disable-return")||E.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!E.getAttribute("data-disable-return")&&this.on(E,"keyup",s.bind(this));var M=e.util.guid();E.setAttribute("data-medium-editor-element",!0),E.classList.add("medium-editor-element"),E.setAttribute("role","textbox"),E.setAttribute("aria-multiline",!0),E.setAttribute("data-medium-editor-editor-index",A),E.setAttribute("medium-editor-index",M),B[M]=E.innerHTML,this.events.attachAllEventsToElement(E)}return E}function k(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",r.bind(this)),this.subscribe("editableKeydownEnter",r.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function S(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(H){H!=="toolbar"&&this.options.extensions[H]&&this.extensions.push(h(this.options.extensions[H],H,this))},this),D.call(this)){var E=this.options.fileDragging;E||(E={},b.call(this)||(E.allowedTypes=[])),this.addBuiltInExtension("fileDragging",E)}var A={paste:!0,"anchor-preview":_.call(this),autoLink:g.call(this),keyboardCommands:C.call(this),placeholder:m.call(this)};Object.keys(A).forEach(function(H){A[H]&&this.addBuiltInExtension(H)},this);var M=this.options.extensions.toolbar;if(!M&&v.call(this)){var F=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});M=new e.extensions.toolbar(F)}M&&this.extensions.push(h(M,"toolbar",this))}function N(E,A){var M=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return A&&M.forEach(function(F){A.hasOwnProperty(F[0])&&A[F[0]]!==void 0&&e.util.deprecated(F[0],F[1],"v6.0.0")}),e.util.defaults({},A,E)}function L(E,A){var M=/^append-(.+)$/gi,F=/justify([A-Za-z]*)$/g,H,R;if(H=M.exec(E),H)return e.util.execFormatBlock(this.options.ownerDocument,H[1]);if(E==="fontSize")return A.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),R=A.value||A.size,this.options.ownerDocument.execCommand("fontSize",!1,R);if(E==="fontName")return A.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),R=A.value||A.name,this.options.ownerDocument.execCommand("fontName",!1,R);if(E==="createLink")return this.createLink(A);if(E==="image"){var G=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,G)}if(E==="html"){var oe=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,oe)}if(F.exec(E)){var V=this.options.ownerDocument.execCommand(E,!1,null),Y=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return Y&&$.call(this,e.util.getTopBlockContainer(Y)),V}return R=A&&A.value,this.options.ownerDocument.execCommand(E,!1,R)}function $(E){if(E){var A,M=Array.prototype.slice.call(E.childNodes).filter(function(F){var H=F.nodeName.toLowerCase()==="div";return H&&!A&&(A=F.style.textAlign),H});M.length&&(this.saveSelection(),M.forEach(function(F){if(F.style.textAlign===A){var H=F.lastChild;if(H){e.util.unwrap(F,this.options.ownerDocument);var R=this.options.ownerDocument.createElement("BR");H.parentNode.insertBefore(R,H.nextSibling)}}},this),E.style.textAlign=A,this.restoreSelection())}}var B={};e.prototype={init:function(E,A){return this.options=N.call(this,this.defaults,A),this.origElements=E,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(l.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,S.call(this),k.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(E){typeof E.destroy=="function"&&E.destroy()},this),this.events.destroy(),this.elements.forEach(function(E){this.options.spellcheck&&(E.innerHTML=E.innerHTML),E.removeAttribute("contentEditable"),E.removeAttribute("spellcheck"),E.removeAttribute("data-medium-editor-element"),E.classList.remove("medium-editor-element"),E.removeAttribute("role"),E.removeAttribute("aria-multiline"),E.removeAttribute("medium-editor-index"),E.removeAttribute("data-medium-editor-editor-index"),E.getAttribute("medium-editor-textarea-id")&&f(E)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,u.call(this,this.options.contentWindow))},on:function(E,A,M,F){return this.events.attachDOMEvent(E,A,M,F),this},off:function(E,A,M,F){return this.events.detachDOMEvent(E,A,M,F),this},subscribe:function(E,A){return this.events.attachCustomEvent(E,A),this},unsubscribe:function(E,A){return this.events.detachCustomEvent(E,A),this},trigger:function(E,A,M){return this.events.triggerCustomEvent(E,A,M),this},delay:function(E){var A=this;return setTimeout(function(){A.isActive&&E()},this.options.delay)},serialize:function(){var E,A,M={},F=this.elements.length;for(E=0;E<F;E+=1)A=this.elements[E].id!==""?this.elements[E].id:"element-"+E,M[A]={value:this.elements[E].innerHTML.trim()};return M},getExtensionByName:function(E){var A;return this.extensions&&this.extensions.length&&this.extensions.some(function(M){return M.name===E?(A=M,!0):!1}),A},addBuiltInExtension:function(E,A){var M=this.getExtensionByName(E),F;if(M)return M;switch(E){case"anchor":F=e.util.extend({},this.options.anchor,A),M=new e.extensions.anchor(F);break;case"anchor-preview":M=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":M=new e.extensions.autoLink;break;case"fileDragging":M=new e.extensions.fileDragging(A);break;case"fontname":M=new e.extensions.fontName(this.options.fontName);break;case"fontsize":M=new e.extensions.fontSize(A);break;case"keyboardCommands":M=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":M=new e.extensions.paste(this.options.paste);break;case"placeholder":M=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(E)&&(A?(F=e.util.defaults({},A,e.extensions.button.prototype.defaults[E]),M=new e.extensions.button(F)):M=new e.extensions.button(E))}return M&&this.extensions.push(h(M,E,this)),M},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var E=this.getExtensionByName("toolbar");return E&&E.checkState(),this},queryCommandState:function(E){var A=/^full-(.+)$/gi,M,F=null;M=A.exec(E),M&&(E=M[1]);try{F=this.options.ownerDocument.queryCommandState(E)}catch{F=null}return F},execAction:function(E,A){var M=/^full-(.+)$/gi,F,H;return F=M.exec(E),F?(this.saveSelection(),this.selectAllContents(),H=L.call(this,F[1],A),this.restoreSelection()):H=L.call(this,E,A),(E==="insertunorderedlist"||E==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),H},getSelectedParentElement:function(E){return E===void 0&&(E=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(E)},selectAllContents:function(){var E=e.selection.getSelectionElement(this.options.contentWindow);if(E){for(;E.children.length===1;)E=E.children[0];this.selectElement(E)}},selectElement:function(E){e.selection.selectNode(E,this.options.ownerDocument);var A=e.selection.getSelectionElement(this.options.contentWindow);A&&this.events.focusElement(A)},getFocusedElement:function(){var E;return this.elements.some(function(A){return!E&&A.getAttribute("data-medium-focused")&&(E=A),!!E},this),E},exportSelection:function(){var E=e.selection.getSelectionElement(this.options.contentWindow),A=this.elements.indexOf(E),M=null;return A>=0&&(M=e.selection.exportSelection(E,this.options.ownerDocument)),M!==null&&A!==0&&(M.editableElementIndex=A),M},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(E,A){if(E){var M=this.elements[E.editableElementIndex||0];e.selection.importSelection(E,M,this.options.ownerDocument,A)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(E){var A=e.selection.getSelectionElement(this.options.contentWindow),M={},F;if(this.elements.indexOf(A)!==-1){try{if(this.events.disableCustomEvent("editableInput"),E.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),F=E.url||E.value,F&&F.trim().length>0){var H=this.options.contentWindow.getSelection();if(H){var R=H.getRangeAt(0),G=R.commonAncestorContainer,oe,V,Y,Q;if(R.endContainer.nodeType===3&&R.startContainer.nodeType!==3&&R.startOffset===0&&R.startContainer.firstChild===R.endContainer&&(G=R.endContainer),V=e.util.getClosestBlockContainer(R.startContainer),Y=e.util.getClosestBlockContainer(R.endContainer),G.nodeType!==3&&G.textContent.length!==0&&V===Y){var ue=V||A,te=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),oe=this.exportSelection(),te.appendChild(ue.cloneNode(!0)),A===ue?e.selection.select(this.options.ownerDocument,ue.firstChild,0,ue.lastChild,ue.lastChild.nodeType===3?ue.lastChild.nodeValue.length:ue.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,ue,0,ue,ue.childNodes.length);var q=this.exportSelection();Q=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,te,{start:oe.start-q.start,end:oe.end-q.start,editableElementIndex:oe.editableElementIndex}),Q.length===0&&(te=this.options.ownerDocument.createDocumentFragment(),te.appendChild(G.cloneNode(!0)),Q=[te.firstChild.firstChild,te.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Q,F.trim());var re=(te.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,te.firstChild.innerHTML.replace(/^\s+/,"")),oe.start-=re,oe.end-=re,this.importSelection(oe)}else this.options.ownerDocument.execCommand("createLink",!1,F);this.options.targetBlank||E.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F),E.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),E.buttonClass)}}if(this.options.targetBlank||E.target==="_blank"||E.buttonClass){M=this.options.ownerDocument.createEvent("HTMLEvents"),M.initEvent("input",!0,!0,this.options.contentWindow);for(var ce=0,ve=this.elements.length;ce<ve;ce+=1)this.elements[ce].dispatchEvent(M)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",M,A)}},cleanPaste:function(E){this.getExtensionByName("paste").cleanPaste(E)},pasteHTML:function(E,A){this.getExtensionByName("paste").pasteHTML(E,A)},setContent:function(E,A){if(A=A||0,this.elements[A]){var M=this.elements[A];M.innerHTML=E,this.checkContentChanged(M)}},getContent:function(E){return E=E||0,this.elements[E]?this.elements[E].innerHTML.trim():null},checkContentChanged:function(E){E=E||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(E,{target:E,currentTarget:E})},resetContent:function(E){if(E){var A=this.elements.indexOf(E);A!==-1&&this.setContent(B[E.getAttribute("medium-editor-index")],A);return}this.elements.forEach(function(M,F){this.setContent(B[M.getAttribute("medium-editor-index")],F)},this)},addElements:function(E){var A=c(E,this.options.ownerDocument,!0);if(A.length===0)return!1;A.forEach(function(M){M=O.call(this,M,this.id),this.elements.push(M),this.trigger("addElement",{target:M,currentTarget:M},M)},this)},removeElements:function(E){var A=c(E,this.options.ownerDocument),M=A.map(function(F){return F.getAttribute("medium-editor-textarea-id")&&F.parentNode?F.parentNode.querySelector('div[medium-editor-textarea-id="'+F.getAttribute("medium-editor-textarea-id")+'"]'):F});this.elements=this.elements.filter(function(F){return M.indexOf(F)!==-1?(this.events.cleanupElement(F),F.getAttribute("medium-editor-textarea-id")&&f(F),this.trigger("removeElement",{target:F,currentTarget:F},F),!1):!0},this)}},e.getEditorFromElement=function(E){var A=E.getAttribute("data-medium-editor-editor-index"),M=E&&E.ownerDocument&&(E.ownerDocument.defaultView||E.ownerDocument.parentWindow);return M&&M._mediumEditors&&M._mediumEditors[A]?M._mediumEditors[A]:null}})(),(function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}})(),e.parseVersionString=function(t){var o=t.split("-"),i=o[0].split("."),r=o.length>1?o[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:r,toString:function(){return[i[0],i[1],i[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e})())})(Pl)),Pl.exports}var lJ=aJ();const Ou=Ms(lJ);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var Bf=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},Lf=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),El=(function(){function n(e,t){var o=[],i=!0,r=!1,s=void 0;try{for(var a=e[Symbol.iterator](),l;!(i=(l=a.next()).done)&&(o.push(l.value),!(t&&o.length===t));i=!0);}catch(u){r=!0,s=u}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return o}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})();String.prototype.startsWith=String.prototype.startsWith||function(n){return this.indexOf(n)===0};String.prototype.padStart=String.prototype.padStart||function(n,e){for(var t=this;t.length<n;)t=e+t;return t};var uJ={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Iv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?n.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):n.toString();return t||"0"}var dJ=(function(){function n(e,t,o,i){Bf(this,n);var r=this;function s(l){if(l.startsWith("hsl")){var u=l.match(/([\-\d\.e]+)/g).map(Number),c=El(u,4),f=c[0],p=c[1],h=c[2],v=c[3];v===void 0&&(v=1),f/=360,p/=100,h/=100,r.hsla=[f,p,h,v]}else if(l.startsWith("rgb")){var _=l.match(/([\-\d\.e]+)/g).map(Number),m=El(_,4),g=m[0],b=m[1],C=m[2],D=m[3];D===void 0&&(D=1),r.rgba=[g,b,C,D]}else l.startsWith("#")?r.rgba=n.hexToRgb(l):r.rgba=n.nameToRgb(l)||n.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(o===void 0){var a=e&&""+e;a&&s(a.toLowerCase())}else this.rgba=[e,t,o,i===void 0?1:i]}return Lf(n,[{key:"printRGB",value:function(t){var o=t?this.rgba:this.rgba.slice(0,3),i=o.map(function(r,s){return Iv(r,s===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var o=[360,100,100,1],i=["","%","%",""],r=t?this.hsla:this.hsla.slice(0,3),s=r.map(function(a,l){return Iv(a*o[l],l===3?3:1)+i[l]});return t?"hsla("+s+")":"hsl("+s+")"}},{key:"printHex",value:function(t){var o=this.hex;return t?o:o.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=n.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=n.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,o=t.map(function(i,r){return r<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+o.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=n.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var o=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!o.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=o.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(r){return parseInt(r,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var o=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=uJ[o];return i===void 0?i:n.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var o=El(t,4),i=o[0],r=o[1],s=o[2],a=o[3];i/=255,r/=255,s/=255;var l=Math.max(i,r,s),u=Math.min(i,r,s),c=void 0,f=void 0,p=(l+u)/2;if(l===u)c=f=0;else{var h=l-u;switch(f=p>.5?h/(2-l-u):h/(l+u),l){case i:c=(r-s)/h+(r<s?6:0);break;case r:c=(s-i)/h+2;break;case s:c=(i-r)/h+4;break}c/=6}return[c,f,p,a]}},{key:"hslToRgb",value:function(t){var o=El(t,4),i=o[0],r=o[1],s=o[2],a=o[3],l=void 0,u=void 0,c=void 0;if(r===0)l=u=c=s;else{var f=function(m,g,b){return b<0&&(b+=1),b>1&&(b-=1),b<.16666666666666666?m+(g-m)*6*b:b<.5?g:b<.6666666666666666?m+(g-m)*(.6666666666666666-b)*6:m},p=s<.5?s*(1+r):s+r-s*r,h=2*s-p;l=f(h,p,i+1/3),u=f(h,p,i),c=f(h,p,i-1/3)}var v=[l*255,u*255,c*255].map(Math.round);return v[3]=a,v}}]),n})(),cJ=(function(){function n(){Bf(this,n),this._events=[]}return Lf(n,[{key:"add",value:function(t,o,i){t.addEventListener(o,i,!1),this._events.push({target:t,type:o,handler:i})}},{key:"remove",value:function(t,o,i){this._events=this._events.filter(function(r){var s=!0;return t&&t!==r.target&&(s=!1),o&&o!==r.type&&(s=!1),i&&i!==r.handler&&(s=!1),s&&n._doRemove(r.target,r.type,r.handler),!s})}},{key:"destroy",value:function(){this._events.forEach(function(t){return n._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,o,i){t.removeEventListener(o,i,!1)}}]),n})();function fJ(n){var e=document.createElement("div");return e.innerHTML=n,e.firstElementChild}function $d(n,e,t){var o=!1;function i(l,u,c){return Math.max(u,Math.min(l,c))}function r(l,u,c){if(c&&(o=!0),!!o){l.preventDefault();var f=e.getBoundingClientRect(),p=f.width,h=f.height,v=u.clientX,_=u.clientY,m=i(v-f.left,0,p),g=i(_-f.top,0,h);t(m/p,g/h)}}function s(l,u){var c=l.buttons===void 0?l.which:l.buttons;c===1?r(l,l,u):o=!1}function a(l,u){l.touches.length===1?r(l,l.touches[0],u):o=!1}n.add(e,"mousedown",function(l){s(l,!0)}),n.add(e,"touchstart",function(l){a(l,!0)}),n.add(window,"mousemove",s),n.add(e,"touchmove",a),n.add(window,"mouseup",function(l){o=!1}),n.add(e,"touchend",function(l){o=!1}),n.add(e,"touchcancel",function(l){o=!1})}var pJ=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,hJ=360,wm="keydown",Dl="mousedown",Pd="focusin";function li(n,e){return(e||document).querySelector(n)}function vJ(n){n.preventDefault(),n.stopPropagation()}function Rd(n,e,t,o,i){n.add(e,wm,function(r){t.indexOf(r.key)>=0&&o(r)})}var Cm=(function(){function n(e){Bf(this,n),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new cJ,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return Lf(n,[{key:"setOptions",value:function(t){var o=this;if(!t)return;var i=this.settings;function r(u,c,f){for(var p in u)c[p]=u[p]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),r(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var s=t.color||t.colour;s&&this._setColor(s)}var a=i.parent;if(a&&i.popup&&!this._popupInited){var l=function(c){return o.openHandler(c)};this._events.add(a,"click",l),Rd(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var o=t&&t.type===wm?this._domEdit:this.domElement;setTimeout(function(){return o.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var o=t&&t.type,i=!1;if(!t)i=!0;else if(o===Dl||o===Pd){var r=(this.__containedEvent||0)+100;t.timeStamp>r&&(i=!0)}else vJ(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",o!==Dl&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,o){this.closeHandler(),this.setOptions(t),o&&this.openHandler()}},{key:"setColor",value:function(t,o){this._setColor(t,{silent:o})}},{key:"_setColor",value:function(t,o){if(typeof t=="string"&&(t=t.trim()),!!t){o=o||{};var i=void 0;try{i=new dJ(t)}catch(s){if(o.failSilently)return;throw s}if(!this.settings.alpha){var r=i.hsla;r[3]=1,i.hsla=r}this.colour=this.color=i,this._setHSLA(null,null,null,null,o)}}},{key:"setColour",value:function(t,o){this.setColor(t,o)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var o=this._toggleDOM(!0);return this._setPosition(),o}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',r=fJ(i);return this.domElement=r,this._domH=li(".picker_hue",r),this._domSL=li(".picker_sl",r),this._domA=li(".picker_alpha",r),this._domEdit=li(".picker_editor input",r),this._domSample=li(".picker_sample",r),this._domOkay=li(".picker_done button",r),this._domCancel=li(".picker_cancel button",r),r.classList.add("layout_"+this.settings.layout),this.settings.alpha||r.classList.add("no_alpha"),this.settings.editor||r.classList.add("no_editor"),this.settings.cancelButton||r.classList.add("no_cancel"),this._ifPopup(function(){return r.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,o=this,i=this.domElement,r=this._events;function s(u,c,f){r.add(u,c,f)}s(i,"click",function(u){return u.preventDefault()}),$d(r,this._domH,function(u,c){return o._setHSLA(u)}),$d(r,this._domSL,function(u,c){return o._setHSLA(null,u,1-c)}),this.settings.alpha&&$d(r,this._domA,function(u,c){return o._setHSLA(null,null,null,1-c)});var a=this._domEdit;s(a,"input",function(u){o._setColor(this.value,{fromEditor:!0,failSilently:!0})}),s(a,"focus",function(u){var c=this;c.selectionStart===c.selectionEnd&&c.select()}),this._ifPopup(function(){var u=function(p){return t.closeHandler(p)};s(window,Dl,u),s(window,Pd,u),Rd(r,i,["Esc","Escape"],u);var c=function(p){t.__containedEvent=p.timeStamp};s(i,Dl,c),s(i,Pd,c),s(t._domCancel,"click",u)});var l=function(c){t._ifPopup(function(){return t.closeHandler(c)}),t.onDone&&t.onDone(t.colour)};s(this._domOkay,"click",l),Rd(r,i,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,o=this.domElement;t!==o.parentNode&&t.appendChild(o),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var r=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(s){s===r?o.classList.add(s):o.classList.remove(s)}),o.classList.add(r)})}},{key:"_setHSLA",value:function(t,o,i,r,s){s=s||{};var a=this.colour,l=a.hsla;[t,o,i,r].forEach(function(u,c){(u||u===0)&&(l[c]=u)}),a.hsla=l,this._updateUI(s),this.onChange&&!s.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var o=this.colour,i=o.hsla,r="hsl("+i[0]*hJ+", 100%, 50%)",s=o.hslString,a=o.hslaString,l=this._domH,u=this._domSL,c=this._domA,f=li(".picker_selector",l),p=li(".picker_selector",u),h=li(".picker_selector",c);function v(O,k,S){k.style.left=S*100+"%"}function _(O,k,S){k.style.top=S*100+"%"}v(l,f,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=r,v(u,p,i[1]),_(u,p,1-i[2]),u.style.color=s,_(c,h,1-i[3]);var m=s,g=m.replace("hsl","hsla").replace(")",", 0)"),b="linear-gradient("+[m,g]+")";if(this._domA.style.background=b+", "+pJ,!t.fromEditor){var C=this.settings.editorFormat,D=this.settings.alpha,T=void 0;switch(C){case"rgb":T=o.printRGB(D);break;case"hsl":T=o.printHSL(D);break;default:T=o.printHex(D)}this._domEdit.value=T}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,o){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):o&&o()}},{key:"_toggleDOM",value:function(t){var o=this.domElement;if(!o)return!1;var i=t?"":"none",r=o.style.display!==i;return r&&(o.style.display=i),r}}]),n})();{var Bd=document.createElement("style");Bd.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(Bd),Cm.StyleElement=Bd}var Ld={exports:{}},Fv;function Sm(){return Fv||(Fv=1,(function(n,e){(function(t,o){n.exports=t()})(function(){var t="object",o="function",i="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function u(q,re){var ce=typeof q[re];return ce==o||!!(ce==t&&q[re])||ce=="unknown"}function c(q,re){return!!(typeof q[re]==t&&q[re])}function f(q,re){return typeof q[re]!=i}function p(q){return function(re,ce){for(var ve=ce.length;ve--;)if(!q(re,ce[ve]))return!1;return!0}}var h=p(u),v=p(c),_=p(f);function m(q){return q&&h(q,l)&&_(q,a)}function g(q){return c(q,"body")?q.body:q.getElementsByTagName("body")[0]}var b=[].forEach?function(q,re){q.forEach(re)}:function(q,re){for(var ce=0,ve=q.length;ce<ve;++ce)re(q[ce],ce)},C={},D=typeof window!=i&&typeof document!=i,T={isHostMethod:u,isHostObject:c,isHostProperty:f,areHostMethods:h,areHostObjects:v,areHostProperties:_,isTextRange:m,getBody:g,forEach:b},O={version:"1.3.2",initialized:!1,isBrowser:D,supported:!0,util:T,features:{},modules:C,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function k(q){typeof console!=i&&u(console,"log")}function S(q,re){D&&re?alert(q):k(q)}function N(q){O.initialized=!0,O.supported=!1,S("Rangy is not supported in this environment. Reason: "+q,O.config.alertOnFail)}O.fail=N;function L(q){S("Rangy warning: "+q,O.config.alertOnWarn)}O.warn=L;var $;({}).hasOwnProperty?(T.extend=$=function(q,re,ce){var ve,Ne;for(var ge in re)ge==="__proto__"||ge==="constructor"||ge==="prototype"||re.hasOwnProperty(ge)&&(ve=q[ge],Ne=re[ge],ce&&ve!==null&&typeof ve=="object"&&Ne!==null&&typeof Ne=="object"&&$(ve,Ne,!0),q[ge]=Ne);return re.hasOwnProperty("toString")&&(q.toString=re.toString),q},T.createOptions=function(q,re){var ce={};return $(ce,re),q&&$(ce,q),ce}):N("hasOwnProperty not supported"),D||N("Rangy can only run in a browser"),(function(){var q;if(D){var re=document.createElement("div");re.appendChild(document.createElement("span"));var ce=[].slice;try{ce.call(re.childNodes,0)[0].nodeType==1&&(q=function(ve){return ce.call(ve,0)})}catch{}}q||(q=function(ve){for(var Ne=[],ge=0,_e=ve.length;ge<_e;++ge)Ne[ge]=ve[ge];return Ne}),T.toArray=q})();var B;D&&(u(document,"addEventListener")?B=function(q,re,ce){q.addEventListener(re,ce,!1)}:u(document,"attachEvent")?B=function(q,re,ce){q.attachEvent("on"+re,ce)}:N("Document does not have required addEventListener or attachEvent method"),T.addListener=B);var E=[];function A(q){return q.message||q.description||String(q)}function M(){if(!(!D||O.initialized)){var q,re=!1,ce=!1;u(document,"createRange")&&(q=document.createRange(),h(q,s)&&_(q,r)&&(re=!0));var ve=g(document);if(!ve||ve.nodeName.toLowerCase()!="body"){N("No body element found");return}if(ve&&u(ve,"createTextRange")&&(q=ve.createTextRange(),m(q)&&(ce=!0)),!re&&!ce){N("Neither Range nor TextRange are available");return}O.initialized=!0,O.features={implementsDomRange:re,implementsTextRange:ce};var Ne,ge;for(var _e in C)(Ne=C[_e])instanceof oe&&Ne.init(Ne,O);for(var st=0,tt=E.length;st<tt;++st)try{E[st](O)}catch(ke){ge="Rangy init listener threw an exception. Continuing. Detail: "+A(ke),k(ge)}}}function F(q,re,ce){ce&&(q+=" in module "+ce.name),O.warn("DEPRECATED: "+q+" is deprecated. Please use "+re+" instead.")}function H(q,re,ce,ve){q[re]=function(){return F(re,ce,ve),q[ce].apply(q,T.toArray(arguments))}}T.deprecationNotice=F,T.createAliasForDeprecatedMethod=H,O.init=M,O.addInitListener=function(q){O.initialized?q(O):E.push(q)};var R=[];O.addShimListener=function(q){R.push(q)};function G(q){q=q||window,M();for(var re=0,ce=R.length;re<ce;++re)R[re](q)}D&&(O.shim=O.createMissingNativeApi=G,H(O,"createMissingNativeApi","shim"));function oe(q,re,ce){this.name=q,this.dependencies=re,this.initialized=!1,this.supported=!1,this.initializer=ce}oe.prototype={init:function(){for(var q=this.dependencies||[],re=0,ce=q.length,ve,Ne;re<ce;++re){if(Ne=q[re],ve=C[Ne],!ve||!(ve instanceof oe))throw new Error("required module '"+Ne+"' not found");if(ve.init(),!ve.supported)throw new Error("required module '"+Ne+"' not supported")}this.initializer(this)},fail:function(q){throw this.initialized=!0,this.supported=!1,new Error(q)},warn:function(q){O.warn("Module "+this.name+": "+q)},deprecationNotice:function(q,re){O.warn("DEPRECATED: "+q+" in module "+this.name+" is deprecated. Please use "+re+" instead")},createError:function(q){return new Error("Error in Rangy "+this.name+" module: "+q)}};function V(q,re,ce){var ve=new oe(q,re,function(Ne){if(!Ne.initialized){Ne.initialized=!0;try{ce(O,Ne),Ne.supported=!0}catch(_e){var ge="Module '"+q+"' failed to load: "+A(_e);k(ge),_e.stack&&k(_e.stack)}}});return C[q]=ve,ve}O.createModule=function(q){var re,ce;arguments.length==2?(re=arguments[1],ce=[]):(re=arguments[2],ce=arguments[1]);var ve=V(q,ce,re);O.initialized&&O.supported&&ve.init()},O.createCoreModule=function(q,re,ce){V(q,re,ce)};function Y(){}O.RangePrototype=Y,O.rangePrototype=new Y;function Q(){}O.selectionPrototype=new Q,O.createCoreModule("DomUtil",[],function(q,re){var ce="undefined",ve=q.util,Ne=ve.getBody;ve.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||re.fail("document missing a Node creation method"),ve.isHostMethod(document,"getElementsByTagName")||re.fail("document missing getElementsByTagName method");var ge=document.createElement("div");ve.areHostMethods(ge,["insertBefore","appendChild","cloneNode"])||re.fail("Incomplete Element implementation"),ve.isHostProperty(ge,"innerHTML")||re.fail("Element is missing innerHTML property");var _e=document.createTextNode("test");ve.areHostMethods(_e,["splitText","deleteData","insertData","appendData","cloneNode"])||re.fail("Incomplete Text Node implementation");var st=function(Se,Ye){for(var be=Se.length;be--;)if(Se[be]===Ye)return!0;return!1};function tt(Se){var Ye;return typeof Se.namespaceURI==ce||(Ye=Se.namespaceURI)===null||Ye=="http://www.w3.org/1999/xhtml"}function ke(Se){var Ye=Se.parentNode;return Ye.nodeType==1?Ye:null}function he(Se){for(var Ye=0;Se=Se.previousSibling;)++Ye;return Ye}function De(Se){switch(Se.nodeType){case 7:case 10:return 0;case 3:case 8:return Se.length;default:return Se.childNodes.length}}function Me(Se,Ye){var be=[],Be;for(Be=Se;Be;Be=Be.parentNode)be.push(Be);for(Be=Ye;Be;Be=Be.parentNode)if(st(be,Be))return Be;return null}function U(Se,Ye,be){for(var Be=be?Ye:Ye.parentNode;Be;){if(Be===Se)return!0;Be=Be.parentNode}return!1}function ne(Se,Ye){return U(Se,Ye,!0)}function se(Se,Ye,be){for(var Be,Ke=be?Se:Se.parentNode;Ke;){if(Be=Ke.parentNode,Be===Ye)return Ke;Ke=Be}return null}function Ee(Se){var Ye=Se.nodeType;return Ye==3||Ye==4||Ye==8}function fe(Se){if(!Se)return!1;var Ye=Se.nodeType;return Ye==3||Ye==8}function Le(Se,Ye){var be=Ye.nextSibling,Be=Ye.parentNode;return be?Be.insertBefore(Se,be):Be.appendChild(Se),Se}function Ie(Se,Ye,be){var Be=Se.cloneNode(!1);if(Be.deleteData(0,Ye),Se.deleteData(Ye,Se.length-Ye),Le(Be,Se),be)for(var Ke=0,ze;ze=be[Ke++];)ze.node==Se&&ze.offset>Ye?(ze.node=Be,ze.offset-=Ye):ze.node==Se.parentNode&&ze.offset>he(Se)&&++ze.offset;return Be}function Ve(Se){if(Se.nodeType==9)return Se;if(typeof Se.ownerDocument!=ce)return Se.ownerDocument;if(typeof Se.document!=ce)return Se.document;if(Se.parentNode)return Ve(Se.parentNode);throw re.createError("getDocument: no document found for node")}function et(Se){var Ye=Ve(Se);if(typeof Ye.defaultView!=ce)return Ye.defaultView;if(typeof Ye.parentWindow!=ce)return Ye.parentWindow;throw re.createError("Cannot get a window object for node")}function nt(Se){if(typeof Se.contentDocument!=ce)return Se.contentDocument;if(typeof Se.contentWindow!=ce)return Se.contentWindow.document;throw re.createError("getIframeDocument: No Document object found for iframe element")}function We(Se){if(typeof Se.contentWindow!=ce)return Se.contentWindow;if(typeof Se.contentDocument!=ce)return Se.contentDocument.defaultView;throw re.createError("getIframeWindow: No Window object found for iframe element")}function lt(Se){return Se&&ve.isHostMethod(Se,"setTimeout")&&ve.isHostObject(Se,"document")}function de(Se,Ye,be){var Be;if(Se?ve.isHostProperty(Se,"nodeType")?Be=Se.nodeType==1&&Se.tagName.toLowerCase()=="iframe"?nt(Se):Ve(Se):lt(Se)&&(Be=Se.document):Be=document,!Be)throw Ye.createError(be+"(): Parameter must be a Window object or DOM node");return Be}function pe(Se){for(var Ye;Ye=Se.parentNode;)Se=Ye;return Se}function xe(Se,Ye,be,Be){var Ke,ze,ht,dt,Ut;if(Se==be)return Ye===Be?0:Ye<Be?-1:1;if(Ke=se(be,Se,!0))return Ye<=he(Ke)?-1:1;if(Ke=se(Se,be,!0))return he(Ke)<Be?-1:1;if(ze=Me(Se,be),!ze)throw new Error("comparePoints error: nodes have no common ancestor");if(ht=Se===ze?ze:se(Se,ze,!0),dt=be===ze?ze:se(be,ze,!0),ht===dt)throw re.createError("comparePoints got to case 4 and childA and childB are the same!");for(Ut=ze.firstChild;Ut;){if(Ut===ht)return-1;if(Ut===dt)return 1;Ut=Ut.nextSibling}}var Ce=!1;function Fe(Se){var Ye;try{return Ye=Se.parentNode,!1}catch{return!0}}(function(){var Se=document.createElement("b");Se.innerHTML="1";var Ye=Se.firstChild;Se.innerHTML="<br />",Ce=Fe(Ye),q.features.crashyTextNodes=Ce})();function Ue(Se){if(!Se)return"[No node]";if(Ce&&Fe(Se))return"[Broken node]";if(Ee(Se))return'"'+Se.data+'"';if(Se.nodeType==1){var Ye=Se.id?' id="'+Se.id+'"':"";return"<"+Se.nodeName+Ye+">[index:"+he(Se)+",length:"+Se.childNodes.length+"]["+(Se.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return Se.nodeName}function qe(Se){for(var Ye=Ve(Se).createDocumentFragment(),be;be=Se.firstChild;)Ye.appendChild(be);return Ye}var at;typeof window.getComputedStyle!=ce?at=function(Se,Ye){return et(Se).getComputedStyle(Se,null)[Ye]}:typeof document.documentElement.currentStyle!=ce?at=function(Se,Ye){return Se.currentStyle?Se.currentStyle[Ye]:""}:re.fail("No means of obtaining computed style properties found");function bt(Se,Ye,be){var Be=Ne(Se),Ke=Se.createElement("div");Ke.contentEditable=""+!!be,Ye&&(Ke.innerHTML=Ye);var ze=Be.firstChild;return ze?Be.insertBefore(Ke,ze):Be.appendChild(Ke),Ke}function Xt(Se){return Se.parentNode.removeChild(Se)}function Ft(Se){this.root=Se,this._next=Se}Ft.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var Se=this._current=this._next,Ye,be;if(this._current)if(Ye=Se.firstChild,Ye)this._next=Ye;else{for(be=null;Se!==this.root&&!(be=Se.nextSibling);)Se=Se.parentNode;this._next=be}return this._current},detach:function(){this._current=this._next=this.root=null}};function pn(Se){return new Ft(Se)}function vn(Se,Ye){this.node=Se,this.offset=Ye}vn.prototype={equals:function(Se){return!!Se&&this.node===Se.node&&this.offset==Se.offset},inspect:function(){return"[DomPosition("+Ue(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function Rt(Se){this.code=this[Se],this.codeName=Se,this.message="DOMException: "+this.codeName}Rt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},Rt.prototype.toString=function(){return this.message},q.dom={arrayContains:st,isHtmlNamespace:tt,parentElement:ke,getNodeIndex:he,getNodeLength:De,getCommonAncestor:Me,isAncestorOf:U,isOrIsAncestorOf:ne,getClosestAncestorIn:se,isCharacterDataNode:Ee,isTextOrCommentNode:fe,insertAfter:Le,splitDataNode:Ie,getDocument:Ve,getWindow:et,getIframeWindow:We,getIframeDocument:nt,getBody:Ne,isWindow:lt,getContentDocument:de,getRootContainer:pe,comparePoints:xe,isBrokenNode:Fe,inspectNode:Ue,getComputedStyleProperty:at,createTestElement:bt,removeNode:Xt,fragmentFromNodeChildren:qe,createIterator:pn,DomPosition:vn},q.DOMException=Rt}),O.createCoreModule("DomRange",["DomUtil"],function(q,re){var ce=q.dom,ve=q.util,Ne=ce.DomPosition,ge=q.DOMException,_e=ce.isCharacterDataNode,st=ce.getNodeIndex,tt=ce.isOrIsAncestorOf,ke=ce.getDocument,he=ce.comparePoints,De=ce.splitDataNode,Me=ce.getClosestAncestorIn,U=ce.getNodeLength,ne=ce.arrayContains,se=ce.getRootContainer,Ee=q.features.crashyTextNodes,fe=ce.removeNode;function Le(J,I){return J.nodeType!=3&&(tt(J,I.startContainer)||tt(J,I.endContainer))}function Ie(J){return J.document||ke(J.startContainer)}function Ve(J){return se(J.startContainer)}function et(J){return new Ne(J.parentNode,st(J))}function nt(J){return new Ne(J.parentNode,st(J)+1)}function We(J,I,W){var me=J.nodeType==11?J.firstChild:J;return _e(I)?W==I.length?ce.insertAfter(J,I):I.parentNode.insertBefore(J,W==0?I:De(I,W)):W>=I.childNodes.length?I.appendChild(J):I.insertBefore(J,I.childNodes[W]),me}function lt(J,I,W){if(qt(J),qt(I),Ie(I)!=Ie(J))throw new ge("WRONG_DOCUMENT_ERR");var me=he(J.startContainer,J.startOffset,I.endContainer,I.endOffset),Oe=he(J.endContainer,J.endOffset,I.startContainer,I.startOffset);return W?me<=0&&Oe>=0:me<0&&Oe>0}function de(J){for(var I,W,me=Ie(J.range).createDocumentFragment(),Oe;W=J.next();){if(I=J.isPartiallySelectedSubtree(),W=W.cloneNode(!I),I&&(Oe=J.getSubtreeIterator(),W.appendChild(de(Oe)),Oe.detach()),W.nodeType==10)throw new ge("HIERARCHY_REQUEST_ERR");me.appendChild(W)}return me}function pe(J,I,W){var me,Oe;W=W||{stop:!1};for(var rt,je;rt=J.next();)if(J.isPartiallySelectedSubtree()){if(I(rt)===!1){W.stop=!0;return}else if(je=J.getSubtreeIterator(),pe(je,I,W),je.detach(),W.stop)return}else for(me=ce.createIterator(rt);Oe=me.next();)if(I(Oe)===!1){W.stop=!0;return}}function xe(J){for(var I;J.next();)J.isPartiallySelectedSubtree()?(I=J.getSubtreeIterator(),xe(I),I.detach()):J.remove()}function Ce(J){for(var I,W=Ie(J.range).createDocumentFragment(),me;I=J.next();){if(J.isPartiallySelectedSubtree()?(I=I.cloneNode(!1),me=J.getSubtreeIterator(),I.appendChild(Ce(me)),me.detach()):J.remove(),I.nodeType==10)throw new ge("HIERARCHY_REQUEST_ERR");W.appendChild(I)}return W}function Fe(J,I,W){var me=!!(I&&I.length),Oe,rt=!!W;me&&(Oe=new RegExp("^("+I.join("|")+")$"));var je=[];return pe(new qe(J,!1),function(Qe){if(!(me&&!Oe.test(Qe.nodeType))&&!(rt&&!W(Qe))){var ft=J.startContainer;if(!(Qe==ft&&_e(ft)&&J.startOffset==ft.length)){var Ot=J.endContainer;Qe==Ot&&_e(Ot)&&J.endOffset==0||je.push(Qe)}}}),je}function Ue(J){var I=typeof J.getName>"u"?"Range":J.getName();return"["+I+"("+ce.inspectNode(J.startContainer)+":"+J.startOffset+", "+ce.inspectNode(J.endContainer)+":"+J.endOffset+")]"}function qe(J,I){if(this.range=J,this.clonePartiallySelectedTextNodes=I,!J.collapsed){this.sc=J.startContainer,this.so=J.startOffset,this.ec=J.endContainer,this.eo=J.endOffset;var W=J.commonAncestorContainer;this.sc===this.ec&&_e(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===W&&!_e(this.sc)?this.sc.childNodes[this.so]:Me(this.sc,W,!0),this._last=this.ec===W&&!_e(this.ec)?this.ec.childNodes[this.eo-1]:Me(this.ec,W,!0))}}qe.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var J=this._current=this._next;return J&&(this._next=J!==this._last?J.nextSibling:null,_e(J)&&this.clonePartiallySelectedTextNodes&&(J===this.ec&&(J=J.cloneNode(!0)).deleteData(this.eo,J.length-this.eo),this._current===this.sc&&(J=J.cloneNode(!0)).deleteData(0,this.so))),J},remove:function(){var J=this._current,I,W;_e(J)&&(J===this.sc||J===this.ec)?(I=J===this.sc?this.so:0,W=J===this.ec?this.eo:J.length,I!=W&&J.deleteData(I,W-I)):J.parentNode&&fe(J)},isPartiallySelectedSubtree:function(){var J=this._current;return Le(J,this.range)},getSubtreeIterator:function(){var J;if(this.isSingleCharacterDataNode)J=this.range.cloneRange(),J.collapse(!1);else{J=new Dn(Ie(this.range));var I=this._current,W=I,me=0,Oe=I,rt=U(I);tt(I,this.sc)&&(W=this.sc,me=this.so),tt(I,this.ec)&&(Oe=this.ec,rt=this.eo),Zt(J,W,me,Oe,rt)}return new qe(J,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var at=[1,3,4,5,7,8,10],bt=[2,9,11],Xt=[5,6,10,12],Ft=[1,3,4,5,7,8,10,11],pn=[1,3,4,5,7,8];function vn(J){return function(I,W){for(var me,Oe=W?I:I.parentNode;Oe;){if(me=Oe.nodeType,ne(J,me))return Oe;Oe=Oe.parentNode}return null}}var Rt=vn([9,11]),Se=vn(Xt),Ye=vn([6,10,12]),be=vn([1]);function Be(J,I){if(Ye(J,I))throw new ge("INVALID_NODE_TYPE_ERR")}function Ke(J,I){if(!ne(I,J.nodeType))throw new ge("INVALID_NODE_TYPE_ERR")}function ze(J,I){if(I<0||I>(_e(J)?J.length:J.childNodes.length))throw new ge("INDEX_SIZE_ERR")}function ht(J,I){if(Rt(J,!0)!==Rt(I,!0))throw new ge("WRONG_DOCUMENT_ERR")}function dt(J){if(Se(J,!0))throw new ge("NO_MODIFICATION_ALLOWED_ERR")}function Ut(J,I){if(!J)throw new ge(I)}function bn(J,I){return I<=(_e(J)?J.length:J.childNodes.length)}function En(J){return!!J.startContainer&&!!J.endContainer&&!(Ee&&(ce.isBrokenNode(J.startContainer)||ce.isBrokenNode(J.endContainer)))&&se(J.startContainer)==se(J.endContainer)&&bn(J.startContainer,J.startOffset)&&bn(J.endContainer,J.endOffset)}function qt(J){if(!En(J))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+J.inspect()+")")}var Hn=document.createElement("style"),Mn=!1;try{Hn.innerHTML="<b>x</b>",Mn=Hn.firstChild.nodeType==3}catch{}q.features.htmlParsingConforms=Mn;var bo=Mn?function(J){var I=this.startContainer,W=ke(I);if(!I)throw new ge("INVALID_STATE_ERR");var me=null;return I.nodeType==1?me=I:_e(I)&&(me=ce.parentElement(I)),me===null||me.nodeName=="HTML"&&ce.isHtmlNamespace(ke(me).documentElement)&&ce.isHtmlNamespace(me)?me=W.createElement("body"):me=me.cloneNode(!1),me.innerHTML=J,ce.fragmentFromNodeChildren(me)}:function(J){var I=Ie(this),W=I.createElement("body");return W.innerHTML=J,ce.fragmentFromNodeChildren(W)};function xi(J,I){qt(J);var W=J.startContainer,me=J.startOffset,Oe=J.endContainer,rt=J.endOffset,je=W===Oe;_e(Oe)&&rt>0&&rt<Oe.length&&De(Oe,rt,I),_e(W)&&me>0&&me<W.length&&(W=De(W,me,I),je?(rt-=me,Oe=W):Oe==W.parentNode&&rt>=st(W)&&rt++,me=0),J.setStartAndEnd(W,me,Oe,rt)}function kt(J){qt(J);var I=J.commonAncestorContainer.parentNode.cloneNode(!1);return I.appendChild(J.cloneContents()),I.innerHTML}var Ii=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],wi=0,xo=1,ro=2,so=3,Ci=0,Fi=1,ur=2,Io=3;ve.extend(q.rangePrototype,{compareBoundaryPoints:function(J,I){qt(this),ht(this.startContainer,I.startContainer);var W,me,Oe,rt,je=J==so||J==wi?"start":"end",Qe=J==xo||J==wi?"start":"end";return W=this[je+"Container"],me=this[je+"Offset"],Oe=I[Qe+"Container"],rt=I[Qe+"Offset"],he(W,me,Oe,rt)},insertNode:function(J){if(qt(this),Ke(J,Ft),dt(this.startContainer),tt(J,this.startContainer))throw new ge("HIERARCHY_REQUEST_ERR");var I=We(J,this.startContainer,this.startOffset);this.setStartBefore(I)},cloneContents:function(){qt(this);var J,I;if(this.collapsed)return Ie(this).createDocumentFragment();if(this.startContainer===this.endContainer&&_e(this.startContainer))return J=this.startContainer.cloneNode(!0),J.data=J.data.slice(this.startOffset,this.endOffset),I=Ie(this).createDocumentFragment(),I.appendChild(J),I;var W=new qe(this,!0);return J=de(W),W.detach(),J},canSurroundContents:function(){qt(this),dt(this.startContainer),dt(this.endContainer);var J=new qe(this,!0),I=J._first&&Le(J._first,this)||J._last&&Le(J._last,this);return J.detach(),!I},surroundContents:function(J){if(Ke(J,pn),!this.canSurroundContents())throw new ge("INVALID_STATE_ERR");var I=this.extractContents();if(J.hasChildNodes())for(;J.lastChild;)J.removeChild(J.lastChild);We(J,this.startContainer,this.startOffset),J.appendChild(I),this.selectNode(J)},cloneRange:function(){qt(this);for(var J=new Dn(Ie(this)),I=Ii.length,W;I--;)W=Ii[I],J[W]=this[W];return J},toString:function(){qt(this);var J=this.startContainer;if(J===this.endContainer&&_e(J))return J.nodeType==3||J.nodeType==4?J.data.slice(this.startOffset,this.endOffset):"";var I=[],W=new qe(this,!0);return pe(W,function(me){(me.nodeType==3||me.nodeType==4)&&I.push(me.data)}),W.detach(),I.join("")},compareNode:function(J){qt(this);var I=J.parentNode,W=st(J);if(!I)throw new ge("NOT_FOUND_ERR");var me=this.comparePoint(I,W),Oe=this.comparePoint(I,W+1);return me<0?Oe>0?ur:Ci:Oe>0?Fi:Io},comparePoint:function(J,I){return qt(this),Ut(J,"HIERARCHY_REQUEST_ERR"),ht(J,this.startContainer),he(J,I,this.startContainer,this.startOffset)<0?-1:he(J,I,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:bo,toHtml:function(){return kt(this)},intersectsNode:function(J,I){if(qt(this),se(J)!=Ve(this))return!1;var W=J.parentNode,me=st(J);if(!W)return!0;var Oe=he(W,me,this.endContainer,this.endOffset),rt=he(W,me+1,this.startContainer,this.startOffset);return I?Oe<=0&&rt>=0:Oe<0&&rt>0},isPointInRange:function(J,I){return qt(this),Ut(J,"HIERARCHY_REQUEST_ERR"),ht(J,this.startContainer),he(J,I,this.startContainer,this.startOffset)>=0&&he(J,I,this.endContainer,this.endOffset)<=0},intersectsRange:function(J){return lt(this,J,!1)},intersectsOrTouchesRange:function(J){return lt(this,J,!0)},intersection:function(J){if(this.intersectsRange(J)){var I=he(this.startContainer,this.startOffset,J.startContainer,J.startOffset),W=he(this.endContainer,this.endOffset,J.endContainer,J.endOffset),me=this.cloneRange();return I==-1&&me.setStart(J.startContainer,J.startOffset),W==1&&me.setEnd(J.endContainer,J.endOffset),me}return null},union:function(J){if(this.intersectsOrTouchesRange(J)){var I=this.cloneRange();return he(J.startContainer,J.startOffset,this.startContainer,this.startOffset)==-1&&I.setStart(J.startContainer,J.startOffset),he(J.endContainer,J.endOffset,this.endContainer,this.endOffset)==1&&I.setEnd(J.endContainer,J.endOffset),I}else throw new ge("Ranges do not intersect")},containsNode:function(J,I){return I?this.intersectsNode(J,!1):this.compareNode(J)==Io},containsNodeContents:function(J){return this.comparePoint(J,0)>=0&&this.comparePoint(J,U(J))<=0},containsRange:function(J){var I=this.intersection(J);return I!==null&&J.equals(I)},containsNodeText:function(J){var I=this.cloneRange();I.selectNode(J);var W=I.getNodes([3]);if(W.length>0){I.setStart(W[0],0);var me=W.pop();return I.setEnd(me,me.length),this.containsRange(I)}else return this.containsNodeContents(J)},getNodes:function(J,I){return qt(this),Fe(this,J,I)},getDocument:function(){return Ie(this)},collapseBefore:function(J){this.setEndBefore(J),this.collapse(!1)},collapseAfter:function(J){this.setStartAfter(J),this.collapse(!0)},getBookmark:function(J){var I=Ie(this),W=q.createRange(I);J=J||ce.getBody(I),W.selectNodeContents(J);var me=this.intersection(W),Oe=0,rt=0;return me&&(W.setEnd(me.startContainer,me.startOffset),Oe=W.toString().length,rt=Oe+me.toString().length),{start:Oe,end:rt,containerNode:J}},moveToBookmark:function(J){var I=J.containerNode,W=0;this.setStart(I,0),this.collapse(!0);for(var me=[I],Oe,rt=!1,je=!1,Qe,ft,Ot;!je&&(Oe=me.pop());)if(Oe.nodeType==3)Qe=W+Oe.length,!rt&&J.start>=W&&J.start<=Qe&&(this.setStart(Oe,J.start-W),rt=!0),rt&&J.end>=W&&J.end<=Qe&&(this.setEnd(Oe,J.end-W),je=!0),W=Qe;else for(Ot=Oe.childNodes,ft=Ot.length;ft--;)me.push(Ot[ft])},getName:function(){return"DomRange"},equals:function(J){return Dn.rangesEqual(this,J)},isValid:function(){return En(this)},inspect:function(){return Ue(this)},detach:function(){}});function K(J){J.START_TO_START=wi,J.START_TO_END=xo,J.END_TO_END=ro,J.END_TO_START=so,J.NODE_BEFORE=Ci,J.NODE_AFTER=Fi,J.NODE_BEFORE_AND_AFTER=ur,J.NODE_INSIDE=Io}function we(J){K(J),K(J.prototype)}function Ge(J,I){return function(){qt(this);var W=this.startContainer,me=this.startOffset,Oe=this.commonAncestorContainer,rt=new qe(this,!0),je,Qe;W!==Oe&&(je=Me(W,Oe,!0),Qe=nt(je),W=Qe.node,me=Qe.offset),pe(rt,dt),rt.reset();var ft=J(rt);return rt.detach(),I(this,W,me,W,me),ft}}function ct(J,I){function W(je,Qe){return function(ft){Ke(ft,at),Ke(se(ft),bt);var Ot=(je?et:nt)(ft);(Qe?me:Oe)(this,Ot.node,Ot.offset)}}function me(je,Qe,ft){var Ot=je.endContainer,Un=je.endOffset;(Qe!==je.startContainer||ft!==je.startOffset)&&((se(Qe)!=se(Ot)||he(Qe,ft,Ot,Un)==1)&&(Ot=Qe,Un=ft),I(je,Qe,ft,Ot,Un))}function Oe(je,Qe,ft){var Ot=je.startContainer,Un=je.startOffset;(Qe!==je.endContainer||ft!==je.endOffset)&&((se(Qe)!=se(Ot)||he(Qe,ft,Ot,Un)==-1)&&(Ot=Qe,Un=ft),I(je,Ot,Un,Qe,ft))}var rt=function(){};rt.prototype=q.rangePrototype,J.prototype=new rt,ve.extend(J.prototype,{setStart:function(je,Qe){Be(je,!0),ze(je,Qe),me(this,je,Qe)},setEnd:function(je,Qe){Be(je,!0),ze(je,Qe),Oe(this,je,Qe)},setStartAndEnd:function(){var je=arguments,Qe=je[0],ft=je[1],Ot=Qe,Un=ft;switch(je.length){case 3:Un=je[2];break;case 4:Ot=je[2],Un=je[3];break}Be(Qe,!0),ze(Qe,ft),Be(Ot,!0),ze(Ot,Un),I(this,Qe,ft,Ot,Un)},setBoundary:function(je,Qe,ft){this["set"+(ft?"Start":"End")](je,Qe)},setStartBefore:W(!0,!0),setStartAfter:W(!1,!0),setEndBefore:W(!0,!1),setEndAfter:W(!1,!1),collapse:function(je){qt(this),je?I(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):I(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(je){Be(je,!0),I(this,je,0,je,U(je))},selectNode:function(je){Be(je,!1),Ke(je,at);var Qe=et(je),ft=nt(je);I(this,Qe.node,Qe.offset,ft.node,ft.offset)},extractContents:Ge(Ce,I),deleteContents:Ge(xe,I),canSurroundContents:function(){qt(this),dt(this.startContainer),dt(this.endContainer);var je=new qe(this,!0),Qe=je._first&&Le(je._first,this)||je._last&&Le(je._last,this);return je.detach(),!Qe},splitBoundaries:function(){xi(this)},splitBoundariesPreservingPositions:function(je){xi(this,je)},normalizeBoundaries:function(){qt(this);var je=this.startContainer,Qe=this.startOffset,ft=this.endContainer,Ot=this.endOffset,Un=function(ao){var oi=ao.nextSibling;oi&&oi.nodeType==ao.nodeType&&(ft=ao,Ot=ao.length,ao.appendData(oi.data),fe(oi))},Ff=function(ao){var oi=ao.previousSibling;if(oi&&oi.nodeType==ao.nodeType){je=ao;var Im=ao.length;if(Qe=oi.length,ao.insertData(0,oi.data),fe(oi),je==ft)Ot+=Qe,ft=je;else if(ft==ao.parentNode){var jf=st(ao);Ot==jf?(ft=ao,Ot=Im):Ot>jf&&Ot--}}},ed=!0,wo;if(_e(ft))Ot==ft.length?Un(ft):Ot==0&&(wo=ft.previousSibling,wo&&wo.nodeType==ft.nodeType&&(Ot=wo.length,je==ft&&(ed=!1),wo.appendData(ft.data),fe(ft),ft=wo));else{if(Ot>0){var td=ft.childNodes[Ot-1];td&&_e(td)&&Un(td)}ed=!this.collapsed}if(ed){if(_e(je))Qe==0?Ff(je):Qe==je.length&&(wo=je.nextSibling,wo&&wo.nodeType==je.nodeType&&(ft==wo&&(ft=je,Ot+=je.length),je.appendData(wo.data),fe(wo)));else if(Qe<je.childNodes.length){var nd=je.childNodes[Qe];nd&&_e(nd)&&Ff(nd)}}else je=ft,Qe=Ot;I(this,je,Qe,ft,Ot)},collapseToPoint:function(je,Qe){Be(je,!0),ze(je,Qe),this.setStartAndEnd(je,Qe)},parentElement:function(){qt(this);var je=this.commonAncestorContainer;return je?be(this.commonAncestorContainer,!0):null}}),we(J)}function At(J){J.collapsed=J.startContainer===J.endContainer&&J.startOffset===J.endOffset,J.commonAncestorContainer=J.collapsed?J.startContainer:ce.getCommonAncestor(J.startContainer,J.endContainer)}function Zt(J,I,W,me,Oe){J.startContainer=I,J.startOffset=W,J.endContainer=me,J.endOffset=Oe,J.document=ce.getDocument(I),At(J)}function Dn(J){Zt(this,J,0,J,0)}ct(Dn,Zt),ve.extend(Dn,{rangeProperties:Ii,RangeIterator:qe,copyComparisonConstants:we,createPrototypeRange:ct,inspect:Ue,toHtml:kt,getRangeDocument:Ie,rangesEqual:function(J,I){return J.startContainer===I.startContainer&&J.startOffset===I.startOffset&&J.endContainer===I.endContainer&&J.endOffset===I.endOffset}}),q.DomRange=Dn}),O.createCoreModule("WrappedRange",["DomRange"],function(q,re){var ce,ve,Ne=q.dom,ge=q.util,_e=Ne.DomPosition,st=q.DomRange,tt=Ne.getBody,ke=Ne.getContentDocument,he=Ne.isCharacterDataNode;if(q.features.implementsDomRange&&(function(){var fe,Le=st.rangeProperties;function Ie(Ce){for(var Fe=Le.length,Ue;Fe--;)Ue=Le[Fe],Ce[Ue]=Ce.nativeRange[Ue];Ce.collapsed=Ce.startContainer===Ce.endContainer&&Ce.startOffset===Ce.endOffset}function Ve(Ce,Fe,Ue,qe,at){var bt=Ce.startContainer!==Fe||Ce.startOffset!=Ue,Xt=Ce.endContainer!==qe||Ce.endOffset!=at,Ft=!Ce.equals(Ce.nativeRange);(bt||Xt||Ft)&&(Ce.setEnd(qe,at),Ce.setStart(Fe,Ue))}var et;ce=function(Ce){if(!Ce)throw re.createError("WrappedRange: Range must be specified");this.nativeRange=Ce,Ie(this)},st.createPrototypeRange(ce,Ve),fe=ce.prototype,fe.selectNode=function(Ce){this.nativeRange.selectNode(Ce),Ie(this)},fe.cloneContents=function(){return this.nativeRange.cloneContents()},fe.surroundContents=function(Ce){this.nativeRange.surroundContents(Ce),Ie(this)},fe.collapse=function(Ce){this.nativeRange.collapse(Ce),Ie(this)},fe.cloneRange=function(){return new ce(this.nativeRange.cloneRange())},fe.refresh=function(){Ie(this)},fe.toString=function(){return this.nativeRange.toString()};var nt=document.createTextNode("test");tt(document).appendChild(nt);var We=document.createRange();We.setStart(nt,0),We.setEnd(nt,0);try{We.setStart(nt,1),fe.setStart=function(Ce,Fe){this.nativeRange.setStart(Ce,Fe),Ie(this)},fe.setEnd=function(Ce,Fe){this.nativeRange.setEnd(Ce,Fe),Ie(this)},et=function(Ce){return function(Fe){this.nativeRange[Ce](Fe),Ie(this)}}}catch{fe.setStart=function(Fe,Ue){try{this.nativeRange.setStart(Fe,Ue)}catch{this.nativeRange.setEnd(Fe,Ue),this.nativeRange.setStart(Fe,Ue)}Ie(this)},fe.setEnd=function(Fe,Ue){try{this.nativeRange.setEnd(Fe,Ue)}catch{this.nativeRange.setStart(Fe,Ue),this.nativeRange.setEnd(Fe,Ue)}Ie(this)},et=function(Fe,Ue){return function(qe){try{this.nativeRange[Fe](qe)}catch{this.nativeRange[Ue](qe),this.nativeRange[Fe](qe)}Ie(this)}}}fe.setStartBefore=et("setStartBefore","setEndBefore"),fe.setStartAfter=et("setStartAfter","setEndAfter"),fe.setEndBefore=et("setEndBefore","setStartBefore"),fe.setEndAfter=et("setEndAfter","setStartAfter"),fe.selectNodeContents=function(Ce){this.setStartAndEnd(Ce,0,Ne.getNodeLength(Ce))},We.selectNodeContents(nt),We.setEnd(nt,3);var lt=document.createRange();lt.selectNodeContents(nt),lt.setEnd(nt,4),lt.setStart(nt,2),We.compareBoundaryPoints(We.START_TO_END,lt)==-1&&We.compareBoundaryPoints(We.END_TO_START,lt)==1?fe.compareBoundaryPoints=function(Ce,Fe){return Fe=Fe.nativeRange||Fe,Ce==Fe.START_TO_END?Ce=Fe.END_TO_START:Ce==Fe.END_TO_START&&(Ce=Fe.START_TO_END),this.nativeRange.compareBoundaryPoints(Ce,Fe)}:fe.compareBoundaryPoints=function(Ce,Fe){return this.nativeRange.compareBoundaryPoints(Ce,Fe.nativeRange||Fe)};var de=document.createElement("div");de.innerHTML="123";var pe=de.firstChild,xe=tt(document);xe.appendChild(de),We.setStart(pe,1),We.setEnd(pe,2),We.deleteContents(),pe.data=="13"&&(fe.deleteContents=function(){this.nativeRange.deleteContents(),Ie(this)},fe.extractContents=function(){var Ce=this.nativeRange.extractContents();return Ie(this),Ce}),xe.removeChild(de),xe=null,ge.isHostMethod(We,"createContextualFragment")&&(fe.createContextualFragment=function(Ce){return this.nativeRange.createContextualFragment(Ce)}),tt(document).removeChild(nt),fe.getName=function(){return"WrappedRange"},q.WrappedRange=ce,q.createNativeRange=function(Ce){return Ce=ke(Ce,re,"createNativeRange"),Ce.createRange()}})(),q.features.implementsTextRange){var De=function(fe){var Le=fe.parentElement(),Ie=fe.duplicate();Ie.collapse(!0);var Ve=Ie.parentElement();Ie=fe.duplicate(),Ie.collapse(!1);var et=Ie.parentElement(),nt=Ve==et?Ve:Ne.getCommonAncestor(Ve,et);return nt==Le?nt:Ne.getCommonAncestor(Le,nt)},Me=function(fe){return fe.compareEndPoints("StartToEnd",fe)==0},U=function(fe,Le,Ie,Ve,et){var nt=fe.duplicate();nt.collapse(Ie);var We=nt.parentElement();if(Ne.isOrIsAncestorOf(Le,We)||(We=Le),!We.canHaveHTML){var lt=new _e(We.parentNode,Ne.getNodeIndex(We));return{boundaryPosition:lt,nodeInfo:{nodeIndex:lt.offset,containerElement:lt.node}}}var de=Ne.getDocument(We).createElement("span");de.parentNode&&Ne.removeNode(de);for(var pe,xe=Ie?"StartToStart":"StartToEnd",Ce,Fe,Ue,qe,at=et&&et.containerElement==We?et.nodeIndex:0,bt=We.childNodes.length,Xt=bt,Ft=Xt;Ft==bt?We.appendChild(de):We.insertBefore(de,We.childNodes[Ft]),nt.moveToElementText(de),pe=nt.compareEndPoints(xe,fe),!(pe==0||at==Xt);){if(pe==-1){if(Xt==at+1)break;at=Ft}else Xt=Xt==at+1?at:Ft;Ft=Math.floor((at+Xt)/2),We.removeChild(de)}if(qe=de.nextSibling,pe==-1&&qe&&he(qe)){nt.setEndPoint(Ie?"EndToStart":"EndToEnd",fe);var pn;if(/[\r\n]/.test(qe.data)){var vn=nt.duplicate(),Rt=vn.text.replace(/\r\n/g,"\r").length;for(pn=vn.moveStart("character",Rt);(pe=vn.compareEndPoints("StartToEnd",vn))==-1;)pn++,vn.moveStart("character",1)}else pn=nt.text.length;Ue=new _e(qe,pn)}else Ce=(Ve||!Ie)&&de.previousSibling,Fe=(Ve||Ie)&&de.nextSibling,Fe&&he(Fe)?Ue=new _e(Fe,0):Ce&&he(Ce)?Ue=new _e(Ce,Ce.data.length):Ue=new _e(We,Ne.getNodeIndex(de));return Ne.removeNode(de),{boundaryPosition:Ue,nodeInfo:{nodeIndex:Ft,containerElement:We}}},ne=function(fe,Le){var Ie,Ve,et=fe.offset,nt=Ne.getDocument(fe.node),We,lt,de=tt(nt).createTextRange(),pe=he(fe.node);return pe?(Ie=fe.node,Ve=Ie.parentNode):(lt=fe.node.childNodes,Ie=et<lt.length?lt[et]:null,Ve=fe.node),We=nt.createElement("span"),We.innerHTML="&#feff;",Ie?Ve.insertBefore(We,Ie):Ve.appendChild(We),de.moveToElementText(We),de.collapse(!Le),Ve.removeChild(We),pe&&de[Le?"moveStart":"moveEnd"]("character",et),de};ve=function(fe){this.textRange=fe,this.refresh()},ve.prototype=new st(document),ve.prototype.refresh=function(){var fe,Le,Ie,Ve=De(this.textRange);Me(this.textRange)?Le=fe=U(this.textRange,Ve,!0,!0).boundaryPosition:(Ie=U(this.textRange,Ve,!0,!1),fe=Ie.boundaryPosition,Le=U(this.textRange,Ve,!1,!1,Ie.nodeInfo).boundaryPosition),this.setStart(fe.node,fe.offset),this.setEnd(Le.node,Le.offset)},ve.prototype.getName=function(){return"WrappedTextRange"},st.copyComparisonConstants(ve);var se=function(fe){if(fe.collapsed)return ne(new _e(fe.startContainer,fe.startOffset),!0);var Le=ne(new _e(fe.startContainer,fe.startOffset),!0),Ie=ne(new _e(fe.endContainer,fe.endOffset),!1),Ve=tt(st.getRangeDocument(fe)).createTextRange();return Ve.setEndPoint("StartToStart",Le),Ve.setEndPoint("EndToEnd",Ie),Ve};if(ve.rangeToTextRange=se,ve.prototype.toTextRange=function(){return se(this)},q.WrappedTextRange=ve,!q.features.implementsDomRange||q.config.preferTextRange){var Ee=(function(fe){return fe("return this;")()})(Function);typeof Ee.Range>"u"&&(Ee.Range=ve),q.createNativeRange=function(fe){return fe=ke(fe,re,"createNativeRange"),tt(fe).createTextRange()},q.WrappedRange=ve}}q.createRange=function(fe){return fe=ke(fe,re,"createRange"),new q.WrappedRange(q.createNativeRange(fe))},q.createRangyRange=function(fe){return fe=ke(fe,re,"createRangyRange"),new st(fe)},ge.createAliasForDeprecatedMethod(q,"createIframeRange","createRange"),ge.createAliasForDeprecatedMethod(q,"createIframeRangyRange","createRangyRange"),q.addShimListener(function(fe){var Le=fe.document;typeof Le.createRange>"u"&&(Le.createRange=function(){return q.createRange(Le)}),Le=fe=null})}),O.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(q,re){q.config.checkSelectionRanges=!0;var ce="boolean",ve="number",Ne=q.dom,ge=q.util,_e=ge.isHostMethod,st=q.DomRange,tt=q.WrappedRange,ke=q.DOMException,he=Ne.DomPosition,De,Me,U=q.features,ne="Control",se=Ne.getDocument,Ee=Ne.getBody,fe=st.rangesEqual;function Le(K){return typeof K=="string"?/^backward(s)?$/i.test(K):!!K}function Ie(K,we){if(K){if(Ne.isWindow(K))return K;if(K instanceof qt)return K.win;var Ge=Ne.getContentDocument(K,re,we);return Ne.getWindow(Ge)}else return window}function Ve(K){return Ie(K,"getWinSelection").getSelection()}function et(K){return Ie(K,"getDocSelection").document.selection}function nt(K){var we=!1;return K.anchorNode&&(we=Ne.comparePoints(K.anchorNode,K.anchorOffset,K.focusNode,K.focusOffset)==1),we}var We=_e(window,"getSelection"),lt=ge.isHostObject(document,"selection");U.implementsWinGetSelection=We,U.implementsDocSelection=lt;var de=lt&&(!We||q.config.preferTextRange);if(de)De=et,q.isSelectionValid=function(K){var we=Ie(K,"isSelectionValid").document,Ge=we.selection;return Ge.type!="None"||se(Ge.createRange().parentElement())==we};else if(We)De=Ve,q.isSelectionValid=function(){return!0};else return re.fail("Neither document.selection or window.getSelection() detected."),!1;q.getNativeSelection=De;var pe=De();if(!pe)return re.fail("Native selection was null (possibly issue 138?)"),!1;var xe=q.createNativeRange(document),Ce=Ee(document),Fe=ge.areHostProperties(pe,["anchorNode","focusNode","anchorOffset","focusOffset"]);U.selectionHasAnchorAndFocus=Fe;var Ue=_e(pe,"extend");U.selectionHasExtend=Ue;var qe=_e(pe,"setBaseAndExtent");U.selectionHasSetBaseAndExtent=qe;var at=typeof pe.rangeCount==ve;U.selectionHasRangeCount=at;var bt=!1,Xt=!0,Ft=Ue?function(K,we){var Ge=st.getRangeDocument(we),ct=q.createRange(Ge);ct.collapseToPoint(we.endContainer,we.endOffset),K.addRange(Be(ct)),K.extend(we.startContainer,we.startOffset)}:null;ge.areHostMethods(pe,["addRange","getRangeAt","removeAllRanges"])&&typeof pe.rangeCount==ve&&U.implementsDomRange&&(function(){var K=window.getSelection();if(K){for(var we=K.rangeCount,Ge=we>1,ct=[],At=nt(K),Zt=0;Zt<we;++Zt)ct[Zt]=K.getRangeAt(Zt);var Dn=Ne.createTestElement(document,"",!1),J=Dn.appendChild(document.createTextNode("   ")),I=document.createRange();if(I.setStart(J,1),I.collapse(!0),K.removeAllRanges(),K.addRange(I),Xt=K.rangeCount==1,K.removeAllRanges(),!Ge){var W=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(W&&parseInt(W[1])>=36)bt=!1;else{var me=I.cloneRange();I.setStart(J,0),me.setEnd(J,3),me.setStart(J,2),K.addRange(I),K.addRange(me),bt=K.rangeCount==2}}for(Ne.removeNode(Dn),K.removeAllRanges(),Zt=0;Zt<we;++Zt)Zt==0&&At?Ft?Ft(K,ct[Zt]):(q.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),K.addRange(ct[Zt])):K.addRange(ct[Zt])}})(),U.selectionSupportsMultipleRanges=bt,U.collapsedNonEditableSelectionsSupported=Xt;var pn=!1,vn;Ce&&_e(Ce,"createControlRange")&&(vn=Ce.createControlRange(),ge.areHostProperties(vn,["item","add"])&&(pn=!0)),U.implementsControlRange=pn,Fe?Me=function(K){return K.anchorNode===K.focusNode&&K.anchorOffset===K.focusOffset}:Me=function(K){return K.rangeCount?K.getRangeAt(K.rangeCount-1).collapsed:!1};function Rt(K,we,Ge){var ct=Ge?"end":"start",At=Ge?"start":"end";K.anchorNode=we[ct+"Container"],K.anchorOffset=we[ct+"Offset"],K.focusNode=we[At+"Container"],K.focusOffset=we[At+"Offset"]}function Se(K){var we=K.nativeSelection;K.anchorNode=we.anchorNode,K.anchorOffset=we.anchorOffset,K.focusNode=we.focusNode,K.focusOffset=we.focusOffset}function Ye(K){K.anchorNode=K.focusNode=null,K.anchorOffset=K.focusOffset=0,K.rangeCount=0,K.isCollapsed=!0,K._ranges.length=0,be(K)}function be(K){K.type=K.rangeCount==0?"None":Me(K)?"Caret":"Range"}function Be(K){var we;return K instanceof st?(we=q.createNativeRange(K.getDocument()),we.setEnd(K.endContainer,K.endOffset),we.setStart(K.startContainer,K.startOffset)):K instanceof tt?we=K.nativeRange:U.implementsDomRange&&K instanceof Ne.getWindow(K.startContainer).Range&&(we=K),we}function Ke(K){if(!K.length||K[0].nodeType!=1)return!1;for(var we=1,Ge=K.length;we<Ge;++we)if(!Ne.isAncestorOf(K[0],K[we]))return!1;return!0}function ze(K){var we=K.getNodes();if(!Ke(we))throw re.createError("getSingleElementFromRange: range "+K.inspect()+" did not consist of a single element");return we[0]}function ht(K){return!!K&&typeof K.text<"u"}function dt(K,we){var Ge=new tt(we);K._ranges=[Ge],Rt(K,Ge,!1),K.rangeCount=1,K.isCollapsed=Ge.collapsed,be(K)}function Ut(K){if(K._ranges.length=0,K.docSelection.type=="None")Ye(K);else{var we=K.docSelection.createRange();if(ht(we))dt(K,we);else{K.rangeCount=we.length;for(var Ge,ct=se(we.item(0)),At=0;At<K.rangeCount;++At)Ge=q.createRange(ct),Ge.selectNode(we.item(At)),K._ranges.push(Ge);K.isCollapsed=K.rangeCount==1&&K._ranges[0].collapsed,Rt(K,K._ranges[K.rangeCount-1],!1),be(K)}}}function bn(K,we){for(var Ge=K.docSelection.createRange(),ct=ze(we),At=se(Ge.item(0)),Zt=Ee(At).createControlRange(),Dn=0,J=Ge.length;Dn<J;++Dn)Zt.add(Ge.item(Dn));try{Zt.add(ct)}catch{throw re.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Zt.select(),Ut(K)}var En;_e(pe,"getRangeAt")?En=function(K,we){try{return K.getRangeAt(we)}catch{return null}}:Fe&&(En=function(K){var we=se(K.anchorNode),Ge=q.createRange(we);return Ge.setStartAndEnd(K.anchorNode,K.anchorOffset,K.focusNode,K.focusOffset),Ge.collapsed!==this.isCollapsed&&Ge.setStartAndEnd(K.focusNode,K.focusOffset,K.anchorNode,K.anchorOffset),Ge});function qt(K,we,Ge){this.nativeSelection=K,this.docSelection=we,this._ranges=[],this.win=Ge,this.refresh()}qt.prototype=q.selectionPrototype;function Hn(K){K.win=K.anchorNode=K.focusNode=K._ranges=null,K.rangeCount=K.anchorOffset=K.focusOffset=0,K.detached=!0,be(K)}var Mn=[];function bo(K,we){for(var Ge=Mn.length,ct,At;Ge--;)if(ct=Mn[Ge],At=ct.selection,we=="deleteAll")Hn(At);else if(ct.win==K)return we=="delete"?(Mn.splice(Ge,1),!0):At;return we=="deleteAll"&&(Mn.length=0),null}var xi=function(K){if(K&&K instanceof qt)return K.refresh(),K;K=Ie(K,"getNativeSelection");var we=bo(K),Ge=De(K),ct=lt?et(K):null;return we?(we.nativeSelection=Ge,we.docSelection=ct,we.refresh()):(we=new qt(Ge,ct,K),Mn.push({win:K,selection:we})),we};q.getSelection=xi,ge.createAliasForDeprecatedMethod(q,"getIframeSelection","getSelection");var kt=qt.prototype;function Ii(K,we){for(var Ge=se(we[0].startContainer),ct=Ee(Ge).createControlRange(),At=0,Zt,Dn=we.length;At<Dn;++At){Zt=ze(we[At]);try{ct.add(Zt)}catch{throw re.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}ct.select(),Ut(K)}if(!de&&Fe&&ge.areHostMethods(pe,["removeAllRanges","addRange"])){kt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Ye(this)};var wi=function(K,we){Ft(K.nativeSelection,we),K.refresh()};at?kt.addRange=function(K,we){if(pn&&lt&&this.docSelection.type==ne)bn(this,K);else if(Le(we)&&Ue)wi(this,K);else{var Ge;bt?Ge=this.rangeCount:(this.removeAllRanges(),Ge=0);var ct=Be(K).cloneRange();try{this.nativeSelection.addRange(ct)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Ge+1){if(q.config.checkSelectionRanges){var At=En(this.nativeSelection,this.rangeCount-1);At&&!fe(At,K)&&(K=new tt(At))}this._ranges[this.rangeCount-1]=K,Rt(this,K,so(this.nativeSelection)),this.isCollapsed=Me(this),be(this)}else this.refresh()}}:kt.addRange=function(K,we){Le(we)&&Ue?wi(this,K):(this.nativeSelection.addRange(Be(K)),this.refresh())},kt.setRanges=function(K){if(pn&&lt&&K.length>1)Ii(this,K);else{this.removeAllRanges();for(var we=0,Ge=K.length;we<Ge;++we)this.addRange(K[we])}}}else if(_e(pe,"empty")&&_e(xe,"select")&&pn&&de)kt.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var K;if(this.anchorNode)K=se(this.anchorNode);else if(this.docSelection.type==ne){var we=this.docSelection.createRange();we.length&&(K=se(we.item(0)))}if(K){var Ge=Ee(K).createTextRange();Ge.select(),this.docSelection.empty()}}}catch{}Ye(this)},kt.addRange=function(K){this.docSelection.type==ne?bn(this,K):(q.WrappedTextRange.rangeToTextRange(K).select(),this._ranges[0]=K,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,Rt(this,K,!1),be(this))},kt.setRanges=function(K){this.removeAllRanges();var we=K.length;we>1?Ii(this,K):we&&this.addRange(K[0])};else return re.fail("No means of selecting a Range or TextRange was found"),!1;kt.getRangeAt=function(K){if(K<0||K>=this.rangeCount)throw new ke("INDEX_SIZE_ERR");return this._ranges[K].cloneRange()};var xo;if(de)xo=function(K){var we;q.isSelectionValid(K.win)?we=K.docSelection.createRange():(we=Ee(K.win.document).createTextRange(),we.collapse(!0)),K.docSelection.type==ne?Ut(K):ht(we)?dt(K,we):Ye(K)};else if(_e(pe,"getRangeAt")&&typeof pe.rangeCount==ve)xo=function(K){if(pn&&lt&&K.docSelection.type==ne)Ut(K);else if(K._ranges.length=K.rangeCount=K.nativeSelection.rangeCount,K.rangeCount){for(var we=0,Ge=K.rangeCount;we<Ge;++we)K._ranges[we]=new q.WrappedRange(K.nativeSelection.getRangeAt(we));Rt(K,K._ranges[K.rangeCount-1],so(K.nativeSelection)),K.isCollapsed=Me(K),be(K)}else Ye(K)};else if(Fe&&typeof pe.isCollapsed==ce&&typeof xe.collapsed==ce&&U.implementsDomRange)xo=function(K){var we,Ge=K.nativeSelection;Ge.anchorNode?(we=En(Ge,0),K._ranges=[we],K.rangeCount=1,Se(K),K.isCollapsed=Me(K),be(K)):Ye(K)};else return re.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;kt.refresh=function(K){var we=K?this._ranges.slice(0):null,Ge=this.anchorNode,ct=this.anchorOffset;if(xo(this),K){var At=we.length;if(At!=this._ranges.length||this.anchorNode!=Ge||this.anchorOffset!=ct)return!0;for(;At--;)if(!fe(we[At],this._ranges[At]))return!0;return!1}};var ro=function(K,we){var Ge=K.getAllRanges();K.removeAllRanges();for(var ct=0,At=Ge.length;ct<At;++ct)fe(we,Ge[ct])||K.addRange(Ge[ct]);K.rangeCount||Ye(K)};pn&&lt?kt.removeRange=function(K){if(this.docSelection.type==ne){for(var we=this.docSelection.createRange(),Ge=ze(K),ct=se(we.item(0)),At=Ee(ct).createControlRange(),Zt,Dn=!1,J=0,I=we.length;J<I;++J)Zt=we.item(J),Zt!==Ge||Dn?At.add(we.item(J)):Dn=!0;At.select(),Ut(this)}else ro(this,K)}:kt.removeRange=function(K){ro(this,K)};var so;!de&&Fe&&U.implementsDomRange?(so=nt,kt.isBackward=function(){return so(this)}):so=kt.isBackward=function(){return!1},kt.isBackwards=kt.isBackward,kt.toString=function(){for(var K=[],we=0,Ge=this.rangeCount;we<Ge;++we)K[we]=""+this._ranges[we];return K.join("")};function Ci(K,we){if(K.win.document!=se(we))throw new ke("WRONG_DOCUMENT_ERR")}function Fi(K,we){if(we<0||we>(Ne.isCharacterDataNode(K)?K.length:K.childNodes.length))throw new ke("INDEX_SIZE_ERR")}kt.collapse=function(K,we){Ci(this,K);var Ge=q.createRange(K);Ge.collapseToPoint(K,we),this.setSingleRange(Ge),this.isCollapsed=!0},kt.collapseToStart=function(){if(this.rangeCount){var K=this._ranges[0];this.collapse(K.startContainer,K.startOffset)}else throw new ke("INVALID_STATE_ERR")},kt.collapseToEnd=function(){if(this.rangeCount){var K=this._ranges[this.rangeCount-1];this.collapse(K.endContainer,K.endOffset)}else throw new ke("INVALID_STATE_ERR")},kt.selectAllChildren=function(K){Ci(this,K);var we=q.createRange(K);we.selectNodeContents(K),this.setSingleRange(we)},qe?kt.setBaseAndExtent=function(K,we,Ge,ct){this.nativeSelection.setBaseAndExtent(K,we,Ge,ct),this.refresh()}:Ue&&(kt.setBaseAndExtent=function(K,we,Ge,ct){Fi(K,we),Fi(Ge,ct),Ci(this,K),Ci(this,Ge);var At=q.createRange(node),Zt=Ne.comparePoints(K,we,Ge,ct)==-1;Zt?At.setStartAndEnd(Ge,ct,K,we):At.setStartAndEnd(K,we,Ge,ct),this.setSingleRange(At,Zt)}),kt.deleteFromDocument=function(){if(pn&&lt&&this.docSelection.type==ne){for(var K=this.docSelection.createRange(),we;K.length;)we=K.item(0),K.remove(we),Ne.removeNode(we);this.refresh()}else if(this.rangeCount){var Ge=this.getAllRanges();if(Ge.length){this.removeAllRanges();for(var ct=0,At=Ge.length;ct<At;++ct)Ge[ct].deleteContents();this.addRange(Ge[At-1])}}},kt.eachRange=function(K,we){for(var Ge=0,ct=this._ranges.length;Ge<ct;++Ge)if(K(this.getRangeAt(Ge)))return we},kt.getAllRanges=function(){var K=[];return this.eachRange(function(we){K.push(we)}),K},kt.setSingleRange=function(K,we){this.removeAllRanges(),this.addRange(K,we)},kt.callMethodOnEachRange=function(K,we){var Ge=[];return this.eachRange(function(ct){Ge.push(ct[K].apply(ct,we||[]))}),Ge};function ur(K){return function(we,Ge){var ct;this.rangeCount?(ct=this.getRangeAt(0),ct["set"+(K?"Start":"End")](we,Ge)):(ct=q.createRange(this.win.document),ct.setStartAndEnd(we,Ge)),this.setSingleRange(ct,this.isBackward())}}kt.setStart=ur(!0),kt.setEnd=ur(!1),q.rangePrototype.select=function(K){xi(this.getDocument()).setSingleRange(this,K)},kt.changeEachRange=function(K){var we=[],Ge=this.isBackward();this.eachRange(function(ct){K(ct),we.push(ct)}),this.removeAllRanges(),Ge&&we.length==1?this.addRange(we[0],"backward"):this.setRanges(we)},kt.containsNode=function(K,we){return this.eachRange(function(Ge){return Ge.containsNode(K,we)},!0)||!1},kt.getBookmark=function(K){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[K])}},kt.moveToBookmark=function(K){for(var we=[],Ge=0,ct,At;ct=K.rangeBookmarks[Ge++];)At=q.createRange(this.win),At.moveToBookmark(ct),we.push(At);K.backward?this.setSingleRange(we[0],"backward"):this.setRanges(we)},kt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},kt.restoreRanges=function(K){this.removeAllRanges();for(var we=0,Ge;Ge=K.ranges[we];++we)this.addRange(Ge,K.backward&&we==0)},kt.toHtml=function(){var K=[];return this.eachRange(function(we){K.push(st.toHtml(we))}),K.join("")},U.implementsTextRange&&(kt.getNativeTextRange=function(){var K;if(K=this.docSelection){var we=K.createRange();if(ht(we))return we;throw re.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return q.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw re.createError("getNativeTextRange: selection contains no range")}});function Io(K){var we=[],Ge=new he(K.anchorNode,K.anchorOffset),ct=new he(K.focusNode,K.focusOffset),At=typeof K.getName=="function"?K.getName():"Selection";if(typeof K.rangeCount<"u")for(var Zt=0,Dn=K.rangeCount;Zt<Dn;++Zt)we[Zt]=st.inspect(K.getRangeAt(Zt));return"["+At+"(Ranges: "+we.join(", ")+")(anchor: "+Ge.inspect()+", focus: "+ct.inspect()+"]"}kt.getName=function(){return"WrappedSelection"},kt.inspect=function(){return Io(this)},kt.detach=function(){bo(this.win,"delete"),Hn(this)},qt.detachAll=function(){bo(null,"deleteAll")},qt.inspect=Io,qt.isDirectionBackward=Le,q.Selection=qt,q.selectionPrototype=kt,q.addShimListener(function(K){typeof K.getSelection>"u"&&(K.getSelection=function(){return xi(K)}),K=null})});var ue=!1,te=function(q){ue||(ue=!0,!O.initialized&&O.config.autoInitialize&&M())};return D&&(document.readyState=="complete"?te():(u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",te,!1),B(window,"load",te))),O})})(Ld)),Ld.exports}var gJ=Sm();const jv=Ms(gJ);var Id={exports:{}},Vv;function _J(){return Vv||(Vv=1,(function(n,e){(function(t,o){n.exports=t(Sm())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(o,i){var r=o.dom,s=r.DomPosition,a=r.arrayContains,l=o.util,u=l.forEach,c="span",f=l.isHostMethod(document,"createElementNS");function p(U,ne){for(var se in U)if(U.hasOwnProperty(se)&&ne(se,U[se])===!1)return!1;return!0}function h(U){return U.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function v(U,ne){return!!U&&new RegExp("(?:^|\\s)"+ne+"(?:\\s|$)").test(U)}function _(U,ne){if(typeof U.classList=="object")return U.classList.contains(ne);var se=typeof U.className=="string",Ee=se?U.className:U.getAttribute("class");return v(Ee,ne)}function m(U,ne){if(typeof U.classList=="object")U.classList.add(ne);else{var se=typeof U.className=="string",Ee=se?U.className:U.getAttribute("class");Ee?v(Ee,ne)||(Ee+=" "+ne):Ee=ne,se?U.className=Ee:U.setAttribute("class",Ee)}}var g=(function(){function U(ne,se,Ee){return se&&Ee?" ":""}return function(ne,se){if(typeof ne.classList=="object")ne.classList.remove(se);else{var Ee=typeof ne.className=="string",fe=Ee?ne.className:ne.getAttribute("class");fe=fe.replace(new RegExp("(^|\\s)"+se+"(\\s|$)"),U),Ee?ne.className=fe:ne.setAttribute("class",fe)}}})();function b(U){var ne=typeof U.className=="string";return ne?U.className:U.getAttribute("class")}function C(U){return U&&U.split(/\s+/).sort().join(" ")}function D(U){return C(b(U))}function T(U,ne){return D(U)==D(ne)}function O(U,ne){for(var se=ne.split(/\s+/),Ee=0,fe=se.length;Ee<fe;++Ee)if(!_(U,h(se[Ee])))return!1;return!0}function k(U){var ne=U.parentNode;return ne&&ne.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(ne.nodeName)}function S(U,ne,se,Ee,fe){var Le=U.node,Ie=U.offset,Ve=Le,et=Ie;Le==Ee&&Ie>fe&&++et,Le==ne&&(Ie==se||Ie==se+1)&&(Ve=Ee,et+=fe-se),Le==ne&&Ie>se+1&&--et,U.node=Ve,U.offset=et}function N(U,ne,se){U.node==ne&&U.offset>se&&--U.offset}function L(U,ne,se,Ee){se==-1&&(se=ne.childNodes.length);var fe=U.parentNode,Le=r.getNodeIndex(U);u(Ee,function(Ie){S(Ie,fe,Le,ne,se)}),ne.childNodes.length==se?ne.appendChild(U):ne.insertBefore(U,ne.childNodes[se])}function $(U,ne){var se=U.parentNode,Ee=r.getNodeIndex(U);u(ne,function(fe){N(fe,se,Ee)}),r.removeNode(U)}function B(U,ne,se,Ee,fe){for(var Le,Ie=[];Le=U.firstChild;)L(Le,ne,se++,fe),Ie.push(Le);return $(U,fe),Ie}function E(U,ne){return B(U,U.parentNode,r.getNodeIndex(U),!0,ne)}function A(U,ne){var se=U.cloneRange();se.selectNodeContents(ne);var Ee=se.intersection(U),fe=Ee?Ee.toString():"";return fe!=""}function M(U){for(var ne=U.getNodes([3]),se=0,Ee;(Ee=ne[se])&&!A(U,Ee);)++se;for(var fe=ne.length-1;(Ee=ne[fe])&&!A(U,Ee);)--fe;return ne.slice(se,fe+1)}function F(U,ne){if(U.attributes.length!=ne.attributes.length)return!1;for(var se=0,Ee=U.attributes.length,fe,Le,Ie;se<Ee;++se)if(fe=U.attributes[se],Ie=fe.name,Ie!="class"&&(Le=ne.attributes.getNamedItem(Ie),fe===null!=(Le===null)||fe.specified!=Le.specified||fe.specified&&fe.nodeValue!==Le.nodeValue))return!1;return!0}function H(U,ne){for(var se=0,Ee=U.attributes.length,fe;se<Ee;++se)if(fe=U.attributes[se].name,!(ne&&a(ne,fe))&&U.attributes[se].specified&&fe!="class")return!0;return!1}var R=r.getComputedStyleProperty,G=(function(){var U=document.createElement("div");return typeof U.isContentEditable=="boolean"?function(ne){return ne&&ne.nodeType==1&&ne.isContentEditable}:function(ne){return!ne||ne.nodeType!=1||ne.contentEditable=="false"?!1:ne.contentEditable=="true"||G(ne.parentNode)}})();function oe(U){var ne;return U&&U.nodeType==1&&((ne=U.parentNode)&&ne.nodeType==9&&ne.designMode=="on"||G(U)&&!G(U.parentNode))}function V(U){return(G(U)||U.nodeType!=1&&G(U.parentNode))&&!oe(U)}var Y=/^inline(-block|-table)?$/i;function Q(U){return U&&U.nodeType==1&&!Y.test(R(U,"display"))}var ue=/[^\r\n\t\f \u200B]/;function te(U){if(U.data.length==0)return!0;if(ue.test(U.data))return!1;var ne=R(U.parentNode,"whiteSpace");switch(ne){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(U.data))return!1}return Q(U.previousSibling)||Q(U.nextSibling)}function q(U){var ne=[],se,Ee;for(se=0;Ee=U[se++];)ne.push(new s(Ee.startContainer,Ee.startOffset),new s(Ee.endContainer,Ee.endOffset));return ne}function re(U,ne){for(var se=0,Ee,fe,Le,Ie=U.length;se<Ie;++se)Ee=U[se],fe=ne[se*2],Le=ne[se*2+1],Ee.setStartAndEnd(fe.node,fe.offset,Le.node,Le.offset)}function ce(U,ne){return r.isCharacterDataNode(U)?ne==0?!!U.previousSibling:ne==U.length?!!U.nextSibling:!0:ne>0&&ne<U.childNodes.length}function ve(U,ne,se,Ee){var fe,Le,Ie=se==0;if(r.isAncestorOf(ne,U))return U;if(r.isCharacterDataNode(ne)){var Ve=r.getNodeIndex(ne);if(se==0)se=Ve;else if(se==ne.length)se=Ve+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+se+" in "+ne.data);ne=ne.parentNode}if(ce(ne,se)){fe=ne.cloneNode(!1),Le=ne.parentNode,fe.id&&fe.removeAttribute("id");for(var et,nt=0;et=ne.childNodes[se];)L(et,fe,nt++,Ee);return L(fe,Le,r.getNodeIndex(ne)+1,Ee),ne==U?fe:ve(U,Le,r.getNodeIndex(fe),Ee)}else if(U!=ne){fe=ne.parentNode;var We=r.getNodeIndex(ne);return Ie||We++,ve(U,fe,We,Ee)}return U}function Ne(U,ne){return U.namespaceURI==ne.namespaceURI&&U.tagName.toLowerCase()==ne.tagName.toLowerCase()&&T(U,ne)&&F(U,ne)&&R(U,"display")=="inline"&&R(ne,"display")=="inline"}function ge(U){var ne=U?"nextSibling":"previousSibling";return function(se,Ee){var fe=se.parentNode,Le=se[ne];if(Le){if(Le&&Le.nodeType==3)return Le}else if(Ee&&(Le=fe[ne],Le&&Le.nodeType==1&&Ne(fe,Le))){var Ie=Le[U?"firstChild":"lastChild"];if(Ie&&Ie.nodeType==3)return Ie}return null}}var _e=ge(!1),st=ge(!0);function tt(U){this.isElementMerge=U.nodeType==1,this.textNodes=[];var ne=this.isElementMerge?U.lastChild:U;ne&&(this.textNodes[0]=ne)}tt.prototype={doMerge:function(U){var ne=this.textNodes,se=ne[0];if(ne.length>1){var Ee=r.getNodeIndex(se),fe=[],Le=0,Ie;u(ne,function(Ve,et){Ie=Ve.parentNode,et>0&&(Ie.removeChild(Ve),Ie.hasChildNodes()||r.removeNode(Ie),U&&u(U,function(nt){nt.node==Ve&&(nt.node=se,nt.offset+=Le),nt.node==Ie&&nt.offset>Ee&&(--nt.offset,nt.offset==Ee+1&&et<ne.length-1&&(nt.node=se,nt.offset=Le))})),fe[et]=Ve.data,Le+=Ve.data.length}),se.data=fe.join("")}return se.data},getLength:function(){for(var U=this.textNodes.length,ne=0;U--;)ne+=this.textNodes[U].length;return ne},toString:function(){var U=[];return u(this.textNodes,function(ne,se){U[se]="'"+ne.data+"'"}),"[Merge("+U.join(",")+")]"}};var ke=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],he={};function De(U,ne,se){var Ee,fe,Le,Ie,Ve=this;Ve.cssClass=Ve.className=U;var et=null,nt={};if(typeof ne=="object"&&ne!==null){for(typeof ne.elementTagName<"u"&&(ne.elementTagName=ne.elementTagName.toLowerCase()),se=ne.tagNames,et=ne.elementProperties,nt=ne.elementAttributes,fe=0;Ie=ke[fe++];)ne.hasOwnProperty(Ie)&&(Ve[Ie]=ne[Ie]);Ee=ne.normalize}else Ee=ne;Ve.normalize=typeof Ee>"u"?!0:Ee,Ve.attrExceptions=[];var We=document.createElement(Ve.elementTagName);Ve.elementProperties=Ve.copyPropertiesToElement(et,We,!0),p(nt,function(de,pe){Ve.attrExceptions.push(de),nt[de]=""+pe}),Ve.elementAttributes=nt,Ve.elementSortedClassName=Ve.elementProperties.hasOwnProperty("className")?C(Ve.elementProperties.className+" "+U):U,Ve.applyToAnyTagName=!1;var lt=typeof se;if(lt=="string")se=="*"?Ve.applyToAnyTagName=!0:Ve.tagNames=h(se.toLowerCase()).split(/\s*,\s*/);else if(lt=="object"&&typeof se.length=="number")for(Ve.tagNames=[],fe=0,Le=se.length;fe<Le;++fe)se[fe]=="*"?Ve.applyToAnyTagName=!0:Ve.tagNames.push(se[fe].toLowerCase());else Ve.tagNames=[Ve.elementTagName]}De.prototype={elementTagName:c,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(U,ne,se){var Ee,fe,Le={},Ie,Ve,et,nt;for(var We in U)if(U.hasOwnProperty(We))if(Ve=U[We],et=ne[We],We=="className")m(ne,Ve),m(ne,this.className),ne[We]=C(ne[We]),se&&(Le[We]=Ve);else if(We=="style"){fe=et,se&&(Le[We]=Ie={});for(Ee in U[We])U[We].hasOwnProperty(Ee)&&(fe[Ee]=Ve[Ee],se&&(Ie[Ee]=fe[Ee]));this.attrExceptions.push(We)}else ne[We]=Ve,se&&(Le[We]=ne[We],nt=he.hasOwnProperty(We)?he[We]:We,this.attrExceptions.push(nt));return se?Le:""},copyAttributesToElement:function(U,ne){for(var se in U)U.hasOwnProperty(se)&&!/^class(?:Name)?$/i.test(se)&&ne.setAttribute(se,U[se])},appliesToElement:function(U){return a(this.tagNames,U.tagName.toLowerCase())},getEmptyElements:function(U){var ne=this;return U.getNodes([1],function(se){return ne.appliesToElement(se)&&!se.hasChildNodes()})},hasClass:function(U){return U.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(U))&&_(U,this.className)},getSelfOrAncestorWithClass:function(U){for(;U;){if(this.hasClass(U))return U;U=U.parentNode}return null},isModifiable:function(U){return!this.applyToEditableOnly||V(U)},isIgnorableWhiteSpaceNode:function(U){return this.ignoreWhiteSpace&&U&&U.nodeType==3&&te(U)},postApply:function(U,ne,se,Ee){var fe=U[0],Le=U[U.length-1],Ie=[],Ve,et=fe,nt=Le,We=0,lt=Le.length,de;u(U,function(Fe){de=_e(Fe,!Ee),de?(Ve||(Ve=new tt(de),Ie.push(Ve)),Ve.textNodes.push(Fe),Fe===fe&&(et=Ve.textNodes[0],We=et.length),Fe===Le&&(nt=Ve.textNodes[0],lt=Ve.getLength())):Ve=null});var pe=st(Le,!Ee);if(pe&&(Ve||(Ve=new tt(Le),Ie.push(Ve)),Ve.textNodes.push(pe)),Ie.length){for(var xe=0,Ce=Ie.length;xe<Ce;++xe)Ie[xe].doMerge(se);ne.setStartAndEnd(et,We,nt,lt)}},createContainer:function(U){var ne=r.getDocument(U),se=f&&!r.isHtmlNamespace(U)&&U.namespaceURI?ne.createElementNS(U.namespaceURI,this.elementTagName):ne.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,se,!1),this.copyAttributesToElement(this.elementAttributes,se),m(se,this.className),this.onElementCreate&&this.onElementCreate(se,this),se},elementHasProperties:function(U,ne){var se=this;return p(ne,function(Ee,fe){if(Ee=="className")return O(U,fe);if(typeof fe=="object"){if(!se.elementHasProperties(U[Ee],fe))return!1}else if(U[Ee]!==fe)return!1})},elementHasAttributes:function(U,ne){return p(ne,function(se,Ee){if(U.getAttribute(se)!==Ee)return!1})},applyToTextNode:function(U,ne){if(k(U)){var se=U.parentNode;if(se.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(se)&&this.elementHasProperties(se,this.elementProperties)&&this.elementHasAttributes(se,this.elementAttributes))m(se,this.className);else{var Ee=U.parentNode,fe=this.createContainer(Ee);Ee.insertBefore(fe,U),fe.appendChild(U)}}},isRemovable:function(U){return U.tagName.toLowerCase()==this.elementTagName&&D(U)==this.elementSortedClassName&&this.elementHasProperties(U,this.elementProperties)&&!H(U,this.attrExceptions)&&this.elementHasAttributes(U,this.elementAttributes)&&this.isModifiable(U)},isEmptyContainer:function(U){var ne=U.childNodes.length;return U.nodeType==1&&this.isRemovable(U)&&(ne==0||ne==1&&this.isEmptyContainer(U.firstChild))},removeEmptyContainers:function(U){var ne=this,se=U.getNodes([1],function(Le){return ne.isEmptyContainer(Le)}),Ee=[U],fe=q(Ee);u(se,function(Le){$(Le,fe)}),re(Ee,fe)},undoToTextNode:function(U,ne,se,Ee){if(!ne.containsNode(se)){var fe=ne.cloneRange();fe.selectNode(se),fe.isPointInRange(ne.endContainer,ne.endOffset)&&(ve(se,ne.endContainer,ne.endOffset,Ee),ne.setEndAfter(se)),fe.isPointInRange(ne.startContainer,ne.startOffset)&&(se=ve(se,ne.startContainer,ne.startOffset,Ee))}this.isRemovable(se)?E(se,Ee):g(se,this.className)},splitAncestorWithClass:function(U,ne,se){var Ee=this.getSelfOrAncestorWithClass(U);Ee&&ve(Ee,U,ne,se)},undoToAncestor:function(U,ne){this.isRemovable(U)?E(U,ne):g(U,this.className)},applyToRange:function(U,ne){var se=this;ne=ne||[];var Ee=q(ne||[]);U.splitBoundariesPreservingPositions(Ee),se.removeEmptyElements&&se.removeEmptyContainers(U);var fe=M(U);if(fe.length){u(fe,function(Ve){!se.isIgnorableWhiteSpaceNode(Ve)&&!se.getSelfOrAncestorWithClass(Ve)&&se.isModifiable(Ve)&&se.applyToTextNode(Ve,Ee)});var Le=fe[fe.length-1];U.setStartAndEnd(fe[0],0,Le,Le.length),se.normalize&&se.postApply(fe,U,Ee,!1),re(ne,Ee)}var Ie=se.getEmptyElements(U);u(Ie,function(Ve){m(Ve,se.className)})},applyToRanges:function(U){for(var ne=U.length;ne--;)this.applyToRange(U[ne],U);return U},applyToSelection:function(U){var ne=o.getSelection(U);ne.setRanges(this.applyToRanges(ne.getAllRanges()))},undoToRange:function(U,ne){var se=this;ne=ne||[];var Ee=q(ne);U.splitBoundariesPreservingPositions(Ee),se.removeEmptyElements&&se.removeEmptyContainers(U,Ee);var fe=M(U),Le,Ie,Ve=fe[fe.length-1];if(fe.length){se.splitAncestorWithClass(U.endContainer,U.endOffset,Ee),se.splitAncestorWithClass(U.startContainer,U.startOffset,Ee);for(var et=0,nt=fe.length;et<nt;++et)Le=fe[et],Ie=se.getSelfOrAncestorWithClass(Le),Ie&&se.isModifiable(Le)&&se.undoToAncestor(Ie,Ee);U.setStartAndEnd(fe[0],0,Ve,Ve.length),se.normalize&&se.postApply(fe,U,Ee,!0),re(ne,Ee)}var We=se.getEmptyElements(U);u(We,function(lt){g(lt,se.className)})},undoToRanges:function(U){for(var ne=U.length;ne--;)this.undoToRange(U[ne],U);return U},undoToSelection:function(U){var ne=o.getSelection(U),se=o.getSelection(U).getAllRanges();this.undoToRanges(se),ne.setRanges(se)},isAppliedToRange:function(U){if(U.collapsed||U.toString()=="")return!!this.getSelfOrAncestorWithClass(U.commonAncestorContainer);var ne=U.getNodes([3]);if(ne.length){for(var se=0,Ee;Ee=ne[se++];)if(!this.isIgnorableWhiteSpaceNode(Ee)&&A(U,Ee)&&this.isModifiable(Ee)&&!this.getSelfOrAncestorWithClass(Ee))return!1}return!0},isAppliedToRanges:function(U){var ne=U.length;if(ne==0)return!1;for(;ne--;)if(!this.isAppliedToRange(U[ne]))return!1;return!0},isAppliedToSelection:function(U){var ne=o.getSelection(U);return this.isAppliedToRanges(ne.getAllRanges())},toggleRange:function(U){this.isAppliedToRange(U)?this.undoToRange(U):this.applyToRange(U)},toggleSelection:function(U){this.isAppliedToSelection(U)?this.undoToSelection(U):this.applyToSelection(U)},getElementsWithClassIntersectingRange:function(U){var ne=[],se=this;return U.getNodes([3],function(Ee){var fe=se.getSelfOrAncestorWithClass(Ee);fe&&!a(ne,fe)&&ne.push(fe)}),ne},detach:function(){}};function Me(U,ne,se){return new De(U,ne,se)}De.util={hasClass:_,addClass:m,removeClass:g,getClass:b,hasSameClasses:T,hasAllClasses:O,replaceWithOwnChildren:E,elementsHaveSameNonClassAttributes:F,elementHasNonClassAttributes:H,splitNodeAt:ve,isEditableElement:G,isEditingHost:oe,isEditable:V},o.CssClassApplier=o.ClassApplier=De,o.createClassApplier=Me,l.createAliasForDeprecatedMethod(o,"createCssClassApplier","createClassApplier",i)}),t})})(Id)),Id.exports}_J();var Hv={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},Uv=Ou.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var n=this;jv.init(),Ou.extensions.button.prototype.init.call(this),this.colorPicker=new Cm({parent:this.button,color:"#000",onDone:function(e){n.coloredText&&n.coloredText.isAppliedToSelection()&&n.coloredText.undoToSelection(),n.coloredText=jv.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),n.coloredText.toggleSelection(),n.base.checkContentChanged(),n.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(n){return n.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),mJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),yJ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},zv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},qv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};(function(n){mJ(e,n);function e(t){var o=n.call(this,t)||this;o.labelMap=new Map;var i=t.lf,r=t.graphModel;return o.lf=i,o.graphModel=r,o.state={tick:0},o}return e.prototype.componentDidMount=function(){var t=this,o=this.props.graphModel;this.editor=new Ou(".lf-label-editor",ss(Hv,{autoLink:!0,extensions:{colorPicker:new Uv}})),o.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),o.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new Ou(".lf-label-editor",ss(Hv,{autoLink:!0,extensions:{colorPicker:new Uv}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,o=this.props,i=o.lf.extension,r=o.graphModel,s=qv(qv([],zv(r.nodes),!1),zv(r.edges),!1),a=i.label;if(a){var l=[];return Lt(s,function(u){var c,f,p=u.getData(),h=(f=(c=p.properties)===null||c===void 0?void 0:c._label)!==null&&f!==void 0?f:[];Lt(h,function(v){var _=t.labelMap,m=new sJ(v,u,r);_.set(m.id,m),l.push(Re(iJ,{label:m,element:u,graphModel:r},m.id))})}),l}return null},e.prototype.render=function(){return Re("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=yJ([eo],e),e})(Yt);var bJ=(function(){function n(e){var t=e.lf,o=this;this.lf=t,this.lf.setPatternItems=function(i){o.setPatternItems(i)}}return n.prototype.render=function(e,t){var o=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.panelEl.addEventListener("touchmove",function(i){i.preventDefault()},{passive:!1}),this.shapeList.forEach(function(i){var r;(r=o.panelEl)===null||r===void 0||r.appendChild(o.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},n.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},n.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},n.prototype.createDndItem=function(e){var t=this,o=document.createElement("div");o.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),o.appendChild(i),e.label){var r=document.createElement("div");r.innerText=e.label,r.className="lf-dnd-text",o.appendChild(r)}return e.disabled?(o.classList.add("disabled"),o.onpointerdown=function(){e.callback&&e.callback(t.lf,t.domContainer)},o):(o.onpointerdown=function(s){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer),s.preventDefault()},o.ondblclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:s,data:e})},o.onclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:s,data:e})},o.oncontextmenu=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:s,data:e})},o)},n.pluginName="dndPanel",n})(),xJ=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wJ=(function(){function n(e){var t=e.lf,o=e.LogicFlow,i=e.options,r=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){r.updateViewPortBounds(),r.isShow&&r.updateViewPort()},this.render=function(a,l){r.container=l,r.lf.on("history:change",function(){r.isShow&&r.setView()}),r.lf.on("graph:transform",function(){r.isShow&&r.setView(!1)})},this.show=function(a,l){r.isShow||(r.initMiniMap(),r.lf.on("graph:resize",r.onGraphResize),r.createMiniMap(a,l),r.setView(!0)),r.isShow=!0},this.hide=function(){r.isShow&&(r.lf.off("graph:resize",r.onGraphResize),r.lfMap.destroy(),r.translateX=0,r.translateY=0,r.removeMiniMap(),r.lf.emit("miniMap:close",{})),r.isShow=!1},this.updatePosition=function(a){if(typeof a=="object")(a.left!==void 0||a.right!==void 0)&&(r.leftPosition=a.left,r.rightPosition=a.right),(a.top!==void 0||a.bottom!==void 0)&&(r.topPosition=a.top,r.bottomPosition=a.bottom);else switch(a){case"left-top":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=0,r.bottomPosition=void 0;break;case"right-top":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=0,r.bottomPosition=void 0;break;case"left-bottom":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=void 0,r.bottomPosition=0;break;case"right-bottom":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=void 0,r.bottomPosition=0;break}r.updateMiniMapPosition()},this.reset=function(){r.lf.resetTranslate(),r.lf.resetZoom()},this.setShowEdge=function(a){r.showEdge!==a&&(r.showEdge=a,r.setView())},this.startDrag=function(a){document.addEventListener("pointermove",r.drag),document.addEventListener("pointerup",r.drop);var l=a.x,u=a.y;r.startPosition={x:l,y:u}},this.drag=function(a){var l=a.x,u=a.y,c=(l-r.startPosition.x)/r.scale,f=(u-r.startPosition.y)/r.scale,p=r.viewPortLeft+c+r.viewPortWidth/r.scale/2,h=r.viewPortTop+f+r.viewPortHeight/r.scale/2;r.startPosition={x:l,y:u},r.lf.focusOn({coordinate:{x:p,y:h}})},this.drop=function(){document.removeEventListener("pointermove",r.drag),document.removeEventListener("pointerup",r.drop)},this.mapClick=function(a){var l=a.offsetX,u=a.offsetY,c=r.translateX+l/r.scale,f=r.translateY+u/r.scale;r.lf.focusOn({coordinate:{x:c,y:f}})},this.lf=t,this.LFCtor=o,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var s={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=s,this.elementAreaBounds=s,this.viewPortBounds=s}return n.prototype.setOption=function(e){var t=e.width,o=t===void 0?150:t,i=e.height,r=i===void 0?220:i,s=e.showEdge,a=s===void 0?!1:s,l=e.isShowHeader,u=l===void 0?!1:l,c=e.isShowCloseIcon,f=c===void 0?!1:c,p=e.leftPosition,h=e.topPosition,v=e.rightPosition,_=v===void 0?0:v,m=e.bottomPosition,g=m===void 0?0:m,b=e.headerTitle,C=b===void 0?"导航":b;this.width=o,this.height=r,this.showEdge=a,this.isShowHeader=u,this.isShowCloseIcon=f,this.leftPosition=p,this.rightPosition=p!==void 0?void 0:_,this.topPosition=h,this.bottomPosition=h!==void 0?void 0:g,this.headerTitle=C},n.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins,isMiniMap:!0}),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},n.prototype.createMiniMap=function(e,t){var o,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(o=this.container)===null||o===void 0||o.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var r=document.createElement("div");r.className="lf-mini-map-header",r.innerText=this.headerTitle,i.appendChild(r);var s=document.createElement("span");s.className="lf-mini-map-close",s.addEventListener("click",this.hide),i.appendChild(s)},n.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},n.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},n.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},n.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},o=e.nodes;o&&o.length>0&&o.forEach(function(i){var r,s,a=i.x,l=i.y,u=(r=i.width)!==null&&r!==void 0?r:200,c=(s=i.height)!==null&&s!==void 0?s:200,f=a-u/2,p=a+u/2,h=l-c/2,v=l+c/2;t.left=Math.min(f,t.left),t.right=Math.max(p,t.right),t.top=Math.min(h,t.top),t.bottom=Math.max(v,t.bottom)}),this.elementAreaBounds=t},n.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,o=e.TRANSLATE_Y,i=e.SCALE_X,r=e.SCALE_Y,s=this.lf.graphModel,a=s.width,l=s.height;this.viewPortBounds={left:-t/i,right:(-t+a)/i,top:-o/r,bottom:(-o+l)/r}},n.prototype.resetData=function(e){var t=e.nodes,o=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&o.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?o:[]}},n.prototype.setView=function(e){var t,o;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),r=this.resetData(i),s=this.lf.viewMap,a=this.lf.graphModel.modelMap,l=this.lfMap.viewMap;try{for(var u=xJ(s.keys()),c=u.next();!c.done;c=u.next()){var f=c.value;l.has(f)||this.lfMap.register({type:f,view:s.get(f),model:a.get(f)})}}catch(N){t={error:N}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(t)throw t.error}}this.lfMap.render(r),this.updateBounds(r)}else this.updateBounds();var p=this.bounds,h=p.left,v=p.top,_=p.right,m=p.bottom,g=_-h,b=m-v,C=this.width/g,D=this.height/b,T=Math.min(C,D);this.scale=T;var O=h-(this.width/T-g)/2,k=v-(this.height/T-b)/2;if(this.lfMap.graphModel.transformModel.translate(-O+this.translateX,-k+this.translateY),this.translateX=O,this.translateY=k,this.miniMapWrap.firstChild){var S=this.miniMapWrap.firstChild.style;S.pointerEvents="none",S.transform="matrix(".concat(T,", 0, 0, ").concat(T,", 0, 0)"),S.transformOrigin="left top",S.height="".concat(this.height/T,"px"),S.width="".concat(this.width/T,"px"),this.updateViewPort()}},n.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),o=t.TRANSLATE_X,i=t.TRANSLATE_Y,r=t.SCALE_X,s=t.SCALE_Y,a=this.lf.graphModel,l=a.width,u=a.height;this.viewPortLeft=-o/r,this.viewPortTop=-i/s,this.viewPortWidth=l/r*this.scale,this.viewPortHeight=u/s*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},n.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.style.touchAction="none",e.addEventListener("pointerdown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},n.prototype.destroy=function(){this.lf.off("graph:resize",this.onGraphResize)},n.pluginName="miniMap",n})(),Gv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Xv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},CJ=(function(){function n(e){var t=e.lf,o=e.options,i=this,r;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.originStatusSaved=!1,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(s){var a=s.e;i.handleMouseDown(a)},this.draw=function(s){if(i.lf.graphModel.editConfigModel.isPinching){i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.cleanupSelectionState();return}var a=i.lf.getPointByClient(s.clientX,s.clientY).domOverlayPosition,l=a.x,u=a.y;if(i.endPoint={x:l,y:u},i.startPoint){var c=i.startPoint,f=c.x,p=c.y,h=f,v=p,_=l-f,m=u-p;l<f&&(h=l,_=f-l),u<p&&(v=u,m=p-u),i.wrapper&&(i.wrapper.style.left="".concat(h,"px"),i.wrapper.style.top="".concat(v,"px"),i.wrapper.style.width="".concat(_,"px"),i.wrapper.style.height="".concat(m,"px"))}},this.drawOff=function(s){if(i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.mouseDownInfo){var a=i.mouseDownInfo,l=a.x,u=a.y,c=a.time,f=Math.abs(s.clientX-l)<5&&Math.abs(s.clientY-u)<5&&Date.now()-c<200;if(f){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var p=Dt(i.startPoint),h=Dt(i.endPoint);if(document.removeEventListener("pointermove",i.draw),i.exclusiveMode||document.removeEventListener("pointerup",i.drawOff),p&&h){var l=p.x,u=p.y,v=h.x,_=h.y,m=[Math.min(l,v),Math.min(u,_)],g=[Math.max(l,v),Math.max(u,_)];if(i.lf.emit("selection:selected-area",{topLeft:m,bottomRight:g}),Math.abs(v-l)<10&&Math.abs(_-u)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var b=i.lf.graphModel.getAreaElement(m,g,i.isWholeEdge,i.isWholeNode,!0),C=i.lf.graphModel,D=C.dynamicGroup,T=C.group,O=[],k=i.lf.getSelectElements(),S=new Set(Xv(Xv([],Gv(k.nodes.map(function($){return $.id})),!1),Gv(k.edges.map(function($){return $.id})),!1));b.forEach(function($){if(T){var B=T.getNodeGroup($.id);if(b.includes(B))return}if(D){var B=D.getGroupByNodeId($.id);if(b.includes(B))return}if(i.exclusiveMode&&S.has($.id)){i.lf.deselectElementById($.id);return}i.lf.selectElementById($.id,!0),O.push($)}),i.startPoint=void 0,i.endPoint=void 0,O.length>0&&i.lf.emit("selection:drop",{e:s}),i.lf.emit("selection:selected",{elements:O,leftTopPoint:m,rightBottomPoint:g})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(r=o==null?void 0:o.exclusiveMode)!==null&&r!==void 0?r:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(s){i.setExclusiveMode(s)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return n.prototype.render=function(e,t){this.container=t},n.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("pointermove",this.draw),document.removeEventListener("pointerup",this.drawOff)},n.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},n.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.style.touchAction="none",this.container.addEventListener("pointerdown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},n.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("pointerdown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},n.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)&&!this.lf.graphModel.editConfigModel.isPinching){var o=e.button===2;if(!o){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originStatusSaved||(this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.originStatusSaved=!0),this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,r=i.x,s=i.y;this.startPoint={x:r,y:s},this.endPoint={x:r,y:s};var a=document.createElement("div");a.className="lf-selection-select",a.oncontextmenu=function(u){u.preventDefault()},a.style.top="".concat(this.startPoint.y,"px"),a.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(a),this.wrapper=a,document.addEventListener("pointermove",this.draw),document.addEventListener("pointerup",this.drawOff)}}},n.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},n.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},n.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=Dt(this.endPoint),t=new PointerEvent("pointerup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},n.prototype.open=function(){this.disabled=!1},n.prototype.close=function(){this.disabled=!0},n.pluginName="selectionSelect",n})();var km=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ts=function(){return ts=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ts.apply(this,arguments)},ga=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},SJ={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function kJ(n){for(var e=n,t=1;t<e.length-1;){var o=ga(e[t-1],2),i=o[0],r=o[1],s=ga(e[t],2),a=s[0],l=s[1],u=ga(e[t+1],2),c=u[0],f=u[1];i===a&&a===c||r===l&&l===f?e.splice(t,1):t++}return e}function EJ(n,e,t,o){var i=[n[0],n[1]],r=[n[0],n[1]];switch(t){case"tl":return e==="tr"?(i[1]+=o,r[0]+=o):e==="lb"&&(i[0]+=o,r[1]+=o),[i,r];case"tr":return e==="tl"?(i[1]+=o,r[0]-=o):e==="rb"&&(i[0]-=o,r[1]+=o),[i,r];case"bl":return e==="br"?(i[1]-=o,r[0]+=o):e==="lt"&&(i[0]+=o,r[1]-=o),[i,r];case"br":return e==="bl"?(i[1]-=o,r[0]-=o):e==="rt"&&(i[0]-=o,r[1]-=o),[i,r];default:return[]}}function DJ(n,e,t,o){var i,r="",s="";n[0]===e[0]?r=n[1]>e[1]?"t":"b":n[1]===e[1]&&(r=n[0]>e[0]?"l":"r"),e[0]===t[0]?s=e[1]>t[1]?"t":"b":e[1]===t[1]&&(s=e[0]>t[0]?"l":"r");var a=Math.min(Math.hypot(e[0]-n[0],e[1]-n[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,o)||1/5*o,l="".concat(r).concat(s),u=SJ[l]||"-",c="L ".concat(n[0]," ").concat(n[1]);if(u==="-")c+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var f=ga(EJ(e,l,u,a),2),p=f[0],h=f[1];p&&h&&(c+="L ".concat(p[0]," ").concat(p[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(h[0]," ").concat(h[1]),i=ga(h,2),e[0]=i[0],e[1]=i[1])}return c}function AJ(n,e){var t=0,o="";if(n.length===2)o+="M".concat(n[t][0]," ").concat(n[t++][1]," L ").concat(n[t][0]," ").concat(n[t][1]);else{for(o+="M".concat(n[t][0]," ").concat(n[t++][1]);t+1<n.length;){var i=n[t-1],r=n[t],s=n[t+++1];o+=DJ(i,r,s,e)}o+="L ".concat(n[t][0]," ").concat(n[t][1])}return o}(function(n){km(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.radius,a=s===void 0?5:s,l=t.getEdgeStyle(),u=t.getEdgeAnimationStyle(),c=kJ(o.split(" ").map(function(h){return h.split(",").map(function(v){return+v})})),f=AJ(c,a),p=ts(ts(ts({style:i?u:{}},l),r),{fill:"none"});return Ze("path",ts({d:f},p))},e})(Ss);(function(n){km(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(ws);var Em=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Nu=function(){return Nu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nu.apply(this,arguments)},Wv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Yv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},OJ=(function(n){Em(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.id,i=t.x,r=t.y,s=t.width,a=t.height,l=t.properties,u=this.props.model.getNodeStyle();return Ze("svg",{x:i-s/2,y:r-a/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[l.labelText?Ze("text",{x:0,y:-5,fontSize:"16px",fill:u.stroke},l.labelText):"",l.disabledDelete?"":Ze("text",{x:l.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:u.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,o)},"x")])},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.id,l=this.props.model.getNodeStyle();return Ze("g",{},[Ze("rect",Nu(Nu({},l),{x:o-r/2,y:i-s/2,width:r,height:s,id:a})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var o=this.props.graphModel;o.deleteNode(t)},e})(cu),NJ=(function(n){Em(e,n);function e(){var t=n.apply(this,Yv([],Wv(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},n.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,o;this.points=[],((o=this.properties)===null||o===void 0?void 0:o.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var o=t.x,i=t.y;this.x=o,this.y=i},e.prototype.updatePointsByNodes=function(t){var o=this,i=[],r=1/0,s=1/0,a=-1/0,l=-1/0;t.forEach(function(u){var c=o.graphModel.getNodeModelById(u);if(c){var f=c.width,p=c.height,h=c.x,v=c.y;r=Math.min(r,h-f/2-o.d),s=Math.min(s,v-p/2-o.d),a=Math.max(a,h+f/2+o.d),l=Math.max(l,v+p/2+o.d)}}),i.push([r,s],[a,s],[a,l],[r,l]),![r,s,a,l].some(function(u){return Math.abs(u)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(a+r)/2,y:(l+s)/2}))},e.prototype.resize=function(t){var o;this.isResize=!0;for(var i=t.width,r=t.height,s={x:i/this.width,y:r/this.height},a=(this.properties.node_selection_ids||[]).slice(),l=[],u=new Set;a.length;){var c=a.shift(),f=(o=this.graphModel.nodesMap[c])===null||o===void 0?void 0:o.model;if(f){if(!Rl(f)){l.push(f);continue}u.has(f.id)||(u.add(f.id),a.push.apply(a,Yv([],Wv(f.properties.node_selection_ids||[]),!1)))}}var p={x:this.x-this.width/2,y:this.y-this.height/2},h=n.prototype.resize.call(this,t),v={x:this.x-this.width/2,y:this.y-this.height/2};return l.forEach(function(_){_.width=_.width*s.x,_.height=_.height*s.y;var m=(_.x-p.x)*s.x+v.x-_.x,g=(_.y-p.y)*s.y+v.y-_.y;_.move(m,g,!0)}),this.isResize=!1,h},e})(au),zc="node-selection";(function(){function n(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:zc,view:OJ,model:NJ})}return Object.defineProperty(n.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),n.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},n.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},n.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,o=this.lf.getGraphRawData(),i=t.filter(function(r){return r!==e.currentClickNode.id});return o.nodes.find(function(r){if(r.type==="node-selection"){var s=Ha(r,"properties.node_selection_ids",[]);return i.every(function(a){return s.includes(a)})}return!1})},n.prototype.onNodeChange=function(e,t){var o=e.graphModel.nodes.filter(function(i){if(!Rl(i))return!1;var r=i.properties.node_selection_ids||[];return r.includes(t.id)});Promise.resolve().then(function(){o.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},n.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(o){var i;if(!(!o.e.shiftKey||o.data.type===zc)){t.currentClickNode=o.data;var r=!1;t.selectNodesIds.includes(o.data.id)&&((i=t.lf.getNodeModelById(o.data.id))===null||i===void 0||i.setSelected(!1),r=!0);var s=e.getSelectElements(!0).nodes;t.selectNodes=s,t.selectNodes.length===1?r?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(o,i,r){if(t.onNodeChange(e,o),Rl(o)&&!o.isResize){var s=o.properties.node_selection_ids||[];return e.graphModel.moveNodes(s,i,r,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(o){return Rl(o)||t.onNodeChange(e,o),!0})},n.pluginName="node-selection",n})();var Rl=function(n){return!!(n&&n.type===zc)},MJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Mu=function(){return Mu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mu.apply(this,arguments)};(function(n){MJ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.properties;return Ze("text",{x:o-r/2+5,y:i-s/2+16,fontSize:12,fill:"blue"},a.moreText)},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=this.props.model.getNodeStyle();return Ze("g",{},[Ze("rect",Mu(Mu({},a),{fill:"#FFFFFF",x:o-r/2,y:i-s/2})),this.getLabelShape()])},e})(Mr);var TJ=Cw();const $J=Ms(TJ);function PJ(n,e="id",t="parentId",o="children"){const i=[],r=new Map;for(const s of n)r.set(s[e],{...s,[o]:[]});for(const s of n){const a=r.get(s[e]),l=s[t];l!=null&&r.has(l)?r.get(l)[o].push(a):i.push(a)}return i}class Dm{constructor({lf:e}){this.lf=e,this.elk=new $J}async layout(e){const t=JSON.parse(JSON.stringify(e)),{nodes:o,edges:i}=t,r=new Map(o.map(h=>[h.id,h])),s=o.map(h=>{var _;let v={id:h.id,parentId:((_=h.properties)==null?void 0:_.loop_parent_key)||null};return h.children&&h.children.length>0?v.layoutOptions={"elk.padding":"[top=112, right=32, bottom=32, left=32]","elk.nodeSize.constraints":"MINIMUM_SIZE","elk.nodeSize.minimum":"[600, 420]","elk.spacing.nodeNode":100,"elk.layered.spacing.nodeNodeBetweenLayers":120}:(v.width=h.properties.width||420,v.height=h.properties.height||100,v.layoutOptions={"elk.nodeSize.constraints":"FIXED"}),v}),a=new Map;i.forEach(h=>{a.set(h.id,{...h})});const l=PJ(s),u=i.map(h=>({id:h.id,sources:[h.sourceNodeId],targets:[h.targetNodeId]})),c={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.nodePlacement.bk.fixedAlignment":"TOP","elk.spacing.nodeNode":200,"elk.layered.spacing.nodeNodeBetweenLayers":200,"elk.layered.considerHierarchy":"true","elk.spacing.componentComponent":80},children:l,edges:u},f=await this.elk.layout(c);function p(h,v=null,_=0,m=0){for(const g of h){const b=r.get(g.id);if(!b)continue;let C,D;v?(C=_+g.x,D=m+g.y):(C=g.x,D=g.y),b.x=C+g.width/2,b.y=D+g.height/2,b.properties||(b.properties={}),b.width=g.width,b.height=g.height,b.properties.width=g.width,b.properties.height=g.height,g.children&&g.children.length>0&&p(g.children,g,C,D)}}p(f.children),i.forEach(h=>{const v=a.get(h.id),_=f.edges.find(m=>m.id===h.id);if(_&&_.sections&&_.sections.length>0){const m=_.sections[0];if(m){v&&(h.sourceAnchorId=v.sourceAnchorId,h.targetAnchorId=v.targetAnchorId),h.startPoint={...m.startPoint},h.endPoint={...m.endPoint};const g=m.startPoint,b=m.endPoint,C=b.x-g.x,D=b.y-g.y;let S=50+Math.sqrt(C*C+D*D)*.3;S=Math.max(10,Math.min(S,100));const $={x:g.x+Math.abs(C)*.3,y:g.y},B={x:b.x-Math.abs(C)*.3,y:b.y};Math.abs(D)>Math.abs(C)?($.x=g.x,$.y=g.y+Math.abs(D)*.3,B.x=b.x,B.y=b.y-Math.abs(D)*.3):($.x=g.x+Math.abs(C)*.3,$.y=g.y,B.x=b.x-Math.abs(C)*.3,B.y=b.y),h.pointsList=[{...g},$,B,{...b}],h.properties||(h.properties={}),h.properties.offset=Math.round(S)}}else if(v&&(h.sourceAnchorId=v.sourceAnchorId,h.targetAnchorId=v.targetAnchorId,h.type=v.type||"custom-bezier-edge",h.startPoint&&h.endPoint&&(!h.pointsList||h.pointsList.length===0))){const m=h.endPoint.x-h.startPoint.x,g=h.endPoint.y-h.startPoint.y;let T=50+Math.sqrt(m*m+g*g)*.3;T=Math.max(10,Math.min(T,100));const S={x:h.startPoint.x+Math.abs(m)*.3,y:h.startPoint.y},N={x:h.endPoint.x-Math.abs(m)*.3,y:h.endPoint.y};Math.abs(g)>Math.abs(m)?(S.x=h.startPoint.x,S.y=h.startPoint.y+Math.abs(g)*.3,N.x=h.endPoint.x,N.y=h.endPoint.y-Math.abs(g)*.3):(S.x=h.startPoint.x+Math.abs(m)*.3,S.y=h.startPoint.y,N.x=h.endPoint.x-Math.abs(m)*.3,N.y=h.endPoint.y),h.pointsList=[{...h.startPoint},S,N,{...h.endPoint}],h.properties||(h.properties={}),h.properties.offset=Math.round(T)}}),this.lf.clearSelectElements(),this.lf.clearData(),this.lf.graphModel.graphDataToModel(t),this.fitView(t.nodes),t.nodes.forEach(h=>{if(h.children&&h.children.length){let v=this.lf.graphModel.getElement(h.id);v&&v.setZIndex(-9999)}})}fitView(e){if(!e||e.length===0){this.lf.resetZoom(),this.lf.resetTranslate();return}const{width:t,height:o}=this.lf.graphModel;let i=1/0,r=1/0,s=-1/0,a=-1/0;e.forEach(v=>{const _=(v.width||v.properties.width)/2,m=(v.height||v.properties.height)/2;i=Math.min(i,v.x-_),r=Math.min(r,v.y-m),s=Math.max(s,v.x+_),a=Math.max(a,v.y+m)});const l=s-i,u=a-r;if(l===0||u===0)return;const c=.1,f=t/(l*(1+c)),p=o/(u*(1+c));let h=Math.min(f,p);h>1?h=1:h<.3&&(h=.3),this.lf.zoom(h),this.lf.translateCenter()}}ii(Dm,"pluginName","elk");class Am{constructor({lf:e}){this.lf=e,this.padding={top:94,right:16,bottom:16,left:16},this.resize_padding=30,this.handleNodeDrag=this.handleNodeDrag.bind(this),e.on("node:drag",this.handleNodeDrag)}handleNodeDrag({data:e}){this.lf.off("node:drag",this.handleNodeDrag);try{const t=this.lf.graphModel.getNodeModelById(e.id);if(!t)return;const{x:o,y:i,width:r,height:s}=t,a=t.getProperties();if(a.loop_parent_key){const l=this.lf.graphModel.getNodeModelById(a.loop_parent_key);if(l){const{x:u,y:c,width:f,height:p}=l,h=o-r/2,v=o+r/2,_=i-s/2,m=i+s/2,g=u-f/2+this.padding.left,b=u+f/2-this.padding.right,C=c-p/2+this.padding.top,D=c+p/2-this.padding.bottom;let T=f,O=p,k=u,S=c,N=!1;if(h<g){const L=g-h+this.resize_padding;T+=L,k-=L/2,N=!0}if(v>b){const L=v-b+this.resize_padding;T+=L,k+=L/2,N=!0}if(_<C){const L=C-_+this.resize_padding;O+=L,S-=L/2,N=!0}if(m>D){const L=m-D+this.resize_padding;O+=L,S+=L/2,N=!0}N&&(l.x=k,l.y=S,l._width=l.width=T,l._height=l.height=O)}}}finally{this.lf.on("node:drag",this.handleNodeDrag)}}}ii(Am,"pluginName","groupAutoResize");var RJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),br=function(){return br=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},br.apply(this,arguments)},BJ=(function(n){RJ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,o=t.width,i=t.height,r=t.radius;Qn(o)||(this.width=o),Qn(i)||(this.height=i),Qn(r)||(this.radius=r)},e.prototype.getTextStyle=function(){var t=this.properties,o=t.refX,i=o===void 0?0:o,r=t.refY,s=r===void 0?0:r,a=t.textStyle,l=n.prototype.getTextStyle.call(this);return br(br(br({},l),Dt(a)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(s,")")})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.properties.style;return br(br({},t),Dt(o)||{})},e})(Pa),Om={};function Wt(n,e){var t=n.type,o=n.component,i=n.effect,r=n.view,s=n.model;if(!t)throw new Error("You should specify type in config");Om[t]={component:o,effect:i},e.register({type:t,view:r||HJ,model:s||BJ})}var js=!1,ks=new Map,Es=new Map,Tu=Je({});function LJ(n,e,t,o,i){js&&(i.isMiniMap&&FJ(t,i.flowId),Tu[n]=Gm(lg({render:function(){return Tt(ag,{to:t},[Tt(e,{node:o,graph:i})])},provide:function(){return{getNode:function(){return o},getGraph:function(){return i}}}})))}function IJ(n,e){if(js&&(delete Tu[n],ks.has(e))){var t=Es.get(e)||[],o=t.indexOf(n);o>-1&&(t.splice(o,1),t.length===0?jJ(e):Es.set(e,t))}}function Kv(){return js}function Nm(){return js=!0,lg({props:{flowId:{type:String,required:!0}},setup:function(n){return function(){var e=[];return Object.keys(Tu).forEach(function(t){if(t.startsWith(n.flowId)){if(ks.has(n.flowId)){var o=Es.get(n.flowId)||[];o.includes(t)||(o.push(t),Es.set(n.flowId,o))}e.push(Tu[t])}}),Tt(ae,{},e.map(function(t){return Tt(t)}))}}})}function FJ(n,e){if(!(!e||!n||!js)){var t=Nm();if(!ks.has(e)){var o=document.createElement("div");n.appendChild(o);var i=er(t,{flowId:e});i.mount(o),ks.set(e,i),Es.set(e,[])}}}function jJ(n){if(!(!n||!js)){var e=ks.get(n);e&&(e.unmount(),ks.delete(n),Es.delete(n))}}var VJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),HJ=(function(n){VJ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var o=document.createElement("div");o.className="custom-vue-node-content",this.root=o,t.appendChild(o),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var o=this.getComponentContainer(),i=this.props,r=i.model,s=i.graphModel;if(o){var a=Om[r.type].component;a&&(Kv()?LJ(this.targetId(),a,o,r,s):(this.vm=er({render:function(){return Tt(a,{node:r,graph:s})},provide:function(){return{getNode:function(){return r},getGraph:function(){return s}}}}),(t=this.vm)===null||t===void 0||t.mount(o)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){Kv()&&IJ(this.targetId(),this.props.graphModel.flowId),this.unmountVueComponent()},e})(Ba);const UJ={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},zJ={class:"custom-line-popup"};function qJ(n,e,t,o,i,r){return Ni((w(),P("div",zJ,[d("button",{class:"delete-btn",onClick:e[0]||(e[0]=St((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))},"删 除")],512)),[[Zi,i.isDeleteConfirmShow]])}const GJ=$e(UJ,[["render",qJ],["__scopeId","data-v-8168a5a6"]]),XJ=70,WJ=36;let YJ=class extends Ss{constructor(e){super(e),this.isMounted=!1,this.r=Tt(GJ,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=er({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=XJ,customHeight:o=WJ}=e.getProperties(),i=e.id,{startPoint:r,endPoint:s,arrowConfig:a,pointsList:l}=e;let u={x:(r.x+s.x-t)/2,y:(r.y+s.y-o)/2,width:t,height:o};if(l.length>2){let f=Math.round(l.length/2);u.x=l[f-1].x+5,u.y=l[f-1].y}const c={width:t,height:o};return setTimeout(()=>{const f=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(f))},0),Ze("foreignObject",{...u,id:"line_"+i},[Ze("div",{id:i,style:c,className:"vue-app-wrapper"})])}},KJ=class extends ws{initEdgeData(e){super.initEdgeData(e)}createId(){return Gi("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}};const JJ={type:"custom-edge",view:YJ,model:KJ},ZJ={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){const e=this.getGraphModel(),t=this.getModel();if(e.getNodeModelById(t.sourceNodeId).properties.isTriggerNode){this.isDeleteConfirmShow=!1;return}const i=e.getSelectElements(!0);i.nodes.length===0&&i.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},QJ={class:"custom-line-popup"};function eZ(n,e,t,o,i,r){return Ni((w(),P("div",QJ,[d("div",{class:"minus-circle-outlined",onClick:e[0]||(e[0]=St((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))})],512)),[[Zi,i.isDeleteConfirmShow]])}const tZ=$e(ZJ,[["render",eZ],["__scopeId","data-v-96663205"]]);class nZ extends Bc{constructor(e){super(e),this.isMounted=!1,this.r=Tt(tZ,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=er({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:e}=this.props,{stroke:t,strokeWidth:o}=e.getArrowStyle();return Ze("path",{stroke:t,strokeWidth:o,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:e}=this.props,{startPoint:t,endPoint:o,pointsList:i}=e,r=e.id,s=24,a=24,l=s/2,u=a/2,c=g=>{const{x:b,y:C}=t,{x:D,y:T}=i[1],{x:O,y:k}=i[2],{x:S,y:N}=o,L=g*g,$=L*g,B=1-g,E=B*B,A=E*B;return{x:b*A+3*D*E*g+3*O*B*L+S*$,y:C*A+3*T*E*g+3*k*B*L+N*$}},f=(g=5)=>{let b=0,C=c(0);for(let D=1;D<=g;D++){const T=D/g,O=c(T),k=O.x-C.x,S=O.y-C.y;b+=Math.sqrt(k*k+S*S),C=O}return b},p=g=>{const b=g/2;let C=0,D=1,T=.5,O=1e-4;for(;D-C>O;)T=(C+D)/2,k(T)<b?C=T:D=T;function k(S){let N=0,L=c(0);const $=5;for(let B=1;B<=$;B++){const E=B/$*S,A=c(E),M=A.x-L.x,F=A.y-L.y;N+=Math.sqrt(M*M+F*F),L=A}return N}return c(T)},h=f(),v=p(h),_={x:v.x-l,y:v.y-u,width:s,height:a},m={width:s,height:a};return setTimeout(()=>{var b,C;const g=(b=document.querySelector(`#line_${r}`))==null?void 0:b.querySelector(".vue-app-wrapper");!this.isMounted&&g?(this.isMounted=!0,this.app.mount(g)):(C=this.r)!=null&&C.component&&(this.r.component.props.isSelected=e.isSelected,this.r.component.props.isHovered=e.isHovered,this.r.component.props.properties=e.getProperties())},0),Ze("foreignObject",{..._,id:`line_${r}`},[Ze("div",{id:r,style:m,className:"vue-app-wrapper"})])}}class oZ extends xc{initEdgeData(e){super.initEdgeData(e)}setAttributes(e){super.setAttributes(e);let t=this.getProperties().offset;t&&(this.offset=t,this.pointsList=[],this.initPoints())}createId(){return Gi("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#37e1ffff":e.stroke="#2475FC",e.strokeWidth=2,e}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}}const iZ={type:"custom-bezier-edge",view:nZ,model:oZ},rZ={name:"QuestionNode",components:{PopupMenu:Iu},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{type:"node",excludedNodeTypes:[],nodeListTabActive:1}},mounted(){this.getGraph().eventCenter.on("custom:showPopupMenu",this.onShowPopupMenu)},methods:{onShowPopupMenu(n){const{type:e,loop_parent_key:t}=n.model.properties;if(t){let o=["custom-group","batch-group","end-node"];this.getGraph().getNodeModelById(t).type=="batch-group"&&o.push("terminate-node"),this.excludedNodeTypes=o}else this.excludedNodeTypes=["explain-node","terminate-node"]},handleAddNode(n){this.$emit("click-item",n)}}};function sZ(n,e,t,o,i,r){const s=Nt("PopupMenu");return w(),Z(s,{onAddNode:r.handleAddNode,type:i.type,excludedNodeTypes:i.excludedNodeTypes,active:i.nodeListTabActive,"onUpdate:active":e[0]||(e[0]=a=>i.nodeListTabActive=a)},null,8,["onAddNode","type","excludedNodeTypes","active"])}const aZ=$e(rZ,[["render",sZ]]),Jv=444,Zv=620;class lZ{constructor({lf:e}){ii(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${Jv}px`,this.__menuDOM.style.height=`${Zv}px`,this.isMounted=!1,this.r=Tt(aZ,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:o})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:o,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=er({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:o,model:i})=>{this._activeData=i,this._activeAnchorData=o,this.createMenu()}),e.on("node:click",({data:o})=>{this.hideMenu()}),e.on("edge:click",({data:o})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,o=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,o])}showMenu(){const[e,t]=this.getContextMenuPosition(),o=this.lf.graphModel.height-64,i=this.lf.graphModel.width-64;this.__menuDOM.style.display="flex";const r=Math.min(525,o-20),s=Jv;let a=e+10;a+s>i&&(a=e-s-20),a<0&&(a=4),this.__menuDOM.style.left=`${a}px`;let l=t;t+r>o?l=t-(t+r-o)-10:l=t-10,l<0&&(l=4),this.__menuDOM.style.top=`${l}px`,this.__menuDOM.style.height=`${r>0?r:Zv}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class Mm{constructor({lf:e}){ii(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:o,metaKey:i}=e,r=t||i;if(r&&o.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(r&&(o.toLowerCase()==="y"||o.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let o=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:o||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),e.nodes.forEach(t=>{t.width=t.properties.width,t.height=t.properties.height}),this.lf.graphModel.graphDataToModel({nodes:e.nodes||[],edges:e.edges||[]}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let o=e;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return!0;o=o.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,o){this.maxHistorySize=o&&o.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),o=this.redoStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:o,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}ii(Mm,"pluginName","canvasHistory");class Tm{constructor({lf:e}){ii(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let o=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*o,100*i):this.lf.translate(100*o,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[o,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]),r=this.lf.getTransform();this.zoom=r.SCALE_X,e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[o,i])}});ii(this,"keydownListener",e=>{var s;const t=(s=e==null?void 0:e.key)==null?void 0:s.toLowerCase(),{graphModel:{eventCenter:o}}=this.lf,i=e.target,r=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!r)return;let a=this.lf.getSelectElements(!0);if(a=JSON.parse(JSON.stringify(a)),a.nodes.length===0)return;a.edges=[];const l=a.nodes.filter(u=>u.type!=="start-node"&&u.type!=="custom-group"&&u.properties.isTriggerNode!=!0);if(l.length>0){this.basePointX=20,this.basePointY=20;let u={x:1/0,y:1/0};l.forEach(c=>{c.id="",c.nodeSortKey="",c.properties.id="",c.properties.next_node_key="",c.properties.nodeSortKey="",c.properties.node_key="",!c.width&&c.properties.width&&(c.width=c.properties.width),!c.height&&c.properties.height&&(c.height=c.properties.height),c.x<u.x&&(u.x=c.x),c.y<u.y&&(u.y=c.y)}),this.clipboard={nodes:l,basePoint:u}}else this.clipboard=null;return}if(t==="v"){if(!r||!this.clipboard||this.clipboard.nodes.length===0)return;if(this.clipboard&&this.clipboard.nodes.length>0){const a={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};o.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:a}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&r){o.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});ii(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}ii(Tm,"pluginName","custom-keyboard");function $m(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=$m(f.children,f)),f})}class tn extends Ba{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=Tt(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=er({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let o=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:o},t.model.width=i,t.model.height=o,t.model._width=i,t.model._height=o,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:o=>{t.model.properties.anchorList=o},setData:o=>{o.dataRaw=o.node_params,Pt(()=>{t.model.properties={...t.model.properties,...o};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model.height=i||o.height||t.model.properties.height,t.model._height=i||o.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:o=>{t.model.properties.node_name=o,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:o,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:_,model:m}=this.props;l==="right"&&!r&&_.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:m})}},c,f,p)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class nn extends Pa{createId(){return Gi(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(r=>r.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let o=JSON.parse(t.properties.node_params);return{sys_global:o.start.sys_global,diy_global:o.start.diy_global,all_global:[...o.start.sys_global,...o.start.diy_global]}}getAllParentVariable(){var l,u,c;const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(f=>f.type==="start-node");r&&(t.add(r.id),e.push(r));const s=f=>{var p;for(let h=0;h<f.length;h++){let _=f[h].sourceNode;if(!t.has(_.id)){if(t.add(_.id),ls.includes(_.type))if(_.type==="zm-plugins-node"){let m=To(_.properties.node_params);(sw.includes(m.plugin.name)||(p=m.plugin)!=null&&p.output_obj.length)&&e.push(_)}else e.push(_);s(_.incoming.edges)}}};s(o);let a=[];if(this.properties.loop_parent_key){let f=i.find(p=>p.id==this.properties.loop_parent_key);f&&(e.filter(h=>h.id==this.properties.loop_parent_key).length>0||e.push(f))}for(const f of e){if(!ls.includes(f.type))continue;let p=JSON.parse(f.properties.node_params),h={label:f.properties.node_name,value:f.id,node_id:f.id,node_type:f.properties.node_type,typ:"node",children:[],loop_parent_key:f.properties.loop_parent_key};if(f.type==="http-node"&&(h.children=p.curl.output),f.type==="zm-workflow-node"&&(h.children=p.workflow.output),f.type==="voice-synthesis-node"&&(h.children=p.text_to_audio.output),f.type==="voice-clone-node"&&(h.children=p.voice_clone.output),f.type==="zm-plugins-node"&&(h.children=p.plugin.output||p.plugin.output_obj),f.type==="code-run-node"&&(h.children=p.code_run.output),f.type==="parameter-extraction-node"&&(h.children=p.params_extractor.output),f.type==="start-node"&&(h.children=[...p.start.diy_global,...p.start.sys_global]),f.type==="custom-group"&&(this.properties.loop_parent_key==f.id?h.children=[...((l=p.loop)==null?void 0:l.intermediate_params)||[],...((u=p.loop)==null?void 0:u.loop_arrays)||[]]:h.children=p.loop.output),f.type==="batch-group"&&(this.properties.loop_parent_key==f.id?h.children=[...((c=p.batch)==null?void 0:c.batch_arrays)||[]]:h.children=p.batch.output),f.type==="import-library-node"&&(h.children=p.library_import.outputs),f.type==="json-node"&&(h.children=p.json_encode.output),f.type==="json-reverse-node"&&(h.children=p.json_decode.output),f.type==="select-data-node"&&(h.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),f.type==="knowledge-base-node"&&(h.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),f.type==="ai-dialogue-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),f.type==="specify-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),f.type==="immediately-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),f.type==="problem-optimization-node"&&(h.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),f.type==="mcp-node"&&(h.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),f.type==="image-generation-node"){let v=p.image_generation.image_num;if(v>0){let _=[];for(let m=0;m<+v;m++){let g=String.fromCharCode(97+m);_.push({key:`picture_url_${g}`,typ:"string",name:`picture_url_${g}`,label:`picture_url_${g}`})}h.children=_}}h.children=Array.isArray(h.children)?h.children:[],h.children.forEach(v=>{v.node_id=f.id,v.node_name=f.properties.node_name,v.node_type=f.properties.node_type}),h.children=$m(h.children,null),a.push(h)}return a}getTriggerNodes(){const{nodes:e}=this.graphModel;return e.filter(o=>o.properties.isTriggerNode)}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const If="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",uZ={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[],node_header_bg_color:""}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.isShowMenu=!1,this.$emit("handleMenu",n)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){this.isShowMenu=!1;let n=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",n)},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(n.target)&&n.target!==this.$el.querySelector(".node-menu-btn")&&n.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return Lu(this.node_type)},updateTitle(n){this.setTitle(n)}}},dZ=["data-node-name","data-node-type"],cZ={class:"node-header-left"},fZ={key:0,class:"node-icon"},pZ=["src"],hZ={class:"node-title"},vZ={key:0,class:"node-menu-wrapper"},gZ={class:"node-menus"},_Z=["onClick"],mZ={class:"node-body"};function yZ(n,e,t,o,i,r){return w(),P("div",{class:Ct(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[d("div",{class:Ct(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[d("div",{class:"node-header",style:In({background:t.properties.node_header_bg_color||"none"})},[d("div",cZ,[t.iconUrl||t.iconName?(w(),P("span",fZ,[d("img",{src:t.iconUrl||r.getImgUrl(t.iconName),alt:""},null,8,pZ)])):ie("",!0),d("span",hZ,j(t.title),1)]),d("div",null,[t.hideMenus?ie("",!0):(w(),P("div",vZ,[d("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=St((...s)=>r.showMenu&&r.showMenu(...s),["stop"]))},[...e[2]||(e[2]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])]),Ni(d("div",gZ,[(w(!0),P(ae,null,ye(r.allMenus,s=>(w(),P("div",{class:"node-menu",key:s.key,onClick:St(a=>r.handleMenu(s),["stop"])},j(s.name),9,_Z))),128)),d("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=St(s=>r.handleDelete(n.item),["stop"]))},"删除")],512),[[Zi,i.isShowMenu]])]))])],4),d("div",mZ,[Oi(n.$slots,"default",{},void 0,!0)])],2)],10,dZ)}const on=$e(uZ,[["render",yZ],["__scopeId","data-v-4cb6a05d"]]),bZ={name:"StartNode",components:{NodeCommon:on},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{outputs:[],show:!1}},computed:{options(){return[...this.outputs]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.outputs=n.trigger.outputs,this.$nextTick(()=>{this.resetSize()})}}},xZ={class:"start-node"},wZ={class:"start-node-options"},CZ={class:"options-list"},SZ={class:"option-label"},kZ={class:"option-type"};function EZ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,"icon-url":t.properties.node_icon,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",xZ,[d("div",wZ,[e[0]||(e[0]=d("div",{class:"options-title"},"输出",-1)),d("div",CZ,[(w(!0),P(ae,null,ye(r.options,a=>(w(),P("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",SZ,j(a.key),1),d("div",kZ,j(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}const DZ=$e(bZ,[["render",EZ],["__scopeId","data-v-e4e70a27"]]);let AZ=class extends tn{constructor(e){super(e),this.renderVue(DZ,e)}},OZ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const NZ={type:"session-trigger-node",model:OZ,view:AZ},MZ={name:"StartNode",components:{NodeCommon:on},inject:["resetSize","setData","getGraph","getNode"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset();const n=this.getGraph();n.eventCenter.on("custom:trigger-add",this.onTriggerAdd),n.eventCenter.on("custom:trigger-change",this.onTriggerChange)},beforeUnmount(){const n=this.getGraph();n.eventCenter.off("custom:trigger-change",this.onTriggerChange),n.eventCenter.off("custom:trigger-add",this.onTriggerAdd)},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list,this.$nextTick(()=>{this.resetSize()})},update(){let n=JSON.parse(this.properties.node_params);n.start.sys_global=this.sys_global,n.start.diy_global=this.diy_global,n.start.trigger_list=this.trigger_list,this.setData({node_params:JSON.stringify(n)})},onTriggerAdd(n){const{trigger:e}=JSON.parse(n.properties.node_params);this.trigger_list.push(e);const{outputs:t}=e,o=new Map(this.diy_global.map((i,r)=>[i.key,{item:i,index:r}]));t&&Array.isArray(t)&&t.forEach(i=>{if(o.has(i.key)){const{index:r}=o.get(i.key);this.diy_global[r]=i}else this.diy_global.push(i)}),this.update()},onTriggerChange(n){const t=this.getNode().getTriggerNodes(),o=[];t.forEach(i=>{const s=JSON.parse(i.properties.node_params).trigger||null;s&&(s.trigger_name=i.properties.node_name,o.push(s))}),this.trigger_list=o,this.update()}}},TZ={class:"start-node"},$Z={class:"start-node-options"},PZ={class:"options-list"},RZ={class:"option-label"},BZ={class:"option-type"};function LZ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:x(()=>[d("div",TZ,[d("div",$Z,[e[0]||(e[0]=d("div",{class:"options-title"},"输出",-1)),d("div",PZ,[(w(!0),P(ae,null,ye(r.options,a=>(w(),P("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",RZ,j(a.key),1),d("div",BZ,j(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const IZ=$e(MZ,[["render",LZ],["__scopeId","data-v-f8d6fab6"]]);let FZ=class extends tn{constructor(e){super(e),this.renderVue(IZ,e)}},jZ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(r,s,a,l)=>{if(r.id==s.id)return!1;const u=r.graphModel.edges.map(f=>f.sourceAnchorId),c=a.id;return a.type==="right"&&!u.includes(c)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(r,s,a,l)=>r.properties.loop_parent_key?r.properties.loop_parent_key===s.properties.loop_parent_key:!s.properties.loop_parent_key};this.sourceRules=[e,t];const o=["session-trigger-node"],i={message:"只允许连接左边的锚点",validate:(r,s,a,l)=>r.id==s.id?!1:l.type==="left"||o.includes(r.type)};this.targetRules=[i]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+25,id:l+"-anchor_left",type:"anchor_left",isHovered:s,isSelected:a,nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const VZ={type:"start-node",model:jZ,view:FZ},Za={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(n){const e=n,t=xg(),{allModelList:o}=Ia(t);let i=wg(o.value).newList;const r=X(""),s=()=>{if(!e.useModel){r.value="";return}for(const a of i)if(a.children){for(const l of a.children)if(e.useModel==l.name&&e.modelConfigId==a.id){r.value=l.show_model_name||l.deployment_name||l.name;return}}};return gt(()=>[e.useModel,e.modelConfigId],()=>{s()},{immediate:!0}),(a,l)=>(w(),P("span",null,j(r.value),1))}},lr={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(n,{expose:e}){const t=n,o=He("getNode"),i=X([]),r=X("");function s(){let f=o().getAllParentVariable();i.value=a(f)}function a(f){return f.forEach(p=>{p.typ=="node"?p.node_type==1?p.value="global":p.value=p.node_id:p.value=p.key,p.children&&p.children.length>0&&(p.children=a(p.children))}),f}const l=(f,p)=>{for(const h of f){if(h.value===p)return h.label;if(h.children&&h.children.length>0){const v=l(h.children,p);if(v)return v}}return null},u=()=>{if(!t.value||t.value.length===0)return"";s();let f=[];t.value.forEach(p=>{const h=l(i.value,p);h&&f.push(h)}),r.value=f.join("/")},c=()=>{u()};return gt(()=>t.value,()=>{u()},{immediate:!0}),e({refresh:c}),(f,p)=>(w(),P("span",null,j(r.value),1))}},HZ={class:"ai-dialogue-node"},UZ={class:"field-list"},zZ={class:"field-item"},qZ={class:"field-item-content"},GZ={class:"field-value"},XZ={class:"field-key"},WZ={class:"field-item"},YZ={class:"field-item-content"},KZ={class:"field-value"},JZ={class:"field-key"},ZZ={class:"field-item"},QZ={class:"field-item-content"},eQ={class:"category-list"},tQ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=jn(),{modelList:r}=Ia(i),s=X([]),a=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[]});function l(f){if(f&&typeof f=="string"){let p=f.split("."),h=p[0],v=p.filter((_,m)=>m>0).join(".");return[h,v]}else if(f&&typeof f=="object"&&f.length===2)return f;return["global","question"]}const u=()=>{const f=e.properties.dataRaw||e.properties.node_params||"{}";let p={};try{p=JSON.parse(f).cate||{}}catch{p={}}p=JSON.parse(JSON.stringify(p));for(let h in p)if(h==="question_value")a.question_value=l(p.question_value);else if(h=="categorys")if(p.categorys&&p.categorys.length>0){let v=p.categorys.map(_=>({..._}));a[h]=v}else a[h]=[{category:"",next_node_key:"",key:_n(16)}];else a[h]=p[h];!a.model_config_id&&r.value.length>0&&(a.model_config_id=r.value[0].id,a.use_model=r.value[0].children[0].name),Pt(()=>{o()})},c=()=>{const f=a.model_config_id?+a.model_config_id:a.model_config_id,p=JSON.stringify({cate:{...a,question_value:a.question_value.join("."),model_config_id:f}});t({...e.node,...a,node_params:p})};return gt(()=>e.properties,(f,p)=>{const h=f.dataRaw||f.node_params||"{}",v=p.dataRaw||p.node_params||"{}";h!=v&&u()},{deep:!0}),ut(()=>{u(),o(),c()}),no(()=>{}),(f,p)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",HZ,[d("div",UZ,[d("div",zZ,[p[0]||(p[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",qZ,[d("div",GZ,[d("span",XZ,[y(lr,{ref:"questionTextRef",value:a.question_value},null,8,["value"])])])])]),d("div",WZ,[p[1]||(p[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",YZ,[d("div",KZ,[d("span",JZ,[y(Za,{useModel:a.use_model,modelConfigId:a.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",ZZ,[p[3]||(p[3]=d("div",{class:"field-item-label"},"问题分类",-1)),d("div",QZ,[d("div",eQ,[(w(!0),P(ae,null,ye(a.categorys,h=>(w(),P("div",{class:"field-value category-value",key:h.key},[d("span",null,j(h.category),1)]))),128)),p[2]||(p[2]=d("div",{class:"field-value category-value"},[d("span",null,"默认分类")],-1))])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},nQ=$e(tQ,[["__scopeId","data-v-7577adca"]]);let oQ=class extends tn{constructor(e){super(e),this.renderVue(nQ,e)}},iQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getAnchorPos(){return aw(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let u=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}],c=this.getAnchorPos(),f=o-r/2;for(let p=0;p<c.length;p++)u.push({id:c[p].id,x:t+i/2,y:f+132+p*32,type:"right",nodeId:e});return u.push({id:l+"-anchor_right",x:t+i/2,y:r/2+o-28,type:"right",nodeId:e}),u}};const rQ={type:"question-node",model:iQ,view:oQ},sQ={name:"QuestionNode",components:{NodeCommon:on},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},aQ={class:"question-node"},lQ={class:"node-desc"};function uQ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",aQ,[d("div",lQ,j(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const dQ=$e(sQ,[["render",uQ],["__scopeId","data-v-c1ff42ad"]]);let cQ=class extends tn{constructor(e){super(e),this.renderVue(dQ,e)}},fQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let u=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&u.push({x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}),u}};const pQ={type:"action-node",model:fQ,view:cQ},hQ={name:"QuestionNode",components:{NodeCommon:on},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(n){return Zm(n)}}},vQ={class:"qa-node"},gQ={key:0,class:"no-data"};function _Q(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",vQ,[t.properties.no_resp_jump_time?ie("",!0):(w(),P("div",gQ,"点击设置消息内容"))])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const mQ=$e(hQ,[["render",_Q],["__scopeId","data-v-6f9ba4d9"]]);let yQ=class extends tn{constructor(e){super(e),this.renderVue(mQ,e)}},bQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const xQ={type:"qa-node",model:bQ,view:yQ},wQ={class:"ai-dialogue-node"},CQ={class:"field-list"},SQ={class:"field-item"},kQ={class:"field-item-content"},EQ={class:"field-value"},DQ={class:"field-item"},AQ={class:"field-item-content"},OQ={class:"field-value"},NQ={class:"field-key"},MQ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=jn(),{modelList:a}=Ia(s),l=X(null),u=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),f=X([]);function p(g){if(g){let b=g.split("."),C=b[0],D=b.filter((T,O)=>O>0).join(".");return[C,D]}return["global","question"]}const h=()=>{const g=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(g).llm||{}}catch{b={}}_();const{model_config_id:C,use_model:D,context_pair:T,temperature:O,max_token:k,prompt:S,prompt_tags:N,question_value:L,enable_thinking:$,libs_node_key:B}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=D,c.context_pair=T||0,c.temperature=O,c.max_token=k,c.prompt=S,c.enable_thinking=$,c.prompt_tags=N||[],c.libs_node_key=B,c.question_value=p(L),!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Pt(()=>{r()})},v=()=>{const g=JSON.stringify({llm:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:g})},_=()=>{let g=i().getAllParentVariable();f.value=g},m=g=>{_(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==g.node_id){let C=b.label.split("/");C[0]=g.node_name,b.label=C.join("/"),b.node_name=g.node_name}}),v(),l.value.refresh()};return gt(()=>e.properties,h,{deep:!0}),ut(()=>{h(),r(),o().eventCenter.on("custom:setNodeName",m)}),no(()=>{o().eventCenter.off("custom:setNodeName",m)}),(g,b)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",wQ,[d("div",CQ,[d("div",SQ,[b[0]||(b[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",kQ,[d("div",EQ,[y(lr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),d("div",DQ,[b[1]||(b[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",AQ,[d("div",OQ,[d("span",NQ,[y(Za,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),b[2]||(b[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"输出"),d("div",{class:"field-item-content"},[d("div",{class:"field-value is-required"},[d("span",{class:"field-key"},"AI回复内容"),d("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},TQ=$e(MQ,[["__scopeId","data-v-c4f526c7"]]);let $Q=class extends tn{constructor(e){super(e),this.renderVue(TQ,e)}},PQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const RQ={type:"ai-dialogue-node",model:PQ,view:$Q},Pm=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...Pm(t.children)):e.push(t)}),e},BQ={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open","resize"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=Pm(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue,this.$nextTick(()=>{this.$emit("resize")})},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize();let i=t.bottom,r=t.left;const s=window.innerWidth,a=window.innerHeight;return r+o.width>s&&(r=s-o.width),i+o.height>a&&(i=t.top-o.height),{top:i,left:r,x:r,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,u=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,u=c;break}c=c.previousSibling}}if(u.nodeType===Node.TEXT_NODE){u.replaceData(l,t," ");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const h in e)c.dataset[h]=e[h];const f=document.createRange();f.setStart(u,l),f.insertNode(c);let p=c.nextSibling;r.setStart(p,1),r.setEnd(p,1),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1,this.showAtList=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())}}};function LQ(n,e,t,o,i,r){return w(),P("span",{ref:"JMention",class:Ct(["j-mention",["type-"+t.type]])},null,2)}const yn=$e(BQ,[["render",LQ]]),IQ={class:"ai-dialogue-node"},FQ={class:"field-list"},jQ={class:"field-item"},VQ={class:"field-item-content"},HQ={class:"field-value"},UQ={class:"field-key"},zQ={class:"field-type"},qQ={class:"field-item"},GQ={class:"field-item-content"},XQ={class:"field-text"},WQ={class:"right-arrow"},YQ={class:"field-text2"},KQ={class:"field-item"},JQ={class:"field-item-content"},ZQ={class:"field-text"},QQ={class:"right-arrow"},eee={class:"field-text2"},tee={key:0,class:"field-item"},nee={class:"field-item-content"},oee={class:"field-text"},iee={class:"right-arrow"},ree={class:"field-text2"},see={key:1,class:"field-item"},aee={class:"field-item-content"},lee={class:"field-list-item"},uee={class:"field-item"},dee={class:"field-item-content"},cee={class:"field-key"},fee={class:"field-type"},pee={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=X([]),a=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[]});function l(_){return _.forEach(m=>{m.cu_key=Math.random()*1e4,m.subs&&m.subs.length?l(m.subs):m.subs=[]}),_}const u=X([]),c=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let m={};try{m=JSON.parse(_).curl||{}}catch{m={}}p(),m=JSON.parse(JSON.stringify(m));for(let g in m){if(g=="headers"||g=="params"||g=="body"){m[g]&&m[g].length>0?a[g]=m[g].map(b=>({...b,cu_key:Math.random()*1e4})):a[g]=[];continue}if(g=="output"){a.output=l(m[g]);continue}a[g]=m[g]}Pt(()=>{r()})},f=()=>{const _=JSON.stringify({curl:{...a}});t({...e.node,...a,node_params:_})},p=()=>{let _=i().getAllParentVariable();_.forEach(m=>{m.tags=m.tags||[]}),u.value=_},h=_=>{yo.includes(_.node_type)&&(p(),Pt(()=>{a.body_raw_tags&&a.body_raw_tags.length>0&&a.body_raw_tags.forEach(g=>{if(g.node_id==_.node_id){let b=g.label.split("/");b[0]=_.node_name,g.label=b.join("/"),g.node_name=_.node_name}}),["headers","params","body"].forEach(g=>{a[g].forEach(C=>{C.tags&&C.tags.length>0&&C.tags.forEach(D=>{if(D.node_id==_.node_id){let T=D.label.split("/");T[0]=_.node_name,D.label=T.join("/"),D.node_name=_.node_name}})})}),f()}))},v=()=>{};return gt(()=>e.properties,c,{deep:!0}),ut(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",h)}),no(()=>{o().eventCenter.off("custom:setNodeName",h)}),(_,m)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:v},{default:x(()=>[d("div",IQ,[d("div",FQ,[d("div",jQ,[m[0]||(m[0]=d("div",{class:"field-item-label"},"请求地址",-1)),d("div",VQ,[d("div",HQ,[d("span",UQ,j(a.method),1),d("span",zQ,j(a.rawurl),1)])])]),d("div",qQ,[m[1]||(m[1]=d("div",{class:"field-item-label"},"HEADERS",-1)),d("div",GQ,[(w(!0),P(ae,null,ye(a.headers,g=>(w(),P("div",{class:"field-list-item",key:g.cu_key},[d("div",XQ,j(g.key),1),d("div",WQ,[y(ee(ea))]),d("div",YQ,[y(yn,{options:u.value,"default-value":g.value,defaultSelectedList:g.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),d("div",KQ,[m[2]||(m[2]=d("div",{class:"field-item-label"},"PARAMS",-1)),d("div",JQ,[(w(!0),P(ae,null,ye(a.params,g=>(w(),P("div",{class:"field-list-item",key:g.cu_key},[d("div",ZQ,j(g.key),1),d("div",QQ,[y(ee(ea))]),d("div",eee,[y(yn,{options:u.value,"default-value":g.value,defaultSelectedList:g.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),a.type==1?(w(),P("div",tee,[m[3]||(m[3]=d("div",{class:"field-item-label"},"BODY",-1)),d("div",nee,[(w(!0),P(ae,null,ye(a.body,g=>(w(),P("div",{class:"field-list-item",key:g.cu_key},[d("div",oee,j(g.key),1),d("div",iee,[y(ee(ea))]),d("div",ree,[y(yn,{options:u.value,"default-value":g.value,defaultSelectedList:g.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):ie("",!0),a.type==2?(w(),P("div",see,[m[4]||(m[4]=d("div",{class:"field-item-label"},"BODY",-1)),d("div",aee,[d("div",lee,j(a.body_raw),1)])])):ie("",!0),d("div",uee,[m[5]||(m[5]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",dee,[(w(!0),P(ae,null,ye(a.output,g=>(w(),P("div",{class:"field-value",key:g.cu_key},[d("span",cee,j(g.key),1),d("span",fee,j(g.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},hee=$e(pee,[["__scopeId","data-v-00abf62d"]]);let vee=class extends tn{constructor(e){super(e),this.renderVue(hee,e)}},gee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+26,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+26,id:l+"-anchor_right",type:"right",nodeId:e}]}};const _ee={type:"http-node",model:gee,view:vee},mee={class:"ai-dialogue-node"},yee={class:"field-list"},bee={class:"field-item"},xee={class:"field-item-content"},wee={class:"field-value"},Cee={class:"field-item"},See={class:"field-item-content"},kee={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=jn(),t=Xe(()=>e.robotInfo.rrf_weight),o=n,i=He("setData"),r=He("getGraph"),s=He("getNode"),a=He("resetSize"),l=X(null),u=X([]),c=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[],rrf_weight:{}}),f=X([]);function p(D){if(D){let T=D.split("."),O=T[0],k=T.filter((S,N)=>N>0).join(".");return[O,k]}return["global","question"]}const h=()=>{const D=o.properties.dataRaw||o.properties.node_params||"{}";let T={};try{T=JSON.parse(D).libs||{}}catch{T={}}b(),T=JSON.parse(JSON.stringify(T));for(let O in T)O=="library_ids"?c[O]=T[O]?T[O].split(","):[]:O=="question_value"?c.question_value=p(T.question_value):O=="rrf_weight"?c.rrf_weight=T[O]?JSON.parse(T[O]):T[O]:c[O]=T[O];T.rrf_weight||(c.rrf_weight=t.value),Pt(()=>{a()})},v=()=>{const D=JSON.stringify({libs:{...c,rerank_model_config_id:c.rerank_model_config_id?+c.rerank_model_config_id:void 0,question_value:c.question_value.join("."),library_ids:c.library_ids.join(","),rrf_weight:JSON.stringify(c.rrf_weight)}});i({...o.node,node_params:D})},_=X([]),m=Xe(()=>_.value.filter(D=>c.library_ids.includes(D.id))),g=async()=>{const D=await Fa({type:""});D&&(_.value=D.data||[],Pt(()=>{a()}))},b=()=>{let D=s().getAllParentVariable();f.value=D},C=()=>{b(),v(),l.value.refresh()};return gt(()=>o.properties,h,{deep:!0}),ut(()=>{g(),h(),r().eventCenter.on("custom:setNodeName",C)}),no(()=>{r().eventCenter.off("custom:setNodeName",C)}),(D,T)=>(w(),Z(on,{properties:n.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",mee,[d("div",yee,[d("div",bee,[T[0]||(T[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",xee,[d("div",wee,[y(lr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),T[2]||(T[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"输出字段"),d("div",{class:"field-item-content"},[d("div",{class:"field-value is-required"},[d("span",{class:"field-key"},"知识库引用"),d("span",{class:"field-type"},"string")])])],-1)),d("div",Cee,[T[1]||(T[1]=d("div",{class:"field-item-label"},"知识库",-1)),d("div",See,[(w(!0),P(ae,null,ye(m.value,O=>(w(),P("div",{class:"library-item",key:O.id},j(O.library_name),1))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Eee=$e(kee,[["__scopeId","data-v-fdcd67a5"]]);let Dee=class extends tn{constructor(e){super(e),this.renderVue(Eee,e)}},Aee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Oee={type:"knowledge-base-node",model:Aee,view:Dee},Nee={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function Mee(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[d("div",{class:"end-node"},[d("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const Tee=$e(Nee,[["render",Mee],["__scopeId","data-v-a5fffb68"]]);let $ee=class extends tn{constructor(e){super(e),this.renderVue(Tee,e)}},Pee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const Ree={type:"end-node",model:Pee,view:$ee},Bee={class:"explain-node"},Lee={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({content:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let r=JSON.parse(t.properties.node_params);Object.assign(o,r),Pt(()=>{e()})};return ut(()=>{i()}),(r,s)=>{const a=$i;return w(),Z(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Bee,[y(a,{"auto-size":"",bordered:!1,class:"explain-textarea",value:o.content,"onUpdate:value":s[0]||(s[0]=l=>o.content=l),placeholder:""},null,8,["value"])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}}};let Iee=class extends tn{constructor(e){super(e),this.renderVue(Lee,e)}},Fee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[]}};const jee={type:"explain-node",model:Fee,view:Iee},Vee={class:"ai-dialogue-node"},Hee={class:"field-list"},Uee={class:"field-item"},zee={class:"field-item-content"},qee={class:"field-text"},Gee={class:"right-arrow"},Xee={class:"field-text"},Wee={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=X([]),a=Je({list:[]}),l=X([]),u=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let _=[];try{_=JSON.parse(v).assign||[]}catch(m){}p(),_.forEach(m=>{m.tags=m.tags||[]}),a.list=_,Pt(()=>{c()})},c=()=>{let v=JSON.parse(e.properties.node_params);v.assign=[...a.list],t({...e.node,node_params:JSON.stringify(v)})};function f(v){return v?v.split(".")[1]:""}const p=()=>{let v=i().getAllParentVariable();v.forEach(_=>{_.tags=_.tags||[]}),l.value=v},h=v=>{yo.includes(v.node_type)&&(p(),Pt(()=>{a.list.forEach(_=>{_.tags&&_.tags.length>0&&_.tags.forEach(m=>{if(m.node_id==v.node_id){let g=m.label.split("/");g[0]=v.node_name,m.label=g.join("/"),m.node_name=v.node_name}})}),c()}))};return gt(()=>e.properties,u,{deep:!0}),ut(()=>{u(),r(),o().eventCenter.on("custom:setNodeName",h)}),no(()=>{o().eventCenter.off("custom:setNodeName",h)}),(v,_)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Vee,[d("div",Hee,[d("div",Uee,[_[0]||(_[0]=d("div",{class:"field-item-label"},"变量",-1)),d("div",zee,[(w(!0),P(ae,null,ye(a.list,(m,g)=>(w(),P("div",{class:"field-list-item",key:g},[d("div",qee,[y(yn,{options:l.value,"default-value":m.value,defaultSelectedList:m.tags},null,8,["options","default-value","defaultSelectedList"])]),d("div",Gee,[y(ee(ea))]),d("div",Xee,j(f(m.variable)),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Yee=$e(Wee,[["__scopeId","data-v-87425de8"]]);let Kee=class extends tn{constructor(e){super(e),this.renderVue(Yee,e)}},Jee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Zee={type:"variable-assignment-node",model:Jee,view:Kee},Qee={class:"judge-node"},ete={class:"if-box-label"},tte={class:"if-box-content"},nte={class:"condition-box"},ote={key:0,class:"condition-left-box"},ite={class:"connection-text"},rte={key:1,class:"condition-line"},ste={class:"condition-body"},ate={class:"field-items"},lte={class:"field-name"},ute={class:"field-rule"},dte={class:"field-value"},cte={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("resetSize"),o=He("getNode"),i=He("updateAnchorList"),r=Je({term:[]}),s=X([]),a=X([]);function l(){let g=o().getAllParentVariable();s.value=u(g)}function u(g){return g.forEach(b=>{b.typ=="node"?b.node_type==1?b.value="global":b.value=b.node_id:b.value=b.key,b.children&&b.children.length>0&&(b.children=u(b.children))}),g}let c=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],f=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function p(g){let b="";if(g.variable&&g.variable.length>0){let C=s.value.filter(D=>D.key==g.variable[0]);C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(D=>D.key==g.variable[1])),C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(D=>D.key==g.variable[2])),C&&C.length&&(b=C[0].typ)))}return b}function h(g){if(!g.variable)return[];let b=p(g);return b==""?g.is_mult?f:c:b=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:b.includes("array")?f:c}const v=g=>{let b=h(g),C=b.findIndex(D=>D.value==g.type);return b[C].label},_=()=>{try{let g=JSON.parse(e.properties.node_params).term||[];g=g.map(b=>{let C=b.terms.map(D=>{let T="";for(let O=0;O<Oo.length;O++)if(D.variable.indexOf(Oo[O])>-1){T=Oo[O];break}if(T!=""){let O=D.variable.split(".");D.variable=[O[0],T]}else D.variable=D.variable.split(".");return{...D,type:D.type>0?D.type:1,key:Math.random()*1e4}});return{...b,is_or:b.is_or?1:0,terms:C,key:Math.random()*1e4}}),r.term=g,Pt(()=>{t(),m()})}catch(g){}},m=()=>{const g=e.properties.nodeSortKey;let b=[],C=56;for(let D=0;D<r.term.length;D++){let T=r.term[D];if(T){let O=0,k=C,S=8,N=2,L=24,$=T.terms.length;O=$*L+S*2+N*($-1),D>0&&D<r.term.length&&(k+=8),C=k+O,b.push({id:g+"-anchor_"+D,offsetHeight:O,offsetTop:k})}}b.length>0&&b.push({id:g+"-anchor_right",offsetHeight:24,offsetTop:C+8}),i(b)};return gt(()=>e.properties.node_params,(g,b)=>{g!=b&&_()},{deep:!0}),ut(()=>{l(),_()}),(g,b)=>(w(),Z(on,{properties:n.properties,title:n.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Qee,[(w(!0),P(ae,null,ye(r.term,(C,D)=>(w(),P("div",{class:"if-box",ref_for:!0,ref:T=>a.value[D]=T,key:D},[d("div",ete,j(D==0?"if":"else if"),1),d("div",tte,[d("div",nte,[C.terms.length>1?(w(),P("div",ote,[d("span",ite,j(C.is_or==1?"or":"and"),1)])):ie("",!0),C.terms.length>1?(w(),P("div",rte)):ie("",!0),d("div",ste,[d("div",ate,[(w(!0),P(ae,null,ye(C.terms,(T,O)=>(w(),P("div",{class:"field-item",key:O},[d("span",lte,[y(lr,{value:T.variable},null,8,["value"])]),d("span",ute,j(v(T)),1),d("span",dte,j(T.value),1)]))),128))])])])])]))),128)),b[0]||(b[0]=d("div",{class:"else-box"},[d("div",{class:"else-box-label"},"else"),d("div",{class:"else-box-content"},[d("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},fte=$e(cte,[["__scopeId","data-v-029a488b"]]);let pte=class extends tn{constructor(e){super(e),this.renderVue(fte,e)}},hte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s,anchorList:a}=this.properties;let l=[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e}];if(a)for(let u=0;u<a.length;u++){let{offsetTop:c,offsetHeight:f}=a[u],p=o-r/2;l.push({id:a[u].id,nodeId:e,x:t+i/2,y:p+c+f/2,type:"right"})}return l}};const vte={type:"judge-node",model:hte,view:pte},gte={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},_te={class:"specify-reply-node"},mte={class:"static-field-list"},yte={class:"static-field-item"},bte={class:"static-field-item-content"},xte={class:"static-field-value"};function wte(n,e,t,o,i,r){const s=Nt("AtText"),a=Nt("node-common");return w(),Z(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",_te,[d("div",mte,[d("div",yte,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"消息内容",-1)),d("div",bte,[d("div",xte,[i.formState.content.length>0?(w(),Z(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ie("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Cte=$e(gte,[["render",wte],["__scopeId","data-v-cd46975b"]]);let Ste=class extends tn{constructor(e){super(e),this.renderVue(Cte,e)}},kte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Ete={type:"specify-reply-node",model:kte,view:Ste},Dte={name:"ImmediatelyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).immediately_reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.immediately_reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},Ate={class:"specify-reply-node"},Ote={class:"static-field-list"},Nte={class:"static-field-item"},Mte={class:"static-field-item-content"},Tte={class:"static-field-value"};function $te(n,e,t,o,i,r){const s=Nt("AtText"),a=Nt("node-common");return w(),Z(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",Ate,[d("div",Ote,[d("div",Nte,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"消息内容",-1)),d("div",Mte,[d("div",Tte,[i.formState.content.length>0?(w(),Z(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ie("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Pte=$e(Dte,[["render",$te],["__scopeId","data-v-f9617244"]]);let Rte=class extends tn{constructor(e){super(e),this.renderVue(Pte,e)}},Bte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Lte={type:"immediately-reply-node",model:Bte,view:Rte},Ite={class:"ai-dialogue-node"},Fte={class:"field-list"},jte={class:"field-item"},Vte={class:"field-item-content"},Hte={class:"field-value"},Ute={class:"field-item"},zte={class:"field-item-content"},qte={class:"field-value"},Gte={class:"field-key"},Xte={class:"field-item"},Wte={class:"field-item-content"},Yte={class:"field-key"},Kte={class:"field-type"},Jte={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=jn(),{modelList:a}=Ia(s),l=X(null),u=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),f=X([]),p=X([]);function h(T){if(T){let O=T.split("."),k=O[0],S=O.filter((N,L)=>L>0).join(".");return[k,S]}return["global","question"]}function v(T){return T.forEach(O=>{O.cu_key=Math.random()*1e4,O.subs&&O.subs.length?v(O.subs):O.subs=[]}),T}const _=()=>{const T=e.properties.dataRaw||e.properties.node_params||"{}";let O={};try{O=JSON.parse(T).params_extractor||{}}catch{O={}}O=JSON.parse(JSON.stringify(O)),g(),b();for(let k in O){if(k=="output"){c.output=v(O[k]);continue}if(k=="question_value"){c.question_value=h(O[k]);continue}c[k]=O[k]}!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Pt(()=>{r()})},m=()=>{const T=JSON.stringify({params_extractor:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:T})},g=()=>{let T=i().getAllParentVariable();T.forEach(O=>{O.tags=O.tags||[]}),f.value=T};function b(){let T=i().getAllParentVariable();p.value=C(T)}function C(T){return T.forEach(O=>{O.typ=="node"?O.node_type==1?O.value="global":O.value=O.node_id:O.value=O.key,O.children&&O.children.length>0&&(O.children=C(O.children))}),T}const D=T=>{yo.includes(T.node_type)&&(g(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(O=>{if(O.node_id==T.node_id){let k=O.label.split("/");k[0]=T.node_name,O.label=k.join("/"),O.node_name=T.node_name}}),m(),l.value.refresh())};return gt(()=>e.properties.dataRaw,(T,O)=>{T!=O&&_()},{deep:!0}),ut(()=>{_(),r(),o().eventCenter.on("custom:setNodeName",D)}),no(()=>{o().eventCenter.off("custom:setNodeName",D)}),(T,O)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Ite,[d("div",Fte,[d("div",jte,[O[0]||(O[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",Vte,[d("div",Hte,[y(lr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),d("div",Ute,[O[1]||(O[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",zte,[d("div",qte,[d("span",Gte,[y(Za,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",Xte,[O[2]||(O[2]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",Wte,[(w(!0),P(ae,null,ye(c.output,k=>(w(),P("div",{class:Ct(["field-value",{"is-required":k.required}]),key:k.cu_key},[d("span",Yte,j(k.key),1),d("span",Kte,j(k.typ),1)],2))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Zte=$e(Jte,[["__scopeId","data-v-0ed6467b"]]);let Qte=class extends tn{constructor(e){super(e),this.renderVue(Zte,e)}},ene=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const tne={type:"parameter-extraction-node",model:ene,view:Qte},nne={class:"ai-dialogue-node"},one={class:"static-field-list"},ine={class:"static-field-item"},rne={class:"static-field-item-content"},sne={class:"static-field-value"},ane={class:"static-field-item"},lne={class:"static-field-item-content"},une={class:"static-field-value"},dne={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=X(null),o=He("setData"),i=He("getGraph"),r=He("getNode"),s=He("resetSize"),a=jn(),{modelList:l}=Ia(a),u=X([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),f=X([]);function p(g){if(g){let b=g.split("."),C=b[0],D=b.filter((T,O)=>O>0).join(".");return[C,D]}return["global","question"]}const h=()=>{const g=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(g).question_optimize||{}}catch{b={}}_();const{model_config_id:C,use_model:D,context_pair:T,temperature:O,max_token:k,prompt:S,prompt_tags:N,question_value:L,enable_thinking:$}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=D,c.context_pair=T||0,c.temperature=O,c.max_token=k,c.prompt=S,c.enable_thinking=$,c.prompt_tags=N||[],c.question_value=p(L),!c.model_config_id&&l.value.length>0&&(c.model_config_id=l.value[0].id,c.use_model=l.value[0].children[0].name),Pt(()=>{s()})},v=()=>{const g={...c,node_params:JSON.stringify({question_optimize:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}})};o(g)},_=()=>{let g=r().getAllParentVariable();f.value=g},m=g=>{_(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==g.node_id){let C=b.label.split("/");C[0]=g.node_name,b.label=C.join("/"),b.node_name=g.node_name}}),v(),t.value.refresh()};return gt(()=>e.properties,h,{deep:!0}),ut(()=>{h(),Pt(()=>{s()}),i().eventCenter.on("custom:setNodeName",m)}),no(()=>{i().eventCenter.off("custom:setNodeName",m)}),(g,b)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",nne,[d("div",one,[d("div",ine,[b[0]||(b[0]=d("div",{class:"static-field-item-label"},"用户问题",-1)),d("div",rne,[d("div",sne,[y(lr,{ref_key:"questionTextRef",ref:t,value:c.question_value},null,8,["value"])])])]),d("div",ane,[b[1]||(b[1]=d("div",{class:"static-field-item-label"},"LLM模型",-1)),d("div",lne,[d("div",une,[y(Za,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])]),b[2]||(b[2]=d("div",{class:"static-field-item"},[d("div",{class:"static-field-item-label"},"输出"),d("div",{class:"static-field-item-content"},[d("div",{class:"static-field-value"},[d("span",{class:"static-field-key"},"问题优化结果"),d("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},cne=$e(dne,[["__scopeId","data-v-5160325d"]]);let fne=class extends tn{constructor(e){super(e),this.renderVue(cne,e)}},pne=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const hne={type:"problem-optimization-node",model:pne,view:fne},La="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",vne={class:"add-data-node"},gne={class:"static-field-list"},_ne={class:"static-field-item"},mne={class:"static-field-item-content"},yne={class:"static-field-value"},bne={class:"static-field-item"},xne={class:"static-field-item-content"},wne={key:0,class:"static-field-value"},Cne={class:"field-name"},Sne={class:"field-name"},kne={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=He("getGraph"),s=X(null);let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),u=X([]),c=()=>{let v=i().getAllParentVariable();u.value=v||[]},f=()=>{let v=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(v),c(),l.formData=a.form_insert,p(),Pt(()=>{o()})},p=()=>{a.form_insert=Bn(l.formData),t({...e.node,node_params:JSON.stringify(a)})};gt(()=>e.properties.dataRaw,(v,_)=>{v!==_&&f()}),ut(()=>{r().eventCenter.on("custom:setNodeName",h),f()}),qc(()=>{r().eventCenter.off("custom:setNodeName",h)});const h=v=>{!l.formData.datas||l.formData.datas.length==0||yo.includes(v.node_type)&&(c(),l.formData.datas.forEach(_=>{_.atTags&&_.atTags.length>0&&_.atTags.forEach(m=>{if(m.node_id==v.node_id){let g=m.label.split("/");g[0]=v.node_name,m.label=g.join("/"),m.node_name=v.node_name}})}),p(),Pt(()=>{s.value.map(_=>_.refresh()),o()}))};return(v,_)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",vne,[d("div",gne,[d("div",_ne,[_[0]||(_[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",mne,[d("div",yne,j(l.formData.form_name||"--"),1)])]),d("div",bne,[_[2]||(_[2]=d("div",{class:"static-field-item-label"},"插入数据",-1)),d("div",xne,[l.formData.datas.length==0?(w(),P("div",wne,"--")):ie("",!0),(w(!0),P(ae,null,ye(l.formData.datas,m=>(w(),P("div",{class:"static-field-value",key:m.id},[d("span",Cne,[y(yn,{options:u.value,"default-value":m.value,defaultSelectedList:m.atTags,ref_for:!0,ref_key:"atInputRef",ref:s},null,8,["options","default-value","defaultSelectedList"])]),_[1]||(_[1]=d("span",{class:"field-arrow"},[d("img",{src:La,alt:""})],-1)),d("span",Sne,j(m.name),1)]))),128))])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Ene=$e(kne,[["__scopeId","data-v-267b065a"]]);let Dne=class extends tn{constructor(e){super(e),this.renderVue(Ene,e)}},Ane=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const One={type:"add-data-node",model:Ane,view:Dne},Nne={class:"node-box"},Mne={class:"static-field-list"},Tne={class:"static-field-item"},$ne={class:"static-field-item-content"},Pne={class:"static-field-value"},Rne={class:"static-field-item",style:{"align-items":"center"}},Bne={class:"static-field-item-content"},Lne={key:0,class:"static-field-value"},Ine={class:"condition-box"},Fne={key:0,class:"condition-left-box"},jne={class:"connection-text"},Vne={key:1,class:"condition-line"},Hne={class:"condition-body"},Une={class:"field-items"},zne={class:"field-name"},qne={class:"field-rule"},Gne={class:"field-value"},Xne={class:"static-field-item"},Wne={class:"static-field-item-content"},Yne={class:"options-list"},Kne={class:"option-label"},Jne={class:"option-label"},Zne={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=or();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),l=X([]),u=()=>{let m=i().getAllParentVariable();l.value=m||[]},c=()=>{let m=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(m),u();let g=p(s.form_update.where||[]);s.form_update.where=g,a.formData=s.form_update,a.formData.form_id&&v(a.formData.form_id),f(),Pt(()=>{o()})},f=()=>{let m={...Bn(a.formData)};m.where=h(m.where),s.form_update=m,t({...e.node,node_params:JSON.stringify(s)})},p=m=>{let g=[];return m.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),D=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=D[0],D.shift(),C.rule=D.join("_"),g.push(C)}),g},h=m=>{let g=[];return m.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,g.push(C)}),g},v=async m=>{r.getFormFieldList({form_id:m}).then(g=>{g.forEach(b=>{b.id=b.id*1}),a.fieldList=g}).catch(()=>{})},_=(m,g)=>nf(g,m);return gt(()=>e.properties.dataRaw,(m,g)=>{m!==g&&c()}),ut(()=>{c()}),(m,g)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",Nne,[d("div",Mne,[d("div",Tne,[g[0]||(g[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",$ne,[d("div",Pne,j(a.formData.form_name||"--"),1)])]),d("div",Rne,[g[2]||(g[2]=d("div",{class:"static-field-item-label"},"更新条件",-1)),d("div",Bne,[a.formData.where.length==0?(w(),P("span",Lne,"--")):ie("",!0),d("div",Ine,[a.formData.where.length>1?(w(),P("div",Fne,[d("span",jne,j(a.formData.typ==1?"且":"或"),1)])):ie("",!0),a.formData.where.length>1?(w(),P("div",Vne)):ie("",!0),d("div",Hne,[d("div",Une,[(w(!0),P(ae,null,ye(a.formData.where,b=>(w(),P("div",{class:"field-item",key:b.id},[d("span",zne,j(b.field_name),1),d("span",qne,j(_(b.field_type,b.rule)),1),d("span",Gne,[y(yn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),P(ae,{key:0},[g[1]||(g[1]=d("span",null,"-",-1)),y(yn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])]),d("div",Xne,[g[4]||(g[4]=d("div",{class:"static-field-item-label"},"更新数据",-1)),d("div",Wne,[d("div",Yne,[(w(!0),P(ae,null,ye(a.formData.datas,b=>(w(),P("div",{class:"options-item",key:b.key},[d("div",Kne,[y(yn,{options:l.value,"default-value":b.value,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"])]),g[3]||(g[3]=d("span",{class:"field-arrow"},[d("img",{src:La,alt:""})],-1)),d("div",Jne,j(b.name),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Qne=$e(Zne,[["__scopeId","data-v-d2e3d4b8"]]);let eoe=class extends tn{constructor(e){super(e),this.renderVue(Qne,e)}},toe=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const noe={type:"update-data-node",model:toe,view:eoe},ooe={class:"node-box"},ioe={class:"static-field-list"},roe={class:"static-field-item"},soe={class:"static-field-item-content"},aoe={class:"static-field-value"},loe={class:"static-field-item",style:{"align-items":"center"}},uoe={class:"static-field-item-content"},doe={key:0,class:"static-field-value"},coe={class:"condition-box"},foe={key:0,class:"condition-left-box"},poe={class:"connection-text"},hoe={key:1,class:"condition-line"},voe={class:"condition-body"},goe={class:"field-items"},_oe={class:"field-name"},moe={class:"field-rule"},yoe={class:"field-value"},boe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("resetSize"),o=He("setData"),i=He("getNode"),r=or();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),l=X([]),u=()=>{let m=i().getAllParentVariable();l.value=m||[]},c=()=>{let m=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(m),u();let g=h(s.form_delete.where||[]);s.form_delete.where=g,a.formData=s.form_delete,a.formData.form_id&&v(a.formData.form_id),f(),Pt(()=>{t()})},f=()=>{let m={...Bn(a.formData)};m.where=p(m.where),s.form_delete=m,o({...e.node,node_params:JSON.stringify(s)})},p=m=>{let g=[];return m.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,g.push(C)}),g},h=m=>{let g=[];return m.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),D=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=D[0],D.shift(),C.rule=D.join("_"),g.push(C)}),g},v=async m=>{r.getFormFieldList({form_id:m}).then(g=>{g.forEach(b=>{b.id=b.id*1}),a.fieldList=g,Pt(()=>{t()})}).catch(()=>{})},_=(m,g)=>nf(g,m);return gt(()=>e.properties.dataRaw,(m,g)=>{m!==g&&c()}),ut(()=>{c()}),(m,g)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",ooe,[d("div",ioe,[d("div",roe,[g[0]||(g[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",soe,[d("div",aoe,j(a.formData.form_name||"--"),1)])]),d("div",loe,[g[2]||(g[2]=d("div",{class:"static-field-item-label"},"删除条件",-1)),d("div",uoe,[a.formData.where.length==0?(w(),P("span",doe,"--")):ie("",!0),d("div",coe,[a.formData.where.length>1?(w(),P("div",foe,[d("span",poe,j(a.formData.typ==1?"且":"或"),1)])):ie("",!0),a.formData.where.length>1?(w(),P("div",hoe)):ie("",!0),d("div",voe,[d("div",goe,[(w(!0),P(ae,null,ye(a.formData.where,b=>(w(),P("div",{class:"field-item",key:b.id},[d("span",_oe,j(b.field_name),1),d("span",moe,j(_(b.field_type,b.rule)),1),d("span",yoe,[y(yn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),P(ae,{key:0},[g[1]||(g[1]=d("span",null,"-",-1)),y(yn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},xoe=$e(boe,[["__scopeId","data-v-a8352cc1"]]);let woe=class extends tn{constructor(e){super(e),this.renderVue(xoe,e)}},Coe=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Soe={type:"delete-data-node",model:Coe,view:woe},koe={class:"node-box"},Eoe={class:"static-field-list"},Doe={class:"static-field-item"},Aoe={class:"static-field-item-content"},Ooe={class:"static-field-value"},Noe={class:"static-field-item",style:{"align-items":"center"}},Moe={class:"static-field-item-content"},Toe={key:0,class:"static-field-value"},$oe={class:"condition-box"},Poe={key:0,class:"condition-left-box"},Roe={class:"connection-text"},Boe={key:1,class:"condition-line"},Loe={class:"condition-body"},Ioe={class:"field-items"},Foe={class:"field-name"},joe={class:"field-rule"},Voe={class:"field-value"},Hoe={class:"static-field-item"},Uoe={class:"static-field-item-content"},zoe={class:"options-list"},qoe={class:"option-label"},Goe={class:"option-type"},Xoe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=He("getGraph"),s=or();let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),u=X([]),c=()=>{let C=i().getAllParentVariable();u.value=C||[]},f=()=>{let C=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(C),c();let D=h(a.form_select.where||[]);a.form_select.where=D,l.formData=a.form_select,l.formData.form_id&&m(l.formData.form_id),p(),Pt(()=>{o()})},p=()=>{let C={...Bn(l.formData)};C.where=v(C.where),a.form_select=C,t({...e.node,node_params:JSON.stringify(a)})},h=C=>{let D=[];return C.forEach(T=>{let O=JSON.parse(JSON.stringify(T)),k=O.rule.split("_");O.form_field_id=O.form_field_id*1,O.field_type=k[0],k.shift(),O.rule=k.join("_"),D.push(O)}),D},v=C=>{let D=[];return C.forEach(T=>{let O=JSON.parse(JSON.stringify(T));O.form_field_id=O.form_field_id*1,O.rule=T.field_type+"_"+T.rule,D.push(O)}),D},_=async()=>{const C=await s.getFormList();C&&(l.tableList=C)},m=async C=>{s.getFormFieldList({form_id:C}).then(D=>{D.forEach(T=>{T.id=T.id*1}),l.fieldList=D}).catch(()=>{})},g=(C,D)=>nf(D,C),b=()=>{f()};return gt(()=>e.properties.dataRaw,(C,D)=>{C!==D&&f()}),ut(()=>{_(),f(),r().eventCenter.on("custom:setNodeName",b)}),no(()=>{r().eventCenter.off("custom:setNodeName",b)}),(C,D)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",koe,[d("div",Eoe,[d("div",Doe,[D[0]||(D[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",Aoe,[d("div",Ooe,j(l.formData.form_name||"--"),1)])]),d("div",Noe,[D[2]||(D[2]=d("div",{class:"static-field-item-label"},"查询条件",-1)),d("div",Moe,[l.formData.where.length==0?(w(),P("span",Toe,"--")):ie("",!0),d("div",$oe,[l.formData.where.length>1?(w(),P("div",Poe,[d("span",Roe,j(l.formData.typ==1?"且":"或"),1)])):ie("",!0),l.formData.where.length>1?(w(),P("div",Boe)):ie("",!0),d("div",Loe,[d("div",Ioe,[(w(!0),P(ae,null,ye(l.formData.where,T=>(w(),P("div",{class:"field-item",key:T.id},[d("span",Foe,j(T.field_name),1),d("span",joe,j(g(T.field_type,T.rule)),1),d("span",Voe,[y(yn,{options:u.value,"default-value":T.rule_value1,defaultSelectedList:T.atTags},null,8,["options","default-value","defaultSelectedList"]),T.rule_value2?(w(),P(ae,{key:0},[D[1]||(D[1]=d("span",null,"-",-1)),y(yn,{options:u.value,"default-value":T.rule_value2,defaultSelectedList:T.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])]),d("div",Hoe,[D[3]||(D[3]=d("div",{class:"static-field-item-label"},"查询字段",-1)),d("div",Uoe,[d("div",zoe,[(w(!0),P(ae,null,ye(l.formData.fields,T=>(w(),P("div",{class:"options-item",key:T.key},[d("div",qoe,j(T.name),1),d("div",Goe,j(T.type),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Woe=$e(Xoe,[["__scopeId","data-v-be12c955"]]);let Yoe=class extends tn{constructor(e){super(e),this.renderVue(Woe,e)}},Koe=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Joe={type:"select-data-node",model:Koe,view:Yoe},Zoe={class:"ai-dialogue-node"},Qoe={class:"field-list"},eie={class:"field-item"},tie={class:"field-item-content"},nie={class:"field-text"},oie={class:"right-arrow"},iie={class:"field-text"},rie={class:"field-item"},sie={class:"field-item-content"},aie={class:"field-key"},lie={class:"field-type"},uie=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,die={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=X([]),a=Je({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),l=X([]);function u(_){return _.forEach(m=>{m.cu_key=Math.random()*1e4,m.subs&&m.subs.length?u(m.subs):m.subs=[]}),_}const c=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let m={};try{m=JSON.parse(_).code_run||{}}catch{m={}}h(),m=JSON.parse(JSON.stringify(m));for(let g in m){if(g=="params"){m[g]&&m[g].length>0?a[g]=m[g].map(b=>({...b,cu_key:Math.random()*1e4})):a[g]=[];continue}if(g=="output"){a.output=u(m[g]);continue}a[g]=m[g]}a.main_func=a.main_func||uie,a.params=a.params.map(g=>{let b="";for(let C=0;C<Oo.length;C++)if(g.variable.indexOf(Oo[C])>-1){b=Oo[C];break}if(b!=""){let C=g.variable.split(".");g.variable=[C[0],b]}else g.variable=g.variable.split(".");return{...g,key:Math.random()*1e4}}),Pt(()=>{r()})},f=()=>{const _=JSON.stringify({code_run:{...a,params:p()}});t({...e.node,...a,node_params:_})};function p(){let _=[];return a.params.forEach(m=>{_.push({field:m.field,variable:m.variable&&m.variable.length>0?m.variable.join("."):""})}),_}const h=()=>{let _=i().getAllParentVariable();l.value=_},v=_=>{yo.includes(_.node_type)&&(h(),Pt(()=>{f()}))};return gt(()=>e.properties,c,{deep:!0}),ut(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",v)}),no(()=>{o().eventCenter.off("custom:setNodeName",v)}),(_,m)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Zoe,[d("div",Qoe,[d("div",eie,[m[0]||(m[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",tie,[(w(!0),P(ae,null,ye(a.params,g=>(w(),P("div",{class:"field-list-item",key:g.cu_key},[d("div",nie,[y(lr,{value:g.variable},null,8,["value"])]),d("div",oie,[y(ee(ea))]),d("div",iie,j(g.field),1)]))),128))])]),d("div",rie,[m[1]||(m[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",sie,[(w(!0),P(ae,null,ye(a.output,g=>(w(),P("div",{class:"field-value",key:g.cu_key},[d("span",aie,j(g.key),1),d("span",lie,j(g.typ),1)]))),128))])]),m[2]||(m[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"异常处理"),d("div",{class:"field-item-content"},[d("div",{class:"field-value"},[d("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},cie=$e(die,[["__scopeId","data-v-32218aac"]]);let fie=class extends tn{constructor(e){super(e),this.renderVue(cie,e)}},pie=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(o,i,r,s)=>{if(o.id==i.id)return!1;const a=o.graphModel.edges.map(u=>u.sourceAnchorId),l=r.id;return r.type==="right"&&!a.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(o,i,r,s)=>o.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}};const hie={type:"code-run-node",model:pie,view:fie},vie={name:"QuestionNode",components:{NodeCommon:on,AtText:yn},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}},valueOptions:[]}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.valueOptions=this.getNode().getAllParentVariable()||[],this.loadProvider(),this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.$nextTick(()=>{this.resetSize()})},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParams=JSON.parse(this.properties.node_params||"{}"),this.$nextTick(()=>{const t=this.$refs.atTextRef;(Array.isArray(t)?t:t?[t]:[]).forEach(i=>{i&&i.refresh&&i.refresh()}),this.resetSize()}))},deep:!0}},methods:{onUpatateNodeName(n){var o,i;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=r=>{!Array.isArray(r)||r.length===0||r.forEach(s=>{if(s&&s.node_id==n.node_id){if(s.label){let a=s.label.split("/");a[0]=n.node_name,s.label=a.join("/")}s.node_name=n.node_name}})},t=((i=(o=this.nodeParams)==null?void 0:o.mcp)==null?void 0:i.tag_map)||{};Object.keys(t).forEach(r=>{e(t[r])}),this.$nextTick(()=>{const r=this.$refs.atTextRef;(Array.isArray(r)?r:r?[r]:[]).forEach(a=>{a&&a.refresh&&a.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.resetSize()})},loadProvider(){var n;kg({provider_id:((n=this.nodeParams)==null?void 0:n.mcp.provider_id)||""}).then(e=>{var o;this.mcpInfo=(e==null?void 0:e.data)||{};let t=To((o=this.mcpInfo)==null?void 0:o.tools,[]);this.toolInfo=t.find(i=>{var r;return i.name==((r=this.nodeParams)==null?void 0:r.mcp.tool_name)}),this.$nextTick(()=>{this.resetSize()})})},update(n){let e=this.nodeParams;e.mcp.arguments=n.arguments,e.mcp.tag_map=n.tag_map,this.setData({node_params:JSON.stringify(e)})},getArgValue(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.arguments)==null?void 0:i[n];return e==null?"":String(e)},getArgTags(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.tag_map)==null?void 0:i[n];return Array.isArray(e)?e:[]}},computed:{propList(){var o;const n=((o=this.toolInfo)==null?void 0:o.inputSchema)||{},e=(n==null?void 0:n.properties)||{},t=Array.isArray(n==null?void 0:n.required)?n.required:[];return Object.keys(e).map(i=>(e[i],{key:i,required:t.includes(i)}))}}},gie={class:"_main"},_ie={class:"label"};function mie(n,e,t,o,i,r){const s=Nt("at-text"),a=mi,l=Nt("node-common");return w(),Z(l,{properties:t.properties,title:t.properties.node_name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"94px"}},{default:x(()=>[d("div",gie,[(w(!0),P(ae,null,ye(r.propList,u=>(w(),P("div",{key:u.key},[d("span",_ie,j(u.key)+"：",1),r.getArgValue(u.key)?(w(),Z(a,{key:0},{default:x(()=>[y(s,{options:i.valueOptions,defaultSelectedList:r.getArgTags(u.key),defaultValue:r.getArgValue(u.key),ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Z(a,{key:1},{default:x(()=>[...e[0]||(e[0]=[z("--",-1)])]),_:1}))]))),128))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key"])}const yie=$e(vie,[["render",mie],["__scopeId","data-v-c187f56c"]]);let bie=class extends tn{constructor(e){super(e),this.renderVue(yie,e)}},xie=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const wie={type:"mcp-node",model:xie,view:bie},Cie={name:"feishu-table-render",components:{AtText:yn},props:{business:{type:String},nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{BatchActions:zd,batchActionParam:{},operatorMap:Rg(),actionState:{}}},async mounted(){zd.includes(this.business)&&await this.initParams(),this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{async initParams(){await Po({name:"feishu_bitable",action:"default/get-schema",params:{}}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.batchActionParam=Bg(((t=e[this.business])==null?void 0:t.params)||{})})},dataFormat(){var o,i,r,s,a;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},{config_name:e,table_name:t}=((a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)||{};this.actionState={...n,config_name:e,table_name:t}}}},Sie={class:"_main"},kie={key:0},Eie={key:1},Die={key:2},Aie={key:3},Oie={key:4},Nie={key:0,class:"field-box"},Mie={key:0},Tie={key:1},$ie={key:1},Pie={key:5},Rie={key:0,class:"field-box"},Bie={class:"arrow-icon"},Lie={key:0},Iie={key:1},Fie={key:1},jie={key:0,class:"field-box"},Vie={key:1},Hie={key:0,class:"field-box"},Uie={key:0},zie={key:1},qie={key:1},Gie={key:10},Xie={class:"label"},Wie={key:0,class:"field-box"},Yie={key:1};function Kie(n,e,t,o,i,r){var l,u;const s=mi,a=Nt("at-text");return w(),P("div",Sie,[d("div",null,[e[0]||(e[0]=d("span",{class:"label"},"配置：",-1)),y(s,null,{default:x(()=>{var c;return[z(j(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})]),["create_bitable","create_tables","table_add_members","update_advanced","roles_list"].includes(t.business)?ie("",!0):(w(),P("div",kie,[e[1]||(e[1]=d("span",{class:"label"},"数据表：",-1)),y(s,null,{default:x(()=>{var c,f,p,h,v,_,m;return[(f=(c=i.actionState)==null?void 0:c.tag_map)!=null&&f.table_id&&((h=(p=i.actionState)==null?void 0:p.tag_map)!=null&&h.table_id.length)?(w(),Z(a,{key:0,class:"batch-render-at",options:t.valueOptions,defaultSelectedList:i.actionState.tag_map.table_id,defaultValue:(v=i.actionState)==null?void 0:v.table_id},null,8,["options","defaultSelectedList","defaultValue"])):(w(),P(ae,{key:1},[z(j(((_=i.actionState)==null?void 0:_.table_name)||((m=i.actionState)==null?void 0:m.table_id)||"--"),1)],64))]}),_:1})])),t.business=="create_bitable"?(w(),P("div",Eie,[e[2]||(e[2]=d("span",{class:"label"},"多维表名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:((p=i.actionState)==null?void 0:p.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_tables"?(w(),P("div",Die,[e[3]||(e[3]=d("span",{class:"label"},"数据表名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:((p=i.actionState)==null?void 0:p.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_views"?(w(),P("div",Aie,[e[4]||(e[4]=d("span",{class:"label"},"视图名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.view_name)||[],defaultValue:((p=i.actionState)==null?void 0:p.view_name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_record"?(w(),P("div",Oie,[e[7]||(e[7]=d("span",{class:"label"},"插入数据：",-1)),Array.isArray(i.actionState.fields)?(w(),P("div",Nie,[(w(!0),P(ae,null,ye(i.actionState.fields,c=>(w(),Z(s,{class:"field-tag",key:c.field_name},{default:x(()=>[d("span",null,j(c.field_name),1),e[5]||(e[5]=d("span",{class:"arrow-icon"},[d("img",{src:La})],-1)),c.value?(w(),P("span",Mie,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),P("span",Tie))]),_:2},1024))),128))])):(w(),P("div",$ie,[y(s,null,{default:x(()=>[...e[6]||(e[6]=[z("--",-1)])]),_:1})]))])):t.business=="delete_record"?(w(),P("div",Pie,[e[9]||(e[9]=d("span",{class:"label"},"删除ID：",-1)),i.actionState.record_id?(w(),Z(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Z(s,{key:1},{default:x(()=>[...e[8]||(e[8]=[z("--",-1)])]),_:1}))])):t.business=="search_records"?(w(),P(ae,{key:6},[d("div",null,[e[11]||(e[11]=d("span",{class:"label"},"查询条件：",-1)),Array.isArray((u=(l=i.actionState)==null?void 0:l.filter)==null?void 0:u.conditions)&&i.actionState.filter.conditions.length?(w(),P("div",Rie,[(w(!0),P(ae,null,ye(i.actionState.filter.conditions,c=>(w(),Z(s,{class:"field-tag",key:c.field_id},{default:x(()=>{var f;return[d("span",null,j(c.field_name),1),d("span",Bie,j((f=i.operatorMap[c.operator])==null?void 0:f.label),1),c.value?(w(),P("span",Lie,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),P("span",Iie))]}),_:2},1024))),128))])):(w(),P("div",Fie,[y(s,null,{default:x(()=>[...e[10]||(e[10]=[z("--",-1)])]),_:1})]))]),d("div",null,[e[13]||(e[13]=d("span",{class:"label"},"查询字段：",-1)),Array.isArray(i.actionState.field_names)&&i.actionState.field_names.length?(w(),P("div",jie,[(w(!0),P(ae,null,ye(i.actionState.field_names,c=>(w(),Z(s,{class:"field-tag",key:c.field},{default:x(()=>[z(j(c),1)]),_:2},1024))),128))])):(w(),P("div",Vie,[y(s,null,{default:x(()=>[...e[12]||(e[12]=[z("--",-1)])]),_:1})]))])],64)):t.business=="update_record"?(w(),P(ae,{key:7},[d("div",null,[e[15]||(e[15]=d("span",{class:"label"},"更新ID：",-1)),i.actionState.record_id?(w(),Z(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Z(s,{key:1},{default:x(()=>[...e[14]||(e[14]=[z("--",-1)])]),_:1}))]),d("div",null,[e[18]||(e[18]=d("span",{class:"label"},"更新数据：",-1)),Array.isArray(i.actionState.fields)?(w(),P("div",Hie,[(w(!0),P(ae,null,ye(i.actionState.fields,c=>(w(),Z(s,{class:"field-tag",key:c.field_name},{default:x(()=>[d("span",null,j(c.field_name),1),e[16]||(e[16]=d("span",{class:"arrow-icon"},[d("img",{src:La})],-1)),c.value?(w(),P("span",Uie,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),P("span",zie))]),_:2},1024))),128))])):(w(),P("div",qie,[y(s,null,{default:x(()=>[...e[17]||(e[17]=[z("--",-1)])]),_:1})]))])],64)):t.business=="update_advanced"?(w(),P(ae,{key:8},[d("div",null,[e[20]||(e[20]=d("span",{class:"label"},"多维表名称：",-1)),i.actionState.name?(w(),Z(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:i.actionState.name},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Z(s,{key:1},{default:x(()=>[...e[19]||(e[19]=[z("--",-1)])]),_:1}))]),d("div",null,[e[21]||(e[21]=d("span",{class:"label"},"高级权限：",-1)),y(s,null,{default:x(()=>[z(j(i.actionState.is_advanced==0?"不设置":i.actionState.is_advanced==1?"开启":"关闭"),1)]),_:1})])],64)):t.business=="table_add_members"?(w(),P(ae,{key:9},[d("div",null,[e[22]||(e[22]=d("span",{class:"label"},"多维表：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.app_token)||[],defaultValue:((p=i.actionState)==null?void 0:p.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})]),d("div",null,[e[24]||(e[24]=d("span",{class:"label"},"协作者角色：",-1)),i.actionState.role_id?(w(),Z(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.role_id)||[],defaultValue:i.actionState.role_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Z(s,{key:1},{default:x(()=>[...e[23]||(e[23]=[z("--",-1)])]),_:1}))]),d("div",null,[e[26]||(e[26]=d("span",{class:"label"},"协作者ID：",-1)),i.actionState.member_id?(w(),Z(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.member_id)||[],defaultValue:i.actionState.member_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Z(s,{key:1},{default:x(()=>[...e[25]||(e[25]=[z("--",-1)])]),_:1}))])],64)):t.business=="roles_list"?(w(),P("div",Gie,[e[27]||(e[27]=d("span",{class:"label"},"多维表：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.app_token)||[],defaultValue:((p=i.actionState)==null?void 0:p.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):i.BatchActions.includes(t.business)?(w(!0),P(ae,{key:11},ye(i.batchActionParam,(c,f)=>(w(),P("div",{key:f},[d("span",Xie,j(c.name)+"：",1),i.actionState[f]?(w(),P("div",Wie,[y(s,null,{default:x(()=>{var p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=i.actionState)==null?void 0:p.tag_map[f])||[],defaultValue:i.actionState[f].toString()},null,8,["options","defaultSelectedList","defaultValue"])]}),_:2},1024)])):(w(),P("div",Yie,[y(s,null,{default:x(()=>[...e[28]||(e[28]=[z("--",-1)])]),_:1})]))]))),128)):ie("",!0)])}const Jie=$e(Cie,[["render",Kie],["__scopeId","data-v-7d895e9a"]]),Zie={name:"feishu-table-render",components:{AtText:yn,QuestionCircleOutlined:yt},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{operatorMap:Rg(),actionState:{}}},mounted(){this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{dataFormat(){var i,r;let n=((r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)||{},e=(n==null?void 0:n.arguments)||{},{config_name:t,table_name:o}=n||{};this.actionState={...n,...e,config_name:t,table_name:o},this.actionState},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},Qie={class:"_main"},ere={class:"label"},tre={class:"hint"},nre={key:0},ore={key:1},ire={key:0,class:"field-box"},rre={key:0},sre={key:1},are={key:1};function lre(n,e,t,o,i,r){var u,c;const s=mi,a=Nt("QuestionCircleOutlined"),l=Nt("at-text");return w(),P("div",Qie,[d("div",null,[e[0]||(e[0]=d("span",{class:"label"},"公众号：",-1)),y(s,null,{default:x(()=>{var f;return[z(j(((f=i.actionState)==null?void 0:f.app_name)||"--"),1)]}),_:1})]),d("div",null,[d("span",ere,[e[2]||(e[2]=z("接收人 ",-1)),d("span",tre,[y(a),e[1]||(e[1]=d("span",{class:"hint-pop"},"接收人openid",-1))]),e[3]||(e[3]=z("： ",-1))]),(u=i.actionState)!=null&&u.touser?(w(),P("span",nre,[y(l,{options:t.valueOptions,defaultSelectedList:[],defaultValue:(((c=i.actionState)==null?void 0:c.touser)||"").toString()},null,8,["options","defaultValue"])])):(w(),P("span",ore,[y(s,null,{default:x(()=>[...e[4]||(e[4]=[z("--",-1)])]),_:1})]))]),d("div",null,[e[5]||(e[5]=d("span",{class:"label"},"消息类型：",-1)),y(s,null,{default:x(()=>{var f;return[z(j(((f=i.actionState)==null?void 0:f.msg_type_name)||"--"),1)]}),_:1})]),d("div",null,[e[8]||(e[8]=d("span",{class:"label"},"回复内容：",-1)),Array.isArray(i.actionState.fields)?(w(),P("div",ire,[(w(!0),P(ae,null,ye(i.actionState.fields,f=>(w(),Z(s,{class:"field-tag",key:f.field_name},{default:x(()=>[d("span",null,j(r.getFieldLabel(f)),1),e[6]||(e[6]=d("span",{class:"arrow-icon"},[d("img",{src:La})],-1)),r.getFieldValue(f)?(w(),P("span",rre,[y(l,{options:t.valueOptions,defaultSelectedList:r.getFieldTags(f),defaultValue:r.getFieldValue(f).toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),P("span",sre))]),_:2},1024))),128))])):(w(),P("div",are,[y(s,null,{default:x(()=>[...e[7]||(e[7]=[z("--",-1)])]),_:1})]))])])}const ure=$e(Zie,[["render",lre],["__scopeId","data-v-408b23fd"]]),dre={name:"feishu-table-render",inject:["getGraph","setData"],components:{AtText:yn},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{atTextRef:null,actionState:{}}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.dataFormat()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{onUpatateNodeName(n){var o;if(!yo.includes(n.node_type))return;const e=i=>{!Array.isArray(i)||i.length===0||i.forEach(r=>{if(r&&r.node_id==n.node_id){if(r.label){let s=r.label.split("/");s[0]=n.node_name,r.label=s.join("/")}r.node_name=n.node_name}})};(((o=this.actionState)==null?void 0:o.rendering)||[]).forEach(i=>{e(i==null?void 0:i.tags)}),this.$nextTick(()=>{const i=this.$refs.atTextRef;(Array.isArray(i)?i:i?[i]:[]).forEach(s=>{s&&s.refresh&&s.refresh()}),this.update(),this.dataFormat(),this.$emit("updateSize")})},update(){this.setData({node_params:JSON.stringify(this.nodeParams)})},dataFormat(){var o,i,r;let n=((i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)||{},e=(n==null?void 0:n.arguments)||{},t=(n==null?void 0:n.rendering)||{};if(Array.isArray(n==null?void 0:n.rendering)){const s=((r=n==null?void 0:n.arguments)==null?void 0:r.tag_map)||(n==null?void 0:n.tag_map)||{};n.rendering.forEach(a=>{if(a&&(!Array.isArray(a.tags)||a.tags.length===0)){const l=a.key,u=l&&s?s[l]:null;Array.isArray(u)&&u.length&&(a.tags=u)}})}this.actionState={...n,...e,...t}},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},cre={class:"_main"},fre={key:0},pre={class:"label"};function hre(n,e,t,o,i,r){var l,u;const s=mi,a=Nt("at-text");return w(),P("div",cre,[(l=i.actionState)!=null&&l.use_plugin_config?(w(),P("div",fre,[e[0]||(e[0]=d("span",{class:"label"},"配置：",-1)),y(s,null,{default:x(()=>{var c;return[z(j(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})])):ie("",!0),(w(!0),P(ae,null,ye(((u=i.actionState)==null?void 0:u.rendering)||[],(c,f)=>(w(),P("div",{key:c.key||f},[d("span",pre,j(c.label)+"：",1),c.value?(w(),Z(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:c.tags,defaultValue:c.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Z(s,{key:1},{default:x(()=>[...e[1]||(e[1]=[z("--",-1)])]),_:1}))]))),128))])}const vre=$e(dre,[["render",hre],["__scopeId","data-v-1bfd27cc"]]),gre={name:"QuestionNode",components:{AtText:yn,FeishuTableRender:Jie,OfficialSendMessageRender:ure,DynamicRender:vre,NodeCommon:on},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{},isMultiNode:!1,pluginData:{},valueOptions:[]}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},computed:{pluginName(){var n,e;return((e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.name)||null},business(){var n,e,t;return((t=(e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.params)==null?void 0:t.business)||null},isFeishuTbPlugin(){return this.pluginName==="feishu_bitable"},isOfficialSendMessagePlugin(){return this.pluginName==="official_send_message"}},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{onUpatateNodeName(n){var o,i,r,s,a,l;if(!yo.includes(n.node_type))return;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=u=>{!Array.isArray(u)||u.length===0||u.forEach(c=>{if(c&&c.node_id==n.node_id){if(c.label){let f=c.label.split("/");f[0]=n.node_name,c.label=f.join("/")}c.node_name=n.node_name}})};this.formState&&typeof this.formState=="object"&&Object.keys(this.formState).forEach(u=>{var c;e((c=this.formState[u])==null?void 0:c.tags)});const t=[];(i=(o=this.nodeParams)==null?void 0:o.plugin)!=null&&i.tag_map&&t.push(this.nodeParams.plugin.tag_map),(l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)!=null&&l.tag_map&&t.push(this.nodeParams.plugin.params.arguments.tag_map),t.forEach(u=>{!u||typeof u!="object"||Object.keys(u).forEach(c=>{e(u[c])})}),this.$nextTick(()=>{const u=this.$refs.atTextRef;(Array.isArray(u)?u:u?[u]:[]).forEach(f=>{f&&f.refresh&&f.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.updateSize()})},async init(){this.valueOptions=this.getNode().getAllParentVariable(),this.nodeParamsFormat(),await this.loadPluginInfo(),await this.loadPluginParams(),this.updateSize()},loadPluginInfo(){return Eg({name:this.pluginName}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.info=e.remote,this.isMultiNode=((t=e==null?void 0:e.local)==null?void 0:t.multiNode)||!1})},loadPluginParams(){return Po({name:this.pluginName,action:"default/get-schema",params:{}}).then(n=>{this.pluginData=(n==null?void 0:n.data)||{},this.formStateFormat(),this.update(this.pluginData)})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){if(this.isFeishuTbPlugin||this.isOfficialSendMessagePlugin)return;let n=JSON.parse(JSON.stringify(this.pluginData));const e={official_account_profile:this.officialAccountHandle,official_batch_tag:this.officialTagHandle,official_send_template_message:this.officialTemplateHandle,official_article:this.officialArticleHandle,official_draft:this.officialDraftHandle};e[this.pluginName]?e[this.pluginName](n):this.defaultHandle(n),this.updateSize()},update(n){var a,l,u;typeof n=="string"&&(n=JSON.parse(n));const e=JSON.parse(this.properties.node_params),t=this.business&&(n!=null&&n[this.business])?n[this.business]:n,o=ma(this.pluginName)||this.isMultiNode,i=o?((l=(a=e==null?void 0:e.plugin)==null?void 0:a.params)==null?void 0:l.arguments)||{}:((u=e==null?void 0:e.plugin)==null?void 0:u.params)||{},r={...i};for(const c in this.formState||{}){const f=this.formState[c]||{},p=(f==null?void 0:f.enum_component)||(f==null?void 0:f.radio_component),h=f==null?void 0:f.enum_default;p&&(r[c]==null||String(r[c]).trim()==="")&&h!=null&&h!==""&&(r[c]=h);const v=f==null?void 0:f.setting_cache_component;if(v===!0||v===1||v==="true"||v==="1"){const m=String((f==null?void 0:f.value)??"");if(m!=="")r[c]=m;else{const g=localStorage.getItem(this.getCacheKey(c));g!=null&&(r[c]=String(g))}}}e.plugin=e.plugin||{},e.plugin.params=e.plugin.params||{},e.plugin.params.use_plugin_config=(t==null?void 0:t.use_plugin_config)||!1,o?e.plugin.params.arguments={...i,...r,tag_map:i.tag_map||{}}:e.plugin.params={...e.plugin.params,...r},e.plugin.output_obj=yi((t==null?void 0:t.output)||{});const s=JSON.stringify(e);this.properties.node_params!==s&&this.setData({...this.properties,node_params:s})},defaultHandle(n){var o,i,r,s,a,l,u,c,f,p,h,v,_;let e,t;ma(this.pluginName)||this.isMultiNode?(this.formState=((o=n==null?void 0:n[this.business])==null?void 0:o.params)||{},e=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},t=((c=(u=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)==null?void 0:c.tag_map)||{}):(e=((p=(f=this.nodeParams)==null?void 0:f.plugin)==null?void 0:p.params)||{},t=((v=(h=this.nodeParams)==null?void 0:h.plugin)==null?void 0:v.tag_map)||{},this.formState=n);for(let m in this.formState){this.formState[m].value=String(e[m]||""),this.formState[m].tags=t[m]||[];const g=(_=this.formState[m])==null?void 0:_.setting_cache_component;if((g===!0||g===1||g==="true"||g==="1")&&!String(this.formState[m].value||"").trim()){const D=localStorage.getItem(this.getCacheKey(m));D!=null&&(this.formState[m].value=String(D))}}this.isMultiNode&&this.ensureMultiNodeRendering()},getCacheKey(n){let e="",t="";const o=typeof window<"u"?String(window.location.hash||""):"";return o.includes("?")&&(o.split("?")[1]||"").split("&").forEach(s=>{const[a,l]=s.split("=");a==="id"&&(e=decodeURIComponent(l||"")),a==="robot_key"&&(t=decodeURIComponent(l||""))}),e||(e=String(localStorage.getItem("last_local_robot_id")||"")),`${e||t||""}:${this.pluginName}:${n}`},ensureMultiNodeRendering(){var r,s,a,l,u,c,f,p,h,v,_,m,g,b,C,D;const n=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.rendering;if(Array.isArray(n)&&n.length){const T=((f=(c=(u=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:u.params)==null?void 0:c.arguments)==null?void 0:f.tag_map)||((h=(p=this.nodeParams)==null?void 0:p.plugin)==null?void 0:h.tag_map)||{};let O=!1;const k=n.map(S=>{var B,E;const N=S==null?void 0:S.key;if((Array.isArray(S==null?void 0:S.tags)?S.tags:[]).length)return S;const $=Array.isArray(T==null?void 0:T[N])?T[N]:Array.isArray((E=(B=this.formState)==null?void 0:B[N])==null?void 0:E.tags)?this.formState[N].tags:[];return $.length?(O=!0,{...S,tags:$}):S});if(O){const S=JSON.parse(this.properties.node_params);S.plugin=S.plugin||{},S.plugin.params=S.plugin.params||{},S.plugin.params.rendering=k,(_=(v=this.nodeParams)==null?void 0:v.plugin)!=null&&_.params&&(this.nodeParams.plugin.params.rendering=k),this.setData({...this.properties,node_params:JSON.stringify(S)})}return}const e=Object.keys(this.formState||{}).filter(T=>T!=="app_secret").filter(T=>{var O,k;return!((k=(O=this.formState)==null?void 0:O[T])!=null&&k.hide_official_component)}).filter(T=>{var O,k;return!((k=(O=this.formState)==null?void 0:O[T])!=null&&k.advanced_settings)}).filter(T=>{var S,N;const O=(N=(S=this.formState)==null?void 0:S[T])==null?void 0:N.plugin_config_component;return!(O===!0||O===1||O==="true"||O==="1")}).filter(T=>{var S,N;const O=(N=(S=this.formState)==null?void 0:S[T])==null?void 0:N.setting_cache_component;return!(O===!0||O===1||O==="true"||O==="1")}).sort((T,O)=>{var k,S,N,L;return+(((S=(k=this.formState)==null?void 0:k[T])==null?void 0:S.sort_num)||0)-+(((L=(N=this.formState)==null?void 0:N[O])==null?void 0:L.sort_num)||0)}),t=((b=(g=(m=this.nodeParams)==null?void 0:m.plugin)==null?void 0:g.params)==null?void 0:b.arguments)||{},o=e.map(T=>{var L,$,B;const O=((L=this.formState)==null?void 0:L[T])||{};let k=(O==null?void 0:O.name)||T,S=String((O==null?void 0:O.value)??"");const N=Array.isArray(O==null?void 0:O.tags)?O.tags:[];if(T==="app_id"&&(k="公众号名称",S=String(t.app_name??((B=($=this.formState)==null?void 0:$.app_name)==null?void 0:B.value)??"")),O!=null&&O.enum_component||O!=null&&O.radio_component){const E=((O==null?void 0:O.enum)||[]).find(A=>String(A==null?void 0:A.value)===S)||((O==null?void 0:O.enum)||[]).find(A=>String(A==null?void 0:A.value)===(O==null?void 0:O.enum_default));E&&E.name&&(S=String(E.name))}return{label:k,value:S,tags:N,key:T}});if(!o.length)return;const i=JSON.parse(this.properties.node_params);i.plugin=i.plugin||{},i.plugin.params=i.plugin.params||{},i.plugin.params.rendering=o,(D=(C=this.nodeParams)==null?void 0:C.plugin)!=null&&D.params&&(this.nodeParams.plugin.params.rendering=o),this.setData({...this.properties,node_params:JSON.stringify(i)})},officialAccountHandle(n){var e,t,o,i,r,s,a,l,u,c,f;if((e=n==null?void 0:n[this.business])==null||delete e.params.app_id,(t=n==null?void 0:n[this.business])==null||delete t.params.app_secret,(o=n==null?void 0:n[this.business])!=null&&o.params)if(this.business==="getTagFans"){let p=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},h=((c=(u=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)==null?void 0:c.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:p.app_name,tags:[]}},p.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:p.tag_name,tags:[]}:(f=h==null?void 0:h.tagid)!=null&&f.length?this.formState.tagid={type:"string",name:"标签名称",value:p.tagid,tags:h.tagid||[]}:this.formState.tagid={type:"string",name:"标签ID",value:p.tagid,tags:[]},this.formState.next_openid={type:"string",name:"上批尾用户openid",value:p.next_openid,tags:h.next_openid||[]},this.updateSize();return}else n[this.business].params={app_name:{type:"string",name:"公众号名称"},...n[this.business].params};this.defaultHandle(n)},officialTemplateHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};switch(this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},template_name:{type:"string",name:"模板名称",value:n.template_name,tags:[]},touser:{type:"string",name:"接收者",value:n.touser,tags:e.touser||[]}},n.link_type){case 0:this.formState.link_type={type:"string",name:"模板跳转",value:"不跳转",tags:[]};break;case 1:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转链接",tags:[]},this.formState.url={type:"string",name:"跳转链接",value:n.url,tags:e.url||[]};break;case 2:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转小程序",tags:[]},this.formState.miniprogram_app={type:"string",name:"小程序APPID",...n.miniprogram.appid},this.formState.miniprogram_path={type:"string",name:"小程序路径",...n.miniprogram.pagepath};break}this.updateSize()},officialTagHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},openid_list:{type:"string",name:"粉丝openid列表",value:n.openid_list,tags:[]}},n.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:n.tag_name,tags:[]}:this.formState.tagid={type:"string",name:"标签名称",value:n.tagid,tags:e.tagid||[]},this.updateSize()},officialArticleHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={url:{type:"string",name:"",value:n.url,tags:e.url||[]},number:{type:"string",name:"",value:n.number,tags:e.number||[]}},this.updateSize()},officialDraftHandle(){var o,i,r,s,a,l,u;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},e=((u=(l=(a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)==null?void 0:l.arguments)==null?void 0:u.tag_map)||{},t=n.article_type?n.article_type=="news"?"图文消息":"图片消息":"--";switch(this.business){case"add_draft":this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},article_type:{type:"string",name:"文章类型",value:t,tags:[]}};break;case"update_draft":case"publish_draft":case"delete_draft":case"preview_message":case"get_draft":default:this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},media_id:{type:"string",name:"文章ID",value:n.media_id,tags:e.media_id||[]}},this.business==="preview_message"&&(this.formState.account={type:"string",name:"接收用户",value:n.account,tags:e.account||[]});break}this.updateSize()},updateSize(){this.$nextTick(()=>{this.resetSize()})}}},_re={key:0,class:"ding-group-node"},mre={key:1,class:"ding-group-node"},yre={class:"label"};function bre(n,e,t,o,i,r){const s=Nt("DynamicRender"),a=Nt("FeishuTableRender"),l=Nt("OfficialSendMessageRender"),u=Nt("at-text"),c=mi,f=Nt("node-common");return w(),Z(f,{properties:t.properties,title:t.properties.node_name,iconUrl:i.info.icon,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"157px"}},{default:x(()=>[i.isMultiNode?(w(),P("div",_re,[y(s,{nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])])):(w(),P("div",mre,[r.isFeishuTbPlugin?(w(),Z(a,{key:0,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):ie("",!0),r.isOfficialSendMessagePlugin?(w(),Z(l,{key:1,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):(w(!0),P(ae,{key:2},ye(i.formState,(p,h)=>(w(),P("div",{key:h},[d("span",yre,j(p.name||h)+"：",1),p.value?(w(),Z(c,{key:0},{default:x(()=>[y(u,{options:i.valueOptions,defaultSelectedList:p.tags,defaultValue:p.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Z(c,{key:1},{default:x(()=>[...e[0]||(e[0]=[z("--",-1)])]),_:1}))]))),128))]))]),_:1},8,["properties","title","iconUrl","isSelected","isHovered","node-key"])}const xre=$e(gre,[["render",bre],["__scopeId","data-v-7fb8cdf7"]]);let wre=class extends tn{constructor(e){super(e),this.renderVue(xre,e)}},Cre=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Sre={type:"zm-plugins-node",model:Cre,view:wre},kre="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cg%20clip-path='url(%23cmdkkm1o9__clip0_12048_97931)'%20stroke='%23fff'%20stroke-width='1.16667'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M6.79163%2013.2109H5.04163V14.9609'/%3e%3cpath%20d='M14.9584%2014.9609H13.2084V13.2109'/%3e%3cpath%20d='M13.2084%206.78906H14.9584V5.03906'/%3e%3cpath%20d='M5.04163%205.03906H6.79163V6.78906'/%3e%3cpath%20d='M6.79163%205.125C5.21015%206.16842%204.16663%207.96112%204.16663%209.99757C4.16663%2010.295%204.18888%2010.5871%204.23181%2010.8726'/%3e%3cpath%20d='M10.875%2015.7708C10.5896%2015.8137%2010.2974%2015.8359%2010%2015.8359C7.96357%2015.8359%206.17086%2014.7924%205.12744%2013.2109'/%3e%3cpath%20d='M15.7682%209.125C15.8111%209.41043%2015.8334%209.70262%2015.8334%2010C15.8334%2012.0364%2014.7898%2013.8291%2013.2084%2014.8726'/%3e%3cpath%20d='M9.125%204.22925C9.41043%204.18632%209.70262%204.16406%2010%204.16406C12.0364%204.16406%2013.8291%205.20758%2014.8726%206.78906'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='cmdkkm1o9__clip0_12048_97931'%3e%3cpath%20fill='%23fff'%20transform='translate(3%203)'%20d='M0%200H14V14H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Ere={class:"preview-img-box"},Dre={class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},Are={class:"custom-slick-arrow",style:{right:"10px"}},Ore=["onClick","src"],Nre={style:{display:"none"}},Mre={__name:"index",props:{currentImageList:{type:Array,default:()=>[]}},setup(n){const e=n,t=X(!1),o=X(0),i=r=>{o.value=r,t.value=!0};return(r,s)=>{const a=Ly,l=Iy,u=Fy;return w(),P("div",Ere,[y(a,{arrows:"",dots:!1},{prevArrow:x(()=>[d("div",Dre,[y(ee(By))])]),nextArrow:x(()=>[d("div",Are,[y(ee(Bu))])]),default:x(()=>[(w(!0),P(ae,null,ye(e.currentImageList,(c,f)=>(w(),P("div",{class:"img-list-item",key:c},[d("img",{onClick:p=>i(f),src:c,alt:""},null,8,Ore)]))),128))]),_:1}),d("div",Nre,[y(u,{preview:{visible:t.value,current:o.value,onVisibleChange:c=>t.value=c}},{default:x(()=>[(w(!0),P(ae,null,ye(e.currentImageList,c=>(w(),Z(l,{key:c,src:c},null,8,["src"]))),128))]),_:1},8,["preview"])])])}}},Rm=$e(Mre,[["__scopeId","data-v-69cc841a"]]),Tre={class:"modal-title-block"},$re={key:0,class:"run-detail"},Pre={class:"flex-content-box"},Rre={class:"test-model-box"},Bre={key:2,class:"input-list-box"},Lre={class:"add-btn-box"},Ire={key:0,class:"result-list-box loading-box"},Fre={key:1,class:"result-list-box"},jre=["onClick"],Vre={class:"status-block"},Hre={class:"icon-name-box"},Ure=["src"],zre={class:"node-name"},qre={key:0,class:"time-tag"},Gre={class:"right-active-icon"},Xre={class:"save-btn-box"},Wre={class:"preview-box"},Yre={class:"preview-title"},Kre={class:"icon-name-box"},Jre=["src"],Zre={class:"node-name"},Qre={key:0,class:"time-tag"},ese={key:0,class:"preview-content-block"},tse={class:"preview-img-box"},nse={class:"preview-content-block"},ose={class:"title-block"},ise={class:"preview-code-box"},rse={__name:"run-test",props:{loop_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo.isLockedByOther),r=n;Xe(()=>[]);const s=X(!1),a=X(""),l=X([]),u=Xe(()=>a.value?l.value.filter(A=>A.node_key==a.value)[0]:null),c=Xe(()=>{let A=[];if(u.value&&u.value.node_type==33){let M=u.value.output;for(let F in M)F.includes("picture_url_")&&A.push(M[F])}return A}),f=X(!1),p=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),h=async()=>{if(i.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Pt();let A=localStorage.getItem("workflow_loop_run_test_data")||"{}";A=JSON.parse(A),p.question=A.question||"",p.openid=A.openid||"",p.global=A.global||"",l.value=[],a.value="",setTimeout(()=>{g()},1e3),s.value=!0},v=X([]),_=X(!1),m=X(!1),g=()=>{ly({robot_key:p.robot_key,loop_node_key:r.loop_node_key}).then(A=>{_.value=A.data.is_need_question,m.value=A.data.is_need_openid,_.value||(p.question=""),v.value=A.data.loop_test_params.map(M=>({...M,field:{...M.field,Vals:b(M.field)}}))})};function b(A){return A.typ=="string"||A.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const C=(A,M)=>{A.splice(M,1)},D=A=>{A.push({value:"",key:Math.random()*1e4})},T=X(null),O=X(0),k=X(0),S=()=>{T.value.validate().then(()=>{let A={...p,loop_node_key:r.loop_node_key},M=JSON.parse(JSON.stringify(v.value));M.forEach(F=>{F.field.typ.includes("array")&&(F.field.Vals=F.field.Vals.map(H=>H.value))}),A.loop_test_params=JSON.stringify(M),f.value=!0,l.value=[],localStorage.setItem("workflow_loop_run_test_data",JSON.stringify({...A})),ay({...A}).then(F=>{xt.success("测试结果生成完成");let H=F.data.node_logs||[];O.value=F.data.use_token,k.value=F.data.use_mills,N(H)}).catch(F=>{l.value=[];let H=F.data.node_logs||[];H&&H.length&&N(H)}).finally(()=>{f.value=!1})})},N=A=>{var M;l.value=A.map(F=>({...F,is_success:F.error_msg==="<nil>",node_icon:Lu(F.node_type)})),a.value=(M=l.value[0])==null?void 0:M.node_key},L=A=>{a.value=A.node_key},$=()=>{As(JSON.stringify(u.value.output)),xt.success("复制成功")};function B(A){return A.field.key.replace(A.node_key+".","")}return e({open:()=>{h()}}),(A,M)=>{const F=mi,H=ti,R=ln,G=kn,oe=$n,V=Vn,Y=Jt,Q=wn,ue=mo,te=gn;return w(),P("div",null,[y(te,{open:s.value,"onUpdate:open":M[2]||(M[2]=q=>s.value=q),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",Tre,[M[3]||(M[3]=z("运行测试 ",-1)),l.value.length?(w(),P("div",$re,[d("span",null,"总耗时："+j(ee(ef)(k.value)),1),d("span",null,"token消耗："+j(O.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",Pre,[d("div",Rre,[M[10]||(M[10]=d("div",{class:"top-title"},"开始节点参数",-1)),y(Q,{model:p,ref_key:"formRef",ref:T,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[_.value?(w(),Z(G,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[y(H,{gap:4},{default:x(()=>[M[5]||(M[5]=z("question ",-1)),y(F,{style:{margin:"0"}},{default:x(()=>[...M[4]||(M[4]=[z("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(R,{placeholder:"请输入",value:p.question,"onUpdate:value":M[0]||(M[0]=q=>p.question=q)},null,8,["value"])]),_:1})):ie("",!0),m.value?(w(),Z(G,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[y(H,{gap:4},{default:x(()=>[M[7]||(M[7]=z("openid ",-1)),y(F,{style:{margin:"0"}},{default:x(()=>[...M[6]||(M[6]=[z("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(R,{placeholder:"请输入",value:p.openid,"onUpdate:value":M[1]||(M[1]=q=>p.openid=q)},null,8,["value"])]),_:1})):ie("",!0),(w(!0),P(ae,null,ye(v.value,q=>(w(),Z(G,{key:q.node_key,rules:[{required:q.field.required,message:`请输入${q.node_name}`}]},{label:x(()=>[y(H,{gap:4},{default:x(()=>[z(j(q.node_name)+" "+j(B(q)),1),y(F,{style:{margin:"0"}},{default:x(()=>[z(j(q.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[q.field.typ=="string"?(w(),Z(R,{key:0,placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ie("",!0),q.field.typ=="number"?(w(),Z(oe,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ie("",!0),q.field.typ.includes("array")?(w(),P("div",Bre,[(w(!0),P(ae,null,ye(q.field.Vals,(re,ce)=>(w(),P("div",{class:"input-list-item",key:ce},[y(V,null,{default:x(()=>[y(R,{placeholder:"请输入",value:re.value,"onUpdate:value":ve=>re.value=ve},null,8,["value","onUpdate:value"])]),_:2},1024),q.field.Vals.length>1?(w(),Z(ee(Kt),{key:0,onClick:ve=>C(q.field.Vals,ce)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",Lre,[y(Y,{onClick:re=>D(q.field.Vals),block:"",type:"dashed"},{default:x(()=>[...M[8]||(M[8]=[z("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),f.value?(w(),P("div",Ire,[f.value?(w(),Z(ue,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),l.value.length>0?(w(),P("div",Fre,[(w(!0),P(ae,null,ye(l.value,(q,re)=>(w(),P("div",{class:Ct(["list-item-block",{active:a.value==q.node_key}]),onClick:ce=>L(q),key:re},[d("div",Vre,[q.is_success?(w(),Z(ee(Ru),{key:0,style:{color:"#138b1b"}})):(w(),Z(ee(Pu),{key:1,style:{color:"#d81e06"}}))]),d("div",Hre,[d("img",{src:q.node_icon,alt:""},null,8,Ure),d("div",zre,j(q.node_name),1)]),q.is_success?(w(),P("div",qre,j(q.use_time)+"ms",1)):ie("",!0),d("div",Gre,[y(ee(Bu))])],10,jre))),128))])):ie("",!0),d("div",Xre,[y(Y,{loading:f.value,onClick:S,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(ee(Qo)),M[9]||(M[9]=z("运行测试",-1))]),_:1},8,["loading"])])]),d("div",Wre,[u.value?(w(),P(ae,{key:0},[d("div",Yre,[M[11]||(M[11]=d("div",{class:"title-text"},"日志详情",-1)),d("div",Kre,[d("img",{src:u.value.node_icon,alt:""},null,8,Jre),d("div",Zre,j(u.value.node_name),1)]),u.value.is_success?(w(),P("div",Qre,j(u.value.use_time)+"ms",1)):ie("",!0)]),c.value.length>0?(w(),P("div",ese,[M[12]||(M[12]=d("div",{class:"title-block"},"生成图像日志",-1)),d("div",tse,[y(Rm,{currentImageList:c.value},null,8,["currentImageList"])])])):ie("",!0),d("div",nse,[d("div",ose,[M[13]||(M[13]=z("运行日志",-1)),y(ee(rs),{onClick:$})]),d("div",ise,[y(ee(us),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},sse=$e(rse,[["__scopeId","data-v-a55516c0"]]),ase={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),P(ae,null,[d("div",{class:Ct(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},lse=$e(ase,[["__scopeId","data-v-8d9d5c66"]]),use={class:"custom-group-content"},dse={class:"top-block"},cse={class:"title-block"},fse={class:"title-text"},pse={class:"btn-block"},hse={class:"info-block"},vse={class:"info-item"},gse={class:"info-content"},_se={key:0,class:"label-text"},mse={key:1,class:"label-text"},yse={key:2,class:"label-value"},bse={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getGraph"),o=He("getNode"),i=He("addNode"),r=He("setData"),s=He("resetSize"),a=X(["custom-group","batch-group","end-node"]),l=X(!1),u=Xe(()=>o().id),c=b=>{i(b),l.value=!1},f=()=>{l.value=!0},p=X(null),h=()=>{p.value.open()},v=Je({loop_type:"array",loop_number:"",loop_arrays:[{key:"",typ:"array",value:"",cu_key:Math.random()*1e4}],intermediate_params:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}],output:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}]}),_=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(b).loop||{}}catch{C={}}C=JSON.parse(JSON.stringify(C)),v.loop_type=C.loop_type,v.loop_number=C.loop_number,v.loop_arrays=C.loop_arrays,v.intermediate_params=C.intermediate_params,v.output=C.output,Pt(()=>{s()})},m=()=>{const b=JSON.stringify({loop:{...v}});r({...e.node,...v,node_params:b})};gt(()=>e.properties,()=>{_()},{deep:!0});const g=()=>{let b=o();t().deleteNode(b.id)};return ut(()=>{_(),s(),m()}),(b,C)=>{const D=Qt,T=ja,O=Pr,k=$r,S=Rr;return w(),P("div",use,[y(lse,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),d("div",{class:"header-box",style:In({background:n.properties.node_header_bg_color})},[d("div",dse,[d("div",cse,[C[2]||(C[2]=d("img",{src:kre,alt:""},null,-1)),d("div",fse,j(e.properties.node_name),1)]),d("div",pse,[y(T,{title:null,trigger:"click",open:l.value,"onUpdate:open":C[0]||(C[0]=N=>l.value=N),arrow:!1,placement:"right"},{content:x(()=>[y(Iu,{style:{height:"550px"},excludedNodeTypes:a.value,onAddNode:c,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[y(D,{title:"新建内部节点"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(f,["stop"])},[y(ee(Fn))])]),_:1})]),_:1},8,["open"]),y(D,{title:"运行测试"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(h,["stop"])},[y(ee(Qo))])]),_:1}),y(S,{trigger:"click"},{overlay:x(()=>[y(k,null,{default:x(()=>[y(O,{onClick:g},{default:x(()=>[...C[4]||(C[4]=[d("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"btn-item",onClick:C[1]||(C[1]=St(()=>{},["stop"]))},[...C[3]||(C[3]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])])]),_:1})])]),d("div",hse,[d("div",vse,[C[5]||(C[5]=d("div",{class:"info-label"},"循环类型",-1)),d("div",gse,[v.loop_type=="array"?(w(),P("div",_se,"使用数组循环")):ie("",!0),v.loop_type=="number"?(w(),P("div",mse,"指定循环次数")):ie("",!0),v.loop_type=="number"?(w(),P("div",yse,j(v.loop_number),1)):ie("",!0)])])])],4),C[6]||(C[6]=d("div",{class:"node-body"},[d("div",{class:"node-content"})],-1)),y(sse,{ref_key:"runTestRef",ref:p,loop_node_key:u.value},null,8,["loop_node_key"])])}}},xse=$e(bse,[["__scopeId","data-v-d0ee3d32"]]);function Bm(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=Bm(f.children,f)),f})}let wse=class extends Ja.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=Ze("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(Ze("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Tt(xse,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=er({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Pt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:_,model:m}=this.props;l==="right"&&!r&&_.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:m})}},c,f,p)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}},Cse=class extends Ja.model{initNodeData(e){super.initNodeData(e),this.DEFAULT_TOP_Z_INDEX=Number.MAX_SAFE_INTEGER,this.DEFAULT_BOTTOM_Z_INDEX=1,this.topGroupZIndex=1,this.width=e.width||600,this.height=e.height||420,this.zIndex=1,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}setSelected(e){super.setSelected(e)}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(u=>u.type==="start-node");r&&(t.add(r.id),e.push(r));const s=u=>{for(let c=0;c<u.length;c++){let p=u[c].sourceNode;t.has(p.id)||(t.add(p.id),ls.includes(p.type)&&e.push(p),s(p.incoming.edges))}};s(o),i.filter(u=>u.properties.loop_parent_key==this.id).forEach(u=>{e.push(u)});let l=[];for(const u of e){if(!ls.includes(u.type))continue;let c=JSON.parse(u.properties.node_params),f={label:u.properties.node_name,value:u.id,node_id:u.id,node_type:u.properties.node_type,typ:"node",children:[],loop_parent_key:u.properties.loop_parent_key,group_node_key:this.id};if(u.type==="http-node"&&(f.children=c.curl.output),u.type==="code-run-node"&&(f.children=c.code_run.output),u.type==="parameter-extraction-node"&&(f.children=c.params_extractor.output),u.type==="start-node"&&(f.children=[...c.start.diy_global,...c.start.sys_global]),u.type==="custom-group"&&(f.children=c.loop.output),u.type==="import-library-node"&&(f.children=c.library_import.outputs),u.type==="json-node"&&(f.children=c.json_encode.output),u.type==="json-reverse-node"&&(f.children=c.json_decode.output),u.type==="select-data-node"&&(f.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),u.type==="knowledge-base-node"&&(f.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),u.type==="ai-dialogue-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),u.type==="specify-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="immediately-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="problem-optimization-node"&&(f.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),u.type==="mcp-node"&&(f.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),u.type==="image-generation-node"){let p=c.image_generation.image_num;if(p>0){let h=[];for(let v=0;v<+p;v++){let _=String.fromCharCode(97+v);h.push({key:`picture_url_${_}`,typ:"string",name:`picture_url_${_}`,label:`picture_url_${_}`})}f.children=h}}if(u.type==="zm-plugins-node"){let p=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=v=>{v.forEach(_=>{_.name=_.key||"",_.subs&&_.subs.length>0&&h(_.subs)})};h(p),f.children=p||[]}f.children.forEach(p=>{p.node_id=u.id,p.node_name=u.properties.node_name,p.node_type=u.properties.node_type}),f.children=Bm(f.children,null),l.push(f)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}};const Sse={type:"custom-group",view:wse,model:Cse},kse={name:"groupStartNode",components:{NodeCommon:on},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{}},computed:{},watch:{properties:{handler(){},deep:!0}},mounted(){},methods:{}};function Ese(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"200px"}},null,8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Dse=$e(kse,[["render",Ese],["__scopeId","data-v-e00a21c6"]]);let Ase=class extends tn{constructor(e){super(e),this.renderVue(Dse,e)}},Ose=class extends nn{setAttributes(){this.width=200,this.height=72;const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Nse={type:"group-start-node",model:Ose,view:Ase},Mse={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function Tse(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[d("div",{class:"end-node"},[d("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const $se=$e(Mse,[["render",Tse],["__scopeId","data-v-ff05e16e"]]);let Pse=class extends tn{constructor(e){super(e),this.renderVue($se,e)}},Rse=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const Bse={type:"terminate-node",model:Rse,view:Pse},Lse={class:"start-node"},Ise={key:0,class:"start-node-options"},Fse={class:"options-list"},jse={class:"options-item"},Vse={key:0,class:"option-label"},Hse={key:1,class:"option-label"},Use={key:2,class:"option-label"},zse={key:0},qse={key:1,class:"start-node-options"},Gse={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(s,a)=>{const l=s.node_params||"{}",u=a.node_params||"{}";l!=u&&r()},{deep:!0});let o={1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",0:"星期日"};const i=Je({type:"select_time",every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""}),r=()=>{if(!t.properties||!t.properties.node_params)return;let a=JSON.parse(t.properties.node_params).trigger.cron_config||{};Object.assign(i,a),Pt(()=>{e()})};return ut(()=>{r()}),(s,a)=>(w(),Z(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Lse,[i.type=="select_time"?(w(),P("div",Ise,[a[1]||(a[1]=d("div",{class:"options-title"},"执行时间",-1)),d("div",Fse,[d("div",jse,[i.every_type=="day"?(w(),P("div",Vse," 每天 "+j(i.hour_minute),1)):ie("",!0),i.every_type=="week"?(w(),P("div",Hse," 每周 "+j(ee(o)[i.week_number])+" "+j(i.hour_minute),1)):ie("",!0),i.every_type=="month"?(w(),P("div",Use,[a[0]||(a[0]=z(" 每月 ",-1)),i.month_day?(w(),P("span",zse,j(i.month_day)+"号",1)):ie("",!0),z(" "+j(i.hour_minute),1)])):ie("",!0)])])])):(w(),P("div",qse,[...a[2]||(a[2]=[d("div",{class:"options-title"},"执行时间",-1),d("div",{class:"options-list"},[d("div",{class:"options-item"},[d("div",{class:"option-label"},"Linux Crontab代码")])],-1)])]))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Xse=$e(Gse,[["__scopeId","data-v-9d83cfc0"]]);let Wse=class extends tn{constructor(e){super(e),this.renderVue(Xse,e)}},Yse=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Kse={type:"timing-trigger-node",model:Yse,view:Wse},Jse={class:"start-node"},Zse={class:"start-node-options"},Qse={class:"options-list"},eae={class:"options-item"},tae={class:"option-label"},nae={class:"start-node-options"},oae={class:"options-list"},iae={class:"option-label"},rae={key:0,class:"options-item"},sae={class:"start-node-options"},aae={class:"options-list"},lae={class:"option-label"},uae={class:"option-type"},dae={key:0,class:"options-item"},cae={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Ts(),t=He("resetSize"),o=n,i=Xe(()=>e.officialList);gt(()=>o.properties,(p,h)=>{const v=p.node_params||"{}",_=h.node_params||"{}";v!=_&&c()},{deep:!0});let r={message:"私信消息",subscribe_unsubscribe:"关注/取消关注事件",qrcode_scan:"扫描带参数二维码事件",menu_click:"自定义菜单事件"};const s=Je({msg_type:"",app_ids:[]}),a=Xe(()=>s.app_ids.map(p=>i.value.find(h=>h.app_id==p)).filter(Boolean)),l=X([]),u=Xe(()=>[...l.value]),c=()=>{if(!o.properties||!o.properties.node_params)return;let p=JSON.parse(o.properties.node_params);l.value=p.trigger.outputs||[];let h=p.trigger.trigger_official_config;s.msg_type=h.msg_type,s.app_ids=h.app_ids?h.app_ids.split(","):[],Pt(()=>{t()})},f=()=>{let p=i.value.find(h=>h.app_id=="sdwdw");a.value};return ut(()=>{c()}),(p,h)=>(w(),Z(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Jse,[d("div",Zse,[h[0]||(h[0]=d("div",{class:"options-title"},"触发事件",-1)),d("div",Qse,[d("div",eae,[d("div",tae,j(ee(r)[s.msg_type]),1)])])]),d("div",nae,[d("div",{class:"options-title",onClick:f},"公众号"),d("div",oae,[(w(!0),P(ae,null,ye(a.value.slice(0,1),v=>(w(),P("div",{class:"options-item",key:v.app_id},[d("div",iae,j(v.app_name),1)]))),128)),a.value.length>1?(w(),P("div",rae,[...h[1]||(h[1]=[d("div",{class:"option-label"},"...",-1)])])):ie("",!0)])]),d("div",sae,[h[3]||(h[3]=d("div",{class:"options-title"},"输出",-1)),d("div",aae,[(w(!0),P(ae,null,ye(u.value.slice(0,2),v=>(w(),P("div",{class:Ct(["options-item",{"is-required":v.required}]),key:v.key},[d("div",lae,j(v.key),1),d("div",uae,j(v.typ),1)],2))),128)),u.value.length>2?(w(),P("div",dae,[...h[2]||(h[2]=[d("div",{class:"option-label"},"...",-1)])])):ie("",!0)])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},fae=$e(cae,[["__scopeId","data-v-2b5d3c24"]]);let pae=class extends tn{constructor(e){super(e),this.renderVue(fae,e)}},hae=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const vae={type:"official-trigger-node",model:hae,view:pae},gae="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cpath%20d='M12.4647%206.7C12.573%206.69991%2012.6803%206.72119%2012.7804%206.76263C12.8805%206.80406%2012.9714%206.86484%2013.048%206.94148C13.1246%207.01811%2013.1853%207.1091%2013.2266%207.20923C13.268%207.30936%2013.2892%207.41667%2013.289%207.525V14.675C13.289%2014.8937%2013.2022%2015.1034%2013.0476%2015.2581C12.893%2015.4128%2012.6834%2015.4998%2012.4647%2015.5H5.32363C5.21533%2015.5001%205.10807%2015.4788%205.00801%2015.4374C4.90796%2015.3959%204.81706%2015.3351%204.74055%2015.2585C4.66403%2015.1818%204.6034%2015.0908%204.56212%2014.9907C4.52084%2014.8906%204.49973%2014.7833%204.5%2014.675V7.525C4.5%207.30643%204.58673%207.0968%204.74115%206.94212C4.89557%206.78744%205.10506%206.70036%205.32363%206.7H12.4654H12.4647ZM8.8945%208.7625C8.82228%208.76241%208.75075%208.77658%208.68402%208.80419C8.61729%208.83181%208.55667%208.87233%208.50563%208.92343C8.4546%208.97453%208.41415%209.0352%208.38662%209.10197C8.35909%209.16873%208.34501%209.24028%208.34519%209.3125V10.55H7.10906C7.00013%2010.5497%206.89358%2010.5818%206.80294%2010.6423C6.71231%2010.7027%206.64168%2010.7887%206.60005%2010.8894C6.55841%2010.99%206.54765%2011.1008%206.56912%2011.2076C6.59059%2011.3144%206.64332%2011.4124%206.72063%2011.4891C6.82375%2011.5922%206.96331%2011.65%207.10906%2011.65H8.34519V12.8875C8.34537%2012.9961%208.37768%2013.1021%208.43804%2013.1924C8.4984%2013.2826%208.58412%2013.3529%208.68439%2013.3946C8.78466%2013.4362%208.895%2013.4472%209.00151%2013.4262C9.10803%2013.4052%209.20595%2013.3532%209.28294%2013.2766C9.334%2013.2255%209.37449%2013.1648%209.40209%2013.0981C9.42969%2013.0313%209.44387%2012.9597%209.44381%2012.8875V11.65H10.6799C10.7887%2011.6501%2010.8951%2011.618%2010.9856%2011.5576C11.0761%2011.4972%2011.1466%2011.4113%2011.1882%2011.3108C11.2298%2011.2103%2011.2406%2011.0996%2011.2193%2010.993C11.198%2010.8863%2011.1454%2010.7883%2011.0684%2010.7116C11.0174%2010.6604%2010.9569%2010.6198%2010.8902%2010.5921C10.8236%2010.5644%2010.7521%2010.5501%2010.6799%2010.55H9.44313V9.3125C9.44313%209.16675%209.38527%209.02696%209.28228%208.92383C9.17928%208.82071%209.03956%208.76268%208.89381%208.7625H8.8945ZM14.8139%204.5C14.9839%204.5003%2015.1477%204.56357%2015.2738%204.67758C15.3999%204.7916%2015.4792%204.94828%2015.4966%205.11737L15.5%205.1875V12.0666C15.5003%2012.1982%2015.4628%2012.327%2015.392%2012.4379C15.3213%2012.5488%2015.2202%2012.637%2015.1007%2012.6922C14.9813%2012.7473%2014.8486%2012.7671%2014.7183%2012.7491C14.588%2012.731%2014.4656%2012.676%2014.3656%2012.5905C14.2316%2012.4752%2014.1471%2012.3127%2014.1298%2012.1367L14.1264%2012.0666V6.14931C14.1263%206.08512%2014.1038%206.02296%2014.0628%205.97361C14.0217%205.92427%2013.9647%205.89084%2013.9016%205.87912L13.8521%205.87431H7.93269C7.76272%205.87433%207.5988%205.81127%207.47268%205.69734C7.34655%205.58341%207.2672%205.42672%207.25%205.25762L7.24656%205.1875C7.24649%205.01749%207.30941%204.85349%207.42318%204.72715C7.53694%204.60082%207.69348%204.52112%207.86256%204.50344L7.93338%204.5H14.8125H14.8139Z'%20fill='%23fff'/%3e%3c/svg%3e",_ae={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),P(ae,null,[d("div",{class:Ct(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},mae=$e(_ae,[["__scopeId","data-v-f0b41657"]]),yae={class:"custom-group-content"},bae={class:"top-block"},xae={class:"title-block"},wae={class:"title-text"},Cae={class:"btn-block"},Sae={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getGraph"),o=He("getNode"),i=He("addNode");He("setData");const r=He("resetSize"),s=X(["custom-group","batch-group","end-node","terminate-node"]),a=X(!1),l=Xe(()=>o().id),u=m=>{i(m),a.value=!1},c=()=>{a.value=!0},f=X(null),p=()=>{let m=h.batch_arrays[0];m&&m.key&&m.typ&&m.value?f.value.open():xt.error("请填写执行数组")},h=Je({chan_number:10,max_run_number:500,batch_arrays:[{key:"",typ:"",value:"",_id:ns(16)}],output:[{key:"",typ:"",value:"",_id:ns(16)}]}),v=()=>{const m=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(m).batch||{}}catch{g={}}h.chan_number=g.chan_number,h.batch_arrays=g.batch_arrays,h.output=g.output,Pt(()=>{r()})};gt(()=>e.properties,(m,g)=>{JSON.stringify(m)!==JSON.stringify(g)&&v()},{deep:!0});const _=()=>{let m=o();t().deleteNode(m.id)};return ut(()=>{v(),r()}),(m,g)=>{const b=Qt,C=ja,D=Pr,T=$r,O=Rr;return w(),P("div",yae,[y(mae,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),d("div",{class:"header-box",style:In({background:n.properties.node_header_bg_color})},[d("div",bae,[d("div",xae,[g[2]||(g[2]=d("img",{src:gae,alt:""},null,-1)),d("div",wae,j(e.properties.node_name),1)]),d("div",Cae,[y(C,{title:null,trigger:"click",open:a.value,"onUpdate:open":g[0]||(g[0]=k=>a.value=k),placement:"right"},{content:x(()=>[y(Iu,{excludedNodeTypes:s.value,onAddNode:u,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[y(b,{title:"新建内部节点"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(c,["stop"])},[y(ee(Fn))])]),_:1})]),_:1},8,["open"]),y(b,{title:"运行测试"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(p,["stop"])},[y(ee(Qo))])]),_:1}),y(O,{trigger:"click"},{overlay:x(()=>[y(T,null,{default:x(()=>[y(D,{onClick:_},{default:x(()=>[...g[4]||(g[4]=[d("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"btn-item",onClick:g[1]||(g[1]=St(()=>{},["stop"]))},[...g[3]||(g[3]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])])]),_:1})])]),g[5]||(g[5]=Xm('<div class="info-block" data-v-99ee6452><div class="info-item" data-v-99ee6452><div class="info-label" data-v-99ee6452>执行数组</div><div class="info-content" data-v-99ee6452><div class="label-text" data-v-99ee6452>input</div></div></div></div>',1))],4),g[6]||(g[6]=d("div",{class:"node-body"},[d("div",{class:"node-content"})],-1)),y(Hg,{ref_key:"runTestRef",ref:f,batch_node_key:l.value},null,8,["batch_node_key"])])}}},kae=$e(Sae,[["__scopeId","data-v-99ee6452"]]);function Lm(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=Lm(f.children,f)),f})}class Eae extends Ja.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=Ze("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(Ze("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Tt(kae,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=er({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Pt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(v=>v.sourceAnchorId),i=t.map(v=>v.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:v=>{v.stopPropagation();const{graphModel:_,model:m}=this.props;l==="right"&&!r&&_.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:m})}},c,f,p)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}}class Dae extends Ja.model{initNodeData(e){super.initNodeData(e),this.width=e.width||600,this.height=e.height||420,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(u=>u.type==="start-node");r&&(t.add(r.id),e.push(r));const s=u=>{for(let c=0;c<u.length;c++){let p=u[c].sourceNode;t.has(p.id)||(t.add(p.id),ls.includes(p.type)&&e.push(p),s(p.incoming.edges))}};s(o),i.filter(u=>u.properties.loop_parent_key==this.id).forEach(u=>{e.push(u)});let l=[];for(const u of e){if(!ls.includes(u.type))continue;let c=JSON.parse(u.properties.node_params),f={label:u.properties.node_name,value:u.id,node_id:u.id,node_type:u.properties.node_type,typ:"node",children:[],loop_parent_key:u.properties.loop_parent_key,group_node_key:this.id};if(u.type==="http-node"&&(f.children=c.curl.output),u.type==="code-run-node"&&(f.children=c.code_run.output),u.type==="parameter-extraction-node"&&(f.children=c.params_extractor.output),u.type==="start-node"&&(f.children=[...c.start.diy_global,...c.start.sys_global]),u.type==="custom-group"&&(f.children=c.loop.output),u.type==="import-library-node"&&(f.children=c.library_import.outputs),u.type==="json-node"&&(f.children=c.json_encode.output),u.type==="json-reverse-node"&&(f.children=c.json_decode.output),u.type==="select-data-node"&&(f.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),u.type==="knowledge-base-node"&&(f.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),u.type==="ai-dialogue-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),u.type==="specify-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="immediately-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="problem-optimization-node"&&(f.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),u.type==="mcp-node"&&(f.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),u.type==="image-generation-node"){let p=c.image_generation.image_num;if(p>0){let h=[];for(let v=0;v<+p;v++){let _=String.fromCharCode(97+v);h.push({key:`picture_url_${_}`,typ:"string",name:`picture_url_${_}`,label:`picture_url_${_}`})}f.children=h}}if(u.type==="zm-plugins-node"){let p=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=v=>{v.forEach(_=>{_.name=_.key||"",_.subs&&_.subs.length>0&&h(_.subs)})};h(p),f.children=p||[]}f.children.forEach(p=>{p.node_id=u.id,p.node_name=u.properties.node_name,p.node_type=u.properties.node_type}),f.children=Lm(f.children,null),l.push(f)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const Aae={type:"batch-group",view:Eae,model:Dae},Oae={class:"ai-dialogue-node"},Nae={class:"field-list"},Mae={class:"field-item"},Tae={class:"field-item-content"},$ae={class:"field-value"},Pae={class:"field-key"},Rae={class:"field-item"},Bae={class:"field-item-content"},Lae={class:"field-value"},Iae={class:"field-key"},Fae={class:"field-item"},jae={class:"options-list"},Vae={class:"option-label"},Hae={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getNode"),o=He("resetSize"),i=X([]),r=X([]),s=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[],image_watermark:"1",image_optimize_prompt:"1"}),a=Xe(()=>{let c=["msg"];if(s.image_num>0)for(let f=0;f<+s.image_num;f++){let p=String.fromCharCode(97+f);c.push(`picture_url_${p}`)}return c}),l=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let f={};try{u(),f=JSON.parse(c).image_generation||{},s.model_config_id=f.model_config_id,s.use_model=f.use_model,s.size=f.size,s.image_num=f.image_num,s.prompt=f.prompt,s.prompt_tags=f.prompt_tags,s.input_images=f.input_images,s.image_watermark=f.image_watermark,s.image_optimize_prompt=f.image_optimize_prompt}catch{f={}}Pt(()=>{o()})};function u(){let c=t().getAllParentVariable();i.value=c||[]}return gt(()=>e.properties,(c,f)=>{const p=c.dataRaw||c.node_params||"{}",h=f.dataRaw||f.node_params||"{}";p!=h&&l()},{deep:!0}),ut(()=>{l(),o()}),no(()=>{}),(c,f)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Oae,[d("div",Nae,[d("div",Mae,[f[0]||(f[0]=d("div",{class:"field-item-label"},"模型",-1)),d("div",Tae,[d("div",$ae,[d("span",Pae,[y(Za,{useModel:s.use_model,modelConfigId:s.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",Rae,[f[1]||(f[1]=d("div",{class:"field-item-label"},"提示词",-1)),d("div",Bae,[d("div",Lae,[d("span",Iae,[y(yn,{options:i.value,defaultSelectedList:s.prompt_tags,defaultValue:s.prompt,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])])])])]),d("div",Fae,[f[3]||(f[3]=d("div",{class:"field-item-label"},"输出",-1)),d("div",jae,[(w(!0),P(ae,null,ye(a.value,p=>(w(),P("div",{class:"options-item",key:p},[d("div",Vae,j(p),1),f[2]||(f[2]=d("div",{class:"option-type"},"string",-1))]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Uae=$e(Hae,[["__scopeId","data-v-7aa328b2"]]);let zae=class extends tn{constructor(e){super(e),this.renderVue(Uae,e)}},qae=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Gae={type:"image-generation-node",model:qae,view:zae},Xae={class:"ai-dialogue-node"},Wae={class:"field-list"},Yae={class:"field-item"},Kae={class:"field-item-content"},Jae={class:"field-list-item"},Zae={class:"field-text"},Qae={key:1},ele={class:"field-item"},tle={class:"field-item-content"},nle={class:"field-key"},ole={class:"field-type"},ile={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=X([]),a=X([]),l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),u=()=>{const h=e.properties.dataRaw||e.properties.node_params||"{}";let v={};try{v=JSON.parse(h).json_encode||{}}catch{v={}}p(),v=JSON.parse(JSON.stringify(v)),l.input_variable=v.input_variable,l.input_tags=v.input_tags||[],l.output=v.output,Pt(()=>{r()})},c=()=>{const h=JSON.stringify({json_encode:{...l}});t({...e.node,node_params:h})},f=h=>{yo.includes(h.node_type)&&Pt(()=>{c()})},p=()=>{let h=i().getAllParentVariable();a.value=h||[]};return gt(()=>e.properties,u,{deep:!0}),ut(()=>{u(),r(),o().eventCenter.on("custom:setNodeName",f)}),no(()=>{o().eventCenter.off("custom:setNodeName",f)}),(h,v)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Xae,[d("div",Wae,[d("div",Yae,[v[0]||(v[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",Kae,[d("div",Jae,[d("div",Zae,[l.input_variable.length>0?(w(),Z(yn,{key:0,options:a.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),P("span",Qae,"--"))])])])]),d("div",ele,[v[1]||(v[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",tle,[(w(!0),P(ae,null,ye(l.output,(_,m)=>(w(),P("div",{class:"field-value",key:m},[d("span",nle,j(_.key),1),d("span",ole,j(_.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rle=$e(ile,[["__scopeId","data-v-773f423c"]]);let sle=class extends tn{constructor(e){super(e),this.renderVue(rle,e)}},ale=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lle={type:"json-node",model:ale,view:sle},ule={class:"ai-dialogue-node"},dle={class:"field-list"},cle={class:"field-item"},fle={class:"field-item-content"},ple={class:"field-list-item"},hle={class:"field-text"},vle={class:"field-item"},gle={class:"field-item-content"},_le={class:"field-key"},mle={class:"field-type"},yle={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph");He("getNode");const i=He("resetSize"),r=X([]),s=Je({input_variable:[],output:[{key:"",typ:"object",subs:[]}]}),a=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let f={};try{f=JSON.parse(c).json_decode||{}}catch{f={}}f=JSON.parse(JSON.stringify(f)),s.input_variable=bg(f.input_variable),s.output=f.output,Pt(()=>{i()})},l=()=>{const c=JSON.stringify({json_decode:{input_variable:s.input_variable?s.input_variable.join("."):"",...s}});t({...e.node,node_params:c})},u=c=>{yo.includes(c.node_type)&&Pt(()=>{l()})};return gt(()=>e.properties,a,{deep:!0}),ut(()=>{a(),i(),o().eventCenter.on("custom:setNodeName",u)}),no(()=>{o().eventCenter.off("custom:setNodeName",u)}),(c,f)=>(w(),Z(on,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",ule,[d("div",dle,[d("div",cle,[f[0]||(f[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",fle,[d("div",ple,[d("div",hle,[y(lr,{value:s.input_variable},null,8,["value"])])])])]),d("div",vle,[f[1]||(f[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",gle,[(w(!0),P(ae,null,ye(s.output,(p,h)=>(w(),P("div",{class:"field-value",key:h},[d("span",_le,j(p.key),1),d("span",mle,j(p.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},ble=$e(yle,[["__scopeId","data-v-51c43b49"]]);let xle=class extends tn{constructor(e){super(e),this.renderVue(ble,e)}},wle=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Cle={type:"json-reverse-node",model:wle,view:xle},Sle={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{use_model:"",text:"",text_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.text_to_audio)==null?void 0:o.arguments)||{};this.formState.use_model=t.use_model||"--",this.formState.text=t.text||"",this.formState.text_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.text)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},kle={class:"specify-reply-node"},Ele={class:"static-field-list"},Dle={class:"static-field-item"},Ale={class:"static-field-item-content"},Ole={class:"static-field-value"},Nle={class:"static-field-item"},Mle={class:"static-field-item-content"},Tle={class:"static-field-value"},$le={key:1};function Ple(n,e,t,o,i,r){const s=Nt("at-text"),a=Nt("node-common");return w(),Z(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",kle,[d("div",Ele,[d("div",Dle,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"语音模型",-1)),d("div",Ale,[d("div",Ole,j(i.formState.use_model),1)])]),d("div",Nle,[e[1]||(e[1]=d("div",{class:"static-field-item-label"},"文本",-1)),d("div",Mle,[d("div",Tle,[i.formState.text.length>0?(w(),Z(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.text_tags,defaultValue:i.formState.text,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),P("span",$le,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Rle=$e(Sle,[["render",Ple],["__scopeId","data-v-02bee5c7"]]);let Ble=class extends tn{constructor(e){super(e),this.renderVue(Rle,e)}},Lle=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Ile={type:"voice-synthesis-node",model:Lle,view:Ble},Fle={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{file_url:"",file_url_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.voice_clone)==null?void 0:o.arguments)||{};this.formState.file_url=t.file_url||"--",this.formState.file_url_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.file_url)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},jle={class:"specify-reply-node"},Vle={class:"static-field-list"},Hle={class:"static-field-item"},Ule={class:"static-field-item-content"},zle={class:"static-field-value"},qle={key:1};function Gle(n,e,t,o,i,r){const s=Nt("at-text"),a=Nt("node-common");return w(),Z(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",jle,[d("div",Vle,[d("div",Hle,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"复刻音频",-1)),d("div",Ule,[d("div",zle,[i.formState.file_url.length>0?(w(),Z(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.file_url_tags,defaultValue:i.formState.file_url,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),P("span",qle,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Xle=$e(Fle,[["render",Gle],["__scopeId","data-v-7cfb5b5d"]]);let Wle=class extends tn{constructor(e){super(e),this.renderVue(Xle,e)}},Yle=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Kle={type:"voice-clone-node",model:Yle,view:Wle},Jle={class:"start-node"},Zle={class:"start-node-options"},Qle={class:"options-list"},eue={class:"options-item"},tue={class:"option-label"},nue={class:"start-node"},oue={class:"start-node-options"},iue={class:"options-list"},rue={class:"options-item"},sue={class:"option-label"},aue={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let s=JSON.parse(t.properties.node_params).trigger.trigger_web_hook_config;Object.assign(o,s),Pt(()=>{e()})};return ut(()=>{i()}),(r,s)=>(w(),Z(on,{title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Jle,[d("div",Zle,[s[0]||(s[0]=d("div",{class:"options-title"},"请求地址",-1)),d("div",Qle,[d("div",eue,[d("div",tue,j(o.url),1)])])])]),d("div",nue,[d("div",oue,[s[1]||(s[1]=d("div",{class:"options-title"},"请求方式",-1)),d("div",iue,[d("div",rue,[d("div",sue,j(o.method),1)])])])])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},lue=$e(aue,[["__scopeId","data-v-453d22cf"]]);let uue=class extends tn{constructor(e){super(e),this.renderVue(lue,e)}},due=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const cue={type:"webhook-trigger-node",model:due,view:uue},fue={class:"ai-dialogue-node"},pue={class:"field-list"},hue={class:"field-item"},vue={class:"field-item-content"},gue={class:"field-value"},_ue={class:"field-key"},mue={class:"field-item"},yue={class:"field-item-content"},bue={class:"field-value"},xue={class:"field-key"},wue={class:"field-item"},Cue={class:"field-item-content"},Sue={class:"field-value"},kue={class:"field-key"},Eue={key:0,class:"field-item"},Due={class:"field-item-content"},Aue={class:"field-value"},Oue={class:"field-key"},Nue={key:1,class:"field-item"},Mue={class:"field-item-content"},Tue={class:"field-value"},$ue={class:"field-key"},Pue={key:2,class:"field-item"},Rue={class:"field-item-content"},Bue={class:"field-value"},Lue={class:"field-key"},Iue={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=Ts(),t=Xe(()=>e.libraryLists),o=n,i=He("getNode"),r=He("resetSize"),s=X([]),a=X([]),l=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),u=Xe(()=>t.value.filter(v=>l.library_id.includes(v.id))),c=Xe(()=>{var v;return(v=u.value[0])==null?void 0:v.library_name}),f=Xe(()=>u.value&&u.value.length?u.value[0].type:-1),p=()=>{const v=o.properties.dataRaw||o.properties.node_params||"{}";let _={};try{h(),_=JSON.parse(v).library_import||{};for(let m in _)m=="library_id"?l.library_id=_[m]?_[m].split(","):[]:l[m]=_[m]}catch{image_generation={}}Pt(()=>{r()})};function h(){let v=i().getAllParentVariable();s.value=v||[]}return gt(()=>o.properties,(v,_)=>{const m=v.dataRaw||v.node_params||"{}",g=_.dataRaw||_.node_params||"{}";m!=g&&p()},{deep:!0}),ut(()=>{p(),r()}),no(()=>{}),(v,_)=>(w(),Z(on,{properties:n.properties,title:o.properties.node_name,menus:a.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",fue,[d("div",pue,[d("div",hue,[_[0]||(_[0]=d("div",{class:"field-item-label"},"知识库",-1)),d("div",vue,[d("div",gue,[d("span",_ue,j(c.value),1)])])]),f.value==2?(w(),P(ae,{key:0},[d("div",mue,[_[1]||(_[1]=d("div",{class:"field-item-label"},"分段问题",-1)),d("div",yue,[d("div",bue,[d("span",xue,[y(yn,{options:s.value,defaultValue:l.qa_question},null,8,["options","defaultValue"])])])])]),d("div",wue,[_[2]||(_[2]=d("div",{class:"field-item-label"},"分段答案",-1)),d("div",Cue,[d("div",Sue,[d("span",kue,[y(yn,{options:s.value,defaultValue:l.qa_answer},null,8,["options","defaultValue"])])])])])],64)):ie("",!0),f.value!=2&&f.value>=0?(w(),P(ae,{key:1},[l.import_type=="content"?(w(),P("div",Eue,[_[3]||(_[3]=d("div",{class:"field-item-label"},"文档标题",-1)),d("div",Due,[d("div",Aue,[d("span",Oue,[y(yn,{options:s.value,defaultValue:l.normal_title},null,8,["options","defaultValue"])])])])])):ie("",!0),l.import_type=="content"?(w(),P("div",Nue,[_[4]||(_[4]=d("div",{class:"field-item-label"},"文档内容",-1)),d("div",Mue,[d("div",Tue,[d("span",$ue,[y(yn,{options:s.value,defaultValue:l.normal_content},null,8,["options","defaultValue"])])])])])):ie("",!0),l.import_type=="url"?(w(),P("div",Pue,[_[5]||(_[5]=d("div",{class:"field-item-label"},"文档URL",-1)),d("div",Rue,[d("div",Bue,[d("span",Lue,[y(yn,{options:s.value,defaultValue:l.normal_url},null,8,["options","defaultValue"])])])])])):ie("",!0)],64)):ie("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Fue=$e(Iue,[["__scopeId","data-v-c77c7a71"]]);let jue=class extends tn{constructor(e){super(e),this.renderVue(Fue,e)}},Vue=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Hue={type:"import-library-node",model:Vue,view:jue},Uue={name:"ZmWorkflowNode",components:{NodeCommon:on},inject:["getNode","getGraph","resetSize","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],robotAvatar:"",nodeParams:{},options:[]}},mounted(){this.init()},methods:{init(){var n,e,t;this.nodeParams=To(this.properties.node_params),this.robotAvatar=(t=(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_info)==null?void 0:t.robot_avatar,this.loadRobotNode()},handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},loadRobotNode(){var n,e;ug({robot_id:(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_id}).then(t=>{var i,r;let o=To((i=t==null?void 0:t.data)==null?void 0:i.node_params);this.options=((r=o==null?void 0:o.start)==null?void 0:r.diy_global)||[],this.update(),this.$nextTick(()=>{this.resetSize()})})},update(){var t;let n=this.nodeParams,e=((t=n==null?void 0:n.workflow)==null?void 0:t.params)||[];if(!Array.isArray(e)||!e.length){let o=JSON.parse(JSON.stringify(this.options));for(let i of o)i.variable=String(i.variable||"");n.workflow.params=o,this.setData({node_params:JSON.stringify(n)})}}}},zue={class:"start-node"},que={class:"start-node-options"},Gue={class:"options-list",style:{"max-height":"82px",overflow:"hidden"}},Xue={class:"option-label"},Wue={class:"option-type"};function Yue(n,e,t,o,i,r){const s=Nt("node-common");return w(),Z(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-url":i.robotAvatar,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",zue,[d("div",que,[e[0]||(e[0]=d("div",{class:"options-title"},"输入参数",-1)),d("div",Gue,[(w(!0),P(ae,null,ye(i.options,a=>(w(),P("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",Xue,j(a.key),1),d("div",Wue,j(a.typ),1)],2))),128))])]),e[1]||(e[1]=d("div",{class:"start-node-options"},[d("div",{class:"options-title"},"异常处理"),d("div",{class:"options-list"},[d("div",{class:"options-item"},[d("div",{class:"option-label"},"运行代码报错时执行该分支")])])],-1))])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","onHandleMenu"])}const Kue=$e(Uue,[["render",Yue],["__scopeId","data-v-1e7378b1"]]);class Jue extends tn{constructor(e){super(e),this.renderVue(Kue,e)}}class Zue extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}}const Que={type:"zm-workflow-node",model:Zue,view:Jue};function ede(n){Wt(NZ,n),Wt(VZ,n),Wt(rQ,n),Wt(pQ,n),Wt(_ee,n),Wt(xQ,n),Wt(RQ,n),Wt(Oee,n),Wt(Ree,n),Wt(Bse,n),Wt(jee,n),Wt(vte,n),Wt(Zee,n),Wt(Ete,n),Wt(Lte,n),Wt(tne,n),Wt(hne,n),Wt(One,n),Wt(noe,n),Wt(Soe,n),Wt(Joe,n),Wt(hie,n),Wt(wie,n),Wt(Sre,n),Wt(Sse,n),Wt(Nse,n),Wt(Kse,n),Wt(vae,n),Wt(Aae,n),Wt(Gae,n),Wt(lle,n),Wt(Cle,n),Wt(Ile,n),Wt(Kle,n),Wt(cue,n),Wt(Hue,n),Wt(Que,n)}const tde={class:"logic-flow-wrapper"},Qv="dont_show_delete_node_confirm",nde={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(n,{expose:e,emit:t}){const o=t;let i=null;const r=X(null),{setStorage:s,getStorage:a}=Qm(),l=X(a(Qv)||!1),u=X(null),c=X(!1),f=X(null),p=X(null),h=Nm(),v=X(""),_=X([]),m={nodes:[]},g={width:160,height:140,bottomPosition:24,rightPosition:16},b={exclusiveMode:!1},C=ke=>{i&&i.zoom(ke)};function D(){if(p.value){i=new eK({container:p.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[bJ,wJ,lZ,CJ,Mm,Tm,eJ,Am,Dm],pluginsOptions:{miniMap:g,selectionSelect:b,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),r.value=i,ede(i),Wt(JJ,i),Wt(iZ,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:De})=>{v.value=De.flowId});let ke={},he=[];i.on("node:dragstart",({data:De})=>{let Me=i.graphModel.getElement(De.id);ke[Me.id]=Me.zIndex,he=[];let U=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);U?(U.properties.width=U._width,U.properties.height=U._height):Me.properties.loop_parent_key||(Me.properties.disabled_add_group=!0),De.children&&De.children.length>0?(Me.setZIndex(-9999),he=De.children||[],he.forEach(ne=>{let se=i.getNodeModelById(ne);ke[se.id]=se.zIndex,se.setZIndex(999999)})):Me.setZIndex(999999),Me.refreshBranch()}),i.on("node:drop",({data:De})=>{let Me=i.graphModel.getElement(De.id),U=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);De.properties.loop_parent_key&&!U&&i.getNodeModelById(De.properties.loop_parent_key).addChild(De.id),De.children&&De.children.length?(Me.setZIndex(-9999),De.children.forEach(ne=>{let se=i.getNodeModelById(ne);se.setZIndex(ke[se.id])})):Me.setZIndex(ke[Me.id]),Me.refreshBranch()}),i.on("node:drag",({data:De})=>{const Me=De.id,U=i.graphModel.getNodeEdges(Me),ne=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);setTimeout(()=>{U.forEach(se=>{if(se.type==="custom-bezier-edge"){const{startPoint:Ee,endPoint:fe}=se,Le=fe.x-Ee.x,Ie=fe.y-Ee.y;let We=10+Math.sqrt(Le*Le+Ie*Ie)*.3;const lt=10,de=1e3;We=Math.round(We),We=Math.max(lt,Math.min(We,de)),se.setProperties({offset:We})}}),ne&&ne.refreshBranch()},0)}),i.on("node:add",()=>{}),i.on("custom:addNode",De=>{M(De)}),i.on("custom:addGroupNode",({data:De,group_id:Me})=>{F(De,Me)}),i.on("group:add-node",({childId:De})=>{i.getNodeModelById(De).properties.loop_parent_key}),i.on("element:click",De=>{_.value=[De.data]}),i.on("node:click",({data:De})=>{ce(De)}),i.on("blank:click",()=>{tt()}),i.on("selection:selected",De=>{let Me=[];De.elements.forEach(U=>{let ne=i.getDataById(U.id);(U.BaseType==="node"||U.BaseType==="edge")&&Me.push(ne)}),_.value=Me}),i.on("node:delete",({data:De})=>{let Me=JSON.parse(JSON.stringify(De));ge(Me)}),i.on("edge:delete",({data:De})=>{let Me=JSON.parse(JSON.stringify(De));_e(Me)}),i.on("custom:node:delete",De=>{Q(De)}),i.on("custom:edge:delete",De=>{ue(De)}),i.on("custom:keyoard:delete",()=>{te()}),i.on("custom:paste",R),i.render(m),i.setZoomMiniSize(.01),i.setZoomMaxSize(8)}}const T=ke=>{const he=qf(),De=JSON.parse(ke.properties.node_params),{trigger_list:Me}=De.start,U=[],ne=[];let se=0;return Me.forEach(Ee=>{const fe=`trigger_${Ee.trigger_type}`,Le=Gi(fe),Ie=he[fe],Ve=Le.substring(0,8)+Le.substring(Le.length-8),et=Gi(fe),nt=Hd(Ee);nt.id=Le,nt.x=ke.x-600,nt.y=ke.y+se,nt.properties.node_key=Le,nt.properties.nodeSortKey=Ve;const We={id:et,sourceNodeId:Le,targetNodeId:ke.id,properties:{isTriggerEdge:!0}};se+=Ie.height+50,U.push(nt),ne.push(We)}),{nodes:U,edges:ne}},O=()=>{const ke=JSON.parse(JSON.stringify(i.getGraphRawData())),he=[],De=[],Me=[];return ke.edges.forEach(U=>{U.properties.isTriggerEdge||De.push(U)}),ke.nodes.forEach(U=>{U.properties.isTriggerNode?Me.push(U):he.push(U)}),ke.nodes=he,ke.edges=De,ke.triggers=Me,ke},k=ke=>{const he=qf();let De={nodes:[],edges:[]};ke.nodes.forEach(U=>{let ne=he[U.type];U.properties.node_icon_name=ne.properties.node_icon_name,U.properties.node_header_bg_color||(U.properties.node_header_bg_color=ne.properties.node_header_bg_color||"#fff"),U.properties.width||(U.properties.width=ne.width),U.properties.height||(U.properties.height=ne.height),U.type=="start-node"&&(De=T(U))}),ke.nodes.unshift(...De.nodes),i.clearData(),i.graphModel.graphDataToModel(ke),i.graphModel.translateCenter(),i.extension.miniMap.show(),De.edges.forEach(U=>{i.graphModel.addEdge(U)});const Me=i.extension.canvasHistory;Me&&Me.setInitialState(ke),S(ke.nodes)},S=ke=>{Pt(()=>{ke.forEach(he=>{if(he.loop_parent_key){const De=i.getNodeModelById(he.loop_parent_key);De&&(De.addChild(he.id),i.graphModel.dynamicGroup.sendNodeToFront(De))}})})};let N={};const L=()=>{const{nodes:ke}=i.graphModel,he=ke.find(U=>U.type==="start-node"),De=he.x-600,Me=he.y;return{x:De,y:Me}},$=(ke,he)=>{const De=he.x-he.width/2,Me=he.x+he.width/2,U=he.y-he.height/2,ne=he.y+he.height/2,se=ke.x-ke._width/2,Ee=ke.x+ke._width/2,fe=ke.y-ke._height/2,Le=ke.y+ke._height/2;let Ie=!1,Ve=ke._width,et=ke._height,nt=0,We=0;if(Me>Ee-20){const lt=Me-Ee+50;Ve+=lt,nt+=lt/2,Ie=!0}if(De<se+20){const lt=se-De+50;Ve+=lt,nt-=lt/2,Ie=!0}if(ne>Le-20){const lt=ne-Le+50;et+=lt,We+=lt/2,Ie=!0}if(U<fe+20){const lt=fe-U+50;et+=lt,We-=lt/2,Ie=!0}Ie&&(ke.properties.width=Ve,ke.properties.height=et,ke._width=Ve,ke._height=et,ke.width=Ve,ke.height=et,ke.x+=nt,ke.y+=We)},B=ke=>{const he=ke.node||ke,De=ke.anchorData,Me=ke.event;if(he.id=he.id||Gi(he.type),he.nodeSortKey=he.id.substring(0,8)+he.id.substring(he.id.length-8),De){let U=i.graphModel.dynamicGroup.getGroupByNodeId(De.nodeId);U?he.properties.loop_parent_key=U.id:he.properties.disabled_add_group=!0}if(ke.isCopy||(N[he.type]?(N[he.type]=N[he.type]+1,he.properties.node_name=he.properties.node_name+N[he.type]):N[he.type]=1),he.properties.width=he.width,he.properties.height=he.height,he.properties.nodeSortKey=he.nodeSortKey,Me){const{transformModel:U}=i.graphModel,{left:ne,top:se}=p.value.getBoundingClientRect(),[Ee,fe]=U.HtmlPointToCanvasPoint([Me.clientX-ne,Me.clientY-se]);he.x=Ee+he.width/2,he.y=fe+he.height/2}else if(!he.x&&!he.y)if(De)he.x=De.x+he.width+100,he.y=De.y+he.height/2-24;else if(ke.isTriggerNode){let U=L();he.x=U.x,he.y=U.y,he.properties.disabled_add_group=!0}else{const{transformModel:U}=i.graphModel,ne=U.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);he.x=ne[0],he.y=ne[1],he.properties.disabled_add_group=!0}return he},E=ke=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:27,node_name:"循环开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},ke.id)},100)},A=ke=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:31,node_name:"批量执行开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},ke.id)},100)},M=ke=>{const he=B(ke),De=ke.model,Me=ke.anchorData;let U=!1;if(i.graphModel.nodes.forEach(se=>{!U&&se.type=="session-trigger-node"&&(U=!0)}),U&&he.type=="session-trigger-node")return xt.error("请勿添加多个会话触发器");let ne=i.addNode(he);if(ne.type=="custom-group"&&E(ne),ne.type=="batch-group"&&A(ne),ke.isTriggerNode){const{nodes:se}=i.graphModel,Ee=se.find(Le=>Le.type==="start-node");let fe={type:"custom-bezier-edge",sourceNodeId:he.id,targetNodeId:Ee.id,properties:{isTriggerEdge:!0}};i.graphModel.addEdge(fe),i.graphModel.eventCenter.emit("custom:trigger-add",he)}if(Me){let se=ne.anchors.find(fe=>fe.type==="left");i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:De.id,targetNodeId:ne.id,sourceAnchorId:Me.id,targetAnchorId:se.id,startPoint:{x:Me.x,y:Me.y},endPoint:{x:se.x,y:se.y}});const Ee=i.graphModel.dynamicGroup.getGroupByNodeId(Me.nodeId);if(Ee&&Ee.id){const fe=i.getNodeModelById(Ee.id);fe.addChild(ne.id),$(fe,ne),i.graphModel.dynamicGroup.sendNodeToFront(fe)}}i.graphModel.clearSelectElements(),ne.setSelected(!0)},F=(ke,he)=>{const De=ke.node||ke;De.id=Gi(De.type),De.nodeSortKey=De.id.substring(0,8)+De.id.substring(De.id.length-8),De.properties.width=De.width,De.properties.height=De.height,De.properties.nodeSortKey=De.nodeSortKey,De.properties.loop_parent_key=he;const Me=i.getNodeModelById(he);De.x=Me.x,De.y=Me.y;let U=0;i.graphModel.nodes.forEach(se=>{se.zIndex>U&&(U=se.zIndex)}),U=U+99;let ne=i.addNode(De);Me.addChild(ne.id),ne.setZIndex(U),i.graphModel.clearSelectElements(),i.graphModel.dynamicGroup.sendNodeToFront(Me)},H=async()=>{const ke=i.getGraphRawData(),he=i.extension.canvasHistory;he&&he.beginTransaction(),i.extension.elk.layout(ke).then(()=>{he&&he.commitTransaction("auto-layout")}).catch(De=>{xt.error("布局失败，请检查"+De),he&&he.rollbackTransaction()})},R=({originalNodes:ke,basePoint:he,pasteBasePoint:De})=>{const Me=i.extension.canvasHistory;Me&&Me.beginTransaction();try{const U=ke.map(se=>{const Ee=se.x-he.x,fe=se.y-he.y,Le=JSON.parse(JSON.stringify(se));return Le.x=De.x+Ee,Le.y=De.y+fe,B({node:Le,isCopy:!0})}),{nodes:ne}=i.addElements({nodes:U});i.clearSelectElements(),ne.forEach(se=>{se.setSelected(!0)})}finally{Me&&Me.commitTransaction("paste")}},G=ke=>{ke.height&&(ke.properties.height=ke.height);let he=i.getNodeModelById(ke.id);he.height=ke.properties.height||ke.height||he.height,he.properties=ke.properties,ke.properties.node_type==2&&ke.properties.node_sub_type==21&&he.graphModel.getNodeEdges(ke.id).forEach(Me=>{Me.sourceNodeId==he.id&&(he.getAnchorInfo(Me.sourceAnchorId)||he.graphModel.deleteEdgeById(Me.id))}),he.refreshBranch()};function oe(ke){return i.getNodeModelById(ke.id)}function V(ke){return i.getEdgeModelById(ke.id)}function Y(){const{nodes:ke}=i.getGraphData();return ke.filter(De=>De.properties.isTriggerNode)}const Q=ke=>{ke&&ke.id&&(_.value=[ke]),q()},ue=ke=>{ke&&ke.id&&(_.value=[ke]),q()},te=()=>{let ke=i.getSelectElements(!0);_.value=[...ke.nodes,...ke.edges],q()},q=()=>{if(_.value.length===0)return;const ke=_.value.filter(Me=>oe(Me)?!["start-node","group-start-node"].includes(Me.type):!0);if(ke.length===0){_.value=[];return}const he=_.value.filter(Me=>Me.properties.isTriggerNode===!0);if(he.length>0&&Y().length-he.length<1){xt.error("请至少保留一个触发器！");return}const De=()=>{const Me=i.extension.canvasHistory;Me&&Me.replaceLastState("replace-before-delete");let U=!1;ke.forEach(ne=>{oe(ne)?(ne.properties.isTriggerNode&&(U=!0),i.deleteNode(ne.id)):V(ne)&&i.deleteEdge(ne.id)}),U&&i.graphModel.eventCenter.emit("custom:trigger-change",null),Me&&Me.saveCurrentState("delete"),_.value=[],i.clearSelectElements()};if(l.value){De();return}if(ke.length>1||ke.length===1&&oe(ke[0])){const Me=ke.length>1?"批量删除":"删除节点",U=`确定要删除选中的 ${ke.length} 个元素吗？`;let ne=!1;gn.confirm({title:Me,content:Tt("div",{},[Tt("p",U),Tt(pg,{class:"dont-show-again-checkbox",onChange:se=>{ne=se.target.checked}},()=>"不再提示")]),onOk:()=>{ne&&(l.value=!0,s(Qv,!0)),De()},onCancel:()=>{}})}else De()},re=["group-start-node","terminate-node"],ce=ke=>{const he=JSON.parse(JSON.stringify(ke));he.properties.dataRaw=he.properties.dataRaw||he.properties.node_params,o("selectNode",he),!re.includes(ke.type)&&(f.value=he,c.value=!0)},ve=ke=>{f.value.properties=ke,G(JSON.parse(JSON.stringify(f.value)))},Ne=ke=>{f.value.properties.node_name=ke,G(JSON.parse(JSON.stringify(f.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:ke,node_id:f.value.id,node_type:f.value.type})},ge=ke=>{o("onDeleteNode",ke),f.value&&ke.id===f.value.id&&(c.value=!1,setTimeout(()=>{f.value=null},350))},_e=ke=>{o("onDeleteEdge",ke)},st=()=>{o("runTest")},tt=()=>{o("blankClick"),c.value&&(c.value=!1),_.value.length>0&&(_.value=[],i.clearSelectElements())};return ut(()=>{D()}),qc(()=>{i&&i.destroy&&i.destroy()}),e({lfRef:r,setData:k,getData:O,updateNode:G}),(ke,he)=>(w(),P("div",tde,[d("div",{ref_key:"containerRef",ref:p,class:"logic-flow-container"},null,512),y(ee(h),{"flow-id":v.value},null,8,["flow-id"]),ee(i)?(w(),Z(US,{key:0,lf:ee(i),onRunTest:st,onAddNode:M,onZoomChange:C,onAutoLayout:H},null,8,["lf"])):ie("",!0),f.value?(w(),Z(Ez,{key:1,ref_key:"nodeFormDrawerRef",ref:u,open:c.value,"onUpdate:open":he[0]||(he[0]=De=>c.value=De),destroyOnClose:!0,"node-id":f.value.id,node:f.value.properties,"node-type":f.value.type,lf:ee(i),onUpdateNode:ve,onChangeTitle:Ne},null,8,["open","node-id","node","node-type","lf"])):ie("",!0)]))}},ode={class:"modal-title-block"},ide={key:0,class:"run-detail"},rde={class:"flex-content-box"},sde={class:"test-model-box"},ade={key:2,class:"input-list-box"},lde={class:"add-btn-box"},ude={key:0,class:"result-list-box loading-box"},dde={key:1,class:"result-list-box"},cde=["onClick"],fde={class:"status-block"},pde={class:"icon-name-box"},hde=["src"],vde={class:"node-name"},gde={key:0,class:"time-tag"},_de={class:"right-active-icon"},mde={class:"save-btn-box"},yde={class:"preview-box"},bde={class:"preview-title"},xde={class:"icon-name-box"},wde=["src"],Cde={class:"node-name"},Sde={key:0,class:"time-tag"},kde={key:0,class:"preview-content-block"},Ede={class:"preview-img-box"},Dde={class:"preview-content-block"},Ade={class:"title-block"},Ode={class:"preview-code-box"},Nde={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(n,{expose:e,emit:t}){const o={openid:"38fjp8344ru43",question:"你好",question_multiple:'{"type":"text", "text":"这是什么"}',conversationid:"12345"},i=n,r=Xe(()=>i.start_node_params.diy_global||[]),s=t,a=Ds().query,l=X(!1),u=X(""),c=X([]),f=Xe(()=>u.value?c.value.filter(H=>H.node_key==u.value)[0]:null),p=Xe(()=>{let H=[];if(f.value&&f.value.node_type==33){let R=f.value.output;for(let G in R)G.includes("picture_url_")&&H.push(R[G])}return H}),h=X(!1),v=Je({is_draft:!0,robot_key:a.robot_key,global:"",globalState:{}}),_=()=>{if(b(),i.isLockedByOther){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}s("save","automatic");let H=localStorage.getItem("workflow_run_test_data")||"{}";H=JSON.parse(H),v.global=H.global||"",c.value=[],u.value="",s("getGlobal"),Pt(()=>{r.value.forEach(R=>{v.globalState[R.key]=m(R)});try{let R=H.global?JSON.parse(H.global):{};for(let G in v.globalState)R[G]&&(Array.isArray(R[G])?v.globalState[G]=R[G].map(oe=>({value:typeof oe=="object"?JSON.stringify(oe):oe,key:Math.random()*1e3})):v.globalState[G]=R[G])}catch(R){}}),l.value=!0};function m(H){return H.typ=="string"||H.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function g(){let H={};return r.value.forEach(R=>{if(R.typ=="string"){const G=(v.globalState[R.key]||"").trim();H[R.key]=G||(o[R.key]??"")}if(R.typ=="number"){const G=v.globalState[R.key];if(G!==""&&G!=null)H[R.key]=+G;else{const oe=o[R.key];H[R.key]=oe!=null&&oe!==""&&!isNaN(Number(oe))?Number(oe):""}}if(R.typ.includes("array")){let G=v.globalState[R.key].map(oe=>(oe.value=typeof oe.value=="string"?oe.value.trim():oe.value,od(oe.value)?JSON.parse(oe.value):oe.value)).filter(oe=>oe);if((!Array.isArray(G)||G.length===0)&&o[R.key]){const oe=o[R.key];od(oe)?G=[JSON.parse(oe)]:G=[oe]}H[R.key]=G}R.typ==="object"&&od(R.value)&&(H[R.key]=JSON.parse(R.value))}),JSON.stringify(H)}function b(){const R=i.lf.getGraphData().nodes.find(G=>G.type==="session-trigger-node");if(R){const oe=JSON.parse(R.properties.node_params||"{}").trigger||{};return oe.chat_config?oe.chat_config.question_multiple_switch:!1}}const C=(H,R)=>{v.globalState[H].splice(R,1)},D=H=>{v.globalState[H].push({value:"",key:Math.random()*1e4})},T=X(null),O=X(0),k=X(0),S=()=>{T.value.validate().then(()=>{let H={...v};const R=b();H.global=g(),delete H.globalState,h.value=!0,c.value=[];const G=F();Object.keys(G).length&&localStorage.setItem("workflow_run_test_data",JSON.stringify({global:JSON.stringify(G)})),uy({...H,question_multiple_switch:R}).then(oe=>{xt.success("测试结果生成完成");let V=oe.data.node_logs||[];O.value=oe.data.use_token,k.value=oe.data.use_mills,N(V)}).catch(oe=>{c.value=[];let V=oe.data.node_logs||[];V&&V.length&&N(V)}).finally(()=>{h.value=!1})})},N=H=>{var R;c.value=H.map(G=>({...G,is_success:G.error_msg==="<nil>",node_icon:Lu(G.node_type)})),u.value=(R=c.value[0])==null?void 0:R.node_key},L=H=>{u.value=H.node_key},$=()=>{As(JSON.stringify(f.value.output)),xt.success("复制成功")},B=()=>{_()};function E(H){const R=o[H.key];return R?`${R}`:"请输入"}function A(H){try{return JSON.parse(H)}catch{return null}}function M(H,R){return JSON.stringify(H)===JSON.stringify(R)}function F(){const H={};return r.value.forEach(R=>{const G=R.key;if(R.typ==="string"){const oe=String(v.globalState[G]||"").trim();if(!oe)return;const V=o[G];if(V!=null&&oe===String(V))return;H[G]=oe;return}if(R.typ==="number"){const oe=v.globalState[G];if(oe===""||oe==null)return;const V=+oe,Y=o[G];if(Y!=null&&!isNaN(Number(Y))&&V===Number(Y))return;H[G]=V;return}if(R.typ.includes("array")){const V=(Array.isArray(v.globalState[G])?v.globalState[G]:[]).map(ue=>String((ue==null?void 0:ue.value)||"").trim()).filter(ue=>ue).map(ue=>{const te=A(ue);return te??ue});if(!V.length)return;let Y=[];const Q=o[G];if(Q!=null){const ue=A(String(Q));Y=ue!=null?[ue]:[String(Q)]}if(Y.length&&M(V,Y))return;H[G]=V;return}}),H}return e({open:B}),(H,R)=>{const G=mi,oe=ti,V=ln,Y=$n,Q=Vn,ue=Jt,te=kn,q=wn,re=mo,ce=gn;return w(),P("div",null,[y(ce,{open:l.value,"onUpdate:open":R[0]||(R[0]=ve=>l.value=ve),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",ode,[R[1]||(R[1]=z("运行测试 ",-1)),c.value.length?(w(),P("div",ide,[d("span",null,"总耗时："+j(ee(ef)(k.value)),1),d("span",null,"token消耗："+j(O.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",rde,[d("div",sde,[R[4]||(R[4]=d("div",{class:"top-title"},"开始节点参数",-1)),y(q,{model:v,ref_key:"formRef",ref:T,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),P(ae,null,ye(r.value,ve=>(w(),Z(te,{name:["globalState",ve.key],key:ve.key,rules:[{required:ve.required,message:`请输入${ve.key}`}]},{label:x(()=>[y(oe,{gap:4},{default:x(()=>[z(j(ve.key)+" ",1),y(G,{style:{margin:"0"}},{default:x(()=>[z(j(ve.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[ve.typ=="string"?(w(),Z(V,{key:0,placeholder:E(ve),value:v.globalState[ve.key],"onUpdate:value":Ne=>v.globalState[ve.key]=Ne},null,8,["placeholder","value","onUpdate:value"])):ie("",!0),ve.typ=="number"?(w(),Z(Y,{key:1,style:{width:"100%"},placeholder:E(ve),value:v.globalState[ve.key],"onUpdate:value":Ne=>v.globalState[ve.key]=Ne},null,8,["placeholder","value","onUpdate:value"])):ie("",!0),ve.typ.includes("array")?(w(),P("div",ade,[(w(!0),P(ae,null,ye(v.globalState[ve.key],(Ne,ge)=>(w(),P("div",{class:"input-list-item",key:ge},[y(Q,null,{default:x(()=>[y(V,{placeholder:E(ve),value:Ne.value,"onUpdate:value":_e=>Ne.value=_e},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),v.globalState[ve.key].length>1?(w(),Z(ee(Kt),{key:0,onClick:_e=>C(ve.key,ge)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",lde,[y(ue,{onClick:Ne=>D(ve.key),block:"",type:"dashed"},{default:x(()=>[...R[2]||(R[2]=[z("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),h.value?(w(),P("div",ude,[h.value?(w(),Z(re,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),c.value.length>0?(w(),P("div",dde,[(w(!0),P(ae,null,ye(c.value,(ve,Ne)=>(w(),P("div",{class:Ct(["list-item-block",{active:u.value==ve.node_key}]),onClick:ge=>L(ve),key:Ne},[d("div",fde,[ve.is_success?(w(),Z(ee(Ru),{key:0,style:{color:"#138b1b"}})):(w(),Z(ee(Pu),{key:1,style:{color:"#d81e06"}}))]),d("div",pde,[d("img",{src:ve.node_icon,alt:""},null,8,hde),d("div",vde,j(ve.node_name),1)]),ve.is_success?(w(),P("div",gde,j(ve.use_time)+"ms",1)):ie("",!0),d("div",_de,[y(ee(Bu))])],10,cde))),128))])):ie("",!0),d("div",mde,[y(ue,{loading:h.value,onClick:S,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(ee(Qo)),R[3]||(R[3]=z("运行测试",-1))]),_:1},8,["loading"])])]),d("div",yde,[f.value?(w(),P(ae,{key:0},[d("div",bde,[R[5]||(R[5]=d("div",{class:"title-text"},"日志详情",-1)),d("div",xde,[d("img",{src:f.value.node_icon,alt:""},null,8,wde),d("div",Cde,j(f.value.node_name),1)]),f.value.is_success?(w(),P("div",Sde,j(f.value.use_time)+"ms",1)):ie("",!0)]),p.value.length>0?(w(),P("div",kde,[R[6]||(R[6]=d("div",{class:"title-block"},"生成图像日志",-1)),d("div",Ede,[y(Rm,{currentImageList:p.value},null,8,["currentImageList"])])])):ie("",!0),d("div",Dde,[d("div",Ade,[R[7]||(R[7]=z("运行日志",-1)),y(ee(rs),{onClick:$})]),d("div",Ode,[y(ee(us),{data:f.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},Mde=$e(Nde,[["__scopeId","data-v-e37a074b"]]),Tde=["data-lf"],$de={class:"header-content"},Pde={key:1,class:"robot-status-box status-0"},Rde={key:0,class:"header-right"},Bde={key:0,class:"last-save-time"},Lde={key:0,class:"auto-save-hint"},Ide={style:{display:"flex","align-items":"center",gap:"8px"}},Fde={class:"lock-config"},jde={style:{"margin-top":"24px","text-align":"right"}},Vde={key:1,class:"lock-tip"},Hde={class:"lock-info"},Ude={__name:"page-header",props:{lf:{default:()=>null,type:Object},saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo),r=t,s=n,a=X(null),l=ey(),u=Xe(()=>{var S;const k=(S=l.userInfo)==null?void 0:S.role_type;return k==1||k==2}),c=X(!1),f=X(10),p=X(!1),h=async()=>{p.value=!0;try{await cy({draft_exptime:f.value}),xt.success("编辑锁设置已保存"),c.value=!1}catch{xt.error("保存失败，请稍后重试")}finally{p.value=!1}};ut(async()=>{var k;try{const S=await dy(),N=+((k=S==null?void 0:S.data)==null?void 0:k.draft_exptime);typeof N=="number"&&(f.value=Math.max(10,Math.min(60,Math.round(N))))}catch{}});const v=()=>{},_=()=>{r("edit")},m=(k="handle")=>{const S=ds();let N=!1;const L=[],$=B=>{N=!0;const E=(B==null?void 0:B.component)||"未命名组件",A=(B==null?void 0:B.typeDisplay)||(B==null?void 0:B.type)||"";(Array.isArray(B==null?void 0:B.errors)?B.errors:[]).forEach(F=>{L.push(`【${E}${A?" - "+A:""}】字段「${F.field_name}」：${F.message}`)})};if(S.on&&S.on("workflow:validate:error",$),S.emit&&S.emit("workflow:validate",{action:"save"}),S.off&&S.off("workflow:validate:error",$),N){gn.warning({title:"表单未完成",content:L.length?Tt("div",L.map(B=>Tt("div",B))):"请完善必填项后再保存"});return}r("save",k)},g=()=>{const k=ds();let S=!1;const N=[],L=$=>{S=!0;const B=($==null?void 0:$.component)||"未命名组件",E=($==null?void 0:$.typeDisplay)||($==null?void 0:$.type)||"";(Array.isArray($==null?void 0:$.errors)?$.errors:[]).forEach(M=>{N.push(`【${B}${E?" - "+E:""}】字段「${M.field_name}」：${M.message}`)})};if(k.on&&k.on("workflow:validate:error",L),k.emit&&k.emit("workflow:validate",{action:"release"}),k.off&&k.off("workflow:validate:error",L),S){gn.warning({title:"表单未完成",content:N.length?Tt("div",N.map($=>Tt("div",$))):"请完善必填项后再发布"});return}r("release")},b=()=>{r("getGlobal")},C=()=>{r("getVersionRecord")},D=()=>{r("edit")},T=()=>{a.value.open()};function O(k,S="YY-MM-DD HH:mm:ss"){return!k||k<=0?"--":ho(k*1e3).format(S)}return e({openRunTest:T}),(k,S)=>{const N=Jt,L=Qt,$=Nn,B=$n,E=ja;return w(),P("div",{class:"page-header","data-lf":n.lf},[d("div",$de,[y(Sw),i.value.start_node_key!=""?(w(),P("div",{key:0,class:"robot-status-box status-1",onClick:_},[y(ee(Ru),{class:"robot-status-icon"}),S[6]||(S[6]=d("div",{class:"robot-status-text"},"已发布",-1))])):(w(),P("div",Pde,[y(ee(Zc),{class:"robot-status-icon"}),S[7]||(S[7]=d("div",{class:"robot-status-text"},"未发布",-1))]))]),s.showRight?(w(),P("div",Rde,[n.currentVersion==""&&n.isEditing?(w(),P(ae,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(w(),P("div",Bde,[z(j(O(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+j(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),n.isEditing&&!n.isLockedByOther&&(!n.autoSaveEnabled||!n.isLeader)?(w(),P("span",Lde,"你可能已在其他页面编辑，已停止自动保存")):ie("",!0)])):ie("",!0),n.isLockedByOther?ie("",!0):(w(),P(ae,{key:1},[y(N,{class:"save-draft",onClick:S[0]||(S[0]=A=>m("handle"))},{default:x(()=>[...S[8]||(S[8]=[z("保存草稿",-1)])]),_:1}),y(N,{type:"primary",loading:s.saveLoading,class:"publish-robot",onClick:g},{default:x(()=>[...S[9]||(S[9]=[z("发布机器人",-1)])]),_:1},8,["loading"])],64))],64)):ie("",!0),!n.isEditing&&!n.currentVersion||n.isLockedByOther?(w(),Z(N,{key:1,disabled:n.isLockedByOther,type:"primary",class:"ml8",onClick:D},{icon:x(()=>[y(ee(wr))]),default:x(()=>[S[10]||(S[10]=z(" 编辑 ",-1))]),_:1},8,["disabled"])):ie("",!0),y(L,{title:"历史发布详情"},{default:x(()=>[y(N,{onClick:S[1]||(S[1]=A=>C())},{default:x(()=>[y(ee(jy))]),_:1})]),_:1}),u.value?(w(),Z(E,{key:2,trigger:"click",placement:"bottomRight",open:c.value,"onUpdate:open":S[5]||(S[5]=A=>c.value=A),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:v},{title:x(()=>[d("div",Ide,[y($,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),S[11]||(S[11]=d("span",{style:{color:"#262626"}},"编辑锁设置",-1)),S[12]||(S[12]=d("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:x(()=>[d("div",Fde,[S[13]||(S[13]=d("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),y(B,{value:f.value,"onUpdate:value":S[2]||(S[2]=A=>f.value=A),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),S[14]||(S[14]=d("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),d("div",jde,[y(N,{class:"ml8",onClick:S[3]||(S[3]=A=>c.value=!1)},{default:x(()=>[...S[15]||(S[15]=[z("取 消",-1)])]),_:1}),y(N,{type:"primary",class:"ml8",loading:p.value,onClick:h},{default:x(()=>[...S[16]||(S[16]=[z("保 存",-1)])]),_:1},8,["loading"])])]),default:x(()=>[y(N,{class:"",onClick:S[4]||(S[4]=A=>c.value=!0),style:{padding:"5px 9px"}},{default:x(()=>[y($,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):ie("",!0)])):ie("",!0),n.isLockedByOther?(w(),P("div",Vde,[S[17]||(S[17]=d("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),d("div",Hde,"（"+j("用户："+n.loginUserName||"--")+" "+j("IP："+n.lockRemoteAddr||"--")+" "+j("User Agent："+n.lockUserAgent||"--")+"）",1)])):ie("",!0),y(Mde,{ref_key:"runTestRef",ref:a,lf:n.lf,start_node_params:n.start_node_params,onGetGlobal:b,onSave:m,isLockedByOther:n.isLockedByOther},null,8,["lf","start_node_params","isLockedByOther"])],8,Tde)}}},zde=$e(Ude,[["__scopeId","data-v-bb6f350f"]]),qde={class:"form-box"},Gde={class:"form-item"},Xde={class:"form-content"},Wde={class:"version-input-box"},Yde={class:"form-item"},Kde={class:"form-content"},eg="wf_uni_identifier",Jde={__name:"version-model",emits:["ok"],setup(n,{expose:e,emit:t}){const o=Ds().query,i=X(!1);let r="";const s=jn(),a=X(""),l=X(""),u=X(""),c=X(""),f=X(!1),p=t,h=b=>{g(),c.value="",r=b,i.value=!0},v=()=>{try{let b=localStorage.getItem(eg);return b||(b=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(eg,b)),b}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},_=()=>{try{const b=navigator.userAgent||"",C=navigator.platform||"";let D="Unknown";/Windows/i.test(b)?D="Windows":/Macintosh|Mac OS X/i.test(b)?D="MacOS":/Linux/i.test(b)?D="Linux":/Android/i.test(b)?D="Android":/iPhone|iPad|iPod/i.test(b)&&(D="iOS");let T="Unknown",O="";const k=b.match(/Edg\/([\d\.]+)/)||b.match(/Chrome\/([\d\.]+)/)||b.match(/Firefox\/([\d\.]+)/)||b.match(/Version\/([\d\.]+).*Safari/);return k&&(b.includes("Edg/")?T="Edge":b.includes("Chrome/")?T="Chrome":b.includes("Firefox/")?T="Firefox":b.includes("Safari")&&!b.includes("Chrome")&&(T="Safari"),O=k[1]),`platform=${C}; os=${D}; browser=${T}/${O}; ua=${b}`}catch{return"ua=unknown"}},m=()=>{f.value=!0,py({robot_key:o.robot_key,node_list:r,version:`${a.value}.${l.value}.${u.value}`,version_desc:c.value,uni_identifier:v(),user_agent:_(),draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}).then(async b=>{await s.getRobot(o.id),s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0,uni_identifier:v(),user_agent:_()}),i.value=!1,b&&b.res==0&&(xt.success("发布成功"),p("ok"))}).finally(()=>{f.value=!1})},g=()=>{fy({robot_key:o.robot_key}).then(b=>{let C=b.data.version_params||[];a.value=C[0],l.value=C[1],u.value=C[2]})};return e({show:h}),(b,C)=>{const D=$n,T=$i,O=gn;return w(),P("div",null,[y(O,{open:i.value,"onUpdate:open":C[4]||(C[4]=k=>i.value=k),title:"发布","ok-text":"立即发布",onOk:m,confirmLoading:f.value,width:600},{default:x(()=>[d("div",qde,[d("div",Gde,[C[8]||(C[8]=d("div",{class:"form-label"},"版本号：",-1)),d("div",Xde,[d("div",Wde,[C[5]||(C[5]=z(" v ",-1)),y(D,{value:a.value,"onUpdate:value":C[0]||(C[0]=k=>a.value=k),precision:0,min:0,max:1e3},null,8,["value"]),C[6]||(C[6]=d("span",null,".",-1)),y(D,{value:l.value,"onUpdate:value":C[1]||(C[1]=k=>l.value=k),precision:0,min:0,max:1e3},null,8,["value"]),C[7]||(C[7]=d("span",null,".",-1)),y(D,{value:u.value,"onUpdate:value":C[2]||(C[2]=k=>u.value=k),precision:0,min:0,max:1e3},null,8,["value"])])])]),d("div",Yde,[C[9]||(C[9]=d("div",{class:"form-label"},"版本描述：",-1)),d("div",Kde,[y(T,{value:c.value,"onUpdate:value":C[3]||(C[3]=k=>c.value=k),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},Zde=$e(Jde,[["__scopeId","data-v-ed3d8e9d"]]),Qde={class:"version-detail"},ece={class:"version-desc flex-center"},tce={class:"version-file-box"},nce={class:"version-text"},oce={class:"version-text"},ice=["onClick"],rce={class:"version-header"},sce={class:"version-title"},ace={class:"time-text flex-center"},lce={class:"version-file-box"},uce={class:"version-text"},dce={class:"version-text"},cce={class:"version-desc"},fce={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(n,{expose:e,emit:t}){const o=Ds().query,i=X(!1),r=X(""),s=X(""),a=t,l=n,u=jn(),c=Xe(()=>u.robotInfo),f=X([]),p=()=>{i.value=!0,h(),Fd({robot_key:o.robot_key}).then(g=>{const b=(g==null?void 0:g.data)||{};r.value=b.remote_addr||"",s.value=b.user_agent||""})},h=()=>{hy({robot_key:o.robot_key}).then(g=>{f.value=g.data.versions||[]})},v=g=>{gn.confirm({title:`确定要恢复到v${g.version}版吗`,icon:null,content:Tt("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){Uf({robot_key:o.robot_key,version_id:g.version_id}).then(b=>{a("setVersion",b.data),i.value=!1,b.res==0&&xt.success("设置成功")})},onCancel(){}})},_=g=>{g==""?dg({robot_key:o.robot_key,data_type:1}).then(b=>{a("preview",b.data,g),i.value=!1}):Uf({robot_key:o.robot_key,version_id:g}).then(b=>{a("preview",b.data,g),i.value=!1})};function m(g,b="YYYY-MM-DD HH:mm:ss"){return g<=0?"--":ho(g*1e3).format(b)}return e({showDrawer:p}),(g,b)=>{const C=Nn,D=ja,T=Pr,O=$r,k=Rr,S=Hy;return w(),P("div",null,[y(S,{open:i.value,"onUpdate:open":b[2]||(b[2]=N=>i.value=N),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:x(()=>[d("div",Qde,[c.value.draft_save_time&&c.value.draft_save_time!=0?(w(),P("div",{key:0,class:"version-list",onClick:b[0]||(b[0]=N=>_(""))},[b[3]||(b[3]=d("div",{class:"version-header"},[d("div",{class:"version-title"},"当前最新草稿")],-1)),d("div",ece,[z(" 最近保存于"+j(m(c.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),d("div",tce,[y(D,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[d("div",nce," IP："+j(r.value||"--"),1),d("div",oce," User Agent："+j(s.value||"--"),1)]),default:x(()=>[y(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):ie("",!0),(w(!0),P(ae,null,ye(f.value,(N,L)=>(w(),P("div",{class:"version-list",onClick:$=>_(N.version_id),key:N.version},[d("div",rce,[d("div",sce,[z(" v"+j(N.version)+" ",1),d("span",ace,[z(j(m(N.create_time))+" ",1),d("div",lce,[y(D,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[d("div",uce," IP："+j(N.last_edit_ip||"--"),1),d("div",dce," User Agent："+j(N.last_edit_user_agent||"--"),1)]),default:x(()=>[y(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),y(k,null,{overlay:x(()=>[y(O,null,{default:x(()=>[y(T,{disabled:l.isLockedByOther,onClick:$=>v(N)},{default:x(()=>[...b[4]||(b[4]=[z(" 恢复到此版本 ",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024)]),default:x(()=>[d("div",{class:"hover-btn-box",onClick:b[1]||(b[1]=St(()=>{},["stop"]))},[y(ee(Vy))])]),_:2},1024)]),d("div",cce,j(N.version_desc),1)],8,ice))),128))])]),_:1},8,["open"])])}}},pce=$e(fce,[["__scopeId","data-v-aa2afdc4"]]),hce={class:"workflow-page"},vce={class:"page-body"},gce={class:"page-left"},_ce={class:"page-container"},tg="wf_uni_identifier",mce=300*1e3,ng=60*1e3,yce=20*1e3,og="wf_autosave_leader_",ig=120*1e3,rg="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",bce={__name:"index",setup(n){const e=xg(),t=Ds(),o=t.query,i=X(t.query.robot_key),r=()=>{try{let be=localStorage.getItem(tg);return be||(be=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(tg,be)),be}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},s=()=>{try{const be=navigator.userAgent||"",Be=navigator.platform||"";let Ke="Unknown";/Windows/i.test(be)?Ke="Windows":/Macintosh|Mac OS X/i.test(be)?Ke="MacOS":/Linux/i.test(be)?Ke="Linux":/Android/i.test(be)?Ke="Android":/iPhone|iPad|iPod/i.test(be)&&(Ke="iOS");let ze="Unknown",ht="";const dt=be.match(/Edg\/([\d\.]+)/)||be.match(/Chrome\/([\d\.]+)/)||be.match(/Firefox\/([\d\.]+)/)||be.match(/Version\/([\d\.]+).*Safari/);return dt&&(be.includes("Edg/")?ze="Edge":be.includes("Chrome/")?ze="Chrome":be.includes("Firefox/")?ze="Firefox":be.includes("Safari")&&!be.includes("Chrome")&&(ze="Safari"),ht=dt[1]),`platform=${Be}; os=${Ke}; browser=${ze}/${ht}; ua=${be}`}catch{return"ua=unknown"}},a=X(null),l=X(null),u=Ts(),c=jn(),f=Xe(()=>{var be;return(be=l.value)==null?void 0:be.lfRef});Xe(()=>u.triggerList);const p=X(""),h=X(""),v=X(null),_=Xe(()=>c.robotInfo.loop_save_canvas_status);gt(_,be=>{be>0&&ne("automatic")});const m=lw(),g=X(!0),b=X(!1),C=X(!0);let D=null,T=null,O=Date.now(),k="";const S=X(""),N=X(""),L=X(""),$=X(!1),B=`${Date.now()}_${Math.random()}`;let E=null;const A=()=>`${og}${i.value}`,M=()=>`wf_open_tabs_${i.value}`;function F(){try{const be=parseInt(localStorage.getItem(M())||"0",10)||0;localStorage.setItem(M(),String(be+1))}catch(be){console.warn("incrementOpenTabs error",be)}}function H(){try{const be=parseInt(localStorage.getItem(M())||"0",10)||0,Be=Math.max(0,be-1);Be<=0?setTimeout(()=>{localStorage.removeItem(M()),localStorage.removeItem(A())},0):localStorage.setItem(M(),String(Be))}catch(be){console.warn("decrementOpenTabs error",be)}}function R(){try{const be=Date.now();for(let Be=0;Be<localStorage.length;Be++){const Ke=localStorage.key(Be);if(Ke&&Ke.startsWith(og)){const ze=localStorage.getItem(Ke);let ht=null;try{ht=ze?JSON.parse(ze):null}catch{ht=null}(!ht||typeof ht.ts!="number"||be-ht.ts>ng)&&localStorage.removeItem(Ke)}}}catch(be){console.warn("cleanupExpiredLeaderKeys error",be)}}function G(){try{const be=localStorage.getItem(A());return be?JSON.parse(be):null}catch{return null}}function oe(){localStorage.setItem(A(),JSON.stringify({tabId:B,ts:Date.now()}))}function V(){const be=G();return!be||Date.now()-be.ts>ng?(oe(),!0):be.tabId===B}function Y(){const be=G();be&&be.tabId===B&&localStorage.removeItem(A())}function Q(be){try{const Be=localStorage.getItem(be),Ke=Be?JSON.parse(Be):null;Ke&&Ke.tabId===B&&localStorage.removeItem(be)}catch{}}function ue(be){be.key===A()&&(et(),R(),$.value=V())}function te(){document.visibilityState==="visible"&&($.value=V()),R(),et()}function q(){re(),R(),$.value=V(),E=setInterval(()=>{const be=V();$.value=be,be&&localStorage.setItem(A(),JSON.stringify({tabId:B,ts:Date.now()}))},yce),window.addEventListener("storage",ue),document.addEventListener("visibilitychange",te),window.addEventListener("beforeunload",()=>{Y(),H()}),window.addEventListener("pagehide",()=>{Y(),H()})}function re(){E&&clearInterval(E),E=null,window.removeEventListener("storage",ue),document.removeEventListener("visibilitychange",te),window.removeEventListener("beforeunload",Y)}function ce(){try{const be=U();return JSON.stringify(be)}catch{return""}}function ve(){Ne(),k=ce(),O=Date.now(),T=setInterval(()=>{if(!g.value)return;const be=ce();be&&be!==k&&(k=be,O=Date.now(),ge())},2*1e3)}function Ne(){T&&clearInterval(T),T=null}function ge(){try{if(!g.value||b.value)return;(!C.value||!V())&&(oe(),C.value=!0),et()}catch{}}function _e(){st(),D=setInterval(()=>{g.value&&C.value&&Date.now()-O>=mce&&(C.value=!1,xt.warning("已超过5分钟无改动，自动保存已暂停"),et())},30*1e3)}function st(){D&&clearInterval(D),D=null}async function tt(){try{const be=await Fd({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(be==null?void 0:be.data)||{};b.value=!Be.lock_res,S.value=Be.remote_addr||"",N.value=Be.user_agent||"",L.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),et()}catch{b.value=!1,c.setIsLockedByOther(b.value)}}async function ke(){try{const be=await Fd({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(be==null?void 0:be.data)||{};return Be.lock_res?(b.value=!1,S.value="",N.value="",L.value="",c.setIsLockedByOther(b.value),!0):(b.value=!Be.lock_res,S.value=Be.remote_addr||"",N.value=Be.user_agent||"",L.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),!1)}catch{return b.value=!1,c.setIsLockedByOther(b.value),!0}}function he(be){be=be||[];let Be=[],Ke=[];be.forEach(ze=>{if(ze.node_type==0){let ht=JSON.parse(ze.node_info_json);ht.type=="custom-edge"&&(ht.pointsList=[],ht.type="custom-bezier-edge"),Ke.push(ht)}else{const ht=m[ze.node_type];ze.type=ht;let dt=JSON.parse(ze.node_info_json);ze.node_type!=0&&(dt.type=m[ze.node_type],dt.id=ze.node_key||Gi(dt.type),dt.x=dt.x||0,dt.y=dt.y||0),ze.node_type==-1&&(ze.node_params=dt.dataRaw),dt.nodeSortKey?ze.nodeSortKey=dt.nodeSortKey:ze.nodeSortKey=dt.id.substring(0,8)+dt.id.substring(dt.id.length-8),ze.dataRaw=dt.dataRaw||ze.node_params,delete ze.node_info_json,dt.loop_parent_key=ze.loop_parent_key,dt.properties=ze,dt.properties.width=dt.width,dt.properties.height=dt.height,Be.push(dt)}}),Me({nodes:Be,edges:Ke})}const De=be=>{a.value.open(be,!0)},Me=be=>{l.value.setData(be)},U=()=>{let be=l.value.getData(),Be=[],Ke={};return be.edges.forEach(ze=>{let ht={node_key:ze.id,node_name:"edge",node_type:0},dt={...ze};ht.node_info_json=dt,Be.push(ht),ze.sourceAnchorId&&(Ke[ze.sourceAnchorId]=ze.targetNodeId),ze.targetAnchorId&&(Ke[ze.targetAnchorId]=ze.sourceNodeId)}),be.nodes.forEach(ze=>{let ht={...ze.properties,node_type:+ze.properties.node_type,node_key:ze.id};ht.node_info_json={type:ze.type,x:ze.x,y:ze.y,width:ze.properties.width,height:ze.properties.height,id:ze.id,nodeSortKey:ht.nodeSortKey,dataRaw:ze.properties.node_params},ht.next_node_key=Ke[ht.nodeSortKey+"-anchor_right"]||"",ht.prev_node_key=Ke[ht.nodeSortKey+"-anchor_left"]||"";let dt=JSON.parse(ht.node_params);if(ht.node_type==1,ht.node_type==2&&dt.term&&dt.term.length>0&&dt.term.forEach((Ut,bn)=>{let En=ht.nodeSortKey+"-anchor_"+bn;Ut.next_node_key=Ke[En]||""}),ht.node_type==3&&dt.cate&&dt.cate.categorys&&dt.cate.categorys.length>0&&dt.cate.categorys.forEach((Ut,bn)=>{let En=ht.nodeSortKey+"-anchor_"+bn;Ut.next_node_key=Ke[En]||""}),ht.node_type==17){let Ut=Ke[ht.nodeSortKey+"-anchor_right_exception"];Ut&&(dt.code_run.exception=Ut)}if(ht.node_type==41){let Ut=Ke[ht.nodeSortKey+"-anchor_right_exception"];Ut&&(dt.workflow.exception=Ut)}ht.node_params=dt,delete ht.dataRaw,Be.push(ht)}),Be},ne=async be=>{if(b.value){be==="handle"&&xt.warning("当前已有其他用户在编辑中，无法保存");return}if(!g.value||!C.value&&be==="automatic")return;let Be=U();if(be==="handle"){const Ke=+c.robotInfo.draft_save_time||0,ze={robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:Ke,re_cover_save:0,uni_identifier:r(),user_agent:s()},ht=await Ie(ze,!1);ht.saved?xt.success("保存成功"):ht.behind;return}try{await dr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id);const Ke=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:Ke})}catch{}};let se=null,Ee=!1,fe=!1,Le=0;async function Ie(be,Be){var Ke,ze;try{const ht={...be,uni_identifier:r(),user_agent:s()},dt=await dr(ht);if(!(((Ke=dt==null?void 0:dt.data)==null?void 0:Ke.behind_draft)==1||(dt==null?void 0:dt.behind_draft)==1)){await c.getRobot(o.id);const bn=+c.robotInfo.draft_save_time||ho().unix();return c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:bn}),{saved:!0,behind:!1}}if(Be){const bn=Date.now();if(Ee||fe&&bn-Le<ig)return C.value=!1,et(),{saved:!1,behind:!0};Ee=!0,fe=!0,Le=bn}return await new Promise(bn=>{gn.confirm({title:"提示",icon:null,content:rg,okText:"确 定",cancelText:"取 消",async onOk(){var Hn;const En={...be,re_cover_save:1,uni_identifier:r(),user_agent:s()},qt=await dr(En);if(qt&&qt.res==0||!((Hn=qt==null?void 0:qt.data)!=null&&Hn.behind_draft)){await c.getRobot(o.id);const Mn=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Mn})}Be&&(C.value=!0,et(),Ee=!1,fe=!1,Le=Date.now()),bn({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,et(),Ee=!1,Le=Date.now()),bn({saved:!1,behind:!0})}})})}catch(ht){if(!(((ze=ht==null?void 0:ht.data)==null?void 0:ze.behind_draft)==1||(ht==null?void 0:ht.behind_draft)==1))return{saved:!1,behind:!1};if(Be){const Ut=Date.now();if(Ee||fe&&Ut-Le<ig)return C.value=!1,et(),{saved:!1,behind:!0};Ee=!0,fe=!0,Le=Ut}return await new Promise(Ut=>{gn.confirm({title:"提示",icon:null,content:rg,okText:"确 定",cancelText:"取 消",async onOk(){var qt;const bn={...be,re_cover_save:1,uni_identifier:r(),user_agent:s()},En=await dr(bn);if(En&&En.res==0||!((qt=En==null?void 0:En.data)!=null&&qt.behind_draft)){await c.getRobot(o.id);const Hn=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Hn})}Be&&(C.value=!0,et(),Ee=!1,fe=!1,Le=Date.now()),Ut({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,et(),Ee=!1,Le=Date.now()),Ut({saved:!1,behind:!0})}})})}}async function Ve(){if(b.value||!g.value||!C.value)return;const be=U(),Be=+c.robotInfo.draft_save_time||0,Ke={robot_key:i.value,data_type:1,node_list:JSON.stringify(be),draft_save_type:"automatic",draft_save_time:Be,re_cover_save:0,uni_identifier:r()};await Ie(Ke,!0)}function et(){se&&clearInterval(se),se=null,$.value=V(),g.value&&C.value&&!b.value&&V()&&(se=setInterval(()=>{Ve()},60*1e3))}qc(()=>{se&&clearInterval(se),st(),Ne(),re(),Y(),H()});const nt=X(null),We=X(!1),lt=be=>{nt.value.show(be)},de=async()=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法发布");return}let be=U(),Be=[];for(let Ke=0;Ke<be.length;Ke++){let ze=be[Ke];ze.node_type==0||ze.node_type==-1||ze.loop_parent_key||(ze.node_type==1?ze.next_node_key==""&&Be.push(ze):ze.node_type==7||ze.node_type==3?ze.prev_node_key==""&&Be.push(ze):(ze.next_node_key==""||ze.prev_node_key=="")&&Be.push(ze))}if(Be.length>0){xt.error("存在未关联的节点，请先关联");return}try{await dr({robot_key:i.value,data_type:1,node_list:JSON.stringify(be),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0}),lt(JSON.stringify(be))}catch{We.value=!1}};let pe=X(null);const xe=be=>{pe.value=be,be.properties.node_sub_type!=51&&ge()},Ce=()=>{ge()},Fe=async()=>Ew({model_type:"LLM"}).then(be=>{let Be=be.data||[],{newList:Ke}=wg(Be);c.setModelList(Ke)}),Ue=X({diy_global:[],sys_global:[]}),qe=()=>{let Be=U().filter(Ke=>Ke.node_type==1);Be.length>0&&(Ue.value=Be[0].node_params.start)},at=X(null),bt=()=>{C.value=!1,et(),at.value.showDrawer()},Xt=be=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法恢复");return}const Be=U();dr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}).then(()=>{c.getRobot(o.id).then(()=>{c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0})}),p.value="",h.value=null,he(be),xt.success("已保存当前草稿并恢复版本"),g.value=!0,C.value=!0,et()})},Ft=async(be,Be)=>{if(!b.value){const Ke=U();try{await dr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Ke),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0})}catch{}}h.value=Be,clearInterval(se),he(be)},pn=()=>{v.value.openRunTest()},vn=async()=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法编辑");return}await ke()&&(g.value=!0,C.value=!0,k=ce(),O=Date.now(),ve(),et(),xt.success("已进入编辑模式"),De(1))},Rt=be=>{be=Array.isArray(be)?be:[];let Be=[],Ke=[];if(be.forEach(ze=>{ze.node_type==21&&(ze.has_loaded===""||ze.plugin_version!==ze.remote_plugin_version?Ke.push(ze):ze.has_loaded==="false"&&Be.push(ze))}),Be.length||Ke.length){let ze=[...new Set([...Be.map(Ut=>Ut.node_name),...Ke.map(Ut=>Ut.node_name)])];const ht={"font-weight":500,"margin-top":"8px","margin-bottom":"4px"},dt={color:"#8c8c8c"};gn.confirm({title:"工作流异常修复",content:Tt("div",{},[Tt("div",{style:ht},"以下插件状态异常，是否自动安装插件并开启？"),Tt("div",{style:dt},ze.join("、"))]),onOk:async()=>{const Ut=[];Be.length&&Ut.push(gw({name:Be.map(bn=>bn.plugin_name).toString()})),Ke.length&&Ut.push(_w({download_data:JSON.stringify(Ke.map(bn=>({url:bn.latest_version_detail_url,version_id:bn.latest_version_detail_id})))})),await Promise.all(Ut),xt.success("操作完成，即将重新加载..."),setTimeout(()=>{window.location.reload()},1200)}})}},Se=async()=>{await Fe(),await u.getTriggerList(i.value),u.getTriggerOfficialMsg(i.value),await e.getAllmodelList(),u.getAllLibraryList();const be=await dg({robot_key:i.value,data_type:1});he(be.data),Rt(be.data)};return ji("handleAutoSaveDraft",async(be="automatic")=>{await ne(be)}),ut(async()=>{F(),await Se(),await tt(),b.value?(g.value=!1,C.value=!1,xt.warning("其他人在编辑，已切换为查看模式")):await ke()?(g.value=!0,C.value=!0):(g.value=!1,C.value=!1),q(),et();let be=A();gt(()=>t.query.robot_key,Be=>{!Be||Be===i.value||(Q(be),H(),i.value=Be,be=A(),F(),q(),et())}),_e(),ve(),t.query.show_tips&&xt.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)}),(be,Be)=>(w(),P("div",hce,[y(zde,{ref_key:"pageHeaderRef",ref:v,onEdit:vn,onSave:ne,onRelease:de,onGetGlobal:qe,onGetVersionRecord:bt,lf:f.value,currentVersion:h.value,start_node_params:Ue.value,saveLoading:We.value,isEditing:g.value,isLockedByOther:b.value,lockRemoteAddr:S.value,lockUserAgent:N.value,loginUserName:L.value,autoSaveEnabled:C.value,isLeader:$.value},null,8,["lf","currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),d("div",vce,[d("div",gce,[y(Rw)]),d("div",_ce,[y(nde,{ref_key:"workflowCanvasRef",ref:l,onSelectedNode:xe,onOnDeleteNode:Ce,onRunTest:pn},null,512)])]),y(kw,{ref_key:"addRobotAlertRef",ref:a},null,512),y(Zde,{ref_key:"versionModelRef",ref:nt},null,512),y(pce,{ref_key:"publishDetailRef",ref:at,onPreview:Ft,onSetVersion:Xt,isLockedByOther:b.value},null,8,["isLockedByOther"])]))}},Spe=$e(bce,[["__scopeId","data-v-4daae0fa"]]);export{Spe as default};
