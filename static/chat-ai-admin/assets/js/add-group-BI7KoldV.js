import{h as re}from"./index-UUVUVnDU.js";import{c as ne,l as le,y as se,z as ue}from"./index-BOvAmdHY.js";import{f as v,w as ie,Y as S,_ as p,k as _,a2 as d,a6 as z,a1 as k,a5 as y,u as L,r as V,e as D,o as pe,ae as N,a4 as T,a9 as de,G as _e,a7 as ve,F as ce,l as me,aa as fe,ab as be}from"./vue-chunks-Ci-XTWEs.js";import{b as G,w as ge,x as ye}from"../../index-BZRrEp3V.js";import{F as $,$ as we,z as he,o as ke,M as B,a as R,e as xe,I as H,u as Le,v as Ae,Q as Ce,b8 as Ie}from"./ui-antd-BWf8LxGy.js";import{u as Re}from"./robot-ChheCicf.js";const Oe={class:"avatar-uploader"},Ue=["src"],Fe={key:1},Me=["src"],Te={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(O,{emit:U}){function A(t){return new Promise((g,I)=>{const u=new FileReader;u.readAsDataURL(t),u.onload=()=>g(u.result),u.onerror=M=>I(M)})}const c=U,m=O,s=v([]),i=v(!1),w=v("");ie(()=>m.value,t=>{w.value=t},{immediate:!0});const F=$.useInjectFormItemContext(),a=()=>{let t={imageUrl:w.value,file:s.value[0].originFileObj};c("change",t),c("update:value",t.imageUrl),F.onFieldChange()},l=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(s.value=[t],A(t).then(u=>{w.value=u,i.value=!1,a()}),!1):(R.error("机器人头像图片大小不能超过100kb"),!1):(R.error("机器人头像只支持JPG、PNG格式的图片"),!1),f=v(!1),x=v(""),e=v(""),P=()=>{f.value=!1,e.value=""},C=async t=>{!t.url&&!t.preview&&(t.preview=await A(t.originFileObj)),x.value=t.url||t.preview,f.value=!0,e.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,g)=>{const I=ke,u=B;return p(),S("div",Oe,[_(I,{"file-list":s.value,"onUpdate:fileList":g[0]||(g[0]=M=>s.value=M),"list-type":m.listType,"show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:C,style:z(m.style)},{default:d(()=>[O.value?(p(),S("img",{key:0,class:"avatar",style:z(m.style),src:O.value,alt:"avatar"},null,12,Ue)):(p(),S("div",Fe,[i.value?(p(),k(L(we),{key:0})):(p(),k(L(he),{key:1})),g[1]||(g[1]=y("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),_(u,{open:f.value,title:e.value,footer:null,onCancel:P},{default:d(()=>[y("img",{alt:"example",style:{width:"100%"},src:x.value},null,8,Me)]),_:1},8,["open","title"])])}}},E=G(Te,[["__scopeId","data-v-34012a20"]]),Se={class:"form-box"},Be={class:"robot-avatar-box"},Pe={__name:"add-robot-alert",emits:["addRobot","editRobot","ok"],setup(O,{expose:U,emit:A}){const c=Re(),m=A;let s="";const i=be(),w=fe(),F=$.useForm,a=v(!1),l=v(!1),f=v(!1),x=v([]),e=V({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),P=D(()=>e.application_type==0?a.value?"编辑机器人基本信息":"新建聊天机器人":a.value?"编辑工作流基本信息":"新建工作流"),C=D(()=>c.robotInfo),{getRobot:t}=c,g=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:I,validateInfos:u,clearValidate:M}=F(e,g),j=r=>{e.robot_avatar=r.file},W=()=>{let r={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||s,group_id:e.group_id||"0"};f.value=!0;let o=le,b="机器人创建成功";a.value&&(o=se,r.id=i.query.id,b="机器人编辑成功",r.robot_avatar==s&&delete r.robot_avatar),o(r,e.application_type).then(h=>{if(f.value=!1,h.res!=0)return R.error(h.msg);if(R.success(b),!a.value&&i.query.robot_key){m("addRobot"),l.value=!1;return}a.value?(t(i.query.id),m("editRobot"),l.value=!1):e.application_type==0?w.push("/robot/config/basic-config?id="+h.data.id+"&robot_key="+h.data.robot_key):(window.open("/#/robot/config/workflow?id="+h.data.id+"&robot_key="+h.data.robot_key+"&show_tips=1"),l.value=!1,m("ok"))}).catch(()=>{f.value=!1})},J=async()=>{let r=await re({model_type:"LLM"});return!r||r.data.length==0?(B.confirm({title:"请先添加LLM模型服务商?",icon:me(Ie,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){w.push("/user/model")},onCancel(){}}),!1):!0},K=async(r,o)=>{r==0?s=ge:s=ye,a.value=o;let b=await J();Q(),b&&(e.robot_avatar="",e.robot_avatar_url=s,e.robot_name="",e.robot_intro="",e.application_type=r,l.value=!0,a.value&&C.value&&(e.robot_name=C.value.robot_name,e.robot_intro=C.value.robot_intro,e.robot_avatar_url=C.value.robot_avatar_url))},Z=r=>{e.group_id=r||"0"},Q=()=>{ne().then(r=>{x.value=r.data||[]})},Y=()=>{M()},X=()=>{I().then(()=>{W()}).catch(r=>{})};return pe(()=>{}),U({open:K,setGroupId:Z}),(r,o)=>{const b=xe,h=H,ee=Ae,te=Le,q=Ce,oe=$,ae=B;return p(),k(ae,{width:a.value?"472px":"746px",open:l.value,"onUpdate:open":o[6]||(o[6]=n=>l.value=n),confirmLoading:f.value,title:P.value,onOk:X,onCancel:Y},{default:d(()=>[y("div",Se,[_(oe,{layout:"vertical"},{default:d(()=>[a.value?(p(),k(b,T({key:0,ref:"name",label:""},L(u).robot_avatar_url),{default:d(()=>[y("div",Be,[_(E,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":o[0]||(o[0]=n=>e.robot_avatar_url=n),onChange:j},null,8,["value"]),o[7]||(o[7]=y("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):N("",!0),_(b,T({ref:"name",label:"应用名称"},L(u).robot_name),{default:d(()=>[_(h,{value:e.robot_name,"onUpdate:value":o[1]||(o[1]=n=>e.robot_name=n),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),_(b,T({ref:"group_id",label:"分组"},L(u).group_id),{default:d(()=>[_(te,{value:e.group_id,"onUpdate:value":o[2]||(o[2]=n=>e.group_id=n),style:{width:"100%"},placeholder:"请选择分组"},{default:d(()=>[(p(!0),S(ce,null,de(x.value,n=>(p(),k(ee,{value:n.id},{default:d(()=>[_e(ve(n.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},16),_(b,T({label:"简介"},L(u).robot_intro),{default:d(()=>[a.value?(p(),k(q,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":o[4]||(o[4]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(p(),k(q,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":o[3]||(o[3]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),a.value?N("",!0):(p(),k(b,T({key:1,ref:"name",label:"机器人头像"},L(u).robot_avatar_url),{default:d(()=>[_(E,{value:e.robot_avatar_url,"onUpdate:value":o[5]||(o[5]=n=>e.robot_avatar_url=n),onChange:j},null,8,["value"]),o[8]||(o[8]=y("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1,__:[8]},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},He=G(Pe,[["__scopeId","data-v-79fe1814"]]),Ve={class:"form-item"},$e={class:"form-content"},Ge={__name:"add-group",emits:["ok"],setup(O,{expose:U,emit:A}){const c=v(!1),m=A,s=v("新建分组"),i=V({group_name:"",id:""}),w=a=>{i.group_name=a.group_name||"",i.id=a.id||"",s.value=a.id?"编辑分组":"新建分组",c.value=!0},F=()=>{if(!i.group_name)return R.error("请输入分组名称");ue({...i}).then(a=>{R.success(`${s.value}成功`),c.value=!1,m("ok")})};return U({show:w}),(a,l)=>{const f=H,x=B;return p(),S("div",null,[_(x,{open:c.value,"onUpdate:open":l[1]||(l[1]=e=>c.value=e),title:s.value,onOk:F,zIndex:2e3},{default:d(()=>[y("div",Ve,[l[2]||(l[2]=y("div",{class:"form-label"},"分组名称：",-1)),y("div",$e,[_(f,{maxLength:15,value:i.group_name,"onUpdate:value":l[0]||(l[0]=e=>i.group_name=e),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},We=G(Ge,[["__scopeId","data-v-0d119043"]]);export{E as A,He as a,We as b};
