import{_ as ye}from"./cu-scroll-5W3_kglT.js";import{b as oe,e as Ne,bi as Le,bb as Oe,d as Se,ar as Me,bq as W,aU as Ae,h as De,bg as Te}from"../../index-CPkdGIiL.js";import{e as ge,ab as le,aa as be,r as ae,f as k,af as Ve,a1 as v,_ as i,a2 as l,a5 as _,k as a,ae as s,n as ce,Y as m,a4 as Z,u as h,G as d,F as I,ad as M,a7 as pe,A as me,y as je,l as xe}from"./vue-chunks-Ci-XTWEs.js";import{A as Ee}from"./avatar-input-DUNM9Pzu.js";import{M as fe}from"./model-select-CiMSoZvM.js";import{O as Pe}from"./open-grapg-modal-ydgy9TQ7.js";import{C as Re}from"./index-DEDImu82.js";import{F as he,e as Fe,I as Ke,Q as Ge,u as Je,v as Qe,X as Ye,p as Xe,ab as A,E as He,O as We,q as Ze,R as et,a as J,M as ne,ac as tt,B as at,z as nt,y as ot,V as lt,U as ke,a8 as _t,g as it,h as ee,a9 as st,aa as ut,H as ve,Y as rt,Z as dt}from"./ui-antd-Bw8cEW5z.js";import{i as ct,e as pt,f as mt}from"./index-CgXFvif9.js";import{A as ft}from"./add-collaborator-yv3VkKUH.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-ChQO-_r6.js";import"./index-BxiNNyyE.js";const ht={class:"add-library-page"},kt={class:"form-box"};const vt={class:"indexing-methods-box"},yt={class:"list-title-block"},gt={class:"list-title-block"},bt={class:"select-card-box"},xt={class:"card-title"},Ct={class:"card-title"},wt={class:"card-title"},zt={class:"card-title"},te="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",$t={__name:"knowledge-config",setup(_e){const q=Ne(),N=ge(()=>{var n;return((n=q.companyInfo)==null?void 0:n.neo4j_status)=="true"}),x=le(),y=be(),C=x.query,b=Le,e=ae({library_name:"",library_intro:"",use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",avatar:b,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,normal_chunk_default_not_merged_text:"false",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:te,qa_index_type:1,group_id:0,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512,sync_official_history_type:2,enable_cron_sync_official_content:!0,app_id_list:""}),B=k(""),D=k(0),w=k({}),Q=n=>{e.use_model=j.includes(n.rawData.model_define)&&n.rawData.deployment_name?n.rawData.deployment_name:n.rawData.name,e.use_model_icon=n.icon,e.use_model_name=n.use_model_name,e.model_config_id=n.rawData.id,B.value=n.rawData.model_define,r()},L=k([]);Oe().then(n=>{L.value=n.data.map(t=>({label:t.name,value:t.no}))});const f=k(!0),c=k(!1);(()=>{Me({id:C.id}).then(n=>{w.value=n.data,D.value=w.value.is_offline?2:1,e.library_name=n.data.library_name,e.qa_index_type=n.data.qa_index_type,e.library_intro=n.data.library_intro,e.use_model=n.data.use_model,e.is_offline=n.data.is_offline,e.group_id=n.data.group_id,e.model_config_id=n.data.model_config_id,e.avatar=n.data.avatar?n.data.avatar:b,e.avatar_file=n.data.avatar_file?n.data.avatar_file:"",e.graph_switch=n.data.graph_switch!="0",e.graph_model_config_id=n.data.graph_model_config_id>0?n.data.graph_model_config_id:void 0,e.graph_use_model=n.data.graph_use_model,e.chunk_type=+n.data.chunk_type,e.normal_chunk_default_separators_no=W(n.data.normal_chunk_default_separators_no,[12,11]),e.normal_chunk_default_chunk_size=n.data.normal_chunk_default_chunk_size,e.normal_chunk_default_not_merged_text=n.data.normal_chunk_default_not_merged_text,e.normal_chunk_default_chunk_overlap=n.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=n.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=n.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=n.data.semantic_chunk_default_threshold,e.ai_chunk_size=n.data.ai_chunk_size||5e3,e.ai_chunk_model=n.data.ai_chunk_model,e.ai_chunk_model_config_id=n.data.ai_chunk_model_config_id,e.ai_chunk_prumpt=n.data.ai_chunk_prumpt||te,e.father_chunk_paragraph_type=+n.data.father_chunk_paragraph_type||2,e.father_chunk_separators_no=W(n.data.father_chunk_separators_no,[12,11]),e.father_chunk_chunk_size=+n.data.father_chunk_chunk_size||1024,e.son_chunk_separators_no=W(n.data.son_chunk_separators_no,[8,10]),e.son_chunk_chunk_size=+n.data.son_chunk_chunk_size||512,e.sync_official_history_type=Number(n.data.sync_official_history_type),e.enable_cron_sync_official_content=n.data.enable_cron_sync_official_content==="true",e.app_id_list=n.data.official_app_id||"",c.value=n.data.type==3,f.value=n.data.type==2})})();const P=k([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),R=he.useForm,Y=ae({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:T}=R(e,Y),V=n=>{e.avatar=n.imageUrl,e.avatar_file=n.file,r()},p=()=>!1,j=["azure","ollama","xinference","openaiAgent"],Ce=["azure"],ie=()=>{r()},O=k([]),X=n=>{O.value=n,je(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&we()})},we=()=>{if(O.value.length>0){let n=null,t=null;for(let z of O.value)if(z.model_define==="tongyi"){n=z;for(let u of n.children)if(u.name==="qwen-max"){t=u;break}break}n||(n=O.value[0],t=n.children[0]),n&&t&&(e.ai_chunk_model=t.name,e.ai_chunk_model_config_id=t.model_config_id)}},se=k(null),ze=n=>{if(n){e.graph_switch=!1;let t={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&O.value.length>0){let z=O.value[0];if(z){let u=z.children[0];t.graph_use_model=u.name,t.graph_model_config_id=u.model_config_id}}se.value.show(t)}else e.graph_switch=!1,r()},F=n=>{e.chunk_type=n,r()},$e=n=>{n.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=n.graph_model_config_id,e.graph_use_model=n.graph_use_model,r(()=>{ne.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:xe(tt,{style:{color:"#52c41a"}}),onOk:()=>y.push({path:"/library/details/knowledge-document",query:{id:C.id}})})}))},r=(n=null)=>{if(!e.library_name)return J.error("请输入知识库名称");let t={library_name:e.library_name,qa_index_type:e.qa_index_type,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:JSON.stringify(e.normal_chunk_default_separators_no),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,normal_chunk_default_not_merged_text:e.normal_chunk_default_not_merged_text,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,ai_chunk_size:e.ai_chunk_size,ai_chunk_model:e.ai_chunk_model,ai_chunk_model_config_id:e.ai_chunk_model_config_id,ai_chunk_prumpt:e.ai_chunk_prumpt,father_chunk_paragraph_type:e.father_chunk_paragraph_type,father_chunk_separators_no:JSON.stringify(e.father_chunk_separators_no),father_chunk_chunk_size:e.father_chunk_chunk_size,son_chunk_separators_no:JSON.stringify(e.son_chunk_separators_no),son_chunk_chunk_size:e.son_chunk_chunk_size,group_id:e.group_id,app_id_list:e.app_id_list,sync_official_history_type:e.sync_official_history_type,enable_cron_sync_official_content:Number(e.enable_cron_sync_official_content),id:x.query.id};Ce.indexOf(B.value)>-1&&(t.use_model="默认"),e.avatar_file&&(t.avatar=e.avatar_file),Ae(t).then(z=>{typeof n=="function"?n():J.success("修改成功")})},ue=n=>{n!=e.qa_index_type&&(e.qa_index_type=n,r())};return(n,t)=>{const z=Ke,u=Fe,re=Ge,K=Qe,G=Je,S=Xe,H=Ye,Ie=Ve("temmplate"),g=Se,$=We,U=He,de=et,qe=Ze,Be=he,Ue=ye;return i(),v(Ue,null,{default:l(()=>[_("div",ht,[_("div",kt,[a(Be,{"label-col":{span:6}},{default:l(()=>[a(u,Z({ref:"name",label:"知识库名称"},h(T).library_name),{default:l(()=>[a(z,{onBlur:r,value:e.library_name,"onUpdate:value":t[0]||(t[0]=o=>e.library_name=o),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),a(u,{label:"知识库简介"},{default:l(()=>[a(re,{onBlur:r,value:e.library_intro,"onUpdate:value":t[1]||(t[1]=o=>e.library_intro=o),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),a(u,Z({ref:"name",label:"知识库封面"},h(T).avatar),{default:l(()=>[a(Ee,{value:e.avatar,"onUpdate:value":t[2]||(t[2]=o=>e.avatar=o),onChange:V},null,8,["value"]),t[30]||(t[30]=_("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[30]},16),c.value?(i(),v(Ie,{key:0},{default:l(()=>[a(u,{label:"历史发布获取时间"},{default:l(()=>[a(G,{value:e.sync_official_history_type,"onUpdate:value":t[3]||(t[3]=o=>e.sync_official_history_type=o),onChange:r},{default:l(()=>[a(K,{value:10},{default:l(()=>t[31]||(t[31]=[d("全部")])),_:1,__:[31]}),a(K,{value:1},{default:l(()=>t[32]||(t[32]=[d("半年内")])),_:1,__:[32]}),a(K,{value:2},{default:l(()=>t[33]||(t[33]=[d("一年内")])),_:1,__:[33]}),a(K,{value:3},{default:l(()=>t[34]||(t[34]=[d("三年以内")])),_:1,__:[34]})]),_:1},8,["value"])]),_:1}),a(u,null,{label:l(()=>[a(S,{title:"每天3:00获取最新发布内容"},{default:l(()=>[t[35]||(t[35]=d(" 每天获取最新发布 ")),a(h(A),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1,__:[35]})]),default:l(()=>[a(H,{checked:e.enable_cron_sync_official_content,"onUpdate:checked":t[4]||(t[4]=o=>e.enable_cron_sync_official_content=o),onChange:r,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1})):s("",!0),a(u,Z({label:"嵌入模型"},h(T).use_model),{default:l(()=>[s("",!0),a(Re,{modelValue:e.use_model,"onUpdate:modelValue":t[5]||(t[5]=o=>e.use_model=o),"label-key":"use_model_name","value-key":"value",modelType:"TEXT EMBEDDING","model-config-id":e.model_config_id,onChange:Q,onLoaded:X},null,8,["modelValue","model-config-id"])]),_:1},16),ce(a(u,{label:"生成知识图谱"},{default:l(()=>[a(H,{onChange:ze,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t[36]||(t[36]=_("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1))]),_:1,__:[36]},512),[[me,N.value]]),ce(a(u,{label:"知识图谱模型"},{default:l(()=>[a(fe,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":t[6]||(t[6]=o=>e.graph_use_model=o),modeId:e.graph_model_config_id,"onUpdate:modeId":t[7]||(t[7]=o=>e.graph_model_config_id=o),style:{width:"300px"},onChange:ie,onLoaded:X},null,8,["modeName","modeId"])]),_:1},512),[[me,e.graph_switch&&N.value]]),f.value?(i(),v(u,{key:1,label:"索引方式"},{default:l(()=>[_("div",vt,[_("div",{class:M(["list-item",{active:e.qa_index_type==1}]),onClick:t[8]||(t[8]=o=>ue(1))},[a(g,{class:"check-icon",name:"check-arrow-filled"}),_("div",yt,[a(g,{name:"file-search"}),t[37]||(t[37]=d(" 问题与答案一起生成索引 "))]),t[38]||(t[38]=_("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),_("div",{class:M(["list-item",{active:e.qa_index_type==2}]),onClick:t[9]||(t[9]=o=>ue(2))},[a(g,{class:"check-icon",name:"check-arrow-filled"}),_("div",gt,[a(g,{name:"comment-search"}),t[39]||(t[39]=d(" 仅对问题生成索引 "))]),t[40]||(t[40]=_("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2)])]),_:1})):s("",!0),f.value?s("",!0):(i(),m(I,{key:2},[a(u,{label:"分段方式",required:""},{default:l(()=>[t[49]||(t[49]=_("div",{class:"form-alert-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),_("div",bt,[_("div",{class:M(["select-card-item",{active:e.chunk_type==1}]),onClick:t[10]||(t[10]=o=>F(1))},[a(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",xt,[a(g,{name:"ordinary-segmentation",class:"title-icon"}),t[41]||(t[41]=d(" 普通分段 "))]),t[42]||(t[42]=_("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),_("div",{class:M(["select-card-item",{active:e.chunk_type==2}]),onClick:t[11]||(t[11]=o=>F(2))},[a(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",Ct,[a(g,{name:"semantic-segmentation",class:"title-icon"}),t[43]||(t[43]=d(" 语义分段 "))]),t[44]||(t[44]=_("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),f.value?s("",!0):(i(),m("div",{key:0,class:M(["select-card-item",{active:e.chunk_type==4}]),onClick:t[12]||(t[12]=o=>F(4))},[a(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",wt,[a(g,{name:"semantic-segmentation",class:"title-icon"}),t[45]||(t[45]=d(" 父子分段 "))]),t[46]||(t[46]=_("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2)),_("div",{class:M(["select-card-item",{active:e.chunk_type==3}]),onClick:t[13]||(t[13]=o=>F(3))},[a(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",zt,[a(g,{name:"semantic-segmentation",class:"title-icon"}),t[47]||(t[47]=d(" AI分段 "))]),t[48]||(t[48]=_("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])]),_:1,__:[49]}),e.chunk_type==1?(i(),m(I,{key:0},[a(u,{label:"分段标识符",required:""},{default:l(()=>[a(G,{onChange:r,value:e.normal_chunk_default_separators_no,"onUpdate:value":t[14]||(t[14]=o=>e.normal_chunk_default_separators_no=o),mode:"tags",style:{width:"100%"},placeholder:"请选择分段标识符",options:L.value},null,8,["value","options"])]),_:1}),a(u,{label:"分段最大长度",required:""},{default:l(()=>[a(U,{gap:8,align:"center"},{default:l(()=>[a($,{onBlur:r,value:e.normal_chunk_default_chunk_size,"onUpdate:value":t[15]||(t[15]=o=>e.normal_chunk_default_chunk_size=o),style:{width:"220px"},precision:0,min:1,max:1e4},null,8,["value"]),t[50]||(t[50]=d(" 字符 "))]),_:1,__:[50]})]),_:1}),a(u,{label:"分段重叠长度"},{default:l(()=>[a(U,{gap:8,align:"center"},{default:l(()=>[a($,{onBlur:r,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":t[16]||(t[16]=o=>e.normal_chunk_default_chunk_overlap=o),style:{width:"220px"},precision:0,min:1,max:5e3},null,8,["value"]),t[51]||(t[51]=d(" 字符 "))]),_:1,__:[51]})]),_:1}),a(u,null,{label:l(()=>[t[52]||(t[52]=d(" 自动合并较小分段 ")),a(S,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:l(()=>[a(h(A))]),_:1})]),default:l(()=>[a(H,{onChange:r,checkedValue:"false",unCheckedValue:"true",checked:e.normal_chunk_default_not_merged_text,"onUpdate:checked":t[17]||(t[17]=o=>e.normal_chunk_default_not_merged_text=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})],64)):s("",!0),e.chunk_type==2?(i(),m(I,{key:1},[e.chunk_type==2?(i(),v(u,{key:0,required:""},{label:l(()=>[t[54]||(t[54]=d(" 分段阈值 ")),a(S,null,{title:l(()=>t[53]||(t[53]=[d("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")])),default:l(()=>[a(h(A),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[a($,{onBlur:r,value:e.semantic_chunk_default_threshold,"onUpdate:value":t[18]||(t[18]=o=>e.semantic_chunk_default_threshold=o),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):s("",!0),a(u,{label:"分段最大长度",required:""},{default:l(()=>[a(U,{gap:8,align:"center"},{default:l(()=>[a($,{onBlur:r,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":t[19]||(t[19]=o=>e.semantic_chunk_default_chunk_size=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),t[55]||(t[55]=d(" 字符 "))]),_:1,__:[55]})]),_:1}),a(u,{label:"分段重叠长度"},{default:l(()=>[a(U,{gap:8,align:"center"},{default:l(()=>[a($,{onBlur:r,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":t[20]||(t[20]=o=>e.semantic_chunk_default_chunk_overlap=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),t[56]||(t[56]=d(" 字符 "))]),_:1,__:[56]})]),_:1})],64)):s("",!0),e.chunk_type==3?(i(),m(I,{key:2},[e.chunk_type==3?(i(),v(u,{key:0,required:""},{label:l(()=>t[57]||(t[57]=[d(" AI大模型 ")])),default:l(()=>[a(fe,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":t[21]||(t[21]=o=>e.ai_chunk_model=o),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":t[22]||(t[22]=o=>e.ai_chunk_model_config_id=o),style:{width:"300px"},onChange:ie,onLoaded:X},null,8,["modeName","modeId"])]),_:1})):s("",!0),a(u,{label:"提示词设置",required:""},{default:l(()=>[a(U,{gap:8,align:"center"},{default:l(()=>[a(re,{onBlur:r,maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":t[23]||(t[23]=o=>e.ai_chunk_prumpt=o),placeholder:te},null,8,["value"])]),_:1})]),_:1}),a(u,null,{label:l(()=>[t[59]||(t[59]=d(" 单次最大字符数 ")),a(S,null,{title:l(()=>t[58]||(t[58]=[d("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")])),default:l(()=>[a(h(A),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[a($,{onBlur:r,class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":t[24]||(t[24]=o=>e.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[60]||(t[60]=d(" 字符 "))]),_:1,__:[60]})],64)):s("",!0),e.chunk_type==4&&!f.value?(i(),m(I,{key:3},[t[65]||(t[65]=_("div",{class:"main-title-block"},"父块（用作上下文）",-1)),a(u,{label:"分段类型"},{default:l(()=>[a(qe,{onChange:r,value:e.father_chunk_paragraph_type,"onUpdate:value":t[25]||(t[25]=o=>e.father_chunk_paragraph_type=o)},{default:l(()=>[a(de,{value:1},{default:l(()=>[t[61]||(t[61]=d("全文 ")),a(S,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:l(()=>[a(h(A))]),_:1})]),_:1,__:[61]}),a(de,{value:2},{default:l(()=>[t[62]||(t[62]=d("段落 ")),a(S,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:l(()=>[a(h(A))]),_:1})]),_:1,__:[62]})]),_:1},8,["value"])]),_:1}),e.father_chunk_paragraph_type==2?(i(),v(u,{key:0,label:"分段标识符"},{default:l(()=>[a(G,{placeholder:"请选择",onChange:r,style:{width:"100%"},mode:"tags",options:L.value,value:e.father_chunk_separators_no,"onUpdate:value":t[26]||(t[26]=o=>e.father_chunk_separators_no=o)},null,8,["options","value"])]),_:1})):s("",!0),e.father_chunk_paragraph_type==2?(i(),v(u,{key:1,label:"分段最大长度"},{default:l(()=>[a(U,{align:"center",gap:8},{default:l(()=>[a($,{style:{flex:"1"},onBlur:r,value:e.father_chunk_chunk_size,"onUpdate:value":t[27]||(t[27]=o=>e.father_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[63]||(t[63]=_("span",{class:"unit-text"},"字符",-1))]),_:1,__:[63]})]),_:1})):s("",!0),t[66]||(t[66]=_("div",{class:"main-title-block"},"子块（用于检索）",-1)),a(u,{label:"分段标识符"},{default:l(()=>[a(G,{placeholder:"请选择",onChange:r,style:{width:"100%"},mode:"tags",options:L.value,value:e.son_chunk_separators_no,"onUpdate:value":t[28]||(t[28]=o=>e.son_chunk_separators_no=o)},null,8,["options","value"])]),_:1}),a(u,{label:"分段最大长度"},{default:l(()=>[a(U,{align:"center",gap:8},{default:l(()=>[a($,{style:{flex:"1"},onBlur:r,value:e.son_chunk_chunk_size,"onUpdate:value":t[29]||(t[29]=o=>e.son_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),t[64]||(t[64]=_("span",{class:"unit-text"},"字符",-1))]),_:1,__:[64]})]),_:1})],64)):s("",!0)],64))]),_:1})]),a(Pe,{onOk:$e,ref_key:"openGrapgModalRef",ref:se},null,512)])]),_:1})}}},It=oe($t,[["__scopeId","data-v-0bbba0cd"]]),qt={class:"content-box"},Bt={key:0,class:"add-btn-block"},Ut={class:"list-content"},Nt={key:0,class:"user-block"},Lt={class:"name-box"},Ot={class:"name"},St={class:"remark-text"},Mt={key:0,class:"hover-btn-box"},At={key:0},Dt={key:1},Tt={key:2},Vt={key:1,class:"hover-btn-box"},jt={class:"role-menu-box"},Et=["onClick"],Pt={class:"menu-header"},Rt={key:0,class:"check-box"},Ft=["onClick"],Kt={class:"menu-header"},Gt={key:0,class:"check-box"},Jt=["onClick"],Qt={class:"menu-header"},Yt={key:0,class:"check-box"},Xt={class:"hover-btn-box"},Ht={key:0},Wt={key:1},Zt={key:2},ea=["onClick"],ta={__name:"role-permission",setup(_e){const q=le().query,N=De(),x=ge(()=>N.user_name),y=k(Te(q.id)),C=k([]),b=ae({object_id:q.id,object_type:2}),e=()=>{ct({...b}).then(f=>{let c=f.data||[];C.value=c})};e();const B=k(null),D=()=>{B.value.show(C.value,[{object_id:+q.id,object_type:2,operate_rights:4}])},w=(f,c)=>{let E=c==4?"管理":c==2?"编辑":"查看";ne.confirm({title:"提示?",icon:a(ve),content:"确认修改该协作者权限为【"+E+"】",okText:"确认",cancelText:"取消",onOk:()=>{let P=[{object_id:+f.object_id,object_type:+f.object_type,operate_rights:+c}];pt({identity_ids:f.identity_id,identity_type:f.identity_type,object_array:JSON.stringify(P)}).then(R=>{J.success("修改成功"),e()})},onCancel(){}})},Q=f=>{ne.confirm({title:"提示?",icon:a(ve),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{mt({identity_id:f.identity_id,identity_type:f.identity_type,object_id:f.object_id,object_type:f.object_type}).then(c=>{J.success("删除成功"),e()})},onCancel(){}})},L=k([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(f,c)=>{const E=at,P=lt,R=_t,Y=ot,T=ye;return i(),v(T,null,{default:l(()=>[_("div",qt,[y.value==4?(i(),m("div",Bt,[a(E,{type:"primary",onClick:D,icon:xe(h(nt))},{default:l(()=>c[0]||(c[0]=[d("添加协助者")])),_:1,__:[0]},8,["icon"])])):s("",!0),_("div",Ut,[a(Y,{columns:L.value,"data-source":C.value,pagination:!1},{bodyCell:l(({column:V,record:p})=>[V.key==="name"?(i(),m("div",Nt,[a(P,{shape:"square",src:p.avatar,size:40},{icon:l(()=>[p.avatar?s("",!0):(i(),v(h(ke),{key:0}))]),_:2},1032,["src"]),_("div",Lt,[_("div",Ot,pe(p.user_name),1),_("div",St,pe(p.name),1)])])):s("",!0),V.key==="operate_rights"?(i(),m(I,{key:1},[y.value==2||p.user_name==x.value?(i(),m("div",Mt,[p.operate_rights==4?(i(),m("span",At,"管理")):s("",!0),p.operate_rights==2?(i(),m("span",Dt,"编辑")):s("",!0),p.operate_rights==1?(i(),m("span",Tt,"查看")):s("",!0)])):p.role_type==1||p.is_creator==1?(i(),m("div",Vt,"管理")):(i(),v(R,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[_("div",jt,[_("div",{class:"role-menu",onClick:j=>w(p,4)},[_("div",Pt,[a(h(ke)),c[1]||(c[1]=_("span",{class:"title"},"管理",-1))]),c[2]||(c[2]=_("div",{class:"desc"},"可编辑，可删除，可查看",-1)),p.operate_rights==4?(i(),m("div",Rt,[a(h(ee))])):s("",!0)],8,Et),_("div",{class:"role-menu",onClick:j=>w(p,2)},[_("div",Kt,[a(h(st)),c[3]||(c[3]=_("span",{class:"title"},"编辑",-1))]),c[4]||(c[4]=_("div",{class:"desc"},"可编辑，可查看",-1)),p.operate_rights==2?(i(),m("div",Gt,[a(h(ee))])):s("",!0)],8,Ft),_("div",{class:"role-menu",onClick:j=>w(p,1)},[_("div",Qt,[a(h(ut)),c[5]||(c[5]=_("span",{class:"title"},"查看",-1))]),c[6]||(c[6]=_("div",{class:"desc"},"仅查看",-1)),p.operate_rights==1?(i(),m("div",Yt,[a(h(ee))])):s("",!0)],8,Jt)])]),default:l(()=>[_("div",Xt,[p.operate_rights==4?(i(),m("span",Ht,"管理")):s("",!0),p.operate_rights==2?(i(),m("span",Wt,"编辑")):s("",!0),p.operate_rights==1?(i(),m("span",Zt,"查看")):s("",!0),a(h(it))])]),_:2},1024))],64)):s("",!0),V.key==="action"?(i(),m(I,{key:2},[y.value==4&&p.user_name!=x.value?(i(),m(I,{key:0},[p.role_type!=1&&p.is_creator!=1?(i(),m("a",{key:0,onClick:j=>Q(p)},"移除",8,ea)):s("",!0)],64)):s("",!0)],64)):s("",!0)]),_:1},8,["columns","data-source"])])]),a(ft,{onOk:e,ref_key:"addCollaboratorRef",ref:B},null,512)]),_:1})}}},aa=oe(ta,[["__scopeId","data-v-98bbc904"]]),na={class:"page-container-box"},oa={class:"content-box"},la={__name:"index",setup(_e){const q=le(),N=be(),x=q.query,y=k(+x.activeKey||1),C=()=>{let b={...x};y.value>1?b.activeKey=y.value:delete b.activeKey,N.push({query:{...b}})};return(b,e)=>{const B=dt,D=rt;return i(),m("div",na,[a(D,{activeKey:y.value,"onUpdate:activeKey":e[0]||(e[0]=w=>y.value=w),onChange:C},{default:l(()=>[(i(),v(B,{key:1,tab:"知识库配置"})),s("",!0)]),_:1},8,["activeKey"]),_("div",oa,[y.value==1?(i(),v(It,{key:0})):s("",!0),y.value==2?(i(),v(aa,{key:1})):s("",!0)])])}}},xa=oe(la,[["__scopeId","data-v-03720dfe"]]);export{xa as default};
