import{s as L,r as N}from"./index-BuURB1pl.js";import{u as B,d as G}from"../../index-DSFcP5NQ.js";import{_ as D}from"./emoji-mart-BBMRoEa3.js";import{m as P,F as V,c as $,I as z,M as A,b as E}from"./ui-antd-Dl1wwwCD.js";import{r as c,E as Q,e as I,b as x,t as h,y as f,u as s,p as C,v as U,a as j,F as H,l as K,q as J,j as R}from"./vue-chunks-BdaA73Wf.js";const W={class:"tip-desc"},X={class:"tip-desc"},Y={__name:"feishu-config-modal",emits:["change"],setup(F,{expose:O,emit:S}){const{t:e}=B("views.explore.plugins.components.feishu-config-modal"),q=S,o=c({}),g=c(!1),v=c(!1),n=Q({});function y(_={}){o.value=_,Object.assign(n,{name:"",appid:"",app_secret:"",is_default:!1}),(!o.value||!Object.keys(o.value).length)&&(n.is_default=!0),g.value=!0}function l(){try{if(v.value=!0,!n.name)throw e("msg_input_credential_name");if(o.value[n.name])throw e("msg_credential_name_exists");if(!n.appid)throw e("msg_input_app_id");if(!n.app_secret)throw e("msg_input_app_secret");L({name:"feishu_bitable",data:JSON.stringify({...o.value,[n.name]:n})}).then(_=>{q("change"),g.value=!1,E.success(e("msg_saved"))}).finally(()=>{v.value=!1})}catch(_){v.value=!1,E.error(_)}}return O({show:y}),(_,r)=>{const M=P,p=z,i=$,t=V,m=A;return x(),I(m,{open:g.value,"onUpdate:open":r[3]||(r[3]=u=>g.value=u),"confirm-loading":v.value,title:s(e)("title_api_key_auth_config"),width:"620px",onOk:l},{default:h(()=>[f(M,{type:"info","show-icon":"",message:s(e)("msg_config_workflow_call")},null,8,["message"]),f(t,{class:"mt16",model:n,"label-col":{span:4},"wrapper-col":{span:20}},{default:h(()=>[f(i,{label:s(e)("label_credential_name"),name:"name",rules:[{required:!0,message:s(e)("msg_input_credential_name")}]},{default:h(()=>[f(p,{value:n.name,"onUpdate:value":r[0]||(r[0]=u=>n.name=u),valueModifiers:{trim:!0},maxlength:16,placeholder:s(e)("ph_input_credential_name")},null,8,["value","placeholder"]),C("div",W,U(s(e)("msg_credential_name_desc")),1)]),_:1},8,["label","rules"]),f(i,{label:s(e)("label_app_id"),name:"appid",rules:[{required:!0,message:s(e)("msg_input_app_id")}]},{default:h(()=>[f(p,{value:n.appid,"onUpdate:value":r[1]||(r[1]=u=>n.appid=u),valueModifiers:{trim:!0},placeholder:s(e)("ph_input_app_id")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),f(i,{label:s(e)("label_app_secret"),name:"app_secret",rules:[{required:!0,message:s(e)("msg_input_app_secret")}]},{default:h(()=>[f(p,{value:n.app_secret,"onUpdate:value":r[2]||(r[2]=u=>n.app_secret=u),valueModifiers:{trim:!0},placeholder:s(e)("ph_input_app_secret")},null,8,["value","placeholder"]),C("div",X,U(s(e)("msg_how_to_get_app_id_secret")),1)]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["open","confirm-loading","title"])}}},ce=D(Y,[["__scopeId","data-v-e3260152"]]),Z={class:"tip-desc"},ee={style:{display:"flex","align-items":"center",gap:"8px"}},ae=["href"],te={key:0,class:"tip-desc"},ne={key:1,class:"tip-desc"},se={__name:"plugin-config-modal",emits:["change"],setup(F,{expose:O,emit:S}){const{t:e}=B("views.explore.plugins.components.plugin-config-modal"),q=S,o=c({}),g=c(""),v=c({}),n=c(!1),y=c(!1),l=Q({}),_=c([]);function r(t){return String(t||"").replace(/`/g,"").trim()}function M(t){const m=[];Object.keys(t||{}).forEach(d=>{const k=t[d]||{};if(k&&k.use_plugin_config===!0){const b=k.params||{};Object.keys(b).forEach(w=>{const a=b[w]||{};a.plugin_config_component===!0&&m.push({key:w,name:a.name,desc:a.desc,tip:a.tip,required:!!a.required,placeholder:a.placeholder,click_title:r(a.click_title),click_url:r(a.click_url)})})}});const u=new Set;_.value=m.filter(d=>u.has(d.key)?!1:(u.add(d.key),!0)).sort((d,k)=>{var b,w;return+(((b=t==null?void 0:t[d.key])==null?void 0:b.sort_num)||0)-+(((w=t==null?void 0:t[k.key])==null?void 0:w.sort_num)||0)})}function p(t={},m="",u={}){o.value=t,g.value=m,v.value=u,Object.keys(l).forEach(d=>delete l[d]),Object.assign(l,{name:"",is_default:!1}),(!o.value||!Object.keys(o.value).length)&&(l.is_default=!0),M(v.value),_.value.forEach(d=>{l[d.key]=""}),n.value=!0}function i(){try{if(y.value=!0,!l.name)throw e("msg_please_input_credential_name");if(o.value[l.name])throw e("msg_credential_name_exists");_.value.forEach(t=>{const m=String(l[t.key]||"").trim();if(t.required&&!m)throw e("msg_please_input_field",{field:t.name||t.key})}),L({name:g.value,data:JSON.stringify({...o.value,[l.name]:l})}).then(()=>{q("change"),n.value=!1,E.success(e("msg_saved"))}).finally(()=>{y.value=!1})}catch(t){y.value=!1,E.error(String(t||e("msg_config_save_failed")))}}return O({show:p}),(t,m)=>{const u=P,d=z,k=$,b=V,w=A;return x(),I(w,{open:n.value,"onUpdate:open":m[1]||(m[1]=a=>n.value=a),"confirm-loading":y.value,title:s(e)("title_api_key_auth_config"),width:"620px",onOk:i},{default:h(()=>[f(u,{type:"info","show-icon":"",message:s(e)("msg_config_workflow_tip")},null,8,["message"]),f(b,{class:"mt16",model:l,"label-col":{span:4},"wrapper-col":{span:20}},{default:h(()=>[f(k,{label:s(e)("label_credential_name"),name:"name",rules:[{required:!0,message:s(e)("msg_please_input_credential_name")}]},{default:h(()=>[f(d,{value:l.name,"onUpdate:value":m[0]||(m[0]=a=>l.name=a),valueModifiers:{trim:!0},maxlength:16,placeholder:s(e)("ph_input_credential_name")},null,8,["value","placeholder"]),C("div",Z,U(s(e)("msg_credential_name_desc")),1)]),_:1},8,["label","rules"]),(x(!0),j(H,null,K(_.value,a=>(x(),I(k,{key:a.key,label:a.name||a.key,name:a.key,rules:a.required?[{required:!0,message:s(e)("msg_please_input_field",{field:a.name||a.key})}]:[]},{default:h(()=>[C("div",ee,[f(d,{value:l[a.key],"onUpdate:value":T=>l[a.key]=T,valueModifiers:{trim:!0},placeholder:a.placeholder||""},null,8,["value","onUpdate:value","placeholder"]),a.click_url?(x(),j("a",{key:0,style:{"flex-shrink":"0"},href:a.click_url,target:"_blank",rel:"noopener noreferrer"},U(a.click_title||s(e)("btn_get")),9,ae)):J("",!0)]),a.tip?(x(),j("div",te,U(a.tip),1)):a.desc?(x(),j("div",ne,U(a.desc),1)):J("",!0)]),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","confirm-loading","title"])}}},_e=D(se,[["__scopeId","data-v-839b6095"]]);function pe(F=!0){G();const O=c({}),S=c(!1),e=c(!1),q=c(""),o=c(""),g=()=>"admin";async function v(){await n(),await y(),r()}async function n(){const p=g();return N({name:"official_article",action:"default/exec",params:JSON.stringify({business:"register",arguments:{username:p}})})}async function y(){var i;const p=g();try{const t=await N({name:"official_article",action:"default/exec",params:JSON.stringify({business:"get_login_status",arguments:{username:p}})});S.value=!!((i=t==null?void 0:t.data)!=null&&i.online),O.value=(t==null?void 0:t.data)||{}}finally{setTimeout(()=>{e.value=!1},1200)}}function l(){e.value||(e.value=!0,y())}async function _(){const p=g(),{data:i}=await N({name:"official_article",action:"default/exec",params:JSON.stringify({business:"wechat_qrcode_login",arguments:{username:p}})});q.value=(i==null?void 0:i.qrcode_base64)||""}async function r(){const p=g(),{data:i}=await N({name:"official_article",action:"default/exec",params:JSON.stringify({business:"get_login_url",arguments:{username:p}})});o.value=i==null?void 0:i.url}F&&R(v);async function M(){o.value||await r(),window.open(o.value)}return{loginInfo:O,loginStatus:S,loginUrl:o,qrcodeUrl:q,loading:e,init:v,refresh:l,goLogin:M,getLoginUrl:r,getLoginQrcode:_}}export{ce as F,_e as P,pe as u};
//# sourceMappingURL=useOfficialArticleLogin-CmM2SX9T.js.map
