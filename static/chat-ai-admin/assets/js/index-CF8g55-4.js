import{_ as O,ae as j,ad as G,d as Q,ax as R,bm as T,bg as H,bQ as X,f as K,B as W,aw as Z,bl as ee}from"../../index-C1Xsov4S.js";import{Y as w,F as te,ab as ae,_ as g,a5 as a,a7 as x,k as s,a2 as i,u as L,B as C,f as $,e as F,r as q,o as oe,a1 as ne,a4 as I,a9 as se,ae as le,G as re}from"./vue-chunks-DCKTEHpB.js";import{p as ie,e as de,f as _e,h as ce,a as B,F as N,b as pe,I as ue,X as fe,M,B as me,a3 as ye,Q as ve}from"./ui-antd-D64OvTpt.js";import{t as be}from"./validate-8MtiUsxW.js";import{A as ge}from"./avatar-input-Dgs7Yoxj.js";import{_ as he}from"./page-alert-Bo_UnvJL.js";import"./utils-D9NMMoMR.js";const ke={class:"list-box"},xe=["onClick"],we={class:"library-info"},Le=["src"],Ce={class:"library-info-content"},$e={class:"library-title"},Ae={class:"item-body"},De={class:"item-footer"},Be={class:"library-size"},Oe={class:"text-item"},qe={class:"text-item"},Ie=["onClick"],Ne=["onClick"],Re={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup(A,{emit:h}){const v=h,f=A,c=d=>{v("edit",d)},p=d=>{v("delete",d)};return(d,u)=>{const m=ie,k=Q,e=_e,r=de,n=ce;return g(),w("div",ke,[(g(!0),w(te,null,ae(f.list,t=>(g(),w("div",{class:"list-item-wrapper",key:t.id},[a("div",{class:"list-item",onClick:C(_=>c(t),["stop"])},[a("div",we,[a("img",{class:"library-icon",src:t.avatar,alt:""},null,8,Le),a("div",Ce,[a("div",$e,x(t.library_name),1)])]),a("div",Ae,[s(m,{title:L(G)(t.library_intro,t,14,2,0),placement:"top"},{default:i(()=>[a("div",{class:"library-desc",ref_for:!0,ref:_=>L(j)(_,t)},x(t.library_intro),513)]),_:2},1032,["title"])]),a("div",De,[a("div",Be,[a("span",Oe,"文档："+x(t.file_total),1),a("span",qe,"大小："+x(t.file_size_str),1)]),a("div",{class:"action-box",onClick:u[1]||(u[1]=C(()=>{},["stop"]))},[s(n,null,{overlay:i(()=>[s(r,null,{default:i(()=>[s(e,null,{default:i(()=>[a("a",{href:"javascript:;",onClick:C(_=>c(t),["stop"])},"管 理",8,Ie)]),_:2},1024),s(e,null,{default:i(()=>[a("a",{class:"delete-text-color",href:"javascript:;",onClick:_=>p(t)},"删 除",8,Ne)]),_:2},1024)]),_:2},1024)]),default:i(()=>[a("div",{class:"action-item",onClick:u[0]||(u[0]=C(()=>{},["stop"]))},[s(k,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,xe)]))),128))])}}},Te=O(Re,[["__scopeId","data-v-5b83eb90"]]),Fe={class:"form-box"},Me={__name:"add-library-model",setup(A,{expose:h}){B.config({duration:2});const v=se(),f=$(!1),c=F(()=>1);let p="",d="";const u=N.useForm,m=$(!1),k=c.value==0?R:T,e=q({type:c.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:k,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:c.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),r=q({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:n,validateInfos:t}=u(e,r),_=o=>{e.avatar=o.imageUrl,e.avatar_file=o.file},S=()=>{f.value=!1},E=()=>{n().then(()=>{P()}).catch(o=>{})},P=()=>{let o=new FormData,l=JSON.parse(JSON.stringify(e));o.append("type",e.type),o.append("access_rights",e.access_rights),o.append("library_name",e.library_name),o.append("library_intro",e.library_intro),o.append("use_model",l.use_model),o.append("model_config_id",e.model_config_id),o.append("avatar",e.avatar_file?e.avatar_file:""),o.append("is_offline",e.is_offline),o.append("urls",JSON.stringify(be(e.urls))),o.append("doc_type",e.doc_type),o.append("file_name",e.file_name),o.append("is_qa_doc",e.is_qa_doc),o.append("qa_index_type",e.qa_index_type),o.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),o.append("is_default",2),m.value=!0,H(o).then(b=>{B.success("创建成功"),d=b.data.id,p=b.data.library_key,V(b.data.id)}).catch(()=>{m.value=!1})},U=async()=>await X({library_key:p,doc_id:"",doc_type:"4",pid:0,title:"无标题文档",content:"# 无标题文档",sort:0}),V=()=>{U().then(o=>{let l=o.data.doc_id;v.replace({path:"/public-library/editor",query:{library_id:d,library_key:p,doc_id:l}})})};return h({show:()=>{f.value=!0}}),oe(()=>{}),(o,l)=>{const b=ue,D=pe,z=fe,J=N,Y=M;return g(),ne(Y,{open:f.value,"onUpdate:open":l[3]||(l[3]=y=>f.value=y),title:"添加知识库",onOk:E,confirmLoading:m.value,onCancel:S,width:"640px"},{default:i(()=>[a("div",Fe,[s(J,{"label-col":{span:5}},{default:i(()=>[s(D,I({ref:"name",label:"知识库名称"},L(t).library_name),{default:i(()=>[s(b,{value:e.library_name,"onUpdate:value":l[0]||(l[0]=y=>e.library_name=y),type:"text",placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),s(D,{label:"知识库简介"},{default:i(()=>[s(z,{maxlength:1e3,value:e.library_intro,"onUpdate:value":l[1]||(l[1]=y=>e.library_intro=y),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),s(D,I({ref:"name",label:"知识库封面"},L(t).avatar),{default:i(()=>[s(ge,{value:e.avatar,"onUpdate:value":l[2]||(l[2]=y=>e.avatar=y),onChange:_},null,8,["value"]),l[4]||(l[4]=a("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Se=O(Me,[["__scopeId","data-v-3cbdc4ac"]]),Ee={"bg-color":"#f5f9ff",class:"library-page"},Pe={class:"library-page-body"},Ue={class:"list-toolbar"},Ve={class:"toolbar-box"},ze={class:"list-total"},Je={key:0,class:"toolbar-box"},Ye={__name:"index",setup(A){let{role_permission:h,role_type:v}=K();const f=F(()=>v==1||h.includes("CreateOpenLibDoc")),c=$(null),p=$([]),d=()=>{W({type:1}).then(r=>{let n=r.data||[];n.forEach(t=>{t.file_size_str=Z(t.file_size),t.avatar||(t.avatar=t.type==0?R:T)}),p.value=n})};d();const u=()=>{c.value.show()},m=r=>{window.open(`/#/public-library/home?library_id=${r.id}&library_key=${r.library_key}`,"_blank","noopener")},k=r=>{let n=3,t=M.confirm({title:`删除${r.library_name}`,icon:s(ve),content:"您确定要删除此知识库吗？",okText:n+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){e(r)},onCancel(){}}),_=setInterval(()=>{n==1?(t.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(_),_=void 0):(n-=1,t.update({okText:n+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:r})=>{ee({id:r}).then(()=>{B.success("删除成功"),d()})};return(r,n)=>{const t=me;return g(),w("div",Ee,[n[3]||(n[3]=a("div",{class:"page-title"},"对外文档",-1)),s(he,{style:{"margin-bottom":"16px"},title:"使用说明"},{default:i(()=>[...n[1]||(n[1]=[a("div",null,[a("p",null," 1、对外文档作为在线文档创作管理工具，创作的文档既可作为知识库关联到机器人使用，也可分享给好友查看。 "),a("p",null,"2、支持设置每篇文档的title、description、keyword，提高SEO搜索权重。")],-1)])]),_:1}),a("div",Pe,[a("div",Ue,[a("div",Ve,[a("h3",ze,"全部 ("+x(p.value.length)+")",1)]),f.value?(g(),w("div",Je,[s(t,{type:"primary",onClick:n[0]||(n[0]=_=>u())},{icon:i(()=>[s(L(ye))]),default:i(()=>[n[2]||(n[2]=re(" 新建对外文档 ",-1))]),_:1})])):le("",!0)]),a("div",null,[s(Te,{list:p.value,onAdd:u,onEdit:m,onDelete:k},null,8,["list"])])]),s(Se,{ref_key:"addLibraryModelRef",ref:c},null,512)])}}},et=O(Ye,[["__scopeId","data-v-962b1c5e"]]);export{et as default};
