import{_ as et}from"./cu-scroll-5W3_kglT.js";import{b as tt,b9 as ot,ba as st,d as at}from"../../index-CPkdGIiL.js";import{f as i,w as Q,e as Z,r as W,o as nt,b as lt,y as ee,Y as d,a5 as s,k as a,a6 as it,ad as D,ae as L,a2 as n,_ as l,u as C,B as M,F as U,a9 as N,a7 as g,a1 as we,G as te}from"./vue-chunks-Ci-XTWEs.js";import{_ as dt}from"./empty-BFmzY9bl.js";import{a as ut,_ as ct}from"./create-send-modal-IRGOuMiF.js";import{ad as rt,ab as Ce,ae as pt,af as _t,ag as vt,ah as ft}from"./index-Bu5ae_-0.js";import{p as gt,I as mt,M as Se,z as Oe,T as ze,D as ht,an as Me,b as yt,c as kt,a8 as bt,B as xt,av as wt,ag as Ct,ah as St,br as Ot,E as zt,u as Mt,v as It,aB as Gt,a as m,H as Dt}from"./ui-antd-Bw8cEW5z.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-ChQO-_r6.js";const Lt={class:"official-draft-wrapper"},Ut={class:"qa-list-wrapper"},Bt={class:"group-head-box"},Et={class:"head-title"},Rt={class:"flex-between-box"},Ht={class:"search-box"},$t={class:"classify-box"},Tt=["onClick"],Wt={class:"classify-title"},Nt={class:"right-content"},Kt={key:0,class:"btn-box"},Pt={class:"hover-btn-wrap"},Vt=["onClick"],Xt=["onClick"],jt={class:"head-content"},Yt={class:"toolbar"},Ft={key:0,class:"title"},qt={class:"pover-group-content-box"},At={class:"group-head-box"},Jt={class:"head-title"},Qt={class:"flex-between-box"},Zt={class:"search-box"},eo={class:"classify-box classify-scroll-box"},to=["onClick"],oo={class:"classify-title"},so={class:"right-content"},ao={key:0,class:"btn-box"},no={class:"hover-btn-wrap"},lo=["onClick"],io=["onClick"],uo={class:"header-row"},co={class:"content-block"},ro={key:0,class:"loading-box"},po={key:0,class:"empty-box"},_o={key:1,class:"draft-list"},vo=["src"],fo={key:1,class:"thumb",src:ct},go={class:"info"},mo={class:"title"},ho={class:"meta"},yo={class:"digest"},ko={class:"extra"},bo={class:"pagination-box"},xo={class:"sync-modal"},wo={class:"sync-select-box"},Ie="official_draft_group_box_width",Ge="official_draft_group_hide_key",K=180,oe=256,Co={__name:"draft-box",props:{appId:{type:String,default:""},accessKey:{type:String,default:""}},setup(P){const h=P,se=i(null),ae=i(null),V=i(0),B=i(!1);Q(()=>h.appId,()=>{c.value.page=1,h.appId&&ge()});const S=i([]),I=i(""),O=i(-1),ne=Z(()=>S.value.filter(o=>(o.group_name||"").includes(I.value))),X=async()=>{let e=(await rt()).data||[];S.value=e.map(u=>({...u,total:0})),await j(),r()},j=async()=>{const o=h.appId,e=S.value.map(async u=>{var w;const p=await Ce({page:1,size:1,app_id:o,group_id:u.id}),x=((w=p==null?void 0:p.data)==null?void 0:w.total)||0;u.total=x});await Promise.all(e)},E=(o={})=>{y.id=o.id||0,y.group_name=o.group_name||"",R.value=!0},R=i(!1),y=W({id:0,group_name:""}),De=async()=>{if(!y.group_name)return m.error("请输入分组名称");await _t({id:y.id,group_name:y.group_name}),R.value=!1,m.success("操作成功"),await X()},le=o=>{Se.confirm({title:`确认删除分组：${o.group_name}`,icon:a(Dt),content:"",okText:"确认",cancelText:"取消",onOk:async()=>{await pt({id:o.id}),await X(),m.success("操作成功"),O.value==o.id&&(O.value=-1,await z())}})},ie=o=>{O.value=o.id,Ee()},k=i([]),Y=i(!1),de=i(0),c=i({page:1,size:20}),Le=W({title:""}),ue=()=>Object.keys(_).filter(o=>_[o]),_=W({}),Ue=Z(()=>ue().length),ce=Z({get(){return k.value.length>0&&k.value.every(o=>!!_[o.id])},set(o){k.value.forEach(e=>{_[e.id]=o})}}),Be=()=>{Object.keys(_).forEach(o=>delete _[o])};Q(k,()=>{ee(r)},{deep:!0}),Q(S,()=>{ee(r)},{deep:!0});const z=async()=>{Y.value=!0;const o=await Ce({page:c.value.page,size:c.value.size,title:Le.title,app_id:h.appId,group_id:O.value}),e=(o==null?void 0:o.data)||{};k.value=e.list||[],de.value=e.total||0,Y.value=!1,Be(),r()},Ee=()=>{c.value.page=1,z()},Re=(o,e)=>{c.value.page=o,c.value.size=e,z()},He=()=>{const o=ue();if(o.length===0)return m.error("请选择你要移动的草稿");b.ids=o.join(","),b.group_id=void 0,H.value=!0},$e=()=>{He()},F=i(null),Te=o=>{F.value&&F.value.show({draft:o})},H=i(!1),b=W({group_id:void 0,ids:""}),We=async()=>{if(!b.group_id)return m.error("请选择分组");await vt({draft_id:b.ids,group_id:b.group_id,app_id:h.appId}),H.value=!1,m.success("移动成功"),await z(),await j()},G=i(K),v=i(localStorage.getItem(Ge)==1),q=i(!1);nt(()=>{ot();const o=parseInt(localStorage.getItem(Ie));o&&o>=K&&o<=oe&&(G.value=o),h.appId&&ge(),window.addEventListener("resize",r)}),lt(()=>{window.removeEventListener("resize",r),st()});const re=()=>{v.value=!v.value,localStorage.setItem(Ge,v.value?1:2),r()};let $=!1,pe=0,_e=0;const Ne=o=>{v.value||($=!0,q.value=!0,pe=o.clientX,_e=G.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",ve),document.addEventListener("mouseup",fe))},ve=o=>{if(!$)return;let e=_e+(o.clientX-pe);e=Math.max(K,Math.min(oe,e)),G.value=e},fe=()=>{$&&($=!1,q.value=!1,localStorage.setItem(Ie,G.value),document.body.style.cursor="",document.removeEventListener("mousemove",ve),document.removeEventListener("mouseup",fe),r())},ge=async()=>{await X(),await z(),r()},r=()=>{ee(()=>{const o=se.value,e=ae.value;if(!o||!e)return;const u=o.style.height;o.style.height="auto";const p=o.scrollHeight||o.offsetHeight||0;o.style.height=u;const x=e.scrollHeight||e.offsetHeight||0;V.value=Math.max(p,x)})},me=o=>{const e=S.value.find(u=>u.id==o);return e?e.group_name:o==0?"未分组":""},Ke=()=>{m.success("创建群发任务成功")},T=i(!1),A=i(0),Pe={0:"前100条",1:"前200条",2:"前1000条",3:"全部"},Ve=[100,200,1e3,0],Xe=()=>{T.value=!0},je=async()=>{const o=Ve[A.value]||0;B.value=!0,await ft({access_key:h.accessKey,limit:o}),B.value=!1,m.success("已提交同步任务，稍后刷新查看"),T.value=!1,setTimeout(()=>{z(),j()},800),setTimeout(()=>{r()},1e3)};return(o,e)=>{const u=at,p=gt,x=mt,w=kt,he=yt,ye=ht,ke=et,Ye=bt,be=xt,xe=Ct,Fe=St,qe=Ot,J=Se,Ae=It,Je=Mt,Qe=zt,Ze=Gt;return l(),d("div",Lt,[s("div",Ut,[s("div",{class:D(["group-content-box",[{collapsed:v.value},{"no-transition":q.value}]]),ref_key:"groupContentRef",ref:se,style:it(v.value?{}:{width:G.value+"px",minWidth:K+"px",maxWidth:oe+"px",height:V.value?V.value+"px":void 0})},[s("div",Bt,[s("div",Et,[a(p,{title:"收起分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(u,{name:"put-away"})])]),_:1}),s("div",Rt,[e[15]||(e[15]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[0]||(e[0]=t=>E({}))},[a(C(Oe))])]),_:1})])]),s("div",Ht,[a(x,{value:I.value,"onUpdate:value":e[2]||(e[2]=t=>I.value=t),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(ze),{onClick:e[1]||(e[1]=M(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",$t,[a(ke,{style:{"padding-right":"24px"}},{default:n(()=>[(l(!0),d(U,null,N(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==O.value}]),onClick:f=>ie(t),key:t.id},[s("div",Wt,g(t.group_name),1),s("div",Nt,[s("div",{class:D(["num",{"num-block":t.id<=0}])},g(t.total),3),t.id>0?(l(),d("div",Kt,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:M(f=>E(t),["stop"])},"重命名",8,Vt)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:M(f=>le(t),["stop"])},"删 除",8,Xt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",Pt,[a(C(Me))])]),_:2},1024)])):L("",!0)])],10,Tt))),128))]),_:1})]),v.value?L("",!0):(l(),d("div",{key:0,class:"resize-bar",onMousedown:Ne},null,32))],6),s("div",{class:"main-content-box",ref_key:"mainContentRef",ref:ae},[a(ke,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:n(()=>[s("div",jt,[s("div",Yt,[v.value?(l(),d("div",Ft,[a(Ye,{title:null,placement:"bottom"},{content:n(()=>[s("div",qt,[s("div",At,[s("div",Jt,[s("div",Qt,[e[16]||(e[16]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[3]||(e[3]=t=>E({}))},[a(C(Oe))])]),_:1})])]),s("div",Zt,[a(x,{allowClear:"",value:I.value,"onUpdate:value":e[5]||(e[5]=t=>I.value=t),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(ze),{onClick:e[4]||(e[4]=M(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",eo,[(l(!0),d(U,null,N(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==O.value}]),onClick:f=>ie(t),key:t.id},[s("div",oo,g(t.group_name),1),s("div",so,[s("div",{class:D(["num",{"num-block":t.id<=0}])},g(t.total),3),t.id>0?(l(),d("div",ao,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:M(f=>E(t),["stop"])},"重命名",8,lo)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:M(f=>le(t),["stop"])},"删 除",8,io)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",no,[a(C(Me))])]),_:2},1024)])):L("",!0)])],10,to))),128))])])]),default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(u,{name:"expand"})])]),_:1})])):L("",!0),a(be,{type:"primary",onClick:Xe,loading:B.value},{default:n(()=>[B.value?L("",!0):(l(),we(C(wt),{key:0})),e[17]||(e[17]=te("同步草稿 "))]),_:1,__:[17]},8,["loading"]),a(be,{disabled:Ue.value===0,onClick:$e},{default:n(()=>e[18]||(e[18]=[te("批量分组")])),_:1,__:[18]},8,["disabled"])]),s("div",uo,[a(xe,{checked:ce.value,"onUpdate:checked":e[6]||(e[6]=t=>ce.value=t)},null,8,["checked"]),e[19]||(e[19]=s("span",{class:"header-text"},"内容",-1))])]),s("div",co,[Y.value?(l(),d("div",ro,[a(Fe)])):(l(),d(U,{key:1},[k.value.length===0?(l(),d("div",po,e[20]||(e[20]=[s("img",{src:dt},null,-1),s("div",{class:"title"},"暂无草稿",-1)]))):(l(),d("div",_o,[(l(!0),d(U,null,N(k.value,t=>(l(),d("div",{class:"draft-item",key:t.id},[a(xe,{checked:_[t.id],"onUpdate:checked":f=>_[t.id]=f},null,8,["checked","onUpdate:checked"]),t.thumb_url?(l(),d("img",{key:0,class:"thumb",src:t.thumb_url},null,8,vo)):(l(),d("img",fo)),s("div",go,[s("div",mo,g(t.title),1),s("div",ho,"所属分组："+g(me(t.group_id)),1),s("div",yo,g(t.digest),1)]),s("div",ko,[a(u,{name:"group-send",class:"icon",onClick:f=>Te(t),style:{"font-size":"32px",cursor:"pointer",color:"transparent"}},null,8,["onClick"])])]))),128))])),s("div",bo,[a(qe,{current:c.value.page,"onUpdate:current":e[7]||(e[7]=t=>c.value.page=t),"page-size":c.value.size,"onUpdate:pageSize":e[8]||(e[8]=t=>c.value.size=t),total:de.value,pageSizeOptions:["10","20","50","100"],"show-size-changer":"",onChange:Re},null,8,["current","page-size","total"])])],64))])]),_:1})],512)]),a(J,{open:R.value,"onUpdate:open":e[10]||(e[10]=t=>R.value=t),title:"添加分组",onOk:De},{default:n(()=>[e[21]||(e[21]=s("div",{style:{margin:"32px 0 4px"}},"分组名称：",-1)),a(x,{value:y.group_name,"onUpdate:value":e[9]||(e[9]=t=>y.group_name=t),placeholder:"请输入分组名称",style:{"margin-bottom":"20px"}},null,8,["value"])]),_:1,__:[21]},8,["open"]),a(J,{open:H.value,"onUpdate:open":e[12]||(e[12]=t=>H.value=t),title:"批量移动分组",onOk:We},{default:n(()=>[a(Qe,{align:"center",style:{margin:"24px 0"}},{default:n(()=>[e[22]||(e[22]=s("div",null,"移动到分组：",-1)),a(Je,{value:b.group_id,"onUpdate:value":e[11]||(e[11]=t=>b.group_id=t),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(l(!0),d(U,null,N(S.value.filter(t=>t.id>0),t=>(l(),we(Ae,{key:t.id,value:t.id},{default:n(()=>[te(g(t.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1,__:[22]})]),_:1},8,["open"]),a(ut,{ref_key:"createSendModalRef",ref:F,"app-id":P.appId,"access-key":P.accessKey,"get-group-name":me,onCreated:Ke},null,8,["app-id","access-key"]),a(J,{open:T.value,"onUpdate:open":e[14]||(e[14]=t=>T.value=t),title:"同步草稿箱",width:478,onOk:je},{default:n(()=>[s("div",xo,[e[23]||(e[23]=s("div",{class:"sync-desc-box"}," 由于微信限制了草稿箱每日同步接口次数，为防止同步草箱时出现接口超限的情况，您可以根据个人业务选择草稿箱的同步条数 ",-1)),e[24]||(e[24]=s("div",{class:"sync-select-title"},"选择同步条数",-1)),s("div",wo,[a(Ze,{min:0,max:3,step:null,value:A.value,"onUpdate:value":e[13]||(e[13]=t=>A.value=t),marks:Pe,tooltipOpen:!1},null,8,["value"])])])]),_:1},8,["open"])])}}},Eo=tt(Co,[["__scopeId","data-v-f12b91d8"]]);export{Eo as default};
