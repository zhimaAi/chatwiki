import{u as K,o as se,p as ie}from"../../index-DSFcP5NQ.js";import{j as ue}from"./index-MT9fcN3v.js";import{j as _e,z as pe,R as de,S as ce}from"./index-Cg7-0swo.js";import{r as v,w as me,a as F,b as u,y as d,t as p,n as J,e as L,p as w,u as a,E as Z,c as M,j as ve,q as $,m as C,v as A,l as fe,_ as ge,F as be,G as he,ag as ye,ah as we}from"./vue-chunks-BdaA73Wf.js";import{_ as z}from"./emoji-mart-BBMRoEa3.js";import{F as B,a0 as ke,a1 as xe,p as Le,M as V,b as P,c as Re,I as H,u as Oe,v as Ue,V as Ie,aO as Ce}from"./ui-antd-Dl1wwwCD.js";import{u as Ae}from"./robot-CIzNpArp.js";const Fe={class:"avatar-uploader"},Pe=["src"],Se={key:1},je=["src"],qe={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(S,{emit:j}){function U(o){return new Promise((x,O)=>{const b=new FileReader;b.readAsDataURL(o),b.onload=()=>x(b.result),b.onerror=h=>O(h)})}const t=j,c=S,g=v([]),m=v(!1),_=v("");me(()=>c.value,o=>{_.value=o},{immediate:!0});const I=B.useInjectFormItemContext(),q=()=>{let o={imageUrl:_.value,file:g.value[0].originFileObj};t("change",o),t("update:value",o.imageUrl),I.onFieldChange()},l=o=>o.type==="image/jpeg"||o.type==="image/png"?o.size/1024<100?(g.value=[o],U(o).then(b=>{_.value=b,m.value=!1,q()}),!1):(P.error("机器人头像图片大小不能超过100kb"),!1):(P.error("机器人头像只支持JPG、PNG格式的图片"),!1),i=v(!1),k=v(""),R=v(""),e=()=>{i.value=!1,R.value=""},G=async o=>{!o.url&&!o.preview&&(o.preview=await U(o.originFileObj)),k.value=o.url||o.preview,i.value=!0,R.value=o.name||o.url.substring(o.url.lastIndexOf("/")+1)};return(o,x)=>{const O=Le,b=V;return u(),F("div",Fe,[d(O,{"file-list":g.value,"onUpdate:fileList":x[0]||(x[0]=h=>g.value=h),"list-type":c.listType,"show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:G,style:J(c.style)},{default:p(()=>[S.value?(u(),F("img",{key:0,class:"avatar",style:J(c.style),src:S.value,alt:"avatar"},null,12,Pe)):(u(),F("div",Se,[m.value?(u(),L(a(ke),{key:0})):(u(),L(a(xe),{key:1})),x[1]||(x[1]=w("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),d(b,{open:i.value,title:R.value,footer:null,onCancel:e},{default:p(()=>[w("img",{alt:"example",style:{width:"100%"},src:k.value},null,8,je)]),_:1},8,["open","title"])])}}},W=z(qe,[["__scopeId","data-v-34012a20"]]),Te={class:"form-box"},$e={class:"robot-avatar-box"},Ve={class:"form-item-tip"},Ge={class:"form-item-tip"},Me={key:0,class:"form-item-tip"},Be={class:"form-item-tip"},ze={__name:"add-robot-alert",emits:["addRobot","editRobot","ok"],setup(S,{expose:j,emit:U}){const{t}=K("views.robot.robot-list.components.add-robot-alert"),c=Ae(),g=U;let m="";const _=we(),I=ye(),q=B.useForm,l=v(!1),i=v(!1),k=v(!1),R=v([]),e=Z({robot_name:"",en_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),G=M(()=>e.application_type==0?l.value?t("title_edit_robot_info"):t("title_create_chat_robot"):l.value?t("title_edit_workflow_info"):t("title_create_workflow")),o=M(()=>c.robotInfo),{getRobot:x}=c,O=M(()=>({robot_name:[{required:!0,message:t("msg_robot_name_required"),trigger:"change"},{min:1,max:20,message:t("msg_max_20_chars"),trigger:"change"}],en_name:[]})),{validate:b,validateInfos:h,clearValidate:Q}=q(e,O),D=n=>{e.robot_avatar=n.file},X=()=>{let n={robot_name:e.robot_name,en_name:e.en_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||m,group_id:e.group_id||"0"};k.value=!0;let r=pe,f="msg_robot_created";l.value&&(r=de,n.id=_.query.id,f="msg_robot_edited",n.robot_avatar==m&&delete n.robot_avatar),r(n,e.application_type).then(y=>{if(k.value=!1,y.res!=0)return P.error(y.msg);if(P.success(t(f)),!l.value&&_.query.robot_key){g("addRobot"),i.value=!1;return}l.value?(x(_.query.id),g("editRobot"),i.value=!1):e.application_type==0?I.push("/robot/config/basic-config?id="+y.data.id+"&robot_key="+y.data.robot_key):(window.open("/#/robot/config/workflow?id="+y.data.id+"&robot_key="+y.data.robot_key+"&show_tips=1"),i.value=!1,g("ok"))}).catch(()=>{k.value=!1})},Y=async()=>{let n=await ue({model_type:"LLM"});return!n||n.data.length==0?(V.confirm({title:t("msg_add_llm_provider_title"),icon:he(Ce,{style:{color:"red"}}),content:t("msg_add_llm_provider_content"),onOk(){I.push("/user/model")},onCancel(){}}),!1):!0},ee=async(n,r)=>{n==0?m=se:m=ie,l.value=r;let f=await Y();oe(),f&&(e.robot_avatar="",e.robot_avatar_url=m,e.robot_name="",e.en_name="",e.robot_intro="",e.application_type=n,i.value=!0,l.value&&o.value&&(e.robot_name=o.value.robot_name,e.en_name=o.value.en_name,e.robot_intro=o.value.robot_intro,e.robot_avatar_url=o.value.robot_avatar_url)),n==0?O.value.en_name=[]:O.value.en_name=[{required:!0,message:t("msg_workflow_name_required"),trigger:"change"},{validator:async(y,T,E)=>!T||/^[a-zA-Z0-9_\.\-]+$/.test(T)?Promise.resolve():Promise.reject(t("msg_workflow_name_format_error"))}]},te=n=>{e.group_id=n||"0"},oe=()=>{_e().then(n=>{R.value=n.data||[]})},ae=()=>{Q()},re=()=>{!l.value&&e.application_type!=0&&(e.robot_name||(e.robot_name=e.en_name)),b().then(()=>{X()}).catch(n=>{})};return ve(()=>{}),j({open:ee,setGroupId:te}),(n,r)=>{const f=Re,y=H,T=Ue,E=Oe,N=Ie,le=B,ne=V;return u(),L(ne,{width:l.value?"472px":"746px",open:i.value,"onUpdate:open":r[7]||(r[7]=s=>i.value=s),confirmLoading:k.value,title:G.value,onOk:re,onCancel:ae},{default:p(()=>[w("div",Te,[d(le,{layout:"vertical"},{default:p(()=>[l.value?(u(),L(f,C({key:0,ref:"name",label:""},a(h).robot_avatar_url),{default:p(()=>[w("div",$e,[d(W,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":r[0]||(r[0]=s=>e.robot_avatar_url=s),onChange:D},null,8,["value"]),w("div",Ve,A(a(t)("ph_upload_avatar")),1)])]),_:1},16)):$("",!0),e.application_type!=0?(u(),L(f,C({key:1,required:"",ref:"en_name",label:a(t)("label_workflow_name")},a(h).en_name),{default:p(()=>[d(y,{value:e.en_name,"onUpdate:value":r[1]||(r[1]=s=>e.en_name=s),maxLength:50,placeholder:a(t)("ph_input")},null,8,["value","placeholder"]),w("div",Ge,A(a(t)("msg_workflow_name_format")),1)]),_:1},16,["label"])):$("",!0),d(f,C({ref:"name",label:e.application_type==0?a(t)("label_app_name"):a(t)("label_remark_name")},a(h).robot_name),{default:p(()=>[d(y,{value:e.robot_name,"onUpdate:value":r[2]||(r[2]=s=>e.robot_name=s),maxLength:20,placeholder:a(t)("ph_input")},null,8,["value","placeholder"]),e.application_type!=0?(u(),F("div",Me,A(a(t)("msg_remark_name_tip")),1)):$("",!0)]),_:1},16,["label"]),d(f,C({ref:"group_id",label:a(t)("label_group")},a(h).group_id),{default:p(()=>[d(E,{value:e.group_id,"onUpdate:value":r[3]||(r[3]=s=>e.group_id=s),style:{width:"100%"},placeholder:a(t)("ph_select_group")},{default:p(()=>[(u(!0),F(be,null,fe(R.value,s=>(u(),L(T,{value:s.id},{default:p(()=>[ge(A(s.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","placeholder"])]),_:1},16,["label"]),d(f,C({label:a(t)("label_intro")},a(h).robot_intro),{default:p(()=>[l.value?(u(),L(N,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":r[5]||(r[5]=s=>e.robot_intro=s),placeholder:a(t)("ph_intro_workflow")},null,8,["value","placeholder"])):(u(),L(N,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":r[4]||(r[4]=s=>e.robot_intro=s),placeholder:a(t)("ph_intro_chat")},null,8,["value","placeholder"]))]),_:1},16,["label"]),l.value?$("",!0):(u(),L(f,C({key:2,ref:"name",label:a(t)("label_robot_avatar")},a(h).robot_avatar_url),{default:p(()=>[d(W,{value:e.robot_avatar_url,"onUpdate:value":r[6]||(r[6]=s=>e.robot_avatar_url=s),onChange:D},null,8,["value"]),w("div",Be,A(a(t)("ph_upload_avatar")),1)]),_:1},16,["label"]))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},et=z(ze,[["__scopeId","data-v-7453c0ff"]]),De={class:"form-item"},Ee={class:"form-label"},Ne={class:"form-content"},Je={__name:"add-group",emits:["ok"],setup(S,{expose:j,emit:U}){const{t}=K("views.robot.robot-list.components.add-group"),c=v(!1),g=U,m=v("title_create_group"),_=Z({group_name:"",id:""}),I=l=>{_.group_name=l.group_name||"",_.id=l.id||"",m.value=l.id?"title_edit_group":"title_create_group",c.value=!0},q=()=>{if(!_.group_name)return P.error(t("msg_group_name_required"));ce({..._}).then(l=>{P.success(t("msg_operation_success",{operation:t(m.value)})),c.value=!1,g("ok")})};return j({show:I}),(l,i)=>{const k=H,R=V;return u(),F("div",null,[d(R,{open:c.value,"onUpdate:open":i[1]||(i[1]=e=>c.value=e),title:a(t)(m.value),onOk:q,zIndex:2e3},{default:p(()=>[w("div",De,[w("div",Ee,A(a(t)("label_group_name"))+"：",1),w("div",Ne,[d(k,{maxLength:15,value:_.group_name,"onUpdate:value":i[0]||(i[0]=e=>_.group_name=e),placeholder:a(t)("ph_input_group_name")},null,8,["value","placeholder"])])])]),_:1},8,["open","title"])])}}},tt=z(Je,[["__scopeId","data-v-4d957f1e"]]);export{W as A,et as a,tt as b};
//# sourceMappingURL=add-group-BYEOdPBe.js.map
