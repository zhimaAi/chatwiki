import{b as A,aC as V,aD as q}from"../../index-cxyImiCC.js";import{h as G}from"./index-B-6n0NRu.js";import{i as X,a as $,S as F}from"./index-CMui0cQS.js";import{d as I,w as M,q as J,S as v,O as c,U as r,N as O,F as T,a1 as E,Z as U,_ as L,j as z,X as x}from"./vue-chunks-BRsu9_To.js";import{_ as K}from"./index-C4vkzxfk.js";const Z=["src"],H={__name:"model-select",props:{modelType:{type:String,validator:f=>["TEXT EMBEDDING","RERAN","LLM"].includes(f),required:!0},isOffline:{type:Boolean,default:!1},modeName:{type:[String,Number],default:""},modeId:{type:[String,Number],default:""},placeholder:{type:String,default:"请选择嵌入模型"}},emits:["change","update:modeName","update:modeId","loaded"],setup(f,{emit:b}){function B(d,n,a){const e=new Set(d.map(t=>t.model_define));return n.filter(t=>{let m=t[a];e.has(m)&&d.filter(l=>{if(l.model_define==m)return l.children=q(l.children,t.children),!1})}),d}const u=b,o=f,s=I();M([()=>o.modeId,()=>o.modeName],([d,n])=>{!d||!n||(s.value=d+"-"+n)});const N=I([]),D=["azure","ollama","xinference","openaiAgent","doubao"],w=["doubao"],R=(d,n)=>{u("update:modeName",n.modelName),u("update:modeId",n.modelId),u("change",d,n)};let g={};const S=()=>{G({model_type:o.modelType,is_offline:o.isOffline}).then(d=>{let a=(d.data||[]).map(e=>{let{model_define:t,deployment_name:m,id:l}=e.model_config;g={...g,...e.choosable_thinking};let i=`${t}-${m||""}-${l}`,_=[],k=[];o.modelType=="TEXT EMBEDDING"?_=e.model_info.vector_model_list:o.modelType=="RERANK"?_=e.model_info.rerank_model_list:o.modelType=="LLM"&&(_=e.model_info.llm_model_list);for(let h=0;h<_.length;h++){let p=_[h],y=p,C=l+"-"+p;D.indexOf(e.model_config.model_define)>-1&&e.model_config.deployment_name&&(w.includes(e.model_config.model_define)?y=e.model_config.show_model_name||e.model_config.deployment_name:y=e.model_config.deployment_name),k.push({key:l+"_"+p,label:y,name:p,deployment_name:m,model_config_id:l,model_define:t,value:C})}return{key:i,model_define:t,children:k,model_config_id:l,deployment_name:m,name:e.model_info.model_name,icon:e.model_info.model_icon_url}});a=B(V(a,"model_define"),a,"model_define"),a.length===0&&(s.value="无可用模型"),N.value=[...a],u("loaded",JSON.parse(JSON.stringify(a)),g)})};return M(()=>o.isOffline,()=>{S()}),J(()=>{S(),o.modeId&&o.modeName&&(s.value=o.modeId+"-"+o.modeName)}),(d,n)=>{const a=K,e=$,t=X,m=F;return c(),v(m,{value:s.value,"onUpdate:value":n[0]||(n[0]=l=>s.value=l),placeholder:f.placeholder,onChange:R,style:{width:"100%"}},{default:r(()=>[(c(!0),O(T,null,E(N.value,l=>(c(),v(t,{key:l.key},{label:r(()=>[z(a,{align:"center",gap:6},{default:r(()=>[x("img",{class:"model-icon",src:l.icon,alt:""},null,8,Z),x("span",null,L(l.name),1)]),_:2},1024)]),default:r(()=>[(c(!0),O(T,null,E(l.children,i=>(c(),v(e,{value:i.value,modelId:i.model_config_id,modelName:i.name,key:i.key},{default:r(()=>[U(L(i.label),1)]),_:2},1032,["value","modelId","modelName"]))),128))]),_:2},1024))),128))]),_:1},8,["value","placeholder"])}}},ee=A(H,[["__scopeId","data-v-db49ab26"]]);export{ee as M};
