{"version":3,"file":"index-vhz1opRm.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/guess-you-want.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/messages/text-message.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/message-list.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/chat-list.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/file-toolbar.vue","../../../../front-end/chat-ai-admin-vue/src/hooks/web/useUpload.js","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/message-input.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/prompt-log-alert.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/library-info-alert.vue","../../../../front-end/chat-ai-admin-vue/src/assets/img/form-modal-header.png","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/variable-modal/index.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"guess-you-want\">\r\n    <div class=\"message-tabs\">\r\n      <div\r\n        v-if=\"props.item.guess_you_want\"\r\n        @click=\"changeTabkey(props.item, 1)\"\r\n        class=\"tab-item\"\r\n        :class=\"{ active: props.item.question_tabkey == 1 }\"\r\n      >\r\n        {{ t('tab_guess_you_want') }}\r\n      </div>\r\n      <div\r\n        v-if=\"\r\n          props.item.guess_you_want && props.common_question_list && props.enable_common_question\r\n        \"\r\n        class=\"v-line\"\r\n      ></div>\r\n      <div\r\n        v-if=\"props.common_question_list && props.enable_common_question\"\r\n        @click=\"changeTabkey(props.item, 2)\"\r\n        class=\"tab-item\"\r\n        :class=\"{ active: props.item.question_tabkey == 2 }\"\r\n      >\r\n        {{ t('tab_common_questions') }}\r\n      </div>\r\n    </div>\r\n    <div class=\"message-menus\" v-if=\"props.item.question_tabkey == 1\">\r\n      <div\r\n        @click=\"onClickMeun(guess)\"\r\n        class=\"menu-item\"\r\n        v-for=\"(guess, guessIndex) in props.item.guess_you_want\"\r\n        :key=\"guessIndex\"\r\n      >\r\n        {{ guess }}\r\n      </div>\r\n    </div>\r\n    <div class=\"message-menus\" v-else>\r\n      <div\r\n        @click=\"onClickMeun(guess)\"\r\n        class=\"menu-item\"\r\n        v-for=\"(guess, guessIndex) in common_question_list\"\r\n        :key=\"guessIndex\"\r\n      >\r\n        {{ guess }}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.guess-you-want')\r\n\r\nconst emit = defineEmits(['clickMeun'])\r\nconst props = defineProps({\r\n  item: {\r\n    type: Object,\r\n    default: () => {}\r\n  },\r\n  common_question_list: {\r\n    type: Object,\r\n    default: () => []\r\n  },\r\n  enable_common_question: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\nconst changeTabkey = (item, key) => {\r\n  item.question_tabkey = key\r\n}\r\nconst onClickMeun = (data) => {\r\n  emit('clickMeun', data)\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.guess-you-want {\r\n  border-radius: 4px 16px 16px 16px;\r\n  margin-top: 8px;\r\n  padding: 16px 12px;\r\n  background: #fff;\r\n  .message-tabs {\r\n    display: flex;\r\n    align-items: center;\r\n    color: #8c8c8c;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n    .tab-item {\r\n      cursor: pointer;\r\n      &.active {\r\n        font-weight: 600;\r\n      }\r\n    }\r\n    .v-line {\r\n      width: 1px;\r\n      height: 14px;\r\n      background: #d9d9d9;\r\n      margin: 0 16px;\r\n    }\r\n  }\r\n  .message-content {\r\n    color: #1a1a1a;\r\n    font-size: 14px;\r\n    line-height: 20px;\r\n  }\r\n  .message-menus {\r\n    .menu-item {\r\n      line-height: 22px;\r\n      margin-top: 8px;\r\n      font-size: 14px;\r\n      border-radius: 4px;\r\n      color: rgb(22, 71, 153);\r\n      cursor: pointer;\r\n      background: #e6efff;\r\n      padding: 6px 12px;\r\n    }\r\n  }\r\n}\r\n</style>","<style lang=\"less\" scoped>\r\n\r\n</style>\r\n\r\n<template>\r\n  <div class=\"text-message\">\r\n    {{ message }}\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  const props = defineProps({\r\n    message: String,\r\n  })\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.message-list-wrapper {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.scroll-box {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow-y: auto;\r\n\r\n  &::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n}\r\n\r\n.markdown-content{\r\n  white-space: normal;\r\n}\r\n\r\n.msg-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  max-width: 300px;\r\n  max-height: 300px;\r\n}\r\n\r\n.message-list {\r\n  .message-item {\r\n    display: flex;\r\n    margin-top: 24px;\r\n\r\n    .user-avatar,\r\n    .robot-avatar {\r\n      display: block;\r\n      width: 32px;\r\n      height: 32px;\r\n      border-radius: 50%;\r\n    }\r\n\r\n    .itme-left {\r\n      margin-right: 8px;\r\n    }\r\n\r\n    .itme-right {\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n\r\n  .user-message {\r\n    .item-body {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .message-content {\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #3a4559;\r\n      white-space: pre-wrap;\r\n    }\r\n  }\r\n\r\n  .robot-message {\r\n    .item-body {\r\n      padding: 12px 16px;\r\n      border-radius: 8px;\r\n      width: auto;\r\n      min-height: 32px;\r\n      max-width: 100%;\r\n      overflow: hidden;\r\n      background-color: #fff;\r\n    }\r\n\r\n    .message-content {\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #3a4559;\r\n      white-space: pre-wrap;\r\n    }\r\n  }\r\n\r\n  .message-menus {\r\n    .menu-item {\r\n      line-height: 22px;\r\n      padding: 8px 16px;\r\n      margin-top: 8px;\r\n      font-size: 14px;\r\n      border-radius: 4px;\r\n      color: rgb(22, 71, 153);\r\n      background: #f2f4f7;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n.message-action-wrap {\r\n  .message-action {\r\n    display: flex;\r\n    padding-top: 12px;\r\n    margin-top: 12px;\r\n    border-top: 1px solid #edeff2;\r\n\r\n      .action-btn {\r\n        position: relative;\r\n        padding: 0 8px;\r\n        line-height: 22px;\r\n        font-size: 14px;\r\n        font-weight: 400;\r\n        color: #7a8699;\r\n        cursor: pointer;\r\n        &::before {\r\n          display: block;\r\n          position: absolute;\r\n          content: ' ';\r\n          right: 0;\r\n          top: 5px;\r\n          width: 1px;\r\n          height: 12px;\r\n          background-color: rgba(5, 5, 5, 0.06);\r\n        }\r\n        &:last-child::before {\r\n          display: none;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .file-items {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 12px 24px;\r\n    line-height: 22px;\r\n    font-weight: 400;\r\n    color: #164799;\r\n    font-size: 14px;\r\n    padding-bottom: 12px;\r\n    border-bottom: 1px solid #edeff2;\r\n    margin-bottom: 12px;\r\n    .file-name {\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: baseline;\r\n      gap: 4px;\r\n      color: #164799;\r\n      position: relative;\r\n      .svg-action {\r\n        position: relative;\r\n        top: 2px;\r\n      }\r\n    }\r\n  }\r\n  .label-flex-block {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n  .thinking-label-wrapper {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 8px;\r\n\r\n    .thinking-label {\r\n      display: flex;\r\n      align-items: center;\r\n      height: 32px;\r\n      padding: 0 16px;\r\n      border-radius: 8px;\r\n      background: #e4e6eb;\r\n      cursor: pointer;\r\n      transition: all 0.2s;\r\n\r\n      &:hover {\r\n        background: #d8dde6;\r\n      }\r\n      .think-icon,\r\n      .loading {\r\n        margin-right: 8px;\r\n        font-size: 16px;\r\n        color: #262626;\r\n      }\r\n      .label-text {\r\n        font-size: 14px;\r\n        font-weight: 400;\r\n        color: #262626;\r\n      }\r\n      .arrow-down {\r\n        margin-left: 8px;\r\n        font-size: 16px;\r\n        color: #262626;\r\n        cursor: pointer;\r\n      }\r\n    }\r\n    .tip {\r\n      margin-left: 8px;\r\n      font-size: 16px;\r\n      color: #8c8c8c;\r\n      cursor: pointer;\r\n    }\r\n\r\n    &.reasoning_open {\r\n      .arrow-down {\r\n        transform: rotate(180deg);\r\n      }\r\n    }\r\n  }\r\n\r\n  .thinking-content {\r\n    position: relative;\r\n    line-height: 22px;\r\n    padding-bottom: 0;\r\n    padding-left: 16px;\r\n    margin-bottom: 12px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    color: #8c8c8c;\r\n    border-bottom: 1px solid #edeff2;\r\n    // 4px竖线\r\n    &::before {\r\n      display: block;\r\n      position: absolute;\r\n      content: '';\r\n      left: 0;\r\n      top: 4px;\r\n      bottom: 20px;\r\n      width: 4px;\r\n      background-color: #d9d9d9;\r\n    }\r\n  }\r\n\r\n  .reply-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8px;\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n.reply-url .url-link {\r\n  color: #2475fc;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 20px;\r\n  text-decoration: none;\r\n}\r\n\r\n.reply-url .url-row {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n  .reply-card .card-row {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n  }\r\n\r\n  .reply-card .card-title-box {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 4px;\r\n  }\r\n\r\n  .reply-card .card-thumb {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 50%;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .reply-card .card-title {\r\n    color: #595959;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n  }\r\n\r\n  .reply-imageText .imageText-row {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n  }\r\n\r\n  .reply-imageText .imageText-thumb {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 6px;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .reply-imageText .imageText-text {\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .reply-imageText .imageText-title {\r\n    color: #595959;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n  }\r\n\r\n  .reply-imageText .imageText-desc {\r\n    color: #8c8c8c;\r\n    font-size: 12px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 16px;\r\n  }\r\n\r\n  .reply-item {\r\n    border-radius: 4px 16px 16px 16px;\r\n    padding: 16px 12px;\r\n    background: #fff;\r\n  }\r\n\r\n  .reply-image .msg-img {\r\n    max-width: 500px;\r\n  }\r\n\r\n  .reply-smartMenu {\r\n    color: #1a1a1a;\r\n    .smart-menu-box {\r\n      .card-title {\r\n        white-space: pre-wrap;\r\n        align-self: stretch;\r\n        font-size: 14px;\r\n        font-style: normal;\r\n        font-weight: 400;\r\n        line-height: 20px;\r\n        margin-bottom: 14px;\r\n      }\r\n      .card-text {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 10px;\r\n        .reply-line {\r\n          line-height: 22px;\r\n          .line-text {\r\n            color: #3a4559;\r\n          }\r\n          .empty-line {\r\n            height: 22px;\r\n          }\r\n          .link {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"message-list-wrapper\">\r\n    <div class=\"scroll-box\" ref=\"scrollBoxRef\" @scroll=\"onScroll\">\r\n      <div class=\"message-list\">\r\n        <template v-for=\"item in props.messages\" :key=\"item.uid\">\r\n          <!-- 用户的消息 -->\r\n          <div\r\n            class=\"message-item user-message\"\r\n            :id=\"'msg-' + item.uid\"\r\n            v-if=\"item.is_customer == 1\"\r\n            :data-msg_type=\"item.msg_type\"\r\n          >\r\n            <div class=\"itme-left\">\r\n              <img class=\"user-avatar\" :src=\"item.avatar\" />\r\n            </div>\r\n            <div class=\"itme-right\">\r\n              <div class=\"item-body\">\r\n                <!-- 收到消息类型处理，目前只处理了image 后续有其他的在这里添加 -->\r\n                <template v-if=\"item.msg_type == 3\">\r\n                  <div class=\"message-content\">\r\n                    <img v-viewer class=\"msg-img\" :src=\"item.media_id_to_oss_url\" alt=\"\" />\r\n                  </div>\r\n                </template>\r\n                <template v-else-if=\"item.msg_type == 99\">\r\n                  <div class=\"message-content\">\r\n                    <MultipleMessage :message=\"item.content\" />\r\n                  </div>\r\n                </template>\r\n                <template v-else>\r\n                  <TextMessage class=\"message-content\" :message=\"item.content\" />\r\n                </template>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <!-- 机器人的消息 -->\r\n          <div class=\"message-item robot-message\" :id=\"'msg-' + item.uid\" v-else>\r\n            <div class=\"itme-left\">\r\n              <a-spin size=\"small\" :spinning=\"item.loading\">\r\n                <img class=\"robot-avatar\" :src=\"item.robot_avatar\" />\r\n              </a-spin>\r\n            </div>\r\n\r\n            <div class=\"itme-right\">\r\n              <template v-if=\"parseReplyList(item.reply_content_list).length\">\r\n                <div class=\"reply-list\">\r\n                  <template v-for=\"(rc, idx) in parseReplyList(item.reply_content_list)\" :key=\"idx\">\r\n                    <div v-if=\"(rc.reply_type || rc.type) === 'text'\" class=\"reply-item reply-text\">\r\n                      <div class=\"message-content\" v-html=\"rc.description\"></div>\r\n                    </div>\r\n                    <div v-else-if=\"(rc.reply_type || rc.type) === 'image'\" class=\"reply-item reply-image\">\r\n                      <div class=\"message-content\">\r\n                        <img v-viewer class=\"msg-img\" :src=\"rc.pic || rc.thumb_url\" />\r\n                      </div>\r\n                    </div>\r\n                    <div v-else-if=\"(rc.reply_type || rc.type) === 'url'\" class=\"reply-item reply-url\">\r\n                      <div class=\"url-row\">\r\n                        <a class=\"url-link\" :href=\"rc.url\" target=\"_blank\">{{ rc.url }}</a>\r\n                      </div>\r\n                    </div>\r\n                    <div v-else-if=\"(rc.reply_type || rc.type) === 'card'\" class=\"reply-item reply-card\">\r\n                      <div class=\"card-row\">\r\n                        <img v-if=\"rc.thumb_url\" :src=\"rc.thumb_url\" class=\"card-thumb\" />\r\n                        <div class=\"card-title-box\">\r\n                          <svg-icon class=\"think-icon\" name=\"applet\"></svg-icon>\r\n                          <span class=\"card-title\">{{ rc.title }}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'imageText'\" class=\"reply-item reply-imageText\">\r\n                    <a class=\"imageText-row\" :href=\"rc.url\" target=\"_blank\">\r\n                      <img v-if=\"rc.thumb_url\" :src=\"rc.thumb_url\" class=\"imageText-thumb\" />\r\n                      <div class=\"imageText-text\">\r\n                        <div class=\"imageText-title\">{{ rc.title }}</div>\r\n                        <div class=\"imageText-desc\">{{ rc.description }}</div>\r\n                      </div>\r\n                    </a>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'smartMenu'\" class=\"reply-item reply-smartMenu\">\r\n                    <div class=\"smart-menu-box\">\r\n                      <div class=\"card-title\" v-if=\"rc.smart_menu && rc.smart_menu.menu_description\">{{ rc.smart_menu.menu_description }}</div>\r\n                      <div class=\"card-text\">\r\n                        <template v-for=\"(line, li) in buildMenuLines(rc.smart_menu?.menu_content || [])\" :key=\"li\">\r\n                          <div class=\"reply-line\" @click=\"onSmartReplyLineClick($event)\">\r\n                            <span class=\"line-text\" v-if=\"line.kind === 'text'\">{{ line.text }}</span>\r\n                            <div v-else-if=\"line.kind === 'newline'\" class=\"empty-line\"></div>\r\n                            <span v-else-if=\"line.kind === 'html'\" v-html=\"line.html\"></span>\r\n                            <a v-else-if=\"line.kind === 'keyword'\" href=\"javascript:;\" class=\"link\" @click.prevent=\"onClickSmartMenuKeyword(line.text)\">\r\n                              <div v-if=\"line.serial_no\">{{ line.serial_no }}</div>\r\n                              {{ line.text }}\r\n                            </a>\r\n                          </div>\r\n                        </template>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  </template>\r\n                </div>\r\n              </template>\r\n              <div class=\"label-flex-block\">\r\n                <div class=\"thinking-label-wrapper\" v-if=\"tips_before_answer_switch && item.startLoading\">\r\n                  <div class=\"thinking-label\">\r\n                    <LoadingOutlined class=\"loading\" />\r\n                    <span class=\"label-text\">{{ tips_before_answer_content }}</span>\r\n                  </div>\r\n                </div>\r\n                <div\r\n                  class=\"thinking-label-wrapper\"\r\n                  :class=\"{ reasoning_open: item.show_quote_file }\"\r\n                  v-if=\"item.msg_type == 1 && isShowQuoteFileProgress && (!item.startLoading || !tips_before_answer_switch)\"\r\n                >\r\n                  <div class=\"thinking-label\" @click=\"toggleQuoteFiel(item)\">\r\n                    <template v-if=\"item.quote_loading\">\r\n                      <LoadingOutlined class=\"loading\" />\r\n                      <span class=\"label-text\">{{ t('label_retrieving_knowledge_base') }}</span>\r\n                    </template>\r\n                    <template v-if=\"!item.quote_loading\">\r\n                      <svg-icon class=\"think-icon\" name=\"quote-file\"></svg-icon>\r\n                      <span class=\"label-text\">{{ t('label_retrieved_knowledge_base_docs', { count: item.quote_file.length }) }}</span>\r\n                    </template>\r\n                    <svg-icon\r\n                      name=\"arrow-down\"\r\n                      class=\"arrow-down\"\r\n                      v-if=\"item.quote_file.length\"\r\n                    ></svg-icon>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- 思考过程label -->\r\n                <div\r\n                  class=\"thinking-label-wrapper\"\r\n                  :class=\"{ reasoning_open: item.show_reasoning }\"\r\n                  v-if=\"item.reasoning_content\"\r\n                >\r\n                  <div class=\"thinking-label\" @click=\"toggleReasonProcess(item)\">\r\n                    <LoadingOutlined class=\"loading\" v-if=\"item.reasoning_status\" />\r\n                    <svg-icon class=\"think-icon\" name=\"think\" v-else></svg-icon>\r\n                    <span class=\"label-text\">{{\r\n                      item.reasoning_status ? t('label_thinking') : t('label_thinking_completed')\r\n                    }}</span>\r\n\r\n                    <svg-icon\r\n                      name=\"arrow-down\"\r\n                      class=\"arrow-down\"\r\n                      v-if=\"!item.reasoning_status\"\r\n                    ></svg-icon>\r\n                  </div>\r\n                  <a-tooltip>\r\n                    <template #title>{{ t('msg_disable_reasoning_tooltip') }}</template>\r\n                    <InfoCircleOutlined class=\"tip\" />\r\n                  </a-tooltip>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"item-body\" v-if=\"isShowBody(item)\">\r\n                <div\r\n                  class=\"file-items\"\r\n                  v-if=\"item.show_quote_file && item.quote_file && item.quote_file.length > 0\"\r\n                >\r\n                  <div\r\n                    class=\"file-item\"\r\n                    v-for=\"file in item.quote_file\"\r\n                    :key=\"file.id\"\r\n                    @click=\"openLibrary(item.quote_file, file, item.id)\"\r\n                  >\r\n                    <a class=\"file-name\">\r\n                      <svg-icon class=\"think-icon\" name=\"quote-file\"></svg-icon>\r\n                      <span v-if=\"file.file_name\">{{ file.file_name }}</span>\r\n                      <span v-else>{{ file.library_name }}-{{ t('library_featured') }}</span>\r\n                    </a>\r\n                  </div>\r\n                </div>\r\n                <div class=\"thinking-content\" v-if=\"item.show_reasoning && item.reasoning_content\">\r\n                  <cherry-markdown :content=\"item.reasoning_content\"></cherry-markdown>\r\n                </div>\r\n                <template v-if=\"item.msg_type == 1\">\r\n                  <div class=\"message-content\" v-viewer>\r\n                    <cherry-markdown :content=\"item.content\"></cherry-markdown>\r\n                  </div>\r\n                  <div class=\"message-menus\">\r\n                    <div\r\n                      class=\"menu-item\"\r\n                      @click=\"onClickMeun(item)\"\r\n                      v-for=\"(item, index) in item.question\"\r\n                      :key=\"index\"\r\n                    >\r\n                      {{ item }}\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n\r\n                <template v-if=\"item.msg_type == 2\">\r\n                  <cherry-markdown class=\"markdown-content\" :content=\"item.menu_json.content\" v-if=\"item.isWelcome\"></cherry-markdown>\r\n                  <div class=\"message-content\" v-html=\"item.menu_json.content\" v-else></div>\r\n                  <div class=\"message-menus\">\r\n                    <div\r\n                      class=\"menu-item\"\r\n                      @click=\"onClickMeun(item)\"\r\n                      v-for=\"(item, index) in item.menu_json.question\"\r\n                      :key=\"index\"\r\n                    >\r\n                      {{ item }}\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n\r\n                <template v-if=\"item.msg_type == 3\">\r\n                  <div class=\"message-content\">\r\n                    <img v-viewer class=\"msg-img\" :src=\"item.content\" alt=\"\" />\r\n                  </div>\r\n                </template>\r\n\r\n                <div\r\n                  class=\"message-action-wrap\"\r\n                  v-if=\"showQuoteFileBox(item)\"\r\n                  v-show=\"!item.question\"\r\n                >\r\n                  <div class=\"message-action\" v-if=\"item.debug && item.debug.length > 0\">\r\n                    <div class=\"action-btn\">\r\n                      <span><a @click=\"openPromptLog(item)\">{{ t('btn_prompt_log') }}</a></span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <!-- 语音消息 -->\r\n              <div v-if=\"item.voice_content && item.voice_content.length\">\r\n                <VoiceMessage :voice_content=\"item.voice_content\" />\r\n              </div>\r\n              <GuessYouWant\r\n                v-if=\"\r\n                  ((item.guess_you_want && item.guess_you_want.length) ||\r\n                    (common_question_list.length &&\r\n                      props.robotInfo.enable_common_question == 'true')) &&\r\n                  item.question_tabkey > 0\r\n                \"\r\n                :item=\"item\"\r\n                :enable_common_question=\"props.robotInfo.enable_common_question == 'true'\"\r\n                :common_question_list=\"common_question_list\"\r\n                @clickMeun=\"onClickMeun\"\r\n              ></GuessYouWant>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, nextTick, toRaw, computed } from 'vue'\r\nimport { LoadingOutlined, InfoCircleOutlined } from '@ant-design/icons-vue'\r\nimport CherryMarkdown from '@/components/cherry-markdown/index.vue'\r\nimport GuessYouWant from './guess-you-want.vue'\r\nimport VoiceMessage from './voice-message.vue'\r\nimport TextMessage from './messages/text-message.vue'\r\nimport MultipleMessage from './messages/multiple-message.vue'\r\nimport { useRobotStore } from '@/stores/modules/robot'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.message-list')\r\nconst robotStore = useRobotStore()\r\n\r\nconst tips_before_answer_content = computed(()=>{\r\n  return robotStore.robotInfo.tips_before_answer_content\r\n})\r\n\r\nconst tips_before_answer_switch = computed(()=>{\r\n  return robotStore.robotInfo.tips_before_answer_switch == 'true'\r\n})\r\n\r\n\r\nconst emit = defineEmits([\r\n  'clickMsgMeun',\r\n  'scroll',\r\n  'scrollStart',\r\n  'scrollEnd',\r\n  'openPromptLog',\r\n  'openLibrary'\r\n])\r\n\r\nconst props = defineProps({\r\n  messages: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  robotInfo: {\r\n    type: Object,\r\n    default: () => {}\r\n  }\r\n})\r\n\r\nconst toggleReasonProcess = (item) => {\r\n  item.show_reasoning = !item.show_reasoning\r\n}\r\n\r\nconst toggleQuoteFiel = (item) => {\r\n  item.show_quote_file = !item.show_quote_file\r\n}\r\n\r\nconst common_question_list = computed(() => {\r\n  if (props.robotInfo.common_question_list.length) {\r\n    return JSON.parse(props.robotInfo.common_question_list)\r\n  }\r\n  return []\r\n})\r\n\r\nconst isShowQuoteFileProgress = computed(() => {\r\n  // 普通机器人才显示\r\n  return (props.robotInfo.chat_type == 1 || props.robotInfo.chat_type == 3) && props.robotInfo.application_type == '0'\r\n})\r\n\r\nconst onClickMeun = (item) => {\r\n  emit('clickMsgMeun', item)\r\n}\r\n\r\nconst scrollBoxRef = ref(null)\r\nconst scrollOption = {\r\n  scrollTop: 0,\r\n  scrollHeight: 0,\r\n  clientHeight: 0,\r\n  scrollStartDiff: 60,\r\n  scrollEndDiff: 60,\r\n  scrollDirection: '' // 滚动方向\r\n}\r\n\r\nlet scrollEventTimer = null // 滚动条防抖\r\nlet onScrollEventLock = false // 时间触发锁\r\n\r\n// 监听滚动条滚动\r\nfunction onScroll(e) {\r\n  if (onScrollEventLock) {\r\n    return\r\n  }\r\n\r\n  if (scrollEventTimer) {\r\n    clearTimeout(scrollEventTimer)\r\n    scrollEventTimer = null\r\n  }\r\n\r\n  scrollEventTimer = setTimeout(() => {\r\n    if (scrollOption.scrollTop - e.target.scrollTop > 0) {\r\n      scrollOption.scrollDirection = 'up'\r\n    }\r\n\r\n    if (scrollOption.scrollTop - e.target.scrollTop < 0) {\r\n      scrollOption.scrollDirection = 'down'\r\n    }\r\n\r\n    scrollOption.scrollTop = e.target.scrollTop\r\n    scrollOption.scrollHeight = e.target.scrollHeight\r\n    scrollOption.clientHeight = e.target.clientHeight\r\n\r\n    emit('scroll', { ...scrollOption })\r\n    // 触顶\r\n    let isAtTop = Math.abs(scrollOption.scrollTop) <= scrollOption.scrollStartDiff\r\n\r\n    if (isAtTop && scrollOption.scrollDirection === 'up') {\r\n      onScrollStart()\r\n    }\r\n    // 触底\r\n    let isAtBottom =\r\n      Math.abs(scrollOption.scrollHeight - scrollOption.scrollTop - scrollOption.clientHeight) <=\r\n      scrollOption.scrollEndDiff\r\n\r\n    if (isAtBottom && scrollOption.scrollDirection === 'down') {\r\n      onScrollEnd()\r\n    }\r\n  }, 50)\r\n}\r\n\r\nfunction onScrollStart() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.messages.length == 0) {\r\n    return\r\n  }\r\n  emit('scrollStart', {\r\n    msg: props.messages[0]\r\n  })\r\n}\r\n\r\nfunction onScrollEnd() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.messages.length == 0) {\r\n    return\r\n  }\r\n  emit('scrollEnd', {\r\n    msg: props.messages[props.messages.length - 1]\r\n  })\r\n}\r\n\r\nconst scrollToBottom = () => {\r\n  if (!scrollBoxRef.value) {\r\n    return\r\n  }\r\n  nextTick(() => {\r\n    // 手动控制滚动到底部不触发触底事件\r\n    onScrollEventLock = true\r\n\r\n    scrollBoxRef.value.scrollTop = scrollBoxRef.value.scrollHeight + 1\r\n    setTimeout(() => {\r\n      scrollOption.scrollTop = scrollBoxRef.value.scrollTop\r\n      onScrollEventLock = false\r\n    }, 50)\r\n  })\r\n}\r\n\r\nfunction scrollToMessage(id, direction) {\r\n  nextTick(() => {\r\n    // 手动控制滚动到底部不触发触底事件\r\n    onScrollEventLock = true\r\n\r\n    if (!direction) {\r\n      direction = 'top'\r\n    }\r\n\r\n    let scroller = scrollBoxRef.value\r\n    let element = document.querySelector('#msg-' + id)\r\n\r\n    if (direction == 'top') {\r\n      scroller.scrollTop = element.offsetTop\r\n    } else {\r\n      scroller.scrollTop = element.offsetTop - scroller.clientHeight + element.clientHeight\r\n    }\r\n\r\n    setTimeout(() => {\r\n      scrollOption.scrollTop = scrollBoxRef.value.scrollTop\r\n      onScrollEventLock = false\r\n    }, 50)\r\n  })\r\n}\r\n\r\n// 重置滚动条状态\r\nfunction resetScroll() {\r\n  scrollOption.scrollTop = 0\r\n  scrollOption.scrollDirection = ''\r\n}\r\n\r\nfunction showQuoteFileBox(item) {\r\n  if (item.quote_file && item.quote_file.length > 0) {\r\n    return true\r\n  }\r\n\r\n  if (item.debug && item.debug.length > 0) {\r\n    return true\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n// 打开Prompt日志\r\nfunction openPromptLog(item) {\r\n  emit('openPromptLog', toRaw(item))\r\n}\r\n\r\n// 打开知识库\r\nfunction openLibrary(files, file, message_id) {\r\n  let newfiles = toRaw(files)\r\n  file.message_id = file.message_id || message_id\r\n  newfiles.forEach((item) => {\r\n    item.message_id = item.message_id || message_id\r\n  })\r\n\r\n  emit('openLibrary', newfiles, toRaw(file))\r\n}\r\n\r\nfunction parseReplyList(val) {\r\n  try {\r\n    if (!val) return []\r\n    if (Array.isArray(val)) return val\r\n    if (typeof val === 'string') return JSON.parse(val || '[]')\r\n    return []\r\n  } catch (_e) {\r\n    return []\r\n  }\r\n}\r\n\r\nfunction buildMenuLines(menu_content) {\r\n  const out = []\r\n  ;(Array.isArray(menu_content) ? menu_content : []).forEach((mc) => {\r\n    const t = String(mc?.menu_type || '')\r\n    const txt = String(mc?.content || '')\r\n    if (t === '0') {\r\n      if (txt === '') { out.push({ kind: 'newline' }) }\r\n      else if (/<a[\\s\\S]*?<\\/a>/.test(txt)) {\r\n        const sanitized = /href\\s*=\\s*['\"]\\s*#\\s*['\"]/i.test(txt)\r\n          ? txt.replace(/href\\s*=\\s*['\"]\\s*#\\s*['\"]/ig, 'href=\"javascript:;\"')\r\n          : txt.replace(/href=/ig, 'target=\"_blank\" href=')\r\n        out.push({ kind: 'html', html: sanitized })\r\n      } else { out.push({ kind: 'text', text: txt }) }\r\n    } else if (t === '1') { out.push({ kind: 'keyword', text: txt, serial_no: mc?.serial_no || '' }) }\r\n  })\r\n  return out.slice(0, 20)\r\n}\r\n\r\nfunction onSmartReplyLineClick(e) {\r\n  const a = e.target?.closest?.('a')\r\n  if (!a) return\r\n  const href = String(a.getAttribute('href') || '')\r\n  if (href === '#' || href === 'javascript:;') { e.preventDefault(); e.stopPropagation() }\r\n}\r\n\r\nfunction onClickSmartMenuKeyword(text) {\r\n  const t = String(text || '').trim()\r\n  if (!t) return\r\n  emit('clickMsgMeun', t)\r\n}\r\n\r\nconst isShowBody = (item) => {\r\n  if(parseReplyList(item.reply_content_list).length && item.content == ''){\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\ndefineExpose({\r\n  scrollToBottom,\r\n  scrollToMessage,\r\n  resetScroll\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.chat-list-box {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n\r\n  .chat-list-item {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 40px;\r\n    line-height: 40px;\r\n    padding: 0 24px;\r\n    cursor: pointer;\r\n\r\n    &:hover {\r\n      background-color: #edeff2;\r\n    }\r\n\r\n    &.active {\r\n      background-color: #edeff2;\r\n      border: 1px solid #d8dde5;\r\n    }\r\n  }\r\n\r\n  .chat-item-icon {\r\n    margin-right: 8px;\r\n    font-size: 16px;\r\n    color: rgb(58, 69, 89);\r\n  }\r\n\r\n  .chat-item-title {\r\n    flex: 1;\r\n    font-size: 14px;\r\n    color: rgb(58, 69, 89);\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"chat-list-box\">\r\n    <cu-scroll ref=\"scroller\" @onScrollEnd=\"onScrollEnd\">\r\n      <div>\r\n        <div\r\n          class=\"chat-list-item\"\r\n          :class=\"{ active: item.id == props.active }\"\r\n          @click=\"handleOpenChat(item)\"\r\n          v-for=\"item in props.list\"\r\n          :key=\"item.id\"\r\n        >\r\n          <svg-icon class=\"chat-item-icon\" name=\"message\"></svg-icon>\r\n          <span class=\"chat-item-title\">{{ item.subject || item.last_chat_message }}</span>\r\n        </div>\r\n      </div>\r\n    </cu-scroll>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { nextTick, ref, watch } from 'vue'\r\nimport CuScroll from '@/components/cu-scroll/cu-scroll.vue'\r\n\r\nconst emit = defineEmits(['openChat', 'onScrollEnd'])\r\n\r\nconst props = defineProps({\r\n  list: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  active: {\r\n    type: [String, Number],\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst scroller = ref(null)\r\n\r\nconst handleOpenChat = (item) => {\r\n  emit('openChat', item)\r\n}\r\n\r\nconst onScrollEnd = () => {\r\n  emit('onScrollEnd')\r\n}\r\n\r\nwatch(\r\n  () => props.list,\r\n  () => {\r\n    nextTick(() => {\r\n      scroller.value.refresh()\r\n    })\r\n  }\r\n)\r\n</script>\r\n","<template>\r\n  <div class=\"file-toolbar\">\r\n    <div class=\"toolbar-left\">\r\n      <div class=\"file-list\">\r\n        <div\r\n          v-for=\"(file, index) in fileList\"\r\n          :key=\"index\"\r\n          class=\"file-item\"\r\n          :class=\"{\r\n            'uploading': file.status === 'uploading',\r\n            'error': file.status === 'error'\r\n          }\"\r\n        >\r\n          <span class=\"delete-btn action-btn\" v-if=\"file.status == 'done' || file.status == 'error'\">\r\n            <CloseOutlined class=\"delete-icon\" @click=\"handleDelete(index)\" />\r\n          </span>\r\n          <span class=\"preview-btn action-btn\" v-if=\"file.status == 'done'\">\r\n            <svg-icon class=\"preview-icon\" name=\"eye-open\" @click=\"handlePreview(index)\"></svg-icon>\r\n          </span>\r\n\r\n          <img :src=\"file.url\" alt=\"avatar\" />\r\n          <div class=\"mask\"></div>\r\n          <div v-if=\"file.status === 'uploading'\" class=\"progress-bar\">\r\n            <div class=\"progress\" :style=\"{ width: file.percent + '%' }\"></div>\r\n          </div>\r\n          <div v-if=\"file.status === 'error'\" class=\"error-text\">上传失败</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { CloseOutlined } from '@ant-design/icons-vue'\r\nimport { api as viewerApi } from \"v-viewer\"\r\nimport { computed } from 'vue'\r\n\r\nconst props = defineProps({\r\n  fileList: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n\r\n// 事件处理\r\nconst emit = defineEmits(['add', 'delete'])\r\n\r\nconst images = computed(() => props.fileList.map(i => i.url))\r\n\r\nconst handlePreview = (index) => {\r\n  const viewer = viewerApi({\r\n    options: {\r\n      toolbar: true,\r\n      initialViewIndex: index\r\n    },\r\n    index: index,\r\n    images: images.value,\r\n  })\r\n  viewer.show()\r\n}\r\n\r\nconst handleDelete = (index) => {\r\n  emit('delete', index)\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.file-toolbar {\r\n  display: flex;\r\n  align-items: center;\r\n  background-color: #fff;\r\n\r\n  .toolbar-left {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n  }\r\n}\r\n\r\n.file-list {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.file-item {\r\n  position: relative;\r\n  flex-shrink: 0;\r\n  width: 62px;\r\n  height: 62px;\r\n  border-radius: 5px;\r\n  cursor: pointer;\r\n  border: 1px dashed #d9d9d9;\r\n\r\n  .action-btn{\r\n    display: none;\r\n  }\r\n\r\n  &:hover .action-btn{\r\n    display: block;\r\n  }\r\n  .delete-btn{\r\n    position: absolute;\r\n    top: -5px;\r\n    right: -5px;\r\n    z-index: 10;\r\n  }\r\n  .delete-icon {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 20px;\r\n    height: 20px;\r\n    color: white;\r\n    border-radius: 50%;\r\n    font-size: 10px;\r\n    background: #1E2226;\r\n  }\r\n\r\n  .preview-btn{\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    z-index: 10;\r\n    font-size: 16px;\r\n    color: #fff;\r\n\r\n    .preview-icon {\r\n      font-size: 20px;\r\n    }\r\n  }\r\n\r\n  img {\r\n    width: 100%;\r\n    height: 100%;\r\n    border-radius: 5px;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .mask {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    border-radius: 6px;\r\n    opacity: 0;\r\n    transition: opacity 0.3s;\r\n    background-color: rgba(0, 0, 0, 0.7);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n\r\n  &:hover .mask {\r\n    opacity: 1;\r\n  }\r\n\r\n  &.uploading {\r\n    img {\r\n      filter: blur(2px);\r\n    }\r\n    .progress-bar {\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      z-index: 10;\r\n      width: 90%;\r\n      height: 4px;\r\n      background-color: rgba(0, 0, 0, 0.4);\r\n      border-radius: 2px;\r\n      .progress {\r\n        height: 100%;\r\n        background-color: #2475FC;\r\n        border-radius: 2px;\r\n        transition: width 0.3s;\r\n      }\r\n    }\r\n  }\r\n\r\n  &.error {\r\n    .mask{\r\n      display: block;\r\n      opacity: 1;\r\n    }\r\n    .error-text {\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      color: white;\r\n      font-size: 12px;\r\n      text-align: center;\r\n      white-space: nowrap;\r\n    }\r\n  }\r\n\r\n  &.add-item {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border: 1px dashed #d9d9d9;\r\n    background-color: #fafafa;\r\n    font-size: 18px;\r\n    color: #666;\r\n    &:hover {\r\n      border-color: #1890ff;\r\n      color: #1890ff;\r\n    }\r\n  }\r\n}\r\n</style>","import { ref, onUnmounted } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { uploadFile } from '@/api/app'\r\nimport { generateRandomId } from '@/utils/index'\r\n\r\n// 真实上传任务\r\nconst uploadFileFetch = (file, fileList, category) => {\r\n  return new Promise((resolve, reject) => {\r\n    uploadFile({\r\n      file: file.originFile,\r\n      category: category\r\n    }, (progressEvent) => {\r\n      const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);\r\n      \r\n      // 更新文件列表中的进度\r\n      const currentFile = fileList.value.find(f => f.uid === file.uid);\r\n      if (currentFile) {\r\n        const updatedFile = { ...currentFile, percent: percentCompleted };\r\n        const index = fileList.value.findIndex(f => f.uid === file.uid);\r\n        if (index !== -1) {\r\n          fileList.value.splice(index, 1, updatedFile);\r\n        }\r\n      }\r\n    }).then((res) => {\r\n      // 上传成功\r\n      const currentFile = fileList.value.find(f => f.uid === file.uid);\r\n      if (currentFile) {\r\n        const updatedFile = { \r\n          ...currentFile, \r\n          percent: 100, \r\n          status: 'done', \r\n          url: res.data.link || '' \r\n        };\r\n        const index = fileList.value.findIndex(f => f.uid === file.uid);\r\n        if (index !== -1) {\r\n          fileList.value.splice(index, 1, updatedFile);\r\n        }\r\n        resolve(updatedFile);\r\n      }\r\n    }).catch((error) => {\r\n      // 上传失败\r\n      const currentFile = fileList.value.find(f => f.uid === file.uid);\r\n      if (currentFile) {\r\n        const updatedFile = { ...currentFile, status: 'error' };\r\n        const index = fileList.value.findIndex(f => f.uid === file.uid);\r\n        if (index !== -1) {\r\n          fileList.value.splice(index, 1, updatedFile);\r\n        }\r\n      }\r\n      reject(error);\r\n    });\r\n  });\r\n}\r\n\r\nexport function useUpload(options) {\r\n  const {\r\n    limit = 10,\r\n    maxSize = 10, // MB\r\n    accept = 'image/*',\r\n    multiple = true,\r\n    category,\r\n    fileList = ref([])\r\n  } = options || {}\r\n\r\n  if(!category){\r\n    throw new Error('category is required')\r\n  }\r\n\r\n  let inputEl = null;\r\n\r\n  const handleFileChange = (event) => {\r\n    let files = Array.from(event.target.files)\r\n    const remainingSlots = limit - fileList.value.length\r\n\r\n    if (remainingSlots <= 0) {\r\n      message.error(`最多只能上传 ${limit} 张图片`)\r\n      return\r\n    }\r\n\r\n    if (files.length > remainingSlots) {\r\n      files = files.slice(0, remainingSlots)\r\n      message.error(`最多只能上传 ${limit} 张图片，已为您选择前 ${remainingSlots} 张`)\r\n    }\r\n\r\n    files.forEach((file) => {\r\n      const isLtMaxSize = file.size / 1024 / 1024 < maxSize;\r\n      if (!isLtMaxSize) {\r\n        message.error(`文件大小不能超过 ${maxSize}MB!`);\r\n        return;\r\n      }\r\n      // 检查文件类型\r\n      const fileType = file.type;\r\n      const acceptedTypes = accept.split(',').map(t => t.trim());\r\n      const isTypeValid = acceptedTypes.some(acceptedType => {\r\n        if (acceptedType.endsWith('/*')) {\r\n          return fileType.startsWith(acceptedType.slice(0, -1));\r\n        }\r\n        return fileType === acceptedType;\r\n      });\r\n\r\n      if (!isTypeValid) {\r\n        message.error(`不支持的文件类型: ${fileType}`);\r\n        return;\r\n      }\r\n\r\n      const fileItem = {\r\n        uid: file.uid || generateRandomId(16),\r\n        name: file.name,\r\n        status: 'uploading',\r\n        percent: 0,\r\n        originFile: file,\r\n        url: URL.createObjectURL(file) // 生成临时的 URL\r\n      }\r\n\r\n      fileList.value.push(fileItem)\r\n\r\n      uploadFileFetch(fileItem, fileList, category)\r\n        .then((res) => {\r\n          const index = fileList.value.findIndex((item) => item.uid === res.uid)\r\n          if (index !== -1) {\r\n            fileList.value.splice(index, 1, res)\r\n          }\r\n        })\r\n        .catch(() => {\r\n          const index = fileList.value.findIndex((item) => item.uid === fileItem.uid)\r\n          if (index !== -1) {\r\n            fileList.value[index].status = 'error'\r\n          }\r\n        })\r\n    })\r\n\r\n    // 清空 input 的 value，以便可以再次选择相同的文件\r\n    event.target.value = ''\r\n  }\r\n\r\n  const createInputElement = () => {\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    input.accept = accept;\r\n    input.multiple = multiple;\r\n    input.style.display = 'none';\r\n    input.onchange = handleFileChange;\r\n    document.body.appendChild(input);\r\n    return input;\r\n  }\r\n\r\n  const openFileDialog = () => {\r\n    if (fileList.value.length >= limit) {\r\n      message.error(`最多只能上传 ${limit} 张图片`);\r\n      return;\r\n    }\r\n    if (!inputEl) {\r\n      inputEl = createInputElement();\r\n    }\r\n    inputEl.click();\r\n  }\r\n\r\n  onUnmounted(() => {\r\n    if (inputEl && document.body.contains(inputEl)) {\r\n      document.body.removeChild(inputEl);\r\n      inputEl = null;\r\n    }\r\n  });\r\n\r\n  return {\r\n    openFileDialog,\r\n  }\r\n}","<template>\r\n  <div class=\"message-input-wrapper\">\r\n    <div class=\"file-toolbar-box\" v-if=\"props.fileList.length > 0\">\r\n      <FileToolbar :file-list=\"props.fileList\" @delete=\"deleteFile\" />\r\n    </div>\r\n    <div class=\"message-input-box\">\r\n      <a-textarea\r\n        class=\"message-input\"\r\n        :value=\"props.value\"\r\n        :placeholder=\"t('ph_input_content')\"\r\n        :auto-size=\"{ minRows: 2, maxRows: 5 }\"\r\n        @change=\"onChange\"\r\n        @keydown=\"handleKeydown\"\r\n      />\r\n    </div>\r\n    <div class=\"message-action\">\r\n      <div class=\"select-file-btn\" @click=\"openFileDialog\" v-if=\"props.showUpload\">\r\n        <svg-icon class=\"select-file-icon\" name=\"circularNeedle\"></svg-icon>\r\n        <span class=\"file-number\" :class=\"{ big: fileList.length > 9 }\" v-if=\"fileList.length > 0\">{{ fileList.length }}</span>\r\n      </div>\r\n\r\n      <button\r\n        class=\"send-msg-btn\"\r\n        :class=\"{ loading: props.loading }\"\r\n        :disabled=\"disabled\"\r\n        @click=\"sendMessage\"\r\n      >\r\n        <a-spin size=\"small\" class=\"loading-action\" style=\"margin-right: 4px\" v-if=\"props.loading\" />\r\n        <svg-icon class=\"paper-airplane\" name=\"paper-airplane\" v-else></svg-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, toRefs } from 'vue'\r\nimport FileToolbar from './file-toolbar.vue'\r\nimport { useUpload } from '@/hooks/web/useUpload.js'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.message-input')\r\n\r\nconst emit = defineEmits(['send', 'update:value', 'update:fileList'])\r\n\r\nconst props = defineProps({\r\n  value: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  loading: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  fileList: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  showUpload: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n})\r\n\r\nconst { fileList } = toRefs(props)\r\n\r\nconst { openFileDialog } = useUpload({\r\n  limit: 10,\r\n  maxSize: 10,\r\n  category: 'chat_image',\r\n  fileList: fileList,\r\n  multiple: true,\r\n  accept: 'image/bmp,image/jpeg,image/png,image/tiff,image/heic,image/gif,image/webp'\r\n})\r\n\r\nconst deleteFile = (index) => {\r\n  const newFileList = props.fileList.filter((_, i) => i !== index);\r\n  emit('update:fileList', newFileList);\r\n}\r\n\r\nconst disabled = computed(() => {\r\n  if(props.fileList.length > 0){\r\n    return false\r\n  }\r\n\r\n  return props.loading || props.value.trim().length === 0\r\n})\r\n\r\nconst onChange = (e) => {\r\n  emit('update:value', e.target.value.trim())\r\n}\r\n\r\nconst handleKeydown = (event) => {\r\n  // 键盘 enter事件 和 enter+shift 组合键 绑定事件\r\n  if (event.key === 'Enter' && !event.shiftKey) {\r\n    // 只按下了 Enter 键\r\n    if (!event.target.value.trim()) {\r\n      return\r\n    }\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    sendMessage()\r\n  } else if (event.key === 'Enter' && event.shiftKey) {\r\n    // 同时按下了 Shift 和 Enter 键\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    emit('update:value', props.value + '\\n')\r\n  }\r\n}\r\n\r\nconst sendMessage = () => {\r\n  emit('send', props.value.trim())\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.message-input-wrapper {\r\n  position: relative;\r\n  border-radius: 20px;\r\n  border: 1px solid #d9d9d9;\r\n  overflow: hidden;\r\n  padding: 12px;\r\n  background-color: #fff;\r\n\r\n  .file-toolbar-box{\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .message-input-box {\r\n    padding: 0 0 12px 0;\r\n  }\r\n\r\n  .message-input {\r\n    width: 100%;\r\n    padding: 0;\r\n    line-height: 24px;\r\n    border: none !important;\r\n    outline: none !important;\r\n    resize: none !important;\r\n    box-shadow: none !important;\r\n  }\r\n\r\n  .message-action {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-end;\r\n  }\r\n\r\n  .send-msg-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 32px;\r\n    height: 32px;\r\n    padding: 0;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    border-radius: 4px;\r\n    border: none;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    color: #2475fc;\r\n    border-radius: 50%;\r\n    background: none;\r\n\r\n    &:hover {\r\n      opacity: 0.8;\r\n    }\r\n    &:disabled {\r\n      opacity: 0.5;\r\n    }\r\n    .paper-airplane {\r\n      font-size: 32px;\r\n    }\r\n\r\n    &.loading {\r\n      background-color: #2475fc;\r\n    }\r\n    .loading-action{\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      margin-left: 3px;\r\n      ::v-deep(.ant-spin-dot-item) {\r\n        background-color: #fff;\r\n      }\r\n    }\r\n    \r\n  }\r\n\r\n  .select-file-btn {\r\n    position: relative;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 32px;\r\n    height: 32px;\r\n    padding: 0;\r\n    margin-right: 8px;\r\n    border-radius: 50%;\r\n    border: none;\r\n    background: #fff;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    border: 1px solid #f0f0f0;\r\n\r\n    &:hover {\r\n      background: #e4e6eb;\r\n    }\r\n\r\n    .select-file-icon {\r\n      font-size: 16px;\r\n      color: #595959;\r\n    }\r\n\r\n    .file-number{\r\n      position: absolute;\r\n      right: -8px;\r\n      top: -8px;\r\n      width: 16px;\r\n      height: 16px;\r\n      border-radius: 50%;\r\n      background: #f00;\r\n      color: #fff;\r\n      font-size: 12px;\r\n      font-weight: 400;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n\r\n      &.big{\r\n        width: auto;\r\n        padding: 0 4px;\r\n        border-radius: 12px;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>","<style lang=\"less\" scoped>\r\n.prompt-log-alert {\r\n  .close-btn {\r\n    font-size: 16px;\r\n    color: rgba(0, 0, 0, 0.45);\r\n    cursor: pointer;\r\n  }\r\n\r\n  .prompt-log-content {\r\n    .prompt-log-items {\r\n      margin-bottom: 24px;\r\n    }\r\n    .prompt-log-label {\r\n      margin-bottom: 4px;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      line-height: 24px;\r\n      color: rgb(0, 0, 0);\r\n    }\r\n\r\n    .prompt-log-item {\r\n      line-height: 22px;\r\n      padding: 12px 16px;\r\n      margin-bottom: 8px;\r\n      font-size: 14px;\r\n      color: #3a4559;\r\n      background-color: #f2f4f7;\r\n      border-radius: 4px;\r\n      white-space: pre-wrap;\r\n\r\n      &:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <a-drawer\r\n    class=\"prompt-log-alert\"\r\n    v-model:open=\"show\"\r\n    :title=\"t('title_prompt_log')\"\r\n    placement=\"right\"\r\n    width=\"746px\"\r\n    :closable=\"false\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"close-btn\" @click=\"onClose\"><CloseOutlined /></span>\r\n    </template>\r\n\r\n    <div class=\"prompt-log-content\" ref=\"contRef\">\r\n      <div class=\"prompt-log-items\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_prompt') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_prompt_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.prompt }}</p>\r\n        </div>\r\n\r\n        <div class=\"prompt-log-item\" v-for=\"(item, index) in promptLog.library\" :key=\"index\">\r\n          <p>{{ item }}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_context') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_context_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\" v-for=\"(item, index) in promptLog.context_qa\" :key=\"index\">\r\n          <p>Q：{{ item.question }}</p>\r\n          <p>A：{{ item.answer }}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_user') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_user_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.cur_question }}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_assistant') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_assistant_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.cur_answer }}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\" v-if=\"promptLog.recall_time > 0\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_recall_time') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_recall_time_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.recall_time }}s</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\" v-if=\"promptLog.request_time > 0\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_request_time') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_request_time_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.request_time }}s</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"prompt-log-items\">\r\n        <div class=\"prompt-log-label\">\r\n          <span>{{ t('label_error') }} </span>\r\n          <a-tooltip>\r\n            <template #title>{{ t('msg_error_tooltip') }}</template>\r\n            <QuestionCircleOutlined class=\"question-icon\" />\r\n          </a-tooltip>\r\n        </div>\r\n        <div class=\"prompt-log-item\">\r\n          <p>{{ promptLog.error }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </a-drawer>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref } from 'vue'\r\nimport { CloseOutlined, QuestionCircleOutlined } from '@ant-design/icons-vue'\r\nimport { useMathJax } from \"@/composables/useMathJax.js\";\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.prompt-log-alert')\r\n\r\nconst {renderMath} = useMathJax()\r\n\r\nconst contRef = ref(null)\r\nconst show = ref(false)\r\nconst promptLog = reactive({\r\n  prompt: '',\r\n  library: [],\r\n  context_qa: [],\r\n  cur_question: '',\r\n  cur_answer: '',\r\n  error: ''\r\n})\r\n\r\nconst onClose = () => {\r\n  show.value = false\r\n}\r\n\r\nconst reset = () => {\r\n  promptLog.prompt = ''\r\n  promptLog.library = []\r\n  promptLog.context_qa = []\r\n  promptLog.cur_question = ''\r\n  promptLog.cur_answer = ''\r\n  promptLog.error = ''\r\n  promptLog.recall_time = ''\r\n  promptLog.request_time = ''\r\n}\r\n\r\nconst open = (msg) => {\r\n  reset()\r\n  promptLog.error = msg.error\r\n  promptLog.recall_time = msg.recall_time ?  (msg.recall_time / 1000).toFixed(2) : '';\r\n  promptLog.request_time = msg.request_time ? (msg.request_time / 1000).toFixed(2) : '';\r\n\r\n  let items = msg.debug || []\r\n\r\n  for (let i = 0; i < items.length; i++) {\r\n    let item = items[i]\r\n\r\n    if (item.type == 'library') {\r\n      promptLog.library.push(item.content)\r\n    } else if (item.type == 'context_qa') {\r\n      promptLog.context_qa.push(item)\r\n    } else {\r\n      promptLog[item.type] = item.content\r\n    }\r\n  }\r\n\r\n  show.value = true\r\n  renderMath(contRef.value)\r\n}\r\n\r\ndefineExpose({\r\n  open\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.library-info-alert {\r\n  .close-btn {\r\n    font-size: 16px;\r\n    color: rgba(0, 0, 0, 0.45);\r\n    cursor: pointer;\r\n  }\r\n\r\n  .library-info-content {\r\n    .file-list {\r\n      font-size: 0;\r\n      width: 100%;\r\n      overflow: hidden;\r\n      overflow-x: auto;\r\n      white-space: nowrap;\r\n\r\n      .file-item {\r\n        display: inline-block;\r\n        line-height: 22px;\r\n        padding: 5px 16px;\r\n        margin-right: 8px;\r\n        font-size: 14px;\r\n        border-radius: 2px;\r\n        color: #595959;\r\n        border: 1px solid #d9d9d9;\r\n        white-space: nowrap;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n\r\n        &.active {\r\n          color: #2475fc;\r\n          border: 1px solid #2475fc;\r\n          background-color: #f5f9ff;\r\n        }\r\n      }\r\n    }\r\n\r\n    .document-items {\r\n      .document-item {\r\n        padding: 16px;\r\n        margin-top: 8px;\r\n        border-radius: 2px;\r\n        background-color: #ffffff;\r\n      }\r\n\r\n      .document-item-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        height: 22px;\r\n        line-height: 22px;\r\n      }\r\n\r\n      .document-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #000000;\r\n        padding-right: 8px;\r\n      }\r\n\r\n      .document-size {\r\n        font-size: 14px;\r\n        color: #8c8c8c;\r\n      }\r\n      .right-box{\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n\r\n      .document-similarity {\r\n        margin-top: 4px;\r\n        font-size: 14px;\r\n        color: #8c8c8c;\r\n        display: flex;\r\n        align-items: center;\r\n        .svg-action{\r\n          margin-right: 4px;\r\n        }\r\n      }\r\n\r\n      .document-content {\r\n        line-height: 22px;\r\n        margin-top: 8px;\r\n        font-size: 14px;\r\n        color: #595959;\r\n        white-space: pre-wrap;\r\n      }\r\n      .fragment-img {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 8px;\r\n        margin-top: 8px;\r\n        img {\r\n          width: 80px;\r\n          height: 80px;\r\n          border-radius: 6px;\r\n          cursor: pointer;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.iframe-box{\r\n  width: 100%;\r\n  height: 620px;\r\n}\r\n</style>\r\n\r\n<template>\r\n  <a-drawer\r\n    class=\"library-info-alert\"\r\n    v-model:open=\"show\"\r\n    :title=\"t('title_answer_source')\"\r\n    placement=\"right\"\r\n    width=\"746px\"\r\n    :closable=\"false\"\r\n    :bodyStyle=\"{ background: '#F2F4F7' }\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"close-btn\" @click=\"onClose\"><CloseOutlined /></span>\r\n    </template>\r\n\r\n    <div class=\"library-info-content\">\r\n      <div class=\"file-list\">\r\n        <div\r\n          class=\"file-item\"\r\n          :class=\"{ active: activeFileId == file.id }\"\r\n          v-for=\"file in fileList\"\r\n          :key=\"file.id\"\r\n          @click=\"chagenFile(file)\"\r\n        >\r\n          <span v-if=\"file.file_name\">{{ file.file_name }}</span>\r\n          <span v-else>{{ file.library_name }}-{{ t('label_selected') }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"document-items\" ref=\"docBoxRef\">\r\n        <div class=\"document-item\" v-for=\"item in documentList\" :key=\"item.id\">\r\n          <div class=\"document-item-header\">\r\n            <div class=\"left-box\">\r\n              <span class=\"document-title\">{{ t('label_id') }}{{ item.id }}</span>\r\n              <span class=\"document-title\" v-if=\"item.title\">{{ item.title }}</span>\r\n              <span class=\"document-size\"> {{ t('label_characters_count', { count: item.word_total }) }} </span>\r\n            </div>\r\n            <div class=\"right-box\">\r\n              <a @click=\"viewSourceFile(item)\" v-if=\"item.page_num > 0\">{{ t('btn_preview_original_file') }}&gt;</a>\r\n              <a @click=\"toSource\">{{ t('btn_view_source_document') }}&gt;</a>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"document-item-body\">\r\n            <div class=\"document-similarity\">\r\n              {{ t('label_similarity') }} <svg-icon name=\"similarity\" style=\"font-size: 16px\"></svg-icon\r\n              >{{ item.similarity }}\r\n            </div>\r\n            <div class=\"document-content\" v-if=\"item.question\">{{ t('label_question') }}{{ item.question }}</div>\r\n            <div class=\"document-content\" v-if=\"item.answer\">{{ t('label_answer') }}{{ item.answer }}</div>\r\n            <div class=\"document-content\">\r\n              {{ item.content }}\r\n            </div>\r\n            <div class=\"fragment-img\" v-viewer>\r\n              <img v-for=\"(item, index) in item.images\" :key=\"index\" :src=\"item\" alt=\"\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </a-drawer>\r\n  <a-modal v-model:open=\"viewOpen\" :title=\"viewTitle\" :footer=\"null\" :width=\"740\">\r\n    <div class=\"iframe-box\">\r\n      <CuScroll>\r\n        <VuePdfEmbed :source=\"sourceUrl\"  />\r\n      </CuScroll>\r\n    </div>\r\n  </a-modal>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed} from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { CloseOutlined } from '@ant-design/icons-vue'\r\nimport { getAnswerSource } from '@/api/chat/index'\r\nimport VuePdfEmbed from 'vue-pdf-embed'\r\nimport { useChatStore } from '@/stores/modules/chat'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { useMathJax } from \"@/composables/useMathJax.js\";\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.library-info-alert')\r\n\r\nconst chatStore = useChatStore()\r\nconst { robot, user } = chatStore\r\nconst router = useRouter()\r\nconst { renderMath } = useMathJax()\r\n\r\nconst docBoxRef = ref(null)\r\nconst show = ref(false)\r\n\r\nconst fileList = ref([])\r\nconst activeFileId = ref(null)\r\n\r\nconst reset = () => {\r\n  fileList.value = []\r\n  activeFileId.value = null\r\n}\r\n\r\nconst open = (files, file) => {\r\n  reset()\r\n  fileList.value = files.map(item => {\r\n    let answer_source_data = null;\r\n    if(item.answer_source_data){\r\n      answer_source_data = JSON.parse(item.answer_source_data)\r\n    }\r\n    return {\r\n      ...item,\r\n      answer_source_data,\r\n    }\r\n  })\r\n  activeFileId.value = file.id\r\n  show.value = true\r\n  console.log(files, file)\r\n  if(file.answer_source_data){\r\n    documentList.value = JSON.parse(file.answer_source_data) || []\r\n    return\r\n  }\r\n  getDocumentList(file)\r\n}\r\n\r\nconst chagenFile = (file) => {\r\n  if (file.id == activeFileId.value) {\r\n    return\r\n  }\r\n\r\n  activeFileId.value = file.id\r\n\r\n  if(file.answer_source_data){\r\n    documentList.value = file.answer_source_data || []\r\n    return\r\n  }\r\n\r\n  getDocumentList(file)\r\n}\r\n\r\nconst documentList = ref([])\r\n\r\nconst getDocumentList = (file) => {\r\n  getAnswerSource({\r\n    message_id: file.message_id,\r\n    file_id: file.id,\r\n    robot_key: robot.robot_key,\r\n    openid: robot.openid,\r\n  }).then((res) => {\r\n    documentList.value = res.data || []\r\n    renderMath(docBoxRef.value)\r\n  })\r\n}\r\n\r\n// 查看原文档\r\nconst toSource = () => {\r\n  let currentItem = fileList.value.filter(item => item.id == activeFileId.value)[0] || {}\r\n  if(currentItem.file_name){\r\n    window.open(`#/library/preview?id=${activeFileId.value}`)\r\n  }else{\r\n    window.open(`#/library/details/categary-manage?id=${currentItem.library_id}`)\r\n  }\r\n}\r\n\r\nconst viewTitle = computed(()=>{\r\n  let currentItem = fileList.value.filter(item => item.id == activeFileId.value)[0] || {}\r\n  if(currentItem.file_name){\r\n    return currentItem.file_name\r\n  }\r\n  return currentItem.library_name + '-' + t('label_selected')\r\n})\r\nconst sourceUrl = ref('')\r\nconst viewOpen = ref(false)\r\nconst viewSourceFile = (item) => {\r\n  console.log(robot)\r\n  viewOpen.value = true;\r\n  sourceUrl.value = '/manage/getLibRawFileOnePage?id=' + activeFileId.value + '&page=' + item.page_num + '&admin_user_id=' + user.admin_user_id\r\n}\r\n\r\nconst onClose = () => {\r\n  show.value = false\r\n}\r\n\r\ndefineExpose({\r\n  open\r\n})\r\n</script>\r\n","export default \"__VITE_ASSET__BOkMqs37__\"","<template>\r\n  <a-modal\r\n    wrapClassName=\"variable-modal-class\"\r\n    v-model:open=\"open\"\r\n    :title=\"null\"\r\n    :footer=\"null\"\r\n    :closable=\"isEdit\"\r\n    :maskClosable=\"false\"\r\n    :width=\"560\"\r\n  >\r\n    <div class=\"modal-header\">\r\n      <div class=\"banner-bg\">\r\n        <img src=\"@/assets/img/form-modal-header.png\" alt=\"\" />\r\n      </div>\r\n      <div class=\"title\">{{ t('title_fill_info') }}</div>\r\n    </div>\r\n    <div class=\"form-body\">\r\n      <a-form :model=\"formState\" ref=\"formRef\" layout=\"vertical\">\r\n        <!-- 字段名 -->\r\n        <a-form-item\r\n          v-for=\"item in wait_variables\"\r\n          :key=\"item.variable_key\"\r\n          :label=\"item.variable_type == 'checkbox_switch' ? null : item.variable_name\"\r\n          :name=\"item.variable_key\"\r\n          :rules=\"[{ required: item.must_input == 1, message: t('msg_input_required', { name: item.variable_name }) }]\"\r\n        >\r\n          <template v-if=\"item.variable_type == 'input_string'\">\r\n            <a-input\r\n              v-model:value=\"formState[item.variable_key]\"\r\n              :maxLength=\"getLength(item)\"\r\n              :placeholder=\"t('ph_input')\"\r\n            />\r\n          </template>\r\n          <template v-if=\"item.variable_type == 'input_number'\">\r\n            <a-input-number\r\n              style=\"width: 100%\"\r\n              v-model:value=\"formState[item.variable_key]\"\r\n              stringMode\r\n              :maxLength=\"50\"\r\n              :placeholder=\"t('ph_input')\"\r\n            />\r\n          </template>\r\n          <template v-if=\"item.variable_type == 'select_one'\">\r\n            <a-select v-model:value=\"formState[item.variable_key]\" style=\"width: 100%\">\r\n              <a-select-option\r\n                v-for=\"option in item.options\"\r\n                :value=\"option.label\"\r\n                :key=\"option.label\"\r\n                >{{ option.label }}</a-select-option\r\n              >\r\n            </a-select>\r\n          </template>\r\n          <template v-if=\"item.variable_type == 'checkbox_switch'\">\r\n            <a-checkbox v-model:checked=\"formState[item.variable_key]\">{{\r\n              item.variable_name\r\n            }}</a-checkbox>\r\n          </template>\r\n        </a-form-item>\r\n      </a-form>\r\n    </div>\r\n    <div class=\"from-footer\">\r\n      <div class=\"btn-box\">\r\n        <a-button @click=\"handleSave\" block type=\"primary\">{{ t('btn_submit') }}</a-button>\r\n      </div>\r\n    </div>\r\n  </a-modal>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, reactive } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useChatStore } from '@/stores/modules/chat'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.variable-modal.index')\r\nconst query = useRoute().query\r\n\r\nconst isEdit = ref(false)\r\n\r\nconst chatStore = useChatStore()\r\nconst chat_variables = computed(() => {\r\n  return chatStore.chat_variables || {}\r\n})\r\n\r\nconst wait_variables = computed(() => {\r\n  let list = chat_variables.value.wait_variables || []\r\n  return list.map((item) => {\r\n    return {\r\n      ...item,\r\n      options: item.options ? JSON.parse(item.options) : []\r\n    }\r\n  })\r\n})\r\n\r\nconst fill_variables = computed(() => {\r\n  return chat_variables.value.fill_variables || []\r\n})\r\n\r\nconst need_fill_variable = computed(() => {\r\n  return chat_variables.value.need_fill_variable || false\r\n})\r\n\r\nconst open = ref(false)\r\n\r\nconst formState = reactive({})\r\n\r\nconst handleEdit = () => {\r\n  isEdit.value = true\r\n  fill_variables.value.forEach((item) => {\r\n    if (item.variable_type == 'input_string' || item.variable_type == 'input_number') {\r\n      // 文本 数字\r\n      formState[item.variable_key] = item.value || ''\r\n    }\r\n\r\n    if (item.variable_type == 'select_one') {\r\n      // 下拉单选\r\n      formState[item.variable_key] = item.value || void 0\r\n    }\r\n\r\n    if (item.variable_type == 'checkbox_switch') {\r\n      // 文本\r\n      formState[item.variable_key] = item.value == 1\r\n    }\r\n  })\r\n  open.value = true\r\n}\r\n\r\nconst initData = (list) => {\r\n  list.forEach((item) => {\r\n    if (item.variable_type == 'input_string' || item.variable_type == 'input_number') {\r\n      // 文本 数字\r\n      formState[item.variable_key] = item.default_value || ''\r\n    }\r\n\r\n    if (item.variable_type == 'select_one') {\r\n      // 下拉单选\r\n      formState[item.variable_key] = item.default_value || void 0\r\n    }\r\n\r\n    if (item.variable_type == 'checkbox_switch') {\r\n      // 文本\r\n      formState[item.variable_key] = item.default_value == 1\r\n    }\r\n  })\r\n}\r\n\r\nconst getLength = (item) => {\r\n  if (item.max_input_length > 0) {\r\n    return +item.max_input_length\r\n  }\r\n  return 50\r\n}\r\n\r\nwatch(\r\n  () => wait_variables.value,\r\n  (val) => {\r\n    val && initData(wait_variables.value)\r\n  },\r\n  {\r\n    deep: true\r\n  }\r\n)\r\n\r\nwatch(\r\n  () => need_fill_variable.value,\r\n  (val) => {\r\n    if (val) {\r\n      isEdit.value = false\r\n      open.value = true\r\n    }\r\n  },\r\n  {\r\n    deep: true,\r\n    immediate: true\r\n  }\r\n)\r\n\r\nconst formRef = ref(null)\r\n\r\nconst handleSave = () => {\r\n  formRef.value.validate().then(() => {\r\n    let chat_prompt_variables = getPostData()\r\n    let variables_key = `chat_prompt_variables_${query.robot_key}`\r\n\r\n    if (isEdit.value) {\r\n      chatStore.handleEditVariables({\r\n        chat_prompt_variables\r\n      })\r\n    } else {\r\n      localStorage.setItem(variables_key, JSON.stringify(chat_prompt_variables))\r\n    }\r\n    open.value = false\r\n  })\r\n}\r\n\r\nfunction getPostData() {\r\n  let list = wait_variables.value\r\n\r\n  return list.map((item) => {\r\n    let value = formState[item.variable_key]\r\n    if (item.variable_type == 'checkbox_switch') {\r\n      value = value ? 1 : 0\r\n    }\r\n    return {\r\n      ...item,\r\n      value\r\n    }\r\n  })\r\n}\r\n\r\ndefineExpose({\r\n  handleEdit\r\n})\r\n</script>\r\n<style lang=\"less\">\r\n.variable-modal-class .ant-modal .ant-modal-content {\r\n  padding: 0;\r\n}\r\n</style>\r\n\r\n<style lang=\"less\" scoped>\r\n.modal-header {\r\n  height: 76px;\r\n  display: flex;\r\n  align-items: center;\r\n  position: relative;\r\n  .title {\r\n    position: relative;\r\n    z-index: 9;\r\n    padding-left: 24px;\r\n    color: #000000;\r\n    font-size: 24px;\r\n    font-weight: 600;\r\n  }\r\n  .banner-bg {\r\n    height: 96px;\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    top: -20px;\r\n    overflow: hidden;\r\n    img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n.form-body {\r\n  padding: 16px 24px 0 24px;\r\n  max-height: 500px;\r\n  overflow-y: auto;\r\n  &::v-deep(.ant-form-item) {\r\n    margin-bottom: 16px;\r\n  }\r\n}\r\n.from-footer {\r\n  padding: 8px 24px 24px 24px;\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.chat-page-wrapper {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  border-radius: 2px;\r\n  overflow: hidden;\r\n  background-color: #f5f9ff;\r\n}\r\n.chat-page-header {\r\n  padding: 0 24px;\r\n  .breadcrumb-box {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 56px;\r\n  }\r\n}\r\n.chat-page {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  flex: 1;\r\n  padding: 24px;\r\n  overflow: hidden;\r\n\r\n  .page-body {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-flow: column nowrap;\r\n    max-width: 46.6%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n\r\n    .chat-box-body {\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n  .page-left,\r\n  .page-right {\r\n    width: 280px;\r\n    height: 100%;\r\n    border-radius: 8px;\r\n    overflow-y: auto;\r\n    background-color: #fafafa;\r\n    box-shadow: 0 2px 16px 0 rgba(14, 27, 58, 0.16);\r\n  }\r\n\r\n  .page-left {\r\n    display: flex;\r\n    flex-flow: column nowrap;\r\n    padding: 24px 0;\r\n\r\n    .page-left-top,\r\n    .page-left-footer {\r\n      padding: 0 24px;\r\n    }\r\n\r\n    .page-left-top {\r\n      margin-bottom: 15px;\r\n    }\r\n\r\n    .page-left-body {\r\n      position: relative;\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n}\r\n\r\n.page-right {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  justify-content: space-between;\r\n  padding: 24px;\r\n\r\n  .prompt-tips {\r\n    line-height: 22px;\r\n    padding: 16px;\r\n    font-size: 14px;\r\n    border-radius: 4px;\r\n    color: #3a4559;\r\n    background: #f2f4f7;\r\n  }\r\n}\r\n\r\n.form-banner-top{\r\n  padding: 16px;\r\n  border-radius: 12px;\r\n  border: 2px solid var(--10, #FFF);\r\n  height: 56px;\r\n  background: linear-gradient(180deg, #EBF2FF 0%, #FFF 22.78%);\r\n  box-shadow: 0 4px 24px 0 #00000014;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  .title{\r\n    font-weight: 600;\r\n    color: #000000;\r\n    font-size: 16px;\r\n  }\r\n  .edit-block{\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    color: #2475fc;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    padding: 1px 8px;\r\n    &:hover{\r\n      background: var(--07, #E4E6EB);\r\n      border-radius: 6px;\r\n    }\r\n  }\r\n}\r\n\r\n</style>\r\n\r\n<template>\r\n  <div class=\"chat-page-wrapper\">\r\n    <div class=\"chat-page-header\">\r\n      <div class=\"breadcrumb-box\">\r\n        <a-breadcrumb>\r\n          <a-breadcrumb-item\r\n            ><router-link to=\"/robot/list\">{{ t('breadcrumb_robot_management') }}</router-link></a-breadcrumb-item\r\n          >\r\n          <a-breadcrumb-item>{{ robot.robot_name }}</a-breadcrumb-item>\r\n        </a-breadcrumb>\r\n      </div>\r\n    </div>\r\n    <div class=\"chat-page\">\r\n      <!-- left -->\r\n      <div class=\"page-left\">\r\n        <div class=\"page-left-top\">\r\n          <a-button type=\"primary\" block ghost @click=\"openNewChat\"\r\n            ><PlusOutlined /> {{ t('btn_new_chat') }}</a-button\r\n          >\r\n        </div>\r\n        <div class=\"page-left-body\">\r\n          <ChatList\r\n            :list=\"myChatList\"\r\n            :active=\"dialogue_id\"\r\n            @openChat=\"handleOpenChat\"\r\n            @onScrollEnd=\"onChatListScrollEnd\"\r\n          />\r\n        </div>\r\n        <div class=\"page-left-footer\"></div>\r\n      </div>\r\n      <!-- body -->\r\n      <div class=\"page-body\">\r\n        <div class=\"form-banner-top\" v-if=\"isShowFromHeader\">\r\n          <div class=\"title\">{{ t('title_form_info') }}</div>\r\n          <div class=\"edit-block\" @click=\"handleEditVariableForm\">\r\n            <EditOutlined />{{ t('btn_edit') }}\r\n          </div>\r\n        </div>\r\n        <div class=\"chat-box-body\">\r\n          <MessageList\r\n            ref=\"messageListRef\"\r\n            :messages=\"messageList\"\r\n            :robotInfo=\"robotInfo\"\r\n            @clickMsgMeun=\"onClickMsgMenu\"\r\n            @scrollStart=\"onScrollStart\"\r\n            @scrollEnd=\"onScrollEnd\"\r\n            @openPromptLog=\"handleOpenPromptLog\"\r\n            @openLibrary=\"handleOpenLibraryInfo\"\r\n          />\r\n        </div>\r\n\r\n        <div style=\"padding-top: 30px\" class=\"chat-box-footer\">\r\n          <MessageInput\r\n            v-model:value=\"message\"\r\n            v-model:fileList=\"fileList\"\r\n            :loading=\"sendLoading\"\r\n            :showUpload=\"robotInfo.question_multiple_switch == 1\"\r\n            @send=\"onSendMesage\" />\r\n        </div>\r\n      </div>\r\n      <!-- right -->\r\n      <div>\r\n        <RobotTestRight\r\n          v-if=\"false\"\r\n          @promptChange=\"onPromptChange\"\r\n          @saveRobotPrompt=\"onSaveRobotPrompt\"\r\n          :robotInfo=\"robotInfo\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <PromptLogAlert ref=\"promptLogAlertRef\" />\r\n\r\n    <libraryInfoAlert ref=\"libraryInfoAlertRef\" />\r\n    <VariableModal ref=\"variableModalRef\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { generateRandomId } from '@/utils/index'\r\nimport { ref, computed, onMounted, watch, onUnmounted, createVNode, toRaw } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { storeToRefs } from 'pinia'\r\nimport { useEventBus } from '@/hooks/event/useEventBus'\r\nimport { useChatStore } from '@/stores/modules/chat'\r\nimport { useUserStore } from '@/stores/modules/user'\r\nimport { ExclamationCircleOutlined, PlusOutlined, EditOutlined } from '@ant-design/icons-vue'\r\nimport { Modal, message as antMessage } from 'ant-design-vue'\r\nimport { showErrorMsg, showSuccessMsg } from '@/utils/index'\r\nimport MessageList from './components/message-list.vue'\r\nimport ChatList from './components/chat-list.vue'\r\nimport RobotTestRight from './components/robot-test-right.vue'\r\nimport MessageInput from './components/message-input.vue'\r\nimport PromptLogAlert from './components/prompt-log-alert.vue'\r\nimport libraryInfoAlert from './components/library-info-alert.vue'\r\nimport VariableModal from './components/variable-modal/index.vue'\r\nimport { saveRobot, checkChatRequestPermission } from '@/api/robot/index'\r\nimport { useRobotStore } from '@/stores/modules/robot'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.index')\r\n\r\n\r\nconst rotue = useRoute()\r\nconst query = rotue.query\r\n\r\nconst robotStore = useRobotStore()\r\n\r\nconst { getRobot } = robotStore\r\n\r\nconst robotInfo = computed(() => robotStore.robotInfo)\r\nconst emitter = useEventBus()\r\nconst chatStore = useChatStore()\r\nconst userStore = useUserStore()\r\n// 是否允许自动滚动到底部\r\nlet isAllowedScrollToBottom = true\r\nconst message = ref('')\r\nconst fileList = ref([])\r\nconst messageListRef = ref(null)\r\n\r\nconst {\r\n  createChat,\r\n  sendMessage,\r\n  getMyChatList,\r\n  openChat,\r\n  onGetChatMessage,\r\n  changeRobotPrompt,\r\n  $reset\r\n} = chatStore\r\nconst { messageList, sendLock, myChatList, robot, dialogue_id } = storeToRefs(chatStore)\r\n\r\nconst isShowFromHeader = computed(()=>{\r\n  return !chatStore.chat_variables.need_fill_variable && chatStore.chat_variables.fill_variables && chatStore.chat_variables.fill_variables.length\r\n})\r\n\r\nconst route = useRoute()\r\nconst isRobotInfo = ref(false)\r\nconst checkChatRequestPermissionLoding = ref(false)\r\nconst sendLoading = computed(() => sendLock.value || checkChatRequestPermissionLoding.value)\r\n\r\nconst onSendMesage = async () => {\r\n  if (sendLoading.value){\r\n    return\r\n  }\r\n\r\n  if (!message.value && !fileList.value.length) {\r\n    return showErrorMsg(t('msg_please_input_message'))\r\n  }\r\n\r\n  checkChatRequestPermissionLoding.value = true\r\n\r\n  try {\r\n    //检查是否含有敏感词\r\n  let result = await checkChatRequestPermission({\r\n    robot_key: robot.value.robot_key,\r\n    openid: robot.value.openid,\r\n    question: message.value,\r\n    form_ids: robot.value.form_ids,\r\n    dialogue_id: dialogue_id.value,\r\n  })\r\n\r\n  checkChatRequestPermissionLoding.value = false\r\n\r\n  if(result.data && result.data.words){\r\n    return antMessage.error(t('msg_sensitive_words', { words: result.data.words.join(';') }))\r\n  }\r\n\r\n  let msg_type = 1;\r\n  let msg = message.value;\r\n\r\n  if(robotInfo.value.question_multiple_switch == 1){\r\n    let messageList = []\r\n\r\n    msg_type = 99;\r\n\r\n    if(message.value){\r\n      messageList = [{\r\n        type: \"text\",\r\n        uid: generateRandomId(16),\r\n        text: message.value\r\n      }]\r\n    }\r\n\r\n    if(fileList.value.length){\r\n      fileList.value.map((file) => {\r\n        messageList.push({\r\n          uid: file.uid,\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: file.url\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    msg = JSON.stringify(messageList)\r\n  }\r\n\r\n\r\n\r\n\r\n  isAllowedScrollToBottom = true\r\n\r\n  sendMessage({\r\n    message: msg,\r\n    global: JSON.stringify(query),\r\n    msg_type: msg_type\r\n  })\r\n\r\n  message.value = ''\r\n  fileList.value = []\r\n  }catch(err){\r\n    checkChatRequestPermissionLoding.value = false\r\n  }\r\n\r\n}\r\n\r\nconst openNewChat = async () => {\r\n  isAllowedScrollToBottom = true\r\n  message.value = ''\r\n\r\n  let query = route.query || {}\r\n  let user_id = userStore.user_id\r\n\r\n  let data = {\r\n    robot_key: query.robot_key,\r\n    avatar: query.avatar,\r\n    name: query.name,\r\n    nickname: query.nickname,\r\n    is_background: 1,\r\n    openid: user_id,\r\n    dialogue_id: 0\r\n  }\r\n\r\n  resetScroll()\r\n\r\n  await createChat(data)\r\n}\r\n\r\nconst handleOpenChat = async (data) => {\r\n  if (dialogue_id.value == data.dialogue_id) {\r\n    return\r\n  }\r\n\r\n  isAllowedScrollToBottom = true\r\n\r\n  let query = route.query || {}\r\n\r\n  let params = {\r\n    robot_key: query.robot_key,\r\n    avatar: data.avatar,\r\n    name: data.name,\r\n    nickname: data.nickname,\r\n    is_background: data.is_background,\r\n    openid: data.openid,\r\n    dialogue_id: data.id\r\n  }\r\n\r\n  resetScroll()\r\n\r\n  await openChat(params)\r\n\r\n  let res = await onGetChatMessage()\r\n  if (res) {\r\n    messageListScrollToBottom()\r\n  }\r\n}\r\n\r\n// 点击菜单\r\nconst onClickMsgMenu = (text) => {\r\n  isAllowedScrollToBottom = true\r\n\r\n  sendMessage({\r\n    message: text\r\n  })\r\n}\r\n\r\nconst saveLoading = ref(false)\r\n\r\nconst saveForm = (formState) => {\r\n  let formData = JSON.parse(JSON.stringify(toRaw(formState)))\r\n  saveLoading.value = true\r\n  let welcomes = formData.welcomes\r\n\r\n  welcomes.question = welcomes.question.map((item) => {\r\n    return item.content\r\n  })\r\n\r\n  let unknown_question_prompt = formData.unknown_question_prompt\r\n\r\n  unknown_question_prompt.question = unknown_question_prompt.question.map((item) => {\r\n    return item.content\r\n  })\r\n\r\n  formData.unknown_question_prompt = JSON.stringify(unknown_question_prompt)\r\n\r\n  formData.welcomes = JSON.stringify(welcomes)\r\n\r\n  saveLoading.value = true\r\n  saveRobot(formData)\r\n    .then((res) => {\r\n      if (res.res != 0) {\r\n        return showErrorMsg(res.msg)\r\n      }\r\n\r\n      saveLoading.value = false\r\n\r\n      showSuccessMsg(t('success_save'))\r\n\r\n      getRobot(formState.id)\r\n    })\r\n    .catch(() => {\r\n      saveLoading.value = false\r\n    })\r\n}\r\n\r\n// 提示词\r\nconst onPromptChange = (e) => {\r\n  changeRobotPrompt(e.currentTarget.value)\r\n}\r\n\r\nconst onSaveRobotPrompt = async (formState, isDefault) => {\r\n  let newFormState = JSON.parse(JSON.stringify(formState)) // 深拷贝，不能改变原对象\r\n  Modal.confirm({\r\n        title: t('confirm_save_prompt'),\r\n        icon: createVNode(ExclamationCircleOutlined),\r\n        content: createVNode('div', { style: 'color:red;' }, t('confirm_save_prompt_content')),\r\n        onOk: async () => {\r\n          // updateRobotInfo({ ...toRaw(formState) })\r\n          if (isDefault) {\r\n            // 传给后端的是默认，渲染的是真实名称\r\n            newFormState.use_model = '默认'\r\n          }\r\n          saveForm(newFormState)\r\n        },\r\n        onCancel() {}\r\n      })\r\n}\r\n\r\n// 监听 updateAiMessage 触发消息列表滚动\r\nconst onUpdateAiMessage = () => {\r\n  messageListScrollToBottom()\r\n}\r\n\r\n// 滚动到顶部\r\nconst onScrollStart = async () => {\r\n  isAllowedScrollToBottom = false\r\n\r\n  let msgId = messageList.value[0].uid\r\n\r\n  let res = await onGetChatMessage()\r\n\r\n  if (res) {\r\n    scrollToMessageById(msgId)\r\n  }\r\n}\r\n\r\n// 监听滚动到底部\r\nconst onScrollEnd = () => {\r\n  // console.log('滚动到底部')\r\n}\r\n\r\nconst messageListScrollToBottom = () => {\r\n  if (messageListRef.value && isAllowedScrollToBottom) {\r\n    messageListRef.value.scrollToBottom()\r\n  }\r\n}\r\n\r\nconst scrollToMessageById = (id) => {\r\n  if (messageListRef.value) {\r\n    messageListRef.value.scrollToMessage(id)\r\n  }\r\n}\r\n\r\nconst resetScroll = () => {\r\n  if (messageListRef.value) {\r\n    messageListRef.value.resetScroll()\r\n  }\r\n}\r\n\r\n// 监听 messageList 改变\r\nconst onMessageListChange = () => {\r\n  if (!isAllowedScrollToBottom) {\r\n    return\r\n  }\r\n}\r\n\r\n// 加载对话记录(对话记录加载下一页)\r\nconst onChatListScrollEnd = () => {\r\n  // 获取对话记录\r\n  getMyChatList()\r\n}\r\n\r\n// 打开Prompt日志\r\nconst promptLogAlertRef = ref(null)\r\n\r\nconst handleOpenPromptLog = (item) => {\r\n  promptLogAlertRef.value.open(item)\r\n}\r\n\r\n// 打开文件知识库\r\nconst libraryInfoAlertRef = ref(null)\r\n\r\nconst handleOpenLibraryInfo = (files, file) => {\r\n  libraryInfoAlertRef.value.open(files, file)\r\n}\r\n\r\nconst variableModalRef = ref(null)\r\nconst handleEditVariableForm = () => {\r\n  variableModalRef.value.handleEdit()\r\n}\r\n\r\nwatch(\r\n  () => messageList.value,\r\n  () => {\r\n    onMessageListChange()\r\n  }\r\n)\r\n\r\nonMounted(async () => {\r\n  // 创建对话\r\n  openNewChat()\r\n  // 获取对话记录\r\n  getMyChatList()\r\n\r\n  await getRobot(query.id)\r\n  isRobotInfo.value = true\r\n  // 监听 updateAiMessage 触发消息列表滚动\r\n  emitter.on('updateAiMessage', onUpdateAiMessage)\r\n})\r\n\r\nonUnmounted(() => {\r\n  $reset()\r\n  emitter.off('updateAiMessage', onUpdateAiMessage)\r\n})\r\n</script>\r\n"],"names":["t","useI18n","emit","__emit","props","__props","changeTabkey","item","key","onClickMeun","data","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","$event","_unref","_hoisted_3","_hoisted_4","_Fragment","_renderList","guess","guessIndex","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","robotStore","useRobotStore","tips_before_answer_content","computed","tips_before_answer_switch","toggleReasonProcess","toggleQuoteFiel","common_question_list","isShowQuoteFileProgress","scrollBoxRef","ref","scrollOption","scrollEventTimer","onScrollEventLock","onScroll","e","onScrollStart","onScrollEnd","scrollToBottom","nextTick","scrollToMessage","id","direction","scroller","element","resetScroll","showQuoteFileBox","openPromptLog","toRaw","openLibrary","files","file","message_id","newfiles","parseReplyList","val","buildMenuLines","menu_content","out","mc","txt","sanitized","onSmartReplyLineClick","a","_b","_a","href","onClickSmartMenuKeyword","text","isShowBody","__expose","_hoisted_8","_hoisted_10","_createVNode","MultipleMessage","_createBlock","TextMessage","_hoisted_12","_component_a_spin","_hoisted_14","_hoisted_15","rc","idx","_hoisted_16","_hoisted_18","_hoisted_19","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_27","_component_svg_icon","_hoisted_28","_hoisted_29","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","line","li","_hoisted_39","_hoisted_40","_withModifiers","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","LoadingOutlined","_hoisted_47","_normalizeClass","_hoisted_49","_hoisted_50","_hoisted_52","_component_a_tooltip","InfoCircleOutlined","_hoisted_53","_hoisted_54","_hoisted_56","_hoisted_57","_hoisted_59","CherryMarkdown","_withDirectives","_hoisted_60","_hoisted_61","index","_hoisted_62","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_vShow","_hoisted_72","VoiceMessage","GuessYouWant","handleOpenChat","watch","CuScroll","images","i","handlePreview","viewerApi","handleDelete","CloseOutlined","_normalizeStyle","uploadFileFetch","fileList","category","resolve","reject","uploadFile","progressEvent","percentCompleted","currentFile","f","updatedFile","res","error","useUpload","options","limit","maxSize","accept","multiple","inputEl","handleFileChange","event","remainingSlots","message","fileType","acceptedType","fileItem","generateRandomId","createInputElement","input","openFileDialog","onUnmounted","toRefs","deleteFile","newFileList","_","disabled","onChange","handleKeydown","sendMessage","FileToolbar","_component_a_textarea","args","renderMath","useMathJax","contRef","show","promptLog","reactive","onClose","reset","msg","items","_component_a_drawer","QuestionCircleOutlined","_hoisted_9","_hoisted_11","_hoisted_13","_hoisted_17","_hoisted_20","chatStore","useChatStore","robot","user","useRouter","docBoxRef","activeFileId","open","answer_source_data","documentList","getDocumentList","chagenFile","getAnswerSource","toSource","currentItem","viewTitle","sourceUrl","viewOpen","viewSourceFile","_createTextVNode","_component_a_modal","_component_CuScroll","VuePdfEmbed","_imports_0","query","useRoute","isEdit","chat_variables","wait_variables","fill_variables","need_fill_variable","formState","handleEdit","initData","list","getLength","formRef","handleSave","chat_prompt_variables","getPostData","variables_key","value","_component_a_form","_component_a_form_item","_component_a_input","_component_a_input_number","_component_a_select","option","_component_a_select_option","_component_a_checkbox","_component_a_button","getRobot","robotInfo","emitter","useEventBus","userStore","useUserStore","isAllowedScrollToBottom","messageListRef","createChat","getMyChatList","openChat","onGetChatMessage","changeRobotPrompt","$reset","messageList","sendLock","myChatList","dialogue_id","storeToRefs","isShowFromHeader","route","isRobotInfo","checkChatRequestPermissionLoding","sendLoading","onSendMesage","showErrorMsg","result","checkChatRequestPermission","antMessage","msg_type","openNewChat","user_id","params","messageListScrollToBottom","onClickMsgMenu","onUpdateAiMessage","msgId","scrollToMessageById","onChatListScrollEnd","promptLogAlertRef","handleOpenPromptLog","libraryInfoAlertRef","handleOpenLibraryInfo","variableModalRef","handleEditVariableForm","onMounted","_component_a_breadcrumb","_component_a_breadcrumb_item","_component_router_link","PlusOutlined","ChatList","EditOutlined","MessageList","MessageInput","PromptLogAlert","libraryInfoAlert","VariableModal"],"mappings":"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"}