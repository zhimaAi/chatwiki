import{_ as Ie}from"./empty-CzGZrENG.js";import{f as m,ab as te,w as De,r as ee,Y as x,_,k as e,a2 as t,F as Q,a9 as X,a1 as P,a5 as o,a7 as D,u as L,G as y,n as de,a4 as Ue,A as ie,ae as Z,e as qe}from"./vue-chunks-BSjLwu6d.js";import{i as Se,j as Te,k as Ee,l as Re,m as Ne,n as Ae,o as Ve,p as Le,q as ye,r as Ye,a as Pe,s as ze,t as Je,v as Be}from"./index-O362J1Hf.js";import{b as ae,d as je,h as Ke,p as me,bz as He}from"../../index-0SFcfYGN.js";import{F as oe,e as ce,X as he,O as Ge,I as ke,E as be,p as pe,ab as xe,M as G,a as B,q as we,R as Ce,J as Qe,br as We,u as Xe,v as Ze,bs as et,B as fe,x as Fe,H as _e,k as tt,at,as as nt,bg as lt,aI as ot,d as st,ah as rt,z as ve,aA as ut,D as dt,g as it,b as _t,c as ct,Z as pt,ai as ft,Y as mt,w as vt,y as gt}from"./ui-antd-BIopZvX3.js";import{a as ge}from"./validate-8MtiUsxW.js";import{d as yt}from"./vuedraggable.umd-CLoFUBnR.js";import{u as ht}from"./database-DbWXIIXi.js";import"./utils-BMKRjDTh.js";const kt={class:"add-data-sheet"},bt={class:"field-name"},xt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(j,{expose:Y,emit:z}){const V=m("添加数据"),q=te().query,v=z,b=j;De(()=>b.column,O=>{l()});const F=m([]),l=()=>{let O=[];b.column.forEach(c=>{g[c.name]="",c.rules=[],c.required=="true"&&c.rules.push({required:!0,message:`请输入${c.name}`}),c.type=="number"&&c.rules.push({type:"number",message:`${c.name}必须为数字`}),c.type=="integer"&&c.rules.push({asyncValidator:N}),c.type=="boolean"&&(g[c.name]="false"),O.push({...c}),F.value=O})},N=(O,c)=>new Promise((p,s)=>c==""||Number.isInteger(+c)?p():s("请输入整数")),A=m(!1),g=ee({form_id:q.form_id}),S=O=>{A.value=!0,$.value&&$.value.resetFields(),l(),g.id="",Object.assign(g,E(O)),g.id?V.value="修改数据":V.value="添加数据"},$=m(null),w=()=>{$.value.validate().then(O=>{Se({...g}).then(c=>{let p=g.id?"修改成功":"添加成功";B.success(p),A.value=!1,v("ok")})})};function E(O){const c={};for(let p in O)if(O.hasOwnProperty(p)){const s=O[p];!isNaN(Number(s))&&typeof s=="string"&&s!=""?c[p]=Number(s):c[p]=s}return c}return Y({show:S}),(O,c)=>{const p=pe,s=be,R=he,i=Ge,d=ke,I=ce,r=oe,a=G;return _(),x("div",kt,[e(a,{open:A.value,"onUpdate:open":c[0]||(c[0]=n=>A.value=n),title:V.value,onOk:w,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(r,{style:{"margin-top":"16px"},model:g,ref_key:"formRef",ref:$,layout:"vertical"},{default:t(()=>[(_(!0),x(Q,null,X(F.value,n=>(_(),P(I,{name:n.name,key:n.id,rules:n.rules},{label:t(()=>[e(s,{gap:4,style:{width:"100%"}},{default:t(()=>[o("div",bt,D(n.name),1),e(p,null,{title:t(()=>[y(D(n.description),1)]),default:t(()=>[e(L(xe))]),_:2},1024)]),_:2},1024)]),default:t(()=>[n.type=="boolean"?(_(),P(R,{key:0,checked:g[n.name],"onUpdate:checked":u=>g[n.name]=u,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):n.type=="number"||n.type=="integer"?(_(),P(i,{key:1,style:{width:"100%"},value:g[n.name],"onUpdate:value":u=>g[n.name]=u,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(_(),P(d,{key:2,value:g[n.name],"onUpdate:value":u=>g[n.name]=u,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},wt=ae(xt,[["__scopeId","data-v-0de1a1fc"]]),Ct={__name:"export-modal",setup(j,{expose:Y}){const V=te().query,T=m("导出数据"),q=m(!1),v=ee({dates:[],type:1}),b=()=>{q.value=!0,v.type=1,v.dates=[]},F=ee({dates:[{validator:async($,w)=>v.type==2&&!w.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),l=oe.useForm,{resetFields:N,validate:A,validateInfos:g}=l(v,F),S=()=>{A().then(()=>{let $={form_id:V.form_id};v.type==2&&($.start_date=v.dates[0],$.end_date=v.dates[1]),Te($),q.value=!1})};return Y({show:b}),($,w)=>{const E=Ce,O=we,c=ce,p=Qe,s=oe,R=G;return _(),x("div",null,[e(R,{open:q.value,"onUpdate:open":w[2]||(w[2]=i=>q.value=i),title:T.value,onOk:S,width:450},{default:t(()=>[e(s,{class:"mt16",layout:"vertical"},{default:t(()=>[e(c,{label:""},{default:t(()=>[e(O,{value:v.type,"onUpdate:value":w[0]||(w[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(E,{value:1},{default:t(()=>w[3]||(w[3]=[y("全部数据")])),_:1,__:[3]}),e(E,{value:2},{default:t(()=>w[4]||(w[4]=[y("自定义日期")])),_:1,__:[4]})]),_:1},8,["value"])]),_:1}),de(e(c,Ue({required:"",label:"选择导出日期"},L(g).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":w[1]||(w[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[ie,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Ft=ae(Ct,[["__scopeId","data-v-ca624632"]]),$t={class:"add-data-sheet"},Ot={class:"filter-list-box"},Mt={style:{"margin-left":"48px"}},It={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:Y,emit:z}){const V=m("添加分类"),q=te().query,v=z,b=j;m([]);const F=m(!1),l=ee({form_id:q.form_id,name:"",condition:[],type:"1",id:""}),N=()=>{let r=[{form_field_id:b.column[0].id,form_filed_type:b.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];l.condition=r},A=r=>{l.condition.splice(r,1)},g=(r,a)=>{r.rule=void 0,r.rule_value1="",r.rule_value2="",r.form_filed_type=b.column.filter(n=>n.id==r.form_field_id)[0].type},S=(r,a)=>a.form_field_id==r.id?!1:l.condition.map(u=>u.form_field_id).includes(r.id),$=()=>{let r=l.condition.map(n=>n.form_field_id),a=b.column.filter(n=>!r.includes(n.id));if(!a.length){B.error("字段已全部添加");return}l.condition.push({form_field_id:a[0].id,form_filed_type:a[0].type,rule:void 0,rule_value1:"",rule_value2:""})},w=r=>!r.rule||r.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(r.rule),E=r=>!r.rule||r.form_filed_type=="boolean"?!1:["between"].includes(r.rule),O=(r,a,n)=>new Promise((u,U)=>w(n)?a?n.form_filed_type=="integer"?Number.isInteger(+a)?u():U("请输入整数"):n.form_filed_type=="number"?ge(a)?u():U("请输入数字"):u():U("请输入"):u()),c=(r,a,n)=>new Promise((u,U)=>E(n)?a?n.form_filed_type=="integer"?Number.isInteger(+a)?+a<+n.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入整数"):n.form_filed_type=="number"?ge(a)?+a<+n.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入数字"):u():U("请输入"):u()),p=()=>{F.value=!0,V.value="添加分类",N(),l.name="",l.type="1",l.id=""},s=r=>{F.value=!0,V.value="编辑分类",Ee({form_id:q.form_id,id:r.id}).then(a=>{let n=a.data.conditions||"[]";n=JSON.parse(n),n=n.map(u=>({form_field_id:u.form_field_id+"",form_filed_type:b.column.filter(U=>U.id==u.form_field_id)[0].type,rule:R(u.rule),rule_value1:u.rule_value1,rule_value2:u.rule_value2})),l.condition=n,l.name=a.data.name,l.type=a.data.type,l.id=a.data.id})};function R(r){const a=["string_","integer_","number_","boolean_"];for(const n of a)if(r.startsWith(n))return r.slice(n.length);return r}const i=m(null),d=()=>{i.value.validate().then(r=>{let a=l.condition.map(f=>({form_field_id:+f.form_field_id,rule:f.form_filed_type+"_"+f.rule,rule_value1:f.rule_value1,rule_value2:f.rule_value2})),n={...l,condition:JSON.stringify(a)},u=Re,U="添加成功";l.id&&(u=Ne,U="编辑成功"),u(n).then(f=>{B.success(U),F.value=!1,v("ok")})}).catch(r=>{})},I=m({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return Y({show:p,edit:s}),(r,a)=>{const n=ke,u=ce,U=Ze,f=Xe,h=We,K=fe,H=Ce,le=we,se=oe,re=G;return _(),x("div",$t,[e(re,{open:F.value,"onUpdate:open":a[2]||(a[2]=M=>F.value=M),title:V.value,onOk:d,width:790},{default:t(()=>[e(se,{class:"form-box",style:{"margin-top":"16px"},model:l,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(u,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(n,{maxLength:64,value:l.name,"onUpdate:value":a[0]||(a[0]=M=>l.name=M),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),a[6]||(a[6]=o("div",{class:"form-required-item"},"筛选条件",-1)),o("div",Ot,[(_(!0),x(Q,null,X(l.condition,(M,J)=>(_(),P(h,{key:J,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[o("div",null,"条件"+D(J+1)+":",1),e(u,null,{default:t(()=>[e(f,{value:M.form_field_id,"onUpdate:value":k=>M.form_field_id=k,style:{width:"150px"},placeholder:"请选择",onChange:k=>g(M,J)},{default:t(()=>[(_(!0),x(Q,null,X(b.column,k=>(_(),P(U,{disabled:S(k,M),key:k.id,value:k.id},{default:t(()=>[y(D(k.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(u,{name:["condition",J,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(f,{value:M.rule,"onUpdate:value":k=>M.rule=k,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(_(!0),x(Q,null,X(I.value[M.form_filed_type],k=>(_(),P(U,{key:k.value,value:k.value},{default:t(()=>[y(D(k.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),de(e(u,{name:["condition",J,"rule_value1"],rules:{asyncValidator:(k,ne)=>O(k,ne,M)}},{default:t(()=>[e(n,{value:M.rule_value1,"onUpdate:value":k=>M.rule_value1=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,w(M)]]),de(e(u,{name:["condition",J,"rule_value2"],rules:{asyncValidator:(k,ne)=>c(k,ne,M),trigger:"blur"}},{default:t(()=>[e(n,{value:M.rule_value2,"onUpdate:value":k=>M.rule_value2=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,E(M)]]),l.condition.length>1?(_(),P(L(et),{key:0,onClick:k=>A(J)},null,8,["onClick"])):Z("",!0)]),_:2},1024))),128)),o("div",Mt,[e(K,{onClick:$},{default:t(()=>a[3]||(a[3]=[y("添加条件")])),_:1,__:[3]})])]),e(u,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:l.type,"onUpdate:value":a[1]||(a[1]=M=>l.type=M)},{default:t(()=>[e(H,{value:"1"},{default:t(()=>a[4]||(a[4]=[y("与（And）")])),_:1,__:[4]}),e(H,{value:"2"},{default:t(()=>a[5]||(a[5]=[y("或（Or）")])),_:1,__:[5]})]),_:1},8,["value"])]),_:1})]),_:1,__:[6]},8,["model"])]),_:1},8,["open","title"])])}}},$e=ae(It,[["__scopeId","data-v-81eb5a66"]]),Dt={class:"custom-table"},Ut={class:"t-body"},qt={class:"t-row"},St={class:"t-item"},Tt={class:"t-item"},Et={class:"drag-btn"},Rt={key:0},Nt={key:1},At={class:"t-item"},Vt={class:"t-item flex-none",style:{width:"120px"}},Lt=["onClick"],Yt=["onClick"],Pt={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(j,{expose:Y,emit:z}){const T=te().query,q=z,v=m("管理分类"),b=m(!1),F=j,l=()=>{ye({form_id:T.form_id}).then(p=>{S.value=p.data.map(s=>({...s}))})},N=()=>{l(),q("ok"),q("change")},A=()=>{l(),b.value=!0},g=()=>{b.value=!1},S=m(),$=()=>{let p=[];S.value.reverse().forEach((s,R)=>{p.push({id:+s.id,sort:+R+1})}),Ae({form_id:T.form_id,filter_sort:JSON.stringify(p)}).then(s=>{B.success("排序成功"),l(),q("change")})},w=p=>{Ve({form_id:T.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(s=>{B.success("设置成功"),l(),q("change")})},E=(p,s)=>{G.confirm({title:"删除确认",icon:e(_e),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Le({id:p.id,form_id:T.form_id}).then(R=>{B.success("删除成功"),S.value.splice(s,1),q("change")})},onCancel(){}})},O=m(null),c=p=>{O.value.edit(p)};return Y({show:A}),(p,s)=>{const R=he,i=je,d=pe,I=Fe,r=G;return _(),x("div",null,[e(r,{open:b.value,"onUpdate:open":s[1]||(s[1]=a=>b.value=a),title:v.value,onCancel:g,footer:null,width:760},{default:t(()=>[o("div",Dt,[s[6]||(s[6]=o("div",{class:"t-head"},[o("div",{class:"td"},[o("div",{style:{width:"24px"}}),y(" 分类名称 ")]),o("div",{class:"td"},"类型"),o("div",{class:"td"},"启用分类"),o("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),o("div",Ut,[o("div",qt,[s[2]||(s[2]=o("div",{class:"t-item"},[o("div",{style:{width:"24px"}}),y(" 全部 ")],-1)),s[3]||(s[3]=o("div",{class:"t-item"},"系统分类",-1)),o("div",St,[e(R,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),s[4]||(s[4]=o("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1))]),e(L(yt),{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=a=>S.value=a),"item-key":"id",onEnd:$,group:"table-rows",handle:".drag-btn"},{item:t(({element:a,index:n})=>[(_(),x("div",{key:a.id,class:"t-row"},[o("div",Tt,[o("span",Et,[e(i,{name:"drag"})]),a.name.length>10?(_(),x("span",Rt,[e(d,null,{title:t(()=>[y(D(a.name),1)]),default:t(()=>[y(" "+D(a.name.slice(0,10)+"..."),1)]),_:2},1024)])):(_(),x("span",Nt,D(a.name),1))]),s[5]||(s[5]=o("div",{class:"t-item"},"自定义分类",-1)),o("div",At,[e(R,{onChange:u=>w(a),checked:a.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),o("div",Vt,[o("a",{onClick:u=>c(a)},"编辑",8,Lt),e(I,{type:"vertical"}),o("a",{onClick:u=>E(a,n)},"删除",8,Yt)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e($e,{onOk:N,column:F.column,ref_key:"addFilrerModalRef",ref:O},null,8,["column"])])}}},zt=ae(Pt,[["__scopeId","data-v-f1db0fc5"]]),Jt={class:"upload-box"},Bt={class:"ant-upload-drag-icon"},jt={key:0,class:"progress-box"},Kt={key:0},Ht={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:Y,emit:z}){const V=Ke(),T=z,q=te().query,v=j,b=m(!1),F=m(!1),l=ee({total:0,success:0,err_data:[]}),N=m([]),A=i=>{const d=i.file.status;if(d==="done")if(i.file.response.res==0){let I=i.file.response.data.task_id;$(I)}else return N.value=[],B.error(i.file.response.msg);else d==="error"&&(N.value=[],B.error(`${i.file.name} file upload failed.`))};function g(i){}let S=null;const $=i=>{S&&clearInterval(S),b.value=!1,p.value=!0,s.value=10,l.total=0,l.success=0,l.err_data=[],S=setInterval(()=>{Ye({task_id:i}).then(d=>{let I=d.data;s.value=(I.processed/I.total).toFixed(),I.finish&&(T("ok"),clearInterval(S),s.value=100),I.total>0&&(l.total=I.total,l.success=I.success,l.err_data=I.err_data)}).catch(()=>{clearInterval(S)})},2e3)},w=()=>{let i;i=v.column.map(d=>d.name),i="id,"+i.join(",")+`
`,me(i,[],[],"导入数据模板.csv")},E=()=>{let i={id:""};v.column.forEach(d=>{i[d.name]=""}),He([i],"导入数据模板.json")},O=()=>{N.value=[],b.value=!0},c=()=>{},p=m(!1),s=m(10),R=()=>{let i="id,",d=["id"];for(let a in l.err_data[0])a!="id"&&a!="err_msg"&&(i+=a+",",d.push(a));i=i+`err_msg
`,d.push("err_msg");let I=l.err_data,r="失败数据_"+st().format("YYYY/MM/DD HH:mm")+".xlsx";me(i,I,d,r)};return Y({show:O}),(i,d)=>{const I=tt,r=at,a=G,n=lt,u=fe,U=ot;return _(),x("div",null,[e(a,{open:b.value,"onUpdate:open":d[1]||(d[1]=f=>b.value=f),title:"导入数据","confirm-loading":F.value,onOk:c,footer:null,width:746},{default:t(()=>[e(I,{"show-icon":"",class:"alert-box"},{message:t(()=>[o("div",null,[d[3]||(d[3]=y(" 支持通过Excel或者json文件导入数据。 ")),o("a",{onClick:w,class:"mr8"},"excel模板"),o("a",{onClick:E},"json模板")]),d[4]||(d[4]=o("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1))]),_:1}),o("div",Jt,[e(r,{fileList:N.value,"onUpdate:fileList":d[0]||(d[0]=f=>N.value=f),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:L(V).getToken},data:{form_id:L(q).form_id},action:"/manage/uploadFormFile",onChange:A,onDrop:g},{default:t(()=>[o("p",Bt,[e(L(nt))]),d[5]||(d[5]=o("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),d[6]||(d[6]=o("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1))]),_:1,__:[5,6]},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(a,{open:p.value,"onUpdate:open":d[2]||(d[2]=f=>p.value=f),title:"导入数据",footer:null,width:746},{default:t(()=>[s.value<100?(_(),x("div",jt,[e(n,{type:"circle",percent:s.value},null,8,["percent"]),d[7]||(d[7]=o("div",{class:"tip"},"数据导入中，请勿关闭页面",-1))])):(_(),P(U,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[y("导入成功"+D(l.success)+"，导入失败"+D(l.total-l.success)+" ",1),l.total-l.success>0?(_(),x("span",Kt," 您可以下载失败数据，修改后重新导入 ")):Z("",!0)]),extra:t(()=>[l.total-l.success>0?(_(),P(u,{key:0,onClick:R,type:"primary"},{default:t(()=>d[8]||(d[8]=[y("下载失败数据")])),_:1,__:[8]})):Z("",!0)]),_:1}))]),_:1},8,["open"])])}}},Gt=ae(Ht,[["__scopeId","data-v-c09a8f6a"]]),Qt={key:0,class:"loading-box"},Wt={key:1,class:"empty-box"},Xt={key:2,class:"field-manage-page"},Zt={class:"page-title"},ea={key:0},ta={key:1},aa={class:"table-wrapper customize-scroll-style"},na={key:0},la={key:1},oa={key:0},sa={key:1},ra=["onClick"],ua=["onClick"],da={__name:"index",setup(j){const Y=ht(),z=qe(()=>Y.databaseInfo.entry_count),T=te().query,q=m([]),v=m([]),b=m(!0),F=ee({form_id:T.form_id,page:1,size:10,total:0}),l=m(!1),N=f=>{F.page=f.current,F.size=f.pageSize,g()},A=()=>{F.page=1,g()},g=()=>{l.value=!0,ze({...F,filter_id:$.value}).then(f=>{q.value=f.data.list||[],F.total=+f.data.total||0,Y.getDatabaseInfo({id:T.form_id})}).finally(()=>{l.value=!1})};Pe({form_id:T.form_id}).then(f=>{v.value=f.data,b.value=!1,g()});const S=m([]),$=m(""),w=()=>{ye({form_id:T.form_id}).then(f=>{let h=f.data||[];if(S.value=h.filter(K=>K.enabled=="true"),$.value){let K=h.filter(H=>H.id==$.value);(K.length&&K[0].enabled=="false"||!K.length)&&($.value="",g())}})};w();const E=()=>{w(),g()},O=()=>{F.page=1,g()},c=m(null),p=(f,h)=>{h==="add"&&c.value.show()},s=f=>{G.confirm({title:"删除确认",icon:e(_e),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Be({id:f.id}).then(h=>{B.success("删除成功"),E()})},onCancel(){}})},R=()=>{G.confirm({title:"清空数据提示",icon:e(_e),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Je({form_id:T.form_id}).then(f=>{B.success("清空成功"),E()})},onCancel(){}})},i=m(null),d=(f={})=>{i.value.show(JSON.parse(JSON.stringify(f)))},I=m(null),r=(f={})=>{I.value.show()},a=m(null),n=()=>{a.value.show()},u=m(null),U=()=>{u.value.show()};return(f,h)=>{const K=rt,H=fe,le=ct,se=_t,re=dt,M=be,J=pt,k=pe,ne=mt,ue=vt,Oe=Fe,Me=gt;return _(),x(Q,null,[b.value?(_(),x("div",Qt,[e(K)])):Z("",!0),!b.value&&!v.value.length?(_(),x("div",Wt,h[3]||(h[3]=[o("img",{src:Ie,alt:""},null,-1),o("div",null,"暂无字段, 请先去添加字段",-1)]))):Z("",!0),!b.value&&v.value.length?(_(),x("div",Xt,[o("div",Zt,[h[7]||(h[7]=y(" 数据管理 ")),e(M,{gap:16},{default:t(()=>[e(H,{type:"primary",onClick:h[0]||(h[0]=C=>d())},{icon:t(()=>[e(L(ve))]),default:t(()=>[h[4]||(h[4]=y(" 添加数据 "))]),_:1,__:[4]}),e(H,{onClick:h[1]||(h[1]=C=>r())},{icon:t(()=>[e(L(ut))]),default:t(()=>[h[5]||(h[5]=y(" 导入数据 "))]),_:1,__:[5]}),e(re,null,{overlay:t(()=>[e(se,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[o("div",{onClick:n},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[o("div",{onClick:R},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(H,null,{default:t(()=>[h[6]||(h[6]=y(" 更多操作 ")),e(L(it))]),_:1,__:[6]})]),_:1})]),_:1})]),e(ne,{class:"tabs-wrapper",activeKey:$.value,"onUpdate:activeKey":h[2]||(h[2]=C=>$.value=C),type:"editable-card",onEdit:p,onChange:O},{addIcon:t(()=>[e(L(ve)),h[8]||(h[8]=y(" 添加分类 "))]),rightExtra:t(()=>[o("span",{class:"setting-btn",onClick:U},[e(L(ft)),h[9]||(h[9]=y(" 管理分类 "))])]),default:t(()=>[e(J,{key:"",closable:!1},{tab:t(()=>[y("全部 ("+D(z.value)+")",1)]),_:1}),(_(!0),x(Q,null,X(S.value,C=>(_(),P(J,{key:C.id,closable:!1},{tab:t(()=>[C.name.length>8?(_(),x("span",ea,[e(k,null,{title:t(()=>[y(D(C.name),1)]),default:t(()=>[y(" "+D(C.name.slice(0,8)+"..."),1)]),_:2},1024)])):(_(),x("span",ta,D(C.name),1)),y(" ("+D(C.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),o("div",aa,[e(Me,{sticky:"","data-source":q.value,loading:l.value,scroll:{x:1e3},pagination:{current:F.page,total:F.total,pageSize:F.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:N},{default:t(()=>[e(ue,{key:"id","data-index":"id",title:"id",width:60}),(_(!0),x(Q,null,X(v.value,C=>(_(),P(ue,{key:C.name,"data-index":C.name,width:165},{title:t(()=>[C.name.length>12?(_(),x("span",na,[e(k,null,{title:t(()=>[y(D(C.name),1)]),default:t(()=>[y(" "+D(C.name.slice(0,12)+"..."),1)]),_:2},1024)])):(_(),x("span",la,D(C.name),1)),e(k,null,{title:t(()=>[y(D(C.description),1)]),default:t(()=>[e(L(xe),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:W})=>[W[C.name].length>10?(_(),x("span",oa,[e(k,null,{title:t(()=>[y(D(W[C.name]),1)]),default:t(()=>[y(" "+D(W[C.name].slice(0,9)+"..."),1)]),_:2},1024)])):(_(),x("span",sa,D(W[C.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(ue,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:C})=>[o("span",null,[o("a",{onClick:W=>d(C)},"编辑",8,ra),e(Oe,{type:"vertical"}),o("a",{onClick:W=>s(C)},"删除",8,ua)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(wt,{onOk:E,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e($e,{onOk:E,column:v.value,ref_key:"addFilrerModalRef",ref:c},null,8,["column"]),e(Ft,{ref_key:"exportModalRef",ref:a},null,512),e(zt,{onOk:g,onChange:w,column:v.value,ref_key:"filterManageModalRef",ref:u},null,8,["column"]),e(Gt,{onOk:A,column:v.value,ref_key:"importDataModalRef",ref:I},null,8,["column"])])):Z("",!0)],64)}}},ha=ae(da,[["__scopeId","data-v-fe0434d1"]]);export{ha as default};
