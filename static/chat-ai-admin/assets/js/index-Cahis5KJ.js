var yC=Object.defineProperty;var _C=(r,e,t)=>e in r?yC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var mo=(r,e,t)=>_C(r,typeof e!="symbol"?e+"":e,t);import{m as bC,n as xC,o as wC,w as SC,p as EC,q as Wf,t as o_,u as yg,v as CC,x as Uo}from"./index-BOvAmdHY.js";import{u as Gr}from"./robot-ChheCicf.js";import{b as bt,d as Ir,F as Fh,aa as a_,aj as tc,ak as OC,al as kC,am as MC,h as NC,ag as AC,ah as TC}from"../../index-BZRrEp3V.js";import{e as tn,ab as Hl,f as xe,o as qt,Y as ae,_ as Y,ae as et,a5 as E,k as j,a2 as U,G as Be,a7 as Te,F as dt,a9 as yt,ad as Sn,a1 as ze,aa as DC,n as ia,am as LC,B as cn,A as cs,u as $e,j as Oi,a3 as Ga,c as Nt,af as Mn,a6 as Ci,E as s_,r as Jt,w as Qt,y as _n,X as PC,J as Vi,l as wn,K as fs,d as hs,s as RC,g as IC,a4 as BC,ah as l_,aj as nc,p as Vo,an as jC,m as HC,a8 as $l,ag as Fl,b as u_}from"./vue-chunks-Ci-XTWEs.js";import{p as ki,a4 as $C,g as ps,ay as _g,a8 as zh,z as In,B as Bn,aD as d_,I as Cr,b as Wh,c as Uh,D as Vh,au as FC,ab as Kn,M as wr,F as Mi,e as Xi,u as Br,v as jr,X as ua,Q as rc,ar as ic,aE as da,aB as zl,O as Ni,K as vs,E as gs,aA as zC,aF as Xh,y as c_,q as f_,R as h_,T as WC,av as UC,ah as p_,ad as VC,ag as v_,a as Rn,aC as XC,ap as fr,ai as GC,aG as ms,a9 as Gh,aH as g_,a7 as YC,aI as KC,aJ as on,aK as Ht,aL as Ya,aM as Wl,aN as pf,aO as $a,aP as un,aQ as ko,aR as io,aS as oa,aT as Ka,aU as xr,s as qC,aV as JC,aW as Uf,aX as Vf,aY as ZC,aZ as m_,a_ as QC,a$ as eO,b0 as bg,b1 as tO,b2 as Xf,b3 as y_,b4 as nO,b5 as __,b6 as rO,b7 as sl,ao as b_,ac as x_,b8 as iO,b9 as oO,ba as aO,a3 as sO,bb as lO,d as Fa,an as uO,aw as dO}from"./ui-antd-BWf8LxGy.js";import{u as cO}from"./global-DqP7WgZx.js";import{_ as fO}from"./empty-BFmzY9bl.js";import{g as hO,a as pO,b as vO,_ as w_,c as S_,d as E_,e as C_,f as O_,h as k_,i as M_,j as N_,k as A_,l as T_,m as D_,n as L_,o as P_,p as R_,q as I_,r as B_,s as j_,t as H_,u as $_,v as F_,w as z_,x as W_,y as U_,z as V_,A as X_,B as G_,C as Y_,D as K_,E as q_,F as J_,G as Z_,H as Q_,I as e0,J as t0,K as n0,L as r0,M as i0,N as o0,O as a0,P as s0,Q as l0,R as u0,S as d0,T as c0,U as f0,V as h0,W as p0,X as v0,Y as g0,Z as m0,$ as y0,a0 as _0,a1 as b0,a2 as x0,a3 as w0,a4 as S0,a5 as E0,a6 as C0,a7 as O0,a8 as k0,a9 as M0,aa as N0,ab as A0,ac as T0,ad as D0,ae as L0,af as P0,ag as R0,ah as I0,ai as B0,aj as j0,ak as H0,al as $0,am as F0,an as z0,ao as W0,ap as U0,aq as V0,ar as X0,as as G0,at as Y0,au as K0,av as q0,aw as J0,ax as Z0,ay as Q0,az as eb,aA as tb,aB as nb,aC as rb,aD as ib,aE as ob,aF as ab,aG as sb,aH as lb,aI as ub,aJ as db,aK as cb,aL as fb,aM as hb,aN as pb,aO as vb,aP as gb,aQ as mb,aR as yb,aS as _b,aT as bb,aU as xb,aV as wb,aW as Sb,aX as Eb,aY as Cb,aZ as Ob,a_ as kb,a$ as Mb,b0 as Nb,b1 as Ab,b2 as Tb,b3 as Db,b4 as Lb,b5 as Pb,b6 as Rb,b7 as Ib,b8 as Bb,b9 as jb,ba as Hb,bb as $b,bc as Fb,bd as zb,be as Wb,bf as Ub,bg as Vb,bh as Xb,bi as Gb,bj as Yb,bk as Kb,bl as qb,bm as Jb,bn as Zb,bo as Qb,bp as ex,bq as tx,br as nx,bs as rx,bt as ix,bu as ox,bv as ax,bw as sx,bx as lx,by as ux,bz as dx,bA as cx,bB as fx,bC as hx,bD as px,bE as vx,bF as gx,bG as mx,bH as yx,bI as _x,bJ as bx,bK as xx,bL as wx,bM as Sx,bN as Ex,bO as Cx,bP as Ox,bQ as kx,bR as Mx,bS as Nx,bT as Ax,bU as Tx,bV as Dx,bW as Lx,bX as Px,bY as Rx,bZ as Ix,b_ as Bx,b$ as jx,c0 as Hx,c1 as $x,c2 as Fx,c3 as zx,c4 as Wx,c5 as Ux,c6 as Vx,c7 as Xx,c8 as Gx,c9 as Yx,ca as Kx,cb as qx,cc as Jx,cd as Zx,ce as Qx,cf as e1,cg as t1,ch as n1,ci as r1,cj as i1,ck as o1,cl as a1,cm as s1,cn as l1,co as u1,cp as d1,cq as c1,cr as f1,cs as h1,ct as p1,cu as v1,cv as g1,cw as m1,cx as y1,cy as ys,cz as gO,cA as mO,cB as yO,cC as _O,cD as bO}from"./styles-DFVEegxB.js";import{M as oc}from"./model-select-S5ievtWN.js";import{_ as _1}from"./index-D-GrJqwf.js";import{_ as Yh}from"./empty-CzGZrENG.js";import{a as xO,g as wO}from"./index-zZra8f7T.js";import{h as b1}from"./index-UUVUVnDU.js";import{d as SO}from"./vuedraggable.umd-DJBjom-v.js";import{g as x1}from"./thirdMcp-CEFgBwgh.js";import{T as EO}from"./top-header-rW3VpPHg.js";import{a as CO}from"./add-group-BI7KoldV.js";import"./utils-ChQO-_r6.js";import"./cu-scroll-BD8CyTy-.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const OO={key:0,class:"sidebar-handle-wrapper"},kO={class:"sidebar-container"},MO={class:"sidebar-menus"},NO=["onClick"],AO={class:"menu-name"},TO={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(r){const e=cO(),t=DC(),n=Hl(),i=tn(()=>n.path.split("/")[3]),o=xe(!0),s=xe(!0);function l(){o.value=!o.value,s.value=!1,e.setHideLayoutTopAndBottom(o.value)}const d=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"未知问题",value:"unknown_issue",path:"/robot/config/unknown_issue",iconName:"unknown-issue"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],c=f=>{if(f.isNewWindowOpen){window.open(`/#${f.path}?robot_key=${n.query.robot_key}&id=${n.query.id}`);return}t.push({path:f.path,query:n.query})};return qt(()=>{setTimeout(()=>{s.value=!1},3e3)}),(f,v)=>{const g=ki,y=Ir;return Y(),ae("div",{class:Sn(["sidebar-wrapper",{"is-hide":o.value}])},[r.showSidebarBtn?(Y(),ae("div",OO,[j(g,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:s.value,"onUpdate:open":v[0]||(v[0]=b=>s.value=b),arrow:!1},{title:U(()=>[Be(Te(o.value?"展开":"收起"),1)]),default:U(()=>[E("span",{class:"sidebar-handle",onClick:l},v[1]||(v[1]=[E("span",{class:"handle-line handle-line01"},null,-1),E("span",{class:"handle-line handle-line02"},null,-1)]))]),_:1},8,["open"])])):et("",!0),E("div",kO,[E("div",MO,[(Y(),ae(dt,null,yt(d,b=>E("div",{class:Sn(["sidebar-menu",{active:i.value==b.value}]),key:b.value,onClick:x=>c(b)},[o.value?(Y(),ze(g,{key:0,placement:"bottom"},{title:U(()=>[E("span",null,Te(b.label),1)]),default:U(()=>[j(y,{name:b.iconName,class:"menu-icon",size:"16"},null,8,["name"])]),_:2},1024)):(Y(),ze(y,{key:1,name:b.iconName,class:"menu-icon",size:"16"},null,8,["name"])),E("span",AO,Te(b.label),1)],10,NO)),64))])])],2)}}},DO=bt(TO,[["__scopeId","data-v-36a951c8"]]),LO={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(r){r!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${r}%`,this.previousValue=r)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("update:modelValue",r.value),this.$emit("zoom-change",r.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const r=this.currentValue.replace("%","").trim(),e=parseInt(r.replace(/[^\d]/g,""),10);if(!r){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const r=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(r)&&r>=1&&r<=800?(this.$emit("update:modelValue",r),this.$emit("zoom-change",r),this.currentValue=`${r}%`,this.previousValue=r):this.currentValue=`${this.previousValue}%`},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(r.target)&&r.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},PO={class:"zoom-select"},RO={class:"zoom-select-options"},IO=["onClick"];function BO(r,e,t,n,i,o){return Y(),ae("div",PO,[E("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=cn(()=>{},["stop"]))},[ia(E("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.currentValue=s),onInput:e[1]||(e[1]=(...s)=>o.handleInput&&o.handleInput(...s)),onFocus:e[2]||(e[2]=(...s)=>o.showMenu&&o.showMenu(...s)),onBlur:e[3]||(e[3]=(...s)=>o.handleBlur&&o.handleBlur(...s))},null,544),[[LC,i.currentValue]])]),ia(E("div",RO,[(Y(!0),ae(dt,null,yt(i.menus,s=>(Y(),ae("div",{class:"zoom-select-option",key:s.value,onClick:l=>o.handleMenu(s)},Te(s.label),9,IO))),128)),e[6]||(e[6]=E("div",{class:"option-line"},null,-1)),E("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=s=>o.handleMenu({value:5}))},"全览")],512),[[cs,i.isShowMenu]])])}const jO=bt(LO,[["render",BO],["__scopeId","data-v-759c17c4"]]),HO={class:"node-list-popup"},$O={class:"tabs-box"},FO={class:"node-list-popup-content"},zO={key:0,class:"node-list"},WO={class:"node-type"},UO={class:"node-flex-box"},VO=["onMousedown"],XO=["src","alt"],GO={class:"node-name"},YO={key:1,class:"mcp-box"},KO={class:"search-box"},qO={key:0,class:"mcp-list"},JO={class:"mcp-info-pop"},ZO={class:"info"},QO=["src"],ek={class:"name"},tk={class:"extra"},nk=["onClick"],rk=["src"],ik={class:"info"},ok={class:"name"},ak={class:"total"},sk={class:"mcp-tools"},lk={class:"params-box"},uk={class:"param-item"},dk={class:"field"},ck={class:"name"},fk={class:"desc"},hk={class:"field"},pk={class:"name"},vk={class:"type"},gk={key:0,class:"required"},mk={class:"desc"},yk=["onMousedown"],_k={key:1,class:"empty-box"},bk={__name:"node-list-popup",props:{type:{type:String,default:""}},emits:["addNode","mouseMove"],setup(r,{emit:e}){const t=e,i=hO(r.type),o=xe([]),s=xe(1),l=xe("");qt(()=>{pO().then(b=>{o.value=b})});const d=tn(()=>l.value?o.value.filter(b=>(b.description+b.name).indexOf(l.value)>-1):o.value),c=(b,x)=>{b.preventDefault();let w=!1;const _=b.clientX,C=b.clientY,k=JSON.parse(JSON.stringify(x)),D=document.createElement("div");D.classList.add("node-item-ghost"),D.innerHTML=b.currentTarget.innerHTML,document.body.appendChild(D);const R=I=>{D.style.left=`${I.clientX+5}px`,D.style.top=`${I.clientY+5}px`};R(b);const $=I=>{!w&&(Math.abs(I.clientX-_)>5||Math.abs(I.clientY-C)>5)&&(w=!0),R(I),t("mouseMove")},P=I=>{document.body.removeChild(D),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",P),w?t("addNode",{node:k,event:I}):f(k)};window.addEventListener("mousemove",$),window.addEventListener("mouseup",P,{once:!0})},f=b=>{b=JSON.parse(JSON.stringify(b)),t("addNode",{node:b})},v=(b,x,w)=>{let _=vO(x,w);c(b,_)};function g(b){s.value=b}function y(){window.open("/#/robot/list?active=3&mcp=2","_blank")}return(b,x)=>{const w=Ir,_=$C,C=zh;return Y(),ae("div",HO,[E("div",$O,[E("div",{class:Sn(["tab-item",{active:s.value==1}]),onClick:x[0]||(x[0]=k=>g(1))},[j(w,{name:"base-node-type"}),x[3]||(x[3]=Be(" 基础功能 "))],2),E("div",{class:Sn(["tab-item",{active:s.value==2}]),onClick:x[1]||(x[1]=k=>g(2))},[j(w,{name:"mcp-node-type"}),x[4]||(x[4]=Be(" MCP "))],2)]),E("div",FO,[s.value==1?(Y(!0),ae(dt,{key:0},yt($e(i),k=>(Y(),ae(dt,{key:k.key},[k.hidden?et("",!0):(Y(),ae("div",zO,[E("div",WO,Te(k.name),1),E("div",UO,[(Y(!0),ae(dt,null,yt(k.nodes,D=>(Y(),ae(dt,{key:D.type},[D.hidden?et("",!0):(Y(),ae("div",{key:0,class:"node-item",onMousedown:R=>c(R,D)},[E("img",{src:D.properties.node_icon,alt:D.properties.node_name},null,8,XO),E("div",GO,Te(D.properties.node_name),1)],40,VO))],64))),128))])]))],64))),128)):(Y(),ae("div",YO,[E("div",KO,[j(_,{value:l.value,"onUpdate:value":x[2]||(x[2]=k=>l.value=k),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),d.value.length?(Y(),ae("div",qO,[(Y(!0),ae(dt,null,yt(d.value,(k,D)=>(Y(),ae("div",{key:D,class:"mcp-item"},[j(C,{placement:"right"},{content:U(()=>[E("div",JO,[E("div",ZO,[E("img",{class:"avatar",src:k.avatar},null,8,QO),E("div",ek,Te(k.name),1)]),E("div",null,Te(k.url),1),E("div",tk,"可用工具："+Te(k.tools.length),1)])]),default:U(()=>[E("div",{class:"mcp-info",onClick:R=>k.expand=!k.expand},[E("img",{class:"avatar",src:k.avatar},null,8,rk),E("div",ik,[E("span",ok,Te(k.name),1),E("span",ak,[Be(Te(k.tools.length)+" ",1),k.expand?(Y(),ze($e(ps),{key:0})):(Y(),ze($e(_g),{key:1}))])])],8,nk)]),_:2},1024),ia(E("div",sk,[(Y(!0),ae(dt,null,yt(k.tools,(R,$)=>(Y(),ze(C,{key:$,placement:"right"},{content:U(()=>[E("div",lk,[E("div",uk,[E("div",dk,[E("span",ck,Te(R.name),1)]),E("div",fk,Te(R.description),1)]),(Y(!0),ae(dt,null,yt(R.inputSchema.properties,(P,I)=>(Y(),ae("div",{key:I,class:"param-item"},[E("div",hk,[E("span",pk,Te(I),1),E("span",vk,Te(P.type),1),R.inputSchema.required.includes(I)?(Y(),ae("span",gk,"必填")):et("",!0)]),E("div",mk,Te(P.description),1)]))),128))])]),default:U(()=>[E("div",{class:"mcp-tool-item",onMousedown:P=>v(P,k,R)},Te(R.name),41,yk)]),_:2},1024))),128))],512),[[cs,k.expand]])]))),128))])):(Y(),ae("div",_k,[x[6]||(x[6]=E("img",{style:{height:"200px"},src:fO},null,-1)),x[7]||(x[7]=E("div",null,"暂无可用MCP插件",-1)),E("a",{onClick:y},[x[5]||(x[5]=Be("去添加")),j($e(_g))])]))]))])])}}},w1=bt(bk,[["__scopeId","data-v-3a3e98ca"]]),xk={class:"custom-control-warpper"},wk={class:"custom-control-body"},Sk={class:"custom-control"},Ek={class:"control-item zoom-control"},Ck={class:"control-item"},Ok={class:"control-item"},kk={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoom-change"],setup(r,{emit:e}){const t=e,n=r,{eventCenter:i}=n.lf.graphModel,o=xe(100),s=()=>{let _=o.value/100;n.lf.zoom(_),t("zoom-change",_)},l=_=>{o.value=_,s()},d=()=>{let _=o.value-10;_<1&&(_=1),o.value=_,s()},c=()=>{let _=o.value+10;_>800&&(_=800),o.value=_,s()},f=xe(!1),v=xe(null),g=_=>{let C=Math.floor(_.transform.SCALE_X*100);o.value=C},y=()=>{t("runTest")},b=_=>{f.value&&(v.value.contains(_.target)||(f.value=!1))},x=()=>{f.value&&(f.value=!1)},w=_=>{t("addNode",_),f.value=!1};return qt(()=>{document.addEventListener("click",b),i.on("graph:transform",g)}),Oi(()=>{document.removeEventListener("click",b),i.off("graph:transform",g)}),(_,C)=>{const k=Ir,D=Bn;return Y(),ae("div",xk,[E("div",wk,[E("div",Sk,[E("div",Ek,[E("div",{class:"action-btn zoom-btn",onClick:d},[j(k,{name:"minus",size:"16"})]),j(jO,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=R=>o.value=R),onZoomChange:l},null,8,["modelValue"]),E("div",{class:"action-btn zoom-btn",onClick:c},[j(k,{name:"plus",size:"16"})])]),C[4]||(C[4]=E("i",{class:"control-line"},null,-1)),E("div",Ck,[j(D,{type:"primary",onClick:C[1]||(C[1]=cn(R=>f.value=!0,["stop"]))},{icon:U(()=>[j($e(In))]),default:U(()=>[C[2]||(C[2]=E("span",null,"新建节点",-1))]),_:1,__:[2]})]),E("div",Ok,[j(D,{onClick:y,style:{"background-color":"#00ad3a"},type:"primary"},{default:U(()=>[j($e(d_)),C[3]||(C[3]=Be("运行测试"))]),_:1,__:[3]})])]),ia(E("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:v},[j(w1,{onAddNode:w,type:"float-btn",onMouseMove:x})],512),[[cs,f.value]])])])}}},Mk=bt(kk,[["__scopeId","data-v-3b141116"]]),Nk={},Ak={class:"node-form-layout"},Tk={class:"layout-header"},Dk={class:"layout-body"};function Lk(r,e){return Y(),ae("div",Ak,[E("div",Tk,[Ga(r.$slots,"header",{},void 0,!0)]),E("div",Dk,[Ga(r.$slots,"default",{},void 0,!0)])])}const pr=bt(Nk,[["render",Lk],["__scopeId","data-v-1df44d93"]]),Pk={class:"node-form-header"},Rk={class:"node-title"},Ik={class:"title-left"},Bk=["src"],jk={class:"title-conttent"},Hk={class:"title-right"},$k={class:"node-desc"},Fk={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},setup(r){const e=Nt("changeTitle"),t=Nt("deleteNode"),n=Nt("close"),i=r;let o=null;const s=g=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":y1,"../../../../assets/svg/ai-generate-white.svg":m1,"../../../../assets/svg/ai-generate.svg":g1,"../../../../assets/svg/ai-mark.svg":v1,"../../../../assets/svg/ai.svg":p1,"../../../../assets/svg/alert-icon.svg":h1,"../../../../assets/svg/ali-ocr.svg":f1,"../../../../assets/svg/analysis.svg":c1,"../../../../assets/svg/anthrop.svg":d1,"../../../../assets/svg/applet.svg":u1,"../../../../assets/svg/arrow-down.svg":l1,"../../../../assets/svg/arrow-left.svg":s1,"../../../../assets/svg/arrow-right.svg":a1,"../../../../assets/svg/attachment.svg":o1,"../../../../assets/svg/auth.svg":i1,"../../../../assets/svg/auto-reply.svg":r1,"../../../../assets/svg/azure.svg":n1,"../../../../assets/svg/baichuan.svg":t1,"../../../../assets/svg/base-node-type.svg":e1,"../../../../assets/svg/book.svg":Qx,"../../../../assets/svg/chat-cache.svg":Zx,"../../../../assets/svg/chat-mode.svg":Jx,"../../../../assets/svg/chat-robot-icon.svg":qx,"../../../../assets/svg/chat.svg":Kx,"../../../../assets/svg/check-arrow-filled.svg":Yx,"../../../../assets/svg/circularNeedle.svg":Gx,"../../../../assets/svg/client.svg":Xx,"../../../../assets/svg/close-circle.svg":Vx,"../../../../assets/svg/cmd.svg":Ux,"../../../../assets/svg/code-run-node.svg":Wx,"../../../../assets/svg/cohere.svg":zx,"../../../../assets/svg/collaborator.svg":Fx,"../../../../assets/svg/collapse-close.svg":$x,"../../../../assets/svg/collapse-open.svg":Hx,"../../../../assets/svg/colour-edit.svg":jx,"../../../../assets/svg/comment-search.svg":Bx,"../../../../assets/svg/common-quession.svg":Ix,"../../../../assets/svg/cu-doc-active.svg":Rx,"../../../../assets/svg/cu-doc-icon.svg":Px,"../../../../assets/svg/data-node.svg":Lx,"../../../../assets/svg/data-security.svg":Dx,"../../../../assets/svg/database-menu-icon.svg":Tx,"../../../../assets/svg/deepseek.svg":Ax,"../../../../assets/svg/delete.svg":Nx,"../../../../assets/svg/direct-connection.svg":Mx,"../../../../assets/svg/dislike-active.svg":kx,"../../../../assets/svg/dislike.svg":Ox,"../../../../assets/svg/doc-active-menu-icon.svg":Cx,"../../../../assets/svg/doc-directory.svg":Ex,"../../../../assets/svg/doc-draft.svg":Sx,"../../../../assets/svg/doc-file.svg":wx,"../../../../assets/svg/doc-file2.svg":xx,"../../../../assets/svg/doc-icon-active.svg":bx,"../../../../assets/svg/doc-icon.svg":_x,"../../../../assets/svg/doc-menu-icon.svg":yx,"../../../../assets/svg/document.svg":mx,"../../../../assets/svg/drag.svg":gx,"../../../../assets/svg/duiwaifuwu.svg":vx,"../../../../assets/svg/economic-active.svg":px,"../../../../assets/svg/economic.svg":hx,"../../../../assets/svg/edit-02.svg":fx,"../../../../assets/svg/edit.svg":cx,"../../../../assets/svg/empty-document.svg":dx,"../../../../assets/svg/empty.svg":ux,"../../../../assets/svg/end-node.svg":lx,"../../../../assets/svg/enterprise-active.svg":sx,"../../../../assets/svg/enterprise.svg":ax,"../../../../assets/svg/enterprise2.svg":ox,"../../../../assets/svg/expand.svg":ix,"../../../../assets/svg/explain-node.svg":rx,"../../../../assets/svg/export-record.svg":nx,"../../../../assets/svg/eye-open.svg":tx,"../../../../assets/svg/field-menu-icon.svg":ex,"../../../../assets/svg/file-icon.svg":Qb,"../../../../assets/svg/file-search.svg":Zb,"../../../../assets/svg/finance.svg":Jb,"../../../../assets/svg/function-center.svg":qb,"../../../../assets/svg/gemini.svg":Kb,"../../../../assets/svg/generate-icon.svg":Yb,"../../../../assets/svg/gou.svg":Gb,"../../../../assets/svg/government.svg":Xb,"../../../../assets/svg/graph-icon.svg":Vb,"../../../../assets/svg/guanlianzhishiku.svg":Ub,"../../../../assets/svg/high-active.svg":Wb,"../../../../assets/svg/high.svg":zb,"../../../../assets/svg/http-node.svg":Fb,"../../../../assets/svg/huanyingyu.svg":$b,"../../../../assets/svg/huoshanyinqin.svg":Hb,"../../../../assets/svg/img-icon.svg":jb,"../../../../assets/svg/input.svg":Bb,"../../../../assets/svg/jibenpeizhi.svg":Ib,"../../../../assets/svg/jichupeizhi.svg":Rb,"../../../../assets/svg/jina.svg":Pb,"../../../../assets/svg/judge-node.svg":Lb,"../../../../assets/svg/knowledge-base-node.svg":Db,"../../../../assets/svg/knowledge-config-active-icon.svg":Tb,"../../../../assets/svg/knowledge-config-icon.svg":Ab,"../../../../assets/svg/law.svg":Nb,"../../../../assets/svg/liaotianceshi.svg":Mb,"../../../../assets/svg/like-active.svg":kb,"../../../../assets/svg/like-icon.svg":Ob,"../../../../assets/svg/like.svg":Cb,"../../../../assets/svg/lingyiwanwu.svg":Eb,"../../../../assets/svg/link-icon-active.svg":Sb,"../../../../assets/svg/link-icon.svg":wb,"../../../../assets/svg/link-left.svg":xb,"../../../../assets/svg/lock-icon.svg":bb,"../../../../assets/svg/login-success.svg":_b,"../../../../assets/svg/logout.svg":yb,"../../../../assets/svg/manufacture.svg":mb,"../../../../assets/svg/mcp-node-type.svg":gb,"../../../../assets/svg/mcp-node.svg":vb,"../../../../assets/svg/medical-treatment.svg":pb,"../../../../assets/svg/menu-expand.svg":hb,"../../../../assets/svg/message.svg":fb,"../../../../assets/svg/minus.svg":cb,"../../../../assets/svg/mix-icon.svg":db,"../../../../assets/svg/more-compatible.svg":ub,"../../../../assets/svg/moxingshezhi.svg":lb,"../../../../assets/svg/multimode-box.svg":sb,"../../../../assets/svg/nav-chat.svg":ab,"../../../../assets/svg/nav-doc.svg":ob,"../../../../assets/svg/nav-explore.svg":ib,"../../../../assets/svg/nav-find.svg":rb,"../../../../assets/svg/nav-library.svg":nb,"../../../../assets/svg/nav-robot.svg":tb,"../../../../assets/svg/nav-search.svg":eb,"../../../../assets/svg/network.svg":Q0,"../../../../assets/svg/open-ai.svg":Z0,"../../../../assets/svg/ordinary-segmentation.svg":J0,"../../../../assets/svg/out-the-box.svg":q0,"../../../../assets/svg/output.svg":K0,"../../../../assets/svg/parameter-extraction-node.svg":Y0,"../../../../assets/svg/pc.svg":G0,"../../../../assets/svg/pdf-img.svg":X0,"../../../../assets/svg/pdf-ocr.svg":V0,"../../../../assets/svg/pdf-text.svg":U0,"../../../../assets/svg/phone.svg":W0,"../../../../assets/svg/plugin-node-type.svg":z0,"../../../../assets/svg/plus.svg":F0,"../../../../assets/svg/point-h.svg":$0,"../../../../assets/svg/problem-optimization-node.svg":H0,"../../../../assets/svg/problem-optimization.svg":j0,"../../../../assets/svg/prompt-icon.svg":B0,"../../../../assets/svg/put-away.svg":I0,"../../../../assets/svg/qa-feedback.svg":R0,"../../../../assets/svg/question-node.svg":P0,"../../../../assets/svg/quick-Instruction.svg":L0,"../../../../assets/svg/quote-file.svg":D0,"../../../../assets/svg/quotes.svg":T0,"../../../../assets/svg/recommendation.svg":A0,"../../../../assets/svg/reply-content.svg":N0,"../../../../assets/svg/reply-settings.svg":M0,"../../../../assets/svg/retail.svg":k0,"../../../../assets/svg/reward-points.svg":O0,"../../../../assets/svg/right-fork-icon.svg":C0,"../../../../assets/svg/robot_auto_reply.svg":E0,"../../../../assets/svg/robot_subscribe_reply.svg":S0,"../../../../assets/svg/save-draft.svg":w0,"../../../../assets/svg/sdk.svg":x0,"../../../../assets/svg/search-check-icon.svg":b0,"../../../../assets/svg/search-right.svg":_0,"../../../../assets/svg/search-tip.svg":y0,"../../../../assets/svg/search.svg":m0,"../../../../assets/svg/segmentation-down.svg":g0,"../../../../assets/svg/segmentation-icon.svg":v0,"../../../../assets/svg/segmentation-up.svg":p0,"../../../../assets/svg/segmentation.svg":h0,"../../../../assets/svg/select-disabled.svg":f0,"../../../../assets/svg/semantic-segmentation.svg":c0,"../../../../assets/svg/sensitive-icon.svg":d0,"../../../../assets/svg/seo-gray.svg":u0,"../../../../assets/svg/seo-highlight.svg":l0,"../../../../assets/svg/seo-light.svg":s0,"../../../../assets/svg/session-record.svg":a0,"../../../../assets/svg/session.svg":o0,"../../../../assets/svg/set-keywords.svg":i0,"../../../../assets/svg/setting.svg":r0,"../../../../assets/svg/share.svg":n0,"../../../../assets/svg/similarity.svg":t0,"../../../../assets/svg/skii.svg":e0,"../../../../assets/svg/source-energy.svg":Q_,"../../../../assets/svg/specify-reply-node.svg":Z_,"../../../../assets/svg/start-node.svg":J_,"../../../../assets/svg/statistical-analysis.svg":q_,"../../../../assets/svg/success.svg":K_,"../../../../assets/svg/suggested-issues.svg":Y_,"../../../../assets/svg/support.svg":G_,"../../../../assets/svg/switch-mobile.svg":X_,"../../../../assets/svg/system-setting.svg":V_,"../../../../assets/svg/team-manage-active.svg":U_,"../../../../assets/svg/team-manage.svg":W_,"../../../../assets/svg/team-manage2.svg":z_,"../../../../assets/svg/tengxunhunyuan.svg":F_,"../../../../assets/svg/test-active-menu-icon.svg":$_,"../../../../assets/svg/test-menu-icon.svg":H_,"../../../../assets/svg/think.svg":j_,"../../../../assets/svg/tongyiqianwen.svg":B_,"../../../../assets/svg/unit.svg":I_,"../../../../assets/svg/unknown-issue.svg":R_,"../../../../assets/svg/unknown-prompt.svg":P_,"../../../../assets/svg/use-token-active.svg":L_,"../../../../assets/svg/use-token.svg":D_,"../../../../assets/svg/user-icon.svg":T_,"../../../../assets/svg/variable-assignment-node.svg":A_,"../../../../assets/svg/vector-icon.svg":N_,"../../../../assets/svg/wenxinyiyan.svg":M_,"../../../../assets/svg/workflow-robot-icon.svg":k_,"../../../../assets/svg/workflow.svg":O_,"../../../../assets/svg/xitongtishici.svg":C_,"../../../../assets/svg/xunfeixinghuo.svg":E_,"../../../../assets/svg/yuezhianmian.svg":S_,"../../../../assets/svg/zhipuai.svg":w_})[`../../../../assets/svg/${g}.svg`],import.meta.url).href,l=tn(()=>s(i.iconName)),d=xe(i.title),c=()=>{o&&clearTimeout(o),o=setTimeout(()=>{e(d.value)},250)},f=()=>{t()},v=()=>{n()};return(g,y)=>{const b=Cr,x=Ir,w=Uh,_=Wh,C=Vh;return Y(),ae("div",Pk,[E("div",Rk,[E("div",Ik,[Ga(g.$slots,"node-icon",{},()=>[l.value?(Y(),ae("img",{key:0,class:"node-icon",src:l.value},null,8,Bk)):et("",!0)],!0)]),E("div",jk,[j(b,{class:"node-name-input",value:d.value,"onUpdate:value":y[0]||(y[0]=k=>d.value=k),placeholder:"请输入节点名称",onChange:cn(c,["stop"])},null,8,["value"])]),E("div",Hk,[r.hideMenus?et("",!0):(Y(),ze(C,{key:0},{overlay:U(()=>[j(_,{style:{width:"100px"}},{default:U(()=>[j(w,{onClick:y[2]||(y[2]=k=>f())},{default:U(()=>y[3]||(y[3]=[E("a",{href:"javascript:;"},"删除",-1)])),_:1,__:[3]})]),_:1})]),default:U(()=>[E("div",{class:"action-btn delete-btn",onClick:y[1]||(y[1]=cn(()=>{},["prevent"]))},[j(x,{name:"point-h",class:"btn-icon"})])]),_:1})),E("div",{class:"action-btn close-btn",onClick:v},[j($e(FC),{class:"btn-icon",style:{"font-size":"12px"}})])])]),E("div",$k,[Ga(g.$slots,"desc",{},()=>[Be(Te(i.desc),1)],!0)])])}}},vr=bt(Fk,[["__scopeId","data-v-50b4425e"]]),Kh="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",zk="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Wk=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"array<string>",value:"array<string>"}],Uk={emits:["close","update-node"],components:{NodeFormLayout:pr,NodeFormHeader:vr,QuestionCircleOutlined:Kn,PlusOutlined:In},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],show:!1,typOptions:[...Wk],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let r=JSON.parse(this.node.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global},methods:{update(){let r=JSON.parse(this.node.node_params);r.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(r)};this.$emit("update-node",e)},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(r,e){this.formState={...r},this.editIndex=e,this.show=!0},handleDel(r){this.diy_global.splice(r,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},Vk={class:"start-node-form"},Xk={class:"node-form-content"},Gk={class:"start-node"},Yk={class:"start-node-options"},Kk={class:"options-item-body"},qk={class:"option-label"},Jk={class:"option-type"},Zk={class:"start-node-options"},Qk={class:"options-title"},e2={class:"options-item-body"},t2={class:"option-label"},n2={class:"option-type"},r2={class:"item-actions-box"},i2={class:"action-items-box"};function o2(r,e,t,n,i,o){const s=Mn("NodeFormHeader"),l=Mn("QuestionCircleOutlined"),d=ki,c=Ir,f=Mn("PlusOutlined"),v=Bn,g=Cr,y=Xi,b=jr,x=Br,w=ua,_=rc,C=Mi,k=wr,D=Mn("NodeFormLayout");return Y(),ze(D,null,{header:U(()=>[j(s,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:U(()=>e[5]||(e[5]=[E("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",Vk,[E("div",Xk,[E("div",Gk,[E("div",Yk,[e[6]||(e[6]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Kh,alt:"",class:"title-icon"}),Be("输出")])],-1)),(Y(!0),ae(dt,null,yt(i.sys_global,R=>(Y(),ae("div",{class:Sn(["options-item",{"is-required":R.required}]),key:R.key},[E("div",Kk,[E("div",qk,Te(R.key),1),E("div",Jk,Te(R.typ),1)])],2))),128))]),E("div",Zk,[E("div",Qk,[e[8]||(e[8]=E("div",null,[E("img",{src:zk,alt:"",class:"title-icon"}),E("span",null,"自定义全局变量")],-1)),E("div",null,[j(d,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:U(()=>e[7]||(e[7]=[E("div",null,[Be(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),E("br"),Be(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),E("br"),Be(" 2、通过api访问时，可以再API中传递参数值"),E("br"),Be(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])),default:U(()=>[j(l,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(Y(!0),ae(dt,null,yt(i.diy_global,(R,$)=>(Y(),ae("div",{class:Sn(["options-item diy-options-item",{"is-required":R.required}]),key:R.key},[E("div",e2,[E("div",t2,Te(R.key),1),E("div",n2,Te(R.typ),1)]),E("div",r2,[j(c,{class:"action-btn",name:"edit-02",onClick:P=>o.handleEdit(R,$)},null,8,["onClick"]),j(c,{class:"action-btn",name:"close-circle",onClick:P=>o.handleDel($)},null,8,["onClick"])])],2))),128)),E("div",i2,[j(v,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:o.handleAdd},{icon:U(()=>[j(f)]),default:U(()=>[e[9]||(e[9]=Be(" 添加全局变量 "))]),_:1,__:[9]},8,["onClick"])])]),j(k,{open:i.show,"onUpdate:open":e[4]||(e[4]=R=>i.show=R),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:o.handleOk},{default:U(()=>[j(C,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:U(()=>[j(y,{label:"变量名",name:"key"},{default:U(()=>[j(g,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=R=>i.formState.key=R),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),j(y,{label:"类型",name:"typ"},{default:U(()=>[j(x,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=R=>i.formState.typ=R)},{default:U(()=>[(Y(!0),ae(dt,null,yt(i.typOptions,R=>(Y(),ze(b,{value:R.value,key:R.value},{default:U(()=>[E("span",null,Te(R.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),j(y,{label:"必填",name:"required"},{default:U(()=>[j(w,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=R=>i.formState.required=R)},null,8,["checked"])]),_:1}),j(y,{label:"描述",name:"desc"},{default:U(()=>[j(_,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=R=>i.formState.desc=R),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const a2=bt(Uk,[["render",o2],["__scopeId","data-v-47555c0d"]]),s2={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right"}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(r){r&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(r){const e=[],t=[],n=(i,o)=>{if(!i||i.length===0)return!1;for(let s=0;s<i.length;s++){const l=i[s],d=l[this.valueKey];if(d===r)return e[o]=l,t[o]=d,!0;if(l[this.childrenKey]&&l[this.childrenKey].length>0){if(e[o]=l,t[o]=d,n(l[this.childrenKey],o+1))return!0;e[o]=null,t[o]=null}}return!1};n(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(r){if(!r||r.length===0)return;const e=[];let t=this.options;for(let n=0;n<r.length;n++){const i=r[n],o=t.find(s=>s[this.valueKey]===i);if(o)e.push(o),t=o[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let r=0;r<this.selectedPath.length;r++){const e=this.selectedPath[r];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:r+1})}},handleSelect(r,e){this.hasChildren(r)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(r),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(r[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(r)&&this.activePath.push({title:r[this.labelKey],options:r[this.childrenKey],level:e+1}),this.$emit("select",r,this.selectedPath,e),(this.checkAnyLevel||!this.hasChildren(r))&&(this.$emit("change",r[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:r[this.valueKey]))},isActive(r,e){return!this.selectedPath||this.selectedPath.length<=e?!1:r[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(r){return r[this.childrenKey]&&r[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const r=this.$el;if(!r)return;const e=r.getBoundingClientRect(),t=window.innerWidth,n=180;e.right+n>t&&e.left>n?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",n)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",n))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},l2={class:"cascade-panel"},u2={class:"cascade-panel-body"},d2=["onClick"],c2={class:"item-content"},f2={class:"item-label"},h2={key:0,class:"item-icon"},p2={key:0,class:"cascade-panel-empty"};function v2(r,e,t,n,i,o){return Y(),ae("div",l2,[E("div",{class:Sn(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(Y(!0),ae(dt,null,yt(i.activePath,(s,l)=>(Y(),ae("div",{class:"cascade-panel-list",key:l},[E("div",u2,[(Y(!0),ae(dt,null,yt(s.options,d=>(Y(),ae("div",{class:Sn(["cascade-panel-item",{active:o.isActive(d,l)}]),key:d.value,onClick:c=>o.handleSelect(d,l)},[E("div",c2,[E("span",f2,Te(d.label),1),o.hasChildren(d)?(Y(),ae("span",h2,e[0]||(e[0]=[E("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[E("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)]))):et("",!0)])],10,d2))),128)),s.options&&s.options.length===0?(Y(),ae("div",p2," 暂无数据 ")):et("",!0)])]))),128))],2)])}const g2=bt(s2,[["render",v2],["__scopeId","data-v-ae341962"]]),S1=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...S1(t.children)):e.push(t)}),e},m2={name:"JMention",components:{CascadePanel:g2},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(r){r.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(r){r.target.closest(".dropdown-list")&&r.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1,this.showAtList=!1},onFocus(){this.$emit("focus")},onOpen(r){this.$emit("open",r)},getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=S1(this.options),i=[...t,...n].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const o=new Set;i.forEach(s=>{const l=new RegExp(`(${s.value})`,"g");if(l.test(this.defaultValue)&&!o.has(s.value)){let d=s.node_name+"."+s.text;d=d.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${d}</span> `),o.add(s.value),this.selectOption(s,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?o+=d.textContent.slice(0,n):o+=d.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const s=n.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?i+=d.textContent.slice(0,t):i+=d.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize(),i=window.innerWidth,o=window.innerHeight;let s=t.bottom,l=t.left;return s+n.height>o&&(s=t.top-n.height),l+n.width>i&&(l=t.right-n.width),s<0&&(s=0),l<0&&(l=0),{top:s,left:l}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:t,left:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${n}px; top:${t}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),s=o.startOffset,l=o.startContainer;let d=s-t,c=l;if(d<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){d=f.textContent.length-t,c=f;break}f=f.previousSibling}}if(c.nodeType===Node.TEXT_NODE){c.replaceData(d,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const v=document.createElement("span");v.contentEditable=!0,v.innerHTML+="&nbsp;",v.classList.add("at-space");for(const b in e)f.dataset[b]=e[b];const g=document.createRange();g.setStart(c,d),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),v.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())},handleDirectionChange(r,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),n=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!n)return;const i=parseFloat(t[1]),o=parseFloat(n[1]);let s;r==="left"?s=i-e:s=i+e,this.positionStyle=`left:${s}px; top:${o}px;`}}},y2={style:{width:"100%",position:"relative"}},_2={class:"mention-input-warpper",ref:"JMentionContainer"},b2=["placeholder"],x2={key:0,class:"placeholder"};function w2(r,e,t,n,i,o){const s=Mn("CascadePanel");return Y(),ae("div",y2,[e[5]||(e[5]=E("div",null,null,-1)),(Y(),ze(s_,{to:"body"},[i.showDropdown?(Y(),ae("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Ci(i.positionStyle)},[j(s,{options:i.showOptions,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","onChange","onDirectionChange"])],4)):et("",!0)])),E("div",_2,[E("div",{ref:"JMention",style:Ci([t.inputStyle]),class:Sn(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onWheel:e[0]||(e[0]=cn(()=>{},["stop"])),onFocus:e[1]||(e[1]=(...l)=>o.onFocus&&o.onFocus(...l)),onInput:e[2]||(e[2]=(...l)=>o.divInput&&o.divInput(...l)),onKeydown:e[3]||(e[3]=(...l)=>o.dropDownKeydown&&o.dropDownKeydown(...l)),onClick:e[4]||(e[4]=(...l)=>o.clickJMention&&o.clickJMention(...l))},null,46,b2),i.localValue.length==0?(Y(),ae("span",x2,Te(t.placeholder),1)):et("",!0)],512)])}const hr=bt(m2,[["render",w2],["__scopeId","data-v-73bd3767"]]),S2={class:"problem-optimization-form"},E2={class:"gray-block"},C2={class:"flex-block-item"},O2={class:"number-box"},k2={class:"number-slider-box"},M2={class:"number-input-box"},N2={class:"number-box"},A2={class:"number-slider-box"},T2={class:"number-input-box"},D2={class:"number-box"},L2={class:"number-box"},P2={class:"number-slider-box"},R2={class:"number-input-box"},I2={class:"field-list-item"},B2={class:"field-label"},j2={class:"field-type"},H2={class:"diy-form-item"},$2={class:"form-content"},F2={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Gr(),o=xe(null),s=tn(()=>i.modelList),l=xe([]),d=xe([]),c=xe(!1),f=()=>{c.value=!c.value},v=(q,ee)=>{_.prompt=q,_.prompt_tags=ee};function g(){const q=n.lf.getNodeModelById(n.nodeId);if(q){let ee=q.getAllParentVariable();d.value=y(ee)}}function y(q){return q.forEach(ee=>{ee.typ=="node"?ee.node_type==1?ee.value="global":ee.value=ee.node_id:ee.value=ee.key,ee.children&&ee.children.length>0&&(ee.children=y(ee.children))}),q}const b=()=>{const q=n.lf.getNodeModelById(n.nodeId);if(q){let ee=q.getAllParentVariable();l.value=ee}};function x(q){if(q){let ee=q.split("."),T=ee[0],z=ee.filter((B,pe)=>pe>0).join(".");return[T,z]}return["global","question"]}const w=xe(),_=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),C=()=>{const q=n.node.dataRaw||n.node.node_params||"{}",ee=JSON.stringify({question_optimize:JSON.parse(q).question_optimize||{}}),T=JSON.stringify({question_optimize:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});ee!=T&&t("update-node",{...n.node,..._,node_params:T})},k=()=>{try{let q=n.node.dataRaw||n.node.node_params||"{}",ee=JSON.parse(q).question_optimize||{};ee=JSON.parse(JSON.stringify(ee));let{model_config_id:T,use_model:z,context_pair:B,temperature:pe,max_token:Ee,prompt:ye,prompt_tags:it,question_value:Oe,enable_thinking:he}=ee;b(),g(),_.model_config_id=T,_.use_model=z,_.context_pair=B||0,_.temperature=pe,_.max_token=Ee,_.prompt=ye,_.enable_thinking=he,_.prompt_tags=it||[],_.question_value=x(Oe),!_.model_config_id&&s.value.length>0&&(_.model_config_id=s.value[0].id,_.use_model=s.value[0].children[0].name)}catch(q){}};Qt(()=>_,()=>{C()},{deep:!0});const D=xe(null),R=q=>{_.prompt="",q.prompt_type==1?_.prompt=q.markdown:_.prompt=q.prompt,_n(()=>{o.value.initData()})},$=q=>{q||g()},P=xe({}),I=(q,ee)=>{P.value=ee},W=tn(()=>{if(!_.model_config_id)return!1;let q=_.model_config_id+"#"+_.use_model;return P.value[q]}),se=()=>{t("close")};return qt(()=>{k()}),(q,ee)=>{const T=Bn,z=Xi,B=ki,pe=zl,Ee=da,ye=Ni,it=ua,Oe=vs,he=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:se},null,8,["title","iconName"])]),default:U(()=>[E("div",S2,[E("div",{class:"node-form-content",onMousedown:ee[11]||(ee[11]=cn(()=>{},["stop"]))},[j(he,{ref_key:"formRef",ref:w,layout:"vertical",model:_},{default:U(()=>[E("div",E2,[ee[24]||(ee[24]=E("div",{class:"gray-block-title"},"输入",-1)),j(z,{label:"LLM模型",name:"use_model"},{default:U(()=>[E("div",C2,[j(oc,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":ee[0]||(ee[0]=We=>_.use_model=We),modeId:_.model_config_id,"onUpdate:modeId":ee[1]||(ee[1]=We=>_.model_config_id=We),onLoaded:I,style:{width:"348px"}},null,8,["modeName","modeId"]),j(T,{onClick:f},{default:U(()=>[ee[12]||(ee[12]=Be("高级设置 ")),c.value?(Y(),ze($e(ps),{key:0})):(Y(),ze($e(ic),{key:1}))]),_:1,__:[12]})])]),_:1}),c.value?(Y(),ze(z,{key:0,name:"temperature"},{label:U(()=>[ee[14]||(ee[14]=E("span",null,"温度 ",-1)),j(B,null,{title:U(()=>ee[13]||(ee[13]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",O2,[E("div",k2,[j(Ee,null,{default:U(()=>[j(pe,{class:"custom-slider",value:_.temperature,"onUpdate:value":ee[2]||(ee[2]=We=>_.temperature=We),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",M2,[j(ye,{value:_.temperature,"onUpdate:value":ee[3]||(ee[3]=We=>_.temperature=We),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):et("",!0),c.value?(Y(),ze(z,{key:1,name:"max_token"},{label:U(()=>[ee[16]||(ee[16]=E("span",null,"最大token ",-1)),j(B,null,{title:U(()=>ee[15]||(ee[15]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",N2,[E("div",A2,[j(Ee,null,{default:U(()=>[j(pe,{class:"custom-slider",value:_.max_token,"onUpdate:value":ee[4]||(ee[4]=We=>_.max_token=We),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",T2,[j(ye,{value:_.max_token,"onUpdate:value":ee[5]||(ee[5]=We=>_.max_token=We),min:0,max:100*1024},null,8,["value"])])])]),_:1})):et("",!0),c.value&&W.value?(Y(),ze(z,{key:2,name:"enable_thinking"},{label:U(()=>[ee[18]||(ee[18]=E("span",null,"深度思考 ",-1)),j(B,null,{title:U(()=>ee[17]||(ee[17]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",D2,[j(it,{checked:_.enable_thinking,"onUpdate:checked":ee[6]||(ee[6]=We=>_.enable_thinking=We)},null,8,["checked"])])]),_:1})):et("",!0),j(z,{name:"context_pair"},{label:U(()=>[ee[20]||(ee[20]=E("span",null,"上下文数量 ",-1)),j(B,null,{title:U(()=>ee[19]||(ee[19]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",L2,[E("div",P2,[j(Ee,null,{default:U(()=>[j(pe,{class:"custom-slider",value:_.context_pair,"onUpdate:value":ee[7]||(ee[7]=We=>_.context_pair=We),min:0,max:50},null,8,["value"])]),_:1})]),E("div",R2,[j(ye,{value:_.context_pair,"onUpdate:value":ee[8]||(ee[8]=We=>_.context_pair=We),min:0,max:50},null,8,["value"])])])]),_:1}),j(z,{name:"prompt",class:"width-100"},{label:U(()=>ee[21]||(ee[21]=[E("div",{class:"space-between-box"},[E("div",null,"对话背景")],-1)])),default:U(()=>[j(hr,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:o,onOpen:b,onChange:ee[9]||(ee[9]=(We,Re)=>v(We,Re)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:U(({label:We,payload:Re})=>[E("div",I2,[E("div",B2,Te(We),1),E("div",j2,Te(Re.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),ee[22]||(ee[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",H2,[ee[23]||(ee[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",$2,[j(Oe,{value:_.question_value,"onUpdate:value":ee[10]||(ee[10]=We=>_.question_value=We),onDropdownVisibleChange:$,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:We})=>We.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),ee[25]||(ee[25]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"问题优化结果"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[25]},8,["model"]),j(_1,{onOk:R,ref_key:"importPromptRef",ref:D},null,512)],32)])]),_:1})}}},z2=bt(F2,[["__scopeId","data-v-2f37db05"]]),W2={class:"input-box"},U2={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(r,{expose:e,emit:t}){const n=xe(!1),i=t;Qt(()=>n.value,v=>{v||i("ok")});const o=r,s=xe(null),l=()=>{n.value=!0,_n(()=>{s.value.refresh()})},d=v=>{i("open",v)},c=(v,g)=>{i("change",v,g)},f=()=>{n.value=!1};return e({show:l}),(v,g)=>{const y=Bn,b=wr;return Y(),ae("div",null,[j(b,{open:n.value,"onUpdate:open":g[1]||(g[1]=x=>n.value=x),title:"字段详情",width:746},{footer:U(()=>[j(y,{type:"primary",onClick:f},{default:U(()=>g[2]||(g[2]=[Be("确定")])),_:1,__:[2]})]),default:U(()=>[E("div",W2,[j(hr,{inputStyle:"height: 550px;",options:o.options,defaultSelectedList:o.defaultSelectedList,defaultValue:o.defaultValue,placeholder:o.placeholder,type:o.type,ref_key:"atInputRef",ref:s,onOpen:d,onChange:g[0]||(g[0]=(x,w)=>c(x,w))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},E1=bt(U2,[["__scopeId","data-v-1f67dd47"]]),V2={class:"problem-optimization-form"},X2={class:"gray-block"},G2={class:"flex-block-item"},Y2={class:"number-box"},K2={class:"number-slider-box"},q2={class:"number-input-box"},J2={class:"number-box"},Z2={class:"number-slider-box"},Q2={class:"number-input-box"},eM={class:"number-box"},tM={class:"number-box"},nM={class:"number-slider-box"},rM={class:"number-input-box"},iM={class:"space-between-box"},oM={class:"field-list-item"},aM={class:"field-label"},sM={class:"field-type"},lM={class:"diy-form-item"},uM={class:"form-content"},dM={class:"diy-form-item mt12"},cM={class:"form-content"},fM={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Nt("getNode"),o=Gr(),s=xe(null),l=tn(()=>o.modelList),d=xe([]),c=xe([]),f=xe(!1),v=xe(),g=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),y=()=>{f.value=!f.value},b=(Ee,ye)=>{g.prompt=Ee,g.prompt_tags=ye};function x(){let Ee=i().getAllParentVariable();c.value=_(Ee)}const w=tn(()=>c.value.filter(ye=>ye.node_type==5));function _(Ee){return Ee.forEach(ye=>{ye.typ=="node"?ye.node_type==1?ye.value="global":ye.value=ye.node_id:ye.value=ye.key,ye.children&&ye.children.length>0&&(ye.children=_(ye.children))}),Ee}const C=()=>{let Ee=i().getAllParentVariable();d.value=Ee};function k(Ee){if(Ee){let ye=Ee.split("."),it=ye[0],Oe=ye.filter((he,We)=>We>0).join(".");return[it,Oe]}return["global","question"]}const D=xe(null),R=()=>{D.value.show()},$=Ee=>{g.prompt="",Ee.prompt_type==1?g.prompt=Ee.markdown:g.prompt=Ee.prompt,_n(()=>{s.value.initData()})},P=xe(null),I=()=>{P.value.show()},W=()=>{s.value.refresh()},se=()=>{const Ee=JSON.stringify({llm:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});t("update-node",{...n.node,...g,node_params:Ee})},q=()=>{try{let Ee=n.node.dataRaw||n.node.node_params||"{}",ye=JSON.parse(Ee).llm||{};ye=JSON.parse(JSON.stringify(ye));let{model_config_id:it,use_model:Oe,context_pair:he,temperature:We,max_token:Re,prompt:Ge,prompt_tags:le,question_value:G,enable_thinking:oe,libs_node_key:de}=ye;C(),x(),g.model_config_id=it,g.use_model=Oe,g.context_pair=he||0,g.temperature=We,g.max_token=Re,g.prompt=Ge,g.enable_thinking=oe,g.prompt_tags=le||[],g.libs_node_key=de,g.question_value=k(G),!g.model_config_id&&l.value.length>0&&(g.model_config_id=l.value[0].id,g.use_model=l.value[0].children[0].name)}catch(Ee){}};Qt(()=>g,()=>{se()},{deep:!0});const ee=Ee=>{Ee||x()},T=xe({}),z=(Ee,ye)=>{T.value=ye},B=tn(()=>{if(!g.model_config_id)return!1;let Ee=g.model_config_id+"#"+g.use_model;return T.value[Ee]}),pe=()=>{t("close")};return qt(()=>{q()}),(Ee,ye)=>{const it=Bn,Oe=Xi,he=ki,We=zl,Re=da,Ge=Ni,le=ua,G=gs,oe=vs,de=jr,ke=Br,Ye=Mi,Ie=_1;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:pe},null,8,["title","iconName"])]),default:U(()=>[E("div",V2,[E("div",{class:"node-form-content",onMousedown:ye[12]||(ye[12]=cn(()=>{},["stop"]))},[j(Ye,{ref_key:"formRef",ref:v,layout:"vertical",model:g},{default:U(()=>[E("div",X2,[ye[28]||(ye[28]=E("div",{class:"gray-block-title"},"输入",-1)),j(Oe,{label:"LLM模型",name:"use_model"},{default:U(()=>[E("div",G2,[j(oc,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":ye[0]||(ye[0]=Fe=>g.use_model=Fe),modeId:g.model_config_id,"onUpdate:modeId":ye[1]||(ye[1]=Fe=>g.model_config_id=Fe),onLoaded:z,style:{width:"348px"}},null,8,["modeName","modeId"]),j(it,{onClick:y},{default:U(()=>[ye[14]||(ye[14]=Be("高级设置 ")),f.value?(Y(),ze($e(ps),{key:0})):(Y(),ze($e(ic),{key:1}))]),_:1,__:[14]})])]),_:1}),f.value?(Y(),ze(Oe,{key:0,name:"temperature"},{label:U(()=>[ye[16]||(ye[16]=E("span",null,"温度 ",-1)),j(he,null,{title:U(()=>ye[15]||(ye[15]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",Y2,[E("div",K2,[j(Re,null,{default:U(()=>[j(We,{class:"custom-slider",value:g.temperature,"onUpdate:value":ye[2]||(ye[2]=Fe=>g.temperature=Fe),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",q2,[j(Ge,{value:g.temperature,"onUpdate:value":ye[3]||(ye[3]=Fe=>g.temperature=Fe),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):et("",!0),f.value?(Y(),ze(Oe,{key:1,name:"max_token"},{label:U(()=>[ye[18]||(ye[18]=E("span",null,"最大token ",-1)),j(he,null,{title:U(()=>ye[17]||(ye[17]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",J2,[E("div",Z2,[j(Re,null,{default:U(()=>[j(We,{class:"custom-slider",value:g.max_token,"onUpdate:value":ye[4]||(ye[4]=Fe=>g.max_token=Fe),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",Q2,[j(Ge,{value:g.max_token,"onUpdate:value":ye[5]||(ye[5]=Fe=>g.max_token=Fe),min:0,max:100*1024},null,8,["value"])])])]),_:1})):et("",!0),f.value&&B.value?(Y(),ze(Oe,{key:2,name:"enable_thinking"},{label:U(()=>[ye[20]||(ye[20]=E("span",null,"深度思考 ",-1)),j(he,null,{title:U(()=>ye[19]||(ye[19]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",eM,[j(le,{checked:g.enable_thinking,"onUpdate:checked":ye[6]||(ye[6]=Fe=>g.enable_thinking=Fe)},null,8,["checked"])])]),_:1})):et("",!0),j(Oe,{name:"context_pair"},{label:U(()=>[ye[22]||(ye[22]=E("span",null,"上下文数量 ",-1)),j(he,null,{title:U(()=>ye[21]||(ye[21]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",tM,[E("div",nM,[j(Re,null,{default:U(()=>[j(We,{class:"custom-slider",value:g.context_pair,"onUpdate:value":ye[7]||(ye[7]=Fe=>g.context_pair=Fe),min:0,max:50},null,8,["value"])]),_:1})]),E("div",rM,[j(Ge,{value:g.context_pair,"onUpdate:value":ye[8]||(ye[8]=Fe=>g.context_pair=Fe),min:0,max:50},null,8,["value"])])])]),_:1}),j(Oe,{name:"prompt",class:"width-100"},{label:U(()=>[E("div",iM,[ye[24]||(ye[24]=E("div",null,"提示词",-1)),j(G,{gap:8},{default:U(()=>[E("div",{class:"btn-hover-wrap",onClick:R},[j($e(zC)),ye[23]||(ye[23]=Be("从提示词库导入 "))]),E("div",{class:"btn-hover-wrap",onClick:I},[j($e(Xh))])]),_:1})])]),default:U(()=>[j(hr,{type:"textarea",inputStyle:"height: 100px;",options:d.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:s,onOpen:C,onChange:ye[9]||(ye[9]=(Fe,Ot)=>b(Fe,Ot)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:U(({label:Fe,payload:Ot})=>[E("div",oM,[E("div",aM,Te(Fe),1),E("div",sM,Te(Ot.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),ye[25]||(ye[25]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[25]}),E("div",lM,[ye[26]||(ye[26]=E("div",{class:"form-label"},"用户问题",-1)),E("div",uM,[j(oe,{value:g.question_value,"onUpdate:value":ye[10]||(ye[10]=Fe=>g.question_value=Fe),onDropdownVisibleChange:ee,style:{width:"220px"},options:c.value,allowClear:!1,displayRender:({labels:Fe})=>Fe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),E("div",dM,[ye[27]||(ye[27]=E("div",{class:"form-label"},"知识库引用",-1)),E("div",cM,[j(ke,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:ee,value:g.libs_node_key,"onUpdate:value":ye[11]||(ye[11]=Fe=>g.libs_node_key=Fe),style:{width:"220px"}},{default:U(()=>[(Y(!0),ae(dt,null,yt(w.value,Fe=>(Y(),ze(de,{value:Fe.node_id,key:Fe.node_id},{default:U(()=>[Be(Te(Fe.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),ye[29]||(ye[29]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"AI回复内容"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[29]},8,["model"])],32),j(Ie,{onOk:$,ref_key:"importPromptRef",ref:D},null,512),j(E1,{options:d.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:C,onChange:ye[13]||(ye[13]=(Fe,Ot)=>b(Fe,Ot)),onOk:W,ref_key:"fullAtInputRef",ref:P},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},hM=bt(fM,[["__scopeId","data-v-4d324acd"]]),Ul="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Mo=PC("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(r=>{this.formListQueue.push(r)});this.formListLoading=!0;try{const r=await wO();this.formList=r.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(r){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:r}){if(this.formFieldListMap[r]&&this.formFieldListMap[r].length>0)return[...this.formFieldListMap[r]];if(this.formFieldListLoadingMap[r])return new Promise(e=>{this.formFieldListQueueMap[r]||(this.formFieldListQueueMap[r]=[]),this.formFieldListQueueMap[r].push(e)});this.formFieldListLoadingMap[r]=!0;try{const e=await xO({form_id:r});this.formFieldListMap[r]=e.data||[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}catch(e){this.formFieldListMap[r]=[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}finally{this.formFieldListLoadingMap[r]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:r}){return this.formFieldListMap[r]=[],this.formFieldListLoadingMap[r]=!1,this.formFieldListQueueMap[r]=[],await this.getFormFieldList({form_id:r})}}}),pM={class:"field-select-box"},vM={key:0,class:"field-list-box"},gM={key:1,class:"empty-box"},mM={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Mo(),o=Jt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),s=xe([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),l=xe([]),d=(b,x)=>{o.selectedRowKeys=b,o.selectedRows=x},c=({formId:b,selectedRowKeys:x,selectedRows:w})=>{o.formId=b,o.selectedRowKeys=x,o.selectedRows=w,y(),o.show=!0},f=()=>{window.open("/#/database/details/field-manage?form_id="+o.formId)},v=()=>{n("ok",o.selectedRowKeys,o.selectedRows),o.show=!1},g=xe(!1),y=()=>{g.value=!0,i.getFormFieldList({form_id:o.formId}).then(b=>{g.value=!1,b.forEach(x=>{x.value="",x.id=x.id*1}),l.value=b}).catch(()=>{g.value=!1})};return e({open:c}),(b,x)=>{const w=c_,_=wr;return Y(),ze(_,{width:"746px",open:o.show,"onUpdate:open":x[0]||(x[0]=C=>o.show=C),title:"关联数据表",onOk:v,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[E("div",pM,[l.value.length?(Y(),ae("div",vM,[j(w,{rowKey:"name","row-selection":{selectedRowKeys:o.selectedRowKeys,onChange:d},dataSource:l.value,columns:s.value,loading:g.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):et("",!0),l.value.length?et("",!0):(Y(),ae("div",gM,[x[2]||(x[2]=E("img",{src:Yh,alt:""},null,-1)),E("div",null,[x[1]||(x[1]=Be(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},yM=bt(mM,[["__scopeId","data-v-0e3939aa"]]),_M={class:"field-list"},bM={class:"field-list-row"},xM={key:0,class:"field-list-col field-list-col-head field-value-head"},wM={key:1,class:"field-list-col field-list-col-head field-del-head"},SM={key:0,class:"field-list-row"},EM={class:"field-list-col field-value-col"},CM={class:"field-list-col field-name-col"},OM={class:"field-list-col field-type-col"},kM={key:0,class:"field-list-col field-value-col"},MM={key:1,class:"field-list-col field-del-col"},NM=["onClick"],AM={key:0,class:"add-btn-box"},TM={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=Nt("getNode"),o=Jt({list:n.list});Qt(()=>n.list,x=>{o.list=x});const s=xe([]),l=()=>{let x=i().getAllParentVariable();s.value=x||[]},d=()=>{l()},c=(x,w,_,C)=>{o.list[C].value=x,o.list[C].atTags=w,g()},f=(x,w)=>{o.list=[...w],g()},v=x=>{o.list.splice(x,1),g()},g=()=>{t("change",[...o.list])},y=xe(),b=()=>{y.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(x=>x.name)})};return qt(()=>{l()}),(x,w)=>{const _=Cr,C=ki,k=Ir,D=Bn;return Y(),ae("div",null,[E("div",_M,[E("div",bM,[w[0]||(w[0]=E("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),w[1]||(w[1]=E("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),r.showInput?(Y(),ae("div",xM,"字段值")):et("",!0),n.showDelete?(Y(),ae("div",wM)):et("",!0)]),r.showEmptyFieldRow?(Y(),ae("div",SM,[w[2]||(w[2]=E("div",{class:"field-list-col field-name-col"},"--",-1)),w[3]||(w[3]=E("div",{class:"field-list-col field-type-col"},"--",-1)),E("div",EM,[j(C,{title:"请先选择数据库"},{default:U(()=>[j(_,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):et("",!0),(Y(!0),ae(dt,null,yt(o.list,(R,$)=>(Y(),ae("div",{class:"field-list-row",key:R.name},[E("div",CM,Te(R.name),1),E("div",OM,Te(R.type),1),r.showInput?(Y(),ae("div",kM,[j(hr,{options:s.value,defaultValue:R.value,defaultSelectedList:R.atTags,onOpen:d,onChange:(P,I)=>c(P,I,R,$),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):et("",!0),n.showDelete?(Y(),ae("div",MM,[E("span",{class:"del-btn",onClick:P=>v($)},[j(k,{class:"del-icon",name:"close-circle"})],8,NM)])):et("",!0)]))),128))]),n.showAdd?(Y(),ae("div",AM,[j(D,{class:"add-btn",type:"dashed",block:"",onClick:b},{default:U(()=>[j($e(In)),w[4]||(w[4]=Be(" 添加更新字段"))]),_:1,__:[4]})])):et("",!0),j(yM,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:y,onOk:f},null,8,["formId"])])}}},qh=bt(TM,[["__scopeId","data-v-7a244ed7"]]),DM={class:"library-checkbox-box"},LM={class:"list-box",ref:"scrollContainer"},PM={class:"library-name"},RM={class:"library-desc"},IM={key:1,class:"empty-box"},BM={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=r,o=xe(),s=xe(!1),l=v=>{o.value=v,s.value=!0},d=()=>{s.value=!1,c()},c=()=>{let v=i.options.filter(g=>g.id===o.value);n("ok",o.value,JSON.parse(JSON.stringify(v[0])))},f=()=>{window.open("/#/database/list")};return e({open:l}),(v,g)=>{const y=h_,b=f_,x=wr;return Y(),ze(x,{width:"746px",open:s.value,"onUpdate:open":g[1]||(g[1]=w=>s.value=w),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:d},{default:U(()=>[E("div",DM,[r.options.length?(Y(),ze(b,{key:0,value:o.value,"onUpdate:value":g[0]||(g[0]=w=>o.value=w),style:{width:"100%"}},{default:U(()=>[E("div",LM,[(Y(!0),ae(dt,null,yt(i.options,w=>(Y(),ae("div",{class:"list-item-wraapper",key:w.id},[j(y,{class:"list-item",value:w.id},{default:U(()=>[E("div",PM,Te(w.name),1),E("div",RM,Te(w.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):et("",!0),r.options.length?et("",!0):(Y(),ae("div",IM,[g[3]||(g[3]=E("img",{src:Yh,alt:""},null,-1)),E("div",null,[g[2]||(g[2]=Be(" 暂无数据表, 请先去添加数据表 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},jM=bt(BM,[["__scopeId","data-v-ee44bfef"]]),HM={class:""},$M={key:0,class:"data-table-info"},FM={class:"data-table-name"},zM={class:"data-table-desc"},WM={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(r,{emit:e}){const t=e,n=r,i=xe(null),o=tn(()=>{let c=n.options.filter(f=>f.id===n.value);return c.length?c[0]:null}),s=()=>{i.value.open()},l=(c,f)=>{t("update:value",c),t("change",c,f)},d=()=>{t("update:value",""),t("change","")};return(c,f)=>{const v=Ir,g=Bn;return Y(),ae("div",HM,[n.value?(Y(),ae("div",$M,[E("div",FM,Te(o.value?o.value.name:n.title),1),E("div",zM,Te(o.value?o.value.description:n.description),1),j(v,{class:"del-btn",name:"close-circle",onClick:d})])):(Y(),ze(g,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:s},{default:U(()=>[j($e(In)),f[0]||(f[0]=Be(" 选择数据表"))]),_:1,__:[0]})),j(jM,{ref_key:"tableSelectAlertRef",ref:i,onOk:l,options:r.options},null,8,["options"])])}}},ac=bt(WM,[["__scopeId","data-v-550ecdef"]]),UM={class:"add-data-form"},VM={class:"node-box-content"},XM={class:"setting-box"},GM={class:"setting-box"},YM={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Mo();let o={};const s=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=(y,b)=>{b?(s.formData.form_name=b.name,s.formData.form_description=b.description,g(b.id)):(s.formData.form_name="",s.formData.form_description="",s.formData.datas=[]),f()},d=y=>{s.formData.datas=y,f()},c=()=>{let y=n.node.dataRaw||n.node.node_params||"{}";o=JSON.parse(y),s.formData=o.form_insert,f()},f=()=>{o.form_insert=Vi(s.formData),t("update-node",{...n.node,node_params:JSON.stringify(o)})},v=async()=>{const y=await i.getFormList();s.tableList=y},g=async y=>{i.getFormFieldList({form_id:y}).then(b=>{b.forEach(x=>{x.id=x.id*1}),s.formData.datas=b,f()}).catch(()=>{})};return qt(()=>{v(),c()}),(y,b)=>(Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:U(()=>b[1]||(b[1]=[E("span",null,[Be("在指定数据表中插入数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",UM,[E("div",VM,[b[2]||(b[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ul,alt:""}),E("span",{class:"text"},"输入")],-1)),b[3]||(b[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",XM,[j(ac,{options:s.tableList,title:s.formData.form_name,description:s.formData.form_description,value:s.formData.form_id,"onUpdate:value":b[0]||(b[0]=x=>s.formData.form_id=x),onChange:l},null,8,["options","title","description","value"])]),b[4]||(b[4]=E("div",{class:"setting-label"},[E("span",null,"插入数据"),E("span",{class:"tip"},"（不填写字段值则为空）")],-1)),E("div",GM,[j(qh,{"form-id":s.formData.form_id,showEmptyFieldRow:s.formData.form_id=="",list:s.formData.datas,showAdd:!1,showDelete:!1,onChange:d},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},KM=bt(YM,[["__scopeId","data-v-b11302f4"]]),qM={class:"library-checkbox-box"},JM={class:"list-tools"},ZM={class:"list-box",ref:"scrollContainer"},QM={class:"library-name"},eN={class:"library-desc"},tN={__name:"library-select-alert",emits:["change","close"],setup(r,{expose:e,emit:t}){const n=t,i=Jt({indeterminate:!1,checkAll:!1,checkedList:[]}),o=xe(!1),s=_=>{g(),i.checkedList=_,o.value=!0},l=()=>{o.value=!1,v()},d=xe(""),c=()=>{g()},f=xe([]),v=()=>{n("change",[...i.checkedList])},g=async()=>{const _=await Fh({library_name:d.value,type:""});if(_){let C=_.data||[];f.value=C}},y=xe(!1),b=async()=>{y.value=!0,await g(),y.value=!1,Rn.success("刷新完成")},x=()=>{window.open("/#/library/add")},w=()=>{n("close")};return e({open:s}),(_,C)=>{const k=Cr,D=Bn,R=v_,$=VC,P=p_,I=wr;return Y(),ze(I,{width:"746px",open:o.value,"onUpdate:open":C[2]||(C[2]=W=>o.value=W),title:"关联知识库",onCancel:w,onOk:l,okText:"确定",cancelText:"取消"},{default:U(()=>[E("div",qM,[E("div",JM,[E("div",null,[j(k,{style:{width:"282px"},value:d.value,"onUpdate:value":C[0]||(C[0]=W=>d.value=W),placeholder:"请输入知识库名称搜索",onChange:c},{suffix:U(()=>[j($e(WC),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),E("div",null,[j(D,{style:{"margin-right":"8px"},onClick:b},{default:U(()=>[j($e(UC)),C[3]||(C[3]=Be(" 刷新 "))]),_:1,__:[3]}),j(D,{type:"primary",ghost:"",onClick:x},{default:U(()=>C[4]||(C[4]=[Be("新建知识库")])),_:1,__:[4]})])]),j(P,{spinning:y.value,delay:100},{default:U(()=>[j($,{value:i.checkedList,"onUpdate:value":C[1]||(C[1]=W=>i.checkedList=W),style:{width:"100%"}},{default:U(()=>[E("div",ZM,[(Y(!0),ae(dt,null,yt(f.value,W=>(Y(),ae("div",{class:"list-item-wraapper",key:W.id},[j(R,{class:"list-item",value:W.id},{default:U(()=>[E("div",QM,Te(W.library_name),1),E("div",eN,Te(W.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},nN=bt(tN,[["__scopeId","data-v-3ab71d50"]]),rN={class:"recall-settings-box"},iN={class:"form-box"},oN={class:"form-item is-required"},aN={class:"form-item-body"},sN={class:"retrieval-mode-items"},lN=["onClick"],uN={class:"retrieval-mode-title"},dN={class:"title-text"},cN={class:"retrieval-mode-desc"},fN={class:"form-item"},hN={class:"form-item-label"},pN={class:"form-item-body"},vN={class:"number-box"},gN={class:"number-slider-box"},mN={class:"number-input-box"},yN={class:"form-item"},_N={class:"form-item-label"},bN={class:"form-item-body"},xN={class:"number-box"},wN={class:"number-slider-box"},SN={class:"number-input-box"},EN={class:"form-item"},CN={class:"form-item-label"},ON={class:"form-item-body"},kN=["src"],MN={__name:"recall-settings-alert",emits:["change"],setup(r,{expose:e,emit:t}){const n=t,i=xe([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=Jt({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=xe(!1),l=x=>{b(),o.rerank_status=x.rerank_status||0,o.rerank_use_model=x.rerank_use_model||void 0,o.rerank_model_config_id=x.rerank_model_config_id||"",o.top_k=x.top_k,o.similarity=x.similarity,o.search_type=x.search_type,s.value=!0},d=(x,w)=>{o.rerank_model_config_id=w.rerank_model_config_id},c=x=>{o.search_type=x},f=()=>o.rerank_status==1&&!o.rerank_model_config_id,v=()=>{if(f())return Rn.error("请选择Rerank模型");s.value=!1,g()},g=()=>{n("change",Vi(o))},y=xe([]),b=()=>{b1({model_type:"RERANK"}).then(x=>{let w=x.data||[];y.value=w.map(_=>({id:_.model_config.id,name:_.model_info.model_name,icon:_.model_info.model_icon_url,children:_.model_info.rerank_model_list}))})};return e({open:l}),(x,w)=>{const _=Ir,C=ki,k=zl,D=Ni,R=ua,$=gs,P=jr,I=XC,W=Br,se=wr;return Y(),ze(se,{width:"472px",open:s.value,"onUpdate:open":w[6]||(w[6]=q=>s.value=q),title:"召回设置",onOk:v,okText:"确定",cancelText:"取消"},{default:U(()=>[E("div",rN,[E("div",iN,[E("div",oN,[w[7]||(w[7]=E("div",{class:"form-item-label"},[E("span",null,"检索模式")],-1)),E("div",aN,[E("div",sN,[(Y(!0),ae(dt,null,yt(i.value,q=>(Y(),ae("div",{class:Sn(["retrieval-mode-item",{active:o.search_type==q.value}]),key:q.value,onClick:ee=>c(q.value)},[o.search_type==q.value?(Y(),ze(_,{key:0,class:"check-arrow",name:"check-arrow-filled"})):et("",!0),E("div",uN,[j(_,{name:q.iconName,class:"title-icon"},null,8,["name"]),E("span",dN,Te(q.title),1),q.isRecommendation?(Y(),ze(_,{key:0,class:"recommendation-icon",name:"recommendation"})):et("",!0)]),E("div",cN,Te(q.desc),1)],10,lN))),128))])])]),E("div",fN,[E("div",hN,[w[9]||(w[9]=E("span",null,"Top K ",-1)),j(C,null,{title:U(()=>w[8]||(w[8]=[Be("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),E("div",pN,[E("div",vN,[E("div",gN,[j(k,{class:"custom-slider",value:o.top_k,"onUpdate:value":w[0]||(w[0]=q=>o.top_k=q),min:1,max:10},null,8,["value"])]),E("div",mN,[j(D,{value:o.top_k,"onUpdate:value":w[1]||(w[1]=q=>o.top_k=q),min:1,max:10},null,8,["value"])])])])]),E("div",yN,[E("div",_N,[w[11]||(w[11]=E("span",null,"相似度阈值 ",-1)),j(C,null,{title:U(()=>w[10]||(w[10]=[Be("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),E("div",bN,[E("div",xN,[E("div",wN,[j(k,{class:"custom-slider",value:o.similarity,"onUpdate:value":w[2]||(w[2]=q=>o.similarity=q),min:0,max:1,step:.01},null,8,["value"])]),E("div",SN,[j(D,{value:o.similarity,"onUpdate:value":w[3]||(w[3]=q=>o.similarity=q),min:0,max:1,step:.01},null,8,["value"])])])])]),E("div",EN,[E("div",CN,[w[12]||(w[12]=E("span",null,"Rerank模型",-1)),w[13]||(w[13]=Be("   ")),j(R,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":w[4]||(w[4]=q=>o.rerank_status=q)},null,8,["checked"])]),E("div",ON,[j(W,{value:o.rerank_use_model,"onUpdate:value":w[5]||(w[5]=q=>o.rerank_use_model=q),placeholder:"请选择Rerank模型",onChange:d,style:{width:"320px"}},{default:U(()=>[(Y(!0),ae(dt,null,yt(y.value,q=>(Y(),ze(I,{key:q.id},{label:U(()=>[j($,{align:"center",gap:8},{default:U(()=>[E("img",{class:"model-icon",src:q.icon,alt:""},null,8,kN),Be(Te(q.name),1)]),_:2},1024)]),default:U(()=>[(Y(!0),ae(dt,null,yt(q.children,ee=>(Y(),ze(P,{value:ee,rerank_model_config_id:q.id,key:ee},{default:U(()=>[E("span",null,Te(ee),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},NN=bt(MN,[["__scopeId","data-v-ebd2f855"]]),AN={class:"problem-optimization-form"},TN={class:"node-form-content"},DN={class:"gray-block"},LN={class:"avatar-box"},PN=["src"],RN={class:"content-box"},IN={class:"list-name"},BN={class:"list-intro"},jN=["onClick"],HN={class:"btn-block"},$N={class:"diy-form-item"},FN={class:"form-content"},zN={class:"form-content"},WN={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=xe([]);function o(){const I=n.lf.getNodeModelById(n.nodeId);if(I){let W=I.getAllParentVariable();i.value=s(W)}}function s(I){return I.forEach(W=>{W.typ=="node"?W.node_type==1?W.value="global":W.value=W.node_id:W.value=W.key,W.children&&W.children.length>0&&(W.children=s(W.children))}),I}function l(I){if(I){let W=I.split("."),se=W[0],q=W.filter((ee,T)=>T>0).join(".");return[se,q]}return["global","question"]}const d=xe(),c=Jt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:""}),f=()=>{const I=JSON.stringify({libs:{...c,rerank_model_config_id:c.rerank_model_config_id?+c.rerank_model_config_id:void 0,question_value:c.question_value.join("."),library_ids:c.library_ids.join(",")}});t("update-node",{...n.node,...c,node_params:I})},v=()=>{try{let I=n.node.dataRaw||n.node.node_params||"{}",W=JSON.parse(I).libs||{};o(),W=JSON.parse(JSON.stringify(W));for(let se in W)se=="library_ids"?c[se]=W[se]?W[se].split(","):[]:se=="question_value"?c.question_value=l(W.question_value):c[se]=W[se]}catch(I){}},g=xe([]),y=xe(null),b=tn(()=>g.value.filter(I=>c.library_ids.includes(I.id))),x=I=>{let W=c.library_ids.indexOf(I.id);c.library_ids.splice(W,1)},w=I=>{R(),c.library_ids=[...I]},_=()=>{y.value.open([...c.library_ids])},C=xe(null),k=()=>{C.value.open(Vi(c))},D=I=>{c.rerank_status=I.rerank_status,c.rerank_use_model=I.rerank_use_model,c.rerank_model_config_id=I.rerank_model_config_id,c.top_k=I.top_k,c.similarity=I.similarity,c.search_type=I.search_type},R=async()=>{const I=await Fh({type:""});I&&(g.value=I.data||[])};Qt(()=>c,()=>{f()},{deep:!0});const $=I=>{I||o()},P=()=>{t("close")};return qt(()=>{v(),R()}),(I,W)=>{const se=Bn,q=Xi,ee=vs,T=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:P},null,8,["title","iconName"])]),default:U(()=>[E("div",AN,[E("div",TN,[j(T,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:U(()=>[E("div",DN,[W[4]||(W[4]=E("div",{class:"gray-block-title"},"输入",-1)),j(q,{label:"关联知识库"},{default:U(()=>[(Y(!0),ae(dt,null,yt(b.value,z=>(Y(),ae("div",{class:"konwledge-list-item",key:z.id},[E("div",LN,[E("img",{src:z.avatar,alt:""},null,8,PN)]),E("div",RN,[E("div",IN,Te(z.library_name),1),E("div",BN,Te(z.library_intro),1)]),E("div",{class:"btn-hover-wrap",onClick:B=>x(z)},[j($e(fr))],8,jN)]))),128)),E("div",HN,[E("div",null,[j(se,{onClick:_,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>W[1]||(W[1]=[Be("添加知识库")])),_:1,__:[1]},8,["icon"])]),E("div",null,[j(se,{onClick:k,icon:wn($e(GC)),block:"",type:"dashed"},{default:U(()=>W[2]||(W[2]=[Be("召回设置")])),_:1,__:[2]},8,["icon"])])])]),_:1}),E("div",$N,[W[3]||(W[3]=E("div",{class:"form-label"},"用户问题",-1)),E("div",FN,[E("div",zN,[j(ee,{value:c.question_value,"onUpdate:value":W[0]||(W[0]=z=>c.question_value=z),onDropdownVisibleChange:$,style:{width:"220px"},options:i.value,allowClear:!1,displayRender:({labels:z})=>z.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),W[5]||(W[5]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"知识库引用"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[5]},8,["model"]),j(nN,{ref_key:"librarySelectAlertRef",ref:y,onClose:R,onChange:w},null,512),j(NN,{ref_key:"recallSettingsAlertRef",ref:C,onChange:D},null,512)])])]),_:1})}}},UN=bt(WN,[["__scopeId","data-v-d4ff0972"]]),qa="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",VN={class:"sub-field-item"},XN=["onClick"],GN=["onClick"],YN={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(d=>d.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px"),i=(d,c)=>{c[d].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(d,c)=>{c.splice(d,1)},s=d=>{d.subs=[]},l=d=>d.typ=="object"&&e.level<=2;return(d,c)=>{const f=Cr,v=jr,g=Br,y=Mn("SubsKey",!0);return Y(!0),ae(dt,null,yt(e.data,(b,x)=>(Y(),ae("div",{class:Sn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:b.cu_key},[E("div",VN,[c[0]||(c[0]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(f,{class:"mr12",style:Ci({width:n.value}),value:b.key,"onUpdate:value":w=>b.key=w,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),c[1]||(c[1]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(g,{class:"mr12",onChange:w=>s(b),value:b.typ,"onUpdate:value":w=>b.typ=w,placeholder:"请选择",style:Ci({width:n.value})},{default:U(()=>[(Y(!0),ae(dt,null,yt(t.value,w=>(Y(),ze(v,{value:w.value},{default:U(()=>[Be(Te(w.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(b)?(Y(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:w=>i(x,e.data)},[j($e(ms))],8,XN)):et("",!0),E("div",{class:"btn-hover-wrap",onClick:w=>o(x,e.data)},[j($e(fr))],8,GN)]),b.subs&&b.subs.length>0?(Y(),ze(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:b.subs},null,8,["level","typOptions","data"])):et("",!0)],2))),128)}}},KN=bt(YN,[["__scopeId","data-v-9125a152"]]);var xg={exports:{}},Qu={exports:{}},qN=Qu.exports,wg;function No(){return wg||(wg=1,function(r,e){(function(t,n){r.exports=n()})(qN,function(){var t=navigator.userAgent,n=navigator.platform,i=/gecko\/\d/i.test(t),o=/MSIE \d/.test(t),s=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),l=/Edge\/(\d+)/.exec(t),d=o||s||l,c=d&&(o?document.documentMode||6:+(l||s)[1]),f=!l&&/WebKit\//.test(t),v=f&&/Qt\/\d+\.\d+/.test(t),g=!l&&/Chrome\/(\d+)/.exec(t),y=g&&+g[1],b=/Opera\//.test(t),x=/Apple Computer/.test(navigator.vendor),w=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),_=/PhantomJS/.test(t),C=x&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),k=/Android/.test(t),D=C||k||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),R=C||/Mac/.test(n),$=/\bCrOS\b/.test(t),P=/win/i.test(n),I=b&&t.match(/Version\/(\d*\.\d*)/);I&&(I=Number(I[1])),I&&I>=15&&(b=!1,f=!0);var W=R&&(v||b&&(I==null||I<12.11)),se=i||d&&c>=9;function q(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}var ee=function(a,u){var p=a.className,h=q(u).exec(p);if(h){var m=p.slice(h.index+h[0].length);a.className=p.slice(0,h.index)+(m?h[1]+m:"")}};function T(a){for(var u=a.childNodes.length;u>0;--u)a.removeChild(a.firstChild);return a}function z(a,u){return T(a).appendChild(u)}function B(a,u,p,h){var m=document.createElement(a);if(p&&(m.className=p),h&&(m.style.cssText=h),typeof u=="string")m.appendChild(document.createTextNode(u));else if(u)for(var S=0;S<u.length;++S)m.appendChild(u[S]);return m}function pe(a,u,p,h){var m=B(a,u,p,h);return m.setAttribute("role","presentation"),m}var Ee;document.createRange?Ee=function(a,u,p,h){var m=document.createRange();return m.setEnd(h||a,p),m.setStart(a,u),m}:Ee=function(a,u,p){var h=document.body.createTextRange();try{h.moveToElementText(a.parentNode)}catch{return h}return h.collapse(!0),h.moveEnd("character",p),h.moveStart("character",u),h};function ye(a,u){if(u.nodeType==3&&(u=u.parentNode),a.contains)return a.contains(u);do if(u.nodeType==11&&(u=u.host),u==a)return!0;while(u=u.parentNode)}function it(a){var u=a.ownerDocument||a,p;try{p=a.activeElement}catch{p=u.body||null}for(;p&&p.shadowRoot&&p.shadowRoot.activeElement;)p=p.shadowRoot.activeElement;return p}function Oe(a,u){var p=a.className;q(u).test(p)||(a.className+=(p?" ":"")+u)}function he(a,u){for(var p=a.split(" "),h=0;h<p.length;h++)p[h]&&!q(p[h]).test(u)&&(u+=" "+p[h]);return u}var We=function(a){a.select()};C?We=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:d&&(We=function(a){try{a.select()}catch{}});function Re(a){return a.display.wrapper.ownerDocument}function Ge(a){return le(a.display.wrapper)}function le(a){return a.getRootNode?a.getRootNode():a.ownerDocument}function G(a){return Re(a).defaultView}function oe(a){var u=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,u)}}function de(a,u,p){u||(u={});for(var h in a)a.hasOwnProperty(h)&&(p!==!1||!u.hasOwnProperty(h))&&(u[h]=a[h]);return u}function ke(a,u,p,h,m){u==null&&(u=a.search(/[^\s\u00a0]/),u==-1&&(u=a.length));for(var S=h||0,O=m||0;;){var A=a.indexOf("	",S);if(A<0||A>=u)return O+(u-S);O+=A-S,O+=p-O%p,S=A+1}}var Ye=function(){this.id=null,this.f=null,this.time=0,this.handler=oe(this.onTimeout,this)};Ye.prototype.onTimeout=function(a){a.id=0,a.time<=+new Date?a.f():setTimeout(a.handler,a.time-+new Date)},Ye.prototype.set=function(a,u){this.f=u;var p=+new Date+a;(!this.id||p<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,a),this.time=p)};function Ie(a,u){for(var p=0;p<a.length;++p)if(a[p]==u)return p;return-1}var Fe=50,Ot={toString:function(){return"CodeMirror.Pass"}},lt={scroll:!1},It={origin:"*mouse"},_t={origin:"+move"};function Yt(a,u,p){for(var h=0,m=0;;){var S=a.indexOf("	",h);S==-1&&(S=a.length);var O=S-h;if(S==a.length||m+O>=u)return h+Math.min(O,u-m);if(m+=S-h,m+=p-m%p,h=S+1,m>=u)return h}}var Kt=[""];function Q(a){for(;Kt.length<=a;)Kt.push(M(Kt)+" ");return Kt[a]}function M(a){return a[a.length-1]}function H(a,u){for(var p=[],h=0;h<a.length;h++)p[h]=u(a[h],h);return p}function Z(a,u,p){for(var h=0,m=p(u);h<a.length&&p(a[h])<=m;)h++;a.splice(h,0,u)}function X(){}function re(a,u){var p;return Object.create?p=Object.create(a):(X.prototype=a,p=new X),u&&de(u,p),p}var ne=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ue(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||ne.test(a))}function we(a,u){return u?u.source.indexOf("\\w")>-1&&ue(a)?!0:u.test(a):ue(a)}function Se(a){for(var u in a)if(a.hasOwnProperty(u)&&a[u])return!1;return!0}var Pe=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Je(a){return a.charCodeAt(0)>=768&&Pe.test(a)}function ct(a,u,p){for(;(p<0?u>0:u<a.length)&&Je(a.charAt(u));)u+=p;return u}function ht(a,u,p){for(var h=u>p?-1:1;;){if(u==p)return u;var m=(u+p)/2,S=h<0?Math.ceil(m):Math.floor(m);if(S==u)return a(S)?u:p;a(S)?p=S:u=S+h}}function Pt(a,u,p,h){if(!a)return h(u,p,"ltr",0);for(var m=!1,S=0;S<a.length;++S){var O=a[S];(O.from<p&&O.to>u||u==p&&O.to==u)&&(h(Math.max(O.from,u),Math.min(O.to,p),O.level==1?"rtl":"ltr",S),m=!0)}m||h(u,p,"ltr")}var qe=null;function ut(a,u,p){var h;qe=null;for(var m=0;m<a.length;++m){var S=a[m];if(S.from<u&&S.to>u)return m;S.to==u&&(S.from!=S.to&&p=="before"?h=m:qe=m),S.from==u&&(S.from!=S.to&&p!="before"?h=m:qe=m)}return h??qe}var Rt=function(){var a="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",u="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function p(F){return F<=247?a.charAt(F):1424<=F&&F<=1524?"R":1536<=F&&F<=1785?u.charAt(F-1536):1774<=F&&F<=2220?"r":8192<=F&&F<=8203?"w":F==8204?"b":"L"}var h=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,m=/[stwN]/,S=/[LRr]/,O=/[Lb1n]/,A=/[1n]/;function L(F,te,ie){this.level=F,this.from=te,this.to=ie}return function(F,te){var ie=te=="ltr"?"L":"R";if(F.length==0||te=="ltr"&&!h.test(F))return!1;for(var ge=F.length,fe=[],Le=0;Le<ge;++Le)fe.push(p(F.charCodeAt(Le)));for(var He=0,Qe=ie;He<ge;++He){var at=fe[He];at=="m"?fe[He]=Qe:Qe=at}for(var ft=0,st=ie;ft<ge;++ft){var gt=fe[ft];gt=="1"&&st=="r"?fe[ft]="n":S.test(gt)&&(st=gt,gt=="r"&&(fe[ft]="R"))}for(var At=1,Mt=fe[0];At<ge-1;++At){var zt=fe[At];zt=="+"&&Mt=="1"&&fe[At+1]=="1"?fe[At]="1":zt==","&&Mt==fe[At+1]&&(Mt=="1"||Mt=="n")&&(fe[At]=Mt),Mt=zt}for(var hn=0;hn<ge;++hn){var Xn=fe[hn];if(Xn==",")fe[hn]="N";else if(Xn=="%"){var bn=void 0;for(bn=hn+1;bn<ge&&fe[bn]=="%";++bn);for(var Pr=hn&&fe[hn-1]=="!"||bn<ge&&fe[bn]=="1"?"1":"N",yr=hn;yr<bn;++yr)fe[yr]=Pr;hn=bn-1}}for(var Nn=0,_r=ie;Nn<ge;++Nn){var qn=fe[Nn];_r=="L"&&qn=="1"?fe[Nn]="L":S.test(qn)&&(_r=qn)}for(var Ln=0;Ln<ge;++Ln)if(m.test(fe[Ln])){var An=void 0;for(An=Ln+1;An<ge&&m.test(fe[An]);++An);for(var En=(Ln?fe[Ln-1]:ie)=="L",br=(An<ge?fe[An]:ie)=="L",Aa=En==br?En?"L":"R":ie,go=Ln;go<An;++go)fe[go]=Aa;Ln=An-1}for(var er=[],Pi,Gn=0;Gn<ge;)if(O.test(fe[Gn])){var ff=Gn;for(++Gn;Gn<ge&&O.test(fe[Gn]);++Gn);er.push(new L(0,ff,Gn))}else{var Qi=Gn,zo=er.length,Wo=te=="rtl"?1:0;for(++Gn;Gn<ge&&fe[Gn]!="L";++Gn);for(var lr=Qi;lr<Gn;)if(A.test(fe[lr])){Qi<lr&&(er.splice(zo,0,new L(1,Qi,lr)),zo+=Wo);var Ta=lr;for(++lr;lr<Gn&&A.test(fe[lr]);++lr);er.splice(zo,0,new L(2,Ta,lr)),zo+=Wo,Qi=lr}else++lr;Qi<Gn&&er.splice(zo,0,new L(1,Qi,Gn))}return te=="ltr"&&(er[0].level==1&&(Pi=F.match(/^\s+/))&&(er[0].from=Pi[0].length,er.unshift(new L(0,0,Pi[0].length))),M(er).level==1&&(Pi=F.match(/\s+$/))&&(M(er).to-=Pi[0].length,er.push(new L(0,ge-Pi[0].length,ge)))),te=="rtl"?er.reverse():er}}();function ot(a,u){var p=a.order;return p==null&&(p=a.order=Rt(a.text,u)),p}var je=[],De=function(a,u,p){if(a.addEventListener)a.addEventListener(u,p,!1);else if(a.attachEvent)a.attachEvent("on"+u,p);else{var h=a._handlers||(a._handlers={});h[u]=(h[u]||je).concat(p)}};function pt(a,u){return a._handlers&&a._handlers[u]||je}function Ke(a,u,p){if(a.removeEventListener)a.removeEventListener(u,p,!1);else if(a.detachEvent)a.detachEvent("on"+u,p);else{var h=a._handlers,m=h&&h[u];if(m){var S=Ie(m,p);S>-1&&(h[u]=m.slice(0,S).concat(m.slice(S+1)))}}}function Ze(a,u){var p=pt(a,u);if(p.length)for(var h=Array.prototype.slice.call(arguments,2),m=0;m<p.length;++m)p[m].apply(null,h)}function tt(a,u,p){return typeof u=="string"&&(u={type:u,preventDefault:function(){this.defaultPrevented=!0}}),Ze(a,p||u.type,a,u),Ut(u)||u.codemirrorIgnore}function wt(a){var u=a._handlers&&a._handlers.cursorActivity;if(u)for(var p=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),h=0;h<u.length;++h)Ie(p,u[h])==-1&&p.push(u[h])}function _e(a,u){return pt(a,u).length>0}function Ue(a){a.prototype.on=function(u,p){De(this,u,p)},a.prototype.off=function(u,p){Ke(this,u,p)}}function vt(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function St(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function Ut(a){return a.defaultPrevented!=null?a.defaultPrevented:a.returnValue==!1}function Xt(a){vt(a),St(a)}function Zn(a){return a.target||a.srcElement}function gn(a){var u=a.which;return u==null&&(a.button&1?u=1:a.button&2?u=3:a.button&4&&(u=2)),R&&a.ctrlKey&&u==1&&(u=3),u}var Fn=function(){if(d&&c<9)return!1;var a=B("div");return"draggable"in a||"dragDrop"in a}(),Yr;function Kr(a){if(Yr==null){var u=B("span","​");z(a,B("span",[u,document.createTextNode("x")])),a.firstChild.offsetHeight!=0&&(Yr=u.offsetWidth<=1&&u.offsetHeight>2&&!(d&&c<8))}var p=Yr?B("span","​"):B("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return p.setAttribute("cm-text",""),p}var Zt;function Mr(a){if(Zt!=null)return Zt;var u=z(a,document.createTextNode("AخA")),p=Ee(u,0,1).getBoundingClientRect(),h=Ee(u,1,2).getBoundingClientRect();return T(a),!p||p.left==p.right?!1:Zt=h.right-p.right<3}var Cn=`

b`.split(/\n/).length!=3?function(a){for(var u=0,p=[],h=a.length;u<=h;){var m=a.indexOf(`
`,u);m==-1&&(m=a.length);var S=a.slice(u,a.charAt(m-1)=="\r"?m-1:m),O=S.indexOf("\r");O!=-1?(p.push(S.slice(0,O)),u+=O+1):(p.push(S),u=m+1)}return p}:function(a){return a.split(/\r\n?|\n/)},Nr=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch{return!1}}:function(a){var u;try{u=a.ownerDocument.selection.createRange()}catch{}return!u||u.parentElement()!=a?!1:u.compareEndPoints("StartToEnd",u)!=0},si=function(){var a=B("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),typeof a.oncopy=="function")}(),Tt=null;function Ti(a){if(Tt!=null)return Tt;var u=z(a,B("span","x")),p=u.getBoundingClientRect(),h=Ee(u,0,1).getBoundingClientRect();return Tt=Math.abs(p.left-h.left)>1}var Fr={},zn={};function or(a,u){arguments.length>2&&(u.dependencies=Array.prototype.slice.call(arguments,2)),Fr[a]=u}function ar(a,u){zn[a]=u}function Ar(a){if(typeof a=="string"&&zn.hasOwnProperty(a))a=zn[a];else if(a&&typeof a.name=="string"&&zn.hasOwnProperty(a.name)){var u=zn[a.name];typeof u=="string"&&(u={name:u}),a=re(u,a),a.name=u.name}else{if(typeof a=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return Ar("application/xml");if(typeof a=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(a))return Ar("application/json")}return typeof a=="string"?{name:a}:a||{name:"null"}}function qr(a,u){u=Ar(u);var p=Fr[u.name];if(!p)return qr(a,"text/plain");var h=p(a,u);if(Tr.hasOwnProperty(u.name)){var m=Tr[u.name];for(var S in m)m.hasOwnProperty(S)&&(h.hasOwnProperty(S)&&(h["_"+S]=h[S]),h[S]=m[S])}if(h.name=u.name,u.helperType&&(h.helperType=u.helperType),u.modeProps)for(var O in u.modeProps)h[O]=u.modeProps[O];return h}var Tr={};function zr(a,u){var p=Tr.hasOwnProperty(a)?Tr[a]:Tr[a]={};de(u,p)}function K(a,u){if(u===!0)return u;if(a.copyState)return a.copyState(u);var p={};for(var h in u){var m=u[h];m instanceof Array&&(m=m.concat([])),p[h]=m}return p}function me(a,u){for(var p;a.innerMode&&(p=a.innerMode(u),!(!p||p.mode==a));)u=p.state,a=p.mode;return p||{mode:a,state:u}}function Ve(a,u,p){return a.startState?a.startState(u,p):!0}var rt=function(a,u,p){this.pos=this.start=0,this.string=a,this.tabSize=u||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=p};rt.prototype.eol=function(){return this.pos>=this.string.length},rt.prototype.sol=function(){return this.pos==this.lineStart},rt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},rt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},rt.prototype.eat=function(a){var u=this.string.charAt(this.pos),p;if(typeof a=="string"?p=u==a:p=u&&(a.test?a.test(u):a(u)),p)return++this.pos,u},rt.prototype.eatWhile=function(a){for(var u=this.pos;this.eat(a););return this.pos>u},rt.prototype.eatSpace=function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},rt.prototype.skipToEnd=function(){this.pos=this.string.length},rt.prototype.skipTo=function(a){var u=this.string.indexOf(a,this.pos);if(u>-1)return this.pos=u,!0},rt.prototype.backUp=function(a){this.pos-=a},rt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ke(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ke(this.string,this.lineStart,this.tabSize):0)},rt.prototype.indentation=function(){return ke(this.string,null,this.tabSize)-(this.lineStart?ke(this.string,this.lineStart,this.tabSize):0)},rt.prototype.match=function(a,u,p){if(typeof a=="string"){var h=function(O){return p?O.toLowerCase():O},m=this.string.substr(this.pos,a.length);if(h(m)==h(a))return u!==!1&&(this.pos+=a.length),!0}else{var S=this.string.slice(this.pos).match(a);return S&&S.index>0?null:(S&&u!==!1&&(this.pos+=S[0].length),S)}},rt.prototype.current=function(){return this.string.slice(this.start,this.pos)},rt.prototype.hideFirstChars=function(a,u){this.lineStart+=a;try{return u()}finally{this.lineStart-=a}},rt.prototype.lookAhead=function(a){var u=this.lineOracle;return u&&u.lookAhead(a)},rt.prototype.baseToken=function(){var a=this.lineOracle;return a&&a.baseToken(this.pos)};function Xe(a,u){if(u-=a.first,u<0||u>=a.size)throw new Error("There is no line "+(u+a.first)+" in the document.");for(var p=a;!p.lines;)for(var h=0;;++h){var m=p.children[h],S=m.chunkSize();if(u<S){p=m;break}u-=S}return p.lines[u]}function Ft(a,u,p){var h=[],m=u.line;return a.iter(u.line,p.line+1,function(S){var O=S.text;m==p.line&&(O=O.slice(0,p.ch)),m==u.line&&(O=O.slice(u.ch)),h.push(O),++m}),h}function pn(a,u,p){var h=[];return a.iter(u,p,function(m){h.push(m.text)}),h}function J(a,u){var p=u-a.height;if(p)for(var h=a;h;h=h.parent)h.height+=p}function N(a){if(a.parent==null)return null;for(var u=a.parent,p=Ie(u.lines,a),h=u.parent;h;u=h,h=h.parent)for(var m=0;h.children[m]!=u;++m)p+=h.children[m].chunkSize();return p+u.first}function V(a,u){var p=a.first;e:do{for(var h=0;h<a.children.length;++h){var m=a.children[h],S=m.height;if(u<S){a=m;continue e}u-=S,p+=m.chunkSize()}return p}while(!a.lines);for(var O=0;O<a.lines.length;++O){var A=a.lines[O],L=A.height;if(u<L)break;u-=L}return p+O}function ce(a,u){return u>=a.first&&u<a.first+a.size}function Ce(a,u){return String(a.lineNumberFormatter(u+a.firstLineNumber))}function ve(a,u,p){if(p===void 0&&(p=null),!(this instanceof ve))return new ve(a,u,p);this.line=a,this.ch=u,this.sticky=p}function be(a,u){return a.line-u.line||a.ch-u.ch}function nt(a,u){return a.sticky==u.sticky&&be(a,u)==0}function mt(a){return ve(a.line,a.ch)}function Lt(a,u){return be(a,u)<0?u:a}function On(a,u){return be(a,u)<0?a:u}function Os(a,u){return Math.max(a.first,Math.min(u,a.first+a.size-1))}function Bt(a,u){if(u.line<a.first)return ve(a.first,0);var p=a.first+a.size-1;return u.line>p?ve(p,Xe(a,p).text.length):Dr(u,Xe(a,u.line).text.length)}function Dr(a,u){var p=a.ch;return p==null||p>u?ve(a.line,u):p<0?ve(a.line,0):a}function fa(a,u){for(var p=[],h=0;h<u.length;h++)p[h]=Bt(a,u[h]);return p}var oo=function(a,u){this.state=a,this.lookAhead=u},mn=function(a,u,p,h){this.state=u,this.doc=a,this.line=p,this.maxLookAhead=h||0,this.baseTokens=null,this.baseTokenPos=1};mn.prototype.lookAhead=function(a){var u=this.doc.getLine(this.line+a);return u!=null&&a>this.maxLookAhead&&(this.maxLookAhead=a),u},mn.prototype.baseToken=function(a){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=a;)this.baseTokenPos+=2;var u=this.baseTokens[this.baseTokenPos+1];return{type:u&&u.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-a}},mn.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},mn.fromSaved=function(a,u,p){return u instanceof oo?new mn(a,K(a.mode,u.state),p,u.lookAhead):new mn(a,K(a.mode,u),p)},mn.prototype.save=function(a){var u=a!==!1?K(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new oo(u,this.maxLookAhead):u};function Wr(a,u,p,h){var m=[a.state.modeGen],S={};kp(a,u.text,a.doc.mode,p,function(F,te){return m.push(F,te)},S,h);for(var O=p.state,A=function(F){p.baseTokens=m;var te=a.state.overlays[F],ie=1,ge=0;p.state=!0,kp(a,u.text,te.mode,p,function(fe,Le){for(var He=ie;ge<fe;){var Qe=m[ie];Qe>fe&&m.splice(ie,1,fe,m[ie+1],Qe),ie+=2,ge=Math.min(fe,Qe)}if(Le)if(te.opaque)m.splice(He,ie-He,fe,"overlay "+Le),ie=He+2;else for(;He<ie;He+=2){var at=m[He+1];m[He+1]=(at?at+" ":"")+"overlay "+Le}},S),p.state=O,p.baseTokens=null,p.baseTokenPos=1},L=0;L<a.state.overlays.length;++L)A(L);return{styles:m,classes:S.bgClass||S.textClass?S:null}}function Zl(a,u,p){if(!u.styles||u.styles[0]!=a.state.modeGen){var h=ao(a,N(u)),m=u.text.length>a.options.maxHighlightLength&&K(a.doc.mode,h.state),S=Wr(a,u,h);m&&(h.state=m),u.stateAfter=h.save(!m),u.styles=S.styles,S.classes?u.styleClasses=S.classes:u.styleClasses&&(u.styleClasses=null),p===a.doc.highlightFrontier&&(a.doc.modeFrontier=Math.max(a.doc.modeFrontier,++a.doc.highlightFrontier))}return u.styles}function ao(a,u,p){var h=a.doc,m=a.display;if(!h.mode.startState)return new mn(h,!0,u);var S=bS(a,u,p),O=S>h.first&&Xe(h,S-1).stateAfter,A=O?mn.fromSaved(h,O,S):new mn(h,Ve(h.mode),S);return h.iter(S,u,function(L){bc(a,L.text,A);var F=A.line;L.stateAfter=F==u-1||F%5==0||F>=m.viewFrom&&F<m.viewTo?A.save():null,A.nextLine()}),p&&(h.modeFrontier=A.line),A}function bc(a,u,p,h){var m=a.doc.mode,S=new rt(u,a.options.tabSize,p);for(S.start=S.pos=h||0,u==""&&Sp(m,p.state);!S.eol();)xc(m,S,p.state),S.start=S.pos}function Sp(a,u){if(a.blankLine)return a.blankLine(u);if(a.innerMode){var p=me(a,u);if(p.mode.blankLine)return p.mode.blankLine(p.state)}}function xc(a,u,p,h){for(var m=0;m<10;m++){h&&(h[0]=me(a,p).mode);var S=a.token(u,p);if(u.pos>u.start)return S}throw new Error("Mode "+a.name+" failed to advance stream.")}var Ep=function(a,u,p){this.start=a.start,this.end=a.pos,this.string=a.current(),this.type=u||null,this.state=p};function Cp(a,u,p,h){var m=a.doc,S=m.mode,O;u=Bt(m,u);var A=Xe(m,u.line),L=ao(a,u.line,p),F=new rt(A.text,a.options.tabSize,L),te;for(h&&(te=[]);(h||F.pos<u.ch)&&!F.eol();)F.start=F.pos,O=xc(S,F,L.state),h&&te.push(new Ep(F,O,K(m.mode,L.state)));return h?te:new Ep(F,O,L.state)}function Op(a,u){if(a)for(;;){var p=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!p)break;a=a.slice(0,p.index)+a.slice(p.index+p[0].length);var h=p[1]?"bgClass":"textClass";u[h]==null?u[h]=p[2]:new RegExp("(?:^|\\s)"+p[2]+"(?:$|\\s)").test(u[h])||(u[h]+=" "+p[2])}return a}function kp(a,u,p,h,m,S,O){var A=p.flattenSpans;A==null&&(A=a.options.flattenSpans);var L=0,F=null,te=new rt(u,a.options.tabSize,h),ie,ge=a.options.addModeClass&&[null];for(u==""&&Op(Sp(p,h.state),S);!te.eol();){if(te.pos>a.options.maxHighlightLength?(A=!1,O&&bc(a,u,h,te.pos),te.pos=u.length,ie=null):ie=Op(xc(p,te,h.state,ge),S),ge){var fe=ge[0].name;fe&&(ie="m-"+(ie?fe+" "+ie:fe))}if(!A||F!=ie){for(;L<te.start;)L=Math.min(te.start,L+5e3),m(L,F);F=ie}te.start=te.pos}for(;L<te.pos;){var Le=Math.min(te.pos,L+5e3);m(Le,F),L=Le}}function bS(a,u,p){for(var h,m,S=a.doc,O=p?-1:u-(a.doc.mode.innerMode?1e3:100),A=u;A>O;--A){if(A<=S.first)return S.first;var L=Xe(S,A-1),F=L.stateAfter;if(F&&(!p||A+(F instanceof oo?F.lookAhead:0)<=S.modeFrontier))return A;var te=ke(L.text,null,a.options.tabSize);(m==null||h>te)&&(m=A-1,h=te)}return m}function xS(a,u){if(a.modeFrontier=Math.min(a.modeFrontier,u),!(a.highlightFrontier<u-10)){for(var p=a.first,h=u-1;h>p;h--){var m=Xe(a,h).stateAfter;if(m&&(!(m instanceof oo)||h+m.lookAhead<u)){p=h+1;break}}a.highlightFrontier=Math.min(a.highlightFrontier,p)}}var Mp=!1,Yi=!1;function wS(){Mp=!0}function SS(){Yi=!0}function Ql(a,u,p){this.marker=a,this.from=u,this.to=p}function ks(a,u){if(a)for(var p=0;p<a.length;++p){var h=a[p];if(h.marker==u)return h}}function ES(a,u){for(var p,h=0;h<a.length;++h)a[h]!=u&&(p||(p=[])).push(a[h]);return p}function CS(a,u,p){var h=p&&window.WeakSet&&(p.markedSpans||(p.markedSpans=new WeakSet));h&&a.markedSpans&&h.has(a.markedSpans)?a.markedSpans.push(u):(a.markedSpans=a.markedSpans?a.markedSpans.concat([u]):[u],h&&h.add(a.markedSpans)),u.marker.attachLine(a)}function OS(a,u,p){var h;if(a)for(var m=0;m<a.length;++m){var S=a[m],O=S.marker,A=S.from==null||(O.inclusiveLeft?S.from<=u:S.from<u);if(A||S.from==u&&O.type=="bookmark"&&(!p||!S.marker.insertLeft)){var L=S.to==null||(O.inclusiveRight?S.to>=u:S.to>u);(h||(h=[])).push(new Ql(O,S.from,L?null:S.to))}}return h}function kS(a,u,p){var h;if(a)for(var m=0;m<a.length;++m){var S=a[m],O=S.marker,A=S.to==null||(O.inclusiveRight?S.to>=u:S.to>u);if(A||S.from==u&&O.type=="bookmark"&&(!p||S.marker.insertLeft)){var L=S.from==null||(O.inclusiveLeft?S.from<=u:S.from<u);(h||(h=[])).push(new Ql(O,L?null:S.from-u,S.to==null?null:S.to-u))}}return h}function wc(a,u){if(u.full)return null;var p=ce(a,u.from.line)&&Xe(a,u.from.line).markedSpans,h=ce(a,u.to.line)&&Xe(a,u.to.line).markedSpans;if(!p&&!h)return null;var m=u.from.ch,S=u.to.ch,O=be(u.from,u.to)==0,A=OS(p,m,O),L=kS(h,S,O),F=u.text.length==1,te=M(u.text).length+(F?m:0);if(A)for(var ie=0;ie<A.length;++ie){var ge=A[ie];if(ge.to==null){var fe=ks(L,ge.marker);fe?F&&(ge.to=fe.to==null?null:fe.to+te):ge.to=m}}if(L)for(var Le=0;Le<L.length;++Le){var He=L[Le];if(He.to!=null&&(He.to+=te),He.from==null){var Qe=ks(A,He.marker);Qe||(He.from=te,F&&(A||(A=[])).push(He))}else He.from+=te,F&&(A||(A=[])).push(He)}A&&(A=Np(A)),L&&L!=A&&(L=Np(L));var at=[A];if(!F){var ft=u.text.length-2,st;if(ft>0&&A)for(var gt=0;gt<A.length;++gt)A[gt].to==null&&(st||(st=[])).push(new Ql(A[gt].marker,null,null));for(var At=0;At<ft;++At)at.push(st);at.push(L)}return at}function Np(a){for(var u=0;u<a.length;++u){var p=a[u];p.from!=null&&p.from==p.to&&p.marker.clearWhenEmpty!==!1&&a.splice(u--,1)}return a.length?a:null}function MS(a,u,p){var h=null;if(a.iter(u.line,p.line+1,function(fe){if(fe.markedSpans)for(var Le=0;Le<fe.markedSpans.length;++Le){var He=fe.markedSpans[Le].marker;He.readOnly&&(!h||Ie(h,He)==-1)&&(h||(h=[])).push(He)}}),!h)return null;for(var m=[{from:u,to:p}],S=0;S<h.length;++S)for(var O=h[S],A=O.find(0),L=0;L<m.length;++L){var F=m[L];if(!(be(F.to,A.from)<0||be(F.from,A.to)>0)){var te=[L,1],ie=be(F.from,A.from),ge=be(F.to,A.to);(ie<0||!O.inclusiveLeft&&!ie)&&te.push({from:F.from,to:A.from}),(ge>0||!O.inclusiveRight&&!ge)&&te.push({from:A.to,to:F.to}),m.splice.apply(m,te),L+=te.length-3}}return m}function Ap(a){var u=a.markedSpans;if(u){for(var p=0;p<u.length;++p)u[p].marker.detachLine(a);a.markedSpans=null}}function Tp(a,u){if(u){for(var p=0;p<u.length;++p)u[p].marker.attachLine(a);a.markedSpans=u}}function eu(a){return a.inclusiveLeft?-1:0}function tu(a){return a.inclusiveRight?1:0}function Sc(a,u){var p=a.lines.length-u.lines.length;if(p!=0)return p;var h=a.find(),m=u.find(),S=be(h.from,m.from)||eu(a)-eu(u);if(S)return-S;var O=be(h.to,m.to)||tu(a)-tu(u);return O||u.id-a.id}function Dp(a,u){var p=Yi&&a.markedSpans,h;if(p)for(var m=void 0,S=0;S<p.length;++S)m=p[S],m.marker.collapsed&&(u?m.from:m.to)==null&&(!h||Sc(h,m.marker)<0)&&(h=m.marker);return h}function Lp(a){return Dp(a,!0)}function nu(a){return Dp(a,!1)}function NS(a,u){var p=Yi&&a.markedSpans,h;if(p)for(var m=0;m<p.length;++m){var S=p[m];S.marker.collapsed&&(S.from==null||S.from<u)&&(S.to==null||S.to>u)&&(!h||Sc(h,S.marker)<0)&&(h=S.marker)}return h}function Pp(a,u,p,h,m){var S=Xe(a,u),O=Yi&&S.markedSpans;if(O)for(var A=0;A<O.length;++A){var L=O[A];if(L.marker.collapsed){var F=L.marker.find(0),te=be(F.from,p)||eu(L.marker)-eu(m),ie=be(F.to,h)||tu(L.marker)-tu(m);if(!(te>=0&&ie<=0||te<=0&&ie>=0)&&(te<=0&&(L.marker.inclusiveRight&&m.inclusiveLeft?be(F.to,p)>=0:be(F.to,p)>0)||te>=0&&(L.marker.inclusiveRight&&m.inclusiveLeft?be(F.from,h)<=0:be(F.from,h)<0)))return!0}}}function li(a){for(var u;u=Lp(a);)a=u.find(-1,!0).line;return a}function AS(a){for(var u;u=nu(a);)a=u.find(1,!0).line;return a}function TS(a){for(var u,p;u=nu(a);)a=u.find(1,!0).line,(p||(p=[])).push(a);return p}function Ec(a,u){var p=Xe(a,u),h=li(p);return p==h?u:N(h)}function Rp(a,u){if(u>a.lastLine())return u;var p=Xe(a,u),h;if(!so(a,p))return u;for(;h=nu(p);)p=h.find(1,!0).line;return N(p)+1}function so(a,u){var p=Yi&&u.markedSpans;if(p){for(var h=void 0,m=0;m<p.length;++m)if(h=p[m],!!h.marker.collapsed){if(h.from==null)return!0;if(!h.marker.widgetNode&&h.from==0&&h.marker.inclusiveLeft&&Cc(a,u,h))return!0}}}function Cc(a,u,p){if(p.to==null){var h=p.marker.find(1,!0);return Cc(a,h.line,ks(h.line.markedSpans,p.marker))}if(p.marker.inclusiveRight&&p.to==u.text.length)return!0;for(var m=void 0,S=0;S<u.markedSpans.length;++S)if(m=u.markedSpans[S],m.marker.collapsed&&!m.marker.widgetNode&&m.from==p.to&&(m.to==null||m.to!=p.from)&&(m.marker.inclusiveLeft||p.marker.inclusiveRight)&&Cc(a,u,m))return!0}function Ki(a){a=li(a);for(var u=0,p=a.parent,h=0;h<p.lines.length;++h){var m=p.lines[h];if(m==a)break;u+=m.height}for(var S=p.parent;S;p=S,S=p.parent)for(var O=0;O<S.children.length;++O){var A=S.children[O];if(A==p)break;u+=A.height}return u}function ru(a){if(a.height==0)return 0;for(var u=a.text.length,p,h=a;p=Lp(h);){var m=p.find(0,!0);h=m.from.line,u+=m.from.ch-m.to.ch}for(h=a;p=nu(h);){var S=p.find(0,!0);u-=h.text.length-S.from.ch,h=S.to.line,u+=h.text.length-S.to.ch}return u}function Oc(a){var u=a.display,p=a.doc;u.maxLine=Xe(p,p.first),u.maxLineLength=ru(u.maxLine),u.maxLineChanged=!0,p.iter(function(h){var m=ru(h);m>u.maxLineLength&&(u.maxLineLength=m,u.maxLine=h)})}var ha=function(a,u,p){this.text=a,Tp(this,u),this.height=p?p(this):1};ha.prototype.lineNo=function(){return N(this)},Ue(ha);function DS(a,u,p,h){a.text=u,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),a.order!=null&&(a.order=null),Ap(a),Tp(a,p);var m=h?h(a):1;m!=a.height&&J(a,m)}function LS(a){a.parent=null,Ap(a)}var PS={},RS={};function Ip(a,u){if(!a||/^\s*$/.test(a))return null;var p=u.addModeClass?RS:PS;return p[a]||(p[a]=a.replace(/\S+/g,"cm-$&"))}function Bp(a,u){var p=pe("span",null,null,f?"padding-right: .1px":null),h={pre:pe("pre",[p],"CodeMirror-line"),content:p,col:0,pos:0,cm:a,trailingSpace:!1,splitSpaces:a.getOption("lineWrapping")};u.measure={};for(var m=0;m<=(u.rest?u.rest.length:0);m++){var S=m?u.rest[m-1]:u.line,O=void 0;h.pos=0,h.addToken=BS,Mr(a.display.measure)&&(O=ot(S,a.doc.direction))&&(h.addToken=HS(h.addToken,O)),h.map=[];var A=u!=a.display.externalMeasured&&N(S);$S(S,h,Zl(a,S,A)),S.styleClasses&&(S.styleClasses.bgClass&&(h.bgClass=he(S.styleClasses.bgClass,h.bgClass||"")),S.styleClasses.textClass&&(h.textClass=he(S.styleClasses.textClass,h.textClass||""))),h.map.length==0&&h.map.push(0,0,h.content.appendChild(Kr(a.display.measure))),m==0?(u.measure.map=h.map,u.measure.cache={}):((u.measure.maps||(u.measure.maps=[])).push(h.map),(u.measure.caches||(u.measure.caches=[])).push({}))}if(f){var L=h.content.lastChild;(/\bcm-tab\b/.test(L.className)||L.querySelector&&L.querySelector(".cm-tab"))&&(h.content.className="cm-tab-wrap-hack")}return Ze(a,"renderLine",a,u.line,h.pre),h.pre.className&&(h.textClass=he(h.pre.className,h.textClass||"")),h}function IS(a){var u=B("span","•","cm-invalidchar");return u.title="\\u"+a.charCodeAt(0).toString(16),u.setAttribute("aria-label",u.title),u}function BS(a,u,p,h,m,S,O){if(u){var A=a.splitSpaces?jS(u,a.trailingSpace):u,L=a.cm.state.specialChars,F=!1,te;if(!L.test(u))a.col+=u.length,te=document.createTextNode(A),a.map.push(a.pos,a.pos+u.length,te),d&&c<9&&(F=!0),a.pos+=u.length;else{te=document.createDocumentFragment();for(var ie=0;;){L.lastIndex=ie;var ge=L.exec(u),fe=ge?ge.index-ie:u.length-ie;if(fe){var Le=document.createTextNode(A.slice(ie,ie+fe));d&&c<9?te.appendChild(B("span",[Le])):te.appendChild(Le),a.map.push(a.pos,a.pos+fe,Le),a.col+=fe,a.pos+=fe}if(!ge)break;ie+=fe+1;var He=void 0;if(ge[0]=="	"){var Qe=a.cm.options.tabSize,at=Qe-a.col%Qe;He=te.appendChild(B("span",Q(at),"cm-tab")),He.setAttribute("role","presentation"),He.setAttribute("cm-text","	"),a.col+=at}else ge[0]=="\r"||ge[0]==`
`?(He=te.appendChild(B("span",ge[0]=="\r"?"␍":"␤","cm-invalidchar")),He.setAttribute("cm-text",ge[0]),a.col+=1):(He=a.cm.options.specialCharPlaceholder(ge[0]),He.setAttribute("cm-text",ge[0]),d&&c<9?te.appendChild(B("span",[He])):te.appendChild(He),a.col+=1);a.map.push(a.pos,a.pos+1,He),a.pos++}}if(a.trailingSpace=A.charCodeAt(u.length-1)==32,p||h||m||F||S||O){var ft=p||"";h&&(ft+=h),m&&(ft+=m);var st=B("span",[te],ft,S);if(O)for(var gt in O)O.hasOwnProperty(gt)&&gt!="style"&&gt!="class"&&st.setAttribute(gt,O[gt]);return a.content.appendChild(st)}a.content.appendChild(te)}}function jS(a,u){if(a.length>1&&!/  /.test(a))return a;for(var p=u,h="",m=0;m<a.length;m++){var S=a.charAt(m);S==" "&&p&&(m==a.length-1||a.charCodeAt(m+1)==32)&&(S=" "),h+=S,p=S==" "}return h}function HS(a,u){return function(p,h,m,S,O,A,L){m=m?m+" cm-force-border":"cm-force-border";for(var F=p.pos,te=F+h.length;;){for(var ie=void 0,ge=0;ge<u.length&&(ie=u[ge],!(ie.to>F&&ie.from<=F));ge++);if(ie.to>=te)return a(p,h,m,S,O,A,L);a(p,h.slice(0,ie.to-F),m,S,null,A,L),S=null,h=h.slice(ie.to-F),F=ie.to}}}function jp(a,u,p,h){var m=!h&&p.widgetNode;m&&a.map.push(a.pos,a.pos+u,m),!h&&a.cm.display.input.needsContentAttribute&&(m||(m=a.content.appendChild(document.createElement("span"))),m.setAttribute("cm-marker",p.id)),m&&(a.cm.display.input.setUneditable(m),a.content.appendChild(m)),a.pos+=u,a.trailingSpace=!1}function $S(a,u,p){var h=a.markedSpans,m=a.text,S=0;if(!h){for(var O=1;O<p.length;O+=2)u.addToken(u,m.slice(S,S=p[O]),Ip(p[O+1],u.cm.options));return}for(var A=m.length,L=0,F=1,te="",ie,ge,fe=0,Le,He,Qe,at,ft;;){if(fe==L){Le=He=Qe=ge="",ft=null,at=null,fe=1/0;for(var st=[],gt=void 0,At=0;At<h.length;++At){var Mt=h[At],zt=Mt.marker;if(zt.type=="bookmark"&&Mt.from==L&&zt.widgetNode)st.push(zt);else if(Mt.from<=L&&(Mt.to==null||Mt.to>L||zt.collapsed&&Mt.to==L&&Mt.from==L)){if(Mt.to!=null&&Mt.to!=L&&fe>Mt.to&&(fe=Mt.to,He=""),zt.className&&(Le+=" "+zt.className),zt.css&&(ge=(ge?ge+";":"")+zt.css),zt.startStyle&&Mt.from==L&&(Qe+=" "+zt.startStyle),zt.endStyle&&Mt.to==fe&&(gt||(gt=[])).push(zt.endStyle,Mt.to),zt.title&&((ft||(ft={})).title=zt.title),zt.attributes)for(var hn in zt.attributes)(ft||(ft={}))[hn]=zt.attributes[hn];zt.collapsed&&(!at||Sc(at.marker,zt)<0)&&(at=Mt)}else Mt.from>L&&fe>Mt.from&&(fe=Mt.from)}if(gt)for(var Xn=0;Xn<gt.length;Xn+=2)gt[Xn+1]==fe&&(He+=" "+gt[Xn]);if(!at||at.from==L)for(var bn=0;bn<st.length;++bn)jp(u,0,st[bn]);if(at&&(at.from||0)==L){if(jp(u,(at.to==null?A+1:at.to)-L,at.marker,at.from==null),at.to==null)return;at.to==L&&(at=!1)}}if(L>=A)break;for(var Pr=Math.min(A,fe);;){if(te){var yr=L+te.length;if(!at){var Nn=yr>Pr?te.slice(0,Pr-L):te;u.addToken(u,Nn,ie?ie+Le:Le,Qe,L+Nn.length==fe?He:"",ge,ft)}if(yr>=Pr){te=te.slice(Pr-L),L=Pr;break}L=yr,Qe=""}te=m.slice(S,S=p[F++]),ie=Ip(p[F++],u.cm.options)}}}function Hp(a,u,p){this.line=u,this.rest=TS(u),this.size=this.rest?N(M(this.rest))-p+1:1,this.node=this.text=null,this.hidden=so(a,u)}function iu(a,u,p){for(var h=[],m,S=u;S<p;S=m){var O=new Hp(a.doc,Xe(a.doc,S),S);m=S+O.size,h.push(O)}return h}var pa=null;function FS(a){pa?pa.ops.push(a):a.ownsGroup=pa={ops:[a],delayedCallbacks:[]}}function zS(a){var u=a.delayedCallbacks,p=0;do{for(;p<u.length;p++)u[p].call(null);for(var h=0;h<a.ops.length;h++){var m=a.ops[h];if(m.cursorActivityHandlers)for(;m.cursorActivityCalled<m.cursorActivityHandlers.length;)m.cursorActivityHandlers[m.cursorActivityCalled++].call(null,m.cm)}}while(p<u.length)}function WS(a,u){var p=a.ownsGroup;if(p)try{zS(p)}finally{pa=null,u(p)}}var Ms=null;function Wn(a,u){var p=pt(a,u);if(p.length){var h=Array.prototype.slice.call(arguments,2),m;pa?m=pa.delayedCallbacks:Ms?m=Ms:(m=Ms=[],setTimeout(US,0));for(var S=function(A){m.push(function(){return p[A].apply(null,h)})},O=0;O<p.length;++O)S(O)}}function US(){var a=Ms;Ms=null;for(var u=0;u<a.length;++u)a[u]()}function $p(a,u,p,h){for(var m=0;m<u.changes.length;m++){var S=u.changes[m];S=="text"?XS(a,u):S=="gutter"?zp(a,u,p,h):S=="class"?kc(a,u):S=="widget"&&GS(a,u,h)}u.changes=null}function Ns(a){return a.node==a.text&&(a.node=B("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),d&&c<8&&(a.node.style.zIndex=2)),a.node}function VS(a,u){var p=u.bgClass?u.bgClass+" "+(u.line.bgClass||""):u.line.bgClass;if(p&&(p+=" CodeMirror-linebackground"),u.background)p?u.background.className=p:(u.background.parentNode.removeChild(u.background),u.background=null);else if(p){var h=Ns(u);u.background=h.insertBefore(B("div",null,p),h.firstChild),a.display.input.setUneditable(u.background)}}function Fp(a,u){var p=a.display.externalMeasured;return p&&p.line==u.line?(a.display.externalMeasured=null,u.measure=p.measure,p.built):Bp(a,u)}function XS(a,u){var p=u.text.className,h=Fp(a,u);u.text==u.node&&(u.node=h.pre),u.text.parentNode.replaceChild(h.pre,u.text),u.text=h.pre,h.bgClass!=u.bgClass||h.textClass!=u.textClass?(u.bgClass=h.bgClass,u.textClass=h.textClass,kc(a,u)):p&&(u.text.className=p)}function kc(a,u){VS(a,u),u.line.wrapClass?Ns(u).className=u.line.wrapClass:u.node!=u.text&&(u.node.className="");var p=u.textClass?u.textClass+" "+(u.line.textClass||""):u.line.textClass;u.text.className=p||""}function zp(a,u,p,h){if(u.gutter&&(u.node.removeChild(u.gutter),u.gutter=null),u.gutterBackground&&(u.node.removeChild(u.gutterBackground),u.gutterBackground=null),u.line.gutterClass){var m=Ns(u);u.gutterBackground=B("div",null,"CodeMirror-gutter-background "+u.line.gutterClass,"left: "+(a.options.fixedGutter?h.fixedPos:-h.gutterTotalWidth)+"px; width: "+h.gutterTotalWidth+"px"),a.display.input.setUneditable(u.gutterBackground),m.insertBefore(u.gutterBackground,u.text)}var S=u.line.gutterMarkers;if(a.options.lineNumbers||S){var O=Ns(u),A=u.gutter=B("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?h.fixedPos:-h.gutterTotalWidth)+"px");if(A.setAttribute("aria-hidden","true"),a.display.input.setUneditable(A),O.insertBefore(A,u.text),u.line.gutterClass&&(A.className+=" "+u.line.gutterClass),a.options.lineNumbers&&(!S||!S["CodeMirror-linenumbers"])&&(u.lineNumber=A.appendChild(B("div",Ce(a.options,p),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+h.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),S)for(var L=0;L<a.display.gutterSpecs.length;++L){var F=a.display.gutterSpecs[L].className,te=S.hasOwnProperty(F)&&S[F];te&&A.appendChild(B("div",[te],"CodeMirror-gutter-elt","left: "+h.gutterLeft[F]+"px; width: "+h.gutterWidth[F]+"px"))}}}function GS(a,u,p){u.alignable&&(u.alignable=null);for(var h=q("CodeMirror-linewidget"),m=u.node.firstChild,S=void 0;m;m=S)S=m.nextSibling,h.test(m.className)&&u.node.removeChild(m);Wp(a,u,p)}function YS(a,u,p,h){var m=Fp(a,u);return u.text=u.node=m.pre,m.bgClass&&(u.bgClass=m.bgClass),m.textClass&&(u.textClass=m.textClass),kc(a,u),zp(a,u,p,h),Wp(a,u,h),u.node}function Wp(a,u,p){if(Up(a,u.line,u,p,!0),u.rest)for(var h=0;h<u.rest.length;h++)Up(a,u.rest[h],u,p,!1)}function Up(a,u,p,h,m){if(u.widgets)for(var S=Ns(p),O=0,A=u.widgets;O<A.length;++O){var L=A[O],F=B("div",[L.node],"CodeMirror-linewidget"+(L.className?" "+L.className:""));L.handleMouseEvents||F.setAttribute("cm-ignore-events","true"),KS(L,F,p,h),a.display.input.setUneditable(F),m&&L.above?S.insertBefore(F,p.gutter||p.text):S.appendChild(F),Wn(L,"redraw")}}function KS(a,u,p,h){if(a.noHScroll){(p.alignable||(p.alignable=[])).push(u);var m=h.wrapperWidth;u.style.left=h.fixedPos+"px",a.coverGutter||(m-=h.gutterTotalWidth,u.style.paddingLeft=h.gutterTotalWidth+"px"),u.style.width=m+"px"}a.coverGutter&&(u.style.zIndex=5,u.style.position="relative",a.noHScroll||(u.style.marginLeft=-h.gutterTotalWidth+"px"))}function As(a){if(a.height!=null)return a.height;var u=a.doc.cm;if(!u)return 0;if(!ye(document.body,a.node)){var p="position: relative;";a.coverGutter&&(p+="margin-left: -"+u.display.gutters.offsetWidth+"px;"),a.noHScroll&&(p+="width: "+u.display.wrapper.clientWidth+"px;"),z(u.display.measure,B("div",[a.node],null,p))}return a.height=a.node.parentNode.offsetHeight}function qi(a,u){for(var p=Zn(u);p!=a.wrapper;p=p.parentNode)if(!p||p.nodeType==1&&p.getAttribute("cm-ignore-events")=="true"||p.parentNode==a.sizer&&p!=a.mover)return!0}function ou(a){return a.lineSpace.offsetTop}function Mc(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function Vp(a){if(a.cachedPaddingH)return a.cachedPaddingH;var u=z(a.measure,B("pre","x","CodeMirror-line-like")),p=window.getComputedStyle?window.getComputedStyle(u):u.currentStyle,h={left:parseInt(p.paddingLeft),right:parseInt(p.paddingRight)};return!isNaN(h.left)&&!isNaN(h.right)&&(a.cachedPaddingH=h),h}function Di(a){return Fe-a.display.nativeBarWidth}function Po(a){return a.display.scroller.clientWidth-Di(a)-a.display.barWidth}function Nc(a){return a.display.scroller.clientHeight-Di(a)-a.display.barHeight}function qS(a,u,p){var h=a.options.lineWrapping,m=h&&Po(a);if(!u.measure.heights||h&&u.measure.width!=m){var S=u.measure.heights=[];if(h){u.measure.width=m;for(var O=u.text.firstChild.getClientRects(),A=0;A<O.length-1;A++){var L=O[A],F=O[A+1];Math.abs(L.bottom-F.bottom)>2&&S.push((L.bottom+F.top)/2-p.top)}}S.push(p.bottom-p.top)}}function Xp(a,u,p){if(a.line==u)return{map:a.measure.map,cache:a.measure.cache};if(a.rest){for(var h=0;h<a.rest.length;h++)if(a.rest[h]==u)return{map:a.measure.maps[h],cache:a.measure.caches[h]};for(var m=0;m<a.rest.length;m++)if(N(a.rest[m])>p)return{map:a.measure.maps[m],cache:a.measure.caches[m],before:!0}}}function JS(a,u){u=li(u);var p=N(u),h=a.display.externalMeasured=new Hp(a.doc,u,p);h.lineN=p;var m=h.built=Bp(a,h);return h.text=m.pre,z(a.display.lineMeasure,m.pre),h}function Gp(a,u,p,h){return Li(a,va(a,u),p,h)}function Ac(a,u){if(u>=a.display.viewFrom&&u<a.display.viewTo)return a.display.view[Bo(a,u)];var p=a.display.externalMeasured;if(p&&u>=p.lineN&&u<p.lineN+p.size)return p}function va(a,u){var p=N(u),h=Ac(a,p);h&&!h.text?h=null:h&&h.changes&&($p(a,h,p,Rc(a)),a.curOp.forceUpdate=!0),h||(h=JS(a,u));var m=Xp(h,u,p);return{line:u,view:h,rect:null,map:m.map,cache:m.cache,before:m.before,hasHeights:!1}}function Li(a,u,p,h,m){u.before&&(p=-1);var S=p+(h||""),O;return u.cache.hasOwnProperty(S)?O=u.cache[S]:(u.rect||(u.rect=u.view.text.getBoundingClientRect()),u.hasHeights||(qS(a,u.view,u.rect),u.hasHeights=!0),O=QS(a,u,p,h),O.bogus||(u.cache[S]=O)),{left:O.left,right:O.right,top:m?O.rtop:O.top,bottom:m?O.rbottom:O.bottom}}var Yp={left:0,right:0,top:0,bottom:0};function Kp(a,u,p){for(var h,m,S,O,A,L,F=0;F<a.length;F+=3)if(A=a[F],L=a[F+1],u<A?(m=0,S=1,O="left"):u<L?(m=u-A,S=m+1):(F==a.length-3||u==L&&a[F+3]>u)&&(S=L-A,m=S-1,u>=L&&(O="right")),m!=null){if(h=a[F+2],A==L&&p==(h.insertLeft?"left":"right")&&(O=p),p=="left"&&m==0)for(;F&&a[F-2]==a[F-3]&&a[F-1].insertLeft;)h=a[(F-=3)+2],O="left";if(p=="right"&&m==L-A)for(;F<a.length-3&&a[F+3]==a[F+4]&&!a[F+5].insertLeft;)h=a[(F+=3)+2],O="right";break}return{node:h,start:m,end:S,collapse:O,coverStart:A,coverEnd:L}}function ZS(a,u){var p=Yp;if(u=="left")for(var h=0;h<a.length&&(p=a[h]).left==p.right;h++);else for(var m=a.length-1;m>=0&&(p=a[m]).left==p.right;m--);return p}function QS(a,u,p,h){var m=Kp(u.map,p,h),S=m.node,O=m.start,A=m.end,L=m.collapse,F;if(S.nodeType==3){for(var te=0;te<4;te++){for(;O&&Je(u.line.text.charAt(m.coverStart+O));)--O;for(;m.coverStart+A<m.coverEnd&&Je(u.line.text.charAt(m.coverStart+A));)++A;if(d&&c<9&&O==0&&A==m.coverEnd-m.coverStart?F=S.parentNode.getBoundingClientRect():F=ZS(Ee(S,O,A).getClientRects(),h),F.left||F.right||O==0)break;A=O,O=O-1,L="right"}d&&c<11&&(F=eE(a.display.measure,F))}else{O>0&&(L=h="right");var ie;a.options.lineWrapping&&(ie=S.getClientRects()).length>1?F=ie[h=="right"?ie.length-1:0]:F=S.getBoundingClientRect()}if(d&&c<9&&!O&&(!F||!F.left&&!F.right)){var ge=S.parentNode.getClientRects()[0];ge?F={left:ge.left,right:ge.left+ma(a.display),top:ge.top,bottom:ge.bottom}:F=Yp}for(var fe=F.top-u.rect.top,Le=F.bottom-u.rect.top,He=(fe+Le)/2,Qe=u.view.measure.heights,at=0;at<Qe.length-1&&!(He<Qe[at]);at++);var ft=at?Qe[at-1]:0,st=Qe[at],gt={left:(L=="right"?F.right:F.left)-u.rect.left,right:(L=="left"?F.left:F.right)-u.rect.left,top:ft,bottom:st};return!F.left&&!F.right&&(gt.bogus=!0),a.options.singleCursorHeightPerLine||(gt.rtop=fe,gt.rbottom=Le),gt}function eE(a,u){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!Ti(a))return u;var p=screen.logicalXDPI/screen.deviceXDPI,h=screen.logicalYDPI/screen.deviceYDPI;return{left:u.left*p,right:u.right*p,top:u.top*h,bottom:u.bottom*h}}function qp(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var u=0;u<a.rest.length;u++)a.measure.caches[u]={}}function Jp(a){a.display.externalMeasure=null,T(a.display.lineMeasure);for(var u=0;u<a.display.view.length;u++)qp(a.display.view[u])}function Ts(a){Jp(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function Zp(a){return g&&k?-(a.body.getBoundingClientRect().left-parseInt(getComputedStyle(a.body).marginLeft)):a.defaultView.pageXOffset||(a.documentElement||a.body).scrollLeft}function Qp(a){return g&&k?-(a.body.getBoundingClientRect().top-parseInt(getComputedStyle(a.body).marginTop)):a.defaultView.pageYOffset||(a.documentElement||a.body).scrollTop}function Tc(a){var u=li(a),p=u.widgets,h=0;if(p)for(var m=0;m<p.length;++m)p[m].above&&(h+=As(p[m]));return h}function au(a,u,p,h,m){if(!m){var S=Tc(u);p.top+=S,p.bottom+=S}if(h=="line")return p;h||(h="local");var O=Ki(u);if(h=="local"?O+=ou(a.display):O-=a.display.viewOffset,h=="page"||h=="window"){var A=a.display.lineSpace.getBoundingClientRect();O+=A.top+(h=="window"?0:Qp(Re(a)));var L=A.left+(h=="window"?0:Zp(Re(a)));p.left+=L,p.right+=L}return p.top+=O,p.bottom+=O,p}function ev(a,u,p){if(p=="div")return u;var h=u.left,m=u.top;if(p=="page")h-=Zp(Re(a)),m-=Qp(Re(a));else if(p=="local"||!p){var S=a.display.sizer.getBoundingClientRect();h+=S.left,m+=S.top}var O=a.display.lineSpace.getBoundingClientRect();return{left:h-O.left,top:m-O.top}}function su(a,u,p,h,m){return h||(h=Xe(a.doc,u.line)),au(a,h,Gp(a,h,u.ch,m),p)}function ui(a,u,p,h,m,S){h=h||Xe(a.doc,u.line),m||(m=va(a,h));function O(Le,He){var Qe=Li(a,m,Le,He?"right":"left",S);return He?Qe.left=Qe.right:Qe.right=Qe.left,au(a,h,Qe,p)}var A=ot(h,a.doc.direction),L=u.ch,F=u.sticky;if(L>=h.text.length?(L=h.text.length,F="before"):L<=0&&(L=0,F="after"),!A)return O(F=="before"?L-1:L,F=="before");function te(Le,He,Qe){var at=A[He],ft=at.level==1;return O(Qe?Le-1:Le,ft!=Qe)}var ie=ut(A,L,F),ge=qe,fe=te(L,ie,F=="before");return ge!=null&&(fe.other=te(L,ge,F!="before")),fe}function tv(a,u){var p=0;u=Bt(a.doc,u),a.options.lineWrapping||(p=ma(a.display)*u.ch);var h=Xe(a.doc,u.line),m=Ki(h)+ou(a.display);return{left:p,right:p,top:m,bottom:m+h.height}}function Dc(a,u,p,h,m){var S=ve(a,u,p);return S.xRel=m,h&&(S.outside=h),S}function Lc(a,u,p){var h=a.doc;if(p+=a.display.viewOffset,p<0)return Dc(h.first,0,null,-1,-1);var m=V(h,p),S=h.first+h.size-1;if(m>S)return Dc(h.first+h.size-1,Xe(h,S).text.length,null,1,1);u<0&&(u=0);for(var O=Xe(h,m);;){var A=tE(a,O,m,u,p),L=NS(O,A.ch+(A.xRel>0||A.outside>0?1:0));if(!L)return A;var F=L.find(1);if(F.line==m)return F;O=Xe(h,m=F.line)}}function nv(a,u,p,h){h-=Tc(u);var m=u.text.length,S=ht(function(O){return Li(a,p,O-1).bottom<=h},m,0);return m=ht(function(O){return Li(a,p,O).top>h},S,m),{begin:S,end:m}}function rv(a,u,p,h){p||(p=va(a,u));var m=au(a,u,Li(a,p,h),"line").top;return nv(a,u,p,m)}function Pc(a,u,p,h){return a.bottom<=p?!1:a.top>p?!0:(h?a.left:a.right)>u}function tE(a,u,p,h,m){m-=Ki(u);var S=va(a,u),O=Tc(u),A=0,L=u.text.length,F=!0,te=ot(u,a.doc.direction);if(te){var ie=(a.options.lineWrapping?rE:nE)(a,u,p,S,te,h,m);F=ie.level!=1,A=F?ie.from:ie.to-1,L=F?ie.to:ie.from-1}var ge=null,fe=null,Le=ht(function(At){var Mt=Li(a,S,At);return Mt.top+=O,Mt.bottom+=O,Pc(Mt,h,m,!1)?(Mt.top<=m&&Mt.left<=h&&(ge=At,fe=Mt),!0):!1},A,L),He,Qe,at=!1;if(fe){var ft=h-fe.left<fe.right-h,st=ft==F;Le=ge+(st?0:1),Qe=st?"after":"before",He=ft?fe.left:fe.right}else{!F&&(Le==L||Le==A)&&Le++,Qe=Le==0?"after":Le==u.text.length?"before":Li(a,S,Le-(F?1:0)).bottom+O<=m==F?"after":"before";var gt=ui(a,ve(p,Le,Qe),"line",u,S);He=gt.left,at=m<gt.top?-1:m>=gt.bottom?1:0}return Le=ct(u.text,Le,1),Dc(p,Le,Qe,at,h-He)}function nE(a,u,p,h,m,S,O){var A=ht(function(ie){var ge=m[ie],fe=ge.level!=1;return Pc(ui(a,ve(p,fe?ge.to:ge.from,fe?"before":"after"),"line",u,h),S,O,!0)},0,m.length-1),L=m[A];if(A>0){var F=L.level!=1,te=ui(a,ve(p,F?L.from:L.to,F?"after":"before"),"line",u,h);Pc(te,S,O,!0)&&te.top>O&&(L=m[A-1])}return L}function rE(a,u,p,h,m,S,O){var A=nv(a,u,h,O),L=A.begin,F=A.end;/\s/.test(u.text.charAt(F-1))&&F--;for(var te=null,ie=null,ge=0;ge<m.length;ge++){var fe=m[ge];if(!(fe.from>=F||fe.to<=L)){var Le=fe.level!=1,He=Li(a,h,Le?Math.min(F,fe.to)-1:Math.max(L,fe.from)).right,Qe=He<S?S-He+1e9:He-S;(!te||ie>Qe)&&(te=fe,ie=Qe)}}return te||(te=m[m.length-1]),te.from<L&&(te={from:L,to:te.to,level:te.level}),te.to>F&&(te={from:te.from,to:F,level:te.level}),te}var Ro;function ga(a){if(a.cachedTextHeight!=null)return a.cachedTextHeight;if(Ro==null){Ro=B("pre",null,"CodeMirror-line-like");for(var u=0;u<49;++u)Ro.appendChild(document.createTextNode("x")),Ro.appendChild(B("br"));Ro.appendChild(document.createTextNode("x"))}z(a.measure,Ro);var p=Ro.offsetHeight/50;return p>3&&(a.cachedTextHeight=p),T(a.measure),p||1}function ma(a){if(a.cachedCharWidth!=null)return a.cachedCharWidth;var u=B("span","xxxxxxxxxx"),p=B("pre",[u],"CodeMirror-line-like");z(a.measure,p);var h=u.getBoundingClientRect(),m=(h.right-h.left)/10;return m>2&&(a.cachedCharWidth=m),m||10}function Rc(a){for(var u=a.display,p={},h={},m=u.gutters.clientLeft,S=u.gutters.firstChild,O=0;S;S=S.nextSibling,++O){var A=a.display.gutterSpecs[O].className;p[A]=S.offsetLeft+S.clientLeft+m,h[A]=S.clientWidth}return{fixedPos:Ic(u),gutterTotalWidth:u.gutters.offsetWidth,gutterLeft:p,gutterWidth:h,wrapperWidth:u.wrapper.clientWidth}}function Ic(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function iv(a){var u=ga(a.display),p=a.options.lineWrapping,h=p&&Math.max(5,a.display.scroller.clientWidth/ma(a.display)-3);return function(m){if(so(a.doc,m))return 0;var S=0;if(m.widgets)for(var O=0;O<m.widgets.length;O++)m.widgets[O].height&&(S+=m.widgets[O].height);return p?S+(Math.ceil(m.text.length/h)||1)*u:S+u}}function Bc(a){var u=a.doc,p=iv(a);u.iter(function(h){var m=p(h);m!=h.height&&J(h,m)})}function Io(a,u,p,h){var m=a.display;if(!p&&Zn(u).getAttribute("cm-not-content")=="true")return null;var S,O,A=m.lineSpace.getBoundingClientRect();try{S=u.clientX-A.left,O=u.clientY-A.top}catch{return null}var L=Lc(a,S,O),F;if(h&&L.xRel>0&&(F=Xe(a.doc,L.line).text).length==L.ch){var te=ke(F,F.length,a.options.tabSize)-F.length;L=ve(L.line,Math.max(0,Math.round((S-Vp(a.display).left)/ma(a.display))-te))}return L}function Bo(a,u){if(u>=a.display.viewTo||(u-=a.display.viewFrom,u<0))return null;for(var p=a.display.view,h=0;h<p.length;h++)if(u-=p[h].size,u<0)return h}function gr(a,u,p,h){u==null&&(u=a.doc.first),p==null&&(p=a.doc.first+a.doc.size),h||(h=0);var m=a.display;if(h&&p<m.viewTo&&(m.updateLineNumbers==null||m.updateLineNumbers>u)&&(m.updateLineNumbers=u),a.curOp.viewChanged=!0,u>=m.viewTo)Yi&&Ec(a.doc,u)<m.viewTo&&uo(a);else if(p<=m.viewFrom)Yi&&Rp(a.doc,p+h)>m.viewFrom?uo(a):(m.viewFrom+=h,m.viewTo+=h);else if(u<=m.viewFrom&&p>=m.viewTo)uo(a);else if(u<=m.viewFrom){var S=lu(a,p,p+h,1);S?(m.view=m.view.slice(S.index),m.viewFrom=S.lineN,m.viewTo+=h):uo(a)}else if(p>=m.viewTo){var O=lu(a,u,u,-1);O?(m.view=m.view.slice(0,O.index),m.viewTo=O.lineN):uo(a)}else{var A=lu(a,u,u,-1),L=lu(a,p,p+h,1);A&&L?(m.view=m.view.slice(0,A.index).concat(iu(a,A.lineN,L.lineN)).concat(m.view.slice(L.index)),m.viewTo+=h):uo(a)}var F=m.externalMeasured;F&&(p<F.lineN?F.lineN+=h:u<F.lineN+F.size&&(m.externalMeasured=null))}function lo(a,u,p){a.curOp.viewChanged=!0;var h=a.display,m=a.display.externalMeasured;if(m&&u>=m.lineN&&u<m.lineN+m.size&&(h.externalMeasured=null),!(u<h.viewFrom||u>=h.viewTo)){var S=h.view[Bo(a,u)];if(S.node!=null){var O=S.changes||(S.changes=[]);Ie(O,p)==-1&&O.push(p)}}}function uo(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function lu(a,u,p,h){var m=Bo(a,u),S,O=a.display.view;if(!Yi||p==a.doc.first+a.doc.size)return{index:m,lineN:p};for(var A=a.display.viewFrom,L=0;L<m;L++)A+=O[L].size;if(A!=u){if(h>0){if(m==O.length-1)return null;S=A+O[m].size-u,m++}else S=A-u;u+=S,p+=S}for(;Ec(a.doc,p)!=p;){if(m==(h<0?0:O.length-1))return null;p+=h*O[m-(h<0?1:0)].size,m+=h}return{index:m,lineN:p}}function iE(a,u,p){var h=a.display,m=h.view;m.length==0||u>=h.viewTo||p<=h.viewFrom?(h.view=iu(a,u,p),h.viewFrom=u):(h.viewFrom>u?h.view=iu(a,u,h.viewFrom).concat(h.view):h.viewFrom<u&&(h.view=h.view.slice(Bo(a,u))),h.viewFrom=u,h.viewTo<p?h.view=h.view.concat(iu(a,h.viewTo,p)):h.viewTo>p&&(h.view=h.view.slice(0,Bo(a,p)))),h.viewTo=p}function ov(a){for(var u=a.display.view,p=0,h=0;h<u.length;h++){var m=u[h];!m.hidden&&(!m.node||m.changes)&&++p}return p}function Ds(a){a.display.input.showSelection(a.display.input.prepareSelection())}function av(a,u){u===void 0&&(u=!0);var p=a.doc,h={},m=h.cursors=document.createDocumentFragment(),S=h.selection=document.createDocumentFragment(),O=a.options.$customCursor;O&&(u=!0);for(var A=0;A<p.sel.ranges.length;A++)if(!(!u&&A==p.sel.primIndex)){var L=p.sel.ranges[A];if(!(L.from().line>=a.display.viewTo||L.to().line<a.display.viewFrom)){var F=L.empty();if(O){var te=O(a,L);te&&jc(a,te,m)}else(F||a.options.showCursorWhenSelecting)&&jc(a,L.head,m);F||oE(a,L,S)}}return h}function jc(a,u,p){var h=ui(a,u,"div",null,null,!a.options.singleCursorHeightPerLine),m=p.appendChild(B("div"," ","CodeMirror-cursor"));if(m.style.left=h.left+"px",m.style.top=h.top+"px",m.style.height=Math.max(0,h.bottom-h.top)*a.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(a.getWrapperElement().className)){var S=su(a,u,"div",null,null),O=S.right-S.left;m.style.width=(O>0?O:a.defaultCharWidth())+"px"}if(h.other){var A=p.appendChild(B("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));A.style.display="",A.style.left=h.other.left+"px",A.style.top=h.other.top+"px",A.style.height=(h.other.bottom-h.other.top)*.85+"px"}}function uu(a,u){return a.top-u.top||a.left-u.left}function oE(a,u,p){var h=a.display,m=a.doc,S=document.createDocumentFragment(),O=Vp(a.display),A=O.left,L=Math.max(h.sizerWidth,Po(a)-h.sizer.offsetLeft)-O.right,F=m.direction=="ltr";function te(st,gt,At,Mt){gt<0&&(gt=0),gt=Math.round(gt),Mt=Math.round(Mt),S.appendChild(B("div",null,"CodeMirror-selected","position: absolute; left: "+st+`px;
                             top: `+gt+"px; width: "+(At??L-st)+`px;
                             height: `+(Mt-gt)+"px"))}function ie(st,gt,At){var Mt=Xe(m,st),zt=Mt.text.length,hn,Xn;function bn(Nn,_r){return su(a,ve(st,Nn),"div",Mt,_r)}function Pr(Nn,_r,qn){var Ln=rv(a,Mt,null,Nn),An=_r=="ltr"==(qn=="after")?"left":"right",En=qn=="after"?Ln.begin:Ln.end-(/\s/.test(Mt.text.charAt(Ln.end-1))?2:1);return bn(En,An)[An]}var yr=ot(Mt,m.direction);return Pt(yr,gt||0,At??zt,function(Nn,_r,qn,Ln){var An=qn=="ltr",En=bn(Nn,An?"left":"right"),br=bn(_r-1,An?"right":"left"),Aa=gt==null&&Nn==0,go=At==null&&_r==zt,er=Ln==0,Pi=!yr||Ln==yr.length-1;if(br.top-En.top<=3){var Gn=(F?Aa:go)&&er,ff=(F?go:Aa)&&Pi,Qi=Gn?A:(An?En:br).left,zo=ff?L:(An?br:En).right;te(Qi,En.top,zo-Qi,En.bottom)}else{var Wo,lr,Ta,hf;An?(Wo=F&&Aa&&er?A:En.left,lr=F?L:Pr(Nn,qn,"before"),Ta=F?A:Pr(_r,qn,"after"),hf=F&&go&&Pi?L:br.right):(Wo=F?Pr(Nn,qn,"before"):A,lr=!F&&Aa&&er?L:En.right,Ta=!F&&go&&Pi?A:br.left,hf=F?Pr(_r,qn,"after"):L),te(Wo,En.top,lr-Wo,En.bottom),En.bottom<br.top&&te(A,En.bottom,null,br.top),te(Ta,br.top,hf-Ta,br.bottom)}(!hn||uu(En,hn)<0)&&(hn=En),uu(br,hn)<0&&(hn=br),(!Xn||uu(En,Xn)<0)&&(Xn=En),uu(br,Xn)<0&&(Xn=br)}),{start:hn,end:Xn}}var ge=u.from(),fe=u.to();if(ge.line==fe.line)ie(ge.line,ge.ch,fe.ch);else{var Le=Xe(m,ge.line),He=Xe(m,fe.line),Qe=li(Le)==li(He),at=ie(ge.line,ge.ch,Qe?Le.text.length+1:null).end,ft=ie(fe.line,Qe?0:null,fe.ch).start;Qe&&(at.top<ft.top-2?(te(at.right,at.top,null,at.bottom),te(A,ft.top,ft.left,ft.bottom)):te(at.right,at.top,ft.left-at.right,at.bottom)),at.bottom<ft.top&&te(A,at.bottom,null,ft.top)}p.appendChild(S)}function Hc(a){if(a.state.focused){var u=a.display;clearInterval(u.blinker);var p=!0;u.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?u.blinker=setInterval(function(){a.hasFocus()||ya(a),u.cursorDiv.style.visibility=(p=!p)?"":"hidden"},a.options.cursorBlinkRate):a.options.cursorBlinkRate<0&&(u.cursorDiv.style.visibility="hidden")}}function sv(a){a.hasFocus()||(a.display.input.focus(),a.state.focused||Fc(a))}function $c(a){a.state.delayingBlurEvent=!0,setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,a.state.focused&&ya(a))},100)}function Fc(a,u){a.state.delayingBlurEvent&&!a.state.draggingText&&(a.state.delayingBlurEvent=!1),a.options.readOnly!="nocursor"&&(a.state.focused||(Ze(a,"focus",a,u),a.state.focused=!0,Oe(a.display.wrapper,"CodeMirror-focused"),!a.curOp&&a.display.selForContextMenu!=a.doc.sel&&(a.display.input.reset(),f&&setTimeout(function(){return a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),Hc(a))}function ya(a,u){a.state.delayingBlurEvent||(a.state.focused&&(Ze(a,"blur",a,u),a.state.focused=!1,ee(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function du(a){for(var u=a.display,p=u.lineDiv.offsetTop,h=Math.max(0,u.scroller.getBoundingClientRect().top),m=u.lineDiv.getBoundingClientRect().top,S=0,O=0;O<u.view.length;O++){var A=u.view[O],L=a.options.lineWrapping,F=void 0,te=0;if(!A.hidden){if(m+=A.line.height,d&&c<8){var ie=A.node.offsetTop+A.node.offsetHeight;F=ie-p,p=ie}else{var ge=A.node.getBoundingClientRect();F=ge.bottom-ge.top,!L&&A.text.firstChild&&(te=A.text.firstChild.getBoundingClientRect().right-ge.left-1)}var fe=A.line.height-F;if((fe>.005||fe<-.005)&&(m<h&&(S-=fe),J(A.line,F),lv(A.line),A.rest))for(var Le=0;Le<A.rest.length;Le++)lv(A.rest[Le]);if(te>a.display.sizerWidth){var He=Math.ceil(te/ma(a.display));He>a.display.maxLineLength&&(a.display.maxLineLength=He,a.display.maxLine=A.line,a.display.maxLineChanged=!0)}}}Math.abs(S)>2&&(u.scroller.scrollTop+=S)}function lv(a){if(a.widgets)for(var u=0;u<a.widgets.length;++u){var p=a.widgets[u],h=p.node.parentNode;h&&(p.height=h.offsetHeight)}}function cu(a,u,p){var h=p&&p.top!=null?Math.max(0,p.top):a.scroller.scrollTop;h=Math.floor(h-ou(a));var m=p&&p.bottom!=null?p.bottom:h+a.wrapper.clientHeight,S=V(u,h),O=V(u,m);if(p&&p.ensure){var A=p.ensure.from.line,L=p.ensure.to.line;A<S?(S=A,O=V(u,Ki(Xe(u,A))+a.wrapper.clientHeight)):Math.min(L,u.lastLine())>=O&&(S=V(u,Ki(Xe(u,L))-a.wrapper.clientHeight),O=L)}return{from:S,to:Math.max(O,S+1)}}function aE(a,u){if(!tt(a,"scrollCursorIntoView")){var p=a.display,h=p.sizer.getBoundingClientRect(),m=null,S=p.wrapper.ownerDocument;if(u.top+h.top<0?m=!0:u.bottom+h.top>(S.defaultView.innerHeight||S.documentElement.clientHeight)&&(m=!1),m!=null&&!_){var O=B("div","​",null,`position: absolute;
                         top: `+(u.top-p.viewOffset-ou(a.display))+`px;
                         height: `+(u.bottom-u.top+Di(a)+p.barHeight)+`px;
                         left: `+u.left+"px; width: "+Math.max(2,u.right-u.left)+"px;");a.display.lineSpace.appendChild(O),O.scrollIntoView(m),a.display.lineSpace.removeChild(O)}}}function sE(a,u,p,h){h==null&&(h=0);var m;!a.options.lineWrapping&&u==p&&(p=u.sticky=="before"?ve(u.line,u.ch+1,"before"):u,u=u.ch?ve(u.line,u.sticky=="before"?u.ch-1:u.ch,"after"):u);for(var S=0;S<5;S++){var O=!1,A=ui(a,u),L=!p||p==u?A:ui(a,p);m={left:Math.min(A.left,L.left),top:Math.min(A.top,L.top)-h,right:Math.max(A.left,L.left),bottom:Math.max(A.bottom,L.bottom)+h};var F=zc(a,m),te=a.doc.scrollTop,ie=a.doc.scrollLeft;if(F.scrollTop!=null&&(Ps(a,F.scrollTop),Math.abs(a.doc.scrollTop-te)>1&&(O=!0)),F.scrollLeft!=null&&(jo(a,F.scrollLeft),Math.abs(a.doc.scrollLeft-ie)>1&&(O=!0)),!O)break}return m}function lE(a,u){var p=zc(a,u);p.scrollTop!=null&&Ps(a,p.scrollTop),p.scrollLeft!=null&&jo(a,p.scrollLeft)}function zc(a,u){var p=a.display,h=ga(a.display);u.top<0&&(u.top=0);var m=a.curOp&&a.curOp.scrollTop!=null?a.curOp.scrollTop:p.scroller.scrollTop,S=Nc(a),O={};u.bottom-u.top>S&&(u.bottom=u.top+S);var A=a.doc.height+Mc(p),L=u.top<h,F=u.bottom>A-h;if(u.top<m)O.scrollTop=L?0:u.top;else if(u.bottom>m+S){var te=Math.min(u.top,(F?A:u.bottom)-S);te!=m&&(O.scrollTop=te)}var ie=a.options.fixedGutter?0:p.gutters.offsetWidth,ge=a.curOp&&a.curOp.scrollLeft!=null?a.curOp.scrollLeft:p.scroller.scrollLeft-ie,fe=Po(a)-p.gutters.offsetWidth,Le=u.right-u.left>fe;return Le&&(u.right=u.left+fe),u.left<10?O.scrollLeft=0:u.left<ge?O.scrollLeft=Math.max(0,u.left+ie-(Le?0:10)):u.right>fe+ge-3&&(O.scrollLeft=u.right+(Le?0:10)-fe),O}function Wc(a,u){u!=null&&(fu(a),a.curOp.scrollTop=(a.curOp.scrollTop==null?a.doc.scrollTop:a.curOp.scrollTop)+u)}function _a(a){fu(a);var u=a.getCursor();a.curOp.scrollToPos={from:u,to:u,margin:a.options.cursorScrollMargin}}function Ls(a,u,p){(u!=null||p!=null)&&fu(a),u!=null&&(a.curOp.scrollLeft=u),p!=null&&(a.curOp.scrollTop=p)}function uE(a,u){fu(a),a.curOp.scrollToPos=u}function fu(a){var u=a.curOp.scrollToPos;if(u){a.curOp.scrollToPos=null;var p=tv(a,u.from),h=tv(a,u.to);uv(a,p,h,u.margin)}}function uv(a,u,p,h){var m=zc(a,{left:Math.min(u.left,p.left),top:Math.min(u.top,p.top)-h,right:Math.max(u.right,p.right),bottom:Math.max(u.bottom,p.bottom)+h});Ls(a,m.scrollLeft,m.scrollTop)}function Ps(a,u){Math.abs(a.doc.scrollTop-u)<2||(i||Vc(a,{top:u}),dv(a,u,!0),i&&Vc(a),Bs(a,100))}function dv(a,u,p){u=Math.max(0,Math.min(a.display.scroller.scrollHeight-a.display.scroller.clientHeight,u)),!(a.display.scroller.scrollTop==u&&!p)&&(a.doc.scrollTop=u,a.display.scrollbars.setScrollTop(u),a.display.scroller.scrollTop!=u&&(a.display.scroller.scrollTop=u))}function jo(a,u,p,h){u=Math.max(0,Math.min(u,a.display.scroller.scrollWidth-a.display.scroller.clientWidth)),!((p?u==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-u)<2)&&!h)&&(a.doc.scrollLeft=u,vv(a),a.display.scroller.scrollLeft!=u&&(a.display.scroller.scrollLeft=u),a.display.scrollbars.setScrollLeft(u))}function Rs(a){var u=a.display,p=u.gutters.offsetWidth,h=Math.round(a.doc.height+Mc(a.display));return{clientHeight:u.scroller.clientHeight,viewHeight:u.wrapper.clientHeight,scrollWidth:u.scroller.scrollWidth,clientWidth:u.scroller.clientWidth,viewWidth:u.wrapper.clientWidth,barLeft:a.options.fixedGutter?p:0,docHeight:h,scrollHeight:h+Di(a)+u.barHeight,nativeBarWidth:u.nativeBarWidth,gutterWidth:p}}var Ho=function(a,u,p){this.cm=p;var h=this.vert=B("div",[B("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),m=this.horiz=B("div",[B("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");h.tabIndex=m.tabIndex=-1,a(h),a(m),De(h,"scroll",function(){h.clientHeight&&u(h.scrollTop,"vertical")}),De(m,"scroll",function(){m.clientWidth&&u(m.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,d&&c<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Ho.prototype.update=function(a){var u=a.scrollWidth>a.clientWidth+1,p=a.scrollHeight>a.clientHeight+1,h=a.nativeBarWidth;if(p){this.vert.style.display="block",this.vert.style.bottom=u?h+"px":"0";var m=a.viewHeight-(u?h:0);this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+m)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(u){this.horiz.style.display="block",this.horiz.style.right=p?h+"px":"0",this.horiz.style.left=a.barLeft+"px";var S=a.viewWidth-a.barLeft-(p?h:0);this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+S)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&a.clientHeight>0&&(h==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:p?h:0,bottom:u?h:0}},Ho.prototype.setScrollLeft=function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Ho.prototype.setScrollTop=function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Ho.prototype.zeroWidthHack=function(){var a=R&&!w?"12px":"18px";this.horiz.style.height=this.vert.style.width=a,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new Ye,this.disableVert=new Ye},Ho.prototype.enableZeroWidthBar=function(a,u,p){a.style.visibility="";function h(){var m=a.getBoundingClientRect(),S=p=="vert"?document.elementFromPoint(m.right-1,(m.top+m.bottom)/2):document.elementFromPoint((m.right+m.left)/2,m.bottom-1);S!=a?a.style.visibility="hidden":u.set(1e3,h)}u.set(1e3,h)},Ho.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz),a.removeChild(this.vert)};var Is=function(){};Is.prototype.update=function(){return{bottom:0,right:0}},Is.prototype.setScrollLeft=function(){},Is.prototype.setScrollTop=function(){},Is.prototype.clear=function(){};function ba(a,u){u||(u=Rs(a));var p=a.display.barWidth,h=a.display.barHeight;cv(a,u);for(var m=0;m<4&&p!=a.display.barWidth||h!=a.display.barHeight;m++)p!=a.display.barWidth&&a.options.lineWrapping&&du(a),cv(a,Rs(a)),p=a.display.barWidth,h=a.display.barHeight}function cv(a,u){var p=a.display,h=p.scrollbars.update(u);p.sizer.style.paddingRight=(p.barWidth=h.right)+"px",p.sizer.style.paddingBottom=(p.barHeight=h.bottom)+"px",p.heightForcer.style.borderBottom=h.bottom+"px solid transparent",h.right&&h.bottom?(p.scrollbarFiller.style.display="block",p.scrollbarFiller.style.height=h.bottom+"px",p.scrollbarFiller.style.width=h.right+"px"):p.scrollbarFiller.style.display="",h.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(p.gutterFiller.style.display="block",p.gutterFiller.style.height=h.bottom+"px",p.gutterFiller.style.width=u.gutterWidth+"px"):p.gutterFiller.style.display=""}var fv={native:Ho,null:Is};function hv(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&ee(a.display.wrapper,a.display.scrollbars.addClass)),a.display.scrollbars=new fv[a.options.scrollbarStyle](function(u){a.display.wrapper.insertBefore(u,a.display.scrollbarFiller),De(u,"mousedown",function(){a.state.focused&&setTimeout(function(){return a.display.input.focus()},0)}),u.setAttribute("cm-not-content","true")},function(u,p){p=="horizontal"?jo(a,u):Ps(a,u)},a),a.display.scrollbars.addClass&&Oe(a.display.wrapper,a.display.scrollbars.addClass)}var dE=0;function $o(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++dE,markArrays:null},FS(a.curOp)}function Fo(a){var u=a.curOp;u&&WS(u,function(p){for(var h=0;h<p.ops.length;h++)p.ops[h].cm.curOp=null;cE(p)})}function cE(a){for(var u=a.ops,p=0;p<u.length;p++)fE(u[p]);for(var h=0;h<u.length;h++)hE(u[h]);for(var m=0;m<u.length;m++)pE(u[m]);for(var S=0;S<u.length;S++)vE(u[S]);for(var O=0;O<u.length;O++)gE(u[O])}function fE(a){var u=a.cm,p=u.display;yE(u),a.updateMaxLine&&Oc(u),a.mustUpdate=a.viewChanged||a.forceUpdate||a.scrollTop!=null||a.scrollToPos&&(a.scrollToPos.from.line<p.viewFrom||a.scrollToPos.to.line>=p.viewTo)||p.maxLineChanged&&u.options.lineWrapping,a.update=a.mustUpdate&&new hu(u,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function hE(a){a.updatedDisplay=a.mustUpdate&&Uc(a.cm,a.update)}function pE(a){var u=a.cm,p=u.display;a.updatedDisplay&&du(u),a.barMeasure=Rs(u),p.maxLineChanged&&!u.options.lineWrapping&&(a.adjustWidthTo=Gp(u,p.maxLine,p.maxLine.text.length).left+3,u.display.sizerWidth=a.adjustWidthTo,a.barMeasure.scrollWidth=Math.max(p.scroller.clientWidth,p.sizer.offsetLeft+a.adjustWidthTo+Di(u)+u.display.barWidth),a.maxScrollLeft=Math.max(0,p.sizer.offsetLeft+a.adjustWidthTo-Po(u))),(a.updatedDisplay||a.selectionChanged)&&(a.preparedSelection=p.input.prepareSelection())}function vE(a){var u=a.cm;a.adjustWidthTo!=null&&(u.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<u.doc.scrollLeft&&jo(u,Math.min(u.display.scroller.scrollLeft,a.maxScrollLeft),!0),u.display.maxLineChanged=!1);var p=a.focus&&a.focus==it(Ge(u));a.preparedSelection&&u.display.input.showSelection(a.preparedSelection,p),(a.updatedDisplay||a.startHeight!=u.doc.height)&&ba(u,a.barMeasure),a.updatedDisplay&&Gc(u,a.barMeasure),a.selectionChanged&&Hc(u),u.state.focused&&a.updateInput&&u.display.input.reset(a.typing),p&&sv(a.cm)}function gE(a){var u=a.cm,p=u.display,h=u.doc;if(a.updatedDisplay&&pv(u,a.update),p.wheelStartX!=null&&(a.scrollTop!=null||a.scrollLeft!=null||a.scrollToPos)&&(p.wheelStartX=p.wheelStartY=null),a.scrollTop!=null&&dv(u,a.scrollTop,a.forceScroll),a.scrollLeft!=null&&jo(u,a.scrollLeft,!0,!0),a.scrollToPos){var m=sE(u,Bt(h,a.scrollToPos.from),Bt(h,a.scrollToPos.to),a.scrollToPos.margin);aE(u,m)}var S=a.maybeHiddenMarkers,O=a.maybeUnhiddenMarkers;if(S)for(var A=0;A<S.length;++A)S[A].lines.length||Ze(S[A],"hide");if(O)for(var L=0;L<O.length;++L)O[L].lines.length&&Ze(O[L],"unhide");p.wrapper.offsetHeight&&(h.scrollTop=u.display.scroller.scrollTop),a.changeObjs&&Ze(u,"changes",u,a.changeObjs),a.update&&a.update.finish()}function Lr(a,u){if(a.curOp)return u();$o(a);try{return u()}finally{Fo(a)}}function Un(a,u){return function(){if(a.curOp)return u.apply(a,arguments);$o(a);try{return u.apply(a,arguments)}finally{Fo(a)}}}function sr(a){return function(){if(this.curOp)return a.apply(this,arguments);$o(this);try{return a.apply(this,arguments)}finally{Fo(this)}}}function Vn(a){return function(){var u=this.cm;if(!u||u.curOp)return a.apply(this,arguments);$o(u);try{return a.apply(this,arguments)}finally{Fo(u)}}}function Bs(a,u){a.doc.highlightFrontier<a.display.viewTo&&a.state.highlight.set(u,oe(mE,a))}function mE(a){var u=a.doc;if(!(u.highlightFrontier>=a.display.viewTo)){var p=+new Date+a.options.workTime,h=ao(a,u.highlightFrontier),m=[];u.iter(h.line,Math.min(u.first+u.size,a.display.viewTo+500),function(S){if(h.line>=a.display.viewFrom){var O=S.styles,A=S.text.length>a.options.maxHighlightLength?K(u.mode,h.state):null,L=Wr(a,S,h,!0);A&&(h.state=A),S.styles=L.styles;var F=S.styleClasses,te=L.classes;te?S.styleClasses=te:F&&(S.styleClasses=null);for(var ie=!O||O.length!=S.styles.length||F!=te&&(!F||!te||F.bgClass!=te.bgClass||F.textClass!=te.textClass),ge=0;!ie&&ge<O.length;++ge)ie=O[ge]!=S.styles[ge];ie&&m.push(h.line),S.stateAfter=h.save(),h.nextLine()}else S.text.length<=a.options.maxHighlightLength&&bc(a,S.text,h),S.stateAfter=h.line%5==0?h.save():null,h.nextLine();if(+new Date>p)return Bs(a,a.options.workDelay),!0}),u.highlightFrontier=h.line,u.modeFrontier=Math.max(u.modeFrontier,h.line),m.length&&Lr(a,function(){for(var S=0;S<m.length;S++)lo(a,m[S],"text")})}}var hu=function(a,u,p){var h=a.display;this.viewport=u,this.visible=cu(h,a.doc,u),this.editorIsHidden=!h.wrapper.offsetWidth,this.wrapperHeight=h.wrapper.clientHeight,this.wrapperWidth=h.wrapper.clientWidth,this.oldDisplayWidth=Po(a),this.force=p,this.dims=Rc(a),this.events=[]};hu.prototype.signal=function(a,u){_e(a,u)&&this.events.push(arguments)},hu.prototype.finish=function(){for(var a=0;a<this.events.length;a++)Ze.apply(null,this.events[a])};function yE(a){var u=a.display;!u.scrollbarsClipped&&u.scroller.offsetWidth&&(u.nativeBarWidth=u.scroller.offsetWidth-u.scroller.clientWidth,u.heightForcer.style.height=Di(a)+"px",u.sizer.style.marginBottom=-u.nativeBarWidth+"px",u.sizer.style.borderRightWidth=Di(a)+"px",u.scrollbarsClipped=!0)}function _E(a){if(a.hasFocus())return null;var u=it(Ge(a));if(!u||!ye(a.display.lineDiv,u))return null;var p={activeElt:u};if(window.getSelection){var h=G(a).getSelection();h.anchorNode&&h.extend&&ye(a.display.lineDiv,h.anchorNode)&&(p.anchorNode=h.anchorNode,p.anchorOffset=h.anchorOffset,p.focusNode=h.focusNode,p.focusOffset=h.focusOffset)}return p}function bE(a){if(!(!a||!a.activeElt||a.activeElt==it(le(a.activeElt)))&&(a.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(a.activeElt.nodeName)&&a.anchorNode&&ye(document.body,a.anchorNode)&&ye(document.body,a.focusNode))){var u=a.activeElt.ownerDocument,p=u.defaultView.getSelection(),h=u.createRange();h.setEnd(a.anchorNode,a.anchorOffset),h.collapse(!1),p.removeAllRanges(),p.addRange(h),p.extend(a.focusNode,a.focusOffset)}}function Uc(a,u){var p=a.display,h=a.doc;if(u.editorIsHidden)return uo(a),!1;if(!u.force&&u.visible.from>=p.viewFrom&&u.visible.to<=p.viewTo&&(p.updateLineNumbers==null||p.updateLineNumbers>=p.viewTo)&&p.renderedView==p.view&&ov(a)==0)return!1;gv(a)&&(uo(a),u.dims=Rc(a));var m=h.first+h.size,S=Math.max(u.visible.from-a.options.viewportMargin,h.first),O=Math.min(m,u.visible.to+a.options.viewportMargin);p.viewFrom<S&&S-p.viewFrom<20&&(S=Math.max(h.first,p.viewFrom)),p.viewTo>O&&p.viewTo-O<20&&(O=Math.min(m,p.viewTo)),Yi&&(S=Ec(a.doc,S),O=Rp(a.doc,O));var A=S!=p.viewFrom||O!=p.viewTo||p.lastWrapHeight!=u.wrapperHeight||p.lastWrapWidth!=u.wrapperWidth;iE(a,S,O),p.viewOffset=Ki(Xe(a.doc,p.viewFrom)),a.display.mover.style.top=p.viewOffset+"px";var L=ov(a);if(!A&&L==0&&!u.force&&p.renderedView==p.view&&(p.updateLineNumbers==null||p.updateLineNumbers>=p.viewTo))return!1;var F=_E(a);return L>4&&(p.lineDiv.style.display="none"),xE(a,p.updateLineNumbers,u.dims),L>4&&(p.lineDiv.style.display=""),p.renderedView=p.view,bE(F),T(p.cursorDiv),T(p.selectionDiv),p.gutters.style.height=p.sizer.style.minHeight=0,A&&(p.lastWrapHeight=u.wrapperHeight,p.lastWrapWidth=u.wrapperWidth,Bs(a,400)),p.updateLineNumbers=null,!0}function pv(a,u){for(var p=u.viewport,h=!0;;h=!1){if(!h||!a.options.lineWrapping||u.oldDisplayWidth==Po(a)){if(p&&p.top!=null&&(p={top:Math.min(a.doc.height+Mc(a.display)-Nc(a),p.top)}),u.visible=cu(a.display,a.doc,p),u.visible.from>=a.display.viewFrom&&u.visible.to<=a.display.viewTo)break}else h&&(u.visible=cu(a.display,a.doc,p));if(!Uc(a,u))break;du(a);var m=Rs(a);Ds(a),ba(a,m),Gc(a,m),u.force=!1}u.signal(a,"update",a),(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)&&(u.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo)}function Vc(a,u){var p=new hu(a,u);if(Uc(a,p)){du(a),pv(a,p);var h=Rs(a);Ds(a),ba(a,h),Gc(a,h),p.finish()}}function xE(a,u,p){var h=a.display,m=a.options.lineNumbers,S=h.lineDiv,O=S.firstChild;function A(Le){var He=Le.nextSibling;return f&&R&&a.display.currentWheelTarget==Le?Le.style.display="none":Le.parentNode.removeChild(Le),He}for(var L=h.view,F=h.viewFrom,te=0;te<L.length;te++){var ie=L[te];if(!ie.hidden)if(!ie.node||ie.node.parentNode!=S){var ge=YS(a,ie,F,p);S.insertBefore(ge,O)}else{for(;O!=ie.node;)O=A(O);var fe=m&&u!=null&&u<=F&&ie.lineNumber;ie.changes&&(Ie(ie.changes,"gutter")>-1&&(fe=!1),$p(a,ie,F,p)),fe&&(T(ie.lineNumber),ie.lineNumber.appendChild(document.createTextNode(Ce(a.options,F)))),O=ie.node.nextSibling}F+=ie.size}for(;O;)O=A(O)}function Xc(a){var u=a.gutters.offsetWidth;a.sizer.style.marginLeft=u+"px",Wn(a,"gutterChanged",a)}function Gc(a,u){a.display.sizer.style.minHeight=u.docHeight+"px",a.display.heightForcer.style.top=u.docHeight+"px",a.display.gutters.style.height=u.docHeight+a.display.barHeight+Di(a)+"px"}function vv(a){var u=a.display,p=u.view;if(!(!u.alignWidgets&&(!u.gutters.firstChild||!a.options.fixedGutter))){for(var h=Ic(u)-u.scroller.scrollLeft+a.doc.scrollLeft,m=u.gutters.offsetWidth,S=h+"px",O=0;O<p.length;O++)if(!p[O].hidden){a.options.fixedGutter&&(p[O].gutter&&(p[O].gutter.style.left=S),p[O].gutterBackground&&(p[O].gutterBackground.style.left=S));var A=p[O].alignable;if(A)for(var L=0;L<A.length;L++)A[L].style.left=S}a.options.fixedGutter&&(u.gutters.style.left=h+m+"px")}}function gv(a){if(!a.options.lineNumbers)return!1;var u=a.doc,p=Ce(a.options,u.first+u.size-1),h=a.display;if(p.length!=h.lineNumChars){var m=h.measure.appendChild(B("div",[B("div",p)],"CodeMirror-linenumber CodeMirror-gutter-elt")),S=m.firstChild.offsetWidth,O=m.offsetWidth-S;return h.lineGutter.style.width="",h.lineNumInnerWidth=Math.max(S,h.lineGutter.offsetWidth-O)+1,h.lineNumWidth=h.lineNumInnerWidth+O,h.lineNumChars=h.lineNumInnerWidth?p.length:-1,h.lineGutter.style.width=h.lineNumWidth+"px",Xc(a.display),!0}return!1}function Yc(a,u){for(var p=[],h=!1,m=0;m<a.length;m++){var S=a[m],O=null;if(typeof S!="string"&&(O=S.style,S=S.className),S=="CodeMirror-linenumbers")if(u)h=!0;else continue;p.push({className:S,style:O})}return u&&!h&&p.push({className:"CodeMirror-linenumbers",style:null}),p}function mv(a){var u=a.gutters,p=a.gutterSpecs;T(u),a.lineGutter=null;for(var h=0;h<p.length;++h){var m=p[h],S=m.className,O=m.style,A=u.appendChild(B("div",null,"CodeMirror-gutter "+S));O&&(A.style.cssText=O),S=="CodeMirror-linenumbers"&&(a.lineGutter=A,A.style.width=(a.lineNumWidth||1)+"px")}u.style.display=p.length?"":"none",Xc(a)}function js(a){mv(a.display),gr(a),vv(a)}function wE(a,u,p,h){var m=this;this.input=p,m.scrollbarFiller=B("div",null,"CodeMirror-scrollbar-filler"),m.scrollbarFiller.setAttribute("cm-not-content","true"),m.gutterFiller=B("div",null,"CodeMirror-gutter-filler"),m.gutterFiller.setAttribute("cm-not-content","true"),m.lineDiv=pe("div",null,"CodeMirror-code"),m.selectionDiv=B("div",null,null,"position: relative; z-index: 1"),m.cursorDiv=B("div",null,"CodeMirror-cursors"),m.measure=B("div",null,"CodeMirror-measure"),m.lineMeasure=B("div",null,"CodeMirror-measure"),m.lineSpace=pe("div",[m.measure,m.lineMeasure,m.selectionDiv,m.cursorDiv,m.lineDiv],null,"position: relative; outline: none");var S=pe("div",[m.lineSpace],"CodeMirror-lines");m.mover=B("div",[S],null,"position: relative"),m.sizer=B("div",[m.mover],"CodeMirror-sizer"),m.sizerWidth=null,m.heightForcer=B("div",null,null,"position: absolute; height: "+Fe+"px; width: 1px;"),m.gutters=B("div",null,"CodeMirror-gutters"),m.lineGutter=null,m.scroller=B("div",[m.sizer,m.heightForcer,m.gutters],"CodeMirror-scroll"),m.scroller.setAttribute("tabIndex","-1"),m.wrapper=B("div",[m.scrollbarFiller,m.gutterFiller,m.scroller],"CodeMirror"),g&&y>=105&&(m.wrapper.style.clipPath="inset(0px)"),m.wrapper.setAttribute("translate","no"),d&&c<8&&(m.gutters.style.zIndex=-1,m.scroller.style.paddingRight=0),!f&&!(i&&D)&&(m.scroller.draggable=!0),a&&(a.appendChild?a.appendChild(m.wrapper):a(m.wrapper)),m.viewFrom=m.viewTo=u.first,m.reportedViewFrom=m.reportedViewTo=u.first,m.view=[],m.renderedView=null,m.externalMeasured=null,m.viewOffset=0,m.lastWrapHeight=m.lastWrapWidth=0,m.updateLineNumbers=null,m.nativeBarWidth=m.barHeight=m.barWidth=0,m.scrollbarsClipped=!1,m.lineNumWidth=m.lineNumInnerWidth=m.lineNumChars=null,m.alignWidgets=!1,m.cachedCharWidth=m.cachedTextHeight=m.cachedPaddingH=null,m.maxLine=null,m.maxLineLength=0,m.maxLineChanged=!1,m.wheelDX=m.wheelDY=m.wheelStartX=m.wheelStartY=null,m.shift=!1,m.selForContextMenu=null,m.activeTouch=null,m.gutterSpecs=Yc(h.gutters,h.lineNumbers),mv(m),p.init(m)}var pu=0,Ji=null;d?Ji=-.53:i?Ji=15:g?Ji=-.7:x&&(Ji=-1/3);function yv(a){var u=a.wheelDeltaX,p=a.wheelDeltaY;return u==null&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(u=a.detail),p==null&&a.detail&&a.axis==a.VERTICAL_AXIS?p=a.detail:p==null&&(p=a.wheelDelta),{x:u,y:p}}function SE(a){var u=yv(a);return u.x*=Ji,u.y*=Ji,u}function _v(a,u){g&&y==102&&(a.display.chromeScrollHack==null?a.display.sizer.style.pointerEvents="none":clearTimeout(a.display.chromeScrollHack),a.display.chromeScrollHack=setTimeout(function(){a.display.chromeScrollHack=null,a.display.sizer.style.pointerEvents=""},100));var p=yv(u),h=p.x,m=p.y,S=Ji;u.deltaMode===0&&(h=u.deltaX,m=u.deltaY,S=1);var O=a.display,A=O.scroller,L=A.scrollWidth>A.clientWidth,F=A.scrollHeight>A.clientHeight;if(h&&L||m&&F){if(m&&R&&f){e:for(var te=u.target,ie=O.view;te!=A;te=te.parentNode)for(var ge=0;ge<ie.length;ge++)if(ie[ge].node==te){a.display.currentWheelTarget=te;break e}}if(h&&!i&&!b&&S!=null){m&&F&&Ps(a,Math.max(0,A.scrollTop+m*S)),jo(a,Math.max(0,A.scrollLeft+h*S)),(!m||m&&F)&&vt(u),O.wheelStartX=null;return}if(m&&S!=null){var fe=m*S,Le=a.doc.scrollTop,He=Le+O.wrapper.clientHeight;fe<0?Le=Math.max(0,Le+fe-50):He=Math.min(a.doc.height,He+fe+50),Vc(a,{top:Le,bottom:He})}pu<20&&u.deltaMode!==0&&(O.wheelStartX==null?(O.wheelStartX=A.scrollLeft,O.wheelStartY=A.scrollTop,O.wheelDX=h,O.wheelDY=m,setTimeout(function(){if(O.wheelStartX!=null){var Qe=A.scrollLeft-O.wheelStartX,at=A.scrollTop-O.wheelStartY,ft=at&&O.wheelDY&&at/O.wheelDY||Qe&&O.wheelDX&&Qe/O.wheelDX;O.wheelStartX=O.wheelStartY=null,ft&&(Ji=(Ji*pu+ft)/(pu+1),++pu)}},200)):(O.wheelDX+=h,O.wheelDY+=m))}}var Ur=function(a,u){this.ranges=a,this.primIndex=u};Ur.prototype.primary=function(){return this.ranges[this.primIndex]},Ur.prototype.equals=function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var u=0;u<this.ranges.length;u++){var p=this.ranges[u],h=a.ranges[u];if(!nt(p.anchor,h.anchor)||!nt(p.head,h.head))return!1}return!0},Ur.prototype.deepCopy=function(){for(var a=[],u=0;u<this.ranges.length;u++)a[u]=new sn(mt(this.ranges[u].anchor),mt(this.ranges[u].head));return new Ur(a,this.primIndex)},Ur.prototype.somethingSelected=function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},Ur.prototype.contains=function(a,u){u||(u=a);for(var p=0;p<this.ranges.length;p++){var h=this.ranges[p];if(be(u,h.from())>=0&&be(a,h.to())<=0)return p}return-1};var sn=function(a,u){this.anchor=a,this.head=u};sn.prototype.from=function(){return On(this.anchor,this.head)},sn.prototype.to=function(){return Lt(this.anchor,this.head)},sn.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function di(a,u,p){var h=a&&a.options.selectionsMayTouch,m=u[p];u.sort(function(ge,fe){return be(ge.from(),fe.from())}),p=Ie(u,m);for(var S=1;S<u.length;S++){var O=u[S],A=u[S-1],L=be(A.to(),O.from());if(h&&!O.empty()?L>0:L>=0){var F=On(A.from(),O.from()),te=Lt(A.to(),O.to()),ie=A.empty()?O.from()==O.head:A.from()==A.head;S<=p&&--p,u.splice(--S,2,new sn(ie?te:F,ie?F:te))}}return new Ur(u,p)}function co(a,u){return new Ur([new sn(a,u||a)],0)}function fo(a){return a.text?ve(a.from.line+a.text.length-1,M(a.text).length+(a.text.length==1?a.from.ch:0)):a.to}function bv(a,u){if(be(a,u.from)<0)return a;if(be(a,u.to)<=0)return fo(u);var p=a.line+u.text.length-(u.to.line-u.from.line)-1,h=a.ch;return a.line==u.to.line&&(h+=fo(u).ch-u.to.ch),ve(p,h)}function Kc(a,u){for(var p=[],h=0;h<a.sel.ranges.length;h++){var m=a.sel.ranges[h];p.push(new sn(bv(m.anchor,u),bv(m.head,u)))}return di(a.cm,p,a.sel.primIndex)}function xv(a,u,p){return a.line==u.line?ve(p.line,a.ch-u.ch+p.ch):ve(p.line+(a.line-u.line),a.ch)}function EE(a,u,p){for(var h=[],m=ve(a.first,0),S=m,O=0;O<u.length;O++){var A=u[O],L=xv(A.from,m,S),F=xv(fo(A),m,S);if(m=A.to,S=F,p=="around"){var te=a.sel.ranges[O],ie=be(te.head,te.anchor)<0;h[O]=new sn(ie?F:L,ie?L:F)}else h[O]=new sn(L,L)}return new Ur(h,a.sel.primIndex)}function qc(a){a.doc.mode=qr(a.options,a.doc.modeOption),Hs(a)}function Hs(a){a.doc.iter(function(u){u.stateAfter&&(u.stateAfter=null),u.styles&&(u.styles=null)}),a.doc.modeFrontier=a.doc.highlightFrontier=a.doc.first,Bs(a,100),a.state.modeGen++,a.curOp&&gr(a)}function wv(a,u){return u.from.ch==0&&u.to.ch==0&&M(u.text)==""&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Jc(a,u,p,h){function m(ft){return p?p[ft]:null}function S(ft,st,gt){DS(ft,st,gt,h),Wn(ft,"change",ft,u)}function O(ft,st){for(var gt=[],At=ft;At<st;++At)gt.push(new ha(F[At],m(At),h));return gt}var A=u.from,L=u.to,F=u.text,te=Xe(a,A.line),ie=Xe(a,L.line),ge=M(F),fe=m(F.length-1),Le=L.line-A.line;if(u.full)a.insert(0,O(0,F.length)),a.remove(F.length,a.size-F.length);else if(wv(a,u)){var He=O(0,F.length-1);S(ie,ie.text,fe),Le&&a.remove(A.line,Le),He.length&&a.insert(A.line,He)}else if(te==ie)if(F.length==1)S(te,te.text.slice(0,A.ch)+ge+te.text.slice(L.ch),fe);else{var Qe=O(1,F.length-1);Qe.push(new ha(ge+te.text.slice(L.ch),fe,h)),S(te,te.text.slice(0,A.ch)+F[0],m(0)),a.insert(A.line+1,Qe)}else if(F.length==1)S(te,te.text.slice(0,A.ch)+F[0]+ie.text.slice(L.ch),m(0)),a.remove(A.line+1,Le);else{S(te,te.text.slice(0,A.ch)+F[0],m(0)),S(ie,ge+ie.text.slice(L.ch),fe);var at=O(1,F.length-1);Le>1&&a.remove(A.line+1,Le-1),a.insert(A.line+1,at)}Wn(a,"change",a,u)}function ho(a,u,p){function h(m,S,O){if(m.linked)for(var A=0;A<m.linked.length;++A){var L=m.linked[A];if(L.doc!=S){var F=O&&L.sharedHist;p&&!F||(u(L.doc,F),h(L.doc,m,F))}}}h(a,null,!0)}function Sv(a,u){if(u.cm)throw new Error("This document is already in use.");a.doc=u,u.cm=a,Bc(a),qc(a),Ev(a),a.options.direction=u.direction,a.options.lineWrapping||Oc(a),a.options.mode=u.modeOption,gr(a)}function Ev(a){(a.doc.direction=="rtl"?Oe:ee)(a.display.lineDiv,"CodeMirror-rtl")}function CE(a){Lr(a,function(){Ev(a),gr(a)})}function vu(a){this.done=[],this.undone=[],this.undoDepth=a?a.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a?a.maxGeneration:1}function Zc(a,u){var p={from:mt(u.from),to:fo(u),text:Ft(a,u.from,u.to)};return kv(a,p,u.from.line,u.to.line+1),ho(a,function(h){return kv(h,p,u.from.line,u.to.line+1)},!0),p}function Cv(a){for(;a.length;){var u=M(a);if(u.ranges)a.pop();else break}}function OE(a,u){if(u)return Cv(a.done),M(a.done);if(a.done.length&&!M(a.done).ranges)return M(a.done);if(a.done.length>1&&!a.done[a.done.length-2].ranges)return a.done.pop(),M(a.done)}function Ov(a,u,p,h){var m=a.history;m.undone.length=0;var S=+new Date,O,A;if((m.lastOp==h||m.lastOrigin==u.origin&&u.origin&&(u.origin.charAt(0)=="+"&&m.lastModTime>S-(a.cm?a.cm.options.historyEventDelay:500)||u.origin.charAt(0)=="*"))&&(O=OE(m,m.lastOp==h)))A=M(O.changes),be(u.from,u.to)==0&&be(u.from,A.to)==0?A.to=fo(u):O.changes.push(Zc(a,u));else{var L=M(m.done);for((!L||!L.ranges)&&gu(a.sel,m.done),O={changes:[Zc(a,u)],generation:m.generation},m.done.push(O);m.done.length>m.undoDepth;)m.done.shift(),m.done[0].ranges||m.done.shift()}m.done.push(p),m.generation=++m.maxGeneration,m.lastModTime=m.lastSelTime=S,m.lastOp=m.lastSelOp=h,m.lastOrigin=m.lastSelOrigin=u.origin,A||Ze(a,"historyAdded")}function kE(a,u,p,h){var m=u.charAt(0);return m=="*"||m=="+"&&p.ranges.length==h.ranges.length&&p.somethingSelected()==h.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function ME(a,u,p,h){var m=a.history,S=h&&h.origin;p==m.lastSelOp||S&&m.lastSelOrigin==S&&(m.lastModTime==m.lastSelTime&&m.lastOrigin==S||kE(a,S,M(m.done),u))?m.done[m.done.length-1]=u:gu(u,m.done),m.lastSelTime=+new Date,m.lastSelOrigin=S,m.lastSelOp=p,h&&h.clearRedo!==!1&&Cv(m.undone)}function gu(a,u){var p=M(u);p&&p.ranges&&p.equals(a)||u.push(a)}function kv(a,u,p,h){var m=u["spans_"+a.id],S=0;a.iter(Math.max(a.first,p),Math.min(a.first+a.size,h),function(O){O.markedSpans&&((m||(m=u["spans_"+a.id]={}))[S]=O.markedSpans),++S})}function NE(a){if(!a)return null;for(var u,p=0;p<a.length;++p)a[p].marker.explicitlyCleared?u||(u=a.slice(0,p)):u&&u.push(a[p]);return u?u.length?u:null:a}function AE(a,u){var p=u["spans_"+a.id];if(!p)return null;for(var h=[],m=0;m<u.text.length;++m)h.push(NE(p[m]));return h}function Mv(a,u){var p=AE(a,u),h=wc(a,u);if(!p)return h;if(!h)return p;for(var m=0;m<p.length;++m){var S=p[m],O=h[m];if(S&&O)e:for(var A=0;A<O.length;++A){for(var L=O[A],F=0;F<S.length;++F)if(S[F].marker==L.marker)continue e;S.push(L)}else O&&(p[m]=O)}return p}function xa(a,u,p){for(var h=[],m=0;m<a.length;++m){var S=a[m];if(S.ranges){h.push(p?Ur.prototype.deepCopy.call(S):S);continue}var O=S.changes,A=[];h.push({changes:A});for(var L=0;L<O.length;++L){var F=O[L],te=void 0;if(A.push({from:F.from,to:F.to,text:F.text}),u)for(var ie in F)(te=ie.match(/^spans_(\d+)$/))&&Ie(u,Number(te[1]))>-1&&(M(A)[ie]=F[ie],delete F[ie])}}return h}function Qc(a,u,p,h){if(h){var m=a.anchor;if(p){var S=be(u,m)<0;S!=be(p,m)<0?(m=u,u=p):S!=be(u,p)<0&&(u=p)}return new sn(m,u)}else return new sn(p||u,u)}function mu(a,u,p,h,m){m==null&&(m=a.cm&&(a.cm.display.shift||a.extend)),Qn(a,new Ur([Qc(a.sel.primary(),u,p,m)],0),h)}function Nv(a,u,p){for(var h=[],m=a.cm&&(a.cm.display.shift||a.extend),S=0;S<a.sel.ranges.length;S++)h[S]=Qc(a.sel.ranges[S],u[S],null,m);var O=di(a.cm,h,a.sel.primIndex);Qn(a,O,p)}function ef(a,u,p,h){var m=a.sel.ranges.slice(0);m[u]=p,Qn(a,di(a.cm,m,a.sel.primIndex),h)}function Av(a,u,p,h){Qn(a,co(u,p),h)}function TE(a,u,p){var h={ranges:u.ranges,update:function(m){this.ranges=[];for(var S=0;S<m.length;S++)this.ranges[S]=new sn(Bt(a,m[S].anchor),Bt(a,m[S].head))},origin:p&&p.origin};return Ze(a,"beforeSelectionChange",a,h),a.cm&&Ze(a.cm,"beforeSelectionChange",a.cm,h),h.ranges!=u.ranges?di(a.cm,h.ranges,h.ranges.length-1):u}function Tv(a,u,p){var h=a.history.done,m=M(h);m&&m.ranges?(h[h.length-1]=u,yu(a,u,p)):Qn(a,u,p)}function Qn(a,u,p){yu(a,u,p),ME(a,a.sel,a.cm?a.cm.curOp.id:NaN,p)}function yu(a,u,p){(_e(a,"beforeSelectionChange")||a.cm&&_e(a.cm,"beforeSelectionChange"))&&(u=TE(a,u,p));var h=p&&p.bias||(be(u.primary().head,a.sel.primary().head)<0?-1:1);Dv(a,Pv(a,u,h,!0)),!(p&&p.scroll===!1)&&a.cm&&a.cm.getOption("readOnly")!="nocursor"&&_a(a.cm)}function Dv(a,u){u.equals(a.sel)||(a.sel=u,a.cm&&(a.cm.curOp.updateInput=1,a.cm.curOp.selectionChanged=!0,wt(a.cm)),Wn(a,"cursorActivity",a))}function Lv(a){Dv(a,Pv(a,a.sel,null,!1))}function Pv(a,u,p,h){for(var m,S=0;S<u.ranges.length;S++){var O=u.ranges[S],A=u.ranges.length==a.sel.ranges.length&&a.sel.ranges[S],L=_u(a,O.anchor,A&&A.anchor,p,h),F=O.head==O.anchor?L:_u(a,O.head,A&&A.head,p,h);(m||L!=O.anchor||F!=O.head)&&(m||(m=u.ranges.slice(0,S)),m[S]=new sn(L,F))}return m?di(a.cm,m,u.primIndex):u}function wa(a,u,p,h,m){var S=Xe(a,u.line);if(S.markedSpans)for(var O=0;O<S.markedSpans.length;++O){var A=S.markedSpans[O],L=A.marker,F="selectLeft"in L?!L.selectLeft:L.inclusiveLeft,te="selectRight"in L?!L.selectRight:L.inclusiveRight;if((A.from==null||(F?A.from<=u.ch:A.from<u.ch))&&(A.to==null||(te?A.to>=u.ch:A.to>u.ch))){if(m&&(Ze(L,"beforeCursorEnter"),L.explicitlyCleared))if(S.markedSpans){--O;continue}else break;if(!L.atomic)continue;if(p){var ie=L.find(h<0?1:-1),ge=void 0;if((h<0?te:F)&&(ie=Rv(a,ie,-h,ie&&ie.line==u.line?S:null)),ie&&ie.line==u.line&&(ge=be(ie,p))&&(h<0?ge<0:ge>0))return wa(a,ie,u,h,m)}var fe=L.find(h<0?-1:1);return(h<0?F:te)&&(fe=Rv(a,fe,h,fe.line==u.line?S:null)),fe?wa(a,fe,u,h,m):null}}return u}function _u(a,u,p,h,m){var S=h||1,O=wa(a,u,p,S,m)||!m&&wa(a,u,p,S,!0)||wa(a,u,p,-S,m)||!m&&wa(a,u,p,-S,!0);return O||(a.cantEdit=!0,ve(a.first,0))}function Rv(a,u,p,h){return p<0&&u.ch==0?u.line>a.first?Bt(a,ve(u.line-1)):null:p>0&&u.ch==(h||Xe(a,u.line)).text.length?u.line<a.first+a.size-1?ve(u.line+1,0):null:new ve(u.line,u.ch+p)}function Iv(a){a.setSelection(ve(a.firstLine(),0),ve(a.lastLine()),lt)}function Bv(a,u,p){var h={canceled:!1,from:u.from,to:u.to,text:u.text,origin:u.origin,cancel:function(){return h.canceled=!0}};return p&&(h.update=function(m,S,O,A){m&&(h.from=Bt(a,m)),S&&(h.to=Bt(a,S)),O&&(h.text=O),A!==void 0&&(h.origin=A)}),Ze(a,"beforeChange",a,h),a.cm&&Ze(a.cm,"beforeChange",a.cm,h),h.canceled?(a.cm&&(a.cm.curOp.updateInput=2),null):{from:h.from,to:h.to,text:h.text,origin:h.origin}}function Sa(a,u,p){if(a.cm){if(!a.cm.curOp)return Un(a.cm,Sa)(a,u,p);if(a.cm.state.suppressEdits)return}if(!((_e(a,"beforeChange")||a.cm&&_e(a.cm,"beforeChange"))&&(u=Bv(a,u,!0),!u))){var h=Mp&&!p&&MS(a,u.from,u.to);if(h)for(var m=h.length-1;m>=0;--m)jv(a,{from:h[m].from,to:h[m].to,text:m?[""]:u.text,origin:u.origin});else jv(a,u)}}function jv(a,u){if(!(u.text.length==1&&u.text[0]==""&&be(u.from,u.to)==0)){var p=Kc(a,u);Ov(a,u,p,a.cm?a.cm.curOp.id:NaN),$s(a,u,p,wc(a,u));var h=[];ho(a,function(m,S){!S&&Ie(h,m.history)==-1&&(zv(m.history,u),h.push(m.history)),$s(m,u,null,wc(m,u))})}}function bu(a,u,p){var h=a.cm&&a.cm.state.suppressEdits;if(!(h&&!p)){for(var m=a.history,S,O=a.sel,A=u=="undo"?m.done:m.undone,L=u=="undo"?m.undone:m.done,F=0;F<A.length&&(S=A[F],!(p?S.ranges&&!S.equals(a.sel):!S.ranges));F++);if(F!=A.length){for(m.lastOrigin=m.lastSelOrigin=null;;)if(S=A.pop(),S.ranges){if(gu(S,L),p&&!S.equals(a.sel)){Qn(a,S,{clearRedo:!1});return}O=S}else if(h){A.push(S);return}else break;var te=[];gu(O,L),L.push({changes:te,generation:m.generation}),m.generation=S.generation||++m.maxGeneration;for(var ie=_e(a,"beforeChange")||a.cm&&_e(a.cm,"beforeChange"),ge=function(He){var Qe=S.changes[He];if(Qe.origin=u,ie&&!Bv(a,Qe,!1))return A.length=0,{};te.push(Zc(a,Qe));var at=He?Kc(a,Qe):M(A);$s(a,Qe,at,Mv(a,Qe)),!He&&a.cm&&a.cm.scrollIntoView({from:Qe.from,to:fo(Qe)});var ft=[];ho(a,function(st,gt){!gt&&Ie(ft,st.history)==-1&&(zv(st.history,Qe),ft.push(st.history)),$s(st,Qe,null,Mv(st,Qe))})},fe=S.changes.length-1;fe>=0;--fe){var Le=ge(fe);if(Le)return Le.v}}}}function Hv(a,u){if(u!=0&&(a.first+=u,a.sel=new Ur(H(a.sel.ranges,function(m){return new sn(ve(m.anchor.line+u,m.anchor.ch),ve(m.head.line+u,m.head.ch))}),a.sel.primIndex),a.cm)){gr(a.cm,a.first,a.first-u,u);for(var p=a.cm.display,h=p.viewFrom;h<p.viewTo;h++)lo(a.cm,h,"gutter")}}function $s(a,u,p,h){if(a.cm&&!a.cm.curOp)return Un(a.cm,$s)(a,u,p,h);if(u.to.line<a.first){Hv(a,u.text.length-1-(u.to.line-u.from.line));return}if(!(u.from.line>a.lastLine())){if(u.from.line<a.first){var m=u.text.length-1-(a.first-u.from.line);Hv(a,m),u={from:ve(a.first,0),to:ve(u.to.line+m,u.to.ch),text:[M(u.text)],origin:u.origin}}var S=a.lastLine();u.to.line>S&&(u={from:u.from,to:ve(S,Xe(a,S).text.length),text:[u.text[0]],origin:u.origin}),u.removed=Ft(a,u.from,u.to),p||(p=Kc(a,u)),a.cm?DE(a.cm,u,h):Jc(a,u,h),yu(a,p,lt),a.cantEdit&&_u(a,ve(a.firstLine(),0))&&(a.cantEdit=!1)}}function DE(a,u,p){var h=a.doc,m=a.display,S=u.from,O=u.to,A=!1,L=S.line;a.options.lineWrapping||(L=N(li(Xe(h,S.line))),h.iter(L,O.line+1,function(fe){if(fe==m.maxLine)return A=!0,!0})),h.sel.contains(u.from,u.to)>-1&&wt(a),Jc(h,u,p,iv(a)),a.options.lineWrapping||(h.iter(L,S.line+u.text.length,function(fe){var Le=ru(fe);Le>m.maxLineLength&&(m.maxLine=fe,m.maxLineLength=Le,m.maxLineChanged=!0,A=!1)}),A&&(a.curOp.updateMaxLine=!0)),xS(h,S.line),Bs(a,400);var F=u.text.length-(O.line-S.line)-1;u.full?gr(a):S.line==O.line&&u.text.length==1&&!wv(a.doc,u)?lo(a,S.line,"text"):gr(a,S.line,O.line+1,F);var te=_e(a,"changes"),ie=_e(a,"change");if(ie||te){var ge={from:S,to:O,text:u.text,removed:u.removed,origin:u.origin};ie&&Wn(a,"change",a,ge),te&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(ge)}a.display.selForContextMenu=null}function Ea(a,u,p,h,m){var S;h||(h=p),be(h,p)<0&&(S=[h,p],p=S[0],h=S[1]),typeof u=="string"&&(u=a.splitLines(u)),Sa(a,{from:p,to:h,text:u,origin:m})}function $v(a,u,p,h){p<a.line?a.line+=h:u<a.line&&(a.line=u,a.ch=0)}function Fv(a,u,p,h){for(var m=0;m<a.length;++m){var S=a[m],O=!0;if(S.ranges){S.copied||(S=a[m]=S.deepCopy(),S.copied=!0);for(var A=0;A<S.ranges.length;A++)$v(S.ranges[A].anchor,u,p,h),$v(S.ranges[A].head,u,p,h);continue}for(var L=0;L<S.changes.length;++L){var F=S.changes[L];if(p<F.from.line)F.from=ve(F.from.line+h,F.from.ch),F.to=ve(F.to.line+h,F.to.ch);else if(u<=F.to.line){O=!1;break}}O||(a.splice(0,m+1),m=0)}}function zv(a,u){var p=u.from.line,h=u.to.line,m=u.text.length-(h-p)-1;Fv(a.done,p,h,m),Fv(a.undone,p,h,m)}function Fs(a,u,p,h){var m=u,S=u;return typeof u=="number"?S=Xe(a,Os(a,u)):m=N(u),m==null?null:(h(S,m)&&a.cm&&lo(a.cm,m,p),S)}function zs(a){this.lines=a,this.parent=null;for(var u=0,p=0;p<a.length;++p)a[p].parent=this,u+=a[p].height;this.height=u}zs.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,u){for(var p=a,h=a+u;p<h;++p){var m=this.lines[p];this.height-=m.height,LS(m),Wn(m,"delete")}this.lines.splice(a,u)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,u,p){this.height+=p,this.lines=this.lines.slice(0,a).concat(u).concat(this.lines.slice(a));for(var h=0;h<u.length;++h)u[h].parent=this},iterN:function(a,u,p){for(var h=a+u;a<h;++a)if(p(this.lines[a]))return!0}};function Ws(a){this.children=a;for(var u=0,p=0,h=0;h<a.length;++h){var m=a[h];u+=m.chunkSize(),p+=m.height,m.parent=this}this.size=u,this.height=p,this.parent=null}Ws.prototype={chunkSize:function(){return this.size},removeInner:function(a,u){this.size-=u;for(var p=0;p<this.children.length;++p){var h=this.children[p],m=h.chunkSize();if(a<m){var S=Math.min(u,m-a),O=h.height;if(h.removeInner(a,S),this.height-=O-h.height,m==S&&(this.children.splice(p--,1),h.parent=null),(u-=S)==0)break;a=0}else a-=m}if(this.size-u<25&&(this.children.length>1||!(this.children[0]instanceof zs))){var A=[];this.collapse(A),this.children=[new zs(A)],this.children[0].parent=this}},collapse:function(a){for(var u=0;u<this.children.length;++u)this.children[u].collapse(a)},insertInner:function(a,u,p){this.size+=u.length,this.height+=p;for(var h=0;h<this.children.length;++h){var m=this.children[h],S=m.chunkSize();if(a<=S){if(m.insertInner(a,u,p),m.lines&&m.lines.length>50){for(var O=m.lines.length%25+25,A=O;A<m.lines.length;){var L=new zs(m.lines.slice(A,A+=25));m.height-=L.height,this.children.splice(++h,0,L),L.parent=this}m.lines=m.lines.slice(0,O),this.maybeSpill()}break}a-=S}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var u=a.children.splice(a.children.length-5,5),p=new Ws(u);if(a.parent){a.size-=p.size,a.height-=p.height;var m=Ie(a.parent.children,a);a.parent.children.splice(m+1,0,p)}else{var h=new Ws(a.children);h.parent=a,a.children=[h,p],a=h}p.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,u,p){for(var h=0;h<this.children.length;++h){var m=this.children[h],S=m.chunkSize();if(a<S){var O=Math.min(u,S-a);if(m.iterN(a,O,p))return!0;if((u-=O)==0)break;a=0}else a-=S}}};var Us=function(a,u,p){if(p)for(var h in p)p.hasOwnProperty(h)&&(this[h]=p[h]);this.doc=a,this.node=u};Us.prototype.clear=function(){var a=this.doc.cm,u=this.line.widgets,p=this.line,h=N(p);if(!(h==null||!u)){for(var m=0;m<u.length;++m)u[m]==this&&u.splice(m--,1);u.length||(p.widgets=null);var S=As(this);J(p,Math.max(0,p.height-S)),a&&(Lr(a,function(){Wv(a,p,-S),lo(a,h,"widget")}),Wn(a,"lineWidgetCleared",a,this,h))}},Us.prototype.changed=function(){var a=this,u=this.height,p=this.doc.cm,h=this.line;this.height=null;var m=As(this)-u;m&&(so(this.doc,h)||J(h,h.height+m),p&&Lr(p,function(){p.curOp.forceUpdate=!0,Wv(p,h,m),Wn(p,"lineWidgetChanged",p,a,N(h))}))},Ue(Us);function Wv(a,u,p){Ki(u)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Wc(a,p)}function LE(a,u,p,h){var m=new Us(a,p,h),S=a.cm;return S&&m.noHScroll&&(S.display.alignWidgets=!0),Fs(a,u,"widget",function(O){var A=O.widgets||(O.widgets=[]);if(m.insertAt==null?A.push(m):A.splice(Math.min(A.length,Math.max(0,m.insertAt)),0,m),m.line=O,S&&!so(a,O)){var L=Ki(O)<a.scrollTop;J(O,O.height+As(m)),L&&Wc(S,m.height),S.curOp.forceUpdate=!0}return!0}),S&&Wn(S,"lineWidgetAdded",S,m,typeof u=="number"?u:N(u)),m}var Uv=0,po=function(a,u){this.lines=[],this.type=u,this.doc=a,this.id=++Uv};po.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,u=a&&!a.curOp;if(u&&$o(a),_e(this,"clear")){var p=this.find();p&&Wn(this,"clear",p.from,p.to)}for(var h=null,m=null,S=0;S<this.lines.length;++S){var O=this.lines[S],A=ks(O.markedSpans,this);a&&!this.collapsed?lo(a,N(O),"text"):a&&(A.to!=null&&(m=N(O)),A.from!=null&&(h=N(O))),O.markedSpans=ES(O.markedSpans,A),A.from==null&&this.collapsed&&!so(this.doc,O)&&a&&J(O,ga(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var L=0;L<this.lines.length;++L){var F=li(this.lines[L]),te=ru(F);te>a.display.maxLineLength&&(a.display.maxLine=F,a.display.maxLineLength=te,a.display.maxLineChanged=!0)}h!=null&&a&&this.collapsed&&gr(a,h,m+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Lv(a.doc)),a&&Wn(a,"markerCleared",a,this,h,m),u&&Fo(a),this.parent&&this.parent.clear()}},po.prototype.find=function(a,u){a==null&&this.type=="bookmark"&&(a=1);for(var p,h,m=0;m<this.lines.length;++m){var S=this.lines[m],O=ks(S.markedSpans,this);if(O.from!=null&&(p=ve(u?S:N(S),O.from),a==-1))return p;if(O.to!=null&&(h=ve(u?S:N(S),O.to),a==1))return h}return p&&{from:p,to:h}},po.prototype.changed=function(){var a=this,u=this.find(-1,!0),p=this,h=this.doc.cm;!u||!h||Lr(h,function(){var m=u.line,S=N(u.line),O=Ac(h,S);if(O&&(qp(O),h.curOp.selectionChanged=h.curOp.forceUpdate=!0),h.curOp.updateMaxLine=!0,!so(p.doc,m)&&p.height!=null){var A=p.height;p.height=null;var L=As(p)-A;L&&J(m,m.height+L)}Wn(h,"markerChanged",h,a)})},po.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var u=this.doc.cm.curOp;(!u.maybeHiddenMarkers||Ie(u.maybeHiddenMarkers,this)==-1)&&(u.maybeUnhiddenMarkers||(u.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},po.prototype.detachLine=function(a){if(this.lines.splice(Ie(this.lines,a),1),!this.lines.length&&this.doc.cm){var u=this.doc.cm.curOp;(u.maybeHiddenMarkers||(u.maybeHiddenMarkers=[])).push(this)}},Ue(po);function Ca(a,u,p,h,m){if(h&&h.shared)return PE(a,u,p,h,m);if(a.cm&&!a.cm.curOp)return Un(a.cm,Ca)(a,u,p,h,m);var S=new po(a,m),O=be(u,p);if(h&&de(h,S,!1),O>0||O==0&&S.clearWhenEmpty!==!1)return S;if(S.replacedWith&&(S.collapsed=!0,S.widgetNode=pe("span",[S.replacedWith],"CodeMirror-widget"),h.handleMouseEvents||S.widgetNode.setAttribute("cm-ignore-events","true"),h.insertLeft&&(S.widgetNode.insertLeft=!0)),S.collapsed){if(Pp(a,u.line,u,p,S)||u.line!=p.line&&Pp(a,p.line,u,p,S))throw new Error("Inserting collapsed marker partially overlapping an existing one");SS()}S.addToHistory&&Ov(a,{from:u,to:p,origin:"markText"},a.sel,NaN);var A=u.line,L=a.cm,F;if(a.iter(A,p.line+1,function(ie){L&&S.collapsed&&!L.options.lineWrapping&&li(ie)==L.display.maxLine&&(F=!0),S.collapsed&&A!=u.line&&J(ie,0),CS(ie,new Ql(S,A==u.line?u.ch:null,A==p.line?p.ch:null),a.cm&&a.cm.curOp),++A}),S.collapsed&&a.iter(u.line,p.line+1,function(ie){so(a,ie)&&J(ie,0)}),S.clearOnEnter&&De(S,"beforeCursorEnter",function(){return S.clear()}),S.readOnly&&(wS(),(a.history.done.length||a.history.undone.length)&&a.clearHistory()),S.collapsed&&(S.id=++Uv,S.atomic=!0),L){if(F&&(L.curOp.updateMaxLine=!0),S.collapsed)gr(L,u.line,p.line+1);else if(S.className||S.startStyle||S.endStyle||S.css||S.attributes||S.title)for(var te=u.line;te<=p.line;te++)lo(L,te,"text");S.atomic&&Lv(L.doc),Wn(L,"markerAdded",L,S)}return S}var Vs=function(a,u){this.markers=a,this.primary=u;for(var p=0;p<a.length;++p)a[p].parent=this};Vs.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Wn(this,"clear")}},Vs.prototype.find=function(a,u){return this.primary.find(a,u)},Ue(Vs);function PE(a,u,p,h,m){h=de(h),h.shared=!1;var S=[Ca(a,u,p,h,m)],O=S[0],A=h.widgetNode;return ho(a,function(L){A&&(h.widgetNode=A.cloneNode(!0)),S.push(Ca(L,Bt(L,u),Bt(L,p),h,m));for(var F=0;F<L.linked.length;++F)if(L.linked[F].isParent)return;O=M(S)}),new Vs(S,O)}function Vv(a){return a.findMarks(ve(a.first,0),a.clipPos(ve(a.lastLine())),function(u){return u.parent})}function RE(a,u){for(var p=0;p<u.length;p++){var h=u[p],m=h.find(),S=a.clipPos(m.from),O=a.clipPos(m.to);if(be(S,O)){var A=Ca(a,S,O,h.primary,h.primary.type);h.markers.push(A),A.parent=h}}}function IE(a){for(var u=function(h){var m=a[h],S=[m.primary.doc];ho(m.primary.doc,function(L){return S.push(L)});for(var O=0;O<m.markers.length;O++){var A=m.markers[O];Ie(S,A.doc)==-1&&(A.parent=null,m.markers.splice(O--,1))}},p=0;p<a.length;p++)u(p)}var BE=0,mr=function(a,u,p,h,m){if(!(this instanceof mr))return new mr(a,u,p,h,m);p==null&&(p=0),Ws.call(this,[new zs([new ha("",null)])]),this.first=p,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=p;var S=ve(p,0);this.sel=co(S),this.history=new vu(null),this.id=++BE,this.modeOption=u,this.lineSep=h,this.direction=m=="rtl"?"rtl":"ltr",this.extend=!1,typeof a=="string"&&(a=this.splitLines(a)),Jc(this,{from:S,to:S,text:a}),Qn(this,co(S),lt)};mr.prototype=re(Ws.prototype,{constructor:mr,iter:function(a,u,p){p?this.iterN(a-this.first,u-a,p):this.iterN(this.first,this.first+this.size,a)},insert:function(a,u){for(var p=0,h=0;h<u.length;++h)p+=u[h].height;this.insertInner(a-this.first,u,p)},remove:function(a,u){this.removeInner(a-this.first,u)},getValue:function(a){var u=pn(this,this.first,this.first+this.size);return a===!1?u:u.join(a||this.lineSeparator())},setValue:Vn(function(a){var u=ve(this.first,0),p=this.first+this.size-1;Sa(this,{from:u,to:ve(p,Xe(this,p).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0),this.cm&&Ls(this.cm,0,0),Qn(this,co(u),lt)}),replaceRange:function(a,u,p,h){u=Bt(this,u),p=p?Bt(this,p):u,Ea(this,a,u,p,h)},getRange:function(a,u,p){var h=Ft(this,Bt(this,a),Bt(this,u));return p===!1?h:p===""?h.join(""):h.join(p||this.lineSeparator())},getLine:function(a){var u=this.getLineHandle(a);return u&&u.text},getLineHandle:function(a){if(ce(this,a))return Xe(this,a)},getLineNumber:function(a){return N(a)},getLineHandleVisualStart:function(a){return typeof a=="number"&&(a=Xe(this,a)),li(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return Bt(this,a)},getCursor:function(a){var u=this.sel.primary(),p;return a==null||a=="head"?p=u.head:a=="anchor"?p=u.anchor:a=="end"||a=="to"||a===!1?p=u.to():p=u.from(),p},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Vn(function(a,u,p){Av(this,Bt(this,typeof a=="number"?ve(a,u||0):a),null,p)}),setSelection:Vn(function(a,u,p){Av(this,Bt(this,a),Bt(this,u||a),p)}),extendSelection:Vn(function(a,u,p){mu(this,Bt(this,a),u&&Bt(this,u),p)}),extendSelections:Vn(function(a,u){Nv(this,fa(this,a),u)}),extendSelectionsBy:Vn(function(a,u){var p=H(this.sel.ranges,a);Nv(this,fa(this,p),u)}),setSelections:Vn(function(a,u,p){if(a.length){for(var h=[],m=0;m<a.length;m++)h[m]=new sn(Bt(this,a[m].anchor),Bt(this,a[m].head||a[m].anchor));u==null&&(u=Math.min(a.length-1,this.sel.primIndex)),Qn(this,di(this.cm,h,u),p)}}),addSelection:Vn(function(a,u,p){var h=this.sel.ranges.slice(0);h.push(new sn(Bt(this,a),Bt(this,u||a))),Qn(this,di(this.cm,h,h.length-1),p)}),getSelection:function(a){for(var u=this.sel.ranges,p,h=0;h<u.length;h++){var m=Ft(this,u[h].from(),u[h].to());p=p?p.concat(m):m}return a===!1?p:p.join(a||this.lineSeparator())},getSelections:function(a){for(var u=[],p=this.sel.ranges,h=0;h<p.length;h++){var m=Ft(this,p[h].from(),p[h].to());a!==!1&&(m=m.join(a||this.lineSeparator())),u[h]=m}return u},replaceSelection:function(a,u,p){for(var h=[],m=0;m<this.sel.ranges.length;m++)h[m]=a;this.replaceSelections(h,u,p||"+input")},replaceSelections:Vn(function(a,u,p){for(var h=[],m=this.sel,S=0;S<m.ranges.length;S++){var O=m.ranges[S];h[S]={from:O.from(),to:O.to(),text:this.splitLines(a[S]),origin:p}}for(var A=u&&u!="end"&&EE(this,h,u),L=h.length-1;L>=0;L--)Sa(this,h[L]);A?Tv(this,A):this.cm&&_a(this.cm)}),undo:Vn(function(){bu(this,"undo")}),redo:Vn(function(){bu(this,"redo")}),undoSelection:Vn(function(){bu(this,"undo",!0)}),redoSelection:Vn(function(){bu(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,u=0,p=0,h=0;h<a.done.length;h++)a.done[h].ranges||++u;for(var m=0;m<a.undone.length;m++)a.undone[m].ranges||++p;return{undo:u,redo:p}},clearHistory:function(){var a=this;this.history=new vu(this.history),ho(this,function(u){return u.history=a.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:xa(this.history.done),undone:xa(this.history.undone)}},setHistory:function(a){var u=this.history=new vu(this.history);u.done=xa(a.done.slice(0),null,!0),u.undone=xa(a.undone.slice(0),null,!0)},setGutterMarker:Vn(function(a,u,p){return Fs(this,a,"gutter",function(h){var m=h.gutterMarkers||(h.gutterMarkers={});return m[u]=p,!p&&Se(m)&&(h.gutterMarkers=null),!0})}),clearGutter:Vn(function(a){var u=this;this.iter(function(p){p.gutterMarkers&&p.gutterMarkers[a]&&Fs(u,p,"gutter",function(){return p.gutterMarkers[a]=null,Se(p.gutterMarkers)&&(p.gutterMarkers=null),!0})})}),lineInfo:function(a){var u;if(typeof a=="number"){if(!ce(this,a)||(u=a,a=Xe(this,a),!a))return null}else if(u=N(a),u==null)return null;return{line:u,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:Vn(function(a,u,p){return Fs(this,a,u=="gutter"?"gutter":"class",function(h){var m=u=="text"?"textClass":u=="background"?"bgClass":u=="gutter"?"gutterClass":"wrapClass";if(!h[m])h[m]=p;else{if(q(p).test(h[m]))return!1;h[m]+=" "+p}return!0})}),removeLineClass:Vn(function(a,u,p){return Fs(this,a,u=="gutter"?"gutter":"class",function(h){var m=u=="text"?"textClass":u=="background"?"bgClass":u=="gutter"?"gutterClass":"wrapClass",S=h[m];if(S)if(p==null)h[m]=null;else{var O=S.match(q(p));if(!O)return!1;var A=O.index+O[0].length;h[m]=S.slice(0,O.index)+(!O.index||A==S.length?"":" ")+S.slice(A)||null}else return!1;return!0})}),addLineWidget:Vn(function(a,u,p){return LE(this,a,u,p)}),removeLineWidget:function(a){a.clear()},markText:function(a,u,p){return Ca(this,Bt(this,a),Bt(this,u),p,p&&p.type||"range")},setBookmark:function(a,u){var p={replacedWith:u&&(u.nodeType==null?u.widget:u),insertLeft:u&&u.insertLeft,clearWhenEmpty:!1,shared:u&&u.shared,handleMouseEvents:u&&u.handleMouseEvents};return a=Bt(this,a),Ca(this,a,a,p,"bookmark")},findMarksAt:function(a){a=Bt(this,a);var u=[],p=Xe(this,a.line).markedSpans;if(p)for(var h=0;h<p.length;++h){var m=p[h];(m.from==null||m.from<=a.ch)&&(m.to==null||m.to>=a.ch)&&u.push(m.marker.parent||m.marker)}return u},findMarks:function(a,u,p){a=Bt(this,a),u=Bt(this,u);var h=[],m=a.line;return this.iter(a.line,u.line+1,function(S){var O=S.markedSpans;if(O)for(var A=0;A<O.length;A++){var L=O[A];!(L.to!=null&&m==a.line&&a.ch>=L.to||L.from==null&&m!=a.line||L.from!=null&&m==u.line&&L.from>=u.ch)&&(!p||p(L.marker))&&h.push(L.marker.parent||L.marker)}++m}),h},getAllMarks:function(){var a=[];return this.iter(function(u){var p=u.markedSpans;if(p)for(var h=0;h<p.length;++h)p[h].from!=null&&a.push(p[h].marker)}),a},posFromIndex:function(a){var u,p=this.first,h=this.lineSeparator().length;return this.iter(function(m){var S=m.text.length+h;if(S>a)return u=a,!0;a-=S,++p}),Bt(this,ve(p,u))},indexFromPos:function(a){a=Bt(this,a);var u=a.ch;if(a.line<this.first||a.ch<0)return 0;var p=this.lineSeparator().length;return this.iter(this.first,a.line,function(h){u+=h.text.length+p}),u},copy:function(a){var u=new mr(pn(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return u.scrollTop=this.scrollTop,u.scrollLeft=this.scrollLeft,u.sel=this.sel,u.extend=!1,a&&(u.history.undoDepth=this.history.undoDepth,u.setHistory(this.getHistory())),u},linkedDoc:function(a){a||(a={});var u=this.first,p=this.first+this.size;a.from!=null&&a.from>u&&(u=a.from),a.to!=null&&a.to<p&&(p=a.to);var h=new mr(pn(this,u,p),a.mode||this.modeOption,u,this.lineSep,this.direction);return a.sharedHist&&(h.history=this.history),(this.linked||(this.linked=[])).push({doc:h,sharedHist:a.sharedHist}),h.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],RE(h,Vv(this)),h},unlinkDoc:function(a){if(a instanceof yn&&(a=a.doc),this.linked)for(var u=0;u<this.linked.length;++u){var p=this.linked[u];if(p.doc==a){this.linked.splice(u,1),a.unlinkDoc(this),IE(Vv(this));break}}if(a.history==this.history){var h=[a.id];ho(a,function(m){return h.push(m.id)},!0),a.history=new vu(null),a.history.done=xa(this.history.done,h),a.history.undone=xa(this.history.undone,h)}},iterLinkedDocs:function(a){ho(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):Cn(a)},lineSeparator:function(){return this.lineSep||`
`},setDirection:Vn(function(a){a!="rtl"&&(a="ltr"),a!=this.direction&&(this.direction=a,this.iter(function(u){return u.order=null}),this.cm&&CE(this.cm))})}),mr.prototype.eachLine=mr.prototype.iter;var Xv=0;function jE(a){var u=this;if(Gv(u),!(tt(u,a)||qi(u.display,a))){vt(a),d&&(Xv=+new Date);var p=Io(u,a,!0),h=a.dataTransfer.files;if(!(!p||u.isReadOnly()))if(h&&h.length&&window.FileReader&&window.File)for(var m=h.length,S=Array(m),O=0,A=function(){++O==m&&Un(u,function(){p=Bt(u.doc,p);var fe={from:p,to:p,text:u.doc.splitLines(S.filter(function(Le){return Le!=null}).join(u.doc.lineSeparator())),origin:"paste"};Sa(u.doc,fe),Tv(u.doc,co(Bt(u.doc,p),Bt(u.doc,fo(fe))))})()},L=function(fe,Le){if(u.options.allowDropFileTypes&&Ie(u.options.allowDropFileTypes,fe.type)==-1){A();return}var He=new FileReader;He.onerror=function(){return A()},He.onload=function(){var Qe=He.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(Qe)){A();return}S[Le]=Qe,A()},He.readAsText(fe)},F=0;F<h.length;F++)L(h[F],F);else{if(u.state.draggingText&&u.doc.sel.contains(p)>-1){u.state.draggingText(a),setTimeout(function(){return u.display.input.focus()},20);return}try{var te=a.dataTransfer.getData("Text");if(te){var ie;if(u.state.draggingText&&!u.state.draggingText.copy&&(ie=u.listSelections()),yu(u.doc,co(p,p)),ie)for(var ge=0;ge<ie.length;++ge)Ea(u.doc,"",ie[ge].anchor,ie[ge].head,"drag");u.replaceSelection(te,"around","paste"),u.display.input.focus()}}catch{}}}}function HE(a,u){if(d&&(!a.state.draggingText||+new Date-Xv<100)){Xt(u);return}if(!(tt(a,u)||qi(a.display,u))&&(u.dataTransfer.setData("Text",a.getSelection()),u.dataTransfer.effectAllowed="copyMove",u.dataTransfer.setDragImage&&!x)){var p=B("img",null,null,"position: fixed; left: 0; top: 0;");p.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",b&&(p.width=p.height=1,a.display.wrapper.appendChild(p),p._top=p.offsetTop),u.dataTransfer.setDragImage(p,0,0),b&&p.parentNode.removeChild(p)}}function $E(a,u){var p=Io(a,u);if(p){var h=document.createDocumentFragment();jc(a,p,h),a.display.dragCursor||(a.display.dragCursor=B("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv)),z(a.display.dragCursor,h)}}function Gv(a){a.display.dragCursor&&(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function Yv(a){if(document.getElementsByClassName){for(var u=document.getElementsByClassName("CodeMirror"),p=[],h=0;h<u.length;h++){var m=u[h].CodeMirror;m&&p.push(m)}p.length&&p[0].operation(function(){for(var S=0;S<p.length;S++)a(p[S])})}}var Kv=!1;function FE(){Kv||(zE(),Kv=!0)}function zE(){var a;De(window,"resize",function(){a==null&&(a=setTimeout(function(){a=null,Yv(WE)},100))}),De(window,"blur",function(){return Yv(ya)})}function WE(a){var u=a.display;u.cachedCharWidth=u.cachedTextHeight=u.cachedPaddingH=null,u.scrollbarsClipped=!1,a.setSize()}for(var vo={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Xs=0;Xs<10;Xs++)vo[Xs+48]=vo[Xs+96]=String(Xs);for(var xu=65;xu<=90;xu++)vo[xu]=String.fromCharCode(xu);for(var Gs=1;Gs<=12;Gs++)vo[Gs+111]=vo[Gs+63235]="F"+Gs;var Zi={};Zi.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Zi.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Zi.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Zi.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Zi.default=R?Zi.macDefault:Zi.pcDefault;function UE(a){var u=a.split(/-(?!$)/);a=u[u.length-1];for(var p,h,m,S,O=0;O<u.length-1;O++){var A=u[O];if(/^(cmd|meta|m)$/i.test(A))S=!0;else if(/^a(lt)?$/i.test(A))p=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else throw new Error("Unrecognized modifier name: "+A)}return p&&(a="Alt-"+a),h&&(a="Ctrl-"+a),S&&(a="Cmd-"+a),m&&(a="Shift-"+a),a}function VE(a){var u={};for(var p in a)if(a.hasOwnProperty(p)){var h=a[p];if(/^(name|fallthrough|(de|at)tach)$/.test(p))continue;if(h=="..."){delete a[p];continue}for(var m=H(p.split(" "),UE),S=0;S<m.length;S++){var O=void 0,A=void 0;S==m.length-1?(A=m.join(" "),O=h):(A=m.slice(0,S+1).join(" "),O="...");var L=u[A];if(!L)u[A]=O;else if(L!=O)throw new Error("Inconsistent bindings for "+A)}delete a[p]}for(var F in u)a[F]=u[F];return a}function Oa(a,u,p,h){u=wu(u);var m=u.call?u.call(a,h):u[a];if(m===!1)return"nothing";if(m==="...")return"multi";if(m!=null&&p(m))return"handled";if(u.fallthrough){if(Object.prototype.toString.call(u.fallthrough)!="[object Array]")return Oa(a,u.fallthrough,p,h);for(var S=0;S<u.fallthrough.length;S++){var O=Oa(a,u.fallthrough[S],p,h);if(O)return O}}}function qv(a){var u=typeof a=="string"?a:vo[a.keyCode];return u=="Ctrl"||u=="Alt"||u=="Shift"||u=="Mod"}function Jv(a,u,p){var h=a;return u.altKey&&h!="Alt"&&(a="Alt-"+a),(W?u.metaKey:u.ctrlKey)&&h!="Ctrl"&&(a="Ctrl-"+a),(W?u.ctrlKey:u.metaKey)&&h!="Mod"&&(a="Cmd-"+a),!p&&u.shiftKey&&h!="Shift"&&(a="Shift-"+a),a}function Zv(a,u){if(b&&a.keyCode==34&&a.char)return!1;var p=vo[a.keyCode];return p==null||a.altGraphKey?!1:(a.keyCode==3&&a.code&&(p=a.code),Jv(p,a,u))}function wu(a){return typeof a=="string"?Zi[a]:a}function ka(a,u){for(var p=a.doc.sel.ranges,h=[],m=0;m<p.length;m++){for(var S=u(p[m]);h.length&&be(S.from,M(h).to)<=0;){var O=h.pop();if(be(O.from,S.from)<0){S.from=O.from;break}}h.push(S)}Lr(a,function(){for(var A=h.length-1;A>=0;A--)Ea(a.doc,"",h[A].from,h[A].to,"+delete");_a(a)})}function tf(a,u,p){var h=ct(a.text,u+p,p);return h<0||h>a.text.length?null:h}function nf(a,u,p){var h=tf(a,u.ch,p);return h==null?null:new ve(u.line,h,p<0?"after":"before")}function rf(a,u,p,h,m){if(a){u.doc.direction=="rtl"&&(m=-m);var S=ot(p,u.doc.direction);if(S){var O=m<0?M(S):S[0],A=m<0==(O.level==1),L=A?"after":"before",F;if(O.level>0||u.doc.direction=="rtl"){var te=va(u,p);F=m<0?p.text.length-1:0;var ie=Li(u,te,F).top;F=ht(function(ge){return Li(u,te,ge).top==ie},m<0==(O.level==1)?O.from:O.to-1,F),L=="before"&&(F=tf(p,F,1))}else F=m<0?O.to:O.from;return new ve(h,F,L)}}return new ve(h,m<0?p.text.length:0,m<0?"before":"after")}function XE(a,u,p,h){var m=ot(u,a.doc.direction);if(!m)return nf(u,p,h);p.ch>=u.text.length?(p.ch=u.text.length,p.sticky="before"):p.ch<=0&&(p.ch=0,p.sticky="after");var S=ut(m,p.ch,p.sticky),O=m[S];if(a.doc.direction=="ltr"&&O.level%2==0&&(h>0?O.to>p.ch:O.from<p.ch))return nf(u,p,h);var A=function(at,ft){return tf(u,at instanceof ve?at.ch:at,ft)},L,F=function(at){return a.options.lineWrapping?(L=L||va(a,u),rv(a,u,L,at)):{begin:0,end:u.text.length}},te=F(p.sticky=="before"?A(p,-1):p.ch);if(a.doc.direction=="rtl"||O.level==1){var ie=O.level==1==h<0,ge=A(p,ie?1:-1);if(ge!=null&&(ie?ge<=O.to&&ge<=te.end:ge>=O.from&&ge>=te.begin)){var fe=ie?"before":"after";return new ve(p.line,ge,fe)}}var Le=function(at,ft,st){for(var gt=function(hn,Xn){return Xn?new ve(p.line,A(hn,1),"before"):new ve(p.line,hn,"after")};at>=0&&at<m.length;at+=ft){var At=m[at],Mt=ft>0==(At.level!=1),zt=Mt?st.begin:A(st.end,-1);if(At.from<=zt&&zt<At.to||(zt=Mt?At.from:A(At.to,-1),st.begin<=zt&&zt<st.end))return gt(zt,Mt)}},He=Le(S+h,h,te);if(He)return He;var Qe=h>0?te.end:A(te.begin,-1);return Qe!=null&&!(h>0&&Qe==u.text.length)&&(He=Le(h>0?0:m.length-1,h,F(Qe)),He)?He:null}var Ys={selectAll:Iv,singleSelection:function(a){return a.setSelection(a.getCursor("anchor"),a.getCursor("head"),lt)},killLine:function(a){return ka(a,function(u){if(u.empty()){var p=Xe(a.doc,u.head.line).text.length;return u.head.ch==p&&u.head.line<a.lastLine()?{from:u.head,to:ve(u.head.line+1,0)}:{from:u.head,to:ve(u.head.line,p)}}else return{from:u.from(),to:u.to()}})},deleteLine:function(a){return ka(a,function(u){return{from:ve(u.from().line,0),to:Bt(a.doc,ve(u.to().line+1,0))}})},delLineLeft:function(a){return ka(a,function(u){return{from:ve(u.from().line,0),to:u.from()}})},delWrappedLineLeft:function(a){return ka(a,function(u){var p=a.charCoords(u.head,"div").top+5,h=a.coordsChar({left:0,top:p},"div");return{from:h,to:u.from()}})},delWrappedLineRight:function(a){return ka(a,function(u){var p=a.charCoords(u.head,"div").top+5,h=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:p},"div");return{from:u.from(),to:h}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(ve(a.firstLine(),0))},goDocEnd:function(a){return a.extendSelection(ve(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(u){return Qv(a,u.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(u){return eg(a,u.head)},{origin:"+move",bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(u){return GE(a,u.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:p},"div")},_t)},goLineLeft:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5;return a.coordsChar({left:0,top:p},"div")},_t)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(u){var p=a.cursorCoords(u.head,"div").top+5,h=a.coordsChar({left:0,top:p},"div");return h.ch<a.getLine(h.line).search(/\S/)?eg(a,u.head):h},_t)},goLineUp:function(a){return a.moveV(-1,"line")},goLineDown:function(a){return a.moveV(1,"line")},goPageUp:function(a){return a.moveV(-1,"page")},goPageDown:function(a){return a.moveV(1,"page")},goCharLeft:function(a){return a.moveH(-1,"char")},goCharRight:function(a){return a.moveH(1,"char")},goColumnLeft:function(a){return a.moveH(-1,"column")},goColumnRight:function(a){return a.moveH(1,"column")},goWordLeft:function(a){return a.moveH(-1,"word")},goGroupRight:function(a){return a.moveH(1,"group")},goGroupLeft:function(a){return a.moveH(-1,"group")},goWordRight:function(a){return a.moveH(1,"word")},delCharBefore:function(a){return a.deleteH(-1,"codepoint")},delCharAfter:function(a){return a.deleteH(1,"char")},delWordBefore:function(a){return a.deleteH(-1,"word")},delWordAfter:function(a){return a.deleteH(1,"word")},delGroupBefore:function(a){return a.deleteH(-1,"group")},delGroupAfter:function(a){return a.deleteH(1,"group")},indentAuto:function(a){return a.indentSelection("smart")},indentMore:function(a){return a.indentSelection("add")},indentLess:function(a){return a.indentSelection("subtract")},insertTab:function(a){return a.replaceSelection("	")},insertSoftTab:function(a){for(var u=[],p=a.listSelections(),h=a.options.tabSize,m=0;m<p.length;m++){var S=p[m].from(),O=ke(a.getLine(S.line),S.ch,h);u.push(Q(h-O%h))}a.replaceSelections(u)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){return Lr(a,function(){for(var u=a.listSelections(),p=[],h=0;h<u.length;h++)if(u[h].empty()){var m=u[h].head,S=Xe(a.doc,m.line).text;if(S){if(m.ch==S.length&&(m=new ve(m.line,m.ch-1)),m.ch>0)m=new ve(m.line,m.ch+1),a.replaceRange(S.charAt(m.ch-1)+S.charAt(m.ch-2),ve(m.line,m.ch-2),m,"+transpose");else if(m.line>a.doc.first){var O=Xe(a.doc,m.line-1).text;O&&(m=new ve(m.line,1),a.replaceRange(S.charAt(0)+a.doc.lineSeparator()+O.charAt(O.length-1),ve(m.line-1,O.length-1),m,"+transpose"))}}p.push(new sn(m,m))}a.setSelections(p)})},newlineAndIndent:function(a){return Lr(a,function(){for(var u=a.listSelections(),p=u.length-1;p>=0;p--)a.replaceRange(a.doc.lineSeparator(),u[p].anchor,u[p].head,"+input");u=a.listSelections();for(var h=0;h<u.length;h++)a.indentLine(u[h].from().line,null,!0);_a(a)})},openLine:function(a){return a.replaceSelection(`
`,"start")},toggleOverwrite:function(a){return a.toggleOverwrite()}};function Qv(a,u){var p=Xe(a.doc,u),h=li(p);return h!=p&&(u=N(h)),rf(!0,a,h,u,1)}function GE(a,u){var p=Xe(a.doc,u),h=AS(p);return h!=p&&(u=N(h)),rf(!0,a,p,u,-1)}function eg(a,u){var p=Qv(a,u.line),h=Xe(a.doc,p.line),m=ot(h,a.doc.direction);if(!m||m[0].level==0){var S=Math.max(p.ch,h.text.search(/\S/)),O=u.line==p.line&&u.ch<=S&&u.ch;return ve(p.line,O?0:S,p.sticky)}return p}function Su(a,u,p){if(typeof u=="string"&&(u=Ys[u],!u))return!1;a.display.input.ensurePolled();var h=a.display.shift,m=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),p&&(a.display.shift=!1),m=u(a)!=Ot}finally{a.display.shift=h,a.state.suppressEdits=!1}return m}function YE(a,u,p){for(var h=0;h<a.state.keyMaps.length;h++){var m=Oa(u,a.state.keyMaps[h],p,a);if(m)return m}return a.options.extraKeys&&Oa(u,a.options.extraKeys,p,a)||Oa(u,a.options.keyMap,p,a)}var KE=new Ye;function Ks(a,u,p,h){var m=a.state.keySeq;if(m){if(qv(u))return"handled";if(/\'$/.test(u)?a.state.keySeq=null:KE.set(50,function(){a.state.keySeq==m&&(a.state.keySeq=null,a.display.input.reset())}),tg(a,m+" "+u,p,h))return!0}return tg(a,u,p,h)}function tg(a,u,p,h){var m=YE(a,u,h);return m=="multi"&&(a.state.keySeq=u),m=="handled"&&Wn(a,"keyHandled",a,u,p),(m=="handled"||m=="multi")&&(vt(p),Hc(a)),!!m}function ng(a,u){var p=Zv(u,!0);return p?u.shiftKey&&!a.state.keySeq?Ks(a,"Shift-"+p,u,function(h){return Su(a,h,!0)})||Ks(a,p,u,function(h){if(typeof h=="string"?/^go[A-Z]/.test(h):h.motion)return Su(a,h)}):Ks(a,p,u,function(h){return Su(a,h)}):!1}function qE(a,u,p){return Ks(a,"'"+p+"'",u,function(h){return Su(a,h,!0)})}var of=null;function rg(a){var u=this;if(!(a.target&&a.target!=u.display.input.getField())&&(u.curOp.focus=it(Ge(u)),!tt(u,a))){d&&c<11&&a.keyCode==27&&(a.returnValue=!1);var p=a.keyCode;u.display.shift=p==16||a.shiftKey;var h=ng(u,a);b&&(of=h?p:null,!h&&p==88&&!si&&(R?a.metaKey:a.ctrlKey)&&u.replaceSelection("",null,"cut")),i&&!R&&!h&&p==46&&a.shiftKey&&!a.ctrlKey&&document.execCommand&&document.execCommand("cut"),p==18&&!/\bCodeMirror-crosshair\b/.test(u.display.lineDiv.className)&&JE(u)}}function JE(a){var u=a.display.lineDiv;Oe(u,"CodeMirror-crosshair");function p(h){(h.keyCode==18||!h.altKey)&&(ee(u,"CodeMirror-crosshair"),Ke(document,"keyup",p),Ke(document,"mouseover",p))}De(document,"keyup",p),De(document,"mouseover",p)}function ig(a){a.keyCode==16&&(this.doc.sel.shift=!1),tt(this,a)}function og(a){var u=this;if(!(a.target&&a.target!=u.display.input.getField())&&!(qi(u.display,a)||tt(u,a)||a.ctrlKey&&!a.altKey||R&&a.metaKey)){var p=a.keyCode,h=a.charCode;if(b&&p==of){of=null,vt(a);return}if(!(b&&(!a.which||a.which<10)&&ng(u,a))){var m=String.fromCharCode(h??p);m!="\b"&&(qE(u,a,m)||u.display.input.onKeyPress(a))}}}var ZE=400,af=function(a,u,p){this.time=a,this.pos=u,this.button=p};af.prototype.compare=function(a,u,p){return this.time+ZE>a&&be(u,this.pos)==0&&p==this.button};var qs,Js;function QE(a,u){var p=+new Date;return Js&&Js.compare(p,a,u)?(qs=Js=null,"triple"):qs&&qs.compare(p,a,u)?(Js=new af(p,a,u),qs=null,"double"):(qs=new af(p,a,u),Js=null,"single")}function ag(a){var u=this,p=u.display;if(!(tt(u,a)||p.activeTouch&&p.input.supportsTouch())){if(p.input.ensurePolled(),p.shift=a.shiftKey,qi(p,a)){f||(p.scroller.draggable=!1,setTimeout(function(){return p.scroller.draggable=!0},100));return}if(!sf(u,a)){var h=Io(u,a),m=gn(a),S=h?QE(h,m):"single";G(u).focus(),m==1&&u.state.selectingText&&u.state.selectingText(a),!(h&&eC(u,m,h,S,a))&&(m==1?h?nC(u,h,S,a):Zn(a)==p.scroller&&vt(a):m==2?(h&&mu(u.doc,h),setTimeout(function(){return p.input.focus()},20)):m==3&&(se?u.display.input.onContextMenu(a):$c(u)))}}}function eC(a,u,p,h,m){var S="Click";return h=="double"?S="Double"+S:h=="triple"&&(S="Triple"+S),S=(u==1?"Left":u==2?"Middle":"Right")+S,Ks(a,Jv(S,m),m,function(O){if(typeof O=="string"&&(O=Ys[O]),!O)return!1;var A=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),A=O(a,p)!=Ot}finally{a.state.suppressEdits=!1}return A})}function tC(a,u,p){var h=a.getOption("configureMouse"),m=h?h(a,u,p):{};if(m.unit==null){var S=$?p.shiftKey&&p.metaKey:p.altKey;m.unit=S?"rectangle":u=="single"?"char":u=="double"?"word":"line"}return(m.extend==null||a.doc.extend)&&(m.extend=a.doc.extend||p.shiftKey),m.addNew==null&&(m.addNew=R?p.metaKey:p.ctrlKey),m.moveOnDrag==null&&(m.moveOnDrag=!(R?p.altKey:p.ctrlKey)),m}function nC(a,u,p,h){d?setTimeout(oe(sv,a),0):a.curOp.focus=it(Ge(a));var m=tC(a,p,h),S=a.doc.sel,O;a.options.dragDrop&&Fn&&!a.isReadOnly()&&p=="single"&&(O=S.contains(u))>-1&&(be((O=S.ranges[O]).from(),u)<0||u.xRel>0)&&(be(O.to(),u)>0||u.xRel<0)?rC(a,h,u,m):iC(a,h,u,m)}function rC(a,u,p,h){var m=a.display,S=!1,O=Un(a,function(F){f&&(m.scroller.draggable=!1),a.state.draggingText=!1,a.state.delayingBlurEvent&&(a.hasFocus()?a.state.delayingBlurEvent=!1:$c(a)),Ke(m.wrapper.ownerDocument,"mouseup",O),Ke(m.wrapper.ownerDocument,"mousemove",A),Ke(m.scroller,"dragstart",L),Ke(m.scroller,"drop",O),S||(vt(F),h.addNew||mu(a.doc,p,null,null,h.extend),f&&!x||d&&c==9?setTimeout(function(){m.wrapper.ownerDocument.body.focus({preventScroll:!0}),m.input.focus()},20):m.input.focus())}),A=function(F){S=S||Math.abs(u.clientX-F.clientX)+Math.abs(u.clientY-F.clientY)>=10},L=function(){return S=!0};f&&(m.scroller.draggable=!0),a.state.draggingText=O,O.copy=!h.moveOnDrag,De(m.wrapper.ownerDocument,"mouseup",O),De(m.wrapper.ownerDocument,"mousemove",A),De(m.scroller,"dragstart",L),De(m.scroller,"drop",O),a.state.delayingBlurEvent=!0,setTimeout(function(){return m.input.focus()},20),m.scroller.dragDrop&&m.scroller.dragDrop()}function sg(a,u,p){if(p=="char")return new sn(u,u);if(p=="word")return a.findWordAt(u);if(p=="line")return new sn(ve(u.line,0),Bt(a.doc,ve(u.line+1,0)));var h=p(a,u);return new sn(h.from,h.to)}function iC(a,u,p,h){d&&$c(a);var m=a.display,S=a.doc;vt(u);var O,A,L=S.sel,F=L.ranges;if(h.addNew&&!h.extend?(A=S.sel.contains(p),A>-1?O=F[A]:O=new sn(p,p)):(O=S.sel.primary(),A=S.sel.primIndex),h.unit=="rectangle")h.addNew||(O=new sn(p,p)),p=Io(a,u,!0,!0),A=-1;else{var te=sg(a,p,h.unit);h.extend?O=Qc(O,te.anchor,te.head,h.extend):O=te}h.addNew?A==-1?(A=F.length,Qn(S,di(a,F.concat([O]),A),{scroll:!1,origin:"*mouse"})):F.length>1&&F[A].empty()&&h.unit=="char"&&!h.extend?(Qn(S,di(a,F.slice(0,A).concat(F.slice(A+1)),0),{scroll:!1,origin:"*mouse"}),L=S.sel):ef(S,A,O,It):(A=0,Qn(S,new Ur([O],0),It),L=S.sel);var ie=p;function ge(st){if(be(ie,st)!=0)if(ie=st,h.unit=="rectangle"){for(var gt=[],At=a.options.tabSize,Mt=ke(Xe(S,p.line).text,p.ch,At),zt=ke(Xe(S,st.line).text,st.ch,At),hn=Math.min(Mt,zt),Xn=Math.max(Mt,zt),bn=Math.min(p.line,st.line),Pr=Math.min(a.lastLine(),Math.max(p.line,st.line));bn<=Pr;bn++){var yr=Xe(S,bn).text,Nn=Yt(yr,hn,At);hn==Xn?gt.push(new sn(ve(bn,Nn),ve(bn,Nn))):yr.length>Nn&&gt.push(new sn(ve(bn,Nn),ve(bn,Yt(yr,Xn,At))))}gt.length||gt.push(new sn(p,p)),Qn(S,di(a,L.ranges.slice(0,A).concat(gt),A),{origin:"*mouse",scroll:!1}),a.scrollIntoView(st)}else{var _r=O,qn=sg(a,st,h.unit),Ln=_r.anchor,An;be(qn.anchor,Ln)>0?(An=qn.head,Ln=On(_r.from(),qn.anchor)):(An=qn.anchor,Ln=Lt(_r.to(),qn.head));var En=L.ranges.slice(0);En[A]=oC(a,new sn(Bt(S,Ln),An)),Qn(S,di(a,En,A),It)}}var fe=m.wrapper.getBoundingClientRect(),Le=0;function He(st){var gt=++Le,At=Io(a,st,!0,h.unit=="rectangle");if(At)if(be(At,ie)!=0){a.curOp.focus=it(Ge(a)),ge(At);var Mt=cu(m,S);(At.line>=Mt.to||At.line<Mt.from)&&setTimeout(Un(a,function(){Le==gt&&He(st)}),150)}else{var zt=st.clientY<fe.top?-20:st.clientY>fe.bottom?20:0;zt&&setTimeout(Un(a,function(){Le==gt&&(m.scroller.scrollTop+=zt,He(st))}),50)}}function Qe(st){a.state.selectingText=!1,Le=1/0,st&&(vt(st),m.input.focus()),Ke(m.wrapper.ownerDocument,"mousemove",at),Ke(m.wrapper.ownerDocument,"mouseup",ft),S.history.lastSelOrigin=null}var at=Un(a,function(st){st.buttons===0||!gn(st)?Qe(st):He(st)}),ft=Un(a,Qe);a.state.selectingText=ft,De(m.wrapper.ownerDocument,"mousemove",at),De(m.wrapper.ownerDocument,"mouseup",ft)}function oC(a,u){var p=u.anchor,h=u.head,m=Xe(a.doc,p.line);if(be(p,h)==0&&p.sticky==h.sticky)return u;var S=ot(m);if(!S)return u;var O=ut(S,p.ch,p.sticky),A=S[O];if(A.from!=p.ch&&A.to!=p.ch)return u;var L=O+(A.from==p.ch==(A.level!=1)?0:1);if(L==0||L==S.length)return u;var F;if(h.line!=p.line)F=(h.line-p.line)*(a.doc.direction=="ltr"?1:-1)>0;else{var te=ut(S,h.ch,h.sticky),ie=te-O||(h.ch-p.ch)*(A.level==1?-1:1);te==L-1||te==L?F=ie<0:F=ie>0}var ge=S[L+(F?-1:0)],fe=F==(ge.level==1),Le=fe?ge.from:ge.to,He=fe?"after":"before";return p.ch==Le&&p.sticky==He?u:new sn(new ve(p.line,Le,He),h)}function lg(a,u,p,h){var m,S;if(u.touches)m=u.touches[0].clientX,S=u.touches[0].clientY;else try{m=u.clientX,S=u.clientY}catch{return!1}if(m>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;h&&vt(u);var O=a.display,A=O.lineDiv.getBoundingClientRect();if(S>A.bottom||!_e(a,p))return Ut(u);S-=A.top-O.viewOffset;for(var L=0;L<a.display.gutterSpecs.length;++L){var F=O.gutters.childNodes[L];if(F&&F.getBoundingClientRect().right>=m){var te=V(a.doc,S),ie=a.display.gutterSpecs[L];return Ze(a,p,a,te,ie.className,u),Ut(u)}}}function sf(a,u){return lg(a,u,"gutterClick",!0)}function ug(a,u){qi(a.display,u)||aC(a,u)||tt(a,u,"contextmenu")||se||a.display.input.onContextMenu(u)}function aC(a,u){return _e(a,"gutterContextMenu")?lg(a,u,"gutterContextMenu",!1):!1}function dg(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Ts(a)}var Ma={toString:function(){return"CodeMirror.Init"}},cg={},Eu={};function sC(a){var u=a.optionHandlers;function p(h,m,S,O){a.defaults[h]=m,S&&(u[h]=O?function(A,L,F){F!=Ma&&S(A,L,F)}:S)}a.defineOption=p,a.Init=Ma,p("value","",function(h,m){return h.setValue(m)},!0),p("mode",null,function(h,m){h.doc.modeOption=m,qc(h)},!0),p("indentUnit",2,qc,!0),p("indentWithTabs",!1),p("smartIndent",!0),p("tabSize",4,function(h){Hs(h),Ts(h),gr(h)},!0),p("lineSeparator",null,function(h,m){if(h.doc.lineSep=m,!!m){var S=[],O=h.doc.first;h.doc.iter(function(L){for(var F=0;;){var te=L.text.indexOf(m,F);if(te==-1)break;F=te+m.length,S.push(ve(O,te))}O++});for(var A=S.length-1;A>=0;A--)Ea(h.doc,m,S[A],ve(S[A].line,S[A].ch+m.length))}}),p("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(h,m,S){h.state.specialChars=new RegExp(m.source+(m.test("	")?"":"|	"),"g"),S!=Ma&&h.refresh()}),p("specialCharPlaceholder",IS,function(h){return h.refresh()},!0),p("electricChars",!0),p("inputStyle",D?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),p("spellcheck",!1,function(h,m){return h.getInputField().spellcheck=m},!0),p("autocorrect",!1,function(h,m){return h.getInputField().autocorrect=m},!0),p("autocapitalize",!1,function(h,m){return h.getInputField().autocapitalize=m},!0),p("rtlMoveVisually",!P),p("wholeLineUpdateBefore",!0),p("theme","default",function(h){dg(h),js(h)},!0),p("keyMap","default",function(h,m,S){var O=wu(m),A=S!=Ma&&wu(S);A&&A.detach&&A.detach(h,O),O.attach&&O.attach(h,A||null)}),p("extraKeys",null),p("configureMouse",null),p("lineWrapping",!1,uC,!0),p("gutters",[],function(h,m){h.display.gutterSpecs=Yc(m,h.options.lineNumbers),js(h)},!0),p("fixedGutter",!0,function(h,m){h.display.gutters.style.left=m?Ic(h.display)+"px":"0",h.refresh()},!0),p("coverGutterNextToScrollbar",!1,function(h){return ba(h)},!0),p("scrollbarStyle","native",function(h){hv(h),ba(h),h.display.scrollbars.setScrollTop(h.doc.scrollTop),h.display.scrollbars.setScrollLeft(h.doc.scrollLeft)},!0),p("lineNumbers",!1,function(h,m){h.display.gutterSpecs=Yc(h.options.gutters,m),js(h)},!0),p("firstLineNumber",1,js,!0),p("lineNumberFormatter",function(h){return h},js,!0),p("showCursorWhenSelecting",!1,Ds,!0),p("resetSelectionOnContextMenu",!0),p("lineWiseCopyCut",!0),p("pasteLinesPerSelection",!0),p("selectionsMayTouch",!1),p("readOnly",!1,function(h,m){m=="nocursor"&&(ya(h),h.display.input.blur()),h.display.input.readOnlyChanged(m)}),p("screenReaderLabel",null,function(h,m){m=m===""?null:m,h.display.input.screenReaderLabelChanged(m)}),p("disableInput",!1,function(h,m){m||h.display.input.reset()},!0),p("dragDrop",!0,lC),p("allowDropFileTypes",null),p("cursorBlinkRate",530),p("cursorScrollMargin",0),p("cursorHeight",1,Ds,!0),p("singleCursorHeightPerLine",!0,Ds,!0),p("workTime",100),p("workDelay",100),p("flattenSpans",!0,Hs,!0),p("addModeClass",!1,Hs,!0),p("pollInterval",100),p("undoDepth",200,function(h,m){return h.doc.history.undoDepth=m}),p("historyEventDelay",1250),p("viewportMargin",10,function(h){return h.refresh()},!0),p("maxHighlightLength",1e4,Hs,!0),p("moveInputWithCursor",!0,function(h,m){m||h.display.input.resetPosition()}),p("tabindex",null,function(h,m){return h.display.input.getField().tabIndex=m||""}),p("autofocus",null),p("direction","ltr",function(h,m){return h.doc.setDirection(m)},!0),p("phrases",null)}function lC(a,u,p){var h=p&&p!=Ma;if(!u!=!h){var m=a.display.dragFunctions,S=u?De:Ke;S(a.display.scroller,"dragstart",m.start),S(a.display.scroller,"dragenter",m.enter),S(a.display.scroller,"dragover",m.over),S(a.display.scroller,"dragleave",m.leave),S(a.display.scroller,"drop",m.drop)}}function uC(a){a.options.lineWrapping?(Oe(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(ee(a.display.wrapper,"CodeMirror-wrap"),Oc(a)),Bc(a),gr(a),Ts(a),setTimeout(function(){return ba(a)},100)}function yn(a,u){var p=this;if(!(this instanceof yn))return new yn(a,u);this.options=u=u?de(u):{},de(cg,u,!1);var h=u.value;typeof h=="string"?h=new mr(h,u.mode,null,u.lineSeparator,u.direction):u.mode&&(h.modeOption=u.mode),this.doc=h;var m=new yn.inputStyles[u.inputStyle](this),S=this.display=new wE(a,h,m,u);S.wrapper.CodeMirror=this,dg(this),u.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),hv(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Ye,keySeq:null,specialChars:null},u.autofocus&&!D&&S.input.focus(),d&&c<11&&setTimeout(function(){return p.display.input.reset(!0)},20),dC(this),FE(),$o(this),this.curOp.forceUpdate=!0,Sv(this,h),u.autofocus&&!D||this.hasFocus()?setTimeout(function(){p.hasFocus()&&!p.state.focused&&Fc(p)},20):ya(this);for(var O in Eu)Eu.hasOwnProperty(O)&&Eu[O](this,u[O],Ma);gv(this),u.finishInit&&u.finishInit(this);for(var A=0;A<lf.length;++A)lf[A](this);Fo(this),f&&u.lineWrapping&&getComputedStyle(S.lineDiv).textRendering=="optimizelegibility"&&(S.lineDiv.style.textRendering="auto")}yn.defaults=cg,yn.optionHandlers=Eu;function dC(a){var u=a.display;De(u.scroller,"mousedown",Un(a,ag)),d&&c<11?De(u.scroller,"dblclick",Un(a,function(L){if(!tt(a,L)){var F=Io(a,L);if(!(!F||sf(a,L)||qi(a.display,L))){vt(L);var te=a.findWordAt(F);mu(a.doc,te.anchor,te.head)}}})):De(u.scroller,"dblclick",function(L){return tt(a,L)||vt(L)}),De(u.scroller,"contextmenu",function(L){return ug(a,L)}),De(u.input.getField(),"contextmenu",function(L){u.scroller.contains(L.target)||ug(a,L)});var p,h={end:0};function m(){u.activeTouch&&(p=setTimeout(function(){return u.activeTouch=null},1e3),h=u.activeTouch,h.end=+new Date)}function S(L){if(L.touches.length!=1)return!1;var F=L.touches[0];return F.radiusX<=1&&F.radiusY<=1}function O(L,F){if(F.left==null)return!0;var te=F.left-L.left,ie=F.top-L.top;return te*te+ie*ie>20*20}De(u.scroller,"touchstart",function(L){if(!tt(a,L)&&!S(L)&&!sf(a,L)){u.input.ensurePolled(),clearTimeout(p);var F=+new Date;u.activeTouch={start:F,moved:!1,prev:F-h.end<=300?h:null},L.touches.length==1&&(u.activeTouch.left=L.touches[0].pageX,u.activeTouch.top=L.touches[0].pageY)}}),De(u.scroller,"touchmove",function(){u.activeTouch&&(u.activeTouch.moved=!0)}),De(u.scroller,"touchend",function(L){var F=u.activeTouch;if(F&&!qi(u,L)&&F.left!=null&&!F.moved&&new Date-F.start<300){var te=a.coordsChar(u.activeTouch,"page"),ie;!F.prev||O(F,F.prev)?ie=new sn(te,te):!F.prev.prev||O(F,F.prev.prev)?ie=a.findWordAt(te):ie=new sn(ve(te.line,0),Bt(a.doc,ve(te.line+1,0))),a.setSelection(ie.anchor,ie.head),a.focus(),vt(L)}m()}),De(u.scroller,"touchcancel",m),De(u.scroller,"scroll",function(){u.scroller.clientHeight&&(Ps(a,u.scroller.scrollTop),jo(a,u.scroller.scrollLeft,!0),Ze(a,"scroll",a))}),De(u.scroller,"mousewheel",function(L){return _v(a,L)}),De(u.scroller,"DOMMouseScroll",function(L){return _v(a,L)}),De(u.wrapper,"scroll",function(){return u.wrapper.scrollTop=u.wrapper.scrollLeft=0}),u.dragFunctions={enter:function(L){tt(a,L)||Xt(L)},over:function(L){tt(a,L)||($E(a,L),Xt(L))},start:function(L){return HE(a,L)},drop:Un(a,jE),leave:function(L){tt(a,L)||Gv(a)}};var A=u.input.getField();De(A,"keyup",function(L){return ig.call(a,L)}),De(A,"keydown",Un(a,rg)),De(A,"keypress",Un(a,og)),De(A,"focus",function(L){return Fc(a,L)}),De(A,"blur",function(L){return ya(a,L)})}var lf=[];yn.defineInitHook=function(a){return lf.push(a)};function Zs(a,u,p,h){var m=a.doc,S;p==null&&(p="add"),p=="smart"&&(m.mode.indent?S=ao(a,u).state:p="prev");var O=a.options.tabSize,A=Xe(m,u),L=ke(A.text,null,O);A.stateAfter&&(A.stateAfter=null);var F=A.text.match(/^\s*/)[0],te;if(!h&&!/\S/.test(A.text))te=0,p="not";else if(p=="smart"&&(te=m.mode.indent(S,A.text.slice(F.length),A.text),te==Ot||te>150)){if(!h)return;p="prev"}p=="prev"?u>m.first?te=ke(Xe(m,u-1).text,null,O):te=0:p=="add"?te=L+a.options.indentUnit:p=="subtract"?te=L-a.options.indentUnit:typeof p=="number"&&(te=L+p),te=Math.max(0,te);var ie="",ge=0;if(a.options.indentWithTabs)for(var fe=Math.floor(te/O);fe;--fe)ge+=O,ie+="	";if(ge<te&&(ie+=Q(te-ge)),ie!=F)return Ea(m,ie,ve(u,0),ve(u,F.length),"+input"),A.stateAfter=null,!0;for(var Le=0;Le<m.sel.ranges.length;Le++){var He=m.sel.ranges[Le];if(He.head.line==u&&He.head.ch<F.length){var Qe=ve(u,F.length);ef(m,Le,new sn(Qe,Qe));break}}}var ci=null;function Cu(a){ci=a}function uf(a,u,p,h,m){var S=a.doc;a.display.shift=!1,h||(h=S.sel);var O=+new Date-200,A=m=="paste"||a.state.pasteIncoming>O,L=Cn(u),F=null;if(A&&h.ranges.length>1)if(ci&&ci.text.join(`
`)==u){if(h.ranges.length%ci.text.length==0){F=[];for(var te=0;te<ci.text.length;te++)F.push(S.splitLines(ci.text[te]))}}else L.length==h.ranges.length&&a.options.pasteLinesPerSelection&&(F=H(L,function(at){return[at]}));for(var ie=a.curOp.updateInput,ge=h.ranges.length-1;ge>=0;ge--){var fe=h.ranges[ge],Le=fe.from(),He=fe.to();fe.empty()&&(p&&p>0?Le=ve(Le.line,Le.ch-p):a.state.overwrite&&!A?He=ve(He.line,Math.min(Xe(S,He.line).text.length,He.ch+M(L).length)):A&&ci&&ci.lineWise&&ci.text.join(`
`)==L.join(`
`)&&(Le=He=ve(Le.line,0)));var Qe={from:Le,to:He,text:F?F[ge%F.length]:L,origin:m||(A?"paste":a.state.cutIncoming>O?"cut":"+input")};Sa(a.doc,Qe),Wn(a,"inputRead",a,Qe)}u&&!A&&hg(a,u),_a(a),a.curOp.updateInput<2&&(a.curOp.updateInput=ie),a.curOp.typing=!0,a.state.pasteIncoming=a.state.cutIncoming=-1}function fg(a,u){var p=a.clipboardData&&a.clipboardData.getData("Text");if(p)return a.preventDefault(),!u.isReadOnly()&&!u.options.disableInput&&u.hasFocus()&&Lr(u,function(){return uf(u,p,0,null,"paste")}),!0}function hg(a,u){if(!(!a.options.electricChars||!a.options.smartIndent))for(var p=a.doc.sel,h=p.ranges.length-1;h>=0;h--){var m=p.ranges[h];if(!(m.head.ch>100||h&&p.ranges[h-1].head.line==m.head.line)){var S=a.getModeAt(m.head),O=!1;if(S.electricChars){for(var A=0;A<S.electricChars.length;A++)if(u.indexOf(S.electricChars.charAt(A))>-1){O=Zs(a,m.head.line,"smart");break}}else S.electricInput&&S.electricInput.test(Xe(a.doc,m.head.line).text.slice(0,m.head.ch))&&(O=Zs(a,m.head.line,"smart"));O&&Wn(a,"electricInput",a,m.head.line)}}}function pg(a){for(var u=[],p=[],h=0;h<a.doc.sel.ranges.length;h++){var m=a.doc.sel.ranges[h].head.line,S={anchor:ve(m,0),head:ve(m+1,0)};p.push(S),u.push(a.getRange(S.anchor,S.head))}return{text:u,ranges:p}}function df(a,u,p,h){a.setAttribute("autocorrect",p?"on":"off"),a.setAttribute("autocapitalize",h?"on":"off"),a.setAttribute("spellcheck",!!u)}function vg(){var a=B("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),u=B("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return f?a.style.width="1000px":a.setAttribute("wrap","off"),C&&(a.style.border="1px solid black"),u}function cC(a){var u=a.optionHandlers,p=a.helpers={};a.prototype={constructor:a,focus:function(){G(this).focus(),this.display.input.focus()},setOption:function(h,m){var S=this.options,O=S[h];S[h]==m&&h!="mode"||(S[h]=m,u.hasOwnProperty(h)&&Un(this,u[h])(this,m,O),Ze(this,"optionChange",this,h))},getOption:function(h){return this.options[h]},getDoc:function(){return this.doc},addKeyMap:function(h,m){this.state.keyMaps[m?"push":"unshift"](wu(h))},removeKeyMap:function(h){for(var m=this.state.keyMaps,S=0;S<m.length;++S)if(m[S]==h||m[S].name==h)return m.splice(S,1),!0},addOverlay:sr(function(h,m){var S=h.token?h:a.getMode(this.options,h);if(S.startState)throw new Error("Overlays may not be stateful.");Z(this.state.overlays,{mode:S,modeSpec:h,opaque:m&&m.opaque,priority:m&&m.priority||0},function(O){return O.priority}),this.state.modeGen++,gr(this)}),removeOverlay:sr(function(h){for(var m=this.state.overlays,S=0;S<m.length;++S){var O=m[S].modeSpec;if(O==h||typeof h=="string"&&O.name==h){m.splice(S,1),this.state.modeGen++,gr(this);return}}}),indentLine:sr(function(h,m,S){typeof m!="string"&&typeof m!="number"&&(m==null?m=this.options.smartIndent?"smart":"prev":m=m?"add":"subtract"),ce(this.doc,h)&&Zs(this,h,m,S)}),indentSelection:sr(function(h){for(var m=this.doc.sel.ranges,S=-1,O=0;O<m.length;O++){var A=m[O];if(A.empty())A.head.line>S&&(Zs(this,A.head.line,h,!0),S=A.head.line,O==this.doc.sel.primIndex&&_a(this));else{var L=A.from(),F=A.to(),te=Math.max(S,L.line);S=Math.min(this.lastLine(),F.line-(F.ch?0:1))+1;for(var ie=te;ie<S;++ie)Zs(this,ie,h);var ge=this.doc.sel.ranges;L.ch==0&&m.length==ge.length&&ge[O].from().ch>0&&ef(this.doc,O,new sn(L,ge[O].to()),lt)}}}),getTokenAt:function(h,m){return Cp(this,h,m)},getLineTokens:function(h,m){return Cp(this,ve(h),m,!0)},getTokenTypeAt:function(h){h=Bt(this.doc,h);var m=Zl(this,Xe(this.doc,h.line)),S=0,O=(m.length-1)/2,A=h.ch,L;if(A==0)L=m[2];else for(;;){var F=S+O>>1;if((F?m[F*2-1]:0)>=A)O=F;else if(m[F*2+1]<A)S=F+1;else{L=m[F*2+2];break}}var te=L?L.indexOf("overlay "):-1;return te<0?L:te==0?null:L.slice(0,te-1)},getModeAt:function(h){var m=this.doc.mode;return m.innerMode?a.innerMode(m,this.getTokenAt(h).state).mode:m},getHelper:function(h,m){return this.getHelpers(h,m)[0]},getHelpers:function(h,m){var S=[];if(!p.hasOwnProperty(m))return S;var O=p[m],A=this.getModeAt(h);if(typeof A[m]=="string")O[A[m]]&&S.push(O[A[m]]);else if(A[m])for(var L=0;L<A[m].length;L++){var F=O[A[m][L]];F&&S.push(F)}else A.helperType&&O[A.helperType]?S.push(O[A.helperType]):O[A.name]&&S.push(O[A.name]);for(var te=0;te<O._global.length;te++){var ie=O._global[te];ie.pred(A,this)&&Ie(S,ie.val)==-1&&S.push(ie.val)}return S},getStateAfter:function(h,m){var S=this.doc;return h=Os(S,h??S.first+S.size-1),ao(this,h+1,m).state},cursorCoords:function(h,m){var S,O=this.doc.sel.primary();return h==null?S=O.head:typeof h=="object"?S=Bt(this.doc,h):S=h?O.from():O.to(),ui(this,S,m||"page")},charCoords:function(h,m){return su(this,Bt(this.doc,h),m||"page")},coordsChar:function(h,m){return h=ev(this,h,m||"page"),Lc(this,h.left,h.top)},lineAtHeight:function(h,m){return h=ev(this,{top:h,left:0},m||"page").top,V(this.doc,h+this.display.viewOffset)},heightAtLine:function(h,m,S){var O=!1,A;if(typeof h=="number"){var L=this.doc.first+this.doc.size-1;h<this.doc.first?h=this.doc.first:h>L&&(h=L,O=!0),A=Xe(this.doc,h)}else A=h;return au(this,A,{top:0,left:0},m||"page",S||O).top+(O?this.doc.height-Ki(A):0)},defaultTextHeight:function(){return ga(this.display)},defaultCharWidth:function(){return ma(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(h,m,S,O,A){var L=this.display;h=ui(this,Bt(this.doc,h));var F=h.bottom,te=h.left;if(m.style.position="absolute",m.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(m),L.sizer.appendChild(m),O=="over")F=h.top;else if(O=="above"||O=="near"){var ie=Math.max(L.wrapper.clientHeight,this.doc.height),ge=Math.max(L.sizer.clientWidth,L.lineSpace.clientWidth);(O=="above"||h.bottom+m.offsetHeight>ie)&&h.top>m.offsetHeight?F=h.top-m.offsetHeight:h.bottom+m.offsetHeight<=ie&&(F=h.bottom),te+m.offsetWidth>ge&&(te=ge-m.offsetWidth)}m.style.top=F+"px",m.style.left=m.style.right="",A=="right"?(te=L.sizer.clientWidth-m.offsetWidth,m.style.right="0px"):(A=="left"?te=0:A=="middle"&&(te=(L.sizer.clientWidth-m.offsetWidth)/2),m.style.left=te+"px"),S&&lE(this,{left:te,top:F,right:te+m.offsetWidth,bottom:F+m.offsetHeight})},triggerOnKeyDown:sr(rg),triggerOnKeyPress:sr(og),triggerOnKeyUp:ig,triggerOnMouseDown:sr(ag),execCommand:function(h){if(Ys.hasOwnProperty(h))return Ys[h].call(null,this)},triggerElectric:sr(function(h){hg(this,h)}),findPosH:function(h,m,S,O){var A=1;m<0&&(A=-1,m=-m);for(var L=Bt(this.doc,h),F=0;F<m&&(L=cf(this.doc,L,A,S,O),!L.hitSide);++F);return L},moveH:sr(function(h,m){var S=this;this.extendSelectionsBy(function(O){return S.display.shift||S.doc.extend||O.empty()?cf(S.doc,O.head,h,m,S.options.rtlMoveVisually):h<0?O.from():O.to()},_t)}),deleteH:sr(function(h,m){var S=this.doc.sel,O=this.doc;S.somethingSelected()?O.replaceSelection("",null,"+delete"):ka(this,function(A){var L=cf(O,A.head,h,m,!1);return h<0?{from:L,to:A.head}:{from:A.head,to:L}})}),findPosV:function(h,m,S,O){var A=1,L=O;m<0&&(A=-1,m=-m);for(var F=Bt(this.doc,h),te=0;te<m;++te){var ie=ui(this,F,"div");if(L==null?L=ie.left:ie.left=L,F=gg(this,ie,A,S),F.hitSide)break}return F},moveV:sr(function(h,m){var S=this,O=this.doc,A=[],L=!this.display.shift&&!O.extend&&O.sel.somethingSelected();if(O.extendSelectionsBy(function(te){if(L)return h<0?te.from():te.to();var ie=ui(S,te.head,"div");te.goalColumn!=null&&(ie.left=te.goalColumn),A.push(ie.left);var ge=gg(S,ie,h,m);return m=="page"&&te==O.sel.primary()&&Wc(S,su(S,ge,"div").top-ie.top),ge},_t),A.length)for(var F=0;F<O.sel.ranges.length;F++)O.sel.ranges[F].goalColumn=A[F]}),findWordAt:function(h){var m=this.doc,S=Xe(m,h.line).text,O=h.ch,A=h.ch;if(S){var L=this.getHelper(h,"wordChars");(h.sticky=="before"||A==S.length)&&O?--O:++A;for(var F=S.charAt(O),te=we(F,L)?function(ie){return we(ie,L)}:/\s/.test(F)?function(ie){return/\s/.test(ie)}:function(ie){return!/\s/.test(ie)&&!we(ie)};O>0&&te(S.charAt(O-1));)--O;for(;A<S.length&&te(S.charAt(A));)++A}return new sn(ve(h.line,O),ve(h.line,A))},toggleOverwrite:function(h){h!=null&&h==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Oe(this.display.cursorDiv,"CodeMirror-overwrite"):ee(this.display.cursorDiv,"CodeMirror-overwrite"),Ze(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==it(Ge(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:sr(function(h,m){Ls(this,h,m)}),getScrollInfo:function(){var h=this.display.scroller;return{left:h.scrollLeft,top:h.scrollTop,height:h.scrollHeight-Di(this)-this.display.barHeight,width:h.scrollWidth-Di(this)-this.display.barWidth,clientHeight:Nc(this),clientWidth:Po(this)}},scrollIntoView:sr(function(h,m){h==null?(h={from:this.doc.sel.primary().head,to:null},m==null&&(m=this.options.cursorScrollMargin)):typeof h=="number"?h={from:ve(h,0),to:null}:h.from==null&&(h={from:h,to:null}),h.to||(h.to=h.from),h.margin=m||0,h.from.line!=null?uE(this,h):uv(this,h.from,h.to,h.margin)}),setSize:sr(function(h,m){var S=this,O=function(L){return typeof L=="number"||/^\d+$/.test(String(L))?L+"px":L};h!=null&&(this.display.wrapper.style.width=O(h)),m!=null&&(this.display.wrapper.style.height=O(m)),this.options.lineWrapping&&Jp(this);var A=this.display.viewFrom;this.doc.iter(A,this.display.viewTo,function(L){if(L.widgets){for(var F=0;F<L.widgets.length;F++)if(L.widgets[F].noHScroll){lo(S,A,"widget");break}}++A}),this.curOp.forceUpdate=!0,Ze(this,"refresh",this)}),operation:function(h){return Lr(this,h)},startOperation:function(){return $o(this)},endOperation:function(){return Fo(this)},refresh:sr(function(){var h=this.display.cachedTextHeight;gr(this),this.curOp.forceUpdate=!0,Ts(this),Ls(this,this.doc.scrollLeft,this.doc.scrollTop),Xc(this.display),(h==null||Math.abs(h-ga(this.display))>.5||this.options.lineWrapping)&&Bc(this),Ze(this,"refresh",this)}),swapDoc:sr(function(h){var m=this.doc;return m.cm=null,this.state.selectingText&&this.state.selectingText(),Sv(this,h),Ts(this),this.display.input.reset(),Ls(this,h.scrollLeft,h.scrollTop),this.curOp.forceScroll=!0,Wn(this,"swapDoc",this,m),m}),phrase:function(h){var m=this.options.phrases;return m&&Object.prototype.hasOwnProperty.call(m,h)?m[h]:h},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ue(a),a.registerHelper=function(h,m,S){p.hasOwnProperty(h)||(p[h]=a[h]={_global:[]}),p[h][m]=S},a.registerGlobalHelper=function(h,m,S,O){a.registerHelper(h,m,O),p[h]._global.push({pred:S,val:O})}}function cf(a,u,p,h,m){var S=u,O=p,A=Xe(a,u.line),L=m&&a.direction=="rtl"?-p:p;function F(){var ft=u.line+L;return ft<a.first||ft>=a.first+a.size?!1:(u=new ve(ft,u.ch,u.sticky),A=Xe(a,ft))}function te(ft){var st;if(h=="codepoint"){var gt=A.text.charCodeAt(u.ch+(p>0?0:-1));if(isNaN(gt))st=null;else{var At=p>0?gt>=55296&&gt<56320:gt>=56320&&gt<57343;st=new ve(u.line,Math.max(0,Math.min(A.text.length,u.ch+p*(At?2:1))),-p)}}else m?st=XE(a.cm,A,u,p):st=nf(A,u,p);if(st==null)if(!ft&&F())u=rf(m,a.cm,A,u.line,L);else return!1;else u=st;return!0}if(h=="char"||h=="codepoint")te();else if(h=="column")te(!0);else if(h=="word"||h=="group")for(var ie=null,ge=h=="group",fe=a.cm&&a.cm.getHelper(u,"wordChars"),Le=!0;!(p<0&&!te(!Le));Le=!1){var He=A.text.charAt(u.ch)||`
`,Qe=we(He,fe)?"w":ge&&He==`
`?"n":!ge||/\s/.test(He)?null:"p";if(ge&&!Le&&!Qe&&(Qe="s"),ie&&ie!=Qe){p<0&&(p=1,te(),u.sticky="after");break}if(Qe&&(ie=Qe),p>0&&!te(!Le))break}var at=_u(a,u,S,O,!0);return nt(S,at)&&(at.hitSide=!0),at}function gg(a,u,p,h){var m=a.doc,S=u.left,O;if(h=="page"){var A=Math.min(a.display.wrapper.clientHeight,G(a).innerHeight||m(a).documentElement.clientHeight),L=Math.max(A-.5*ga(a.display),3);O=(p>0?u.bottom:u.top)+p*L}else h=="line"&&(O=p>0?u.bottom+3:u.top-3);for(var F;F=Lc(a,S,O),!!F.outside;){if(p<0?O<=0:O>=m.height){F.hitSide=!0;break}O+=p*5}return F}var dn=function(a){this.cm=a,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Ye,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};dn.prototype.init=function(a){var u=this,p=this,h=p.cm,m=p.div=a.lineDiv;m.contentEditable=!0,df(m,h.options.spellcheck,h.options.autocorrect,h.options.autocapitalize);function S(A){for(var L=A.target;L;L=L.parentNode){if(L==m)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(L.className))break}return!1}De(m,"paste",function(A){!S(A)||tt(h,A)||fg(A,h)||c<=11&&setTimeout(Un(h,function(){return u.updateFromDOM()}),20)}),De(m,"compositionstart",function(A){u.composing={data:A.data,done:!1}}),De(m,"compositionupdate",function(A){u.composing||(u.composing={data:A.data,done:!1})}),De(m,"compositionend",function(A){u.composing&&(A.data!=u.composing.data&&u.readFromDOMSoon(),u.composing.done=!0)}),De(m,"touchstart",function(){return p.forceCompositionEnd()}),De(m,"input",function(){u.composing||u.readFromDOMSoon()});function O(A){if(!(!S(A)||tt(h,A))){if(h.somethingSelected())Cu({lineWise:!1,text:h.getSelections()}),A.type=="cut"&&h.replaceSelection("",null,"cut");else if(h.options.lineWiseCopyCut){var L=pg(h);Cu({lineWise:!0,text:L.text}),A.type=="cut"&&h.operation(function(){h.setSelections(L.ranges,0,lt),h.replaceSelection("",null,"cut")})}else return;if(A.clipboardData){A.clipboardData.clearData();var F=ci.text.join(`
`);if(A.clipboardData.setData("Text",F),A.clipboardData.getData("Text")==F){A.preventDefault();return}}var te=vg(),ie=te.firstChild;df(ie),h.display.lineSpace.insertBefore(te,h.display.lineSpace.firstChild),ie.value=ci.text.join(`
`);var ge=it(le(m));We(ie),setTimeout(function(){h.display.lineSpace.removeChild(te),ge.focus(),ge==m&&p.showPrimarySelection()},50)}}De(m,"copy",O),De(m,"cut",O)},dn.prototype.screenReaderLabelChanged=function(a){a?this.div.setAttribute("aria-label",a):this.div.removeAttribute("aria-label")},dn.prototype.prepareSelection=function(){var a=av(this.cm,!1);return a.focus=it(le(this.div))==this.div,a},dn.prototype.showSelection=function(a,u){!a||!this.cm.display.view.length||((a.focus||u)&&this.showPrimarySelection(),this.showMultipleSelections(a))},dn.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},dn.prototype.showPrimarySelection=function(){var a=this.getSelection(),u=this.cm,p=u.doc.sel.primary(),h=p.from(),m=p.to();if(u.display.viewTo==u.display.viewFrom||h.line>=u.display.viewTo||m.line<u.display.viewFrom){a.removeAllRanges();return}var S=Ou(u,a.anchorNode,a.anchorOffset),O=Ou(u,a.focusNode,a.focusOffset);if(!(S&&!S.bad&&O&&!O.bad&&be(On(S,O),h)==0&&be(Lt(S,O),m)==0)){var A=u.display.view,L=h.line>=u.display.viewFrom&&mg(u,h)||{node:A[0].measure.map[2],offset:0},F=m.line<u.display.viewTo&&mg(u,m);if(!F){var te=A[A.length-1].measure,ie=te.maps?te.maps[te.maps.length-1]:te.map;F={node:ie[ie.length-1],offset:ie[ie.length-2]-ie[ie.length-3]}}if(!L||!F){a.removeAllRanges();return}var ge=a.rangeCount&&a.getRangeAt(0),fe;try{fe=Ee(L.node,L.offset,F.offset,F.node)}catch{}fe&&(!i&&u.state.focused?(a.collapse(L.node,L.offset),fe.collapsed||(a.removeAllRanges(),a.addRange(fe))):(a.removeAllRanges(),a.addRange(fe)),ge&&a.anchorNode==null?a.addRange(ge):i&&this.startGracePeriod()),this.rememberSelection()}},dn.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){a.gracePeriod=!1,a.selectionChanged()&&a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})},20)},dn.prototype.showMultipleSelections=function(a){z(this.cm.display.cursorDiv,a.cursors),z(this.cm.display.selectionDiv,a.selection)},dn.prototype.rememberSelection=function(){var a=this.getSelection();this.lastAnchorNode=a.anchorNode,this.lastAnchorOffset=a.anchorOffset,this.lastFocusNode=a.focusNode,this.lastFocusOffset=a.focusOffset},dn.prototype.selectionInEditor=function(){var a=this.getSelection();if(!a.rangeCount)return!1;var u=a.getRangeAt(0).commonAncestorContainer;return ye(this.div,u)},dn.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||it(le(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},dn.prototype.blur=function(){this.div.blur()},dn.prototype.getField=function(){return this.div},dn.prototype.supportsTouch=function(){return!0},dn.prototype.receivedFocus=function(){var a=this,u=this;this.selectionInEditor()?setTimeout(function(){return a.pollSelection()},20):Lr(this.cm,function(){return u.cm.curOp.selectionChanged=!0});function p(){u.cm.state.focused&&(u.pollSelection(),u.polling.set(u.cm.options.pollInterval,p))}this.polling.set(this.cm.options.pollInterval,p)},dn.prototype.selectionChanged=function(){var a=this.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},dn.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var a=this.getSelection(),u=this.cm;if(k&&g&&this.cm.display.gutterSpecs.length&&fC(a.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var p=Ou(u,a.anchorNode,a.anchorOffset),h=Ou(u,a.focusNode,a.focusOffset);p&&h&&Lr(u,function(){Qn(u.doc,co(p,h),lt),(p.bad||h.bad)&&(u.curOp.selectionChanged=!0)})}}},dn.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var a=this.cm,u=a.display,p=a.doc.sel.primary(),h=p.from(),m=p.to();if(h.ch==0&&h.line>a.firstLine()&&(h=ve(h.line-1,Xe(a.doc,h.line-1).length)),m.ch==Xe(a.doc,m.line).text.length&&m.line<a.lastLine()&&(m=ve(m.line+1,0)),h.line<u.viewFrom||m.line>u.viewTo-1)return!1;var S,O,A;h.line==u.viewFrom||(S=Bo(a,h.line))==0?(O=N(u.view[0].line),A=u.view[0].node):(O=N(u.view[S].line),A=u.view[S-1].node.nextSibling);var L=Bo(a,m.line),F,te;if(L==u.view.length-1?(F=u.viewTo-1,te=u.lineDiv.lastChild):(F=N(u.view[L+1].line)-1,te=u.view[L+1].node.previousSibling),!A)return!1;for(var ie=a.doc.splitLines(hC(a,A,te,O,F)),ge=Ft(a.doc,ve(O,0),ve(F,Xe(a.doc,F).text.length));ie.length>1&&ge.length>1;)if(M(ie)==M(ge))ie.pop(),ge.pop(),F--;else if(ie[0]==ge[0])ie.shift(),ge.shift(),O++;else break;for(var fe=0,Le=0,He=ie[0],Qe=ge[0],at=Math.min(He.length,Qe.length);fe<at&&He.charCodeAt(fe)==Qe.charCodeAt(fe);)++fe;for(var ft=M(ie),st=M(ge),gt=Math.min(ft.length-(ie.length==1?fe:0),st.length-(ge.length==1?fe:0));Le<gt&&ft.charCodeAt(ft.length-Le-1)==st.charCodeAt(st.length-Le-1);)++Le;if(ie.length==1&&ge.length==1&&O==h.line)for(;fe&&fe>h.ch&&ft.charCodeAt(ft.length-Le-1)==st.charCodeAt(st.length-Le-1);)fe--,Le++;ie[ie.length-1]=ft.slice(0,ft.length-Le).replace(/^\u200b+/,""),ie[0]=ie[0].slice(fe).replace(/\u200b+$/,"");var At=ve(O,fe),Mt=ve(F,ge.length?M(ge).length-Le:0);if(ie.length>1||ie[0]||be(At,Mt))return Ea(a.doc,ie,At,Mt,"+input"),!0},dn.prototype.ensurePolled=function(){this.forceCompositionEnd()},dn.prototype.reset=function(){this.forceCompositionEnd()},dn.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},dn.prototype.readFromDOMSoon=function(){var a=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(a.readDOMTimeout=null,a.composing)if(a.composing.done)a.composing=null;else return;a.updateFromDOM()},80))},dn.prototype.updateFromDOM=function(){var a=this;(this.cm.isReadOnly()||!this.pollContent())&&Lr(this.cm,function(){return gr(a.cm)})},dn.prototype.setUneditable=function(a){a.contentEditable="false"},dn.prototype.onKeyPress=function(a){a.charCode==0||this.composing||(a.preventDefault(),this.cm.isReadOnly()||Un(this.cm,uf)(this.cm,String.fromCharCode(a.charCode==null?a.keyCode:a.charCode),0))},dn.prototype.readOnlyChanged=function(a){this.div.contentEditable=String(a!="nocursor")},dn.prototype.onContextMenu=function(){},dn.prototype.resetPosition=function(){},dn.prototype.needsContentAttribute=!0;function mg(a,u){var p=Ac(a,u.line);if(!p||p.hidden)return null;var h=Xe(a.doc,u.line),m=Xp(p,h,u.line),S=ot(h,a.doc.direction),O="left";if(S){var A=ut(S,u.ch);O=A%2?"right":"left"}var L=Kp(m.map,u.ch,O);return L.offset=L.collapse=="right"?L.end:L.start,L}function fC(a){for(var u=a;u;u=u.parentNode)if(/CodeMirror-gutter-wrapper/.test(u.className))return!0;return!1}function Na(a,u){return u&&(a.bad=!0),a}function hC(a,u,p,h,m){var S="",O=!1,A=a.doc.lineSeparator(),L=!1;function F(fe){return function(Le){return Le.id==fe}}function te(){O&&(S+=A,L&&(S+=A),O=L=!1)}function ie(fe){fe&&(te(),S+=fe)}function ge(fe){if(fe.nodeType==1){var Le=fe.getAttribute("cm-text");if(Le){ie(Le);return}var He=fe.getAttribute("cm-marker"),Qe;if(He){var at=a.findMarks(ve(h,0),ve(m+1,0),F(+He));at.length&&(Qe=at[0].find(0))&&ie(Ft(a.doc,Qe.from,Qe.to).join(A));return}if(fe.getAttribute("contenteditable")=="false")return;var ft=/^(pre|div|p|li|table|br)$/i.test(fe.nodeName);if(!/^br$/i.test(fe.nodeName)&&fe.textContent.length==0)return;ft&&te();for(var st=0;st<fe.childNodes.length;st++)ge(fe.childNodes[st]);/^(pre|p)$/i.test(fe.nodeName)&&(L=!0),ft&&(O=!0)}else fe.nodeType==3&&ie(fe.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;ge(u),u!=p;)u=u.nextSibling,L=!1;return S}function Ou(a,u,p){var h;if(u==a.display.lineDiv){if(h=a.display.lineDiv.childNodes[p],!h)return Na(a.clipPos(ve(a.display.viewTo-1)),!0);u=null,p=0}else for(h=u;;h=h.parentNode){if(!h||h==a.display.lineDiv)return null;if(h.parentNode&&h.parentNode==a.display.lineDiv)break}for(var m=0;m<a.display.view.length;m++){var S=a.display.view[m];if(S.node==h)return pC(S,u,p)}}function pC(a,u,p){var h=a.text.firstChild,m=!1;if(!u||!ye(h,u))return Na(ve(N(a.line),0),!0);if(u==h&&(m=!0,u=h.childNodes[p],p=0,!u)){var S=a.rest?M(a.rest):a.line;return Na(ve(N(S),S.text.length),m)}var O=u.nodeType==3?u:null,A=u;for(!O&&u.childNodes.length==1&&u.firstChild.nodeType==3&&(O=u.firstChild,p&&(p=O.nodeValue.length));A.parentNode!=h;)A=A.parentNode;var L=a.measure,F=L.maps;function te(Qe,at,ft){for(var st=-1;st<(F?F.length:0);st++)for(var gt=st<0?L.map:F[st],At=0;At<gt.length;At+=3){var Mt=gt[At+2];if(Mt==Qe||Mt==at){var zt=N(st<0?a.line:a.rest[st]),hn=gt[At]+ft;return(ft<0||Mt!=Qe)&&(hn=gt[At+(ft?1:0)]),ve(zt,hn)}}}var ie=te(O,A,p);if(ie)return Na(ie,m);for(var ge=A.nextSibling,fe=O?O.nodeValue.length-p:0;ge;ge=ge.nextSibling){if(ie=te(ge,ge.firstChild,0),ie)return Na(ve(ie.line,ie.ch-fe),m);fe+=ge.textContent.length}for(var Le=A.previousSibling,He=p;Le;Le=Le.previousSibling){if(ie=te(Le,Le.firstChild,-1),ie)return Na(ve(ie.line,ie.ch+He),m);He+=Le.textContent.length}}var kn=function(a){this.cm=a,this.prevInput="",this.pollingFast=!1,this.polling=new Ye,this.hasSelection=!1,this.composing=null,this.resetting=!1};kn.prototype.init=function(a){var u=this,p=this,h=this.cm;this.createField(a);var m=this.textarea;a.wrapper.insertBefore(this.wrapper,a.wrapper.firstChild),C&&(m.style.width="0px"),De(m,"input",function(){d&&c>=9&&u.hasSelection&&(u.hasSelection=null),p.poll()}),De(m,"paste",function(O){tt(h,O)||fg(O,h)||(h.state.pasteIncoming=+new Date,p.fastPoll())});function S(O){if(!tt(h,O)){if(h.somethingSelected())Cu({lineWise:!1,text:h.getSelections()});else if(h.options.lineWiseCopyCut){var A=pg(h);Cu({lineWise:!0,text:A.text}),O.type=="cut"?h.setSelections(A.ranges,null,lt):(p.prevInput="",m.value=A.text.join(`
`),We(m))}else return;O.type=="cut"&&(h.state.cutIncoming=+new Date)}}De(m,"cut",S),De(m,"copy",S),De(a.scroller,"paste",function(O){if(!(qi(a,O)||tt(h,O))){if(!m.dispatchEvent){h.state.pasteIncoming=+new Date,p.focus();return}var A=new Event("paste");A.clipboardData=O.clipboardData,m.dispatchEvent(A)}}),De(a.lineSpace,"selectstart",function(O){qi(a,O)||vt(O)}),De(m,"compositionstart",function(){var O=h.getCursor("from");p.composing&&p.composing.range.clear(),p.composing={start:O,range:h.markText(O,h.getCursor("to"),{className:"CodeMirror-composing"})}}),De(m,"compositionend",function(){p.composing&&(p.poll(),p.composing.range.clear(),p.composing=null)})},kn.prototype.createField=function(a){this.wrapper=vg(),this.textarea=this.wrapper.firstChild;var u=this.cm.options;df(this.textarea,u.spellcheck,u.autocorrect,u.autocapitalize)},kn.prototype.screenReaderLabelChanged=function(a){a?this.textarea.setAttribute("aria-label",a):this.textarea.removeAttribute("aria-label")},kn.prototype.prepareSelection=function(){var a=this.cm,u=a.display,p=a.doc,h=av(a);if(a.options.moveInputWithCursor){var m=ui(a,p.sel.primary().head,"div"),S=u.wrapper.getBoundingClientRect(),O=u.lineDiv.getBoundingClientRect();h.teTop=Math.max(0,Math.min(u.wrapper.clientHeight-10,m.top+O.top-S.top)),h.teLeft=Math.max(0,Math.min(u.wrapper.clientWidth-10,m.left+O.left-S.left))}return h},kn.prototype.showSelection=function(a){var u=this.cm,p=u.display;z(p.cursorDiv,a.cursors),z(p.selectionDiv,a.selection),a.teTop!=null&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},kn.prototype.reset=function(a){if(!(this.contextMenuPending||this.composing&&a)){var u=this.cm;if(this.resetting=!0,u.somethingSelected()){this.prevInput="";var p=u.getSelection();this.textarea.value=p,u.state.focused&&We(this.textarea),d&&c>=9&&(this.hasSelection=p)}else a||(this.prevInput=this.textarea.value="",d&&c>=9&&(this.hasSelection=null));this.resetting=!1}},kn.prototype.getField=function(){return this.textarea},kn.prototype.supportsTouch=function(){return!1},kn.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!D||it(le(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},kn.prototype.blur=function(){this.textarea.blur()},kn.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},kn.prototype.receivedFocus=function(){this.slowPoll()},kn.prototype.slowPoll=function(){var a=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){a.poll(),a.cm.state.focused&&a.slowPoll()})},kn.prototype.fastPoll=function(){var a=!1,u=this;u.pollingFast=!0;function p(){var h=u.poll();!h&&!a?(a=!0,u.polling.set(60,p)):(u.pollingFast=!1,u.slowPoll())}u.polling.set(20,p)},kn.prototype.poll=function(){var a=this,u=this.cm,p=this.textarea,h=this.prevInput;if(this.contextMenuPending||this.resetting||!u.state.focused||Nr(p)&&!h&&!this.composing||u.isReadOnly()||u.options.disableInput||u.state.keySeq)return!1;var m=p.value;if(m==h&&!u.somethingSelected())return!1;if(d&&c>=9&&this.hasSelection===m||R&&/[\uf700-\uf7ff]/.test(m))return u.display.input.reset(),!1;if(u.doc.sel==u.display.selForContextMenu){var S=m.charCodeAt(0);if(S==8203&&!h&&(h="​"),S==8666)return this.reset(),this.cm.execCommand("undo")}for(var O=0,A=Math.min(h.length,m.length);O<A&&h.charCodeAt(O)==m.charCodeAt(O);)++O;return Lr(u,function(){uf(u,m.slice(O),h.length-O,null,a.composing?"*compose":null),m.length>1e3||m.indexOf(`
`)>-1?p.value=a.prevInput="":a.prevInput=m,a.composing&&(a.composing.range.clear(),a.composing.range=u.markText(a.composing.start,u.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},kn.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},kn.prototype.onKeyPress=function(){d&&c>=9&&(this.hasSelection=null),this.fastPoll()},kn.prototype.onContextMenu=function(a){var u=this,p=u.cm,h=p.display,m=u.textarea;u.contextMenuPending&&u.contextMenuPending();var S=Io(p,a),O=h.scroller.scrollTop;if(!S||b)return;var A=p.options.resetSelectionOnContextMenu;A&&p.doc.sel.contains(S)==-1&&Un(p,Qn)(p.doc,co(S),lt);var L=m.style.cssText,F=u.wrapper.style.cssText,te=u.wrapper.offsetParent.getBoundingClientRect();u.wrapper.style.cssText="position: static",m.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(a.clientY-te.top-5)+"px; left: "+(a.clientX-te.left-5)+`px;
      z-index: 1000; background: `+(d?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var ie;f&&(ie=m.ownerDocument.defaultView.scrollY),h.input.focus(),f&&m.ownerDocument.defaultView.scrollTo(null,ie),h.input.reset(),p.somethingSelected()||(m.value=u.prevInput=" "),u.contextMenuPending=fe,h.selForContextMenu=p.doc.sel,clearTimeout(h.detectingSelectAll);function ge(){if(m.selectionStart!=null){var He=p.somethingSelected(),Qe="​"+(He?m.value:"");m.value="⇚",m.value=Qe,u.prevInput=He?"":"​",m.selectionStart=1,m.selectionEnd=Qe.length,h.selForContextMenu=p.doc.sel}}function fe(){if(u.contextMenuPending==fe&&(u.contextMenuPending=!1,u.wrapper.style.cssText=F,m.style.cssText=L,d&&c<9&&h.scrollbars.setScrollTop(h.scroller.scrollTop=O),m.selectionStart!=null)){(!d||d&&c<9)&&ge();var He=0,Qe=function(){h.selForContextMenu==p.doc.sel&&m.selectionStart==0&&m.selectionEnd>0&&u.prevInput=="​"?Un(p,Iv)(p):He++<10?h.detectingSelectAll=setTimeout(Qe,500):(h.selForContextMenu=null,h.input.reset())};h.detectingSelectAll=setTimeout(Qe,200)}}if(d&&c>=9&&ge(),se){Xt(a);var Le=function(){Ke(window,"mouseup",Le),setTimeout(fe,20)};De(window,"mouseup",Le)}else setTimeout(fe,50)},kn.prototype.readOnlyChanged=function(a){a||this.reset(),this.textarea.disabled=a=="nocursor",this.textarea.readOnly=!!a},kn.prototype.setUneditable=function(){},kn.prototype.needsContentAttribute=!1;function vC(a,u){if(u=u?de(u):{},u.value=a.value,!u.tabindex&&a.tabIndex&&(u.tabindex=a.tabIndex),!u.placeholder&&a.placeholder&&(u.placeholder=a.placeholder),u.autofocus==null){var p=it(le(a));u.autofocus=p==a||a.getAttribute("autofocus")!=null&&p==document.body}function h(){a.value=A.getValue()}var m;if(a.form&&(De(a.form,"submit",h),!u.leaveSubmitMethodAlone)){var S=a.form;m=S.submit;try{var O=S.submit=function(){h(),S.submit=m,S.submit(),S.submit=O}}catch{}}u.finishInit=function(L){L.save=h,L.getTextArea=function(){return a},L.toTextArea=function(){L.toTextArea=isNaN,h(),a.parentNode.removeChild(L.getWrapperElement()),a.style.display="",a.form&&(Ke(a.form,"submit",h),!u.leaveSubmitMethodAlone&&typeof a.form.submit=="function"&&(a.form.submit=m))}},a.style.display="none";var A=yn(function(L){return a.parentNode.insertBefore(L,a.nextSibling)},u);return A}function gC(a){a.off=Ke,a.on=De,a.wheelEventPixels=SE,a.Doc=mr,a.splitLines=Cn,a.countColumn=ke,a.findColumn=Yt,a.isWordChar=ue,a.Pass=Ot,a.signal=Ze,a.Line=ha,a.changeEnd=fo,a.scrollbarModel=fv,a.Pos=ve,a.cmpPos=be,a.modes=Fr,a.mimeModes=zn,a.resolveMode=Ar,a.getMode=qr,a.modeExtensions=Tr,a.extendMode=zr,a.copyState=K,a.startState=Ve,a.innerMode=me,a.commands=Ys,a.keyMap=Zi,a.keyName=Zv,a.isModifierKey=qv,a.lookupKey=Oa,a.normalizeKeyMap=VE,a.StringStream=rt,a.SharedTextMarker=Vs,a.TextMarker=po,a.LineWidget=Us,a.e_preventDefault=vt,a.e_stopPropagation=St,a.e_stop=Xt,a.addClass=Oe,a.contains=ye,a.rmClass=ee,a.keyNames=vo}sC(yn),cC(yn);var mC="iter insert remove copy getEditor constructor".split(" ");for(var ku in mr.prototype)mr.prototype.hasOwnProperty(ku)&&Ie(mC,ku)<0&&(yn.prototype[ku]=function(a){return function(){return a.apply(this.doc,arguments)}}(mr.prototype[ku]));return Ue(mr),yn.inputStyles={textarea:kn,contenteditable:dn},yn.defineMode=function(a){!yn.defaults.mode&&a!="null"&&(yn.defaults.mode=a),or.apply(this,arguments)},yn.defineMIME=ar,yn.defineMode("null",function(){return{token:function(a){return a.skipToEnd()}}}),yn.defineMIME("text/plain","null"),yn.defineExtension=function(a,u){yn.prototype[a]=u},yn.defineDocExtension=function(a,u){mr.prototype[a]=u},yn.fromTextArea=vC,gC(yn),yn.version="5.65.19",yn})}(Qu)),Qu.exports}var Sg;function JN(){return Sg||(Sg=1,function(r,e){(function(t){t(No())})(function(t){t.defineMode("javascript",function(n,i){var o=n.indentUnit,s=i.statementIndent,l=i.jsonld,d=i.json||l,c=i.trackScope!==!1,f=i.typescript,v=i.wordCharacters||/[\w$\xa1-\uffff]/,g=function(){function N(mt){return{type:mt,style:"keyword"}}var V=N("keyword a"),ce=N("keyword b"),Ce=N("keyword c"),ve=N("keyword d"),be=N("operator"),nt={type:"atom",style:"atom"};return{if:N("if"),while:V,with:V,else:ce,do:ce,try:ce,finally:ce,return:ve,break:ve,continue:ve,new:N("new"),delete:Ce,void:Ce,throw:Ce,debugger:N("debugger"),var:N("var"),const:N("var"),let:N("var"),function:N("function"),catch:N("catch"),for:N("for"),switch:N("switch"),case:N("case"),default:N("default"),in:be,typeof:be,instanceof:be,true:nt,false:nt,null:nt,undefined:nt,NaN:nt,Infinity:nt,this:N("this"),class:N("class"),super:N("atom"),yield:Ce,export:N("export"),import:N("import"),extends:Ce,await:Ce}}(),y=/[+\-*&%=<>!?|~^@]/,b=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function x(N){for(var V=!1,ce,Ce=!1;(ce=N.next())!=null;){if(!V){if(ce=="/"&&!Ce)return;ce=="["?Ce=!0:Ce&&ce=="]"&&(Ce=!1)}V=!V&&ce=="\\"}}var w,_;function C(N,V,ce){return w=N,_=ce,V}function k(N,V){var ce=N.next();if(ce=='"'||ce=="'")return V.tokenize=D(ce),V.tokenize(N,V);if(ce=="."&&N.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return C("number","number");if(ce=="."&&N.match(".."))return C("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(ce))return C(ce);if(ce=="="&&N.eat(">"))return C("=>","operator");if(ce=="0"&&N.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return C("number","number");if(/\d/.test(ce))return N.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),C("number","number");if(ce=="/")return N.eat("*")?(V.tokenize=R,R(N,V)):N.eat("/")?(N.skipToEnd(),C("comment","comment")):J(N,V,1)?(x(N),N.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),C("regexp","string-2")):(N.eat("="),C("operator","operator",N.current()));if(ce=="`")return V.tokenize=$,$(N,V);if(ce=="#"&&N.peek()=="!")return N.skipToEnd(),C("meta","meta");if(ce=="#"&&N.eatWhile(v))return C("variable","property");if(ce=="<"&&N.match("!--")||ce=="-"&&N.match("->")&&!/\S/.test(N.string.slice(0,N.start)))return N.skipToEnd(),C("comment","comment");if(y.test(ce))return(ce!=">"||!V.lexical||V.lexical.type!=">")&&(N.eat("=")?(ce=="!"||ce=="=")&&N.eat("="):/[<>*+\-|&?]/.test(ce)&&(N.eat(ce),ce==">"&&N.eat(ce))),ce=="?"&&N.eat(".")?C("."):C("operator","operator",N.current());if(v.test(ce)){N.eatWhile(v);var Ce=N.current();if(V.lastType!="."){if(g.propertyIsEnumerable(Ce)){var ve=g[Ce];return C(ve.type,ve.style,Ce)}if(Ce=="async"&&N.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return C("async","keyword",Ce)}return C("variable","variable",Ce)}}function D(N){return function(V,ce){var Ce=!1,ve;if(l&&V.peek()=="@"&&V.match(b))return ce.tokenize=k,C("jsonld-keyword","meta");for(;(ve=V.next())!=null&&!(ve==N&&!Ce);)Ce=!Ce&&ve=="\\";return Ce||(ce.tokenize=k),C("string","string")}}function R(N,V){for(var ce=!1,Ce;Ce=N.next();){if(Ce=="/"&&ce){V.tokenize=k;break}ce=Ce=="*"}return C("comment","comment")}function $(N,V){for(var ce=!1,Ce;(Ce=N.next())!=null;){if(!ce&&(Ce=="`"||Ce=="$"&&N.eat("{"))){V.tokenize=k;break}ce=!ce&&Ce=="\\"}return C("quasi","string-2",N.current())}var P="([{}])";function I(N,V){V.fatArrowAt&&(V.fatArrowAt=null);var ce=N.string.indexOf("=>",N.start);if(!(ce<0)){if(f){var Ce=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(N.string.slice(N.start,ce));Ce&&(ce=Ce.index)}for(var ve=0,be=!1,nt=ce-1;nt>=0;--nt){var mt=N.string.charAt(nt),Lt=P.indexOf(mt);if(Lt>=0&&Lt<3){if(!ve){++nt;break}if(--ve==0){mt=="("&&(be=!0);break}}else if(Lt>=3&&Lt<6)++ve;else if(v.test(mt))be=!0;else if(/["'\/`]/.test(mt))for(;;--nt){if(nt==0)return;var On=N.string.charAt(nt-1);if(On==mt&&N.string.charAt(nt-2)!="\\"){nt--;break}}else if(be&&!ve){++nt;break}}be&&!ve&&(V.fatArrowAt=nt)}}var W={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function se(N,V,ce,Ce,ve,be){this.indented=N,this.column=V,this.type=ce,this.prev=ve,this.info=be,Ce!=null&&(this.align=Ce)}function q(N,V){if(!c)return!1;for(var ce=N.localVars;ce;ce=ce.next)if(ce.name==V)return!0;for(var Ce=N.context;Ce;Ce=Ce.prev)for(var ce=Ce.vars;ce;ce=ce.next)if(ce.name==V)return!0}function ee(N,V,ce,Ce,ve){var be=N.cc;for(T.state=N,T.stream=ve,T.marked=null,T.cc=be,T.style=V,N.lexical.hasOwnProperty("align")||(N.lexical.align=!0);;){var nt=be.length?be.pop():d?Ie:ke;if(nt(ce,Ce)){for(;be.length&&be[be.length-1].lex;)be.pop()();return T.marked?T.marked:ce=="variable"&&q(N,Ce)?"variable-2":V}}}var T={state:null,marked:null,cc:null};function z(){for(var N=arguments.length-1;N>=0;N--)T.cc.push(arguments[N])}function B(){return z.apply(null,arguments),!0}function pe(N,V){for(var ce=V;ce;ce=ce.next)if(ce.name==N)return!0;return!1}function Ee(N){var V=T.state;if(T.marked="def",!!c){if(V.context){if(V.lexical.info=="var"&&V.context&&V.context.block){var ce=ye(N,V.context);if(ce!=null){V.context=ce;return}}else if(!pe(N,V.localVars)){V.localVars=new he(N,V.localVars);return}}i.globalVars&&!pe(N,V.globalVars)&&(V.globalVars=new he(N,V.globalVars))}}function ye(N,V){if(V)if(V.block){var ce=ye(N,V.prev);return ce?ce==V.prev?V:new Oe(ce,V.vars,!0):null}else return pe(N,V.vars)?V:new Oe(V.prev,new he(N,V.vars),!1);else return null}function it(N){return N=="public"||N=="private"||N=="protected"||N=="abstract"||N=="readonly"}function Oe(N,V,ce){this.prev=N,this.vars=V,this.block=ce}function he(N,V){this.name=N,this.next=V}var We=new he("this",new he("arguments",null));function Re(){T.state.context=new Oe(T.state.context,T.state.localVars,!1),T.state.localVars=We}function Ge(){T.state.context=new Oe(T.state.context,T.state.localVars,!0),T.state.localVars=null}Re.lex=Ge.lex=!0;function le(){T.state.localVars=T.state.context.vars,T.state.context=T.state.context.prev}le.lex=!0;function G(N,V){var ce=function(){var Ce=T.state,ve=Ce.indented;if(Ce.lexical.type=="stat")ve=Ce.lexical.indented;else for(var be=Ce.lexical;be&&be.type==")"&&be.align;be=be.prev)ve=be.indented;Ce.lexical=new se(ve,T.stream.column(),N,null,Ce.lexical,V)};return ce.lex=!0,ce}function oe(){var N=T.state;N.lexical.prev&&(N.lexical.type==")"&&(N.indented=N.lexical.indented),N.lexical=N.lexical.prev)}oe.lex=!0;function de(N){function V(ce){return ce==N?B():N==";"||ce=="}"||ce==")"||ce=="]"?z():B(V)}return V}function ke(N,V){return N=="var"?B(G("vardef",V),St,de(";"),oe):N=="keyword a"?B(G("form"),Ot,ke,oe):N=="keyword b"?B(G("form"),ke,oe):N=="keyword d"?T.stream.match(/^\s*$/,!1)?B():B(G("stat"),It,de(";"),oe):N=="debugger"?B(de(";")):N=="{"?B(G("}"),Ge,ht,oe,le):N==";"?B():N=="if"?(T.state.lexical.info=="else"&&T.state.cc[T.state.cc.length-1]==oe&&T.state.cc.pop()(),B(G("form"),Ot,ke,oe,Yr)):N=="function"?B(Cn):N=="for"?B(G("form"),Ge,Kr,ke,le,oe):N=="class"||f&&V=="interface"?(T.marked="keyword",B(G("form",N=="class"?N:V),Fr,oe)):N=="variable"?f&&V=="declare"?(T.marked="keyword",B(ke)):f&&(V=="module"||V=="enum"||V=="type")&&T.stream.match(/^\s*\w/,!1)?(T.marked="keyword",V=="enum"?B(Xe):V=="type"?B(si,de("operator"),ot,de(";")):B(G("form"),Ut,de("{"),G("}"),ht,oe,oe)):f&&V=="namespace"?(T.marked="keyword",B(G("form"),Ie,ke,oe)):f&&V=="abstract"?(T.marked="keyword",B(ke)):B(G("stat"),ne):N=="switch"?B(G("form"),Ot,de("{"),G("}","switch"),Ge,ht,oe,oe,le):N=="case"?B(Ie,de(":")):N=="default"?B(de(":")):N=="catch"?B(G("form"),Re,Ye,ke,oe,le):N=="export"?B(G("stat"),Ar,oe):N=="import"?B(G("stat"),Tr,oe):N=="async"?B(ke):V=="@"?B(Ie,ke):z(G("stat"),Ie,de(";"),oe)}function Ye(N){if(N=="(")return B(Tt,de(")"))}function Ie(N,V){return lt(N,V,!1)}function Fe(N,V){return lt(N,V,!0)}function Ot(N){return N!="("?z():B(G(")"),It,de(")"),oe)}function lt(N,V,ce){if(T.state.fatArrowAt==T.stream.start){var Ce=ce?H:M;if(N=="(")return B(Re,G(")"),Je(Tt,")"),oe,de("=>"),Ce,le);if(N=="variable")return z(Re,Ut,de("=>"),Ce,le)}var ve=ce?Yt:_t;return W.hasOwnProperty(N)?B(ve):N=="function"?B(Cn,ve):N=="class"||f&&V=="interface"?(T.marked="keyword",B(G("form"),Ti,oe)):N=="keyword c"||N=="async"?B(ce?Fe:Ie):N=="("?B(G(")"),It,de(")"),oe,ve):N=="operator"||N=="spread"?B(ce?Fe:Ie):N=="["?B(G("]"),rt,oe,ve):N=="{"?ct(we,"}",null,ve):N=="quasi"?z(Kt,ve):N=="new"?B(Z(ce)):B()}function It(N){return N.match(/[;\}\)\],]/)?z():z(Ie)}function _t(N,V){return N==","?B(It):Yt(N,V,!1)}function Yt(N,V,ce){var Ce=ce==!1?_t:Yt,ve=ce==!1?Ie:Fe;if(N=="=>")return B(Re,ce?H:M,le);if(N=="operator")return/\+\+|--/.test(V)||f&&V=="!"?B(Ce):f&&V=="<"&&T.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?B(G(">"),Je(ot,">"),oe,Ce):V=="?"?B(Ie,de(":"),ve):B(ve);if(N=="quasi")return z(Kt,Ce);if(N!=";"){if(N=="(")return ct(Fe,")","call",Ce);if(N==".")return B(ue,Ce);if(N=="[")return B(G("]"),It,de("]"),oe,Ce);if(f&&V=="as")return T.marked="keyword",B(ot,Ce);if(N=="regexp")return T.state.lastType=T.marked="operator",T.stream.backUp(T.stream.pos-T.stream.start-1),B(ve)}}function Kt(N,V){return N!="quasi"?z():V.slice(V.length-2)!="${"?B(Kt):B(It,Q)}function Q(N){if(N=="}")return T.marked="string-2",T.state.tokenize=$,B(Kt)}function M(N){return I(T.stream,T.state),z(N=="{"?ke:Ie)}function H(N){return I(T.stream,T.state),z(N=="{"?ke:Fe)}function Z(N){return function(V){return V=="."?B(N?re:X):V=="variable"&&f?B(_e,N?Yt:_t):z(N?Fe:Ie)}}function X(N,V){if(V=="target")return T.marked="keyword",B(_t)}function re(N,V){if(V=="target")return T.marked="keyword",B(Yt)}function ne(N){return N==":"?B(oe,ke):z(_t,de(";"),oe)}function ue(N){if(N=="variable")return T.marked="property",B()}function we(N,V){if(N=="async")return T.marked="property",B(we);if(N=="variable"||T.style=="keyword"){if(T.marked="property",V=="get"||V=="set")return B(Se);var ce;return f&&T.state.fatArrowAt==T.stream.start&&(ce=T.stream.match(/^\s*:\s*/,!1))&&(T.state.fatArrowAt=T.stream.pos+ce[0].length),B(Pe)}else{if(N=="number"||N=="string")return T.marked=l?"property":T.style+" property",B(Pe);if(N=="jsonld-keyword")return B(Pe);if(f&&it(V))return T.marked="keyword",B(we);if(N=="[")return B(Ie,Pt,de("]"),Pe);if(N=="spread")return B(Fe,Pe);if(V=="*")return T.marked="keyword",B(we);if(N==":")return z(Pe)}}function Se(N){return N!="variable"?z(Pe):(T.marked="property",B(Cn))}function Pe(N){if(N==":")return B(Fe);if(N=="(")return z(Cn)}function Je(N,V,ce){function Ce(ve,be){if(ce?ce.indexOf(ve)>-1:ve==","){var nt=T.state.lexical;return nt.info=="call"&&(nt.pos=(nt.pos||0)+1),B(function(mt,Lt){return mt==V||Lt==V?z():z(N)},Ce)}return ve==V||be==V?B():ce&&ce.indexOf(";")>-1?z(N):B(de(V))}return function(ve,be){return ve==V||be==V?B():z(N,Ce)}}function ct(N,V,ce){for(var Ce=3;Ce<arguments.length;Ce++)T.cc.push(arguments[Ce]);return B(G(V,ce),Je(N,V),oe)}function ht(N){return N=="}"?B():z(ke,ht)}function Pt(N,V){if(f){if(N==":")return B(ot);if(V=="?")return B(Pt)}}function qe(N,V){if(f&&(N==":"||V=="in"))return B(ot)}function ut(N){if(f&&N==":")return T.stream.match(/^\s*\w+\s+is\b/,!1)?B(Ie,Rt,ot):B(ot)}function Rt(N,V){if(V=="is")return T.marked="keyword",B()}function ot(N,V){if(V=="keyof"||V=="typeof"||V=="infer"||V=="readonly")return T.marked="keyword",B(V=="typeof"?Fe:ot);if(N=="variable"||V=="void")return T.marked="type",B(wt);if(V=="|"||V=="&")return B(ot);if(N=="string"||N=="number"||N=="atom")return B(wt);if(N=="[")return B(G("]"),Je(ot,"]",","),oe,wt);if(N=="{")return B(G("}"),De,oe,wt);if(N=="(")return B(Je(tt,")"),je,wt);if(N=="<")return B(Je(ot,">"),ot);if(N=="quasi")return z(Ke,wt)}function je(N){if(N=="=>")return B(ot)}function De(N){return N.match(/[\}\)\]]/)?B():N==","||N==";"?B(De):z(pt,De)}function pt(N,V){if(N=="variable"||T.style=="keyword")return T.marked="property",B(pt);if(V=="?"||N=="number"||N=="string")return B(pt);if(N==":")return B(ot);if(N=="[")return B(de("variable"),qe,de("]"),pt);if(N=="(")return z(Nr,pt);if(!N.match(/[;\}\)\],]/))return B()}function Ke(N,V){return N!="quasi"?z():V.slice(V.length-2)!="${"?B(Ke):B(ot,Ze)}function Ze(N){if(N=="}")return T.marked="string-2",T.state.tokenize=$,B(Ke)}function tt(N,V){return N=="variable"&&T.stream.match(/^\s*[?:]/,!1)||V=="?"?B(tt):N==":"?B(ot):N=="spread"?B(tt):z(ot)}function wt(N,V){if(V=="<")return B(G(">"),Je(ot,">"),oe,wt);if(V=="|"||N=="."||V=="&")return B(ot);if(N=="[")return B(ot,de("]"),wt);if(V=="extends"||V=="implements")return T.marked="keyword",B(ot);if(V=="?")return B(ot,de(":"),ot)}function _e(N,V){if(V=="<")return B(G(">"),Je(ot,">"),oe,wt)}function Ue(){return z(ot,vt)}function vt(N,V){if(V=="=")return B(ot)}function St(N,V){return V=="enum"?(T.marked="keyword",B(Xe)):z(Ut,Pt,gn,Fn)}function Ut(N,V){if(f&&it(V))return T.marked="keyword",B(Ut);if(N=="variable")return Ee(V),B();if(N=="spread")return B(Ut);if(N=="[")return ct(Zn,"]");if(N=="{")return ct(Xt,"}")}function Xt(N,V){return N=="variable"&&!T.stream.match(/^\s*:/,!1)?(Ee(V),B(gn)):(N=="variable"&&(T.marked="property"),N=="spread"?B(Ut):N=="}"?z():N=="["?B(Ie,de("]"),de(":"),Xt):B(de(":"),Ut,gn))}function Zn(){return z(Ut,gn)}function gn(N,V){if(V=="=")return B(Fe)}function Fn(N){if(N==",")return B(St)}function Yr(N,V){if(N=="keyword b"&&V=="else")return B(G("form","else"),ke,oe)}function Kr(N,V){if(V=="await")return B(Kr);if(N=="(")return B(G(")"),Zt,oe)}function Zt(N){return N=="var"?B(St,Mr):N=="variable"?B(Mr):z(Mr)}function Mr(N,V){return N==")"?B():N==";"?B(Mr):V=="in"||V=="of"?(T.marked="keyword",B(Ie,Mr)):z(Ie,Mr)}function Cn(N,V){if(V=="*")return T.marked="keyword",B(Cn);if(N=="variable")return Ee(V),B(Cn);if(N=="(")return B(Re,G(")"),Je(Tt,")"),oe,ut,ke,le);if(f&&V=="<")return B(G(">"),Je(Ue,">"),oe,Cn)}function Nr(N,V){if(V=="*")return T.marked="keyword",B(Nr);if(N=="variable")return Ee(V),B(Nr);if(N=="(")return B(Re,G(")"),Je(Tt,")"),oe,ut,le);if(f&&V=="<")return B(G(">"),Je(Ue,">"),oe,Nr)}function si(N,V){if(N=="keyword"||N=="variable")return T.marked="type",B(si);if(V=="<")return B(G(">"),Je(Ue,">"),oe)}function Tt(N,V){return V=="@"&&B(Ie,Tt),N=="spread"?B(Tt):f&&it(V)?(T.marked="keyword",B(Tt)):f&&N=="this"?B(Pt,gn):z(Ut,Pt,gn)}function Ti(N,V){return N=="variable"?Fr(N,V):zn(N,V)}function Fr(N,V){if(N=="variable")return Ee(V),B(zn)}function zn(N,V){if(V=="<")return B(G(">"),Je(Ue,">"),oe,zn);if(V=="extends"||V=="implements"||f&&N==",")return V=="implements"&&(T.marked="keyword"),B(f?ot:Ie,zn);if(N=="{")return B(G("}"),or,oe)}function or(N,V){if(N=="async"||N=="variable"&&(V=="static"||V=="get"||V=="set"||f&&it(V))&&T.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return T.marked="keyword",B(or);if(N=="variable"||T.style=="keyword")return T.marked="property",B(ar,or);if(N=="number"||N=="string")return B(ar,or);if(N=="[")return B(Ie,Pt,de("]"),ar,or);if(V=="*")return T.marked="keyword",B(or);if(f&&N=="(")return z(Nr,or);if(N==";"||N==",")return B(or);if(N=="}")return B();if(V=="@")return B(Ie,or)}function ar(N,V){if(V=="!"||V=="?")return B(ar);if(N==":")return B(ot,gn);if(V=="=")return B(Fe);var ce=T.state.lexical.prev,Ce=ce&&ce.info=="interface";return z(Ce?Nr:Cn)}function Ar(N,V){return V=="*"?(T.marked="keyword",B(Ve,de(";"))):V=="default"?(T.marked="keyword",B(Ie,de(";"))):N=="{"?B(Je(qr,"}"),Ve,de(";")):z(ke)}function qr(N,V){if(V=="as")return T.marked="keyword",B(de("variable"));if(N=="variable")return z(Fe,qr)}function Tr(N){return N=="string"?B():N=="("?z(Ie):N=="."?z(_t):z(zr,K,Ve)}function zr(N,V){return N=="{"?ct(zr,"}"):(N=="variable"&&Ee(V),V=="*"&&(T.marked="keyword"),B(me))}function K(N){if(N==",")return B(zr,K)}function me(N,V){if(V=="as")return T.marked="keyword",B(zr)}function Ve(N,V){if(V=="from")return T.marked="keyword",B(Ie)}function rt(N){return N=="]"?B():z(Je(Fe,"]"))}function Xe(){return z(G("form"),Ut,de("{"),G("}"),Je(Ft,"}"),oe,oe)}function Ft(){return z(Ut,gn)}function pn(N,V){return N.lastType=="operator"||N.lastType==","||y.test(V.charAt(0))||/[,.]/.test(V.charAt(0))}function J(N,V,ce){return V.tokenize==k&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(V.lastType)||V.lastType=="quasi"&&/\{\s*$/.test(N.string.slice(0,N.pos-(ce||0)))}return{startState:function(N){var V={tokenize:k,lastType:"sof",cc:[],lexical:new se((N||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new Oe(null,null,!1),indented:N||0};return i.globalVars&&typeof i.globalVars=="object"&&(V.globalVars=i.globalVars),V},token:function(N,V){if(N.sol()&&(V.lexical.hasOwnProperty("align")||(V.lexical.align=!1),V.indented=N.indentation(),I(N,V)),V.tokenize!=R&&N.eatSpace())return null;var ce=V.tokenize(N,V);return w=="comment"?ce:(V.lastType=w=="operator"&&(_=="++"||_=="--")?"incdec":w,ee(V,ce,w,_,N))},indent:function(N,V){if(N.tokenize==R||N.tokenize==$)return t.Pass;if(N.tokenize!=k)return 0;var ce=V&&V.charAt(0),Ce=N.lexical,ve;if(!/^\s*else\b/.test(V))for(var be=N.cc.length-1;be>=0;--be){var nt=N.cc[be];if(nt==oe)Ce=Ce.prev;else if(nt!=Yr&&nt!=le)break}for(;(Ce.type=="stat"||Ce.type=="form")&&(ce=="}"||(ve=N.cc[N.cc.length-1])&&(ve==_t||ve==Yt)&&!/^[,\.=+\-*:?[\(]/.test(V));)Ce=Ce.prev;s&&Ce.type==")"&&Ce.prev.type=="stat"&&(Ce=Ce.prev);var mt=Ce.type,Lt=ce==mt;return mt=="vardef"?Ce.indented+(N.lastType=="operator"||N.lastType==","?Ce.info.length+1:0):mt=="form"&&ce=="{"?Ce.indented:mt=="form"?Ce.indented+o:mt=="stat"?Ce.indented+(pn(N,V)?s||o:0):Ce.info=="switch"&&!Lt&&i.doubleIndentSwitch!=!1?Ce.indented+(/^(?:case|default)\b/.test(V)?o:2*o):Ce.align?Ce.column+(Lt?0:1):Ce.indented+(Lt?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:d?null:"/*",blockCommentEnd:d?null:"*/",blockCommentContinue:d?null:" * ",lineComment:d?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:d?"json":"javascript",jsonldMode:l,jsonMode:d,expressionAllowed:J,skipExpression:function(N){ee(N,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),xg.exports}JN();var Eg={exports:{}},Cg;function C1(){return Cg||(Cg=1,function(r,e){(function(t){t(No())})(function(t){function n(l,d,c,f){if(c&&c.call){var v=c;c=null}else var v=s(l,c,"rangeFinder");typeof d=="number"&&(d=t.Pos(d,0));var g=s(l,c,"minFoldSize");function y(_){var C=v(l,d);if(!C||C.to.line-C.from.line<g)return null;if(f==="fold")return C;for(var k=l.findMarksAt(C.from),D=0;D<k.length;++D)if(k[D].__isFold){if(!_)return null;C.cleared=!0,k[D].clear()}return C}var b=y(!0);if(s(l,c,"scanUp"))for(;!b&&d.line>l.firstLine();)d=t.Pos(d.line-1,0),b=y(!1);if(!(!b||b.cleared||f==="unfold")){var x=i(l,c,b);t.on(x,"mousedown",function(_){w.clear(),t.e_preventDefault(_)});var w=l.markText(b.from,b.to,{replacedWith:x,clearOnEnter:s(l,c,"clearOnEnter"),__isFold:!0});w.on("clear",function(_,C){t.signal(l,"unfold",l,_,C)}),t.signal(l,"fold",l,b.from,b.to)}}function i(l,d,c){var f=s(l,d,"widget");if(typeof f=="function"&&(f=f(c.from,c.to)),typeof f=="string"){var v=document.createTextNode(f);f=document.createElement("span"),f.appendChild(v),f.className="CodeMirror-foldmarker"}else f&&(f=f.cloneNode(!0));return f}t.newFoldFunction=function(l,d){return function(c,f){n(c,f,{rangeFinder:l,widget:d})}},t.defineExtension("foldCode",function(l,d,c){n(this,l,d,c)}),t.defineExtension("isFolded",function(l){for(var d=this.findMarksAt(l),c=0;c<d.length;++c)if(d[c].__isFold)return!0}),t.commands.toggleFold=function(l){l.foldCode(l.getCursor())},t.commands.fold=function(l){l.foldCode(l.getCursor(),null,"fold")},t.commands.unfold=function(l){l.foldCode(l.getCursor(),{scanUp:!1},"unfold")},t.commands.foldAll=function(l){l.operation(function(){for(var d=l.firstLine(),c=l.lastLine();d<=c;d++)l.foldCode(t.Pos(d,0),{scanUp:!1},"fold")})},t.commands.unfoldAll=function(l){l.operation(function(){for(var d=l.firstLine(),c=l.lastLine();d<=c;d++)l.foldCode(t.Pos(d,0),{scanUp:!1},"unfold")})},t.registerHelper("fold","combine",function(){var l=Array.prototype.slice.call(arguments,0);return function(d,c){for(var f=0;f<l.length;++f){var v=l[f](d,c);if(v)return v}}}),t.registerHelper("fold","auto",function(l,d){for(var c=l.getHelpers(d,"fold"),f=0;f<c.length;f++){var v=c[f](l,d);if(v)return v}});var o={rangeFinder:t.fold.auto,widget:"↔",minFoldSize:0,scanUp:!1,clearOnEnter:!0};t.defineOption("foldOptions",null);function s(l,d,c){if(d&&d[c]!==void 0)return d[c];var f=l.options.foldOptions;return f&&f[c]!==void 0?f[c]:o[c]}t.defineExtension("foldOption",function(l,d){return s(this,l,d)})})}()),Eg.exports}C1();var Og={exports:{}},kg;function ZN(){return kg||(kg=1,function(r,e){(function(t){t(No(),C1())})(function(t){t.defineOption("foldGutter",!1,function(w,_,C){C&&C!=t.Init&&(w.clearGutter(w.state.foldGutter.options.gutter),w.state.foldGutter=null,w.off("gutterClick",v),w.off("changes",y),w.off("viewportChange",b),w.off("fold",x),w.off("unfold",x),w.off("swapDoc",y),w.off("optionChange",g)),_&&(w.state.foldGutter=new i(o(_)),f(w),w.on("gutterClick",v),w.on("changes",y),w.on("viewportChange",b),w.on("fold",x),w.on("unfold",x),w.on("swapDoc",y),w.on("optionChange",g))});var n=t.Pos;function i(w){this.options=w,this.from=this.to=0}function o(w){return w===!0&&(w={}),w.gutter==null&&(w.gutter="CodeMirror-foldgutter"),w.indicatorOpen==null&&(w.indicatorOpen="CodeMirror-foldgutter-open"),w.indicatorFolded==null&&(w.indicatorFolded="CodeMirror-foldgutter-folded"),w}function s(w,_){for(var C=w.findMarks(n(_,0),n(_+1,0)),k=0;k<C.length;++k)if(C[k].__isFold){var D=C[k].find(-1);if(D&&D.line===_)return C[k]}}function l(w){if(typeof w=="string"){var _=document.createElement("div");return _.className=w+" CodeMirror-guttermarker-subtle",_}else return w.cloneNode(!0)}function d(w,_,C){var k=w.state.foldGutter.options,D=_-1,R=w.foldOption(k,"minFoldSize"),$=w.foldOption(k,"rangeFinder"),P=typeof k.indicatorFolded=="string"&&c(k.indicatorFolded),I=typeof k.indicatorOpen=="string"&&c(k.indicatorOpen);w.eachLine(_,C,function(W){++D;var se=null,q=W.gutterMarkers;if(q&&(q=q[k.gutter]),s(w,D)){if(P&&q&&P.test(q.className))return;se=l(k.indicatorFolded)}else{var ee=n(D,0),T=$&&$(w,ee);if(T&&T.to.line-T.from.line>=R){if(I&&q&&I.test(q.className))return;se=l(k.indicatorOpen)}}!se&&!q||w.setGutterMarker(W,k.gutter,se)})}function c(w){return new RegExp("(^|\\s)"+w+"(?:$|\\s)\\s*")}function f(w){var _=w.getViewport(),C=w.state.foldGutter;C&&(w.operation(function(){d(w,_.from,_.to)}),C.from=_.from,C.to=_.to)}function v(w,_,C){var k=w.state.foldGutter;if(k){var D=k.options;if(C==D.gutter){var R=s(w,_);R?R.clear():w.foldCode(n(_,0),D)}}}function g(w,_){_=="mode"&&y(w)}function y(w){var _=w.state.foldGutter;if(_){var C=_.options;_.from=_.to=0,clearTimeout(_.changeUpdate),_.changeUpdate=setTimeout(function(){f(w)},C.foldOnChangeTimeSpan||600)}}function b(w){var _=w.state.foldGutter;if(_){var C=_.options;clearTimeout(_.changeUpdate),_.changeUpdate=setTimeout(function(){var k=w.getViewport();_.from==_.to||k.from-_.to>20||_.from-k.to>20?f(w):w.operation(function(){k.from<_.from&&(d(w,k.from,_.from),_.from=k.from),k.to>_.to&&(d(w,_.to,k.to),_.to=k.to)})},C.updateViewportTimeSpan||400)}}function x(w,_){var C=w.state.foldGutter;if(C){var k=_.line;k>=C.from&&k<C.to&&d(w,k,k+1)}}})}()),Og.exports}ZN();var Mg={exports:{}},Ng;function QN(){return Ng||(Ng=1,function(r,e){(function(t){t(No())})(function(t){function n(i){return function(o,s){var l=s.line,d=o.getLine(l);function c(x){for(var w,_=s.ch,C=0;;){var k=_<=0?-1:d.lastIndexOf(x[0],_-1);if(k==-1){if(C==1)break;C=1,_=d.length;continue}if(C==1&&k<s.ch)break;if(w=o.getTokenTypeAt(t.Pos(l,k+1)),!/^(comment|string)/.test(w))return{ch:k+1,tokenType:w,pair:x};_=k-1}}function f(x){var w=1,_=o.lastLine(),C,k=x.ch,D;e:for(var R=l;R<=_;++R)for(var $=o.getLine(R),P=R==l?k:0;;){var I=$.indexOf(x.pair[0],P),W=$.indexOf(x.pair[1],P);if(I<0&&(I=$.length),W<0&&(W=$.length),P=Math.min(I,W),P==$.length)break;if(o.getTokenTypeAt(t.Pos(R,P+1))==x.tokenType){if(P==I)++w;else if(!--w){C=R,D=P;break e}}++P}return C==null||l==C?null:{from:t.Pos(l,k),to:t.Pos(C,D)}}for(var v=[],g=0;g<i.length;g++){var y=c(i[g]);y&&v.push(y)}v.sort(function(x,w){return x.ch-w.ch});for(var g=0;g<v.length;g++){var b=f(v[g]);if(b)return b}return null}}t.registerHelper("fold","brace",n([["{","}"],["[","]"]])),t.registerHelper("fold","brace-paren",n([["{","}"],["[","]"],["(",")"]])),t.registerHelper("fold","import",function(i,o){function s(g){if(g<i.firstLine()||g>i.lastLine())return null;var y=i.getTokenAt(t.Pos(g,1));if(/\S/.test(y.string)||(y=i.getTokenAt(t.Pos(g,y.end+1))),y.type!="keyword"||y.string!="import")return null;for(var b=g,x=Math.min(i.lastLine(),g+10);b<=x;++b){var w=i.getLine(b),_=w.indexOf(";");if(_!=-1)return{startCh:y.end,end:t.Pos(b,_)}}}var l=o.line,d=s(l),c;if(!d||s(l-1)||(c=s(l-2))&&c.end.line==l-1)return null;for(var f=d.end;;){var v=s(f.line+1);if(v==null)break;f=v.end}return{from:i.clipPos(t.Pos(l,d.startCh+1)),to:f}}),t.registerHelper("fold","include",function(i,o){function s(v){if(v<i.firstLine()||v>i.lastLine())return null;var g=i.getTokenAt(t.Pos(v,1));if(/\S/.test(g.string)||(g=i.getTokenAt(t.Pos(v,g.end+1))),g.type=="meta"&&g.string.slice(0,8)=="#include")return g.start+8}var l=o.line,d=s(l);if(d==null||s(l-1)!=null)return null;for(var c=l;;){var f=s(c+1);if(f==null)break;++c}return{from:t.Pos(l,d+1),to:i.clipPos(t.Pos(c))}})})}()),Mg.exports}QN();var Ag={exports:{}},Tg;function eA(){return Tg||(Tg=1,function(r,e){(function(t){t(No())})(function(t){var n="CodeMirror-activeline",i="CodeMirror-activeline-background",o="CodeMirror-activeline-gutter";t.defineOption("styleActiveLine",!1,function(f,v,g){var y=g==t.Init?!1:g;v!=y&&(y&&(f.off("beforeSelectionChange",c),s(f),delete f.state.activeLines),v&&(f.state.activeLines=[],d(f,f.listSelections()),f.on("beforeSelectionChange",c)))});function s(f){for(var v=0;v<f.state.activeLines.length;v++)f.removeLineClass(f.state.activeLines[v],"wrap",n),f.removeLineClass(f.state.activeLines[v],"background",i),f.removeLineClass(f.state.activeLines[v],"gutter",o)}function l(f,v){if(f.length!=v.length)return!1;for(var g=0;g<f.length;g++)if(f[g]!=v[g])return!1;return!0}function d(f,v){for(var g=[],y=0;y<v.length;y++){var b=v[y],x=f.getOption("styleActiveLine");if(!(typeof x=="object"&&x.nonEmpty?b.anchor.line!=b.head.line:!b.empty())){var w=f.getLineHandleVisualStart(b.head.line);g[g.length-1]!=w&&g.push(w)}}l(f.state.activeLines,g)||f.operation(function(){s(f);for(var _=0;_<g.length;_++)f.addLineClass(g[_],"wrap",n),f.addLineClass(g[_],"background",i),f.addLineClass(g[_],"gutter",o);f.state.activeLines=g})}function c(f,v){d(f,v.ranges)}})}()),Ag.exports}eA();var tA=No();const O1=fs(tA);var Dg={exports:{}},Lg;function nA(){return Lg||(Lg=1,function(r,e){(function(t){t(No())})(function(t){var n=t.Pos,i="http://www.w3.org/2000/svg";function o(M,H){this.mv=M,this.type=H,this.classes=H=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}o.prototype={constructor:o,init:function(M,H,Z){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=t(M,de({value:H,readOnly:!this.mv.options.allowEditingOriginals},de(Z))),this.mv.options.connect=="align"&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new Ot(this.edit)),this.orig.state.trackAlignable=new Ot(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.lockButton.setAttribute("aria-label",this.lockButton.title),this.orig.state.diffViews=[this];var X=Z.chunkClassLocation||"background";Object.prototype.toString.call(X)!="[object Array]"&&(X=[X]),this.classes.classLocation=X,this.diff=pe(z(H),z(Z.value),this.mv.options.ignoreWhitespace),this.chunks=Ee(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=Z.showDifferences!==!1},registerEvents:function(M){this.forceUpdate=d(this),g(this,!0,!1),c(this,M)},setShowDifferences:function(M){M=M!==!1,M!=this.showDifferences&&(this.showDifferences=M,this.forceUpdate("full"))}};function s(M){M.diffOutOfDate&&(M.diff=pe(M.orig.getValue(),M.edit.getValue(),M.mv.options.ignoreWhitespace),M.chunks=Ee(M.diff),M.diffOutOfDate=!1,t.signal(M.edit,"updateDiff",M.diff))}var l=!1;function d(M){var H={from:0,to:0,marked:[]},Z={from:0,to:0,marked:[]},X,re=!1;function ne(Je){l=!0,re=!1,Je=="full"&&(M.svg&&G(M.svg),M.copyButtons&&G(M.copyButtons),b(M.edit,H.marked,M.classes),b(M.orig,Z.marked,M.classes),H.from=H.to=Z.from=Z.to=0),s(M),M.showDifferences&&(x(M.edit,M.diff,H,DIFF_INSERT,M.classes),x(M.orig,M.diff,Z,DIFF_DELETE,M.classes)),M.mv.options.connect=="align"&&P(M),C(M),M.needsScrollSync!=null&&f(M,M.needsScrollSync),l=!1}function ue(Je){l||(M.dealigned=!0,we(Je))}function we(Je){l||re||(clearTimeout(X),Je===!0&&(re=!0),X=setTimeout(ne,Je===!0?20:250))}function Se(Je,ct){M.diffOutOfDate||(M.diffOutOfDate=!0,H.from=H.to=Z.from=Z.to=0),ue(ct.text.length-1!=ct.to.line-ct.from.line)}function Pe(){M.diffOutOfDate=!0,M.dealigned=!0,ne("full")}return M.edit.on("change",Se),M.orig.on("change",Se),M.edit.on("swapDoc",Pe),M.orig.on("swapDoc",Pe),M.mv.options.connect=="align"&&(t.on(M.edit.state.trackAlignable,"realign",ue),t.on(M.orig.state.trackAlignable,"realign",ue)),M.edit.on("viewportChange",function(){we(!1)}),M.orig.on("viewportChange",function(){we(!1)}),ne(),ne}function c(M,H){M.edit.on("scroll",function(){f(M,!0)&&C(M)}),M.orig.on("scroll",function(){f(M,!1)&&C(M),H&&f(H,!0)&&C(H)})}function f(M,H){if(M.diffOutOfDate)return M.lockScroll&&M.needsScrollSync==null&&(M.needsScrollSync=H),!1;if(M.needsScrollSync=null,!M.lockScroll)return!0;var Z,X,re=+new Date;if(H?(Z=M.edit,X=M.orig):(Z=M.orig,X=M.edit),Z.state.scrollSetBy==M&&(Z.state.scrollSetAt||0)+250>re)return!1;var ne=Z.getScrollInfo();if(M.mv.options.connect=="align")Pt=ne.top;else{var ue=.5*ne.clientHeight,we=ne.top+ue,Se=Z.lineAtHeight(we,"local"),Pe=Oe(M.chunks,Se,H),Je=v(Z,H?Pe.edit:Pe.orig),ct=v(X,H?Pe.orig:Pe.edit),ht=(we-Je.top)/(Je.bot-Je.top),Pt=ct.top-ue+ht*(ct.bot-ct.top),qe,ut;if(Pt>ne.top&&(ut=ne.top/ue)<1)Pt=Pt*ut+ne.top*(1-ut);else if((qe=ne.height-ne.clientHeight-ne.top)<ue){var Rt=X.getScrollInfo(),ot=Rt.height-Rt.clientHeight-Pt;ot>qe&&(ut=qe/ue)<1&&(Pt=Pt*ut+(Rt.height-Rt.clientHeight-qe)*(1-ut))}}return X.scrollTo(ne.left,Pt),X.state.scrollSetAt=re,X.state.scrollSetBy=M,!0}function v(M,H){var Z=H.after;return Z==null&&(Z=M.lastLine()+1),{top:M.heightAtLine(H.before||0,"local"),bot:M.heightAtLine(Z,"local")}}function g(M,H,Z){M.lockScroll=H,H&&Z!=!1&&f(M,DIFF_INSERT)&&C(M),(H?t.addClass:t.rmClass)(M.lockButton,"CodeMirror-merge-scrolllock-enabled")}function y(M,H,Z){for(var X=Z.classLocation,re=0;re<X.length;re++)M.removeLineClass(H,X[re],Z.chunk),M.removeLineClass(H,X[re],Z.start),M.removeLineClass(H,X[re],Z.end)}function b(M,H,Z){for(var X=0;X<H.length;++X){var re=H[X];re instanceof t.TextMarker?re.clear():re.parent&&y(M,re,Z)}H.length=0}function x(M,H,Z,X,re){var ne=M.getViewport();M.operation(function(){Z.from==Z.to||ne.from-Z.to>20||Z.from-ne.to>20?(b(M,Z.marked,re),_(M,H,X,Z.marked,ne.from,ne.to,re),Z.from=ne.from,Z.to=ne.to):(ne.from<Z.from&&(_(M,H,X,Z.marked,ne.from,Z.from,re),Z.from=ne.from),ne.to>Z.to&&(_(M,H,X,Z.marked,Z.to,ne.to,re),Z.to=ne.to))})}function w(M,H,Z,X,re,ne){for(var ue=Z.classLocation,we=M.getLineHandle(H),Se=0;Se<ue.length;Se++)X&&M.addLineClass(we,ue[Se],Z.chunk),re&&M.addLineClass(we,ue[Se],Z.start),ne&&M.addLineClass(we,ue[Se],Z.end);return we}function _(M,H,Z,X,re,ne,ue){var we=n(0,0),Se=n(re,0),Pe=M.clipPos(n(ne-1)),Je=Z==DIFF_DELETE?ue.del:ue.insert;function ct(tt,wt){for(var _e=Math.max(re,tt),Ue=Math.min(ne,wt),vt=_e;vt<Ue;++vt)X.push(w(M,vt,ue,!0,vt==tt,vt==wt-1));tt==wt&&_e==wt&&Ue==wt&&(_e?X.push(w(M,_e-1,ue,!1,!1,!0)):X.push(w(M,_e,ue,!1,!0,!1)))}for(var ht=0,Pt=!1,qe=0;qe<H.length;++qe){var ut=H[qe],Rt=ut[0],ot=ut[1];if(Rt==DIFF_EQUAL){var je=we.line+(it(H,qe)?0:1);ke(we,ot);var De=we.line+(ye(H,qe)?1:0);De>je&&(Pt&&(ct(ht,je),Pt=!1),ht=De)}else if(Pt=!0,Rt==Z){var pt=ke(we,ot,!0),Ke=It(Se,we),Ze=lt(Pe,pt);_t(Ke,Ze)||X.push(M.markText(Ke,Ze,{className:Je})),we=pt}}Pt&&ct(ht,we.line+1)}function C(M){if(M.showDifferences){if(M.svg){G(M.svg);var H=M.gap.offsetWidth;oe(M.svg,"width",H,"height",M.gap.offsetHeight)}M.copyButtons&&G(M.copyButtons);for(var Z=M.edit.getViewport(),X=M.orig.getViewport(),re=M.mv.wrap.getBoundingClientRect().top,ne=re-M.edit.getScrollerElement().getBoundingClientRect().top+M.edit.getScrollInfo().top,ue=re-M.orig.getScrollerElement().getBoundingClientRect().top+M.orig.getScrollInfo().top,we=0;we<M.chunks.length;we++){var Se=M.chunks[we];Se.editFrom<=Z.to&&Se.editTo>=Z.from&&Se.origFrom<=X.to&&Se.origTo>=X.from&&se(M,Se,ue,ne,H)}}}function k(M,H){for(var Z=0,X=0,re=0;re<H.length;re++){var ne=H[re];if(ne.editTo>M&&ne.editFrom<=M)return null;if(ne.editFrom>M)break;Z=ne.editTo,X=ne.origTo}return X+(M-Z)}function D(M,H,Z){for(var X=M.state.trackAlignable,re=M.firstLine(),ne=0,ue=[],we=0;;we++){for(var Se=H[we],Pe=Se?Z?Se.origFrom:Se.editFrom:1e9;ne<X.alignable.length;ne+=2){var Je=X.alignable[ne]+1;if(!(Je<=re))if(Je<=Pe)ue.push(Je);else break}if(!Se)break;ue.push(re=Z?Se.origTo:Se.editTo)}return ue}function R(M,H,Z,X){var re=0,ne=0,ue=0,we=0;e:for(;;re++){var Se=M[re],Pe=H[ne];if(!Se&&Pe==null)break;for(var Je=Se?Se[0]:1e9,ct=Pe??1e9;ue<Z.length;){var ht=Z[ue];if(ht.origFrom<=ct&&ht.origTo>ct){ne++,re--;continue e}if(ht.editTo>Je){if(ht.editFrom<=Je)continue e;break}we+=ht.origTo-ht.origFrom-(ht.editTo-ht.editFrom),ue++}if(Je==ct-we)Se[X]=ct,ne++;else if(Je<ct-we)Se[X]=Je+we;else{var Pt=[ct-we,null,null];Pt[X]=ct,M.splice(re,0,Pt),ne++}}}function $(M,H){var Z=D(M.edit,M.chunks,!1),X=[];if(H)for(var re=0,ne=0;re<H.chunks.length;re++){for(var ue=H.chunks[re].editTo;ne<Z.length&&Z[ne]<ue;)ne++;(ne==Z.length||Z[ne]!=ue)&&Z.splice(ne++,0,ue)}for(var re=0;re<Z.length;re++)X.push([Z[re],null,null]);return R(X,D(M.orig,M.chunks,!0),M.chunks,1),H&&R(X,D(H.orig,H.chunks,!0),H.chunks,2),X}function P(M,H){if(!(!M.dealigned&&!H)){if(!M.orig.curOp)return M.orig.operation(function(){P(M,H)});M.dealigned=!1;var Z=M.mv.left==M?M.mv.right:M.mv.left;Z&&(s(Z),Z.dealigned=!1);for(var X=$(M,Z),re=M.mv.aligners,ne=0;ne<re.length;ne++)re[ne].clear();re.length=0;var ue=[M.edit,M.orig],we=[],Se=[];Z&&ue.push(Z.orig);for(var ne=0;ne<ue.length;ne++)we.push(ue[ne].getScrollInfo().top),Se.push(-ue[ne].getScrollerElement().getBoundingClientRect().top);(Se[0]!=Se[1]||ue.length==3&&Se[1]!=Se[2])&&I(ue,Se,[0,0,0],re);for(var Pe=0;Pe<X.length;Pe++)I(ue,Se,X[Pe],re);for(var ne=0;ne<ue.length;ne++)ue[ne].scrollTo(null,we[ne])}}function I(M,H,Z,X){for(var re=-1e8,ne=[],ue=0;ue<M.length;ue++)if(Z[ue]!=null){var we=M[ue].heightAtLine(Z[ue],"local")-H[ue];ne[ue]=we,re=Math.max(re,we)}for(var ue=0;ue<M.length;ue++)if(Z[ue]!=null){var Se=re-ne[ue];Se>1&&X.push(W(M[ue],Z[ue],Se))}}function W(M,H,Z){var X=!0;H>M.lastLine()&&(H--,X=!1);var re=document.createElement("div");return re.className="CodeMirror-merge-spacer",re.style.height=Z+"px",re.style.minWidth="1px",M.addLineWidget(H,re,{height:Z,above:X,mergeSpacer:!0,handleMouseEvents:!0})}function se(M,H,Z,X,re){var ne=M.type=="left",ue=M.orig.heightAtLine(H.origFrom,"local",!0)-Z;if(M.svg){var we=ue,Se=M.edit.heightAtLine(H.editFrom,"local",!0)-X;if(ne){var Pe=we;we=Se,Se=Pe}var Je=M.orig.heightAtLine(H.origTo,"local",!0)-Z,ct=M.edit.heightAtLine(H.editTo,"local",!0)-X;if(ne){var Pe=Je;Je=ct,ct=Pe}var ht=" C "+re/2+" "+Se+" "+re/2+" "+we+" "+(re+2)+" "+we,Pt=" C "+re/2+" "+Je+" "+re/2+" "+ct+" -1 "+ct;oe(M.svg.appendChild(document.createElementNS(i,"path")),"d","M -1 "+Se+ht+" L "+(re+2)+" "+Je+Pt+" z","class",M.classes.connect)}if(M.copyButtons){var qe=M.copyButtons.appendChild(le("div",M.type=="left"?"⇝":"⇜","CodeMirror-merge-copy")),ut=M.mv.options.allowEditingOriginals;if(qe.title=M.edit.phrase(ut?"Push to left":"Revert chunk"),qe.chunk=H,qe.style.top=(H.origTo>H.origFrom?ue:M.edit.heightAtLine(H.editFrom,"local")-X)+"px",qe.setAttribute("role","button"),qe.setAttribute("tabindex","0"),qe.setAttribute("aria-label",qe.title),ut){var Rt=M.edit.heightAtLine(H.editFrom,"local")-X,ot=M.copyButtons.appendChild(le("div",M.type=="right"?"⇝":"⇜","CodeMirror-merge-copy-reverse"));ot.title="Push to right",ot.chunk={editFrom:H.origFrom,editTo:H.origTo,origFrom:H.editFrom,origTo:H.editTo},ot.style.top=Rt+"px",M.type=="right"?ot.style.left="2px":ot.style.right="2px",ot.setAttribute("role","button"),ot.setAttribute("tabindex","0"),ot.setAttribute("aria-label",ot.title)}}}function q(M,H,Z,X){if(!M.diffOutOfDate){var re=X.origTo>Z.lastLine()?n(X.origFrom-1):n(X.origFrom,0),ne=n(X.origTo,0),ue=X.editTo>H.lastLine()?n(X.editFrom-1):n(X.editFrom,0),we=n(X.editTo,0),Se=M.mv.options.revertChunk;Se?Se(M.mv,Z,re,ne,H,ue,we):H.replaceRange(Z.getRange(re,ne),ue,we)}}var ee=t.MergeView=function(M,H){if(!(this instanceof ee))return new ee(M,H);this.options=H;var Z=H.origLeft,X=H.origRight==null?H.orig:H.origRight,re=Z!=null,ne=X!=null,ue=1+(re?1:0)+(ne?1:0),we=[],Se=this.left=null,Pe=this.right=null,Je=this;if(re){Se=this.left=new o(this,"left");var ct=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");we.push(ct),we.push(T(Se))}var ht=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");if(we.push(ht),ne){Pe=this.right=new o(this,"right"),we.push(T(Pe));var Pt=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");we.push(Pt)}(ne?Pt:ht).className+=" CodeMirror-merge-pane-rightmost",we.push(le("div",null,null,"height: 0; clear: both;"));var qe=this.wrap=M.appendChild(le("div",we,"CodeMirror-merge CodeMirror-merge-"+ue+"pane"));this.edit=t(ht,de(H)),Se&&Se.init(ct,Z,H),Pe&&Pe.init(Pt,X,H),H.collapseIdentical&&this.editor().operation(function(){Ge(Je,H.collapseIdentical)}),H.connect=="align"&&(this.aligners=[],P(this.left||this.right,!0)),Se&&Se.registerEvents(Pe),Pe&&Pe.registerEvents(Se);var ut=function(){Se&&C(Se),Pe&&C(Pe)};t.on(window,"resize",ut);var Rt=setInterval(function(){for(var ot=qe.parentNode;ot&&ot!=document.body;ot=ot.parentNode);ot||(clearInterval(Rt),t.off(window,"resize",ut))},5e3)};function T(M){var H=M.lockButton=le("div",null,"CodeMirror-merge-scrolllock");H.setAttribute("role","button"),H.setAttribute("tabindex","0");var Z=le("div",[H],"CodeMirror-merge-scrolllock-wrap");t.on(H,"click",function(){g(M,!M.lockScroll)}),t.on(H,"keyup",function(ue){(ue.key==="Enter"||ue.code==="Space")&&g(M,!M.lockScroll)});var X=[Z];if(M.mv.options.revertButtons!==!1){M.copyButtons=le("div",null,"CodeMirror-merge-copybuttons-"+M.type);var re=function(ue){var we=ue.target||ue.srcElement;if(we.chunk){if(we.className=="CodeMirror-merge-copy-reverse"){q(M,M.orig,M.edit,we.chunk);return}q(M,M.edit,M.orig,we.chunk)}};t.on(M.copyButtons,"click",re),t.on(M.copyButtons,"keyup",function(ue){(ue.key==="Enter"||ue.code==="Space")&&re(ue)}),X.unshift(M.copyButtons)}if(M.mv.options.connect!="align"){var ne=document.createElementNS&&document.createElementNS(i,"svg");ne&&!ne.createSVGRect&&(ne=null),M.svg=ne,ne&&X.push(ne)}return M.gap=le("div",X,"CodeMirror-merge-gap")}ee.prototype={constructor:ee,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(M){this.right&&this.right.setShowDifferences(M),this.left&&this.left.setShowDifferences(M)},rightChunks:function(){if(this.right)return s(this.right),this.right.chunks},leftChunks:function(){if(this.left)return s(this.left),this.left.chunks}};function z(M){return typeof M=="string"?M:M.getValue()}var B;function pe(M,H,Z){B||(B=new diff_match_patch);for(var X=B.diff_main(M,H),re=0;re<X.length;++re){var ne=X[re];(Z?!/[^ \t]/.test(ne[1]):!ne[1])?X.splice(re--,1):re&&X[re-1][0]==ne[0]&&(X.splice(re--,1),X[re][1]+=ne[1])}return X}function Ee(M){var H=[];if(!M.length)return H;for(var Z=0,X=0,re=n(0,0),ne=n(0,0),ue=0;ue<M.length;++ue){var we=M[ue],Se=we[0];if(Se==DIFF_EQUAL){var Pe=!it(M,ue)||re.line<Z||ne.line<X?1:0,Je=re.line+Pe,ct=ne.line+Pe;ke(re,we[1],null,ne);var ht=ye(M,ue)?1:0,Pt=re.line+ht,qe=ne.line+ht;Pt>Je&&(ue&&H.push({origFrom:X,origTo:ct,editFrom:Z,editTo:Je}),Z=Pt,X=qe)}else ke(Se==DIFF_INSERT?re:ne,we[1])}return(Z<=re.line||X<=ne.line)&&H.push({origFrom:X,origTo:ne.line+1,editFrom:Z,editTo:re.line+1}),H}function ye(M,H){if(H==M.length-1)return!0;var Z=M[H+1][1];return Z.length==1&&H<M.length-2||Z.charCodeAt(0)!=10?!1:H==M.length-2?!0:(Z=M[H+2][1],(Z.length>1||H==M.length-3)&&Z.charCodeAt(0)==10)}function it(M,H){if(H==0)return!0;var Z=M[H-1][1];return Z.charCodeAt(Z.length-1)!=10?!1:H==1?!0:(Z=M[H-2][1],Z.charCodeAt(Z.length-1)==10)}function Oe(M,H,Z){for(var X,re,ne,ue,we=0;we<M.length;we++){var Se=M[we],Pe=Z?Se.editFrom:Se.origFrom,Je=Z?Se.editTo:Se.origTo;re==null&&(Pe>H?(re=Se.editFrom,ue=Se.origFrom):Je>H&&(re=Se.editTo,ue=Se.origTo)),Je<=H?(X=Se.editTo,ne=Se.origTo):Pe<=H&&(X=Se.editFrom,ne=Se.origFrom)}return{edit:{before:X,after:re},orig:{before:ne,after:ue}}}function he(M,H,Z){M.addLineClass(H,"wrap","CodeMirror-merge-collapsed-line");var X=document.createElement("span");X.className="CodeMirror-merge-collapsed-widget",X.title=M.phrase("Identical text collapsed. Click to expand.");var re=M.markText(n(H,0),n(Z-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:X,clearOnEnter:!0});function ne(){re.clear(),M.removeLineClass(H,"wrap","CodeMirror-merge-collapsed-line")}return re.explicitlyCleared&&ne(),t.on(X,"click",ne),re.on("clear",ne),t.on(X,"click",ne),{mark:re,clear:ne}}function We(M,H){var Z=[];function X(){for(var we=0;we<Z.length;we++)Z[we].clear()}for(var re=0;re<H.length;re++){var ne=H[re],ue=he(ne.cm,ne.line,ne.line+M);Z.push(ue),ue.mark.on("clear",X)}return Z[0].mark}function Re(M,H,Z,X){for(var re=0;re<M.chunks.length;re++)for(var ne=M.chunks[re],ue=ne.editFrom-H;ue<ne.editTo+H;ue++){var we=ue+Z;we>=0&&we<X.length&&(X[we]=!1)}}function Ge(M,H){typeof H!="number"&&(H=2);for(var Z=[],X=M.editor(),re=X.firstLine(),ne=re,ue=X.lastLine();ne<=ue;ne++)Z.push(!0);M.left&&Re(M.left,H,re,Z),M.right&&Re(M.right,H,re,Z);for(var we=0;we<Z.length;we++)if(Z[we]){for(var Se=we+re,Pe=1;we<Z.length-1&&Z[we+1];we++,Pe++);if(Pe>H){var Je=[{line:Se,cm:X}];M.left&&Je.push({line:k(Se,M.left.chunks),cm:M.left.orig}),M.right&&Je.push({line:k(Se,M.right.chunks),cm:M.right.orig});var ct=We(Pe,Je);M.options.onCollapse&&M.options.onCollapse(M,Se,Pe,ct)}}}function le(M,H,Z,X){var re=document.createElement(M);if(Z&&(re.className=Z),X&&(re.style.cssText=X),typeof H=="string")re.appendChild(document.createTextNode(H));else if(H)for(var ne=0;ne<H.length;++ne)re.appendChild(H[ne]);return re}function G(M){for(var H=M.childNodes.length;H>0;--H)M.removeChild(M.firstChild)}function oe(M){for(var H=1;H<arguments.length;H+=2)M.setAttribute(arguments[H],arguments[H+1])}function de(M,H){H||(H={});for(var Z in M)M.hasOwnProperty(Z)&&(H[Z]=M[Z]);return H}function ke(M,H,Z,X){for(var re=Z?n(M.line,M.ch):M,ne=0;;){var ue=H.indexOf(`
`,ne);if(ue==-1)break;++re.line,X&&++X.line,ne=ue+1}return re.ch=(ne?0:re.ch)+(H.length-ne),X&&(X.ch=(ne?0:X.ch)+(H.length-ne)),re}var Ye=1,Ie=2,Fe=4;function Ot(M){this.cm=M,this.alignable=[],this.height=M.doc.height;var H=this;M.on("markerAdded",function(Z,X){if(X.collapsed){var re=X.find(1);re!=null&&H.set(re.line,Fe)}}),M.on("markerCleared",function(Z,X,re,ne){ne!=null&&X.collapsed&&H.check(ne,Fe,H.hasMarker)}),M.on("markerChanged",this.signal.bind(this)),M.on("lineWidgetAdded",function(Z,X,re){X.mergeSpacer||(X.above?H.set(re-1,Ie):H.set(re,Ye))}),M.on("lineWidgetCleared",function(Z,X,re){X.mergeSpacer||(X.above?H.check(re-1,Ie,H.hasWidgetBelow):H.check(re,Ye,H.hasWidget))}),M.on("lineWidgetChanged",this.signal.bind(this)),M.on("change",function(Z,X){var re=X.from.line,ne=X.to.line-X.from.line,ue=X.text.length-1,we=re+ue;(ne||ue)&&H.map(re,ne,ue),H.check(we,Fe,H.hasMarker),(ne||ue)&&H.check(X.from.line,Fe,H.hasMarker)}),M.on("viewportChange",function(){H.cm.doc.height!=H.height&&H.signal()})}Ot.prototype={signal:function(){t.signal(this,"realign"),this.height=this.cm.doc.height},set:function(M,H){for(var Z=-1;Z<this.alignable.length;Z+=2){var X=this.alignable[Z]-M;if(X==0){if((this.alignable[Z+1]&H)==H)return;this.alignable[Z+1]|=H,this.signal();return}if(X>0)break}this.signal(),this.alignable.splice(Z,0,M,H)},find:function(M){for(var H=0;H<this.alignable.length;H+=2)if(this.alignable[H]==M)return H;return-1},check:function(M,H,Z){var X=this.find(M);if(!(X==-1||!(this.alignable[X+1]&H))&&!Z.call(this,M)){this.signal();var re=this.alignable[X+1]&~H;re?this.alignable[X+1]=re:this.alignable.splice(X,2)}},hasMarker:function(M){var H=this.cm.getLineHandle(M);if(H.markedSpans){for(var Z=0;Z<H.markedSpans.length;Z++)if(H.markedSpans[Z].marker.collapsed&&H.markedSpans[Z].to!=null)return!0}return!1},hasWidget:function(M){var H=this.cm.getLineHandle(M);if(H.widgets){for(var Z=0;Z<H.widgets.length;Z++)if(!H.widgets[Z].above&&!H.widgets[Z].mergeSpacer)return!0}return!1},hasWidgetBelow:function(M){if(M==this.cm.lastLine())return!1;var H=this.cm.getLineHandle(M+1);if(H.widgets){for(var Z=0;Z<H.widgets.length;Z++)if(H.widgets[Z].above&&!H.widgets[Z].mergeSpacer)return!0}return!1},map:function(M,H,Z){for(var X=Z-H,re=M+H,ne=-1,ue=-1,we=0;we<this.alignable.length;we+=2){var Se=this.alignable[we];Se==M&&this.alignable[we+1]&Ie&&(ne=we),Se==re&&this.alignable[we+1]&Ie&&(ue=we),!(Se<=M)&&(Se<re?this.alignable.splice(we--,2):this.alignable[we]+=X)}if(ne>-1){var Pe=this.alignable[ne+1];Pe==Ie?this.alignable.splice(ne,2):this.alignable[ne+1]=Pe&~Ie}ue>-1&&Z&&this.set(M+Z,Ie)}};function lt(M,H){return(M.line-H.line||M.ch-H.ch)<0?M:H}function It(M,H){return(M.line-H.line||M.ch-H.ch)>0?M:H}function _t(M,H){return M.line==H.line&&M.ch==H.ch}function Yt(M,H,Z){for(var X=M.length-1;X>=0;X--){var re=M[X],ne=(Z?re.origTo:re.editTo)-1;if(ne<H)return ne}}function Kt(M,H,Z){for(var X=0;X<M.length;X++){var re=M[X],ne=Z?re.origFrom:re.editFrom;if(ne>H)return ne}}function Q(M,H){var Z=null,X=M.state.diffViews,re=M.getCursor().line;if(X)for(var ne=0;ne<X.length;ne++){var ue=X[ne],we=M==ue.orig;s(ue);var Se=H<0?Yt(ue.chunks,re,we):Kt(ue.chunks,re,we);Se!=null&&(Z==null||(H<0?Se>Z:Se<Z))&&(Z=Se)}if(Z!=null)M.setCursor(Z,0);else return t.Pass}t.commands.goNextDiff=function(M){return Q(M,1)},t.commands.goPrevDiff=function(M){return Q(M,-1)}})}()),Dg.exports}nA();var vf={exports:{}},Pg;function rA(){return Pg||(Pg=1,function(r){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,i=0;e.Diff=function(o,s){return[o,s]},e.prototype.diff_main=function(o,s,l,d){typeof d>"u"&&(this.Diff_Timeout<=0?d=Number.MAX_VALUE:d=new Date().getTime()+this.Diff_Timeout*1e3);var c=d;if(o==null||s==null)throw new Error("Null input. (diff_main)");if(o==s)return o?[new e.Diff(i,o)]:[];typeof l>"u"&&(l=!0);var f=l,v=this.diff_commonPrefix(o,s),g=o.substring(0,v);o=o.substring(v),s=s.substring(v),v=this.diff_commonSuffix(o,s);var y=o.substring(o.length-v);o=o.substring(0,o.length-v),s=s.substring(0,s.length-v);var b=this.diff_compute_(o,s,f,c);return g&&b.unshift(new e.Diff(i,g)),y&&b.push(new e.Diff(i,y)),this.diff_cleanupMerge(b),b},e.prototype.diff_compute_=function(o,s,l,d){var c;if(!o)return[new e.Diff(n,s)];if(!s)return[new e.Diff(t,o)];var f=o.length>s.length?o:s,v=o.length>s.length?s:o,g=f.indexOf(v);if(g!=-1)return c=[new e.Diff(n,f.substring(0,g)),new e.Diff(i,v),new e.Diff(n,f.substring(g+v.length))],o.length>s.length&&(c[0][0]=c[2][0]=t),c;if(v.length==1)return[new e.Diff(t,o),new e.Diff(n,s)];var y=this.diff_halfMatch_(o,s);if(y){var b=y[0],x=y[1],w=y[2],_=y[3],C=y[4],k=this.diff_main(b,w,l,d),D=this.diff_main(x,_,l,d);return k.concat([new e.Diff(i,C)],D)}return l&&o.length>100&&s.length>100?this.diff_lineMode_(o,s,d):this.diff_bisect_(o,s,d)},e.prototype.diff_lineMode_=function(o,s,l){var d=this.diff_linesToChars_(o,s);o=d.chars1,s=d.chars2;var c=d.lineArray,f=this.diff_main(o,s,!1,l);this.diff_charsToLines_(f,c),this.diff_cleanupSemantic(f),f.push(new e.Diff(i,""));for(var v=0,g=0,y=0,b="",x="";v<f.length;){switch(f[v][0]){case n:y++,x+=f[v][1];break;case t:g++,b+=f[v][1];break;case i:if(g>=1&&y>=1){f.splice(v-g-y,g+y),v=v-g-y;for(var w=this.diff_main(b,x,!1,l),_=w.length-1;_>=0;_--)f.splice(v,0,w[_]);v=v+w.length}y=0,g=0,b="",x="";break}v++}return f.pop(),f},e.prototype.diff_bisect_=function(o,s,l){for(var d=o.length,c=s.length,f=Math.ceil((d+c)/2),v=f,g=2*f,y=new Array(g),b=new Array(g),x=0;x<g;x++)y[x]=-1,b[x]=-1;y[v+1]=0,b[v+1]=0;for(var w=d-c,_=w%2!=0,C=0,k=0,D=0,R=0,$=0;$<f&&!(new Date().getTime()>l);$++){for(var P=-$+C;P<=$-k;P+=2){var I=v+P,W;P==-$||P!=$&&y[I-1]<y[I+1]?W=y[I+1]:W=y[I-1]+1;for(var se=W-P;W<d&&se<c&&o.charAt(W)==s.charAt(se);)W++,se++;if(y[I]=W,W>d)k+=2;else if(se>c)C+=2;else if(_){var q=v+w-P;if(q>=0&&q<g&&b[q]!=-1){var ee=d-b[q];if(W>=ee)return this.diff_bisectSplit_(o,s,W,se,l)}}}for(var T=-$+D;T<=$-R;T+=2){var q=v+T,ee;T==-$||T!=$&&b[q-1]<b[q+1]?ee=b[q+1]:ee=b[q-1]+1;for(var z=ee-T;ee<d&&z<c&&o.charAt(d-ee-1)==s.charAt(c-z-1);)ee++,z++;if(b[q]=ee,ee>d)R+=2;else if(z>c)D+=2;else if(!_){var I=v+w-T;if(I>=0&&I<g&&y[I]!=-1){var W=y[I],se=v+W-I;if(ee=d-ee,W>=ee)return this.diff_bisectSplit_(o,s,W,se,l)}}}}return[new e.Diff(t,o),new e.Diff(n,s)]},e.prototype.diff_bisectSplit_=function(o,s,l,d,c){var f=o.substring(0,l),v=s.substring(0,d),g=o.substring(l),y=s.substring(d),b=this.diff_main(f,v,!1,c),x=this.diff_main(g,y,!1,c);return b.concat(x)},e.prototype.diff_linesToChars_=function(o,s){var l=[],d={};l[0]="";function c(y){for(var b="",x=0,w=-1,_=l.length;w<y.length-1;){w=y.indexOf(`
`,x),w==-1&&(w=y.length-1);var C=y.substring(x,w+1);(d.hasOwnProperty?d.hasOwnProperty(C):d[C]!==void 0)?b+=String.fromCharCode(d[C]):(_==f&&(C=y.substring(x),w=y.length),b+=String.fromCharCode(_),d[C]=_,l[_++]=C),x=w+1}return b}var f=4e4,v=c(o);f=65535;var g=c(s);return{chars1:v,chars2:g,lineArray:l}},e.prototype.diff_charsToLines_=function(o,s){for(var l=0;l<o.length;l++){for(var d=o[l][1],c=[],f=0;f<d.length;f++)c[f]=s[d.charCodeAt(f)];o[l][1]=c.join("")}},e.prototype.diff_commonPrefix=function(o,s){if(!o||!s||o.charAt(0)!=s.charAt(0))return 0;for(var l=0,d=Math.min(o.length,s.length),c=d,f=0;l<c;)o.substring(f,c)==s.substring(f,c)?(l=c,f=l):d=c,c=Math.floor((d-l)/2+l);return c},e.prototype.diff_commonSuffix=function(o,s){if(!o||!s||o.charAt(o.length-1)!=s.charAt(s.length-1))return 0;for(var l=0,d=Math.min(o.length,s.length),c=d,f=0;l<c;)o.substring(o.length-c,o.length-f)==s.substring(s.length-c,s.length-f)?(l=c,f=l):d=c,c=Math.floor((d-l)/2+l);return c},e.prototype.diff_commonOverlap_=function(o,s){var l=o.length,d=s.length;if(l==0||d==0)return 0;l>d?o=o.substring(l-d):l<d&&(s=s.substring(0,l));var c=Math.min(l,d);if(o==s)return c;for(var f=0,v=1;;){var g=o.substring(c-v),y=s.indexOf(g);if(y==-1)return f;v+=y,(y==0||o.substring(c-v)==s.substring(0,v))&&(f=v,v++)}},e.prototype.diff_halfMatch_=function(o,s){if(this.Diff_Timeout<=0)return null;var l=o.length>s.length?o:s,d=o.length>s.length?s:o;if(l.length<4||d.length*2<l.length)return null;var c=this;function f(k,D,R){for(var $=k.substring(R,R+Math.floor(k.length/4)),P=-1,I="",W,se,q,ee;(P=D.indexOf($,P+1))!=-1;){var T=c.diff_commonPrefix(k.substring(R),D.substring(P)),z=c.diff_commonSuffix(k.substring(0,R),D.substring(0,P));I.length<z+T&&(I=D.substring(P-z,P)+D.substring(P,P+T),W=k.substring(0,R-z),se=k.substring(R+T),q=D.substring(0,P-z),ee=D.substring(P+T))}return I.length*2>=k.length?[W,se,q,ee,I]:null}var v=f(l,d,Math.ceil(l.length/4)),g=f(l,d,Math.ceil(l.length/2)),y;if(!v&&!g)return null;g?v?y=v[4].length>g[4].length?v:g:y=g:y=v;var b,x,w,_;o.length>s.length?(b=y[0],x=y[1],w=y[2],_=y[3]):(w=y[0],_=y[1],b=y[2],x=y[3]);var C=y[4];return[b,x,w,_,C]},e.prototype.diff_cleanupSemantic=function(o){for(var s=!1,l=[],d=0,c=null,f=0,v=0,g=0,y=0,b=0;f<o.length;)o[f][0]==i?(l[d++]=f,v=y,g=b,y=0,b=0,c=o[f][1]):(o[f][0]==n?y+=o[f][1].length:b+=o[f][1].length,c&&c.length<=Math.max(v,g)&&c.length<=Math.max(y,b)&&(o.splice(l[d-1],0,new e.Diff(t,c)),o[l[d-1]+1][0]=n,d--,d--,f=d>0?l[d-1]:-1,v=0,g=0,y=0,b=0,c=null,s=!0)),f++;for(s&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),f=1;f<o.length;){if(o[f-1][0]==t&&o[f][0]==n){var x=o[f-1][1],w=o[f][1],_=this.diff_commonOverlap_(x,w),C=this.diff_commonOverlap_(w,x);_>=C?(_>=x.length/2||_>=w.length/2)&&(o.splice(f,0,new e.Diff(i,w.substring(0,_))),o[f-1][1]=x.substring(0,x.length-_),o[f+1][1]=w.substring(_),f++):(C>=x.length/2||C>=w.length/2)&&(o.splice(f,0,new e.Diff(i,x.substring(0,C))),o[f-1][0]=n,o[f-1][1]=w.substring(0,w.length-C),o[f+1][0]=t,o[f+1][1]=x.substring(C),f++),f++}f++}},e.prototype.diff_cleanupSemanticLossless=function(o){function s(C,k){if(!C||!k)return 6;var D=C.charAt(C.length-1),R=k.charAt(0),$=D.match(e.nonAlphaNumericRegex_),P=R.match(e.nonAlphaNumericRegex_),I=$&&D.match(e.whitespaceRegex_),W=P&&R.match(e.whitespaceRegex_),se=I&&D.match(e.linebreakRegex_),q=W&&R.match(e.linebreakRegex_),ee=se&&C.match(e.blanklineEndRegex_),T=q&&k.match(e.blanklineStartRegex_);return ee||T?5:se||q?4:$&&!I&&W?3:I||W?2:$||P?1:0}for(var l=1;l<o.length-1;){if(o[l-1][0]==i&&o[l+1][0]==i){var d=o[l-1][1],c=o[l][1],f=o[l+1][1],v=this.diff_commonSuffix(d,c);if(v){var g=c.substring(c.length-v);d=d.substring(0,d.length-v),c=g+c.substring(0,c.length-v),f=g+f}for(var y=d,b=c,x=f,w=s(d,c)+s(c,f);c.charAt(0)===f.charAt(0);){d+=c.charAt(0),c=c.substring(1)+f.charAt(0),f=f.substring(1);var _=s(d,c)+s(c,f);_>=w&&(w=_,y=d,b=c,x=f)}o[l-1][1]!=y&&(y?o[l-1][1]=y:(o.splice(l-1,1),l--),o[l][1]=b,x?o[l+1][1]=x:(o.splice(l+1,1),l--))}l++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(o){for(var s=!1,l=[],d=0,c=null,f=0,v=!1,g=!1,y=!1,b=!1;f<o.length;)o[f][0]==i?(o[f][1].length<this.Diff_EditCost&&(y||b)?(l[d++]=f,v=y,g=b,c=o[f][1]):(d=0,c=null),y=b=!1):(o[f][0]==t?b=!0:y=!0,c&&(v&&g&&y&&b||c.length<this.Diff_EditCost/2&&v+g+y+b==3)&&(o.splice(l[d-1],0,new e.Diff(t,c)),o[l[d-1]+1][0]=n,d--,c=null,v&&g?(y=b=!0,d=0):(d--,f=d>0?l[d-1]:-1,y=b=!1),s=!0)),f++;s&&this.diff_cleanupMerge(o)},e.prototype.diff_cleanupMerge=function(o){o.push(new e.Diff(i,""));for(var s=0,l=0,d=0,c="",f="",v;s<o.length;)switch(o[s][0]){case n:d++,f+=o[s][1],s++;break;case t:l++,c+=o[s][1],s++;break;case i:l+d>1?(l!==0&&d!==0&&(v=this.diff_commonPrefix(f,c),v!==0&&(s-l-d>0&&o[s-l-d-1][0]==i?o[s-l-d-1][1]+=f.substring(0,v):(o.splice(0,0,new e.Diff(i,f.substring(0,v))),s++),f=f.substring(v),c=c.substring(v)),v=this.diff_commonSuffix(f,c),v!==0&&(o[s][1]=f.substring(f.length-v)+o[s][1],f=f.substring(0,f.length-v),c=c.substring(0,c.length-v))),s-=l+d,o.splice(s,l+d),c.length&&(o.splice(s,0,new e.Diff(t,c)),s++),f.length&&(o.splice(s,0,new e.Diff(n,f)),s++),s++):s!==0&&o[s-1][0]==i?(o[s-1][1]+=o[s][1],o.splice(s,1)):s++,d=0,l=0,c="",f="";break}o[o.length-1][1]===""&&o.pop();var g=!1;for(s=1;s<o.length-1;)o[s-1][0]==i&&o[s+1][0]==i&&(o[s][1].substring(o[s][1].length-o[s-1][1].length)==o[s-1][1]?(o[s][1]=o[s-1][1]+o[s][1].substring(0,o[s][1].length-o[s-1][1].length),o[s+1][1]=o[s-1][1]+o[s+1][1],o.splice(s-1,1),g=!0):o[s][1].substring(0,o[s+1][1].length)==o[s+1][1]&&(o[s-1][1]+=o[s+1][1],o[s][1]=o[s][1].substring(o[s+1][1].length)+o[s+1][1],o.splice(s+1,1),g=!0)),s++;g&&this.diff_cleanupMerge(o)},e.prototype.diff_xIndex=function(o,s){var l=0,d=0,c=0,f=0,v;for(v=0;v<o.length&&(o[v][0]!==n&&(l+=o[v][1].length),o[v][0]!==t&&(d+=o[v][1].length),!(l>s));v++)c=l,f=d;return o.length!=v&&o[v][0]===t?f:f+(s-c)},e.prototype.diff_prettyHtml=function(o){for(var s=[],l=/&/g,d=/</g,c=/>/g,f=/\n/g,v=0;v<o.length;v++){var g=o[v][0],y=o[v][1],b=y.replace(l,"&amp;").replace(d,"&lt;").replace(c,"&gt;").replace(f,"&para;<br>");switch(g){case n:s[v]='<ins style="background:#e6ffe6;">'+b+"</ins>";break;case t:s[v]='<del style="background:#ffe6e6;">'+b+"</del>";break;case i:s[v]="<span>"+b+"</span>";break}}return s.join("")},e.prototype.diff_text1=function(o){for(var s=[],l=0;l<o.length;l++)o[l][0]!==n&&(s[l]=o[l][1]);return s.join("")},e.prototype.diff_text2=function(o){for(var s=[],l=0;l<o.length;l++)o[l][0]!==t&&(s[l]=o[l][1]);return s.join("")},e.prototype.diff_levenshtein=function(o){for(var s=0,l=0,d=0,c=0;c<o.length;c++){var f=o[c][0],v=o[c][1];switch(f){case n:l+=v.length;break;case t:d+=v.length;break;case i:s+=Math.max(l,d),l=0,d=0;break}}return s+=Math.max(l,d),s},e.prototype.diff_toDelta=function(o){for(var s=[],l=0;l<o.length;l++)switch(o[l][0]){case n:s[l]="+"+encodeURI(o[l][1]);break;case t:s[l]="-"+o[l][1].length;break;case i:s[l]="="+o[l][1].length;break}return s.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(o,s){for(var l=[],d=0,c=0,f=s.split(/\t/g),v=0;v<f.length;v++){var g=f[v].substring(1);switch(f[v].charAt(0)){case"+":try{l[d++]=new e.Diff(n,decodeURI(g))}catch{throw new Error("Illegal escape in diff_fromDelta: "+g)}break;case"-":case"=":var y=parseInt(g,10);if(isNaN(y)||y<0)throw new Error("Invalid number in diff_fromDelta: "+g);var b=o.substring(c,c+=y);f[v].charAt(0)=="="?l[d++]=new e.Diff(i,b):l[d++]=new e.Diff(t,b);break;default:if(f[v])throw new Error("Invalid diff operation in diff_fromDelta: "+f[v])}}if(c!=o.length)throw new Error("Delta length ("+c+") does not equal source text length ("+o.length+").");return l},e.prototype.match_main=function(o,s,l){if(o==null||s==null||l==null)throw new Error("Null input. (match_main)");return l=Math.max(0,Math.min(l,o.length)),o==s?0:o.length?o.substring(l,l+s.length)==s?l:this.match_bitap_(o,s,l):-1},e.prototype.match_bitap_=function(o,s,l){if(s.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var d=this.match_alphabet_(s),c=this;function f(W,se){var q=W/s.length,ee=Math.abs(l-se);return c.Match_Distance?q+ee/c.Match_Distance:ee?1:q}var v=this.Match_Threshold,g=o.indexOf(s,l);g!=-1&&(v=Math.min(f(0,g),v),g=o.lastIndexOf(s,l+s.length),g!=-1&&(v=Math.min(f(0,g),v)));var y=1<<s.length-1;g=-1;for(var b,x,w=s.length+o.length,_,C=0;C<s.length;C++){for(b=0,x=w;b<x;)f(C,l+x)<=v?b=x:w=x,x=Math.floor((w-b)/2+b);w=x;var k=Math.max(1,l-x+1),D=Math.min(l+x,o.length)+s.length,R=Array(D+2);R[D+1]=(1<<C)-1;for(var $=D;$>=k;$--){var P=d[o.charAt($-1)];if(C===0?R[$]=(R[$+1]<<1|1)&P:R[$]=(R[$+1]<<1|1)&P|((_[$+1]|_[$])<<1|1)|_[$+1],R[$]&y){var I=f(C,$-1);if(I<=v)if(v=I,g=$-1,g>l)k=Math.max(1,2*l-g);else break}}if(f(C+1,l)>v)break;_=R}return g},e.prototype.match_alphabet_=function(o){for(var s={},l=0;l<o.length;l++)s[o.charAt(l)]=0;for(var l=0;l<o.length;l++)s[o.charAt(l)]|=1<<o.length-l-1;return s},e.prototype.patch_addContext_=function(o,s){if(s.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var l=s.substring(o.start2,o.start2+o.length1),d=0;s.indexOf(l)!=s.lastIndexOf(l)&&l.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)d+=this.Patch_Margin,l=s.substring(o.start2-d,o.start2+o.length1+d);d+=this.Patch_Margin;var c=s.substring(o.start2-d,o.start2);c&&o.diffs.unshift(new e.Diff(i,c));var f=s.substring(o.start2+o.length1,o.start2+o.length1+d);f&&o.diffs.push(new e.Diff(i,f)),o.start1-=c.length,o.start2-=c.length,o.length1+=c.length+f.length,o.length2+=c.length+f.length}},e.prototype.patch_make=function(o,s,l){var d,c;if(typeof o=="string"&&typeof s=="string"&&typeof l>"u")d=o,c=this.diff_main(d,s,!0),c.length>2&&(this.diff_cleanupSemantic(c),this.diff_cleanupEfficiency(c));else if(o&&typeof o=="object"&&typeof s>"u"&&typeof l>"u")c=o,d=this.diff_text1(c);else if(typeof o=="string"&&s&&typeof s=="object"&&typeof l>"u")d=o,c=s;else if(typeof o=="string"&&typeof s=="string"&&l&&typeof l=="object")d=o,c=l;else throw new Error("Unknown call format to patch_make.");if(c.length===0)return[];for(var f=[],v=new e.patch_obj,g=0,y=0,b=0,x=d,w=d,_=0;_<c.length;_++){var C=c[_][0],k=c[_][1];switch(!g&&C!==i&&(v.start1=y,v.start2=b),C){case n:v.diffs[g++]=c[_],v.length2+=k.length,w=w.substring(0,b)+k+w.substring(b);break;case t:v.length1+=k.length,v.diffs[g++]=c[_],w=w.substring(0,b)+w.substring(b+k.length);break;case i:k.length<=2*this.Patch_Margin&&g&&c.length!=_+1?(v.diffs[g++]=c[_],v.length1+=k.length,v.length2+=k.length):k.length>=2*this.Patch_Margin&&g&&(this.patch_addContext_(v,x),f.push(v),v=new e.patch_obj,g=0,x=w,y=b);break}C!==n&&(y+=k.length),C!==t&&(b+=k.length)}return g&&(this.patch_addContext_(v,x),f.push(v)),f},e.prototype.patch_deepCopy=function(o){for(var s=[],l=0;l<o.length;l++){var d=o[l],c=new e.patch_obj;c.diffs=[];for(var f=0;f<d.diffs.length;f++)c.diffs[f]=new e.Diff(d.diffs[f][0],d.diffs[f][1]);c.start1=d.start1,c.start2=d.start2,c.length1=d.length1,c.length2=d.length2,s[l]=c}return s},e.prototype.patch_apply=function(o,s){if(o.length==0)return[s,[]];o=this.patch_deepCopy(o);var l=this.patch_addPadding(o);s=l+s+l,this.patch_splitMax(o);for(var d=0,c=[],f=0;f<o.length;f++){var v=o[f].start2+d,g=this.diff_text1(o[f].diffs),y,b=-1;if(g.length>this.Match_MaxBits?(y=this.match_main(s,g.substring(0,this.Match_MaxBits),v),y!=-1&&(b=this.match_main(s,g.substring(g.length-this.Match_MaxBits),v+g.length-this.Match_MaxBits),(b==-1||y>=b)&&(y=-1))):y=this.match_main(s,g,v),y==-1)c[f]=!1,d-=o[f].length2-o[f].length1;else{c[f]=!0,d=y-v;var x;if(b==-1?x=s.substring(y,y+g.length):x=s.substring(y,b+this.Match_MaxBits),g==x)s=s.substring(0,y)+this.diff_text2(o[f].diffs)+s.substring(y+g.length);else{var w=this.diff_main(g,x,!1);if(g.length>this.Match_MaxBits&&this.diff_levenshtein(w)/g.length>this.Patch_DeleteThreshold)c[f]=!1;else{this.diff_cleanupSemanticLossless(w);for(var _=0,C,k=0;k<o[f].diffs.length;k++){var D=o[f].diffs[k];D[0]!==i&&(C=this.diff_xIndex(w,_)),D[0]===n?s=s.substring(0,y+C)+D[1]+s.substring(y+C):D[0]===t&&(s=s.substring(0,y+C)+s.substring(y+this.diff_xIndex(w,_+D[1].length))),D[0]!==t&&(_+=D[1].length)}}}}}return s=s.substring(l.length,s.length-l.length),[s,c]},e.prototype.patch_addPadding=function(o){for(var s=this.Patch_Margin,l="",d=1;d<=s;d++)l+=String.fromCharCode(d);for(var d=0;d<o.length;d++)o[d].start1+=s,o[d].start2+=s;var c=o[0],f=c.diffs;if(f.length==0||f[0][0]!=i)f.unshift(new e.Diff(i,l)),c.start1-=s,c.start2-=s,c.length1+=s,c.length2+=s;else if(s>f[0][1].length){var v=s-f[0][1].length;f[0][1]=l.substring(f[0][1].length)+f[0][1],c.start1-=v,c.start2-=v,c.length1+=v,c.length2+=v}if(c=o[o.length-1],f=c.diffs,f.length==0||f[f.length-1][0]!=i)f.push(new e.Diff(i,l)),c.length1+=s,c.length2+=s;else if(s>f[f.length-1][1].length){var v=s-f[f.length-1][1].length;f[f.length-1][1]+=l.substring(0,v),c.length1+=v,c.length2+=v}return l},e.prototype.patch_splitMax=function(o){for(var s=this.Match_MaxBits,l=0;l<o.length;l++)if(!(o[l].length1<=s)){var d=o[l];o.splice(l--,1);for(var c=d.start1,f=d.start2,v="";d.diffs.length!==0;){var g=new e.patch_obj,y=!0;for(g.start1=c-v.length,g.start2=f-v.length,v!==""&&(g.length1=g.length2=v.length,g.diffs.push(new e.Diff(i,v)));d.diffs.length!==0&&g.length1<s-this.Patch_Margin;){var b=d.diffs[0][0],x=d.diffs[0][1];b===n?(g.length2+=x.length,f+=x.length,g.diffs.push(d.diffs.shift()),y=!1):b===t&&g.diffs.length==1&&g.diffs[0][0]==i&&x.length>2*s?(g.length1+=x.length,c+=x.length,y=!1,g.diffs.push(new e.Diff(b,x)),d.diffs.shift()):(x=x.substring(0,s-g.length1-this.Patch_Margin),g.length1+=x.length,c+=x.length,b===i?(g.length2+=x.length,f+=x.length):y=!1,g.diffs.push(new e.Diff(b,x)),x==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(x.length))}v=this.diff_text2(g.diffs),v=v.substring(v.length-this.Patch_Margin);var w=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);w!==""&&(g.length1+=w.length,g.length2+=w.length,g.diffs.length!==0&&g.diffs[g.diffs.length-1][0]===i?g.diffs[g.diffs.length-1][1]+=w:g.diffs.push(new e.Diff(i,w))),y||o.splice(++l,0,g)}}},e.prototype.patch_toText=function(o){for(var s=[],l=0;l<o.length;l++)s[l]=o[l];return s.join("")},e.prototype.patch_fromText=function(o){var s=[];if(!o)return s;for(var l=o.split(`
`),d=0,c=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;d<l.length;){var f=l[d].match(c);if(!f)throw new Error("Invalid patch string: "+l[d]);var v=new e.patch_obj;for(s.push(v),v.start1=parseInt(f[1],10),f[2]===""?(v.start1--,v.length1=1):f[2]=="0"?v.length1=0:(v.start1--,v.length1=parseInt(f[2],10)),v.start2=parseInt(f[3],10),f[4]===""?(v.start2--,v.length2=1):f[4]=="0"?v.length2=0:(v.start2--,v.length2=parseInt(f[4],10)),d++;d<l.length;){var g=l[d].charAt(0);try{var y=decodeURI(l[d].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+y)}if(g=="-")v.diffs.push(new e.Diff(t,y));else if(g=="+")v.diffs.push(new e.Diff(n,y));else if(g==" ")v.diffs.push(new e.Diff(i,y));else{if(g=="@")break;if(g!=="")throw new Error('Invalid patch mode "'+g+'" in: '+y)}d++}}return s},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var o,s;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?s=this.start2+",0":this.length2==1?s=this.start2+1:s=this.start2+1+","+this.length2;for(var l=["@@ -"+o+" +"+s+` @@
`],d,c=0;c<this.diffs.length;c++){switch(this.diffs[c][0]){case n:d="+";break;case t:d="-";break;case i:d=" ";break}l[c+1]=d+encodeURI(this.diffs[c][1])+`
`}return l.join("").replace(/%20/g," ")},r.exports=e,r.exports.diff_match_patch=e,r.exports.DIFF_DELETE=t,r.exports.DIFF_INSERT=n,r.exports.DIFF_EQUAL=i}(vf)),vf.exports}var iA=rA();const oA=fs(iA);var Rg={exports:{}},Ig;function aA(){return Ig||(Ig=1,function(r,e){(function(t){t(No())})(function(t){t.defineSimpleMode=function(g,y){t.defineMode(g,function(b){return t.simpleMode(b,y)})},t.simpleMode=function(g,y){n(y,"start");var b={},x=y.meta||{},w=!1;for(var _ in y)if(_!=x&&y.hasOwnProperty(_))for(var C=b[_]=[],k=y[_],D=0;D<k.length;D++){var R=k[D];C.push(new s(R,y)),(R.indent||R.dedent)&&(w=!0)}var $={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:w?[]:null}},copyState:function(I){var W={state:I.state,pending:I.pending,local:I.local,localState:null,indent:I.indent&&I.indent.slice(0)};I.localState&&(W.localState=t.copyState(I.local.mode,I.localState)),I.stack&&(W.stack=I.stack.slice(0));for(var se=I.persistentStates;se;se=se.next)W.persistentStates={mode:se.mode,spec:se.spec,state:se.state==I.localState?W.localState:t.copyState(se.mode,se.state),next:W.persistentStates};return W},token:l(b,g),innerMode:function(I){return I.local&&{mode:I.local.mode,state:I.localState}},indent:v(b,x)};if(x)for(var P in x)x.hasOwnProperty(P)&&($[P]=x[P]);return $};function n(g,y){if(!g.hasOwnProperty(y))throw new Error("Undefined state "+y+" in simple mode")}function i(g,y){if(!g)return/(?:)/;var b="";return g instanceof RegExp?(g.ignoreCase&&(b="i"),g.unicode&&(b+="u"),g=g.source):g=String(g),new RegExp((y===!1?"":"^")+"(?:"+g+")",b)}function o(g){if(!g)return null;if(g.apply)return g;if(typeof g=="string")return g.replace(/\./g," ");for(var y=[],b=0;b<g.length;b++)y.push(g[b]&&g[b].replace(/\./g," "));return y}function s(g,y){(g.next||g.push)&&n(y,g.next||g.push),this.regex=i(g.regex),this.token=o(g.token),this.data=g}function l(g,y){return function(b,x){if(x.pending){var w=x.pending.shift();return x.pending.length==0&&(x.pending=null),b.pos+=w.text.length,w.token}if(x.local)if(x.local.end&&b.match(x.local.end)){var _=x.local.endToken||null;return x.local=x.localState=null,_}else{var _=x.local.mode.token(b,x.localState),C;return x.local.endScan&&(C=x.local.endScan.exec(b.current()))&&(b.pos=b.start+C.index),_}for(var k=g[x.state],D=0;D<k.length;D++){var R=k[D],$=(!R.data.sol||b.sol())&&b.match(R.regex);if($){R.data.next?x.state=R.data.next:R.data.push?((x.stack||(x.stack=[])).push(x.state),x.state=R.data.push):R.data.pop&&x.stack&&x.stack.length&&(x.state=x.stack.pop()),R.data.mode&&c(y,x,R.data.mode,R.token),R.data.indent&&x.indent.push(b.indentation()+y.indentUnit),R.data.dedent&&x.indent.pop();var P=R.token;if(P&&P.apply&&(P=P($)),$.length>2&&R.token&&typeof R.token!="string"){for(var I=2;I<$.length;I++)$[I]&&(x.pending||(x.pending=[])).push({text:$[I],token:R.token[I-1]});return b.backUp($[0].length-($[1]?$[1].length:0)),P[0]}else return P&&P.join?P[0]:P}}return b.next(),null}}function d(g,y){if(g===y)return!0;if(!g||typeof g!="object"||!y||typeof y!="object")return!1;var b=0;for(var x in g)if(g.hasOwnProperty(x)){if(!y.hasOwnProperty(x)||!d(g[x],y[x]))return!1;b++}for(var x in y)y.hasOwnProperty(x)&&b--;return b==0}function c(g,y,b,x){var w;if(b.persistent)for(var _=y.persistentStates;_&&!w;_=_.next)(b.spec?d(b.spec,_.spec):b.mode==_.mode)&&(w=_);var C=w?w.mode:b.mode||t.getMode(g,b.spec),k=w?w.state:t.startState(C);b.persistent&&!w&&(y.persistentStates={mode:C,spec:b.spec,state:k,next:y.persistentStates}),y.localState=k,y.local={mode:C,end:b.end&&i(b.end),endScan:b.end&&b.forceEnd!==!1&&i(b.end,!1),endToken:x&&x.join?x[x.length-1]:x}}function f(g,y){for(var b=0;b<y.length;b++)if(y[b]===g)return!0}function v(g,y){return function(b,x,w){if(b.local&&b.local.mode.indent)return b.local.mode.indent(b.localState,x,w);if(b.indent==null||b.local||y.dontIndentStates&&f(b.state,y.dontIndentStates)>-1)return t.Pass;var _=b.indent.length-1,C=g[b.state];e:for(;;){for(var k=0;k<C.length;k++){var D=C[k];if(D.data.dedent&&D.data.dedentIfLineStart!==!1){var R=D.regex.exec(x);if(R&&R[0]){_--,(D.next||D.push)&&(C=g[D.next||D.push]),x=x.slice(R[0].length);continue e}}}break}return _<0?0:b.indent[_]}}})}()),Rg.exports}aA();!window.CodeMirror&&(window.CodeMirror=O1);const Vl=window.CodeMirror||O1,sA=hs({name:"DefaultMode",props:{name:{type:String,default:`cm-textarea-${+new Date}`},value:{type:String,default:""},content:{type:String,default:""},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>null},placeholder:{type:String,default:""}},emits:{ready:r=>r,"update:cminstance":r=>r},setup(r,{emit:e}){const t=xe(),n=xe(null),i=()=>{n.value=nc(Vl.fromTextArea(t.value,r.options)),e("update:cminstance",n.value);const o=Qt(()=>r.cminstance,s=>{var l;s&&((l=r.cminstance)==null||l.setValue(r.value||r.content)),e("ready",$e(n)),o==null||o()},{deep:!0})};return qt(()=>{i()}),{textarea:t,initialize:i}}}),Jh=(r,e)=>{const t=r.__vccOpts||r;for(const[n,i]of e)t[n]=i;return t},lA=["name","placeholder"];function uA(r,e,t,n,i,o){return Y(),ae("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,lA)}const Bg=Jh(sA,[["render",uA]]);window.diff_match_patch=oA;window.DIFF_DELETE=-1;window.DIFF_INSERT=1;window.DIFF_EQUAL=0;const dA=hs({name:"MergeMode",props:{options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=xe(),n=xe(),i=()=>{t.value=nc(Vl.MergeView(n.value,r.options)),e("update:cminstance",t.value),e("ready",t)};return qt(()=>{i()}),{mergeView:n,initialize:i}}}),cA={ref:"mergeView"};function fA(r,e,t,n,i,o){return Y(),ae("div",cA,null,512)}const hA=Jh(dA,[["render",fA]]);function pA(r){const e=/#link#(.+)#link#/g,t=[];let n;for(n=e.exec(r);n;){const i=document.createElement("a"),o=JSON.parse(n[1]),s=Object.entries(o);for(const[l,d]of s)i.setAttribute(l,d);i.className="editor_custom_link",i.innerHTML="logDownload",t.push({start:n.index,end:n.index+n[0].length,node:i}),n=e.exec(r)}return t}function vA(r){const e=[];function t(){const n=/#log<(\w*)>log#((.|\r\n|\n)*?)#log<(\w*)>log#/g;let i;for(i=n.exec(r);i;){const o=i[0].replace(/\r\n/g,`
`).split(`
`),s=i[2].replace(/\r\n/g,`
`).split(`
`),l=document.createElement("span"),d=i[1];l.className=`c-editor--log__${d}`;let c=0;for(let f=0;f<o.length;f++){const v=o[f],g=s[f],y=l.cloneNode(!1);y.innerText=g,e.push({start:i.index+c,end:i.index+c+v.length,node:y}),c=c+v.length+1}i=n.exec(r)}}return t(),e}const Mu=[{regex:/(\[.*?\])([ \t]*)(<error>[ \t])(.+)/,token:["tag","","error.strong","error.strong"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<info>)(.+)(.?)/,token:["tag","","bracket","bracket","hr"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<warning>)(.+)(.?)/,token:["tag","","comment","comment","hr"],sol:!0}];Vl.defineSimpleMode("fclog",{start:[...Mu,{regex:/.*/,token:"hr"}],error:[...Mu,{regex:/.*/,token:"error.strong"}],info:[...Mu,{regex:/.*/,token:"bracket"}],warning:[...Mu,{regex:/.*\[/,token:"comment"}]});Vl.defineSimpleMode("log",{start:[{regex:/^[=]+[^=]*[=]+/,token:"strong"},{regex:/([^\w])([A-Z][\w]*)/,token:["","string"]},{regex:/(^[A-Z][\w]*)/,token:"string"}]});const gA=hs({name:"CodemirrorFclog",props:{value:{type:String,default:""},name:{type:String,default:`cm-textarea-${+new Date}`},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=xe(),n=xe(null),i=(s=r.cminstance)=>{s.getAllMarks().forEach(c=>c.clear());const l=s.getValue(),d=[].concat(pA(l)).concat(vA(l));for(let c=0;c<d.length;c++){const f=d[c];s.markText(s.posFromIndex(f.start),s.posFromIndex(f.end),{replacedWith:f.node})}},o=()=>{var s;n.value=nc(Vl.fromTextArea(t.value,r.options)),e("update:cminstance",$e(n)),(s=n.value)==null||s.on("change",i)};return Qt(()=>r.cminstance,s=>{var l;s&&(i(r.cminstance),(l=r.cminstance)==null||l.setValue(r.value),e("ready",n))},{deep:!0,immediate:!0}),qt(()=>{o()}),{initialize:o,textarea:t}}}),mA=["name","placeholder"];function yA(r,e,t,n,i,o){return Y(),ae("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,mA)}const _A=Jh(gA,[["render",yA]]),k1={"update:value":()=>!0,change:(r,e)=>({value:r,cm:e}),input:()=>!0,ready:r=>r},bA=["changes","scroll","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],xA=()=>{const r={};return bA.forEach(e=>{r[e]=(...t)=>t}),r},wA={...k1,...xA()},gf={mode:"text",theme:"default",lineNumbers:!0,smartIndent:!0,indentUnit:2,styleActiveLine:!0};function SA(r){Promise.resolve().then(()=>{const e=r.getScrollInfo();r.scrollTo(e.left,e.height)})}const EA=({props:r,cminstance:e,emit:t,internalInstance:n,content:i})=>{const o=tn(()=>{var l;return r.merge?(l=$e(e))==null?void 0:l.editor():$e(e)}),s=()=>{const l=[];return Object.keys(n==null?void 0:n.vnode.props).forEach(d=>{if(d.startsWith("on")){const c=d.replace(d[2],d[2].toLowerCase()).slice(2);!k1[c]&&l.push(c)}}),l};return{listenerEvents:()=>{o.value.on("change",d=>{const c=d.getValue();c===i.value&&c!==""||(i.value=c,t("update:value",i.value||""),t("input",i.value||" "),Promise.resolve().then(()=>{t("change",i.value,d)}),r.keepCursorInEnd&&SA(d))});const l={};s().filter(d=>!l[d]&&(l[d]=!0)).forEach(d=>{o.value.on(d,(...c)=>{t(d,...c)})})}}};function CA({props:r,cminstance:e,presetRef:t}){const n=xe("100%"),i=xe("100%"),o=tn(()=>{var g;return r.merge?(g=$e(e))==null?void 0:g.editor():$e(e)}),s=()=>{_n(()=>{var g;(g=o.value)==null||g.refresh()})},l=g=>g?!(g&&isNaN(+g)):!1,d=(g=r.width,y=r.height)=>{var b;let x="100%",w="100%";l(g)?x=`${String(g)}px`:g&&(x=g),l(y)?w=`${String(y)}px`:y&&(w=y),n.value=x,i.value=w,(b=o.value)==null||b.setSize("100%","100%")},c=()=>{var g;const y=(g=o.value)==null?void 0:g.getWrapperElement();y==null||y.remove()},f=()=>{var g,y,b;const x=(g=o.value)==null?void 0:g.getDoc().getHistory();(y=t.value)==null||y.initialize(),c(),(b=o.value)==null||b.getDoc().setHistory(x)},v=()=>{const g=document.querySelector(".CodeMirror-gutters");return(g==null?void 0:g.style.left.replace("px",""))!=="0"};return{reload:f,refresh:s,resize:d,destroy:c,containerWidth:n,containerHeight:i,reviseStyle:()=>{if(s(),!v())return;const g=setInterval(()=>{v()?s():clearInterval(g)},60),y=setTimeout(()=>{clearInterval(g),clearTimeout(y)},400)}}}const OA=hs({__name:"index",props:{value:{type:String,default:""},options:{type:Object,default:()=>gf},globalOptions:{type:Object,default:()=>gf},placeholder:{type:String,default:""},border:{type:Boolean,default:!1},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},originalStyle:{type:Boolean,default:!1},keepCursorInEnd:{type:Boolean,default:!1},merge:{type:Boolean,default:!1},name:{type:String,default:""},marker:{type:Function,default:()=>null},unseenLines:{type:Array,default:()=>[]}},emits:wA,setup(r,{expose:e,emit:t}){var n,i,o;typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value(q){if(q==null)throw new TypeError("Cannot convert undefined or null to object");const ee=Object(q);for(let T=1;T<arguments.length;T++){const z=arguments[T];if(z!=null)for(const B in z)Object.prototype.hasOwnProperty.call(z,B)&&(ee[B]=z[B])}return ee},writable:!0,configurable:!0});const s=r,l=t,d=xe(null),c=xe(""),f=RC(Bg),v=xe({foldGutter:!0,...gf,...s.globalOptions,...s.options,gutters:[...new Set(["CodeMirror-linenumbers","CodeMirror-foldgutter",...((n=s.options)==null?void 0:n.gutters)||[]])]}),g=IC(),y=s.name||((o=(i=g==null?void 0:g.parent)==null?void 0:i.type)==null?void 0:o.name)||void 0,b=xe(null),x=tn(()=>{var q;return s.merge?(q=$e(d))==null?void 0:q.editor():$e(d)}),{refresh:w,resize:_,destroy:C,containerHeight:k,containerWidth:D,reviseStyle:R}=CA({props:s,cminstance:d,presetRef:b}),{listenerEvents:$}=EA({props:s,cminstance:d,emit:l,internalInstance:g,content:c}),P=()=>{s.unseenLines!==void 0&&s.marker!==void 0&&s.unseenLines.forEach(q=>{var ee,T;const z=(ee=d.value)==null?void 0:ee.lineInfo(q);(T=d.value)==null||T.setGutterMarker(q,"breakpoints",z!=null&&z.gutterMarkers?null:s.marker())})},I=q=>{var ee,T;const z=(ee=d.value)==null?void 0:ee.getValue();q!==z&&((T=d.value)==null||T.setValue(q),c.value=q,R()),P()},W=()=>{$(),P(),_(s.width,s.height),l("ready",d.value),Qt([()=>s.width,()=>s.height],([q,ee])=>{_(q,ee)},{deep:!0})},se=()=>{if(s.options.mode==="fclog"||s.options.mode==="log"){f.value=_A;return}if(s.merge){f.value=hA;return}f.value=Bg};return Qt(()=>s.options,q=>{var ee;for(const T in s.options)(ee=x.value)==null||ee.setOption(T,$e(q[T]))},{deep:!0}),Qt(()=>s.value,q=>{I(q)}),Qt(()=>s.merge,se,{immediate:!0}),Oi(()=>{C()}),e({cminstance:d,resize:_,refresh:w,destroy:C}),(q,ee)=>(Y(),ae("div",{class:Sn(["codemirror-container",{merge:q.$props.merge,bordered:q.$props.border||q.$props.merge&&!s.originalStyle,"original-style":s.originalStyle}]),style:Ci({height:$e(k),width:$e(D)})},[(Y(),ze(l_(f.value),BC({ref_key:"presetRef",ref:b,cminstance:d.value,"onUpdate:cminstance":ee[0]||(ee[0]=T=>d.value=T),style:{height:"100%"}},{...q.$props,...q.$attrs,options:v.value,name:$e(y),content:c.value},{onReady:W}),null,16,["cminstance"]))],6))}});function kA(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}kA(`.codemirror-container {
  position: relative;
  display: inline-block;
  height: 100%;
  width: fit-content;
  font-size: 13px;
  overflow: hidden;
}
.codemirror-container.bordered {
  border: 1px solid #aaaaaa;
}

.codemirror-container .editor_custom_link {
  cursor: pointer;
  color: #1474f1;
  text-decoration: underline;
}
.codemirror-container .editor_custom_link:hover {
  color: #04b4fa;
}
.codemirror-container:not(.original-style) .CodeMirror-lines .CodeMirror-placeholder.CodeMirror-line-like {
  color: #666;
}
.codemirror-container:not(.original-style) .CodeMirror,
.codemirror-container:not(.original-style) .CodeMirror-merge-pane {
  height: 100%;
  font-family: consolas !important;
}
.codemirror-container:not(.original-style) .CodeMirror-merge,
.codemirror-container:not(.original-style) .CodeMirror-merge-right .CodeMirror {
  height: 100%;
  border: none !important;
}
.codemirror-container:not(.original-style) .c-editor--log__error {
  color: #bb0606;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__info {
  color: #333333;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__warning {
  color: #ee9900;
}
.codemirror-container:not(.original-style) .c-editor--log__success {
  color: #669600;
}
.codemirror-container:not(.original-style) .cm-header,
.codemirror-container:not(.original-style) .cm-strong {
  font-weight: bold;
}
`);const jg={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(r,{expose:e,emit:t}){const n=t,i=xe(""),o=r;Qt(()=>o.value,g=>{i.value=g},{immediate:!0});const s={mode:"text/javascript",theme:"dracula"},l=xe(null),d=g=>{n("update:value",g)},c=()=>{l.value.refresh()},f=()=>{},v=()=>{};return e({handleRefresh:c}),(g,y)=>(Y(),ae("div",null,[j($e(OA),{onWheel:y[0]||(y[0]=cn(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":y[1]||(y[1]=b=>i.value=b),options:s,ref_key:"cmRef",ref:l,height:o.height,width:o.width,onChange:d,onInput:v,onReady:f},null,8,["value","height","width"])]))}},MA={class:"problem-optimization-form"},NA={class:"node-form-content"},AA={class:"gray-block"},TA={class:"array-form-box"},DA={class:"flex-block-item"},LA=["onClick"],PA={class:"code-edit-box"},RA={class:"title-block"},IA={class:"code-box"},BA={class:"flex-block-item"},jA={class:"gray-block mt16"},HA={class:"output-box"},$A={class:"flex-block-item",style:{gap:"12px"}},FA=["onClick"],zA=["onClick"],WA={key:0,class:"sub-field-box"},UA={style:{margin:"40px 0 24px 0"}},Hg=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,VA={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=xe([]);function o(){const ee=n.lf.getNodeModelById(n.nodeId);if(ee){let T=ee.getAllParentVariable();i.value=s(T)}}function s(ee){return ee.forEach(T=>{T.typ=="node"?T.node_type==1?T.value="global":T.value=T.node_id:T.value=T.key,T.children&&T.children.length>0&&(T.children=s(T.children))}),ee}const l=xe(),d=Jt({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),c=()=>{d.main_func=Hg};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function v(ee){return ee.forEach(T=>{T.cu_key=Math.random()*1e4,T.subs&&T.subs.length?v(T.subs):T.subs=[]}),ee}const g=()=>{const ee=JSON.stringify({code_run:{...d,params:y()}});t("update-node",{...n.node,...d,node_params:ee})};function y(){let ee=[];return d.params.forEach(T=>{ee.push({field:T.field,variable:T.variable&&T.variable.length>0?T.variable.join("."):""})}),ee}const b=()=>{try{let ee=n.node.dataRaw||n.node.node_params||"{}",T=JSON.parse(ee).code_run||{};T=JSON.parse(JSON.stringify(T)),o();for(let z in T){if(z=="params"){T[z]&&T[z].length>0?d[z]=T[z].map(B=>({...B,cu_key:Math.random()*1e4})):d[z]=[];continue}if(z=="output"){d.output=v(T[z]);continue}d[z]=T[z]}d.main_func=d.main_func||Hg,d.params=d.params.map(z=>{let B="";for(let pe=0;pe<f.length;pe++)if(z.variable.indexOf(f[pe])>-1){B=f[pe];break}if(B!=""){let pe=z.variable.split(".");z.variable=[pe[0],B]}else z.variable=z.variable.split(".");return{...z,key:Math.random()*1e4}})}catch(ee){}};Qt(()=>d,()=>{g()},{deep:!0});const x=()=>{d.params.push({key:"",value:"",cu_key:Math.random()*1e4})},w=ee=>{d.params.splice(ee,1)},_=()=>{d.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},C=ee=>{d.output.splice(ee,1)},k=ee=>{ee.subs=[]},D=ee=>{d.output[ee].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},R=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],$=ee=>{ee||o()},P=xe(!1),I=xe(null),W=()=>{P.value=!0,I.value&&I.value.handleRefresh()},se=()=>{P.value=!1},q=()=>{t("close")};return qt(()=>{b()}),(ee,T)=>{const z=Cr,B=da,pe=vs,Ee=Xi,ye=Bn,it=gs,Oe=Ni,he=jr,We=Br,Re=wr,Ge=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:q},null,8,["title","iconName"])]),default:U(()=>[E("div",MA,[E("div",NA,[j(Ge,{ref_key:"formRef",ref:l,layout:"vertical",model:d},{default:U(()=>[E("div",AA,[T[10]||(T[10]=E("div",{class:"gray-block-title"},"输入",-1)),E("div",TA,[T[6]||(T[6]=E("div",{class:"form-item-label"},"自定义输入参数",-1)),(Y(!0),ae(dt,null,yt(d.params,(le,G)=>(Y(),ae("div",{class:"form-item-list",key:G},[j(Ee,{label:null,name:["params",G,"variable"]},{default:U(()=>[E("div",DA,[j(B,null,{default:U(()=>[j(z,{style:{width:"190px"},value:le.field,"onUpdate:value":oe=>le.field=oe,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),j(pe,{value:le.variable,"onUpdate:value":oe=>le.variable=oe,onDropdownVisibleChange:$,style:{width:"400px"},options:i.value,allowClear:!1,displayRender:({labels:oe})=>oe.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),E("div",{class:"btn-hover-wrap",onClick:oe=>w(G)},[j($e(fr))],8,LA)])]),_:2},1032,["name"])]))),128)),j(ye,{onClick:x,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>T[5]||(T[5]=[Be("添加参数")])),_:1,__:[5]},8,["icon"])]),E("div",PA,[E("div",RA,[T[7]||(T[7]=E("div",null,"JavaScript 代码",-1)),j(it,{gap:16,align:"center"},{default:U(()=>[E("a",{onClick:c},"还原为模板"),E("div",{class:"btn-hover-wrap",onClick:W},[j($e(Xh))])]),_:1})]),E("div",IA,[j(jg,{value:d.main_func,"onUpdate:value":T[0]||(T[0]=le=>d.main_func=le),width:410,height:170},null,8,["value"])])]),j(Ee,{name:"timeout",class:"mt16"},{label:U(()=>[j(it,{gap:2},{default:U(()=>T[8]||(T[8]=[Be("超时时长")])),_:1,__:[8]})]),default:U(()=>[E("div",BA,[j(Oe,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:d.timeout,"onUpdate:value":T[1]||(T[1]=le=>d.timeout=le),min:0,max:3e3},null,8,["value"]),T[9]||(T[9]=Be(" 秒 "))])]),_:1})]),E("div",jA,[T[13]||(T[13]=E("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),E("div",HA,[T[12]||(T[12]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:T[2]||(T[2]=cn(()=>{},["stop"]))},[(Y(!0),ae(dt,null,yt(d.output,(le,G)=>(Y(),ae("div",{class:"form-item-list",key:G},[j(Ee,{label:null,name:["output",G,"key"]},{default:U(()=>[E("div",$A,[j(z,{style:{width:"214px"},value:le.key,"onUpdate:value":oe=>le.key=oe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),j(B,null,{default:U(()=>[j(We,{onChange:oe=>k(le),value:le.typ,"onUpdate:value":oe=>le.typ=oe,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(Y(),ae(dt,null,yt(R,oe=>j(he,{value:oe.value,key:oe.value},{default:U(()=>[Be(Te(oe.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),le.typ=="object"?(Y(),ae("div",{key:0,class:"btn-hover-wrap",onClick:oe=>D(G)},[j($e(ms))],8,FA)):et("",!0),E("div",{class:"btn-hover-wrap",onClick:oe=>C(G)},[j($e(fr))],8,zA)]),le.subs&&le.subs.length>0?(Y(),ae("div",WA,[j(B,null,{default:U(()=>[j(KN,{data:le.subs,level:2,typOptions:R},null,8,["data"])]),_:2},1024)])):et("",!0)]),_:2},1032,["name"])]))),128)),j(ye,{onClick:_,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>T[11]||(T[11]=[Be("添加参数")])),_:1,__:[11]},8,["icon"])],32)])]),T[15]||(T[15]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"异常处理"),E("div",null,"运行代码报错时执行该分支")],-1)),j(Re,{open:P.value,"onUpdate:open":T[4]||(T[4]=le=>P.value=le),title:"编辑代码",width:746},{footer:U(()=>[j(ye,{type:"primary",onClick:se},{default:U(()=>T[14]||(T[14]=[Be("确定")])),_:1,__:[14]})]),default:U(()=>[E("div",UA,[j(jg,{ref_key:"codeEditBoxRef",ref:I,value:d.main_func,"onUpdate:value":T[3]||(T[3]=le=>d.main_func=le),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1,__:[15]},8,["model"])])])]),_:1})}}},XA=bt(VA,[["__scopeId","data-v-ff8a1a30"]]),GA={class:"sub-field-item"},YA=["onClick"],KA=["onClick"],qA={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(d=>d.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px"),i=(d,c)=>{c[d].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(d,c)=>{c.splice(d,1)},s=d=>{d.subs=[]},l=d=>d.typ=="object"&&e.level<=2;return(d,c)=>{const f=Cr,v=jr,g=Br,y=Mn("SubsKey",!0);return Y(!0),ae(dt,null,yt(e.data,(b,x)=>(Y(),ae("div",{class:Sn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:b.cu_key},[E("div",GA,[c[0]||(c[0]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(f,{class:"mr12",style:Ci({width:n.value}),value:b.key,"onUpdate:value":w=>b.key=w,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),c[1]||(c[1]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(g,{class:"mr12",onChange:w=>s(b),value:b.typ,"onUpdate:value":w=>b.typ=w,placeholder:"请选择",style:Ci({width:n.value})},{default:U(()=>[(Y(!0),ae(dt,null,yt(t.value,w=>(Y(),ze(v,{value:w.value},{default:U(()=>[Be(Te(w.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(b)?(Y(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:w=>i(x,e.data)},[j($e(ms))],8,YA)):et("",!0),E("div",{class:"btn-hover-wrap",onClick:w=>o(x,e.data)},[j($e(fr))],8,KA)]),b.subs&&b.subs.length>0?(Y(),ze(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:b.subs},null,8,["level","typOptions","data"])):et("",!0)],2))),128)}}},JA=bt(qA,[["__scopeId","data-v-b8acefd2"]]),ZA={class:"problem-optimization-form"},QA={class:"node-form-content"},eT={class:"gray-block"},tT={class:"flex-block-item"},nT={class:"array-form-box"},rT={class:"flex-block-item"},iT={class:"at-input-flex1"},oT={class:"field-list-item"},aT={class:"field-label"},sT={class:"field-type"},lT=["onClick"],uT={class:"array-form-box"},dT={class:"flex-block-item"},cT={class:"at-input-flex1"},fT={class:"field-list-item"},hT={class:"field-label"},pT={class:"field-type"},vT=["onClick"],gT={key:0},mT={key:0,class:"array-form-box"},yT={class:"flex-block-item"},_T={class:"at-input-flex1"},bT={class:"field-list-item"},xT={class:"field-label"},wT={class:"field-type"},ST=["onClick"],ET={class:"field-list-item"},CT={class:"field-label"},OT={class:"field-type"},kT={class:"flex-block-item"},MT={class:"gray-block mt16"},NT={class:"output-box"},AT={class:"flex-block-item",style:{gap:"12px"}},TT=["onClick"],DT=["onClick"],LT={key:0,class:"sub-field-box"},PT={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=xe([]),o=Jt({}),s=(se,q,ee)=>{if(se){let T=`at_input_${q}_${ee}`;o[T]=se}},l=(se,q,ee,T)=>{se=="body_raw"?(f.body_raw=q,f.body_raw_tags=ee):(T.tags=ee,T.value=q)},d=()=>{const se=n.lf.getNodeModelById(n.nodeId);if(se){let q=se.getAllParentVariable();q.forEach(ee=>{ee.tags=ee.tags||[]}),i.value=q}},c=xe(),f=Jt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function v(se){return se.forEach(q=>{q.cu_key=Math.random()*1e4,q.subs&&q.subs.length?v(q.subs):q.subs=[]}),se}const g=()=>{const se=JSON.stringify({curl:{...f}});t("update-node",{...n.node,...f,node_params:se})},y=()=>{try{let se=n.node.dataRaw||n.node.node_params||"{}",q=JSON.parse(se).curl||{};q=JSON.parse(JSON.stringify(q)),d();for(let ee in q){if(ee=="headers"||ee=="params"||ee=="body"){q[ee]&&q[ee].length>0?f[ee]=q[ee].map(T=>({...T,cu_key:Math.random()*1e4})):f[ee]=[];continue}if(ee=="output"){f.output=v(q[ee]);continue}f[ee]=q[ee]}}catch(se){}};Qt(()=>f,()=>{g()},{deep:!0});const b=()=>{f.headers.push({key:"",value:"",cu_key:Math.random()*1e4})},x=se=>{f.headers.splice(se,1)},w=()=>{f.params.push({key:"",value:"",cu_key:Math.random()*1e4})},_=se=>{f.params.splice(se,1)},C=()=>{f.body.push({key:"",value:"",cu_key:Math.random()*1e4})},k=se=>{f.body.splice(se,1)},D=()=>{f.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},R=se=>{f.output.splice(se,1)},$=se=>{se.subs=[]},P=se=>{f.output[se].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},I=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],W=()=>{t("close")};return qt(()=>{y()}),(se,q)=>{const ee=jr,T=Br,z=da,B=Cr,pe=Xi,Ee=Bn,ye=h_,it=f_,Oe=gs,he=Ni,We=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:W},null,8,["title","iconName"])]),default:U(()=>[E("div",ZA,[E("div",QA,[j(We,{ref_key:"formRef",ref:c,layout:"vertical",model:f},{default:U(()=>[E("div",eT,[q[19]||(q[19]=E("div",{class:"gray-block-title"},"输入",-1)),j(pe,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:U(()=>[E("div",tT,[j(z,null,{default:U(()=>[j(T,{value:f.method,"onUpdate:value":q[0]||(q[0]=Re=>f.method=Re),style:{width:"120px"}},{default:U(()=>[j(ee,{value:"POST"},{default:U(()=>q[7]||(q[7]=[Be("POST")])),_:1,__:[7]}),j(ee,{value:"GET"},{default:U(()=>q[8]||(q[8]=[Be("GET")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),j(B,{class:"flex1",value:f.rawurl,"onUpdate:value":q[1]||(q[1]=Re=>f.rawurl=Re),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),E("div",nT,[q[10]||(q[10]=E("div",{class:"form-item-label"},"HEADERS",-1)),(Y(!0),ae(dt,null,yt(f.headers,(Re,Ge)=>(Y(),ae("div",{class:"form-item-list",key:Ge},[j(pe,{label:null,name:["headers",Ge,"value"]},{default:U(()=>[E("div",rT,[j(z,null,{default:U(()=>[j(B,{style:{width:"120px"},value:Re.key,"onUpdate:value":le=>Re.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",iT,[j(hr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>s(le,"headers",Ge),options:i.value,defaultSelectedList:Re.tags,defaultValue:Re.value,onOpen:d,onChange:(le,G)=>l("headers",le,G,Re,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:le,payload:G})=>[E("div",oT,[E("div",aT,Te(le),1),E("div",sT,Te(G.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>x(Ge)},[j($e(fr))],8,lT)])]),_:2},1032,["name"])]))),128)),j(Ee,{onClick:b,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>q[9]||(q[9]=[Be("添加参数")])),_:1,__:[9]},8,["icon"])]),E("div",uT,[q[12]||(q[12]=E("div",{class:"form-item-label"},"PARAMS",-1)),(Y(!0),ae(dt,null,yt(f.params,(Re,Ge)=>(Y(),ae("div",{class:"form-item-list",key:Ge},[j(pe,{label:null,name:["params",Ge,"value"]},{default:U(()=>[E("div",dT,[j(z,null,{default:U(()=>[j(B,{style:{width:"120px"},value:Re.key,"onUpdate:value":le=>Re.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",cT,[j(hr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>s(le,"params",Ge),options:i.value,defaultSelectedList:Re.tags,defaultValue:Re.value,onOpen:d,onChange:(le,G)=>l("params",le,G,Re,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:le,payload:G})=>[E("div",fT,[E("div",hT,Te(le),1),E("div",pT,Te(G.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>_(Ge)},[j($e(fr))],8,vT)])]),_:2},1032,["name"])]))),128)),j(Ee,{onClick:w,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>q[11]||(q[11]=[Be("添加参数")])),_:1,__:[11]},8,["icon"])]),f.method=="POST"?(Y(),ae("div",gT,[j(pe,{label:"BODY",name:"type",class:"line-height-22"},{default:U(()=>[j(it,{value:f.type,"onUpdate:value":q[2]||(q[2]=Re=>f.type=Re)},{default:U(()=>[j(ye,{value:0},{default:U(()=>q[13]||(q[13]=[Be("none")])),_:1,__:[13]}),j(ye,{value:1},{default:U(()=>q[14]||(q[14]=[Be("x-www-form-urlencoded")])),_:1,__:[14]}),j(ye,{value:2},{default:U(()=>q[15]||(q[15]=[Be("JSON")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),f.type==1?(Y(),ae("div",mT,[(Y(!0),ae(dt,null,yt(f.body,(Re,Ge)=>(Y(),ae("div",{class:"form-item-list",key:Ge},[j(pe,{label:null,name:["body",Ge,"value"],rules:{required:!0}},{default:U(()=>[E("div",yT,[j(z,null,{default:U(()=>[j(B,{style:{width:"120px"},value:Re.key,"onUpdate:value":le=>Re.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",_T,[j(hr,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>s(le,"body",Ge),options:i.value,defaultSelectedList:Re.tags,defaultValue:Re.value,onOpen:d,onChange:(le,G)=>l("body",le,G,Re,Ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:le,payload:G})=>[E("div",bT,[E("div",xT,Te(le),1),E("div",wT,Te(G.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>k(Ge)},[j($e(fr))],8,ST)])]),_:2},1032,["name"])]))),128)),j(Ee,{onClick:C,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>q[16]||(q[16]=[Be("添加参数")])),_:1,__:[16]},8,["icon"])])):et("",!0),f.type==2?(Y(),ze(pe,{key:1,label:null,name:"body_raw"},{default:U(()=>[j(hr,{type:"textarea",options:i.value,defaultSelectedList:f.body_raw_tags,defaultValue:f.body_raw,ref:Re=>s(Re,"body","body_raw"),onOpen:d,onChange:q[3]||(q[3]=(Re,Ge)=>l("body_raw",Re,Ge)),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:Re,payload:Ge})=>[E("div",ET,[E("div",CT,Te(Re),1),E("div",OT,Te(Ge.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):et("",!0)])):et("",!0),j(pe,{name:"timeout"},{label:U(()=>[j(Oe,{gap:2},{default:U(()=>q[17]||(q[17]=[Be("超时时长")])),_:1,__:[17]})]),default:U(()=>[E("div",kT,[j(he,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:f.timeout,"onUpdate:value":q[4]||(q[4]=Re=>f.timeout=Re),min:0,max:3e3},null,8,["value"]),q[18]||(q[18]=Be(" 秒 "))])]),_:1})]),E("div",MT,[E("div",{class:"gray-block-title",onClick:q[5]||(q[5]=(...Re)=>se.test&&se.test(...Re))},"输出 (输出字段提取)"),E("div",NT,[q[21]||(q[21]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:q[6]||(q[6]=cn(()=>{},["stop"]))},[(Y(!0),ae(dt,null,yt(f.output,(Re,Ge)=>(Y(),ae("div",{class:"form-item-list",key:Ge},[j(pe,{label:null,name:["output",Ge,"key"]},{default:U(()=>[E("div",AT,[j(B,{style:{width:"214px"},value:Re.key,"onUpdate:value":le=>Re.key=le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),j(z,null,{default:U(()=>[j(T,{onChange:le=>$(Re),value:Re.typ,"onUpdate:value":le=>Re.typ=le,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(Y(),ae(dt,null,yt(I,le=>j(ee,{value:le.value,key:le.value},{default:U(()=>[Be(Te(le.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Re.typ=="object"?(Y(),ae("div",{key:0,class:"btn-hover-wrap",onClick:le=>P(Ge)},[j($e(ms))],8,TT)):et("",!0),E("div",{class:"btn-hover-wrap",onClick:le=>R(Ge)},[j($e(fr))],8,DT)]),Re.subs&&Re.subs.length>0?(Y(),ae("div",LT,[j(z,null,{default:U(()=>[j(JA,{data:Re.subs,level:2,typOptions:I},null,8,["data"])]),_:2},1024)])):et("",!0)]),_:2},1032,["name"])]))),128)),j(Ee,{onClick:D,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>q[20]||(q[20]=[Be("添加参数")])),_:1,__:[20]},8,["icon"])],32)])])]),_:1},8,["model"])])])]),_:1})}}},RT=bt(PT,[["__scopeId","data-v-b2059d33"]]),Pn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},M1={string:[Pn.EQUALITY.IS,Pn.EQUALITY.IS_NOT,Pn.TEXT.CONTAIN,Pn.TEXT.NOT_CONTAIN,Pn.NULLABILITY.EMPTY,Pn.NULLABILITY.NOT_EMPTY],integer:[Pn.COMPARISON.GT,Pn.COMPARISON.LT,Pn.COMPARISON.GTE,Pn.COMPARISON.LTE,Pn.EQUALITY.EQ,Pn.COMPARISON.BETWEEN],number:[Pn.COMPARISON.GT,Pn.COMPARISON.LT,Pn.COMPARISON.GTE,Pn.COMPARISON.LTE,Pn.EQUALITY.EQ,Pn.COMPARISON.BETWEEN],boolean:[Pn.BOOLEAN.TRUE,Pn.BOOLEAN.FALSE]},N1=r=>M1[r]||[],Zh=(r,e)=>{const n=N1(e).find(i=>i.value===r);return(n==null?void 0:n.label)||r},IT={class:"query-condition-filter"},BT={class:"condition-select-box"},jT={class:"select-wrapper"},HT={class:"field-items"},$T={class:"field-select-box"},FT={class:"operator-select-box"},zT={class:"field-value-box"},WT={key:0,class:"site-input-group-wrapper"},UT={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},VT={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},XT=["onClick"],GT={class:"add-btn-box"},YT={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(r,{emit:e}){const t=e,n=r,i=Nt("getNode"),o=Jt({list:n.where,type:n.type});Qt(()=>n.where,k=>{o.list=k}),Qt(()=>n.type,k=>{o.type=k});const s=tn(()=>n.where.length>1),l=tn(()=>M1),d=xe([]),c=()=>{let k=i().getAllParentVariable();d.value=k||[]},f=()=>{c()},v=()=>{let k={type:o.type,list:o.list};t("change",k)},g=(k,D,R,$)=>{o.list[$].rule_value1=k,o.list[$].atTags=D,v()},y=(k,D,R,$)=>{o.list[$].rule_value2=k,o.list[$].atTags2=D,v()},b=()=>{let k={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list.push(k),v()},x=k=>{o.list.splice(k,1),v()},w=(k,D)=>{let R=N1(D.type),$={form_field_id:D.value,field_name:D.name,field_type:D.type,rule:R[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list[k]=$,v()},_=(k,D)=>{let R=o.list[k];R.rule=D.value,R.rule_value1="",R.rule_value2="",R.atTags=[],R.atTags2=[],v()},C=({key:k})=>{o.type=k,t("changeType",k),v()};return qt(()=>{c()}),(k,D)=>{const R=Uh,$=Wh,P=Vh,I=jr,W=Br,se=Cr,q=Ir,ee=Bn,T=ki;return Y(),ae("div",{class:Sn(["query-condition-filter-warpper",{"is-multiple":s.value}])},[E("div",IT,[D[5]||(D[5]=E("div",{class:"auxiliary-line"},null,-1)),E("div",BT,[E("div",jT,[j(P,null,{overlay:U(()=>[j($,{style:{width:"100px"},onClick:C},{default:U(()=>[(Y(),ze(R,{key:1},{default:U(()=>D[1]||(D[1]=[E("a",{href:"javascript:;"},"且",-1)])),_:1,__:[1]})),(Y(),ze(R,{key:2},{default:U(()=>D[2]||(D[2]=[E("a",{href:"javascript:;"},"或",-1)])),_:1,__:[2]}))]),_:1})]),default:U(()=>[E("a",{class:"ant-dropdown-link",onClick:D[0]||(D[0]=cn(()=>{},["prevent"]))},[Be(Te(o.type==1?"且":"或")+" ",1),j($e(ps))])]),_:1})])]),E("div",HT,[(Y(!0),ae(dt,null,yt(o.list,(z,B)=>(Y(),ae("div",{class:"field-item",key:z.field},[E("div",$T,[j(W,{style:{width:"100px"},value:z.form_field_id,"onUpdate:value":pe=>z.form_field_id=pe,onChange:(pe,Ee)=>w(B,Ee)},{default:U(()=>[j(I,{value:0,type:"integer",name:"ID",key:"id"},{default:U(()=>D[3]||(D[3]=[Be("ID")])),_:1,__:[3]}),(Y(!0),ae(dt,null,yt(n.fieldOptions,pe=>(Y(),ze(I,{value:pe.id,type:pe.type,name:pe.name,key:pe.id},{default:U(()=>[Be(Te(pe.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",FT,[j(W,{value:z.rule,"onUpdate:value":pe=>z.rule=pe,style:{width:"100px"},onChange:(pe,Ee)=>_(B,Ee)},{default:U(()=>[(Y(!0),ae(dt,null,yt(l.value[z.field_type],pe=>(Y(),ze(I,{value:pe.value,key:pe.value},{default:U(()=>[Be(Te(pe.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",zT,[z.rule==="between"?(Y(),ae("div",WT,[E("div",UT,[j(hr,{options:d.value,defaultValue:z.rule_value1,defaultSelectedList:z.atTags,onOpen:f,onChange:(pe,Ee)=>g(pe,Ee,z,B),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),D[4]||(D[4]=E("span",{class:"site-input-split"},"~",-1)),E("div",VT,[j(hr,{options:d.value,defaultValue:z.rule_value2,defaultSelectedList:z.atTags2,onOpen:f,onChange:(pe,Ee)=>y(pe,Ee,z,B),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(z.field_type)?(Y(),ze(se,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(z.field_type)?(Y(),ze(hr,{key:2,options:d.value,defaultValue:z.rule_value1,defaultSelectedList:z.atTags,onOpen:f,onChange:(pe,Ee)=>g(pe,Ee,z,B),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(Y(),ze(hr,{key:3,options:d.value,defaultValue:z.rule_value1,defaultSelectedList:z.atTags,onOpen:f,onChange:(pe,Ee)=>g(pe,Ee,z,B),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),E("span",{class:"field-del-btn",onClick:pe=>x(B)},[j(q,{class:"del-icon",name:"close-circle"})],8,XT)]))),128))])]),E("div",GT,[r.disabled?(Y(),ze(T,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:U(()=>[E("span",null,[j(ee,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:U(()=>[j($e(In)),D[6]||(D[6]=Be(" 添加条件 "))]),_:1,__:[6]})])]),_:1})):(Y(),ze(ee,{key:1,class:"add-btn",type:"dashed",block:"",onClick:b},{default:U(()=>[j($e(In)),D[7]||(D[7]=Be(" 添加条件 "))]),_:1,__:[7]}))])],2)}}},Qh=bt(YT,[["__scopeId","data-v-d18ef387"]]),KT={class:"delete-data-form"},qT={class:"node-box-content"},JT={class:"setting-box"},ZT={class:"setting-box"},QT={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Nt("setData"),n=Mo();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),s=({type:b,list:x})=>{o.formData.typ=b,o.formData.where=x,c()},l=(b,x)=>{x?(o.formData.form_name=x.name,o.formData.form_description=x.description,y(x.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.where=[]),c()},d=()=>{let b=e.node.dataRaw||"{}";i=JSON.parse(b);let x=f(i.form_delete.where||[]);i.form_delete.where=x,o.formData=i.form_delete,o.formData.form_id&&y(o.formData.form_id),c()},c=()=>{let b={...Vi(o.formData)};b.where=v(b.where),i.form_delete=b,t({...e.node,node_params:JSON.stringify(i)})},f=b=>{let x=[];return b.forEach(w=>{let _=JSON.parse(JSON.stringify(w)),C=_.rule.split("_");_.form_field_id=_.form_field_id*1,_.field_type=C[0],C.shift(),_.rule=C.join("_"),x.push(_)}),x},v=b=>{let x=[];return b.forEach(w=>{let _=JSON.parse(JSON.stringify(w));_.form_field_id=_.form_field_id*1,_.rule=w.field_type+"_"+w.rule,x.push(_)}),x},g=async()=>{const b=await n.getFormList();b&&(o.tableList=b)},y=async b=>{n.getFormFieldList({form_id:b}).then(x=>{x.forEach(w=>{w.id=w.id*1}),o.fieldList=x}).catch(()=>{})};return qt(()=>{g(),d()}),(b,x)=>(Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:U(()=>x[1]||(x[1]=[E("span",null,[Be("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",KT,[E("div",qT,[x[2]||(x[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ul,alt:""}),E("span",{class:"text"},"输入")],-1)),x[3]||(x[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",JT,[j(ac,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":x[0]||(x[0]=w=>o.formData.form_id=w),onChange:l},null,8,["options","title","description","value"])]),x[4]||(x[4]=E("div",{class:"setting-label"},[E("span",null,"删除条件")],-1)),E("div",ZT,[j(Qh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},eD=bt(QT,[["__scopeId","data-v-c1b21ded"]]),tD={class:"variable-node"},nD={class:"node-form-content"},rD={class:"gray-block"},iD={class:"field-items"},oD={class:"field-name-box"},aD={class:"field-value-box"},sD={class:"field-value-option"},lD={class:"option-label"},uD={class:"option-type"},dD={class:"field-actions"},cD={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=xe([]),o=xe([]);function s(){const _=n.lf.getNodeModelById(n.nodeId);if(_){let k=_.getGlobalVariable().diy_global||[];k.forEach(D=>{D.label=D.key,D.value="global."+D.key}),o.value=k||[]}}function l(){const _=n.lf.getNodeModelById(n.nodeId);if(_){let C=_.getAllParentVariable();i.value=C}}const d=xe([]),c=()=>{let _=JSON.parse(n.node.node_params);_.assign=[...d.value],t("update-node",{...n.node,node_params:JSON.stringify(_)})},f=()=>{try{let _=n.node.dataRaw||n.node.node_params||"{}",C=JSON.parse(_).assign||[];C=JSON.parse(JSON.stringify(C)),C.forEach(k=>{k.tags=k.tags||[]}),d.value=C,s()}catch(_){}},v=_=>{_&&l()},g=(_,C,k)=>{k.tags=C,k.value=_,c()},y=()=>{d.value.push({variable:void 0,value:""}),c()},b=_=>{d.value.splice(_,1),c()},x=_=>{_&&s()},w=()=>{t("close")};return qt(()=>{f()}),(_,C)=>{const k=jr,D=Br,R=Bn;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:w},null,8,["title","iconName"])]),default:U(()=>[E("div",tD,[E("div",nD,[E("div",rD,[E("div",iD,[(Y(!0),ae(dt,null,yt(d.value,($,P)=>(Y(),ae("div",{class:"field-item",key:P},[E("div",oD,[j(D,{style:{width:"100%"},placeholder:"请输入选择变量",value:$.variable,"onUpdate:value":I=>$.variable=I,onDropdownVisibleChange:x,onChange:c},{default:U(()=>[(Y(!0),ae(dt,null,yt(o.value,I=>(Y(),ze(k,{value:I.value,key:I.key},{default:U(()=>[E("span",null,Te(I.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),E("div",aD,[j(hr,{ref_for:!0,ref:"atInput"+P,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:$.tags,defaultValue:$.value,onOpen:v,onChange:(I,W)=>g(I,W,$,P),placeholder:"请输入变量值，键入“/”插入变量"},{option:U(({label:I,payload:W})=>[E("div",sD,[E("div",lD,Te(I),1),E("div",uD,Te(W.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",dD,[j($e(fr),{class:"action-btn",onClick:I=>b(P)},null,8,["onClick"])])]))),128))]),E("div",null,[j(R,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:y},{icon:U(()=>[j($e(In))]),default:U(()=>[C[0]||(C[0]=Be(" 添加赋值变量 "))]),_:1,__:[0]})])])])])]),_:1})}}},fD=bt(cD,[["__scopeId","data-v-1b385123"]]),hD={class:"update-data-form"},pD={class:"node-box-content"},vD={class:"setting-box"},gD={class:"setting-box"},mD={class:"setting-box"},yD={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Mo();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),s=({type:x,list:w})=>{o.formData.typ=x,o.formData.where=w,f()},l=(x,w)=>{w?(o.formData.form_name=w.name,o.formData.form_description=w.description,b(w.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.datas=[],o.formData.where=[],o.formData.typ=1),f()},d=x=>{o.formData.datas=x,f()},c=()=>{let x=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(x);let w=v(i.form_update.where||[]);i.form_update.where=w,o.formData=i.form_update,o.formData.form_id&&b(o.formData.form_id),f()},f=()=>{let x={...Vi(o.formData)};x.where=g(x.where),i.form_update=x,t({...e.node,node_params:JSON.stringify(i)})},v=x=>{let w=[];return x.forEach(_=>{let C=JSON.parse(JSON.stringify(_)),k=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=k[0],k.shift(),C.rule=k.join("_"),w.push(C)}),w},g=x=>{let w=[];return x.forEach(_=>{let C=JSON.parse(JSON.stringify(_));C.form_field_id=C.form_field_id*1,C.rule=_.field_type+"_"+_.rule,w.push(C)}),w},y=async()=>{const x=await n.getFormList();x&&(o.tableList=x)},b=async x=>{n.getFormFieldList({form_id:x}).then(w=>{w.forEach(_=>{_.id=_.id*1}),o.fieldList=w}).catch(()=>{})};return qt(()=>{y(),c()}),(x,w)=>(Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:U(()=>w[1]||(w[1]=[E("span",null,[Be("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",hD,[E("div",pD,[w[2]||(w[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ul,alt:""}),E("span",{class:"text"},"输入")],-1)),w[3]||(w[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",vD,[j(ac,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":w[0]||(w[0]=_=>o.formData.form_id=_),onChange:l},null,8,["options","title","description","value"])]),w[4]||(w[4]=E("div",{class:"setting-label"},[E("span",null,"更新条件")],-1)),E("div",gD,[j(Qh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])]),w[5]||(w[5]=E("div",{class:"setting-label"},[E("span",null,"更新数据")],-1)),E("div",mD,[j(qh,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showEmptyFieldRow:o.formData.form_id=="",list:o.formData.datas,onChange:d},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},_D=bt(yD,[["__scopeId","data-v-9cb10cb8"]]),A1={__name:"add-params-modal",emits:["add","edit","addSub"],setup(r,{expose:e,emit:t}){const n=t,i=xe(!1),o=xe("新增参数");let s="add";const l=(_,C)=>C?/^[a-zA-Z_]+$/.test(C)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let d=0;const c=Jt({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),f=()=>{i.value=!0},v=()=>{Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="add",o.value="新增参数",i.value=!0},g=_=>{d=_,Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="addSub",o.value="新增参数",i.value=!0},y=(_,C)=>{d=C,Object.assign(c,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(c,{..._}),s="edit",o.value="编辑参数",i.value=!0},b=xe(null),x=()=>{b.value.validate().then(()=>{s=="add"&&n("add",{...c}),s=="addSub"&&n("addSub",{...c},d),s=="edit"&&n("edit",{...c},d),i.value=!1})},w=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:f,add:v,edit:y,addSub:g}),(_,C)=>{const k=Cr,D=Xi,R=jr,$=Br,P=ua,I=rc,W=Mi,se=wr;return Y(),ae("div",null,[j(se,{open:i.value,"onUpdate:open":C[5]||(C[5]=q=>i.value=q),title:o.value,onOk:x,width:472,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[j(W,{ref_key:"formRef",ref:b,layout:"vertical",model:c,style:{margin:"24px 0"}},{default:U(()=>[j(D,{label:"参数key",name:"key",rules:[{required:!0,validator:(q,ee)=>l(q,ee)}]},{default:U(()=>[j(k,{value:c.key,"onUpdate:value":C[0]||(C[0]=q=>c.key=q),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),j(D,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:U(()=>[j($,{value:c.typ,"onUpdate:value":C[1]||(C[1]=q=>c.typ=q),placeholder:"请选择",style:{width:"100%"}},{default:U(()=>[(Y(),ae(dt,null,yt(w,q=>j(R,{value:q.value},{default:U(()=>[Be(Te(q.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),j(D,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:U(()=>[j(P,{checked:c.required,"onUpdate:checked":C[2]||(C[2]=q=>c.required=q)},null,8,["checked"])]),_:1}),j(D,{label:"默认值",name:"default",rules:[{required:c.required,message:"请输入默认值"}]},{default:U(()=>[j(k,{value:c.default,"onUpdate:value":C[3]||(C[3]=q=>c.default=q),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),j(D,{label:"枚举值",name:"enum"},{default:U(()=>[j(I,{style:{height:"80px"},value:c.enum,"onUpdate:value":C[4]||(C[4]=q=>c.enum=q),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},bD={class:"sub-field-item"},xD=["onClick"],wD=["onClick"],SD=["onClick"],ED={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(y=>y.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px");let i=0;const o=(y,b)=>{b.splice(y,1)},s=y=>{y.subs=[]},l=xe(null),d=y=>{i=y,l.value.add()},c=(y,b)=>{l.value.edit(y,b)},f=y=>{e.data[i].subs.push(y)},v=(y,b)=>{e.data.splice(b,1,y)},g=y=>y.typ=="object"&&e.level<=2;return(y,b)=>{const x=Cr,w=jr,_=Br,C=Mn("SubsKey",!0);return Y(),ae(dt,null,[(Y(!0),ae(dt,null,yt(e.data,(k,D)=>(Y(),ae("div",{class:Sn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:k.cu_key},[E("div",bD,[b[0]||(b[0]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(x,{class:"mr12",style:Ci({width:n.value}),value:k.key,"onUpdate:value":R=>k.key=R,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),b[1]||(b[1]=E("img",{class:"fork-icon",src:qa,alt:""},null,-1)),j(_,{class:"mr12",onChange:R=>s(k),value:k.typ,"onUpdate:value":R=>k.typ=R,placeholder:"请选择",style:Ci({width:n.value})},{default:U(()=>[(Y(!0),ae(dt,null,yt(t.value,R=>(Y(),ze(w,{value:R.value},{default:U(()=>[Be(Te(R.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),g(k)?(Y(),ae("div",{key:0,class:"btn-hover-wrap mr12",onClick:R=>d(D,e.data)},[j($e(ms))],8,xD)):et("",!0),E("div",{class:"btn-hover-wrap mr12",onClick:R=>c(k,D)},[j($e(Gh))],8,wD),E("div",{class:"btn-hover-wrap",onClick:R=>o(D,e.data)},[j($e(fr))],8,SD)]),k.subs&&k.subs.length>0?(Y(),ze(C,{key:0,level:e.level+1,typOptions:e.typOptions,data:k.subs},null,8,["level","typOptions","data"])):et("",!0)],2))),128)),j(A1,{onAdd:f,onEdit:v,ref_key:"addParamsModalRef",ref:l},null,512)],64)}}},CD=bt(ED,[["__scopeId","data-v-30c2ddb1"]]),OD={class:"problem-optimization-form"},kD={class:"node-form-content"},MD={class:"gray-block"},ND={class:"flex-block-item"},AD={class:"number-box"},TD={class:"number-slider-box"},DD={class:"number-input-box"},LD={class:"number-box"},PD={class:"number-slider-box"},RD={class:"number-input-box"},ID={class:"number-box"},BD={class:"number-box"},jD={class:"number-slider-box"},HD={class:"number-input-box"},$D={class:"field-list-item"},FD={class:"field-label"},zD={class:"field-type"},WD={class:"diy-form-item"},UD={class:"form-content"},VD={class:"gray-block mt16"},XD={class:"output-box"},GD={class:"array-form-box"},YD={class:"flex-block-item",style:{gap:"12px"}},KD=["onClick"],qD=["onClick"],JD=["onClick"],ZD={key:0,class:"sub-field-box"},QD={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Gr(),o=xe(null),s=tn(()=>i.modelList),l=xe([]),d=xe([]),c=xe(!1),f=()=>{c.value=!c.value},v=(Oe,he)=>{_.prompt=Oe,_.prompt_tags=he};function g(){const Oe=n.lf.getNodeModelById(n.nodeId);if(Oe){let he=Oe.getAllParentVariable();d.value=y(he)}}function y(Oe){return Oe.forEach(he=>{he.typ=="node"?he.node_type==1?he.value="global":he.value=he.node_id:he.value=he.key,he.children&&he.children.length>0&&(he.children=y(he.children))}),Oe}const b=()=>{const Oe=n.lf.getNodeModelById(n.nodeId);if(Oe){let he=Oe.getAllParentVariable();l.value=he}};function x(Oe){if(Oe){let he=Oe.split("."),We=he[0],Re=he.filter((Ge,le)=>le>0).join(".");return[We,Re]}return["global","question"]}const w=xe(),_=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),C=()=>{const Oe=JSON.stringify({params_extractor:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});t("update-node",{...n.node,..._,node_params:Oe})},k=()=>{try{let Oe=n.node.dataRaw||n.node.node_params||"{}",he=JSON.parse(Oe).params_extractor||{};he=JSON.parse(JSON.stringify(he)),b(),g();for(let We in he){if(We=="output"){_.output=D(he[We]);continue}if(We=="question_value"){_.question_value=x(he[We]);continue}_[We]=he[We]}!_.model_config_id&&s.value.length>0&&(_.model_config_id=s.value[0].id,_.use_model=s.value[0].children[0].name)}catch(Oe){}};Qt(()=>_,()=>{C()},{deep:!0});function D(Oe){return Oe.forEach(he=>{he.cu_key=Math.random()*1e4,he.subs&&he.subs.length?D(he.subs):he.subs=[]}),Oe}const R=xe(null),$=()=>{R.value.add()},P=(Oe,he)=>{R.value.edit(Oe,he)},I=Oe=>{_.output.push(Oe)},W=(Oe,he)=>{_.output.splice(he,1,Oe)},se=Oe=>{_.output.splice(Oe,1)},q=Oe=>{Oe.subs=[]},ee=Oe=>{R.value.addSub(Oe)},T=(Oe,he)=>{_.output[he].subs.push(Oe)},z=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],B=Oe=>{Oe||g()},pe=xe({}),Ee=(Oe,he)=>{pe.value=he},ye=tn(()=>{if(!_.model_config_id)return!1;let Oe=_.model_config_id+"#"+_.use_model;return pe.value[Oe]}),it=()=>{t("close")};return qt(()=>{k()}),(Oe,he)=>{const We=Bn,Re=Xi,Ge=ki,le=zl,G=da,oe=Ni,de=ua,ke=vs,Ye=Cr,Ie=jr,Fe=Br,Ot=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:it},null,8,["title","iconName"])]),default:U(()=>[E("div",OD,[E("div",kD,[j(Ot,{ref_key:"formRef",ref:w,layout:"vertical",model:_},{default:U(()=>[E("div",MD,[he[24]||(he[24]=E("div",{class:"gray-block-title"},"输入",-1)),j(Re,{label:"LLM模型",name:"use_model"},{default:U(()=>[E("div",ND,[j(oc,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":he[0]||(he[0]=lt=>_.use_model=lt),modeId:_.model_config_id,"onUpdate:modeId":he[1]||(he[1]=lt=>_.model_config_id=lt),onLoaded:Ee,style:{width:"348px"}},null,8,["modeName","modeId"]),j(We,{onClick:f},{default:U(()=>[he[12]||(he[12]=Be("高级设置 ")),c.value?(Y(),ze($e(ps),{key:0})):(Y(),ze($e(ic),{key:1}))]),_:1,__:[12]})])]),_:1}),c.value?(Y(),ze(Re,{key:0,name:"temperature"},{label:U(()=>[he[14]||(he[14]=E("span",null,"温度 ",-1)),j(Ge,null,{title:U(()=>he[13]||(he[13]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",AD,[E("div",TD,[j(G,null,{default:U(()=>[j(le,{class:"custom-slider",value:_.temperature,"onUpdate:value":he[2]||(he[2]=lt=>_.temperature=lt),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",DD,[j(oe,{value:_.temperature,"onUpdate:value":he[3]||(he[3]=lt=>_.temperature=lt),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):et("",!0),c.value?(Y(),ze(Re,{key:1,name:"max_token"},{label:U(()=>[he[16]||(he[16]=E("span",null,"最大token ",-1)),j(Ge,null,{title:U(()=>he[15]||(he[15]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",LD,[E("div",PD,[j(G,null,{default:U(()=>[j(le,{class:"custom-slider",value:_.max_token,"onUpdate:value":he[4]||(he[4]=lt=>_.max_token=lt),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",RD,[j(oe,{value:_.max_token,"onUpdate:value":he[5]||(he[5]=lt=>_.max_token=lt),min:0,max:100*1024},null,8,["value"])])])]),_:1})):et("",!0),c.value&&ye.value?(Y(),ze(Re,{key:2,name:"enable_thinking"},{label:U(()=>[he[18]||(he[18]=E("span",null,"深度思考 ",-1)),j(Ge,null,{title:U(()=>he[17]||(he[17]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",ID,[j(de,{checked:_.enable_thinking,"onUpdate:checked":he[6]||(he[6]=lt=>_.enable_thinking=lt)},null,8,["checked"])])]),_:1})):et("",!0),j(Re,{name:"context_pair"},{label:U(()=>[he[20]||(he[20]=E("span",null,"上下文数量 ",-1)),j(Ge,null,{title:U(()=>he[19]||(he[19]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",BD,[E("div",jD,[j(G,null,{default:U(()=>[j(le,{class:"custom-slider",value:_.context_pair,"onUpdate:value":he[7]||(he[7]=lt=>_.context_pair=lt),min:0,max:50},null,8,["value"])]),_:1})]),E("div",HD,[j(oe,{value:_.context_pair,"onUpdate:value":he[8]||(he[8]=lt=>_.context_pair=lt),min:0,max:50},null,8,["value"])])])]),_:1}),j(Re,{name:"prompt",class:"width-100"},{label:U(()=>he[21]||(he[21]=[E("div",{class:"space-between-box"},[E("div",null,"提示词")],-1)])),default:U(()=>[j(hr,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:o,onOpen:b,onChange:he[9]||(he[9]=(lt,It)=>v(lt,It)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:U(({label:lt,payload:It})=>[E("div",$D,[E("div",FD,Te(lt),1),E("div",zD,Te(It.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),he[22]||(he[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",WD,[he[23]||(he[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",UD,[j(ke,{value:_.question_value,"onUpdate:value":he[10]||(he[10]=lt=>_.question_value=lt),onDropdownVisibleChange:B,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:lt})=>lt.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),E("div",VD,[E("div",{class:"gray-block-title",onClick:he[11]||(he[11]=(...lt)=>Oe.test&&Oe.test(...lt))},"输出 (输出字段提取)"),E("div",XD,[he[26]||(he[26]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",GD,[(Y(!0),ae(dt,null,yt(_.output,(lt,It)=>(Y(),ae("div",{class:"form-item-list",key:It},[j(Re,{label:null,name:["output",It,"key"]},{default:U(()=>[E("div",YD,[j(Ye,{style:{width:"214px"},value:lt.key,"onUpdate:value":_t=>lt.key=_t,placeholder:"请输入"},null,8,["value","onUpdate:value"]),j(G,null,{default:U(()=>[j(Fe,{onChange:_t=>q(lt),value:lt.typ,"onUpdate:value":_t=>lt.typ=_t,placeholder:"请选择",style:{width:"214px"}},{default:U(()=>[(Y(),ae(dt,null,yt(z,_t=>j(Ie,{value:_t.value,key:_t.value},{default:U(()=>[Be(Te(_t.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),lt.typ=="object"?(Y(),ae("div",{key:0,class:"btn-hover-wrap",onClick:_t=>ee(It)},[j($e(ms))],8,KD)):et("",!0),E("div",{class:"btn-hover-wrap",onClick:_t=>P(lt,It)},[j($e(Gh))],8,qD),E("div",{class:"btn-hover-wrap",onClick:_t=>se(It)},[j($e(fr))],8,JD)]),lt.subs&&lt.subs.length>0?(Y(),ae("div",ZD,[j(G,null,{default:U(()=>[j(CD,{data:lt.subs,level:2,typOptions:z},null,8,["data"])]),_:2},1024)])):et("",!0)]),_:2},1032,["name"])]))),128)),j(We,{onClick:$,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>he[25]||(he[25]=[Be("添加参数")])),_:1,__:[25]},8,["icon"])])])])]),_:1},8,["model"])]),j(A1,{onAdd:I,onEdit:W,onAddSub:T,ref_key:"addParamsModalRef",ref:R},null,512)])]),_:1})}}},eL=bt(QD,[["__scopeId","data-v-abc4a683"]]),tL={class:"collapse-panel-warpper"},nL={class:"collapse-panel-header"},rL={class:"title-text"},iL={class:"collapse-panel-body"},oL={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(r){const t=xe(r.defaultCollapsed),n=()=>{t.value=!t.value};return(i,o)=>{const s=Ir;return Y(),ae("div",tL,[E("div",nL,[E("div",{class:"collapse-panel-title",onClick:cn(n,["stop"])},[E("span",rL,[Be(Te(r.title)+" ",1),r.count?(Y(),ae(dt,{key:0},[Be("（"+Te(r.count)+"）",1)],64)):et("",!0)]),j(s,{name:"arrow-down",class:Sn(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])])]),ia(E("div",iL,[Ga(i.$slots,"default",{},void 0,!0)],512),[[cs,!t.value]])])}}},mf=bt(oL,[["__scopeId","data-v-9d22edcd"]]),aL={class:"field-select-box"},sL={key:0,class:"field-list-box"},lL={key:1,class:"empty-box"},uL={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Jt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),o=xe([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),s=xe([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),l=(f,v)=>{i.selectedRowKeys=f,i.selectedRows=v},d=({formId:f,selectedRowKeys:v,selectedRows:g})=>{i.formId=f,i.selectedRowKeys=v,i.selectedRows=g,i.show=!0},c=()=>{n("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:d}),(f,v)=>{const g=c_,y=wr;return Y(),ze(y,{width:"746px",open:i.show,"onUpdate:open":v[1]||(v[1]=b=>i.show=b),title:"关联数据表",onOk:c,"ok-text":"确定","cancel-text":"取消"},{default:U(()=>[E("div",aL,[s.value.length?(Y(),ae("div",sL,[j(g,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:l},dataSource:s.value,columns:o.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):et("",!0),s.value.length?et("",!0):(Y(),ae("div",lL,[v[3]||(v[3]=E("img",{src:Yh,alt:""},null,-1)),E("div",null,[v[2]||(v[2]=Be(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:v[0]||(v[0]=(...b)=>f.openAddLibrary&&f.openAddLibrary(...b))}," 去添加")])]))])]),_:1},8,["open"])}}},dL=bt(uL,[["__scopeId","data-v-fca59186"]]),cL={class:"field-list"},fL={class:"field-list-col field-drag-col"},hL={class:"drag-btn"},pL={class:"field-list-col field-name-col"},vL={class:"field-name-box"},gL={class:"field-name"},mL={class:"field-type-tag"},yL={class:"field-list-col field-value-col"},_L={key:0,class:"field-list-col field-del-col"},bL={class:"add-btn-box"},xL={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],o=xe([]);Qt(()=>n.list,g=>{o.value=g.map(y=>({...y,is_asc:y.is_asc?1:0}))});const s=g=>{o.value.splice(g,1),c()},l=(g,y)=>{o.value=y.map(b=>({...b})),c()},d=()=>{c()},c=()=>{let g=o.value.map(y=>({...y,is_asc:y.is_asc==1}));t("change",g)},f=xe(),v=()=>{f.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(g=>g.name)})};return(g,y)=>{const b=jr,x=Br,w=Ir,_=Bn,C=ki;return Y(),ae("div",null,[E("div",cL,[(Y(!0),ae(dt,null,yt(o.value,k=>(Y(),ae("div",{class:"field-list-row",key:k.name},[E("div",fL,[E("span",hL,[j($e(g_))])]),E("div",pL,[E("div",vL,[E("span",gL,Te(k.name),1),E("span",mL,Te(k.type),1)])]),E("div",yL,[j(x,{value:k.is_asc,"onUpdate:value":D=>k.is_asc=D,style:{width:"100%"},onChange:d},{default:U(()=>[(Y(),ae(dt,null,yt(i,D=>j(b,{value:D.value,key:D.key},{default:U(()=>[Be(Te(D.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value"])]),n.showDelete?(Y(),ae("div",_L,[E("span",{class:"del-btn",onClick:y[0]||(y[0]=D=>s(g.index))},[j(w,{class:"del-icon",name:"close-circle"})])])):et("",!0)]))),128))]),E("div",bL,[r.disabled?(Y(),ze(C,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:U(()=>[E("span",null,[j(_,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:U(()=>[j($e(In)),y[1]||(y[1]=Be(" 添加排序字段 "))]),_:1,__:[1]})])]),_:1})):(Y(),ze(_,{key:1,class:"add-btn",type:"dashed",block:"",onClick:v},{default:U(()=>[j($e(In)),y[2]||(y[2]=Be(" 添加排序字段 "))]),_:1,__:[2]}))]),j(dL,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:f,onOk:l},null,8,["formId"])])}}},wL=bt(xL,[["__scopeId","data-v-d239001f"]]),SL={class:"field-item"},EL={class:"field-name"},CL={class:"field-type"},OL={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(r){const e=r,t=xe([]);return(n,i)=>{const o=Ir,s=YC;return Y(),ae("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=cn(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=cn(()=>{},["stop"]))},[j(s,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:U(({switcherCls:l})=>[E("span",{class:Sn(l)},[j(o,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:U(({dataRef:l})=>[E("div",SL,[E("span",EL,Te(l.title),1),E("span",CL,Te(l.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},kL=bt(OL,[["__scopeId","data-v-29131f6c"]]),ML={class:"select-data-form"},NL={class:"node-box-content"},AL={class:"setting-box"},TL={class:"setting-box"},DL={class:"node-box-content"},LL={class:"setting-box"},PL={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Nt("setData"),n=Mo();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),s=tn(()=>[{title:"output_list",key:"output_list",type:"Array(Object)",children:o.formData.fields.map(k=>({title:k.name,key:k.name,type:k.type}))},{title:"row_num",key:"row_num",type:"integer"}]),l=({type:C,list:k})=>{o.formData.typ=C,o.formData.where=k,y()},d=C=>{o.formData.order=[...C],y()},c=(C,k)=>{k?(o.formData.form_name=k.name,o.formData.form_description=k.description,_(k.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.typ=1,o.formData.fields=[],o.formData.where=[],o.formData.order=[],o.formData.limit=100),y()},f=C=>{o.formData.fields=C,y()},v=()=>{y()},g=()=>{let C=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(C);let k=b(i.form_select.where||[]);i.form_select.where=k,o.formData=i.form_select,o.formData.form_id&&_(o.formData.form_id),y()},y=()=>{let C={...Vi(o.formData)};C.where=x(C.where),i.form_select=C,t({...e.node,node_params:JSON.stringify(i)})},b=C=>{let k=[];return C.forEach(D=>{let R=JSON.parse(JSON.stringify(D)),$=R.rule.split("_");R.form_field_id=R.form_field_id*1,R.field_type=$[0],$.shift(),R.rule=$.join("_"),k.push(R)}),k},x=C=>{let k=[];return C.forEach(D=>{let R=JSON.parse(JSON.stringify(D));R.form_field_id=R.form_field_id*1,R.rule=D.field_type+"_"+D.rule,k.push(R)}),k},w=async()=>{const C=await n.getFormList();C&&(o.tableList=C)},_=async C=>{n.getFormFieldList({form_id:C}).then(k=>{k.forEach(D=>{D.id=D.id*1}),o.fieldList=k}).catch(()=>{})};return qt(()=>{w(),g()}),(C,k)=>{const D=Ni;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:U(()=>k[8]||(k[8]=[E("span",null,[Be("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",ML,[E("div",NL,[k[9]||(k[9]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ul,alt:""}),E("span",{class:"text"},"输入")],-1)),k[10]||(k[10]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",AL,[j(ac,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":k[0]||(k[0]=R=>o.formData.form_id=R),onChange:c},null,8,["options","title","description","value"])]),E("div",TL,[j(mf,{title:"查询条件",count:o.formData.where.length},{default:U(()=>[j(Qh,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:l},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),E("div",{class:"setting-box",onWheel:k[1]||(k[1]=cn(()=>{},["stop"])),onTouchmove:k[2]||(k[2]=cn(()=>{},["stop"]))},[j(mf,{title:"查询字段",count:o.formData.fields.length},{default:U(()=>[j(qh,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showInput:!1,showEmptyFieldRow:o.formData.form_id=="",list:o.formData.fields,onChange:f},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),E("div",{class:"setting-box",onWheel:k[3]||(k[3]=cn(()=>{},["stop"])),onTouchmove:k[4]||(k[4]=cn(()=>{},["stop"]))},[j(mf,{title:"排序",count:o.formData.order.length},{default:U(()=>[j(wL,{"form-id":o.formData.form_id,disabled:!o.formData.form_id,list:o.formData.order,onChange:d},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),k[11]||(k[11]=E("div",{class:"setting-label"},[E("span",null,"查询数量")],-1)),E("div",{class:"setting-box",onWheel:k[6]||(k[6]=cn(()=>{},["stop"])),onTouchmove:k[7]||(k[7]=cn(()=>{},["stop"]))},[j(D,{min:1,max:1e3,value:o.formData.limit,"onUpdate:value":k[5]||(k[5]=R=>o.formData.limit=R),disabled:!o.formData.form_id,style:{width:"205px"},onChange:v},null,8,["value","disabled"])],32)]),E("div",DL,[k[12]||(k[12]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Kh,alt:""}),E("span",{class:"text"},"输出")],-1)),E("div",LL,[j(kL,{treeData:s.value},null,8,["treeData"])])])])]),_:1})}}},RL=bt(PL,[["__scopeId","data-v-10a423c3"]]),IL={class:"problem-optimization-form"},BL={class:"gray-block"},jL={class:"flex-block-item"},HL={class:"number-box"},$L={class:"number-slider-box"},FL={class:"number-input-box"},zL={class:"number-box"},WL={class:"number-slider-box"},UL={class:"number-input-box"},VL={class:"number-box"},XL={class:"number-box"},GL={class:"number-slider-box"},YL={class:"number-input-box"},KL={class:"gray-block mt16"},qL={class:"array-form-box"},JL={class:"flex-block-item"},ZL=["onClick"],QL={class:"form-item-list"},eP={class:"flex-block-item"},tP={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Gr(),o=tn(()=>i.modelList),s=xe(!1),l=()=>{s.value=!s.value},d=xe(),c=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]}),f=()=>{const k=JSON.stringify({cate:{...c,model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t("update-node",{...n.node,...c,node_params:k})},v=()=>{try{let k=n.node.dataRaw||n.node.node_params||"{}",D=JSON.parse(k).cate||{};D=JSON.parse(JSON.stringify(D));for(let R in D)if(R=="categorys")if(D.categorys&&D.categorys.length>0){let $=D.categorys.map(P=>({...P,key:Math.random()*1e4}));c[R]=$}else c[R]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else c[R]=D[R];!c.model_config_id&&o.value.length>0&&(c.model_config_id=o.value[0].id,c.use_model=o.value[0].children[0].name)}catch(k){}};Qt(()=>c,()=>{f()},{deep:!0});const g=()=>{c.categorys.push({category:"",next_node_key:"",key:Math.random()*1e4})},y=k=>{c.categorys.splice(k,1)},b=()=>Promise.resolve(),x=xe({}),w=(k,D)=>{x.value=D},_=tn(()=>{if(!c.model_config_id)return!1;let k=c.model_config_id+"#"+c.use_model;return x.value[k]}),C=()=>{t("close")};return qt(()=>{v()}),(k,D)=>{const R=Bn,$=Xi,P=ki,I=zl,W=da,se=Ni,q=ua,ee=Cr,T=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:C},null,8,["title","iconName"])]),default:U(()=>[E("div",IL,[E("div",{class:"node-form-content",onMousedown:D[9]||(D[9]=cn(()=>{},["stop"]))},[j(T,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:U(()=>[E("div",BL,[D[19]||(D[19]=E("div",{class:"gray-block-title"},"输入",-1)),j($,{label:"LLM模型",name:"use_model"},{default:U(()=>[E("div",jL,[j(oc,{modelType:"LLM",modeName:c.use_model,"onUpdate:modeName":D[0]||(D[0]=z=>c.use_model=z),modeId:c.model_config_id,"onUpdate:modeId":D[1]||(D[1]=z=>c.model_config_id=z),onLoaded:w,style:{width:"348px"}},null,8,["modeName","modeId"]),j(R,{onClick:l},{default:U(()=>[D[10]||(D[10]=Be("高级设置 ")),s.value?(Y(),ze($e(ps),{key:0})):(Y(),ze($e(ic),{key:1}))]),_:1,__:[10]})])]),_:1}),s.value?(Y(),ze($,{key:0,name:"temperature"},{label:U(()=>[D[12]||(D[12]=E("span",null,"温度 ",-1)),j(P,null,{title:U(()=>D[11]||(D[11]=[Be("温度越低，回答越严谨。温度越高，回答越发散。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",HL,[E("div",$L,[j(W,null,{default:U(()=>[j(I,{class:"custom-slider",value:c.temperature,"onUpdate:value":D[2]||(D[2]=z=>c.temperature=z),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",FL,[j(se,{value:c.temperature,"onUpdate:value":D[3]||(D[3]=z=>c.temperature=z),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):et("",!0),s.value?(Y(),ze($,{key:1,name:"max_token"},{label:U(()=>[D[14]||(D[14]=E("span",null,"最大token ",-1)),j(P,null,{title:U(()=>D[13]||(D[13]=[Be("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",zL,[E("div",WL,[j(W,null,{default:U(()=>[j(I,{class:"custom-slider",value:c.max_token,"onUpdate:value":D[4]||(D[4]=z=>c.max_token=z),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",UL,[j(se,{value:c.max_token,"onUpdate:value":D[5]||(D[5]=z=>c.max_token=z),min:0,max:100*1024},null,8,["value"])])])]),_:1})):et("",!0),s.value&&_.value?(Y(),ze($,{key:2,name:"enable_thinking"},{label:U(()=>[D[16]||(D[16]=E("span",null,"深度思考 ",-1)),j(P,null,{title:U(()=>D[15]||(D[15]=[Be("开启时，调用大模型时会指定走深度思考模式")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",VL,[j(q,{checked:c.enable_thinking,"onUpdate:checked":D[6]||(D[6]=z=>c.enable_thinking=z)},null,8,["checked"])])]),_:1})):et("",!0),j($,{name:"context_pair"},{label:U(()=>[D[18]||(D[18]=E("span",null,"上下文数量 ",-1)),j(P,null,{title:U(()=>D[17]||(D[17]=[Be("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:U(()=>[j($e(Kn),{class:"question-icon"})]),_:1})]),default:U(()=>[E("div",XL,[E("div",GL,[j(W,null,{default:U(()=>[j(I,{class:"custom-slider",value:c.context_pair,"onUpdate:value":D[7]||(D[7]=z=>c.context_pair=z),min:0,max:50},null,8,["value"])]),_:1})]),E("div",YL,[j(se,{value:c.context_pair,"onUpdate:value":D[8]||(D[8]=z=>c.context_pair=z),min:0,max:50},null,8,["value"])])])]),_:1}),D[20]||(D[20]=E("div",{class:"diy-form-item"},[E("div",{class:"form-label"},"用户问题"),E("div",{class:"form-content"},"流程开始>用户问题")],-1))]),E("div",KL,[D[22]||(D[22]=E("div",{class:"gray-block-title"},"问题分类设置",-1)),E("div",qL,[(Y(!0),ae(dt,null,yt(c.categorys,(z,B)=>(Y(),ae("div",{class:"form-item-list",key:z.key},[j($,{label:null,name:["categorys",B,"category"],rules:{required:!0,validator:(pe,Ee)=>b(pe,Ee)}},{default:U(()=>[E("div",JL,[j(ee,{class:"flex1",value:z.category,"onUpdate:value":pe=>z.category=pe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),E("div",{class:"btn-hover-wrap",onClick:pe=>y(B)},[j($e(fr))],8,ZL)])]),_:2},1032,["name","rules"])]))),128)),E("div",QL,[j($,{label:null},{default:U(()=>[E("div",eP,[j(ee,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),j(R,{onClick:g,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>D[21]||(D[21]=[Be("添加问题分类")])),_:1,__:[21]},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},nP=bt(tP,[["__scopeId","data-v-3875cab5"]]),rP={class:"judge-node-form"},iP={class:"gray-block-title"},oP=["onClick"],aP={class:"condition-list-box"},sP={class:"left-select-box"},lP={class:"condition-body"},uP=["onClick"],dP={class:"btn-wrap"},cP={class:"add-btn-block"},fP={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Nt("getNode"),n=Nt("setData"),i=xe(),o=Jt({term:[]}),s=xe([]);function l(){let $=t().getAllParentVariable();s.value=d($)}function d($){return $.forEach(P=>{P.typ=="node"?P.node_type==1?P.value="global":P.value=P.node_id:P.value=P.key,P.children&&P.children.length>0&&(P.children=d(P.children))}),$}const c=$=>{$||l()};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const v=()=>{try{let $=JSON.parse(e.node.node_params).term||[];$=$.map(P=>{let I=P.terms.map(W=>{let se="";for(let q=0;q<f.length;q++)if(W.variable.indexOf(f[q])>-1){se=f[q];break}if(se!=""){let q=W.variable.split(".");W.variable=[q[0],se]}else W.variable=W.variable.split(".");return{...W,type:W.type>0?W.type:1,key:Math.random()*1e4}});return{...P,is_or:P.is_or?1:0,terms:I,key:Math.random()*1e4}}),o.term=$,g()}catch($){}},g=()=>{let $=JSON.parse(JSON.stringify(o.term));$=$.map(P=>({is_or:P.is_or==1,next_node_key:P.next_node_key,terms:P.terms.map(I=>({variable:I.variable.join("."),is_mult:I.is_mult,type:I.type,value:I.value}))})),n({...e.node,term:$,node_params:JSON.stringify({term:$})})},y=$=>{o.term[$].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},b=($,P)=>{o.term[$].terms.splice(P,1)},x=()=>{o.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},w=$=>{o.term.splice($,1)},_=$=>{let P=D($);$.is_mult=P.includes("array"),$.type=void 0};let C=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],k=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function D($){let P="";if($.variable&&$.variable.length>0){let I=s.value.filter(W=>W.key==$.variable[0]);I&&I.length&&(P=I[0].typ),P=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter(W=>W.key==$.variable[1])),I&&I.length&&(P=I[0].typ),P=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter(W=>W.key==$.variable[2])),I&&I.length&&(P=I[0].typ)))}return P}function R($){if(!$.variable)return[];let P=D($);return P==""?$.is_mult?k:C:P=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:P.includes("array")?k:C}return Qt(()=>o,()=>{g()},{deep:!0}),qt(()=>{l(),v()}),($,P)=>{const I=gs,W=jr,se=Br,q=vs,ee=Cr,T=Bn,z=Mi;return Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:U(()=>P[2]||(P[2]=[E("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])),_:1},8,["title","iconName"])]),default:U(()=>[E("div",rP,[E("div",{class:"form-block",onMousedown:P[1]||(P[1]=cn(()=>{},["stop"]))},[j(z,{ref_key:"formRef",ref:i,layout:"vertical",model:o},{default:U(()=>[j($e(SO),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:o.term,"onUpdate:modelValue":P[0]||(P[0]=B=>o.term=B),"item-key":"key"},{item:U(({element:B,index:pe})=>[(Y(),ae("div",{class:"gray-block",key:B.key},[E("div",iP,[j(I,{gap:8},{default:U(()=>[j($e(g_),{class:"icon drag-btn"}),Be(Te(pe==0?"if":"else if"),1)]),_:2},1024),o.term.length>1?(Y(),ae("div",{key:0,class:"btn-hover-wrap",onClick:Ee=>w(pe)},[j($e(fr))],8,oP)):et("",!0)]),E("div",aP,[E("div",sP,[j(se,{size:"small",value:B.is_or,"onUpdate:value":Ee=>B.is_or=Ee,bordered:!1,style:{width:"64px"}},{default:U(()=>[j(W,{value:0},{default:U(()=>P[3]||(P[3]=[Be("and")])),_:1,__:[3]}),j(W,{value:1},{default:U(()=>P[4]||(P[4]=[Be("or")])),_:1,__:[4]})]),_:2},1032,["value","onUpdate:value"])]),E("div",lP,[(Y(!0),ae(dt,null,yt(B.terms,(Ee,ye)=>(Y(),ae("div",{class:"condition-item",key:Ee.key},[j(q,{value:Ee.variable,"onUpdate:value":it=>Ee.variable=it,onChange:it=>_(Ee),onDropdownVisibleChange:c,style:{width:"160px"},options:s.value,allowClear:!1,displayRender:({labels:it})=>it.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),j(se,{value:Ee.type,"onUpdate:value":it=>Ee.type=it,style:{width:"120px"},placeholder:"请选择"},{default:U(()=>[(Y(!0),ae(dt,null,yt(R(Ee),it=>(Y(),ze(W,{value:it.value,key:it.value},{default:U(()=>[Be(Te(it.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),Ee.type!=5&&Ee.type!=6?(Y(),ze(ee,{key:0,placeholder:"请输入",value:Ee.value,"onUpdate:value":it=>Ee.value=it,style:{width:"150px"}},null,8,["value","onUpdate:value"])):et("",!0),E("div",{class:"btn-hover-wrap",onClick:it=>b(pe,ye)},[j($e(fr))],8,uP)]))),128))])]),E("div",dP,[j(T,{onClick:Ee=>y(pe),icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>P[5]||(P[5]=[Be("添加条件")])),_:2,__:[5]},1032,["onClick","icon"])])]))]),_:1},8,["modelValue"]),E("div",cP,[j(T,{onClick:x,icon:wn($e(In)),block:"",type:"dashed"},{default:U(()=>P[6]||(P[6]=[Be("添加分支")])),_:1,__:[6]},8,["icon"])]),P[7]||(P[7]=E("div",{class:"gray-block mt8"},[E("div",{class:"gray-block-title"},"else"),E("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1,__:[7]},8,["model"])],32)])]),_:1})}}},hP=bt(fP,[["__scopeId","data-v-8d703e95"]]),pP={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:vr,AtInput:hr,FullscreenOutlined:Xh,FullAtInput:E1,NodeFormLayout:pr},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.update()}},mounted(){this.getValueOptions();const r=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const n=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=n.content,this.formState.content_tags=n.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),r.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(r){ys.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.node.node_params);r.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},vP={class:"specify-reply-form"},gP={class:"node-content"},mP={class:"form-item-label"},yP={class:"flex-between-box"},_P={class:"form-item-body"};function bP(r,e,t,n,i,o){const s=Mn("NodeFormHeader"),l=Mn("FullscreenOutlined"),d=Mn("at-input"),c=Mn("FullAtInput"),f=Mn("NodeFormLayout");return Y(),ze(f,null,{header:U(()=>[j(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:U(()=>[E("div",vP,[E("div",gP,[e[5]||(e[5]=E("div",{class:"form-label"},"输出",-1)),E("div",{class:"form-item",onMousedown:e[2]||(e[2]=cn(()=>{},["stop"]))},[E("div",mP,[E("div",yP,[e[4]||(e[4]=E("div",null,"消息内容",-1)),E("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...v)=>o.handleOpenFullAtModal&&o.handleOpenFullAtModal(...v))},[j(l)])])]),E("div",_P,[j(d,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:o.showAtList,onChange:e[1]||(e[1]=(v,g)=>o.changeValue(v,g))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),j(c,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:o.showAtList,onChange:e[3]||(e[3]=(v,g)=>o.changeValue(v,g)),onOk:o.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const xP=bt(pP,[["render",bP],["__scopeId","data-v-87ffa1dc"]]),wP=["src"],SP={class:"mcp-form"},EP={class:"node-options"},CP={class:"options-item-tit"},OP={class:"option-label"},kP={class:"option-type"},MP={class:"field-list-item"},NP={class:"field-label"},AP={class:"field-type"},TP={class:"desc"},DP={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=Nt("getNode"),t=Nt("setData"),n=r,i=Jt({mcpInfo:{},toolInfo:{}}),o=Jt({params:{}}),s=xe([]);let l={};function d(){c(),l=JSON.parse(n.node.node_params),g()}function c(){s.value=e().getAllParentVariable()}function f(y,b,x){y.value=b,y.tags=x,v()}function v(){let y={arguments:{},tag_map:{}};for(let b in o.params){let x=o.params[b].value,w=i.toolInfo.inputSchema.properties[b]||{};w.type=="string"?x=String(x):["number","integer"].includes(w.type)&&(x=Number(x)),y.arguments[b]=x,y.tag_map[b]=o.params[b].tags}l.mcp.arguments=y.arguments,l.mcp.tag_map=y.tag_map||[],t({...n.node,node_params:JSON.stringify(l)})}const g=()=>{x1({provider_id:l.mcp.provider_id}).then(y=>{var C;i.mcpInfo=(y==null?void 0:y.data)||{};let b=a_((C=i.mcpInfo)==null?void 0:C.tools,{});i.toolInfo=b.find(k=>k.name==l.mcp.tool_name);let x=i.toolInfo.inputSchema||{},w=(x==null?void 0:x.properties)||{},_=(x==null?void 0:x.required)||[];w=JSON.parse(JSON.stringify(w));for(let k in w)w[k].value=String(l.mcp.arguments[k]||""),w[k].tags=l.mcp.tag_map?l.mcp.tag_map[k]:[],w[k].required=_.includes(k);o.params=w})};return qt(()=>{d()}),(y,b)=>(Y(),ze(pr,null,{header:U(()=>[j(vr,{title:r.node.node_name,iconName:r.node.node_icon_name},{"node-icon":U(()=>[E("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,wP)]),desc:U(()=>[E("span",null,Te(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:U(()=>[E("div",SP,[E("div",EP,[b[0]||(b[0]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Ul,class:"title-icon"}),Be("输入")])],-1)),(Y(!0),ae(dt,null,yt(o.params,(x,w)=>(Y(),ae("div",{key:w,class:Sn(["options-item",{"is-required":x.required}])},[E("div",CP,[E("div",OP,Te(w),1),E("div",kP,Te(x.type),1)]),E("div",null,[j(hr,{type:"textarea",inputStyle:"height: 64px;",options:s.value,defaultSelectedList:x.tags,defaultValue:x.value,ref_for:!0,ref:"atInputRef",onOpen:c,onChange:(_,C)=>f(x,_,C),placeholder:"请输入内容，键入“/”可以插入变量"},{option:U(({label:_,payload:C})=>[E("div",MP,[E("div",NP,Te(_),1),E("div",AP,Te(C.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",TP,Te(x.description),1)],2))),128))]),b[1]||(b[1]=E("div",{class:"node-options"},[E("div",{class:"options-title"},[E("div",null,[E("img",{src:Kh,class:"title-icon"}),Be("输出")])]),E("div",{class:"options-item"},[E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"输出")]),E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"text"),E("div",{class:"option-type"},"string")]),E("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},LP=bt(DP,[["__scopeId","data-v-8d3b79f4"]]),PP=["width"],RP={class:"node-form-drawer-body"},IP=["node-key"],BP={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(r,{expose:e,emit:t}){const n={"start-node":a2,"problem-optimization-node":z2,"ai-dialogue-node":hM,"add-data-node":KM,"knowledge-base-node":UN,"code-run-node":XA,"http-node":RT,"delete-data-node":eD,"variable-assignment-node":fD,"update-data-node":_D,"parameter-extraction-node":eL,"select-data-node":RL,"question-node":nP,"judge-node":hP,"specify-reply-node":xP,"mcp-node":LP},i=t,o=r,s=tn({get:()=>o.open,set:C=>i("update:open",C)}),l=()=>{s.value=!1},d=tn(()=>["delete-data-node","update-data-node","select-data-node","judge-node"].includes(o.nodeType)?600:480),c=()=>o.lf.getNodeModelById(o.nodeId),f=()=>o.lf.graphModel,v=C=>{w(C)},g=C=>{i("change-title",C)},y=()=>{s.value=!1;let C=c();f().eventCenter.emit("custom:node:delete",C)};Vo("lf",o.lf),Vo("getNode",c),Vo("getGraph",f),Vo("setData",v),Vo("changeTitle",g),Vo("deleteNode",y),Vo("close",l);const b=tn(()=>{const C=`${o.nodeType}`;return n[C]||null}),x=xe(null),w=C=>{clearTimeout(x.value),x.value=setTimeout(()=>{C.dataRaw=C.node_params,i("update-node",C)},300)},_=()=>{s.value=!1};return e({open}),(C,k)=>{const D=Bn,R=KC;return Y(),ze(HC,{name:"slide-right",appear:""},{default:U(()=>[s.value?(Y(),ae("div",{key:0,width:d.value,style:Ci({width:d.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:jC(_,["esc"])},[E("div",RP,[E("div",{class:"drawer-form","node-key":o.nodeType},[b.value?(Y(),ze(l_(b.value),{lf:o.lf,"node-id":o.nodeId,"node-type":o.nodeType,node:o.node,key:o.nodeId,onClose:_,onUpdateNode:w},null,40,["lf","node-id","node-type","node"])):(Y(),ze(R,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:U(()=>[j(D,{type:"primary",onClick:_},{default:U(()=>k[0]||(k[0]=[Be("关闭")])),_:1,__:[0]})]),_:1}))],8,IP)])],44,PP)):et("",!0)]),_:1})}}},jP=bt(BP,[["__scopeId","data-v-bd080cb6"]]);var sc,Vt,T1,Ko,$g,D1,L1,P1,ep,Gf,Yf,El={},R1=[],HP=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Xl=Array.isArray;function no(r,e){for(var t in e)r[t]=e[t];return r}function tp(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function xt(r,e,t){var n,i,o,s={};for(o in e)o=="key"?n=e[o]:o=="ref"?i=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?sc.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(o in r.defaultProps)s[o]===void 0&&(s[o]=r.defaultProps[o]);return ed(r,s,n,i,null)}function ed(r,e,t,n,i){var o={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++T1,__i:-1,__u:0};return i==null&&Vt.vnode!=null&&Vt.vnode(o),o}function lc(){return{current:null}}function Ja(r){return r.children}function Gt(r,e){this.props=r,this.context=e}function Za(r,e){if(e==null)return r.__?Za(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?Za(r):null}function I1(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return I1(r)}}function Fg(r){(!r.__d&&(r.__d=!0)&&Ko.push(r)&&!ld.__r++||$g!=Vt.debounceRendering)&&(($g=Vt.debounceRendering)||D1)(ld)}function ld(){for(var r,e,t,n,i,o,s,l=1;Ko.length;)Ko.length>l&&Ko.sort(L1),r=Ko.shift(),l=Ko.length,r.__d&&(t=void 0,n=void 0,i=(n=(e=r).__v).__e,o=[],s=[],e.__P&&((t=no({},n)).__v=n.__v+1,Vt.vnode&&Vt.vnode(t),np(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[i]:null,o,i??Za(n),!!(32&n.__u),s),t.__v=n.__v,t.__.__k[t.__i]=t,H1(o,t,s),n.__e=n.__=null,t.__e!=i&&I1(t)));ld.__r=0}function B1(r,e,t,n,i,o,s,l,d,c,f){var v,g,y,b,x,w,_,C=n&&n.__k||R1,k=e.length;for(d=$P(t,e,C,d,k),v=0;v<k;v++)(y=t.__k[v])!=null&&(g=y.__i==-1?El:C[y.__i]||El,y.__i=v,w=np(r,y,g,i,o,s,l,d,c,f),b=y.__e,y.ref&&g.ref!=y.ref&&(g.ref&&rp(g.ref,null,y),f.push(y.ref,y.__c||b,y)),x==null&&b!=null&&(x=b),(_=!!(4&y.__u))||g.__k===y.__k?d=j1(y,d,r,_):typeof y.type=="function"&&w!==void 0?d=w:b&&(d=b.nextSibling),y.__u&=-7);return t.__e=x,d}function $P(r,e,t,n,i){var o,s,l,d,c,f=t.length,v=f,g=0;for(r.__k=new Array(i),o=0;o<i;o++)(s=e[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(d=o+g,(s=r.__k[o]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?ed(null,s,null,null,null):Xl(s)?ed(Ja,{children:s},null,null,null):s.constructor==null&&s.__b>0?ed(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=r,s.__b=r.__b+1,l=null,(c=s.__i=FP(s,t,d,v))!=-1&&(v--,(l=t[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(i>f?g--:i<f&&g++),typeof s.type!="function"&&(s.__u|=4)):c!=d&&(c==d-1?g--:c==d+1?g++:(c>d?g--:g++,s.__u|=4))):r.__k[o]=null;if(v)for(o=0;o<f;o++)(l=t[o])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=Za(l)),F1(l,l));return n}function j1(r,e,t,n){var i,o;if(typeof r.type=="function"){for(i=r.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=r,e=j1(i[o],e,t,n));return e}r.__e!=e&&(n&&(e&&r.type&&!e.parentNode&&(e=Za(r)),t.insertBefore(r.__e,e||null)),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function ud(r,e){return e=e||[],r==null||typeof r=="boolean"||(Xl(r)?r.some(function(t){ud(t,e)}):e.push(r)),e}function FP(r,e,t,n){var i,o,s,l=r.key,d=r.type,c=e[t],f=c!=null&&(2&c.__u)==0;if(c===null&&r.key==null||f&&l==c.key&&d==c.type)return t;if(n>(f?1:0)){for(i=t-1,o=t+1;i>=0||o<e.length;)if((c=e[s=i>=0?i--:o++])!=null&&(2&c.__u)==0&&l==c.key&&d==c.type)return s}return-1}function zg(r,e,t){e[0]=="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||HP.test(e)?t:t+"px"}function Nu(r,e,t,n,i){var o,s;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||zg(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||zg(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(P1,"$1")),s=e.toLowerCase(),e=s in r||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+o]=t,t?n?t.u=n.u:(t.u=ep,r.addEventListener(e,o?Yf:Gf,o)):r.removeEventListener(e,o?Yf:Gf,o);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function Wg(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=ep++;else if(e.t<t.u)return;return t(Vt.event?Vt.event(e):e)}}}function np(r,e,t,n,i,o,s,l,d,c){var f,v,g,y,b,x,w,_,C,k,D,R,$,P,I,W,se,q=e.type;if(e.constructor!=null)return null;128&t.__u&&(d=!!(32&t.__u),o=[l=e.__e=t.__e]),(f=Vt.__b)&&f(e);e:if(typeof q=="function")try{if(_=e.props,C="prototype"in q&&q.prototype.render,k=(f=q.contextType)&&n[f.__c],D=f?k?k.props.value:f.__:n,t.__c?w=(v=e.__c=t.__c).__=v.__E:(C?e.__c=v=new q(_,D):(e.__c=v=new Gt(_,D),v.constructor=q,v.render=WP),k&&k.sub(v),v.props=_,v.state||(v.state={}),v.context=D,v.__n=n,g=v.__d=!0,v.__h=[],v._sb=[]),C&&v.__s==null&&(v.__s=v.state),C&&q.getDerivedStateFromProps!=null&&(v.__s==v.state&&(v.__s=no({},v.__s)),no(v.__s,q.getDerivedStateFromProps(_,v.__s))),y=v.props,b=v.state,v.__v=e,g)C&&q.getDerivedStateFromProps==null&&v.componentWillMount!=null&&v.componentWillMount(),C&&v.componentDidMount!=null&&v.__h.push(v.componentDidMount);else{if(C&&q.getDerivedStateFromProps==null&&_!==y&&v.componentWillReceiveProps!=null&&v.componentWillReceiveProps(_,D),!v.__e&&v.shouldComponentUpdate!=null&&v.shouldComponentUpdate(_,v.__s,D)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(v.props=_,v.state=v.__s,v.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(ee){ee&&(ee.__=e)}),R=0;R<v._sb.length;R++)v.__h.push(v._sb[R]);v._sb=[],v.__h.length&&s.push(v);break e}v.componentWillUpdate!=null&&v.componentWillUpdate(_,v.__s,D),C&&v.componentDidUpdate!=null&&v.__h.push(function(){v.componentDidUpdate(y,b,x)})}if(v.context=D,v.props=_,v.__P=r,v.__e=!1,$=Vt.__r,P=0,C){for(v.state=v.__s,v.__d=!1,$&&$(e),f=v.render(v.props,v.state,v.context),I=0;I<v._sb.length;I++)v.__h.push(v._sb[I]);v._sb=[]}else do v.__d=!1,$&&$(e),f=v.render(v.props,v.state,v.context),v.state=v.__s;while(v.__d&&++P<25);v.state=v.__s,v.getChildContext!=null&&(n=no(no({},n),v.getChildContext())),C&&!g&&v.getSnapshotBeforeUpdate!=null&&(x=v.getSnapshotBeforeUpdate(y,b)),W=f,f!=null&&f.type===Ja&&f.key==null&&(W=$1(f.props.children)),l=B1(r,Xl(W)?W:[W],e,t,n,i,o,s,l,d,c),v.base=e.__e,e.__u&=-161,v.__h.length&&s.push(v),w&&(v.__E=v.__=null)}catch(ee){if(e.__v=null,d||o!=null)if(ee.then){for(e.__u|=d?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,e.__e=l}else{for(se=o.length;se--;)tp(o[se]);Kf(e)}else e.__e=t.__e,e.__k=t.__k,ee.then||Kf(e);Vt.__e(ee,e,t)}else o==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):l=e.__e=zP(t.__e,e,t,n,i,o,s,d,c);return(f=Vt.diffed)&&f(e),128&e.__u?void 0:l}function Kf(r){r&&r.__c&&(r.__c.__e=!0),r&&r.__k&&r.__k.forEach(Kf)}function H1(r,e,t){for(var n=0;n<t.length;n++)rp(t[n],t[++n],t[++n]);Vt.__c&&Vt.__c(e,r),r.some(function(i){try{r=i.__h,i.__h=[],r.some(function(o){o.call(i)})}catch(o){Vt.__e(o,i.__v)}})}function $1(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Xl(r)?r.map($1):no({},r)}function zP(r,e,t,n,i,o,s,l,d){var c,f,v,g,y,b,x,w=t.props,_=e.props,C=e.type;if(C=="svg"?i="http://www.w3.org/2000/svg":C=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((y=o[c])&&"setAttribute"in y==!!C&&(C?y.localName==C:y.nodeType==3)){r=y,o[c]=null;break}}if(r==null){if(C==null)return document.createTextNode(_);r=document.createElementNS(i,C,_.is&&_),l&&(Vt.__m&&Vt.__m(e,o),l=!1),o=null}if(C==null)w===_||l&&r.data==_||(r.data=_);else{if(o=o&&sc.call(r.childNodes),w=t.props||El,!l&&o!=null)for(w={},c=0;c<r.attributes.length;c++)w[(y=r.attributes[c]).name]=y.value;for(c in w)if(y=w[c],c!="children"){if(c=="dangerouslySetInnerHTML")v=y;else if(!(c in _)){if(c=="value"&&"defaultValue"in _||c=="checked"&&"defaultChecked"in _)continue;Nu(r,c,null,y,i)}}for(c in _)y=_[c],c=="children"?g=y:c=="dangerouslySetInnerHTML"?f=y:c=="value"?b=y:c=="checked"?x=y:l&&typeof y!="function"||w[c]===y||Nu(r,c,y,w[c],i);if(f)l||v&&(f.__html==v.__html||f.__html==r.innerHTML)||(r.innerHTML=f.__html),e.__k=[];else if(v&&(r.innerHTML=""),B1(e.type=="template"?r.content:r,Xl(g)?g:[g],e,t,n,C=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,s,o?o[0]:t.__k&&Za(t,0),l,d),o!=null)for(c=o.length;c--;)tp(o[c]);l||(c="value",C=="progress"&&b==null?r.removeAttribute("value"):b!=null&&(b!==r[c]||C=="progress"&&!b||C=="option"&&b!=w[c])&&Nu(r,c,b,w[c],i),c="checked",x!=null&&x!=r[c]&&Nu(r,c,x,w[c],i))}return r}function rp(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(i){Vt.__e(i,t)}}function F1(r,e,t){var n,i;if(Vt.unmount&&Vt.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||rp(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){Vt.__e(o,e)}n.base=n.__P=null}if(n=r.__k)for(i=0;i<n.length;i++)n[i]&&F1(n[i],e,t||typeof r.type!="function");t||tp(r.__e),r.__c=r.__=r.__e=void 0}function WP(r,e,t){return this.constructor(r,t)}function UP(r,e,t){var n,i,o,s;e==document&&(e=document.documentElement),Vt.__&&Vt.__(r,e),i=(n=!1)?null:e.__k,o=[],s=[],np(e,r=e.__k=xt(Ja,null,[r]),i||El,El,e.namespaceURI,i?null:e.firstChild?sc.call(e.childNodes):null,o,i?i.__e:e.firstChild,n,s),H1(o,r,s)}sc=R1.slice,Vt={__e:function(r,e,t,n){for(var i,o,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(r)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(r,n||{}),s=i.__d),s)return i.__E=i}catch(l){r=l}throw r}},T1=0,Gt.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=no({},this.state),typeof r=="function"&&(r=r(no({},t),this.props)),r&&no(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),Fg(this))},Gt.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Fg(this))},Gt.prototype.render=Ja,Ko=[],D1=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,L1=function(r,e){return r.__v.__b-e.__v.__b},ld.__r=0,P1=/(PointerCapture)$|Capture$/i,ep=0,Gf=Wg(!1),Yf=Wg(!0);var VP="An invariant failed, however the error is obfuscated because this is a production build.",dd=[];Object.freeze(dd);var ip={};Object.freeze(ip);function Rr(){return++kt.mobxGuid}function an(r){throw ta(!1,r),"X"}function ta(r,e){if(!r)throw new Error("[mobx] "+(e||VP))}function z1(r){var e=!1;return function(){if(!e)return e=!0,r.apply(this,arguments)}}var Au=function(){};function XP(r){var e=[];return r.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function op(r){return r!==null&&typeof r=="object"}function _s(r){if(r===null||typeof r!="object")return!1;var e=Object.getPrototypeOf(r);return e===Object.prototype||e===null}function GP(r){if(xs(r)||Hr(r))return r;if(Array.isArray(r))return new Map(r);if(_s(r)){var e=new Map;for(var t in r)e.set(t,r[t]);return e}else return an("Cannot convert to map from '"+r+"'")}function bs(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function YP(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function KP(r,e){var t=Object.getOwnPropertyDescriptor(r,e);return!t||t.configurable!==!1&&t.writable!==!1}function Ao(r,e){var t="isMobX"+r;return e.prototype[t]=!0,function(n){return op(n)&&n[t]===!0}}function xs(r){return r instanceof Map}function Gl(r){return r instanceof Set}function W1(r){var e=new Set;for(var t in r)e.add(t);return Object.getOwnPropertySymbols(r).forEach(function(n){Object.getOwnPropertyDescriptor(r,n).enumerable&&e.add(n)}),Array.from(e)}function wo(r){return r&&r.toString?r.toString():new String(r).toString()}function U1(r){return r===null?null:typeof r=="object"?""+r:r}var qP=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames,$t=Symbol("mobx administration"),ws=function(){function r(e){e===void 0&&(e="Atom@"+Rr()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=ln.NOT_TRACKING}return r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.reportObserved=function(){return tw(this)},r.prototype.reportChanged=function(){xi(),yR(this),wi()},r.prototype.toString=function(){return this.name},r}(),ap=Ao("Atom",ws);function sp(r,e,t){e===void 0&&(e=Au),t===void 0&&(t=Au);var n=new ws(r);return e!==Au&&TR(n,e),t!==Au&&sw(n,t),n}function JP(r,e){return mw(r,e)}function ZP(r,e){return Object.is(r,e)}var Qa={structural:JP,default:ZP};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var qf=function(r,e){return qf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},qf(r,e)};function QP(r,e){qf(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var cd=function(){return cd=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},cd.apply(this,arguments)};function $i(r){var e=typeof Symbol=="function"&&r[Symbol.iterator],t=0;return e?e.call(r):{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}}}function za(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o}function lp(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(za(arguments[e]));return r}var fd=Symbol("mobx did run lazy initializers"),rl=Symbol("mobx pending decorators"),eR={},tR={};function nR(r,e){var t=e?eR:tR;return t[r]||(t[r]={configurable:!0,enumerable:e,get:function(){return aa(this),this[r]},set:function(n){aa(this),this[r]=n}})}function aa(r){var e,t;if(r[fd]!==!0){var n=r[rl];if(n){bs(r,fd,!0);var i=lp(Object.getOwnPropertySymbols(n),Object.keys(n));try{for(var o=$i(i),s=o.next();!s.done;s=o.next()){var l=s.value,d=n[l];d.propertyCreator(r,d.prop,d.descriptor,d.decoratorTarget,d.decoratorArguments)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}}}function V1(r,e){return function(){var n,i=function(s,l,d,c){if(c===!0)return e(s,l,d,s,n),null;if(!Object.prototype.hasOwnProperty.call(s,rl)){var f=s[rl];bs(s,rl,cd({},f))}return s[rl][l]={prop:l,propertyCreator:e,descriptor:d,decoratorTarget:s,decoratorArguments:n},nR(l,r)};return rR(arguments)?(n=dd,i.apply(null,arguments)):(n=Array.prototype.slice.call(arguments),i)}}function rR(r){return(r.length===2||r.length===3)&&(typeof r[1]=="string"||typeof r[1]=="symbol")||r.length===4&&r[3]===!0}function Yl(r,e,t){return rs(r)?r:Array.isArray(r)?Ae.array(r,{name:t}):_s(r)?Ae.object(r,void 0,{name:t}):xs(r)?Ae.map(r,{name:t}):Gl(r)?Ae.set(r,{name:t}):r}function iR(r,e,t){return r==null||Ai(r)||Gi(r)||Hr(r)||oi(r)?r:Array.isArray(r)?Ae.array(r,{name:t,deep:!1}):_s(r)?Ae.object(r,void 0,{name:t,deep:!1}):xs(r)?Ae.map(r,{name:t,deep:!1}):Gl(r)?Ae.set(r,{name:t,deep:!1}):an(!1)}function uc(r){return r}function oR(r,e,t){return mw(r,e)?e:r}function dc(r){ta(r);var e=V1(!0,function(n,i,o,s,l){var d=o?o.initializer?o.initializer.call(n):o.value:void 0;hp(n).addObservableProp(i,d,r)}),t=e;return t.enhancer=r,t}var X1={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(X1);function Ha(r){return r==null?X1:typeof r=="string"?{name:r,deep:!0,proxy:!0}:r}var up=dc(Yl),aR=dc(iR),G1=dc(uc),sR=dc(oR);function Tu(r){return r.defaultDecorator?r.defaultDecorator.enhancer:r.deep===!1?uc:Yl}function lR(r,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return up.apply(null,arguments);if(rs(r))return r;var n=_s(r)?Ae.object(r,e,t):Array.isArray(r)?Ae.array(r,e):xs(r)?Ae.map(r,e):Gl(r)?Ae.set(r,e):r;if(n!==r)return n;an(!1)}var Ug={box:function(r,e){arguments.length>2&&Qs("box");var t=Ha(e);return new ra(r,Tu(t),t.name,!0,t.equals)},array:function(r,e){arguments.length>2&&Qs("array");var t=Ha(e);return XR(r,Tu(t),t.name)},map:function(r,e){arguments.length>2&&Qs("map");var t=Ha(e);return new fp(r,Tu(t),t.name)},set:function(r,e){arguments.length>2&&Qs("set");var t=Ha(e);return new vw(r,Tu(t),t.name)},object:function(r,e,t){typeof arguments[1]=="string"&&Qs("object");var n=Ha(t);if(n.proxy===!1)return nh({},r,e,n);var i=uw(n),o=nh({},void 0,void 0,n),s=WR(o);return dw(s,r,e,i),s},ref:G1,shallow:aR,deep:up,struct:sR},Ae=lR;Object.keys(Ug).forEach(function(r){return Ae[r]=Ug[r]});function Qs(r){an("Expected one or two arguments to observable."+r+". Did you accidentally try to use observable."+r+" as decorator?")}var hd=V1(!1,function(r,e,t,n,i){var o=t.get,s=t.set,l=i[0]||{};hp(r).addComputedProp(r,e,cd({get:o,set:s,context:r},l))}),uR=hd({equals:Qa.structural}),fn=function(e,t,n){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return hd.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new ts(i)};fn.struct=uR;var ln;(function(r){r[r.NOT_TRACKING=-1]="NOT_TRACKING",r[r.UP_TO_DATE=0]="UP_TO_DATE",r[r.POSSIBLY_STALE=1]="POSSIBLY_STALE",r[r.STALE=2]="STALE"})(ln||(ln={}));var Fi;(function(r){r[r.NONE=0]="NONE",r[r.LOG=1]="LOG",r[r.BREAK=2]="BREAK"})(Fi||(Fi={}));var pd=function(){function r(e){this.cause=e}return r}();function il(r){return r instanceof pd}function Jf(r){switch(r.dependenciesState){case ln.UP_TO_DATE:return!1;case ln.NOT_TRACKING:case ln.STALE:return!0;case ln.POSSIBLY_STALE:{for(var e=dp(!0),t=Ss(),n=r.observing,i=n.length,o=0;o<i;o++){var s=n[o];if(ns(s)){if(kt.disableErrorBoundaries)s.get();else try{s.get()}catch{return Eo(t),ll(e),!0}if(r.dependenciesState===ln.STALE)return Eo(t),ll(e),!0}}return q1(r),Eo(t),ll(e),!1}}}function es(r){var e=r.observers.size>0;kt.computationDepth>0&&e&&an(!1),!kt.allowStateChanges&&(e||kt.enforceActions==="strict")&&an(!1)}function Y1(r,e,t){var n=dp(!0);q1(r),r.newObserving=new Array(r.observing.length+100),r.unboundDepsCount=0,r.runId=++kt.runId;var i=kt.trackingDerivation;kt.trackingDerivation=r;var o;if(kt.disableErrorBoundaries===!0)o=e.call(t);else try{o=e.call(t)}catch(s){o=new pd(s)}return kt.trackingDerivation=i,dR(r),ll(n),o}function dR(r){for(var e=r.observing,t=r.observing=r.newObserving,n=ln.UP_TO_DATE,i=0,o=r.unboundDepsCount,s=0;s<o;s++){var l=t[s];l.diffValue===0&&(l.diffValue=1,i!==s&&(t[i]=l),i++),l.dependenciesState>n&&(n=l.dependenciesState)}for(t.length=i,r.newObserving=null,o=e.length;o--;){var l=e[o];l.diffValue===0&&Q1(l,r),l.diffValue=0}for(;i--;){var l=t[i];l.diffValue===1&&(l.diffValue=0,mR(l,r))}n!==ln.UP_TO_DATE&&(r.dependenciesState=n,r.onBecomeStale())}function Zf(r){var e=r.observing;r.observing=[];for(var t=e.length;t--;)Q1(e[t],r);r.dependenciesState=ln.NOT_TRACKING}function K1(r){var e=Ss();try{return r()}finally{Eo(e)}}function Ss(){var r=kt.trackingDerivation;return kt.trackingDerivation=null,r}function Eo(r){kt.trackingDerivation=r}function dp(r){var e=kt.allowStateReads;return kt.allowStateReads=r,e}function ll(r){kt.allowStateReads=r}function q1(r){if(r.dependenciesState!==ln.UP_TO_DATE){r.dependenciesState=ln.UP_TO_DATE;for(var e=r.observing,t=e.length;t--;)e[t].lowestObserverState=ln.UP_TO_DATE}}var vd=0,cR=1,Vg=Object.getOwnPropertyDescriptor(function(){},"name");Vg&&Vg.configurable;function na(r,e,t){var n=function(){return J1(r,e,t||this,arguments)};return n.isMobxAction=!0,n}function J1(r,e,t,n){var i=fR();try{return e.apply(t,n)}catch(o){throw i.error=o,o}finally{hR(i)}}function fR(r,e,t){var n=ri(),i=0,o=Ss();xi();var s=cc(!0),l=dp(!0),d={prevDerivation:o,prevAllowStateChanges:s,prevAllowStateReads:l,notifySpy:n,startTime:i,actionId:cR++,parentActionId:vd};return vd=d.actionId,d}function hR(r){vd!==r.actionId&&an("invalid action stack. did you forget to finish an action?"),vd=r.parentActionId,r.error!==void 0&&(kt.suppressReactionErrors=!0),fc(r.prevAllowStateChanges),ll(r.prevAllowStateReads),wi(),Eo(r.prevDerivation),r.notifySpy,kt.suppressReactionErrors=!1}function cc(r){var e=kt.allowStateChanges;return kt.allowStateChanges=r,e}function fc(r){kt.allowStateChanges=r}var ra=function(r){QP(e,r);function e(t,n,i,o,s){i===void 0&&(i="ObservableValue@"+Rr()),s===void 0&&(s=Qa.default);var l=r.call(this,i)||this;return l.enhancer=n,l.name=i,l.equals=s,l.hasUnreportedChange=!1,l.value=n(t,void 0,i),l}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==kt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(es(this),zi(this)){var n=Wi(this,{object:this,type:"update",newValue:t});if(!n)return kt.UNCHANGED;t=n.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?kt.UNCHANGED:t},e.prototype.setNewValue=function(t){var n=this.value;this.value=t,this.reportChanged(),Si(this)&&Ei(this,{type:"update",object:this,newValue:t,oldValue:n})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return Kl(this,t)},e.prototype.observe=function(t,n){return n&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),ql(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return U1(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e}(ws),pR=Ao("ObservableValue",ra),ts=function(){function r(e){this.dependenciesState=ln.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=ln.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+Rr(),this.value=new pd(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=Fi.NONE,ta(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+Rr(),e.set&&(this.setter=na(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?Qa.structural:Qa.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return r.prototype.onBecomeStale=function(){bR(this)},r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.get=function(){this.isComputing&&an("Cycle detected in computation "+this.name+": "+this.derivation),kt.inBatch===0&&this.observers.size===0&&!this.keepAlive?Jf(this)&&(this.warnAboutUntrackedRead(),xi(),this.value=this.computeValue(!1),wi()):(tw(this),Jf(this)&&this.trackAndCompute()&&_R(this));var e=this.value;if(il(e))throw e.cause;return e},r.prototype.peek=function(){var e=this.computeValue(!1);if(il(e))throw e.cause;return e},r.prototype.set=function(e){if(this.setter){ta(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else ta(!1,!1)},r.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===ln.NOT_TRACKING,n=this.computeValue(!0),i=t||il(e)||il(n)||!this.equals(e,n);return i&&(this.value=n),i},r.prototype.computeValue=function(e){this.isComputing=!0,kt.computationDepth++;var t;if(e)t=Y1(this,this.derivation,this.scope);else if(kt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(n){t=new pd(n)}return kt.computationDepth--,this.isComputing=!1,t},r.prototype.suspend=function(){this.keepAlive||(Zf(this),this.value=void 0)},r.prototype.observe=function(e,t){var n=this,i=!0,o=void 0;return MR(function(){var s=n.get();if(!i||t){var l=Ss();e({type:"update",object:n,newValue:s,oldValue:o}),Eo(l)}i=!1,o=s})},r.prototype.warnAboutUntrackedRead=function(){},r.prototype.toJSON=function(){return this.get()},r.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},r.prototype.valueOf=function(){return U1(this.get())},r.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},r}(),ns=Ao("ComputedValue",ts),td=function(){function r(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return r}(),vR={};function Qf(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:vR}var nd=!0,Z1=!1,kt=function(){var r=Qf();return r.__mobxInstanceCount>0&&!r.__mobxGlobals&&(nd=!1),r.__mobxGlobals&&r.__mobxGlobals.version!==new td().version&&(nd=!1),nd?r.__mobxGlobals?(r.__mobxInstanceCount+=1,r.__mobxGlobals.UNCHANGED||(r.__mobxGlobals.UNCHANGED={}),r.__mobxGlobals):(r.__mobxInstanceCount=1,r.__mobxGlobals=new td):(setTimeout(function(){Z1||an("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new td)}();function gR(){(kt.pendingReactions.length||kt.inBatch||kt.isRunningReactions)&&an("isolateGlobalState should be called before MobX is running any reactions"),Z1=!0,nd&&(--Qf().__mobxInstanceCount===0&&(Qf().__mobxGlobals=void 0),kt=new td)}function eh(){return kt}function mR(r,e){r.observers.add(e),r.lowestObserverState>e.dependenciesState&&(r.lowestObserverState=e.dependenciesState)}function Q1(r,e){r.observers.delete(e),r.observers.size===0&&ew(r)}function ew(r){r.isPendingUnobservation===!1&&(r.isPendingUnobservation=!0,kt.pendingUnobservations.push(r))}function xi(){kt.inBatch++}function wi(){if(--kt.inBatch===0){iw();for(var r=kt.pendingUnobservations,e=0;e<r.length;e++){var t=r[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof ts&&t.suspend())}kt.pendingUnobservations=[]}}function tw(r){var e=kt.trackingDerivation;return e!==null?(e.runId!==r.lastAccessedBy&&(r.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=r,r.isBeingObserved||(r.isBeingObserved=!0,r.onBecomeObserved())),!0):(r.observers.size===0&&kt.inBatch>0&&ew(r),!1)}function yR(r){r.lowestObserverState!==ln.STALE&&(r.lowestObserverState=ln.STALE,r.observers.forEach(function(e){e.dependenciesState===ln.UP_TO_DATE&&(e.isTracing!==Fi.NONE&&nw(e,r),e.onBecomeStale()),e.dependenciesState=ln.STALE}))}function _R(r){r.lowestObserverState!==ln.STALE&&(r.lowestObserverState=ln.STALE,r.observers.forEach(function(e){e.dependenciesState===ln.POSSIBLY_STALE?e.dependenciesState=ln.STALE:e.dependenciesState===ln.UP_TO_DATE&&(r.lowestObserverState=ln.UP_TO_DATE)}))}function bR(r){r.lowestObserverState===ln.UP_TO_DATE&&(r.lowestObserverState=ln.POSSIBLY_STALE,r.observers.forEach(function(e){e.dependenciesState===ln.UP_TO_DATE&&(e.dependenciesState=ln.POSSIBLY_STALE,e.isTracing!==Fi.NONE&&nw(e,r),e.onBecomeStale())}))}function nw(r,e){if(""+r.name+e.name,r.isTracing===Fi.BREAK){var t=[];rw(LR(r),t,1),new Function(`debugger;
/*
Tracing '`+r.name+`'

You are entering this break point because derivation '`+r.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(r instanceof ts?r.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function rw(r,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+r.name),r.dependencies&&r.dependencies.forEach(function(n){return rw(n,e,t+1)})}var Cl=function(){function r(e,t,n,i){e===void 0&&(e="Reaction@"+Rr()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=n,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=ln.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+Rr(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=Fi.NONE}return r.prototype.onBecomeStale=function(){this.schedule()},r.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,kt.pendingReactions.push(this),iw())},r.prototype.isScheduled=function(){return this._isScheduled},r.prototype.runReaction=function(){if(!this.isDisposed){if(xi(),this._isScheduled=!1,Jf(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&ri()}catch(e){this.reportExceptionInDerivation(e)}}wi()}},r.prototype.track=function(e){if(!this.isDisposed){xi(),this._isRunning=!0;var t=Y1(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&Zf(this),il(t)&&this.reportExceptionInDerivation(t.cause),wi()}},r.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(kt.disableErrorBoundaries)throw e;var n="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";kt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(n,e),kt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},r.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(xi(),Zf(this),wi()))},r.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[$t]=this,e},r.prototype.toString=function(){return"Reaction["+this.name+"]"},r.prototype.trace=function(e){e===void 0&&(e=!1),$R(this,e)},r}(),Xg=100,th=function(r){return r()};function iw(){kt.inBatch>0||kt.isRunningReactions||th(xR)}function xR(){kt.isRunningReactions=!0;for(var r=kt.pendingReactions,e=0;r.length>0;){++e===Xg&&(console.error("Reaction doesn't converge to a stable state after "+Xg+" iterations."+(" Probably there is a cycle in the reactive function: "+r[0])),r.splice(0));for(var t=r.splice(0),n=0,i=t.length;n<i;n++)t[n].runReaction()}kt.isRunningReactions=!1}var gd=Ao("Reaction",Cl);function wR(r){var e=th;th=function(t){return r(function(){return e(t)})}}function ri(){return!1}function SR(r){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function ER(){an(!1)}function Gg(r){return function(e,t,n){if(n){if(n.value)return{value:na(r,n.value),enumerable:!1,configurable:!0,writable:!0};var i=n.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return na(r,i.call(this))}}}return CR(r).apply(this,arguments)}}function CR(r){return function(e,t,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){bs(this,t,Me(r,i))}})}}function OR(r,e,t,n){return n===!0?(yf(r,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return yf(this,e,t.value||t.initializer.call(this)),this[e]},set:ER}:{enumerable:!1,configurable:!0,set:function(i){yf(this,e,i)},get:function(){}}}var Me=function(e,t,n,i){if(arguments.length===1&&typeof e=="function")return na(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return na(e,t);if(arguments.length===1&&typeof e=="string")return Gg(e);if(i===!0)bs(e,t,na(e.name||t,n.value,this));else return Gg(t).apply(null,arguments)};Me.bound=OR;function kR(r,e){var t=typeof r=="string"?r:r.name||"<unnamed action>",n=typeof r=="function"?r:e;return J1(t,n,this,void 0)}function yf(r,e,t){bs(r,e,na(e,t.bind(r)))}function MR(r,e){e===void 0&&(e=ip);var t=e&&e.name||r.name||"Autorun@"+Rr(),n=!e.scheduler&&!e.delay,i;if(n)i=new Cl(t,function(){this.track(l)},e.onError,e.requiresObservable);else{var o=ow(e),s=!1;i=new Cl(t,function(){s||(s=!0,o(function(){s=!1,i.isDisposed||i.track(l)}))},e.onError,e.requiresObservable)}function l(){r(i)}return i.schedule(),i.getDisposer()}var NR=function(r){return r()};function ow(r){return r.scheduler?r.scheduler:r.delay?function(e){return setTimeout(e,r.delay)}:NR}function aw(r,e,t){t===void 0&&(t=ip);var n=t.name||"Reaction@"+Rr(),i=Me(n,t.onError?AR(t.onError,e):e),o=!t.scheduler&&!t.delay,s=ow(t),l=!0,d=!1,c,f=t.compareStructural?Qa.structural:t.equals||Qa.default,v=new Cl(n,function(){l||o?g():d||(d=!0,s(g))},t.onError,t.requiresObservable);function g(){if(d=!1,!v.isDisposed){var y=!1;v.track(function(){var b=r(v);y=l||!f(c,b),c=b}),l&&t.fireImmediately&&i(c,v),!l&&y===!0&&i(c,v),l&&(l=!1)}}return v.schedule(),v.getDisposer()}function AR(r,e){return function(){try{return e.apply(this,arguments)}catch(t){r.call(this,t)}}}function TR(r,e,t){return lw("onBecomeObserved",r,e)}function sw(r,e,t){return lw("onBecomeUnobserved",r,e)}function lw(r,e,t,n){var i=Oo(e),o=t,s=r+"Listeners";i[s]?i[s].add(o):i[s]=new Set([o]);var l=i[r];return typeof l!="function"?an(!1):function(){var d=i[s];d&&(d.delete(o),d.size===0&&delete i[s])}}function DR(r){var e=r.enforceActions,t=r.computedRequiresReaction,n=r.computedConfigurable,i=r.disableErrorBoundaries,o=r.reactionScheduler,s=r.reactionRequiresObservable,l=r.observableRequiresReaction;if(gR(),e!==void 0){var d=void 0;switch(e){case!0:case"observed":d=!0;break;case!1:case"never":d=!1;break;case"strict":case"always":d="strict";break;default:an("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}kt.enforceActions=d,kt.allowStateChanges=!(d===!0||d==="strict")}t!==void 0&&(kt.computedRequiresReaction=!!t),s!==void 0&&(kt.reactionRequiresObservable=!!s),l!==void 0&&(kt.observableRequiresReaction=!!l,kt.allowStateReads=!kt.observableRequiresReaction),n!==void 0&&(kt.computedConfigurable=!!n),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),kt.disableErrorBoundaries=!!i),o&&wR(o)}function nh(r,e,t,n){n=Ha(n);var i=uw(n);return aa(r),hp(r,n.name,i.enhancer),e&&dw(r,e,t,i),r}function uw(r){return r.defaultDecorator||(r.deep===!1?G1:up)}function dw(r,e,t,n){var i,o,s,l,d,c;xi();try{var s=qP(e);try{for(var f=$i(s),v=f.next();!v.done;v=f.next()){var c=v.value,g=Object.getOwnPropertyDescriptor(e,c),y=t&&c in t?t[c]:g.get?hd:n,b=y(r,c,g,!0);b&&Object.defineProperty(r,c,b)}}catch(w){i={error:w}}finally{try{v&&!v.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}finally{wi()}}function LR(r,e){return cw(Oo(r,e))}function cw(r){var e={name:r.name};return r.observing&&r.observing.length>0&&(e.dependencies=XP(r.observing).map(cw)),e}function fw(r,e){if(r==null)return!1;if(e!==void 0){if(Ai(r)===!1||!r[$t].values.has(e))return!1;var t=Oo(r,e);return ns(t)}return ns(r)}function PR(r){return arguments.length>1?an(!1):fw(r)}function Yg(r,e){return typeof e!="string"?an(!1):fw(r,e)}function RR(r,e){return r==null?!1:Ai(r)||!!r[$t]||ap(r)||gd(r)||ns(r)}function rs(r){return arguments.length!==1&&an(!1),RR(r)}function is(r){return Ai(r)?r[$t].getKeys():Hr(r)||oi(r)?Array.from(r.keys()):Gi(r)?r.map(function(e,t){return t}):an(!1)}function IR(r){return Ai(r)?is(r).map(function(e){return r[e]}):Hr(r)?is(r).map(function(e){return r.get(e)}):oi(r)?Array.from(r.values()):Gi(r)?r.slice():an(!1)}function BR(r){return Ai(r)?is(r).map(function(e){return[e,r[e]]}):Hr(r)?is(r).map(function(e){return[e,r.get(e)]}):oi(r)?Array.from(r.entries()):Gi(r)?r.map(function(e,t){return[t,e]}):an(!1)}function cp(r,e,t){if(arguments.length===2&&!oi(r)){xi();var n=e;try{for(var i in n)cp(r,i,n[i])}finally{wi()}return}if(Ai(r)){var o=r[$t],s=o.values.get(e);s?o.write(e,t):o.addObservableProp(e,t,o.defaultEnhancer)}else if(Hr(r))r.set(e,t);else if(oi(r))r.add(e);else if(Gi(r))typeof e!="number"&&(e=parseInt(e,10)),ta(e>=0,"Not a valid index: '"+e+"'"),xi(),e>=r.length&&(r.length=e+1),r[e]=t,wi();else return an(!1)}function hw(r,e,t,n){return jR(r,e,t)}function jR(r,e,t){return hc(r).observe(e,t)}var HR={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Da(r,e,t,n){return n.detectCycles&&r.set(e,t),t}function yo(r,e,t){if(!e.recurseEverything&&!rs(r)||typeof r!="object")return r;if(r===null)return null;if(r instanceof Date)return r;if(pR(r))return yo(r.get(),e,t);rs(r)&&is(r);var n=e.detectCycles===!0;if(n&&r!==null&&t.has(r))return t.get(r);if(Gi(r)||Array.isArray(r)){var i=Da(t,r,[],e),o=r.map(function(y){return yo(y,e,t)});i.length=o.length;for(var s=0,l=o.length;s<l;s++)i[s]=o[s];return i}if(oi(r)||Object.getPrototypeOf(r)===Set.prototype)if(e.exportMapsAsObjects===!1){var d=Da(t,r,new Set,e);return r.forEach(function(y){d.add(yo(y,e,t))}),d}else{var c=Da(t,r,[],e);return r.forEach(function(y){c.push(yo(y,e,t))}),c}if(Hr(r)||Object.getPrototypeOf(r)===Map.prototype)if(e.exportMapsAsObjects===!1){var f=Da(t,r,new Map,e);return r.forEach(function(y,b){f.set(b,yo(y,e,t))}),f}else{var v=Da(t,r,{},e);return r.forEach(function(y,b){v[b]=yo(y,e,t)}),v}var g=Da(t,r,{},e);return W1(r).forEach(function(y){g[y]=yo(r[y],e,t)}),g}function gi(r,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=HR),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),yo(r,e,t)}function $R(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=!1;typeof r[r.length-1]=="boolean"&&(t=r.pop());var n=FR(r);if(!n)return an(!1);n.isTracing===Fi.NONE&&""+n.name,n.isTracing=t?Fi.BREAK:Fi.LOG}function FR(r){switch(r.length){case 0:return kt.trackingDerivation;case 1:return Oo(r[0]);case 2:return Oo(r[0],r[1])}}function yi(r,e){e===void 0&&(e=void 0),xi();try{return r.apply(e)}finally{wi()}}function Du(r){return r[$t]}function Lu(r){return typeof r=="string"||typeof r=="number"||typeof r=="symbol"}var zR={has:function(r,e){if(e===$t||e==="constructor"||e===fd)return!0;var t=Du(r);return Lu(e)?t.has(e):e in r},get:function(r,e){if(e===$t||e==="constructor"||e===fd)return r[e];var t=Du(r),n=t.values.get(e);if(n instanceof ws){var i=n.get();return i===void 0&&t.has(e),i}return Lu(e)&&t.has(e),r[e]},set:function(r,e,t){return Lu(e)?(cp(r,e,t),!0):!1},deleteProperty:function(r,e){if(!Lu(e))return!1;var t=Du(r);return t.remove(e),!0},ownKeys:function(r){var e=Du(r);return e.keysAtom.reportObserved(),Reflect.ownKeys(r)},preventExtensions:function(r){return an("Dynamic observable objects cannot be frozen"),!1}};function WR(r){var e=new Proxy(r,zR);return r[$t].proxy=e,e}function zi(r){return r.interceptors!==void 0&&r.interceptors.length>0}function Kl(r,e){var t=r.interceptors||(r.interceptors=[]);return t.push(e),z1(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function Wi(r,e){var t=Ss();try{for(var n=lp(r.interceptors||[]),i=0,o=n.length;i<o&&(e=n[i](e),ta(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{Eo(t)}}function Si(r){return r.changeListeners!==void 0&&r.changeListeners.length>0}function ql(r,e){var t=r.changeListeners||(r.changeListeners=[]);return t.push(e),z1(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function Ei(r,e){var t=Ss(),n=r.changeListeners;if(n){n=n.slice();for(var i=0,o=n.length;i<o;i++)n[i](e);Eo(t)}}var UR=1e4,VR={get:function(r,e){return e===$t?r[$t]:e==="length"?r[$t].getArrayLength():typeof e=="number"?to.get.call(r,e):typeof e=="string"&&!isNaN(e)?to.get.call(r,parseInt(e)):to.hasOwnProperty(e)?to[e]:r[e]},set:function(r,e,t){return e==="length"&&r[$t].setArrayLength(t),typeof e=="number"&&to.set.call(r,e,t),typeof e=="symbol"||isNaN(e)?r[e]=t:to.set.call(r,parseInt(e),t),!0},preventExtensions:function(r){return an("Observable arrays cannot be frozen"),!1}};function XR(r,e,t,n){t===void 0&&(t="ObservableArray@"+Rr()),n===void 0&&(n=!1);var i=new pw(t,e,n);YP(i.values,$t,i);var o=new Proxy(i.values,VR);if(i.proxy=o,r&&r.length){var s=cc(!0);i.spliceWithArray(0,0,r),fc(s)}return o}var pw=function(){function r(e,t,n){this.owned=n,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new ws(e||"ObservableArray@"+Rr()),this.enhancer=function(i,o){return t(i,o,e+"[..]")}}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},r.prototype.intercept=function(e){return Kl(this,e)},r.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),ql(this,e)},r.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},r.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var n=new Array(e-t),i=0;i<e-t;i++)n[i]=void 0;this.spliceWithArray(t,0,n)}else this.spliceWithArray(e,t-e)},r.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},r.prototype.spliceWithArray=function(e,t,n){var i=this;es(this.atom);var o=this.values.length;if(e===void 0?e=0:e>o?e=o:e<0&&(e=Math.max(0,o+e)),arguments.length===1?t=o-e:t==null?t=0:t=Math.max(0,Math.min(t,o-e)),n===void 0&&(n=dd),zi(this)){var s=Wi(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:n});if(!s)return dd;t=s.removedCount,n=s.added}n=n.length===0?n:n.map(function(d){return i.enhancer(d,void 0)});var l=this.spliceItemsIntoValues(e,t,n);return(t!==0||n.length!==0)&&this.notifyArraySplice(e,n,l),this.dehanceValues(l)},r.prototype.spliceItemsIntoValues=function(e,t,n){var i;if(n.length<UR)return(i=this.values).splice.apply(i,lp([e,t],n));var o=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(n,this.values.slice(e+t)),o},r.prototype.notifyArrayChildUpdate=function(e,t,n){var i=!this.owned&&ri(),o=Si(this),s=o||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:n}:null;this.atom.reportChanged(),o&&Ei(this,s)},r.prototype.notifyArraySplice=function(e,t,n){var i=!this.owned&&ri(),o=Si(this),s=o||i?{object:this.proxy,type:"splice",index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom.reportChanged(),o&&Ei(this,s)},r}(),to={intercept:function(r){return this[$t].intercept(r)},observe:function(r,e){e===void 0&&(e=!1);var t=this[$t];return t.observe(r,e)},clear:function(){return this.splice(0)},replace:function(r){var e=this[$t];return e.spliceWithArray(0,e.values.length,r)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=this[$t];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(r);case 2:return i.spliceWithArray(r,e)}return i.spliceWithArray(r,e,t)},spliceWithArray:function(r,e,t){var n=this[$t];return n.spliceWithArray(r,e,t)},push:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[$t];return t.spliceWithArray(t.values.length,0,r),t.values.length},pop:function(){return this.splice(Math.max(this[$t].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[$t];return t.spliceWithArray(0,0,r),t.values.length},reverse:function(){var r=this.slice();return r.reverse.apply(r,arguments)},sort:function(r){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(r){var e=this[$t],t=e.dehanceValues(e.values).indexOf(r);return t>-1?(this.splice(t,1),!0):!1},get:function(r){var e=this[$t];if(e){if(r<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[r]);console.warn("[mobx.array] Attempt to read an array index ("+r+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(r,e){var t=this[$t],n=t.values;if(r<n.length){es(t.atom);var i=n[r];if(zi(t)){var o=Wi(t,{type:"update",object:t.proxy,index:r,newValue:e});if(!o)return;e=o.newValue}e=t.enhancer(e,i);var s=e!==i;s&&(n[r]=e,t.notifyArrayChildUpdate(r,e,i))}else if(r===n.length)t.spliceWithArray(r,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+r+" is larger than "+n.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(r){typeof Array.prototype[r]=="function"&&(to[r]=function(){var e=this[$t];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[r].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(r){typeof Array.prototype[r]=="function"&&(to[r]=function(e,t){var n=this,i=this[$t];i.atom.reportObserved();var o=i.dehanceValues(i.values);return o[r](function(s,l){return e.call(t,s,l,n)},t)})});["reduce","reduceRight"].forEach(function(r){to[r]=function(){var e=this,t=this[$t];t.atom.reportObserved();var n=arguments[0];return arguments[0]=function(i,o,s){return o=t.dehanceValue(o),n(i,o,s,e)},t.values[r].apply(t.values,arguments)}});var GR=Ao("ObservableArrayAdministration",pw);function Gi(r){return op(r)&&GR(r[$t])}var Kg,YR={},fp=function(){function r(e,t,n){if(t===void 0&&(t=Yl),n===void 0&&(n="ObservableMap@"+Rr()),this.enhancer=t,this.name=n,this[Kg]=YR,this._keysAtom=sp(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return r.prototype._has=function(e){return this._data.has(e)},r.prototype.has=function(e){var t=this;if(!kt.trackingDerivation)return this._has(e);var n=this._hasMap.get(e);if(!n){var i=n=new ra(this._has(e),uc,this.name+"."+wo(e)+"?",!1);this._hasMap.set(e,i),sw(i,function(){return t._hasMap.delete(e)})}return n.get()},r.prototype.set=function(e,t){var n=this._has(e);if(zi(this)){var i=Wi(this,{type:n?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return n?this._updateValue(e,t):this._addValue(e,t),this},r.prototype.delete=function(e){var t=this;if(es(this._keysAtom),zi(this)){var n=Wi(this,{type:"delete",object:this,name:e});if(!n)return!1}if(this._has(e)){var i=ri(),o=Si(this),n=o||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return yi(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var l=t._data.get(e);l.setNewValue(void 0),t._data.delete(e)}),o&&Ei(this,n),!0}return!1},r.prototype._updateHasMapEntry=function(e,t){var n=this._hasMap.get(e);n&&n.setNewValue(t)},r.prototype._updateValue=function(e,t){var n=this._data.get(e);if(t=n.prepareNewValue(t),t!==kt.UNCHANGED){var i=ri(),o=Si(this),s=o||i?{type:"update",object:this,oldValue:n.value,name:e,newValue:t}:null;n.setNewValue(t),o&&Ei(this,s)}},r.prototype._addValue=function(e,t){var n=this;es(this._keysAtom),yi(function(){var l=new ra(t,n.enhancer,n.name+"."+wo(e),!1);n._data.set(e,l),t=l.value,n._updateHasMapEntry(e,!0),n._keysAtom.reportChanged()});var i=ri(),o=Si(this),s=o||i?{type:"add",object:this,name:e,newValue:t}:null;o&&Ei(this,s)},r.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},r.prototype.values=function(){var e=this,t=this.keys();return md({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:e.get(o)}}})},r.prototype.entries=function(){var e=this,t=this.keys();return md({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:[o,e.get(o)]}}})},r.prototype[Kg=$t,Symbol.iterator]=function(){return this.entries()},r.prototype.forEach=function(e,t){var n,i;try{for(var o=$i(this),s=o.next();!s.done;s=o.next()){var l=za(s.value,2),d=l[0],c=l[1];e.call(t,c,d,this)}}catch(f){n={error:f}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},r.prototype.merge=function(e){var t=this;return Hr(e)&&(e=e.toJS()),yi(function(){var n=cc(!0);try{_s(e)?W1(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var o=za(i,2),s=o[0],l=o[1];return t.set(s,l)}):xs(e)?(e.constructor!==Map&&an("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,o){return t.set(o,i)})):e!=null&&an("Cannot initialize map from "+e)}finally{fc(n)}}),this},r.prototype.clear=function(){var e=this;yi(function(){K1(function(){var t,n;try{for(var i=$i(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;e.delete(s)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.replace=function(e){var t=this;return yi(function(){var n,i,o,s,l=GP(e),d=new Map,c=!1;try{for(var f=$i(t._data.keys()),v=f.next();!v.done;v=f.next()){var g=v.value;if(!l.has(g)){var y=t.delete(g);if(y)c=!0;else{var b=t._data.get(g);d.set(g,b)}}}}catch(I){n={error:I}}finally{try{v&&!v.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var x=$i(l.entries()),w=x.next();!w.done;w=x.next()){var _=za(w.value,2),g=_[0],b=_[1],C=t._data.has(g);if(t.set(g,b),t._data.has(g)){var k=t._data.get(g);d.set(g,k),C||(c=!0)}}}catch(I){o={error:I}}finally{try{w&&!w.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}if(!c)if(t._data.size!==d.size)t._keysAtom.reportChanged();else for(var D=t._data.keys(),R=d.keys(),$=D.next(),P=R.next();!$.done;){if($.value!==P.value){t._keysAtom.reportChanged();break}$=D.next(),P=R.next()}t._data=d}),this},Object.defineProperty(r.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.toPOJO=function(){var e,t,n={};try{for(var i=$i(this),o=i.next();!o.done;o=i.next()){var s=za(o.value,2),l=s[0],d=s[1];n[typeof l=="symbol"?l:wo(l)]=d}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.toJS=function(){return new Map(this)},r.prototype.toJSON=function(){return this.toPOJO()},r.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return wo(t)+": "+(""+e.get(t))}).join(", ")+" }]"},r.prototype.observe=function(e,t){return ql(this,e)},r.prototype.intercept=function(e){return Kl(this,e)},r}(),Hr=Ao("ObservableMap",fp),qg,KR={},vw=function(){function r(e,t,n){if(t===void 0&&(t=Yl),n===void 0&&(n="ObservableSet@"+Rr()),this.name=n,this[qg]=KR,this._data=new Set,this._atom=sp(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,o){return t(i,o,n)},e&&this.replace(e)}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.clear=function(){var e=this;yi(function(){K1(function(){var t,n;try{for(var i=$i(e._data.values()),o=i.next();!o.done;o=i.next()){var s=o.value;e.delete(s)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.forEach=function(e,t){var n,i;try{for(var o=$i(this),s=o.next();!s.done;s=o.next()){var l=s.value;e.call(t,l,l,this)}}catch(d){n={error:d}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},Object.defineProperty(r.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.add=function(e){var t=this;if(es(this._atom),zi(this)){var n=Wi(this,{type:"add",object:this,newValue:e});if(!n)return this}if(!this.has(e)){yi(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=ri(),o=Si(this),n=o||i?{type:"add",object:this,newValue:e}:null;o&&Ei(this,n)}return this},r.prototype.delete=function(e){var t=this;if(zi(this)){var n=Wi(this,{type:"delete",object:this,oldValue:e});if(!n)return!1}if(this.has(e)){var i=ri(),o=Si(this),n=o||i?{type:"delete",object:this,oldValue:e}:null;return yi(function(){t._atom.reportChanged(),t._data.delete(e)}),o&&Ei(this,n),!0}return!1},r.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},r.prototype.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return md({next:function(){var i=e;return e+=1,i<n.length?{value:[t[i],n[i]],done:!1}:{done:!0}}})},r.prototype.keys=function(){return this.values()},r.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,n=Array.from(this._data.values());return md({next:function(){return t<n.length?{value:e.dehanceValue(n[t++]),done:!1}:{done:!0}}})},r.prototype.replace=function(e){var t=this;return oi(e)&&(e=e.toJS()),yi(function(){var n=cc(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):Gl(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&an("Cannot initialize set from "+e)}finally{fc(n)}}),this},r.prototype.observe=function(e,t){return ql(this,e)},r.prototype.intercept=function(e){return Kl(this,e)},r.prototype.toJS=function(){return new Set(this)},r.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},r.prototype[qg=$t,Symbol.iterator]=function(){return this.values()},r}(),oi=Ao("ObservableSet",vw),gw=function(){function r(e,t,n,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=n,this.defaultEnhancer=i,this.keysAtom=new ws(n+".keys")}return r.prototype.read=function(e){return this.values.get(e).get()},r.prototype.write=function(e,t){var n=this.target,i=this.values.get(e);if(i instanceof ts){i.set(t);return}if(zi(this)){var o=Wi(this,{type:"update",object:this.proxy||n,name:e,newValue:t});if(!o)return;t=o.newValue}if(t=i.prepareNewValue(t),t!==kt.UNCHANGED){var s=Si(this),l=ri(),o=s||l?{type:"update",object:this.proxy||n,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),s&&Ei(this,o)}},r.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),n=t.get(e);if(n)return n.get();var i=!!this.values.get(e);return n=new ra(i,uc,this.name+"."+wo(e)+"?",!1),t.set(e,n),n.get()},r.prototype.addObservableProp=function(e,t,n){n===void 0&&(n=this.defaultEnhancer);var i=this.target;if(zi(this)){var o=Wi(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!o)return;t=o.newValue}var s=new ra(t,n,this.name+"."+wo(e),!1);this.values.set(e,s),t=s.value,Object.defineProperty(i,e,qR(e)),this.notifyPropertyAddition(e,t)},r.prototype.addComputedProp=function(e,t,n){var i=this.target;n.name=n.name||this.name+"."+wo(t),this.values.set(t,new ts(n)),(e===i||KP(e,t))&&Object.defineProperty(e,t,JR(t))},r.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(zi(this)){var n=Wi(this,{object:this.proxy||t,name:e,type:"remove"});if(!n)return}try{xi();var i=Si(this),o=ri(),s=this.values.get(e),l=s&&s.get();if(s&&s.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var d=this.pendingKeys.get(e);d&&d.set(!1)}delete this.target[e];var n=i||o?{type:"remove",object:this.proxy||t,oldValue:l,name:e}:null;i&&Ei(this,n)}finally{wi()}}},r.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},r.prototype.observe=function(e,t){return ql(this,e)},r.prototype.intercept=function(e){return Kl(this,e)},r.prototype.notifyPropertyAddition=function(e,t){var n=Si(this),i=ri(),o=n||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(n&&Ei(this,o),this.pendingKeys){var s=this.pendingKeys.get(e);s&&s.set(!0)}this.keysAtom.reportChanged()},r.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var n=[];try{for(var i=$i(this.values),o=i.next();!o.done;o=i.next()){var s=za(o.value,2),l=s[0],d=s[1];d instanceof ra&&n.push(l)}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}();function hp(r,e,t){if(e===void 0&&(e=""),t===void 0&&(t=Yl),Object.prototype.hasOwnProperty.call(r,$t))return r[$t];_s(r)||(e=(r.constructor.name||"ObservableObject")+"@"+Rr()),e||(e="ObservableObject@"+Rr());var n=new gw(r,new Map,wo(e),t);return bs(r,$t,n),n}var Jg=Object.create(null),Zg=Object.create(null);function qR(r){return Jg[r]||(Jg[r]={configurable:!0,enumerable:!0,get:function(){return this[$t].read(r)},set:function(e){this[$t].write(r,e)}})}function Qg(r){var e=r[$t];return e||(aa(r),r[$t])}function JR(r){return Zg[r]||(Zg[r]={configurable:kt.computedConfigurable,enumerable:!1,get:function(){return Qg(this).read(r)},set:function(e){Qg(this).write(r,e)}})}var ZR=Ao("ObservableObjectAdministration",gw);function Ai(r){return op(r)?(aa(r),ZR(r[$t])):!1}function Oo(r,e){if(typeof r=="object"&&r!==null){if(Gi(r))return e!==void 0&&an(!1),r[$t].atom;if(oi(r))return r[$t];if(Hr(r)){var t=r;if(e===void 0)return t._keysAtom;var n=t._data.get(e)||t._hasMap.get(e);return n||an(!1),n}if(aa(r),e&&!r[$t]&&r[e],Ai(r)){if(!e)return an(!1);var n=r[$t].values.get(e);return n||an(!1),n}if(ap(r)||ns(r)||gd(r))return r}else if(typeof r=="function"&&gd(r[$t]))return r[$t];return an(!1)}function hc(r,e){if(r||an("Expecting some object"),e!==void 0)return hc(Oo(r,e));if(ap(r)||ns(r)||gd(r)||Hr(r)||oi(r))return r;if(aa(r),r[$t])return r[$t];an(!1)}function QR(r,e){var t;return e!==void 0?t=Oo(r,e):Ai(r)||Hr(r)||oi(r)?t=hc(r):t=Oo(r),t.name}var em=Object.prototype.toString;function mw(r,e,t){return t===void 0&&(t=-1),rh(r,e,t)}function rh(r,e,t,n,i){if(r===e)return r!==0||1/r===1/e;if(r==null||e==null)return!1;if(r!==r)return e!==e;var o=typeof r;if(o!=="function"&&o!=="object"&&typeof e!="object")return!1;var s=em.call(r);if(s!==em.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+r==""+e;case"[object Number]":return+r!=+r?+e!=+e:+r==0?1/+r===1/e:+r==+e;case"[object Date]":case"[object Boolean]":return+r==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(r)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}r=tm(r),e=tm(e);var l=s==="[object Array]";if(!l){if(typeof r!="object"||typeof e!="object")return!1;var d=r.constructor,c=e.constructor;if(d!==c&&!(typeof d=="function"&&d instanceof d&&typeof c=="function"&&c instanceof c)&&"constructor"in r&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),n=n||[],i=i||[];for(var f=n.length;f--;)if(n[f]===r)return i[f]===e;if(n.push(r),i.push(e),l){if(f=r.length,f!==e.length)return!1;for(;f--;)if(!rh(r[f],e[f],t-1,n,i))return!1}else{var v=Object.keys(r),g=void 0;if(f=v.length,Object.keys(e).length!==f)return!1;for(;f--;)if(g=v[f],!(e3(e,g)&&rh(r[g],e[g],t-1,n,i)))return!1}return n.pop(),i.pop(),!0}function tm(r){return Gi(r)?r.slice():xs(r)||Hr(r)||Gl(r)||oi(r)?Array.from(r.entries()):r}function e3(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function md(r){return r[Symbol.iterator]=t3,r}function t3(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:SR,extras:{getDebugName:QR},$mobx:$t});function n3(r){return!(r.prototype&&r.prototype.render)&&!Gt.isPrototypeOf(r)}function yw(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,n=t===void 0?"":t,i=e.suffix,o=i===void 0?"":i,s=r.displayName||r.name||r.constructor&&r.constructor.name||"<component>";return n+s+o}var nm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_w=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},bw=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),xw=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},ww=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},rm=console;function r3(r){var e=eh().allowStateChanges;return eh().allowStateChanges=r,e}function i3(r){eh().allowStateChanges=r}function o3(r,e,t,n,i){var o=r3(r),s=void 0;try{s=e(t,n,i)}finally{i3(o)}return s}function im(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r[e],i=Sw[e],o=n?t===!0?function(){i.apply(this,arguments),n.apply(this,arguments)}:function(){n.apply(this,arguments),i.apply(this,arguments)}:i;r[e]=o}function om(r,e){if(r==null||e==null||(typeof r>"u"?"undefined":nm(r))!=="object"||(typeof e>"u"?"undefined":nm(e))!=="object")return r!==e;var t=Object.keys(r);if(t.length!==Object.keys(e).length)return!0;for(var n=void 0,i=t.length-1;n=t[i];i--)if(e[n]!==r[n])return!0;return!1}var Sw={componentWillMount:function(){var e=this,t=yw(this),n=!1,i=!1;function o(v){var g=this[v],y=sp("reactive "+v);Object.defineProperty(this,v,{configurable:!0,enumerable:!0,get:function(){return y.reportObserved(),g},set:function(x){!i&&om(g,x)?(g=x,n=!0,y.reportChanged(),n=!1):g=x}})}o.call(this,"props"),o.call(this,"state");var s=this.render.bind(this),l=null,d=!1,c=function(){return l=new Cl(t+".render()",function(){if(!d&&(d=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var g=!0;try{i=!0,n||Gt.prototype.forceUpdate.call(e),g=!1}finally{i=!1,g&&l.dispose()}}}),l.reactComponent=e,f.$mobx=l,e.render=f,f(e.props,e.state,e.context)},f=function(g,y,b){d=!1;var x=void 0,w=void 0;if(l.track(function(){try{w=o3(!1,s,g,y,b)}catch(_){x=_}}),x)throw x;return w};this.render=c},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:om(this.props,e)}};function pp(r){if(arguments.length>1&&rm.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),r.isMobxInjector===!0&&rm.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),n3(r)){var e,t;return pp((t=e=function(i){xw(o,i);function o(){return _w(this,o),ww(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return bw(o,[{key:"render",value:function(){return r.call(this,this.props,this.context)}}]),o}(Gt),e.displayName=yw(r),t))}if(!r)throw new Error("Please pass a valid component to 'observer'");var n=r.prototype||r;return a3(n),r.isMobXReactObserver=!0,r}function a3(r){im(r,"componentWillMount",!0),im(r,"componentDidMount"),r.shouldComponentUpdate||(r.shouldComponentUpdate=Sw.shouldComponentUpdate)}var s3=pp(function(r){var e=r.children;return e[0]()});s3.displayName="Observer";var l3=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u3(r,e){return e={exports:{}},r(e,e.exports),e.exports}u3(function(r,e){(function(t,n){r.exports=n()})(l3,function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,o=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,l=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,c=d&&d(Object);return function f(v,g,y){if(typeof g!="string"){if(c){var b=d(g);b&&b!==c&&f(v,b,y)}var x=o(g);s&&(x=x.concat(s(g)));for(var w=0;w<x.length;++w){var _=x[w];if(!t[_]&&!n[_]&&(!y||!y[_])){var C=l(g,_);try{i(v,_,C)}catch{}}}return v}return v}})});var am={children:!0,key:!0,ref:!0},sm=console;(function(r){xw(e,r);function e(){return _w(this,e),ww(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return bw(e,[{key:"render",value:function(n){var i=n.children;return i.length>1?xt("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var n={},i=this.context.mobxStores;if(i)for(var o in i)n[o]=i[o];for(var s in this.props)!am[s]&&s!=="suppressChangedStoreWarning"&&(n[s]=this.props[s]);return{mobxStores:n}}},{key:"componentWillReceiveProps",value:function(n){if(Object.keys(n).length!==Object.keys(this.props).length&&sm.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!n.suppressChangedStoreWarning)for(var i in n)!am[i]&&this.props[i]!==n[i]&&sm.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Gt);if(!Gt)throw new Error("mobx-preact requires Preact to be available");var ji,_f,lm,Ew=[],rr=Vt,um=rr.__b,dm=rr.__r,cm=rr.diffed,fm=rr.__c,hm=rr.unmount,pm=rr.__;function d3(){for(var r;r=Ew.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(rd),r.__H.__h.forEach(ih),r.__H.__h=[]}catch(e){r.__H.__h=[],rr.__e(e,r.__v)}}rr.__b=function(r){ji=null,um&&um(r)},rr.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),pm&&pm(r,e)},rr.__r=function(r){dm&&dm(r);var e=(ji=r.__c).__H;e&&(_f===ji?(e.__h=[],ji.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(rd),e.__h.forEach(ih),e.__h=[])),_f=ji},rr.diffed=function(r){cm&&cm(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(Ew.push(e)!==1&&lm===rr.requestAnimationFrame||((lm=rr.requestAnimationFrame)||c3)(d3)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),_f=ji=null},rr.__c=function(r,e){e.some(function(t){try{t.__h.forEach(rd),t.__h=t.__h.filter(function(n){return!n.__||ih(n)})}catch(n){e.some(function(i){i.__h&&(i.__h=[])}),e=[],rr.__e(n,t.__v)}}),fm&&fm(r,e)},rr.unmount=function(r){hm&&hm(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{rd(n)}catch(i){e=i}}),t.__H=void 0,e&&rr.__e(e,t.__v))};var vm=typeof requestAnimationFrame=="function";function c3(r){var e,t=function(){clearTimeout(n),vm&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,35);vm&&(e=requestAnimationFrame(t))}function rd(r){var e=ji,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),ji=e}function ih(r){var e=ji;r.__c=r.__(),ji=e}function f3(r,e){for(var t in e)r[t]=e[t];return r}function gm(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function mm(r,e){this.props=r,this.context=e}(mm.prototype=new Gt).isPureReactComponent=!0,mm.prototype.shouldComponentUpdate=function(r,e){return gm(this.props,r)||gm(this.state,e)};var ym=Vt.__b;Vt.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),ym&&ym(r)};var h3=Vt.__e;Vt.__e=function(r,e,t,n){if(r.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(r,e)}h3(r,e,t,n)};var _m=Vt.unmount;function Cw(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=f3({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return Cw(n,e,t)})),r}function Ow(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return Ow(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function bf(){this.__u=0,this.o=null,this.__b=null}function kw(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function Pu(){this.i=null,this.l=null}Vt.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),_m&&_m(r)},(bf.prototype=new Gt).__c=function(r,e){var t=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(t);var i=kw(n.__v),o=!1,s=function(){o||(o=!0,t.__R=null,i?i(l):l())};t.__R=s;var l=function(){if(!--n.__u){if(n.state.__a){var d=n.state.__a;n.__v.__k[0]=Ow(d,d.__c.__P,d.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(s,s)},bf.prototype.componentWillUnmount=function(){this.o=[]},bf.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Cw(this.__b,t,n.__O=n.__P)}this.__b=null}var i=e.__a&&xt(Ja,null,r.fallback);return i&&(i.__u&=-33),[xt(Ja,null,e.__a?null:r.children),i]};var bm=function(r,e,t){if(++t[1]===t[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(t=r.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.i=t=t[2]}};(Pu.prototype=new Gt).__a=function(r){var e=this,t=kw(e.__v),n=e.l.get(r);return n[0]++,function(i){var o=function(){e.props.revealOrder?(n.push(i),bm(e,r,n)):i()};t?t(o):o()}},Pu.prototype.render=function(r){this.i=null,this.l=new Map;var e=ud(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return r.children},Pu.prototype.componentDidUpdate=Pu.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,t){bm(r,t,e)})};var p3=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,v3=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,g3=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,m3=/[A-Z0-9]/g,y3=typeof document<"u",_3=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function xm(r,e,t){return e.__k==null&&(e.textContent=""),UP(r,e),typeof t=="function"&&t(),r?r.__c:null}Gt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Gt.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var wm=Vt.event;function b3(){}function x3(){return this.cancelBubble}function w3(){return this.defaultPrevented}Vt.event=function(r){return wm&&(r=wm(r)),r.persist=b3,r.isPropagationStopped=x3,r.isDefaultPrevented=w3,r.nativeEvent=r};var S3={enumerable:!1,configurable:!0,get:function(){return this.class}},Sm=Vt.vnode;Vt.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,i={},o=n.indexOf("-")===-1;for(var s in t){var l=t[s];if(!(s==="value"&&"defaultValue"in t&&l==null||y3&&s==="children"&&n==="noscript"||s==="class"||s==="className")){var d=s.toLowerCase();s==="defaultValue"&&"value"in t&&t.value==null?s="value":s==="download"&&l===!0?l="":d==="translate"&&l==="no"?l=!1:d[0]==="o"&&d[1]==="n"?d==="ondoubleclick"?s="ondblclick":d!=="onchange"||n!=="input"&&n!=="textarea"||_3(t.type)?d==="onfocus"?s="onfocusin":d==="onblur"?s="onfocusout":g3.test(s)&&(s=d):d=s="oninput":o&&v3.test(s)?s=s.replace(m3,"-$&").toLowerCase():l===null&&(l=void 0),d==="oninput"&&i[s=d]&&(s="oninputCapture"),i[s]=l}}n=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=ud(t.children).forEach(function(c){c.props.selected=i.value.indexOf(c.props.value)!=-1})),n=="select"&&i.defaultValue!=null&&(i.value=ud(t.children).forEach(function(c){c.props.selected=i.multiple?i.defaultValue.indexOf(c.props.value)!=-1:i.defaultValue==c.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",S3)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i}(r),r.$$typeof=p3,Sm&&Sm(r)};var Em=Vt.__r;Vt.__r=function(r){Em&&Em(r),r.__c};var Cm=Vt.diffed;Vt.diffed=function(r){Cm&&Cm(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var E3=0;function Ne(r,e,t,n,i,o){e||(e={});var s,l,d=e;if("ref"in d)for(l in d={},e)l=="ref"?s=e[l]:d[l]=e[l];var c={type:r,props:d,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--E3,__i:-1,__u:0,__source:i,__self:o};if(typeof r=="function"&&(s=r.defaultProps))for(l in s)d[l]===void 0&&(d[l]=s[l]);return Vt.vnode&&Vt.vnode(c),c}var C3=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Ol;(function(r){function e(t){var n=C3(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return on({},r.defaults,n)}r.get=e})(Ol||(Ol={}));(function(r){r.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Ol||(Ol={}));var Om={node:!1,edge:!1},O3={node:!0,edge:!0},k3=function(r){return!r||typeof r=="boolean"?r===!0?Ht(O3):Ht(Om):Ya(Ht(Om),r)},M3=function(){return Wl(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function cr(r){try{return JSON.parse(JSON.stringify(r))}catch{return r}}var Ru=200,N3=9999,A3=10,en;(function(r){r[r.DEFAULT=1]="DEFAULT",r[r.TEXT_EDIT=2]="TEXT_EDIT",r[r.SHOW_MENU=3]="SHOW_MENU",r[r.ALLOW_CONNECT=4]="ALLOW_CONNECT",r[r.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(en||(en={}));var xn;(function(r){r.NODE="node",r.EDGE="edge",r.GRAPH="graph"})(xn||(xn={}));var Wt;(function(r){r.NODE="node",r.CIRCLE_NODE="circle-node",r.POLYGON_NODE="polygon-node",r.RECT_NODE="rect-node",r.TEXT_NODE="text-node",r.ELLIPSE_NODE="ellipse-node",r.DIAMOND_NODE="diamond-node",r.HTML_NODE="html-node",r.CUSTOM_HTML_NODE="custom-html-node",r.EDGE="edge",r.LINE_EDGE="line-edge",r.POLYLINE_EDGE="polyline-edge",r.BEZIER_EDGE="bezier-edge",r.GRAPH="graph"})(Wt||(Wt={}));var Ct;(function(r){r.ELEMENT_CLICK="element:click",r.NODE_ADD="node:add",r.NODE_DELETE="node:delete",r.NODE_CLICK="node:click",r.NODE_DBCLICK="node:dbclick",r.NODE_GROUP_COPY="node:group-copy-add",r.NODE_DND_ADD="node:dnd-add",r.NODE_DND_DRAG="node:dnd-drag",r.NODE_MOUSEDOWN="node:mousedown",r.NODE_DRAGSTART="node:dragstart",r.NODE_DRAG="node:drag",r.NODE_DROP="node:drop",r.NODE_MOUSEUP="node:mouseup",r.NODE_MOUSEMOVE="node:mousemove",r.NODE_MOUSEENTER="node:mouseenter",r.NODE_MOUSELEAVE="node:mouseleave",r.NODE_CONTEXTMENU="node:contextmenu",r.NODE_ROTATE="node:rotate",r.NODE_RESIZE="node:resize",r.NODE_FOCUS="node:focus",r.NODE_BLUR="node:blur",r.NODE_PROPERTIES_CHANGE="node:properties-change",r.NODE_PROPERTIES_DELETE="node:properties-delete",r.EDGE_ADD="edge:add",r.EDGE_DELETE="edge:delete",r.EDGE_CLICK="edge:click",r.EDGE_DBCLICK="edge:dbclick",r.EDGE_FOCUS="edge:focus",r.EDGE_BLUR="edge:blur",r.EDGE_MOUSEENTER="edge:mouseenter",r.EDGE_MOUSELEAVE="edge:mouseleave",r.EDGE_CONTEXTMENU="edge:contextmenu",r.EDGE_ADJUST="edge:adjust",r.EDGE_EXCHANGE_NODE="edge:exchange-node",r.ANCHOR_CLICK="anchor:click",r.ANCHOR_MOUSEDOWN="anchor:mousedown",r.ANCHOR_DRAGSTART="anchor:dragstart",r.ANCHOR_DRAG="anchor:drag",r.ANCHOR_DROP="anchor:drop",r.ANCHOR_DRAGEND="anchor:dragend",r.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",r.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",r.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",r.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",r.ADJUST_POINT_DRAG="adjustPoint:drag",r.ADJUST_POINT_DROP="adjustPoint:drop",r.ADJUST_POINT_DRAGEND="adjustPoint:dragend",r.BLANK_MOUSEDOWN="blank:mousedown",r.BLANK_DRAGSTART="blank:dragstart",r.BLANK_DRAG="blank:drag",r.BLANK_DROP="blank:drop",r.BLANK_MOUSEMOVE="blank:mousemove",r.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",r.BLANK_MOUSEUP="blank:mouseup",r.BLANK_CLICK="blank:click",r.BLANK_CONTEXTMENU="blank:contextmenu",r.SELECTION_MOUSEDOWN="selection:mousedown",r.SELECTION_DRAGSTART="selection:dragstart",r.SELECTION_DRAG="selection:drag",r.SELECTION_DROP="selection:drop",r.SELECTION_MOUSEMOVE="selection:mousemove",r.SELECTION_MOUSEUP="selection:mouseup",r.SELECTION_CONTEXTMENU="selection:contextmenu",r.CONNECTION_NOT_ALLOWED="connection:not-allowed",r.TEXT_MOUSEDOWN="text:mousedown",r.TEXT_DRAGSTART="text:dragstart",r.TEXT_DRAG="text:drag",r.TEXT_DROP="text:drop",r.TEXT_CLICK="text:click",r.TEXT_DBCLICK="text:dbclick",r.TEXT_BLUR="text:blur",r.TEXT_MOUSEMOVE="text:mousemove",r.TEXT_MOUSEUP="text:mouseup",r.TEXT_FOCUS="text:focus",r.TEXT_ADD="text:add",r.TEXT_UPDATE="text:update",r.TEXT_CLEAR="text:clear",r.LABEL_MOUSEDOWN="label:mousedown",r.LABEL_DRAGSTART="label:dragstart",r.LABEL_DRAG="label:drag",r.LABEL_DROP="label:drop",r.LABEL_CLICK="label:click",r.LABEL_DBCLICK="label:dbclick",r.LABEL_BLUR="label:blur",r.LABEL_MOUSEMOVE="label:mousemove",r.LABEL_MOUSEUP="label:mouseup",r.LABEL_FOCUS="label:focus",r.LABEL_ADD="label:add",r.LABEL_UPDATE="label:update",r.LABEL_CLEAR="label:clear",r.LABEL_DELETE="label:delete",r.LABEL_SHOULD_ADD="label:should-add",r.LABEL_BATCH_ADD="label:batch-add",r.LABEL_SHOULD_UPDATE="label:should-update",r.LABEL_SHOULD_DELETE="label:should-delete",r.LABEL_BATCH_DELETE="label:batch-delete",r.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",r.HISTORY_CHANGE="history:change",r.GRAPH_TRANSFORM="graph:transform",r.GRAPH_RENDERED="graph:rendered",r.GRAPH_UPDATED="graph:updated",r.EDIT_CONFIG_CHANGED="editConfig:changed"})(Ct||(Ct={}));var _i;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.INCREASE=1]="INCREASE"})(_i||(_i={}));var vn;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(vn||(vn={}));var ii;(function(r){r.TEXT="text",r.LABEL="label"})(ii||(ii={}));var T3=0,ai=function(){function r(e){var t=e.onDragStart,n=t===void 0?pf:t,i=e.onDragging,o=i===void 0?pf:i,s=e.onDragEnd,l=s===void 0?pf:s,d=e.eventType,c=d===void 0?"":d,f=e.eventCenter,v=e.step,g=v===void 0?1:v,y=e.isStopPropagation,b=y===void 0?!0:y,x=e.model,w=e.data,_=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(C){var k,D,R=window==null?void 0:window.document;if(C.button===T3){_.isStopPropagation&&C.stopPropagation(),_.isStartDragging=!0,_.startX=C.clientX,_.startY=C.clientY,R.addEventListener("mousemove",_.handleMouseMove,!1),R.addEventListener("mouseup",_.handleMouseUp,!1);var $=(k=_.model)===null||k===void 0?void 0:k.getData();(D=_.eventCenter)===null||D===void 0||D.emit(Ct["".concat(_.eventType,"_MOUSEDOWN")],{e:C,data:_.data||$}),_.startTime=new Date().getTime()}},this.handleMouseMove=function(C){var k,D;if(_.isStopPropagation&&C.stopPropagation(),!!_.isStartDragging&&(_.sumDeltaX+=C.clientX-_.startX,_.sumDeltaY+=C.clientY-_.startY,_.startX=C.clientX,_.startY=C.clientY,_.step<=1||Math.abs(_.sumDeltaX)>_.step||Math.abs(_.sumDeltaY)>_.step)){var R=_.sumDeltaX%_.step,$=_.sumDeltaY%_.step,P=_.sumDeltaX-R,I=_.sumDeltaY-$;_.sumDeltaX=R,_.sumDeltaY=$;var W=(k=_.model)===null||k===void 0?void 0:k.getData();_.isDragging||((D=_.eventCenter)===null||D===void 0||D.emit(Ct["".concat(_.eventType,"_DRAGSTART")],{e:C,data:_.data||W}),_.onDragStart({event:C})),_.isDragging=!0,Promise.resolve().then(function(){var se,q;_.onDragging({deltaX:P,deltaY:I,event:C}),(se=_.eventCenter)===null||se===void 0||se.emit(Ct["".concat(_.eventType,"_MOUSEMOVE")],{deltaX:P,deltaY:I,e:C,data:_.data||W}),(q=_.eventCenter)===null||q===void 0||q.emit(Ct["".concat(_.eventType,"_DRAG")],{e:C,data:_.data||W})})}},this.handleMouseUp=function(C){var k=window.document;_.isStartDragging=!1,_.isStopPropagation&&C.stopPropagation(),Promise.resolve().then(function(){var D,R,$;k.removeEventListener("mousemove",_.handleMouseMove,!1),k.removeEventListener("mouseup",_.handleMouseUp,!1);var P=(D=_.model)===null||D===void 0?void 0:D.getData();(R=_.eventCenter)===null||R===void 0||R.emit(Ct["".concat(_.eventType,"_MOUSEUP")],{e:C,data:_.data||P}),_.isDragging&&(_.isDragging=!1,_.onDragEnd({event:C}),($=_.eventCenter)===null||$===void 0||$.emit(Ct["".concat(_.eventType,"_DROP")],{e:C,data:_.data||P}))})},this.cancelDrag=function(){var C=window==null?void 0:window.document;C.removeEventListener("mousemove",_.handleMouseMove,!1),C.removeEventListener("mouseup",_.handleMouseUp,!1),_.onDragEnd({event:void 0}),_.isDragging=!1},this.destroy=function(){_.isStartDragging&&_.cancelDrag()},this.onDragStart=n,this.onDragging=o,this.onDragEnd=l,this.step=g,this.isStopPropagation=b,this.eventType=c,this.eventCenter=f,this.model=x,this.data=w}return r.prototype.setStep=function(e){this.step=e},r.prototype.setModel=function(e){this.model=e},r}(),D3=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{x:e-n/2,y:t-i/2,x1:e+n/2,y1:t+i/2}},L3=function(r){var e=r.startPoint,t=r.endPoint,n=(e.x+t.x)/2,i=(e.y+t.y)/2,o=Math.abs(e.x-t.x)+10,s=Math.abs(e.y-t.y)+10;return{x:n-o/2,y:i-s/2,x1:n+o/2,y1:i+s/2}},P3=function(r){var e=r.points,t=sa(e),n=Nl(t,8),i=n.x,o=n.y,s=n.width,l=n.height;return{x:i-s/2,y:o-l/2,x1:i+s/2,y1:o+l/2}},R3=function(r){var e=r.path,t=vp(e),n=Nl(t,8),i=n.x,o=n.y,s=n.width,l=n.height;return{x:i-s/2,y:o-l/2,x1:i+s/2,y1:o+l/2}},I3=function(r){if(r.modelType===Wt.LINE_EDGE)return L3(r);if(r.modelType===Wt.POLYLINE_EDGE)return P3(r);if(r.modelType===Wt.BEZIER_EDGE)return R3(r)},B3=function(r,e,t,n){var i=(e.y-r.y)*(n.x-t.x)-(r.x-e.x)*(t.y-n.y);if(i===0)return!1;var o=((e.x-r.x)*(n.x-t.x)*(t.y-r.y)+(e.y-r.y)*(n.x-t.x)*r.x-(n.y-t.y)*(e.x-r.x)*t.x)/i,s=-((e.y-r.y)*(n.y-t.y)*(t.x-r.x)+(e.x-r.x)*(n.y-t.y)*r.y-(n.x-t.x)*(e.y-r.y)*t.y)/i;return(o-r.x)*(o-e.x)<=0&&(s-r.y)*(s-e.y)<=0&&(o-t.x)*(o-n.x)<=0&&(s-t.y)*(s-n.y)<=0?{x:o,y:s}:!1},kl=function(r,e,t){var n=r.x,i=r.y,o=e.x,s=e.y,l=t.x,d=t.y,c=(d-s)/(l-o),f=s-c*o;return(n>=o&&n<=l||n<=o&&n>=l)&&(i>=s&&i<=d||i<=s&&i>=d)&&Math.abs(i-c*n-f)<Number.EPSILON},Ml=function(r){var e=r.start,t=r.end,n=r.offset,i=r.verticalLength,o=r.type,s={leftX:0,leftY:0,rightX:0,rightY:0},l=Math.atan((t.y-e.y)/(t.x-e.x)),d=Math.atan(n/i),c=Math.sqrt(i*i+n*n);return o==="start"?t.x>=e.x?(s.leftX=e.x+c*Math.sin(l+d),s.leftY=e.y-c*Math.cos(l+d),s.rightX=e.x-c*Math.sin(l-d),s.rightY=e.y+c*Math.cos(l-d)):(s.leftX=e.x-c*Math.sin(l+d),s.leftY=e.y+c*Math.cos(l+d),s.rightX=e.x+c*Math.sin(l-d),s.rightY=e.y-c*Math.cos(l-d)):o==="end"&&(t.x>=e.x?(s.leftX=t.x+c*Math.sin(l-d),s.leftY=t.y-c*Math.cos(l-d),s.rightX=t.x-c*Math.sin(l+d),s.rightY=t.y+c*Math.cos(l+d)):(s.leftX=t.x-c*Math.sin(l-d),s.leftY=t.y+c*Math.cos(l-d),s.rightX=t.x+c*Math.sin(l+d),s.rightY=t.y-c*Math.cos(l+d))),s},Wa=function(){return Wa=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wa.apply(this,arguments)},ti=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},So=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},j3=function(r,e){return Math.abs(r.centerX-e.centerX)*2<r.width+e.width&&Math.abs(r.centerY-e.centerY)*2<r.height+e.height},oh=function(r){var e=[],t={};return r.forEach(function(n){var i="".concat(n.x,"-").concat(n.y);n.id=i,t[i]=n}),Object.keys(t).forEach(function(n){e.push(t[n])}),e},yd=function(r,e){return r.width===0&&r.height===0?r:{x:r.x,y:r.y,centerX:r.centerX,centerY:r.centerY,minX:r.minX-e,minY:r.minY-e,maxX:r.maxX+e,maxY:r.maxY+e,height:r.height+2*e,width:r.width+2*e}},H3=function(r,e){var t=Math.abs(r.x-e.centerX),n=Math.abs(r.y-e.centerY);return t/e.width>n/e.height?vn.HORIZONTAL:vn.VERTICAL},_d=function(r,e,t){var n=H3(t,e);return n===vn.HORIZONTAL?{x:t.x>r.centerX?r.maxX:r.minX,y:t.y}:{x:t.x,y:t.y>r.centerY?r.maxY:r.minY}},km=function(r,e){var t=Math.min(r.minX,e.minX),n=Math.min(r.minY,e.minY),i=Math.max(r.maxX,e.maxX),o=Math.max(r.maxY,e.maxY);return{x:(t+i)/2,y:(n+o)/2,centerX:(t+i)/2,centerY:(n+o)/2,minX:t,minY:n,maxX:i,maxY:o,height:o-n,width:i-t}},Nl=function(r,e){r===void 0&&(r=[]);var t=[],n=[];r.forEach(function(f){t.push(f.x),n.push(f.y)});var i=Math.min.apply(Math,So([],ti(t),!1)),o=Math.max.apply(Math,So([],ti(t),!1)),s=Math.min.apply(Math,So([],ti(n),!1)),l=Math.max.apply(Math,So([],ti(n),!1)),d=o-i,c=l-s;return e&&(d+=e,c+=e),{centerX:(i+o)/2,centerY:(s+l)/2,maxX:o,maxY:l,minX:i,minY:s,x:(i+o)/2,y:(s+l)/2,height:c,width:d}},bd=function(r){var e=r.minX,t=r.minY,n=r.maxX,i=r.maxY;return[{x:e,y:t},{x:n,y:t},{x:n,y:i},{x:e,y:i}]},Iu=function(r,e){var t=r.x,n=r.y;return t<e.minX||t>e.maxX||n<e.minY||n>e.maxY},$3=function(r,e){return e<r.minX||e>r.maxX?[]:[{x:e,y:r.minY},{x:e,y:r.maxY}]},F3=function(r,e){return e<r.minY||e>r.maxY?[]:[{x:r.minX,y:e},{x:r.maxX,y:e}]},z3=function(r,e){return So(So([],ti($3(r,e.x)),!1),ti(F3(r,e.y)),!1)},ah=function(r,e){return Math.abs(r.x-e.x)+Math.abs(r.y-e.y)},W3=function(r,e){var t=-2,n=0;return e.forEach(function(i){i&&(r.x===i.x&&(n+=t),r.y===i.y&&(n+=t))}),n},Mm=function(r,e,t,n,i){return ah(r,e)+ah(r,t)+W3(r,[e,t,n,i])},Mw=function(r,e,t,n,i){i||(i=0),r.unshift(e[n]),t[n]&&t[n]!==n&&i<=100&&Mw(r,e,t,t[n],i+1)},U3=function(r,e){var t=r.indexOf(e);t>-1&&r.splice(t,1)},ol=function(r,e,t,n){var i=e.x-r.x,o=e.y-r.y,s=n.x-t.x,l=n.y-t.y,d=(-o*(r.x-t.x)+i*(r.y-t.y))/(-s*o+i*l),c=(s*(r.y-t.y)-l*(r.x-t.x))/(-s*o+i*l);return d>=0&&d<=1&&c>=0&&c<=1},Nm=function(r,e,t){if(t.width===0&&t.height===0)return!1;var n=ti(bd(t),4),i=n[0],o=n[1],s=n[2],l=n[3];return ol(r,e,i,o)||ol(r,e,i,l)||ol(r,e,o,s)||ol(r,e,s,l)},V3=function(r,e,t,n){var i=[];return r.forEach(function(o){o!==e&&(o.x===e.x||o.y===e.y)&&!Nm(o,e,t)&&!Nm(o,e,n)&&i.push(o)}),oh(i)},X3=function(r,e,t,n,i,o,s){var l=[],d=[e],c={},f={},v={};e.id&&(f[e.id]=0,v[e.id]=Mm(e,t,e));var g={};r.forEach(function(x){x.id&&(g[x.id]=x)});for(var y=function(){var x,w=1/0;if(d.forEach(function(C){C.id&&v[C.id]<w&&(w=v[C.id],x=C)}),x===t&&t.id){var _=[];return Mw(_,g,c,t.id),{value:_}}if(!x)return{value:[e,t]};U3(d,x),l.push(x),V3(r,x,n,i).forEach(function(C){if(l.indexOf(C)===-1&&(d.indexOf(C)===-1&&d.push(C),x!=null&&x.id&&(C!=null&&C.id))){var k=v[x.id]+ah(x,C);if(f[C.id]&&k>=f[C.id])return;c[C.id]=x.id,f[C.id]=k,v[C.id]=f[C.id]+Mm(C,t,e,o,s)}})};d.length;){var b=y();if(typeof b=="object")return b.value}return[e,t]},Am=function(r){return Vr(r)},Nw=function(r){for(var e=1;e<r.length-1;){var t=r[e-1],n=r[e],i=r[e+1];t.x===n.x&&n.x===i.x||t.y===n.y&&n.y===i.y?r.splice(e,1):e++}return r},Tm=function(r,e,t,n,i){var o=Am(t),s=Am(n),l=yd(o,i),d=yd(s,i),c=_d(l,o,r),f=_d(d,s,e);if(j3(l,d)){var v=Y3(r,e,c,f);return So(So([r,c],ti(v),!1),[f,e],!1)}var g=Nl([c,f]),y=km(l,g),b=km(d,g),x=[];x=x.concat(bd(y)),x=x.concat(bd(b));var w={x:(r.x+e.x)/2,y:(r.y+e.y)/2};[g,y,b].forEach(function(C){x=x.concat(z3(C,w).filter(function(k){return Iu(k,l)&&Iu(k,d)}))}),[{x:c.x,y:f.y},{x:f.x,y:c.y}].forEach(function(C){Iu(C,l)&&Iu(C,d)&&x.push(C)}),x.unshift(c),x.push(f),x=oh(x);var _=X3(x,c,f,o,s,r,e);return _.unshift(r),_.push(e),_.length>2&&(_=Nw(_)),oh(_)},G3=function(r){if(r.length===1){var e=ti(r,1),t=e[0];return[t,t]}else{for(var n=r[0],i=r[1],o=bi(n.x,n.y,i.x,i.y),s=1;s<r.length-1;s++){var l=r[s],d=r[s+1],c=bi(l.x,l.y,d.x,d.y);c>o&&(o=c,n=l,i=d)}return[n,i]}},Dm=function(r,e,t){var n=ro(r,t),i=ro(e,t);return n&&i},Lm=function(r,e,t){var n=ro(r,t),i=ro(e,t),o=n&&i,s=n||i;return!o&&s},Pm=function(r,e,t){for(var n=void 0,i=Vr(t),o=bd(i),s=0;s<o.length;s++){var l=ol(r,e,o[s],o[(s+1)%o.length]);l&&(n=[o[s],o[(s+1)%o.length]])}if(n)return B3(r,e,n[0],n[1])},xd=function(r,e){var t=void 0;return r.x===e.x?t=vn.VERTICAL:r.y===e.y&&(t=vn.HORIZONTAL),t},sa=function(r){var e=r.split(" "),t=[];return e&&e.forEach(function(n){var i=ti(n.split(","),2),o=i[0],s=i[1];t.push({x:Number(o),y:Number(s)})}),t},Y3=function(r,e,t,n){var i=[],o=xd(r,t),s=xd(e,n);if(o===s)r.y===t.y?(i.push({x:t.x,y:(t.y+n.y)/2}),i.push({x:n.x,y:(t.y+n.y)/2})):(i.push({x:(t.x+n.x)/2,y:t.y}),i.push({x:(t.x+n.x)/2,y:n.y}));else{var l={x:t.x,y:n.y},d=kl(l,r,t),c=kl(l,e,n);if(d||c)l={x:n.x,y:t.y};else{var f=Rm(l,r,t),v=Rm(l,e,n);f&&v&&(l={x:n.x,y:t.y})}i.push(l)}return i},Rm=function(r,e,t){return r.x===e.x&&r.x===t.x||r.y===e.y&&r.y===t.y},Aw=function(r){if(!r)return 0;for(var e=0,t=0;t<r.length;t++){var n=r.charCodeAt(t);r.match(/[A-Z]/)?e+=1.5:n>=1&&n<=126||n>=65376&&n<=65439?e+=1:e+=2}return e},K3=function(r){var e=r.start,t=r.end,n;if(e.x===t.x&&e.y===t.y)n="";else{var i={start:e,end:t,offset:10,verticalLength:5},o=Ml(Wa(Wa({},i),{type:"start"})),s=Ml(Wa(Wa({},i),{type:"end"}));n="M".concat(o.leftX," ").concat(o.leftY,`
    L`).concat(o.rightX," ").concat(o.rightY,`
    L`).concat(s.rightX," ").concat(s.rightY,`
    L`).concat(s.leftX," ").concat(s.leftY," z")}return{d:n,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},Im=function(r){var e=r.start,t=r.end,n=r.sourceNode,i=r.targetNode,o=r.offset,s=Vr(n),l=Vr(i),d=yd(s,o),c=yd(l,o),f=_d(d,s,e),v=_d(c,l,t);return{sNext:f,ePre:v}},vp=function(r){var e=r.replace(/M/g,"").replace(/C/g,",").split(","),t=Bu(e[0]),n=Bu(e[1]),i=Bu(e[2]),o=Bu(e[3]);return[t,n,i,o]},Bu=function(r){var e=ti(r.replace(/(^\s*)/g,"").split(" "),2),t=e[0],n=e[1];return{x:+t,y:+n}},Bm=function(r,e){var t=ti(r,4),n=t[0],i=t[1],o=t[2],s=t[3],l=HI(n,i,o,s,e);return[l,r[3]]},Tw=function(r,e){for(var t=r.x,n=r.y,i=sa(e),o=Number.MAX_SAFE_INTEGER,s,l=[],d=0;d<i.length;d++)l.push({start:i[d],end:i[(d+1)%i.length]});if(l.forEach(function(g){var y=g.start,b=g.end;if(y.x===b.x){var x={x:y.x,y:n},w=kl(x,y,b);if(w){var _=Math.abs(y.x-t);_<o&&(o=_,s=x)}}else if(y.y===b.y){var x={x:t,y:y.y},w=kl(x,y,b);if(w){var _=Math.abs(y.y-n);_<o&&(o=_,s=x)}}}),!s){var c=l[0],f=c.start,v=c.end;s={x:f.x+(v.x-f.x)/2,y:f.y+(v.y-f.y)/2}}return s},q3=function(r){return $a(r,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},jm=function(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))};function J3(r,e){return typeof e!="function"?function(t,n,i){return Object.assign({type:r.edgeType},i)}:function(t,n,i){var o=e(t,n,i);return o?typeof o=="string"?Object.assign({},i,{type:o}):Object.assign({type:o},i):{type:r.edgeType}}}var Z3=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return un(e,function(o){var s=Aw(o);i=s>i?s:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},La=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},ju=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};function os(r,e,t){return t&&e*Math.round(r/e)||r}function Q3(r,e,t){if(!r)return[];var n=Math.min.apply(Math,ju([],La(r.map(function(x){return x[0]})),!1)),i=Math.max.apply(Math,ju([],La(r.map(function(x){return x[0]})),!1)),o=Math.min.apply(Math,ju([],La(r.map(function(x){return x[1]})),!1)),s=Math.max.apply(Math,ju([],La(r.map(function(x){return x[1]})),!1)),l=-n,d=-o,c=r.map(function(x){var w=La(x,2),_=w[0],C=w[1];return[_+l,C+d]}),f=i-n,v=s-o,g=e?e/f:1,y=t?t/v:1,b=Math.min(g,y);return c.map(function(x){var w=La(x,2),_=w[0],C=w[1];return[_*b,C*b]})}var xf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},wf=function(r,e,t){var n=xf(r,2),i=n[0],o=n[1],s=xf(e,2),l=s[0],d=s[1],c=xf(t,2),f=c[0],v=c[1];return i>l&&i<f&&o>d&&o<v},Dw=function(r,e){var t=e.multipleSelectKey,n=!1;switch(t){case"meta":n=r.metaKey;break;case"alt":n=r.altKey;break;case"shift":n=r.shiftKey;break;case"ctrl":n=r.ctrlKey;break;default:n=!1;break}return n},gp=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function Hm(r,e){return r instanceof ir&&e instanceof ir}var Lw=function(r){gp(e,r);function e(t,n,i){var o=r.call(this,3)||this;return o[0]=t,o[1]=n,o[2]=i,o.x=t,o.y=n,o.z=i,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.add=function(t){if(Hm(this,t))return new ir(this.x+t.x,this.y+t.y);var n=this.z+t.z;return new sh((this.x+t.x)/n,(this.y+t.y)/n)},e.prototype.subtract=function(t){if(Hm(this,t))return new ir(this.x-t.x,this.y-t.y);var n=this.z-t.z;return n===0?new ir(this.x-t.x,this.y-t.y):new sh((this.x-t.x)/n,(this.y-t.y)/n)},e}(Array),ir=function(r){gp(e,r);function e(t,n,i){var o=r.call(this,t,n,i??0)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var n=this;return t.reduce(function(i,o,s){return i+o*n[s]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var n=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return n>=0?i:-i},e}(Lw),sh=function(r){gp(e,r);function e(t,n){var i=r.call(this,t,n,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e}(Lw),pc=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Pa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Sf=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Jl=function(r){pc(e,r);function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=r.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(o,s){i[s]=o}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return Sf([],Pa(this.map(function(n){return n[t]})),!1)},e.prototype.transpose=function(){for(var t=[],n=0;n<this.columns;n++)t.push(this.getColumn(n));return new(e.bind.apply(e,Sf([void 0],Pa(t),!1)))},e.prototype.cross=function(t){var n=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var o=this.getRow(i),s=function(d){var c=t.getColumn(d);n[i][d]=o.reduce(function(f,v,g){return f+v*c[g]},0)},l=0;l<t.columns;l++)s(l);return new(e.bind.apply(e,Sf([void 0],Pa(n),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new sh(t[0],t[1])})},e.prototype.toString=function(){var t=Pa(this[0],2),n=t[0],i=t[1],o=Pa(this[1],2),s=o[0],l=o[1],d=Pa(this[2],2),c=d[0],f=d[1];return"matrix(".concat(n," ").concat(i," ").concat(s," ").concat(l," ").concat(c," ").concat(f,")")},e.prototype.translate=function(t,n){return this.cross(new wd(t,n))},e.prototype.rotate=function(t){return this.cross(new eI(t))},e.prototype.scale=function(t,n){return this.cross(new tI(t,n))},e}(Array),eI=function(r){pc(e,r);function e(t){var n=r.call(this,new ir(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new ir(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new ir(0,0,1))||this;return Object.setPrototypeOf(n,e.prototype),n}return e.prototype.inverse=function(){return this.transpose()},e}(Jl),tI=function(r){pc(e,r);function e(t,n){var i=r.call(this,new ir(t,0,0),new ir(0,n,0),new ir(0,0,1))||this;return i.sx=t,i.sy=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(Jl),wd=function(r){pc(e,r);function e(t,n){var i=r.call(this,new ir(1,0,0),new ir(0,1,0),new ir(t,n,1))||this;return i.tx=t,i.ty=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(Jl);DR({});var Sd=function(){return Sd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Sd.apply(this,arguments)},nI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},lh=function(r){var e=r.anchors;return e},Ed=function(r,e){for(var t=e.nodes,n,i=t.length-1;i>=0;i--){var o=t[i],s=oI(r,o);if(s){var l=o.getTargetAnchor(r);if(l){var d={node:o,anchorIndex:l.index,anchor:l.anchor};(!n||rI(o,n.node,e))&&(n=d)}}}return n},rI=function(r,e,t){return r.zIndex>e.zIndex?!0:t.nodesMap[r.id].index>t.nodesMap[e.id].index},iI=function(r,e){for(var t=lh(e),n,i=Number.MAX_SAFE_INTEGER,o=0;o<t.length;o++){var s=bi(r.x,r.y,t[o].x,t[o].y);s<i&&(i=s,n={index:o,anchor:Sd(Sd({},t[o]),{x:t[o].x,y:t[o].y,id:t[o].id})})}return n},bi=function(r,e,t,n){return Math.hypot(r-t,e-n)},ro=function(r,e,t){t===void 0&&(t=0);var n=!1,i=Vr(e),o=nI(new Jl([r.x,r.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),s=o[0],l=o[1],d={x:s,y:l};return d.x>=i.minX-t&&d.x<=i.maxX+t&&d.y>=i.minY-t&&d.y<=i.maxY+t&&(n=!0),n},oI=function(r,e){return ro(r,e,5)},Vr=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{minX:e-n/2,minY:t-i/2,maxX:e+n/2,maxY:t+i/2,x:e,y:t,width:n,height:i,centerX:e,centerY:t}},aI=function(r){var e=r,t=e.x,n=e.y,i=e.width,o=e.height,s=e.radius;return[{x:t-i/2+s,y:n-o/2+s,r:s},{x:t+i/2-s,y:n-o/2+s,r:s},{x:t-i/2+s,y:n+o/2-s,r:s},{x:t+i/2-s,y:n+o/2-s,r:s}]},$m=function(r,e,t){var n=aI(t),i,o=Number.MAX_SAFE_INTEGER;return n.forEach(function(s){var l=bi(r.x,r.y,s.x,s.y);l<o&&(o=l,i=s)}),uh(r,e,i)},uh=function(r,e,t){var n,i=t.x,o=t.y,s=t.r;if(e===vn.HORIZONTAL){var l=i-Math.sqrt(s*s-(r.y-o)*(r.y-o)),d=i+Math.sqrt(s*s-(r.y-o)*(r.y-o)),c=Math.abs(l-r.x)<Math.abs(d-r.x)?l:d;n={x:c,y:r.y}}else if(e===vn.VERTICAL){var f=o-Math.sqrt(s*s-(r.x-i)*(r.x-i)),v=o+Math.sqrt(s*s-(r.x-i)*(r.x-i)),g=Math.abs(f-r.y)<Math.abs(v-r.y)?f:v;n={x:r.x,y:g}}return n},Fm=function(r,e){var t=e,n=!1,i=t.x,o=t.y,s=t.width,l=t.height,d=t.radius,c={minX:i-s/2+d,maxX:i+s/2-d,minY:o-l/2+d,maxY:o+l/2-d};return r.y===o+l/2||r.y===o-l/2?n=r.x>c.minX&&r.x<c.maxX:(r.x===i+s/2||r.x===i-s/2)&&(n=r.y>c.minY&&r.y<c.maxY),n},zm=function(r,e,t){var n,i=t,o=i.x,s=i.y,l=i.rx,d=i.ry;if(e===vn.HORIZONTAL){var c=o-Math.sqrt(l*l-(r.y-s)*(r.y-s)*l*l/(d*d)),f=o+Math.sqrt(l*l-(r.y-s)*(r.y-s)*l*l/(d*d)),v=Math.abs(c-r.x)<Math.abs(f-r.x)?c:f;n={x:v,y:r.y}}else if(e===vn.VERTICAL){var g=s-Math.sqrt(d*d-(r.x-o)*(r.x-o)*d*d/(l*l)),y=s+Math.sqrt(d*d-(r.x-o)*(r.x-o)*d*d/(l*l)),b=Math.abs(g-r.y)<Math.abs(y-r.y)?g:y;n={x:r.x,y:b}}return n},Hu=function(r,e,t){for(var n=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,o,s=[],l=0;l<n.length;l++)s.push({start:n[l],end:n[(l+1)%n.length]});return s.forEach(function(d){var c=d.start,f=d.end,v=c,g=f;c.x>f.x&&(v=f,g=c);var y={x:r.x,y:r.y};if(v.x===g.x&&e===vn.HORIZONTAL&&(y={x:v.x,y:r.y}),v.y===g.y&&e===vn.VERTICAL&&(y={x:r.x,y:v.y}),v.x!==g.x&&v.y!==g.y){var b=(g.y-v.y)/(g.x-v.x),x=(v.x*g.y-g.x*v.y)/(v.x-g.x);e===vn.HORIZONTAL?y={x:(r.y-x)/b,y:r.y}:e===vn.VERTICAL&&(y={x:r.x,y:b*r.x+x})}var w=kl(y,c,f);if(w){var _=bi(y.x,y.y,r.x,r.y);_<i&&(i=_,o=y)}}),o},sI=function(r){var e=$a(r,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},Wm=function(r,e,t,n){var i=r.x,o=r.y;return e.x>r.x?i=r.x+t/2:e.x<r.x&&(i=r.x-t/2),e.y>r.y?o=r.y+n/2:e.y<r.y&&(o=r.y-n/2),{x:i,y:o}},Pw=function(r){var e=r.rows,t=r.style,n=r.rowsLength,i=r.className,o=document.createElement("div");o.className=i,o.style.fontSize="".concat(t.fontSize),o.style.width="".concat(t.width),o.style.lineHeight="".concat(t.lineHeight),o.style.padding="".concat(t.padding),t.fontFamily&&(o.style.fontFamily="".concat(t.fontFamily)),n>1?e.forEach(function(l){var d=document.createElement("div");d.textContent=l,o.appendChild(d)}):o.textContent=e[0],document.body.appendChild(o);var s=o.clientHeight;return document.body.removeChild(o),s},Um=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return e&&e.forEach(function(o){var s=Aw(o);i=s>i?s:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},Cd=function(r){return typeof r!="object"?{isAllPass:!!r,msg:r?"":"不允许连接"}:r};let $u;const lI=new Uint8Array(16);function uI(){if(!$u&&($u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $u(lI)}const nr=[];for(let r=0;r<256;++r)nr.push((r+256).toString(16).slice(1));function dI(r,e=0){return nr[r[e+0]]+nr[r[e+1]]+nr[r[e+2]]+nr[r[e+3]]+"-"+nr[r[e+4]]+nr[r[e+5]]+"-"+nr[r[e+6]]+nr[r[e+7]]+"-"+nr[r[e+8]]+nr[r[e+9]]+"-"+nr[r[e+10]]+nr[r[e+11]]+nr[r[e+12]]+nr[r[e+13]]+nr[r[e+14]]+nr[r[e+15]]}const cI=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vm={randomUUID:cI};function fI(r,e,t){if(Vm.randomUUID&&!r)return Vm.randomUUID();r=r||{};const n=r.random||(r.rng||uI)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,dI(n)}var Co=function(){return fI()},ul=new Map,Rw=function(r){var e=Co();function t(){r();var i=ul.get(e);if(i){var o=window.requestAnimationFrame(t);ul.set(e,o)}}var n=window.requestAnimationFrame(t);return ul.set(e,n),e},Od=function(r){var e=ul.get(r);e&&(window.cancelAnimationFrame(e),ul.delete(r))},Al=function(){return Al=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Al.apply(this,arguments)},hI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function Iw(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.value,s=r.fontSize,l=s===void 0?12:s,d=r.fill,c=d===void 0?"currentColor":d,f=r.overflowMode,v=f===void 0?"default":f,g=r.textWidth,y=g===void 0?void 0:g,b=r.model,x={x:t,y:i,fill:c,fontSize:l,textAnchor:"middle",dominantBaseline:"central"};if(un(ko(r),function(R){var $=hI(R,2),P=$[0],I=$[1];typeof I!="object"&&(x[P]=I)}),o){var w=String(o).split(/[\r\n]/g),_=w.length;if(v!=="default"){var C=b.BaseType,k=b.modelType;if(C===xn.NODE&&k!==Wt.TEXT_NODE||C===xn.EDGE&&y)return pI(r)}if(_>1){var D=w.map(function(R,$){var P=l+2,I=($-(_-1)/2)*P;return Ne("tspan",{className:"lf-text-tspan",x:t,y:i+I,children:R})});return Ne("text",Al({},x,{children:D}))}return Ne("text",Al({},x,{children:o}))}return null}function pI(r){var e=r.x,t=r.y,n=r.value,i=r.model,o=r.textWidth,s=r.fontSize,l=s===void 0?12:s,d=r.lineHeight,c=r.fontFamily,f=c===void 0?"":c,v=r.wrapPadding,g=v===void 0?"0, 0":v,y=r.overflowMode,b=i.width,x=i.height,w=i.textHeight,_=o||b,C=String(n).split(/[\r\n]/g),k=C.length,D=Pw({rows:C,style:{fontSize:"".concat(l,"px"),width:"".concat(_,"px"),fontFamily:f,lineHeight:d,padding:g},rowsLength:k,className:"lf-get-text-height"}),R=x>D?x:D;w&&(R=w);var $=y==="ellipsis";return $&&(R=l+2),Ne("g",{children:Ne("foreignObject",{width:_,height:R,x:e-_/2,y:t-R/2,style:{overflow:"visible",textAlign:"left"},children:Ne("div",{className:"lf-node-text-auto-wrap",style:{minHeight:R,width:_,padding:g},children:Ne("div",{className:$?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:$?C.join(""):"",style:Al({},r),children:C.map(function(P){return Ne("div",{className:"lf-node-text--auto-wrap-inner",children:P})})})})})})}var dh=function(){return dh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},dh.apply(this,arguments)},vI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function as(r){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return un(ko(r),function(t){var n=vI(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),Ne("line",dh({},e))}var ch=function(){return ch=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ch.apply(this,arguments)},gI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function ni(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=r.className,s=r.strokeWidth,l=r.radius,d=l===void 0?0:l,c=e-n/2,f=t-i/2,v={};return v["stroke-width"]=s,un(ko(r),function(g){var y=gI(g,2),b=y[0],x=y[1];typeof x!="object"&&(v[b]=x)}),o?v.className="lf-basic-shape ".concat(o):v.className="lf-basic-shape",d&&(v.rx=d,v.ry=d),v.x=c,v.y=f,Ne("rect",ch({},v))}var fh=function(){return fh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},fh.apply(this,arguments)},mI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function Tl(r){var e={d:""};return un(ko(r),function(t){var n=mI(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),Ne("path",fh({},e))}var hh=function(){return hh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hh.apply(this,arguments)},yI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function ss(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.r,s=o===void 0?4:o,l=r.className,d={cx:t,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return un(ko(r),function(c){var f=yI(c,2),v=f[0],g=f[1];typeof g!="object"&&(d[v]=g)}),l?d.className="lf-basic-shape ".concat(l):d.className="lf-basic-shape",Ne("circle",hh({},d))}var ph=function(){return ph=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ph.apply(this,arguments)},_I=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function bI(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.rx,s=o===void 0?4:o,l=r.ry,d=l===void 0?4:l,c=r.className,f={cx:t,cy:i,rx:s,ry:d,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return un(ko(r),function(v){var g=_I(v,2),y=g[0],b=g[1];typeof b!="object"&&(f[y]=b)}),c?f.className="lf-basic-shape ".concat(c):f.className="lf-basic-shape",Ne("ellipse",ph({},f))}var kd=function(){return kd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},kd.apply(this,arguments)},xI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function wI(r,e){var t=r.map(function(C){return{x:C[0],y:C[1]}}),n=t.length;if(n<3)return"";for(var i=Math.abs(e),o="",s=0;s<n;s++){var l=t[(s-1+n)%n],d=t[s],c=t[(s+1)%n],f={x:d.x-l.x,y:d.y-l.y},v={x:c.x-d.x,y:c.y-d.y},g=Math.hypot(f.x,f.y),y=Math.hypot(v.x,v.y),b={x:f.x/g,y:f.y/g},x={x:v.x/y,y:v.y/y},w={x:d.x-b.x*i,y:d.y-b.y*i},_={x:d.x+x.x*i,y:d.y+x.y*i};s===0?o+="M ".concat(w.x," ").concat(w.y," "):o+="L ".concat(w.x," ").concat(w.y," "),o+="Q ".concat(d.x," ").concat(d.y," ").concat(_.x," ").concat(_.y," ")}return o+="Z",o}function mp(r){var e=r.points,t=e===void 0?[]:e,n=r.className,i=r.radius,o={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(un(ko(r),function(l){var d=xI(l,2),c=d[0],f=d[1];typeof f!="object"&&(o[c]=f)}),n?o.classNmae="lf-basic-shape ".concat(n):o.className="lf-basic-shape",i){var s=wI(t,i);return o.d=s,Ne("path",kd({},o))}else return o.points=t.map(function(l){return l.join(",")}).join(" "),Ne("polygon",kd({},o))}var vh=function(){return vh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vh.apply(this,arguments)},SI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o};function EI(r){var e=r.className,t={points:"",fill:"none"};return un(ko(r),function(n){var i=SI(n,2),o=i[0],s=i[1];(o==="style"||typeof s!="object")&&(t[o]=s)}),e&&(t.className="".concat(e)),Ne("polyline",vh({},t))}var Bw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dl=function(){return Dl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dl.apply(this,arguments)},CI=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},OI=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},nn;(function(r){r[r.LEFT_TOP=0]="LEFT_TOP",r[r.RIGHT_TOP=1]="RIGHT_TOP",r[r.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",r[r.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(nn||(nn={}));var kI=function(r){Bw(e,r);function e(t){var n=r.call(this)||this;n.isShiftPressed=!1,n.bindKeyboardEvents=function(){document.addEventListener("keydown",n.handleKeyDown),document.addEventListener("keyup",n.handleKeyUp)},n.handleKeyDown=function(l){l.key==="Shift"&&(n.isShiftPressed=!0)},n.handleKeyUp=function(l){l.key==="Shift"&&(n.isShiftPressed=!1)},n.updateEdgePointByAnchors=function(){var l=n.nodeModel,d=l.id,c=l.anchors,f=n.graphModel.getNodeEdges(d);un(f,function(v){if(v.sourceNodeId===d){var g=oa(c,function(y){return y.id===v.sourceAnchorId});g&&v.updateStartPoint({x:g.x,y:g.y})}else if(v.targetNodeId===d){var g=oa(c,function(b){return b.id===v.targetAnchorId});g&&v.updateEndPoint({x:g.x,y:g.y})}})},n.triggerResizeEvent=function(l,d,c,f,v,g){n.graphModel.eventCenter.emit(Ct.NODE_RESIZE,{preData:l,data:d,deltaX:c,deltaY:f,index:v,model:g})},n.recalcResizeInfo=function(l,d,c,f,v){c===void 0&&(c=1),f===void 0&&(f=!1),v===void 0&&(v=!1);var g=Ht(d),y=g.deltaX,b=g.deltaY,x=g.width,w=g.height,_=g.PCTResizeInfo;if(_){var C=4,k=0,D=0;switch(l){case nn.LEFT_TOP:D=(y*-1-b)/C;break;case nn.RIGHT_TOP:D=(y-b)/C;break;case nn.RIGHT_BOTTOM:D=(y+b)/C;break;case nn.LEFT_BOTTOM:D=(y*-1+b)/C;break}D!==0&&(k=Math.round(D/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+k,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+k,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var R=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),$=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(l){case nn.LEFT_TOP:y=x-R,b=w-$;break;case nn.RIGHT_TOP:y=R-x,b=w-$;break;case nn.RIGHT_BOTTOM:y=R-x,b=$-w;break;case nn.LEFT_BOTTOM:y=x-R,b=$-w;break}return g}switch(l){case nn.LEFT_TOP:g.width=f?x:x-y*c,g.height=v?w:w-b*c;break;case nn.RIGHT_TOP:g.width=f?x:x+y*c,g.height=v?w:w-b*c;break;case nn.RIGHT_BOTTOM:g.width=f?x:x+y*c,g.height=v?w:w+b*c;break;case nn.LEFT_BOTTOM:g.width=f?x:x-y*c,g.height=v?w:w+b*c;break}return g},n.resizeNode=function(l){var d=l.deltaX,c=l.deltaY,f=n.index,v=n.props,g=v.model,y=v.graphModel,b=v.x,x=v.y;jw({x:b,y:x,deltaX:d,deltaY:c,index:f,nodeModel:g,graphModel:y,forceProportional:n.isShiftPressed,cancelCallback:function(){n.dragHandler.cancelDrag()}})},n.onDragStart=function(){n.graphModel.selectNodeById(n.nodeModel.id)},n.onDragging=function(l){var d=l.deltaX,c=l.deltaY,f=n.graphModel.transformModel,v=OI(f.fixDeltaXY(d,c),2),g=v[0],y=v[1];n.resizeNode({deltaX:g,deltaY:y})},n.onDragEnd=function(){var l=n.nodeModel.x,d=n.nodeModel.y;n.nodeModel.moveTo(l,d),n.updateEdgePointByAnchors()};var i=t.index,o=t.model,s=t.graphModel;return n.index=i,n.nodeModel=o,n.graphModel=s,n.dragHandler=new ai({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:s.gridSize}),n.bindKeyboardEvents(),n}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.direction,s=t.model,l=s.getResizeControlStyle(),d=l.width,c=l.height,f=CI(l,["width","height"]);return Ne("g",{className:"lf-resize-control lf-resize-control-".concat(o),children:[Ne(ni,Dl({className:"lf-resize-control-content",x:n,y:i,width:d??7,height:c??7},f)),Ne(ni,{className:"lf-resize-control-content",x:n,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(Gt),MI=function(r){Bw(e,r);function e(){return r.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=Vr(n),s=o.minX,l=o.minY,d=o.maxX,c=o.maxY,f=[{index:nn.LEFT_TOP,direction:"nw",x:s,y:l},{index:nn.RIGHT_TOP,direction:"ne",x:d,y:l},{index:nn.RIGHT_BOTTOM,direction:"se",x:d,y:c},{index:nn.LEFT_BOTTOM,direction:"sw",x:s,y:c}];return io(f,function(v){return Ne(kI,Dl({},v,{model:n,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getResizeOutlineStyle();return Ne(ni,Dl({},l,{x:n,y:i,width:o,height:s}))},e.prototype.render=function(){return Ne("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(Gt);function NI(r,e){var t=r.x,n=r.y,i=e.x,o=e.y,s={x:t+(i-t)/2,y:n+(o-n)/2};return s}function al(r,e,t){var n=AI(t),i=r.x-e.x,o=r.y-e.y,s=i*Math.cos(n)-o*Math.sin(n)+e.x,l=i*Math.sin(n)+o*Math.cos(n)+e.y;return{x:s,y:l}}function AI(r){return r*Math.PI/180}function TI(r){return r/Math.PI*180}function DI(r,e,t,n,i,o,s,l){i===void 0&&(i=!1),o===void 0&&(o=!1);var d={x:t.x-(r.x-t.x),y:t.y-(r.y-t.y)},c=NI(d,e),f=al(e,c,-n),v=al(d,c,-n);if(i){var g=Math.abs(f.x-v.x),y=g-s;c.x>f.x?c.x=c.x+y/2:c.x=c.x-y/2}if(o){var b=Math.abs(f.y-v.y),x=b-l;c.y>f.y?c.y=c.y+x/2:c.y=c.y-x/2}if(i||o){var w=al(v,c,n),_=w.x-d.x,C=w.y-d.y;c.x=c.x-_,c.y=c.y-C,v=al(d,c,-n),f={x:c.x-(v.x-c.x),y:c.y-(v.y-c.y)}}var k=Math.abs(f.x-v.x),D=Math.abs(f.y-v.y);return i&&(k=s),o&&(D=l),{width:k,height:D,center:c}}function LI(r,e,t,n,i,o,s,l,d){l===void 0&&(l=!1),d===void 0&&(d=!1);var c=e.deltaX,f=e.deltaY,v=e.width,g=e.height,y=TI(t),b={x:n,y:i},x={x:o,y:s},w=al(b,x,y),_={x:w.x+c,y:w.y+f},C=DI(w,_,x,y,l,d,v,g),k=C.width,D=C.height,R=C.center;return e.width=k*r,e.height=D*r,e.deltaX=(R.x-x.x)*2,e.deltaY=(R.y-x.y)*2,e}var PI=function(r,e,t,n,i,o,s,l,d,c,f){t===void 0&&(t=1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=0),f===void 0&&(f=!1);var v=Ht(e),g=v.deltaX,y=v.deltaY,b=v.width,x=v.height,w=v.PCTResizeInfo;if(w){var _=4,C=0,k=0;switch(r){case nn.LEFT_TOP:k=(g*-1-y)/_;break;case nn.RIGHT_TOP:k=(g-y)/_;break;case nn.RIGHT_BOTTOM:k=(g+y)/_;break;case nn.LEFT_BOTTOM:k=(g*-1+y)/_;break}k!==0&&(C=Math.round(k/w.ResizeBasis.basisHeight*1e5)/1e3),w.ResizePCT.widthPCT=Math.max(Math.min(w.ResizePCT.widthPCT+C,w.ScaleLimit.maxScaleLimit),w.ScaleLimit.minScaleLimit),w.ResizePCT.heightPCT=Math.max(Math.min(w.ResizePCT.heightPCT+C,w.ScaleLimit.maxScaleLimit),w.ScaleLimit.minScaleLimit);var D=Math.round(w.ResizePCT.widthPCT*w.ResizeBasis.basisWidth/100),R=Math.round(w.ResizePCT.heightPCT*w.ResizeBasis.basisHeight/100);switch(r){case nn.LEFT_TOP:g=b-D,y=x-R;break;case nn.RIGHT_TOP:g=D-b,y=x-R;break;case nn.RIGHT_BOTTOM:g=D-b,y=R-x;break;case nn.LEFT_BOTTOM:g=b-D,y=R-x;break}return v}if(o%(2*Math.PI)!==0&&s!==void 0&&l!==void 0)return LI(t,v,o,s,l,d,c,n,i);if(f){var $=b/x,P=0,I=b,W=x;switch(r){case nn.LEFT_TOP:P=Math.abs(g)>Math.abs(y)?-g:-y,$>=1?(I=b+P,W=I/$):(W=x+P,I=W*$),v.width=I,v.height=W,v.deltaX=b-I,v.deltaY=x-W;break;case nn.RIGHT_TOP:P=Math.abs(g)>Math.abs(y)?g:-y,$>=1?(I=b+P,W=I/$):(W=x-P,I=W*$),v.width=I,v.height=W,v.deltaX=I-b,v.deltaY=x-W;break;case nn.RIGHT_BOTTOM:P=Math.abs(g)>Math.abs(y)?g:y,$>=1?(I=b+P,W=I/$):(W=x+P,I=W*$),v.width=I,v.height=W,v.deltaX=I-b,v.deltaY=W-x;break;case nn.LEFT_BOTTOM:P=Math.abs(g)>Math.abs(y)?-g:y,$>=1?(I=b-P,W=I/$):(W=x+P,I=W*$),v.width=I,v.height=W,v.deltaX=b-I,v.deltaY=W-x;break}return v}switch(r){case nn.LEFT_TOP:v.width=n?b:b-g*t,v.height=i?x:x-y*t;break;case nn.RIGHT_TOP:v.width=n?b:b+g*t,v.height=i?x:x-y*t;break;case nn.RIGHT_BOTTOM:v.width=n?b:b+g*t,v.height=i?x:x+y*t;break;case nn.LEFT_BOTTOM:v.width=n?b:b-g*t,v.height=i?x:x+y*t;break}return v},RI=function(r,e){var t=r.id,n=r.anchors,i=e.getNodeEdges(t);un(i,function(o){if(o.sourceNodeId===t){var s=oa(n,function(l){return l.id===o.sourceAnchorId});s&&o.updateStartPoint({x:s.x,y:s.y})}else if(o.targetNodeId===t){var s=oa(n,function(d){return d.id===o.targetAnchorId});s&&o.updateEndPoint({x:s.x,y:s.y})}})},II=function(r,e,t,n,i,o,s){s.eventCenter.emit(Ct.NODE_RESIZE,{preData:r,data:e,deltaX:t,deltaY:n,index:i,model:o})},jw=function(r){var e=r.x,t=r.y,n=r.deltaX,i=r.deltaY,o=r.index,s=r.nodeModel,l=r.graphModel,d=r.cancelCallback,c=r.forceProportional,f=c===void 0?!1:c,v=s.r,g=s.rx,y=s.ry,b=s.width,x=s.height,w=s.PCTResizeInfo,_=s.minWidth,C=s.minHeight,k=s.maxWidth,D=s.maxHeight,R=s.rotate,$=s.x,P=s.y,I=_===k,W=C===D,se={width:v||g||b,height:v||y||x,deltaX:n,deltaY:i,PCTResizeInfo:w},q=v||g&&y?1/2:1,ee=e,T=t,z=PI(o,se,q,I,W,R,ee,T,$,P,f);if(z.width<_||z.width>k||z.height<C||z.height>D){d==null||d();return}(R%(2*Math.PI)==0||w||ee===void 0||T===void 0)&&(z.deltaX=I?0:z.deltaX,z.deltaY=W?0:z.deltaY);var B=s.getData(),pe=s.resize(z);B.x===pe.x&&B.y===pe.y||(RI(s,l),II(B,pe,n,i,o,s,l))},BI=100,jI={x:1,y:0};function HI(r,e,t,n,i){for(var o=function(y){if(y<0||y>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:r.x*Math.pow(1-y,3)+3*e.x*y*Math.pow(1-y,2)+3*t.x*Math.pow(y,2)*(1-y)+n.x*Math.pow(y,3),y:r.y*Math.pow(1-y,3)+3*e.y*y*Math.pow(1-y,2)+3*t.y*Math.pow(y,2)*(1-y)+n.y*Math.pow(y,3)}},s=0,l=2,d=n.x,c=n.y,f=n;s<i&&l<50;){f=o(1-l/BI);var v=f.x,g=f.y;s=bi(d,c,v,g),l++}return f}function $I(r,e){return r.x*e.y-r.y*e.x}function FI(r,e){var t=[r.x,r.y,r.z],n=[e.x,e.y,e.z];return n.reduce(function(i,o,s){return i+o*t[s]})}function zI(r,e){var t=$I(r,e),n=Math.acos(FI(Xm(r),Xm(e)));return t>=0?n:-n}function Xm(r){var e=Math.hypot(r.x,r.y);return{x:r.x/e,y:r.y/e,z:0}}function WI(r){return zI(jI,r)}function UI(r){return r*(180/Math.PI)}var Hw={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},VI={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},XI={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},GI={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Ll={colorful:GI,dark:XI,radius:VI,default:Hw},YI={background:"#23272e"},KI={background:"#fefeff"},gh={background:"#ffffff"},Pl={colorful:KI,dark:YI,radius:gh,default:gh},qI={color:"#66676a",thickness:1},JI={color:"#dadada",thickness:1},mh={color:"#acacac",thickness:1},Rl={colorful:JI,dark:qI,radius:mh,default:mh},$w=function(r,e){var t=Ht(Hw);return e&&(t=Ya(t,Ll[e])),r&&(t=Ya(t,r)),t},ZI=function(r,e){if(Ll[r]){console.warn("theme mode ".concat(r," already exists"));return}Ll[r]=e,Pl[r]=e.background||gh,Rl[r]=e.grid||mh},QI=function(r){delete Ll[r],delete Pl[r],delete Rl[r]},Gm=function(){var r={colorful:{},dark:{},radius:{},default:{}};on(Ll,r),on(Pl,r),on(Rl,r)},e8=$w,t8=1e3,n8=999,yp=function(){return++t8},r8=function(){return--n8},Dn=function(){return Dn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dn.apply(this,arguments)},Dt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},vc=function(){function r(e,t){var n;this.BaseType=xn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ii.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=en.DEFAULT,this.modelType=Wt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initEdgeData(e),this.setAttributes()}return r.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||Co()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var o=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=o,on(this,q3(e));var s=this.graphModel.overlapMode;s===_i.INCREASE&&(this.zIndex=e.zIndex||yp()),this.setAnchors(),this.initPoints(),this.formatText(e)},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.getEdgeStyle=function(){return Dn(Dn({},this.graphModel.theme.baseEdge),this.style)},r.prototype.getAdjustPointStyle=function(){return Dn({},this.graphModel.theme.edgeAdjust)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Ht(e)},r.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Ht(e)},r.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),n=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return Dn(Dn(Dn({},e),{fill:i,stroke:i}),n)},r.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Ht(t)},r.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(r.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),r.prototype.getBeginAnchor=function(e,t,n){var i,o,s=lh(e);if(n){if(i=oa(s,function(l){return l.id===n}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(n,"，已使用默认锚点作为起点"))}return s.forEach(function(l){var d=jm(l,t);(o===void 0||d<o)&&(o=d,i=l)}),i},r.prototype.getEndAnchor=function(e,t){var n=this,i,o,s=lh(e);if(t){if(i=oa(s,function(l){return l.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return s.forEach(function(l){if(n.startPoint){var d=jm(l,n.startPoint);(o===void 0||d<o)&&(o=d,i=l)}}),i},r.prototype.getProperties=function(){return gi(this.properties)},r.prototype.getData=function(){var e=this.properties;rs(e)&&(e=gi(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:on({},this.startPoint),endPoint:on({},this.endPoint)};this.graphModel.overlapMode===_i.INCREASE&&(t.zIndex=this.zIndex);var n=this.text,i=n.x,o=n.y,s=n.value;return s&&(t.text={x:i,y:o,value:s}),t},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.setProperty=function(e,t){cp(this.properties,e,cr(t)),this.setAttributes()},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setProperties=function(e){this.properties=Dn(Dn({},gi(this.properties)),cr(e)),this.setAttributes()},r.prototype.changeEdgeId=function(e){var t=this.arrowConfig,n=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),n&&n==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},r.prototype.setStyle=function(e,t){var n;this.style=Dn(Dn({},this.style),(n={},n[e]=cr(t),n))},r.prototype.setStyles=function(e){this.style=Dn(Dn({},this.style),cr(e))},r.prototype.updateStyles=function(e){this.style=Dn({},cr(e))},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,s=o.edgeTextDraggable,l=o.edgeTextEdit,d=this.textPosition,c=d.x,f=d.y,v=e.text,g={value:"",x:c,y:f,draggable:s,editable:l};v&&(typeof v=="string"?g=Dn(Dn({},g),{value:v}):(g=Dn(Dn({},g),{x:(t=v.x)!==null&&t!==void 0?t:c,y:(n=v.y)!==null&&n!==void 0?n:f,value:(i=v.value)!==null&&i!==void 0?i:""}),Ka(v.draggable)||(g.draggable=v.draggable),Ka(v.editable)||(g.editable=v.editable))),this.text=g},r.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,n=e.y;this.text.x=t,this.text.y=n},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,s=n.value,l=n.draggable,d=n.editable;this.text={value:s,editable:d,draggable:l,x:i+e,y:o+t}},r.prototype.setText=function(e){e&&on(this.text,e)},r.prototype.updateText=function(e){this.text=Dn(Dn({},gi(this.text)),{value:e})},r.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.openEdgeAnimation=function(){this.isAnimation=!0},r.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateStartPoint=function(e){this.startPoint=e},r.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},r.prototype.updateEndPoint=function(e){this.endPoint=e},r.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},r.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},r.prototype.initPoints=function(){},r.prototype.updateAttributes=function(e){on(this,e)},r.prototype.getAdjustStart=function(){return this.startPoint},r.prototype.getAdjustEnd=function(){return this.endPoint},r.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,n=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:n.x,y:n.y})},r.BaseType=xn.EDGE,Dt([Ae],r.prototype,"type",void 0),Dt([Ae],r.prototype,"sourceNodeId",void 0),Dt([Ae],r.prototype,"targetNodeId",void 0),Dt([Ae],r.prototype,"startPoint",void 0),Dt([Ae],r.prototype,"endPoint",void 0),Dt([Ae],r.prototype,"textMode",void 0),Dt([Ae],r.prototype,"text",void 0),Dt([Ae],r.prototype,"properties",void 0),Dt([Ae],r.prototype,"points",void 0),Dt([Ae],r.prototype,"pointsList",void 0),Dt([Ae],r.prototype,"isSelected",void 0),Dt([Ae],r.prototype,"isHovered",void 0),Dt([Ae],r.prototype,"isHitable",void 0),Dt([Ae],r.prototype,"isHittable",void 0),Dt([Ae],r.prototype,"draggable",void 0),Dt([Ae],r.prototype,"visible",void 0),Dt([Ae],r.prototype,"isAnimation",void 0),Dt([Ae],r.prototype,"isShowAdjustPoint",void 0),Dt([Ae],r.prototype,"zIndex",void 0),Dt([Ae],r.prototype,"state",void 0),Dt([Ae],r.prototype,"style",void 0),Dt([Ae],r.prototype,"arrowConfig",void 0),Dt([fn],r.prototype,"sourceNode",null),Dt([fn],r.prototype,"targetNode",null),Dt([fn],r.prototype,"textPosition",null),Dt([Me],r.prototype,"setProperty",null),Dt([Me],r.prototype,"deleteProperty",null),Dt([Me],r.prototype,"setProperties",null),Dt([Me],r.prototype,"changeEdgeId",null),Dt([Me],r.prototype,"setStyle",null),Dt([Me],r.prototype,"setStyles",null),Dt([Me],r.prototype,"updateStyles",null),Dt([Me],r.prototype,"setTextMode",null),Dt([Me],r.prototype,"formatText",null),Dt([Me],r.prototype,"resetTextPosition",null),Dt([Me],r.prototype,"moveText",null),Dt([Me],r.prototype,"setText",null),Dt([Me],r.prototype,"updateText",null),Dt([Me],r.prototype,"setAnchors",null),Dt([Me],r.prototype,"setSelected",null),Dt([Me],r.prototype,"setHovered",null),Dt([Me],r.prototype,"setHitable",null),Dt([Me],r.prototype,"setHittable",null),Dt([Me],r.prototype,"openEdgeAnimation",null),Dt([Me],r.prototype,"closeEdgeAnimation",null),Dt([Me],r.prototype,"setElementState",null),Dt([Me],r.prototype,"updateStartPoint",null),Dt([Me],r.prototype,"moveStartPoint",null),Dt([Me],r.prototype,"updateEndPoint",null),Dt([Me],r.prototype,"moveEndPoint",null),Dt([Me],r.prototype,"setZIndex",null),Dt([Me],r.prototype,"initPoints",null),Dt([Me],r.prototype,"updateAttributes",null),Dt([Me],r.prototype,"getAdjustStart",null),Dt([Me],r.prototype,"getAdjustEnd",null),Dt([Me],r.prototype,"updateAfterAdjustStartAndEnd",null),r}(),i8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),qo=function(){return qo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},qo.apply(this,arguments)},Jr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ef=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Ym=function(r){i8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=Wl(t,"properties.offset",100),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return qo(qo(qo({},n),Ht(t)),Ht(o))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,n=0;return this.pointsList.forEach(function(i){var o=i.x,s=i.y;t+=o,n+=s}),{x:t/this.pointsList.length,y:n/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,s=i.y;return{x:o,y:s}});return qo(qo({},t),{pointsList:n})},e.prototype.getControls=function(){var t=this.startPoint,n=this.endPoint,i=Im({start:t,end:n,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var n=Ef(t,4),i=n[0],o=n[1],s=n[2],l=n[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(o.x," ").concat(o.y,`,
    `).concat(s.x," ").concat(s.y,`,
    `).concat(l.x," ").concat(l.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),n=t.sNext,i=t.ePre;this.updatePath(n,i)},e.prototype.updatePath=function(t,n){t=Ht(t),n=Ht(n);var i={x:this.startPoint.x,y:this.startPoint.y},o={x:this.endPoint.x,y:this.endPoint.y};if(!t||!n){var s=this.getControls();t=s.sNext,n=s.ePre}this.pointsList=[i,t,n,o],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n;var i=Ef(this.pointsList,3),o=i[1],s=i[2];o.x+=t,o.y+=n,this.updatePath(o,s)},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n;var i=Ef(this.pointsList,3),o=i[1],s=i[2];s.x+=t,s.y+=n,this.updatePath(o,s)},e.prototype.updateAdjustAnchor=function(t,n){var i;n==="sNext"?this.pointsList[1]=t:n==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,s=t.targetNode,l=Im({start:n,end:i,sourceNode:o,targetNode:s,offset:this.offset}),d=l.sNext,c=l.ePre;this.pointsList=[n,d,c,i],this.initPoints()},Jr([Ae],e.prototype,"offset",void 0),Jr([Ae],e.prototype,"path",void 0),Jr([Me],e.prototype,"initPoints",null),Jr([Me],e.prototype,"updatePoints",null),Jr([Me],e.prototype,"updateStartPoint",null),Jr([Me],e.prototype,"updateEndPoint",null),Jr([Me],e.prototype,"moveStartPoint",null),Jr([Me],e.prototype,"moveEndPoint",null),Jr([Me],e.prototype,"updateAdjustAnchor",null),Jr([Me],e.prototype,"getAdjustStart",null),Jr([Me],e.prototype,"getAdjustEnd",null),Jr([Me],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(vc),o8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),dl=function(){return dl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},dl.apply(this,arguments)},Km=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},a8=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},qm=function(r){o8(e,r);function e(){var t=r.apply(this,a8([],Km(arguments),!1))||this;return t.modelType=Wt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return dl(dl(dl({},n),Ht(t)),Ht(o))},e.prototype.initEdgeData=function(t){r.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var n=Km(t,2),i=n[0],o=n[1];return"".concat(i.x,",").concat(i.y," ").concat(o.x,",").concat(o.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(vc),s8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),cl=function(){return cl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},cl.apply(this,arguments)},tr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Jm=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},l8=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},ls=function(r){s8(e,r);function e(){var t=r.apply(this,l8([],Jm(arguments),!1))||this;return t.modelType=Wt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=Wl(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return cl(cl(cl({},n),Ht(t)),Ht(o))},e.prototype.getTextPosition=function(){var t,n=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!n){var i=this.dbClickPosition,o=i.x,s=i.y;return{x:o,y:s}}var l=sa(this.points),d=Jm(G3(l),2),c=d[0],f=d[1];return{x:(c.x+f.x)/2,y:(c.y+f.y)/2}},e.prototype.getAfterAnchor=function(t,n,i){var o,s;return i.forEach(function(l){var d;t===vn.HORIZONTAL?d=Math.abs(n.y-l.y):t===vn.VERTICAL&&(d=Math.abs(n.x-l.x)),(!s||s>d)&&(s=d,o=l)}),o},e.prototype.getCrossPoint=function(t,n,i){var o;return t===vn.HORIZONTAL?o={x:i.x,y:n.y}:t===vn.VERTICAL&&(o={x:n.x,y:i.y}),o},e.prototype.removeCrossPoints=function(t,n,i){var o=i.map(function(_){return _});if(t===1){var s=o[t],l=o[n],d=o[t-1],c=Dm(d,s,this.sourceNode);if(c){var f=Lm(s,l,this.sourceNode);if(f){var v=Pm(s,l,this.sourceNode);v&&(o[t]=v,o.splice(t-1,1),t--,n--)}}else{var g=this.sourceNode.anchors;g.forEach(function(_){if(_.x===d.x&&_.x===s.x||_.y===d.y&&_.y===s.y){var C=bi(_.x,_.y,s.x,s.y),k=bi(d.x,d.y,s.x,s.y);C<k&&(o[t-1]=_)}})}}if(n===i.length-2){var y=o[t],b=o[n],x=o[n+1],w=Dm(b,x,this.targetNode);if(w){var f=Lm(y,b,this.targetNode);if(f){var v=Pm(y,b,this.targetNode);v&&(o[n]=v,o.splice(n+1,1))}}else{var g=this.targetNode.anchors;g.forEach(function(C){if(C.x===x.x&&C.x===b.x||C.y===x.y&&C.y===b.y){var k=bi(C.x,C.y,b.x,b.y),D=bi(x.x,x.y,b.x,b.y);k<D&&(o[n+1]=C)}})}}return o},e.prototype.getDraggingPoints=function(t,n,i,o,s){var l=s.map(function(f){return f}),d=this.getAfterAnchor(t,i,o),c=this.getCrossPoint(t,i,d);return n==="start"?(l.unshift(c),l.unshift(d)):(l.push(c),l.push(d)),l},e.prototype.updateCrossPoints=function(t){var n=t.map(function(C){return C}),i=t[0],o=t[1],s=t[n.length-2],l=t[n.length-1],d=this,c=d.sourceNode,f=d.targetNode,v=c.modelType,g=f.modelType,y=xd(i,o),b=n[0];switch(v){case Wt.RECT_NODE:if(c.radius!==0){var x=Fm(i,c);x||(b=$m(i,y,c))}break;case Wt.CIRCLE_NODE:b=uh(i,y,c);break;case Wt.ELLIPSE_NODE:b=zm(i,y,c);break;case Wt.DIAMOND_NODE:b=Hu(i,y,c);break;case Wt.POLYGON_NODE:b=Hu(i,y,c);break}b&&(n[0]=b);var w=xd(s,l),_=n[n.length-1];switch(g){case Wt.RECT_NODE:if(f.radius!==0){var x=Fm(l,f);x||(_=$m(l,w,f))}break;case Wt.CIRCLE_NODE:_=uh(l,w,f);break;case Wt.ELLIPSE_NODE:_=zm(l,w,f);break;case Wt.DIAMOND_NODE:_=Hu(l,w,f);break;case Wt.POLYGON_NODE:_=Hu(l,w,f);break}return _&&(n[n.length-1]=_),n},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,s=i.y;return{x:o,y:s}});return Object.assign({},t,{pointsList:n})},e.prototype.getPath=function(t){return t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=Tm({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n,this.updatePoints()},e.prototype.updatePointsList=function(t,n){this.pointsList.forEach(function(s){s.x+=t,s.y+=n});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var o=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},o),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,n){var i;this.isDragging=!0;var o=t.start,s=t.end,l=t.startIndex,d=t.endIndex,c=t.direction,f=this.pointsList,v=f;return c===vn.HORIZONTAL?(f[l]={x:o.x,y:o.y+n.y},f[d]={x:s.x,y:s.y+n.y},v=this.pointsList.map(function(g){return g})):c===vn.VERTICAL&&(f[l]={x:o.x+n.x,y:o.y},f[d]={x:s.x+n.x,y:s.y},v=this.pointsList.map(function(g){return g})),this.updatePointsAfterDrag(v),this.draggingPointList=v,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[d]),startIndex:l,endIndex:d,direction:c}},e.prototype.dragAppend=function(t,n){var i;this.isDragging=!0;var o=t.start,s=t.end,l=t.startIndex,d=t.endIndex,c=t.direction,f=this.pointsList;if(c===vn.HORIZONTAL){f[l]={x:o.x,y:o.y+n.y},f[d]={x:s.x,y:s.y+n.y};var v=this.pointsList.map(function(w){return w});if(l!==0&&d!==this.pointsList.length-1&&(v=this.removeCrossPoints(l,d,v)),l===0){var g={x:o.x,y:o.y+n.y},y=ro(g,this.sourceNode);if(!y){var b=this.sourceNode.anchors;v=this.getDraggingPoints(c,"start",g,b,v)}}if(d===this.pointsList.length-1){var x={x:s.x,y:s.y+n.y},y=ro(x,this.targetNode);if(!y){var b=this.targetNode.anchors;v=this.getDraggingPoints(c,"end",x,b,v)}}this.updatePointsAfterDrag(v),this.draggingPointList=v}else if(c===vn.VERTICAL){f[l]={x:o.x+n.x,y:o.y},f[d]={x:s.x+n.x,y:s.y};var v=this.pointsList.map(function(_){return _});if(l!==0&&d!==this.pointsList.length-1&&(v=this.removeCrossPoints(l,d,v)),l===0){var g={x:o.x+n.x,y:o.y},y=ro(g,this.sourceNode);if(!y){var b=this.sourceNode.anchors;v=this.getDraggingPoints(c,"start",g,b,v)}}if(d===this.pointsList.length-1){var x={x:s.x+n.x,y:s.y},y=ro(x,this.targetNode);if(!y){var b=this.targetNode.anchors;v=this.getDraggingPoints(c,"end",x,b,v)}}this.updatePointsAfterDrag(v),this.draggingPointList=v}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[d]),startIndex:l,endIndex:d,direction:c}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=Nw(sa(this.points));this.pointsList=t.map(function(o){return o}),this.draggingPointList=[];var n=t[0];this.startPoint=on({},n);var i=t[t.length-1];this.endPoint=on({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var n=this.updateCrossPoints(t);this.points=n.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,s=t.targetNode;this.pointsList=Tm({x:n.x,y:n.y},{x:i.x,y:i.y},o,s,this.offset||0),this.initPoints()},tr([Ae],e.prototype,"offset",void 0),tr([Ae],e.prototype,"dbClickPosition",void 0),tr([Me],e.prototype,"initPoints",null),tr([Me],e.prototype,"updatePoints",null),tr([Me],e.prototype,"updateStartPoint",null),tr([Me],e.prototype,"moveStartPoint",null),tr([Me],e.prototype,"updateEndPoint",null),tr([Me],e.prototype,"moveEndPoint",null),tr([Me],e.prototype,"updatePointsList",null),tr([Me],e.prototype,"dragAppendStart",null),tr([Me],e.prototype,"dragAppendSimple",null),tr([Me],e.prototype,"dragAppend",null),tr([Me],e.prototype,"dragAppendEnd",null),tr([Me],e.prototype,"updatePointsAfterDrag",null),tr([Me],e.prototype,"getAdjustStart",null),tr([Me],e.prototype,"getAdjustEnd",null),tr([Me],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(vc),Yn=function(){return Yn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Yn.apply(this,arguments)},jt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Zm=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},u8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},To=function(){function r(e,t){var n;this.BaseType=xn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ii.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=en.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=Wt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,n=t.x,i=n===void 0?0:n,o=t.y,s=o===void 0?0:o;this.transform=new wd(-i,-s).rotate(e).translate(i,s).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),r.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||Co()}this.formatText(e),on(this,sI(e));var o=this.graphModel.overlapMode;o===_i.INCREASE&&(this.zIndex=e.zIndex||yp())},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,s=o.nodeTextDraggable,l=o.nodeTextEdit,d=e.x,c=e.y,f=e.text,v={value:"",x:d,y:c,draggable:s,editable:l};f&&(typeof f=="string"?v.value=f:(v=Yn(Yn({},v),{x:(t=f.x)!==null&&t!==void 0?t:d,y:(n=f.y)!==null&&n!==void 0?n:c,value:(i=f.value)!==null&&i!==void 0?i:""}),Ka(f.draggable)||(v.draggable=f.draggable),Ka(f.editable)||(v.editable=f.editable))),e.text=v},r.prototype.resize=function(e){var t=e.width,n=e.height,i=e.deltaX,o=e.deltaY,s=this.isAllowResizeNode(i,o,t,n);return s?(this.move(i/2,o/2),this.width=t,this.height=n,this.setProperties({width:t,height:n}),this.getData()):this.getData()},r.prototype.proportionalResize=function(){},r.prototype.getData=function(){var e=this.text,t=e.x,n=e.y,i=e.value,o=this.properties;rs(o)&&(o=gi(o)),xr(o.width)&&(o.width=this.width),xr(o.height)&&(o.height=this.height);var s={id:this.id,type:this.type,x:this.x,y:this.y,properties:o};return this.rotate&&(s.rotate=this.rotate),this.graphModel.overlapMode===_i.INCREASE&&(s.zIndex=this.zIndex),i&&(s.text={x:t,y:n,value:i}),s},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.getProperties=function(){return gi(this.properties)},r.prototype.getOuterGAttributes=function(){return{className:""}},r.prototype.getNodeStyle=function(){return Yn(Yn({},this.graphModel.theme.baseNode),this.style)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,n=t===void 0?{}:t;return Yn(Yn({},Ht(e)),Ht(n))},r.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Ht(e)},r.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Ht(e)},r.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Ht(e)},r.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Ht(t)},r.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Ht(t)},r.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Ht(e)},r.prototype.isAllowConnectedAsSource=function(e,t,n,i){var o=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var s=!0,l="",d=0;d<o.length;d++){var c=o[d];if(!c.validate.call(this,this,e,t,n,i)){s=!1,l=c.message;break}}return{isAllPass:s,msg:l}},r.prototype.getConnectedSourceRules=function(){return this.sourceRules},r.prototype.isAllowConnectedAsTarget=function(e,t,n,i){var o=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var s=!0,l="",d=0;d<o.length;d++){var c=o[d];if(!c.validate.call(this,e,this,t,n,i)){s=!1,l=c.message;break}}return{isAllPass:s,msg:l}},r.prototype.isAllowMoveNode=function(e,t){var n,i,o=!0,s=!0,l=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var d=Zm(l),c=d.next();!c.done;c=d.next()){var f=c.value,v=f(this,e,t);if(!v)return!1;if(typeof v=="object"){var g=v;if(!g.x&&!g.y)return!1;o=o&&g.x,s=s&&g.y}}}catch(y){n={error:y}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return{x:o,y:s}},r.prototype.getConnectedTargetRules=function(){return this.targetRules},r.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,n=e.id,i=e.x,o=e.y;return t&&t.length>0?t.map(function(s,l){return s.length?(s=s,{id:"".concat(n,"_").concat(l),x:i+s[0],y:o+s[1]}):(s=s,Yn(Yn({},s),{x:i+s.x,y:o+s.y,id:s.id||"".concat(n,"_").concat(l)}))}):this.getDefaultAnchor()},r.prototype.getDefaultAnchor=function(){return[]},r.prototype.getTargetAnchor=function(e){return iI(e,this)},r.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(r.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,n=t.x,i=t.y,o=t.rotate;return e.forEach(function(s){var l=s.x,d=s.y,c=u8(new Jl([l,d,1]).translate(-n,-i).rotate(o).translate(n,i)[0],2),f=c[0],v=c[1];s.x=f,s.y=v}),e},enumerable:!1,configurable:!0}),r.prototype.getAnchorInfo=function(e){if(!xr(e))for(var t=0;t<this.anchors.length;t++){var n=this.anchors[t];if(n.id===e)return n}},r.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},r.prototype.isAllowMoveByXORY=function(e,t,n){var i,o;if(n)i=!0,o=!0;else{var s=this.isAllowMoveNode(e,t);typeof s=="boolean"?(i=s,o=s):(i=s.x,o=s.y)}return{isAllowMoveX:i,isAllowMoveY:o}},r.prototype.move=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,s=i.isAllowMoveY;return o&&(this.x=this.x+e,this.text&&this.moveText(e,0)),s&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(o||s)&&(this.rotate=this._rotate),o||s},r.prototype.getMoveDistance=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,s=i.isAllowMoveY,l=0,d=0;return o&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),l=e),s&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),d=t),this.transform=new wd(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[l,d]},r.prototype.moveTo=function(e,t,n){n===void 0&&(n=!1);var i=e-this.x,o=t-this.y;return!n&&!this.isAllowMoveNode(i,o)?!1:(this.text&&this.moveText(i,o),this.x=e,this.y=t,!0)},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,s=n.value,l=n.draggable,d=n.editable;this.text={value:s,editable:d,draggable:l,x:i+e,y:o+t}},r.prototype.updateText=function(e){this.text=Yn(Yn({},gi(this.text)),{value:e})},r.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},r.prototype.isAllowResizeNode=function(e,t,n,i){var o,s,l=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var d=Zm(l),c=d.next();!c.done;c=d.next()){var f=c.value,v=f(this,e,t,n,i);if(!v)return!1}}catch(g){o={error:g}}finally{try{c&&!c.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}return!0},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},r.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},r.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},r.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateProperties=function(e,t){var n=gi(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(Ct.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:n,properties:e})},r.prototype.setProperty=function(e,t){var n=gi(this.properties),i=Ht(n);qC(i,e,cr(t)),this.updateProperties(i,[e])},r.prototype.setProperties=function(e){var t=gi(this.properties),n=Yn(Yn({},t),cr(e)),i=[];JC(e,function(o,s){(Uf(t,s)&&t[s]!==o||!Uf(t,s))&&i.push(s)}),this.updateProperties(n,i)},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setStyle=function(e,t){var n;this.style=Yn(Yn({},this.style),(n={},n[e]=cr(t),n))},r.prototype.setStyles=function(e){this.style=Yn(Yn({},this.style),cr(e))},r.prototype.updateStyles=function(e){this.style=Yn({},cr(e))},r.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},r.prototype.updateAttributes=function(e){on(this,e)},r.BaseType=xn.NODE,jt([Ae],r.prototype,"type",void 0),jt([Ae],r.prototype,"x",void 0),jt([Ae],r.prototype,"y",void 0),jt([Ae],r.prototype,"textMode",void 0),jt([Ae],r.prototype,"text",void 0),jt([Ae],r.prototype,"properties",void 0),jt([Ae],r.prototype,"_width",void 0),jt([Ae],r.prototype,"_height",void 0),jt([Ae],r.prototype,"anchorsOffset",void 0),jt([Ae],r.prototype,"isSelected",void 0),jt([Ae],r.prototype,"isHovered",void 0),jt([Ae],r.prototype,"isShowAnchor",void 0),jt([Ae],r.prototype,"isDragging",void 0),jt([Ae],r.prototype,"isHitable",void 0),jt([Ae],r.prototype,"isHittable",void 0),jt([Ae],r.prototype,"draggable",void 0),jt([Ae],r.prototype,"visible",void 0),jt([Ae],r.prototype,"rotatable",void 0),jt([Ae],r.prototype,"resizable",void 0),jt([Ae],r.prototype,"zIndex",void 0),jt([Ae],r.prototype,"state",void 0),jt([Ae],r.prototype,"autoToFront",void 0),jt([Ae],r.prototype,"style",void 0),jt([Ae],r.prototype,"transform",void 0),jt([Ae],r.prototype,"_rotate",void 0),jt([fn],r.prototype,"incoming",null),jt([fn],r.prototype,"outgoing",null),jt([Me],r.prototype,"setTextMode",null),jt([Me],r.prototype,"addNodeMoveRules",null),jt([Me],r.prototype,"move",null),jt([Me],r.prototype,"getMoveDistance",null),jt([Me],r.prototype,"moveTo",null),jt([Me],r.prototype,"moveText",null),jt([Me],r.prototype,"updateText",null),jt([Me],r.prototype,"addNodeResizeRules",null),jt([Me],r.prototype,"setSelected",null),jt([Me],r.prototype,"setHovered",null),jt([Me],r.prototype,"setIsShowAnchor",null),jt([Me],r.prototype,"setRotatable",null),jt([Me],r.prototype,"setResizable",null),jt([Me],r.prototype,"setHitable",null),jt([Me],r.prototype,"setHittable",null),jt([Me],r.prototype,"setElementState",null),jt([Me],r.prototype,"setProperty",null),jt([Me],r.prototype,"setProperties",null),jt([Me],r.prototype,"deleteProperty",null),jt([Me],r.prototype,"setStyle",null),jt([Me],r.prototype,"setStyles",null),jt([Me],r.prototype,"updateStyles",null),jt([Me],r.prototype,"setZIndex",null),jt([Me],r.prototype,"updateAttributes",null),r}(),d8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),fl=function(){return fl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},fl.apply(this,arguments)},Cf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Md=function(r){d8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.circle,i=this.properties.style,o=i===void 0?{}:i;return fl(fl(fl({},t),Ht(n)),Ht(o))},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.r;return[{x:n,y:i-o,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+o,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.deltaX,o=t.deltaY;return this.move(i/2,o/2),this.r=n,this.setProperties({r:n}),this.getData()},Cf([Ae],e.prototype,"r",void 0),Cf([fn],e.prototype,"width",null),Cf([fn],e.prototype,"height",null),e}(To),c8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),hl=function(){return hl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hl.apply(this,arguments)},Ra=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Fu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},yh=function(r){c8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.diamond,i=this.properties.style,o=i===void 0?{}:i;return hl(hl(hl({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,n=t.x,i=t.y,o=t.rx,s=t.ry;return[[n,i-s],[n+o,i],[n,i+s],[n-o,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return io(this.points,function(t){var n=Fu(t,2),i=n[0],o=n[1];return{x:i,y:o}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return un(this.points,function(i){var o=Fu(i,1),s=o[0];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return un(this.points,function(i){var o=Fu(i,2),s=o[1];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return io(this.points,function(n,i){var o=Fu(n,2),s=o[0],l=o[1];return{x:s,y:l,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,s=t.deltaY;return this.move(o/2,s/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},Ra([Ae],e.prototype,"rx",void 0),Ra([Ae],e.prototype,"ry",void 0),Ra([fn],e.prototype,"points",null),Ra([fn],e.prototype,"pointsPosition",null),Ra([fn],e.prototype,"width",null),Ra([fn],e.prototype,"height",null),e}(To),f8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),pl=function(){return pl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},pl.apply(this,arguments)},zu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},_h=function(r){f8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.ellipse,i=this.properties.style,o=i===void 0?{}:i;return pl(pl(pl({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.rx,s=t.ry;return[{x:n,y:i-s,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,s=t.deltaY;return this.move(o/2,s/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},zu([Ae],e.prototype,"rx",void 0),zu([Ae],e.prototype,"ry",void 0),zu([fn],e.prototype,"width",null),zu([fn],e.prototype,"height",null),e}(To),h8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vl=function(){return vl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vl.apply(this,arguments)},Wu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Uu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Nd=function(r){h8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.points,i=t.width,o=t.height,s=n||this.points;this.points=Q3(s,i,o)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.polygon,i=this.properties.style,o=i===void 0?{}:i;return vl(vl(vl({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return this.points.map(function(l){return{x:l[0]+n-o/2,y:l[1]+i-s/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Uu(i,1),s=o[0];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Uu(i,2),s=o[1];s<t&&(t=s),s>n&&(n=s)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=this,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points;return d.map(function(c,f){var v=Uu(c,2),g=v[0],y=v[1];return{x:i+g-s/2,y:o+y-l/2,id:"".concat(t.id,"_").concat(f)}})},e.prototype.resize=function(t){var n=this,i=t.width,o=t.height,s=t.deltaX,l=t.deltaY;this.move(s/2,l/2);var d=io(this.points,function(c){var f=Uu(c,2),v=f[0],g=f[1];return[v*i/n.width,g*o/n.height]});return this.points=d,this.properties.points=d,this.getData()},Wu([Ae],e.prototype,"points",void 0),Wu([fn],e.prototype,"pointsPosition",null),Wu([fn],e.prototype,"width",null),Wu([fn],e.prototype,"height",null),e}(To),p8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gl=function(){return gl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gl.apply(this,arguments)},v8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},us=function(r){p8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height,o=t.radius,s=this.getNodeStyle().radius;xr(n)||(this.width=n),xr(i)||(this.height=i),xr(o)||(this.radius=o),xr(s)||(this.radius=s)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return[{x:n,y:i-s/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.rect,i=this.properties.style,o=i===void 0?{}:i;return gl(gl(gl({},t),Ht(n)),Ht(o))},v8([Ae],e.prototype,"radius",void 0),e}(To),g8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ml=function(){return ml=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ml.apply(this,arguments)},Qm=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},m8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},y8=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},ey=function(r){g8(e,r);function e(){var t=r.apply(this,y8([],m8(arguments),!1))||this;return t.modelType=Wt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=r.prototype.getTextStyle.call(this),n=this.graphModel.theme.text,i=this.properties.textStyle;return ml(ml(ml({},t),Ht(n)),Ht(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=Um({rows:t,fontSize:n,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=Um({rows:t,fontSize:n,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),Qm([fn],e.prototype,"width",null),Qm([fn],e.prototype,"height",null),e}(To),_8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Il=function(r){_8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Wt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height;n&&(this.width=n),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,s=t.height;return[{x:n,y:i-s/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+s/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e}(To),rn=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},b8={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},Vu=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],x8=function(){function r(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=ii.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ii.TEXT,this.edgeTextMode=ii.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",on(this,this.computeConfig(e))}return r.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);on(this,t)},r.prototype.computeConfig=function(e){var t=e.isSilentMode,n=e.textDraggable,i=e.textMode,o=e.textEdit,s=e.adjustEdgeStartAndEnd,l={};if(t===!1&&on(l,this.stagedConfig),t===!0&&t!==this.isSilentMode){var d=$a(b8,Vu);this.stagedConfig=$a(this,Vu),on(l,d)}Ka(o)||on(l,{nodeTextEdit:o,edgeTextEdit:o}),Ka(n)||on(l,{nodeTextDraggable:n,edgeTextDraggable:n}),i&&on(l,{nodeTextMode:i,edgeTextMode:i}),Vf(s)&&on(l,{adjustEdgeStart:s,adjustEdgeEnd:s});var c=$a(e,Vu);return on(l,c)},r.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},r.prototype.getConfig=function(){return $a(this,Vu)},rn([Ae],r.prototype,"isSilentMode",void 0),rn([Ae],r.prototype,"stopZoomGraph",void 0),rn([Ae],r.prototype,"stopMoveGraph",void 0),rn([Ae],r.prototype,"stopScrollGraph",void 0),rn([Ae],r.prototype,"snapGrid",void 0),rn([Ae],r.prototype,"textMode",void 0),rn([Ae],r.prototype,"textEdit",void 0),rn([Ae],r.prototype,"textDraggable",void 0),rn([Ae],r.prototype,"nodeTextEdit",void 0),rn([Ae],r.prototype,"nodeTextDraggable",void 0),rn([Ae],r.prototype,"nodeTextMultiple",void 0),rn([Ae],r.prototype,"nodeTextVertical",void 0),rn([Ae],r.prototype,"nodeTextMode",void 0),rn([Ae],r.prototype,"edgeTextMode",void 0),rn([Ae],r.prototype,"edgeTextEdit",void 0),rn([Ae],r.prototype,"edgeTextDraggable",void 0),rn([Ae],r.prototype,"edgeTextMultiple",void 0),rn([Ae],r.prototype,"edgeTextVertical",void 0),rn([Ae],r.prototype,"hideAnchors",void 0),rn([Ae],r.prototype,"allowRotate",void 0),rn([Ae],r.prototype,"allowResize",void 0),rn([Ae],r.prototype,"hoverOutline",void 0),rn([Ae],r.prototype,"nodeSelectedOutline",void 0),rn([Ae],r.prototype,"adjustNodePosition",void 0),rn([Ae],r.prototype,"autoExpand",void 0),rn([Ae],r.prototype,"adjustEdge",void 0),rn([Ae],r.prototype,"adjustEdgeMiddle",void 0),rn([Ae],r.prototype,"adjustEdgeStartAndEnd",void 0),rn([Ae],r.prototype,"adjustEdgeStart",void 0),rn([Ae],r.prototype,"adjustEdgeEnd",void 0),rn([Ae],r.prototype,"edgeSelectedOutline",void 0),rn([Me],r.prototype,"updateEditConfig",null),rn([Me],r.prototype,"updateTextMode",null),r}(),w8="*",S8=function(){function r(){this._events={}}return r.prototype.on=function(e,t,n){var i=this;e==null||e.split(",").forEach(function(o){o=o.trim(),i._events[o]||(i._events[o]=[]),i._events[o].push({callback:t,once:!!n})})},r.prototype.once=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){i=i.trim(),n.on(i,t,!0)})},r.prototype.emit=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){var o=n._events[i]||[],s=n._events[w8]||[],l=function(d){for(var c=d.length,f=0;f<c;f++)if(d[f]){var v=d[f],g=v.callback,y=v.once;y&&(d.splice(f,1),d.length===0&&delete n._events[i],c--,f--),g.apply(n,[t])}};l(o),l(s)})},r.prototype.off=function(e,t){var n=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete n._events[i];else{for(var o=n._events[i]||[],s=o.length,l=0;l<s;l++)o[l].callback===t&&(o.splice(l,1),s--,l--);o.length===0&&delete n._events[i]}})},r.prototype.getEvents=function(){return this._events},r.prototype.destroy=function(){this._events={}},r}(),E8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bh=function(){return bh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bh.apply(this,arguments)},C8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},O8=function(r){E8(e,r);function e(t){var n=r.call(this)||this;n.stepScrollX=0,n.stepScrollY=0,n.onDragging=function(l){var d=l.deltaX,c=l.deltaY;n.setState({isDragging:!0});var f=n.props.graphModel,v=f.transformModel,g=f.editConfigModel;g.stopMoveGraph!==!0&&v.translate(d,c)},n.onDragEnd=function(){n.setState({isDragging:!1})},n.zoomHandler=function(l){var d=n.props,c=d.graphModel,f=c.editConfigModel,v=c.transformModel,g=c.gridSize,y=d.graphModel,b=l.deltaX,x=l.deltaY,w=f.stopScrollGraph,_=f.stopZoomGraph;if(!w&&!l.ctrlKey&&!l.metaKey){if(l.preventDefault(),n.stepScrollX+=b,n.stepScrollY+=x,Math.abs(n.stepScrollX)>=g){var C=n.stepScrollX%g,k=n.stepScrollX-C;v.translate(-k*v.SCALE_X,0),n.stepScrollX=C}if(Math.abs(n.stepScrollY)>=g){var D=n.stepScrollY%g,R=n.stepScrollY-D;v.translate(0,-R*v.SCALE_Y),n.stepScrollY=D}return}if(!_){l.preventDefault();var $=y.getPointByClient({x:l.clientX,y:l.clientY}),P=$.canvasOverlayPosition,I=P.x,W=P.y;v.zoom(l.deltaY<0,[I,W])}},n.clickHandler=function(l){var d=l.target;if(d.getAttribute("name")==="canvas-overlay"){var c=n.props.graphModel,f=c.selectElements;f.size>0&&c.clearSelectElements(),c.eventCenter.emit(Ct.BLANK_CLICK,{e:l})}},n.handleContextMenu=function(l){var d=l.target;if(d.getAttribute("name")==="canvas-overlay"){l.preventDefault();var c=n.props.graphModel,f=c.getPointByClient({x:l.clientX,y:l.clientY});c.eventCenter.emit(Ct.BLANK_CONTEXTMENU,{e:l,position:f})}},n.mouseDownHandler=function(l){var d=n.props.graphModel,c=d.eventCenter,f=d.editConfigModel,v=d.transformModel.SCALE_X,g=d.gridSize,y=f.adjustEdge,b=f.adjustNodePosition,x=f.stopMoveGraph,w=l.target,_=!y&&!b;(w.getAttribute("name")==="canvas-overlay"||_)&&(x!==!0?(n.stepDrag.setStep(g*v),n.stepDrag.handleMouseDown(l)):c.emit(Ct.BLANK_MOUSEDOWN,{e:l}),n.clickHandler(l))};var i=t.graphModel,o=i.gridSize,s=i.eventCenter;return n.stepDrag=new ai({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"BLANK",isStopPropagation:!1,eventCenter:s,model:void 0}),n.state={isDragging:!1},n}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props,o=i.children,s=i.dnd,l=this.state.isDragging;return Ne("svg",bh({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:l?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},s.eventMap(),{children:Ne("g",{transform:n,children:o})}))},e=C8([Sr],e),e}(Gt),Fw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bl=function(){return Bl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bl.apply(this,arguments)},k8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},M8=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},ty=function(r){Fw(e,r);function e(){var t=r.call(this)||this;return t.onDragging=function(n){var i=n.event,o=t.props,s=o.graphModel,l=o.bezierModel,d=o.type,c=s.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,f=c.x,v=c.y;l.updateAdjustAnchor({x:f,y:v},d),s.eventCenter.emit(Ct.EDGE_ADJUST,{data:l.getData()})},t.onDragEnd=function(){var n=t.props.bezierModel;n.isDragging=!1},t.dragHandler=new ai({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,n=this.props.position,i=n.x,o=n.y,s=this.props.bezierModel,l=s.getEdgeStyle().adjustAnchor;return Ne(ss,Bl({className:"lf-bezier-adjust-anchor",x:i,y:o},l,{onMouseDown:function(d){t.dragHandler.handleMouseDown(d)}}))},e}(Gt),N8=function(r){Fw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,n){var i=t.path,o=t.id,s=vp(i),l=M8(s,4),d=l[0],c=l[1],f=l[2],v=l[3],g=t.getEdgeStyle().adjustLine,y=[];return y.push(Ne(as,Bl({x1:d.x,y1:d.y,x2:c.x,y2:c.y},g))),y.push(Ne(ty,{position:c,bezierModel:t,graphModel:n,type:"sNext"},"".concat(o,"_ePre"))),y.push(Ne(as,Bl({x1:v.x,y1:v.y,x2:f.x,y2:f.y},g))),y.push(Ne(ty,{position:f,bezierModel:t,graphModel:n,type:"ePre"},"".concat(o,"_sNext"))),y},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,n=t.edges,i=[],o=0;o<n.length;o++){var s=n[o];s.isSelected&&s.modelType===Wt.BEZIER_EDGE&&s.draggable&&i.push(this.getBezierAdjust(s,t))}return i},e.prototype.render=function(){return Ne("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=k8([Sr],e),e}(Gt),A8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),T8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},D8=function(r){A8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return Ne("div",{className:"lf-background",children:Ne("div",{style:ZC(t)?t:{},className:"lf-background-area"})})},e=T8([Sr],e),e}(Gt),L8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),P8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Xa=function(r){L8(e,r);function e(t){var n=r.call(this,t)||this;return n.id=Co(),n.gridOptions=n.props.graphModel.grid,n}return e.prototype.renderDot=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,s=t.visible,l=n??{},d=l.color,c=l.thickness,f=c===void 0?2:c,v=Math.min(Math.max(2,f),o/4),g=s?1:0;return Ne("g",{fill:d,opacity:g,children:[Ne("circle",{cx:0,cy:0,r:v/2}),Ne("circle",{cx:0,cy:o,r:v/2}),Ne("circle",{cx:o,cy:0,r:v/2}),Ne("circle",{cx:o,cy:o,r:v/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,s=t.visible,l=n??{},d=l.color,c=l.thickness,f=c===void 0?1:c,v=Math.min(Math.max(1,f),o/2),g="M 0 0 H ".concat(o," V ").concat(o," H 0 Z"),y=s?1:0;return Ne("path",{d:g,stroke:d,strokeWidth:v/2,opacity:y,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,n=t.transformModel,i=t.grid;this.gridOptions=i;var o=this.gridOptions,s=o.type,l=o.size,d=l===void 0?1:l,c=n.SCALE_X,f=n.SKEW_Y,v=n.SKEW_X,g=n.SCALE_Y,y=n.TRANSLATE_X,b=n.TRANSLATE_Y,x=[c,f,v,g,y,b].join(","),w="matrix(".concat(x,")");return Ne("div",{className:"lf-grid",children:Ne("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[Ne("defs",{children:Ne("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:w,x:"0",y:"0",width:d,height:d,children:[s==="dot"&&this.renderDot(),s==="mesh"&&this.renderMesh()]})}),Ne("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=P8([Sr],e),e}(Gt);(function(r){r.defaultProps={size:A3,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var n=Ht(r.defaultProps);return typeof t=="number"?on(n,{size:t}):typeof t=="boolean"?on(n,{visible:t}):on(n,t)}r.getGridOptions=e})(Xa||(Xa={}));var R8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),I8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},B8=function(r){R8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props.children;return Ne("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:Ne("g",{transform:n,children:i})})},e=I8([Sr],e),e}(Gt),j8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),_o=function(){return _o=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},_o.apply(this,arguments)},H8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},$8=function(r){j8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,n=t.nodes,i=t.editConfigModel,o=i.hoverOutline,s=i.nodeSelectedOutline,l=[];return n.forEach(function(d){if(d.isHovered||d.isSelected){var c=d.isHovered,f=d.isSelected,v=d.x,g=d.y,y=d.width,b=d.height;if(s&&f||o&&c){var x=d.getOutlineStyle(),w={};if(Object.keys(x).forEach(function(C){C!=="hover"&&(w[C]=x[C])}),c){var _=x.hover;w=_o(_o({},w),_)}l.push(Ne(ni,_o({transform:d.transform,className:"lf-outline-node",x:v,y:g,width:y+10,height:b+10},w)))}}}),l},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,n=t.edges,i=t.editConfigModel,o=i.edgeSelectedOutline,s=i.hoverOutline,l=[],d=0;d<n.length;d++){var c=n[d];(o&&c.isSelected||s&&c.isHovered)&&(c.modelType===Wt.LINE_EDGE?l.push(this.getLineOutline(c)):c.modelType===Wt.POLYLINE_EDGE?l.push(this.getPolylineOutline(c)):c.modelType===Wt.BEZIER_EDGE&&l.push(this.getBezierOutline(c)))}return l},e.prototype.getLineOutline=function(t){var n=t.startPoint,i=t.endPoint,o=(n.x+i.x)/2,s=(n.y+i.y)/2,l=Math.abs(n.x-i.x)+10,d=Math.abs(n.y-i.y)+10,c=t.getOutlineStyle();return Ne(ni,_o({className:"lf-outline-edge",x:o,y:s,width:l,height:d},c))},e.prototype.getPolylineOutline=function(t){var n=t.points,i=sa(n),o=Nl(i,8),s=o.x,l=o.y,d=o.width,c=o.height,f=t.getOutlineStyle();return Ne(ni,_o({className:"lf-outline",x:s,y:l,width:d,height:c},f))},e.prototype.getBezierOutline=function(t){var n=t.path,i=vp(n),o=Nl(i,8),s=o.x,l=o.y,d=o.width,c=o.height,f=t.getOutlineStyle();return Ne(ni,_o({className:"lf-outline",x:s,y:l,width:d,height:c},f))},e.prototype.render=function(){return Ne("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=H8([Sr],e),e}(Gt),F8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bo=function(){return bo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bo.apply(this,arguments)},z8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},W8=function(r){F8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,n=t??{},i=n.position,o=n.isShowHorizontal,s=n.isShowVertical,l=t==null?void 0:t.getStyle(),d=i??{},c=d.x,f=c===void 0?0:c,v=d.y,g=v===void 0?0:v,y=bo(bo({x1:-1e5,y1:g,x2:1e5,y2:g},l),{stroke:o?l==null?void 0:l.stroke:"none"}),b=bo(bo({x1:f,y1:-1e5,x2:f,y2:1e5},l),{stroke:s?l==null?void 0:l.stroke:"none"});return Ne("g",{className:"lf-snapline",children:[Ne(as,bo({},y)),Ne(as,bo({},b))]})},e=z8([Sr],e),e}(Gt),U8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),V8=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},X8=function(r){U8(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,n=t.tool,i=t.graphModel,o=i.textEditElement,s=n.getTools(),l=s.map(function(d){return xt(d,{textEditElement:o,graphModel:i,lf:n.instance})});return n.components=l,l},e.prototype.triggerToolRender=function(){var t=this.props,n=t.tool,i=t.graphModel,o=document.querySelector("#ToolOverlay_".concat(i.flowId)),s=n.getInstance();s.components.forEach(function(l){return l(s,o)}),s.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return Ne("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=V8([Sr],e),e}(Gt),fi=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ia=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},G8={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},Y8=function(){function r(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var n=t.stopMoveGraph,i=n===void 0?!1:n;this.updateTranslateLimits(i)}return r.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},r.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},r.prototype.HtmlPointToCanvasPoint=function(e){var t=Ia(e,2),n=t[0],i=t[1];return[(n-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},r.prototype.CanvasPointToHtmlPoint=function(e){var t=Ia(e,2),n=t[0],i=t[1];return[n*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},r.prototype.moveCanvasPointByHtml=function(e,t,n){var i=Ia(e,2),o=i[0],s=i[1];return[o+t/this.SCALE_X,s+n/this.SCALE_Y]},r.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},r.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},r.prototype.zoom=function(e,t){e===void 0&&(e=!1);var n=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(n=e,i=e):e?(n+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(n-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),n<this.MINI_SCALE_SIZE||n>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(n-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=n,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},r.prototype.emitGraphTransform=function(e){this.eventCenter.emit(Ct.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},r.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},r.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},r.prototype.focusOn=function(e,t,n,i){var o=Ia(this.CanvasPointToHtmlPoint([e,t]),2),s=o[0],l=o[1],d=Ia([n/2-s,i/2-l],2),c=d[0],f=d[1];this.TRANSLATE_X+=c,this.TRANSLATE_Y+=f,this.emitGraphTransform("focusOn")},r.prototype.updateTranslateLimits=function(e){var t;t=Ia(Array.isArray(e)&&e.length===4?e:G8[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},fi([Ae],r.prototype,"SCALE_X",void 0),fi([Ae],r.prototype,"SKEW_Y",void 0),fi([Ae],r.prototype,"SKEW_X",void 0),fi([Ae],r.prototype,"SCALE_Y",void 0),fi([Ae],r.prototype,"TRANSLATE_X",void 0),fi([Ae],r.prototype,"TRANSLATE_Y",void 0),fi([Ae],r.prototype,"ZOOM_SIZE",void 0),fi([Me],r.prototype,"zoom",null),fi([Me],r.prototype,"resetZoom",null),fi([Me],r.prototype,"translate",null),fi([Me],r.prototype,"focusOn",null),r}(),K8=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Of=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},q8=function(r){K8(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.parentTransform=n.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,n=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,n*=i.scaleY}else t*=this.parentTransform.SCALE_X,n*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:n}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,n=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),o=i.scaleX,s=i.scaleY;t=o*t,n=s*n}return{translateX:t,translateY:n}},e.prototype.HtmlPointToCanvasPoint=function(t){var n=Of(t,2),i=n[0],o=n[1],s=this.getCumulativeScale(),l=s.scaleX,d=s.scaleY,c=this.getCumulativeTranslate(),f=c.translateX,v=c.translateY;return[(i-f)/l,(o-v)/d]},e.prototype.CanvasPointToHtmlPoint=function(t){var n=Of(t,2),i=n[0],o=n[1],s=this.getCumulativeScale(),l=s.scaleX,d=s.scaleY,c=this.getCumulativeTranslate(),f=c.translateX,v=c.translateY;return[i*l+f,o*d+v]},e.prototype.moveCanvasPointByHtml=function(t,n,i){var o=Of(t,2),s=o[0],l=o[1],d=this.getCumulativeScale(),c=d.scaleX,f=d.scaleY;return[s+n/c,l+i/f]},e.prototype.fixDeltaXY=function(t,n){var i=this.getCumulativeScale(),o=i.scaleX,s=i.scaleY;return[t/o,n/s]},e}(Y8),ur=function(){return ur=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ur.apply(this,arguments)},Et=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},J8=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jn=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Zr=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Z8=function(){function r(e){var t=this,n,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=_i.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var o=e.container,s=e.partial,l=e.background,d=l===void 0?{}:l,c=e.grid,f=e.idGenerator,v=e.edgeGenerator,g=e.animation,y=e.customTrajectory;this.rootEl=o,this.partial=!!s,this.background=d,typeof c=="object"&&e.snapGrid&&(this.gridSize=c.size||1),this.customStyles=e.style||{},this.grid=Xa.getGridOptions(c??!1),this.theme=$w(e.style,e.themeMode),this.theme.grid=Ht(this.grid),this.theme.background=Ht(this.background),this.edgeType=e.edgeType||"polyline",this.animation=k3(g),this.overlapMode=e.overlapMode||_i.DEFAULT,this.width=(n=e.width)!==null&&n!==void 0?n:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=xr(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=xr(e.height);var b=new ResizeObserver(m_(function(x){var w,_;try{for(var C=J8(x),k=C.next();!k.done;k=C.next()){var D=k.value;D.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:D.contentRect}))}}catch(R){w={error:R}}finally{try{k&&!k.done&&(_=C.return)&&_.call(C)}finally{if(w)throw w.error}}},16));b.observe(this.rootEl),this.waitCleanEffects.push(function(){b.disconnect()}),this.eventCenter=new S8,this.editConfigModel=new x8(e),this.transformModel=new q8(this.eventCenter,e),this.flowId=Co(),this.idGenerator=f,this.edgeGenerator=J3(this,v),this.customTrajectory=y}return Object.defineProperty(r.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelsMap",{get:function(){return Zr(Zr([],Jn(this.nodes),!1),Jn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sortElements",{get:function(){for(var e=Zr(Zr([],Jn(this.nodes),!1),Jn(this.edges),!1).sort(function(l,d){return l.zIndex-d.zIndex}),t=[],n=[-Ru,-Ru],i=[this.width+Ru,this.height+Ru],o=0;o<e.length;o++){var s=e[o];s.visible&&(!this.partial||s.isSelected||this.isElementInArea(s,n,i,!1,!1))&&t.push(s)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(n){return n.state===en.TEXT_EDIT}),t=this.edges.find(function(n){return n.state===en.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),r.prototype.getAreaElement=function(e,t,n,i,o){var s=this;n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1);var l=[];return un(Zr(Zr([],Jn(this.nodes),!1),Jn(this.edges),!1),function(d){var c=s.isElementInArea(d,e,t,n,i);(!o||d.visible)&&c&&l.push(d)}),l},r.prototype.getModel=function(e){return this.modelMap.get(e)},r.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getPointByClient=function(e){var t=e.x,n=e.y,i=this.rootEl.getBoundingClientRect(),o={x:t-i.left,y:n-i.top},s=Jn(this.transformModel.HtmlPointToCanvasPoint([o.x,o.y]),2),l=s[0],d=s[1],c={x:l,y:d};return{domOverlayPosition:o,canvasOverlayPosition:c}},r.prototype.isElementInArea=function(e,t,n,i,o){var s;if(i===void 0&&(i=!0),o===void 0&&(o=!0),e.BaseType===xn.NODE){e=e;for(var l=Vr(e),d=l.minX,c=l.minY,f=l.maxX,v=l.maxY,g=[{x:d,y:c},{x:f,y:c},{x:f,y:v},{x:d,y:v}],y=o,b=0;b<g.length;b++){var x=g[b],w=x.x,_=x.y;if(s=Jn(this.transformModel.CanvasPointToHtmlPoint([w,_]),2),w=s[0],_=s[1],wf([w,_],t,n)!==o){y=!o;break}}return y}if(e.BaseType===xn.EDGE){e=e;var C=e.startPoint,k=e.endPoint,D=this.transformModel.CanvasPointToHtmlPoint([C.x,C.y]),R=this.transformModel.CanvasPointToHtmlPoint([k.x,k.y]),$=wf(D,t,n),P=wf(R,t,n);return i?$&&P:$||P}return!1},r.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=io(e.nodes,function(i){var o=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(o.id,o),t.nodeModelMap.set(o.id,o),o}):this.nodes=[],e.edges){var n=this.edgeType;this.edges=io(e.edges,function(i){var o,s=t.getModel((o=i.type)!==null&&o!==void 0?o:n);if(!s)throw new Error("找不到".concat(i.type,"对应的边。"));var l=new s(i,t);return t.edgeModelMap.set(l.id,l),t.elementsModelMap.set(l.id,l),l})}else this.edges=[]},r.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(n){var i=n.getData();i&&!n.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(n){var i=n.getData();i&&!n.virtual&&t.push(i)}),{nodes:t,edges:e}},r.prototype.modelToHistoryData=function(){for(var e=!1,t=[],n=0;n<this.nodes.length;n++){var i=this.nodes[n];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var o=!1,s=[],l=0;l<this.edges.length;l++){var d=this.edges[l];if(d.isDragging){o=!0;break}else s.push(d.getHistoryData())}return o?!1:{nodes:t,edges:s}},r.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getElement=function(e){return this.modelsMap[e]},r.prototype.getNodeEdges=function(e){for(var t=[],n=0;n<this.edges.length;n++){var i=this.edges[n],o=i.sourceNodeId===e,s=i.targetNodeId===e;(o||s)&&t.push(i)}return t},r.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,n={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===xn.NODE&&n.nodes.push(i.getData()),i.BaseType===xn.EDGE){var o=i.getData(),s=t.get(o.sourceNodeId)&&t.get(o.targetNodeId);(e||s)&&n.edges.push(o)}}),n},r.prototype.updateAttributes=function(e,t){var n=this.getElement(e);n==null||n.updateAttributes(t)},r.prototype.changeNodeId=function(e,t){return t||(t=Co()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(n){n.sourceNodeId===e&&(n.sourceNodeId=t),n.targetNodeId===e&&(n.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},r.prototype.changeEdgeId=function(e,t){return t||(t=Co()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(n){n.id===e&&n.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},r.prototype.getTextModel=function(e){var t=this.editConfigModel,n=t.textMode,i=t.nodeTextMode,o=t.edgeTextMode;if(e.BaseType===xn.NODE)return e.textMode||i||n||ii.TEXT;if(e.BaseType===xn.EDGE)return e.textMode||o||n||ii.TEXT},r.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},r.prototype.setFakeNode=function(e){this.fakeNode=e},r.prototype.removeFakeNode=function(){this.fakeNode=null},r.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},r.prototype.toFront=function(e){var t,n,i,o=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((n=this.edgesMap[e])===null||n===void 0?void 0:n.model);o&&(this.overlapMode===_i.DEFAULT&&((i=this.topElement)===null||i===void 0||i.setZIndex(),o.setZIndex(N3),this.topElement=o),this.overlapMode===_i.INCREASE&&this.setElementZIndex(e,"top"))},r.prototype.setElementZIndex=function(e,t){var n,i,o=((n=this.nodesMap[e])===null||n===void 0?void 0:n.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(o){var s=void 0;typeof t=="number"?s=t:(t==="top"&&(s=yp()),t==="bottom"&&(s=r8())),o.setZIndex(s)}},r.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,n=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(Ct.NODE_DELETE,{data:n,model:t})},r.prototype.addNode=function(e,t,n){t===void 0&&(t=Ct.NODE_ADD);var i=cr(e),o=i.id;o&&this.nodesMap[o]&&delete i.id;var s=this.getModelAfterSnapToGrid(i);this.nodes.push(s);var l=s.getData(),d={data:l};return n&&(d.e=n),this.eventCenter.emit(t,d),s},r.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),n=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,o=e.y;i&&o&&(e.x=os(i,this.gridSize,n),e.y=os(o,this.gridSize,n),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-o));var s=new t(e,this);return this.nodeModelMap.set(s.id,s),this.elementsModelMap.set(s.id,s),s},r.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){n.x+=30,n.y+=30,n.id="",typeof n.text=="object"&&n.text!==null&&(n.text.x+=30,n.text.y+=30);var i=this.addNode(n);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},r.prototype.moveNode=function(e,t,n,i){var o;i===void 0&&(i=!1);var s=this.nodesMap[e];if(!s){console.warn("不存在id为".concat(e,"的节点"));return}var l=s.model;o=Jn(l.getMoveDistance(t,n,i),2),t=o[0],n=o[1],this.moveEdge(e,t,n)},r.prototype.moveNode2Coordinate=function(e,t,n,i){i===void 0&&(i=!1);var o=this.nodesMap[e];if(!o){console.warn("不存在id为".concat(e,"的节点"));return}var s=o.model,l=s.x,d=s.y,c=t-l,f=n-d;this.moveNode(e,c,f,i)},r.prototype.editText=function(e){this.setElementStateById(e,en.TEXT_EDIT)},r.prototype.addEdge=function(e){var t=cr(e),n=t.type;n||(n=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(n);if(!i)throw new Error("找不到".concat(n,"对应的边，请确认是否已注册此类型边。"));var o=new i(ur(ur({},t),{type:n}),this);this.edgeModelMap.set(o.id,o),this.elementsModelMap.set(o.id,o);var s=o.getData();return this.edges.push(o),this.eventCenter.emit(Ct.EDGE_ADD,{data:s}),o},r.prototype.moveEdge=function(e,t,n){for(var i=0;i<this.edges.length;i++){var o=this.edges[i],s=o.textPosition,l=s.x,d=s.y,c=this.edges[i].sourceNodeId===e,f=this.edges[i].targetNodeId===e;c&&o.moveStartPoint(t,n),f&&o.moveEndPoint(t,n),(c||f)&&this.handleEdgeTextMove(o,l,d)}},r.prototype.handleEdgeTextMove=function(e,t,n){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===Wt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var o=e.text,s=Tw(o,e.points);e.moveText(s.x-o.x,s.y-o.y)}var l=e.textPosition,d=l.x,c=l.y;e.moveText(d-t,c-n)},r.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var n=0;n<this.edges.length;n++)if(this.edges[n].sourceNodeId===e&&this.edges[n].targetNodeId===t){var i=this.edges[n].getData();this.edges.splice(n,1),n--,this.eventCenter.emit(Ct.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var n=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(n,1),this.eventCenter.emit(Ct.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(Ct.EDGE_DELETE,{data:n})}},r.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(Ct.EDGE_DELETE,{data:n})}},r.prototype.setElementStateById=function(e,t,n){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(en.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(en.DEFAULT)})},r.prototype.updateText=function(e,t){var n=oa(Zr(Zr([],Jn(this.nodes),!1),Jn(this.edges),!1),function(i){return i.id===e});n==null||n.updateText(t)},r.prototype.selectNodeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.nodesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectEdgeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.edgesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var n=this.getElement(e);n==null||n.setSelected(!0)},r.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},r.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===_i.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},r.prototype.moveNodes=function(e,t,n,i){var o,s,l,d=this;i===void 0&&(i=!1);for(var c=e.reduce(function(k,D){var R,$=(R=d.nodesMap[D])===null||R===void 0?void 0:R.model;return $&&(k[D]=$.getMoveDistance(t,n,i)),k},{}),f=0;f<this.edges.length;f++){var v=this.edges[f],g=v.textPosition,y=g.x,b=g.y,x=c[v.sourceNodeId],w=c[v.targetNodeId],_=void 0,C=void 0;x&&w&&v.modelType===Wt.POLYLINE_EDGE?(o=Jn(x,2),_=o[0],C=o[1],v.updatePointsList(_,C)):(x&&(s=Jn(x,2),_=s[0],C=s[1],v.moveStartPoint(_,C)),w&&(l=Jn(w,2),_=l[0],C=l[1],v.moveEndPoint(_,C))),(x||w)&&this.handleEdgeTextMove(v,y,b)}},r.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},r.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},r.prototype.setDefaultEdgeType=function(e){this.edgeType=e},r.prototype.changeNodeType=function(e,t){var n=this.getNodeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的节点"));return}var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var s=new o(i,this);this.nodes.splice(this.nodesMap[e].index,1,s);var l=this.getNodeEdges(e);l.forEach(function(d){if(d.sourceNodeId===e){var c=Wm(s,d.startPoint,s.width,s.height);d.updateStartPoint(c)}if(d.targetNodeId===e){var c=Wm(s,d.endPoint,s.width,s.height);d.updateEndPoint(c)}})},r.prototype.changeEdgeType=function(e,t){var n=this.getEdgeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的边"));return}if(n.type!==t){var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var s=new o(i,this);this.edges.splice(this.edgesMap[e].index,1,s)}},r.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetNodeId===e&&t.push(n)}),t},r.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceNodeId===e&&t.push(n)}),t},r.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetAnchorId===e&&t.push(n)}),t},r.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceAnchorId===e&&t.push(n)}),t},r.prototype.getNodeIncomingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){var o;i.targetNodeId===e&&n.push((o=t.nodesMap[i.sourceNodeId])===null||o===void 0?void 0:o.model)}),n},r.prototype.getNodeOutgoingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&n.push(t.nodesMap[i.targetNodeId].model)}),n},r.prototype.setTheme=function(e,t){var n;if(t&&(Pl[t]&&this.updateBackgroundOptions(ur(ur({},typeof this.background=="object"?this.background:{}),Pl[t])),Rl[t]&&this.updateGridOptions(Xa.getGridOptions(ur(ur({},this.grid),Rl[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=Xa.getGridOptions((n=e.grid)!==null&&n!==void 0?n:!1);this.updateGridOptions(i)}this.theme=e8(ur(ur({},this.customStyles),e),t),this.customStyles=ur(ur({},this.customStyles),e)},r.prototype.getTheme=function(){var e=this,t=e.background,n=e.grid,i=ur(ur({},Ht(this.theme)),{background:t,grid:n});return i},r.prototype.updateGridOptions=function(e){Ya(this.grid,e)},r.prototype.updateGridSize=function(e){this.gridSize=e},r.prototype.updateBackgroundOptions=function(e){Vf(e)||Vf(this.background)?this.background=e:this.background=ur(ur({},this.background),e)},r.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=xr(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=xr(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},r.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},r.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],n=[];e.forEach(function(g){var y=g.x,b=g.y,x=g.width,w=g.height,_=g.getNodeStyle().strokeWidth,C=_===void 0?0:_,k=y+x/2+C,D=y-x/2-C,R=b+w/2+C,$=b-w/2-C;t=t.concat([k,D].filter(function(P){return!Number.isNaN(P)})),n=n.concat([R,$].filter(function(P){return!Number.isNaN(P)}))});var i=Math.min.apply(Math,Zr([],Jn(t),!1)),o=Math.max.apply(Math,Zr([],Jn(t),!1)),s=Math.min.apply(Math,Zr([],Jn(n),!1)),l=Math.max.apply(Math,Zr([],Jn(n),!1)),d=o-i||0,c=l-s||0,f=i+d/2,v=s+c/2;return{width:d,height:c,x:f,y:v}},r.prototype.translateCenter=function(){var e=this,t=e.nodes,n=e.width,i=e.height,o=e.rootEl,s=e.transformModel;if(t.length){var l=n||o.clientWidth,d=i||o.clientHeight,c=this.getVirtualRectSize(),f=c.x,v=c.y;s.focusOn(f,v,l,d)}},r.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var n=this,i=n.nodes,o=n.width,s=n.height,l=n.rootEl,d=n.transformModel;if(i.length){var c=o||l.clientWidth,f=s||l.clientHeight,v=this.getVirtualRectSize(),g=v.width,y=v.height,b=v.x,x=v.y,w=(g+t)/c,_=(y+e)/f,C=1/Math.max(w,_),k=[c/2,f/2];d.zoom(C,k),d.focusOn(b,x,c,f)}},r.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},r.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},r.prototype.getPartial=function(){return this.partial},r.prototype.setPartial=function(e){this.partial=e},r.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},Et([Ae],r.prototype,"width",void 0),Et([Ae],r.prototype,"height",void 0),Et([Ae],r.prototype,"theme",void 0),Et([Ae],r.prototype,"grid",void 0),Et([Ae],r.prototype,"edgeType",void 0),Et([Ae],r.prototype,"nodes",void 0),Et([Ae],r.prototype,"edges",void 0),Et([Ae],r.prototype,"fakeNode",void 0),Et([Ae],r.prototype,"overlapMode",void 0),Et([Ae],r.prototype,"background",void 0),Et([Ae],r.prototype,"gridSize",void 0),Et([Ae],r.prototype,"transformModel",void 0),Et([Ae],r.prototype,"editConfigModel",void 0),Et([Ae],r.prototype,"partial",void 0),Et([fn],r.prototype,"nodesMap",null),Et([fn],r.prototype,"edgesMap",null),Et([fn],r.prototype,"modelsMap",null),Et([fn],r.prototype,"sortElements",null),Et([fn],r.prototype,"textEditElement",null),Et([fn],r.prototype,"selectElements",null),Et([fn],r.prototype,"selectNodes",null),Et([Me],r.prototype,"setTextMode",null),Et([Me],r.prototype,"setFakeNode",null),Et([Me],r.prototype,"removeFakeNode",null),Et([Me],r.prototype,"setModel",null),Et([Me],r.prototype,"toFront",null),Et([Me],r.prototype,"setElementZIndex",null),Et([Me],r.prototype,"deleteNode",null),Et([Me],r.prototype,"addNode",null),Et([Me],r.prototype,"cloneNode",null),Et([Me],r.prototype,"moveNode",null),Et([Me],r.prototype,"moveNode2Coordinate",null),Et([Me],r.prototype,"editText",null),Et([Me],r.prototype,"addEdge",null),Et([Me],r.prototype,"moveEdge",null),Et([Me],r.prototype,"deleteEdgeBySourceAndTarget",null),Et([Me],r.prototype,"deleteEdgeById",null),Et([Me],r.prototype,"deleteEdgeBySource",null),Et([Me],r.prototype,"deleteEdgeByTarget",null),Et([Me],r.prototype,"setElementStateById",null),Et([Me],r.prototype,"updateText",null),Et([Me],r.prototype,"selectNodeById",null),Et([Me],r.prototype,"selectEdgeById",null),Et([Me],r.prototype,"selectElementById",null),Et([Me],r.prototype,"deselectElementById",null),Et([Me],r.prototype,"clearSelectElements",null),Et([Me],r.prototype,"moveNodes",null),Et([Me],r.prototype,"setDefaultEdgeType",null),Et([Me],r.prototype,"changeNodeType",null),Et([Me],r.prototype,"changeEdgeType",null),Et([Me],r.prototype,"getNodeIncomingEdge",null),Et([Me],r.prototype,"getNodeOutgoingEdge",null),Et([Me],r.prototype,"getAnchorIncomingEdge",null),Et([Me],r.prototype,"getAnchorOutgoingEdge",null),Et([Me],r.prototype,"getNodeIncomingNode",null),Et([Me],r.prototype,"getNodeOutgoingNode",null),Et([Me],r.prototype,"setTheme",null),Et([Me],r.prototype,"getTheme",null),Et([Me],r.prototype,"resize",null),Et([Me],r.prototype,"clearData",null),Et([Me],r.prototype,"translateCenter",null),Et([Me],r.prototype,"fitView",null),Et([Me],r.prototype,"openEdgeAnimation",null),Et([Me],r.prototype,"closeEdgeAnimation",null),Et([Me],r.prototype,"setPartial",null),r}(),Jo=function(){return Jo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Jo.apply(this,arguments)},el=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Q8=function(){function r(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return r.prototype.getStyle=function(){return Jo({},this.graphModel.theme.snapline)},r.prototype.getCenterSnapLine=function(e,t){for(var n=e.x,i=e.y,o=!1,s=!1,l=0;l<t.length;l++){var d=t[l];if(d.id!==e.id&&(hi(n,d.x,this.epsilon)&&(o=!0),hi(i,d.y,this.epsilon)&&(s=!0),o&&s))break}return{isShowVertical:o,isShowHorizontal:s,position:{x:n,y:i}}},r.prototype.getHorizontalSnapline=function(e,t){var n=!1,i=0,o=e.id,s;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)s=Vr(l);else{var d=this.graphModel.getNodeModelById(o);d&&(s=Vr(d))}}for(var c=0;c<t.length;c++){var f=t[c];if(f.id!==e.id){var v=Vr(f);if(hi(v.minY,s==null?void 0:s.minY,this.epsilon)||hi(v.maxY,s==null?void 0:s.minY,this.epsilon)){n=!0,i=s.minY;break}if(hi(v.minY,s==null?void 0:s.maxY,this.epsilon)||hi(v.maxY,s==null?void 0:s.maxY,this.epsilon)){n=!0,i=s.maxY;break}}}return{isShowHorizontal:n,isShowVertical:this.isShowVertical,position:Jo(Jo({},this.position),{y:i})}},r.prototype.getVerticalSnapline=function(e,t){var n=!1,i=0,o=e.id,s;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)s=Vr(l);else{var d=this.graphModel.getNodeModelById(o);d&&(s=Vr(d))}}for(var c=0;c<t.length;c++){var f=t[c];if(f.id!==e.id){var v=Vr(f);if(hi(v.minX,s==null?void 0:s.minX,this.epsilon)){n=!0,i=s.minX;break}if(hi(v.minX,s==null?void 0:s.minX,this.epsilon)||hi(v.maxX,s==null?void 0:s.minX,this.epsilon)){n=!0,i=s.minX;break}if(hi(v.minX,s==null?void 0:s.maxX,this.epsilon)||hi(v.maxX,s==null?void 0:s.maxX,this.epsilon)){n=!0,i=s.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:n,position:Jo(Jo({},this.position),{x:i})}},r.prototype.getSnapLinePosition=function(e,t){var n=this.getCenterSnapLine(e,t),i=n.isShowHorizontal,o=n.isShowVertical;if(!i){var s=this.getHorizontalSnapline(e,t);s.isShowHorizontal&&(n.isShowHorizontal=s.isShowHorizontal,n.position.y=s.position.y)}if(!o){var l=this.getVerticalSnapline(e,t);l.isShowVertical&&(n.isShowVertical=l.isShowVertical,n.position.x=l.position.x)}return n},r.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,n=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=n},r.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},r.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,n=this.getSnapLinePosition(e,t);this.setSnaplineInfo(n)},el([Ae],r.prototype,"isShowHorizontal",void 0),el([Ae],r.prototype,"isShowVertical",void 0),el([Ae],r.prototype,"position",void 0),el([Me],r.prototype,"clearSnapline",null),el([Me],r.prototype,"setNodeSnapLine",null),r}();function hi(r,e,t){return Math.abs(r-e)<=t}var eB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),tB=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},nB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},rB=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},iB=function(r){eB(e,r);function e(){var t=r.apply(this,rB([],nB(arguments),!1))||this;return t.handleResize=function(){var n=t.props,i=n.graphModel,o=n.options,s=i.width,l=i.height,d=i.isContainerWidth,c=i.isContainerHeight,f=s,v=l,g=!1;d&&(f=void 0,g=!0),c&&(v=void 0,g=!0),g&&i.resize(f,v),o.width=s,o.height=l},t.throttleResize=QC(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(Ct.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,n,i){i===void 0&&(i="canvas-overlay");var o=this.props.getView,s=o(t.type);return s?Ne(s,{model:t,graphModel:n,overlay:i},t.id):null},e.prototype.render=function(){var t=this,n=this.props,i=n.graphModel,o=n.tool,s=n.options,l=n.dnd,d=n.snaplineModel,c={};s.width&&(c.width="".concat(i.width,"px")),s.height&&(c.height="".concat(i.height,"px"));var f=i.fakeNode,v=i.editConfigModel,g=i.background,y=v.adjustEdge;return Ne("div",{className:"lf-graph","flow-id":i.flowId,style:c,children:[Ne(O8,{graphModel:i,dnd:l,children:[Ne("g",{className:"lf-base",children:io(i.sortElements,function(b){return t.getComponent(b,i)})}),f?this.getComponent(f,i):""]}),Ne(B8,{graphModel:i,children:[Ne($8,{graphModel:i}),y?Ne(N8,{graphModel:i}):"",s.snapline!==!1?Ne(W8,{snaplineModel:d}):""]}),Ne(X8,{graphModel:i,tool:o}),g&&Ne(D8,{background:g}),Ne(Xa,{graphModel:i})]})},e=tB([Sr],e),e}(Gt),oB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bi=function(){return Bi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bi.apply(this,arguments)},aB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},sB=function(r){oB(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(n){var i=n.event,o=t.props,s=o.anchorData,l=o.nodeModel,d=o.graphModel;d.selectNodeById(l.id),l.autoToFront&&d.toFront(l.id),d.eventCenter.emit(Ct.ANCHOR_DRAGSTART,{data:s,e:i,nodeModel:l}),t.setState({startX:s.x,startY:s.y,endX:s.x,endY:s.y})},t.onDragging=function(n){var i=n.event,o=t.props,s=o.graphModel,l=o.nodeModel,d=o.anchorData,c=s.transformModel,f=s.eventCenter,v=s.width,g=s.height,y=s.editConfigModel,b=y.autoExpand,x=y.stopMoveGraph;if(i){var w=i.clientX,_=i.clientY,C=s.getPointByClient({x:w,y:_}),k=C.domOverlayPosition,D=k.x,R=k.y,$=C.canvasOverlayPosition,P=$.x,I=$.y;t.t&&Od(t.t);var W=[],se=10;D<10?W=[se,0]:D+10>v?W=[-se,0]:R<10?W=[0,se]:R+10>g&&(W=[0,-se]),t.setState({endX:P,endY:I,dragging:!0}),t.moveAnchorEnd(P,I),W.length>0&&!x&&b&&(t.t=Rw(function(){var q=aB(W,2),ee=q[0],T=q[1];c.translate(ee,T);var z=t.state,B=z.endX,pe=z.endY;t.setState({endX:B-ee,endY:pe-T}),t.moveAnchorEnd(B-ee,pe-T)})),f.emit(Ct.ANCHOR_DRAG,{data:d,e:i,nodeModel:l})}},t.onDragEnd=function(n){var i=n.event;t.t&&Od(t.t);var o=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var s=t.props,l=s.graphModel,d=s.nodeModel,c=s.anchorData;l.eventCenter.emit(Ct.ANCHOR_DRAGEND,{data:c,e:i,nodeModel:d,edgeModel:o??void 0})},t.checkEnd=function(n){var i,o=t.props,s=o.graphModel,l=o.nodeModel,d=o.anchorData,c=d.x,f=d.y,v=d.id,g=t.state,y=g.endX,b=g.endY,x=g.dragging,w=Ed({x:y,y:b},s);if(t.preTargetNode&&t.preTargetNode.state!==en.DEFAULT&&t.preTargetNode.setElementState(en.DEFAULT),!!x&&w&&w.node){var _=w.node,C=w.anchor.id,k="".concat(l.id,"_").concat(_.id,"_").concat(C,"_").concat(v),D=t.sourceRuleResults.get(k)||{},R=D.isAllPass,$=D.msg,P=t.targetRuleResults.get(k)||{},I=P.isAllPass,W=P.msg;if(R&&I){_.setElementState(en.DEFAULT);var se=s.getNodeModelById(w.node.id),q=(i=s.edgeGenerator)===null||i===void 0?void 0:i.call(s,l.getData(),se==null?void 0:se.getData()),ee=s.addEdge(Bi(Bi({},q),{sourceNodeId:l.id,sourceAnchorId:v,startPoint:{x:c,y:f},targetNodeId:w.node.id,targetAnchorId:w.anchor.id,endPoint:{x:w.anchor.x,y:w.anchor.y}})),T=t.props.anchorData;return s.eventCenter.emit(Ct.ANCHOR_DROP,{data:T,e:n,nodeModel:l,edgeModel:ee}),ee}var z=_.getData();return s.eventCenter.emit(Ct.CONNECTION_NOT_ALLOWED,{data:z,msg:W||$||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new ai({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,n=t.anchorData,i=t.style,o=t.node,s=o.getAnchorShape(n);if(s)return s;var l=n.x,d=n.y,c=Bi(Bi({},i),i==null?void 0:i.hover);return Ne("g",{children:[Ne(ss,Bi({className:"lf-node-anchor-hover"},c,{x:l,y:d})),Ne(ss,Bi({className:"lf-node-anchor"},i,{x:l,y:d}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,n=t.graphModel,i=n.getAnchorIncomingEdge,o=n.getAnchorOutgoingEdge,s=t.anchorData.id;return{incomingEdgeList:i(s),outgoingEdgeList:o(s)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,n){var i,o,s=this.props,l=s.graphModel,d=s.nodeModel,c=s.anchorData,f=Ed({x:t,y:n},l);if(f){var v=f.node,g=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(en.DEFAULT),c.id===g)return;this.preTargetNode=v;var y="".concat(d.id,"_").concat(v.id,"_").concat(g,"_").concat(c.id);if(!this.targetRuleResults.has(y)){var b=f.anchor,x=d.isAllowConnectedAsSource(v,c,b),w=v.isAllowConnectedAsTarget(d,c,b);this.sourceRuleResults.set(y,Cd(x)),this.targetRuleResults.set(y,Cd(w))}var _=((i=this.sourceRuleResults.get(y))!==null&&i!==void 0?i:{}).isAllPass,C=((o=this.targetRuleResults.get(y))!==null&&o!==void 0?o:{}).isAllPass;_&&C?v.setElementState(en.ALLOW_CONNECT):v.setElementState(en.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==en.DEFAULT&&this.preTargetNode.setElementState(en.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,n=t.startX,i=t.startY,o=t.endX,s=t.endY,l=bi(n,i,o,s);return l>10},e.prototype.render=function(){var t=this,n=this.state,i=n.startX,o=n.startY,s=n.endX,l=n.endY,d=this.props,c=d.anchorData,f=d.edgeStyle,v=d.nodeModel,g=d.graphModel,y=c.edgeAddable;return Ne("g",{className:"lf-anchor",children:[Ne("g",{onClick:function(b){b.stopPropagation(),g.eventCenter.emit(Ct.ANCHOR_CLICK,{data:c,e:b,nodeModel:v})},onMouseDown:function(b){g.eventCenter.emit(Ct.ANCHOR_MOUSEDOWN,{data:c,e:b,nodeModel:v}),y!==!1&&t.dragHandler.handleMouseDown(b)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(Bi({sourcePoint:{x:i,y:o},targetPoint:{x:s,y:l}},f)):Ne(as,Bi({x1:i,y1:o,x2:s,y2:l},f,{"pointer-events":"none"})))]})},e}(Gt),lB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),xh=function(){return xh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},xh.apply(this,arguments)},uB=function(r){lB(e,r);function e(t){var n=r.call(this,t)||this;return n.style={},n.onDragging=function(i){var o,s=i.event,l=n.props,d=l.graphModel,c=l.nodeModel,f=l.eventCenter,v=d.selectNodes,g=c.x,y=c.y,b=s.clientX,x=s.clientY,w=d.getPointByClient({x:b,y:x}).canvasOverlayPosition,_=w.x,C=w.y,k=new ir(_-g,C-y),D=((o=n.normal)===null||o===void 0?void 0:o.angle(k))-n.defaultAngle,R=new wd(-g,-y).rotate(D).translate(g,y).toString();c.transform=R,c.rotate=D;var $=io(v,function(I){return I.id});$.indexOf(c.id)===-1&&($=[c.id]);var P=eO($,function(I,W){var se=d.getNodeModelById(W);return I[W]=se==null?void 0:se.getMoveDistance(0,0,!1),I},{});$.forEach(function(I){var W=d.getNodeEdges(I);W.forEach(function(se){if(P[se.sourceNodeId]){var q=d.getNodeModelById(se.sourceNodeId),ee=q.anchors.find(function(T){return T.id===se.sourceAnchorId});se.updateStartPoint(ee)}if(P[se.targetNodeId]){var q=d.getNodeModelById(se.targetNodeId),ee=q.anchors.find(function(B){return B.id===se.targetAnchorId});se.updateEndPoint(ee)}})}),f.emit(Ct.NODE_ROTATE,{e:s,model:c,data:c.getData()})},n.style=t.style,n.stepperDrag=new ai({onDragging:n.onDragging}),n}return e.prototype.render=function(){var t=this,n=this.props.nodeModel,i=n.x,o=n.y,s=n.width,l=n.height,d=i+s/2+20,c=o-l/2-20;return this.normal=new ir(1,0),this.defaultAngle=this.normal.angle(new ir(d-i,c-o)),n.defaultAngle=this.defaultAngle,Ne("g",{className:"lf-rotate-control",children:Ne("g",{onMouseDown:function(f){t.stepperDrag.handleMouseDown(f)},children:Ne(ss,xh({},this.style,{cx:d,cy:c}))})})},e}(Gt),kf={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var ny;function dB(){return ny||(ny=1,function(r){(function(){var e={}.hasOwnProperty;function t(){for(var o="",s=0;s<arguments.length;s++){var l=arguments[s];l&&(o=i(o,n(l)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var s="";for(var l in o)e.call(o,l)&&o[l]&&(s=i(s,l));return s}function i(o,s){return s?o?o+" "+s:o+s:o}r.exports?(t.default=t,r.exports=t):window.classNames=t})()}(kf)),kf.exports}var cB=dB();const wh=fs(cB);var fB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Sh=function(){return Sh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Sh.apply(this,arguments)},hB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},zw=function(r){fB(e,r);function e(t){var n=r.call(this)||this;n.mouseDownHandler=function(o){var s=n.props,l=s.draggable,d=s.model,c=s.graphModel,f=c.editConfigModel.nodeTextDraggable;(l??f)&&(o.stopPropagation(),n.stepperDrag.model=d,n.stepperDrag.handleMouseDown(o))},n.onDragging=function(o){var s=o.deltaX,l=o.deltaY,d=n.props,c=d.model,f=d.graphModel.transformModel;if(s||l){var v=hB(f.fixDeltaXY(s,l),2),g=v[0],y=v[1];c.moveText(g,y)}},n.dbClickHandler=function(){var o=n.props,s=o.editable,l=o.graphModel.eventCenter,d=o.model;s&&d.setElementState(en.TEXT_EDIT),l.emit(Ct.TEXT_DBCLICK,{data:d.text,model:d})};var i=t.draggable;return n.stepperDrag=new ai({onDragging:n.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),n}return e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=n.text,l=s.value,d=s.x,c=s.y,f=s.editable,v=s.draggable,g={x:d,y:c,className:"",value:l},y=n.getTextStyle(),b=o.nodeTextDraggable||v;return Ne(Iw,Sh({},g,y,{className:wh({"lf-element-text":f,"lf-text-draggable":!f&&b,"lf-text-disabled":!f&&!b}),model:n}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return Ne("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(Gt),pB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),pi=function(){return pi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},pi.apply(this,arguments)},Xu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},vB=function(r){pB(e,r);function e(t){var n=r.call(this,t)||this;return n.setHoverOn=function(){n.setState({isHovered:!0})},n.setHoverOff=function(){n.setState({isHovered:!1})},n.state={isHovered:!1},n}return e.prototype.getBackground=function(){var t=this.state.isHovered,n=this.props.model,i=n.text,o=n.getTextStyle(),s=o.background||{};if(t&&o.hover&&o.hover.background&&(s=pi(pi({},s),o.hover.background)),i!=null&&i.value&&(s==null?void 0:s.fill)!=="transparent"){var l=o.fontSize,d=o.textWidth,c=o.lineHeight,f=o.overflowMode,v=s.wrapPadding,g=i==null?void 0:i.value.split(/[\r\n]/g),y=g.length,b=i.x,x=i.y,w={};if(f==="autoWrap"&&d){var _=Pw({rows:g,style:{fontSize:"".concat(l,"px"),width:"".concat(d,"px"),lineHeight:c,padding:v},rowsLength:y,className:"lf-get-text-height"});w=pi(pi({},s),{x:b,y:x,width:d,height:_})}else{var C=Z3({rows:g,rowsLength:y,fontSize:l}),k=C.width,D=C.height;if(f==="ellipsis"&&(k=d,D=l+2),typeof s.wrapPadding=="string"){var R=s.wrapPadding.split(",").filter(function(it){return it.trim()}).map(function(it){return parseFloat(it.trim())});if(R.length>0&&R.length<=4){if(R.length===1){var $=Xu(R,1),P=$[0];R=[P,P,P,P]}else if(R.length===2){var I=Xu(R,2),W=I[0],se=I[1];R=[W,se,W,se]}else if(R.length===3){var q=Xu(R,3),ee=q[0],se=q[1],T=q[2];R=[ee,se,T,se]}var z=Xu(R,4),B=z[0],pe=z[1],Ee=z[2],ye=z[3];k+=pe+ye,D+=B+Ee,b=b+(pe-ye)/2,x=x+(Ee-B)/2}}w=pi(pi({},s),{x:b-1,y:x-1,width:k,height:D})}return Ne(ni,pi({},w))}return null},e.prototype.getShape=function(){var t=this.props.model,n=t.text,i=n.x,o=n.y,s=n.value;if(!s)return null;var l=t.getTextStyle(),d=pi({x:i,y:o,value:s,model:t,className:"lf-element-text"},l);return Ne("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),Ne(Iw,pi({},d))]})},e}(zw),gB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ad=function(){return Ad=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ad.apply(this,arguments)},mB=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Gu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Do=function(r){gB(e,r);function e(t){var n=r.call(this)||this;n.onDragStart=function(d){var c=d.event,f=n.props,v=f.model,g=f.graphModel;if(c){var y=g.getPointByClient({x:c.clientX,y:c.clientY}).canvasOverlayPosition,b=y.x,x=y.y;n.moveOffset={dx:v.x-b,dy:v.y-x}}},n.onDragging=function(d){var c,f,v,g,y=d.event,b=n.props,x=b.model,w=b.graphModel,_=w.editConfigModel,C=_.stopMoveGraph,k=_.autoExpand,D=_.snapGrid,R=w.transformModel,$=w.selectNodes,P=w.width,I=w.height,W=w.gridSize;x.isDragging=!0;var se=y,q=se.clientX,ee=se.clientY,T=w.getPointByClient({x:q,y:ee}).canvasOverlayPosition,z=T.x,B=T.y,pe=Gu(R.CanvasPointToHtmlPoint([z,B]),2),Ee=pe[0],ye=pe[1];if(z=z+((f=(c=n.moveOffset)===null||c===void 0?void 0:c.dx)!==null&&f!==void 0?f:0),B=B+((g=(v=n.moveOffset)===null||v===void 0?void 0:v.dy)!==null&&g!==void 0?g:0),z=os(z,W,D),B=os(B,W,D),!P||!I){w.moveNode2Coordinate(x.id,z,B);return}var it=Ee<0||ye<0||Ee>P||ye>I;if(!(k&&!C&&it)){var Oe=Gu(R.CanvasPointToHtmlPoint([z-x.width/2,B-x.height/2]),2),he=Oe[0],We=Oe[1],Re=Gu(R.CanvasPointToHtmlPoint([z+x.width/2,B+x.height/2]),2),Ge=Re[0],le=Re[1],G=Math.max(W,20),oe=[];he<0?oe=[G,0]:Ge>w.width?oe=[-G,0]:We<0?oe=[0,G]:le>w.height&&(oe=[0,-G]),n.t&&Od(n.t);var de=$.map(function(ke){return ke.id});de.indexOf(x.id)===-1&&(de=[x.id]),oe.length>0&&!C&&k?n.t=Rw(function(){var ke=Gu(oe,2),Ye=ke[0],Ie=ke[1];R.translate(Ye??0,Ie??0);var Fe=-(Ye??0)/R.SCALE_X,Ot=-(Ie??0)/R.SCALE_X;w.moveNodes(de,Fe,Ot)}):w.moveNodes(de,z-x.x,B-x.y)}},n.onDragEnd=function(){n.t&&Od(n.t);var d=n.props.model;d.isDragging=!1},n.onMouseOut=function(d){M3()&&n.setHoverOff(d)},n.handleMouseUp=function(){var d=n.props.model;n.mouseUpDrag=d.isDragging},n.handleClick=function(d){var c=n.mouseUpDrag===!1;if(n.startTime){var f=n.props,v=f.model,g=f.graphModel;if(c){var y=v.getData(),b=g.getPointByClient({x:d.clientX,y:d.clientY}),x={data:y,e:d,position:b,isSelected:!1,isMultiple:!1},w=d.button===2,_=d.detail===2;if(!w){var C=g.editConfigModel,k=Dw(d,C);x.isMultiple=k,v.isSelected&&!_&&k?(x.isSelected=!1,v.setSelected(!1)):(g.selectNodeById(v.id,k),x.isSelected=!0,C.isSilentMode||n.toFront()),_?(C.nodeTextEdit&&v.text.editable&&C.textMode===ii.TEXT&&(v.setSelected(!1),g.setElementStateById(v.id,en.TEXT_EDIT)),g.eventCenter.emit(Ct.NODE_DBCLICK,x)):(g.eventCenter.emit(Ct.ELEMENT_CLICK,x),g.eventCenter.emit(Ct.NODE_CLICK,x))}}}},n.handleContextMenu=function(d){d.preventDefault();var c=n.props,f=c.model,v=c.graphModel,g=v.editConfigModel,y=f.getData(),b=v.getPointByClient({x:d.clientX,y:d.clientY});v.setElementStateById(f.id,en.SHOW_MENU,b.domOverlayPosition),f.isSelected||v.selectNodeById(f.id),v.eventCenter.emit(Ct.NODE_CONTEXTMENU,{data:y,e:d,position:b}),g.isSilentMode||n.toFront()},n.handleMouseDown=function(d){var c=n.props,f=c.model,v=c.graphModel;n.startTime=new Date().getTime();var g=v.editConfigModel;g.adjustNodePosition&&f.draggable&&n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.handleFocus=function(){var d=n.props,c=d.model,f=d.graphModel;f.eventCenter.emit(Ct.NODE_FOCUS,{data:c.getData()})},n.handleBlur=function(){var d=n.props,c=d.model,f=d.graphModel;f.eventCenter.emit(Ct.NODE_BLUR,{data:c.getData()})},n.setHoverOn=function(d){var c=n.props,f=c.model,v=c.graphModel;if(!f.isHovered){var g=f.getData();f.setHovered(!0),v.eventCenter.emit(Ct.NODE_MOUSEENTER,{data:g,e:d})}},n.setHoverOff=function(d){var c=n.props,f=c.model,v=c.graphModel,g=f.getData();f.isHovered&&(f.setHovered(!1),v.eventCenter.emit(Ct.NODE_MOUSELEAVE,{data:g,e:d}))};var i=t.graphModel,o=i.gridSize,s=i.eventCenter,l=t.model;return n.stepDrag=new ai({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"NODE",isStopPropagation:!1,eventCenter:s,model:l}),n.modelDisposer=aw(function(){return n.props},function(d){d&&d.model&&n.stepDrag.setModel(d.model)}),n}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,n=this.props,i=n.model,o=n.graphModel,s=i.isSelected,l=i.isHitable,d=i.isDragging,c=i.isShowAnchor;return l&&(s||c)&&!d?io(i.anchors,function(f,v){var g=i.getAnchorLineStyle(f),y=i.getAnchorStyle(f);return Ne(sB,{anchorData:f,node:t,style:y,edgeStyle:g,anchorIndex:v,nodeModel:i,graphModel:o,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.isSilentMode,l=o.allowRotate,d=n.isSelected,c=n.isHitable,f=n.rotatable,v=n.isHovered,g=l&&f,y=n.getRotateControlStyle();if(!s&&c&&(d||v)&&g)return Ne(uB,{graphModel:i,nodeModel:n,eventCenter:i.eventCenter,style:y})},e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.isSilentMode,l=o.allowResize,d=n.isSelected,c=n.isHitable,f=n.resizable,v=n.isHovered,g=l&&f,y=n.getResizeControlStyle();return!s&&c&&(d||v)&&g?Ne(MI,{style:y,model:n,graphModel:i}):null},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,s=o.editConfigModel;if(s.nodeTextMode!==ii.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var l=!1;return s.nodeTextDraggable&&i.text.draggable&&(l=!0),Ne(zw,{editable:s.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,n=t.state,i=t.isDragging,o=t.isSelected,s="lf-node";switch(n){case en.ALLOW_CONNECT:s+=" lf-node-allow";break;case en.NOT_ALLOW_CONNECT:s+=" lf-node-not-allow";break;default:s+=" lf-node-default";break}return i&&(s+=" lf-dragging"),o&&(s+=" lf-node-selected"),s},e.prototype.toFront=function(){var t=this.props,n=t.model,i=t.graphModel;n.autoToFront&&i.toFront(n.id)},e.prototype.render=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.hideAnchors,l=o.adjustNodePosition,d=o.allowRotate,c=o.allowResize,f=i.gridSize,v=i.transformModel.SCALE_X,g=n.isHitable,y=n.draggable,b=n.transform,x=n.getOuterGAttributes(),w=x.className,_=w===void 0?"":w,C=mB(x,["className"]),k=Ne("g",{className:"lf-node-content",children:[Ne("g",{transform:b,children:[this.getShape(),this.getText(),d&&this.getRotateControl(),c&&this.getResizeControl()]}),!s&&this.getAnchors()]}),D;return g?(l&&y&&this.stepDrag.setStep(f*v),D=Ne("g",Ad({className:"".concat(this.getStateClassName()," ").concat(_),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},C,{children:k}))):D=Ne("g",Ad({className:"".concat(this.getStateClassName()," ").concat(_)},C,{children:k})),D},e.isObserved=!1,e}(Gt),yB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Eh=function(){return Eh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Eh.apply(this,arguments)},la=function(r){yB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Ne(ni,Eh({},n,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(Do),_B=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ch=function(){return Ch=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ch.apply(this,arguments)},Td=function(r){_B(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.r,s=t.getNodeStyle();return Ne(ss,Ch({},s,{x:n,y:i,r:o}))},e}(Do),bB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dd=function(){return Dd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dd.apply(this,arguments)},Ld=function(r){bB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points,c=t.getNodeStyle(),f={transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(o-l/2,")")};return Ne("g",Dd({},f,{children:Ne(mp,Dd({},c,{points:d,x:i,y:o}))}))},e}(Do),xB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Oh=function(){return Oh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Oh.apply(this,arguments)},kh=function(r){xB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Ne("g",{children:Ne(mp,Oh({},n,{points:t.points,x:t.x,y:t.y}))})},e}(Do),wB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Mh=function(){return Mh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Mh.apply(this,arguments)},Nh=function(r){wB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Ne(bI,Mh({},n,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(Do),SB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yl=function(){return yl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yl.apply(this,arguments)},ry=function(r){SB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,n=t.getTextStyle(),i=t.width,o=t.height,s=t.x,l=t.y,d=yl(yl({},n.background),{x:s,y:l,width:i,height:o});return Ne(ni,yl({},d))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return Ne("g",{children:this.getBackground()})},e}(Do),EB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ah=function(){return Ah=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ah.apply(this,arguments)},CB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},OB=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},jl=function(r){EB(e,r);function e(){var t=r.apply(this,OB([],CB(arguments),!1))||this;return t.ref=lc(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.height,s=t.width,l=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),Ne("foreignObject",Ah({},l,{x:n-s/2,y:i-o/2,width:s,height:o,ref:this.ref}))},e}(Do),kB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vi=function(){return vi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vi.apply(this,arguments)},MB=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},NB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Hi;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(Hi||(Hi={}));var iy=function(r){kB(e,r);function e(t){var n=r.call(this)||this;n.handleMouseDown=function(d){n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.onDragStart=function(){var d=n.props,c=d.x,f=d.y,v=d.edgeModel,g=v.startPoint,y=v.endPoint,b=v.pointsList;n.oldEdge={startPoint:g,endPoint:y,pointsList:b},n.setState({endX:c,endY:f,dragging:!0})},n.onDragging=function(d){var c=d.deltaX,f=d.deltaY,v=n.state,g=v.endX,y=v.endY,b=n.props,x=b.graphModel,w=b.type,_=x.transformModel,C=x.editConfigModel,k=NB(_.moveCanvasPointByHtml([g,y],c,f),2),D=k[0],R=k[1];n.setState({endX:D,endY:R,dragging:!0});var $=n.props.edgeModel,P=Ed({x:g,y},x);if(P&&P.node&&n.isAllowAdjust(P).pass){var I=$.startPoint,W=$.endPoint,se=$.sourceNode,q=$.targetNode,ee=w===Hi.SOURCE?{startPoint:{x:P.anchor.x,y:P.anchor.y},endPoint:{x:W.x,y:W.y},sourceNode:P.node,targetNode:q}:{startPoint:{x:I.x,y:I.y},endPoint:{x:P.anchor.x,y:P.anchor.y},sourceNode:se,targetNode:P.node};$.updateAfterAdjustStartAndEnd(ee)}else w===Hi.SOURCE?$.updateStartPoint({x:D,y:R}):$.updateEndPoint({x:D,y:R});$.text.value&&C.adjustEdge&&$.setText(Object.assign({},$.text,$.textPosition))},n.onDragEnd=function(d){var c,f,v,g=d.event;try{n.setState({dragging:!1});var y=n.props,b=y.graphModel,x=y.edgeModel,w=y.type,_=n.state,C=_.endX,k=_.endY,D=_.dragging,R=Ed({x:C,y:k},b);if(!D)return;var $=!1,P=void 0;if(R&&R.node){var I=n.isAllowAdjust(R),W=I.pass,se=I.msg,q=I.newTargetNode;if(W){var ee=x.getData(),T=ee.text,z=ee.sourceAnchorId,B=z===void 0?"":z,pe=ee.targetAnchorId,Ee=pe===void 0?"":pe,ye=MB(ee,["text","sourceAnchorId","targetAnchorId"]);if(P=vi(vi({sourceAnchorId:B,targetAnchorId:Ee},ye),{text:(T==null?void 0:T.value)||""}),w===Hi.SOURCE){var it=b.getNodeModelById(R.node.id),Oe=b.getNodeModelById(x.targetNodeId),he=(c=b.edgeGenerator)===null||c===void 0?void 0:c.call(b,it==null?void 0:it.getData(),Oe==null?void 0:Oe.getData(),P);P=vi(vi({},he),{sourceNodeId:R.node.id,sourceAnchorId:R.anchor.id,startPoint:{x:R.anchor.x,y:R.anchor.y},targetNodeId:x.targetNodeId,endPoint:vi({},x.endPoint)}),x.sourceNodeId===R.node.id&&x.sourceAnchorId===R.anchor.id&&($=!0)}else if(w===Hi.TARGET){var it=b.getNodeModelById(x.sourceNodeId),Oe=b.getNodeModelById(R.node.id),he=(f=b.edgeGenerator)===null||f===void 0?void 0:f.call(b,it==null?void 0:it.getData(),Oe==null?void 0:Oe.getData(),P);P=vi(vi({},he),{sourceNodeId:x.sourceNodeId,startPoint:vi({},x.startPoint),targetNodeId:R.node.id,targetAnchorId:R.anchor.id,endPoint:{x:R.anchor.x,y:R.anchor.y}}),x.targetNodeId===R.node.id&&x.targetAnchorId===R.anchor.id&&($=!0)}}else{$=!0;var We=q.getData();b.eventCenter.emit(Ct.CONNECTION_NOT_ALLOWED,{data:We,msg:se})}}else $=!0;if($)n.recoveryEdge();else{var Re=x.getData();b.deleteEdgeById(x.id);var Ge=b.addEdge(vi({},P));b.eventCenter.emit(Ct.EDGE_EXCHANGE_NODE,{data:{newEdge:Ge.getData(),oldEdge:Re}})}(v=n.preTargetNode)===null||v===void 0||v.setElementState(en.DEFAULT)}finally{var b=n.props.graphModel;b.eventCenter.emit(Ct.ADJUST_POINT_DRAGEND,{e:g,data:n.stepDragData})}},n.recoveryEdge=function(){var d=n.props.edgeModel,c=n.oldEdge,f=c.startPoint,v=c.endPoint,g=c.pointsList;d.updateStartPoint(f),d.updateEndPoint(v),d.modelType!==Wt.LINE_EDGE&&(d.pointsList=g??[],d.initPoints())},n.getAdjustPointStyle=function(){var d=n.props.graphModel.theme,c=d.edgeAdjust;return c},n.state={dragging:!1,endX:0,endY:0},n.targetRuleResults=new Map,n.sourceRuleResults=new Map;var i=t.type,o=t.edgeModel,s=t.graphModel,l=s.eventCenter;return n.stepDragData={type:i,edgeData:o.getData()},n.stepDrag=new ai({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:l,data:n.stepDragData}),n}return e.prototype.isAllowAdjust=function(t){var n=this.props,i=n.edgeModel,o=i.id,s=i.sourceNode,l=i.targetNode,d=i.sourceAnchorId,c=i.targetAnchorId,f=n.type,v,g,y,b;if(f===Hi.SOURCE?(v=t.node,g=l,y=t.anchor,b=l.getAnchorInfo(c)):(v=s,g=t.node,b=t.anchor,y=s.getAnchorInfo(d)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(en.DEFAULT),this.preTargetNode=t.node,b.id===y.id)return{pass:!1,msg:"",newTargetNode:g};var x="".concat(v.id,"_").concat(g.id,"_").concat(y.id,"_").concat(b.id);if(!this.targetRuleResults.has(x)){var w=v.isAllowConnectedAsSource(g,y,b,o),_=g.isAllowConnectedAsTarget(v,y,b,o);this.sourceRuleResults.set(x,Cd(w)),this.targetRuleResults.set(x,Cd(_))}var C=this.sourceRuleResults.get(x),k=C.isAllPass,D=C.msg,R=this.targetRuleResults.get(x),$=R.isAllPass,P=R.msg,I=k&&$?en.ALLOW_CONNECT:en.NOT_ALLOW_CONNECT;return f===Hi.SOURCE?v.setElementState(I):g.setElementState(I),{pass:k&&$,msg:P||D,newTargetNode:g}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.getAdjustPointShape,s=t.edgeModel,l=this.state.dragging;return Ne("g",{pointerEvents:l?"none":"",onMouseDown:this.handleMouseDown,children:l?"":o(n,i,s)})},e}(Gt),AB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Th=function(){return Th=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Th.apply(this,arguments)};(function(r){AB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,n=t.arrowInfo,i=t.style,o=n.start,s=n.end,l={start:o,end:s,offset:i.offset,verticalLength:i.verticalLength,type:"end"},d=Ml(l),c=d.leftX,f=d.leftY,v=d.rightX,g=d.rightY;return Th({d:"M".concat(c," ").concat(f," L").concat(s.x," ").concat(s.y," L").concat(v," ").concat(g," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),n=t.d,i=t.strokeWidth,o=t.stroke,s=t.fill;return Ne(Tl,{d:n,fill:s,strokeWidth:i,stroke:o})},e.prototype.render=function(){return Ne("g",{className:"lf-arrow",children:this.getShape()})},e})(Gt);var TB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),_l=function(){return _l=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},_l.apply(this,arguments)},DB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},gc=function(r){TB(e,r);function e(){var t=r.call(this)||this;return t.textRef=lc(),t.handleHover=function(n,i){var o=t.props,s=o.model,l=o.graphModel.eventCenter;s.setHovered(n);var d=n?Ct.EDGE_MOUSEENTER:Ct.EDGE_MOUSELEAVE,c=s.getData();l.emit(d,{data:c,e:i})},t.setHoverOn=function(n){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,n))},t.setHoverOff=function(n){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,n))},t.handleContextMenu=function(n){n.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,o=i.model,s=i.graphModel,l=s.editConfigModel,d=s.getPointByClient({x:n.clientX,y:n.clientY});s.setElementStateById(o.id,en.SHOW_MENU,d.domOverlayPosition),l.isSilentMode||t.toFront(),o.isSelected||s.selectEdgeById(o.id);var c=o==null?void 0:o.getData();s.eventCenter.emit(Ct.EDGE_CONTEXTMENU,{data:c,e:n,position:d})},t.handleMouseDown=function(n){n.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(){var n=t.props.model;t.mouseUpDrag=n.isDragging},t.handleClick=function(n){if(t.startTime&&!t.mouseUpDrag){var i=n.button===2;if(!i){var o=n.detail===2,s=t.props,l=s.model,d=s.graphModel,c=l==null?void 0:l.getData(),f=d.getPointByClient({x:n.clientX,y:n.clientY});if(o){var v=d.editConfigModel,g=d.textEditElement,y=l.id,b=l.text,x=l.modelType;if(g&&g.id===y&&d.setElementStateById(y,en.DEFAULT),v.edgeTextEdit&&b.editable&&(l.setSelected(!1),d.setElementStateById(y,en.TEXT_EDIT)),x===Wt.POLYLINE_EDGE){var w=l,_=d.getPointByClient({x:n.x,y:n.y}).canvasOverlayPosition,C=_.x,k=_.y;w.dbClickPosition=Tw({x:C,y:k},w.points)}d.eventCenter.emit(Ct.EDGE_DBCLICK,{data:c,e:n,position:f})}else d.eventCenter.emit(Ct.ELEMENT_CLICK,{data:c,e:n,position:f}),d.eventCenter.emit(Ct.EDGE_CLICK,{data:c,e:n,position:f});var D=d.editConfigModel;d.selectEdgeById(l.id,Dw(n,D)),D.isSilentMode||t.toFront()}}},t.handleFocus=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(Ct.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(Ct.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return Ne("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,s=o.editConfigModel;if(s.edgeTextMode!==ii.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var l=!1;return s.edgeTextDraggable&&i.text.draggable&&(l=!0),Ne(vB,{ref:this.textRef,editable:s.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isSelected,s=this.state.hover;return{start:n,end:i,hover:s,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint;return[n,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,n=t.id,i=t.getArrowStyle(),o=i.refY,s=o===void 0?0:o,l=i.refX,d=l===void 0?2:l,c=DB(this.getLastTwoPoints(),2),f=c[0],v=c[1],g="auto";if(f&&v){var y=v.x-f.x,b=v.y-f.y;if(y!==0||b!==0){var x=UI(WI({x:y,y:b}));Number.isFinite(x)&&!Number.isNaN(x)&&(g=x)}}return Ne("g",{children:Ne("defs",{children:[Ne("marker",{id:"marker-start-".concat(n),refX:-d,refY:s,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),Ne("marker",{id:"marker-end-".concat(n),refX:d,refY:s,overflow:"visible",orient:g,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,n){var i=n.stroke,o=n.fill,s=o===void 0?i:o,l=n.strokeWidth,d=n.offset,c=d===void 0?10:d,f=n.verticalLength,v=n.strokeLinecap,g=n.strokeLinejoin,y=n.transform,b="";switch(t){case"solid":b="M".concat(-c/4,",0 L").concat(3*c/4,",").concat(f," L").concat(3*c/4,",-").concat(f," Z");break;case"hollow":b="M".concat(-c/4,",0 L").concat(3*c/4,",").concat(f," L").concat(-c/4,",0 L").concat(3*c/4,",-").concat(f," L").concat(-c/4,",0 Z");break;case"diamond":b="M".concat(-c/2,",0 L0,").concat(f," L").concat(c/2,",0 L0,-").concat(f," L").concat(-c/2,",0 Z");break;case"circle":b="M".concat(-c/2,",0 A").concat(c/4,",").concat(c/4," 0 1,0 ").concat(c/2,",0 A").concat(c/4,",").concat(c/4," 0 1,0 ").concat(-c/2,",0 Z");break;default:b="";break}return Ne("path",{d:b,stroke:i,fill:s,strokeWidth:l,strokeLinecap:v,strokeLinejoin:g,transform:y})},e.prototype.getStartArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,s=n.offset,l=n.verticalLength,d=n.startArrowType,c=d===void 0?"none":d,f=n.strokeLinecap,v=n.strokeLinejoin;return this.getArrowPath(c,{stroke:i,strokeWidth:o,offset:s,verticalLength:l,strokeLinecap:f,strokeLinejoin:v})},e.prototype.getEndArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,s=n.offset,l=n.verticalLength,d=n.endArrowType,c=d===void 0?"solid":d,f=n.strokeLinecap,v=n.strokeLinejoin;return this.getArrowPath(c,{stroke:i,strokeWidth:o,offset:s,verticalLength:l,strokeLinecap:f,strokeLinejoin:v,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,n,i){var o=i.getAdjustPointStyle();return Ne(ss,_l({className:"lf-edge-adjust-point"},o,{x:t,y:n}))},e.prototype.getAdjustPoints=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,s=o.adjustEdgeStartAndEnd,l=o.adjustEdgeStart,d=o.adjustEdgeEnd,c=n.getAdjustStart(),f=n.getAdjustEnd();return Ne("g",{children:[s&&l&&Ne(iy,_l({type:Hi.SOURCE},c,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i})),s&&d&&Ne(iy,_l({type:Hi.TARGET},f,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return Ne("g",{})},e.prototype.getAppend=function(){return Ne("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,n=t.graphModel,i=t.model;n.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,n=t.isSelected,i=t.isHitable,o=t.isShowAdjustPoint;return Ne("g",{children:[Ne("g",{className:["lf-edge",!i&&"pointer-none",n&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),o&&n?this.getAdjustPoints():""]})},e.isObserved=!1,e}(Gt),LB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dh=function(){return Dh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Dh.apply(this,arguments)},PB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},oy=function(r){LB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.getEdgeStyle(),i=t,o=i.path,s=i.isAnimation,l=i.arrowConfig,d=t.getEdgeAnimationStyle(),c=d.strokeDasharray,f=d.stroke,v=d.strokeDashoffset,g=d.animationName,y=d.animationDuration,b=d.animationIterationCount,x=d.animationTimingFunction,w=d.animationDirection;return Ne(Tl,Dh({d:o},n,l,s?{strokeDasharray:c,stroke:f,style:{strokeDashoffset:v,animationName:g,animationDuration:y,animationIterationCount:b,animationTimingFunction:x,animationDirection:w}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return Ne(Tl,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,n=this.state.hover,i=t.isSelected,o=t.getArrowStyle().offset,s=t.pointsList.map(function(v){return{x:v.x,y:v.y}}),l=PB(Bm(s,o),2),d=l[0],c=l[1],f={start:d,end:c,hover:n,isSelected:i};return f},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.getArrowStyle().offset,i=t.pointsList.map(function(o){return{x:o.x,y:o.y}});return Bm(i,n)},e}(gc),RB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Lh=function(){return Lh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Lh.apply(this,arguments)},ay=function(r){RB(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isAnimation,s=t.arrowConfig,l=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),c=d.strokeDasharray,f=d.stroke,v=d.strokeDashoffset,g=d.animationName,y=d.animationDuration,b=d.animationIterationCount,x=d.animationTimingFunction,w=d.animationDirection;return Ne(as,Lh({},l,{x1:n.x,y1:n.y,x2:i.x,y2:i.y},s,o?{strokeDasharray:c,stroke:f,style:{strokeDashoffset:v,animationName:g,animationDuration:y,animationIterationCount:b,animationTimingFunction:x,animationDirection:w}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o={start:n,end:i},s=K3(o),l=s.d,d=s.strokeWidth,c=s.fill,f=s.strokeDasharray,v=s.stroke;return Ne(Tl,{d:l,fill:c,strokeWidth:d,stroke:v,strokeDasharray:f})},e}(gc),IB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zo=function(){return Zo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Zo.apply(this,arguments)},BB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},ds=function(r){IB(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(){var n=t.props.model;n.dragAppendStart(),t.isShowAdjustPointTemp=n.isShowAdjustPoint,n.isShowAdjustPoint=!1},t.onDragging=function(n){var i=n.deltaX,o=n.deltaY,s=t.props,l=s.model,d=s.graphModel;t.isDragging=!0;var c=d.transformModel,f=d.editConfigModel,v=BB(c.fixDeltaXY(i,o),2),g=v[0],y=v[1],b=l,x=f.adjustEdgeMiddle;x?t.appendInfo=b.dragAppendSimple(t.appendInfo,{x:g,y}):t.appendInfo=b.dragAppend(t.appendInfo,{x:g,y})},t.onDragEnd=function(){var n,i=t.props,o=i.model,s=i.graphModel.eventCenter,l=o;l.dragAppendEnd(),t.isDragging=!1,l.isShowAdjustPoint=(n=t.isShowAdjustPointTemp)!==null&&n!==void 0?n:!1,t.appendInfo=void 0,s.emit(Ct.EDGE_ADJUST,{data:l.getData()})},t.beforeDragStart=function(n,i){i.draggable&&t.drag.handleMouseDown(n),t.appendInfo=i},t.drag=new ai({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,s=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),d=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,v=l.animationName,g=l.animationDuration,y=l.animationIterationCount,b=l.animationTimingFunction,x=l.animationDirection;return Ne(EI,Zo({points:n},s,o,i?{strokeDasharray:d,stroke:c,style:{strokeDashoffset:f,animationName:v,animationDuration:g,animationIterationCount:y,animationTimingFunction:b,animationDirection:x}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.points,i=t.isSelected,o=this.state.hover,s=sa(n),l=s[0],d=s[0];return s.length>=2&&(l=s[s.length-2],d=s[s.length-1]),{start:l,end:d,hover:o,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.points,i=sa(n),o=i[0],s=i[0];return i.length>=2&&(o=i[i.length-2],s=i[i.length-1]),[o,s]},e.prototype.getAppendAttributes=function(t){var n=t.start,i=t.end,o;if(n.x===i.x&&n.y===i.y)o="";else{var s={start:n,end:i,offset:10,verticalLength:5},l=Ml(Zo(Zo({},s),{type:"start"})),d=Ml(Zo(Zo({},s),{type:"end"}));o="M".concat(l.leftX," ").concat(l.leftY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(d.rightX," ").concat(d.rightY,`
      L`).concat(d.leftX," ").concat(d.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var n=this.getAppendAttributes(t),i=n.d,o=n.strokeWidth,s=n.fill,l=n.strokeDasharray,d=n.stroke;return Ne(Tl,{d:i,fill:s,strokeWidth:o,stroke:d,strokeDasharray:l})},e.prototype.getAppendWidth=function(){for(var t=this,n=this.props,i=n.model,o=n.graphModel,s=i.pointsList,l=i.draggable,d=[],c=s.length,f=function(y){var b="lf-polyline-append",x={start:{x:s[y].x,y:s[y].y},end:{x:s[y+1].x,y:s[y+1].y},startIndex:y,endIndex:y+1,direction:vn.HORIZONTAL,draggable:!0},w=Ne("g",{className:b,children:v.getAppendShape(x)}),_=o.editConfigModel,C=_.adjustEdge,k=_.adjustEdgeMiddle;if(C&&l){var D=x.startIndex,R=x.endIndex,$=k&&(D===0||R===c-1);x.draggable=!$,x.start.x===x.end.x?(x.draggable&&(b+="-ew-resize"),x.direction=vn.VERTICAL):x.start.y===x.end.y&&(x.draggable&&(b+="-ns-resize"),x.direction=vn.HORIZONTAL),w=Ne("g",{className:v.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(P){return t.beforeDragStart(P,x)},children:Ne("g",{className:b,children:v.getAppendShape(x)})})}d.push(w)},v=this,g=0;g<c-1;g++)f(g);return Ne("g",{children:d})},e}(gc),Ua=function(){return Ua=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ua.apply(this,arguments)},jB=function(){function r(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(Ua(Ua({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(Ct.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var o=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),s=o.x,l=o.y;t.fakeNode.moveTo(s,l);var d=t.fakeNode.getData();t.lf.setNodeSnapLine(d),t.lf.graphModel.eventCenter.emit(Ct.NODE_DND_DRAG,{data:d,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(Ua(Ua({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),Ct.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var n=e.lf;this.lf=n}return r.prototype.clientToLocalPoint=function(e){var t=e.x,n=e.y,i=Wl(this.lf.options,["grid","size"]),o=this.lf.graphModel.getPointByClient({x:t,y:n}),s=o.canvasOverlayPosition,l=s.x,d=s.y,c=this.lf.graphModel.editConfigModel.snapGrid;return{x:os(l,i,c),y:os(d,i,c)}},r.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},r.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},r}();function HB(r,e){r.on("node:mousemove",function(t){var n=t.data;e.setNodeSnapLine(n)}),r.on("node:mouseup",function(){e.clearSnapline()})}var $B=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),eo=function(){return eo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},eo.apply(this,arguments)},FB=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},zB=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},WB=function(r){$B(e,r);function e(t){var n=r.call(this,t)||this;return n.ref=lc(),n.__prevText={type:"",text:"",id:""},n.keyupHandler=function(i){var o=n.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(o==null||o.setElementState(en.DEFAULT))},n.inputHandler=function(i){var o=i.target.innerText,s=n.props.graphModel.textEditElement;s&&(n.__prevText={type:s.type,text:o.replace(/(\r\n)+$|(\n)+$/,""),id:s.id})},n.keydownHandler=function(i){i.stopPropagation()},n.state={style:{left:0,top:0}},n}return e.getDerivedStateFromProps=function(t){var n,i=t.textEditElement,o=t.graphModel,s=o.transformModel,l=o.theme,d=l.inputText,c;if(i){if(!(!((n=i.text)===null||n===void 0)&&n.value)&&i.BaseType===xn.EDGE){var f=i.text,v=i.textPosition,g=v.x,y=v.y;f.x=g,f.y=y,i.setText(f)}var b={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===xn.EDGE){var x=l.edgeText,w=x.overflowMode,_=x.lineHeight,C=x.wrapPadding,k=x.textWidth;k&&w==="autoWrap"&&(c=eo(eo({},b),{width:k,minWidth:k,lineHeight:_,padding:C}))}else if(i.BaseType===xn.NODE){var D=l.nodeText,w=D.overflowMode,_=D.lineHeight,C=D.wrapPadding,k=D.textWidth,R=i.width,$=i.modelType,P=i.textWidth,I=P||k||R;($!==Wt.TEXT_NODE&&w==="autoWrap"||$===Wt.TEXT_NODE&&k)&&(c=eo(eo({},b),{width:I,minWidth:I,lineHeight:_,padding:C}))}var W=i.text,se=W.x,q=W.y,ee=zB(s.CanvasPointToHtmlPoint([se,q]),2),T=ee[0],z=ee[1];return{style:eo(eo({left:T,top:z},c),d)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var n=this.__prevText,i=n.text,o=n.id;t.updateText(o,i),t.eventCenter.emit(Ct.TEXT_UPDATE,{data:eo({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(n)}},e.prototype.render=function(){var t,n=this.props.graphModel.textEditElement,i=this.state.style;return n?Ne("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=n.text)===null||t===void 0?void 0:t.value},n.id):null},e.toolName="text-edit-tool",e=FB([Sr],e),e}(Gt),UB=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),VB=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Mf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},XB=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},GB=function(r){UB(e,r);function e(t){var n=r.call(this,t)||this;n.handleMouseDown=function(l){n.stepDrag.handleMouseDown(l)},n.handleWheelEvent=function(l){var d,c;l.preventDefault();var f=l.deltaX,v=l.deltaY,g=l.clientX,y=l.clientY,b=l.ctrlKey,x=new WheelEvent("wheel",{deltaX:f,deltaY:v,clientX:g,clientY:y,ctrlKey:b});(c=(d=n.props.lf.container)===null||d===void 0?void 0:d.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||c===void 0||c.dispatchEvent(x)},n.onDragging=function(l){var d=l.deltaX,c=l.deltaY,f=n.props,v=f.graphModel,g=f.lf,y=g.getTransform(),b=y.SCALE_X,x=y.SCALE_Y,w=v.getSelectElements(!0);v.moveNodes(w.nodes.map(function(_){return _.id}),d/b,c/x)},n.handleContextMenu=function(l){l.preventDefault();var d=n.props,c=d.graphModel,f=d.graphModel,v=f.eventCenter,g=f.selectElements,y=c.getPointByClient({x:l.clientX,y:l.clientY}),b={nodes:[],edges:[]},x=XB([],Mf(g.values()),!1);x.forEach(function(w){w.BaseType===xn.NODE&&b.nodes.push(w.getData()),w.BaseType===xn.EDGE&&b.edges.push(w.getData())}),v.emit(Ct.SELECTION_CONTEXTMENU,{data:b,e:l,position:y})};var i=t.graphModel,o=i.gridSize,s=i.eventCenter;return n.stepDrag=new ai({onDragging:n.onDragging,step:o,eventType:"SELECTION",eventCenter:s}),n}return e.prototype.render=function(){var t,n,i=this.props.graphModel,o=i.selectElements,s=i.transformModel,l=this.props.lf.getTransform(),d=l.SCALE_X,c=l.SCALE_Y;if(!(o.size<=1)){var f=Number.MAX_SAFE_INTEGER,v=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER;o.forEach(function(x){var w;x.BaseType===xn.NODE&&(w=D3(x)),x.BaseType===xn.EDGE&&(w=I3(x)),w!==void 0&&(f=Math.min(f,w.x),v=Math.min(v,w.y),g=Math.max(g,w.x1),y=Math.max(y,w.y1))}),t=Mf(s.CanvasPointToHtmlPoint([f,v]),2),f=t[0],v=t[1],n=Mf(s.CanvasPointToHtmlPoint([g,y]),2),g=n[0],y=n[1];var b={left:"".concat(f-20*d/2,"px"),top:"".concat(v-20*c/2,"px"),width:"".concat(g-f+20*d,"px"),height:"".concat(y-v+20*c,"px"),"border-width":"".concat(2*d,"px")};return Ne("div",{className:"lf-multiple-select",style:b,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=VB([Sr],e),e}(Gt),Nf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},YB=[WB,GB],KB=function(){function r(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,un(YB,function(o){t.isDisabled(o.toolName)||t.registerTool(o.toolName,o)});var n=e.graphModel,i=n.eventCenter;i.on("".concat(Ct.GRAPH_TRANSFORM,",").concat(Ct.NODE_CLICK,",").concat(Ct.BLANK_CLICK," "),function(){var o,s=n.textEditElement,l=n.editConfigModel,d=l.edgeTextEdit,c=l.nodeTextEdit;(d||c)&&s&&((o=n.textEditElement)===null||o===void 0||o.setElementState(en.DEFAULT))})}return r.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},r.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},r.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},r.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},r.prototype.getTools=function(){return Array.from(this.toolMap.values())},r.prototype.getInstance=function(){return this.instance},r.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},Nf([Ae],r.prototype,"toolMap",void 0),Nf([Me],r.prototype,"disableTool",null),Nf([Me],r.prototype,"enableTool",null),r}();function qB(r){throw new Error("[mobx-utils] "+r)}function Pd(r,e){e===void 0&&(e="Illegal state"),r||qB(e)}var Ww=function(r){return r&&r!==Object.prototype&&Object.getOwnPropertyNames(r).concat(Ww(Object.getPrototypeOf(r))||[])},JB=function(r){var e=Ww(r),t=e.filter(function(n,i){return e.indexOf(n)===i});return t},ZB=function(r){return JB(r).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},Uw="pending",Rd="fulfilled",_p="rejected";function QB(r){switch(this.state){case Uw:return r.pending&&r.pending(this.value);case _p:return r.rejected&&r.rejected(this.value);case Rd:return r.fulfilled?r.fulfilled(this.value):this.value}}function sy(r,e){if(Pd(arguments.length<=2,"fromPromise expects up to two arguments"),Pd(typeof r=="function"||typeof r=="object"&&r&&typeof r.then=="function","Please pass a promise or function to fromPromise"),r.isPromiseBasedObservable===!0)return r;typeof r=="function"&&(r=new Promise(r));var t=r;r.then(Me("observableFromPromise-resolve",function(i){t.value=i,t.state=Rd}),Me("observableFromPromise-reject",function(i){t.value=i,t.state=_p})),t.isPromiseBasedObservable=!0,t.case=QB;var n=e&&e.state===Rd?e.value:void 0;return nh(t,{value:n,state:Uw},{},{deep:!1}),t}(function(r){r.reject=Me("fromPromise.reject",function(t){var n=r(Promise.reject(t));return n.state=_p,n.value=t,n});function e(t){t===void 0&&(t=void 0);var n=r(Promise.resolve(t));return n.state=Rd,n.value=t,n}r.resolve=Me("fromPromise.resolve",e)})(sy||(sy={}));var Yu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o};(function(){function r(e,t){var n=this;kR(function(){n.current=t,n.subscription=e.subscribe(n)})}return r.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},r.prototype.next=function(e){this.current=e},r.prototype.complete=function(){this.dispose()},r.prototype.error=function(e){this.current=e,this.dispose()},Yu([Ae.ref],r.prototype,"current",void 0),Yu([Me.bound],r.prototype,"next",null),Yu([Me.bound],r.prototype,"complete",null),Yu([Me.bound],r.prototype,"error",null),r})();var Id=function(){return Id=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Id.apply(this,arguments)},tl=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},e4=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function r(e){var t=this;this.model=e,this.localValues=Ae.map({}),this.localComputedValues=Ae.map({}),this.isPropertyDirty=function(n){return t.localValues.has(n)},Pd(Ai(e),"createViewModel expects an observable object"),ZB(e).forEach(function(n){if(!(n===$t||n==="__mobxDidRunLazyInitializers")){if(Pd(e4.indexOf(n)===-1,"The propertyname "+n+" is reserved and cannot be used with viewModels"),Yg(e,n)){var i=hc(e,n).derivation;t.localComputedValues.set(n,fn(i.bind(t)))}var o=Object.getOwnPropertyDescriptor(e,n),s=o?{enumerable:o.enumerable}:{};Object.defineProperty(t,n,Id(Id({},s),{configurable:!0,get:function(){return Yg(e,n)?t.localComputedValues.get(n).get():t.isPropertyDirty(n)?t.localValues.get(n):t.model[n]},set:Me(function(l){l!==t.model[n]?t.localValues.set(n,l):t.localValues.delete(n)})}))}})}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),r.prototype.submit=function(){var e=this;is(this.localValues).forEach(function(t){var n=e.localValues.get(t),i=e.model[t];Gi(i)?i.replace(n):Hr(i)?(i.clear(),i.merge(n)):PR(n)||(e.model[t]=n)}),this.localValues.clear()},r.prototype.reset=function(){this.localValues.clear()},r.prototype.resetProperty=function(e){this.localValues.delete(e)},tl([fn],r.prototype,"isDirty",null),tl([fn],r.prototype,"changedValues",null),tl([Me.bound],r.prototype,"submit",null),tl([Me.bound],r.prototype,"reset",null),tl([Me.bound],r.prototype,"resetProperty",null),r})();function Af(r){if(!r)return"ROOT";for(var e=[];r.parent;)e.push(r.path),r=r.parent;return e.reverse().join("/")}function Tf(r){return Ai(r)||Gi(r)||Hr(r)}function t4(r,e){var t=new WeakMap;function n(l){var d=t.get(l.object);i(l,d),e(l,Af(d),r)}function i(l,d){switch(l.type){case"add":o(l.newValue,d,l.name);break;case"update":s(l.oldValue),o(l.newValue,d,l.name||""+l.index);break;case"remove":case"delete":s(l.oldValue);break;case"splice":l.removed.map(s),l.added.forEach(function(v,g){return o(v,d,""+(l.index+g))});for(var c=l.index+l.addedCount;c<l.object.length;c++)if(Tf(l.object[c])){var f=t.get(l.object[c]);f&&(f.path=""+c)}break}}function o(l,d,c){if(Tf(l)){var f=t.get(l);if(f){if(f.parent!==d||f.path!==c)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Af(d)+"/"+c+"',")+(" but it already exists at '"+Af(f.parent)+"/"+f.path+"'"))}else{var v={parent:d,path:c,dispose:hw(l,n)};t.set(l,v),BR(l).forEach(function(g){var y=g[0],b=g[1];return o(b,v,y)})}}}function s(l){if(Tf(l)){var d=t.get(l);if(!d)return;t.delete(l),d.dispose(),IR(l).forEach(s)}}return o(r,void 0,""),function(){s(r)}}var n4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){n4(e,r);function e(t,n,i){var o=i===void 0?{}:i,s=o.name,l=s===void 0?"ogm"+(Math.random()*1e3|0):s,d=o.keyToName,c=d===void 0?function(g){return""+g}:d,f=r.call(this)||this;f._keyToName=c,f._groupBy=n,f._ogmInfoKey=Symbol("ogmInfo"+l),f._base=t;for(var v=0;v<t.length;v++)f._addItem(t[v]);return f._disposeBaseObserver=hw(f._base,function(g){if(g.type==="splice")yi(function(){for(var y=0,b=g.removed;y<b.length;y++){var x=b[y];f._removeItem(x)}for(var w=0,_=g.added;w<_.length;w++){var C=_[w];f._addItem(C)}});else if(g.type==="update")yi(function(){f._removeItem(g.oldValue),f._addItem(g.newValue)});else throw new Error("illegal state")}),f}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,n){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var n=this._base[t],i=n[this._ogmInfoKey];i.reaction(),delete n[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var n=r.prototype.get.call(this,t);return n===void 0&&(n=Ae([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),r.prototype.set.call(this,t,n)),n},e.prototype._removeFromGroupArr=function(t,n){var i=r.prototype.get.call(this,t);i.length===1?r.prototype.delete.call(this,t):(n===i.length-1||(i[n]=i[i.length-1],i[n][this._ogmInfoKey].groupArrIndex=n),i.length--)},e.prototype._addItem=function(t){var n=this,i=this._groupBy(t),o=this._getGroupArr(i),s={groupByValue:i,groupArrIndex:o.length,reaction:aw(function(){return n._groupBy(t)},function(l,d){var c=t[n._ogmInfoKey];n._removeFromGroupArr(c.groupByValue,c.groupArrIndex);var f=n._getGroupArr(l),v=f.length;f.push(t),c.groupByValue=l,c.groupArrIndex=v})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:s}),o.push(t)},e.prototype._removeItem=function(t){var n=t[this._ogmInfoKey];this._removeFromGroupArr(n.groupByValue,n.groupArrIndex),n.reaction(),delete t[this._ogmInfoKey]},e})(fp);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var Ph=function(){return Ph=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ph.apply(this,arguments)},r4=function(){function r(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return r.prototype.add=function(e){bg(tO(this.undos),e)||(this.undos.push(e),bg(this.curData,e)||(this.redos=[]),this.eventCenter.emit(Ct.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},r.prototype.undoAble=function(){return this.undos.length>1},r.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Ht(t),t}},r.prototype.redoAble=function(){return this.redos.length>0},r.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Ht(e),e}},r.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=t4(e,m_(function(){var n=e.modelToHistoryData();n&&t.add(Ph({},n))},this.waitTime))},r.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},r}(),Df={exports:{}},ly;function i4(){return ly||(ly=1,function(r){(function(e,t,n){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d,c=1;c<20;++c)i[111+c]="f"+c;for(c=0;c<=9;++c)i[c+96]=c.toString();function f(P,I,W){if(P.addEventListener){P.addEventListener(I,W,!1);return}P.attachEvent("on"+I,W)}function v(P){if(P.type=="keypress"){var I=String.fromCharCode(P.which);return P.shiftKey||(I=I.toLowerCase()),I}return i[P.which]?i[P.which]:o[P.which]?o[P.which]:String.fromCharCode(P.which).toLowerCase()}function g(P,I){return P.sort().join(",")===I.sort().join(",")}function y(P){var I=[];return P.shiftKey&&I.push("shift"),P.altKey&&I.push("alt"),P.ctrlKey&&I.push("ctrl"),P.metaKey&&I.push("meta"),I}function b(P){if(P.preventDefault){P.preventDefault();return}P.returnValue=!1}function x(P){if(P.stopPropagation){P.stopPropagation();return}P.cancelBubble=!0}function w(P){return P=="shift"||P=="ctrl"||P=="alt"||P=="meta"}function _(){if(!d){d={};for(var P in i)P>95&&P<112||i.hasOwnProperty(P)&&(d[i[P]]=P)}return d}function C(P,I,W){return W||(W=_()[P]?"keydown":"keypress"),W=="keypress"&&I.length&&(W="keydown"),W}function k(P){return P==="+"?["+"]:(P=P.replace(/\+{2}/g,"+plus"),P.split("+"))}function D(P,I){var W,se,q,ee=[];for(W=k(P),q=0;q<W.length;++q)se=W[q],l[se]&&(se=l[se]),I&&I!="keypress"&&s[se]&&(se=s[se],ee.push("shift")),w(se)&&ee.push(se);return I=C(se,ee,I),{key:se,modifiers:ee,action:I}}function R(P,I){return P===null||P===t?!1:P===I?!0:R(P.parentNode,I)}function $(P){var I=this;if(P=P||t,!(I instanceof $))return new $(P);I.target=P,I._callbacks={},I._directMap={};var W={},se,q=!1,ee=!1,T=!1;function z(he){he=he||{};var We=!1,Re;for(Re in W){if(he[Re]){We=!0;continue}W[Re]=0}We||(T=!1)}function B(he,We,Re,Ge,le,G){var oe,de,ke=[],Ye=Re.type;if(!I._callbacks[he])return[];for(Ye=="keyup"&&w(he)&&(We=[he]),oe=0;oe<I._callbacks[he].length;++oe)if(de=I._callbacks[he][oe],!(!Ge&&de.seq&&W[de.seq]!=de.level)&&Ye==de.action&&(Ye=="keypress"&&!Re.metaKey&&!Re.ctrlKey||g(We,de.modifiers))){var Ie=!Ge&&de.combo==le,Fe=Ge&&de.seq==Ge&&de.level==G;(Ie||Fe)&&I._callbacks[he].splice(oe,1),ke.push(de)}return ke}function pe(he,We,Re,Ge){I.stopCallback(We,We.target||We.srcElement,Re,Ge)||he(We,Re)===!1&&(b(We),x(We))}I._handleKey=function(he,We,Re){var Ge=B(he,We,Re),le,G={},oe=0,de=!1;for(le=0;le<Ge.length;++le)Ge[le].seq&&(oe=Math.max(oe,Ge[le].level));for(le=0;le<Ge.length;++le){if(Ge[le].seq){if(Ge[le].level!=oe)continue;de=!0,G[Ge[le].seq]=1,pe(Ge[le].callback,Re,Ge[le].combo,Ge[le].seq);continue}de||pe(Ge[le].callback,Re,Ge[le].combo)}var ke=Re.type=="keypress"&&ee;Re.type==T&&!w(he)&&!ke&&z(G),ee=de&&Re.type=="keydown"};function Ee(he){typeof he.which!="number"&&(he.which=he.keyCode);var We=v(he);if(We){if(he.type=="keyup"&&q===We){q=!1;return}I.handleKey(We,y(he),he)}}function ye(){clearTimeout(se),se=setTimeout(z,1e3)}function it(he,We,Re,Ge){W[he]=0;function le(Ye){return function(){T=Ye,++W[he],ye()}}function G(Ye){pe(Re,Ye,he),Ge!=="keyup"&&(q=v(Ye)),setTimeout(z,10)}for(var oe=0;oe<We.length;++oe){var de=oe+1===We.length,ke=de?G:le(Ge||D(We[oe+1]).action);Oe(We[oe],ke,Ge,he,oe)}}function Oe(he,We,Re,Ge,le){I._directMap[he+":"+Re]=We,he=he.replace(/\s+/g," ");var G=he.split(" "),oe;if(G.length>1){it(he,G,We,Re);return}oe=D(he,Re),I._callbacks[oe.key]=I._callbacks[oe.key]||[],B(oe.key,oe.modifiers,{type:oe.action},Ge,he,le),I._callbacks[oe.key][Ge?"unshift":"push"]({callback:We,modifiers:oe.modifiers,action:oe.action,seq:Ge,level:le,combo:he})}I._bindMultiple=function(he,We,Re){for(var Ge=0;Ge<he.length;++Ge)Oe(he[Ge],We,Re)},f(P,"keypress",Ee),f(P,"keydown",Ee),f(P,"keyup",Ee)}$.prototype.bind=function(P,I,W){var se=this;return P=P instanceof Array?P:[P],se._bindMultiple.call(se,P,I,W),se},$.prototype.unbind=function(P,I){var W=this;return W.bind.call(W,P,function(){},I)},$.prototype.trigger=function(P,I){var W=this;return W._directMap[P+":"+I]&&W._directMap[P+":"+I]({},P),W},$.prototype.reset=function(){var P=this;return P._callbacks={},P._directMap={},P},$.prototype.stopCallback=function(P,I){var W=this;if((" "+I.className+" ").indexOf(" mousetrap ")>-1||R(I,W.target))return!1;if("composedPath"in P&&typeof P.composedPath=="function"){var se=P.composedPath()[0];se!==P.target&&(I=se)}return I.tagName=="INPUT"||I.tagName=="SELECT"||I.tagName=="TEXTAREA"||I.isContentEditable},$.prototype.handleKey=function(){var P=this;return P._handleKey.apply(P,arguments)},$.addKeycodes=function(P){for(var I in P)P.hasOwnProperty(I)&&(i[I]=P[I]);d=null},$.init=function(){var P=$(t);for(var I in P)I.charAt(0)!=="_"&&($[I]=function(W){return function(){return P[W].apply(P,arguments)}}(I))},$.init(),e.Mousetrap=$,r.exports&&(r.exports=$)})(typeof window<"u"?window:null,typeof window<"u"?document:null)}(Df)),Df.exports}var o4=i4();const a4=fs(o4);var Ri=null;function uy(r,e){var t,n;return r.x+=e,r.y+=e,Xf(r.text)||(r.text.x+=e,r.text.y+=e),Xf((t=r.properties)===null||t===void 0?void 0:t._label)||(n=r.properties)===null||n===void 0||n._label.forEach(function(i){i.x+=e,i.y+=e}),r}function dy(r,e){return r.startPoint&&(r.startPoint.x+=e,r.startPoint.y+=e),r.endPoint&&(r.endPoint.x+=e,r.endPoint.y+=e),r.pointsList&&r.pointsList.length>0&&r.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Xf(r.text)||(r.text.x+=e,r.text.y+=e),r}var Ba=40,Ku=40;function s4(r,e){var t=r.keyboard,n=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Ku=Ba,!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=r.options.guards,o=e.getSelectElements(!1),s=i&&i.beforeClone?i.beforeClone(o):!0;return!s||o.nodes.length===0&&o.edges.length===0?(Ri=null,!0):(Ri=o,Ri.nodes.forEach(function(l){return uy(l,Ba)}),Ri.edges.forEach(function(l){return dy(l,Ba)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;if(Ri&&(Ri.nodes||Ri.edges)){r.clearSelectElements();var i=r.addElements(Ri,Ku);if(!i)return!0;i.nodes.forEach(function(o){return r.selectElementById(o.id,!0)}),i.edges.forEach(function(o){return r.selectElementById(o.id,!0)}),Ri.nodes.forEach(function(o){return uy(o,Ba)}),Ri.edges.forEach(function(o){return dy(o,Ba)}),Ku=Ku+Ba}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.redo(),!1)}),t.on(["backspace"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return r.clearSelectElements(),i.edges.forEach(function(o){return o.id&&r.deleteEdge(o.id)}),i.nodes.forEach(function(o){return o.id&&r.deleteNode(o.id)}),!1})}var l4=function(){function r(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new a4(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return r.prototype.initShortcuts=function(){var e=this,t,n=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(n)if(y_(n))n.forEach(function(l){var d=l.keys,c=l.callback,f=l.action;return e.on(d,c,f)});else{var i=n.keys,o=n.callback,s=n.action;this.on(i,o,s)}},r.prototype.on=function(e,t,n){this.mousetrap.bind(this.getKeys(e),t,n)},Object.defineProperty(r.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),r.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},r.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},r.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},r.prototype.destroy=function(){this.mousetrap.reset()},r.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(n){return t.formatKey(n)})},r.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},r}(),xo=function(){return xo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},xo.apply(this,arguments)},qu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Lf=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Pf=Symbol("plugin registered by Logicflow.use"),Rh=function(){function r(e){var t=this,n;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(c,f){return t.viewMap.set(c,f)},this.getView=function(c){return t.viewMap.get(c)};var i=Ol.get(e),o=i.container,s=i.width,l=i.height;this.options=i,this.container=this.initContainer(o,s,l),this.graphModel=new Z8(xo(xo({},i),{container:this.container})),this.plugins=(n=i.plugins)!==null&&n!==void 0?n:[];var d=this.graphModel.eventCenter;this.tool=new KB(this),this.dnd=new jB({lf:this}),this.history=new r4(d),this.keyboard=new l4({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new Q8(this.graphModel,i.snaplineEpsilon),HB(d,this.snaplineModel)),i.isSilentMode||(s4(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return r.prototype.initContainer=function(e,t,n){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=n?"".concat(n,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return r.toStringTag},enumerable:!1,configurable:!0}),r.prototype.register=function(e,t,n){if(n===void 0&&(n=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:gc,BaseEdgeModel:vc,BaseNode:Do,BaseNodeModel:To,RectNode:la,RectNodeModel:us,CircleNode:Td,CircleNodeModel:Md,PolygonNode:Ld,PolygonNodeModel:Nd,TextNode:ry,TextNodeModel:ey,LineEdge:ay,LineEdgeModel:qm,DiamondNode:kh,DiamondNodeModel:yh,PolylineEdge:ds,PolylineEdgeModel:ls,BezierEdge:oy,BezierEdgeModel:Ym,EllipseNode:Nh,EllipseNodeModel:_h,HtmlNode:jl,HtmlNodeModel:Il,h:xt,type:e};if(this.viewMap.forEach(function(c){var f=c.extendKey;f&&(i[f]=c)}),this.graphModel.modelMap.forEach(function(c){var f=c.extendKey;f&&(i[f]=c)}),t){var o=t(i),s=o.view,l=o.model,d=s;n&&!d.isObserved&&(d.isObserved=!0,d=Sr(d)),this.setView(e,d),this.graphModel.setModel(e,l)}},r.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=Sr(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},r.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),un(e,function(n){t.registerElement(n)})},r.prototype.defaultRegister=function(){var e=[{type:"rect",view:la,model:us},{type:"circle",view:Td,model:Md},{type:"polygon",view:Ld,model:Nd},{type:"text",view:ry,model:ey},{type:"ellipse",view:Nh,model:_h},{type:"diamond",view:kh,model:yh},{type:"html",view:jl,model:Il},{type:"line",view:ay,model:qm},{type:"polyline",view:ds,model:ls},{type:"bezier",view:oy,model:Ym}];this.batchRegister(e)},r.prototype.addNode=function(e,t,n){return t===void 0&&(t=Ct.NODE_ADD),this.graphModel.addNode(e,t,n)},r.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteNode(e),o},r.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){var i=this.options.guards,o=i!=null&&i.beforeClone?i.beforeClone(n):!0;if(o)return this.graphModel.cloneNode(e)}},r.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},r.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},r.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},r.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},r.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},r.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},r.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},r.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},r.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var n=new t(xo(xo({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(n),n},r.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},r.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},r.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},r.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},r.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},r.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},r.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},r.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,n=e.targetNodeId,i=[],o=this.graphModel.edges;return t&&n?un(o,function(s){s.sourceNodeId===t&&s.targetNodeId===n&&i.push(s)}):t?un(o,function(s){s.sourceNodeId===t&&i.push(s)}):n&&un(o,function(s){s.targetNodeId===n&&i.push(s)}),i},r.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},r.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},r.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteEdgeById(e),o},r.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,n=e.targetNodeId;t&&n?this.graphModel.deleteEdgeBySourceAndTarget(t,n):t?this.graphModel.deleteEdgeBySource(t):n&&this.graphModel.deleteEdgeByTarget(n)},r.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},r.prototype.addElements=function(e,t){var n=this,i=e.nodes,o=e.edges;t===void 0&&(t=40);var s={},l={nodes:[],edges:[]};return un(i,function(d){var c=d.id,f=n.addNode(d);c&&(s[c]=f.id),l.nodes.push(f)}),un(o,function(d){var c=d.sourceNodeId,f=d.targetNodeId;s[c]&&(c=s[c]),s[f]&&(f=s[f]);var v=n.graphModel.addEdge(xo(xo({},d),{sourceNodeId:c,targetNodeId:f}));l.edges.push(v)}),l},r.prototype.selectElementById=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),this.graphModel.selectElementById(e,t),!t&&n&&this.graphModel.toFront(e)},r.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},r.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},r.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},r.prototype.getModelById=function(e){return this.graphModel.getElement(e)},r.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},r.prototype.deleteElement=function(e){var t,n,i,o=this.getModelById(e);if(!o)return!1;var s=(t={},t[xn.NODE]=this.deleteNode,t[xn.EDGE]=this.deleteEdge,t);return(i=(n=s[o.BaseType])===null||n===void 0?void 0:n.call(this,e))!==null&&i!==void 0?i:!1},r.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},r.prototype.getAreaElement=function(e,t,n,i,o){return n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1),this.graphModel.getAreaElement(e,t,n,i,o).map(function(s){return s.getData()})},r.prototype.setProperties=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.setProperties(cr(t))},r.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},r.prototype.deleteProperty=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.deleteProperty(t)},r.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},r.prototype.editText=function(e){this.graphModel.editText(e)},r.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},r.prototype.updateEditConfig=function(e){var t=this.graphModel,n=t.editConfigModel,i=t.transformModel,o=n.snapGrid;if(n.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!xr(e==null?void 0:e.snapGrid)&&e.snapGrid!==o){var s=this.graphModel.grid.size,l=s===void 0?1:s;this.graphModel.updateGridSize(e.snapGrid?l:1)}this.emit(Ct.EDIT_CONFIG_CHANGED,{data:n.getConfig()})},r.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},r.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},r.prototype.getTheme=function(){return this.graphModel.getTheme()},r.prototype.focusByElement=function(e){var t=void 0,n=this.getNodeModelById(e);if(n){var i=n.getData(),o=i.x,s=i.y;t={x:o,y:s}}var l=this.getEdgeModelById(e);if(l){var d=l.textPosition,o=d.x,s=d.y;t={x:o,y:s}}t&&this.focusByCoordinate(t)},r.prototype.focusByCoordinate=function(e){var t=this.graphModel,n=t.transformModel,i=t.width,o=t.height,s=e.x,l=e.y;n.focusOn(s,l,i,o)},r.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,n=e.coordinate;t&&this.focusByElement(t),n&&this.focusByCoordinate(n)}},r.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},r.prototype.toFront=function(e){this.graphModel.toFront(e)},r.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},r.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Lf([n],qu(e),!1)):n},r.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},r.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},r.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(cr(e)),this.options.history!==!1&&this.history.watch(this.graphModel),xm(Ne(iB,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(Ct.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},r.prototype.render=function(e){var t=Ht(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},r.prototype.undo=function(){if(this.history.undoAble()){var e=cr(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.redo=function(){if(this.history.redoAble()){var e=cr(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.zoom=function(e,t){var n=this.graphModel.transformModel;return n.zoom(e,t)},r.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},r.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},r.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},r.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,n=e.SCALE_Y,i=e.TRANSLATE_X,o=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:n,TRANSLATE_X:i,TRANSLATE_Y:o}},r.prototype.translate=function(e,t){var n=this.graphModel.transformModel;n.translate(e,t)},r.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,n=e.TRANSLATE_Y;this.translate(-t,-n)},r.prototype.translateCenter=function(){this.graphModel.translateCenter()},r.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},r.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},r.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},r.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},r.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},r.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},r.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},r.use=function(e,t){var n,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(n={},n[Pf]=Pf,n.extension=e,n.props=t,n))},r.addThemeMode=function(e,t){ZI(e,t)},r.removeThemeMode=function(e){QI(e)},r.clearThemeMode=function(){Gm()},r.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var n=Array.from(r.extensions,function(o){var s=qu(o,2),l=s[1];return l}),i=Lf(Lf([],qu(this.plugins),!1),qu(n),!1);un(i,function(o){var s,l;Pf in o?(s=o.extension,l=o.props):s=o;var d=s==null?void 0:s.pluginName;nO(e,d)===-1&&t.installPlugin(s,l)})},r.prototype.installPlugin=function(e,t){var n,i;if("pluginName"in e&&"install"in e){var o=e.pluginName,s=e.install,l=e.render;o&&(s&&s.call(e,this,r),l&&this.components.push(l.bind(e)),this.extension[o]=e);return}var d=e,c=d.pluginName,f=new d({lf:this,LogicFlow:r,props:t,options:(i=(n=this.options.pluginsOptions)===null||n===void 0?void 0:n[c])!==null&&i!==void 0?i:{}});f.render&&this.components.push(f.render.bind(f)),this.extension[c]=f},r.prototype.destroy=function(){var e;this.clearData(),xm(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Gm();for(var t in this.extension){var n=this.extension[t];"destroy"in n&&((e=n.destroy)===null||e===void 0||e.call(n))}},r.extensions=new Map,r}();(function(r){r.toStringTag="LF.".concat(r.name)})(Rh||(Rh={}));const u4=Rh;function Sr(r){return pp(r)}var cy={width:40,height:40},fy={width:40,height:40},hy={width:40,height:40},py={width:100,height:80},vy={width:100,height:80},d4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),c4=(globalThis==null?void 0:globalThis._ids)||new d4;function Es(){return c4.next()}var Vw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){Vw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(Es())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=r.prototype.getConnectedTargetRules.call(this),n={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(n),t},e.extendKey="StartEventModel",e})(Md);(function(r){Vw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(Td);var Xw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bd=function(){return Bd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bd.apply(this,arguments)};(function(r){Xw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(Es())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=r.prototype.getConnectedSourceRules.call(this),n={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(n),t},e.extendKey="EndEventModel",e})(Md);(function(r){Xw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle(),i=t,o=i.x,s=i.y,l=i.r,d=r.prototype.getShape.call(this);return xt("g",{},d,xt("circle",Bd(Bd({},n),{cx:o,cy:s,r:l-5})))},e.extendKey="EndEventView",e})(Td);var Gw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){Gw(e,r);function e(t,n){return t.id||(t.id="Flow_".concat(Es())),r.call(this,t,n)||this}return e.extendKey="SequenceFlowModel",e})(ls);(function(r){Gw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(ds);var Yw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bl=function(){return bl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bl.apply(this,arguments)};(function(r){Yw(e,r);function e(t,n){var i=this;return t.id||(t.id="Gateway_".concat(Es())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=r.call(this,t,n)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(Nd);(function(r){Yw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,s=n.width,l=n.height,d=n.points,c=t.getNodeStyle();return xt("g",{transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(o-l/2,")")},xt("polygon",bl(bl({},c),{x:i,y:o,points:d})),xt("path",bl({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},c)))},e.extendKey="ExclusiveGatewayNode",e})(Ld);var Kw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ih=function(){return Ih=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ih.apply(this,arguments)};(function(r){Kw(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(Es())),r.call(this,t,n)||this}return e.extendKey="ServiceTaskModel",e})(us);(function(r){Kw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getNodeStyle();return xt("svg",{x:n-o/2+5,y:i-s/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},xt("path",{fill:l.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.radius,d=t.getNodeStyle();return xt("g",{},[xt("rect",Ih({x:n-o/2,y:i-s/2,rx:l,ry:l,width:o,height:s},d)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(la);var qw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),jd=function(){return jd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},jd.apply(this,arguments)};(function(r){qw(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(Es())),r.call(this,t,n)||this}return e.extendKey="UserTaskModel",e})(us);(function(r){qw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getNodeStyle();return xt("svg",{x:n-o/2+5,y:i-s/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},xt("path",{fill:l.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.radius,d=t.getNodeStyle();return xt("g",{},[xt("rect",jd(jd({},d),{x:n-o/2,y:i-s/2,rx:l,ry:l,width:o,height:s})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(la);var f4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),h4=(globalThis==null?void 0:globalThis._ids)||new f4;function gy(){return h4.next()}function Jw(r){return Object.prototype.toString.call(r)}function p4(r){return"  ".repeat(r)}function Hd(r){var e=r;return Jw(r)==="[object Object]"?(e={},Object.keys(r).forEach(function(t){var n=t;t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=Hd(r[t])})):Array.isArray(r)&&(e=[],r.forEach(function(t,n){e[n]=Hd(t)})),e}function $d(r){return r==null?"":r.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function v4(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(Hd(r)).replace(/"/g,"'")}return $d(String(e))}var Xo=`	
`;function id(r,e,t){var n=p4(t);if(r!==0&&r!==!1&&!r)return Xo+n+"<".concat(e," />");var i="";if(e==="#text")return Xo+n+$d(String(r));if(e==="#cdata-section")return Xo+n+"<![CDATA["+r+"]]>";if(e==="#comment")return Xo+n+"<!--"+r+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+v4(r)+'"';if(Array.isArray(r))r.forEach(function(d){i+=id(d,e,t+1)});else if(Jw(r)==="[object Object]"){var o=Object.keys(r),s="",l="";i+=(t===0?"":Xo+n)+"<"+e,o.forEach(function(d){d.charAt(0)==="-"?s+=id(r[d],d,t+1):l+=id(r[d],d,t+1)}),i+=s+(l!==""?">".concat(l).concat(Xo+n,"</").concat(e,">"):" />")}else i+=Xo+n+"<".concat(e,">").concat($d(String(r)),"</").concat(e,">");return i}function g4(r){var e="";for(var t in r)e+=id(r[t],t,0);return e}var Or=function(){};Or.ObjTree=function(){return this};Or.ObjTree.VERSION="0.23";Or.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Or.ObjTree.prototype.attr_prefix="-";Or.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e)return this.parseDOM(e)};Or.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,s=t,l=n.onComplete;n.onComplete=function(f){var v;f&&f.responseXML&&f.responseXML.documentElement&&(v=o.parseDOM(f.responseXML.documentElement)),s(v,f),l&&l(f)}}else n.asynchronous=!1;var d;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var c=new HTTP.Request(n);c&&(d=c.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var c=new Ajax.Request(r,n);c&&(d=c.transport)}if(t)return d;if(d&&d.responseXML&&d.responseXML.documentElement)return this.parseDOM(d.responseXML.documentElement)};Or.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!=11){var n={};n[r.nodeName]=t,t=n}return t}};Or.ObjTree.prototype.parseElement=function(r){if(r.nodeType!=7){if(r.nodeType==3||r.nodeType==4||r.nodeType==8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var s=r.attributes[i].nodeValue;try{s=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=r.attributes[i].nodeValue}s&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var d=r.childNodes[i].nodeType;d==3||d==4||d==8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var s=this.parseElement(r.childNodes[i]);s&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}}else t===null&&(t={});return t}};Or.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t==1&&(r[e]=[]),r[e][r[e].length]=n):t==1?r[e]=n:t==2?r[e]=[r[e],n]:r[e][r[e].length]=n};Or.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};Or.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];i.charAt(0)!=this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<"+i+" />":typeof o=="object"&&o.constructor==Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" "+i.substring(1)+'="'+this.xml_escape(o)+'"'}var s=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<"+r+s+`>
`+l+"</"+r+`>
`:l="<"+r+s+">"+l+"</"+r+`>
`:l="<"+r+s+` />
`),l};Or.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<"+r+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};Or.ObjTree.prototype.scalar_to_xml=function(r,e){return r=="#text"?this.xml_escape(e):"<"+r+">"+this.xml_escape(e)+"</"+r+`>
`};Or.ObjTree.prototype.xml_escape=$d;var m4=function(r){return new Or.ObjTree().parseXML(r)},y4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bh=function(){return Bh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bh.apply(this,arguments)},mc=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Ui;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow"})(Ui||(Ui={}));var Zw=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],my=["properties","startPoint","endPoint","pointsList"],Qw=function(r){return String(r||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function yy(r){var e=r?my.concat(r):my;return function(t){function n(i){var o={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(s){return n(s)}):(Object.entries(i).forEach(function(s){var l=mc(s,2),d=l[0],c=l[1];typeof c!="object"?d.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(d)?o[d]=c:o["-".concat(d)]=c:e.includes(d)?o["-".concat(d)]=n(c):o[d]=n(c)}),o)}return n(t)}}function Fd(r){var e={};return Object.entries(r).forEach(function(t){var n=mc(t,2),i=n[0],o=n[1];i.indexOf("-")===0?e[i.substring(1)]=Hd(o):typeof o=="string"?e[i]=o:Object.prototype.toString.call(o)==="[object Object]"?e[i]=Fd(o):Array.isArray(o)?e[i]=o.map(function(s){return Fd(s)}):e[i]=o}),e}function _4(r,e,t){var n=new Map;e.nodes.forEach(function(o){var s,l={"-id":o.id};if(!((s=o.text)===null||s===void 0)&&s.value&&(l["-name"]=o.text.value),o.properties){var d=yy(t)(o.properties);Object.assign(l,d)}n.set(o.id,l),r[o.type]?Array.isArray(r[o.type])?r[o.type].push(l):r[o.type]=[r[o.type],l]:r[o.type]=l});var i=e.edges.map(function(o){var s,l,d=n.get(o.targetNodeId);d["bpmn:incoming"]?Array.isArray(d["bpmn:incoming"])?d["bpmn:incoming"].push(o.id):d["bpmn:incoming"]=[d["bpmn:incoming"],o.id]:d["bpmn:incoming"]=o.id;var c={"-id":o.id,"-sourceRef":o.sourceNodeId,"-targetRef":o.targetNodeId};if(!((s=o.text)===null||s===void 0)&&s.value&&(c["-name"]=(l=o.text)===null||l===void 0?void 0:l.value),o.properties){var f=yy(t)(o.properties);Object.assign(c,f)}return c});e.edges.forEach(function(o){var s=n.get(o.sourceNodeId);s["bpmn:outgoing"]?Array.isArray(s["bpmn:outgoing"])?s["bpmn:outgoing"].push(o.id):s["bpmn:outgoing"]=[s["bpmn:outgoing"],o.id]:s["bpmn:outgoing"]=o.id}),r[Ui.FLOW]=i}function b4(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var d=l.x,c=l.y;return{"-x":d,"-y":c}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,s=80,l=t.x,d=t.y,c=Lo.shapeConfigMap.get(t.type);c&&(o=c.width,s=c.height),l-=o/2,d-=s/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":d,"-width":o,"-height":s}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}function x4(r){var e=[],t=[],n=r["bpmn:definitions"];if(n){var i=n["bpmn:process"],o=n["bpmndi:BPMNDiagram"],s=o==null?void 0:o["bpmndi:BPMNPlane"];if(!i||!s)return{nodes:e,edges:t};Object.keys(i).forEach(function(l){if(l.indexOf("bpmn:")===0){var d=i[l];if(l===Ui.FLOW){var c=s["bpmndi:BPMNEdge"],f=(Array.isArray(c),c);t=S4(d,f)}else{var v=s["bpmndi:BPMNShape"],g=(Array.isArray(v),v);e=e.concat(w4(d,g,l))}}})}return{nodes:e,edges:t}}function w4(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(s){var l;Array.isArray(e)?l=e.find(function(c){return c["-bpmnElement"]===s["-id"]}):l=e;var d=_y(l,t,s);n.push(d)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===r["-id"]}):i=e;var o=_y(i,t,r);n.push(o)}return n}function _y(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=Qw(t["-name"]),s=Lo.shapeConfigMap.get(e);s&&(n+=s.width/2,i+=s.height/2);var l;Object.entries(t).forEach(function(v){var g=mc(v,2),y=g[0],b=g[1];Zw.indexOf(y)===-1&&(l||(l={}),l[y]=b)}),l&&(l=Fd(l));var d;if(o&&(d={x:n,y:i,value:o},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var c=r["bpmndi:BPMNLabel"]["dc:Bounds"];d.x=Number(c["-x"])+Number(c["-width"])/2,d.y=Number(c["-y"])+Number(c["-height"])/2}var f={id:r["-bpmnElement"],type:e,x:n,y:i,properties:l};return d&&(f.text=d),f}function S4(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):o=e,t.push(by(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(by(n,r))}return t}function by(r,e){var t,n=e["-name"]?Qw("".concat(e["-name"])):"";if(n){var i=void 0;r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=r["bpmndi:BPMNLabel"]["dc:Bounds"]);var o=0;if(n.split(`
`).forEach(function(y){o<y.length&&(o=y.length)}),i)t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7};else{var s=r["di:waypoint"]||[],l=s[0],d=s[s.length-1]||l,c=(Number((l==null?void 0:l["-x"])||0)+Number((d==null?void 0:d["-x"])||0))/2,f=(Number((l==null?void 0:l["-y"])||0)+Number((d==null?void 0:d["-y"])||0))/2;t={value:n,x:c,y:f}}}var v;Object.entries(e).forEach(function(y){var b=mc(y,2),x=b[0],w=b[1];Zw.indexOf(x)===-1&&(v||(v={}),v[x]=w)}),v&&(v=Fd(v));var g={id:e["-id"],type:Ui.FLOW,pointsList:r["di:waypoint"].map(function(y){return{x:Number(y["-x"]),y:Number(y["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:v};return t&&(g.text=t),g}var Lo=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var s=Bh({},n.processAttributes);_4(s,i,o);var l={"-id":"BPMNPlane_1","-bpmnElement":s["-id"]};b4(l,i);var d=n.definitionAttributes;d["bpmn:process"]=s,d["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":l};var c={"bpmn:definitions":d};return c},this.adapterIn=function(i){if(i)return x4(i)},t.adapterIn=function(i){return n.adapterIn(i)},t.adapterOut=function(i,o){return n.adapterOut(i,o)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(gy())},this.definitionAttributes={"-id":"Definitions_".concat(gy()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();Lo.shapeConfigMap.set(Ui.START,{width:cy.width,height:cy.height});Lo.shapeConfigMap.set(Ui.END,{width:fy.width,height:fy.height});Lo.shapeConfigMap.set(Ui.GATEWAY,{width:hy.width,height:hy.height});Lo.shapeConfigMap.set(Ui.SYSTEM,{width:py.width,height:py.height});Lo.shapeConfigMap.set(Ui.USER,{width:vy.width,height:vy.height});(function(r){y4(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(o){var s=typeof o=="string"?n.sanitizeNameAttributes(o):o,l=m4(s);return n.adapterIn(l)},n.adapterXmlOut=function(o,s){var l=n.adapterOut(o,s);return g4(l)};var i=t.lf;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(n,i){var o=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(o,'"')})},e.pluginName="bpmnXmlAdapter",e})(Lo);var E4=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var n=Math.random()*16|0,i=t==="x"?n:n&3|8;return i.toString(16)});return e},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),C4=(globalThis==null?void 0:globalThis._ids)||new E4;function O4(){return C4.next()}xt("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),xt("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),xt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});xt("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});xt("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var k4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Qo=function(){return Qo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Qo.apply(this,arguments)},M4=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},N4=ai,A4=function(r){k4(e,r);function e(t){var n=r.call(this)||this;return n.updatePosition=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.x,c=l.y;n.nodeModel.x=d+o/2,n.nodeModel.y=c+s/2,n.nodeModel.moveText(o/2,s/2)},n.getResize=function(i){var o=i.index,s=i.deltaX,l=i.deltaY,d=i.width,c=i.height,f=i.PCTResizeInfo,v=i.pct,g=v===void 0?1:v,y=i.freezeWidth,b=y===void 0?!1:y,x=i.freezeHeight,w=x===void 0?!1:x,_={width:d,height:c,deltaX:s,deltaY:l};if(f){var C=4,k=0,D=0;switch(o){case 0:D=(s*-1-l)/C;break;case 1:D=(s-l)/C;break;case 2:D=(s+l)/C;break;case 3:D=(s*-1+l)/C;break}D!==0&&(k=Math.round(D/f.ResizeBasis.basisHeight*1e5)/1e3),f.ResizePCT.widthPCT=Math.max(Math.min(f.ResizePCT.widthPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit),f.ResizePCT.heightPCT=Math.max(Math.min(f.ResizePCT.heightPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit);var R=Math.round(f.ResizePCT.widthPCT*f.ResizeBasis.basisWidth/100),$=Math.round(f.ResizePCT.heightPCT*f.ResizeBasis.basisHeight/100);switch(o){case 0:s=d-R,l=c-$;break;case 1:s=R-d,l=c-$;break;case 2:s=R-d,l=$-c;break;case 3:s=d-R,l=$-c;break}return _.width=R,_.height=$,_.deltaX=s/g,_.deltaY=l/g,_}switch(o){case 0:_.width=b?d:d-s*g,_.height=w?c:c-l*g;break;case 1:_.width=b?d:d+s*g,_.height=w?c:c-l*g;break;case 2:_.width=b?d:d+s*g,_.height=w?c:c+l*g;break;case 3:_.width=b?d:d-s*g,_.height=w?c:c+l*g;break}return _},n.updateEdgePointByAnchors=function(){var i=n.nodeModel,o=i.id,s=i.anchors,l=n.getNodeEdges(o);l.sourceEdges.forEach(function(d){var c=s.find(function(f){return f.id===d.sourceAnchorId});c&&d.updateStartPoint({x:c.x,y:c.y})}),l.targetEdges.forEach(function(d){var c=s.find(function(f){return f.id===d.targetAnchorId});c&&d.updateEndPoint({x:c.x,y:c.y})})},n.updateRect=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.x,c=l.y,f=l.width,v=l.height,g=l.radius,y=l.PCTResizeInfo,b=n.nodeModel,x=b.minWidth,w=b.minHeight,_=b.maxWidth,C=b.maxHeight,k=n.index,D=x===_,R=w===C,$=n.getResize({index:k,deltaX:o,deltaY:s,width:f,height:v,PCTResizeInfo:y,pct:1,freezeWidth:D,freezeHeight:R});if($.width<x||$.width>_||$.height<w||$.height>C){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:D?0:$.deltaX,deltaY:R?0:$.deltaY}),n.nodeModel.width=$.width,n.nodeModel.height=$.height,n.nodeModel.setProperties({nodeSize:{width:$.width,height:$.height}});var P={x:d,y:c,width:f,height:v,radius:g},I={x:n.nodeModel.x,y:n.nodeModel.y,width:n.nodeModel.width,height:n.nodeModel.height,radius:g};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:P,afterNode:I})},n.updateEllipse=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.rx,c=l.ry,f=l.x,v=l.y,g=l.PCTResizeInfo,y=n.index,b=n.nodeModel,x=b.minWidth,w=b.minHeight,_=b.maxWidth,C=b.maxHeight,k=x===_,D=w===C,R=d,$=c,P=n.getResize({index:y,deltaX:o,deltaY:s,width:R,height:$,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:D});if(P.width<x/2||P.width>_/2||P.height<w/2||P.height>C/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:P.deltaX,deltaY:D?0:P.deltaY}),n.nodeModel.rx=P.width,n.nodeModel.ry=P.height,n.nodeModel.setProperties({nodeSize:{rx:P.width,ry:P.height}});var I={x:f,y:v},W={rx:P.width,ry:P.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:Qo(Qo({},I),{rx:d,ry:c}),afterNode:W})},n.updateDiamond=function(i){var o=i.deltaX,s=i.deltaY,l=n.nodeModel,d=l.rx,c=l.ry,f=l.x,v=l.y,g=l.PCTResizeInfo,y=n.index,b=n.nodeModel,x=b.minWidth,w=b.minHeight,_=b.maxWidth,C=b.maxHeight,k=x===_,D=w===C,R=d,$=c,P=n.getResize({index:y,deltaX:o,deltaY:s,width:R,height:$,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:D});if(P.width<x/2||P.width>_/2||P.height<w/2||P.height>C/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:P.deltaX,deltaY:D?0:P.deltaY}),n.nodeModel.rx=P.width,n.nodeModel.ry=P.height,n.nodeModel.setProperties({nodeSize:{rx:P.width,ry:P.height}});var I={x:f,y:v,rx:d,ry:c},W={rx:P.width,ry:P.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:s,beforeNode:I,afterNode:W})},n.eventEmit=function(i){var o=i.deltaX,s=i.deltaY,l=i.beforeNode,d=i.afterNode,c=n.nodeModel,f=c.id,v=c.modelType,g=c.type,y=Qo({id:f,modelType:v,type:g},l),b=Qo({id:f,modelType:v,type:g},d);n.graphModel.eventCenter.emit("node:resize",{preData:y,data:b,deltaX:o,deltaY:s,index:n.index,model:n.nodeModel})},n.onDragging=function(i){var o,s=i.deltaX,l=i.deltaY,d=n.graphModel.transformModel,c=n.nodeModel.modelType;o=M4(d.fixDeltaXY(s,l),2),s=o[0],l=o[1],c===Wt.RECT_NODE||c===Wt.HTML_NODE?n.updateRect({deltaX:s,deltaY:l}):c===Wt.ELLIPSE_NODE?n.updateEllipse({deltaX:s,deltaY:l}):c===Wt.DIAMOND_NODE&&n.updateDiamond({deltaX:s,deltaY:l})},n.onDragEnd=function(){var i=n.graphModel.gridSize,o=i===void 0?1:i,s=o*Math.round(n.nodeModel.x/o),l=o*Math.round(n.nodeModel.y/o);n.nodeModel.moveTo(s,l),n.updateEdgePointByAnchors()},n.index=t.index,n.nodeModel=t.model,n.graphModel=t.graphModel,n.dragHandler=new N4({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:1}),n}return e.prototype.getNodeEdges=function(t){for(var n=this.graphModel,i=n.edges,o=[],s=[],l=0;l<i.length;l++){var d=i[l];d.sourceNodeId===t?o.push(d):i[l].targetNodeId===t&&s.push(d)}return{sourceEdges:o,targetEdges:s}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.index,s=t.model,l=s.getControlPointStyle();return Ne("g",{className:"lf-resize-control-".concat(o),children:Ne(ni,Qo({className:"lf-node-control",x:n,y:i},l,{onMouseDown:this.dragHandler.handleMouseDown}))})},e}(Gt),T4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),zd=function(){return zd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},zd.apply(this,arguments)},yc=function(r){T4(e,r);function e(){var t=r.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=n.x,s=n.y,l=n.width,d=n.height,c={minX:o-l/2,minY:s-d/2,maxX:o+l/2,maxY:s+d/2},f=c.minX,v=c.minY,g=c.maxX,y=c.maxY,b=[{x:f,y:v},{x:g,y:v},{x:g,y},{x:f,y}];return b.map(function(x,w){return Ne(A4,zd({index:w},x,{model:n,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.getResizeOutlineStyle();return Ne(ni,zd({},l,{x:n,y:i,width:o,height:s}))},e.prototype.render=function(){return Ne("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e}(Gt),eS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){eS(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(_h);(function(r){eS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Ne(yc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel.editConfigModel.isSilentMode;return Ne("g",{children:[this.getResizeShape(),n.isSelected&&!i?this.getControlGroup():""]})},e})(Nh);var tS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),jh=function(){return jh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},jh.apply(this,arguments)};(function(r){tS(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(yh);(function(r){tS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Ne(yc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,n=t.points,i=t.getNodeStyle();return Ne("g",{children:Ne(mp,jh({},i,{points:n}))})},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Ne("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(kh);var nS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){nS(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Il);(function(r){nS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Ne(yc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Ne("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(jl);var rS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),D4=function(r){rS(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e}(us),L4=function(r){rS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Ne(yc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Ne("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e}(la),iS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Wd=function(){return Wd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wd.apply(this,arguments)},Go=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Yo=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},xy=500,wy=300,P4=-1e4;(function(r){iS(e,r);function e(){var t=r.apply(this,Yo([],Go(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=xy,t.unfoldedHeight=wy,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var n=this;r.prototype.initNodeData.call(this,t);var i=[];y_(t.children)&&(i=t.children),this.children=new Set(i),this.width=xy,this.height=wy,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=P4,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){n.isFolded&&n.foldGroup(n.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var n=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=Yo(Yo([],Go(this.incoming.edges),!1),Go(this.outgoing.edges),!1);this.children.forEach(function(o){var s=n.graphModel.getElement(o);if(s){var l=s.isFolded;if(s.isGroup&&!s.isFolded&&s.foldGroup(t),s.isGroup&&!t){var d=n.childrenLastFoldStatus[o];d!==void 0&&d!==s.isFolded&&s.foldGroup(d)}n.childrenLastFoldStatus[o]=!!l,s.visible=!t;var c=s.incoming.edges,f=s.outgoing.edges;i=Yo(Yo(Yo([],Go(i),!1),Go(c),!1),Go(f),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var n=r.prototype.getAnchorStyle.call(this,t);return n.stroke="transparent",n.fill="transparent",n.hover.fill="transparent",n.hover.stroke="transparent",n},e.prototype.foldEdge=function(t,n){var i=this;n.forEach(function(o,s){var l=o.id,d=o.sourceNodeId,c=o.targetNodeId,f=o.startPoint,v=o.endPoint,g=o.type,y=o.text,b=o.getProperties(),x={id:"".concat(l,"__").concat(s),sourceNodeId:d,targetNodeId:c,startPoint:f,endPoint:v,type:g,properties:b,text:y==null?void 0:y.value};o.virtual&&i.graphModel.deleteEdgeById(o.id);var w=i.graphModel.group.getNodeGroup(c);w||(w=i.graphModel.getNodeModelById(c));var _=i.graphModel.group.getNodeGroup(d);_||(_=i.graphModel.getNodeModelById(d)),t&&o.visible!==!1&&(i.children.has(d)||i.id===d?(x.startPoint=void 0,x.sourceNodeId=i.id):(x.endPoint=void 0,x.targetNodeId=i.id),(w.id!==i.id||_.id!==i.id)&&i.createVirtualEdge(x),o.visible=!1),!t&&o.visible===!1&&(w&&w.isGroup&&w.isFolded?(x.targetNodeId=w.id,x.endPoint=void 0,i.createVirtualEdge(x)):_&&_.isGroup&&_.isFolded?(x.sourceNodeId=_.id,x.startPoint=void 0,i.createVirtualEdge(x)):o.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isFoldedEdge=!0},e.prototype.isInRange=function(t){var n=t.minX,i=t.minY,o=t.maxX,s=t.maxY;return n>=this.x-this.width/2&&o<=this.x+this.width/2&&i>=this.y-this.height/2&&s<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var n=t.minX,i=t.minY,o=t.maxX,s=t.maxY;return{x:n>=this.x-this.width/2&&o<=this.x+this.width/2,y:i>=this.y-this.height/2&&s<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this);n.children=[],this.children.forEach(function(o){var s=t.graphModel.getNodeModelById(o);s&&!s.virtual&&n.children.push(o)});var i=n.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,n},e.prototype.getHistoryData=function(){var t=r.prototype.getData.call(this);t.children=Yo([],Go(this.children),!1),t.isGroup=!0;var n=t.properties;return n==null||delete n.groupAddable,n!=null&&n.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(D4);(function(r){iS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,n=t.resizable,i=t.properties;return n&&!i.isFolded?r.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,s=t.y,l=t.radius,d=t.properties,c=t.getAddableOutlineStyle;if(!d.groupAddable)return null;var f=this.props.model.getNodeStyle().strokeWidth,v=f===void 0?0:f,g=c(),y=n+v+8,b=i+v+8;return xt("rect",Wd(Wd({},g),{width:y,height:b,x:o-y/2,y:s-b/2,rx:l,ry:l}))},e.prototype.getFoldIcon=function(){var t=this.props.model,n=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var o=xt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," M").concat(n+7,",").concat(i+2," ").concat(n+7,",").concat(i+10):"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," ")});return xt("g",{},[xt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),o])},e.prototype.getResizeShape=function(){return xt("g",{},[this.getAddableShape(),r.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(L4);var Sy=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),xl=function(){return xl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},xl.apply(this,arguments)};function R4(r){var e=function(n){Sy(i,n);function i(o,s){o.id||(o.id="Flow_".concat(O4()));var l=xl(xl(xl({},{}),o.properties),{isDefaultFlow:!1});return o.properties=l,n.call(this,o,s)||this}return i.extendKey="SequenceFlowModel",i}(ls),t=function(n){Sy(i,n);function i(){return n!==null&&n.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var o=this.props.model,s=o.properties.isDefaultFlow;return s?xt("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):xt("path",{d:""})},i.extendKey="SequenceFlowEdge",i}(ds);return{type:"bpmn:sequenceFlow",view:t,model:e}}R4();var Ey={width:40,height:40},Cy={width:40,height:40},Oy={width:100,height:80},Ud={width:100,height:80},ky={width:100,height:80},My={width:100,height:80},Ny={width:100,height:80},Ay={width:100,height:80},Ty={width:100,height:80},Dy={width:100,height:80},kr=function(){};kr.ObjTree=function(){return this};kr.ObjTree.VERSION="0.23";kr.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;kr.ObjTree.prototype.attr_prefix="-";kr.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};kr.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,s=t,l=n.onComplete;n.onComplete=function(f){var v;f&&f.responseXML&&f.responseXML.documentElement&&(v=o.parseDOM(f.responseXML.documentElement)),s(v,f),l&&l(f)}}else n.asynchronous=!1;var d;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var c=new HTTP.Request(n);c&&(d=c.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var c=new Ajax.Request(r,n);c&&(d=c.transport)}if(t)return d;if(d&&d.responseXML&&d.responseXML.documentElement)return this.parseDOM(d.responseXML.documentElement)};kr.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!==11){var n={};n[r.nodeName]=t,t=n}return t}};kr.ObjTree.prototype.parseElement=function(r){if(r.nodeType!==7){if(r.nodeType===3||r.nodeType===4||r.nodeType===8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var s=r.attributes[i].nodeValue;try{s=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=r.attributes[i].nodeValue}s!=null&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var d=r.childNodes[i].nodeType;d===3||d===4||d===8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var s=this.parseElement(r.childNodes[i]);s&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],s))}}}}else t===null&&(t={});return t}};kr.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t===1&&(r[e]=[]),r[e][r[e].length]=n):t===1?r[e]=n:t===2?r[e]=[r[e],n]:r[e][r[e].length]=n};kr.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};kr.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(Uf(e,i)){var o=e[i];i.charAt(0)!==this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<".concat(i," />"):typeof o=="object"&&o.constructor===Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(o),'"')}var s=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<".concat(r).concat(s,`>
`).concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(s,">").concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(s,` />
`)),l};kr.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<".concat(r," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};kr.ObjTree.prototype.scalar_to_xml=function(r,e){return r==="#text"?this.xml_escape(e):"<".concat(r,">").concat(this.xml_escape(e),"</").concat(r,`>
`)};kr.ObjTree.prototype.xml_escape=function(r){return r.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var I4=function(r){return new kr.ObjTree().parseXML(r)};function oS(r){return Object.prototype.toString.call(r)}function Ly(r){return"  ".repeat(r)}function Vd(r){return oS(r)==="[object Object]"?Object.keys(r).reduce(function(e,t){var n=t;return t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=Vd(r[t]),e},{}):Array.isArray(r)?r.map(function(e){return Vd(e)}):r}function B4(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(Vd(r)).replace(/"/g,"'")}return e}var Py=`	
`;function od(r,e,t){var n=Ly(t),i="",o=Py+n;if(e==="-json")return"";if(e==="#text")return o+r;if(e==="#cdata-section")return"".concat(o,"<![CDATA[").concat(r,"]]>");if(e==="#comment")return"".concat(o,"<!--").concat(r,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(B4(r),'"');if(Array.isArray(r))i+=r.map(function(c){return od(c,e,t+1)}).join("");else if(oS(r)==="[object Object]"){var s=Object.keys(r),l="",d=r["-json"]?Py+Ly(t+1)+r["-json"]:"";i+="".concat(t===0?"":o,"<").concat(e),s.forEach(function(c){c.charAt(0)==="-"?l+=od(r[c],c,t+1):d+=od(r[c],c,t+1)}),i+=l+(d!==""?">".concat(d).concat(o,"</").concat(e,">"):" />")}else i+="".concat(o,"<").concat(e,">").concat(r.toString(),"</").concat(e,">");return i}function j4(r){var e="";for(var t in r)e+=od(r[t],t,0);return e}var H4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Hh=function(){return Hh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Hh.apply(this,arguments)},Ry=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},bp=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},dr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},mi=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Er;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",r.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",r.BOUNDARY="bpmn:boundaryEvent",r.PARALLEL_GATEWAY="bpmn:parallelGateway",r.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",r.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow",r.SUBPROCESS="bpmn:subProcess"})(Er||(Er={}));var aS=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],$4=["properties","startPoint","endPoint","pointsList"],Xd={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},sS=function(r,e){var t=Object.keys(e||{});return t.forEach(function(n){if(r[n]){var i=e[n],o=i.in,s=i.out;o&&(r[n].in=o),s&&(r[n].out=s)}else r[n]=e[n]}),r},ei={"bpmn:startEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ei[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateCatchEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ei[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateThrowEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ei[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:boundaryEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ei[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:sequenceFlow":{out:function(r){var e=r.properties,t=e.expressionType,n=e.condition;return n?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(n,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(n,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(r){var e=r.properties,t=e.timerType,n=e.timerValue,i=e.definitionId,o=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(n,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&n?">".concat(o(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(r,e){var t,n,i,o,s=r,l=e["-id"],d="",c="";try{for(var f=bp(Object.keys(e)),v=f.next();!v.done;v=f.next()){var g=v.value;g.includes("bpmn:")&&(i=dr(g.split(":"),2),d=i[1],c=(o=e[g])===null||o===void 0?void 0:o["#text"])}}catch(y){t={error:y}}finally{try{v&&!v.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}return{"-definitionId":l,"-definitionType":s,"-timerType":d,"-timerValue":c}}},"bpmn:conditionExpression":{in:function(r,e){var t,n="",i="";return e["#cdata-section"]?(i="cdata",n=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",n=e["#text"]),{"-condition":n,"-expressionType":i}}}};function F4(r){var e=r??{},t=e.retainedAttrsFields,n=e.excludeFields,i=e.transformer,o=new Set(mi(mi([],dr($4),!1),dr(t||[]),!1)),s={in:new Set(mi(mi([],dr(Xd.in),!1),dr((n==null?void 0:n.in)||[]),!1)),out:new Set(mi(mi([],dr(Xd.out),!1),dr((n==null?void 0:n.out)||[]),!1))};return ei=sS(ei,i),function(l){var d=l.nodes,c=l.edges;function f(v,g){var y,b;if((v==null?void 0:v.flag)!==1){var x;if((x=ei[v.type])&&x.out){var w=x.out(v),_=Object.keys(w);_.length>0&&_.forEach(function(W){v[W]=w[W]})}v!=null&&v.children&&(v.children=v.children.map(function(W){var se=d.find(function(q){return q.id===W})||c.find(function(q){return q.id===W});return se||{}}));var C={};if(typeof v=="string")return v;if(Array.isArray(v))return v.map(function(W){return f(W,"")}).filter(function(W){return W!=null});try{for(var k=bp(Object.entries(v)),D=k.next();!D.done;D=k.next()){var R=dr(D.value,2),$=R[0],P=R[1];if((P==null?void 0:P.flag)===1)return;var I=[g,$].filter(function(W){return W}).join(".");s.out.has(I)||(typeof P!="object"?$.indexOf("-")===0||["#text","#cdata-section","#comment"].includes($)?C[$]=P:C["-".concat($)]=P:o.has(I)?C["-".concat($)]=f(P,I):C[$]=f(P,I))}}catch(W){y={error:W}}finally{try{D&&!D.done&&(b=k.return)&&b.call(k)}finally{if(y)throw y.error}}return C}}return f(l,"")}}function Gd(r){var e,t,n={};try{for(var i=bp(Object.entries(r)),o=i.next();!o.done;o=i.next()){var s=dr(o.value,2),l=s[0],d=s[1];l.indexOf("-")===0?n[l.substring(1)]=Vd(d):typeof d=="string"?n[l]=d:Object.prototype.toString.call(d)==="[object Object]"?n[l]=Gd(d):Array.isArray(d)?n[l]=d.map(function(c){return Gd(c)}):n[l]=d}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n}function z4(r,e,t){var n,i=new Map,o=F4(t)(e);o.nodes.forEach(function(l){var d=l["-id"],c=l["-type"],f=l.text,v=l.children,g=Ry(l,["-id","-type","text","children"]),y={"-id":d};f!=null&&f["-value"]&&(y["-name"]=f["-value"]),g["-json"]&&(y["-json"]=g["-json"]),g["-properties"]&&Object.assign(y,g["-properties"]),v&&(y.children=v),r[c]||(r[c]=[]),r[c].push(y),i.set(d,y)});var s=o.edges.map(function(l){var d=l["-id"],c=l["-sourceNodeId"],f=l["-targetNodeId"],v=l.text,g=Ry(l,["-id","-sourceNodeId","-targetNodeId","text"]),y=i.get(f);y["bpmn:incoming"]||(y["bpmn:incoming"]=[]),y["bpmn:incoming"].push(d);var b={"-id":d,"-sourceRef":c,"-targetRef":f};return v!=null&&v["-value"]&&(b["-name"]=v["-value"]),g["-json"]&&(b["-json"]=g["-json"]),g["-properties"]&&Object.assign(b,g["-properties"]),b});return e.edges.forEach(function(l){var d=l.sourceNodeId,c=l.id,f=i.get(d);f["bpmn:outgoing"]||(f["bpmn:outgoing"]=[]),f["bpmn:outgoing"].push(c)}),(n=r["bpmn:subProcess"])===null||n===void 0||n.forEach(function(l){var d={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},c=[];l.children.forEach(function(x){var w,_=i.get(x["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(k){_[k]&&_[k].forEach(function(D){d[k].add(D)})});var C=(w=r[x["-type"]])===null||w===void 0?void 0:w.findIndex(function(k){return k["-id"]===x["-id"]});C>=0&&r[x["-type"]].splice(C,1),i.delete(x["-id"]),l[x["-type"]]||(l[x["-type"]]=[]),l[x["-type"]].push(_)});var f=d["bpmn:incoming"],v=d["bpmn:outgoing"];v.forEach(function(x){f.has(x)&&c.push(x)});for(var g=function(x){var w=s.findIndex(function(_){return _["-id"]===c[x]});w>=0?(l["bpmn:sequenceFlow"]||(l["bpmn:sequenceFlow"]=[]),l["bpmn:sequenceFlow"].push(s[w]),s.splice(w,1)):x++,y=x},y,b=0;b<c.length;)g(b),b=y;delete l.children}),r[Er.FLOW]=s,r}function W4(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var d=l.x,c=l.y;return{"-x":d,"-y":c}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,s=80,l=t.x,d=t.y,c=$r.shapeConfigMap.get(t.type);c&&(o=c.width,s=c.height),l-=o/2,d-=s/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":d,"-width":o,"-height":s}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}var U4=["bpmn:incoming","bpmn:outgoing"];function V4(r,e){var t=[],n=[],i=new Map,o=e??{},s=o.transformer,l=o.excludeFields,d={in:new Set(mi(mi([],dr(Xd.in),!1),dr((l==null?void 0:l.in)||[]),!1)),out:new Set(mi(mi([],dr(Xd.out),!1),dr((l==null?void 0:l.out)||[]),!1))};ei=sS(ei,s);var c=r["bpmn:definitions"];if(c){var f=c["bpmn:process"];(function(g,y){y.forEach(function(b){try{Object.keys(g).forEach(function(x){try{b(x)}catch(w){console.error(w)}})}catch(x){console.error(x)}})})(f,[function(g){function y(x){x["-children"]||(x["-children"]=[]),Object.keys(x).forEach(function(w){var _;w.indexOf("bpmn:")===0&&!U4.includes(w)&&(f[w]||(f[w]=[]),!Array.isArray(f[w])&&(f[w]=[f[w]]),Array.isArray(x[w])?(_=f[w]).push.apply(_,mi([],dr(x[w]),!1)):f[w].push(x[w]),Array.isArray(x[w])?x[w].forEach(function(C){!w.includes("Flow")&&x["-children"].push(C["-id"])}):!w.includes("Flow")&&x["-children"].push(x[w]["-id"]),delete x[w])})}if(g==="bpmn:subProcess"){var b=f[g];Array.isArray(b)?b.forEach(function(x){g==="bpmn:subProcess"&&y(x)}):y(b)}},function(g){var y=function(x){Object.keys(x).forEach(function(w){var _,C;if(w.includes("bpmn:")){var k={};ei[w]&&ei[w].in?(k=(C=(_=ei[w]).in)===null||C===void 0?void 0:C.call(_,w,__.cloneDeep(x[w])),delete x[w]):b(x[w]);var D=void 0;(D=Reflect.ownKeys(k)).length>0&&D.forEach(function(R){Reflect.set(x,R,k[R])})}})};function b(x){i.set(x["-id"],x),Array.isArray(x)?x.forEach(function(w){b(w)}):typeof x=="object"&&y(x)}b(f[g])},function(g){if(g.indexOf("bpmn:")===0){var y=f[g];if(g==="bpmn:sequenceFlow"){var b=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];n=G4(y,b)}else{var x=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(g==="bpmn:boundaryEvent"){var w=f[g],_=function(C){var k=C["-attachedToRef"],D=i.get(k);D["-boundaryEvents"]||(D["-boundaryEvents"]=[]),D["-boundaryEvents"].push(C["-id"])};Array.isArray(w)?w.forEach(function(C){_(C)}):_(w)}t=t.concat(X4(y,x,g))}}}])}var v=function(g,y,b){Object.keys(g).forEach(function(x){var w=b?"".concat(b,".").concat(x):x;y.has(w)?delete g[x]:typeof g[x]=="object"&&v(g[x],y,w)})};return t.forEach(function(g){var y,b;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var x=(b=e==null?void 0:e.mapping)===null||b===void 0?void 0:b.in,w=g.type;x[w]&&(g.type=x[w])}v(g,d.in,"")}),n.forEach(function(g){var y,b;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var x=(b=e==null?void 0:e.mapping)===null||b===void 0?void 0:b.in,w=g.type;x[w]&&(g.type=x[w])}v(g,d.in,"")}),{nodes:t,edges:n}}function X4(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(s){var l;Array.isArray(e)?l=e.find(function(c){return c["-bpmnElement"]===s["-id"]}):l=e;var d=Iy(l,t,s);n.push(d)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===r["-id"]}):i=e;var o=Iy(i,t,r);n.push(o)}return n}function Iy(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=t["-children"],s=t["-name"],l=$r.shapeConfigMap.get(e);l&&(n+=l.width/2,i+=l.height/2);var d={};Object.entries(t).forEach(function(g){var y=dr(g,2),b=y[0],x=y[1];aS.includes(b)||(d[b]=x)}),d=Gd(d);var c;if(s&&(c={x:n,y:i,value:s},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var f=r["bpmndi:BPMNLabel"]["dc:Bounds"];c.x=Number(f["-x"])+Number(f["-width"])/2,c.y=Number(f["-y"])+Number(f["-height"])/2}var v={id:r["-bpmnElement"],type:e,x:n,y:i,properties:d};return o&&(v.children=o),c&&(v.text=c),v}function G4(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):o=e,t.push(By(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(By(n,r))}return t}function By(r,e){var t,n=e["-name"]?"".concat(e["-name"]):"";if(n){var i=r["bpmndi:BPMNLabel"]["dc:Bounds"],o=0;n.split(`
`).forEach(function(c){o<c.length&&(o=c.length)}),t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7}}var s={};Object.entries(e).forEach(function(c){var f=dr(c,2),v=f[0],g=f[1];aS.includes(v)||(s[v]=g)}),s=Gd(s);var l=r["di:waypoint"].map(function(c){return{x:Number(c["-x"]),y:Number(c["-y"])}}),d={id:e["-id"],type:Er.FLOW,pointsList:l,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(d.text=t),d}var $r=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var s,l,d=Hh({},n.processAttributes);z4(d,i,o);var c={"-id":"BPMNPlane_1","-bpmnElement":d["-id"]};W4(c,i);var f=n.definitionAttributes;f["bpmn:process"]=d,f["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":c};var v={"bpmn:definitions":f};if(!((s=o==null?void 0:o.mapping)===null||s===void 0)&&s.out){var g=(l=o==null?void 0:o.mapping)===null||l===void 0?void 0:l.out,y=function(b){Array.isArray(b)&&b.forEach(function(x){return y(x)}),typeof b=="object"&&Object.keys(b).forEach(function(x){var w;(w=g[x])?(b[w]=__.cloneDeep(b[x]),delete b[x],y(b[w])):y(b[x])})};y(v)}return v},this.adapterIn=function(i,o){if(i)return V4(i,o)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();$r.shapeConfigMap.set(Er.START,{width:Ey.width,height:Ey.height});$r.shapeConfigMap.set(Er.END,{width:Cy.width,height:Cy.height});$r.shapeConfigMap.set(Er.INTERMEDIATE_CATCH,{width:Ud.width,height:Ud.height});$r.shapeConfigMap.set(Er.INTERMEDIATE_THROW,{width:Ud.width,height:Ud.height});$r.shapeConfigMap.set(Er.BOUNDARY,{width:Oy.width,height:Oy.height});$r.shapeConfigMap.set(Er.PARALLEL_GATEWAY,{width:ky.width,height:ky.height});$r.shapeConfigMap.set(Er.INCLUSIVE_GATEWAY,{width:My.width,height:My.height});$r.shapeConfigMap.set(Er.EXCLUSIVE_GATEWAY,{width:Ny.width,height:Ny.height});$r.shapeConfigMap.set(Er.SYSTEM,{width:Ay.width,height:Ay.height});$r.shapeConfigMap.set(Er.USER,{width:Ty.width,height:Ty.height});$r.shapeConfigMap.set(Er.SUBPROCESS,{width:Dy.width,height:Dy.height});(function(r){H4(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(s){var l=I4(s);return n.adapterIn(l,n.props)},n.adapterXmlOut=function(s){var l=n.adapterOut(s,n.props);return j4(l)};var i=t.lf,o=t.props;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n.props=o,n}return e.pluginName="BPMNAdapter",e})($r);function Y4(r,e,t){var n=e.x,i=e.y,o=r.x,s=r.y,l=o-n,d=s-i,c=l*Math.cos(t)-d*Math.sin(t),f=l*Math.sin(t)+d*Math.cos(t),v=c+n,g=f+i;return{x:v,y:g}}var K4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Yd=function(){return Yd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Yd.apply(this,arguments)},q4=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},J4=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){K4(e,r);function e(){var t=r.apply(this,J4([],q4(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(n){var i=n.model,o=t.props,s=o.model,l=o.graphModel,d=s.transformWithContainer,c=s.isRestrict,f=t.childrenPositionMap;if(!(!d||c)&&i.id===s.id){var v={x:s.x,y:s.y};un(Array.from(s.children),function(g){var y=l.getNodeModelById(g);if(y){var b={x:y.x,y:y.y};f.has(y.id)?b=f.get(y.id):f.set(y.id,b);var x=i.rotate*(180/Math.PI);x<0&&(x+=360);var w=x*(Math.PI/180),_=Y4(b,v,w);y.moveTo(_.x,_.y),y.rotate=i.rotate}})}},t.onNodeResize=function(n){var i=n.deltaX,o=n.deltaY,s=n.index,l=n.model,d=n.preData,c=t.props,f=c.model,v=c.graphModel,g=f.transformWithContainer,y=f.isRestrict;if(!(!g||y)&&l.id===f.id){var b=d.properties,x=b||{},w=x.width,_=x.height;un(Array.from(f.children),function(C){var k=v.getNodeModelById(C);if(k){var D=k.width/w*i,R=k.height/_*o;jw({deltaX:D,deltaY:R,index:s,nodeModel:k,graphModel:v,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var n=t.props.model;n.isCollapsed&&n.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){r.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,n){var i=this,o=[];return t.isGroup&&un(Array.from(t.children),function(s){o.push(s);var l=n.getNodeModelById(s);l!=null&&l.isGroup&&(o=o.concat(i.getNodesInGroup(l,n)))}),o},e.prototype.getResizeControl=function(){var t=this.props.model,n=t.resizable,i=t.isCollapsed,o=n&&!i;return o?r.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,s=t.y,l=t.radius,d=t.groupAddable;if(!d)return null;var c=t.getNodeStyle().strokeWidth,f=c===void 0?0:c,v=t.getAddableOutlineStyle(),g=n+f+8,y=i+f+8;return xt("rect",Yd(Yd({},v),{width:g,height:y,x:o-g/2,y:s-y/2,rx:l,ry:l}))},e.prototype.getCollapseIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," M").concat(t+7,",").concat(n+2," ").concat(t+7,",").concat(n+10)},e.prototype.getExpandIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=n-o/2+10,d=i-s/2+10;if(!t.collapsible)return null;var c=t!=null&&t.isCollapsed?this.getCollapseIcon(l,d):this.getExpandIcon(l,d),f=xt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:c});return xt("g",{},[xt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:l,y:d,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),f])},e.prototype.getShape=function(){return xt("g",{},[this.getAppendAreaShape(),r.prototype.getShape.call(this),this.getOperateIcon()])},e})(la);var Z4=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Kd=function(){return Kd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Kd.apply(this,arguments)},Rf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},ja=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},nl=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Q4=400,e5=230,t5=80,n5=60,r5=-1e4;(function(r){Z4(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var n;r.prototype.initNodeData.call(this,t);var i=(n=t.properties)!==null&&n!==void 0?n:{},o=i.children,s=i.width,l=i.height,d=i.collapsedWidth,c=i.collapsedHeight,f=i.collapsible,v=i.isCollapsed,g=i.zIndex,y=i.isRestrict,b=i.autoResize,x=i.autoToFront,w=i.transformWithContainer;this.children=o?new Set(o):new Set,this.zIndex=g??r5,this.isCollapsed=v??!1,this.setProperties({isCollapsed:v??!1});var _=s??Q4,C=l??e5;this.width=_,this.height=C,this.expandWidth=_,this.expandHeight=C,this.collapsedWidth=d??t5,this.collapsedHeight=c??n5,this.isRestrict=y??!1,this.transformWithContainer=w??!1,this.autoResize=b??!1,this.collapsible=f??!0,this.autoToFront=x??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this),i=[];return un(Array.from(this.children),function(o){var s=t.graphModel.getNodeModelById(o);s&&!s.virtual&&i.push(o)}),n.children=i,n.properties&&(n.properties.children=i,n.properties.isCollapsed=this.isCollapsed),n},e.prototype.getNodesInGroup=function(t){var n=[];return t.isGroup&&un(Array.from(t.children),function(i){n.push(i)}),n},e.prototype.getMoveDistance=function(t,n,i){i===void 0&&(i=!1);var o=ja(r.prototype.getMoveDistance.call(this,t,n,i),2),s=o[0],l=o[1],d=this.getNodesInGroup(this);return this.graphModel.moveNodes(d,t,n,i),[s,l]},e.prototype.getHistoryData=function(){var t=r.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var n=this,i=n.x,o=n.y,s=n.collapsedWidth,l=n.collapsedHeight,d=n.expandWidth,c=n.expandHeight,f=n.isCollapsed;return f&&(t.x=i+d/2-s/2,t.y=o+c/2-l/2,t.text&&(t.text.x=t.text.x+d/2-s/2,t.text.y=t.text.y+c/2-l/2)),t},e.prototype.toggleCollapse=function(t){var n=this,i=this.graphModel,o=!!t;this.isCollapsed=o,this.setProperties({isCollapsed:o}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:o,nodeModel:this}),o?this.collapse():this.expand();var s=nl(nl([],ja(this.incoming.edges),!1),ja(this.outgoing.edges),!1),l=Array.from(this.children);un(l,function(d){var c,f,v=n.graphModel.elementsModelMap.get(d);if(v){var g=v.isCollapsed;if(v.isGroup){var y=v;if(y.isCollapsed||y.toggleCollapse(t),!t){var b=(c=n.childrenLastCollapseStateDict)===null||c===void 0?void 0:c.get(d);b!==void 0&&b!==v.isCollapsed&&y.toggleCollapse(b)}}if((f=n.childrenLastCollapseStateDict)===null||f===void 0||f.set(d,!!g),v.visible=!t,v.BaseType===xn.NODE){var x=v.incoming.edges,w=v.outgoing.edges;s=nl(nl(nl([],ja(s),!1),ja(x),!1),ja(w),!1)}}}),this.collapseEdge(o,s)},e.prototype.collapse=function(){var t=this,n=t.x,i=t.y,o=t.text,s=t.width,l=t.height,d=t.collapsedWidth,c=t.collapsedHeight;this.x=n-s/2+d/2,this.y=i-l/2+c/2,this.text.x=o.x-s/2+d/2,this.text.y=o.y-l/2+c/2,this.expandWidth=s,this.expandHeight=l,this.width=d,this.height=c},e.prototype.expand=function(){var t=this,n=t.x,i=t.y,o=t.text,s=t.expandWidth,l=t.expandHeight,d=t.collapsedWidth,c=t.collapsedHeight;this.width=s,this.height=l,this.x=n+this.width/2-d/2,this.y=i+this.height/2-c/2,this.text.x=o.x+this.width/2-d/2,this.text.y=o.y+this.height/2-c/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,n){var i=this,o=this.graphModel;un(n,function(s,l){var d,c=s.getData(),f=c.targetNodeId,v=c.sourceNodeId,g=Kd(Kd({},c),{id:"".concat(c.id,"__").concat(l),text:(d=c.text)===null||d===void 0?void 0:d.value});s.virtual&&o.deleteEdgeById(s.id);var y=o.dynamicGroup.getGroupByNodeId(f);y||(y=o.getNodeModelById(f));var b=o.dynamicGroup.getGroupByNodeId(v);b||(b=o.getNodeModelById(v)),t&&s.visible&&(i.children.has(v)||i.id===v?(g.startPoint=void 0,g.sourceNodeId=i.id):(g.endPoint=void 0,g.targetNodeId=i.id),(y.id!==i.id||b.id!==i.id)&&i.createVirtualEdge(g),s.visible=!1),!t&&!s.visible&&(y&&y.isGroup&&y.isCollapsed?(g.targetNodeId=y.id,g.endPoint=void 0,i.createVirtualEdge(g)):b&&b.isGroup&&b.isCollapsed?(g.sourceNodeId=b.id,g.startPoint=void 0,i.createVirtualEdge(g)):s.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var n=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:n,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var n=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:n})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=r.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Rf([Ae],e.prototype,"isCollapsed",void 0),Rf([Ae],e.prototype,"groupAddable",void 0),Rf([Ae],e.prototype,"transformWithContainer",void 0),e})(us);var jy;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(jy||(jy={}));var i5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),wl=function(){return wl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},wl.apply(this,arguments)},o5=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},a5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},s5=function(r){i5(e,r);function e(t){var n=r.call(this,t)||this;n.textRef=lc(),n.setHoverOn=function(){var d=n.props.element;d.isDragging||n.state.isHovered||(n.setState({isHovered:!0}),d.setHovered(!0))},n.setHoverOff=function(){var d=n.props.element;n.state.isHovered&&(n.setState({isHovered:!1}),d.setHovered(!1))},n.handleMouseDown=function(d){var c,f=n.props,v=f.label,g=f.graphModel,y=g.editConfigModel.nodeTextDraggable;((c=v.draggable)!==null&&c!==void 0?c:y)&&!n.state.isDragging&&!n.state.isEditing&&n.stepDrag.handleMouseDown(d)},n.handleMouseUp=function(d){n.state.isDragging&&n.stepDrag.handleMouseUp(d)},n.handleDragging=function(d){var c=d.deltaX,f=d.deltaY;n.state.isDragging||n.setState({isDragging:!0});var v=n.props,g=v.label,y=v.graphModel,b=y.transformModel,x=a5(b.fixDeltaXY(c,f),2),w=x[0],_=x[1];n.setElementModelLabelInfo({x:g.x+w,y:g.y+_}),y.eventCenter.emit("label:drag",{data:g.getData(),model:g})},n.handleDragEnd=function(){n.setState({isDragging:!1})},n.handleClick=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel;v.setSelected(!n.state.isSelected),n.setState({isSelected:!n.state.isSelected}),n.setElementModelLabelInfo({isSelected:!0}),g.eventCenter.emit("label:click",{data:f.getData(),e:d,model:v})},n.handleDbClick=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel;if(g.eventCenter.emit("label:dblclick",{data:f.getData(),e:d,model:v}),!f.editable){v.setSelected(!0);return}if(v.setSelected(),v.setElementState(en.TEXT_EDIT),n.setState({isEditing:!0}),n.textRef.current){n.textRef.current.contentEditable="true",n.textRef.current.focus();var y=document.createRange(),b=window.getSelection();y.selectNodeContents(n.textRef.current),y.collapse(!1),b==null||b.removeAllRanges(),b==null||b.addRange(y)}},n.handleBlur=function(d){var c=n.props,f=c.label,v=c.element,g=c.graphModel.eventCenter;g.emit("label:blur",{e:d,model:v,data:f.getData(),element:n.textRef.current}),n.setState({isDragging:!1,isHovered:!1,isSelected:!1})},n.handleInput=function(d){var c=n.props,f=c.label,v=c.graphModel;v.eventCenter.emit("label:input",{e:d,data:f.getData()})},n.reCalcLabelSize=function(){};var i=t.label,o=t.graphModel,s=o.gridSize,l=o.eventCenter;return n.stepDrag=new ai({onDragging:n.handleDragging,onDragEnd:n.handleDragEnd,step:s,eventType:"LABEL",model:i,eventCenter:l}),n.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},n}return e.prototype.setElementModelLabelInfo=function(t){var n=this.props,i=n.label,o=n.element,s=n.graphModel,l=o.properties._label,d=l,c=rO(d,function(g){return g.id===i.id}),f=d[c];d[c]=wl(wl({},f),t);var v=s.getElement(o.id);v==null||v.setProperty("_label",d)},e.prototype.componentDidMount=function(){var t=this,n=this.props,i=n.label,o=n.element,s=n.graphModel;s.eventCenter.on("blank:click,node:click,edge:click,label:click",function(l){var d,c,f,v,g=l.data;if(((g==null?void 0:g.type)!=="label"||g.type==="label"&&g.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var y=(c=(d=t.textRef.current)===null||d===void 0?void 0:d.innerText)!==null&&c!==void 0?c:"",b=(v=(f=t.textRef.current)===null||f===void 0?void 0:f.innerHTML)!==null&&v!==void 0?v:"";t.setElementModelLabelInfo({value:y,content:b,isSelected:!1}),o.setElementState(en.DEFAULT)}((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,n=this.props,i=n.label,o=n.element,s=n.graphModel,l=this.state,d=l.isDragging,c=l.isHovered,f=l.isSelected,v=l.isEditing,g=s.transformModel,y=g.getTransformStyle().transform,b=i.id,x=i.x,w=i.y,_=i.zIndex,C=i.vertical,k=i.style,D=i.rotate,R=i.content,$=i.labelWidth,P=i.textOverflowMode,I=$??(o.BaseType==="node"?o.width-20:80),W={left:"".concat(x-I/2,"px"),top:"".concat(w-10,"px"),width:"".concat(I,"px"),height:"20px",zIndex:_??1,transform:D?"".concat(y," rotate(").concat(D,"deg)"):"".concat(y," rotate(").concat(C?-.25:0,"turn)")};return Ne("div",{id:"element-container-".concat(b),className:wh("lf-label-editor-container"),style:W,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:Ne("div",{ref:this.textRef,id:"editor-container-".concat(b),className:wh("lf-label-editor",(t={"lf-label-editor-dragging":d,"lf-label-editor-editing":v,"lf-label-editor-hover":!v&&(c||f)},t["lf-label-editor-".concat(P)]=!v,t)),onInput:this.handleInput,style:wl({maxWidth:"".concat(I,"px"),boxSizing:"border-box",display:"inline-block",background:v||o.BaseType==="edge"?"#fff":"transparent"},k),dangerouslySetInnerHTML:{__html:R}})})},e=o5([Sr],e),e}(Gt),Qr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},l5=Co,u5=function(){function r(e,t,n){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=n,this.id=(i=e.id)!==null&&i!==void 0?i:l5(),this.initLabelData(e)}return r.prototype.initLabelData=function(e){on(this,e)},r.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:gi(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},Qr([Ae],r.prototype,"x",void 0),Qr([Ae],r.prototype,"y",void 0),Qr([Ae],r.prototype,"content",void 0),Qr([Ae],r.prototype,"value",void 0),Qr([Ae],r.prototype,"rotate",void 0),Qr([Ae],r.prototype,"style",void 0),Qr([Ae],r.prototype,"zIndex",void 0),Qr([Ae],r.prototype,"vertical",void 0),Qr([Ae],r.prototype,"editable",void 0),Qr([Ae],r.prototype,"draggable",void 0),Qr([Ae],r.prototype,"labelWidth",void 0),Qr([Ae],r.prototype,"textOverflowMode",void 0),r}(),ad={exports:{}},If=ad.exports,Hy;function d5(){return Hy||(Hy=1,function(r){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||function(e){if("Element"in e){var t="classList",n="prototype",i=e.Element[n],o=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},l=Array[n].indexOf||function(b){for(var x=0,w=this.length;x<w;x++)if(x in this&&this[x]===b)return x;return-1},d=function(b,x){this.name=b,this.code=DOMException[b],this.message=x},c=function(b,x){if(x==="")throw new d("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(x))throw new d("INVALID_CHARACTER_ERR","String contains an invalid character");return l.call(b,x)},f=function(b){for(var x=s.call(b.getAttribute("class")||""),w=x?x.split(/\s+/):[],_=0,C=w.length;_<C;_++)this.push(w[_]);this._updateClassName=function(){b.setAttribute("class",this.toString())}},v=f[n]=[],g=function(){return new f(this)};if(d[n]=Error[n],v.item=function(b){return this[b]||null},v.contains=function(b){return b+="",c(this,b)!==-1},v.add=function(){var b=arguments,x=0,w=b.length,_,C=!1;do _=b[x]+"",c(this,_)===-1&&(this.push(_),C=!0);while(++x<w);C&&this._updateClassName()},v.remove=function(){var b=arguments,x=0,w=b.length,_,C=!1,k;do for(_=b[x]+"",k=c(this,_);k!==-1;)this.splice(k,1),C=!0,k=c(this,_);while(++x<w);C&&this._updateClassName()},v.toggle=function(b,x){b+="";var w=this.contains(b),_=w?x!==!0&&"remove":x!==!1&&"add";return _&&this[_](b),x===!0||x===!1?x:!w},v.toString=function(){return this.join(" ")},o.defineProperty){var y={get:g,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,y)}catch(b){b.number===-2146823252&&(y.enumerable=!1,o.defineProperty(i,t,y))}}else o[n].__defineGetter__&&i.__defineGetter__(t,g)}}(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(i){var o=function(P){return Object.prototype.toString.call(P).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},l=function(I,W,se){this.data=I,this.size=I.length,this.type=W,this.encoding=se},d=s.prototype,c=l.prototype,f=i.FileReaderSync,v=function(P){this.code=this[this.name=P]},g="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),y=g.length,b=i.URL||i.webkitURL||i,x=b.createObjectURL,w=b.revokeObjectURL,_=b,C=i.btoa,k=i.atob,D=i.ArrayBuffer,R=i.Uint8Array,$=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(l.fake=c.fake=!0;y--;)v.prototype[g[y]]=y+1;return b.createObjectURL||(_=i.URL=function(P){var I=document.createElementNS("http://www.w3.org/1999/xhtml","a"),W;return I.href=P,"origin"in I||(I.protocol.toLowerCase()==="data:"?I.origin=null:(W=P.match($),I.origin=W&&W[1])),I}),_.createObjectURL=function(P){var I=P.type,W;if(I===null&&(I="application/octet-stream"),P instanceof l)return W="data:"+I,P.encoding==="base64"?W+";base64,"+P.data:P.encoding==="URI"?W+","+decodeURIComponent(P.data):C?W+";base64,"+C(P.data):W+","+encodeURIComponent(P.data);if(x)return x.call(b,P)},_.revokeObjectURL=function(P){P.substring(0,5)!=="data:"&&w&&w.call(b,P)},d.append=function(P){var I=this.data;if(R&&(P instanceof D||P instanceof R)){for(var W="",se=new R(P),q=0,ee=se.length;q<ee;q++)W+=String.fromCharCode(se[q]);I.push(W)}else if(o(P)==="Blob"||o(P)==="File")if(f){var T=new f;I.push(T.readAsBinaryString(P))}else throw new v("NOT_READABLE_ERR");else P instanceof l?P.encoding==="base64"&&k?I.push(k(P.data)):P.encoding==="URI"?I.push(decodeURIComponent(P.data)):P.encoding==="raw"&&I.push(P.data):(typeof P!="string"&&(P+=""),I.push(unescape(encodeURIComponent(P))))},d.getBlob=function(P){return arguments.length||(P=null),new l(this.data.join(""),P,"raw")},d.toString=function(){return"[object BlobBuilder]"},c.slice=function(P,I,W){var se=arguments.length;return se<3&&(W=null),new l(this.data.slice(P,se>1?I:this.data.length),W,this.encoding)},c.toString=function(){return"[object Blob]"},c.close=function(){this.size=0,delete this.data},s}(e);e.Blob=function(i,o){var s=o&&o.type||"",l=new t;if(i)for(var d=0,c=i.length;d<c;d++)Uint8Array&&i[d]instanceof Uint8Array?l.append(i[d].buffer):l.append(i[d]);var f=l.getBlob(s);return!f.slice&&f.webkitSlice&&(f.slice=f.webkitSlice),f};var n=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=n(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||If.content||If),function(e,t){var n=typeof process<"u"&&process&&process.versions&&process.versions.electron;n?e.MediumEditor=t:r.exports=t}(If,function(){function e(t,n){return this.init(t,n)}return e.extensions={},function(t){function n(d,c){var f,v=Array.prototype.slice.call(arguments,2);c=c||{};for(var g=0;g<v.length;g++){var y=v[g];if(y)for(f in y)y.hasOwnProperty(f)&&typeof y[f]<"u"&&(d||c.hasOwnProperty(f)===!1)&&(c[f]=y[f])}return c}var i=!1;try{var o=document.createElement("div"),s=document.createTextNode(" ");o.appendChild(s),i=o.contains(s)}catch{}var l={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(d){return!!(l.isMac&&d.metaKey||!l.isMac&&d.ctrlKey)},isKey:function(d,c){var f=l.getKeyCode(d);return Array.isArray(c)===!1?f===c:c.indexOf(f)!==-1},getKeyCode:function(d){var c=d.which;return c===null&&(c=d.charCode!==null?d.charCode:d.keyCode),c},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var c=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,c)},defaults:function(){var c=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,c)},createLink:function(d,c,f,v){var g=d.createElement("a");return l.moveTextRangeIntoElement(c[0],c[c.length-1],g),g.setAttribute("href",f),v&&(v==="_blank"&&g.setAttribute("rel","noopener noreferrer"),g.setAttribute("target",v)),g},findOrCreateMatchingTextNodes:function(d,c,f){for(var v=d.createTreeWalker(c,NodeFilter.SHOW_ALL,null,!1),g=[],y=0,b=!1,x=null,w=null;(x=v.nextNode())!==null;)if(!(x.nodeType>3))if(x.nodeType===3){if(!b&&f.start<y+x.nodeValue.length&&(b=!0,w=l.splitStartNodeIfNeeded(x,f.start,y)),b&&l.splitEndNodeIfNeeded(x,w,f.end,y),b&&y===f.end)break;if(b&&y>f.end+1)throw new Error("PerformLinking overshot the target!");b&&g.push(w||x),y+=x.nodeValue.length,w!==null&&(y+=w.nodeValue.length,v.nextNode()),w=null}else x.tagName.toLowerCase()==="img"&&(!b&&f.start<=y&&(b=!0),b&&g.push(x));return g},splitStartNodeIfNeeded:function(d,c,f){return c!==f?d.splitText(c-f):null},splitEndNodeIfNeeded:function(d,c,f,v){var g,y;g=v+d.nodeValue.length+(c?c.nodeValue.length:0)-1,y=f-v-(c?d.nodeValue.length:0),g>=f&&v!==g&&y!==0&&(c||d).splitText(y)},splitByBlockElements:function(d){if(d.nodeType!==3&&d.nodeType!==1)return[];var c=[],f=e.util.blockContainerElementNames.join(",");if(d.nodeType===3||d.querySelectorAll(f).length===0)return[d];for(var v=0;v<d.childNodes.length;v++){var g=d.childNodes[v];if(g.nodeType===3)c.push(g);else if(g.nodeType===1){var y=g.querySelectorAll(f);y.length===0?c.push(g):c=c.concat(e.util.splitByBlockElements(g))}}return c},findAdjacentTextNodeWithContent:function(c,f,v){var g=!1,y,b=v.createNodeIterator(c,NodeFilter.SHOW_TEXT,null,!1);for(y=b.nextNode();y;){if(y===f)g=!0;else if(g&&y.nodeType===3&&y.nodeValue&&y.nodeValue.trim().length>0)break;y=b.nextNode()}return y},findPreviousSibling:function(d){if(!d||l.isMediumEditorElement(d))return!1;for(var c=d.previousSibling;!c&&!l.isMediumEditorElement(d.parentNode);)d=d.parentNode,c=d.previousSibling;return c},isDescendant:function(c,f,v){if(!c||!f)return!1;if(c===f)return!!v;if(c.nodeType!==1)return!1;if(i||f.nodeType!==3)return c.contains(f);for(var g=f.parentNode;g!==null;){if(g===c)return!0;g=g.parentNode}return!1},isElement:function(c){return!!(c&&c.nodeType===1)},throttle:function(d,c){var f=50,v,g,y,b=null,x=0,w=function(){x=Date.now(),b=null,y=d.apply(v,g),b||(v=g=null)};return!c&&c!==0&&(c=f),function(){var _=Date.now(),C=c-(_-x);return v=this,g=arguments,C<=0||C>c?(b&&(clearTimeout(b),b=null),x=_,y=d.apply(v,g),b||(v=g=null)):b||(b=setTimeout(w,C)),y}},traverseUp:function(d,c){if(!d)return!1;do{if(d.nodeType===1){if(c(d))return d;if(l.isMediumEditorElement(d))return!1}d=d.parentNode}while(d);return!1},htmlEntities:function(d){return String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(d,c){var f,v,g,y,b,x,w,_=!1,C=["insertHTML",!1,c];if(!e.util.isEdge&&d.queryCommandSupported("insertHTML"))try{return d.execCommand.apply(d,C)}catch{}if(f=d.getSelection(),f.rangeCount){if(v=f.getRangeAt(0),w=v.commonAncestorContainer,l.isMediumEditorElement(w)&&!w.firstChild)v.selectNode(w.appendChild(d.createTextNode("")));else if(w.nodeType===3&&v.startOffset===0&&v.endOffset===w.nodeValue.length||w.nodeType!==3&&w.innerHTML===v.toString()){for(;!l.isMediumEditorElement(w)&&w.parentNode&&w.parentNode.childNodes.length===1&&!l.isMediumEditorElement(w.parentNode);)w=w.parentNode;v.selectNode(w)}for(v.deleteContents(),g=d.createElement("div"),g.innerHTML=c,y=d.createDocumentFragment();g.firstChild;)b=g.firstChild,x=y.appendChild(b);v.insertNode(y),x&&(v=v.cloneRange(),v.setStartAfter(x),v.collapse(!0),e.selection.selectRange(d,v)),_=!0}return d.execCommand.callListeners&&d.execCommand.callListeners(C,_),_},execFormatBlock:function(d,c){var f=l.getTopBlockContainer(e.selection.getSelectionStart(d)),v;if(c==="blockquote"){if(f&&(v=Array.prototype.slice.call(f.childNodes),v.some(function(g){return l.isBlockContainer(g)})))return d.execCommand("outdent",!1,null);if(l.isIE)return d.execCommand("indent",!1,c)}if(f&&c===f.nodeName.toLowerCase()&&(c="p"),l.isIE&&(c="<"+c+">"),f&&f.nodeName.toLowerCase()==="blockquote"){if(l.isIE&&c==="<p>")return d.execCommand("outdent",!1,c);if((l.isFF||l.isEdge)&&c==="p")return v=Array.prototype.slice.call(f.childNodes),v.some(function(g){return!l.isBlockContainer(g)})&&d.execCommand("formatBlock",!1,c),d.execCommand("outdent",!1,c)}return d.execCommand("formatBlock",!1,c)},setTargetBlank:function(d,c){var f,v=c||!1;if(d.nodeName.toLowerCase()==="a")d.target="_blank",d.rel="noopener noreferrer";else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)(v===!1||v===d[f].attributes.href.value)&&(d[f].target="_blank",d[f].rel="noopener noreferrer")},removeTargetBlank:function(d,c){var f;if(d.nodeName.toLowerCase()==="a")d.removeAttribute("target"),d.removeAttribute("rel");else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)c===d[f].attributes.href.value&&(d[f].removeAttribute("target"),d[f].removeAttribute("rel"))},addClassToAnchors:function(d,c){var f=c.split(" "),v,g;if(d.nodeName.toLowerCase()==="a")for(g=0;g<f.length;g+=1)d.classList.add(f[g]);else{var y=d.getElementsByTagName("a");if(y.length===0){var b=l.getClosestTag(d,"a");d=b?[b]:[]}else d=y;for(v=0;v<d.length;v+=1)for(g=0;g<f.length;g+=1)d[v].classList.add(f[g])}},isListItem:function(d){if(!d)return!1;if(d.nodeName.toLowerCase()==="li")return!0;for(var c=d.parentNode,f=c.nodeName.toLowerCase();f==="li"||!l.isBlockContainer(c)&&f!=="div";){if(f==="li")return!0;if(c=c.parentNode,c)f=c.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(d,c){if(c.nodeName.toLowerCase()==="li"){var f=c.parentElement;f.parentElement.nodeName.toLowerCase()==="p"&&(l.unwrap(f.parentElement,d),e.selection.moveCursor(d,c.firstChild,c.firstChild.textContent.length))}},splitOffDOMTree:function(d,c,f){for(var v=c,g=null,y=!f;v!==d;){var b=v.parentNode,x=b.cloneNode(!1),w=y?v:b.firstChild,_;for(g&&(y?x.appendChild(g):_=g),g=x;w;){var C=w.nextSibling;w===v?(w.hasChildNodes()?w=w.cloneNode(!1):w.parentNode.removeChild(w),w.textContent&&g.appendChild(w),w=y?C:null):(w.parentNode.removeChild(w),(w.hasChildNodes()||w.textContent)&&g.appendChild(w),w=C)}_&&g.appendChild(_),v=b}return g},moveTextRangeIntoElement:function(d,c,f){if(!d||!c)return!1;var v=l.findCommonRoot(d,c);if(!v)return!1;if(c===d){var g=d.parentNode,y=d.nextSibling;return g.removeChild(d),f.appendChild(d),y?g.insertBefore(f,y):g.appendChild(f),f.hasChildNodes()}for(var b=[],x,w,_,C=0;C<v.childNodes.length;C++)if(_=v.childNodes[C],!x)l.isDescendant(_,d,!0)&&(x=_);else if(l.isDescendant(_,c,!0)){w=_;break}else b.push(_);var k=w.nextSibling,D=v.ownerDocument.createDocumentFragment();return x===d?(x.parentNode.removeChild(x),D.appendChild(x)):D.appendChild(l.splitOffDOMTree(x,d)),b.forEach(function(R){R.parentNode.removeChild(R),D.appendChild(R)}),w===c?(w.parentNode.removeChild(w),D.appendChild(w)):D.appendChild(l.splitOffDOMTree(w,c,!0)),f.appendChild(D),w.parentNode===v?v.insertBefore(f,w):k?v.insertBefore(f,k):v.appendChild(f),f.hasChildNodes()},depthOfNode:function(d){for(var c=0,f=d;f.parentNode!==null;)f=f.parentNode,c++;return c},findCommonRoot:function(d,c){for(var f=l.depthOfNode(d),v=l.depthOfNode(c),g=d,y=c;f!==v;)f>v?(g=g.parentNode,f-=1):(y=y.parentNode,v-=1);for(;g!==y;)g=g.parentNode,y=y.parentNode;return g},isElementAtBeginningOfBlock:function(d){for(var c,f;!l.isBlockContainer(d)&&!l.isMediumEditorElement(d);){for(f=d;f=f.previousSibling;)if(c=f.nodeType===3?f.nodeValue:f.textContent,c.length>0)return!1;d=d.parentNode}return!0},isMediumEditorElement:function(d){return d&&d.getAttribute&&!!d.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(d){return l.traverseUp(d,function(c){return l.isMediumEditorElement(c)})},isBlockContainer:function(d){return d&&d.nodeType!==3&&l.blockContainerElementNames.indexOf(d.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(d){return l.traverseUp(d,function(c){return l.isBlockContainer(c)||l.isMediumEditorElement(c)})},getTopBlockContainer:function(d){var c=l.isBlockContainer(d)?d:!1;return l.traverseUp(d,function(f){return l.isBlockContainer(f)&&(c=f),!c&&l.isMediumEditorElement(f)?(c=f,!0):!1}),c},getFirstSelectableLeafNode:function(d){for(;d&&d.firstChild;)d=d.firstChild;if(d=l.traverseUp(d,function(f){return l.emptyElementNames.indexOf(f.nodeName.toLowerCase())===-1}),d.nodeName.toLowerCase()==="table"){var c=d.querySelector("th, td");c&&(d=c)}return d},getFirstTextNode:function(d){return l.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),l._getFirstTextNode(d)},_getFirstTextNode:function(d){if(d.nodeType===3)return d;for(var c=0;c<d.childNodes.length;c++){var f=l._getFirstTextNode(d.childNodes[c]);if(f!==null)return f}return null},ensureUrlHasProtocol:function(d){return d.indexOf("://")===-1?"http://"+d:d},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(d,c,f){var v=d+" is deprecated, please use "+c+" instead.";f&&(v+=" Will be removed in "+f),l.warn(v)},deprecatedMethod:function(d,c,f,v){l.deprecated(d,c,v),typeof this[c]=="function"&&this[c].apply(this,f)},cleanupAttrs:function(d,c){c.forEach(function(f){d.removeAttribute(f)})},cleanupTags:function(d,c){c.indexOf(d.nodeName.toLowerCase())!==-1&&d.parentNode.removeChild(d)},unwrapTags:function(d,c){c.indexOf(d.nodeName.toLowerCase())!==-1&&e.util.unwrap(d,document)},getClosestTag:function(d,c){return l.traverseUp(d,function(f){return f.nodeName.toLowerCase()===c.toLowerCase()})},unwrap:function(d,c){for(var f=c.createDocumentFragment(),v=Array.prototype.slice.call(d.childNodes),g=0;g<v.length;g++)f.appendChild(v[g]);f.childNodes.length?d.parentNode.replaceChild(f,d):d.parentNode.removeChild(d)},guid:function(){function d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}};e.util=l}(window),function(){var t=function(n){e.util.extend(this,n)};t.extend=function(n){var i=this,o;n&&n.hasOwnProperty("constructor")?o=n.constructor:o=function(){return i.apply(this,arguments)},e.util.extend(o,i);var s=function(){this.constructor=o};return s.prototype=i.prototype,o.prototype=new s,n&&e.util.extend(o.prototype,n),o},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(n){return this.base.options[n]}},["execAction","on","off","subscribe","trigger"].forEach(function(n){t.prototype[n]=function(){return this.base[n].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(i,o){var s=o.getSelection(),l,d;return s.rangeCount===0?!1:(l=s.getRangeAt(0),d=l.commonAncestorContainer,e.util.traverseUp(d,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(o){return e.util.isMediumEditorElement(o)},i)},exportSelection:function(i,o){if(!i)return null;var s=null,l=o.getSelection();if(l.rangeCount>0){var d=l.getRangeAt(0),c=d.cloneRange(),f;c.selectNodeContents(i),c.setEnd(d.startContainer,d.startOffset),f=c.toString().length,s={start:f,end:f+d.toString().length},this.doesRangeStartWithImages(d,o)&&(s.startsWithImage=!0);var v=this.getTrailingImageCount(i,s,d.endContainer,d.endOffset);if(v&&(s.trailingImageCount=v),f!==0){var g=this.getIndexRelativeToAdjacentEmptyBlocks(o,i,d.startContainer,d.startOffset);g!==-1&&(s.emptyBlocksIndex=g)}}return s},importSelection:function(i,o,s,l){if(!(!i||!o)){var d=s.createRange();d.setStart(o,0),d.collapse(!0);var c=o,f=[],v=0,g=!1,y=!1,b=0,x=!1,w,_=!1,C=null;for((l||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(_=!0);!x&&c;){if(c.nodeType>3){c=f.pop();continue}if(c.nodeType===3&&!y)w=v+c.length,!g&&i.start>=v&&i.start<=w&&(_||i.start<w?(d.setStart(c,i.start-v),g=!0):C=c),g&&i.end>=v&&i.end<=w&&(i.trailingImageCount?y=!0:(d.setEnd(c,i.end-v),x=!0)),v=w;else{if(i.trailingImageCount&&y&&(c.nodeName.toLowerCase()==="img"&&b++,b===i.trailingImageCount)){for(var k=0;c.parentNode.childNodes[k]!==c;)k++;d.setEnd(c.parentNode,k+1),x=!0}if(!x&&c.nodeType===1)for(var D=c.childNodes.length-1;D>=0;)f.push(c.childNodes[D]),D-=1}x||(c=f.pop())}!g&&C&&(d.setStart(C,C.length),d.setEnd(C,C.length)),typeof i.emptyBlocksIndex<"u"&&(d=this.importSelectionMoveCursorPastBlocks(s,o,i.emptyBlocksIndex,d)),l&&(d=this.importSelectionMoveCursorPastAnchor(i,d)),this.selectRange(s,d)}},importSelectionMoveCursorPastAnchor:function(i,o){var s=function(v){return v.nodeName.toLowerCase()==="a"};if(i.start===i.end&&o.startContainer.nodeType===3&&o.startOffset===o.startContainer.nodeValue.length&&e.util.traverseUp(o.startContainer,s)){for(var l=o.startContainer,d=o.startContainer.parentNode;d!==null&&d.nodeName.toLowerCase()!=="a";)d.childNodes[d.childNodes.length-1]!==l?d=null:(l=d,d=d.parentNode);if(d!==null&&d.nodeName.toLowerCase()==="a"){for(var c=null,f=0;c===null&&f<d.parentNode.childNodes.length;f++)d.parentNode.childNodes[f]===d&&(c=f);o.setStart(d.parentNode,c+1),o.collapse(!0)}}return o},importSelectionMoveCursorPastBlocks:function(i,o,s,l){var d=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),c=l.startContainer,f,v,g=0;for(s=s||1,c.nodeType===3&&e.util.isBlockContainer(c.previousSibling)?f=c.previousSibling:f=e.util.getClosestBlockContainer(c);d.nextNode();)if(!v)f===d.currentNode&&(v=d.currentNode);else if(v=d.currentNode,g++,g===s||v.textContent.length>0)break;return v||(v=f),l.setStart(e.util.getFirstSelectableLeafNode(v),0),l},getIndexRelativeToAdjacentEmptyBlocks:function(i,o,s,l){if(s.textContent.length>0&&l>0)return-1;var d=s;if(d.nodeType!==3&&(d=s.childNodes[l]),d){if(!e.util.isElementAtBeginningOfBlock(d))return-1;var c=e.util.findPreviousSibling(d);if(c){if(c.nodeValue)return-1}else return-1}for(var f=e.util.getClosestBlockContainer(s),v=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),g=0;v.nextNode();){var y=v.currentNode.textContent==="";if((y||g>0)&&(g+=1),v.currentNode===f)return g;y||(g=0)}return g},doesRangeStartWithImages:function(i,o){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var s=i.startContainer.querySelector("img");if(!s)return!1;for(var l=o.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);l.nextNode();){var d=l.currentNode;if(d===s)break;if(d.nodeValue)return!1}return!0},getTrailingImageCount:function(i,o,s,l){if(l===0||s.nodeType!==1||s.nodeName.toLowerCase()!=="img"&&!s.querySelector("img"))return 0;for(var d=s.childNodes[l-1];d.hasChildNodes();)d=d.lastChild;for(var c=i,f=[],v=0,g=!1,y=!1,b=!1,x,w=0;!b&&c;){if(c.nodeType>3){c=f.pop();continue}if(c.nodeType===3&&!y)w=0,x=v+c.length,!g&&o.start>=v&&o.start<=x&&(g=!0),g&&o.end>=v&&o.end<=x&&(y=!0),v=x;else if(c.nodeName.toLowerCase()==="img"&&w++,c===d)b=!0;else if(c.nodeType===1)for(var _=c.childNodes.length-1;_>=0;)f.push(c.childNodes[_]),_-=1;b||(c=f.pop())}return w},selectionContainsContent:function(i){var o=i.getSelection();if(!o||o.isCollapsed||!o.rangeCount)return!1;if(o.toString().trim()!=="")return!0;var s=this.getSelectedParentElement(o.getRangeAt(0));return!!(s&&(s.nodeName.toLowerCase()==="img"||s.nodeType===1&&s.querySelector("img")))},selectionInContentEditableFalse:function(i){var o,s=this.findMatchingSelectionParent(function(l){var d=l&&l.getAttribute("contenteditable");return d==="true"&&(o=!0),l.nodeName!=="#text"&&d==="false"},i);return!o&&s},getSelectionHtml:function(o){var s,l="",d=o.getSelection(),c,f;if(d.rangeCount){for(f=o.createElement("div"),s=0,c=d.rangeCount;s<c;s+=1)f.appendChild(d.getRangeAt(s).cloneContents());l=f.innerHTML}return l},getCaretOffsets:function(o,s){var l,d;return s||(s=window.getSelection().getRangeAt(0)),l=s.cloneRange(),d=s.cloneRange(),l.selectNodeContents(o),l.setEnd(s.endContainer,s.endOffset),d.selectNodeContents(o),d.setStart(s.endContainer,s.endOffset),{left:l.toString().length,right:d.toString().length}},rangeSelectsSingleNode:function(i){var o=i.startContainer;return o===i.endContainer&&o.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var o=i.getSelection(),s,l,d;if(!o.rangeCount||o.isCollapsed||!o.getRangeAt(0).commonAncestorContainer)return[];if(s=o.getRangeAt(0),s.commonAncestorContainer.nodeType===3){for(l=[],d=s.commonAncestorContainer;d.parentNode&&d.parentNode.childNodes.length===1;)l.push(d.parentNode),d=d.parentNode;return l}return[].filter.call(s.commonAncestorContainer.getElementsByTagName("*"),function(c){return typeof o.containsNode=="function"?o.containsNode(c,!0):!0})},selectNode:function(i,o){var s=o.createRange();s.selectNodeContents(i),this.selectRange(o,s)},select:function(i,o,s,l,d){var c=i.createRange();return c.setStart(o,s),l?c.setEnd(l,d):c.collapse(!0),this.selectRange(i,c),c},clearSelection:function(i,o){o?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,o,s){this.select(i,o,s)},getSelectionRange:function(i){var o=i.getSelection();return o.rangeCount===0?null:o.getRangeAt(0)},selectRange:function(i,o){var s=i.getSelection();s.removeAllRanges(),s.addRange(o)},getSelectionStart:function(i){var o=i.getSelection().anchorNode,s=o&&o.nodeType===3?o.parentNode:o;return s}};e.selection=n}(),function(){function t(i,o){return i?i.some(function(s){if(typeof s.getInteractionElements!="function")return!1;var l=s.getInteractionElements();return l?(Array.isArray(l)||(l=[l]),l.some(function(d){return e.util.isDescendant(d,o,!0)})):!1}):!1}var n=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,o,s,l){var d=this.base.options.contentWindow,c=this.base.options.ownerDocument;i=e.util.isElement(i)||[d,c].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(f){f.addEventListener(o,s,l),this.events.push([f,o,s,l])}).bind(this))},detachDOMEvent:function(i,o,s,l){var d,c,f=this.base.options.contentWindow,v=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[f,v].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(g){d=this.indexOfListener(g,o,s,l),d!==-1&&(c=this.events.splice(d,1)[0],c[0].removeEventListener(c[1],c[2],c[3]))}).bind(this)))},indexOfListener:function(i,o,s,l){var d,c,f;for(d=0,c=this.events.length;d<c;d=d+1)if(f=this.events[d],f[0]===i&&f[1]===o&&f[2]===s&&f[3]===l)return d;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var o=this.events.filter(function(c){return c&&c[0].getAttribute&&c[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),s=0,l=o.length;s<l;s++){var d=o[s];this.detachDOMEvent(d[0],d[1],d[2],d[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(o){this.attachDOMEvent(i,o.name,o.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,o){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(o)},detachCustomEvent:function(i,o){var s=this.indexOfCustomListener(i,o);s!==-1&&this.customEvents[i].splice(s,1)},indexOfCustomListener:function(i,o){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(o)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,o,s){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(l){l(o,s)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var o=i.execCommand.listeners.indexOf(this.execCommandListener);o!==-1&&i.execCommand.listeners.splice(o,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var o=function(l,d){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(c){c({command:l[0],value:l[2],args:l,result:d})})},s=function(){var l=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return l;var d=Array.prototype.slice.call(arguments);return o(d,l),l};s.orig=i.execCommand,s.listeners=[],s.callListeners=o,i.execCommand=s}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(o){this.contentCache[o.getAttribute("medium-editor-index")]=o.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,o){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(s){this.attachDOMEvent(s,i,o.bind(this))},this),this.eventsCache.push({name:i,handler:o})},cleanupElement:function(i){var o=i.getAttribute("medium-editor-index");o&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[o])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,o){var s=this.base.getFocusedElement(),l;s&&o.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(s,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(l=s),l||this.base.elements.some(function(c){return!l&&e.util.isDescendant(c,i,!0)&&(l=c),!!l},this);var d=!e.util.isDescendant(s,i,!0)&&!t(this.base.extensions,i);l!==s&&(s&&d&&(s.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",o,s)),l&&(l.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",o,l))),d&&this.triggerCustomEvent("externalInteraction",o)},updateInput:function(i,o){if(this.contentCache){var s=i.getAttribute("medium-editor-index"),l=i.innerHTML;l!==this.contentCache[s]&&this.triggerCustomEvent("editableInput",o,i),this.contentCache[s]=l}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var o=i.currentTarget.activeElement,s;this.base.elements.some(function(l){return e.util.isDescendant(l,o,!0)?(s=l,!0):!1},this),s&&this.updateInput(s,{target:o,currentTarget:s})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var o={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(o.currentTarget,o)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=n}(),function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(n){t.isBuiltInButton(n)?e.Extension.call(this,this.defaults[n]):e.Extension.call(this,n)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var n=this.document.createElement("button"),i=this.contentDefault,o=this.getAria(),s=this.getEditorOption("buttonLabels");return n.classList.add("medium-editor-action"),n.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(l){n.classList.add(l)}),n.setAttribute("data-action",this.getAction()),o&&(n.setAttribute("title",o),n.setAttribute("aria-label",o)),this.attrs&&Object.keys(this.attrs).forEach(function(l){n.setAttribute(l,this.attrs[l])},this),s==="fontawesome"&&this.contentFA&&(i=this.contentFA),n.innerHTML=i,n},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var n=null;return this.useQueryState&&(n=this.base.queryCommandState(this.getAction())),n},isAlreadyApplied:function(n){var i=!1,o=this.getTagNames(),s,l;return this.knownState===!1||this.knownState===!0?this.knownState:(o&&o.length>0&&(i=o.indexOf(n.nodeName.toLowerCase())!==-1),!i&&this.style&&(s=this.style.value.split("|"),l=this.window.getComputedStyle(n,null).getPropertyValue(this.style.prop),s.forEach(function(d){this.knownState||(i=l.indexOf(d)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(n){return typeof n=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(n)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.hideToolbarDefaultActions()},setToolbarPosition:function(){var n=this.base.getExtensionByName("toolbar");n&&n.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(n){e.util.isKey(n,e.util.keyCode.K)&&e.util.isMetaCtrlKey(n)&&!n.shiftKey&&this.handleClick(n)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var n=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return n.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),n.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),n.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(n){var i=this.getInput(),o=this.getAnchorTargetCheckbox(),s=this.getAnchorButtonCheckbox();if(n=n||{value:""},typeof n=="string"&&(n={value:n}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=n.value,i.focus(),o&&(o.checked=n.target==="_blank"),s){var l=n.buttonClass?n.buttonClass.split(" "):[];s.checked=l.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var n=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),o={value:this.getInput().value.trim()};return this.linkValidation&&(o.value=this.checkLinkFormat(o.value)),o.target="_self",n&&n.checked&&(o.target="_blank"),i&&i.checked&&(o.buttonClass=this.customClassOption),o},doFormSave:function(){var n=this.getFormOpts();this.completeFormSave(n)},completeFormSave:function(n){this.base.restoreSelection(),this.execAction(this.action,n),this.base.checkSelection()},ensureEncodedUri:function(n){return n===decodeURI(n)?encodeURI(n):n},ensureEncodedUriComponent:function(n){return n===decodeURIComponent(n)?encodeURIComponent(n):n},ensureEncodedParam:function(n){var i=n.split("="),o=i[0],s=i[1];return o+(s===void 0?"":"="+this.ensureEncodedUriComponent(s))},ensureEncodedQuery:function(n){return n.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(n){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,o=i.test(n),s="",l=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,d=n.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),c=d[1],f=d[2],v=d[3];if(l.test(n))return"tel:"+n;if(!o){var g=c.split("/")[0];(g.match(/.+(\.|:).+/)||g==="localhost")&&(s="http://")}return s+this.ensureEncodedUri(c)+(f===void 0?"":"?"+this.ensureEncodedQuery(f))+(v===void 0?"":"#"+v)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(n){var i=n.querySelector(".medium-editor-toolbar-close"),o=n.querySelector(".medium-editor-toolbar-save"),s=n.querySelector(".medium-editor-toolbar-input");this.on(n,"click",this.handleFormClick.bind(this)),this.on(s,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(o,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var n=this.document,i=n.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(n){if(n.keyCode===e.util.keyCode.ENTER){n.preventDefault(),this.doFormSave();return}n.keyCode===e.util.keyCode.ESCAPE&&(n.preventDefault(),this.doFormCancel())},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var n=this.document.createElement("div");return n.id="medium-editor-anchor-preview-"+this.getEditorId(),n.className="medium-editor-anchor-preview",n.innerHTML=this.getTemplate(),this.on(n,"click",this.handleClick.bind(this)),n},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(n){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||n.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=n.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=n.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=n,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(n){n=n||this.activeAnchor;var i=this.window.innerWidth,o=this.anchorPreview.offsetHeight,s=n.getBoundingClientRect(),l=this.diffLeft,d=this.diffTop,c=this.getEditorOption("elementsContainer"),f=["absolute","fixed"].indexOf(window.getComputedStyle(c).getPropertyValue("position"))>-1,v={},g,y,b,x,w;g=this.anchorPreview.offsetWidth/2;var _=this.base.getExtensionByName("toolbar");_&&(l=_.diffLeft,d=_.diffTop),y=l-g,f?(x=c.getBoundingClientRect(),["top","left"].forEach(function(C){v[C]=s[C]-x[C]}),v.width=s.width,v.height=s.height,s=v,i=x.width,w=c.scrollTop):w=this.window.pageYOffset,b=s.left+s.width/2,w+=o+s.top+s.height-d-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(w)+"px",this.anchorPreview.style.right="initial",b<g?(this.anchorPreview.style.left=y+g+"px",this.anchorPreview.style.right="initial"):i-b<g?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=y+b+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(n){var i=this.base.getExtensionByName("anchor"),o=this.activeAnchor;i&&o&&(n.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(o){var s={value:o.attributes.href.value,target:o.getAttribute("target"),buttonClass:o.getAttribute("class")};i.showForm(s),o=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(n){var i=e.util.getClosestTag(n.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var o=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&o&&o.isDisplayed&&o.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(n){(!n.relatedTarget||!/anchor-preview/.test(n.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var n=new Date().getTime()-this.lastOver;n>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){var t,n,i,o,s;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+n+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",o=new RegExp("^("+n+")$","i"),s=new RegExp(i,"gi");function l(c){return!e.util.getClosestTag(c,"a")}var d=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var c=0,f=0;f<this.window._mediumEditors.length;f++){var v=this.window._mediumEditors[f];v!==null&&v.getExtensionByName("autoLink")!==void 0&&c++}return c===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(c,f){this.performLinking(f)},onKeypress:function(c){this.disableEventHandling||e.util.isKey(c,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var f=this.base.exportSelection();this.performLinking(c.target)&&this.base.importSelection(f,!0)}catch(v){window.console&&window.console.error("Failed to perform linking",v),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(c){var f=e.util.splitByBlockElements(c),v=!1;f.length===0&&(f=[c]);for(var g=0;g<f.length;g++)v=this.removeObsoleteAutoLinkSpans(f[g])||v,v=this.performLinkingWithinElement(f[g])||v;return this.base.events.updateInput(c,{target:c,currentTarget:c}),v},removeObsoleteAutoLinkSpans:function(c){if(!c||c.nodeType===3)return!1;for(var f=c.querySelectorAll('span[data-auto-link="true"]'),v=!1,g=0;g<f.length;g++){var y=f[g].textContent;if(y.indexOf("://")===-1&&(y=e.util.ensureUrlHasProtocol(y)),f[g].getAttribute("data-href")!==y&&l(f[g])){v=!0;var b=y.replace(/\s+$/,"");if(f[g].getAttribute("data-href")===b){var x=y.length-b.length,w=e.util.splitOffDOMTree(f[g],this.splitTextBeforeEnd(f[g],x));f[g].parentNode.insertBefore(w,f[g].nextSibling)}else e.util.unwrap(f[g],this.document)}}return v},splitTextBeforeEnd:function(c,f){for(var v=this.document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null,!1),g=!0;g;)g=v.lastChild()!==null;for(var y,b,x;f>0&&x!==null;)y=v.currentNode,b=y.nodeValue,b.length>f?(x=y.splitText(b.length-f),f=0):(x=v.previousNode(),f-=b.length);return x},performLinkingWithinElement:function(c){for(var f=this.findLinkableText(c),v=!1,g=0;g<f.length;g++){var y=e.util.findOrCreateMatchingTextNodes(this.document,c,f[g]);this.shouldNotLink(y)||this.createAutoLink(y,f[g].href)}return v},shouldNotLink:function(c){for(var f=!1,v=0;v<c.length&&f===!1;v++)f=!!e.util.traverseUp(c[v],function(g){return g.nodeName.toLowerCase()==="a"||g.getAttribute&&g.getAttribute("data-auto-link")==="true"});return f},findLinkableText:function(c){for(var f=c.textContent,v=null,g=[];(v=s.exec(f))!==null;){var y=!0,b=v.index+v[0].length;y=(v.index===0||t.indexOf(f[v.index-1])!==-1)&&(b===f.length||t.indexOf(f[b])!==-1),y=y&&(v[0].indexOf("/")!==-1||o.test(v[0].split(".").pop().split("?").shift())),y&&g.push({href:v[0],start:v.index,end:b})}return g},createAutoLink:function(c,f){f=e.util.ensureUrlHasProtocol(f);var v=e.util.createLink(this.document,c,f,this.getEditorOption("targetBlank")?"_blank":null),g=this.document.createElement("span");for(g.setAttribute("data-auto-link","true"),g.setAttribute("data-href",f),v.insertBefore(g,v.firstChild);v.childNodes.length>1;)g.appendChild(v.childNodes[1])}});e.extensions.autoLink=d}(),function(){var t="medium-editor-dragover";function n(o){var s=e.util.getContainerEditorElement(o),l=Array.prototype.slice.call(s.parentElement.querySelectorAll("."+t));l.forEach(function(d){d.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){o.preventDefault(),o.dataTransfer.dropEffect="copy";var s=o.target.classList?o.target:o.target.parentElement;n(s),o.type==="dragover"&&s.classList.add(t)},handleDrop:function(o){o.preventDefault(),o.stopPropagation(),this.base.selectElement(o.target);var s=this.base.exportSelection();s.start=s.end,this.base.importSelection(s),o.dataTransfer.files&&Array.prototype.slice.call(o.dataTransfer.files).forEach(function(l){this.isAllowedFile(l)&&l.type.match("image")&&this.insertImageFile(l)},this),n(o.target)},isAllowedFile:function(o){return this.allowedTypes.some(function(s){return!!o.type.match(s)})},insertImageFile:function(o){if(typeof FileReader=="function"){var s=new FileReader;s.readAsDataURL(o),s.addEventListener("load",(function(l){var d=this.document.createElement("img");d.src=l.target.result,e.util.insertHTMLCommand(this.document,d.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(n){var i=n.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(n)},this)},handleKeydown:function(n){var i=e.util.getKeyCode(n);if(this.keys[i]){var o=e.util.isMetaCtrlKey(n),s=!!n.shiftKey,l=!!n.altKey;this.keys[i].forEach(function(d){d.meta===o&&d.shift===s&&(d.alt===l||d.alt===void 0)&&(n.preventDefault(),n.stopPropagation(),typeof d.command=="function"?d.command.apply(this):d.command!==!1&&this.execAction(d.command))},this)}}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(n){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("select"),s=n.createElement("a"),l=n.createElement("a"),d;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var c=0;c<this.fonts.length;c++)d=n.createElement("option"),d.innerHTML=this.fonts[c],d.value=this.fonts[c],o.appendChild(d);return o.className="medium-editor-toolbar-select",i.appendChild(o),this.on(o,"change",this.handleFontChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("face")&&n.removeAttribute("face")})},handleFontChange:function(){var n=this.getSelect().value;n===""?this.clearFontName():this.execAction("fontName",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(n){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("input"),s=n.createElement("a"),l=n.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),o.setAttribute("type","range"),o.setAttribute("min","1"),o.setAttribute("max","7"),o.className="medium-editor-toolbar-input",i.appendChild(o),this.on(o,"change",this.handleSliderChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("size")&&n.removeAttribute("size")})},handleSliderChange:function(){var n=this.getInput().value;n==="4"?this.clearFontSize():this.execAction("fontSize",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){var t="%ME_PASTEBIN%",n=null,i=null,o=function(c){c.stopPropagation()};function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function l(c,f,v){var g=c.clipboardData||f.clipboardData||v.dataTransfer,y={};if(!g)return y;if(g.getData){var b=g.getData("Text");b&&b.length>0&&(y["text/plain"]=b)}if(g.types)for(var x=0;x<g.types.length;x++){var w=g.types[x];y[w]=g.getData(w)}return y}var d=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(c){this.on(c,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(c,f){this.on(f,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(c,f){if(!c.defaultPrevented){var v=l(c,this.window,this.document),g=v["text/html"],y=v["text/plain"];this.window.clipboardData&&c.clipboardData===void 0&&!g&&(g=y),(g||y)&&(c.preventDefault(),this.doPaste(g,y,f))}},doPaste:function(c,f,v){var g,y="",b;if(this.cleanPastedHTML&&c)return this.cleanPaste(c);if(f){if(this.getEditorOption("disableReturn")||v&&v.getAttribute("data-disable-return"))y=e.util.htmlEntities(f);else if(g=f.split(/[\r\n]+/g),g.length>1)for(b=0;b<g.length;b+=1)g[b]!==""&&(y+="<p>"+e.util.htmlEntities(g[b])+"</p>");else y=e.util.htmlEntities(g[0]);e.util.insertHTMLCommand(this.document,y)}},handlePasteBinPaste:function(c){if(c.defaultPrevented){this.removePasteBin();return}var f=l(c,this.window,this.document),v=f["text/html"],g=f["text/plain"],y=i;if(!this.cleanPastedHTML||v){c.preventDefault(),this.removePasteBin(),this.doPaste(v,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y);return}setTimeout((function(){this.cleanPastedHTML&&(v=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(v,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y)}).bind(this),0)},handleKeydown:function(c,f){e.util.isKey(c,e.util.keyCode.V)&&e.util.isMetaCtrlKey(c)&&(c.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(f))},createPasteBin:function(c){var f,v=e.selection.getSelectionRange(this.document),g=this.window.pageYOffset;i=c,v&&(f=v.getClientRects(),f.length?g+=f[0].top:v.startContainer.getBoundingClientRect!==void 0?g+=v.startContainer.getBoundingClientRect().top:g+=v.getBoundingClientRect().top),n=v;var y=this.document.createElement("div");y.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),y.setAttribute("style","border: 1px red solid; position: absolute; top: "+g+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),y.setAttribute("contentEditable",!0),y.innerHTML=t,this.document.body.appendChild(y),this.on(y,"focus",o),this.on(y,"focusin",o),this.on(y,"focusout",o),y.focus(),e.selection.selectNode(y,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(y,"paste",this.boundHandlePaste)},removePasteBin:function(){n!==null&&(e.selection.selectRange(this.document,n),n=null),i!==null&&(i=null);var c=this.getPasteBin();c&&c&&(this.off(c,"focus",o),this.off(c,"focusin",o),this.off(c,"focusout",o),this.off(c,"paste",this.boundHandlePaste),c.parentElement.removeChild(c))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var c=this.getPasteBin();if(!c||c.firstChild&&c.firstChild.id==="mcepastebin")return!1;var f=c.innerHTML;return!f||f===t?!1:f},cleanPaste:function(c){var f,v,g,y,b=/<p|<br|<div/.test(c),x=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(f=0;f<x.length;f+=1)c=c.replace(x[f][0],x[f][1]);if(!b)return this.pasteHTML(c);for(g=this.document.createElement("div"),g.innerHTML="<p>"+c.split("<br><br>").join("</p><p>")+"</p>",v=g.querySelectorAll("a,p,div,br"),f=0;f<v.length;f+=1)switch(y=v[f],y.innerHTML=y.innerHTML.replace(/\n/gi," "),y.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(y);break;case"br":this.filterLineBreak(y);break}this.pasteHTML(g.innerHTML)},pasteHTML:function(c,f){f=e.util.defaults({},f,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var v,g,y,b,x=this.document.createDocumentFragment();for(x.appendChild(this.document.createElement("body")),b=x.querySelector("body"),b.innerHTML=c,this.cleanupSpans(b),v=b.querySelectorAll("*"),y=0;y<v.length;y+=1)g=v[y],g.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(g),e.util.cleanupAttrs(g,f.cleanAttrs),e.util.cleanupTags(g,f.cleanTags),e.util.unwrapTags(g,f.unwrapTags);e.util.insertHTMLCommand(this.document,b.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(c){return c&&(c.nodeName.toLowerCase()==="p"||c.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(c){/^\s*$/.test(c.textContent)&&c.parentNode&&c.parentNode.removeChild(c)},filterLineBreak:function(c){this.isCommonBlock(c.previousElementSibling)?this.removeWithParent(c):this.isCommonBlock(c.parentNode)&&(c.parentNode.firstChild===c||c.parentNode.lastChild===c)?this.removeWithParent(c):c.parentNode&&c.parentNode.childElementCount===1&&c.parentNode.textContent===""&&this.removeWithParent(c)},removeWithParent:function(c){c&&c.parentNode&&(c.parentNode.parentNode&&c.parentNode.childElementCount===1?c.parentNode.parentNode.removeChild(c.parentNode):c.parentNode.removeChild(c))},cleanupSpans:function(c){var f,v,g,y=c.querySelectorAll(".replace-with"),b=function(x){return x&&x.nodeName!=="#text"&&x.getAttribute("contenteditable")==="false"};for(f=0;f<y.length;f+=1)v=y[f],g=this.document.createElement(v.classList.contains("bold")?"b":"i"),v.classList.contains("bold")&&v.classList.contains("italic")?g.innerHTML="<i>"+v.innerHTML+"</i>":g.innerHTML=v.innerHTML,v.parentNode.replaceChild(g,v);for(y=c.querySelectorAll("span"),f=0;f<y.length;f+=1){if(v=y[f],e.util.traverseUp(v,b))return!1;e.util.unwrap(v,this.document)}}});e.extensions.paste=d}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(n,i){this.initElement(i)},initElement:function(n){n.getAttribute("data-placeholder")||n.setAttribute("data-placeholder",this.text),this.updatePlaceholder(n)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(n,i){this.cleanupElement(i)},cleanupElement:function(n){n.getAttribute("data-placeholder")===this.text&&n.removeAttribute("data-placeholder")},showPlaceholder:function(n){n&&(e.util.isFF&&n.childNodes.length===0?(n.classList.add("medium-editor-placeholder-relative"),n.classList.remove("medium-editor-placeholder")):(n.classList.add("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(n){n&&(n.classList.remove("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(n,i){if(n.querySelector("img, blockquote, ul, ol, table")||n.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(n);i||this.showPlaceholder(n)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(n,i){var o=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,o)},handleFocus:function(n,i){this.hidePlaceholder(i)},handleBlur:function(n,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(n,i){return this.base.extensions.forEach(function(o){if(o!==this)return n.apply(i||this,arguments)},this)},createToolbar:function(){var n=this.document.createElement("div");return n.id="medium-editor-toolbar-"+this.getEditorId(),n.className="medium-editor-toolbar",this.static?n.className+=" static-toolbar":this.relativeContainer?n.className+=" medium-editor-relative-toolbar":n.className+=" medium-editor-stalker-toolbar",n.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&n.appendChild(i.getForm())}),this.attachEventHandlers(),n},createToolbarButtons:function(){var n=this.document.createElement("ul"),i,o,s,l,d,c;return n.id="medium-editor-toolbar-actions"+this.getEditorId(),n.className="medium-editor-toolbar-actions",n.style.display="block",this.buttons.forEach(function(f){typeof f=="string"?(d=f,c=null):(d=f.name,c=f),l=this.base.addBuiltInExtension(d,c),l&&typeof l.getButton=="function"&&(o=l.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(o)?i.appendChild(o):i.innerHTML=o,n.appendChild(i))},this),s=n.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),n},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(n){if(n&&n.target&&e.util.isDescendant(this.getToolbarElement(),n.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(n){n.hasForm&&n.isDisplayed()&&n.hideForm()})},multipleBlockElementsSelected:function(){var n=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),o=e.selection.getSelectionHtml(this.document).replace(n,""),s=o.match(i);return!!s&&s.length>1},modifySelection:function(){var n=this.window.getSelection(),i=n.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var o=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(o){for(var s=0;o.nodeValue.substr(s,1).trim().length===0;)s=s+1;i=e.selection.select(this.document,o,s,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var n=e.selection.getSelectionElement(this.window);if(!n||this.getEditorElements().indexOf(n)===-1||n.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(n){typeof n.isActive=="function"&&typeof n.setInactive=="function"&&n.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var n=[],i=null,o=e.selection.getSelectionRange(this.document),s,l=function(d){typeof d.checkState=="function"?d.checkState(s):typeof d.isActive=="function"&&typeof d.isAlreadyApplied=="function"&&typeof d.setActive=="function"&&!d.isActive()&&d.isAlreadyApplied(s)&&d.setActive()};if(o&&(this.forEachExtension(function(d){if(typeof d.queryCommandState=="function"&&(i=d.queryCommandState(),i!==null)){i&&typeof d.setActive=="function"&&d.setActive();return}n.push(d)}),s=e.selection.getSelectedParentElement(o),!!this.getEditorElements().some(function(d){return e.util.isDescendant(d,s,!0)})))for(;s&&(n.forEach(l),!e.util.isMediumEditorElement(s));)s=s.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var n=this.base.getFocusedElement(),i=this.window.getSelection();if(!n)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(n):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(n){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,o=this.window.innerWidth,s=this.getToolbarElement(),l=n.getBoundingClientRect(),d=l.top+i,c=l.left+l.width/2,f=s.offsetHeight,v=s.offsetWidth,g=v/2,y;switch(this.sticky?i>d+n.offsetHeight-f-this.stickyTopOffset?(s.style.top=d+n.offsetHeight-f+"px",s.classList.remove("medium-editor-sticky-toolbar")):i>d-f-this.stickyTopOffset?(s.classList.add("medium-editor-sticky-toolbar"),s.style.top=this.stickyTopOffset+"px"):(s.classList.remove("medium-editor-sticky-toolbar"),s.style.top=d-f+"px"):s.style.top=d-f+"px",this.align){case"left":y=l.left;break;case"right":y=l.right-v;break;case"center":y=c-g;break}y<0?y=0:y+v>o&&(y=o-Math.ceil(v)-1),s.style.left=y+"px"},positionToolbar:function(n){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=n.getRangeAt(0),o=i.getBoundingClientRect();(!o||o.height===0&&o.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?o=i.startContainer.querySelector("img").getBoundingClientRect():o=i.startContainer.getBoundingClientRect());var s=this.window.innerWidth,l=this.getToolbarElement(),d=l.offsetHeight,c=l.offsetWidth,f=c/2,v=50,g=this.diffLeft-f,y=this.getEditorOption("elementsContainer"),b=["absolute","fixed"].indexOf(window.getComputedStyle(y).getPropertyValue("position"))>-1,x={},w={},_,C;b?(C=y.getBoundingClientRect(),["top","left"].forEach(function(k){w[k]=o[k]-C[k]}),w.width=o.width,w.height=o.height,o=w,s=C.width,x.top=y.scrollTop):x.top=this.window.pageYOffset,_=o.left+o.width/2,x.top+=o.top-d,o.top<v?(l.classList.add("medium-toolbar-arrow-over"),l.classList.remove("medium-toolbar-arrow-under"),x.top+=v+o.height-this.diffTop):(l.classList.add("medium-toolbar-arrow-under"),l.classList.remove("medium-toolbar-arrow-over"),x.top+=this.diffTop),_<f?(x.left=g+f,x.right="initial"):s-_<f?(x.left="auto",x.right=0):(x.left=g+_,x.right="initial"),["top","left","right"].forEach(function(k){l.style[k]=x[k]+(isNaN(x[k])?"":"px")})}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(n){var i="medium-editor-dragover";n.preventDefault(),n.dataTransfer.dropEffect="copy",n.type==="dragover"?n.target.classList.add(i):n.type==="dragleave"&&n.target.classList.remove(i)},handleDrop:function(n){var i="medium-editor-dragover",o;n.preventDefault(),n.stopPropagation(),n.dataTransfer.files&&(o=Array.prototype.slice.call(n.dataTransfer.files,0),o.some((function(s){if(s.type.match("image")){var l,d;l=new FileReader,l.readAsDataURL(s),d="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+d+'" />'),l.onload=(function(){var c=this.document.getElementById(d);c&&(c.removeAttribute("id"),c.removeAttribute("class"),c.src=l.result)}).bind(this)}}).bind(this))),n.target.classList.remove(i)}});e.extensions.imageDragging=t}(),function(){function t(T){var z=e.selection.getSelectionStart(this.options.ownerDocument),B=z.textContent,pe=e.selection.getCaretOffsets(z);(B[pe.left-1]===void 0||B[pe.left-1].trim()===""||B[pe.left]!==void 0&&B[pe.left].trim()==="")&&T.preventDefault()}function n(T,z){if(this.options.disableReturn||z.getAttribute("data-disable-return"))T.preventDefault();else if(this.options.disableDoubleReturn||z.getAttribute("data-disable-double-return")){var B=e.selection.getSelectionStart(this.options.ownerDocument);(B&&B.textContent.trim()===""&&B.nodeName.toLowerCase()!=="li"||B.previousElementSibling&&B.previousElementSibling.nodeName.toLowerCase()!=="br"&&B.previousElementSibling.textContent.trim()==="")&&T.preventDefault()}}function i(T){var z=e.selection.getSelectionStart(this.options.ownerDocument),B=z&&z.nodeName.toLowerCase();B==="pre"&&(T.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(z)&&(T.preventDefault(),T.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function o(T){var z,B=e.selection.getSelectionStart(this.options.ownerDocument),pe=B.nodeName.toLowerCase(),Ee=/^(\s+|<br\/?>)?$/i,ye=/h\d/i;e.util.isKey(T,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&B.previousElementSibling&&ye.test(pe)&&e.selection.getCaretOffsets(B).left===0?e.util.isKey(T,e.util.keyCode.BACKSPACE)&&Ee.test(B.previousElementSibling.innerHTML)?(B.previousElementSibling.parentNode.removeChild(B.previousElementSibling),T.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(T,e.util.keyCode.ENTER)&&(z=this.options.ownerDocument.createElement("p"),z.innerHTML="<br>",B.previousElementSibling.parentNode.insertBefore(z,B),T.preventDefault()):e.util.isKey(T,e.util.keyCode.DELETE)&&B.nextElementSibling&&B.previousElementSibling&&!ye.test(pe)&&Ee.test(B.innerHTML)&&ye.test(B.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,B.nextElementSibling),B.previousElementSibling.parentNode.removeChild(B),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&pe==="li"&&Ee.test(B.innerHTML)&&!B.previousElementSibling&&!B.parentElement.previousElementSibling&&B.nextElementSibling&&B.nextElementSibling.nodeName.toLowerCase()==="li"?(z=this.options.ownerDocument.createElement("p"),z.innerHTML="<br>",B.parentElement.parentElement.insertBefore(z,B.parentElement),e.selection.moveCursor(this.options.ownerDocument,z),B.parentElement.removeChild(B),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(B,"blockquote")!==!1&&e.selection.getCaretOffsets(B).left===0?(T.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(T,e.util.keyCode.ENTER)&&e.util.getClosestTag(B,"blockquote")!==!1&&e.selection.getCaretOffsets(B).right===0?(z=this.options.ownerDocument.createElement("p"),z.innerHTML="<br>",B.parentElement.insertBefore(z,B.nextSibling),e.selection.moveCursor(this.options.ownerDocument,z),T.preventDefault()):e.util.isKey(T,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(B.parentElement)&&!B.previousElementSibling&&B.nextElementSibling&&Ee.test(B.innerHTML)&&(T.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,B.nextSibling),B.parentElement.removeChild(B))}function s(T){var z=e.selection.getSelectionStart(this.options.ownerDocument),B;z&&(e.util.isMediumEditorElement(z)&&z.children.length===0&&!e.util.isBlockContainer(z)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(T,e.util.keyCode.ENTER)&&!e.util.isListItem(z)&&!e.util.isBlockContainer(z)&&(B=z.nodeName.toLowerCase(),B==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!T.shiftKey&&!T.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function l(T,z){var B=z.parentNode.querySelector('textarea[medium-editor-textarea-id="'+z.getAttribute("medium-editor-textarea-id")+'"]');B&&(B.value=z.innerHTML.trim())}function d(T){T._mediumEditors||(T._mediumEditors=[null]),this.id||(this.id=T._mediumEditors.length),T._mediumEditors[this.id]=this}function c(T){!T._mediumEditors||!T._mediumEditors[this.id]||(T._mediumEditors[this.id]=null)}function f(T,z,B){var pe=[];if(T||(T=[]),typeof T=="string"&&(T=z.querySelectorAll(T)),e.util.isElement(T)&&(T=[T]),B)for(var Ee=0;Ee<T.length;Ee++){var ye=T[Ee];e.util.isElement(ye)&&!ye.getAttribute("data-medium-editor-element")&&!ye.getAttribute("medium-editor-textarea-id")&&pe.push(ye)}else pe=Array.prototype.slice.apply(T);return pe}function v(T){var z=T.parentNode.querySelector('textarea[medium-editor-textarea-id="'+T.getAttribute("medium-editor-textarea-id")+'"]');z&&(z.classList.remove("medium-editor-hidden"),z.removeAttribute("medium-editor-textarea-id")),T.parentNode&&T.parentNode.removeChild(T)}function g(T,z){return Object.keys(z).forEach(function(B){T[B]===void 0&&(T[B]=z[B])}),T}function y(T,z,B){var pe={window:B.options.contentWindow,document:B.options.ownerDocument,base:B};return T=g(T,pe),typeof T.init=="function"&&T.init(),T.name||(T.name=z),T}function b(){return this.elements.every(function(T){return!!T.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function x(){return b.call(this)?this.options.anchorPreview!==!1:!1}function w(){return this.options.placeholder!==!1}function _(){return this.options.autoLink!==!1}function C(){return this.options.imageDragging!==!1}function k(){return this.options.keyboardCommands!==!1}function D(){return!this.options.extensions.imageDragging}function R(T){for(var z=this.options.ownerDocument.createElement("div"),B=Date.now(),pe="medium-editor-"+B,Ee=T.attributes;this.options.ownerDocument.getElementById(pe);)B++,pe="medium-editor-"+B;z.className=T.className,z.id=pe,z.innerHTML=T.value,T.setAttribute("medium-editor-textarea-id",pe);for(var ye=0,it=Ee.length;ye<it;ye++)z.hasAttribute(Ee[ye].nodeName)||z.setAttribute(Ee[ye].nodeName,Ee[ye].value);return T.form&&this.on(T.form,"reset",(function(Oe){Oe.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(pe))}).bind(this)),T.classList.add("medium-editor-hidden"),T.parentNode.insertBefore(z,T),z}function $(T,z){if(!T.getAttribute("data-medium-editor-element")){T.nodeName.toLowerCase()==="textarea"&&(T=R.call(this,T),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=l.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!T.getAttribute("data-disable-editing")&&(T.setAttribute("contentEditable",!0),T.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(T.getAttribute("data-disable-return")||T.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!T.getAttribute("data-disable-return")&&this.on(T,"keyup",s.bind(this));var B=e.util.guid();T.setAttribute("data-medium-editor-element",!0),T.classList.add("medium-editor-element"),T.setAttribute("role","textbox"),T.setAttribute("aria-multiline",!0),T.setAttribute("data-medium-editor-editor-index",z),T.setAttribute("medium-editor-index",B),ee[B]=T.innerHTML,this.events.attachAllEventsToElement(T)}return T}function P(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",o.bind(this)),this.subscribe("editableKeydownEnter",o.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function I(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(Ee){Ee!=="toolbar"&&this.options.extensions[Ee]&&this.extensions.push(y(this.options.extensions[Ee],Ee,this))},this),D.call(this)){var T=this.options.fileDragging;T||(T={},C.call(this)||(T.allowedTypes=[])),this.addBuiltInExtension("fileDragging",T)}var z={paste:!0,"anchor-preview":x.call(this),autoLink:_.call(this),keyboardCommands:k.call(this),placeholder:w.call(this)};Object.keys(z).forEach(function(Ee){z[Ee]&&this.addBuiltInExtension(Ee)},this);var B=this.options.extensions.toolbar;if(!B&&b.call(this)){var pe=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});B=new e.extensions.toolbar(pe)}B&&this.extensions.push(y(B,"toolbar",this))}function W(T,z){var B=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return z&&B.forEach(function(pe){z.hasOwnProperty(pe[0])&&z[pe[0]]!==void 0&&e.util.deprecated(pe[0],pe[1],"v6.0.0")}),e.util.defaults({},z,T)}function se(T,z){var B=/^append-(.+)$/gi,pe=/justify([A-Za-z]*)$/g,Ee,ye;if(Ee=B.exec(T),Ee)return e.util.execFormatBlock(this.options.ownerDocument,Ee[1]);if(T==="fontSize")return z.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),ye=z.value||z.size,this.options.ownerDocument.execCommand("fontSize",!1,ye);if(T==="fontName")return z.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),ye=z.value||z.name,this.options.ownerDocument.execCommand("fontName",!1,ye);if(T==="createLink")return this.createLink(z);if(T==="image"){var it=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,it)}if(T==="html"){var Oe=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,Oe)}if(pe.exec(T)){var he=this.options.ownerDocument.execCommand(T,!1,null),We=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return We&&q.call(this,e.util.getTopBlockContainer(We)),he}return ye=z&&z.value,this.options.ownerDocument.execCommand(T,!1,ye)}function q(T){if(T){var z,B=Array.prototype.slice.call(T.childNodes).filter(function(pe){var Ee=pe.nodeName.toLowerCase()==="div";return Ee&&!z&&(z=pe.style.textAlign),Ee});B.length&&(this.saveSelection(),B.forEach(function(pe){if(pe.style.textAlign===z){var Ee=pe.lastChild;if(Ee){e.util.unwrap(pe,this.options.ownerDocument);var ye=this.options.ownerDocument.createElement("BR");Ee.parentNode.insertBefore(ye,Ee.nextSibling)}}},this),T.style.textAlign=z,this.restoreSelection())}}var ee={};e.prototype={init:function(T,z){return this.options=W.call(this,this.defaults,z),this.origElements=T,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(d.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,I.call(this),P.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(T){typeof T.destroy=="function"&&T.destroy()},this),this.events.destroy(),this.elements.forEach(function(T){this.options.spellcheck&&(T.innerHTML=T.innerHTML),T.removeAttribute("contentEditable"),T.removeAttribute("spellcheck"),T.removeAttribute("data-medium-editor-element"),T.classList.remove("medium-editor-element"),T.removeAttribute("role"),T.removeAttribute("aria-multiline"),T.removeAttribute("medium-editor-index"),T.removeAttribute("data-medium-editor-editor-index"),T.getAttribute("medium-editor-textarea-id")&&v(T)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,c.call(this,this.options.contentWindow))},on:function(T,z,B,pe){return this.events.attachDOMEvent(T,z,B,pe),this},off:function(T,z,B,pe){return this.events.detachDOMEvent(T,z,B,pe),this},subscribe:function(T,z){return this.events.attachCustomEvent(T,z),this},unsubscribe:function(T,z){return this.events.detachCustomEvent(T,z),this},trigger:function(T,z,B){return this.events.triggerCustomEvent(T,z,B),this},delay:function(T){var z=this;return setTimeout(function(){z.isActive&&T()},this.options.delay)},serialize:function(){var T,z,B={},pe=this.elements.length;for(T=0;T<pe;T+=1)z=this.elements[T].id!==""?this.elements[T].id:"element-"+T,B[z]={value:this.elements[T].innerHTML.trim()};return B},getExtensionByName:function(T){var z;return this.extensions&&this.extensions.length&&this.extensions.some(function(B){return B.name===T?(z=B,!0):!1}),z},addBuiltInExtension:function(T,z){var B=this.getExtensionByName(T),pe;if(B)return B;switch(T){case"anchor":pe=e.util.extend({},this.options.anchor,z),B=new e.extensions.anchor(pe);break;case"anchor-preview":B=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":B=new e.extensions.autoLink;break;case"fileDragging":B=new e.extensions.fileDragging(z);break;case"fontname":B=new e.extensions.fontName(this.options.fontName);break;case"fontsize":B=new e.extensions.fontSize(z);break;case"keyboardCommands":B=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":B=new e.extensions.paste(this.options.paste);break;case"placeholder":B=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(T)&&(z?(pe=e.util.defaults({},z,e.extensions.button.prototype.defaults[T]),B=new e.extensions.button(pe)):B=new e.extensions.button(T))}return B&&this.extensions.push(y(B,T,this)),B},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var T=this.getExtensionByName("toolbar");return T&&T.checkState(),this},queryCommandState:function(T){var z=/^full-(.+)$/gi,B,pe=null;B=z.exec(T),B&&(T=B[1]);try{pe=this.options.ownerDocument.queryCommandState(T)}catch{pe=null}return pe},execAction:function(T,z){var B=/^full-(.+)$/gi,pe,Ee;return pe=B.exec(T),pe?(this.saveSelection(),this.selectAllContents(),Ee=se.call(this,pe[1],z),this.restoreSelection()):Ee=se.call(this,T,z),(T==="insertunorderedlist"||T==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),Ee},getSelectedParentElement:function(T){return T===void 0&&(T=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(T)},selectAllContents:function(){var T=e.selection.getSelectionElement(this.options.contentWindow);if(T){for(;T.children.length===1;)T=T.children[0];this.selectElement(T)}},selectElement:function(T){e.selection.selectNode(T,this.options.ownerDocument);var z=e.selection.getSelectionElement(this.options.contentWindow);z&&this.events.focusElement(z)},getFocusedElement:function(){var T;return this.elements.some(function(z){return!T&&z.getAttribute("data-medium-focused")&&(T=z),!!T},this),T},exportSelection:function(){var T=e.selection.getSelectionElement(this.options.contentWindow),z=this.elements.indexOf(T),B=null;return z>=0&&(B=e.selection.exportSelection(T,this.options.ownerDocument)),B!==null&&z!==0&&(B.editableElementIndex=z),B},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(T,z){if(T){var B=this.elements[T.editableElementIndex||0];e.selection.importSelection(T,B,this.options.ownerDocument,z)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(T){var z=e.selection.getSelectionElement(this.options.contentWindow),B={},pe;if(this.elements.indexOf(z)!==-1){try{if(this.events.disableCustomEvent("editableInput"),T.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),pe=T.url||T.value,pe&&pe.trim().length>0){var Ee=this.options.contentWindow.getSelection();if(Ee){var ye=Ee.getRangeAt(0),it=ye.commonAncestorContainer,Oe,he,We,Re;if(ye.endContainer.nodeType===3&&ye.startContainer.nodeType!==3&&ye.startOffset===0&&ye.startContainer.firstChild===ye.endContainer&&(it=ye.endContainer),he=e.util.getClosestBlockContainer(ye.startContainer),We=e.util.getClosestBlockContainer(ye.endContainer),it.nodeType!==3&&it.textContent.length!==0&&he===We){var Ge=he||z,le=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),Oe=this.exportSelection(),le.appendChild(Ge.cloneNode(!0)),z===Ge?e.selection.select(this.options.ownerDocument,Ge.firstChild,0,Ge.lastChild,Ge.lastChild.nodeType===3?Ge.lastChild.nodeValue.length:Ge.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,Ge,0,Ge,Ge.childNodes.length);var G=this.exportSelection();Re=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,le,{start:Oe.start-G.start,end:Oe.end-G.start,editableElementIndex:Oe.editableElementIndex}),Re.length===0&&(le=this.options.ownerDocument.createDocumentFragment(),le.appendChild(it.cloneNode(!0)),Re=[le.firstChild.firstChild,le.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Re,pe.trim());var oe=(le.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,le.firstChild.innerHTML.replace(/^\s+/,"")),Oe.start-=oe,Oe.end-=oe,this.importSelection(Oe)}else this.options.ownerDocument.execCommand("createLink",!1,pe);this.options.targetBlank||T.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),pe):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),pe),T.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),T.buttonClass)}}if(this.options.targetBlank||T.target==="_blank"||T.buttonClass){B=this.options.ownerDocument.createEvent("HTMLEvents"),B.initEvent("input",!0,!0,this.options.contentWindow);for(var de=0,ke=this.elements.length;de<ke;de+=1)this.elements[de].dispatchEvent(B)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",B,z)}},cleanPaste:function(T){this.getExtensionByName("paste").cleanPaste(T)},pasteHTML:function(T,z){this.getExtensionByName("paste").pasteHTML(T,z)},setContent:function(T,z){if(z=z||0,this.elements[z]){var B=this.elements[z];B.innerHTML=T,this.checkContentChanged(B)}},getContent:function(T){return T=T||0,this.elements[T]?this.elements[T].innerHTML.trim():null},checkContentChanged:function(T){T=T||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(T,{target:T,currentTarget:T})},resetContent:function(T){if(T){var z=this.elements.indexOf(T);z!==-1&&this.setContent(ee[T.getAttribute("medium-editor-index")],z);return}this.elements.forEach(function(B,pe){this.setContent(ee[B.getAttribute("medium-editor-index")],pe)},this)},addElements:function(T){var z=f(T,this.options.ownerDocument,!0);if(z.length===0)return!1;z.forEach(function(B){B=$.call(this,B,this.id),this.elements.push(B),this.trigger("addElement",{target:B,currentTarget:B},B)},this)},removeElements:function(T){var z=f(T,this.options.ownerDocument),B=z.map(function(pe){return pe.getAttribute("medium-editor-textarea-id")&&pe.parentNode?pe.parentNode.querySelector('div[medium-editor-textarea-id="'+pe.getAttribute("medium-editor-textarea-id")+'"]'):pe});this.elements=this.elements.filter(function(pe){return B.indexOf(pe)!==-1?(this.events.cleanupElement(pe),pe.getAttribute("medium-editor-textarea-id")&&v(pe),this.trigger("removeElement",{target:pe,currentTarget:pe},pe),!1):!0},this)}},e.getEditorFromElement=function(T){var z=T.getAttribute("data-medium-editor-editor-index"),B=T&&T.ownerDocument&&(T.ownerDocument.defaultView||T.ownerDocument.parentWindow);return B&&B._mediumEditors&&B._mediumEditors[z]?B._mediumEditors[z]:null}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(t){var n=t.split("-"),i=n[0].split("."),o=n.length>1?n[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:o,toString:function(){return[i[0],i[1],i[2]].join(".")+(o?"-"+o:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e}())}(ad)),ad.exports}var c5=d5();const qd=fs(c5);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var xp=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},wp=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),Ju=function(){function r(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var l=e[Symbol.iterator](),d;!(i=(d=l.next()).done)&&(n.push(d.value),!(t&&n.length===t));i=!0);}catch(c){o=!0,s=c}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return n}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(r){return this.indexOf(r)===0};String.prototype.padStart=String.prototype.padStart||function(r,e){for(var t=this;t.length<r;)t=e+t;return t};var f5={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function $y(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?r.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):r.toString();return t||"0"}var h5=function(){function r(e,t,n,i){xp(this,r);var o=this;function s(d){if(d.startsWith("hsl")){var c=d.match(/([\-\d\.e]+)/g).map(Number),f=Ju(c,4),v=f[0],g=f[1],y=f[2],b=f[3];b===void 0&&(b=1),v/=360,g/=100,y/=100,o.hsla=[v,g,y,b]}else if(d.startsWith("rgb")){var x=d.match(/([\-\d\.e]+)/g).map(Number),w=Ju(x,4),_=w[0],C=w[1],k=w[2],D=w[3];D===void 0&&(D=1),o.rgba=[_,C,k,D]}else d.startsWith("#")?o.rgba=r.hexToRgb(d):o.rgba=r.nameToRgb(d)||r.hexToRgb(d)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(n===void 0){var l=e&&""+e;l&&s(l.toLowerCase())}else this.rgba=[e,t,n,i===void 0?1:i]}return wp(r,[{key:"printRGB",value:function(t){var n=t?this.rgba:this.rgba.slice(0,3),i=n.map(function(o,s){return $y(o,s===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var n=[360,100,100,1],i=["","%","%",""],o=t?this.hsla:this.hsla.slice(0,3),s=o.map(function(l,d){return $y(l*n[d],d===3?3:1)+i[d]});return t?"hsla("+s+")":"hsl("+s+")"}},{key:"printHex",value:function(t){var n=this.hex;return t?n:n.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=r.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=r.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,n=t.map(function(i,o){return o<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+n.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=r.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var n=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!n.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=n.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(o){return parseInt(o,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var n=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=f5[n];return i===void 0?i:r.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var n=Ju(t,4),i=n[0],o=n[1],s=n[2],l=n[3];i/=255,o/=255,s/=255;var d=Math.max(i,o,s),c=Math.min(i,o,s),f=void 0,v=void 0,g=(d+c)/2;if(d===c)f=v=0;else{var y=d-c;switch(v=g>.5?y/(2-d-c):y/(d+c),d){case i:f=(o-s)/y+(o<s?6:0);break;case o:f=(s-i)/y+2;break;case s:f=(i-o)/y+4;break}f/=6}return[f,v,g,l]}},{key:"hslToRgb",value:function(t){var n=Ju(t,4),i=n[0],o=n[1],s=n[2],l=n[3],d=void 0,c=void 0,f=void 0;if(o===0)d=c=f=s;else{var v=function(w,_,C){return C<0&&(C+=1),C>1&&(C-=1),C<.16666666666666666?w+(_-w)*6*C:C<.5?_:C<.6666666666666666?w+(_-w)*(.6666666666666666-C)*6:w},g=s<.5?s*(1+o):s+o-s*o,y=2*s-g;d=v(y,g,i+1/3),c=v(y,g,i),f=v(y,g,i-1/3)}var b=[d*255,c*255,f*255].map(Math.round);return b[3]=l,b}}]),r}(),p5=function(){function r(){xp(this,r),this._events=[]}return wp(r,[{key:"add",value:function(t,n,i){t.addEventListener(n,i,!1),this._events.push({target:t,type:n,handler:i})}},{key:"remove",value:function(t,n,i){this._events=this._events.filter(function(o){var s=!0;return t&&t!==o.target&&(s=!1),n&&n!==o.type&&(s=!1),i&&i!==o.handler&&(s=!1),s&&r._doRemove(o.target,o.type,o.handler),!s})}},{key:"destroy",value:function(){this._events.forEach(function(t){return r._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,n,i){t.removeEventListener(n,i,!1)}}]),r}();function v5(r){var e=document.createElement("div");return e.innerHTML=r,e.firstElementChild}function Bf(r,e,t){var n=!1;function i(d,c,f){return Math.max(c,Math.min(d,f))}function o(d,c,f){if(f&&(n=!0),!!n){d.preventDefault();var v=e.getBoundingClientRect(),g=v.width,y=v.height,b=c.clientX,x=c.clientY,w=i(b-v.left,0,g),_=i(x-v.top,0,y);t(w/g,_/y)}}function s(d,c){var f=d.buttons===void 0?d.which:d.buttons;f===1?o(d,d,c):n=!1}function l(d,c){d.touches.length===1?o(d,d.touches[0],c):n=!1}r.add(e,"mousedown",function(d){s(d,!0)}),r.add(e,"touchstart",function(d){l(d,!0)}),r.add(window,"mousemove",s),r.add(e,"touchmove",l),r.add(window,"mouseup",function(d){n=!1}),r.add(e,"touchend",function(d){n=!1}),r.add(e,"touchcancel",function(d){n=!1})}var g5=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,m5=360,lS="keydown",Zu="mousedown",jf="focusin";function Ii(r,e){return(e||document).querySelector(r)}function y5(r){r.preventDefault(),r.stopPropagation()}function Hf(r,e,t,n,i){r.add(e,lS,function(o){t.indexOf(o.key)>=0&&n(o)})}var uS=function(){function r(e){xp(this,r),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new p5,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return wp(r,[{key:"setOptions",value:function(t){var n=this;if(!t)return;var i=this.settings;function o(c,f,v){for(var g in c)f[g]=c[g]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),o(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var s=t.color||t.colour;s&&this._setColor(s)}var l=i.parent;if(l&&i.popup&&!this._popupInited){var d=function(f){return n.openHandler(f)};this._events.add(l,"click",d),Hf(this._events,l,[" ","Spacebar","Enter"],d),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var n=t&&t.type===lS?this._domEdit:this.domElement;setTimeout(function(){return n.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var n=t&&t.type,i=!1;if(!t)i=!0;else if(n===Zu||n===jf){var o=(this.__containedEvent||0)+100;t.timeStamp>o&&(i=!0)}else y5(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",n!==Zu&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,n){this.closeHandler(),this.setOptions(t),n&&this.openHandler()}},{key:"setColor",value:function(t,n){this._setColor(t,{silent:n})}},{key:"_setColor",value:function(t,n){if(typeof t=="string"&&(t=t.trim()),!!t){n=n||{};var i=void 0;try{i=new h5(t)}catch(s){if(n.failSilently)return;throw s}if(!this.settings.alpha){var o=i.hsla;o[3]=1,i.hsla=o}this.colour=this.color=i,this._setHSLA(null,null,null,null,n)}}},{key:"setColour",value:function(t,n){this.setColor(t,n)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var n=this._toggleDOM(!0);return this._setPosition(),n}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',o=v5(i);return this.domElement=o,this._domH=Ii(".picker_hue",o),this._domSL=Ii(".picker_sl",o),this._domA=Ii(".picker_alpha",o),this._domEdit=Ii(".picker_editor input",o),this._domSample=Ii(".picker_sample",o),this._domOkay=Ii(".picker_done button",o),this._domCancel=Ii(".picker_cancel button",o),o.classList.add("layout_"+this.settings.layout),this.settings.alpha||o.classList.add("no_alpha"),this.settings.editor||o.classList.add("no_editor"),this.settings.cancelButton||o.classList.add("no_cancel"),this._ifPopup(function(){return o.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,n=this,i=this.domElement,o=this._events;function s(c,f,v){o.add(c,f,v)}s(i,"click",function(c){return c.preventDefault()}),Bf(o,this._domH,function(c,f){return n._setHSLA(c)}),Bf(o,this._domSL,function(c,f){return n._setHSLA(null,c,1-f)}),this.settings.alpha&&Bf(o,this._domA,function(c,f){return n._setHSLA(null,null,null,1-f)});var l=this._domEdit;s(l,"input",function(c){n._setColor(this.value,{fromEditor:!0,failSilently:!0})}),s(l,"focus",function(c){var f=this;f.selectionStart===f.selectionEnd&&f.select()}),this._ifPopup(function(){var c=function(g){return t.closeHandler(g)};s(window,Zu,c),s(window,jf,c),Hf(o,i,["Esc","Escape"],c);var f=function(g){t.__containedEvent=g.timeStamp};s(i,Zu,f),s(i,jf,f),s(t._domCancel,"click",c)});var d=function(f){t._ifPopup(function(){return t.closeHandler(f)}),t.onDone&&t.onDone(t.colour)};s(this._domOkay,"click",d),Hf(o,i,["Enter"],d)}},{key:"_setPosition",value:function(){var t=this.settings.parent,n=this.domElement;t!==n.parentNode&&t.appendChild(n),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var o=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(s){s===o?n.classList.add(s):n.classList.remove(s)}),n.classList.add(o)})}},{key:"_setHSLA",value:function(t,n,i,o,s){s=s||{};var l=this.colour,d=l.hsla;[t,n,i,o].forEach(function(c,f){(c||c===0)&&(d[f]=c)}),l.hsla=d,this._updateUI(s),this.onChange&&!s.silent&&this.onChange(l)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var n=this.colour,i=n.hsla,o="hsl("+i[0]*m5+", 100%, 50%)",s=n.hslString,l=n.hslaString,d=this._domH,c=this._domSL,f=this._domA,v=Ii(".picker_selector",d),g=Ii(".picker_selector",c),y=Ii(".picker_selector",f);function b($,P,I){P.style.left=I*100+"%"}function x($,P,I){P.style.top=I*100+"%"}b(d,v,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=o,b(c,g,i[1]),x(c,g,1-i[2]),c.style.color=s,x(f,y,1-i[3]);var w=s,_=w.replace("hsl","hsla").replace(")",", 0)"),C="linear-gradient("+[w,_]+")";if(this._domA.style.background=C+", "+g5,!t.fromEditor){var k=this.settings.editorFormat,D=this.settings.alpha,R=void 0;switch(k){case"rgb":R=n.printRGB(D);break;case"hsl":R=n.printHSL(D);break;default:R=n.printHex(D)}this._domEdit.value=R}this._domSample.style.color=l}},{key:"_ifPopup",value:function(t,n){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):n&&n()}},{key:"_toggleDOM",value:function(t){var n=this.domElement;if(!n)return!1;var i=t?"":"none",o=n.style.display!==i;return o&&(n.style.display=i),o}}]),r}();{var $f=document.createElement("style");$f.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild($f),uS.StyleElement=$f}var Ff={exports:{}},Fy;function dS(){return Fy||(Fy=1,function(r,e){(function(t,n){r.exports=t()})(function(){var t="object",n="function",i="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],d=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function c(G,oe){var de=typeof G[oe];return de==n||!!(de==t&&G[oe])||de=="unknown"}function f(G,oe){return!!(typeof G[oe]==t&&G[oe])}function v(G,oe){return typeof G[oe]!=i}function g(G){return function(oe,de){for(var ke=de.length;ke--;)if(!G(oe,de[ke]))return!1;return!0}}var y=g(c),b=g(f),x=g(v);function w(G){return G&&y(G,d)&&x(G,l)}function _(G){return f(G,"body")?G.body:G.getElementsByTagName("body")[0]}var C=[].forEach?function(G,oe){G.forEach(oe)}:function(G,oe){for(var de=0,ke=G.length;de<ke;++de)oe(G[de],de)},k={},D=typeof window!=i&&typeof document!=i,R={isHostMethod:c,isHostObject:f,isHostProperty:v,areHostMethods:y,areHostObjects:b,areHostProperties:x,isTextRange:w,getBody:_,forEach:C},$={version:"1.3.2",initialized:!1,isBrowser:D,supported:!0,util:R,features:{},modules:k,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function P(G){typeof console!=i&&c(console,"log")}function I(G,oe){D&&oe?alert(G):P(G)}function W(G){$.initialized=!0,$.supported=!1,I("Rangy is not supported in this environment. Reason: "+G,$.config.alertOnFail)}$.fail=W;function se(G){I("Rangy warning: "+G,$.config.alertOnWarn)}$.warn=se;var q;({}).hasOwnProperty?(R.extend=q=function(G,oe,de){var ke,Ye;for(var Ie in oe)Ie==="__proto__"||Ie==="constructor"||Ie==="prototype"||oe.hasOwnProperty(Ie)&&(ke=G[Ie],Ye=oe[Ie],de&&ke!==null&&typeof ke=="object"&&Ye!==null&&typeof Ye=="object"&&q(ke,Ye,!0),G[Ie]=Ye);return oe.hasOwnProperty("toString")&&(G.toString=oe.toString),G},R.createOptions=function(G,oe){var de={};return q(de,oe),G&&q(de,G),de}):W("hasOwnProperty not supported"),D||W("Rangy can only run in a browser"),function(){var G;if(D){var oe=document.createElement("div");oe.appendChild(document.createElement("span"));var de=[].slice;try{de.call(oe.childNodes,0)[0].nodeType==1&&(G=function(ke){return de.call(ke,0)})}catch{}}G||(G=function(ke){for(var Ye=[],Ie=0,Fe=ke.length;Ie<Fe;++Ie)Ye[Ie]=ke[Ie];return Ye}),R.toArray=G}();var ee;D&&(c(document,"addEventListener")?ee=function(G,oe,de){G.addEventListener(oe,de,!1)}:c(document,"attachEvent")?ee=function(G,oe,de){G.attachEvent("on"+oe,de)}:W("Document does not have required addEventListener or attachEvent method"),R.addListener=ee);var T=[];function z(G){return G.message||G.description||String(G)}function B(){if(!(!D||$.initialized)){var G,oe=!1,de=!1;c(document,"createRange")&&(G=document.createRange(),y(G,s)&&x(G,o)&&(oe=!0));var ke=_(document);if(!ke||ke.nodeName.toLowerCase()!="body"){W("No body element found");return}if(ke&&c(ke,"createTextRange")&&(G=ke.createTextRange(),w(G)&&(de=!0)),!oe&&!de){W("Neither Range nor TextRange are available");return}$.initialized=!0,$.features={implementsDomRange:oe,implementsTextRange:de};var Ye,Ie;for(var Fe in k)(Ye=k[Fe])instanceof Oe&&Ye.init(Ye,$);for(var Ot=0,lt=T.length;Ot<lt;++Ot)try{T[Ot]($)}catch(It){Ie="Rangy init listener threw an exception. Continuing. Detail: "+z(It),P(Ie)}}}function pe(G,oe,de){de&&(G+=" in module "+de.name),$.warn("DEPRECATED: "+G+" is deprecated. Please use "+oe+" instead.")}function Ee(G,oe,de,ke){G[oe]=function(){return pe(oe,de,ke),G[de].apply(G,R.toArray(arguments))}}R.deprecationNotice=pe,R.createAliasForDeprecatedMethod=Ee,$.init=B,$.addInitListener=function(G){$.initialized?G($):T.push(G)};var ye=[];$.addShimListener=function(G){ye.push(G)};function it(G){G=G||window,B();for(var oe=0,de=ye.length;oe<de;++oe)ye[oe](G)}D&&($.shim=$.createMissingNativeApi=it,Ee($,"createMissingNativeApi","shim"));function Oe(G,oe,de){this.name=G,this.dependencies=oe,this.initialized=!1,this.supported=!1,this.initializer=de}Oe.prototype={init:function(){for(var G=this.dependencies||[],oe=0,de=G.length,ke,Ye;oe<de;++oe){if(Ye=G[oe],ke=k[Ye],!ke||!(ke instanceof Oe))throw new Error("required module '"+Ye+"' not found");if(ke.init(),!ke.supported)throw new Error("required module '"+Ye+"' not supported")}this.initializer(this)},fail:function(G){throw this.initialized=!0,this.supported=!1,new Error(G)},warn:function(G){$.warn("Module "+this.name+": "+G)},deprecationNotice:function(G,oe){$.warn("DEPRECATED: "+G+" in module "+this.name+" is deprecated. Please use "+oe+" instead")},createError:function(G){return new Error("Error in Rangy "+this.name+" module: "+G)}};function he(G,oe,de){var ke=new Oe(G,oe,function(Ye){if(!Ye.initialized){Ye.initialized=!0;try{de($,Ye),Ye.supported=!0}catch(Fe){var Ie="Module '"+G+"' failed to load: "+z(Fe);P(Ie),Fe.stack&&P(Fe.stack)}}});return k[G]=ke,ke}$.createModule=function(G){var oe,de;arguments.length==2?(oe=arguments[1],de=[]):(oe=arguments[2],de=arguments[1]);var ke=he(G,de,oe);$.initialized&&$.supported&&ke.init()},$.createCoreModule=function(G,oe,de){he(G,oe,de)};function We(){}$.RangePrototype=We,$.rangePrototype=new We;function Re(){}$.selectionPrototype=new Re,$.createCoreModule("DomUtil",[],function(G,oe){var de="undefined",ke=G.util,Ye=ke.getBody;ke.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||oe.fail("document missing a Node creation method"),ke.isHostMethod(document,"getElementsByTagName")||oe.fail("document missing getElementsByTagName method");var Ie=document.createElement("div");ke.areHostMethods(Ie,["insertBefore","appendChild","cloneNode"])||oe.fail("Incomplete Element implementation"),ke.isHostProperty(Ie,"innerHTML")||oe.fail("Element is missing innerHTML property");var Fe=document.createTextNode("test");ke.areHostMethods(Fe,["splitText","deleteData","insertData","appendData","cloneNode"])||oe.fail("Incomplete Text Node implementation");var Ot=function(_e,Ue){for(var vt=_e.length;vt--;)if(_e[vt]===Ue)return!0;return!1};function lt(_e){var Ue;return typeof _e.namespaceURI==de||(Ue=_e.namespaceURI)===null||Ue=="http://www.w3.org/1999/xhtml"}function It(_e){var Ue=_e.parentNode;return Ue.nodeType==1?Ue:null}function _t(_e){for(var Ue=0;_e=_e.previousSibling;)++Ue;return Ue}function Yt(_e){switch(_e.nodeType){case 7:case 10:return 0;case 3:case 8:return _e.length;default:return _e.childNodes.length}}function Kt(_e,Ue){var vt=[],St;for(St=_e;St;St=St.parentNode)vt.push(St);for(St=Ue;St;St=St.parentNode)if(Ot(vt,St))return St;return null}function Q(_e,Ue,vt){for(var St=vt?Ue:Ue.parentNode;St;){if(St===_e)return!0;St=St.parentNode}return!1}function M(_e,Ue){return Q(_e,Ue,!0)}function H(_e,Ue,vt){for(var St,Ut=vt?_e:_e.parentNode;Ut;){if(St=Ut.parentNode,St===Ue)return Ut;Ut=St}return null}function Z(_e){var Ue=_e.nodeType;return Ue==3||Ue==4||Ue==8}function X(_e){if(!_e)return!1;var Ue=_e.nodeType;return Ue==3||Ue==8}function re(_e,Ue){var vt=Ue.nextSibling,St=Ue.parentNode;return vt?St.insertBefore(_e,vt):St.appendChild(_e),_e}function ne(_e,Ue,vt){var St=_e.cloneNode(!1);if(St.deleteData(0,Ue),_e.deleteData(Ue,_e.length-Ue),re(St,_e),vt)for(var Ut=0,Xt;Xt=vt[Ut++];)Xt.node==_e&&Xt.offset>Ue?(Xt.node=St,Xt.offset-=Ue):Xt.node==_e.parentNode&&Xt.offset>_t(_e)&&++Xt.offset;return St}function ue(_e){if(_e.nodeType==9)return _e;if(typeof _e.ownerDocument!=de)return _e.ownerDocument;if(typeof _e.document!=de)return _e.document;if(_e.parentNode)return ue(_e.parentNode);throw oe.createError("getDocument: no document found for node")}function we(_e){var Ue=ue(_e);if(typeof Ue.defaultView!=de)return Ue.defaultView;if(typeof Ue.parentWindow!=de)return Ue.parentWindow;throw oe.createError("Cannot get a window object for node")}function Se(_e){if(typeof _e.contentDocument!=de)return _e.contentDocument;if(typeof _e.contentWindow!=de)return _e.contentWindow.document;throw oe.createError("getIframeDocument: No Document object found for iframe element")}function Pe(_e){if(typeof _e.contentWindow!=de)return _e.contentWindow;if(typeof _e.contentDocument!=de)return _e.contentDocument.defaultView;throw oe.createError("getIframeWindow: No Window object found for iframe element")}function Je(_e){return _e&&ke.isHostMethod(_e,"setTimeout")&&ke.isHostObject(_e,"document")}function ct(_e,Ue,vt){var St;if(_e?ke.isHostProperty(_e,"nodeType")?St=_e.nodeType==1&&_e.tagName.toLowerCase()=="iframe"?Se(_e):ue(_e):Je(_e)&&(St=_e.document):St=document,!St)throw Ue.createError(vt+"(): Parameter must be a Window object or DOM node");return St}function ht(_e){for(var Ue;Ue=_e.parentNode;)_e=Ue;return _e}function Pt(_e,Ue,vt,St){var Ut,Xt,Zn,gn,Fn;if(_e==vt)return Ue===St?0:Ue<St?-1:1;if(Ut=H(vt,_e,!0))return Ue<=_t(Ut)?-1:1;if(Ut=H(_e,vt,!0))return _t(Ut)<St?-1:1;if(Xt=Kt(_e,vt),!Xt)throw new Error("comparePoints error: nodes have no common ancestor");if(Zn=_e===Xt?Xt:H(_e,Xt,!0),gn=vt===Xt?Xt:H(vt,Xt,!0),Zn===gn)throw oe.createError("comparePoints got to case 4 and childA and childB are the same!");for(Fn=Xt.firstChild;Fn;){if(Fn===Zn)return-1;if(Fn===gn)return 1;Fn=Fn.nextSibling}}var qe=!1;function ut(_e){var Ue;try{return Ue=_e.parentNode,!1}catch{return!0}}(function(){var _e=document.createElement("b");_e.innerHTML="1";var Ue=_e.firstChild;_e.innerHTML="<br />",qe=ut(Ue),G.features.crashyTextNodes=qe})();function Rt(_e){if(!_e)return"[No node]";if(qe&&ut(_e))return"[Broken node]";if(Z(_e))return'"'+_e.data+'"';if(_e.nodeType==1){var Ue=_e.id?' id="'+_e.id+'"':"";return"<"+_e.nodeName+Ue+">[index:"+_t(_e)+",length:"+_e.childNodes.length+"]["+(_e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return _e.nodeName}function ot(_e){for(var Ue=ue(_e).createDocumentFragment(),vt;vt=_e.firstChild;)Ue.appendChild(vt);return Ue}var je;typeof window.getComputedStyle!=de?je=function(_e,Ue){return we(_e).getComputedStyle(_e,null)[Ue]}:typeof document.documentElement.currentStyle!=de?je=function(_e,Ue){return _e.currentStyle?_e.currentStyle[Ue]:""}:oe.fail("No means of obtaining computed style properties found");function De(_e,Ue,vt){var St=Ye(_e),Ut=_e.createElement("div");Ut.contentEditable=""+!!vt,Ue&&(Ut.innerHTML=Ue);var Xt=St.firstChild;return Xt?St.insertBefore(Ut,Xt):St.appendChild(Ut),Ut}function pt(_e){return _e.parentNode.removeChild(_e)}function Ke(_e){this.root=_e,this._next=_e}Ke.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var _e=this._current=this._next,Ue,vt;if(this._current)if(Ue=_e.firstChild,Ue)this._next=Ue;else{for(vt=null;_e!==this.root&&!(vt=_e.nextSibling);)_e=_e.parentNode;this._next=vt}return this._current},detach:function(){this._current=this._next=this.root=null}};function Ze(_e){return new Ke(_e)}function tt(_e,Ue){this.node=_e,this.offset=Ue}tt.prototype={equals:function(_e){return!!_e&&this.node===_e.node&&this.offset==_e.offset},inspect:function(){return"[DomPosition("+Rt(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function wt(_e){this.code=this[_e],this.codeName=_e,this.message="DOMException: "+this.codeName}wt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},wt.prototype.toString=function(){return this.message},G.dom={arrayContains:Ot,isHtmlNamespace:lt,parentElement:It,getNodeIndex:_t,getNodeLength:Yt,getCommonAncestor:Kt,isAncestorOf:Q,isOrIsAncestorOf:M,getClosestAncestorIn:H,isCharacterDataNode:Z,isTextOrCommentNode:X,insertAfter:re,splitDataNode:ne,getDocument:ue,getWindow:we,getIframeWindow:Pe,getIframeDocument:Se,getBody:Ye,isWindow:Je,getContentDocument:ct,getRootContainer:ht,comparePoints:Pt,isBrokenNode:ut,inspectNode:Rt,getComputedStyleProperty:je,createTestElement:De,removeNode:pt,fragmentFromNodeChildren:ot,createIterator:Ze,DomPosition:tt},G.DOMException=wt}),$.createCoreModule("DomRange",["DomUtil"],function(G,oe){var de=G.dom,ke=G.util,Ye=de.DomPosition,Ie=G.DOMException,Fe=de.isCharacterDataNode,Ot=de.getNodeIndex,lt=de.isOrIsAncestorOf,It=de.getDocument,_t=de.comparePoints,Yt=de.splitDataNode,Kt=de.getClosestAncestorIn,Q=de.getNodeLength,M=de.arrayContains,H=de.getRootContainer,Z=G.features.crashyTextNodes,X=de.removeNode;function re(J,N){return J.nodeType!=3&&(lt(J,N.startContainer)||lt(J,N.endContainer))}function ne(J){return J.document||It(J.startContainer)}function ue(J){return H(J.startContainer)}function we(J){return new Ye(J.parentNode,Ot(J))}function Se(J){return new Ye(J.parentNode,Ot(J)+1)}function Pe(J,N,V){var ce=J.nodeType==11?J.firstChild:J;return Fe(N)?V==N.length?de.insertAfter(J,N):N.parentNode.insertBefore(J,V==0?N:Yt(N,V)):V>=N.childNodes.length?N.appendChild(J):N.insertBefore(J,N.childNodes[V]),ce}function Je(J,N,V){if(Zt(J),Zt(N),ne(N)!=ne(J))throw new Ie("WRONG_DOCUMENT_ERR");var ce=_t(J.startContainer,J.startOffset,N.endContainer,N.endOffset),Ce=_t(J.endContainer,J.endOffset,N.startContainer,N.startOffset);return V?ce<=0&&Ce>=0:ce<0&&Ce>0}function ct(J){for(var N,V,ce=ne(J.range).createDocumentFragment(),Ce;V=J.next();){if(N=J.isPartiallySelectedSubtree(),V=V.cloneNode(!N),N&&(Ce=J.getSubtreeIterator(),V.appendChild(ct(Ce)),Ce.detach()),V.nodeType==10)throw new Ie("HIERARCHY_REQUEST_ERR");ce.appendChild(V)}return ce}function ht(J,N,V){var ce,Ce;V=V||{stop:!1};for(var ve,be;ve=J.next();)if(J.isPartiallySelectedSubtree()){if(N(ve)===!1){V.stop=!0;return}else if(be=J.getSubtreeIterator(),ht(be,N,V),be.detach(),V.stop)return}else for(ce=de.createIterator(ve);Ce=ce.next();)if(N(Ce)===!1){V.stop=!0;return}}function Pt(J){for(var N;J.next();)J.isPartiallySelectedSubtree()?(N=J.getSubtreeIterator(),Pt(N),N.detach()):J.remove()}function qe(J){for(var N,V=ne(J.range).createDocumentFragment(),ce;N=J.next();){if(J.isPartiallySelectedSubtree()?(N=N.cloneNode(!1),ce=J.getSubtreeIterator(),N.appendChild(qe(ce)),ce.detach()):J.remove(),N.nodeType==10)throw new Ie("HIERARCHY_REQUEST_ERR");V.appendChild(N)}return V}function ut(J,N,V){var ce=!!(N&&N.length),Ce,ve=!!V;ce&&(Ce=new RegExp("^("+N.join("|")+")$"));var be=[];return ht(new ot(J,!1),function(nt){if(!(ce&&!Ce.test(nt.nodeType))&&!(ve&&!V(nt))){var mt=J.startContainer;if(!(nt==mt&&Fe(mt)&&J.startOffset==mt.length)){var Lt=J.endContainer;nt==Lt&&Fe(Lt)&&J.endOffset==0||be.push(nt)}}}),be}function Rt(J){var N=typeof J.getName>"u"?"Range":J.getName();return"["+N+"("+de.inspectNode(J.startContainer)+":"+J.startOffset+", "+de.inspectNode(J.endContainer)+":"+J.endOffset+")]"}function ot(J,N){if(this.range=J,this.clonePartiallySelectedTextNodes=N,!J.collapsed){this.sc=J.startContainer,this.so=J.startOffset,this.ec=J.endContainer,this.eo=J.endOffset;var V=J.commonAncestorContainer;this.sc===this.ec&&Fe(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===V&&!Fe(this.sc)?this.sc.childNodes[this.so]:Kt(this.sc,V,!0),this._last=this.ec===V&&!Fe(this.ec)?this.ec.childNodes[this.eo-1]:Kt(this.ec,V,!0))}}ot.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var J=this._current=this._next;return J&&(this._next=J!==this._last?J.nextSibling:null,Fe(J)&&this.clonePartiallySelectedTextNodes&&(J===this.ec&&(J=J.cloneNode(!0)).deleteData(this.eo,J.length-this.eo),this._current===this.sc&&(J=J.cloneNode(!0)).deleteData(0,this.so))),J},remove:function(){var J=this._current,N,V;Fe(J)&&(J===this.sc||J===this.ec)?(N=J===this.sc?this.so:0,V=J===this.ec?this.eo:J.length,N!=V&&J.deleteData(N,V-N)):J.parentNode&&X(J)},isPartiallySelectedSubtree:function(){var J=this._current;return re(J,this.range)},getSubtreeIterator:function(){var J;if(this.isSingleCharacterDataNode)J=this.range.cloneRange(),J.collapse(!1);else{J=new pn(ne(this.range));var N=this._current,V=N,ce=0,Ce=N,ve=Q(N);lt(N,this.sc)&&(V=this.sc,ce=this.so),lt(N,this.ec)&&(Ce=this.ec,ve=this.eo),Ft(J,V,ce,Ce,ve)}return new ot(J,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var je=[1,3,4,5,7,8,10],De=[2,9,11],pt=[5,6,10,12],Ke=[1,3,4,5,7,8,10,11],Ze=[1,3,4,5,7,8];function tt(J){return function(N,V){for(var ce,Ce=V?N:N.parentNode;Ce;){if(ce=Ce.nodeType,M(J,ce))return Ce;Ce=Ce.parentNode}return null}}var wt=tt([9,11]),_e=tt(pt),Ue=tt([6,10,12]),vt=tt([1]);function St(J,N){if(Ue(J,N))throw new Ie("INVALID_NODE_TYPE_ERR")}function Ut(J,N){if(!M(N,J.nodeType))throw new Ie("INVALID_NODE_TYPE_ERR")}function Xt(J,N){if(N<0||N>(Fe(J)?J.length:J.childNodes.length))throw new Ie("INDEX_SIZE_ERR")}function Zn(J,N){if(wt(J,!0)!==wt(N,!0))throw new Ie("WRONG_DOCUMENT_ERR")}function gn(J){if(_e(J,!0))throw new Ie("NO_MODIFICATION_ALLOWED_ERR")}function Fn(J,N){if(!J)throw new Ie(N)}function Yr(J,N){return N<=(Fe(J)?J.length:J.childNodes.length)}function Kr(J){return!!J.startContainer&&!!J.endContainer&&!(Z&&(de.isBrokenNode(J.startContainer)||de.isBrokenNode(J.endContainer)))&&H(J.startContainer)==H(J.endContainer)&&Yr(J.startContainer,J.startOffset)&&Yr(J.endContainer,J.endOffset)}function Zt(J){if(!Kr(J))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+J.inspect()+")")}var Mr=document.createElement("style"),Cn=!1;try{Mr.innerHTML="<b>x</b>",Cn=Mr.firstChild.nodeType==3}catch{}G.features.htmlParsingConforms=Cn;var Nr=Cn?function(J){var N=this.startContainer,V=It(N);if(!N)throw new Ie("INVALID_STATE_ERR");var ce=null;return N.nodeType==1?ce=N:Fe(N)&&(ce=de.parentElement(N)),ce===null||ce.nodeName=="HTML"&&de.isHtmlNamespace(It(ce).documentElement)&&de.isHtmlNamespace(ce)?ce=V.createElement("body"):ce=ce.cloneNode(!1),ce.innerHTML=J,de.fragmentFromNodeChildren(ce)}:function(J){var N=ne(this),V=N.createElement("body");return V.innerHTML=J,de.fragmentFromNodeChildren(V)};function si(J,N){Zt(J);var V=J.startContainer,ce=J.startOffset,Ce=J.endContainer,ve=J.endOffset,be=V===Ce;Fe(Ce)&&ve>0&&ve<Ce.length&&Yt(Ce,ve,N),Fe(V)&&ce>0&&ce<V.length&&(V=Yt(V,ce,N),be?(ve-=ce,Ce=V):Ce==V.parentNode&&ve>=Ot(V)&&ve++,ce=0),J.setStartAndEnd(V,ce,Ce,ve)}function Tt(J){Zt(J);var N=J.commonAncestorContainer.parentNode.cloneNode(!1);return N.appendChild(J.cloneContents()),N.innerHTML}var Ti=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Fr=0,zn=1,or=2,ar=3,Ar=0,qr=1,Tr=2,zr=3;ke.extend(G.rangePrototype,{compareBoundaryPoints:function(J,N){Zt(this),Zn(this.startContainer,N.startContainer);var V,ce,Ce,ve,be=J==ar||J==Fr?"start":"end",nt=J==zn||J==Fr?"start":"end";return V=this[be+"Container"],ce=this[be+"Offset"],Ce=N[nt+"Container"],ve=N[nt+"Offset"],_t(V,ce,Ce,ve)},insertNode:function(J){if(Zt(this),Ut(J,Ke),gn(this.startContainer),lt(J,this.startContainer))throw new Ie("HIERARCHY_REQUEST_ERR");var N=Pe(J,this.startContainer,this.startOffset);this.setStartBefore(N)},cloneContents:function(){Zt(this);var J,N;if(this.collapsed)return ne(this).createDocumentFragment();if(this.startContainer===this.endContainer&&Fe(this.startContainer))return J=this.startContainer.cloneNode(!0),J.data=J.data.slice(this.startOffset,this.endOffset),N=ne(this).createDocumentFragment(),N.appendChild(J),N;var V=new ot(this,!0);return J=ct(V),V.detach(),J},canSurroundContents:function(){Zt(this),gn(this.startContainer),gn(this.endContainer);var J=new ot(this,!0),N=J._first&&re(J._first,this)||J._last&&re(J._last,this);return J.detach(),!N},surroundContents:function(J){if(Ut(J,Ze),!this.canSurroundContents())throw new Ie("INVALID_STATE_ERR");var N=this.extractContents();if(J.hasChildNodes())for(;J.lastChild;)J.removeChild(J.lastChild);Pe(J,this.startContainer,this.startOffset),J.appendChild(N),this.selectNode(J)},cloneRange:function(){Zt(this);for(var J=new pn(ne(this)),N=Ti.length,V;N--;)V=Ti[N],J[V]=this[V];return J},toString:function(){Zt(this);var J=this.startContainer;if(J===this.endContainer&&Fe(J))return J.nodeType==3||J.nodeType==4?J.data.slice(this.startOffset,this.endOffset):"";var N=[],V=new ot(this,!0);return ht(V,function(ce){(ce.nodeType==3||ce.nodeType==4)&&N.push(ce.data)}),V.detach(),N.join("")},compareNode:function(J){Zt(this);var N=J.parentNode,V=Ot(J);if(!N)throw new Ie("NOT_FOUND_ERR");var ce=this.comparePoint(N,V),Ce=this.comparePoint(N,V+1);return ce<0?Ce>0?Tr:Ar:Ce>0?qr:zr},comparePoint:function(J,N){return Zt(this),Fn(J,"HIERARCHY_REQUEST_ERR"),Zn(J,this.startContainer),_t(J,N,this.startContainer,this.startOffset)<0?-1:_t(J,N,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Nr,toHtml:function(){return Tt(this)},intersectsNode:function(J,N){if(Zt(this),H(J)!=ue(this))return!1;var V=J.parentNode,ce=Ot(J);if(!V)return!0;var Ce=_t(V,ce,this.endContainer,this.endOffset),ve=_t(V,ce+1,this.startContainer,this.startOffset);return N?Ce<=0&&ve>=0:Ce<0&&ve>0},isPointInRange:function(J,N){return Zt(this),Fn(J,"HIERARCHY_REQUEST_ERR"),Zn(J,this.startContainer),_t(J,N,this.startContainer,this.startOffset)>=0&&_t(J,N,this.endContainer,this.endOffset)<=0},intersectsRange:function(J){return Je(this,J,!1)},intersectsOrTouchesRange:function(J){return Je(this,J,!0)},intersection:function(J){if(this.intersectsRange(J)){var N=_t(this.startContainer,this.startOffset,J.startContainer,J.startOffset),V=_t(this.endContainer,this.endOffset,J.endContainer,J.endOffset),ce=this.cloneRange();return N==-1&&ce.setStart(J.startContainer,J.startOffset),V==1&&ce.setEnd(J.endContainer,J.endOffset),ce}return null},union:function(J){if(this.intersectsOrTouchesRange(J)){var N=this.cloneRange();return _t(J.startContainer,J.startOffset,this.startContainer,this.startOffset)==-1&&N.setStart(J.startContainer,J.startOffset),_t(J.endContainer,J.endOffset,this.endContainer,this.endOffset)==1&&N.setEnd(J.endContainer,J.endOffset),N}else throw new Ie("Ranges do not intersect")},containsNode:function(J,N){return N?this.intersectsNode(J,!1):this.compareNode(J)==zr},containsNodeContents:function(J){return this.comparePoint(J,0)>=0&&this.comparePoint(J,Q(J))<=0},containsRange:function(J){var N=this.intersection(J);return N!==null&&J.equals(N)},containsNodeText:function(J){var N=this.cloneRange();N.selectNode(J);var V=N.getNodes([3]);if(V.length>0){N.setStart(V[0],0);var ce=V.pop();return N.setEnd(ce,ce.length),this.containsRange(N)}else return this.containsNodeContents(J)},getNodes:function(J,N){return Zt(this),ut(this,J,N)},getDocument:function(){return ne(this)},collapseBefore:function(J){this.setEndBefore(J),this.collapse(!1)},collapseAfter:function(J){this.setStartAfter(J),this.collapse(!0)},getBookmark:function(J){var N=ne(this),V=G.createRange(N);J=J||de.getBody(N),V.selectNodeContents(J);var ce=this.intersection(V),Ce=0,ve=0;return ce&&(V.setEnd(ce.startContainer,ce.startOffset),Ce=V.toString().length,ve=Ce+ce.toString().length),{start:Ce,end:ve,containerNode:J}},moveToBookmark:function(J){var N=J.containerNode,V=0;this.setStart(N,0),this.collapse(!0);for(var ce=[N],Ce,ve=!1,be=!1,nt,mt,Lt;!be&&(Ce=ce.pop());)if(Ce.nodeType==3)nt=V+Ce.length,!ve&&J.start>=V&&J.start<=nt&&(this.setStart(Ce,J.start-V),ve=!0),ve&&J.end>=V&&J.end<=nt&&(this.setEnd(Ce,J.end-V),be=!0),V=nt;else for(Lt=Ce.childNodes,mt=Lt.length;mt--;)ce.push(Lt[mt])},getName:function(){return"DomRange"},equals:function(J){return pn.rangesEqual(this,J)},isValid:function(){return Kr(this)},inspect:function(){return Rt(this)},detach:function(){}});function K(J){J.START_TO_START=Fr,J.START_TO_END=zn,J.END_TO_END=or,J.END_TO_START=ar,J.NODE_BEFORE=Ar,J.NODE_AFTER=qr,J.NODE_BEFORE_AND_AFTER=Tr,J.NODE_INSIDE=zr}function me(J){K(J),K(J.prototype)}function Ve(J,N){return function(){Zt(this);var V=this.startContainer,ce=this.startOffset,Ce=this.commonAncestorContainer,ve=new ot(this,!0),be,nt;V!==Ce&&(be=Kt(V,Ce,!0),nt=Se(be),V=nt.node,ce=nt.offset),ht(ve,gn),ve.reset();var mt=J(ve);return ve.detach(),N(this,V,ce,V,ce),mt}}function rt(J,N){function V(be,nt){return function(mt){Ut(mt,je),Ut(H(mt),De);var Lt=(be?we:Se)(mt);(nt?ce:Ce)(this,Lt.node,Lt.offset)}}function ce(be,nt,mt){var Lt=be.endContainer,On=be.endOffset;(nt!==be.startContainer||mt!==be.startOffset)&&((H(nt)!=H(Lt)||_t(nt,mt,Lt,On)==1)&&(Lt=nt,On=mt),N(be,nt,mt,Lt,On))}function Ce(be,nt,mt){var Lt=be.startContainer,On=be.startOffset;(nt!==be.endContainer||mt!==be.endOffset)&&((H(nt)!=H(Lt)||_t(nt,mt,Lt,On)==-1)&&(Lt=nt,On=mt),N(be,Lt,On,nt,mt))}var ve=function(){};ve.prototype=G.rangePrototype,J.prototype=new ve,ke.extend(J.prototype,{setStart:function(be,nt){St(be,!0),Xt(be,nt),ce(this,be,nt)},setEnd:function(be,nt){St(be,!0),Xt(be,nt),Ce(this,be,nt)},setStartAndEnd:function(){var be=arguments,nt=be[0],mt=be[1],Lt=nt,On=mt;switch(be.length){case 3:On=be[2];break;case 4:Lt=be[2],On=be[3];break}St(nt,!0),Xt(nt,mt),St(Lt,!0),Xt(Lt,On),N(this,nt,mt,Lt,On)},setBoundary:function(be,nt,mt){this["set"+(mt?"Start":"End")](be,nt)},setStartBefore:V(!0,!0),setStartAfter:V(!1,!0),setEndBefore:V(!0,!1),setEndAfter:V(!1,!1),collapse:function(be){Zt(this),be?N(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):N(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(be){St(be,!0),N(this,be,0,be,Q(be))},selectNode:function(be){St(be,!1),Ut(be,je);var nt=we(be),mt=Se(be);N(this,nt.node,nt.offset,mt.node,mt.offset)},extractContents:Ve(qe,N),deleteContents:Ve(Pt,N),canSurroundContents:function(){Zt(this),gn(this.startContainer),gn(this.endContainer);var be=new ot(this,!0),nt=be._first&&re(be._first,this)||be._last&&re(be._last,this);return be.detach(),!nt},splitBoundaries:function(){si(this)},splitBoundariesPreservingPositions:function(be){si(this,be)},normalizeBoundaries:function(){Zt(this);var be=this.startContainer,nt=this.startOffset,mt=this.endContainer,Lt=this.endOffset,On=function(mn){var Wr=mn.nextSibling;Wr&&Wr.nodeType==mn.nodeType&&(mt=mn,Lt=mn.length,mn.appendData(Wr.data),X(Wr))},Os=function(mn){var Wr=mn.previousSibling;if(Wr&&Wr.nodeType==mn.nodeType){be=mn;var Zl=mn.length;if(nt=Wr.length,mn.insertData(0,Wr.data),X(Wr),be==mt)Lt+=nt,mt=be;else if(mt==mn.parentNode){var ao=Ot(mn);Lt==ao?(mt=mn,Lt=Zl):Lt>ao&&Lt--}}},Bt=!0,Dr;if(Fe(mt))Lt==mt.length?On(mt):Lt==0&&(Dr=mt.previousSibling,Dr&&Dr.nodeType==mt.nodeType&&(Lt=Dr.length,be==mt&&(Bt=!1),Dr.appendData(mt.data),X(mt),mt=Dr));else{if(Lt>0){var fa=mt.childNodes[Lt-1];fa&&Fe(fa)&&On(fa)}Bt=!this.collapsed}if(Bt){if(Fe(be))nt==0?Os(be):nt==be.length&&(Dr=be.nextSibling,Dr&&Dr.nodeType==be.nodeType&&(mt==Dr&&(mt=be,Lt+=be.length),be.appendData(Dr.data),X(Dr)));else if(nt<be.childNodes.length){var oo=be.childNodes[nt];oo&&Fe(oo)&&Os(oo)}}else be=mt,nt=Lt;N(this,be,nt,mt,Lt)},collapseToPoint:function(be,nt){St(be,!0),Xt(be,nt),this.setStartAndEnd(be,nt)},parentElement:function(){Zt(this);var be=this.commonAncestorContainer;return be?vt(this.commonAncestorContainer,!0):null}}),me(J)}function Xe(J){J.collapsed=J.startContainer===J.endContainer&&J.startOffset===J.endOffset,J.commonAncestorContainer=J.collapsed?J.startContainer:de.getCommonAncestor(J.startContainer,J.endContainer)}function Ft(J,N,V,ce,Ce){J.startContainer=N,J.startOffset=V,J.endContainer=ce,J.endOffset=Ce,J.document=de.getDocument(N),Xe(J)}function pn(J){Ft(this,J,0,J,0)}rt(pn,Ft),ke.extend(pn,{rangeProperties:Ti,RangeIterator:ot,copyComparisonConstants:me,createPrototypeRange:rt,inspect:Rt,toHtml:Tt,getRangeDocument:ne,rangesEqual:function(J,N){return J.startContainer===N.startContainer&&J.startOffset===N.startOffset&&J.endContainer===N.endContainer&&J.endOffset===N.endOffset}}),G.DomRange=pn}),$.createCoreModule("WrappedRange",["DomRange"],function(G,oe){var de,ke,Ye=G.dom,Ie=G.util,Fe=Ye.DomPosition,Ot=G.DomRange,lt=Ye.getBody,It=Ye.getContentDocument,_t=Ye.isCharacterDataNode;if(G.features.implementsDomRange&&function(){var X,re=Ot.rangeProperties;function ne(qe){for(var ut=re.length,Rt;ut--;)Rt=re[ut],qe[Rt]=qe.nativeRange[Rt];qe.collapsed=qe.startContainer===qe.endContainer&&qe.startOffset===qe.endOffset}function ue(qe,ut,Rt,ot,je){var De=qe.startContainer!==ut||qe.startOffset!=Rt,pt=qe.endContainer!==ot||qe.endOffset!=je,Ke=!qe.equals(qe.nativeRange);(De||pt||Ke)&&(qe.setEnd(ot,je),qe.setStart(ut,Rt))}var we;de=function(qe){if(!qe)throw oe.createError("WrappedRange: Range must be specified");this.nativeRange=qe,ne(this)},Ot.createPrototypeRange(de,ue),X=de.prototype,X.selectNode=function(qe){this.nativeRange.selectNode(qe),ne(this)},X.cloneContents=function(){return this.nativeRange.cloneContents()},X.surroundContents=function(qe){this.nativeRange.surroundContents(qe),ne(this)},X.collapse=function(qe){this.nativeRange.collapse(qe),ne(this)},X.cloneRange=function(){return new de(this.nativeRange.cloneRange())},X.refresh=function(){ne(this)},X.toString=function(){return this.nativeRange.toString()};var Se=document.createTextNode("test");lt(document).appendChild(Se);var Pe=document.createRange();Pe.setStart(Se,0),Pe.setEnd(Se,0);try{Pe.setStart(Se,1),X.setStart=function(qe,ut){this.nativeRange.setStart(qe,ut),ne(this)},X.setEnd=function(qe,ut){this.nativeRange.setEnd(qe,ut),ne(this)},we=function(qe){return function(ut){this.nativeRange[qe](ut),ne(this)}}}catch{X.setStart=function(ut,Rt){try{this.nativeRange.setStart(ut,Rt)}catch{this.nativeRange.setEnd(ut,Rt),this.nativeRange.setStart(ut,Rt)}ne(this)},X.setEnd=function(ut,Rt){try{this.nativeRange.setEnd(ut,Rt)}catch{this.nativeRange.setStart(ut,Rt),this.nativeRange.setEnd(ut,Rt)}ne(this)},we=function(ut,Rt){return function(ot){try{this.nativeRange[ut](ot)}catch{this.nativeRange[Rt](ot),this.nativeRange[ut](ot)}ne(this)}}}X.setStartBefore=we("setStartBefore","setEndBefore"),X.setStartAfter=we("setStartAfter","setEndAfter"),X.setEndBefore=we("setEndBefore","setStartBefore"),X.setEndAfter=we("setEndAfter","setStartAfter"),X.selectNodeContents=function(qe){this.setStartAndEnd(qe,0,Ye.getNodeLength(qe))},Pe.selectNodeContents(Se),Pe.setEnd(Se,3);var Je=document.createRange();Je.selectNodeContents(Se),Je.setEnd(Se,4),Je.setStart(Se,2),Pe.compareBoundaryPoints(Pe.START_TO_END,Je)==-1&&Pe.compareBoundaryPoints(Pe.END_TO_START,Je)==1?X.compareBoundaryPoints=function(qe,ut){return ut=ut.nativeRange||ut,qe==ut.START_TO_END?qe=ut.END_TO_START:qe==ut.END_TO_START&&(qe=ut.START_TO_END),this.nativeRange.compareBoundaryPoints(qe,ut)}:X.compareBoundaryPoints=function(qe,ut){return this.nativeRange.compareBoundaryPoints(qe,ut.nativeRange||ut)};var ct=document.createElement("div");ct.innerHTML="123";var ht=ct.firstChild,Pt=lt(document);Pt.appendChild(ct),Pe.setStart(ht,1),Pe.setEnd(ht,2),Pe.deleteContents(),ht.data=="13"&&(X.deleteContents=function(){this.nativeRange.deleteContents(),ne(this)},X.extractContents=function(){var qe=this.nativeRange.extractContents();return ne(this),qe}),Pt.removeChild(ct),Pt=null,Ie.isHostMethod(Pe,"createContextualFragment")&&(X.createContextualFragment=function(qe){return this.nativeRange.createContextualFragment(qe)}),lt(document).removeChild(Se),X.getName=function(){return"WrappedRange"},G.WrappedRange=de,G.createNativeRange=function(qe){return qe=It(qe,oe,"createNativeRange"),qe.createRange()}}(),G.features.implementsTextRange){var Yt=function(X){var re=X.parentElement(),ne=X.duplicate();ne.collapse(!0);var ue=ne.parentElement();ne=X.duplicate(),ne.collapse(!1);var we=ne.parentElement(),Se=ue==we?ue:Ye.getCommonAncestor(ue,we);return Se==re?Se:Ye.getCommonAncestor(re,Se)},Kt=function(X){return X.compareEndPoints("StartToEnd",X)==0},Q=function(X,re,ne,ue,we){var Se=X.duplicate();Se.collapse(ne);var Pe=Se.parentElement();if(Ye.isOrIsAncestorOf(re,Pe)||(Pe=re),!Pe.canHaveHTML){var Je=new Fe(Pe.parentNode,Ye.getNodeIndex(Pe));return{boundaryPosition:Je,nodeInfo:{nodeIndex:Je.offset,containerElement:Je.node}}}var ct=Ye.getDocument(Pe).createElement("span");ct.parentNode&&Ye.removeNode(ct);for(var ht,Pt=ne?"StartToStart":"StartToEnd",qe,ut,Rt,ot,je=we&&we.containerElement==Pe?we.nodeIndex:0,De=Pe.childNodes.length,pt=De,Ke=pt;Ke==De?Pe.appendChild(ct):Pe.insertBefore(ct,Pe.childNodes[Ke]),Se.moveToElementText(ct),ht=Se.compareEndPoints(Pt,X),!(ht==0||je==pt);){if(ht==-1){if(pt==je+1)break;je=Ke}else pt=pt==je+1?je:Ke;Ke=Math.floor((je+pt)/2),Pe.removeChild(ct)}if(ot=ct.nextSibling,ht==-1&&ot&&_t(ot)){Se.setEndPoint(ne?"EndToStart":"EndToEnd",X);var Ze;if(/[\r\n]/.test(ot.data)){var tt=Se.duplicate(),wt=tt.text.replace(/\r\n/g,"\r").length;for(Ze=tt.moveStart("character",wt);(ht=tt.compareEndPoints("StartToEnd",tt))==-1;)Ze++,tt.moveStart("character",1)}else Ze=Se.text.length;Rt=new Fe(ot,Ze)}else qe=(ue||!ne)&&ct.previousSibling,ut=(ue||ne)&&ct.nextSibling,ut&&_t(ut)?Rt=new Fe(ut,0):qe&&_t(qe)?Rt=new Fe(qe,qe.data.length):Rt=new Fe(Pe,Ye.getNodeIndex(ct));return Ye.removeNode(ct),{boundaryPosition:Rt,nodeInfo:{nodeIndex:Ke,containerElement:Pe}}},M=function(X,re){var ne,ue,we=X.offset,Se=Ye.getDocument(X.node),Pe,Je,ct=lt(Se).createTextRange(),ht=_t(X.node);return ht?(ne=X.node,ue=ne.parentNode):(Je=X.node.childNodes,ne=we<Je.length?Je[we]:null,ue=X.node),Pe=Se.createElement("span"),Pe.innerHTML="&#feff;",ne?ue.insertBefore(Pe,ne):ue.appendChild(Pe),ct.moveToElementText(Pe),ct.collapse(!re),ue.removeChild(Pe),ht&&ct[re?"moveStart":"moveEnd"]("character",we),ct};ke=function(X){this.textRange=X,this.refresh()},ke.prototype=new Ot(document),ke.prototype.refresh=function(){var X,re,ne,ue=Yt(this.textRange);Kt(this.textRange)?re=X=Q(this.textRange,ue,!0,!0).boundaryPosition:(ne=Q(this.textRange,ue,!0,!1),X=ne.boundaryPosition,re=Q(this.textRange,ue,!1,!1,ne.nodeInfo).boundaryPosition),this.setStart(X.node,X.offset),this.setEnd(re.node,re.offset)},ke.prototype.getName=function(){return"WrappedTextRange"},Ot.copyComparisonConstants(ke);var H=function(X){if(X.collapsed)return M(new Fe(X.startContainer,X.startOffset),!0);var re=M(new Fe(X.startContainer,X.startOffset),!0),ne=M(new Fe(X.endContainer,X.endOffset),!1),ue=lt(Ot.getRangeDocument(X)).createTextRange();return ue.setEndPoint("StartToStart",re),ue.setEndPoint("EndToEnd",ne),ue};if(ke.rangeToTextRange=H,ke.prototype.toTextRange=function(){return H(this)},G.WrappedTextRange=ke,!G.features.implementsDomRange||G.config.preferTextRange){var Z=function(X){return X("return this;")()}(Function);typeof Z.Range>"u"&&(Z.Range=ke),G.createNativeRange=function(X){return X=It(X,oe,"createNativeRange"),lt(X).createTextRange()},G.WrappedRange=ke}}G.createRange=function(X){return X=It(X,oe,"createRange"),new G.WrappedRange(G.createNativeRange(X))},G.createRangyRange=function(X){return X=It(X,oe,"createRangyRange"),new Ot(X)},Ie.createAliasForDeprecatedMethod(G,"createIframeRange","createRange"),Ie.createAliasForDeprecatedMethod(G,"createIframeRangyRange","createRangyRange"),G.addShimListener(function(X){var re=X.document;typeof re.createRange>"u"&&(re.createRange=function(){return G.createRange(re)}),re=X=null})}),$.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(G,oe){G.config.checkSelectionRanges=!0;var de="boolean",ke="number",Ye=G.dom,Ie=G.util,Fe=Ie.isHostMethod,Ot=G.DomRange,lt=G.WrappedRange,It=G.DOMException,_t=Ye.DomPosition,Yt,Kt,Q=G.features,M="Control",H=Ye.getDocument,Z=Ye.getBody,X=Ot.rangesEqual;function re(K){return typeof K=="string"?/^backward(s)?$/i.test(K):!!K}function ne(K,me){if(K){if(Ye.isWindow(K))return K;if(K instanceof Zt)return K.win;var Ve=Ye.getContentDocument(K,oe,me);return Ye.getWindow(Ve)}else return window}function ue(K){return ne(K,"getWinSelection").getSelection()}function we(K){return ne(K,"getDocSelection").document.selection}function Se(K){var me=!1;return K.anchorNode&&(me=Ye.comparePoints(K.anchorNode,K.anchorOffset,K.focusNode,K.focusOffset)==1),me}var Pe=Fe(window,"getSelection"),Je=Ie.isHostObject(document,"selection");Q.implementsWinGetSelection=Pe,Q.implementsDocSelection=Je;var ct=Je&&(!Pe||G.config.preferTextRange);if(ct)Yt=we,G.isSelectionValid=function(K){var me=ne(K,"isSelectionValid").document,Ve=me.selection;return Ve.type!="None"||H(Ve.createRange().parentElement())==me};else if(Pe)Yt=ue,G.isSelectionValid=function(){return!0};else return oe.fail("Neither document.selection or window.getSelection() detected."),!1;G.getNativeSelection=Yt;var ht=Yt();if(!ht)return oe.fail("Native selection was null (possibly issue 138?)"),!1;var Pt=G.createNativeRange(document),qe=Z(document),ut=Ie.areHostProperties(ht,["anchorNode","focusNode","anchorOffset","focusOffset"]);Q.selectionHasAnchorAndFocus=ut;var Rt=Fe(ht,"extend");Q.selectionHasExtend=Rt;var ot=Fe(ht,"setBaseAndExtent");Q.selectionHasSetBaseAndExtent=ot;var je=typeof ht.rangeCount==ke;Q.selectionHasRangeCount=je;var De=!1,pt=!0,Ke=Rt?function(K,me){var Ve=Ot.getRangeDocument(me),rt=G.createRange(Ve);rt.collapseToPoint(me.endContainer,me.endOffset),K.addRange(St(rt)),K.extend(me.startContainer,me.startOffset)}:null;Ie.areHostMethods(ht,["addRange","getRangeAt","removeAllRanges"])&&typeof ht.rangeCount==ke&&Q.implementsDomRange&&function(){var K=window.getSelection();if(K){for(var me=K.rangeCount,Ve=me>1,rt=[],Xe=Se(K),Ft=0;Ft<me;++Ft)rt[Ft]=K.getRangeAt(Ft);var pn=Ye.createTestElement(document,"",!1),J=pn.appendChild(document.createTextNode("   ")),N=document.createRange();if(N.setStart(J,1),N.collapse(!0),K.removeAllRanges(),K.addRange(N),pt=K.rangeCount==1,K.removeAllRanges(),!Ve){var V=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(V&&parseInt(V[1])>=36)De=!1;else{var ce=N.cloneRange();N.setStart(J,0),ce.setEnd(J,3),ce.setStart(J,2),K.addRange(N),K.addRange(ce),De=K.rangeCount==2}}for(Ye.removeNode(pn),K.removeAllRanges(),Ft=0;Ft<me;++Ft)Ft==0&&Xe?Ke?Ke(K,rt[Ft]):(G.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),K.addRange(rt[Ft])):K.addRange(rt[Ft])}}(),Q.selectionSupportsMultipleRanges=De,Q.collapsedNonEditableSelectionsSupported=pt;var Ze=!1,tt;qe&&Fe(qe,"createControlRange")&&(tt=qe.createControlRange(),Ie.areHostProperties(tt,["item","add"])&&(Ze=!0)),Q.implementsControlRange=Ze,ut?Kt=function(K){return K.anchorNode===K.focusNode&&K.anchorOffset===K.focusOffset}:Kt=function(K){return K.rangeCount?K.getRangeAt(K.rangeCount-1).collapsed:!1};function wt(K,me,Ve){var rt=Ve?"end":"start",Xe=Ve?"start":"end";K.anchorNode=me[rt+"Container"],K.anchorOffset=me[rt+"Offset"],K.focusNode=me[Xe+"Container"],K.focusOffset=me[Xe+"Offset"]}function _e(K){var me=K.nativeSelection;K.anchorNode=me.anchorNode,K.anchorOffset=me.anchorOffset,K.focusNode=me.focusNode,K.focusOffset=me.focusOffset}function Ue(K){K.anchorNode=K.focusNode=null,K.anchorOffset=K.focusOffset=0,K.rangeCount=0,K.isCollapsed=!0,K._ranges.length=0,vt(K)}function vt(K){K.type=K.rangeCount==0?"None":Kt(K)?"Caret":"Range"}function St(K){var me;return K instanceof Ot?(me=G.createNativeRange(K.getDocument()),me.setEnd(K.endContainer,K.endOffset),me.setStart(K.startContainer,K.startOffset)):K instanceof lt?me=K.nativeRange:Q.implementsDomRange&&K instanceof Ye.getWindow(K.startContainer).Range&&(me=K),me}function Ut(K){if(!K.length||K[0].nodeType!=1)return!1;for(var me=1,Ve=K.length;me<Ve;++me)if(!Ye.isAncestorOf(K[0],K[me]))return!1;return!0}function Xt(K){var me=K.getNodes();if(!Ut(me))throw oe.createError("getSingleElementFromRange: range "+K.inspect()+" did not consist of a single element");return me[0]}function Zn(K){return!!K&&typeof K.text<"u"}function gn(K,me){var Ve=new lt(me);K._ranges=[Ve],wt(K,Ve,!1),K.rangeCount=1,K.isCollapsed=Ve.collapsed,vt(K)}function Fn(K){if(K._ranges.length=0,K.docSelection.type=="None")Ue(K);else{var me=K.docSelection.createRange();if(Zn(me))gn(K,me);else{K.rangeCount=me.length;for(var Ve,rt=H(me.item(0)),Xe=0;Xe<K.rangeCount;++Xe)Ve=G.createRange(rt),Ve.selectNode(me.item(Xe)),K._ranges.push(Ve);K.isCollapsed=K.rangeCount==1&&K._ranges[0].collapsed,wt(K,K._ranges[K.rangeCount-1],!1),vt(K)}}}function Yr(K,me){for(var Ve=K.docSelection.createRange(),rt=Xt(me),Xe=H(Ve.item(0)),Ft=Z(Xe).createControlRange(),pn=0,J=Ve.length;pn<J;++pn)Ft.add(Ve.item(pn));try{Ft.add(rt)}catch{throw oe.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Ft.select(),Fn(K)}var Kr;Fe(ht,"getRangeAt")?Kr=function(K,me){try{return K.getRangeAt(me)}catch{return null}}:ut&&(Kr=function(K){var me=H(K.anchorNode),Ve=G.createRange(me);return Ve.setStartAndEnd(K.anchorNode,K.anchorOffset,K.focusNode,K.focusOffset),Ve.collapsed!==this.isCollapsed&&Ve.setStartAndEnd(K.focusNode,K.focusOffset,K.anchorNode,K.anchorOffset),Ve});function Zt(K,me,Ve){this.nativeSelection=K,this.docSelection=me,this._ranges=[],this.win=Ve,this.refresh()}Zt.prototype=G.selectionPrototype;function Mr(K){K.win=K.anchorNode=K.focusNode=K._ranges=null,K.rangeCount=K.anchorOffset=K.focusOffset=0,K.detached=!0,vt(K)}var Cn=[];function Nr(K,me){for(var Ve=Cn.length,rt,Xe;Ve--;)if(rt=Cn[Ve],Xe=rt.selection,me=="deleteAll")Mr(Xe);else if(rt.win==K)return me=="delete"?(Cn.splice(Ve,1),!0):Xe;return me=="deleteAll"&&(Cn.length=0),null}var si=function(K){if(K&&K instanceof Zt)return K.refresh(),K;K=ne(K,"getNativeSelection");var me=Nr(K),Ve=Yt(K),rt=Je?we(K):null;return me?(me.nativeSelection=Ve,me.docSelection=rt,me.refresh()):(me=new Zt(Ve,rt,K),Cn.push({win:K,selection:me})),me};G.getSelection=si,Ie.createAliasForDeprecatedMethod(G,"getIframeSelection","getSelection");var Tt=Zt.prototype;function Ti(K,me){for(var Ve=H(me[0].startContainer),rt=Z(Ve).createControlRange(),Xe=0,Ft,pn=me.length;Xe<pn;++Xe){Ft=Xt(me[Xe]);try{rt.add(Ft)}catch{throw oe.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}rt.select(),Fn(K)}if(!ct&&ut&&Ie.areHostMethods(ht,["removeAllRanges","addRange"])){Tt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Ue(this)};var Fr=function(K,me){Ke(K.nativeSelection,me),K.refresh()};je?Tt.addRange=function(K,me){if(Ze&&Je&&this.docSelection.type==M)Yr(this,K);else if(re(me)&&Rt)Fr(this,K);else{var Ve;De?Ve=this.rangeCount:(this.removeAllRanges(),Ve=0);var rt=St(K).cloneRange();try{this.nativeSelection.addRange(rt)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Ve+1){if(G.config.checkSelectionRanges){var Xe=Kr(this.nativeSelection,this.rangeCount-1);Xe&&!X(Xe,K)&&(K=new lt(Xe))}this._ranges[this.rangeCount-1]=K,wt(this,K,ar(this.nativeSelection)),this.isCollapsed=Kt(this),vt(this)}else this.refresh()}}:Tt.addRange=function(K,me){re(me)&&Rt?Fr(this,K):(this.nativeSelection.addRange(St(K)),this.refresh())},Tt.setRanges=function(K){if(Ze&&Je&&K.length>1)Ti(this,K);else{this.removeAllRanges();for(var me=0,Ve=K.length;me<Ve;++me)this.addRange(K[me])}}}else if(Fe(ht,"empty")&&Fe(Pt,"select")&&Ze&&ct)Tt.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var K;if(this.anchorNode)K=H(this.anchorNode);else if(this.docSelection.type==M){var me=this.docSelection.createRange();me.length&&(K=H(me.item(0)))}if(K){var Ve=Z(K).createTextRange();Ve.select(),this.docSelection.empty()}}}catch{}Ue(this)},Tt.addRange=function(K){this.docSelection.type==M?Yr(this,K):(G.WrappedTextRange.rangeToTextRange(K).select(),this._ranges[0]=K,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,wt(this,K,!1),vt(this))},Tt.setRanges=function(K){this.removeAllRanges();var me=K.length;me>1?Ti(this,K):me&&this.addRange(K[0])};else return oe.fail("No means of selecting a Range or TextRange was found"),!1;Tt.getRangeAt=function(K){if(K<0||K>=this.rangeCount)throw new It("INDEX_SIZE_ERR");return this._ranges[K].cloneRange()};var zn;if(ct)zn=function(K){var me;G.isSelectionValid(K.win)?me=K.docSelection.createRange():(me=Z(K.win.document).createTextRange(),me.collapse(!0)),K.docSelection.type==M?Fn(K):Zn(me)?gn(K,me):Ue(K)};else if(Fe(ht,"getRangeAt")&&typeof ht.rangeCount==ke)zn=function(K){if(Ze&&Je&&K.docSelection.type==M)Fn(K);else if(K._ranges.length=K.rangeCount=K.nativeSelection.rangeCount,K.rangeCount){for(var me=0,Ve=K.rangeCount;me<Ve;++me)K._ranges[me]=new G.WrappedRange(K.nativeSelection.getRangeAt(me));wt(K,K._ranges[K.rangeCount-1],ar(K.nativeSelection)),K.isCollapsed=Kt(K),vt(K)}else Ue(K)};else if(ut&&typeof ht.isCollapsed==de&&typeof Pt.collapsed==de&&Q.implementsDomRange)zn=function(K){var me,Ve=K.nativeSelection;Ve.anchorNode?(me=Kr(Ve,0),K._ranges=[me],K.rangeCount=1,_e(K),K.isCollapsed=Kt(K),vt(K)):Ue(K)};else return oe.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Tt.refresh=function(K){var me=K?this._ranges.slice(0):null,Ve=this.anchorNode,rt=this.anchorOffset;if(zn(this),K){var Xe=me.length;if(Xe!=this._ranges.length||this.anchorNode!=Ve||this.anchorOffset!=rt)return!0;for(;Xe--;)if(!X(me[Xe],this._ranges[Xe]))return!0;return!1}};var or=function(K,me){var Ve=K.getAllRanges();K.removeAllRanges();for(var rt=0,Xe=Ve.length;rt<Xe;++rt)X(me,Ve[rt])||K.addRange(Ve[rt]);K.rangeCount||Ue(K)};Ze&&Je?Tt.removeRange=function(K){if(this.docSelection.type==M){for(var me=this.docSelection.createRange(),Ve=Xt(K),rt=H(me.item(0)),Xe=Z(rt).createControlRange(),Ft,pn=!1,J=0,N=me.length;J<N;++J)Ft=me.item(J),Ft!==Ve||pn?Xe.add(me.item(J)):pn=!0;Xe.select(),Fn(this)}else or(this,K)}:Tt.removeRange=function(K){or(this,K)};var ar;!ct&&ut&&Q.implementsDomRange?(ar=Se,Tt.isBackward=function(){return ar(this)}):ar=Tt.isBackward=function(){return!1},Tt.isBackwards=Tt.isBackward,Tt.toString=function(){for(var K=[],me=0,Ve=this.rangeCount;me<Ve;++me)K[me]=""+this._ranges[me];return K.join("")};function Ar(K,me){if(K.win.document!=H(me))throw new It("WRONG_DOCUMENT_ERR")}function qr(K,me){if(me<0||me>(Ye.isCharacterDataNode(K)?K.length:K.childNodes.length))throw new It("INDEX_SIZE_ERR")}Tt.collapse=function(K,me){Ar(this,K);var Ve=G.createRange(K);Ve.collapseToPoint(K,me),this.setSingleRange(Ve),this.isCollapsed=!0},Tt.collapseToStart=function(){if(this.rangeCount){var K=this._ranges[0];this.collapse(K.startContainer,K.startOffset)}else throw new It("INVALID_STATE_ERR")},Tt.collapseToEnd=function(){if(this.rangeCount){var K=this._ranges[this.rangeCount-1];this.collapse(K.endContainer,K.endOffset)}else throw new It("INVALID_STATE_ERR")},Tt.selectAllChildren=function(K){Ar(this,K);var me=G.createRange(K);me.selectNodeContents(K),this.setSingleRange(me)},ot?Tt.setBaseAndExtent=function(K,me,Ve,rt){this.nativeSelection.setBaseAndExtent(K,me,Ve,rt),this.refresh()}:Rt&&(Tt.setBaseAndExtent=function(K,me,Ve,rt){qr(K,me),qr(Ve,rt),Ar(this,K),Ar(this,Ve);var Xe=G.createRange(node),Ft=Ye.comparePoints(K,me,Ve,rt)==-1;Ft?Xe.setStartAndEnd(Ve,rt,K,me):Xe.setStartAndEnd(K,me,Ve,rt),this.setSingleRange(Xe,Ft)}),Tt.deleteFromDocument=function(){if(Ze&&Je&&this.docSelection.type==M){for(var K=this.docSelection.createRange(),me;K.length;)me=K.item(0),K.remove(me),Ye.removeNode(me);this.refresh()}else if(this.rangeCount){var Ve=this.getAllRanges();if(Ve.length){this.removeAllRanges();for(var rt=0,Xe=Ve.length;rt<Xe;++rt)Ve[rt].deleteContents();this.addRange(Ve[Xe-1])}}},Tt.eachRange=function(K,me){for(var Ve=0,rt=this._ranges.length;Ve<rt;++Ve)if(K(this.getRangeAt(Ve)))return me},Tt.getAllRanges=function(){var K=[];return this.eachRange(function(me){K.push(me)}),K},Tt.setSingleRange=function(K,me){this.removeAllRanges(),this.addRange(K,me)},Tt.callMethodOnEachRange=function(K,me){var Ve=[];return this.eachRange(function(rt){Ve.push(rt[K].apply(rt,me||[]))}),Ve};function Tr(K){return function(me,Ve){var rt;this.rangeCount?(rt=this.getRangeAt(0),rt["set"+(K?"Start":"End")](me,Ve)):(rt=G.createRange(this.win.document),rt.setStartAndEnd(me,Ve)),this.setSingleRange(rt,this.isBackward())}}Tt.setStart=Tr(!0),Tt.setEnd=Tr(!1),G.rangePrototype.select=function(K){si(this.getDocument()).setSingleRange(this,K)},Tt.changeEachRange=function(K){var me=[],Ve=this.isBackward();this.eachRange(function(rt){K(rt),me.push(rt)}),this.removeAllRanges(),Ve&&me.length==1?this.addRange(me[0],"backward"):this.setRanges(me)},Tt.containsNode=function(K,me){return this.eachRange(function(Ve){return Ve.containsNode(K,me)},!0)||!1},Tt.getBookmark=function(K){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[K])}},Tt.moveToBookmark=function(K){for(var me=[],Ve=0,rt,Xe;rt=K.rangeBookmarks[Ve++];)Xe=G.createRange(this.win),Xe.moveToBookmark(rt),me.push(Xe);K.backward?this.setSingleRange(me[0],"backward"):this.setRanges(me)},Tt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Tt.restoreRanges=function(K){this.removeAllRanges();for(var me=0,Ve;Ve=K.ranges[me];++me)this.addRange(Ve,K.backward&&me==0)},Tt.toHtml=function(){var K=[];return this.eachRange(function(me){K.push(Ot.toHtml(me))}),K.join("")},Q.implementsTextRange&&(Tt.getNativeTextRange=function(){var K;if(K=this.docSelection){var me=K.createRange();if(Zn(me))return me;throw oe.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return G.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw oe.createError("getNativeTextRange: selection contains no range")}});function zr(K){var me=[],Ve=new _t(K.anchorNode,K.anchorOffset),rt=new _t(K.focusNode,K.focusOffset),Xe=typeof K.getName=="function"?K.getName():"Selection";if(typeof K.rangeCount<"u")for(var Ft=0,pn=K.rangeCount;Ft<pn;++Ft)me[Ft]=Ot.inspect(K.getRangeAt(Ft));return"["+Xe+"(Ranges: "+me.join(", ")+")(anchor: "+Ve.inspect()+", focus: "+rt.inspect()+"]"}Tt.getName=function(){return"WrappedSelection"},Tt.inspect=function(){return zr(this)},Tt.detach=function(){Nr(this.win,"delete"),Mr(this)},Zt.detachAll=function(){Nr(null,"deleteAll")},Zt.inspect=zr,Zt.isDirectionBackward=re,G.Selection=Zt,G.selectionPrototype=Tt,G.addShimListener(function(K){typeof K.getSelection>"u"&&(K.getSelection=function(){return si(K)}),K=null})});var Ge=!1,le=function(G){Ge||(Ge=!0,!$.initialized&&$.config.autoInitialize&&B())};return D&&(document.readyState=="complete"?le():(c(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",le,!1),ee(window,"load",le))),$})}(Ff)),Ff.exports}var _5=dS();const zy=fs(_5);var zf={exports:{}},Wy;function b5(){return Wy||(Wy=1,function(r,e){(function(t,n){r.exports=t(dS())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(n,i){var o=n.dom,s=o.DomPosition,l=o.arrayContains,d=n.util,c=d.forEach,f="span",v=d.isHostMethod(document,"createElementNS");function g(Q,M){for(var H in Q)if(Q.hasOwnProperty(H)&&M(H,Q[H])===!1)return!1;return!0}function y(Q){return Q.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function b(Q,M){return!!Q&&new RegExp("(?:^|\\s)"+M+"(?:\\s|$)").test(Q)}function x(Q,M){if(typeof Q.classList=="object")return Q.classList.contains(M);var H=typeof Q.className=="string",Z=H?Q.className:Q.getAttribute("class");return b(Z,M)}function w(Q,M){if(typeof Q.classList=="object")Q.classList.add(M);else{var H=typeof Q.className=="string",Z=H?Q.className:Q.getAttribute("class");Z?b(Z,M)||(Z+=" "+M):Z=M,H?Q.className=Z:Q.setAttribute("class",Z)}}var _=function(){function Q(M,H,Z){return H&&Z?" ":""}return function(M,H){if(typeof M.classList=="object")M.classList.remove(H);else{var Z=typeof M.className=="string",X=Z?M.className:M.getAttribute("class");X=X.replace(new RegExp("(^|\\s)"+H+"(\\s|$)"),Q),Z?M.className=X:M.setAttribute("class",X)}}}();function C(Q){var M=typeof Q.className=="string";return M?Q.className:Q.getAttribute("class")}function k(Q){return Q&&Q.split(/\s+/).sort().join(" ")}function D(Q){return k(C(Q))}function R(Q,M){return D(Q)==D(M)}function $(Q,M){for(var H=M.split(/\s+/),Z=0,X=H.length;Z<X;++Z)if(!x(Q,y(H[Z])))return!1;return!0}function P(Q){var M=Q.parentNode;return M&&M.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(M.nodeName)}function I(Q,M,H,Z,X){var re=Q.node,ne=Q.offset,ue=re,we=ne;re==Z&&ne>X&&++we,re==M&&(ne==H||ne==H+1)&&(ue=Z,we+=X-H),re==M&&ne>H+1&&--we,Q.node=ue,Q.offset=we}function W(Q,M,H){Q.node==M&&Q.offset>H&&--Q.offset}function se(Q,M,H,Z){H==-1&&(H=M.childNodes.length);var X=Q.parentNode,re=o.getNodeIndex(Q);c(Z,function(ne){I(ne,X,re,M,H)}),M.childNodes.length==H?M.appendChild(Q):M.insertBefore(Q,M.childNodes[H])}function q(Q,M){var H=Q.parentNode,Z=o.getNodeIndex(Q);c(M,function(X){W(X,H,Z)}),o.removeNode(Q)}function ee(Q,M,H,Z,X){for(var re,ne=[];re=Q.firstChild;)se(re,M,H++,X),ne.push(re);return q(Q,X),ne}function T(Q,M){return ee(Q,Q.parentNode,o.getNodeIndex(Q),!0,M)}function z(Q,M){var H=Q.cloneRange();H.selectNodeContents(M);var Z=H.intersection(Q),X=Z?Z.toString():"";return X!=""}function B(Q){for(var M=Q.getNodes([3]),H=0,Z;(Z=M[H])&&!z(Q,Z);)++H;for(var X=M.length-1;(Z=M[X])&&!z(Q,Z);)--X;return M.slice(H,X+1)}function pe(Q,M){if(Q.attributes.length!=M.attributes.length)return!1;for(var H=0,Z=Q.attributes.length,X,re,ne;H<Z;++H)if(X=Q.attributes[H],ne=X.name,ne!="class"&&(re=M.attributes.getNamedItem(ne),X===null!=(re===null)||X.specified!=re.specified||X.specified&&X.nodeValue!==re.nodeValue))return!1;return!0}function Ee(Q,M){for(var H=0,Z=Q.attributes.length,X;H<Z;++H)if(X=Q.attributes[H].name,!(M&&l(M,X))&&Q.attributes[H].specified&&X!="class")return!0;return!1}var ye=o.getComputedStyleProperty,it=function(){var Q=document.createElement("div");return typeof Q.isContentEditable=="boolean"?function(M){return M&&M.nodeType==1&&M.isContentEditable}:function(M){return!M||M.nodeType!=1||M.contentEditable=="false"?!1:M.contentEditable=="true"||it(M.parentNode)}}();function Oe(Q){var M;return Q&&Q.nodeType==1&&((M=Q.parentNode)&&M.nodeType==9&&M.designMode=="on"||it(Q)&&!it(Q.parentNode))}function he(Q){return(it(Q)||Q.nodeType!=1&&it(Q.parentNode))&&!Oe(Q)}var We=/^inline(-block|-table)?$/i;function Re(Q){return Q&&Q.nodeType==1&&!We.test(ye(Q,"display"))}var Ge=/[^\r\n\t\f \u200B]/;function le(Q){if(Q.data.length==0)return!0;if(Ge.test(Q.data))return!1;var M=ye(Q.parentNode,"whiteSpace");switch(M){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(Q.data))return!1}return Re(Q.previousSibling)||Re(Q.nextSibling)}function G(Q){var M=[],H,Z;for(H=0;Z=Q[H++];)M.push(new s(Z.startContainer,Z.startOffset),new s(Z.endContainer,Z.endOffset));return M}function oe(Q,M){for(var H=0,Z,X,re,ne=Q.length;H<ne;++H)Z=Q[H],X=M[H*2],re=M[H*2+1],Z.setStartAndEnd(X.node,X.offset,re.node,re.offset)}function de(Q,M){return o.isCharacterDataNode(Q)?M==0?!!Q.previousSibling:M==Q.length?!!Q.nextSibling:!0:M>0&&M<Q.childNodes.length}function ke(Q,M,H,Z){var X,re,ne=H==0;if(o.isAncestorOf(M,Q))return Q;if(o.isCharacterDataNode(M)){var ue=o.getNodeIndex(M);if(H==0)H=ue;else if(H==M.length)H=ue+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+H+" in "+M.data);M=M.parentNode}if(de(M,H)){X=M.cloneNode(!1),re=M.parentNode,X.id&&X.removeAttribute("id");for(var we,Se=0;we=M.childNodes[H];)se(we,X,Se++,Z);return se(X,re,o.getNodeIndex(M)+1,Z),M==Q?X:ke(Q,re,o.getNodeIndex(X),Z)}else if(Q!=M){X=M.parentNode;var Pe=o.getNodeIndex(M);return ne||Pe++,ke(Q,X,Pe,Z)}return Q}function Ye(Q,M){return Q.namespaceURI==M.namespaceURI&&Q.tagName.toLowerCase()==M.tagName.toLowerCase()&&R(Q,M)&&pe(Q,M)&&ye(Q,"display")=="inline"&&ye(M,"display")=="inline"}function Ie(Q){var M=Q?"nextSibling":"previousSibling";return function(H,Z){var X=H.parentNode,re=H[M];if(re){if(re&&re.nodeType==3)return re}else if(Z&&(re=X[M],re&&re.nodeType==1&&Ye(X,re))){var ne=re[Q?"firstChild":"lastChild"];if(ne&&ne.nodeType==3)return ne}return null}}var Fe=Ie(!1),Ot=Ie(!0);function lt(Q){this.isElementMerge=Q.nodeType==1,this.textNodes=[];var M=this.isElementMerge?Q.lastChild:Q;M&&(this.textNodes[0]=M)}lt.prototype={doMerge:function(Q){var M=this.textNodes,H=M[0];if(M.length>1){var Z=o.getNodeIndex(H),X=[],re=0,ne;c(M,function(ue,we){ne=ue.parentNode,we>0&&(ne.removeChild(ue),ne.hasChildNodes()||o.removeNode(ne),Q&&c(Q,function(Se){Se.node==ue&&(Se.node=H,Se.offset+=re),Se.node==ne&&Se.offset>Z&&(--Se.offset,Se.offset==Z+1&&we<M.length-1&&(Se.node=H,Se.offset=re))})),X[we]=ue.data,re+=ue.data.length}),H.data=X.join("")}return H.data},getLength:function(){for(var Q=this.textNodes.length,M=0;Q--;)M+=this.textNodes[Q].length;return M},toString:function(){var Q=[];return c(this.textNodes,function(M,H){Q[H]="'"+M.data+"'"}),"[Merge("+Q.join(",")+")]"}};var It=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],_t={};function Yt(Q,M,H){var Z,X,re,ne,ue=this;ue.cssClass=ue.className=Q;var we=null,Se={};if(typeof M=="object"&&M!==null){for(typeof M.elementTagName<"u"&&(M.elementTagName=M.elementTagName.toLowerCase()),H=M.tagNames,we=M.elementProperties,Se=M.elementAttributes,X=0;ne=It[X++];)M.hasOwnProperty(ne)&&(ue[ne]=M[ne]);Z=M.normalize}else Z=M;ue.normalize=typeof Z>"u"?!0:Z,ue.attrExceptions=[];var Pe=document.createElement(ue.elementTagName);ue.elementProperties=ue.copyPropertiesToElement(we,Pe,!0),g(Se,function(ct,ht){ue.attrExceptions.push(ct),Se[ct]=""+ht}),ue.elementAttributes=Se,ue.elementSortedClassName=ue.elementProperties.hasOwnProperty("className")?k(ue.elementProperties.className+" "+Q):Q,ue.applyToAnyTagName=!1;var Je=typeof H;if(Je=="string")H=="*"?ue.applyToAnyTagName=!0:ue.tagNames=y(H.toLowerCase()).split(/\s*,\s*/);else if(Je=="object"&&typeof H.length=="number")for(ue.tagNames=[],X=0,re=H.length;X<re;++X)H[X]=="*"?ue.applyToAnyTagName=!0:ue.tagNames.push(H[X].toLowerCase());else ue.tagNames=[ue.elementTagName]}Yt.prototype={elementTagName:f,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(Q,M,H){var Z,X,re={},ne,ue,we,Se;for(var Pe in Q)if(Q.hasOwnProperty(Pe))if(ue=Q[Pe],we=M[Pe],Pe=="className")w(M,ue),w(M,this.className),M[Pe]=k(M[Pe]),H&&(re[Pe]=ue);else if(Pe=="style"){X=we,H&&(re[Pe]=ne={});for(Z in Q[Pe])Q[Pe].hasOwnProperty(Z)&&(X[Z]=ue[Z],H&&(ne[Z]=X[Z]));this.attrExceptions.push(Pe)}else M[Pe]=ue,H&&(re[Pe]=M[Pe],Se=_t.hasOwnProperty(Pe)?_t[Pe]:Pe,this.attrExceptions.push(Se));return H?re:""},copyAttributesToElement:function(Q,M){for(var H in Q)Q.hasOwnProperty(H)&&!/^class(?:Name)?$/i.test(H)&&M.setAttribute(H,Q[H])},appliesToElement:function(Q){return l(this.tagNames,Q.tagName.toLowerCase())},getEmptyElements:function(Q){var M=this;return Q.getNodes([1],function(H){return M.appliesToElement(H)&&!H.hasChildNodes()})},hasClass:function(Q){return Q.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(Q))&&x(Q,this.className)},getSelfOrAncestorWithClass:function(Q){for(;Q;){if(this.hasClass(Q))return Q;Q=Q.parentNode}return null},isModifiable:function(Q){return!this.applyToEditableOnly||he(Q)},isIgnorableWhiteSpaceNode:function(Q){return this.ignoreWhiteSpace&&Q&&Q.nodeType==3&&le(Q)},postApply:function(Q,M,H,Z){var X=Q[0],re=Q[Q.length-1],ne=[],ue,we=X,Se=re,Pe=0,Je=re.length,ct;c(Q,function(ut){ct=Fe(ut,!Z),ct?(ue||(ue=new lt(ct),ne.push(ue)),ue.textNodes.push(ut),ut===X&&(we=ue.textNodes[0],Pe=we.length),ut===re&&(Se=ue.textNodes[0],Je=ue.getLength())):ue=null});var ht=Ot(re,!Z);if(ht&&(ue||(ue=new lt(re),ne.push(ue)),ue.textNodes.push(ht)),ne.length){for(var Pt=0,qe=ne.length;Pt<qe;++Pt)ne[Pt].doMerge(H);M.setStartAndEnd(we,Pe,Se,Je)}},createContainer:function(Q){var M=o.getDocument(Q),H=v&&!o.isHtmlNamespace(Q)&&Q.namespaceURI?M.createElementNS(Q.namespaceURI,this.elementTagName):M.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,H,!1),this.copyAttributesToElement(this.elementAttributes,H),w(H,this.className),this.onElementCreate&&this.onElementCreate(H,this),H},elementHasProperties:function(Q,M){var H=this;return g(M,function(Z,X){if(Z=="className")return $(Q,X);if(typeof X=="object"){if(!H.elementHasProperties(Q[Z],X))return!1}else if(Q[Z]!==X)return!1})},elementHasAttributes:function(Q,M){return g(M,function(H,Z){if(Q.getAttribute(H)!==Z)return!1})},applyToTextNode:function(Q,M){if(P(Q)){var H=Q.parentNode;if(H.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(H)&&this.elementHasProperties(H,this.elementProperties)&&this.elementHasAttributes(H,this.elementAttributes))w(H,this.className);else{var Z=Q.parentNode,X=this.createContainer(Z);Z.insertBefore(X,Q),X.appendChild(Q)}}},isRemovable:function(Q){return Q.tagName.toLowerCase()==this.elementTagName&&D(Q)==this.elementSortedClassName&&this.elementHasProperties(Q,this.elementProperties)&&!Ee(Q,this.attrExceptions)&&this.elementHasAttributes(Q,this.elementAttributes)&&this.isModifiable(Q)},isEmptyContainer:function(Q){var M=Q.childNodes.length;return Q.nodeType==1&&this.isRemovable(Q)&&(M==0||M==1&&this.isEmptyContainer(Q.firstChild))},removeEmptyContainers:function(Q){var M=this,H=Q.getNodes([1],function(re){return M.isEmptyContainer(re)}),Z=[Q],X=G(Z);c(H,function(re){q(re,X)}),oe(Z,X)},undoToTextNode:function(Q,M,H,Z){if(!M.containsNode(H)){var X=M.cloneRange();X.selectNode(H),X.isPointInRange(M.endContainer,M.endOffset)&&(ke(H,M.endContainer,M.endOffset,Z),M.setEndAfter(H)),X.isPointInRange(M.startContainer,M.startOffset)&&(H=ke(H,M.startContainer,M.startOffset,Z))}this.isRemovable(H)?T(H,Z):_(H,this.className)},splitAncestorWithClass:function(Q,M,H){var Z=this.getSelfOrAncestorWithClass(Q);Z&&ke(Z,Q,M,H)},undoToAncestor:function(Q,M){this.isRemovable(Q)?T(Q,M):_(Q,this.className)},applyToRange:function(Q,M){var H=this;M=M||[];var Z=G(M||[]);Q.splitBoundariesPreservingPositions(Z),H.removeEmptyElements&&H.removeEmptyContainers(Q);var X=B(Q);if(X.length){c(X,function(ue){!H.isIgnorableWhiteSpaceNode(ue)&&!H.getSelfOrAncestorWithClass(ue)&&H.isModifiable(ue)&&H.applyToTextNode(ue,Z)});var re=X[X.length-1];Q.setStartAndEnd(X[0],0,re,re.length),H.normalize&&H.postApply(X,Q,Z,!1),oe(M,Z)}var ne=H.getEmptyElements(Q);c(ne,function(ue){w(ue,H.className)})},applyToRanges:function(Q){for(var M=Q.length;M--;)this.applyToRange(Q[M],Q);return Q},applyToSelection:function(Q){var M=n.getSelection(Q);M.setRanges(this.applyToRanges(M.getAllRanges()))},undoToRange:function(Q,M){var H=this;M=M||[];var Z=G(M);Q.splitBoundariesPreservingPositions(Z),H.removeEmptyElements&&H.removeEmptyContainers(Q,Z);var X=B(Q),re,ne,ue=X[X.length-1];if(X.length){H.splitAncestorWithClass(Q.endContainer,Q.endOffset,Z),H.splitAncestorWithClass(Q.startContainer,Q.startOffset,Z);for(var we=0,Se=X.length;we<Se;++we)re=X[we],ne=H.getSelfOrAncestorWithClass(re),ne&&H.isModifiable(re)&&H.undoToAncestor(ne,Z);Q.setStartAndEnd(X[0],0,ue,ue.length),H.normalize&&H.postApply(X,Q,Z,!0),oe(M,Z)}var Pe=H.getEmptyElements(Q);c(Pe,function(Je){_(Je,H.className)})},undoToRanges:function(Q){for(var M=Q.length;M--;)this.undoToRange(Q[M],Q);return Q},undoToSelection:function(Q){var M=n.getSelection(Q),H=n.getSelection(Q).getAllRanges();this.undoToRanges(H),M.setRanges(H)},isAppliedToRange:function(Q){if(Q.collapsed||Q.toString()=="")return!!this.getSelfOrAncestorWithClass(Q.commonAncestorContainer);var M=Q.getNodes([3]);if(M.length){for(var H=0,Z;Z=M[H++];)if(!this.isIgnorableWhiteSpaceNode(Z)&&z(Q,Z)&&this.isModifiable(Z)&&!this.getSelfOrAncestorWithClass(Z))return!1}return!0},isAppliedToRanges:function(Q){var M=Q.length;if(M==0)return!1;for(;M--;)if(!this.isAppliedToRange(Q[M]))return!1;return!0},isAppliedToSelection:function(Q){var M=n.getSelection(Q);return this.isAppliedToRanges(M.getAllRanges())},toggleRange:function(Q){this.isAppliedToRange(Q)?this.undoToRange(Q):this.applyToRange(Q)},toggleSelection:function(Q){this.isAppliedToSelection(Q)?this.undoToSelection(Q):this.applyToSelection(Q)},getElementsWithClassIntersectingRange:function(Q){var M=[],H=this;return Q.getNodes([3],function(Z){var X=H.getSelfOrAncestorWithClass(Z);X&&!l(M,X)&&M.push(X)}),M},detach:function(){}};function Kt(Q,M,H){return new Yt(Q,M,H)}Yt.util={hasClass:x,addClass:w,removeClass:_,getClass:C,hasSameClasses:R,hasAllClasses:$,replaceWithOwnChildren:T,elementsHaveSameNonClassAttributes:pe,elementHasNonClassAttributes:Ee,splitNodeAt:ke,isEditableElement:it,isEditingHost:Oe,isEditable:he},n.CssClassApplier=n.ClassApplier=Yt,n.createClassApplier=Kt,d.createAliasForDeprecatedMethod(n,"createCssClassApplier","createClassApplier",i)}),t})}(zf)),zf.exports}b5();var Uy={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},Vy=qd.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var r=this;zy.init(),qd.extensions.button.prototype.init.call(this),this.colorPicker=new uS({parent:this.button,color:"#000",onDone:function(e){r.coloredText&&r.coloredText.isAppliedToSelection()&&r.coloredText.undoToSelection(),r.coloredText=zy.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),r.coloredText.toggleSelection(),r.base.checkContentChanged(),r.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(r){return r.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),x5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),w5=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(s=r[l])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Xy=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Gy=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){x5(e,r);function e(t){var n=r.call(this,t)||this;n.labelMap=new Map;var i=t.lf,o=t.graphModel;return n.lf=i,n.graphModel=o,n.state={tick:0},n}return e.prototype.componentDidMount=function(){var t=this,n=this.props.graphModel;this.editor=new qd(".lf-label-editor",Ya(Uy,{autoLink:!0,extensions:{colorPicker:new Vy}})),n.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),n.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new qd(".lf-label-editor",Ya(Uy,{autoLink:!0,extensions:{colorPicker:new Vy}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,n=this.props,i=n.lf.extension,o=n.graphModel,s=Gy(Gy([],Xy(o.nodes),!1),Xy(o.edges),!1),l=i.label;if(l){var d=[];return un(s,function(c){var f,v,g=c.getData(),y=(v=(f=g.properties)===null||f===void 0?void 0:f._label)!==null&&v!==void 0?v:[];un(y,function(b){var x=t.labelMap,w=new u5(b,c,o);x.set(w.id,w),d.push(Ne(s5,{label:w,element:c,graphModel:o},w.id))})}),d}return null},e.prototype.render=function(){return Ne("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=w5([Sr],e),e})(Gt);var S5=function(){function r(e){var t=e.lf,n=this;this.lf=t,this.lf.setPatternItems=function(i){n.setPatternItems(i)}}return r.prototype.render=function(e,t){var n=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.shapeList.forEach(function(i){var o;(o=n.panelEl)===null||o===void 0||o.appendChild(n.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},r.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},r.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},r.prototype.createDndItem=function(e){var t=this,n=document.createElement("div");n.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),n.appendChild(i),e.label){var o=document.createElement("div");o.innerText=e.label,o.className="lf-dnd-text",n.appendChild(o)}return e.disabled?(n.classList.add("disabled"),n.onmousedown=function(){e.callback&&e.callback(t.lf,t.domContainer)},n):(n.onmousedown=function(){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer)},n.ondblclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:s,data:e})},n.onclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:s,data:e})},n.oncontextmenu=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:s,data:e})},n)},r.pluginName="dndPanel",r}(),E5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ea=function(){return ea=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ea.apply(this,arguments)},C5=function(r){E5(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,n=t.width,i=t.height,o=t.radius;xr(n)||(this.width=n),xr(i)||(this.height=i),xr(o)||(this.radius=o)},e.prototype.getTextStyle=function(){var t=this.properties,n=t.refX,i=n===void 0?0:n,o=t.refY,s=o===void 0?0:o,l=t.textStyle,d=r.prototype.getTextStyle.call(this);return ea(ea(ea({},d),Ht(l)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(s,")")})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.properties.style;return ea(ea({},t),Ht(n)||{})},e}(Il),cS={};function Tn(r,e){var t=r.type,n=r.component,i=r.effect,o=r.view,s=r.model;if(!t)throw new Error("You should specify type in config");cS[t]={component:n,effect:i},e.register({type:t,view:o||A5,model:s||C5})}var Cs=!1,Jd=new Map,Zd=Jt({});function O5(r,e,t,n,i){Cs&&(Zd[r]=nc(hs({render:function(){return wn(s_,{to:t},[wn(e,{node:n,graph:i})])},provide:function(){return{getNode:function(){return n},getGraph:function(){return i}}}})))}function k5(r){Cs&&delete Zd[r]}function Yy(){return Cs}function fS(){return Cs=!0,hs({props:{flowId:{type:String,required:!0}},setup:function(r){return function(){var e=[];return Object.keys(Zd).forEach(function(t){t.startsWith(r.flowId)&&e.push(Zd[t])}),wn(dt,{},e.map(function(t){return wn(t)}))}}})}function M5(r,e){if(!(!e||!r||!Cs)){var t=fS();if(!Jd.has(e)){var n=document.createElement("div");r.appendChild(n);var i=$l(t,{flowId:e});i.mount(n),Jd.set(e,i)}}}function Ky(r){if(!(!r||!Cs)){var e=Jd.get(r);e&&(e.unmount(),Jd.delete(r))}}var N5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),A5=function(r){N5(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var n=document.createElement("div");n.className="custom-vue-node-content",this.root=n,t.appendChild(n),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var n=this.getComponentContainer(),i=this.props,o=i.model,s=i.graphModel;if(n){var l=cS[o.type].component;l&&(Yy()?O5(this.targetId(),l,n,o,s):(this.vm=$l({render:function(){return wn(l,{node:o,graph:s})},provide:function(){return{getNode:function(){return o},getGraph:function(){return s}}}}),(t=this.vm)===null||t===void 0||t.mount(n)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){Yy()&&k5(this.targetId()),this.unmountVueComponent()},e}(jl),T5=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},D5=function(){function r(e){var t=e.lf,n=e.LogicFlow,i=e.options,o=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){o.updateViewPortBounds(),o.isShow&&o.updateViewPort()},this.render=function(l,d){o.container=d,o.lf.on("history:change",function(){o.isShow&&o.setView()}),o.lf.on("graph:transform",function(){o.isShow&&o.setView(!1)})},this.show=function(l,d){o.isShow||(o.initMiniMap(),o.lf.on("graph:resize",o.onGraphResize),o.createMiniMap(l,d),o.setView(!0)),o.isShow=!0},this.hide=function(){o.isShow&&(Ky(o.lfMap.graphModel.flowId),o.lf.off("graph:resize",o.onGraphResize),o.lfMap.destroy(),o.translateX=0,o.translateY=0,o.removeMiniMap(),o.lf.emit("miniMap:close",{})),o.isShow=!1},this.updatePosition=function(l){if(typeof l=="object")(l.left!==void 0||l.right!==void 0)&&(o.leftPosition=l.left,o.rightPosition=l.right),(l.top!==void 0||l.bottom!==void 0)&&(o.topPosition=l.top,o.bottomPosition=l.bottom);else switch(l){case"left-top":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=0,o.bottomPosition=void 0;break;case"right-top":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=0,o.bottomPosition=void 0;break;case"left-bottom":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=void 0,o.bottomPosition=0;break;case"right-bottom":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=void 0,o.bottomPosition=0;break}o.updateMiniMapPosition()},this.reset=function(){o.lf.resetTranslate(),o.lf.resetZoom()},this.setShowEdge=function(l){o.showEdge!==l&&(o.showEdge=l,o.setView())},this.startDrag=function(l){document.addEventListener("mousemove",o.drag),document.addEventListener("mouseup",o.drop);var d=l.x,c=l.y;o.startPosition={x:d,y:c}},this.drag=function(l){var d=l.x,c=l.y,f=(d-o.startPosition.x)/o.scale,v=(c-o.startPosition.y)/o.scale,g=o.viewPortLeft+f+o.viewPortWidth/o.scale/2,y=o.viewPortTop+v+o.viewPortHeight/o.scale/2;o.startPosition={x:d,y:c},o.lf.focusOn({coordinate:{x:g,y}})},this.drop=function(){document.removeEventListener("mousemove",o.drag),document.removeEventListener("mouseup",o.drop)},this.mapClick=function(l){var d=l.offsetX,c=l.offsetY,f=o.translateX+d/o.scale,v=o.translateY+c/o.scale;o.lf.focusOn({coordinate:{x:f,y:v}})},this.lf=t,this.LFCtor=n,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var s={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=s,this.elementAreaBounds=s,this.viewPortBounds=s}return r.prototype.setOption=function(e){var t=e.width,n=t===void 0?150:t,i=e.height,o=i===void 0?220:i,s=e.showEdge,l=s===void 0?!1:s,d=e.isShowHeader,c=d===void 0?!1:d,f=e.isShowCloseIcon,v=f===void 0?!1:f,g=e.leftPosition,y=e.topPosition,b=e.rightPosition,x=b===void 0?0:b,w=e.bottomPosition,_=w===void 0?0:w,C=e.headerTitle,k=C===void 0?"导航":C;this.width=n,this.height=o,this.showEdge=l,this.isShowHeader=c,this.isShowCloseIcon=v,this.leftPosition=g,this.rightPosition=g!==void 0?void 0:x,this.topPosition=y,this.bottomPosition=y!==void 0?void 0:_,this.headerTitle=k},r.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins}),M5(e,this.lfMap.graphModel.flowId),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},r.prototype.createMiniMap=function(e,t){var n,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(n=this.container)===null||n===void 0||n.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var o=document.createElement("div");o.className="lf-mini-map-header",o.innerText=this.headerTitle,i.appendChild(o);var s=document.createElement("span");s.className="lf-mini-map-close",s.addEventListener("click",this.hide),i.appendChild(s)},r.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},r.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},r.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},r.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},n=e.nodes;n&&n.length>0&&n.forEach(function(i){var o,s,l=i.x,d=i.y,c=(o=i.width)!==null&&o!==void 0?o:200,f=(s=i.height)!==null&&s!==void 0?s:200,v=l-c/2,g=l+c/2,y=d-f/2,b=d+f/2;t.left=Math.min(v,t.left),t.right=Math.max(g,t.right),t.top=Math.min(y,t.top),t.bottom=Math.max(b,t.bottom)}),this.elementAreaBounds=t},r.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,n=e.TRANSLATE_Y,i=e.SCALE_X,o=e.SCALE_Y,s=this.lf.graphModel,l=s.width,d=s.height;this.viewPortBounds={left:-t/i,right:(-t+l)/i,top:-n/o,bottom:(-n+d)/o}},r.prototype.resetData=function(e){var t=e.nodes,n=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&n.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?n:[]}},r.prototype.setView=function(e){var t,n;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),o=this.resetData(i),s=this.lf.viewMap,l=this.lf.graphModel.modelMap,d=this.lfMap.viewMap;try{for(var c=T5(s.keys()),f=c.next();!f.done;f=c.next()){var v=f.value;d.has(v)||this.lfMap.register({type:v,view:s.get(v),model:l.get(v)})}}catch(W){t={error:W}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}this.lfMap.render(o),this.updateBounds(o)}else this.updateBounds();var g=this.bounds,y=g.left,b=g.top,x=g.right,w=g.bottom,_=x-y,C=w-b,k=this.width/_,D=this.height/C,R=Math.min(k,D);this.scale=R;var $=y-(this.width/R-_)/2,P=b-(this.height/R-C)/2;if(this.lfMap.graphModel.transformModel.translate(-$+this.translateX,-P+this.translateY),this.translateX=$,this.translateY=P,this.miniMapWrap.firstChild){var I=this.miniMapWrap.firstChild.style;I.pointerEvents="none",I.transform="matrix(".concat(R,", 0, 0, ").concat(R,", 0, 0)"),I.transformOrigin="left top",I.height="".concat(this.height/R,"px"),I.width="".concat(this.width/R,"px"),this.updateViewPort()}},r.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),n=t.TRANSLATE_X,i=t.TRANSLATE_Y,o=t.SCALE_X,s=t.SCALE_Y,l=this.lf.graphModel,d=l.width,c=l.height;this.viewPortLeft=-n/o,this.viewPortTop=-i/s,this.viewPortWidth=d/o*this.scale,this.viewPortHeight=c/s*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},r.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.addEventListener("mousedown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},r.prototype.destroy=function(){Ky(this.lfMap.graphModel.flowId),this.lf.off("graph:resize",this.onGraphResize)},r.pluginName="miniMap",r}(),qy=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Jy=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},L5=function(){function r(e){var t=e.lf,n=e.options,i=this,o;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(s){var l=s.e;i.handleMouseDown(l)},this.draw=function(s){var l=i.lf.getPointByClient(s.clientX,s.clientY).domOverlayPosition,d=l.x,c=l.y;if(i.endPoint={x:d,y:c},i.startPoint){var f=i.startPoint,v=f.x,g=f.y,y=v,b=g,x=d-v,w=c-g;d<v&&(y=d,x=v-d),c<g&&(b=c,w=g-c),i.wrapper&&(i.wrapper.style.left="".concat(y,"px"),i.wrapper.style.top="".concat(b,"px"),i.wrapper.style.width="".concat(x,"px"),i.wrapper.style.height="".concat(w,"px"))}},this.drawOff=function(s){if(i.mouseDownInfo){var l=i.mouseDownInfo,d=l.x,c=l.y,f=l.time,v=Math.abs(s.clientX-d)<5&&Math.abs(s.clientY-c)<5&&Date.now()-f<200;if(v){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var g=Ht(i.startPoint),y=Ht(i.endPoint);if(document.removeEventListener("mousemove",i.draw),i.exclusiveMode||document.removeEventListener("mouseup",i.drawOff),i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),g&&y){var d=g.x,c=g.y,b=y.x,x=y.y,w=[Math.min(d,b),Math.min(c,x)],_=[Math.max(d,b),Math.max(c,x)];if(i.lf.emit("selection:selected-area",{topLeft:w,bottomRight:_}),Math.abs(b-d)<10&&Math.abs(x-c)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var C=i.lf.graphModel.getAreaElement(w,_,i.isWholeEdge,i.isWholeNode,!0),k=i.lf.graphModel,D=k.dynamicGroup,R=k.group,$=[],P=i.lf.getSelectElements(),I=new Set(Jy(Jy([],qy(P.nodes.map(function(q){return q.id})),!1),qy(P.edges.map(function(q){return q.id})),!1));C.forEach(function(q){if(R){var ee=R.getNodeGroup(q.id);if(C.includes(ee))return}if(D){var ee=D.getGroupByNodeId(q.id);if(C.includes(ee))return}if(i.exclusiveMode&&I.has(q.id)){i.lf.deselectElementById(q.id);return}i.lf.selectElementById(q.id,!0),$.push(q)}),i.startPoint=void 0,i.endPoint=void 0,$.length>0&&i.lf.emit("selection:drop",{e:s}),i.lf.emit("selection:selected",{elements:$,leftTopPoint:w,rightBottomPoint:_})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(o=n==null?void 0:n.exclusiveMode)!==null&&o!==void 0?o:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(s){i.setExclusiveMode(s)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return r.prototype.render=function(e,t){this.container=t},r.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("mousemove",this.draw),document.removeEventListener("mouseup",this.drawOff)},r.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},r.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.addEventListener("mousedown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},r.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("mousedown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},r.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)){var n=e.button===2;if(!n){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,o=i.x,s=i.y;this.startPoint={x:o,y:s},this.endPoint={x:o,y:s};var l=document.createElement("div");l.className="lf-selection-select",l.oncontextmenu=function(c){c.preventDefault()},l.style.top="".concat(this.startPoint.y,"px"),l.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(l),this.wrapper=l,document.addEventListener("mousemove",this.draw),document.addEventListener("mouseup",this.drawOff)}}},r.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},r.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},r.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=Ht(this.endPoint),t=new MouseEvent("mouseup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},r.prototype.open=function(){this.disabled=!1},r.prototype.close=function(){this.disabled=!0},r.pluginName="selectionSelect",r}();var hS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Va=function(){return Va=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Va.apply(this,arguments)},Sl=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},P5={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function R5(r){for(var e=r,t=1;t<e.length-1;){var n=Sl(e[t-1],2),i=n[0],o=n[1],s=Sl(e[t],2),l=s[0],d=s[1],c=Sl(e[t+1],2),f=c[0],v=c[1];i===l&&l===f||o===d&&d===v?e.splice(t,1):t++}return e}function I5(r,e,t,n){var i=[r[0],r[1]],o=[r[0],r[1]];switch(t){case"tl":return e==="tr"?(i[1]+=n,o[0]+=n):e==="lb"&&(i[0]+=n,o[1]+=n),[i,o];case"tr":return e==="tl"?(i[1]+=n,o[0]-=n):e==="rb"&&(i[0]-=n,o[1]+=n),[i,o];case"bl":return e==="br"?(i[1]-=n,o[0]+=n):e==="lt"&&(i[0]+=n,o[1]-=n),[i,o];case"br":return e==="bl"?(i[1]-=n,o[0]-=n):e==="rt"&&(i[0]-=n,o[1]-=n),[i,o];default:return[]}}function B5(r,e,t,n){var i,o="",s="";r[0]===e[0]?o=r[1]>e[1]?"t":"b":r[1]===e[1]&&(o=r[0]>e[0]?"l":"r"),e[0]===t[0]?s=e[1]>t[1]?"t":"b":e[1]===t[1]&&(s=e[0]>t[0]?"l":"r");var l=Math.min(Math.hypot(e[0]-r[0],e[1]-r[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,n)||1/5*n,d="".concat(o).concat(s),c=P5[d]||"-",f="L ".concat(r[0]," ").concat(r[1]);if(c==="-")f+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var v=Sl(I5(e,d,c,l),2),g=v[0],y=v[1];g&&y&&(f+="L ".concat(g[0]," ").concat(g[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(y[0]," ").concat(y[1]),i=Sl(y,2),e[0]=i[0],e[1]=i[1])}return f}function j5(r,e){var t=0,n="";if(r.length===2)n+="M".concat(r[t][0]," ").concat(r[t++][1]," L ").concat(r[t][0]," ").concat(r[t][1]);else{for(n+="M".concat(r[t][0]," ").concat(r[t++][1]);t+1<r.length;){var i=r[t-1],o=r[t],s=r[t+++1];n+=B5(i,o,s,e)}n+="L ".concat(r[t][0]," ").concat(r[t][1])}return n}(function(r){hS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,s=t.radius,l=s===void 0?5:s,d=t.getEdgeStyle(),c=t.getEdgeAnimationStyle(),f=R5(n.split(" ").map(function(y){return y.split(",").map(function(b){return+b})})),v=j5(f,l),g=Va(Va(Va({style:i?c:{}},d),o),{fill:"none"});return xt("path",Va({d:v},g))},e})(ds);(function(r){hS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(ls);var pS=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Qd=function(){return Qd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Qd.apply(this,arguments)},Zy=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o},Qy=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},H5=function(r){pS(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.id,i=t.x,o=t.y,s=t.width,l=t.height,d=t.properties,c=this.props.model.getNodeStyle();return xt("svg",{x:i-s/2,y:o-l/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[d.labelText?xt("text",{x:0,y:-5,fontSize:"16px",fill:c.stroke},d.labelText):"",d.disabledDelete?"":xt("text",{x:d.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:c.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,n)},"x")])},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.id,d=this.props.model.getNodeStyle();return xt("g",{},[xt("rect",Qd(Qd({},d),{x:n-o/2,y:i-s/2,width:o,height:s,id:l})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var n=this.props.graphModel;n.deleteNode(t)},e}(Ld),$5=function(r){pS(e,r);function e(){var t=r.apply(this,Qy([],Zy(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},r.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,n;this.points=[],((n=this.properties)===null||n===void 0?void 0:n.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var n=t.x,i=t.y;this.x=n,this.y=i},e.prototype.updatePointsByNodes=function(t){var n=this,i=[],o=1/0,s=1/0,l=-1/0,d=-1/0;t.forEach(function(c){var f=n.graphModel.getNodeModelById(c);if(f){var v=f.width,g=f.height,y=f.x,b=f.y;o=Math.min(o,y-v/2-n.d),s=Math.min(s,b-g/2-n.d),l=Math.max(l,y+v/2+n.d),d=Math.max(d,b+g/2+n.d)}}),i.push([o,s],[l,s],[l,d],[o,d]),![o,s,l,d].some(function(c){return Math.abs(c)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(l+o)/2,y:(d+s)/2}))},e.prototype.resize=function(t){var n;this.isResize=!0;for(var i=t.width,o=t.height,s={x:i/this.width,y:o/this.height},l=(this.properties.node_selection_ids||[]).slice(),d=[],c=new Set;l.length;){var f=l.shift(),v=(n=this.graphModel.nodesMap[f])===null||n===void 0?void 0:n.model;if(v){if(!sd(v)){d.push(v);continue}c.has(v.id)||(c.add(v.id),l.push.apply(l,Qy([],Zy(v.properties.node_selection_ids||[]),!1)))}}var g={x:this.x-this.width/2,y:this.y-this.height/2},y=r.prototype.resize.call(this,t),b={x:this.x-this.width/2,y:this.y-this.height/2};return d.forEach(function(x){x.width=x.width*s.x,x.height=x.height*s.y;var w=(x.x-g.x)*s.x+b.x-x.x,_=(x.y-g.y)*s.y+b.y-x.y;x.move(w,_,!0)}),this.isResize=!1,y},e}(Nd),$h="node-selection";(function(){function r(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:$h,view:H5,model:$5})}return Object.defineProperty(r.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),r.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},r.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},r.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,n=this.lf.getGraphRawData(),i=t.filter(function(o){return o!==e.currentClickNode.id});return n.nodes.find(function(o){if(o.type==="node-selection"){var s=Wl(o,"properties.node_selection_ids",[]);return i.every(function(l){return s.includes(l)})}return!1})},r.prototype.onNodeChange=function(e,t){var n=e.graphModel.nodes.filter(function(i){if(!sd(i))return!1;var o=i.properties.node_selection_ids||[];return o.includes(t.id)});Promise.resolve().then(function(){n.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},r.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(n){var i;if(!(!n.e.shiftKey||n.data.type===$h)){t.currentClickNode=n.data;var o=!1;t.selectNodesIds.includes(n.data.id)&&((i=t.lf.getNodeModelById(n.data.id))===null||i===void 0||i.setSelected(!1),o=!0);var s=e.getSelectElements(!0).nodes;t.selectNodes=s,t.selectNodes.length===1?o?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(n,i,o){if(t.onNodeChange(e,n),sd(n)&&!n.isResize){var s=n.properties.node_selection_ids||[];return e.graphModel.moveNodes(s,i,o,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(n){return sd(n)||t.onNodeChange(e,n),!0})},r.pluginName="node-selection",r})();var sd=function(r){return!!(r&&r.type===$h)},F5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ec=function(){return ec=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ec.apply(this,arguments)};(function(r){F5(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=t.properties;return xt("text",{x:n-o/2+5,y:i-s/2+16,fontSize:12,fill:"blue"},l.moreText)},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,s=t.height,l=this.props.model.getNodeStyle();return xt("g",{},[xt("rect",ec(ec({},l),{fill:"#FFFFFF",x:n-o/2,y:i-s/2})),this.getLabelShape()])},e})(la);const z5={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(r){if(r){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const r=this.getGraphModel(),e=this.getModel();r.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},W5={class:"custom-line-popup"};function U5(r,e,t,n,i,o){return ia((Y(),ae("div",W5,[E("button",{class:"delete-btn",onClick:e[0]||(e[0]=cn((...s)=>o.handleDelete&&o.handleDelete(...s),["stop"]))},"删 除")],512)),[[cs,i.isDeleteConfirmShow]])}const V5=bt(z5,[["render",U5],["__scopeId","data-v-8168a5a6"]]),X5=70,G5=36;class Y5 extends ds{constructor(e){super(e),this.isMounted=!1,this.r=wn(V5,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=$l({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=X5,customHeight:n=G5}=e.getProperties(),i=e.id,{startPoint:o,endPoint:s,arrowConfig:l,pointsList:d}=e;let c={x:(o.x+s.x-t)/2,y:(o.y+s.y-n)/2,width:t,height:n};if(d.length>2){let v=Math.round(d.length/2);c.x=d[v-1].x+5,c.y=d[v-1].y}const f={width:t,height:n};return setTimeout(()=>{const v=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(v))},0),xt("foreignObject",{...c,id:"line_"+i},[xt("div",{id:i,style:f,className:"vue-app-wrapper"})])}}class K5 extends ls{initEdgeData(e){super.initEdgeData(e)}createId(){return tc("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),n=this.graphModel.getNodeModelById(this.targetNodeId),i=n==null?void 0:n.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}}const q5={type:"custom-edge",view:Y5,model:K5};function vS(r,e){return r.map(t=>{let n=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,o=e?e.node_type:t.node_type,s=t.name||t.key,l=e?`${e.text}.${s}`:s,d=t.children||t.subs||[],c="",f="";o==1?f=`global.${l}`:e?f=`${e.original_value}.${t.key}`:f=`${n}.${t.key}`,c=`【${f}】`;let v={label:s,value:c,original_value:f,node_id:n,node_name:i,node_type:o,text:l,key:t.key,id:n,typ:t.typ,children:d||[]};return v.children&&v.children.length>0&&(v.children=vS(v.children,v)),v})}class jn extends jl{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=wn(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=$l({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let n=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:n},t.model._width=i,t.model._height=n,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:n=>{t.model.properties.anchorList=n},setData:n=>{n.dataRaw=n.node_params,_n(()=>{t.model.properties={...t.model.properties,...n};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model._height=i||n.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:n=>{t.model.properties.node_name=n,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:n,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),n=t.map(b=>b.sourceAnchorId),i=t.map(b=>b.targetAnchorId),o=!1;const{x:s,y:l,type:d}=e,c=10;d==="left"?o=i.includes(e.id):o=n.includes(e.id);const f=xt("circle",{className:"custom-anchor-circle",cx:s,cy:l,r:c,fill:"#fff",stroke:"#2475FC","stroke-width":2}),v=xt("g",{className:"custom-anchor-arrow",transform:`translate(${s-c-2}, ${l-c-2})`},[xt("circle",{cx:12,cy:12,r:c,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),xt("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),g=xt("g",{className:`custom-anchor-plus ${o?"anchor-hide":""}`,transform:`translate(${s-c-2}, ${l-c-2})`},[xt("circle",{cx:12,cy:12,r:c,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),xt("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),xt("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return xt("g",{id:e.id,className:`custom-anchor custom-anchor-${d} ${o?"anchor-selected":"anchor-not-selected"}`,onClick:b=>{b.stopPropagation();const{graphModel:x,model:w}=this.props;d==="right"&&!o&&x.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:w})}},f,v,g)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class Hn extends Il{createId(){return tc(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(o=>o.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let n=JSON.parse(t.properties.node_params);return{sys_global:n.start.sys_global,diy_global:n.start.diy_global,all_global:[...n.start.sys_global,...n.start.diy_global]}}getAllParentVariable(){const e=[],t=new Set,n=this.incoming.edges,{nodes:i}=this.graphModel,o=["start-node","http-node","parameter-extraction-node","knowledge-base-node","ai-dialogue-node","specify-reply-node","problem-optimization-node","select-data-node","code-run-node","mcp-node"];let s=i.find(c=>c.type==="start-node");s&&(t.add(s.id),e.push(s));const l=c=>{for(let f=0;f<c.length;f++){let g=c[f].sourceNode;t.has(g.id)||(t.add(g.id),o.includes(g.type)&&e.push(g),l(g.incoming.edges))}};l(n);let d=[];for(const c of e){if(!o.includes(c.type))continue;let f=JSON.parse(c.properties.node_params),v={label:c.properties.node_name,value:c.id,node_id:c.id,node_type:c.properties.node_type,typ:"node",children:[]};c.type==="http-node"&&(v.children=f.curl.output),c.type==="code-run-node"&&(v.children=f.code_run.output),c.type==="parameter-extraction-node"&&(v.children=f.params_extractor.output),c.type==="start-node"&&(v.children=[...f.start.diy_global,...f.start.sys_global]),c.type==="select-data-node"&&(v.children=[{key:"output_list",typ:"Array(Object)",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),c.type==="knowledge-base-node"&&(v.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),c.type==="ai-dialogue-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),c.type==="specify-reply-node"&&(v.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),c.type==="problem-optimization-node"&&(v.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),c.type==="mcp-node"&&(v.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),v.children.forEach(g=>{g.node_id=c.id,g.node_name=c.properties.node_name,g.node_type=c.properties.node_type}),v.children=vS(v.children,null),d.push(v)}return d}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const J5="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",Z5={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[]}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("handleMenu",r)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){let r=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",r)},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(r.target)&&r.target!==this.$el.querySelector(".node-menu-btn")&&r.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImggeUrl(r){return new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":y1,"../../../../assets/svg/ai-generate-white.svg":m1,"../../../../assets/svg/ai-generate.svg":g1,"../../../../assets/svg/ai-mark.svg":v1,"../../../../assets/svg/ai.svg":p1,"../../../../assets/svg/alert-icon.svg":h1,"../../../../assets/svg/ali-ocr.svg":f1,"../../../../assets/svg/analysis.svg":c1,"../../../../assets/svg/anthrop.svg":d1,"../../../../assets/svg/applet.svg":u1,"../../../../assets/svg/arrow-down.svg":l1,"../../../../assets/svg/arrow-left.svg":s1,"../../../../assets/svg/arrow-right.svg":a1,"../../../../assets/svg/attachment.svg":o1,"../../../../assets/svg/auth.svg":i1,"../../../../assets/svg/auto-reply.svg":r1,"../../../../assets/svg/azure.svg":n1,"../../../../assets/svg/baichuan.svg":t1,"../../../../assets/svg/base-node-type.svg":e1,"../../../../assets/svg/book.svg":Qx,"../../../../assets/svg/chat-cache.svg":Zx,"../../../../assets/svg/chat-mode.svg":Jx,"../../../../assets/svg/chat-robot-icon.svg":qx,"../../../../assets/svg/chat.svg":Kx,"../../../../assets/svg/check-arrow-filled.svg":Yx,"../../../../assets/svg/circularNeedle.svg":Gx,"../../../../assets/svg/client.svg":Xx,"../../../../assets/svg/close-circle.svg":Vx,"../../../../assets/svg/cmd.svg":Ux,"../../../../assets/svg/code-run-node.svg":Wx,"../../../../assets/svg/cohere.svg":zx,"../../../../assets/svg/collaborator.svg":Fx,"../../../../assets/svg/collapse-close.svg":$x,"../../../../assets/svg/collapse-open.svg":Hx,"../../../../assets/svg/colour-edit.svg":jx,"../../../../assets/svg/comment-search.svg":Bx,"../../../../assets/svg/common-quession.svg":Ix,"../../../../assets/svg/cu-doc-active.svg":Rx,"../../../../assets/svg/cu-doc-icon.svg":Px,"../../../../assets/svg/data-node.svg":Lx,"../../../../assets/svg/data-security.svg":Dx,"../../../../assets/svg/database-menu-icon.svg":Tx,"../../../../assets/svg/deepseek.svg":Ax,"../../../../assets/svg/delete.svg":Nx,"../../../../assets/svg/direct-connection.svg":Mx,"../../../../assets/svg/dislike-active.svg":kx,"../../../../assets/svg/dislike.svg":Ox,"../../../../assets/svg/doc-active-menu-icon.svg":Cx,"../../../../assets/svg/doc-directory.svg":Ex,"../../../../assets/svg/doc-draft.svg":Sx,"../../../../assets/svg/doc-file.svg":wx,"../../../../assets/svg/doc-file2.svg":xx,"../../../../assets/svg/doc-icon-active.svg":bx,"../../../../assets/svg/doc-icon.svg":_x,"../../../../assets/svg/doc-menu-icon.svg":yx,"../../../../assets/svg/document.svg":mx,"../../../../assets/svg/drag.svg":gx,"../../../../assets/svg/duiwaifuwu.svg":vx,"../../../../assets/svg/economic-active.svg":px,"../../../../assets/svg/economic.svg":hx,"../../../../assets/svg/edit-02.svg":fx,"../../../../assets/svg/edit.svg":cx,"../../../../assets/svg/empty-document.svg":dx,"../../../../assets/svg/empty.svg":ux,"../../../../assets/svg/end-node.svg":lx,"../../../../assets/svg/enterprise-active.svg":sx,"../../../../assets/svg/enterprise.svg":ax,"../../../../assets/svg/enterprise2.svg":ox,"../../../../assets/svg/expand.svg":ix,"../../../../assets/svg/explain-node.svg":rx,"../../../../assets/svg/export-record.svg":nx,"../../../../assets/svg/eye-open.svg":tx,"../../../../assets/svg/field-menu-icon.svg":ex,"../../../../assets/svg/file-icon.svg":Qb,"../../../../assets/svg/file-search.svg":Zb,"../../../../assets/svg/finance.svg":Jb,"../../../../assets/svg/function-center.svg":qb,"../../../../assets/svg/gemini.svg":Kb,"../../../../assets/svg/generate-icon.svg":Yb,"../../../../assets/svg/gou.svg":Gb,"../../../../assets/svg/government.svg":Xb,"../../../../assets/svg/graph-icon.svg":Vb,"../../../../assets/svg/guanlianzhishiku.svg":Ub,"../../../../assets/svg/high-active.svg":Wb,"../../../../assets/svg/high.svg":zb,"../../../../assets/svg/http-node.svg":Fb,"../../../../assets/svg/huanyingyu.svg":$b,"../../../../assets/svg/huoshanyinqin.svg":Hb,"../../../../assets/svg/img-icon.svg":jb,"../../../../assets/svg/input.svg":Bb,"../../../../assets/svg/jibenpeizhi.svg":Ib,"../../../../assets/svg/jichupeizhi.svg":Rb,"../../../../assets/svg/jina.svg":Pb,"../../../../assets/svg/judge-node.svg":Lb,"../../../../assets/svg/knowledge-base-node.svg":Db,"../../../../assets/svg/knowledge-config-active-icon.svg":Tb,"../../../../assets/svg/knowledge-config-icon.svg":Ab,"../../../../assets/svg/law.svg":Nb,"../../../../assets/svg/liaotianceshi.svg":Mb,"../../../../assets/svg/like-active.svg":kb,"../../../../assets/svg/like-icon.svg":Ob,"../../../../assets/svg/like.svg":Cb,"../../../../assets/svg/lingyiwanwu.svg":Eb,"../../../../assets/svg/link-icon-active.svg":Sb,"../../../../assets/svg/link-icon.svg":wb,"../../../../assets/svg/link-left.svg":xb,"../../../../assets/svg/lock-icon.svg":bb,"../../../../assets/svg/login-success.svg":_b,"../../../../assets/svg/logout.svg":yb,"../../../../assets/svg/manufacture.svg":mb,"../../../../assets/svg/mcp-node-type.svg":gb,"../../../../assets/svg/mcp-node.svg":vb,"../../../../assets/svg/medical-treatment.svg":pb,"../../../../assets/svg/menu-expand.svg":hb,"../../../../assets/svg/message.svg":fb,"../../../../assets/svg/minus.svg":cb,"../../../../assets/svg/mix-icon.svg":db,"../../../../assets/svg/more-compatible.svg":ub,"../../../../assets/svg/moxingshezhi.svg":lb,"../../../../assets/svg/multimode-box.svg":sb,"../../../../assets/svg/nav-chat.svg":ab,"../../../../assets/svg/nav-doc.svg":ob,"../../../../assets/svg/nav-explore.svg":ib,"../../../../assets/svg/nav-find.svg":rb,"../../../../assets/svg/nav-library.svg":nb,"../../../../assets/svg/nav-robot.svg":tb,"../../../../assets/svg/nav-search.svg":eb,"../../../../assets/svg/network.svg":Q0,"../../../../assets/svg/open-ai.svg":Z0,"../../../../assets/svg/ordinary-segmentation.svg":J0,"../../../../assets/svg/out-the-box.svg":q0,"../../../../assets/svg/output.svg":K0,"../../../../assets/svg/parameter-extraction-node.svg":Y0,"../../../../assets/svg/pc.svg":G0,"../../../../assets/svg/pdf-img.svg":X0,"../../../../assets/svg/pdf-ocr.svg":V0,"../../../../assets/svg/pdf-text.svg":U0,"../../../../assets/svg/phone.svg":W0,"../../../../assets/svg/plugin-node-type.svg":z0,"../../../../assets/svg/plus.svg":F0,"../../../../assets/svg/point-h.svg":$0,"../../../../assets/svg/problem-optimization-node.svg":H0,"../../../../assets/svg/problem-optimization.svg":j0,"../../../../assets/svg/prompt-icon.svg":B0,"../../../../assets/svg/put-away.svg":I0,"../../../../assets/svg/qa-feedback.svg":R0,"../../../../assets/svg/question-node.svg":P0,"../../../../assets/svg/quick-Instruction.svg":L0,"../../../../assets/svg/quote-file.svg":D0,"../../../../assets/svg/quotes.svg":T0,"../../../../assets/svg/recommendation.svg":A0,"../../../../assets/svg/reply-content.svg":N0,"../../../../assets/svg/reply-settings.svg":M0,"../../../../assets/svg/retail.svg":k0,"../../../../assets/svg/reward-points.svg":O0,"../../../../assets/svg/right-fork-icon.svg":C0,"../../../../assets/svg/robot_auto_reply.svg":E0,"../../../../assets/svg/robot_subscribe_reply.svg":S0,"../../../../assets/svg/save-draft.svg":w0,"../../../../assets/svg/sdk.svg":x0,"../../../../assets/svg/search-check-icon.svg":b0,"../../../../assets/svg/search-right.svg":_0,"../../../../assets/svg/search-tip.svg":y0,"../../../../assets/svg/search.svg":m0,"../../../../assets/svg/segmentation-down.svg":g0,"../../../../assets/svg/segmentation-icon.svg":v0,"../../../../assets/svg/segmentation-up.svg":p0,"../../../../assets/svg/segmentation.svg":h0,"../../../../assets/svg/select-disabled.svg":f0,"../../../../assets/svg/semantic-segmentation.svg":c0,"../../../../assets/svg/sensitive-icon.svg":d0,"../../../../assets/svg/seo-gray.svg":u0,"../../../../assets/svg/seo-highlight.svg":l0,"../../../../assets/svg/seo-light.svg":s0,"../../../../assets/svg/session-record.svg":a0,"../../../../assets/svg/session.svg":o0,"../../../../assets/svg/set-keywords.svg":i0,"../../../../assets/svg/setting.svg":r0,"../../../../assets/svg/share.svg":n0,"../../../../assets/svg/similarity.svg":t0,"../../../../assets/svg/skii.svg":e0,"../../../../assets/svg/source-energy.svg":Q_,"../../../../assets/svg/specify-reply-node.svg":Z_,"../../../../assets/svg/start-node.svg":J_,"../../../../assets/svg/statistical-analysis.svg":q_,"../../../../assets/svg/success.svg":K_,"../../../../assets/svg/suggested-issues.svg":Y_,"../../../../assets/svg/support.svg":G_,"../../../../assets/svg/switch-mobile.svg":X_,"../../../../assets/svg/system-setting.svg":V_,"../../../../assets/svg/team-manage-active.svg":U_,"../../../../assets/svg/team-manage.svg":W_,"../../../../assets/svg/team-manage2.svg":z_,"../../../../assets/svg/tengxunhunyuan.svg":F_,"../../../../assets/svg/test-active-menu-icon.svg":$_,"../../../../assets/svg/test-menu-icon.svg":H_,"../../../../assets/svg/think.svg":j_,"../../../../assets/svg/tongyiqianwen.svg":B_,"../../../../assets/svg/unit.svg":I_,"../../../../assets/svg/unknown-issue.svg":R_,"../../../../assets/svg/unknown-prompt.svg":P_,"../../../../assets/svg/use-token-active.svg":L_,"../../../../assets/svg/use-token.svg":D_,"../../../../assets/svg/user-icon.svg":T_,"../../../../assets/svg/variable-assignment-node.svg":A_,"../../../../assets/svg/vector-icon.svg":N_,"../../../../assets/svg/wenxinyiyan.svg":M_,"../../../../assets/svg/workflow-robot-icon.svg":k_,"../../../../assets/svg/workflow.svg":O_,"../../../../assets/svg/xitongtishici.svg":C_,"../../../../assets/svg/xunfeixinghuo.svg":E_,"../../../../assets/svg/yuezhianmian.svg":S_,"../../../../assets/svg/zhipuai.svg":w_})[`../../../../assets/svg/${r}.svg`],import.meta.url).href},updateTitle(r){this.setTitle(r)}}},Q5=["data-node-name","data-node-type"],ej={class:"node-header"},tj={class:"node-header-left"},nj={key:0,class:"node-icon"},rj=["src"],ij={class:"node-title"},oj={key:0,class:"node-menu-wrapper"},aj={class:"node-menus"},sj=["onClick"],lj={class:"node-body"};function uj(r,e,t,n,i,o){return Y(),ae("div",{class:Sn(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[E("div",{class:Sn(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[E("div",ej,[E("div",tj,[t.iconUrl||t.iconName?(Y(),ae("span",nj,[E("img",{src:t.iconUrl||o.getImggeUrl(t.iconName),alt:""},null,8,rj)])):et("",!0),E("span",ij,Te(t.title),1)]),E("div",null,[t.hideMenus?et("",!0):(Y(),ae("div",oj,[E("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=cn((...s)=>o.showMenu&&o.showMenu(...s),["stop"]))},e[2]||(e[2]=[E("img",{class:"btn-icon",src:J5,alt:""},null,-1)])),ia(E("div",aj,[(Y(!0),ae(dt,null,yt(o.allMenus,s=>(Y(),ae("div",{class:"node-menu",key:s.key,onClick:cn(l=>o.handleMenu(s),["stop"])},Te(s.name),9,sj))),128)),E("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=cn(s=>o.handleDelete(r.item),["stop"]))},"删除")],512),[[cs,i.isShowMenu]])]))])]),E("div",lj,[Ga(r.$slots,"default",{},void 0,!0)])],2)],10,Q5)}const $n=bt(Z5,[["render",uj],["__scopeId","data-v-e196b1bf"]]),dj={name:"StartNode",components:{NodeCommon:$n},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(){this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let r=JSON.parse(this.properties.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global,this.$nextTick(()=>{this.resetSize()})}}},cj={class:"start-node"},fj={class:"start-node-options"},hj={class:"options-list"},pj={class:"option-label"},vj={class:"option-type"};function gj(r,e,t,n,i,o){const s=Mn("node-common");return Y(),ze(s,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:U(()=>[E("div",cj,[E("div",fj,[e[0]||(e[0]=E("div",{class:"options-title"},"输入",-1)),E("div",hj,[(Y(!0),ae(dt,null,yt(o.options,l=>(Y(),ae("div",{class:Sn(["options-item",{"is-required":l.required}]),key:l.key},[E("div",pj,Te(l.key),1),E("div",vj,Te(l.typ),1)],2))),128))])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const mj=bt(dj,[["render",gj],["__scopeId","data-v-a8526388"]]);let yj=class extends jn{constructor(e){super(e),this.renderVue(mj,e)}},_j=class extends Hn{setAttributes(){this.width=568,this.height=322;const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",isHovered:s,isSelected:l,nodeId:e}]}};const bj={type:"start-node",model:_j,view:yj},_c={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(r){const e=r,t=Gr(),{modelList:n}=Fl(t),i=xe(""),o=()=>{if(!e.useModel){i.value="";return}for(const s of n.value)if(s.children){for(const l of s.children)if(e.useModel==l.name&&e.modelConfigId==l.id){i.value=l.show_model_name||l.deployment_name||l.name;return}}};return Qt(()=>[e.useModel,e.modelConfigId],()=>{o()},{immediate:!0}),(s,l)=>(Y(),ae("span",null,Te(i.value),1))}},ca={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(r,{expose:e}){const t=r,n=Nt("getNode"),i=xe([]),o=xe("");function s(){let v=n().getAllParentVariable();i.value=l(v)}function l(v){return v.forEach(g=>{g.typ=="node"?g.node_type==1?g.value="global":g.value=g.node_id:g.value=g.key,g.children&&g.children.length>0&&(g.children=l(g.children))}),v}const d=(v,g)=>{for(const y of v){if(y.value===g)return y.label;if(y.children&&y.children.length>0){const b=d(y.children,g);if(b)return b}}return null},c=()=>{if(!t.value||t.value.length===0)return"";s();let v=[];t.value.forEach(g=>{const y=d(i.value,g);y&&v.push(y)}),o.value=v.join("/")},f=()=>{c()};return Qt(()=>t.value,()=>{c()},{immediate:!0}),e({refresh:f}),(v,g)=>(Y(),ae("span",null,Te(o.value),1))}},xj={class:"ai-dialogue-node"},wj={class:"field-list"},Sj={class:"field-item"},Ej={class:"field-item-content"},Cj={class:"field-value"},Oj={class:"field-key"},kj={class:"field-item"},Mj={class:"field-item-content"},Nj={class:"field-value"},Aj={class:"field-key"},Tj={class:"field-item"},Dj={class:"field-item-content"},Lj={class:"category-list"},Pj={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("resetSize"),i=Gr(),{modelList:o}=Fl(i),s=xe([]),l=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]});function d(v){if(v&&typeof v=="string"){let g=v.split("."),y=g[0],b=g.filter((x,w)=>w>0).join(".");return[y,b]}else if(v&&typeof v=="object"&&v.length===2)return v;return["global","question"]}const c=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(v).cate||{}}catch{g={}}g=JSON.parse(JSON.stringify(g));for(let y in g)if(y==="question_value")l.question_value=d(g.question_value);else if(y=="categorys")if(g.categorys&&g.categorys.length>0){let b=g.categorys.map(x=>({...x,key:Math.random()*1e4}));l[y]=b}else l[y]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else l[y]=g[y];!l.model_config_id&&o.value.length>0&&(l.model_config_id=o.value[0].id,l.use_model=o.value[0].children[0].name),_n(()=>{n()})},f=()=>{const v=JSON.stringify({cate:{...l,model_config_id:l.model_config_id?+l.model_config_id:l.model_config_id}});t({...e.node,...l,node_params:v})};return Qt(()=>e.properties,c,{deep:!0}),qt(()=>{c(),n(),f()}),Oi(()=>{}),(v,g)=>(Y(),ze($n,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",xj,[E("div",wj,[E("div",Sj,[g[0]||(g[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",Ej,[E("div",Cj,[E("span",Oj,[j(ca,{ref:"questionTextRef",value:l.question_value},null,8,["value"])])])])]),E("div",kj,[g[1]||(g[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",Mj,[E("div",Nj,[E("span",Aj,[j(_c,{useModel:l.use_model,modelConfigId:l.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",Tj,[g[3]||(g[3]=E("div",{class:"field-item-label"},"问题分类",-1)),E("div",Dj,[E("div",Lj,[(Y(!0),ae(dt,null,yt(l.categorys,y=>(Y(),ae("div",{class:"field-value category-value",key:y.key},[E("span",null,Te(y.category),1)]))),128)),g[2]||(g[2]=E("div",{class:"field-value category-value"},[E("span",null,"默认分类")],-1))])])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Rj=bt(Pj,[["__scopeId","data-v-d3bd1d72"]]);let Ij=class extends jn{constructor(e){super(e),this.renderVue(Rj,e)}},Bj=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getAnchorPos(){return gO(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;let c=[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}],f=this.getAnchorPos(),v=n-o/2;for(let g=0;g<f.length;g++)c.push({id:f[g].id,x:t+i/2,y:v+132+g*32,type:"right"});return c.push({id:d+"-anchor_right",x:t+i/2,y:o/2+n-28,type:"right",nodeId:e}),c}};const jj={type:"question-node",model:Bj,view:Ij},Hj={name:"QuestionNode",components:{NodeCommon:$n},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},$j={class:"question-node"},Fj={class:"node-desc"};function zj(r,e,t,n,i,o){const s=Mn("node-common");return Y(),ze(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:U(()=>[E("div",$j,[E("div",Fj,Te(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const Wj=bt(Hj,[["render",zj],["__scopeId","data-v-a573d26e"]]);let Uj=class extends jn{constructor(e){super(e),this.renderVue(Wj,e)}},Vj=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;let c=[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&c.push({x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}),c}};const Xj={type:"action-node",model:Vj,view:Uj},Gj={name:"QuestionNode",components:{NodeCommon:$n},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(r){return OC(r)}}},Yj={class:"qa-node"},Kj={key:0,class:"no-data"};function qj(r,e,t,n,i,o){const s=Mn("node-common");return Y(),ze(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:U(()=>[E("div",Yj,[t.properties.no_resp_jump_time?et("",!0):(Y(),ae("div",Kj,"点击设置消息内容"))])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const Jj=bt(Gj,[["render",qj],["__scopeId","data-v-7f55a54e"]]);let Zj=class extends jn{constructor(e){super(e),this.renderVue(Jj,e)}},Qj=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const eH={type:"qa-node",model:Qj,view:Zj},tH={class:"ai-dialogue-node"},nH={class:"field-list"},rH={class:"field-item"},iH={class:"field-item-content"},oH={class:"field-value"},aH={class:"field-item"},sH={class:"field-item-content"},lH={class:"field-value"},uH={class:"field-key"},dH={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=Gr(),{modelList:l}=Fl(s),d=xe(null),c=xe([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),v=xe([]);function g(_){if(_){let C=_.split("."),k=C[0],D=C.filter((R,$)=>$>0).join(".");return[k,D]}return["global","question"]}const y=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(_).llm||{}}catch{C={}}x();const{model_config_id:k,use_model:D,context_pair:R,temperature:$,max_token:P,prompt:I,prompt_tags:W,question_value:se,enable_thinking:q,libs_node_key:ee}=JSON.parse(JSON.stringify(C));f.model_config_id=k,f.use_model=D,f.context_pair=R||0,f.temperature=$,f.max_token=P,f.prompt=I,f.enable_thinking=q,f.prompt_tags=W||[],f.libs_node_key=ee,f.question_value=g(se),!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),_n(()=>{o()})},b=()=>{const _=JSON.stringify({llm:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:_})},x=()=>{let _=i().getAllParentVariable();v.value=_},w=_=>{x(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(C=>{if(C.node_id==_.node_id){let k=C.label.split("/");k[0]=_.node_name,C.label=k.join("/"),C.node_name=_.node_name}}),b(),d.value.refresh()};return Qt(()=>e.properties,y,{deep:!0}),qt(()=>{y(),o(),n().eventCenter.on("custom:setNodeName",w)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",w)}),(_,C)=>(Y(),ze($n,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",tH,[E("div",nH,[E("div",rH,[C[0]||(C[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",iH,[E("div",oH,[j(ca,{ref_key:"questionTextRef",ref:d,value:f.question_value},null,8,["value"])])])]),E("div",aH,[C[1]||(C[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",sH,[E("div",lH,[E("span",uH,[j(_c,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),C[2]||(C[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"AI回复内容"),E("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},cH=bt(dH,[["__scopeId","data-v-84fe052f"]]);let fH=class extends jn{constructor(e){super(e),this.renderVue(cH,e)}},hH=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const pH={type:"ai-dialogue-node",model:hH,view:fH},gS=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...gS(t.children)):e.push(t)}),e},vH={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=gS(this.options),i=[...t,...n].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const o=new Set;i.forEach(s=>{const l=new RegExp(`(${s.value})`,"g");if(l.test(this.defaultValue)&&!o.has(s.value)){let d=s.node_name+"."+s.text;d=d.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${d}</span> `),o.add(s.value),this.selectOption(s,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?o+=d.textContent.slice(0,n):o+=d.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const s=n.childNodes;for(let l=0;l<s.length;l++){const d=s[l];d.nodeType===Node.TEXT_NODE&&(l===s.length-1?i+=d.textContent.slice(0,t):i+=d.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize();let i=t.bottom,o=t.left;const s=window.innerWidth,l=window.innerHeight;return o+n.width>s&&(o=s-n.width),i+n.height>l&&(i=t.top-n.height),{top:i,left:o,x:o,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{x:t,y:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle="",this.positionStyle+=`left:${t}px;`,this.positionStyle+=`top:${n}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),s=o.startOffset,l=o.startContainer;let d=s-t,c=l;if(d<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){d=f.textContent.length-t,c=f;break}f=f.previousSibling}}if(c.nodeType===Node.TEXT_NODE){c.replaceData(d,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const v=document.createElement("span");v.contentEditable=!0,v.innerHTML+="&nbsp;",v.classList.add("at-space");for(const b in e)f.dataset[b]=e[b];const g=document.createRange();g.setStart(c,d),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),v.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())}}};function gH(r,e,t,n,i,o){return Y(),ae("span",{ref:"JMention",class:Sn(["j-mention",["type-"+t.type]])},null,2)}const Xr=bt(vH,[["render",gH]]),mH={class:"ai-dialogue-node"},yH={class:"field-list"},_H={class:"field-item"},bH={class:"field-item-content"},xH={class:"field-value"},wH={class:"field-key"},SH={class:"field-type"},EH={class:"field-item"},CH={class:"field-item-content"},OH={class:"field-text"},kH={class:"right-arrow"},MH={class:"field-text2"},NH={class:"field-item"},AH={class:"field-item-content"},TH={class:"field-text"},DH={class:"right-arrow"},LH={class:"field-text2"},PH={key:0,class:"field-item"},RH={class:"field-item-content"},IH={class:"field-text"},BH={class:"right-arrow"},jH={class:"field-text2"},HH={key:1,class:"field-item"},$H={class:"field-item-content"},FH={class:"field-list-item"},zH={class:"field-item"},WH={class:"field-item-content"},UH={class:"field-key"},VH={class:"field-type"},XH={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=xe([]),l=Jt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function d(x){return x.forEach(w=>{w.cu_key=Math.random()*1e4,w.subs&&w.subs.length?d(w.subs):w.subs=[]}),x}const c=xe([]),f=()=>{const x=e.properties.dataRaw||e.properties.node_params||"{}";let w={};try{w=JSON.parse(x).curl||{}}catch{w={}}g(),w=JSON.parse(JSON.stringify(w));for(let _ in w){if(_=="headers"||_=="params"||_=="body"){w[_]&&w[_].length>0?l[_]=w[_].map(C=>({...C,cu_key:Math.random()*1e4})):l[_]=[];continue}if(_=="output"){l.output=d(w[_]);continue}l[_]=w[_]}_n(()=>{o()})},v=()=>{const x=JSON.stringify({curl:{...l}});t({...e.node,...l,node_params:x})},g=()=>{let x=i().getAllParentVariable();x.forEach(w=>{w.tags=w.tags||[]}),c.value=x},y=x=>{ys.includes(x.node_type)&&(g(),_n(()=>{l.body_raw_tags&&l.body_raw_tags.length>0&&l.body_raw_tags.forEach(_=>{if(_.node_id==x.node_id){let C=_.label.split("/");C[0]=x.node_name,_.label=C.join("/"),_.node_name=x.node_name}}),["headers","params","body"].forEach(_=>{l[_].forEach(k=>{k.tags&&k.tags.length>0&&k.tags.forEach(D=>{if(D.node_id==x.node_id){let R=D.label.split("/");R[0]=x.node_name,D.label=R.join("/"),D.node_name=x.node_name}})})}),v()}))},b=()=>{};return Qt(()=>e.properties,f,{deep:!0}),qt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",y)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",y)}),(x,w)=>(Y(),ze($n,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:b},{default:U(()=>[E("div",mH,[E("div",yH,[E("div",_H,[w[0]||(w[0]=E("div",{class:"field-item-label"},"请求地址",-1)),E("div",bH,[E("div",xH,[E("span",wH,Te(l.method),1),E("span",SH,Te(l.rawurl),1)])])]),E("div",EH,[w[1]||(w[1]=E("div",{class:"field-item-label"},"HEADERS",-1)),E("div",CH,[(Y(!0),ae(dt,null,yt(l.headers,_=>(Y(),ae("div",{class:"field-list-item",key:_.cu_key},[E("div",OH,Te(_.key),1),E("div",kH,[j($e(sl))]),E("div",MH,[j(Xr,{options:c.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),E("div",NH,[w[2]||(w[2]=E("div",{class:"field-item-label"},"PARAMS",-1)),E("div",AH,[(Y(!0),ae(dt,null,yt(l.params,_=>(Y(),ae("div",{class:"field-list-item",key:_.cu_key},[E("div",TH,Te(_.key),1),E("div",DH,[j($e(sl))]),E("div",LH,[j(Xr,{options:c.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),l.type==1?(Y(),ae("div",PH,[w[3]||(w[3]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",RH,[(Y(!0),ae(dt,null,yt(l.body,_=>(Y(),ae("div",{class:"field-list-item",key:_.cu_key},[E("div",IH,Te(_.key),1),E("div",BH,[j($e(sl))]),E("div",jH,[j(Xr,{options:c.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):et("",!0),l.type==2?(Y(),ae("div",HH,[w[4]||(w[4]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",$H,[E("div",FH,Te(l.body_raw),1)])])):et("",!0),E("div",zH,[w[5]||(w[5]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",WH,[(Y(!0),ae(dt,null,yt(l.output,_=>(Y(),ae("div",{class:"field-value",key:_.cu_key},[E("span",UH,Te(_.key),1),E("span",VH,Te(_.typ),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},GH=bt(XH,[["__scopeId","data-v-2ec194e8"]]);let YH=class extends jn{constructor(e){super(e),this.renderVue(GH,e)}},KH=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+26,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+26,id:d+"-anchor_right",type:"right",nodeId:e}]}};const qH={type:"http-node",model:KH,view:YH},JH={class:"ai-dialogue-node"},ZH={class:"field-list"},QH={class:"field-item"},e$={class:"field-item-content"},t$={class:"field-value"},n$={class:"field-item"},r$={class:"field-item-content"},i$={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=xe(null),l=xe([]),d=Jt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[]}),c=xe([]);function f(C){if(C){let k=C.split("."),D=k[0],R=k.filter(($,P)=>P>0).join(".");return[D,R]}return["global","question"]}const v=()=>{const C=e.properties.dataRaw||e.properties.node_params||"{}";let k={};try{k=JSON.parse(C).libs||{}}catch{k={}}w(),k=JSON.parse(JSON.stringify(k));for(let D in k)D=="library_ids"?d[D]=k[D]?k[D].split(","):[]:D=="question_value"?d.question_value=f(k.question_value):d[D]=k[D];_n(()=>{o()})},g=()=>{const C=JSON.stringify({libs:{...d,rerank_model_config_id:d.rerank_model_config_id?+d.rerank_model_config_id:void 0,question_value:d.question_value.join("."),library_ids:d.library_ids.join(",")}});t({...e.node,...d,node_params:C})},y=xe([]),b=tn(()=>y.value.filter(C=>d.library_ids.includes(C.id))),x=async()=>{const C=await Fh({type:""});C&&(y.value=C.data||[],_n(()=>{o()}))},w=()=>{let C=i().getAllParentVariable();c.value=C},_=()=>{w(),g(),s.value.refresh()};return Qt(()=>e.properties,v,{deep:!0}),qt(()=>{x(),v(),n().eventCenter.on("custom:setNodeName",_)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",_)}),(C,k)=>(Y(),ze($n,{title:e.properties.node_name,menus:l.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",JH,[E("div",ZH,[E("div",QH,[k[0]||(k[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",e$,[E("div",t$,[j(ca,{ref_key:"questionTextRef",ref:s,value:d.question_value},null,8,["value"])])])]),k[2]||(k[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出字段"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"知识库引用"),E("span",{class:"field-type"},"string")])])],-1)),E("div",n$,[k[1]||(k[1]=E("div",{class:"field-item-label"},"知识库",-1)),E("div",r$,[(Y(!0),ae(dt,null,yt(b.value,D=>(Y(),ae("div",{class:"library-item",key:D.id},Te(D.library_name),1))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},o$=bt(i$,[["__scopeId","data-v-2328071d"]]);let a$=class extends jn{constructor(e){super(e),this.renderVue(o$,e)}},s$=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const l$={type:"knowledge-base-node",model:s$,view:a$},u$={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:$n},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function d$(r,e,t,n,i,o){const s=Mn("node-common");return Y(),ze(s,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu,style:{width:"420px",height:"94px"}},{default:U(()=>e[0]||(e[0]=[E("div",{class:"end-node"},[E("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])),_:1,__:[0]},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const c$=bt(u$,[["render",d$],["__scopeId","data-v-120df52f"]]);let f$=class extends jn{constructor(e){super(e),this.renderVue(c$,e)}},h$=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e}]}};const p$={type:"end-node",model:h$,view:f$},v$={name:"EndNode",inject:["getNode","getGraph","setData"],components:{NodeCommon:$n},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{observer:null,menus:[],formState:{content:"",height:88}}},computed:{},mounted(){var t;let r=JSON.parse(this.properties.node_params);this.formState={...this.formState,...r};const e=(t=this.$refs.textareaRef)==null?void 0:t.querySelector("textarea");e&&(this.observer=new ResizeObserver(n=>{for(const i of n){const{height:o}=i.contentRect;this.formState.height=o+8,this.updateContent()}}),this.observer.observe(e))},beforeUnmount(){this.observer&&this.observer.disconnect()},methods:{getHeight(){return 68+this.formState.height},updateContent(){this.setData({node_params:JSON.stringify(this.formState),height:this.getHeight()})},handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}};function g$(r,e,t,n,i,o){const s=rc,l=Mn("node-common");return Y(),ze(l,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu},{default:U(()=>[E("div",{class:"explain-node",onMousedown:e[3]||(e[3]=cn(()=>{},["stop"])),ref:"textareaRef"},[j(s,{style:Ci({height:`${i.formState.height}px`}),onWheel:e[0]||(e[0]=cn(()=>{},["stop"])),bordered:!1,class:"explain-textarea",value:i.formState.content,"onUpdate:value":e[1]||(e[1]=d=>i.formState.content=d),placeholder:"请输入注释",onInput:e[2]||(e[2]=d=>o.updateContent(d.target.value))},null,8,["style","value"])],544)]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const m$=bt(v$,[["render",g$],["__scopeId","data-v-ae80eb55"]]);let y$=class extends jn{constructor(e){super(e),this.renderVue(m$,e)}},_$=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[]}};const b$={type:"explain-node",model:_$,view:y$},x$={class:"ai-dialogue-node"},w$={class:"field-list"},S$={class:"field-item"},E$={class:"field-item-content"},C$={class:"field-text"},O$={class:"right-arrow"},k$={class:"field-text"},M$={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=xe([]),l=Jt({list:[]}),d=xe([]),c=xe([]),f=()=>{const w=e.properties.dataRaw||e.properties.node_params||"{}";let _=[];try{_=JSON.parse(w).assign||[]}catch(C){}b(),y(),_.forEach(C=>{C.tags=C.tags||[]}),l.list=_,_n(()=>{o()})},v=()=>{let w=JSON.parse(e.properties.node_params);w.assign=[...l.list],t({...e.node,node_params:JSON.stringify(w)})};function g(w){return w?w.split(".")[1]:""}const y=()=>{let _=i().getGlobalVariable().diy_global||[];_.forEach(C=>{C.label=C.key,C.value="global."+C.key}),d.value=_||[]},b=()=>{let w=i().getAllParentVariable();w.forEach(_=>{_.tags=_.tags||[]}),c.value=w},x=w=>{ys.includes(w.node_type)&&(b(),_n(()=>{l.list.forEach(_=>{_.tags&&_.tags.length>0&&_.tags.forEach(C=>{if(C.node_id==w.node_id){let k=C.label.split("/");k[0]=w.node_name,C.label=k.join("/"),C.node_name=w.node_name}})}),v()}))};return Qt(()=>e.properties,f,{deep:!0}),qt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",x)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",x)}),(w,_)=>(Y(),ze($n,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",x$,[E("div",w$,[E("div",S$,[_[0]||(_[0]=E("div",{class:"field-item-label"},"变量",-1)),E("div",E$,[(Y(!0),ae(dt,null,yt(l.list,(C,k)=>(Y(),ae("div",{class:"field-list-item",key:k},[E("div",C$,[j(Xr,{options:c.value,"default-value":C.value,defaultSelectedList:C.tags},null,8,["options","default-value","defaultSelectedList"])]),E("div",O$,[j($e(sl))]),E("div",k$,Te(g(C.variable)),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},N$=bt(M$,[["__scopeId","data-v-7189ac92"]]);let A$=class extends jn{constructor(e){super(e),this.renderVue(N$,e)}},T$=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const D$={type:"variable-assignment-node",model:T$,view:A$},L$={class:"judge-node"},P$={class:"if-box-label"},R$={class:"if-box-content"},I$={class:"condition-box"},B$={key:0,class:"condition-left-box"},j$={class:"connection-text"},H$={key:1,class:"condition-line"},$$={class:"condition-body"},F$={class:"field-items"},z$={class:"field-name"},W$={class:"field-rule"},U$={class:"field-value"},V$={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("resetSize"),n=Nt("getNode"),i=Nt("updateAnchorList");let o=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const s=Jt({term:[]}),l=xe([]),d=xe([]);function c(){let C=n().getAllParentVariable();l.value=f(C)}function f(C){return C.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=f(k.children))}),C}let v=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],g=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function y(C){let k="";if(C.variable&&C.variable.length>0){let D=l.value.filter(R=>R.key==C.variable[0]);D&&D.length&&(k=D[0].typ),k=="object"&&(D[0]&&D[0].children&&(D=D[0].subs.filter(R=>R.key==C.variable[1])),D&&D.length&&(k=D[0].typ),k=="object"&&(D[0]&&D[0].children&&(D=D[0].subs.filter(R=>R.key==C.variable[2])),D&&D.length&&(k=D[0].typ)))}return k}function b(C){if(!C.variable)return[];let k=y(C);return k==""?C.is_mult?g:v:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?g:v}const x=C=>{let k=b(C),D=k.findIndex(R=>R.value==C.type);return k[D].label},w=()=>{try{let C=JSON.parse(e.properties.node_params).term||[];C=C.map(k=>{let D=k.terms.map(R=>{let $="";for(let P=0;P<o.length;P++)if(R.variable.indexOf(o[P])>-1){$=o[P];break}if($!=""){let P=R.variable.split(".");R.variable=[P[0],$]}else R.variable=R.variable.split(".");return{...R,type:R.type>0?R.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:D,key:Math.random()*1e4}}),s.term=C,_n(()=>{t(),_()})}catch(C){}},_=()=>{const C=e.properties.nodeSortKey;let k=[],D=56;for(let R=0;R<s.term.length;R++){let $=s.term[R];if($){let P=0,I=D,W=8,se=2,q=24,ee=$.terms.length;P=ee*q+W*2+se*(ee-1),R>0&&R<s.term.length&&(I+=8),D=I+P,k.push({id:C+"-anchor_"+R,offsetHeight:P,offsetTop:I})}}k.length>0&&k.push({id:C+"-anchor_right",offsetHeight:24,offsetTop:D+8}),i(k)};return Qt(()=>e.properties.node_params,(C,k)=>{C!=k&&w()},{deep:!0}),qt(()=>{c(),w()}),(C,k)=>(Y(),ze($n,{title:r.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",L$,[(Y(!0),ae(dt,null,yt(s.term,(D,R)=>(Y(),ae("div",{class:"if-box",ref_for:!0,ref:$=>d.value[R]=$,key:R},[E("div",P$,Te(R==0?"if":"else if"),1),E("div",R$,[E("div",I$,[D.terms.length>1?(Y(),ae("div",B$,[E("span",j$,Te(D.is_or==1?"or":"and"),1)])):et("",!0),D.terms.length>1?(Y(),ae("div",H$)):et("",!0),E("div",$$,[E("div",F$,[(Y(!0),ae(dt,null,yt(D.terms,($,P)=>(Y(),ae("div",{class:"field-item",key:P},[E("span",z$,[j(ca,{value:$.variable},null,8,["value"])]),E("span",W$,Te(x($)),1),E("span",U$,Te($.value),1)]))),128))])])])])]))),128)),k[0]||(k[0]=E("div",{class:"else-box"},[E("div",{class:"else-box-label"},"else"),E("div",{class:"else-box-content"},[E("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},X$=bt(V$,[["__scopeId","data-v-ec454a26"]]);let G$=class extends jn{constructor(e){super(e),this.renderVue(X$,e)}},Y$=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const s=n.graphModel.edges.map(d=>d.sourceAnchorId),l=o.id;return o.type==="right"&&!s.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:s,anchorList:l}=this.properties;let d=[{x:t-i/2,y:n-o/2+24,id:s+"-anchor_left",type:"left",nodeId:e}];if(l)for(let c=0;c<l.length;c++){let{offsetTop:f,offsetHeight:v}=l[c],g=n-o/2;d.push({id:l[c].id,x:t+i/2,y:g+f+v/2,type:"right"})}return d}};const K$={type:"judge-node",model:Y$,view:G$},q$={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:$n,AtText:Xr},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(r,e){r.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let r=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(r).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(r){ys.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh(),this.update()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.properties.node_params);r.reply={...this.formState},this.setData({node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()}}},J$={class:"specify-reply-node"},Z$={class:"static-field-list"},Q$={class:"static-field-item"},e6={class:"static-field-item-content"},t6={class:"static-field-value"},n6={key:1};function r6(r,e,t,n,i,o){const s=Mn("at-text"),l=Mn("node-common");return Y(),ze(l,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:U(()=>[E("div",J$,[E("div",Z$,[E("div",Q$,[e[0]||(e[0]=E("div",{class:"static-field-item-label"},"消息内容",-1)),E("div",e6,[E("div",t6,[i.formState.content.length>0?(Y(),ze(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(Y(),ae("span",n6,"--"))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const i6=bt(q$,[["render",r6],["__scopeId","data-v-39d8d3b6"]]);let o6=class extends jn{constructor(e){super(e),this.renderVue(i6,e)}},a6=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const s=n.graphModel.edges.map(d=>d.sourceAnchorId),l=o.id;return o.type==="right"&&!s.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const s6={type:"specify-reply-node",model:a6,view:o6},l6={class:"ai-dialogue-node"},u6={class:"field-list"},d6={class:"field-item"},c6={class:"field-item-content"},f6={class:"field-value"},h6={class:"field-item"},p6={class:"field-item-content"},v6={class:"field-value"},g6={class:"field-key"},m6={class:"field-item"},y6={class:"field-item-content"},_6={class:"field-key"},b6={class:"field-type"},x6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=Gr(),{modelList:l}=Fl(s),d=xe(null),c=xe([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),v=xe([]),g=xe([]);function y(R){if(R){let $=R.split("."),P=$[0],I=$.filter((W,se)=>se>0).join(".");return[P,I]}return["global","question"]}function b(R){return R.forEach($=>{$.cu_key=Math.random()*1e4,$.subs&&$.subs.length?b($.subs):$.subs=[]}),R}const x=()=>{const R=e.properties.dataRaw||e.properties.node_params||"{}";let $={};try{$=JSON.parse(R).params_extractor||{}}catch{$={}}$=JSON.parse(JSON.stringify($)),_(),C();for(let P in $){if(P=="output"){f.output=b($[P]);continue}if(P=="question_value"){f.question_value=y($[P]);continue}f[P]=$[P]}!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),_n(()=>{o()})},w=()=>{const R=JSON.stringify({params_extractor:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:R})},_=()=>{let R=i().getAllParentVariable();R.forEach($=>{$.tags=$.tags||[]}),v.value=R};function C(){let R=i().getAllParentVariable();g.value=k(R)}function k(R){return R.forEach($=>{$.typ=="node"?$.node_type==1?$.value="global":$.value=$.node_id:$.value=$.key,$.children&&$.children.length>0&&($.children=k($.children))}),R}const D=R=>{ys.includes(R.node_type)&&(_(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach($=>{if($.node_id==R.node_id){let P=$.label.split("/");P[0]=R.node_name,$.label=P.join("/"),$.node_name=R.node_name}}),w(),d.value.refresh())};return Qt(()=>e.properties.dataRaw,(R,$)=>{R!=$&&x()},{deep:!0}),qt(()=>{x(),o(),n().eventCenter.on("custom:setNodeName",D)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",D)}),(R,$)=>(Y(),ze($n,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",l6,[E("div",u6,[E("div",d6,[$[0]||($[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",c6,[E("div",f6,[j(ca,{ref_key:"questionTextRef",ref:d,value:f.question_value},null,8,["value"])])])]),E("div",h6,[$[1]||($[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",p6,[E("div",v6,[E("span",g6,[j(_c,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",m6,[$[2]||($[2]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",y6,[(Y(!0),ae(dt,null,yt(f.output,P=>(Y(),ae("div",{class:Sn(["field-value",{"is-required":P.required}]),key:P.cu_key},[E("span",_6,Te(P.key),1),E("span",b6,Te(P.typ),1)],2))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},w6=bt(x6,[["__scopeId","data-v-b4fcdde5"]]);let S6=class extends jn{constructor(e){super(e),this.renderVue(w6,e)}},E6=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const C6={type:"parameter-extraction-node",model:E6,view:S6},O6={class:"ai-dialogue-node"},k6={class:"static-field-list"},M6={class:"static-field-item"},N6={class:"static-field-item-content"},A6={class:"static-field-value"},T6={class:"static-field-item"},D6={class:"static-field-item-content"},L6={class:"static-field-value"},P6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=xe(null),n=Nt("setData"),i=Nt("getGraph"),o=Nt("getNode"),s=Nt("resetSize"),l=Gr(),{modelList:d}=Fl(l),c=xe([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),v=xe([]);function g(_){if(_){let C=_.split("."),k=C[0],D=C.filter((R,$)=>$>0).join(".");return[k,D]}return["global","question"]}const y=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(_).question_optimize||{}}catch{C={}}x();const{model_config_id:k,use_model:D,context_pair:R,temperature:$,max_token:P,prompt:I,prompt_tags:W,question_value:se,enable_thinking:q}=JSON.parse(JSON.stringify(C));f.model_config_id=k,f.use_model=D,f.context_pair=R||0,f.temperature=$,f.max_token=P,f.prompt=I,f.enable_thinking=q,f.prompt_tags=W||[],f.question_value=g(se),!f.model_config_id&&d.value.length>0&&(f.model_config_id=d.value[0].id,f.use_model=d.value[0].children[0].name),_n(()=>{s()})},b=()=>{const _={...f,node_params:JSON.stringify({question_optimize:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}})};n(_)},x=()=>{let _=o().getAllParentVariable();v.value=_},w=_=>{x(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(C=>{if(C.node_id==_.node_id){let k=C.label.split("/");k[0]=_.node_name,C.label=k.join("/"),C.node_name=_.node_name}}),b(),t.value.refresh()};return Qt(()=>e.properties,y,{deep:!0}),qt(()=>{y(),_n(()=>{s()}),i().eventCenter.on("custom:setNodeName",w)}),Oi(()=>{i().eventCenter.off("custom:setNodeName",w)}),(_,C)=>(Y(),ze($n,{title:e.properties.node_name,menus:c.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",O6,[E("div",k6,[E("div",M6,[C[0]||(C[0]=E("div",{class:"static-field-item-label"},"用户问题",-1)),E("div",N6,[E("div",A6,[j(ca,{ref_key:"questionTextRef",ref:t,value:f.question_value},null,8,["value"])])])]),E("div",T6,[C[1]||(C[1]=E("div",{class:"static-field-item-label"},"LLM模型",-1)),E("div",D6,[E("div",L6,[j(_c,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])]),C[2]||(C[2]=E("div",{class:"static-field-item"},[E("div",{class:"static-field-item-label"},"输出"),E("div",{class:"static-field-item-content"},[E("div",{class:"static-field-value"},[E("span",{class:"static-field-key"},"问题优化结果"),E("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},R6=bt(P6,[["__scopeId","data-v-b6c9b29b"]]);let I6=class extends jn{constructor(e){super(e),this.renderVue(R6,e)}},B6=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}};const j6={type:"problem-optimization-node",model:B6,view:I6},mS="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",H6={class:"add-data-node"},$6={class:"static-field-list"},F6={class:"static-field-item"},z6={class:"static-field-item-content"},W6={class:"static-field-value"},U6={class:"static-field-item"},V6={class:"static-field-item-content"},X6={key:0,class:"static-field-value"},G6={class:"field-name"},Y6={class:"field-name"},K6={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("resetSize"),i=Nt("getNode");let o={};const s=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=xe([]),d=()=>{let v=i().getAllParentVariable();l.value=v||[]},c=()=>{let v=e.properties.dataRaw||e.properties.node_params||"{}";o=JSON.parse(v),d(),s.formData=o.form_insert,f(),_n(()=>{n()})},f=()=>{o.form_insert=Vi(s.formData),t({...e.node,node_params:JSON.stringify(o)})};return Qt(()=>e.properties.dataRaw,(v,g)=>{v!==g&&c()}),qt(()=>{c()}),(v,g)=>(Y(),ze($n,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",H6,[E("div",$6,[E("div",F6,[g[0]||(g[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",z6,[E("div",W6,Te(s.formData.form_name||"--"),1)])]),E("div",U6,[g[2]||(g[2]=E("div",{class:"static-field-item-label"},"插入数据",-1)),E("div",V6,[s.formData.datas.length==0?(Y(),ae("div",X6,"--")):et("",!0),(Y(!0),ae(dt,null,yt(s.formData.datas,y=>(Y(),ae("div",{class:"static-field-value",key:y.id},[E("span",G6,[j(Xr,{options:l.value,"default-value":y.value,defaultSelectedList:y.atTags},null,8,["options","default-value","defaultSelectedList"])]),g[1]||(g[1]=E("span",{class:"field-arrow"},[E("img",{src:mS,alt:""})],-1)),E("span",Y6,Te(y.name),1)]))),128))])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},q6=bt(K6,[["__scopeId","data-v-419759cb"]]);let J6=class extends jn{constructor(e){super(e),this.renderVue(q6,e)}},Z6=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const Q6={type:"add-data-node",model:Z6,view:J6},eF={class:"node-box"},tF={class:"static-field-list"},nF={class:"static-field-item"},rF={class:"static-field-item-content"},iF={class:"static-field-value"},oF={class:"static-field-item",style:{"align-items":"center"}},aF={class:"static-field-item-content"},sF={key:0,class:"static-field-value"},lF={class:"condition-box"},uF={key:0,class:"condition-left-box"},dF={class:"connection-text"},cF={key:1,class:"condition-line"},fF={class:"condition-body"},hF={class:"field-items"},pF={class:"field-name"},vF={class:"field-rule"},gF={class:"field-value"},mF={class:"static-field-item"},yF={class:"static-field-item-content"},_F={class:"options-list"},bF={class:"option-label"},xF={class:"option-label"},wF={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("resetSize"),i=Nt("getNode"),o=Mo();let s={};const l=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),d=xe([]),c=()=>{let w=i().getAllParentVariable();d.value=w||[]},f=()=>{let w=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(w),c();let _=g(s.form_update.where||[]);s.form_update.where=_,l.formData=s.form_update,l.formData.form_id&&b(l.formData.form_id),v(),_n(()=>{n()})},v=()=>{let w={...Vi(l.formData)};w.where=y(w.where),s.form_update=w,t({...e.node,node_params:JSON.stringify(s)})},g=w=>{let _=[];return w.forEach(C=>{let k=JSON.parse(JSON.stringify(C)),D=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=D[0],D.shift(),k.rule=D.join("_"),_.push(k)}),_},y=w=>{let _=[];return w.forEach(C=>{let k=JSON.parse(JSON.stringify(C));k.form_field_id=k.form_field_id*1,k.rule=C.field_type+"_"+C.rule,_.push(k)}),_},b=async w=>{o.getFormFieldList({form_id:w}).then(_=>{_.forEach(C=>{C.id=C.id*1}),l.fieldList=_}).catch(()=>{})},x=(w,_)=>Zh(_,w);return Qt(()=>e.properties.dataRaw,(w,_)=>{w!==_&&f()}),qt(()=>{f()}),(w,_)=>(Y(),ze($n,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:U(()=>[E("div",eF,[E("div",tF,[E("div",nF,[_[0]||(_[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",rF,[E("div",iF,Te(l.formData.form_name||"--"),1)])]),E("div",oF,[_[2]||(_[2]=E("div",{class:"static-field-item-label"},"更新条件",-1)),E("div",aF,[l.formData.where.length==0?(Y(),ae("span",sF,"--")):et("",!0),E("div",lF,[l.formData.where.length>1?(Y(),ae("div",uF,[E("span",dF,Te(l.formData.typ==1?"且":"或"),1)])):et("",!0),l.formData.where.length>1?(Y(),ae("div",cF)):et("",!0),E("div",fF,[E("div",hF,[(Y(!0),ae(dt,null,yt(l.formData.where,C=>(Y(),ae("div",{class:"field-item",key:C.id},[E("span",pF,Te(C.field_name),1),E("span",vF,Te(x(C.field_type,C.rule)),1),E("span",gF,[j(Xr,{options:d.value,"default-value":C.rule_value1,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"]),C.rule_value2?(Y(),ae(dt,{key:0},[_[1]||(_[1]=E("span",null,"-",-1)),j(Xr,{options:d.value,"default-value":C.rule_value2,defaultSelectedList:C.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):et("",!0)])]))),128))])])])])]),E("div",mF,[_[4]||(_[4]=E("div",{class:"static-field-item-label"},"更新数据",-1)),E("div",yF,[E("div",_F,[(Y(!0),ae(dt,null,yt(l.formData.datas,C=>(Y(),ae("div",{class:"options-item",key:C.key},[E("div",bF,[j(Xr,{options:d.value,"default-value":C.value,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"])]),_[3]||(_[3]=E("span",{class:"field-arrow"},[E("img",{src:mS,alt:""})],-1)),E("div",xF,Te(C.name),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},SF=bt(wF,[["__scopeId","data-v-632323ff"]]);let EF=class extends jn{constructor(e){super(e),this.renderVue(SF,e)}},CF=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const OF={type:"update-data-node",model:CF,view:EF},kF={class:"node-box"},MF={class:"static-field-list"},NF={class:"static-field-item"},AF={class:"static-field-item-content"},TF={class:"static-field-value"},DF={class:"static-field-item",style:{"align-items":"center"}},LF={class:"static-field-item-content"},PF={key:0,class:"static-field-value"},RF={class:"condition-box"},IF={key:0,class:"condition-left-box"},BF={class:"connection-text"},jF={key:1,class:"condition-line"},HF={class:"condition-body"},$F={class:"field-items"},FF={class:"field-name"},zF={class:"field-rule"},WF={class:"field-value"},UF={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("resetSize"),n=Nt("setData"),i=Nt("getNode"),o=Mo();let s={};const l=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),d=xe([]),c=()=>{let w=i().getAllParentVariable();d.value=w||[]},f=()=>{let w=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(w),c();let _=y(s.form_delete.where||[]);s.form_delete.where=_,l.formData=s.form_delete,l.formData.form_id&&b(l.formData.form_id),v(),_n(()=>{t()})},v=()=>{let w={...Vi(l.formData)};w.where=g(w.where),s.form_delete=w,n({...e.node,node_params:JSON.stringify(s)})},g=w=>{let _=[];return w.forEach(C=>{let k=JSON.parse(JSON.stringify(C));k.form_field_id=k.form_field_id*1,k.rule=C.field_type+"_"+C.rule,_.push(k)}),_},y=w=>{let _=[];return w.forEach(C=>{let k=JSON.parse(JSON.stringify(C)),D=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=D[0],D.shift(),k.rule=D.join("_"),_.push(k)}),_},b=async w=>{o.getFormFieldList({form_id:w}).then(_=>{_.forEach(C=>{C.id=C.id*1}),l.fieldList=_,_n(()=>{t()})}).catch(()=>{})},x=(w,_)=>Zh(_,w);return Qt(()=>e.properties.dataRaw,(w,_)=>{w!==_&&f()}),qt(()=>{f()}),(w,_)=>(Y(),ze($n,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:U(()=>[E("div",kF,[E("div",MF,[E("div",NF,[_[0]||(_[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",AF,[E("div",TF,Te(l.formData.form_name||"--"),1)])]),E("div",DF,[_[2]||(_[2]=E("div",{class:"static-field-item-label"},"删除条件",-1)),E("div",LF,[l.formData.where.length==0?(Y(),ae("span",PF,"--")):et("",!0),E("div",RF,[l.formData.where.length>1?(Y(),ae("div",IF,[E("span",BF,Te(l.formData.typ==1?"且":"或"),1)])):et("",!0),l.formData.where.length>1?(Y(),ae("div",jF)):et("",!0),E("div",HF,[E("div",$F,[(Y(!0),ae(dt,null,yt(l.formData.where,C=>(Y(),ae("div",{class:"field-item",key:C.id},[E("span",FF,Te(C.field_name),1),E("span",zF,Te(x(C.field_type,C.rule)),1),E("span",WF,[j(Xr,{options:d.value,"default-value":C.rule_value1,defaultSelectedList:C.atTags},null,8,["options","default-value","defaultSelectedList"]),C.rule_value2?(Y(),ae(dt,{key:0},[_[1]||(_[1]=E("span",null,"-",-1)),j(Xr,{options:d.value,"default-value":C.rule_value2,defaultSelectedList:C.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):et("",!0)])]))),128))])])])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},VF=bt(UF,[["__scopeId","data-v-a02bcfc5"]]);let XF=class extends jn{constructor(e){super(e),this.renderVue(VF,e)}},GF=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const YF={type:"delete-data-node",model:GF,view:XF},KF={class:"node-box"},qF={class:"static-field-list"},JF={class:"static-field-item"},ZF={class:"static-field-item-content"},QF={class:"static-field-value"},e7={class:"static-field-item",style:{"align-items":"center"}},t7={class:"static-field-item-content"},n7={key:0,class:"static-field-value"},r7={class:"condition-box"},i7={key:0,class:"condition-left-box"},o7={class:"connection-text"},a7={key:1,class:"condition-line"},s7={class:"condition-body"},l7={class:"field-items"},u7={class:"field-name"},d7={class:"field-rule"},c7={class:"field-value"},f7={class:"static-field-item"},h7={class:"static-field-item-content"},p7={class:"options-list"},v7={class:"option-label"},g7={class:"option-type"},m7={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("resetSize"),i=Nt("getNode"),o=Nt("getGraph"),s=Mo();let l={};const d=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),c=xe([]),f=()=>{let k=i().getAllParentVariable();c.value=k||[]},v=()=>{let k=e.properties.dataRaw||e.properties.node_params||"{}";l=JSON.parse(k),f();let D=y(l.form_select.where||[]);l.form_select.where=D,d.formData=l.form_select,d.formData.form_id&&w(d.formData.form_id),g(),_n(()=>{n()})},g=()=>{let k={...Vi(d.formData)};k.where=b(k.where),l.form_select=k,t({...e.node,node_params:JSON.stringify(l)})},y=k=>{let D=[];return k.forEach(R=>{let $=JSON.parse(JSON.stringify(R)),P=$.rule.split("_");$.form_field_id=$.form_field_id*1,$.field_type=P[0],P.shift(),$.rule=P.join("_"),D.push($)}),D},b=k=>{let D=[];return k.forEach(R=>{let $=JSON.parse(JSON.stringify(R));$.form_field_id=$.form_field_id*1,$.rule=R.field_type+"_"+R.rule,D.push($)}),D},x=async()=>{const k=await s.getFormList();k&&(d.tableList=k)},w=async k=>{s.getFormFieldList({form_id:k}).then(D=>{D.forEach(R=>{R.id=R.id*1}),d.fieldList=D}).catch(()=>{})},_=(k,D)=>Zh(D,k),C=()=>{v()};return Qt(()=>e.properties.dataRaw,(k,D)=>{k!==D&&v()}),qt(()=>{x(),v(),o().eventCenter.on("custom:setNodeName",C)}),Oi(()=>{o().eventCenter.off("custom:setNodeName",C)}),(k,D)=>(Y(),ze($n,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:U(()=>[E("div",KF,[E("div",qF,[E("div",JF,[D[0]||(D[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",ZF,[E("div",QF,Te(d.formData.form_name||"--"),1)])]),E("div",e7,[D[2]||(D[2]=E("div",{class:"static-field-item-label"},"查询条件",-1)),E("div",t7,[d.formData.where.length==0?(Y(),ae("span",n7,"--")):et("",!0),E("div",r7,[d.formData.where.length>1?(Y(),ae("div",i7,[E("span",o7,Te(d.formData.typ==1?"且":"或"),1)])):et("",!0),d.formData.where.length>1?(Y(),ae("div",a7)):et("",!0),E("div",s7,[E("div",l7,[(Y(!0),ae(dt,null,yt(d.formData.where,R=>(Y(),ae("div",{class:"field-item",key:R.id},[E("span",u7,Te(R.field_name),1),E("span",d7,Te(_(R.field_type,R.rule)),1),E("span",c7,[j(Xr,{options:c.value,"default-value":R.rule_value1,defaultSelectedList:R.atTags},null,8,["options","default-value","defaultSelectedList"]),R.rule_value2?(Y(),ae(dt,{key:0},[D[1]||(D[1]=E("span",null,"-",-1)),j(Xr,{options:c.value,"default-value":R.rule_value2,defaultSelectedList:R.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):et("",!0)])]))),128))])])])])]),E("div",f7,[D[3]||(D[3]=E("div",{class:"static-field-item-label"},"查询字段",-1)),E("div",h7,[E("div",p7,[(Y(!0),ae(dt,null,yt(d.formData.fields,R=>(Y(),ae("div",{class:"options-item",key:R.key},[E("div",v7,Te(R.name),1),E("div",g7,Te(R.type),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},y7=bt(m7,[["__scopeId","data-v-8cf3c00f"]]);let _7=class extends jn{constructor(e){super(e),this.renderVue(y7,e)}},b7=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:d+"-anchor_right",type:"right",nodeId:e}]}};const x7={type:"select-data-node",model:b7,view:_7},w7={class:"ai-dialogue-node"},S7={class:"field-list"},E7={class:"field-item"},C7={class:"field-item-content"},O7={class:"field-text"},k7={class:"right-arrow"},M7={class:"field-text"},N7={class:"field-item"},A7={class:"field-item-content"},T7={class:"field-key"},D7={class:"field-type"},L7=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,P7={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Nt("setData"),n=Nt("getGraph"),i=Nt("getNode"),o=Nt("resetSize"),s=xe([]),l=Jt({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),d=xe([]);let c=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function f(w){return w.forEach(_=>{_.cu_key=Math.random()*1e4,_.subs&&_.subs.length?f(_.subs):_.subs=[]}),w}const v=()=>{const w=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(w).code_run||{}}catch{_={}}b(),_=JSON.parse(JSON.stringify(_));for(let C in _){if(C=="params"){_[C]&&_[C].length>0?l[C]=_[C].map(k=>({...k,cu_key:Math.random()*1e4})):l[C]=[];continue}if(C=="output"){l.output=f(_[C]);continue}l[C]=_[C]}l.main_func=l.main_func||L7,l.params=l.params.map(C=>{let k="";for(let D=0;D<c.length;D++)if(C.variable.indexOf(c[D])>-1){k=c[D];break}if(k!=""){let D=C.variable.split(".");C.variable=[D[0],k]}else C.variable=C.variable.split(".");return{...C,key:Math.random()*1e4}}),_n(()=>{o()})},g=()=>{const w=JSON.stringify({code_run:{...l,params:y()}});t({...e.node,...l,node_params:w})};function y(){let w=[];return l.params.forEach(_=>{w.push({field:_.field,variable:_.variable&&_.variable.length>0?_.variable.join("."):""})}),w}const b=()=>{let w=i().getAllParentVariable();d.value=w},x=w=>{ys.includes(w.node_type)&&(b(),_n(()=>{g()}))};return Qt(()=>e.properties,v,{deep:!0}),qt(()=>{v(),o(),n().eventCenter.on("custom:setNodeName",x)}),Oi(()=>{n().eventCenter.off("custom:setNodeName",x)}),(w,_)=>(Y(),ze($n,{title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:U(()=>[E("div",w7,[E("div",S7,[E("div",E7,[_[0]||(_[0]=E("div",{class:"field-item-label"},"输入参数",-1)),E("div",C7,[(Y(!0),ae(dt,null,yt(l.params,C=>(Y(),ae("div",{class:"field-list-item",key:C.cu_key},[E("div",O7,[j(ca,{value:C.variable},null,8,["value"])]),E("div",k7,[j($e(sl))]),E("div",M7,Te(C.field),1)]))),128))])]),E("div",N7,[_[1]||(_[1]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",A7,[(Y(!0),ae(dt,null,yt(l.output,C=>(Y(),ae("div",{class:"field-value",key:C.cu_key},[E("span",T7,Te(C.key),1),E("span",D7,Te(C.typ),1)]))),128))])]),_[2]||(_[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"异常处理"),E("div",{class:"field-item-content"},[E("div",{class:"field-value"},[E("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},R7=bt(P7,[["__scopeId","data-v-b020100f"]]);let I7=class extends jn{constructor(e){super(e),this.renderVue(R7,e)}},B7=class extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+28,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+28,id:d+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:n+o/2-28,id:d+"-anchor_right_exception",type:"right",nodeId:e}]}};const j7={type:"code-run-node",model:B7,view:I7},H7={name:"QuestionNode",components:{NodeCommon:$n},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}}}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.loadProvider()},methods:{loadProvider(){var r;x1({provider_id:((r=this.nodeParams)==null?void 0:r.mcp.provider_id)||""}).then(e=>{var n;this.mcpInfo=(e==null?void 0:e.data)||{};let t=a_((n=this.mcpInfo)==null?void 0:n.tools,{});this.toolInfo=t.find(i=>{var o;return i.name==((o=this.nodeParams)==null?void 0:o.mcp.tool_name)})})},update(r){let e=this.nodeParams;e.mcp.arguments=r.arguments,e.mcp.tag_map=r.tag_map,this.setData({node_params:JSON.stringify(e)})}}},$7={class:"mcp-node"};function F7(r,e,t,n,i,o){var d;const s=b_,l=Mn("node-common");return Y(),ze(l,{title:(d=i.toolInfo)==null?void 0:d.name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:U(()=>[E("div",$7,[e[1]||(e[1]=Be(" MCP插件： ")),i.toolInfo===null?(Y(),ze(s,{key:0,color:"red"},{default:U(()=>e[0]||(e[0]=[Be("工具不存在或工具异常")])),_:1,__:[0]})):(Y(),ze(s,{key:1},{default:U(()=>[Be(Te(t.properties.node_name),1)]),_:1}))])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key"])}const z7=bt(H7,[["render",F7]]);class W7 extends jn{constructor(e){super(e),this.renderVue(z7,e)}}class U7 extends Hn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,s)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(c=>c.sourceAnchorId),d=o.id;return o.type==="right"&&!l.includes(d)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,s)=>n.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:s,isSelected:l}=this,{nodeSortKey:d}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:d+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:d+"-anchor_right",type:"right",nodeId:e}]}}const V7={type:"mcp-node",model:U7,view:W7},X7={name:"QuestionNode",components:{PopupMenu:w1},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{}},mounted(){},methods:{handleAddNode(r){this.$emit("click-item",r)}}};function G7(r,e,t,n,i,o){const s=Mn("PopupMenu");return Y(),ze(s,{onAddNode:o.handleAddNode,type:"node"},null,8,["onAddNode"])}const Y7=bt(X7,[["render",G7]]),K7=130,q7=440;class J7{constructor({lf:e}){mo(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${K7}px`,this.__menuDOM.style.height=`${q7}px`,this.isMounted=!1,this.r=wn(Y7,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:n})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:n,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=$l({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:n,model:i})=>{this._activeData=i,this._activeAnchorData=n,this.createMenu()}),e.on("node:click",({data:n})=>{this.hideMenu()}),e.on("edge:click",({data:n})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,n=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,n])}showMenu(){const[e,t]=this.getContextMenuPosition();this.__menuDOM.style.display="flex",this.__menuDOM.style.top=`${t}px`,this.__menuDOM.style.left=`${e+10}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class yS{constructor({lf:e}){mo(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:n,metaKey:i}=e,o=t||i;if(o&&n.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(o&&(n.toLowerCase()==="y"||n.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let n=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:n||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),e.nodes&&e.nodes.length>0&&e.nodes.forEach(t=>{this.lf.addNode(t)}),e.edges&&e.edges.length>0&&e.edges.forEach(t=>{this.lf.addEdge(t)}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let n=e;for(;n&&n!==document.body;){if(n.hasAttribute&&n.hasAttribute("contenteditable"))return!0;n=n.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,n){this.maxHistorySize=n&&n.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((o,s)=>({index:s,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),n=this.redoStack.map((o,s)=>({index:s,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:n,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}mo(yS,"pluginName","canvasHistory");class _S{constructor({lf:e}){mo(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let n=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*n,100*i):this.lf.translate(100*n,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[n,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]);e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[n,i])}});mo(this,"keydownListener",e=>{const t=e.key.toLowerCase(),{graphModel:{eventCenter:n}}=this.lf,i=e.target,o=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!o)return;e.preventDefault();let s=this.lf.getSelectElements(!0);s=JSON.parse(JSON.stringify(s)),s.edges=[];const l=s.nodes.filter(d=>d.type!=="start-node"&&d.type!=="custom-group");if(l.length>0){this.basePointX=20,this.basePointY=20;let d={x:1/0,y:1/0};l.forEach(c=>{c.id="",c.nodeSortKey="",c.properties.id="",c.properties.next_node_key="",c.properties.nodeSortKey="",c.properties.node_key="",!c.width&&c.properties.width&&(c.width=c.properties.width),!c.height&&c.properties.height&&(c.height=c.properties.height),c.x<d.x&&(d.x=c.x),c.y<d.y&&(d.y=c.y)}),this.clipboard={nodes:l,basePoint:d}}else this.clipboard=null;return}if(t==="v"){if(!o)return;if(e.preventDefault(),this.clipboard&&this.clipboard.nodes.length>0){const s={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};n.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:s}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&o){n.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});mo(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}mo(_S,"pluginName","custom-keyboard");const Z7={class:"logic-flow-wrapper"},e_="dont_show_delete_node_confirm",Q7={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(r,{expose:e,emit:t}){const n=t;let i=null;const{setStorage:o,getStorage:s}=kC(),l=xe(s(e_)||!1),d=xe(null),c=xe(!1),f=xe(null),v=xe(null),g=fS(),y=xe(""),b=xe([]),x={nodes:[]},w={width:160,height:140,bottomPosition:24,rightPosition:16},_={exclusiveMode:!1},C=le=>{i&&i.zoom(le)};function k(){if(v.value){i=new u4({container:v.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[S5,D5,J7,L5,yS,_S],pluginsOptions:{miniMap:w,selectionSelect:_,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),Tn(q5,i),Tn(bj,i),Tn(jj,i),Tn(Xj,i),Tn(qH,i),Tn(eH,i),Tn(pH,i),Tn(l$,i),Tn(p$,i),Tn(b$,i),Tn(K$,i),Tn(D$,i),Tn(s6,i),Tn(C6,i),Tn(j6,i),Tn(Q6,i),Tn(OF,i),Tn(YF,i),Tn(x7,i),Tn(j7,i),Tn(V7,i),i.setDefaultEdgeType("custom-edge"),i.on("graph:rendered",({graphModel:G})=>{y.value=G.flowId});let le=1;i.on("node:dragstart",({data:G})=>{let oe=i.graphModel.getElement(G.id);le=oe.zIndex,oe.setZIndex(999999)}),i.on("node:drop",({data:G})=>{i.graphModel.getElement(G.id).setZIndex(le)}),i.on("node:add",()=>{}),i.on("custom:addNode",G=>{I(G)}),i.on("element:click",G=>{b.value=[G.data]}),i.on("node:click",({data:G})=>{ye(G)}),i.on("blank:click",()=>{Ge()}),i.on("selection:selected",G=>{let oe=[];G.elements.forEach(de=>{let ke=i.getDataById(de.id);(de.BaseType==="node"||de.BaseType==="edge")&&oe.push(ke)}),b.value=oe}),i.on("node:delete",({data:G})=>{let oe=JSON.parse(JSON.stringify(G));he(oe)}),i.on("edge:delete",({data:G})=>{let oe=JSON.parse(JSON.stringify(G));We(oe)}),i.on("custom:node:delete",G=>{T(G)}),i.on("custom:edge:delete",G=>{z(G)}),i.on("custom:keyoard:delete",()=>{B()}),i.on("custom:paste",W),i.render(x),i.setZoomMiniSize(.01),i.setZoomMaxSize(8),i.container.setAttribute("tabindex","0"),i.container.style.outline="none",i.container.focus()}}const D=()=>i.getGraphRawData(),R=le=>{let G=mO();le.nodes.forEach(de=>{let ke=G[de.type];de.properties.node_icon_name=ke.properties.node_icon_name,de.properties.width||(de.properties.width=ke.width),de.properties.height||(de.properties.height=ke.height)}),i.clearData(),i.graphModel.graphDataToModel(le),i.graphModel.translateCenter(),i.extension.miniMap.show();const oe=i.extension.canvasHistory;oe&&oe.setInitialState(le)};let $={};const P=le=>{const G=le.node||le,oe=le.anchorData,de=le.event;if(G.id=G.id||tc(G.type),G.nodeSortKey=G.id.substring(0,8)+G.id.substring(G.id.length-8),le.isCopy||($[G.type]?($[G.type]=$[G.type]+1,G.properties.node_name=G.properties.node_name+$[G.type]):$[G.type]=1),G.properties.width=G.width,G.properties.height=G.height,G.properties.nodeSortKey=G.nodeSortKey,de){const{transformModel:ke}=i.graphModel,{left:Ye,top:Ie}=v.value.getBoundingClientRect(),[Fe,Ot]=ke.HtmlPointToCanvasPoint([de.clientX-Ye,de.clientY-Ie]);G.x=Fe+G.width/2,G.y=Ot+G.height/2}else if(!G.x&&!G.y)if(oe)G.x=oe.x+G.width+100,G.y=oe.y+G.height/2-24;else{const{transformModel:ke}=i.graphModel,Ye=ke.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);G.x=Ye[0],G.y=Ye[1]}return G},I=le=>{const G=P(le),oe=le.model,de=le.anchorData;let ke=0;i.graphModel.nodes.forEach(Ie=>{Ie.zIndex>ke&&(ke=Ie.zIndex)}),ke=ke+1;let Ye=i.addNode(G);de&&i.graphModel.addEdge({type:"custom-edge",sourceNodeId:oe.id,targetNodeId:Ye.id,sourceAnchorId:de.id,startPoint:{x:de.x,y:de.y}}),Ye.setZIndex(ke),i.graphModel.clearSelectElements(),Ye.setSelected(!0)},W=({originalNodes:le,basePoint:G,pasteBasePoint:oe})=>{const de=i.extension.canvasHistory;de&&de.beginTransaction();try{const ke=le.map(Ie=>{const Fe=Ie.x-G.x,Ot=Ie.y-G.y,lt=JSON.parse(JSON.stringify(Ie));return lt.x=oe.x+Fe,lt.y=oe.y+Ot,P({node:lt,isCopy:!0})}),{nodes:Ye}=i.addElements({nodes:ke});i.clearSelectElements(),Ye.forEach(Ie=>{Ie.setSelected(!0)})}finally{de&&de.commitTransaction("paste")}},se=le=>{le.height&&(le.properties.height=le.height);let G=i.getNodeModelById(le.id);G.height=le.properties.height||le.height||G.height,G.properties=le.properties,le.properties.node_type==2&&le.properties.node_sub_type==21&&G.graphModel.getNodeEdges(le.id).forEach(de=>{de.sourceNodeId==G.id&&(G.getAnchorInfo(de.sourceAnchorId)||G.graphModel.deleteEdgeById(de.id))}),G.refreshBranch()};function q(le){return i.getNodeModelById(le.id)}function ee(le){return i.getEdgeModelById(le.id)}const T=le=>{le&&le.id&&(b.value=[le]),pe()},z=le=>{le&&le.id&&(b.value=[le]),pe()},B=()=>{let le=i.getSelectElements(!0);b.value=[...le.nodes,...le.edges],pe()},pe=()=>{if(b.value.length===0)return;const le=b.value.filter(oe=>q(oe)?oe.type!=="start-node":!0);if(le.length===0){b.value=[];return}const G=()=>{const oe=i.extension.canvasHistory;oe&&oe.replaceLastState("replace-before-delete"),le.forEach(de=>{q(de)?i.deleteNode(de.id):ee(de)&&i.deleteEdge(de.id)}),oe&&oe.saveCurrentState("delete"),b.value=[],i.clearSelectElements()};if(l.value){G();return}if(le.length>1||le.length===1&&q(le[0])){const oe=le.length>1?"批量删除":"删除节点",de=`确定要删除选中的 ${le.length} 个元素吗？`;let ke=!1;wr.confirm({title:oe,content:wn("div",{},[wn("p",de),wn(v_,{class:"dont-show-again-checkbox",onChange:Ye=>{ke=Ye.target.checked}},()=>"不再提示")]),onOk:()=>{ke&&(l.value=!0,o(e_,!0)),G()},onCancel:()=>{}})}else G()},Ee=["explain-node","end-node"],ye=le=>{const G=JSON.parse(JSON.stringify(le));G.properties.dataRaw=G.properties.dataRaw||G.properties.node_params,n("selectNode",G),!Ee.includes(le.type)&&(f.value=G,c.value=!0)},it=le=>{f.value.properties=le,se(JSON.parse(JSON.stringify(f.value)))},Oe=le=>{f.value.properties.node_name=le,se(JSON.parse(JSON.stringify(f.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:le,node_id:f.value.id,node_type:f.value.type})},he=le=>{n("onDeleteNode",le),f.value&&le.id===f.value.id&&(c.value=!1,setTimeout(()=>{f.value=null},350))},We=le=>{n("onDeleteEdge",le)},Re=()=>{n("runTest")},Ge=()=>{n("blankClick"),c.value&&(c.value=!1),b.value.length>0&&(b.value=[],i.clearSelectElements())};return qt(()=>{k()}),u_(()=>{i&&i.destroy()}),e({setData:R,getData:D,updateNode:se}),(le,G)=>(Y(),ae("div",Z7,[E("div",{ref_key:"containerRef",ref:v,class:"logic-flow-container"},null,512),j($e(g),{"flow-id":y.value},null,8,["flow-id"]),$e(i)?(Y(),ze(Mk,{key:0,lf:$e(i),onRunTest:Re,onAddNode:I,onZoomChange:C},null,8,["lf"])):et("",!0),f.value?(Y(),ze(jP,{key:1,ref_key:"nodeFormDrawerRef",ref:d,open:c.value,"onUpdate:open":G[0]||(G[0]=oe=>c.value=oe),destroyOnClose:!0,"node-id":f.value.id,node:f.value.properties,"node-type":f.value.type,lf:$e(i),onUpdateNode:it,onChangeTitle:Oe},null,8,["open","node-id","node","node-type","lf"])):et("",!0)]))}},e9={class:"flex-content-box"},t9={class:"test-model-box"},n9={key:2,class:"input-list-box"},r9={class:"add-btn-box"},i9={key:0,class:"result-list-box loading-box"},o9={key:1,class:"result-list-box"},a9=["onClick"],s9={class:"status-block"},l9={class:"icon-name-box"},u9=["src"],d9={class:"node-name"},c9={key:0,class:"time-tag"},f9={class:"right-active-icon"},h9={class:"save-btn-box"},p9={class:"preview-box"},v9={class:"preview-title"},g9={class:"icon-name-box"},m9=["src"],y9={class:"node-name"},_9={key:0,class:"time-tag"},b9={class:"preview-content-block"},x9={class:"title-block"},w9={class:"preview-code-box"},S9={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(r,{expose:e,emit:t}){const n=r,i=tn(()=>n.start_node_params.diy_global||[]),o=t,s=Hl().query,l=xe(!1),d=xe(""),c=xe([]),f=tn(()=>d.value?c.value.filter(I=>I.node_key==d.value)[0]:null),v=xe(!1),g=Jt({is_draft:!0,robot_key:s.robot_key,question:"",openid:"",global:"",globalState:{}}),y=()=>{if(n.isLockedByOther){Rn.warning("当前已有其他用户在编辑中，无法运行测试");return}o("save","automatic");let I=localStorage.getItem("workflow_run_test_data")||"{}";I=JSON.parse(I),g.question=I.question||"",g.openid=I.openid||"",g.global=I.global||"",c.value=[],d.value="",o("getGlobal"),_n(()=>{i.value.forEach(W=>{g.globalState[W.key]=b(W)});try{let W=I.global?JSON.parse(I.global):{};for(let se in g.globalState)W[se]&&(Array.isArray(W[se])?g.globalState[se]=W[se].map(q=>({value:q,key:Math.random()*1e3})):g.globalState[se]=W[se])}catch(W){}}),l.value=!0};function b(I){return I.typ=="string"||I.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function x(){let I={};return i.value.forEach(W=>{if(W.typ=="string"&&(I[W.key]=g.globalState[W.key]),W.typ=="number"&&(I[W.key]=g.globalState[W.key]?+g.globalState[W.key]:""),W.typ=="array<string>"){let se=g.globalState[W.key].map(q=>q.value).filter(q=>q);I[W.key]=se}}),JSON.stringify(I)}const w=(I,W)=>{g.globalState[I].splice(W,1)},_=I=>{g.globalState[I].push({value:"",key:Math.random()*1e4})},C=xe(null),k=()=>{C.value.validate().then(()=>{let I={...g};I.global=x(),delete I.globalState,v.value=!0,c.value=[],localStorage.setItem("workflow_run_test_data",JSON.stringify({...I})),bC({...I}).then(W=>{Rn.success("测试结果生成完成"),D(W.data||[])}).catch(W=>{c.value=[],W.data&&W.data.length&&D(W.data)}).finally(()=>{v.value=!1})})},D=I=>{var W;c.value=I.map(se=>({...se,is_success:se.error_msg==="<nil>",node_icon:_O(se.node_type)})),d.value=(W=c.value[0])==null?void 0:W.node_key},R=I=>{d.value=I.node_key},$=()=>{MC(JSON.stringify(f.value.output)),Rn.success("复制成功")};return e({open:()=>{y()}}),(I,W)=>{const se=b_,q=gs,ee=Cr,T=Xi,z=Ni,B=da,pe=Bn,Ee=Mi,ye=p_,it=wr;return Y(),ae("div",null,[j(it,{open:l.value,"onUpdate:open":W[2]||(W[2]=Oe=>l.value=Oe),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:U(()=>[E("div",e9,[E("div",t9,[W[9]||(W[9]=E("div",{class:"top-title"},"开始节点参数",-1)),j(Ee,{model:g,ref_key:"formRef",ref:C,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:U(()=>[j(T,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:U(()=>[j(q,{gap:4},{default:U(()=>[W[4]||(W[4]=Be("question ")),j(se,{style:{margin:"0"}},{default:U(()=>W[3]||(W[3]=[Be("string")])),_:1,__:[3]})]),_:1,__:[4]})]),default:U(()=>[j(ee,{placeholder:"请输入",value:g.question,"onUpdate:value":W[0]||(W[0]=Oe=>g.question=Oe)},null,8,["value"])]),_:1}),j(T,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:U(()=>[j(q,{gap:4},{default:U(()=>[W[6]||(W[6]=Be("openid ")),j(se,{style:{margin:"0"}},{default:U(()=>W[5]||(W[5]=[Be("string")])),_:1,__:[5]})]),_:1,__:[6]})]),default:U(()=>[j(ee,{placeholder:"请输入",value:g.openid,"onUpdate:value":W[1]||(W[1]=Oe=>g.openid=Oe)},null,8,["value"])]),_:1}),(Y(!0),ae(dt,null,yt(i.value,Oe=>(Y(),ze(T,{name:["globalState",Oe.key],key:Oe.key,rules:[{required:Oe.required,message:`请输入${Oe.key}`}]},{label:U(()=>[j(q,{gap:4},{default:U(()=>[Be(Te(Oe.key)+" ",1),j(se,{style:{margin:"0"}},{default:U(()=>[Be(Te(Oe.typ),1)]),_:2},1024)]),_:2},1024)]),default:U(()=>[Oe.typ=="string"?(Y(),ze(ee,{key:0,placeholder:"请输入",value:g.globalState[Oe.key],"onUpdate:value":he=>g.globalState[Oe.key]=he},null,8,["value","onUpdate:value"])):et("",!0),Oe.typ=="number"?(Y(),ze(z,{key:1,style:{width:"100%"},placeholder:"请输入",value:g.globalState[Oe.key],"onUpdate:value":he=>g.globalState[Oe.key]=he},null,8,["value","onUpdate:value"])):et("",!0),Oe.typ=="array<string>"?(Y(),ae("div",n9,[(Y(!0),ae(dt,null,yt(g.globalState[Oe.key],(he,We)=>(Y(),ae("div",{class:"input-list-item",key:We},[j(B,null,{default:U(()=>[j(ee,{placeholder:"请输入",value:he.value,"onUpdate:value":Re=>he.value=Re},null,8,["value","onUpdate:value"])]),_:2},1024),g.globalState[Oe.key].length>1?(Y(),ze($e(fr),{key:0,onClick:Re=>w(Oe.key,We)},null,8,["onClick"])):et("",!0)]))),128)),E("div",r9,[j(pe,{onClick:he=>_(Oe.key),block:"",type:"dashed"},{default:U(()=>W[7]||(W[7]=[Be("添加")])),_:2,__:[7]},1032,["onClick"])])])):et("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),v.value?(Y(),ae("div",i9,[v.value?(Y(),ze(ye,{key:0,tip:"测试结果生成中..."})):et("",!0)])):et("",!0),c.value.length>0?(Y(),ae("div",o9,[(Y(!0),ae(dt,null,yt(c.value,(Oe,he)=>(Y(),ae("div",{class:Sn(["list-item-block",{active:d.value==Oe.node_key}]),onClick:We=>R(Oe),key:he},[E("div",s9,[Oe.is_success?(Y(),ze($e(x_),{key:0,style:{color:"#138b1b"}})):(Y(),ze($e(iO),{key:1,style:{color:"#d81e06"}}))]),E("div",l9,[E("img",{src:Oe.node_icon,alt:""},null,8,u9),E("div",d9,Te(Oe.node_name),1)]),Oe.is_success?(Y(),ae("div",c9,Te(Oe.use_time)+"ms",1)):et("",!0),E("div",f9,[j($e(oO))])],10,a9))),128))])):et("",!0),E("div",h9,[j(pe,{loading:v.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:U(()=>[j($e(d_)),W[8]||(W[8]=Be("运行测试"))]),_:1,__:[8]},8,["loading"])])]),E("div",p9,[f.value?(Y(),ae(dt,{key:0},[E("div",v9,[W[10]||(W[10]=E("div",{class:"title-text"},"日志详情",-1)),E("div",g9,[E("img",{src:f.value.node_icon,alt:""},null,8,m9),E("div",y9,Te(f.value.node_name),1)]),f.value.is_success?(Y(),ae("div",_9,Te(f.value.use_time)+"ms",1)):et("",!0)]),E("div",b9,[E("div",x9,[W[11]||(W[11]=Be("运行日志")),j($e(aO),{onClick:$})]),E("div",w9,[j($e(yO),{data:f.value.output},null,8,["data"])])])],64)):et("",!0)])])]),_:1},8,["open"])])}}},E9=bt(S9,[["__scopeId","data-v-eb3e0659"]]),C9={class:"page-header"},O9={class:"header-content"},k9={key:1,class:"robot-status-box status-0"},M9={key:0,class:"header-right"},N9={key:0,class:"last-save-time"},A9={key:0,class:"auto-save-hint"},T9={style:{display:"flex","align-items":"center",gap:"8px"}},D9={class:"lock-config"},L9={style:{"margin-top":"24px","text-align":"right"}},P9={key:1,class:"lock-tip"},R9={class:"lock-info"},I9={__name:"page-header",props:{saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(r,{expose:e,emit:t}){const n=Gr(),i=tn(()=>n.robotInfo),o=t,s=r,l=xe(null),d=NC(),c=tn(()=>{var I;const P=(I=d.userInfo)==null?void 0:I.role_type;return P==1||P==2}),f=xe(!1),v=xe(10),g=xe(!1),y=async()=>{g.value=!0;try{await wC({draft_exptime:v.value}),Rn.success("编辑锁设置已保存"),f.value=!1}catch{Rn.error("保存失败，请稍后重试")}finally{g.value=!1}};qt(async()=>{var P;try{const I=await xC(),W=+((P=I==null?void 0:I.data)==null?void 0:P.draft_exptime);typeof W=="number"&&(v.value=Math.max(10,Math.min(60,Math.round(W))))}catch{}});const b=()=>{},x=()=>{o("edit")},w=(P="handle")=>{o("save",P)},_=()=>{o("release")},C=()=>{o("getGlobal")},k=()=>{o("getVersionRecord")},D=()=>{o("edit")},R=()=>{l.value.open()};function $(P,I="YY-MM-DD HH:mm:ss"){return!P||P<=0?"--":Fa(P*1e3).format(I)}return e({openRunTest:R}),(P,I)=>{const W=Bn,se=ki,q=Ir,ee=Ni,T=zh;return Y(),ae("div",C9,[E("div",O9,[j(EO),i.value.start_node_key!=""?(Y(),ae("div",{key:0,class:"robot-status-box status-1",onClick:x},[j($e(x_),{class:"robot-status-icon"}),I[6]||(I[6]=E("div",{class:"robot-status-text"},"已发布",-1))])):(Y(),ae("div",k9,[j($e(sO),{class:"robot-status-icon"}),I[7]||(I[7]=E("div",{class:"robot-status-text"},"未发布",-1))]))]),s.showRight?(Y(),ae("div",M9,[r.currentVersion==""&&r.isEditing?(Y(),ae(dt,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(Y(),ae("div",N9,[Be(Te($(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+Te(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),r.isEditing&&!r.isLockedByOther&&(!r.autoSaveEnabled||!r.isLeader)?(Y(),ae("span",A9,"你可能已在其他页面编辑，已停止自动保存")):et("",!0)])):et("",!0),r.isLockedByOther?et("",!0):(Y(),ae(dt,{key:1},[j(W,{class:"save-draft",onClick:I[0]||(I[0]=z=>w("handle"))},{default:U(()=>I[8]||(I[8]=[Be("保存草稿")])),_:1,__:[8]}),j(W,{type:"primary",loading:s.saveLoading,class:"publish-robot",onClick:_},{default:U(()=>I[9]||(I[9]=[Be("发布机器人")])),_:1,__:[9]},8,["loading"])],64))],64)):et("",!0),!r.isEditing&&!r.currentVersion||r.isLockedByOther?(Y(),ze(W,{key:1,disabled:r.isLockedByOther,type:"primary",class:"ml8",onClick:D},{icon:U(()=>[j($e(Gh))]),default:U(()=>[I[10]||(I[10]=Be(" 编辑 "))]),_:1,__:[10]},8,["disabled"])):et("",!0),j(se,{title:"历史发布详情"},{default:U(()=>[j(W,{onClick:I[1]||(I[1]=z=>k())},{default:U(()=>[j($e(lO))]),_:1})]),_:1}),c.value?(Y(),ze(T,{key:2,trigger:"click",placement:"bottomRight",open:f.value,"onUpdate:open":I[5]||(I[5]=z=>f.value=z),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onVisibleChange:b},{title:U(()=>[E("div",T9,[j(q,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),I[11]||(I[11]=E("span",{style:{color:"#262626"}},"编辑锁设置",-1)),I[12]||(I[12]=E("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:U(()=>[E("div",D9,[I[13]||(I[13]=E("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),j(ee,{value:v.value,"onUpdate:value":I[2]||(I[2]=z=>v.value=z),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),I[14]||(I[14]=E("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),E("div",L9,[j(W,{class:"ml8",onClick:I[3]||(I[3]=z=>f.value=!1)},{default:U(()=>I[15]||(I[15]=[Be("取 消")])),_:1,__:[15]}),j(W,{type:"primary",class:"ml8",loading:g.value,onClick:y},{default:U(()=>I[16]||(I[16]=[Be("保 存")])),_:1,__:[16]},8,["loading"])])]),default:U(()=>[j(W,{class:"",onClick:I[4]||(I[4]=z=>f.value=!0),style:{padding:"5px 9px"}},{default:U(()=>[j(q,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):et("",!0)])):et("",!0),r.isLockedByOther?(Y(),ae("div",P9,[I[17]||(I[17]=E("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),E("div",R9,"（"+Te("用户："+r.loginUserName||"--")+" "+Te("IP："+r.lockRemoteAddr||"--")+" "+Te("User Agent："+r.lockUserAgent||"--")+"）",1)])):et("",!0),j(E9,{ref_key:"runTestRef",ref:l,start_node_params:r.start_node_params,onGetGlobal:C,onSave:w,isLockedByOther:r.isLockedByOther},null,8,["start_node_params","isLockedByOther"])])}}},B9=bt(I9,[["__scopeId","data-v-a34e808f"]]),j9={class:"form-box"},H9={class:"form-item"},$9={class:"form-content"},F9={class:"version-input-box"},z9={class:"form-item"},W9={class:"form-content"},U9={__name:"version-model",emits:["ok"],setup(r,{expose:e,emit:t}){const n=Hl().query,i=xe(!1);let o="";const s=Gr(),l=xe(""),d=xe(""),c=xe(""),f=xe(""),v=xe(!1),g=t,y=w=>{x(),f.value="",o=w,i.value=!0},b=()=>{v.value=!0,EC({robot_key:n.robot_key,node_list:o,version:`${l.value}.${d.value}.${c.value}`,version_desc:f.value,draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}).then(async w=>{await s.getRobot(n.id);const _=+s.robotInfo.draft_save_time||0;s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:_}),i.value=!1,w&&w.res==0&&(Rn.success("发布成功"),g("ok"))}).finally(()=>{v.value=!1})},x=()=>{SC({robot_key:n.robot_key}).then(w=>{let _=w.data.version_params||[];l.value=_[0],d.value=_[1],c.value=_[2]})};return e({show:y}),(w,_)=>{const C=Ni,k=rc,D=wr;return Y(),ae("div",null,[j(D,{open:i.value,"onUpdate:open":_[4]||(_[4]=R=>i.value=R),title:"发布","ok-text":"立即发布",onOk:b,confirmLoading:v.value,width:600},{default:U(()=>[E("div",j9,[E("div",H9,[_[8]||(_[8]=E("div",{class:"form-label"},"版本号：",-1)),E("div",$9,[E("div",F9,[_[5]||(_[5]=Be(" v ")),j(C,{value:l.value,"onUpdate:value":_[0]||(_[0]=R=>l.value=R),precision:0,min:0,max:1e3},null,8,["value"]),_[6]||(_[6]=E("span",null,".",-1)),j(C,{value:d.value,"onUpdate:value":_[1]||(_[1]=R=>d.value=R),precision:0,min:0,max:1e3},null,8,["value"]),_[7]||(_[7]=E("span",null,".",-1)),j(C,{value:c.value,"onUpdate:value":_[2]||(_[2]=R=>c.value=R),precision:0,min:0,max:1e3},null,8,["value"])])])]),E("div",z9,[_[9]||(_[9]=E("div",{class:"form-label"},"版本描述：",-1)),E("div",W9,[j(k,{value:f.value,"onUpdate:value":_[3]||(_[3]=R=>f.value=R),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},V9=bt(U9,[["__scopeId","data-v-72e384f1"]]),X9={class:"version-detail"},G9={class:"version-desc flex-center"},Y9={class:"version-file-box"},K9={class:"version-text"},q9={class:"version-text"},J9=["onClick"],Z9={class:"version-header"},Q9={class:"version-title"},ez={class:"time-text flex-center"},tz={class:"version-file-box"},nz={class:"version-text"},rz={class:"version-text"},iz={class:"version-desc"},oz={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(r,{expose:e,emit:t}){const n=Hl().query,i=xe(!1),o=xe(""),s=xe(""),l=t,d=r,c=Gr(),f=tn(()=>c.robotInfo),v=xe([]),g=()=>{i.value=!0,y(),Wf({robot_key:n.robot_key}).then(_=>{const C=(_==null?void 0:_.data)||{};o.value=C.remote_addr||"",s.value=C.user_agent||""})},y=()=>{CC({robot_key:n.robot_key}).then(_=>{v.value=_.data.versions||[]})},b=_=>{wr.confirm({title:`确定要恢复到v${_.version}版吗`,icon:null,content:wn("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){yg({robot_key:n.robot_key,version_id:_.version_id}).then(C=>{l("setVersion",C.data),i.value=!1,C.res==0&&Rn.success("设置成功")})},onCancel(){}})},x=_=>{_==""?o_({robot_key:n.robot_key,data_type:1}).then(C=>{l("preview",C.data,_),i.value=!1}):yg({robot_key:n.robot_key,version_id:_}).then(C=>{l("preview",C.data,_),i.value=!1})};function w(_,C="YYYY-MM-DD HH:mm:ss"){return _<=0?"--":Fa(_*1e3).format(C)}return e({showDrawer:g}),(_,C)=>{const k=Ir,D=zh,R=Uh,$=Wh,P=Vh,I=dO;return Y(),ae("div",null,[j(I,{open:i.value,"onUpdate:open":C[2]||(C[2]=W=>i.value=W),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:U(()=>[E("div",X9,[f.value.draft_save_time&&f.value.draft_save_time!=0?(Y(),ae("div",{key:0,class:"version-list",onClick:C[0]||(C[0]=W=>x(""))},[C[3]||(C[3]=E("div",{class:"version-header"},[E("div",{class:"version-title"},"当前最新草稿")],-1)),E("div",G9,[Be(" 最近保存于"+Te(w(f.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),E("div",Y9,[j(D,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:U(()=>[E("div",K9," IP："+Te(o.value||"--"),1),E("div",q9," User Agent："+Te(s.value||"--"),1)]),default:U(()=>[j(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):et("",!0),(Y(!0),ae(dt,null,yt(v.value,(W,se)=>(Y(),ae("div",{class:"version-list",onClick:q=>x(W.version_id),key:W.version},[E("div",Z9,[E("div",Q9,[Be(" v"+Te(W.version)+" ",1),E("span",ez,[Be(Te(w(W.create_time))+" ",1),E("div",tz,[j(D,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:U(()=>[E("div",nz," IP："+Te(W.last_edit_ip||"--"),1),E("div",rz," User Agent："+Te(W.last_edit_user_agent||"--"),1)]),default:U(()=>[j(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),j(P,null,{overlay:U(()=>[j($,null,{default:U(()=>[j(R,{disabled:d.isLockedByOther,onClick:q=>b(W)},{default:U(()=>C[4]||(C[4]=[Be(" 恢复到此版本 ")])),_:2,__:[4]},1032,["disabled","onClick"])]),_:2},1024)]),default:U(()=>[E("div",{class:"hover-btn-box",onClick:C[1]||(C[1]=cn(()=>{},["stop"]))},[j($e(uO))])]),_:2},1024)]),E("div",iz,Te(W.version_desc),1)],8,J9))),128))])]),_:1},8,["open"])])}}},az=bt(oz,[["__scopeId","data-v-aa2afdc4"]]),sz={class:"workflow-page"},lz={class:"page-body"},uz={class:"page-left"},dz={class:"page-container"},cz=5*60*1e3,t_=60*1e3,fz=20*1e3,n_="wf_autosave_leader_",r_=2*60*1e3,i_="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",hz={__name:"index",setup(r){const e=Hl(),t=e.query,n=xe(e.query.robot_key),i=xe(null),o=xe(null),s=Gr(),l=xe(""),d=xe(""),c=xe(null),f=bO(),v=xe(!0),g=xe(!1),y=xe(!0);let b=null,x=null,w=Date.now(),_="";const C=xe(""),k=xe(""),D=xe(""),R=xe(!1),$=`${Date.now()}_${Math.random()}`;let P=null;const I=()=>`${n_}${n.value}`,W=()=>`wf_open_tabs_${n.value}`;function se(){try{const je=parseInt(localStorage.getItem(W())||"0",10)||0;localStorage.setItem(W(),String(je+1))}catch(je){console.warn("incrementOpenTabs error",je)}}function q(){try{const je=parseInt(localStorage.getItem(W())||"0",10)||0,De=Math.max(0,je-1);De<=0?setTimeout(()=>{localStorage.removeItem(W()),localStorage.removeItem(I())},0):localStorage.setItem(W(),String(De))}catch(je){console.warn("decrementOpenTabs error",je)}}function ee(){try{const je=Date.now();for(let De=0;De<localStorage.length;De++){const pt=localStorage.key(De);if(pt&&pt.startsWith(n_)){const Ke=localStorage.getItem(pt);let Ze=null;try{Ze=Ke?JSON.parse(Ke):null}catch{Ze=null}(!Ze||typeof Ze.ts!="number"||je-Ze.ts>t_)&&localStorage.removeItem(pt)}}}catch(je){console.warn("cleanupExpiredLeaderKeys error",je)}}function T(){try{const je=localStorage.getItem(I());return je?JSON.parse(je):null}catch{return null}}function z(){localStorage.setItem(I(),JSON.stringify({tabId:$,ts:Date.now()}))}function B(){const je=T();return!je||Date.now()-je.ts>t_?(z(),!0):je.tabId===$}function pe(){const je=T();je&&je.tabId===$&&localStorage.removeItem(I())}function Ee(je){try{const De=localStorage.getItem(je),pt=De?JSON.parse(De):null;pt&&pt.tabId===$&&localStorage.removeItem(je)}catch{}}function ye(je){je.key===I()&&(H(),ee(),R.value=B())}function it(){document.visibilityState==="visible"&&(R.value=B()),ee(),H()}function Oe(){he(),ee(),R.value=B(),P=setInterval(()=>{const je=B();R.value=je,je&&localStorage.setItem(I(),JSON.stringify({tabId:$,ts:Date.now()}))},fz),window.addEventListener("storage",ye),document.addEventListener("visibilitychange",it),window.addEventListener("beforeunload",()=>{pe(),q()}),window.addEventListener("pagehide",()=>{pe(),q()})}function he(){P&&clearInterval(P),P=null,window.removeEventListener("storage",ye),document.removeEventListener("visibilitychange",it),window.removeEventListener("beforeunload",pe)}function We(){try{const je=Ot();return JSON.stringify(je)}catch{return""}}function Re(){Ge(),_=We(),w=Date.now(),x=setInterval(()=>{if(!v.value)return;const je=We();je&&je!==_&&(_=je,w=Date.now(),le())},2*1e3)}function Ge(){x&&clearInterval(x),x=null}function le(){try{if(!v.value||g.value)return;(!y.value||!B())&&(z(),y.value=!0),H()}catch{}}function G(){oe(),b=setInterval(()=>{v.value&&y.value&&Date.now()-w>=cz&&(y.value=!1,Rn.warning("已超过5分钟无改动，自动保存已暂停"),H())},30*1e3)}function oe(){b&&clearInterval(b),b=null}async function de(){try{const je=await Wf({robot_key:n.value}),De=(je==null?void 0:je.data)||{};g.value=!De.lock_res,C.value=De.remote_addr||"",k.value=De.user_agent||"",D.value=De.login_user_name||"",H()}catch{g.value=!1}}async function ke(){try{const je=await Wf({robot_key:n.value}),De=(je==null?void 0:je.data)||{};return De.lock_res?(g.value=!1,C.value="",k.value="",D.value="",!0):(g.value=!De.lock_res,C.value=De.remote_addr||"",k.value=De.user_agent||"",D.value=De.login_user_name||"",!1)}catch{return g.value=!1,!0}}function Ye(je){je=je||[];let De=[],pt=[];je.forEach(Ke=>{if(Ke.node_type==0){let Ze=JSON.parse(Ke.node_info_json);pt.push(Ze)}else{const Ze=f[Ke.node_type];if(Ke.type=Ze,Ke.node_type==1){let wt=JSON.parse(Ke.node_params);wt.start||(wt.start=[]),Ke.node_params=JSON.stringify(wt)}let tt=JSON.parse(Ke.node_info_json);Ke.node_type!=0&&(tt.type=f[Ke.node_type],tt.id=Ke.node_key||tc(tt.type),tt.x=tt.x||0,tt.y=tt.y||0),Ke.node_type==-1&&(Ke.node_params=tt.dataRaw),tt.nodeSortKey?Ke.nodeSortKey=tt.nodeSortKey:Ke.nodeSortKey=tt.id.substring(0,8)+tt.id.substring(tt.id.length-8),Ke.dataRaw=tt.dataRaw||Ke.node_params,delete Ke.node_info_json,tt.properties=Ke,tt.properties.width=tt.width,tt.properties.height=tt.height,De.push(tt)}}),Fe({nodes:De,edges:pt})}const Ie=je=>{i.value.open(je,!0)},Fe=je=>{o.value.setData(je)},Ot=()=>{let je=o.value.getData(),De=[],pt={};return je.edges.forEach(Ke=>{let Ze={node_key:Ke.id,node_name:"edge",node_type:0},tt={...Ke};Ze.node_info_json=tt,De.push(Ze),Ke.sourceAnchorId&&(pt[Ke.sourceAnchorId]=Ke.targetNodeId),Ke.targetAnchorId&&(pt[Ke.targetAnchorId]=Ke.sourceNodeId)}),je.nodes.forEach(Ke=>{let Ze={...Ke.properties,node_type:+Ke.properties.node_type,node_key:Ke.id};Ze.node_info_json={type:Ke.type,x:Ke.x,y:Ke.y,width:Ke.properties.width,height:Ke.properties.height,id:Ke.id,nodeSortKey:Ze.nodeSortKey,dataRaw:Ke.properties.node_params},Ze.next_node_key=pt[Ze.nodeSortKey+"-anchor_right"]||"",Ze.prev_node_key=pt[Ze.nodeSortKey+"-anchor_left"]||"";let tt=JSON.parse(Ze.node_params);if(Ze.node_type==2&&tt.term&&tt.term.length>0&&tt.term.forEach((wt,_e)=>{let Ue=Ze.nodeSortKey+"-anchor_"+_e;wt.next_node_key=pt[Ue]||""}),Ze.node_type==3&&tt.cate&&tt.cate.categorys&&tt.cate.categorys.length>0&&tt.cate.categorys.forEach((wt,_e)=>{let Ue=Ze.nodeSortKey+"-anchor_"+_e;wt.next_node_key=pt[Ue]||""}),Ze.node_type==17){let wt=pt[Ze.nodeSortKey+"-anchor_right_exception"];wt&&(tt.code_run.exception=wt)}Ze.node_params=tt,delete Ze.dataRaw,De.push(Ze)}),De},lt=async je=>{if(g.value){je==="handle"&&Rn.warning("当前已有其他用户在编辑中，无法保存");return}if(!v.value||!y.value&&je==="automatic")return;let De=Ot();if(je==="handle"){const pt=+s.robotInfo.draft_save_time||0,Ke={robot_key:n.value,data_type:1,node_list:JSON.stringify(De),draft_save_type:"handle",draft_save_time:pt,re_cover_save:0},Ze=await Q(Ke,!1);Ze.saved?Rn.success("保存成功"):Ze.behind;return}try{await Uo({robot_key:n.value,data_type:1,node_list:JSON.stringify(De),draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}),await s.getRobot(t.id);const pt=+s.robotInfo.draft_save_time||Fa().unix();s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:pt})}catch{}};let It=null,_t=!1,Yt=!1,Kt=0;async function Q(je,De){var pt,Ke;try{const Ze=await Uo(je);if(!(((pt=Ze==null?void 0:Ze.data)==null?void 0:pt.behind_draft)==1||(Ze==null?void 0:Ze.behind_draft)==1)){await s.getRobot(t.id);const wt=+s.robotInfo.draft_save_time||Fa().unix();return s.setDrafSaveTime({draft_save_type:De?"automatic":"handle",draft_save_time:wt}),{saved:!0,behind:!1}}if(De){const wt=Date.now();if(_t||Yt&&wt-Kt<r_)return y.value=!1,H(),{saved:!1,behind:!0};_t=!0,Yt=!0,Kt=wt}return await new Promise(wt=>{wr.confirm({title:"提示",icon:null,content:i_,okText:"确 定",cancelText:"取 消",async onOk(){var vt;const _e={...je,re_cover_save:1},Ue=await Uo(_e);if(Ue&&Ue.res==0||!((vt=Ue==null?void 0:Ue.data)!=null&&vt.behind_draft)){await s.getRobot(t.id);const St=+s.robotInfo.draft_save_time||Fa().unix();s.setDrafSaveTime({draft_save_type:De?"automatic":"handle",draft_save_time:St})}De&&(y.value=!0,H(),_t=!1,Yt=!1,Kt=Date.now()),wt({saved:!0,behind:!0})},onCancel(){De&&(y.value=!1,H(),_t=!1,Kt=Date.now()),wt({saved:!1,behind:!0})}})})}catch(Ze){if(!(((Ke=Ze==null?void 0:Ze.data)==null?void 0:Ke.behind_draft)==1||(Ze==null?void 0:Ze.behind_draft)==1))return{saved:!1,behind:!1};if(De){const wt=Date.now();if(_t||Yt&&wt-Kt<r_)return y.value=!1,H(),{saved:!1,behind:!0};_t=!0,Yt=!0,Kt=wt}return await new Promise(wt=>{wr.confirm({title:"提示",icon:null,content:i_,okText:"确 定",cancelText:"取 消",async onOk(){var vt;const _e={...je,re_cover_save:1},Ue=await Uo(_e);if(Ue&&Ue.res==0||!((vt=Ue==null?void 0:Ue.data)!=null&&vt.behind_draft)){await s.getRobot(t.id);const St=+s.robotInfo.draft_save_time||Fa().unix();s.setDrafSaveTime({draft_save_type:De?"automatic":"handle",draft_save_time:St})}De&&(y.value=!0,H(),_t=!1,Yt=!1,Kt=Date.now()),wt({saved:!0,behind:!0})},onCancel(){De&&(y.value=!1,H(),_t=!1,Kt=Date.now()),wt({saved:!1,behind:!0})}})})}}async function M(){if(g.value||!v.value||!y.value)return;const je=Ot(),De=+s.robotInfo.draft_save_time||0,pt={robot_key:n.value,data_type:1,node_list:JSON.stringify(je),draft_save_type:"automatic",draft_save_time:De,re_cover_save:0};await Q(pt,!0)}function H(){It&&clearInterval(It),It=null,R.value=B(),v.value&&y.value&&!g.value&&B()&&(It=setInterval(()=>{M()},1*60*1e3))}u_(()=>{It&&clearInterval(It),oe(),Ge(),he(),pe(),q()});const Z=xe(null),X=xe(!1),re=je=>{Z.value.show(je)},ne=async()=>{if(g.value){Rn.warning("当前已有其他用户在编辑中，无法发布");return}let je=Ot(),De=[];for(let pt=0;pt<je.length;pt++){let Ke=je[pt];Ke.node_type==0||Ke.node_type==-1||(Ke.node_type==1?Ke.next_node_key==""&&De.push(Ke):Ke.node_type==7||Ke.node_type==3?Ke.prev_node_key==""&&De.push(Ke):(Ke.next_node_key==""||Ke.prev_node_key=="")&&De.push(Ke))}if(De.length>0){Rn.error("存在未关联的节点，请先关联");return}try{await Uo({robot_key:n.value,data_type:1,node_list:JSON.stringify(je),draft_save_type:"handle",draft_save_time:+s.robotInfo.draft_save_time||0}),await s.getRobot(t.id),s.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+s.robotInfo.draft_save_time||0}),re(JSON.stringify(je))}catch{X.value=!1}};let ue=xe(null);const we=je=>{ue.value=je,je.properties.node_sub_type!=51&&le()},Se=()=>{le()},Pe=async()=>{let je=(De,pt,Ke)=>{const Ze=new Set(De.map(tt=>tt.model_define));return pt.filter(tt=>{let wt=tt[Ke];Ze.has(wt)&&De.filter(_e=>{if(_e.model_define==wt)return _e.children=TC(_e.children,tt.children),!1})}),De};return b1({model_type:"LLM"}).then(De=>{let pt=De.data||[],Ke=[],Ze=[];Ze=pt.map(tt=>{Ke=[];for(let wt=0;wt<tt.model_info.llm_model_list.length;wt++){const _e=tt.model_info.llm_model_list[wt];Ke.push({name:_e,deployment_name:tt.model_config.deployment_name,id:tt.model_config.id,model_define:tt.model_info.model_define})}return{id:tt.model_config.id,name:tt.model_info.model_name,model_define:tt.model_info.model_define,icon:tt.model_info.model_icon_url,children:Ke,deployment_name:tt.model_config.deployment_name}}),Ze=je(AC(Ze,"model_define"),Ze,"model_define"),s.setModelList(Ze)})},Je=xe({diy_global:[],sys_global:[]}),ct=()=>{let De=Ot().filter(pt=>pt.node_type==1);De.length>0&&(Je.value=De[0].node_params.start)},ht=xe(null),Pt=()=>{y.value=!1,H(),ht.value.showDrawer()},qe=je=>{if(g.value){Rn.warning("当前已有其他用户在编辑中，无法恢复");return}const De=Ot();Uo({robot_key:n.value,data_type:1,node_list:JSON.stringify(De),draft_save_type:"handle",draft_save_time:+s.robotInfo.draft_save_time||0}).then(()=>{s.getRobot(t.id).then(()=>{s.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+s.robotInfo.draft_save_time||0})}),l.value="",d.value=null,Ye(je),Rn.success("已保存当前草稿并恢复版本"),v.value=!0,y.value=!0,H()})},ut=async(je,De)=>{if(!g.value){const pt=Ot();try{await Uo({robot_key:n.value,data_type:1,node_list:JSON.stringify(pt),draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}),await s.getRobot(t.id),s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0})}catch{}}d.value=De,clearInterval(It),Ye(je)},Rt=()=>{c.value.openRunTest()};qt(async()=>{se(),await Pe();const je=await o_({robot_key:n.value,data_type:1});Ye(je.data),await de(),g.value?(v.value=!1,y.value=!1,Rn.warning("其他人在编辑，已切换为查看模式")):await ke()?(v.value=!0,y.value=!0):(v.value=!1,y.value=!1),Oe(),H();let De=I();Qt(()=>e.query.robot_key,pt=>{!pt||pt===n.value||(Ee(De),q(),n.value=pt,De=I(),se(),Oe(),H())}),G(),Re(),e.query.show_tips&&Rn.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)});const ot=async()=>{if(g.value){Rn.warning("当前已有其他用户在编辑中，无法编辑");return}await ke()&&(v.value=!0,y.value=!0,_=We(),w=Date.now(),Re(),H(),Rn.success("已进入编辑模式"),Ie(1))};return(je,De)=>(Y(),ae("div",sz,[j(B9,{ref_key:"pageHeaderRef",ref:c,onEdit:ot,onSave:lt,onRelease:ne,onGetGlobal:ct,onGetVersionRecord:Pt,currentVersion:d.value,start_node_params:Je.value,saveLoading:X.value,isEditing:v.value,isLockedByOther:g.value,lockRemoteAddr:C.value,lockUserAgent:k.value,loginUserName:D.value,autoSaveEnabled:y.value,isLeader:R.value},null,8,["currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),E("div",lz,[E("div",uz,[j(DO)]),E("div",dz,[j(Q7,{ref_key:"workflowCanvasRef",ref:o,onSelectedNode:we,onOnDeleteNode:Se,onRunTest:Rt},null,512)])]),j(CO,{ref_key:"addRobotAlertRef",ref:i},null,512),j(V9,{ref_key:"versionModelRef",ref:Z},null,512),j(az,{ref_key:"publishDetailRef",ref:ht,onPreview:ut,onSetVersion:qe,isLockedByOther:g.value},null,8,["isLockedByOther"])]))}},bW=bt(hz,[["__scopeId","data-v-266aed5b"]]);export{bW as default};
