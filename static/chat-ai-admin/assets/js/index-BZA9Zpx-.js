import{ab as ie,e as B,l,f as H,o as pe,b as de,Y as q,_ as k,k as $,a2 as R,F as N,a9 as se,a1 as x,af as z,u as P,G as U,a7 as V,B as _e,ad as ye,d as be,a5 as ae,ae as me,ag as ge,aa as he}from"./vue-chunks-yZ4gwLzA.js";import{u as j}from"./robot-DmLnKp5K.js";import{b as re,d as u,ag as ce}from"../../index-CuFGOJXl.js";import{g as ke}from"./index-DQDi1d6e.js";import{c as we,az as ve,b as Se}from"./ui-antd-BKjlZQNA.js";import{T as Re}from"./top-header-5nj-JJx9.js";import"./index-CfeGYFjs.js";import"./utils-smNh_pj2.js";import"./add-group-BvjxT2FY.js";import"./index-DXUrEY-q.js";const Me={class:"left-menu-box"},qe={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(_,{emit:K}){const i=ie(),r=j(),m=_,s=i.query,M=B(()=>{const o=E.value.find(b=>b.id==="function-center"),a=(o==null?void 0:o.children)||[],c=a.find(b=>b.id==="auto-reply");if(i.path.split("/")[3]==="auto-reply"&&!c)return["function-center"];const n=a.find(b=>b.id==="subscribe-reply");if(i.path.split("/")[3]==="subscribe-reply"&&!n)return["function-center"];const y=a.find(b=>b.id==="smart-menu");return i.path.split("/")[3]==="smart-menu"&&!y?["function-center"]:[i.path.split("/")[3]]}),A=[{key:"workflow",id:"workflow",icon:()=>l(u,{name:"workflow",class:"menu-icon"}),label:"工作流编排",title:"工作流编排",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>l(u,{name:"jichupeizhi",class:"menu-icon"}),label:"基础配置",title:"基础配置",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>l(u,{name:"guanlianzhishiku",class:"menu-icon"}),label:"知识库",title:"知识库",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>l(u,{name:"skii",class:"menu-icon"}),label:"工作流",title:"工作流",path:"/robot/config/skill-config",menuIn:["0"]},{key:"function-center",id:"function-center",icon:()=>l(u,{name:"function-center",class:"menu-icon"}),label:"功能中心",title:"功能中心",path:"/robot/config/function-center",menuIn:["0","1"]},{key:"external-services",id:"external-services",icon:()=>l(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"对外服务",title:"对外服务",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>l(u,{name:"liaotianceshi",class:"menu-icon"}),label:"聊天测试",title:"聊天测试",path:"/robot/test",query:{robot_key:m.robotInfo.robot_key,id:m.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>l(u,{name:"qa-feedback",class:"menu-icon"}),label:"问答反馈",title:"问答反馈",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>l(u,{name:"session-record",class:"menu-icon"}),label:"会话记录",title:"会话记录",path:"/robot/config/session-record",query:{robot_key:m.robotInfo.robot_key,id:m.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>l(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"API Key管理",title:"API Key管理",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"unknown_issue",id:"unknown_issue",icon:()=>l(u,{name:"unknown-issue",class:"menu-icon"}),label:"未知问题",title:"未知问题",path:"/robot/config/unknown_issue",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>l(u,{name:"statistical-analysis",class:"menu-icon"}),label:"统计分析",title:"统计分析",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>l(u,{name:"export-record",class:"menu-icon"}),label:"导出记录",title:"导出记录",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>l(u,{name:"doc-file",class:"menu-icon"}),label:"调用日志",title:"调用日志",path:"/robot/config/invoke-logs",menuIn:["1"]}],S=H(null),I=H(null),L=H(null);async function G(){var o,a,c,n,y,b,t,g,D,O,Y,J,Q,X,Z,ee,oe,ne,te;try{const T=((o=m.robotInfo)==null?void 0:o.id)||s.id;if(!T)return;const F=await ke({robot_id:T}),C=(F==null?void 0:F.data)||[],f=(C||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(f){const e=((a=f==null?void 0:f.robot_config)==null?void 0:a.switch_status)??((c=f==null?void 0:f.user_config)==null?void 0:c.switch_status)??"0",h=((n=f==null?void 0:f.robot_config)==null?void 0:n.ai_reply_status)??((y=f==null?void 0:f.user_config)==null?void 0:y.ai_reply_status)??"0";r.setKeywordReplySwitchStatus(String(e)),r.setKeywordReplyAiReplyStatus(String(h))}else r.setKeywordReplySwitchStatus("0"),r.setKeywordReplyAiReplyStatus("0");const w=(C||[]).find(e=>{var h;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((h=e==null?void 0:e.robot_config)==null?void 0:h.fixed_menu)==="1"});w?S.value={key:"auto-reply",id:"auto-reply",icon:()=>l(u,{name:"auto-reply",class:"menu-icon"}),label:(b=w==null?void 0:w.menu)==null?void 0:b.name,title:(t=w==null?void 0:w.menu)==null?void 0:t.name,path:((g=w==null?void 0:w.menu)==null?void 0:g.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:S.value=null;const p=(C||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(p){const e=((D=p==null?void 0:p.robot_config)==null?void 0:D.switch_status)??((O=p==null?void 0:p.user_config)==null?void 0:O.switch_status)??"0",h=((Y=p==null?void 0:p.robot_config)==null?void 0:Y.ai_reply_status)??((J=p==null?void 0:p.user_config)==null?void 0:J.ai_reply_status)??"0";r.setSubscribeReplySwitchStatus(String(e)),r.setSubscribeReplyAiReplyStatus(String(h))}else r.setSubscribeReplySwitchStatus("0"),r.setSubscribeReplyAiReplyStatus("0");!1||(I.value=null);const d=(C||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_smart_menu");if(d){const e=((Q=d==null?void 0:d.robot_config)==null?void 0:Q.switch_status)??((X=d==null?void 0:d.user_config)==null?void 0:X.switch_status)??"0",h=((Z=d==null?void 0:d.robot_config)==null?void 0:Z.ai_reply_status)??((ee=d==null?void 0:d.user_config)==null?void 0:ee.ai_reply_status)??"0";r.setSmartMenuSwitchStatus(String(e)),r.setSmartMenuAiReplyStatus(String(h))}else r.setSmartMenuSwitchStatus("0"),r.setSmartMenuAiReplyStatus("0");const v=(C||[]).find(e=>{var h;return(e==null?void 0:e.ability_type)==="robot_smart_menu"&&((h=e==null?void 0:e.robot_config)==null?void 0:h.fixed_menu)==="1"});v?L.value={key:"smart-menu",id:"smart-menu",icon:()=>l(u,{name:"smart-menu",class:"menu-icon"}),label:(oe=v==null?void 0:v.menu)==null?void 0:oe.name,title:(ne=v==null?void 0:v.menu)==null?void 0:ne.name,path:((te=v==null?void 0:v.menu)==null?void 0:te.path)||"/robot/ability/smart-menu",menuIn:["0","1"]}:L.value=null}catch(T){console.warn("refreshAbilityMenu failed",T)}}function W(o){var n,y;const a=((n=m.robotInfo)==null?void 0:n.id)||s.id,c=(y=o==null?void 0:o.detail)==null?void 0:y.robotId;!c||!a||String(c)!==String(a)||G()}pe(()=>{G(),window.addEventListener("robotAbilityUpdated",W)}),de(()=>{window.removeEventListener("robotAbilityUpdated",W)});const E=B(()=>{let o=A;ce(s.id)==1?o=o.filter(n=>n.id=="external-services"):o=o.filter(n=>{var y;return n.menuIn.includes((y=m.robotInfo)==null?void 0:y.application_type)});const a=[...o],c=a.findIndex(n=>n.id==="function-center");if(c>=0){const n=[];S.value&&n.push(S.value),I.value&&n.push(I.value),L.value&&n.push(L.value),a[c]={...a[c],children:n}}return a}),le=B(()=>{const o=E.value.find(c=>c.id==="function-center");return o&&Array.isArray(o.children)&&o.children.length>0?["function-center"]:[]}),ue=o=>i.path.split("/")[3]===o.id,fe=({item:o})=>{M.value.includes(o.id)};return(o,a)=>{const c=z("router-link"),n=we,y=ve,b=Se;return k(),q("div",Me,[$(b,{class:"left-menu",mode:"inline",selectedKeys:M.value,openKeys:le.value,onClick:fe},{default:R(()=>[(k(!0),q(N,null,se(E.value,t=>(k(),q(N,{key:t.key},[t.children&&t.children.length?(k(),x(y,{key:t.key,icon:t.icon,class:ye({"submenu-selected":ue(t)})},{title:R(()=>[$(c,{class:"default-color",to:{path:t.path,query:t.query||P(s)},target:t.target||"_self",onClick:a[0]||(a[0]=_e(()=>{},["stop"]))},{default:R(()=>[U(V(t.label),1)]),_:2},1032,["to","target"])]),default:R(()=>[(k(!0),q(N,null,se(t.children,g=>(k(),x(c,{class:"default-color",key:g.key,to:{path:g.path,query:g.query||P(s)},target:g.target||"_self"},{default:R(()=>[(k(),x(n,{icon:g.icon,path:g.path,key:g.key},{default:R(()=>[U(V(g.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["to","target"]))),128))]),_:2},1032,["icon","class"])):(k(),x(c,{key:1,class:"default-color",target:t.target||"_self",to:{path:t.path,query:t.query||P(s)}},{default:R(()=>[(k(),x(n,{icon:t.icon,path:t.path,key:t.key},{default:R(()=>[U(V(t.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))],64))),128))]),_:1},8,["selectedKeys","openKeys"])])}}},Ae=re(qe,[["__scopeId","data-v-e0aaa23e"]]),Ie=be({name:"robotPage",components:{leftMenu:Ae,TopHeader:Re},async beforeRouteEnter(_,K,i){const r=j(),{getRobot:m,robotInfo:s,getRobotLists:M,getGroupList:A}=r;await m(_.query.id),M(),A();let S=ce(_.query.id);if(S==0){i("/no-permission");return}if(S==1){window.location.href=`${s.h5_domain}/#/chat/pc?robot_key=${s.robot_key}`,i("/robot/list");return}let I=["basicConfig","libraryConfig","skillConfig"];if(s.application_type==1&&I.includes(_.name)){i(`/robot/config/workflow?id=${s.id}&robot_key=${s.robot_key}`);return}if(s.application_type==0&&_.name=="robotWorkflow"){i(`/robot/config/basic-config?id=${s.id}&robot_key=${s.robot_key}`);return}i()},setup(){const _=he(),K=j(),{robotInfo:i}=ge(K),r=B(()=>ie().name!="robotWorkflow");return{robotInfo:i,changeMenu:s=>{_.push({path:s.path,query:{robot_key:i.value.robot_key,id:i.value.id}})},isShowLeft:r}}}),Ce={class:"robot-main-container"},xe={class:"robot-page-layout"},$e={key:0,class:"layout-left"},Ke={class:"layout-body"};function Le(_,K,i,r,m,s){const M=z("TopHeader"),A=z("leftMenu"),S=z("router-view");return k(),q("div",Ce,[ae("div",xe,[_.isShowLeft?(k(),q("div",$e,[$(M),$(A,{onChangeMenu:_.changeMenu,robotInfo:_.robotInfo},null,8,["onChangeMenu","robotInfo"])])):me("",!0),ae("div",Ke,[$(S)])])])}const Ge=re(Ie,[["render",Le],["__scopeId","data-v-5283f69c"]]);export{Ge as default};
