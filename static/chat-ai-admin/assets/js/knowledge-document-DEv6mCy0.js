import{_ as to}from"./cu-scroll-CeyRYmkN.js";import{b as ke,aA as Mo,aB as oo,aC as so,aD as Uo,aE as lt,aF as Do,d as $t,aG as Go,aH as Lt,aI as no,aJ as To,aK as zo,aL as Fo,aM as Eo,h as ao,aN as it,aO as No,aP as Ho,e as Po,aQ as Bo,au as Ko,aR as Wo,an as Vo,aS as Ao,aT as Yo,aU as Jo,aV as Qo,aW as jo}from"../../index-ZzVqUZIR.js";import{r as ae,q as lo,Y as l,_ as n,k as t,a2 as s,a5 as e,n as at,a1 as F,ae as v,u as $,a7 as y,F as P,a9 as ue,G as m,B as ne,aa as St,ab as Pe,f as c,e as ve,o as xt,a6 as io,ad as _e,a4 as Xo,J as Ct,b as Zo,A as Qt}from"./vue-chunks-yZ4gwLzA.js";import{w as es,p as qt,a5 as ts,aa as Ot,bs as os,bt as ss,ab as ns,bu as as,x as uo,a as E,M as le,O as He,k as ls,J as Rt,u as Be,v as Ke,g as is,ar as us,I as De,a2 as Ue,X as Ne,D as ro,an as ut,b as _o,c as co,B as It,bv as ds,aN as rs,F as dt,e as Mt,q as _s,R as cs,N as ps,aL as po,H as vs,aJ as ms,a1 as fs,bw as gs,ah as ys,ae as yt,aM as ot,bx as ht,by as hs,bz as ks,av as bs,a7 as ws,W as xs,d as kt}from"./ui-antd-BJtyvQX6.js";import{E as Cs}from"./edit-subsection-CbaTDe4f.js";import{U as vo}from"./upload-input-CJJGHjj1.js";import{t as jt}from"./validate-8MtiUsxW.js";import{M as Xt}from"./model-select-DoQzbsHY.js";import{O as $s}from"./open-grapg-modal-j65Sz4mt.js";import{R as Ls}from"./rename-modal-BXu5gOpJ.js";import{_ as Ss}from"./page-alert-i26_USk5.js";import{d as qs}from"./vuedraggable.umd-BwU7FuvS.js";const Os={class:"subsection-box"},Rs=["onDblclick"],Is={class:"list-item"},Ms={class:"list-content"},Us={class:"status-error"},Ds=["onClick","innerHTML"],Gs={class:"similar-question-list"},Ts={class:"list-item list-item-answer"},zs=["innerHTML"],Fs={class:"fragment-img"},Es=["src"],Ns={class:"right-opration"},Hs=["onClick"],Ps=["onClick"],Bs=["onClick"],Ks=["onClick"],Ws={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(Q,{expose:K,emit:se}){const T=se,h=Q,W=ae({selectedRowKeys:[]}),L=u=>{W.selectedRowKeys=u},N=()=>{W.selectedRowKeys=[]},w=u=>{T("openEditSubscription",u)},b=u=>{le.confirm({title:"提示",icon:t(He),content:"确认是否删除该问答?",onOk(){return new Promise((q,Y)=>{oo({id:u}).then(I=>{E.success("删除成功"),T("handleDelParagraph",u),q()}).catch(()=>{q()})})},onCancel(){}})},R=(u,q)=>{Mo({id:u.id,category_id:q}).then(Y=>{E.success("设置成功"),T("getList")})},S=(u,q,Y)=>{let I=Y.field,U=Y.order;U?U=U==="ascend"?"asc":"desc":I="",T("handleSort",{sort_field:I,sort_type:U})};function p(u,q,Y={}){if(!q||!u)return u;const{highlightClass:I="highlight",caseSensitive:U=!1,wholeWord:j=!1}=Y,D=U?"g":"gi";let G;return j?G=new RegExp(`\\b${V(q)}\\b`,D):G=new RegExp(V(q),D),u.replace(G,x=>`<span class="${I}">${x}</span>`)}function V(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return K({handleOpenEditModal:w,state:W,resetSelect:N}),(u,q)=>{const Y=qt,I=Ot,U=es,j=uo,D=lo("viewer");return n(),l("div",Os,[t(j,{"data-source":Q.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:W.selectedRowKeys,onChange:L},pagination:!1,loading:h.isLoading,onChange:S},{default:s(()=>[t(U,{key:"id","data-index":"id",width:1148},{title:s(()=>[m("问答（共"+y(h.total)+"个）",1)]),default:s(({record:G})=>[e("div",{class:"qa-list-box",onDblclick:x=>w(G)},[e("div",Is,[q[0]||(q[0]=e("div",{class:"list-label"},"问题",-1)),e("div",Ms,[G.status==2?(n(),F(Y,{key:0,placement:"top"},{title:s(()=>[e("span",null,y(G.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Us,[t($(ts))])])]),_:2},1024)):v("",!0),e("span",{onClick:x=>w(G),innerHTML:p(G.question,h.search),class:"question-text"},null,8,Ds),G.similar_questions&&G.similar_questions.length?(n(),F(I,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[e("div",Gs,[(n(!0),l(P,null,ue(G.similar_questions,(x,_)=>(n(),l("div",{class:"similar-question-list-item",key:_},y(x),1))),128))])]),title:s(()=>[e("span",null,"共 "+y(G.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[e("a",null,"（"+y(G.similar_questions.length)+"）",1)]),_:2},1024)):v("",!0)])]),e("div",Ts,[q[1]||(q[1]=e("div",{class:"list-label"},"答案",-1)),e("div",{class:"list-content",innerHTML:p(G.answer,h.search)},null,8,zs)]),at((n(),l("div",Fs,[(n(!0),l(P,null,ue(G.images,(x,_)=>(n(),l("img",{key:_,src:x,alt:""},null,8,Es))),128))])),[[D]])],40,Rs)]),_:1}),t(U,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),t(U,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),t(U,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),t(U,{title:"操作",key:"action","data-index":"action",width:120},{default:s(({record:G,index:x})=>[e("div",Ns,[G.category_id>0?(n(),l("div",{key:0,class:"hover-btn-box",onClick:_=>R(G,0)},[t($(os),{style:{color:"#F59A23"}})],8,Hs)):(n(),l("div",{key:1,class:"hover-btn-box",onClick:_=>R(G,4)},[t($(ss))],8,Ps)),e("div",{class:"hover-btn-box",onClick:ne(_=>w(G),["stop"])},[t($(ns))],8,Bs),e("div",{class:"hover-btn-box",onClick:ne(_=>b(G.id),["stop"])},[t($(as))],8,Ks)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},Vs=ke(Ws,[["__scopeId","data-v-f54edaa7"]]),As={class:"alert-box"},Ys={class:"upload-file-box"},Js={key:0,class:"hight-set"},Qs={key:0,class:"set-box"},js={class:"form-item"},Xs={class:"form-item-body"},Zs={class:"form-item"},en={class:"form-item-body"},tn={class:"form-item"},on={class:"form-item-body"},sn={key:1,class:"set-box"},nn={class:"form-item"},an={class:"form-item-body"},ln={class:"form-item"},un={class:"form-item-body"},dn={class:"form-item"},rn={class:"form-item-body"},_n={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(Q,{expose:K,emit:se}){const T=so(),{qa_index_type:h}=T;St();const L=Pe().query,N=c(!1),w=c(!1),b=c([]),R=se,S=c([]),p=Q,V=ve(()=>p.library_id||L.id),u=ae({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),q=c(!0),Y=x=>{u.group_id=void 0,x>=0&&(u.group_id=x),N.value=!0},I=()=>{let x=new FormData;b.value.forEach(_=>{x.append("library_files",_)}),Uo(x).then(_=>{let O=[];for(let z in _.data)O.push({lable:_.data[z],value:z});S.value=O})},U=()=>{if(b.value.length==0){E.error("请选择文件");return}w.value=!0;let x=new FormData;x.append("library_id",V.value);let _=!1;if(b.value.forEach(O=>{(O.name.includes(".xlsx")||O.name.includes(".csv"))&&(_=!0),x.append("library_files",O)}),_){if(!u.question_column)return w.value=!1,E.error("请选择问题所在列");if(!u.answer_column)return w.value=!1,E.error("请选择答案所在列");x.append("question_column",u.question_column),x.append("answer_column",u.answer_column),u.similar_column&&x.append("similar_column",u.similar_column)}else x.append("question_lable",u.question_lable),x.append("answer_lable",u.answer_lable),x.append("similar_label",u.similar_label);x.append("group_id",u.group_id>=0?u.group_id:0),x.append("is_qa_doc",1),x.append("qa_index_type",h),lt(x).then(O=>{R("ok"),N.value=!1,b.value=[],w.value=!1}).catch(()=>{w.value=!1})},j=()=>{b.value=[]},D=c(1),G=x=>{u.question_column=void 0,u.answer_column=void 0,u.similar_column=void 0,u.question_lable="问题：",u.answer_lable="答案：",u.similar_label="相似问法：",b.value=x,x&&x.length>0&&(x[0].type.includes(".document")?D.value=2:(D.value=1,I()))};return K({show:Y}),(x,_)=>{const O=ls,z=Ke,de=Be,Z=Rt,B=De,be=le;return n(),l("div",null,[t(be,{width:680,open:N.value,"onUpdate:open":_[9]||(_[9]=k=>N.value=k),"confirm-loading":w.value,maskClosable:!1,title:"上传文档",onOk:U,onCancel:j},{default:s(()=>[e("div",As,[t(O,{"show-icon":""},{message:s(()=>[..._[10]||(_[10]=[e("div",null,[m(" 通过word或者Excel形式导入问答，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),m("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),m("创建导入文档 ")],-1),e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),e("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])]),_:1})]),t(Z,{align:"center",style:{margin:"16px 0"}},{default:s(()=>[_[11]||(_[11]=e("div",null,"所属分组：",-1)),t(de,{value:u.group_id,"onUpdate:value":_[0]||(_[0]=k=>u.group_id=k),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),l(P,null,ue(p.groupLists.filter(k=>k.id>=0),k=>(n(),F(z,{value:k.id},{default:s(()=>[m(y(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),e("div",Ys,[t(vo,{type:2,value:b.value,"onUpdate:value":_[1]||(_[1]=k=>b.value=k),onChange:G},null,8,["value"])]),b.value.length>0?(n(),l("div",Js,[e("a",{onClick:_[2]||(_[2]=k=>q.value=!q.value)},[_[12]||(_[12]=m("高级设置： ",-1)),q.value?(n(),F($(us),{key:1})):(n(),F($(is),{key:0}))]),q.value?(n(),l(P,{key:0},[D.value==1?(n(),l("div",Qs,[e("div",js,[_[13]||(_[13]=e("div",{class:"form-item-label required"},"问题所在列：",-1)),e("div",Xs,[t(de,{value:u.question_column,"onUpdate:value":_[3]||(_[3]=k=>u.question_column=k),placeholder:"请选择列名",style:{width:"100%"}},{default:s(()=>[(n(!0),l(P,null,ue(S.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Zs,[_[14]||(_[14]=e("div",{class:"form-item-label"},"相似问法所在列：",-1)),e("div",en,[t(de,{value:u.similar_column,"onUpdate:value":_[4]||(_[4]=k=>u.similar_column=k),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),l(P,null,ue(S.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",tn,[_[15]||(_[15]=e("div",{class:"form-item-label required"},"答案所在列：",-1)),e("div",on,[t(de,{value:u.answer_column,"onUpdate:value":_[5]||(_[5]=k=>u.answer_column=k),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:s(()=>[(n(!0),l(P,null,ue(S.value,k=>(n(),F(z,{value:k.value,key:k.value},{default:s(()=>[m(y(k.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):v("",!0),D.value==2?(n(),l("div",sn,[e("div",nn,[_[16]||(_[16]=e("div",{class:"form-item-label"},"问题开始标识符：",-1)),e("div",an,[t(B,{placeholder:"请输入标识符",value:u.question_lable,"onUpdate:value":_[6]||(_[6]=k=>u.question_lable=k)},null,8,["value"])])]),e("div",ln,[_[17]||(_[17]=e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),e("div",un,[t(B,{placeholder:"请输入标识符",value:u.similar_label,"onUpdate:value":_[7]||(_[7]=k=>u.similar_label=k)},null,8,["value"])])]),e("div",dn,[_[18]||(_[18]=e("div",{class:"form-item-label"},"答案开始标识符：",-1)),e("div",rn,[t(B,{placeholder:"请输入标识符",value:u.answer_lable,"onUpdate:value":_[8]||(_[8]=k=>u.answer_lable=k)},null,8,["value"])])])])):v("",!0)],64)):v("",!0)])):v("",!0)]),_:1},8,["open","confirm-loading"])])}}},mo=ke(_n,[["__scopeId","data-v-f60dc02a"]]),cn={class:"form-item"},pn={class:"form-content"},vn={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(Q,{expose:K,emit:se}){const T=Pe().query,h=c(!1),W=se,L=c("新建分组"),N=Q,w=ae({group_name:"",id:"",library_id:T.id}),b=S=>{w.group_name=S.group_name||"",w.id=S.id||"",L.value=S.id?"编辑分组":"新建分组",w.library_id=S.library_id,h.value=!0},R=()=>{if(!w.group_name)return E.error("请输入分组名称");Do({...w,group_type:N.group_type}).then(S=>{E.success(`${L.value}成功`),h.value=!1,W("ok")})};return K({show:b}),(S,p)=>{const V=De,u=le;return n(),l("div",null,[t(u,{open:h.value,"onUpdate:open":p[1]||(p[1]=q=>h.value=q),title:L.value,onOk:R},{default:s(()=>[e("div",cn,[p[2]||(p[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",pn,[t(V,{maxLength:15,value:w.group_name,"onUpdate:value":p[0]||(p[0]=q=>w.group_name=q),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},fo=ke(vn,[["__scopeId","data-v-239b5ad3"]]),mn={class:"qa-list-wrapper"},fn={class:"group-head-box"},gn={class:"head-title"},yn={class:"flex-between-box"},hn={class:"search-box"},kn={class:"classify-box"},bn=["onClick"],wn={class:"classify-title"},xn={class:"right-content"},Cn={key:0,class:"btn-box"},$n={class:"hover-btn-wrap"},Ln=["onClick"],Sn=["onClick"],qn={class:"main-content-box"},On={class:"head-content"},Rn={class:"title"},In={class:"pover-group-content-box"},Mn={class:"group-head-box"},Un={class:"head-title"},Dn={class:"flex-between-box"},Gn={class:"search-box"},Tn={class:"classify-box classify-scroll-box"},zn=["onClick"],Fn={class:"classify-title"},En={class:"right-content"},Nn={key:0,class:"btn-box"},Hn={class:"hover-btn-wrap"},Pn=["onClick"],Bn=["onClick"],Kn={class:"btn-right-box"},Wn={class:"des-content-block"},Vn={key:0,class:"alert-icon-box"},An={class:"content-block"},Yn={class:"pagination-box"},Zt="qa_document_group_box_width",st=180,bt=256,Jn={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(Q){const K=c(null),T=Pe().query,h=c(""),W=c([]),L=c(-1),N=ve(()=>W.value.find(C=>C.id==L.value)||{}),w=ve(()=>W.value.filter(C=>C.group_name.includes(h.value))),b=Q,R=ve(()=>b.library_id||T.id),S=c([]),p=c(localStorage.getItem("qa_document_group_hide_key")==1),V=c(0),u=c(0),q={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},Y=c({is_qa_doc:"1",library_id:R.value}),I=c({page:1,size:100}),U=ae({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:R.value,search:""}),j=C=>{U.sort_field=C.sort_field,U.sort_type=C.sort_type,D()},D=()=>{I.value.page=1,Z()},G=(C,d)=>{I.value.page=C,I.value.size=d,Z()},x=()=>{p.value=!p.value,localStorage.setItem("qa_document_group_hide_key",p.value?1:2)},_=()=>{zo({id:R.value}).then(()=>{E.success("操作完成"),Z()})},O=c(null),z=C=>{C.group_id||L.value>=0&&(C.group_id=L.value),O.value.showModal(JSON.parse(JSON.stringify(C)))},de=c(!1),Z=()=>{de.value=!0,Go({...I.value,...U,group_id:L.value}).then(C=>{de.value=!1;let d=C.data,ce=d.list||[];ce.forEach(M=>{M.status_text=q[M.status],M.similar_questions&&(M.similar_questions=JSON.parse(M.similar_questions))}),S.value=ce,V.value=d.total,u.value=d.exception_total,K.value&&K.value.resetSelect()})};Z();const B=()=>{Lt({library_id:R.value}).then(C=>{let ce=(C.data||[]).reduce((M,ge)=>M+ +ge.total,0);W.value=[{group_name:"全部分组",id:-1,total:ce},...C.data]})};B();const be=c(null),k=C=>{be.value.show({...C,library_id:R.value})},we=()=>{B(),Z()},Ge=C=>{L.value=C.id,D()},xe=C=>{le.confirm({title:`确认删除分组${C.group_name}`,icon:t(He),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){no({id:C.id}).then(()=>{E.success("删除成功"),B(),L.value==C.id&&(L.value=-1,D())})}})},me=c(null),A=()=>{me.value.show(L.value)},Se=c(!1),re=ae({group_id:void 0,ids:""}),We=()=>{if(K.value.state.selectedRowKeys.length==0)return E.error("请选择你要移动的问答");re.ids=K.value.state.selectedRowKeys.join(","),re.group_id=void 0,Se.value=!0},rt=()=>{if(K.value.state.selectedRowKeys.length==0)return E.error("请选择你要删除的问答");le.confirm({title:"提示",icon:t(He),content:"确认是否删除所选问答?",onOk(){oo({id:K.value.state.selectedRowKeys.join(",")}).then(C=>{E.success("删除成功"),Z()})},onCancel(){}})},_t=()=>{if(!re.group_id)return E.error("请选择分组");Eo({...re}).then(()=>{Se.value=!1,E.success("移动成功"),we()})},ie=c(st),qe=c(!1);xt(()=>{const C=parseInt(localStorage.getItem(Zt));C&&C>=st&&C<=bt&&(ie.value=C)});let Oe=!1,fe=0,ee=0;const Ce=C=>{p.value||(Oe=!0,qe.value=!0,fe=C.clientX,ee=ie.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Ve),document.addEventListener("mouseup",Te))},Ve=C=>{if(!Oe)return;let d=ee+(C.clientX-fe);d=Math.max(st,Math.min(bt,d)),ie.value=d},Te=()=>{Oe&&(Oe=!1,qe.value=!1,localStorage.setItem(Zt,ie.value),document.body.style.cursor="",document.removeEventListener("mousemove",Ve),document.removeEventListener("mouseup",Te))},Re=c(!1),H=()=>{let C="";K.value.state.selectedRowKeys.length>0&&(C=K.value.state.selectedRowKeys.join(",")),To({library_id:T.id,export_type:2,group_id:L.value,data_ids:C}).then(d=>{Re.value=!0})},ct=()=>{Fo.push({path:"/library/details/export-record",query:T})};return(C,d)=>{const ce=$t,M=qt,ge=De,$e=co,Ae=_o,Ye=ro,Je=to,pt=Ot,pe=It,vt=ds,mt=Ke,Qe=Be,ft=Rt,je=le,gt=rs;return n(),l(P,null,[e("div",mn,[e("div",{class:_e(["group-content-box",[{collapsed:p.value},{"no-transition":qe.value}]]),style:io(p.value?{}:{width:ie.value+"px",minWidth:st+"px",maxWidth:bt+"px"})},[e("div",fn,[e("div",gn,[t(M,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:x},[t(ce,{name:"put-away"})])]),_:1}),e("div",yn,[d[16]||(d[16]=e("div",null,"问答分组",-1)),t(M,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:d[0]||(d[0]=g=>k({}))},[t($(Ue))])]),_:1})])]),e("div",hn,[t(ge,{value:h.value,"onUpdate:value":d[2]||(d[2]=g=>h.value=g),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:d[1]||(d[1]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",kn,[t(Je,{style:{"padding-right":"24px"}},{default:s(()=>[(n(!0),l(P,null,ue(w.value,g=>(n(),l("div",{class:_e(["classify-item",{active:g.id==L.value}]),onClick:ye=>Ge(g),key:g.id},[e("div",wn,y(g.group_name),1),e("div",xn,[e("div",{class:_e(["num",{"num-block":g.id<=0}])},y(g.total),3),g.id>0?(n(),l("div",Cn,[t(Ye,{placement:"bottomRight"},{overlay:s(()=>[t(Ae,null,{default:s(()=>[t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>k(g),["stop"])},"重命名",8,Ln)]),_:2},1024),t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>xe(g),["stop"])},"删 除",8,Sn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",$n,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,bn))),128))]),_:1})]),p.value?v("",!0):(n(),l("div",{key:0,class:"resize-bar",onMousedown:Ce},null,32))],6),e("div",qn,[t(Je,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[e("div",On,[e("div",Rn,[p.value?(n(),F(pt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",In,[e("div",Mn,[e("div",Un,[e("div",Dn,[d[17]||(d[17]=e("div",null,"问答分组",-1)),t(M,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:d[3]||(d[3]=g=>k({}))},[t($(Ue))])]),_:1})])]),e("div",Gn,[t(ge,{allowClear:"",value:h.value,"onUpdate:value":d[5]||(d[5]=g=>h.value=g),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:d[4]||(d[4]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",Tn,[(n(!0),l(P,null,ue(w.value,g=>(n(),l("div",{class:_e(["classify-item",{active:g.id==L.value}]),onClick:ye=>Ge(g),key:g.id},[e("div",Fn,y(g.group_name),1),e("div",En,[e("div",{class:_e(["num",{"num-block":g.id<=0}])},y(g.total),3),g.id>0?(n(),l("div",Nn,[t(Ye,{placement:"bottomRight"},{overlay:s(()=>[t(Ae,null,{default:s(()=>[t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>k(g),["stop"])},"重命名",8,Pn)]),_:2},1024),t($e,null,{default:s(()=>[e("div",{onClick:ne(ye=>xe(g),["stop"])},"删 除",8,Bn)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Hn,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,zn))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:x},[t(ce,{name:"expand"})])]),_:1})):v("",!0),e("div",null,y(N.value.group_name),1),e("div",Kn,[e("div",null,[t(ge,{onChange:D,value:U.search,"onUpdate:value":d[6]||(d[6]=g=>U.search=g),placeholder:"搜索问答"},{suffix:s(()=>[t($(Ne))]),_:1},8,["value"])]),t(pe,{onClick:rt},{default:s(()=>[...d[18]||(d[18]=[m("批量删除",-1)])]),_:1}),t(pe,{onClick:We},{default:s(()=>[...d[19]||(d[19]=[m("批量移动",-1)])]),_:1}),t(pe,{onClick:d[7]||(d[7]=g=>A())},{default:s(()=>[...d[20]||(d[20]=[m("批量导入",-1)])]),_:1}),t(pe,{onClick:d[8]||(d[8]=g=>H())},{default:s(()=>[...d[21]||(d[21]=[m("批量导出",-1)])]),_:1}),t(pe,{onClick:d[9]||(d[9]=g=>z({})),type:"primary",icon:t($(Ue))},{default:s(()=>[...d[22]||(d[22]=[m("问答",-1)])]),_:1},8,["icon"])])]),e("div",Wn,[u.value>0?(n(),l("div",Vn,[t(ce,{name:"alert-icon"}),e("div",null,y(u.value)+"个问答学习失败",1),e("a",{onClick:_},"重新学习")])):v("",!0)])]),e("div",An,[t(Vs,{ref_key:"subsectionBoxRef",ref:K,total:V.value,isLoading:de.value,paragraphLists:S.value,search:U.search,onOpenEditSubscription:z,onHandleDelParagraph:we,onGetList:Z,onHandleSort:j},null,8,["total","isLoading","paragraphLists","search"]),e("div",Yn,[t(vt,{current:I.value.page,"onUpdate:current":d[10]||(d[10]=g=>I.value.page=g),"page-size":I.value.size,"onUpdate:pageSize":d[11]||(d[11]=g=>I.value.size=g),total:V.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:G},null,8,["current","page-size","total"])])])]),_:1})])]),t(Cs,{detailsInfo:Y.value,onHandleEdit:we,ref_key:"editSubscriptionRef",ref:O},null,8,["detailsInfo"]),t(fo,{ref_key:"addGroupRef",ref:be,onOk:we},null,512),t(mo,{groupLists:W.value,library_id:Q.library_id,onOk:we,ref_key:"qaUploadModalRef",ref:me},null,8,["groupLists","library_id"]),t(je,{open:Se.value,"onUpdate:open":d[13]||(d[13]=g=>Se.value=g),title:"批量移动分组",onOk:_t},{default:s(()=>[t(ft,{align:"center",style:{margin:"24px 0"}},{default:s(()=>[d[23]||(d[23]=e("div",null,"移动到分组：",-1)),t(Qe,{value:re.group_id,"onUpdate:value":d[12]||(d[12]=g=>re.group_id=g),style:{flex:"1"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),l(P,null,ue(W.value.filter(g=>g.id>=0),g=>(n(),F(mt,{value:g.id},{default:s(()=>[m(y(g.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),t(je,{open:Re.value,"onUpdate:open":d[15]||(d[15]=g=>Re.value=g),title:null,footer:null,width:640},{default:s(()=>[t(gt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:s(()=>[t(pe,{style:{"margin-right":"16px"},onClick:d[14]||(d[14]=g=>Re.value=!1)},{default:s(()=>[...d[24]||(d[24]=[m("知道了",-1)])]),_:1}),t(pe,{onClick:ct,type:"primary"},{default:s(()=>[...d[25]||(d[25]=[m("去下载",-1)])]),_:1})]),_:1})]),_:1},8,["open"])],64)}}},Di=ke(Jn,[["__scopeId","data-v-d2b8e852"]]),Qn={class:"form-box"},jn={class:"upload-document-type-box"},Xn=["onClick"],Zn={class:"right-block"},ea={class:"title-block"},ta={class:"title-text"},oa={class:"desc"},sa={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(Q,{expose:K,emit:se}){const T=St(),h=Pe(),W=dt.useForm,L=c(!1),N=c("添加自定义文档"),w=Q,b=ae({library_id:h.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),R=c([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),S=j=>{b.qa_index_type=j},p=ae({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:V,validate:u,validateInfos:q}=W(b,p),Y=()=>{L.value=!0,V(),b.file_name="",b.is_qa_doc=0,b.qa_index_type=1,b.library_id=w.libraryInfo.id||h.query.id,w.libraryInfo.type==2&&(b.is_qa_doc=1)},I=c(!1),U=()=>{u().then(()=>{let j={...Ct(b),group_id:w.group_id};I.value=!0,lt(j).then(D=>{E.success(`${N.value}成功`),L.value=!1,T.push("/library/preview?id="+D.data.file_ids[0])}).finally(()=>{I.value=!1})})};return K({add:Y}),(j,D)=>{const G=De,x=Mt,_=cs,O=_s,z=$t,de=dt,Z=le;return n(),l("div",null,[t(Z,{open:L.value,"onUpdate:open":D[2]||(D[2]=B=>L.value=B),title:N.value,onOk:U,width:"472px",confirmLoading:I.value},{default:s(()=>[e("div",Qn,[t(de,{layout:"vertical"},{default:s(()=>[t(x,Xo({label:"文档名称"},$(q).file_name),{default:s(()=>[t(G,{type:"text",placeholder:"请输入文档名称",value:b.file_name,"onUpdate:value":D[0]||(D[0]=B=>b.file_name=B)},null,8,["value"])]),_:1},16),v("",!0),b.is_qa_doc==1?(n(),F(x,{key:1,label:"索引方式",required:""},{default:s(()=>[e("div",jn,[(n(!0),l(P,null,ue(R.value,B=>(n(),l("div",{class:_e(["type-item",{active:b.qa_index_type==B.value}]),key:B.value,onClick:be=>S(B.value)},[e("div",Zn,[e("div",ea,[t(z,{name:b.qa_index_type==B.value?B.iconNameActive:B.iconName},null,8,["name"]),e("div",ta,y(B.title),1)]),e("div",oa,y(B.desc),1)]),b.qa_index_type==B.value?(n(),F(z,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],10,Xn))),128))])]),_:1})):v("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},na=ke(sa,[["__scopeId","data-v-2205ab5f"]]),aa="/assets/img/guide-image-DSu20zRj.png",la={class:"container"},ia={class:"guide-content"},ua={class:"content-box"},da={__name:"guide-learning-tips",setup(Q,{expose:K}){const se=ao(),T=c(!1),h=c(!1),W=c(""),L=()=>{setTimeout(()=>{T.value=!0},500)},N=()=>{se.setGuideLearningTips(h.value),T.value=!1},w=()=>{se.setGuideLearningTips(h.value),T.value=!1};return K({show:L}),(b,R)=>{const S=ps,p=It,V=le;return n(),l("div",la,[t(V,{open:T.value,"onUpdate:open":R[1]||(R[1]=u=>T.value=u),title:W.value,onOk:N,onCancel:w,width:"472px"},{footer:s(()=>[t(p,{type:"primary",onClick:N},{default:s(()=>[...R[5]||(R[5]=[m("我知道了",-1)])]),_:1})]),default:s(()=>[e("div",ia,[R[4]||(R[4]=e("img",{src:aa,alt:"操作引导",class:"guide-image"},null,-1)),e("div",ua,[R[3]||(R[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),t(S,{checked:h.value,"onUpdate:checked":R[0]||(R[0]=u=>h.value=u)},{default:s(()=>[...R[2]||(R[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},ra=ke(da,[["__scopeId","data-v-d94a3a33"]]),_a={__name:"edit-online-doc",emits:["ok"],setup(Q,{expose:K,emit:se}){const T=se,h=ae({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),W=c({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),L=c(!1),N=S=>{S=JSON.parse(JSON.stringify(S)),h.id=S.id||"",h.file_name=S.file_name||"",h.doc_auto_renew_frequency=+S.doc_auto_renew_frequency||1,S.doc_auto_renew_minute>0&&(h.doc_auto_renew_minute=it(S.doc_auto_renew_minute)),L.value=!0},w=c(!1),b=c(null),R=()=>{b.value.validate().then(()=>{w.value=!0,No({...h,doc_auto_renew_minute:h.doc_auto_renew_minute?it(h.doc_auto_renew_minute):0}).then(()=>{L.value=!1,w.value=!1,T("ok")})}).catch(()=>{w.value=!1})};return K({show:N}),(S,p)=>{const V=De,u=Mt,q=Ke,Y=Be,I=po,U=dt,j=le;return n(),l("div",null,[t(j,{open:L.value,"onUpdate:open":p[3]||(p[3]=D=>L.value=D),"confirm-loading":w.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:R},{default:s(()=>[t(U,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:b,model:h,rules:W.value},{default:s(()=>[t(u,{name:"file_name",label:"文件名称"},{default:s(()=>[t(V,{value:h.file_name,"onUpdate:value":p[0]||(p[0]=D=>h.file_name=D),placeholder:"请输入"},null,8,["value"])]),_:1}),t(u,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:s(()=>[t(Y,{value:h.doc_auto_renew_frequency,"onUpdate:value":p[1]||(p[1]=D=>h.doc_auto_renew_frequency=D),style:{width:"100%"}},{default:s(()=>[t(q,{value:1},{default:s(()=>[...p[4]||(p[4]=[m("不自动更新",-1)])]),_:1}),t(q,{value:2},{default:s(()=>[...p[5]||(p[5]=[m("每天",-1)])]),_:1}),t(q,{value:3},{default:s(()=>[...p[6]||(p[6]=[m("每3天",-1)])]),_:1}),t(q,{value:4},{default:s(()=>[...p[7]||(p[7]=[m("每7天",-1)])]),_:1}),t(q,{value:5},{default:s(()=>[...p[8]||(p[8]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),h.doc_auto_renew_frequency>1?(n(),F(u,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(I,{valueFormat:"HH:mm",value:h.doc_auto_renew_minute,"onUpdate:value":p[2]||(p[2]=D=>h.doc_auto_renew_minute=D),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},ca={class:"form-item"},pa={class:"form-content"},va={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(Q,{expose:K,emit:se}){const T=c(!1),h=se,W=c("修改分组"),L=Q,N=ae({group_id:"",file_id:""}),w=c([]),b=p=>{N.group_id=p.group_id||"0",N.file_id=p.id||"",S(),T.value=!0},R=()=>{if(!N.group_id)return E.error("请选择分组");Ho({...N,library_id:L.libraryId,sense:L.sense}).then(p=>{E.success(`${W.value}成功`),T.value=!1,h("ok")})},S=()=>{Lt({library_id:L.libraryId,group_type:1}).then(p=>{w.value=p.data||[]})};return K({show:b}),(p,V)=>{const u=Ke,q=Be,Y=le;return n(),l("div",null,[t(Y,{open:T.value,"onUpdate:open":V[1]||(V[1]=I=>T.value=I),title:W.value,onOk:R},{default:s(()=>[e("div",ca,[V[2]||(V[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",pa,[t(q,{value:N.group_id,"onUpdate:value":V[0]||(V[0]=I=>N.group_id=I),style:{width:"100%"},placeholder:"请选择分组"},{default:s(()=>[(n(!0),l(P,null,ue(w.value,I=>(n(),F(u,{value:I.id},{default:s(()=>[m(y(I.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},ma=ke(va,[["__scopeId","data-v-b85f6cc4"]]),fa={class:"details-library-page"},ga={class:"group-head-box"},ya={class:"head-title"},ha={class:"flex-between-box"},ka={class:"classify-box",style:{"margin-top":"16px"}},ba=["onClick"],wa={key:0,class:"drag-btn"},xa={key:1,style:{width:"20px"}},Ca={class:"classify-title"},$a={class:"right-content"},La={key:0,class:"btn-box"},Sa={class:"hover-btn-wrap"},qa=["onClick"],Oa=["onClick"],Ra={class:"main-content-box"},Ia={class:"group-header-title"},Ma={class:"pover-group-content-box"},Ua={class:"group-head-box"},Da={class:"head-title"},Ga={class:"flex-between-box"},Ta={class:"search-box"},za={class:"classify-box classify-scroll-box"},Fa=["onClick"],Ea={class:"classify-title"},Na={class:"right-content"},Ha={key:0,class:"btn-box"},Pa={class:"hover-btn-wrap"},Ba=["onClick"],Ka=["onClick"],Wa={class:"title"},Va={class:"list-tools"},Aa={class:"tools-items"},Ya={class:"right-box"},Ja={key:0,class:"status-box"},Qa={class:"status-item"},ja={class:"status-content"},Xa={class:"status-item"},Za={class:"status-content content-tip"},el={class:"status-item"},tl={class:"status-content content-tip"},ol={key:1,class:"status-select-box"},sl={class:"tool-item"},nl={class:"tool-item"},al={class:"dropdown-btn-menu"},ll={key:0,class:"desc"},il={key:1,class:"desc"},ul={class:"dropdown-btn-menu"},dl={class:"dropdown-btn-menu"},rl={class:"list-content"},_l={key:0,class:"doc-name-td"},cl=["href"],pl=["onClick"],vl={key:0},ml={key:1},fl=["onClick"],gl={key:0},yl={key:1},hl={key:2,class:"url-remark"},kl=["onClick"],bl={key:0,class:"pdf-progress-box"},wl={class:"progress-title"},xl={class:"status-box"},Cl=["onClick"],$l={class:"progress-bar"},Ll={class:"num-box"},Sl={key:0,class:"status-tag running"},ql={key:2,class:"status-tag running"},Ol={key:3,class:"status-tag complete"},Rl={class:"status-tag status-error"},Il=["onClick"],Ml={class:"status-tag status-error"},Ul={class:"status-tag"},Dl=["onClick"],Gl={key:7,class:"status-tag"},Tl={key:8,class:"status-tag running"},zl={class:"status-tag error"},Fl={key:10,class:"status-tag cancel"},El={key:11,class:"status-tag subning"},Nl={class:"status-tag"},Hl=["onClick"],Pl={key:1,class:"status-tag running"},Bl={key:2,class:"status-tag complete"},Kl={class:"status-tag error"},Wl=["onClick"],Vl={class:"zm-line1 reason-text"},Al={key:4,class:"status-tag running"},Yl={class:"status-tag warning"},Jl={class:"reason-text"},Ql=["onClick"],jl={key:0},Xl={key:1},Zl={key:0,class:"text-block"},ei={class:"time-content-box"},ti={key:0},oi={key:1},si={key:2},ni={key:3},ai={key:4},li={key:5,class:"ml4"},ii={key:6},ui=["onClick"],di={key:1},ri={key:0},_i={key:1},ci=["onClick"],pi=["onClick"],vi={class:"upload-file-box"},mi={class:"select-card-box"},fi=["onClick"],gi={class:"card-title"},yi={key:0,class:"card-switch-box"},hi={class:"card-desc"},ki={key:0,class:"card-switch"},eo="qa_document_group_box_width",nt=180,wt=256,bi={__name:"knowledge-document",props:{type:{type:[Number,String],default:()=>2},library_id:{type:[Number,String],default:()=>""}},setup(Q){const{setStorage:K}=Vo("localStorage"),se=so(),{changeGraphSwitch:T}=se,h=Po(),W=ve(()=>{var a;return((a=h.companyInfo)==null?void 0:a.neo4j_status)=="true"}),L=ve(()=>{var a;return((a=h.companyInfo)==null?void 0:a.ali_ocr_switch)=="1"}),N=Q,w=ve(()=>N.library_id||j.id),b=c(localStorage.getItem("document_group_hide_key")==1),R=c(""),S=c([]),p=c(-1),V=ve(()=>S.value.find(a=>a.id==p.value)||{}),u=ve(()=>S.value.filter(a=>a.group_name.includes(R.value))),q=ao(),Y=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],I=Pe(),U=St(),j=I.query,D=c(!1),G=c(null),x=c(null),_=c(!1),O=c({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});ae({selectedRowKeys:[]});const z=ae({use_model:"",model_config_id:""}),de=(a,o)=>{let f=o.modelName,X=o.modelId;xe.value.length>0?le.confirm({title:`确定切换模型为${f}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){z.use_model=f,z.model_config_id=X,Z()},onCancel(){}}):(z.use_model=f,z.model_config_id=X,Z())},Z=(a=!0,o=null)=>{jo({...Ct(O.value),use_model:z.use_model,model_config_id:z.model_config_id}).then(()=>{O.value.use_model=z.use_model,O.value.model_config_id=z.model_config_id,typeof o=="function"&&o(),a&&E.success("保存成功")})},B=c([]),be=a=>{B.value=a},k=c([]),we=a=>{k.value=a,Ge()},Ge=()=>{if(!O.value.id){setTimeout(()=>{Ge()},100);return}if(k.value.length>0&&!O.value.use_model){let a=null,o=null;for(let f of k.value)if(f.model_define==="chatwiki"){a=f;for(let X of a.children)if(X.name==="text-embedding-v2"){o=X;break}break}a||(a=k.value[0],o=a.children[0]),a&&(z.use_model=o.name,z.model_config_id=o.model_config_id,Z(!1))}},xe=c([]),me=ae({learned_err_count:0,learned_count:0,learned_wait_count:0}),A=ae({library_id:w.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),Se=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],re=c([]),We=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"文章更新时间",dataIndex:"official_article_update_time",key:"official_article_update_time",width:220},{title:"合计",dataIndex:"total_hits",key:"total_hits",width:150,sorter:!0},{title:"昨日",dataIndex:"yesterday_hits",key:"yesterday_hits",width:150,sorter:!0},{title:"今日",dataIndex:"today_hits",key:"today_hits",width:150,sorter:!0},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],rt=a=>{ie()},_t=(a,o,f)=>{A.page=a.current,A.size=a.pageSize,A.sort_field="",A.sort_type="",f.order&&f.field&&(A.sort_field=f.field,A.sort_type=f.order=="ascend"?"asc":"desc"),ee()},ie=()=>{A.page=1,ee(),Ie()};let qe=!1;const Oe=({id:a})=>{xe.value.length==1&&(qe=!0),Qo({id:a}).then(()=>{qe&&A.page>1&&A.page--,ee(),Ie(),E.success("删除成功")})},fe=(a,o={})=>{let f=I.name;if(a.status=="4"){if(f=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+a.id+"&page="+A.page);return}return U.push({path:"/library/document-segmentation",query:{document_id:a.id,page:A.page}})}if(a.status=="3"&&O.value.type!=2)return E.error("学习失败,不可预览");if(a.status=="0")return E.error("转换中,稍候可预览");if(a.status=="1")return E.error("学习中,不可预览");if(a.status=="6")return E.error("获取中,不可预览");if(a.status=="7")return E.error("获取失败,不可预览");if(a.status=="10")return E.error("正在分段,不可预览");if(f=="libraryConfig"){window.open("/#/library/preview?id="+a.id);return}U.push({name:"libraryPreview",query:{id:a.id,...o}})},ee=()=>{let a=Ct(A);a.status==0&&(a.status=""),a.group_id=p.value,D.value=!0,Bo(a).then(o=>{let f=o.data.info;!z.use_model&&z.use_model!=f.use_model&&(z.use_model=f.use_model,z.model_config_id=f.model_config_id),O.value={...f},_.value=f.graph_switch==1,f.graph_switch=="0"||!W.value?re.value=We.filter(J=>!["graph_status","graph_entity_count"].includes(J.key)):re.value=We,N.type!=3&&(re.value=re.value.filter(J=>J.key!="official_article_update_time"));let X=o.data.list||[],he=o.data.count_data||{};A.total=o.data.total,me.learned_count=he.learned_count,me.learned_err_count=he.learned_err_count,me.learned_wait_count=he.learned_wait_count;let te=!1;xe.value=X.map(J=>(["1","6","0","5"].includes(J.status)&&(te=!0),J.file_size_str=Ko(J.file_size),J.update_time=kt(J.update_time*1e3).format("YYYY-MM-DD HH:mm"),J.official_article_update_time=kt(J.official_article_update_time*1e3).format("YYYY-MM-DD HH:mm"),J.doc_last_renew_time_desc=J.doc_last_renew_time>0?kt(J.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",J)),te&&Ve(),!te&&clearInterval(Ce.value)}).finally(()=>{D.value=!1})},Ce=c(null),Ve=()=>{clearInterval(Ce.value),Ce.value=setInterval(()=>{ee()},1e3*5)},Te=c(null),Re=a=>{if(k.value.length==0){le.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){U.push({path:"/user/model"})}});return}let{key:o}=a;o==1&&Ae(),o==2&&ct(),o==3&&Te.value.add()},H=ae({open:!1,urls:"",library_id:w.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(a,o)=>jt(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),ct=()=>{H.open=!0,H.confirmLoading=!1,H.urls="",H.doc_auto_renew_minute="02:00",H.doc_auto_renew_frequency=1},C=c(null),d=()=>{C.value.validate().then(()=>{H.confirmLoading=!0,lt({library_id:H.library_id,urls:JSON.stringify(jt(H.urls)),doc_auto_renew_frequency:H.doc_auto_renew_frequency,doc_auto_renew_minute:it(H.doc_auto_renew_minute),doc_type:2,group_id:p.value}).then(()=>{H.open=!1,H.confirmLoading=!1,ie()})}).catch(()=>{H.confirmLoading=!1})},ce=()=>{H.open=!1},M=ae({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ge=ve(()=>M.fileList.filter(a=>a.type==="application/pdf").length>0),$e=c(null),Ae=()=>{if(O.value.type==2){$e.value.show();return}M.fileList=[],M.open=!0},Ye=()=>{M.fileList=[]},Je=a=>{M.fileList=a},pt=()=>{if(G.value&&!q.getGuideLearningTips&&M.fileList.length>1&&G.value.show(),M.fileList.length==0){E.error("请选择文件");return}M.confirmLoading=!0;let a=new FormData;a.append("library_id",A.library_id),a.append("group_id",p.value||0);let o=!1;M.fileList.forEach(f=>{(f.name.includes(".xlsx")||f.name.includes(".csv"))&&(o=!0),a.append("library_files",f)}),ge.value&&a.append("pdf_parse_type",M.pdf_parse_type),lt(a).then(f=>{ee(),M.open=!1,M.fileList=[],M.confirmLoading=!1,o&&f.data.file_ids.length==1&&U.push("/library/document-segmentation?document_id="+f.data.file_ids[0])}).catch(()=>{M.confirmLoading=!1})},pe=c(null),vt=a=>{pe.value.show(a)},mt=a=>{U.push({path:"/library/document-segmentation",query:{document_id:a.id}})},Qe=a=>{Yo({id:a.id}).then(()=>{ee()})},ft=()=>{if(_.value){_.value=!1;let a={graph_model_config_id:O.value.graph_model_config_id,graph_use_model:O.value.graph_use_model};if((!a.graph_model_config_id||!a.graph_use_model)&&B.value.length>0){let f=B.value[0].children[0];a.graph_use_model=f.name,a.graph_model_config_id=f.model_config_id}x.value.show(a)}else O.value.graph_switch=0,Z(!1,()=>{ee(),T(0)})},je=a=>{_.value=!0,O.value.graph_switch=1,O.value.graph_model_config_id=a.graph_model_config_id,O.value.graph_use_model=a.graph_use_model,Z(!1,()=>{ee(),T(1)})},gt=a=>{if(a.key==4&&!L.value)return!1;M.pdf_parse_type=a.key},g=()=>{window.open("#/user/aliocr")},ye=c(null),Ut=a=>{ye.value.show({...a})},go=a=>{Jo({id:a.id}).then(o=>{E.success("更新成功"),ee()})},yo=a=>{le.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){Ao({id:a.id}).then(o=>{E.success("取消成功"),ee()})}})},ho=a=>{K("graph:autoOpenFileId",a.id),U.push({path:"/library/details/knowledge-graph",query:{id:w.value}})},ko=a=>{let o=`/manage/downloadLibraryFile?id=${a.id}&token=${q.getToken}`;var f=document.createElement("a");f.href=o,f.style.display="none",f.click()},Dt=()=>{b.value=!b.value,localStorage.setItem("document_group_hide_key",b.value?1:2)},Ie=()=>{Lt({library_id:w.value,group_type:1}).then(a=>{let f=(a.data||[]).reduce((X,he)=>X+ +he.total,0);S.value=[{group_name:"全部分组",id:-1,total:f},...a.data]})};Ie();const Gt=c(null),Xe=a=>{Gt.value.show({...a,library_id:w.value})},Tt=c(null),bo=a=>{Tt.value.show({...a,sense:1})},zt=()=>{Ie(),ee()},Ft=a=>{p.value=a.id,ie()},Et=a=>{le.confirm({title:`确认删除分组${a.group_name}`,icon:t(He),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){no({id:a.id,sense:1}).then(()=>{E.success("删除成功"),Ie(),p.value==a.id&&(p.value=-1,ie())})}})},ze=c(nt),Ze=c(!1);xt(()=>{const a=parseInt(localStorage.getItem(eo));a&&a>=nt&&a<=wt&&(ze.value=a)});let et=!1,Nt=0,Ht=0;const wo=a=>{b.value||(et=!0,Ze.value=!0,Nt=a.clientX,Ht=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Pt),document.addEventListener("mouseup",Bt))},Pt=a=>{if(!et)return;let o=Ht+(a.clientX-Nt);o=Math.max(nt,Math.min(wt,o)),ze.value=o},Bt=()=>{et&&(et=!1,Ze.value=!1,localStorage.setItem(eo,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",Pt),document.removeEventListener("mouseup",Bt))},xo=a=>a.draggedContext.element.id>0&&a.relatedContext.element.id>0,Co=async()=>{try{const a=S.value.filter(o=>o.id>0).map((o,f)=>({id:o.id,sort:S.value.length-f}));await Wo({library_id:w.value,sense:1,sort_group:JSON.stringify(a)}),E.success("排序已保存")}catch(a){console.error("排序保存失败:",a),Ie()}};return xt(()=>{j.page&&(A.page=+j.page),ee()}),Zo(()=>{Ce.value&&clearInterval(Ce.value)}),(a,o)=>{const f=$t,X=qt,he=De,te=co,J=_o,tt=ro,Kt=to,Wt=Ot,Le=Rt,Me=Ke,Vt=Be,$o=vs,Lo=It,So=gs,Fe=ys,At=ks,qo=uo,Ee=Mt,Yt=dt,Jt=le,Oo=xs,Ro=po,Io=lo("copy");return n(),l("div",fa,[e("div",{class:_e(["group-content-box",[{collapsed:b.value},{"no-transition":Ze.value}]]),style:io(b.value?{}:{width:ze.value+"px",minWidth:nt+"px",maxWidth:wt+"px"})},[e("div",ga,[e("div",ya,[t(X,{title:"收起问答分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Dt},[t(f,{name:"put-away"})])]),_:1}),e("div",ha,[o[17]||(o[17]=e("div",null,"知识分组",-1)),t(X,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=r=>Xe({}))},[t($(Ue))])]),_:1})])]),v("",!0)]),e("div",ka,[t(Kt,{style:{"padding-right":"24px"}},{default:s(()=>[t($(qs),{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=r=>S.value=r),"item-key":"id",disabled:Ze.value,onEnd:Co,move:xo,handle:".drag-btn"},{item:s(({element:r})=>[e("div",{class:_e(["classify-item",{active:r.id==p.value}]),onClick:i=>Ft(r)},[r.id>0?(n(),l("span",wa,[t(f,{name:"drag"})])):(n(),l("span",xa)),e("div",Ca,y(r.group_name),1),e("div",$a,[e("div",{class:_e(["num",{"num-block":r.id<=0}])},y(r.total),3),r.id>0?(n(),l("div",La,[t(tt,{placement:"bottomRight"},{overlay:s(()=>[t(J,null,{default:s(()=>[t(te,null,{default:s(()=>[e("div",{onClick:ne(i=>Xe(r),["stop"])},"重命名",8,qa)]),_:2},1024),t(te,null,{default:s(()=>[e("div",{onClick:ne(i=>Et(r),["stop"])},"删 除",8,Oa)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Sa,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,ba)]),_:1},8,["modelValue","disabled"])]),_:1})]),b.value?v("",!0):(n(),l("div",{key:0,class:"resize-bar",onMousedown:wo},null,32))],6),e("div",Ra,[t(Kt,{scrollbar:!1},{default:s(()=>[e("div",Ia,[b.value?(n(),F(Wt,{key:0,title:null,placement:"bottom"},{content:s(()=>[e("div",Ma,[e("div",Ua,[e("div",Da,[e("div",Ga,[o[18]||(o[18]=e("div",null,"问答分组",-1)),t(X,{title:"新建分组"},{default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=r=>Xe({}))},[t($(Ue))])]),_:1})])]),e("div",Ta,[t(he,{allowClear:"",value:R.value,"onUpdate:value":o[6]||(o[6]=r=>R.value=r),placeholder:"搜索分组",style:{width:"100%"}},{suffix:s(()=>[t($(Ne),{onClick:o[5]||(o[5]=ne(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",za,[(n(!0),l(P,null,ue(u.value,r=>(n(),l("div",{class:_e(["classify-item",{active:r.id==p.value}]),onClick:i=>Ft(r),key:r.id},[e("div",Ea,y(r.group_name),1),e("div",Na,[e("div",{class:_e(["num",{"num-block":r.id<=0}])},y(r.total),3),r.id>0?(n(),l("div",Ha,[t(tt,{placement:"bottomRight"},{overlay:s(()=>[t(J,null,{default:s(()=>[t(te,null,{default:s(()=>[e("div",{onClick:ne(i=>Xe(r),["stop"])},"重命名",8,Ba)]),_:2},1024),t(te,null,{default:s(()=>[e("div",{onClick:ne(i=>Et(r),["stop"])},"删 除",8,Ka)]),_:2},1024)]),_:2},1024)]),default:s(()=>[e("div",Pa,[t($(ut))])]),_:2},1024)])):v("",!0)])],10,Fa))),128))])])]),default:s(()=>[e("div",{class:"hover-btn-wrap",onClick:Dt},[t(f,{name:"expand"})])]),_:1})):v("",!0),e("div",Wa,y(V.value.group_name),1)]),e("div",Va,[e("div",Aa,[at(t(Le,{align:"center",class:"tool-item custom-select-box"},{default:s(()=>[o[19]||(o[19]=e("span",null,"嵌入模型：",-1)),t(Xt,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:z.use_model,modeId:z.model_config_id,style:{width:"240px"},onChange:de,onLoaded:we},null,8,["modeName","modeId"])]),_:1},512),[[Qt,!1]])]),e("div",Ya,[O.value.type==0?(n(),l("div",Ja,[e("div",Qa,[o[20]||(o[20]=e("div",{class:"status-label"},"已学习：",-1)),e("div",ja,y(me.learned_count),1)]),e("div",Xa,[o[21]||(o[21]=e("div",{class:"status-label"},"，未学习：",-1)),e("div",Za,y(me.learned_wait_count),1)]),e("div",el,[o[22]||(o[22]=e("div",{class:"status-label"},"，学习失败：",-1)),e("div",tl,y(me.learned_err_count),1)])])):v("",!0),O.value.type==0?(n(),l("div",ol,[t(Vt,{value:A.status,"onUpdate:value":o[7]||(o[7]=r=>A.status=r),style:{width:"150px"},placeholder:"请选择",onChange:rt},{default:s(()=>[(n(),l(P,null,ue(Se,r=>t(Me,{key:r.id,value:r.id},{default:s(()=>[m(y(r.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):v("",!0),e("div",sl,[t(he,{style:{width:"140px"},value:A.file_name,"onUpdate:value":o[8]||(o[8]=r=>A.file_name=r),placeholder:"文档名称搜索",onChange:ie},{suffix:s(()=>[t($(Ne),{onClick:ie,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),W.value?(n(),F(Le,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:s(()=>[at(t(Xt,{modelType:"LLM",onLoaded:be},null,512),[[Qt,!1]]),o[23]||(o[23]=e("span",null,"生成知识图谱：",-1)),t($o,{checked:_.value,"onUpdate:checked":o[9]||(o[9]=r=>_.value=r),onChange:ft,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})):v("",!0),e("div",nl,[t(tt,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:s(()=>[t(J,{onClick:Re},{default:s(()=>[(n(),F(te,{key:1},{default:s(()=>[e("div",al,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"doc-icon"}),o[24]||(o[24]=e("div",{class:"title"},"本地文档",-1))]),_:1}),O.value.type==2?(n(),l("div",ll," 上传本地 docx/csv/xlsx 等格式文件 ")):(n(),l("div",il," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),O.value.type!=2?(n(),F(te,{key:2},{default:s(()=>[e("div",ul,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"link-icon"}),o[25]||(o[25]=e("div",{class:"title"},"在线数据",-1))]),_:1}),o[26]||(o[26]=e("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):v("",!0),(n(),F(te,{key:3},{default:s(()=>[e("div",dl,[t(Le,{class:"title-block",gap:4},{default:s(()=>[t(f,{name:"cu-doc-icon"}),o[27]||(o[27]=e("div",{class:"title"},"自定义文档",-1))]),_:1}),o[28]||(o[28]=e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1}))]),_:1})]),default:s(()=>[Q.type!=3?(n(),F(Lo,{key:0,type:"primary"},{icon:s(()=>[t($(Ue))]),default:s(()=>[o[29]||(o[29]=e("span",null,"添加内容",-1))]),_:1})):v("",!0)]),_:1})])])]),O.value.type==0?(n(),F(Ss,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:s(()=>[...o[30]||(o[30]=[e("div",null,[e("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),e("p",null,"2、未学习的文档数据不会被检索到。")],-1)])]),_:1})):v("",!0),e("div",rl,[t(qo,{columns:re.value,"data-source":xe.value,scroll:{x:1e3},"row-key":"id",pagination:{current:A.page,total:A.total,pageSize:A.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:_t},{bodyCell:s(({column:r,record:i})=>[r.key==="file_name"?(n(),l("div",_l,[i.doc_type==2?(n(),F(Wt,{key:0,title:null},{content:s(()=>[o[31]||(o[31]=m(" 原链接：",-1)),e("a",{href:i.doc_url,target:"_blank"},y(i.doc_url),9,cl),at(t($(ms),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Io,`${i.doc_url}`]])]),default:s(()=>[e("a",{onClick:oe=>fe(i)},[["5","6","7"].includes(i.status)?(n(),l("span",vl,y(i.doc_url),1)):(n(),l("span",ml,y(i.file_name),1))],8,pl)]),_:2},1024)):(n(),l("a",{key:1,onClick:oe=>fe(i)},[["5","6","7"].includes(i.status)?(n(),l("span",gl,y(i.doc_url),1)):(n(),l("span",yl,y(i.file_name),1))],8,fl)),i.doc_type==2&&i.remark?(n(),l("div",hl," 备注："+y(i.remark),1)):v("",!0)])):v("",!0),r.key==="graph_entity_count"?(n(),l("a",{key:1,onClick:oe=>ho(i)},y(i.graph_entity_count),9,kl)):v("",!0),r.key==="status"?(n(),l(P,{key:2},[i.file_ext=="pdf"&&i.pdf_parse_type>=2?(n(),l(P,{key:0},[i.status==0?(n(),l("div",bl,[e("div",wl,[e("span",xl,[t($(fs)),o[32]||(o[32]=m("文档解析中",-1))]),e("a",{onClick:oe=>yo(i)},"取消",8,Cl)]),e("div",$l,[t(So,{size:"small",class:"progress-bar-box",percent:parseInt(i.ocr_pdf_index/i.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",Ll,y(i.ocr_pdf_index)+" / "+y(i.ocr_pdf_total),1)])])):v("",!0)],64)):(n(),l(P,{key:1},[i.status==0?(n(),l("span",Sl,[t(Fe,{size:"small"}),o[33]||(o[33]=m(" 转换中",-1))])):v("",!0)],64)),i.status==1?(n(),l("span",ql,[t(Fe,{size:"small"}),o[34]||(o[34]=m(" 学习中",-1))])):v("",!0),i.status==2?(n(),l("span",Ol,[t($(yt)),o[35]||(o[35]=m(" 学习完成",-1))])):v("",!0),i.status==3?(n(),F(X,{key:4,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Rl,[t($(ot)),o[36]||(o[36]=m(" 转换失败",-1))]),O.value.type==2?(n(),l("a",{key:0,class:"ml8",onClick:oe=>fe(i)},"学习",8,Il)):v("",!0)])]),_:2},1024)):v("",!0),i.status==8?(n(),F(X,{key:5,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",null,[e("span",Ml,[t($(ot)),o[37]||(o[37]=m(" 转化异常",-1))])])]),_:2},1024)):v("",!0),i.status==4?(n(),l(P,{key:6},[e("span",Ul,[t($(ht)),o[38]||(o[38]=m(" 待学习",-1))]),e("a",{class:"ml8",onClick:oe=>fe(i)},"学习",8,Dl)],64)):v("",!0),i.status==5?(n(),l("span",Gl,[t($(ht)),o[39]||(o[39]=m(" 待获取",-1))])):v("",!0),i.status==6?(n(),l("span",Tl,[t(Fe,{size:"small"}),o[40]||(o[40]=m(" 获取中",-1))])):v("",!0),i.status==7?(n(),F(X,{key:9,placement:"top"},{title:s(()=>[e("span",null,y(i.errmsg),1)]),default:s(()=>[e("span",zl,[t($(ot)),o[41]||(o[41]=m(" 获取失败",-1))])]),_:2},1024)):v("",!0),i.status==9?(n(),l("span",Fl,[t($(He)),o[42]||(o[42]=m(" 取消解析",-1))])):v("",!0),i.status==10?(n(),l("span",El,[t(Fe,{size:"small"}),o[43]||(o[43]=m(" 正在分段 ",-1))])):v("",!0)],64)):v("",!0),r.key==="graph_status"?(n(),l(P,{key:3},[i.graph_status==0?(n(),l(P,{key:0},[e("span",Nl,[t($(ht)),o[44]||(o[44]=m(" 待生成",-1))]),e("a",{class:"ml8",onClick:oe=>Qe(i)},"生成",8,Hl)],64)):i.graph_status==1?(n(),l("span",Pl,[t($(hs)),o[45]||(o[45]=m(" 排队中",-1))])):i.graph_status==2?(n(),l("span",Bl,[t($(yt)),o[46]||(o[46]=m(" 生成完成",-1))])):i.graph_status==3?(n(),l(P,{key:3},[e("span",Kl,[t($(ot)),o[47]||(o[47]=m(" 生成失败",-1))]),e("a",{class:"ml8",onClick:oe=>Qe(i)},"生成",8,Wl),i.graph_err_msg?(n(),F(X,{key:0,title:i.graph_err_msg},{default:s(()=>[e("div",Vl,"原因："+y(i.graph_err_msg),1)]),_:2},1032,["title"])):v("",!0)],64)):i.graph_status==4?(n(),l("span",Al,[t(Fe,{size:"small"}),o[48]||(o[48]=m(" 生成中",-1))])):i.graph_status==5?(n(),l(P,{key:5},[e("span",Yl,[t($(yt)),o[49]||(o[49]=m(" 部分成功",-1))]),e("div",Jl,[m(" 失败数："+y(i.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:oe=>fe(i,{graph_status:3})},"详情",8,Ql)])],64)):v("",!0)],64)):v("",!0),r.key==="file_size"?(n(),l(P,{key:4},[i.doc_type==3?(n(),l("span",jl,"-")):(n(),l("span",Xl,y(i.file_size_str),1))],64)):v("",!0),r.key==="doc_auto_renew_frequency"?(n(),l(P,{key:5},[i.doc_type==2?(n(),l("div",Zl,[e("div",ei,[i.doc_auto_renew_frequency==1?(n(),l("span",ti,"不自动更新")):v("",!0),i.doc_auto_renew_frequency==2?(n(),l("span",oi,"每天")):v("",!0),i.doc_auto_renew_frequency==3?(n(),l("span",si,"每3天")):v("",!0),i.doc_auto_renew_frequency==4?(n(),l("span",ni,"每7天")):v("",!0),i.doc_auto_renew_frequency==5?(n(),l("span",ai,"每30天")):v("",!0),i.doc_auto_renew_frequency>1&&i.doc_auto_renew_minute>0?(n(),l("span",li,y($(it)(i.doc_auto_renew_minute)),1)):v("",!0),i.doc_auto_renew_frequency>1?(n(),l("span",ii,"更新")):v("",!0),e("a",{class:"ml4 btn-hover-block",onClick:oe=>Ut(i)},"修改",8,ui)]),t(Le,{align:"center"},{default:s(()=>[m(" 最近更新: "+y(i.doc_last_renew_time_desc)+" ",1),t(At,{title:"确认更新?",onConfirm:oe=>go(i)},{default:s(()=>[...o[50]||(o[50]=[e("a",{class:"ml4 btn-hover-block"},"更新",-1)])]),_:1},8,["onConfirm"])]),_:2},1024)])):(n(),l("div",di,"--"))],64)):v("",!0),r.key==="paragraph_count"?(n(),l(P,{key:6},[i.status==0||i.status==1?(n(),l("span",ri,"-")):(n(),l("span",_i,y(i.paragraph_count),1))],64)):v("",!0),r.key==="action"?(n(),F(Le,{key:7,gap:8},{default:s(()=>[t(X,null,{title:s(()=>[...o[51]||(o[51]=[m("重新分段",-1)])]),default:s(()=>[t($(bs),{class:"btn-hover-block",onClick:oe=>mt(i)},null,8,["onClick"])]),_:2},1024),t(tt,null,{overlay:s(()=>[t(J,null,{default:s(()=>[i.doc_type==2?(n(),F(te,{key:0},{default:s(()=>[e("div",{onClick:oe=>Ut(i)},"编辑",8,ci)]),_:2},1024)):v("",!0),t(te,{disabled:i.status==6||i.status==7||i.status==0},{default:s(()=>[e("div",{onClick:oe=>fe(i)},"预览",8,pi)]),_:2},1032,["disabled"]),t(te,{onClick:oe=>vt(i)},{default:s(()=>[...o[52]||(o[52]=[e("div",null,"重命名",-1)])]),_:1},8,["onClick"]),t(At,{title:"确定要删除吗?",onConfirm:oe=>Oe(i)},{default:s(()=>[t(te,null,{default:s(()=>[...o[53]||(o[53]=[e("span",null,"删除",-1)])]),_:1})]),_:1},8,["onConfirm"]),t(te,{onClick:oe=>bo(i)},{default:s(()=>[...o[54]||(o[54]=[e("div",null,"修改分组",-1)])]),_:1},8,["onClick"]),t(te,{onClick:oe=>ko(i)},{default:s(()=>[...o[55]||(o[55]=[e("div",null,"下载文档",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[e("div",{class:"table-btn",onClick:o[10]||(o[10]=ne(()=>{},["prevent"]))},[t($(ws),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),t(Jt,{open:M.open,"onUpdate:open":o[12]||(o[12]=r=>M.open=r),"confirm-loading":M.confirmLoading,maskClosable:!1,title:"上传文档",onOk:pt,onCancel:Ye,width:"740px"},{default:s(()=>[t(Yt,{class:"mt24"},{default:s(()=>[t(Ee,{required:"",label:""},{default:s(()=>[e("div",vi,[t(vo,{type:O.value.type,maxCount:20,value:M.fileList,"onUpdate:value":o[11]||(o[11]=r=>M.fileList=r),onChange:Je},null,8,["type","value"])])]),_:1}),ge.value?(n(),F(Ee,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:s(()=>[e("div",mi,[(n(),l(P,null,ue(Y,r=>e("div",{key:r.key,class:_e(["select-card-item",{active:M.pdf_parse_type==r.key},{disabled:r.key==4&&!L.value}]),onClick:ne(i=>gt(r),["stop"])},[t(f,{class:"check-arrow",name:"check-arrow-filled"}),e("div",gi,[t(f,{name:r.icon,style:{"font-size":"16px"}},null,8,["name"]),m(" "+y(r.title)+" ",1),r.key==4&&!L.value?(n(),l("div",yi,"未开启")):v("",!0)]),e("div",hi,y(r.desc),1),r.key==4&&!L.value?(n(),l("div",ki,[o[56]||(o[56]=m(" 未开启阿里云OCR ",-1)),e("div",{class:"card-switch-btn",onClick:ne(g,["stop"])},"去开启")])):v("",!0)],10,fi)),64))])]),_:1})):v("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(mo,{onOk:ee,ref_key:"qaUploadModalRef",ref:$e},null,512),t(Jt,{open:H.open,"onUpdate:open":o[16]||(o[16]=r=>H.open=r),"confirm-loading":H.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:d,onCancel:ce},{default:s(()=>[t(Yt,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:C,model:H,rules:H.rules},{default:s(()=>[t(Ee,{name:"urls",label:"网页链接"},{default:s(()=>[t(Oo,{style:{height:"120px"},value:H.urls,"onUpdate:value":o[13]||(o[13]=r=>H.urls=r),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(Ee,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:s(()=>[t(Vt,{value:H.doc_auto_renew_frequency,"onUpdate:value":o[14]||(o[14]=r=>H.doc_auto_renew_frequency=r),style:{width:"100%"}},{default:s(()=>[t(Me,{value:1},{default:s(()=>[...o[57]||(o[57]=[m("不自动更新",-1)])]),_:1}),t(Me,{value:2},{default:s(()=>[...o[58]||(o[58]=[m("每天",-1)])]),_:1}),t(Me,{value:3},{default:s(()=>[...o[59]||(o[59]=[m("每3天",-1)])]),_:1}),t(Me,{value:4},{default:s(()=>[...o[60]||(o[60]=[m("每7天",-1)])]),_:1}),t(Me,{value:5},{default:s(()=>[...o[61]||(o[61]=[m("每30天",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),H.doc_auto_renew_frequency>1?(n(),F(Ee,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:s(()=>[t(Ro,{valueFormat:"HH:mm",value:H.doc_auto_renew_minute,"onUpdate:value":o[15]||(o[15]=r=>H.doc_auto_renew_minute=r),format:"HH:mm"},null,8,["value"])]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t(na,{libraryInfo:O.value,group_id:p.value,onOk:ie,ref_key:"addCustomDocumentRef",ref:Te},null,8,["libraryInfo","group_id"]),t(Ls,{onOk:ie,ref_key:"renameModalRef",ref:pe},null,512),t($s,{onOk:je,ref_key:"openGrapgModalRef",ref:x},null,512),t(ra,{ref_key:"guideLearningTipsRef",ref:G},null,512),t(_a,{onOk:ee,ref_key:"editOnlineDocRef",ref:ye},null,512),t(fo,{group_type:"1",ref_key:"addGroupRef",ref:Gt,onOk:zt},null,512),t(ma,{libraryId:w.value,sense:1,ref_key:"editGroupRef",ref:Tt,onOk:zt},null,8,["libraryId"])])}}},Gi=ke(bi,[["__scopeId","data-v-8a877929"]]);export{Gi as K,Di as Q};
