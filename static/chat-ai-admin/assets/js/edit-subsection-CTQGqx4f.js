import{b as we,d as qe,aw as Ce,b0 as Le,ax as Me,b1 as Se,ay as De}from"../../index-0SFcfYGN.js";import{f as l,r as Z,w as Ie,ab as Ue,Y as d,_ as i,k as n,a2 as v,n as W,A as X,a5 as t,ae as m,a1 as N,a6 as Ae,u as K,a7 as b,F as Q,a9 as Ee,G as h,ad as ze,y as Oe}from"./vue-chunks-BSjLwu6d.js";import{U as Be}from"./index-Beyh1KL9.js";import{u as Fe}from"./util-BwuffJOK.js";import{C as Ne}from"./index-WmX9Oj3S.js";import{M as Te}from"./index-BMSQkwth.js";import{I as Ve,a2 as je,bi as Ge,bj as $e,u as Ke,v as Qe,Q as Pe,Y as Re,Z as He,O as Ye,B as Je,ax as Ze,M as We,a as x}from"./ui-antd-BIopZvX3.js";const Xe={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},et={class:"custom-modal-header"},tt={key:1},st={key:2},ot={class:"form-box-wrapper"},at={key:0,class:"form-item"},lt={class:"form-content"},nt={key:1,class:"form-item"},it={class:"form-content"},rt={class:"star-item-box"},dt={key:2},ut={class:"form-item"},vt={class:"form-content"},ct={class:"form-item"},_t={class:"form-content"},mt={class:"form-item"},pt={class:"form-content"},ft={key:0,class:"error-tip"},gt={key:3,class:"form-item"},yt={class:"form-content"},bt={key:0,class:"error-tip"},ht={class:"form-item"},xt={class:"form-content"},kt={class:"upload-box-wrapper"},wt={key:0},qt={key:4,class:"form-item"},Ct={class:"form-label-box"},Lt={class:"form-content"},Mt={class:"ai-generate-wrapper"},St={class:"form-box-wrapper ai-generate-wrapper-box"},Dt={class:"ai-generate-wrapper-left"},It={class:"form-box-wrapper-options"},Ut={class:"form-item flex1"},At={class:"form-content"},Et={class:"form-item flex1"},zt={class:"form-content dual-inputs"},Ot={class:"input-group"},Bt={class:"form-label-input-box"},Ft={class:"form-box-wrapper-content"},Nt={class:"problem-box"},Tt={class:"problem-content"},Vt={class:"problem-box"},jt={class:"problem-content"},Gt={class:"form-item generate-btn-box"},$t={class:"result-nav"},Kt={key:0,class:"tip"},Qt={key:1,class:"result-nav-text"},Pt={key:0,class:"container"},Rt={class:"result-container"},Ht=["innerHTML"],Yt={class:"result-footer"},Jt={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(ee,{expose:te,emit:se}){const oe=l(!1),_=l(!1),T=l(!1),q=l(!1),C=l(!1),r=Z({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),ae=new Te({html:!0,linkify:!0,typographer:!0}),P=l(""),L=Z({finish:"",content:""});Ie(()=>L.content,()=>{P.value=ae.render(L.content)});const M=Ue(),le=M.query,S=M.name,I=ee,V=se,ne=l(""),ie=["azure","ollama","xinference","openaiAgent"],R=l("1"),k=l(!1),U=l(""),g=l(""),p=l(""),y=l(""),f=l(""),w=l([]),D=l(0),A=l(""),E=l("0"),c=l(!1),re=s=>{_.value=!1,T.value=!1,C.value=!1,U.value=s.title||"",g.value=s.content||"",A.value=s.id||"",p.value=s.answer||"",w.value=s.images||[],y.value=s.question||"",f.value=s.similar_questions?s.similar_questions.join(`
`):"",c.value=I.detailsInfo.is_qa_doc=="1",D.value=s.category_id||0,E.value=s.group_id||"0",G(),c&&de(),k.value=!0},H=l([]),de=()=>{De({library_id:I.detailsInfo.library_id}).then(s=>{H.value=s.data||[]})},j=l([]),G=()=>{Se({file_id:le.id}).then(s=>{let e=s.data||[];e=e.map(a=>({value:a.id,payload:{...a,color:Xe[a.type]}})),S=="categaryManages"?j.value=[...e]:j.value=[{value:0,payload:{id:0,name:"未标记"}},...e],V("handleStatrList",s.data||[])})},Y=()=>{if(J(),!g.value&&!c.value)return x.error("请输入分段内容");if(!y.value&&c.value)return x.error("请输入分段问题");if(!p.value&&c.value)return x.error("请输入分段答案");if(c.value&&p.value.length>1e4||!c.value&&g.value.length>1e4)return;if(S=="categaryManages"&&D.value<=0)return x.error("请选择分类标记");let s={title:U.value,content:g.value,question:y.value,answer:p.value,images:w.value,category_id:D.value};c.value&&(s.group_id=E.value||0);let e=f.value.trim();e?(e=e.split(`
`),s.similar_questions=JSON.stringify(e)):s.similar_questions="[]",A.value?s.id=A.value:s.file_id=M.query.id;let a=new FormData;for(let u in s)Fe.isArray(s[u])?s[u].forEach($=>{a.append(u,$)}):a.append(u,s[u]);S=="knowledgeDocument"&&(a.delete("file_id"),a.append("library_id",M.query.id)),S=="libraryConfig"&&(a.delete("file_id"),a.append("library_id",I.detailsInfo.library_id)),S=="categaryManages"?(a.delete("file_id"),a.append("library_id",M.query.id),Le(a).then(u=>{x.success(s.id?"修改成功":"添加成功"),k.value=!1,V("handleEdit",{...s}),G()})):Me(a).then(u=>{x.success(s.id?"修改成功":"添加成功"),k.value=!1,V("handleEdit",{...s}),G()})},ue=()=>{_.value=!0},z=l(""),ve=async()=>{L.content="",z.value="",q.value=!0,C.value=!0;try{let s={library_id:I.detailsInfo.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count,question:y.value,answer:p.value};const e=await Ce(s);z.value=e.data.map(a=>a).join(`
`),L.content=e.data.map((a,u)=>`<div class="dialog-message">${u+1}. ${a}</div>`).join(""),T.value=!0}finally{q.value=!1}},ce=()=>{f.value?f.value+=`
${z.value}`:f.value+=z.value,x.success("保存成功"),T.value=!1,_.value=!1,C.value=!1},_e=s=>{r.use_model=ie.includes(s.rawData.model_define)&&s.rawData.deployment_name?s.rawData.deployment_name:s.rawData.name,r.use_model_icon=s.icon,r.use_model_name=s.use_model_name,r.model_config_id=s.rawData.id,ne.value=s.rawData.model_define},O=l([]),me=s=>{O.value=s,Oe(()=>{(!r.ai_chunk_model||!Number(r.ai_chunk_model_config_id))&&pe()})},pe=()=>{if(O.value.length>0){let s=null,e=null;for(let a of O.value)if(a.model_define==="tongyi"){s=a;for(let u of s.children)if(u.name==="qwen-max"){e=u;break}break}s||(s=O.value[0],e=s.children[0]),s&&e&&(r.use_model=e.name,r.model_config_id=e.model_config_id,r.ai_chunk_model=e.name,r.ai_chunk_model_config_id=e.model_config_id)}};function fe(s){return s.split(`
`).map(e=>e.trim()).filter(e=>e).join(`
`)}const J=()=>{f.value=fe(f.value)};return te({showModal:re}),(s,e)=>{const a=Je,u=Ve,$=je,ge=Qe,ye=Ke,B=Pe,F=qe,be=He,he=Re,xe=Ye,ke=We;return i(),d("div",null,[n(ke,{open:k.value,"onUpdate:open":e[13]||(e[13]=o=>k.value=o),onOk:Y,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:_.value?C.value?"944px":"472px":"746px","ok-button-props":{style:{display:_.value?"none":"block"}}},{title:v(()=>[t("div",et,[_.value?(i(),N(a,{key:0,type:"text",class:"back-button",onClick:e[0]||(e[0]=o=>_.value=!1)},{icon:v(()=>[n(K(Ze),{style:{"font-size":"12px"}})]),_:1})):m("",!0),_.value?(i(),d("span",tt,"AI生成相似问法")):(i(),d("span",st,b(A.value?"编辑分段":"新增分段"),1))])]),footer:v(()=>[_.value?m("",!0):(i(),d(Q,{key:0},[n(a,{onClick:e[12]||(e[12]=o=>k.value=!1)},{default:v(()=>e[32]||(e[32]=[h("取消")])),_:1,__:[32]}),n(a,{type:"primary",onClick:Y},{default:v(()=>e[33]||(e[33]=[h("确定")])),_:1,__:[33]})],64))]),default:v(()=>[W(t("div",ot,[c.value?m("",!0):(i(),d("div",at,[e[14]||(e[14]=t("div",{class:"form-label"},"分段标题：",-1)),t("div",lt,[n(u,{maxLength:25,value:U.value,"onUpdate:value":e[1]||(e[1]=o=>U.value=o),placeholder:"请输入分段标题"},null,8,["value"])])])),c.value?m("",!0):(i(),d("div",nt,[e[15]||(e[15]=t("div",{class:"form-label"},"分段分类标记",-1)),t("div",it,[n($,{value:D.value,"onUpdate:value":e[2]||(e[2]=o=>D.value=o),options:j.value},{label:v(({payload:o})=>[t("div",rt,[o.id>0?(i(),N(K(Ge),{key:0,style:Ae({color:o.color})},null,8,["style"])):(i(),N(K($e),{key:1})),t("div",null,b(o.name||"-"),1),o.data_count>0?(i(),d("span",dt,"("+b(o.data_count)+")",1)):m("",!0)])]),_:1},8,["value","options"])])])),c.value?(i(),d(Q,{key:2},[t("div",ut,[e[16]||(e[16]=t("div",{class:"form-label required"},"所属分组：",-1)),t("div",vt,[n(ye,{value:E.value,"onUpdate:value":e[3]||(e[3]=o=>E.value=o),style:{width:"100%"}},{default:v(()=>[(i(!0),d(Q,null,Ee(H.value,o=>(i(),N(ge,{value:o.id},{default:v(()=>[h(b(o.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),t("div",ct,[e[17]||(e[17]=t("div",{class:"form-label required"},"分段问题：",-1)),t("div",_t,[n(B,{placeholder:"请输入分段问题",value:y.value,"onUpdate:value":e[4]||(e[4]=o=>y.value=o),style:{height:"100px"}},null,8,["value"])])]),t("div",mt,[e[18]||(e[18]=t("div",{class:"form-label required"},"分段答案：",-1)),t("div",pt,[n(B,{placeholder:"请输入分段答案",value:p.value,"onUpdate:value":e[5]||(e[5]=o=>p.value=o),style:{height:"100px"}},null,8,["value"]),p.value.length>1e4?(i(),d("div",ft,"分段答案最多支持10000个字符")):m("",!0)])])],64)):(i(),d("div",gt,[e[19]||(e[19]=t("div",{class:"form-label required"},"分段内容：",-1)),t("div",yt,[n(B,{style:{height:"150px"},value:g.value,"onUpdate:value":e[6]||(e[6]=o=>g.value=o),placeholder:"请输入分段内容"},null,8,["value"]),g.value.length>1e4?(i(),d("div",bt,"分段内容最多支持10000个字符")):m("",!0)])])),t("div",ht,[t("div",xt,[t("div",kt,[n(he,{activeKey:R.value,"onUpdate:activeKey":e[7]||(e[7]=o=>R.value=o),size:"small"},{default:v(()=>[n(be,{key:"1"},{tab:v(()=>[t("span",null,[n(F,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),e[20]||(e[20]=h(" 答案附图 ")),w.value.length?(i(),d("span",wt,"("+b(w.value.length)+")",1)):m("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Be,{value:w.value,"onUpdate:value":e[8]||(e[8]=o=>w.value=o)},null,8,["value"])])])]),c.value?(i(),d("div",qt,[t("div",Ct,[e[22]||(e[22]=t("div",{class:"form-label"},"相似问法",-1)),t("div",{class:"ai-generate",onClick:ue},[n(F,{name:"ai-generate",style:{"font-size":"14px"}}),e[21]||(e[21]=t("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),t("div",Lt,[n(B,{placeholder:"请输入相似问法",value:f.value,"onUpdate:value":e[9]||(e[9]=o=>f.value=o),style:{height:"100px"},onBlur:J},null,8,["value"]),e[23]||(e[23]=t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])])):m("",!0)],512),[[X,!_.value]]),W(t("div",Mt,[t("div",St,[t("div",Dt,[t("div",It,[t("div",Ut,[e[24]||(e[24]=t("div",{class:"form-label required"},"相似问法模型：",-1)),t("div",At,[n(Ne,{modelValue:r.use_model,"onUpdate:modelValue":e[10]||(e[10]=o=>r.use_model=o),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":r.model_config_id,onChange:_e,onLoaded:me},null,8,["modelValue","model-config-id"])])]),t("div",Et,[t("div",zt,[t("div",Ot,[e[26]||(e[26]=t("div",{class:"form-label required"},"问题个数：",-1)),t("div",Bt,[n(xe,{value:r.count,"onUpdate:value":e[11]||(e[11]=o=>r.count=o),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),e[25]||(e[25]=h("个 "))])])])])]),t("div",Ft,[t("div",Nt,[e[27]||(e[27]=t("div",{class:"problem"},"问题",-1)),t("div",Tt,b(y.value),1)]),t("div",Vt,[e[28]||(e[28]=t("div",{class:"problem"},"答案",-1)),t("div",jt,b(p.value),1)])]),t("div",Gt,[n(a,{onClick:ve,loading:q.value,class:"generate-btn"},{default:v(()=>[n(F,{name:"ai-generate-white",style:{"font-size":"16px"}}),e[29]||(e[29]=h(" 开始生成 "))]),_:1,__:[29]},8,["loading"])])]),t("div",{class:ze(["ai-generate-wrapper-right",{"show-result":C.value}])},[t("div",$t,[n(F,{name:"generate-icon",style:{"font-size":"14px"}}),q.value?(i(),d("span",Kt,"相似问法生成中...")):(i(),d("div",Qt,"相似问法生成完毕"))]),!L.content&&q.value&&!oe.value?(i(),d("div",Pt,e[30]||(e[30]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):m("",!0),t("div",Rt,[t("div",{class:"dialog-content",innerHTML:P.value},null,8,Ht)]),t("div",Yt,[n(a,{class:"result-footer-btn",type:"primary",onClick:ce},{default:v(()=>e[31]||(e[31]=[h("保存相似问法")])),_:1,__:[31]})])],2)])],512),[[X,_.value]])]),_:1},8,["open","width","ok-button-props"])])}}},as=we(Jt,[["__scopeId","data-v-7b0f66d0"]]);export{as as E,Xe as c};
