import{b as Q,f as ue,m as ge}from"../../index-0TFHdij1.js";import{e as Ue,a as Se,s as Ke,g as Be,b as qe,c as Oe,d as Ge,f as Pe,h as Xe}from"./index-B551IHpY.js";import{f as w,Y as c,_ as n,F as S,a9 as W,ad as he,a7 as C,u as le,a5 as s,k as l,ai as Ve,a2 as o,G as d,a1 as x,ae as f,J as ie,r as de,a4 as Fe,e as z,ab as Ye,w as je,o as ze}from"./vue-chunks-CXJTX1FC.js";import{p as He,B as ce,F as re,e as be,q as xe,R as Me,u as we,v as Le,I as $e,M as ne,a as se,w as _e,x as pe,d as Ee,k as Ce,K as Je,y as De,z as We,E as Qe,G as Ze,H as ye}from"./ui-antd-D3ZAJ1Vq.js";import"./utils-yZpnICoG.js";const et={class:"page-tabs"},tt=["onClick"],ot={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(N,{emit:T}){const{t:h}=ue(),g=T,A=N,E=w([{value:1,title:h("views.user.model.modelsHaveBeenAdded"),langKey:"views.user.model.modelsHaveBeenAdded"},{value:0,title:h("views.user.model.canAddAModel"),langKey:"views.user.model.canAddAModel"}]),e=a=>{g("update:value",a),g("change",a)};return(a,_)=>(n(),c("div",et,[(n(!0),c(S,null,W(E.value,M=>(n(),c("div",{class:he(["tab-item",{active:A.value==M.value}]),onClick:k=>e(M.value),key:M.value},C(le(h)(M.langKey)),11,tt))),128))]))}},lt=Q(ot,[["__scopeId","data-v-5999ba44"]]),nt={class:"model-list"},at={class:"model-item-left"},st={class:"model-item-left-top"},it=["src"],dt={class:"model-name"},ut={class:"model-tags"},_t={class:"tag"},pt={class:"model-item-left-bottom"},mt={class:"model-desc"},rt={class:"model-item-right"},ct={__name:"model-list",props:{type:{type:Number,default:()=>1},list:{type:Array,default:()=>[]}},emits:["edit","new","see","remove","add"],setup(N,{emit:T}){const{t:h}=ue(),g=T,A=N,E=a=>{g("see",ie(a))},e=a=>{g("add",ie(a))};return(a,_)=>{const M=He,k=ce;return n(),c("div",nt,[(n(!0),c(S,null,W(A.list,I=>(n(),c("div",{class:"model-item",key:I.model_define},[s("div",at,[s("div",st,[s("img",{class:"model-logo",src:I.model_icon_url,alt:""},null,8,it),s("div",dt,C(I.model_name),1),_[6]||(_[6]=s("div",{class:"line"},null,-1)),s("div",ut,[(n(!0),c(S,null,W(I.support_list,($,F)=>(n(),c("div",{key:F},[l(M,null,Ve({default:o(()=>[s("span",_t,C($),1)]),_:2},[$=="LLM"?{name:"title",fn:o(()=>[_[0]||(_[0]=d("大语言模型，添加机器人时需要选择一个大语言模型。用户的提问将交由大语言模型，结合知识库给出答案。"))]),key:"0"}:$=="TEXT EMBEDDING"?{name:"title",fn:o(()=>[_[1]||(_[1]=d("嵌入模型，添加知识库时需要选择嵌入模型，用于将知识库分段向量化。用户提问时也会将问题生成向量，通过比对向量相似度的方式四配跟提问语义相近的知识库分段。向量检索具备很好的语义分析能力。"))]),key:"1"}:$=="RERANK"?{name:"title",fn:o(()=>[_[2]||(_[2]=d("重排序模型,通过重排序模型,将从知识库中检索出来的分段进行重新排序。再将重排序的结果前top-K传递个大语言模型生成答案。重排序有助于优化检索结果，提高大语言模型回答的准确性。"))]),key:"2"}:$=="SPEECH2TEXT"?{name:"title",fn:o(()=>[_[3]||(_[3]=d("一种用于将音视频中的语音转化为文字的技术解决方案"))]),key:"3"}:$=="TTS"?{name:"title",fn:o(()=>[_[4]||(_[4]=d("语音合成模型"))]),key:"4"}:$=="IMAGE"?{name:"title",fn:o(()=>[_[5]||(_[5]=d("图像生成模型"))]),key:"5"}:void 0]),1024)]))),128))])]),s("div",pt,[s("div",mt,C(I.introduce),1)])]),s("div",rt,[I.model_define!="azure"?(n(),x(k,{key:0,class:"add-btn",onClick:$=>E(I)},{default:o(()=>_[7]||(_[7]=[d("查看模型")])),_:2,__:[7]},1032,["onClick"])):f("",!0),l(k,{class:"add-btn",onClick:$=>e(I)},{default:o(()=>_[8]||(_[8]=[d("添加配置")])),_:2,__:[8]},1032,["onClick"])])]))),128))])}}},ft=Q(ct,[["__scopeId","data-v-dfc31414"]]),G={componentType:"input",placeholder:"",defaultValue:""},vt={componentType:"radio",defaultValue:void 0},gt={componentType:"select",defaultValue:void 0},ke={id:{hidden:!0},config_name:{...G,label:"配置名称",placeholder:"请输入配置的别名，仅用作展示",rules:[{required:!0,message:"请输入配置名称",trigger:"change"}]},model_types:{...vt,key:"model_types",label:"模型类型",optionsKey:"supported_type",options:[],disabled:!1,rules:[{required:!0,message:"请选择模型类型",trigger:"change"}]},thinking_type:{componentType:"radio2",defaultValue:"0",key:"thinking_type",label:"深度思考",optionsKey:"thinking_type",options:[{label:"支持（类似deepseek r1这种只支持思考模式的模型）",value:"1"},{label:"可选（比如doubao1.6,可以通过接口控制是否启用深度思考模式）",value:"2"},{label:"不支持（比如deepseek v3,模型本身不支持深度思考模式）",value:"0"}],disabled:!1,rules:[{required:!0,message:"请选择深度思考",trigger:"change"}]},deployment_name:{...G,label:"部署名称",placeholder:"请与Azure 部署名称保持一致",rules:[{required:!0,message:"请输入部署名称",trigger:"change"}]},model_name:{...G,label:"模型名称",placeholder:"模型名称请保持一致",rules:[{required:!0,message:"请输入模型名称",trigger:"change"}]},api_endpoint:{...G,label:"API 域名",placeholder:"请输入您的API 域名",rules:[{required:!0,message:"请输入API 域名",trigger:"change"}]},model_context_length:{...G,label:"模型上下文长度",placeholder:"请输入您的模型上下文长度",rules:[{required:!0,message:"请输入模型上下文长度",trigger:"change"}]},model_uid:{...G,label:"模型UID",placeholder:"请输入您的模型UID",rules:[{required:!0,message:"请输入模型UID",trigger:"change"}]},api_key:{...G,label:"API Key",placeholder:"请输入您的API Key",rules:[{required:!0,message:"请输入API Key",trigger:"change"}]},secret_key:{...G,label:"Secret Key",placeholder:"请输入您的Secret Key",rules:[{required:!0,message:"请输入Secret Key",trigger:"change"}]},api_version:{...gt,label:"API 版本",placeholder:"请输入您的API 版本",optionsKey:"api_versions",options:[],rules:[{required:!0,message:"请选择API 版本",trigger:"change"}]},app_id:{...G,label:"appid",placeholder:"请输入appid",rules:[{required:!0,message:"请输入appid",trigger:"change"}]},region:{...G,label:"region",placeholder:"请输入地区",rules:[{required:!0,message:"请输入地区",trigger:"change"}]}};function yt(N,T){if((T=="yiyan"||T=="doubao")&&N=="secret_key")return{...G,label:"Secret Key",placeholder:"请输入您的Secret Key"};if(ke[N])return ke[N];let h={...G};return h.placeholder="请输入您的"+N,h}const kt={class:"form-wrapper"},ht={class:"model-logo-box"},bt=["src"],xt={key:0,href:"https://www.yuque.com/zhimaxiaoshiwangluo/pggco1/hmwl4gveq4xwa4uw?singleDoc# ",target:"_blank"},Mt={class:"form-box"},wt={class:"form-item-label"},Lt={key:0},$t={key:1},Et=["href"],Ct={__name:"set-model-alert",emits:["ok"],setup(N,{expose:T,emit:h}){const{t:g}=ue(),A=h,E=re.useForm,e=w(""),a=de({model_icon_url:"",model_define:"",model_name:""}),_=w(!1),M=w({}),k=w({}),I=w([]),$=["ollama","xinference","openaiAgent"],F=(i,r)=>{M.value={},k.value={},I.value=[];const{model_icon_url:B,model_define:P,model_name:m,history_config_params:ee}=i;let q=i.config_params;e.value=r?g("common.edit")+" "+m:g("common.add")+" "+m,a.model_icon_url=B,a.model_define=P,a.model_name=m;let O={},X={},te=[];q.unshift("id"),q.includes("config_name")||q.unshift("config_name"),r&&ee&&ee.length>0&&(q=[...q,...ee]),q.forEach(u=>{u=="model_type"&&(u="model_types"),$.indexOf(i.model_define)>-1&&u=="deployment_name"&&(u="model_name");let y=yt(u,P);y.key=u,y.help_links=i.help_links,y.disabled=!1,y.key=="model_types"&&r&&(y.disabled=!0);let V=y.options;r?($.indexOf(r.model_define)>-1&&r.deployment_name&&(r.model_name=r.deployment_name),X[u]=r[u]||void 0):X[u]=y.defaultValue,y.optionsKey&&i[y.optionsKey]&&(V=i[y.optionsKey]),y.hidden||te.push({...y,options:V,key:u}),y.rules&&(O[u]=y.rules)}),i.model_define=="doubao"?(r||(X.region="cn-beijing"),te.forEach(u=>{u.key=="deployment_name"&&(u.placeholder="请输入接入点ID")}),O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入接入点ID")):O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入部署名称"),X.config_name||(X.config_name=i.model_name),M.value=O,k.value=X,I.value=te,_.value=!0,setTimeout(()=>{Y()},100)},{resetFields:Z,clearValidate:Y,validate:U,validateInfos:b}=E(k,M),t=()=>{U().then(()=>{k.value.id?j():K()}).catch(i=>{})},R=()=>{Z(),Y()},L=w(!1),K=()=>{let i=ie(k.value),r=JSON.parse(JSON.stringify(i));r.model_type=r.model_types,r.model_define=a.model_define,$.indexOf(r.model_define)>-1&&r.model_name&&(r.deployment_name=r.model_name,delete r.model_name),L.value=!0,Se(r).then(B=>{L.value=!1,_.value=!1,se.success(g("common.saveSuccess")),A("ok",B.data)}).catch(()=>{L.value=!1})},j=()=>{let i=ie(k.value),r=JSON.parse(JSON.stringify(i));r.model_type=r.model_types,r.model_define=a.model_define,$.indexOf(r.model_define)>-1&&r.model_name&&(r.deployment_name=r.model_name,delete r.model_name),L.value=!0,Ue(r).then(()=>{L.value=!1,_.value=!1,se.success(g("common.saveSuccess")),A("ok")}).catch(()=>{L.value=!1})};return T({open:F}),(i,r)=>{const B=Me,P=xe,m=Le,ee=we,q=$e,O=be,X=re,te=ne;return n(),x(te,{class:"add-model-alert",width:"650px",open:_.value,"onUpdate:open":r[0]||(r[0]=u=>_.value=u),title:e.value,confirmLoading:L.value,onOk:t,onCancel:R,maskClosable:!1},{default:o(()=>[s("div",kt,[s("div",ht,[s("img",{class:"model-logo",src:a.model_icon_url,alt:""},null,8,bt),a.model_define=="doubao"?(n(),c("a",xt,"查看使用说明>")):f("",!0)]),s("div",Mt,[l(X,{layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18}},{default:o(()=>[(n(!0),c(S,null,W(I.value,u=>(n(),c(S,{key:u.key},[u.hidden?f("",!0):(n(),x(O,Fe({key:0,ref_for:!0},le(b)[u.key]),{label:o(()=>[s("div",wt,[a.model_define=="doubao"&&u.key=="deployment_name"?(n(),c("span",Lt,"接入点ID")):(n(),c("span",$t,C(le(g)("views.user.model."+u.key)),1))])]),default:o(()=>[u.componentType=="radio"?(n(),x(P,{key:0,value:k.value[u.key],"onUpdate:value":y=>k.value[u.key]=y,disabled:u.disabled},{default:o(()=>[(n(!0),c(S,null,W(u.options,(y,V)=>(n(),x(B,{value:y,key:V},{default:o(()=>[s("span",null,C(y),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])):f("",!0),u.componentType=="radio2"?(n(),x(P,{key:1,value:k.value[u.key],"onUpdate:value":y=>k.value[u.key]=y,disabled:u.disabled},{default:o(()=>[(n(!0),c(S,null,W(u.options,(y,V)=>(n(),x(B,{style:{"line-height":"32px"},value:y.value,key:y.value},{default:o(()=>[s("span",null,C(y.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])):f("",!0),u.componentType=="select"?(n(),x(ee,{key:2,value:k.value[u.key],"onUpdate:value":y=>k.value[u.key]=y,placeholder:u.placeholder},{default:o(()=>[(n(!0),c(S,null,W(u.options,(y,V)=>(n(),x(m,{value:y,key:V},{default:o(()=>[s("span",null,C(y),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):f("",!0),u.componentType=="input"?(n(),c(S,{key:3},[l(q,{value:k.value[u.key],"onUpdate:value":y=>k.value[u.key]=y,placeholder:u.placeholder},null,8,["value","onUpdate:value","placeholder"]),u.key=="api_key"?(n(),c("a",{key:0,href:u.help_links,target:"_blank"},C(le(g)("views.user.model.getApikeyText")),9,Et)):f("",!0)],64)):f("",!0)]),_:2},1040))],64))),128))]),_:1})])])]),_:1},8,["open","title","confirmLoading"])}}},Dt=Q(Ct,[["__scopeId","data-v-a4d8cebd"]]),Tt={class:"form-wrapper"},It={class:"tools-wrapper"},At=["src"],Rt={__name:"see-model-alert",setup(N,{expose:T}){const h=w({}),g=w(!1),A=w([]);return T({open:e=>{h.value=e,A.value=e.use_model_configs||[],g.value=!0}}),(e,a)=>{const _=_e,M=pe,k=ne;return n(),x(k,{class:"add-model-alert",width:"800px",open:g.value,"onUpdate:open":a[0]||(a[0]=I=>g.value=I),title:"模型列表",footer:null},{default:o(()=>[s("div",Tt,[s("div",It,[s("img",{class:"model-logo",src:h.value.model_icon_url,alt:""},null,8,At),s("span",null,C(h.value.model_name),1)]),l(M,{"data-source":A.value,pagination:!1,scroll:{y:500}},{default:o(()=>[l(_,{key:"show_model_name",title:"模型名称","data-index":"show_model_name"}),l(_,{key:"model_type",title:"模型类型","data-index":"model_type"})]),_:1},8,["data-source"])])]),_:1},8,["open"])}}},Nt=Q(Rt,[["__scopeId","data-v-767aaf20"]]),Ut={__name:"buy-record",props:{list:{type:Array,default:()=>[]}},setup(N,{expose:T}){const h=w(!1),g=E=>E<=0?"--":Ee(E*1e3).format("YYYY/MM/DD HH:mm:ss");return T({show:()=>{h.value=!0}}),(E,e)=>{const a=_e,_=pe,M=ne;return n(),c("div",null,[l(M,{open:h.value,"onUpdate:open":e[0]||(e[0]=k=>h.value=k),title:"购买记录",footer:null,width:896},{default:o(()=>[l(_,{style:{"margin-top":"16px"},"data-source":N.list},{default:o(()=>[l(a,{key:"create_time",title:"购买时间","data-index":"create_time"},{default:o(({record:k})=>[d(C(g(k.create_time)),1)]),_:1}),l(a,{key:"buy_total",title:"购买积分数","data-index":"buy_total"}),l(a,{key:"use_total",title:"已消耗","data-index":"use_total"}),l(a,{key:"expire_total",title:"已过期","data-index":"expire_total"}),l(a,{key:"surplus_total",title:"剩余额度","data-index":"surplus_total"}),l(a,{key:"expire_time",title:"到期时间","data-index":"expire_time"},{default:o(({record:k})=>[d(C(g(k.expire_time)),1)]),_:1}),l(a,{key:"remark_outer",title:"备注","data-index":"remark_outer"})]),_:1},8,["data-source"])]),_:1},8,["open"])])}}},St={class:"modal-box"},Kt={__name:"kefu-modal",setup(N,{expose:T}){const h=w(!1);return T({show:()=>{h.value=!0}}),(A,E)=>{const e=Ce,a=ne;return n(),c("div",null,[l(a,{open:h.value,"onUpdate:open":E[0]||(E[0]=_=>h.value=_),title:"购买资源包",footer:null,width:546},{default:o(()=>[s("div",St,[l(e,{"show-icon":"",message:"暂不支持线上购买，请扫码联系客服购买"}),E[1]||(E[1]=s("div",{class:"img-box"},[s("img",{src:"https://xkf-upload-oss.xiaokefu.com.cn/static/kefu.png",alt:""})],-1))])]),_:1},8,["open"])])}}},Bt=Q(Kt,[["__scopeId","data-v-64d91ba9"]]),qt={class:"modal-list-box"},Ot={class:"alert-box"},Gt={class:"left-block"},Pt={class:"btn-box"},Xt={class:"tab-box"},Vt={class:"table-box"},Ft={key:0},Yt={key:1},jt={key:2},zt={key:0},Ht={key:1},Jt=["onClick"],Wt=["onClick"],Qt={__name:"has-modal-list",props:{currentModalItem:{type:Object,default:()=>({})}},emits:["addModel","delModel","editConfig","delConfig"],setup(N,{emit:T}){const h=N,g=T;let A={input_text:"文本",input_voice:"语音",input_image:"图片",input_video:"视频",input_document:"文档"},E={output_text:"文本",output_voice:"语音",output_image:"图片",output_video:"视频"};const e=w("LLM"),a=z(()=>h.currentModalItem.config_info||{api_key:""});a.value;const _=z(()=>a.value.model_define=="doubao"?"接入点id":a.value.model_define=="azure"?"部署名称":"model");a.value;const M=z(()=>h.currentModalItem.use_model_configs||[]),k=z(()=>M.value.filter(b=>b.model_type==e.value).map(b=>{let t=[],R=[];for(let L in A)b[L]==1&&t.push(A[L]);for(let L in E)b[L]==1&&R.push(E[L]);return{...b,input_desc:t.join(","),output_desc:R.join(",")}})),I=z(()=>[{label:`大语言模型（${M.value.filter(U=>U.model_type=="LLM").length}）`,value:"LLM"},{label:`嵌入模型（${M.value.filter(U=>U.model_type=="TEXT EMBEDDING").length}）`,value:"TEXT EMBEDDING"},{label:`重排序模型（${M.value.filter(U=>U.model_type=="RERANK").length}）`,value:"RERANK"}]),$=U=>{g("addModel",h.currentModalItem,U)},F=()=>{g("editConfig",h.currentModalItem,a.value)},Z=()=>{g("delConfig",a.value)},Y=U=>{g("delModel",U)};return(U,b)=>{const t=ce,R=De,L=_e,K=We,j=pe;return n(),c("div",qt,[s("div",Ot,[s("div",Gt,[l(le(Je)),["baai","ollama","xinference"].includes(a.value.model_define)?(n(),c(S,{key:0},[b[2]||(b[2]=d(" API endpoint：")),a.value.api_endpoint?(n(),c(S,{key:0},[d(C(a.value.api_endpoint.slice(0,30))+C(a.value.api_endpoint.length>30?"...":""),1)],64)):f("",!0)],64)):(n(),c(S,{key:1},[b[3]||(b[3]=d(" API Key：")),a.value.api_key?(n(),c(S,{key:0},[d(C(a.value.api_key.slice(0,30))+" "+C(a.value.api_key.length>30?"...":""),1)],64)):f("",!0)],64))]),s("div",Pt,[l(t,{onClick:b[0]||(b[0]=i=>$())},{default:o(()=>b[4]||(b[4]=[d("添加模型")])),_:1,__:[4]}),l(t,{onClick:F},{default:o(()=>b[5]||(b[5]=[d("修改配置")])),_:1,__:[5]}),l(t,{onClick:Z},{default:o(()=>b[6]||(b[6]=[d("移除配置")])),_:1,__:[6]})])]),s("div",Xt,[l(R,{value:e.value,"onUpdate:value":b[1]||(b[1]=i=>e.value=i),options:I.value},null,8,["value","options"])]),s("div",Vt,[l(j,{sticky:"","data-source":k.value,pagination:!1,scroll:{x:1e3}},{default:o(()=>[l(L,{width:140,key:"show_model_name",title:"模型名称","data-index":"show_model_name"}),l(L,{width:140,key:"use_model_name",title:_.value,"data-index":"use_model_name"},{default:o(({record:i})=>[d(C(i.use_model_name),1)]),_:1},8,["title"]),e.value=="LLM"?(n(),x(L,{width:140,key:"thinking_type",title:"深度思考","data-index":"thinking_type"},{default:o(({record:i})=>[i.thinking_type==0?(n(),c("span",Ft,"不支持")):f("",!0),i.thinking_type==1?(n(),c("span",Yt,"支持")):f("",!0),i.thinking_type==2?(n(),c("span",jt,"可选")):f("",!0)]),_:1})):f("",!0),e.value=="LLM"?(n(),x(L,{width:140,key:"function_call",title:"工具调用","data-index":"function_call"},{default:o(({record:i})=>[i.function_call==0?(n(),c("span",zt,"不支持")):f("",!0),i.function_call==1?(n(),c("span",Ht,"支持")):f("",!0)]),_:1})):f("",!0),e.value=="TEXT EMBEDDING"?(n(),x(L,{width:120,key:"vector_dimension_list",title:"向量维度","data-index":"vector_dimension_list"})):f("",!0),e.value!="RERANK"?(n(),x(L,{width:140,key:"input_desc",title:"输入","data-index":"input_desc"},{default:o(({record:i})=>[d(C(i.input_desc),1)]),_:1})):f("",!0),e.value=="LLM"?(n(),x(L,{width:140,key:"output_desc",title:"输出","data-index":"output_desc"},{default:o(({record:i})=>[d(C(i.output_desc),1)]),_:1})):f("",!0),l(L,{key:"action",title:"操作",width:120,fixed:"right"},{default:o(({record:i})=>[s("a",{onClick:r=>$(i)},"编辑",8,Jt),l(K,{type:"vertical"}),s("a",{onClick:r=>Y(i)},"删除",8,Wt)]),_:1})]),_:1},8,["data-source"])])])}}},Zt=Q(Qt,[["__scopeId","data-v-e53dc74a"]]),eo={__name:"add-model-new",emits:"ok",setup(N,{expose:T,emit:h}){const g=w(!1),A=h,E=["siliconflow","doubao","tongyi"],e=de({model_config_id:"",id:"",model_type:"LLM",use_model_name:"",show_model_name:"",thinking_type:"0",function_call:"1",input_text:!0,input_voice:!1,input_image:!1,input_video:!1,input_document:!1,output_text:!0,output_voice:!1,output_image:!1,output_video:!1,vector_dimension_list:""}),a=w({}),_=w([]),M=z(()=>a.value.model_define=="doubao"?"接入点id":a.value.model_define=="azure"?"部署名称":"model"),k=w(null),I=(b,t)=>{a.value=b,_.value=b.supported_type||[],Y(),e.model_config_id=b.config_info.id,t&&(e.id=t.id,e.model_type=t.model_type,e.use_model_name=t.use_model_name,e.show_model_name=t.show_model_name||t.use_model_name,e.thinking_type=t.thinking_type+"",e.function_call=t.function_call+"",e.input_text=t.input_text==1,e.input_voice=t.input_voice==1,e.input_image=t.input_image==1,e.input_video=t.input_video==1,e.input_document=t.input_document==1,e.output_text=t.output_text==1,e.output_voice=t.output_voice==1,e.output_image=t.output_image==1,e.output_video=t.output_video==1,e.vector_dimension_list=t.vector_dimension_list),g.value=!0},$=w(!1),F=()=>{k.value.validate().then(()=>{let b={...e,input_text:e.input_text?1:0,input_voice:e.input_voice?1:0,input_image:e.input_image?1:0,input_video:e.input_video?1:0,input_document:e.input_document?1:0,output_text:e.output_text?1:0,output_voice:e.output_voice?1:0,output_image:e.output_image?1:0,output_video:e.output_video?1:0};$.value=!0,Ke({...b}).then(()=>{se.success("保存成功"),A("ok"),g.value=!1}).finally(()=>{$.value=!1})})},Z=()=>{e.input_voice=!1,e.input_image=!1,e.input_video=!1,e.input_document=!1,e.output_text=!1,e.output_voice=!1,e.output_image=!1,e.output_video=!1};function Y(){Object.assign(e,{model_config_id:"",id:"",model_type:_.value[0],use_model_name:"",show_model_name:"",thinking_type:"0",function_call:"1",input_text:!0,input_voice:!1,input_image:!1,input_video:!1,input_document:!1,output_text:!0,output_voice:!1,output_image:!1,output_video:!1,vector_dimension_list:""})}const U=()=>{e.show_model_name||(e.show_model_name=e.use_model_name)};return T({show:I}),(b,t)=>{const R=Me,L=xe,K=be,j=$e,i=Ze,r=Qe,B=re,P=ne;return n(),c("div",null,[l(P,{open:g.value,"onUpdate:open":t[17]||(t[17]=m=>g.value=m),title:`${e.id?"编辑":"添加"}模型`,width:700,onOk:F,confirmLoading:$.value},{default:o(()=>[l(B,{class:"form-box",ref_key:"formRef",ref:k,layout:"vertical",model:e},{default:o(()=>[l(K,{name:"model_type",label:"模型类型",required:""},{default:o(()=>[l(L,{onChange:Z,value:e.model_type,"onUpdate:value":t[0]||(t[0]=m=>e.model_type=m),name:"radioGroup"},{default:o(()=>[_.value.includes("LLM")?(n(),x(R,{key:0,value:"LLM"},{default:o(()=>t[18]||(t[18]=[d("大语言模型")])),_:1,__:[18]})):f("",!0),_.value.includes("TEXT EMBEDDING")?(n(),x(R,{key:1,value:"TEXT EMBEDDING"},{default:o(()=>t[19]||(t[19]=[d("嵌入模型")])),_:1,__:[19]})):f("",!0),_.value.includes("RERANK")?(n(),x(R,{key:2,value:"RERANK"},{default:o(()=>t[20]||(t[20]=[d("重排序模型")])),_:1,__:[20]})):f("",!0)]),_:1},8,["value"])]),_:1}),l(K,{name:"use_model_name",label:M.value,rules:[{required:!0,message:`请输入${M.value}`}]},{default:o(()=>[l(j,{value:e.use_model_name,"onUpdate:value":t[1]||(t[1]=m=>e.use_model_name=m),onBlur:U,placeholder:"请输入，为调用模型时参数"},null,8,["value"])]),_:1},8,["label","rules"]),l(K,{name:"show_model_name",label:"模型名称",rules:[{required:!0,message:"请输入模型名称"}]},{default:o(()=>[l(j,{value:e.show_model_name,"onUpdate:value":t[2]||(t[2]=m=>e.show_model_name=m),maxLength:50,placeholder:"请输入模型名称，仅后台展示用"},null,8,["value"])]),_:1}),e.model_type=="TEXT EMBEDDING"?(n(),x(K,{key:0,name:"vector_dimension_list",label:"向量维度"},{default:o(()=>[l(j,{value:e.vector_dimension_list,"onUpdate:value":t[3]||(t[3]=m=>e.vector_dimension_list=m),placeholder:"请输入支持的向量维度，多个向量维度用英文逗号分割"},null,8,["value"]),t[21]||(t[21]=s("div",{class:"form-tip"},"向量维度必须为正整数，比如1024",-1))]),_:1,__:[21]})):f("",!0),E.includes(a.value.model_define)&&e.model_type=="LLM"?(n(),x(K,{key:1,name:"thinking_type",label:"深度思考",required:""},{default:o(()=>[l(L,{class:"thiing-radio-box",value:e.thinking_type,"onUpdate:value":t[4]||(t[4]=m=>e.thinking_type=m)},{default:o(()=>[l(R,{value:"1"},{default:o(()=>t[22]||(t[22]=[d("支持（类似deepseek r1这种只支持思考模式的模型）")])),_:1,__:[22]}),l(R,{value:"2"},{default:o(()=>t[23]||(t[23]=[d("可选（比如doubao 1.6，可以通过接口控制是否启用深度思考模式）")])),_:1,__:[23]}),l(R,{value:"0"},{default:o(()=>t[24]||(t[24]=[d("不支持（比如deepseek v3，模型本身不支持深度思考模式）")])),_:1,__:[24]})]),_:1},8,["value"])]),_:1})):f("",!0),e.model_type=="LLM"?(n(),x(K,{key:2,name:"function_call",label:"工具调用",required:""},{default:o(()=>[l(L,{value:e.function_call,"onUpdate:value":t[5]||(t[5]=m=>e.function_call=m)},{default:o(()=>[l(R,{value:"1"},{default:o(()=>t[25]||(t[25]=[d("支持")])),_:1,__:[25]}),l(R,{value:"0"},{default:o(()=>t[26]||(t[26]=[d("不支持")])),_:1,__:[26]})]),_:1},8,["value"])]),_:1})):f("",!0),e.model_type!="RERANK"?(n(),x(K,{key:3,label:"支持输入类型",required:""},{default:o(()=>[e.model_type=="LLM"?(n(),x(r,{key:0,gap:8},{default:o(()=>[l(i,{checked:e.input_text,"onUpdate:checked":t[6]||(t[6]=m=>e.input_text=m)},{default:o(()=>t[27]||(t[27]=[d("文本")])),_:1,__:[27]},8,["checked"]),l(i,{checked:e.input_voice,"onUpdate:checked":t[7]||(t[7]=m=>e.input_voice=m)},{default:o(()=>t[28]||(t[28]=[d("语音")])),_:1,__:[28]},8,["checked"]),l(i,{checked:e.input_image,"onUpdate:checked":t[8]||(t[8]=m=>e.input_image=m)},{default:o(()=>t[29]||(t[29]=[d("图片")])),_:1,__:[29]},8,["checked"]),l(i,{checked:e.input_video,"onUpdate:checked":t[9]||(t[9]=m=>e.input_video=m)},{default:o(()=>t[30]||(t[30]=[d("视频")])),_:1,__:[30]},8,["checked"]),l(i,{checked:e.input_document,"onUpdate:checked":t[10]||(t[10]=m=>e.input_document=m)},{default:o(()=>t[31]||(t[31]=[d("文档")])),_:1,__:[31]},8,["checked"])]),_:1})):(n(),x(r,{key:1,gap:8},{default:o(()=>[l(i,{checked:e.input_text,"onUpdate:checked":t[11]||(t[11]=m=>e.input_text=m)},{default:o(()=>t[32]||(t[32]=[d("文本")])),_:1,__:[32]},8,["checked"]),l(i,{disabled:"",checked:e.input_image,"onUpdate:checked":t[12]||(t[12]=m=>e.input_image=m)},{default:o(()=>t[33]||(t[33]=[d("图片")])),_:1,__:[33]},8,["checked"])]),_:1}))]),_:1})):f("",!0),e.model_type=="LLM"?(n(),x(K,{key:4,label:"支持输出类型",required:""},{default:o(()=>[l(r,{gap:8},{default:o(()=>[l(i,{checked:e.output_text,"onUpdate:checked":t[13]||(t[13]=m=>e.output_text=m)},{default:o(()=>t[34]||(t[34]=[d("文本")])),_:1,__:[34]},8,["checked"]),l(i,{checked:e.output_voice,"onUpdate:checked":t[14]||(t[14]=m=>e.output_voice=m)},{default:o(()=>t[35]||(t[35]=[d("语音")])),_:1,__:[35]},8,["checked"]),l(i,{checked:e.output_image,"onUpdate:checked":t[15]||(t[15]=m=>e.output_image=m)},{default:o(()=>t[36]||(t[36]=[d("图片")])),_:1,__:[36]},8,["checked"]),l(i,{checked:e.output_video,"onUpdate:checked":t[16]||(t[16]=m=>e.output_video=m)},{default:o(()=>t[37]||(t[37]=[d("视频")])),_:1,__:[37]},8,["checked"])]),_:1})]),_:1})):f("",!0)]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},to=Q(eo,[["__scopeId","data-v-44ecad59"]]),oo={class:"user-model-page"},lo={class:"list-wrapper"},no={key:0,class:"alert-content-box"},ao={key:1,class:"content-body-box"},so={class:"model-group-box"},io=["onClick"],uo=["src"],_o={class:"model-name"},po={class:"model-content-box"},mo={key:0,class:"chatwiki-model-box"},ro={class:"statics-block"},co={class:"statics-item"},fo={class:"num"},vo={class:"statics-item"},go={class:"num"},yo={class:"statics-item"},ko={class:"num"},ho={class:"btn-block"},bo={class:"search-block"},xo={class:"search-item"},Mo={class:"list-box"},wo={key:0},Lo={key:1},$o={key:2},Eo={key:0},Co={key:1},Do={__name:"index",setup(N){const T=Ye().query,{t:h}=ue(),g=w(+T.activeTab>=0?+T.activeTab:1),A=()=>{};w([]);const E=w([]),e=w(""),a=de({all_surplus:0,all_use:0,min_expiretime:"",list:[]}),_=de({model_supplier:void 0}),M=w("LLM"),k=z(()=>E.value.filter(p=>p.model_type==M.value)),I=z(()=>[{label:`大语言模型（${E.value.filter(p=>p.model_type=="LLM").length}）`,value:"LLM"},{label:`嵌入模型（${E.value.filter(p=>p.model_type=="TEXT EMBEDDING").length}）`,value:"TEXT EMBEDDING"},{label:`重排序模型（${E.value.filter(p=>p.model_type=="RERANK").length}）`,value:"RERANK"}]),$=w([]),F=()=>{Pe().then(p=>{a.all_surplus=p.data.all_surplus,a.all_use=p.data.all_use,a.list=p.data.list||[],a.min_expiretime=p.data.min_expiretime>0?Ee(p.data.min_expiretime*1e3).format("YYYY-MM-DD"):"--"})},Z=w(null),Y=w(null),U=()=>{F(),Y.value.show()};let b={tongyi:"通义千问",deepseek:"DeepSeek",doubao:"豆包"},t={LLM:"大语言模型","TEXT EMBEDDING":"嵌入模型",RERANK:"重排序模型"},R={input_text:"文本",input_voice:"语音",input_image:"图片",input_video:"视频",input_document:"文档"},L={output_text:"文本",output_voice:"语音",output_image:"图片",output_video:"视频"};const K=()=>{Oe({..._}).then(p=>{if(!p.data){E.value=[];return}E.value=p.data.map(v=>{let H=[],ae=[];for(let oe in R)v[oe]==1&&H.push(R[oe]);for(let oe in L)v[oe]==1&&ae.push(L[oe]);return{...v,model_supplier_desc:b[v.model_supplier],model_type_desc:t[v.model_type],input_desc:H.join(","),output_desc:ae.join(",")}})})},j=z(()=>$.value.filter(p=>p.config_info_id==e.value)[0]||{}),i=p=>{e.value=p.config_info_id};je(()=>$,()=>{$.value.filter(p=>p.config_info_id==e.value).length==0&&(e.value=$.value[0].config_info_id)},{deep:!0});const r=w([]),B=()=>{Be().then(p=>{let v=p.data||[];v.forEach(H=>{H.config_info_id=H.model_define=="chatwiki"?"chatwiki":H.config_info.id}),$.value=v})},P=w(null),m=(p,v)=>{P.value.show(p,v)},ee=p=>{ne.confirm({title:"删除模型确认",icon:l(ye),content:`确认删除【${p.show_model_name}】这个模型吗?`,onOk(){Xe({id:p.id}).then(()=>{se.success("删除成功"),B(),q()})}})},q=()=>{qe().then(p=>{r.value=p.data||[]})};ze(()=>{B(),q()});const O=w(null),X=p=>{O.value.open(p)},te=p=>{y.value.open(p)},u=p=>{y.value.open(p)},y=w(null),V=(p,v)=>{y.value.open(p,v)},fe=()=>{B(),q()},Te=p=>{g.value==0&&(g.value=1,e.value=p),fe()},ve=p=>{ne.confirm({title:h("views.user.model.deleteModel"),icon:l(ye),content:h("views.user.model.deleteModelContent"),onOk(){Ge({id:p.id}).then(()=>{se.success(h("common.deleteSuccessful")),B(),q()})}})},Ie=w(null),Ae=()=>{Ie.value.open()};return(p,v)=>{const H=Ce,ae=ce,oe=De,me=Le,Re=we,J=_e,Ne=pe;return n(),c(S,null,[s("div",oo,[l(lt,{value:g.value,"onUpdate:value":v[0]||(v[0]=D=>g.value=D),onChange:A},null,8,["value"]),s("div",lo,[g.value==0?(n(),c("div",no,[l(H,{"show-icon":""},{message:o(()=>v[3]||(v[3]=[s("div",{class:"title"},"使用说明",-1),s("div",null," 1、模型主要分为嵌入模型（TEXT EMBEDDING）和大模型（LLM），嵌入模型用于将上传知识库的文本内容进行向量化便于后续检索，大模型用于将检索到的相关知识进行理解后返回答案。 ",-1),s("div",null,"2、配置模型时尽量选择同时支持LLM和TEXT EMBEDDING的模型，否则要配置多个模型。",-1),s("div",null," 3、国内模型厂商一般都需要认证后才可使用，所以在配置模型前，确保在模型服务厂商那里已认证，否则配置模型时会提示配置参数错误。 ",-1)])),_:1})])):f("",!0),g.value==1?(n(),c("div",ao,[s("div",so,[(n(!0),c(S,null,W($.value,D=>(n(),c("div",{class:he(["model-list-item",{active:D.config_info_id==e.value}]),onClick:To=>i(D),key:D.config_info_id},[s("img",{class:"avatar",src:D.model_icon_url,alt:""},null,8,uo),s("div",_o,C(D.config_info.config_name||D.model_name),1)],10,io))),128))]),s("div",po,[e.value=="chatwiki"?(n(),c("div",mo,[s("div",ro,[s("div",co,[v[4]||(v[4]=s("div",{class:"title"},"剩余积分",-1)),s("div",fo,C(le(ge)(a.all_surplus)),1)]),s("div",vo,[v[5]||(v[5]=s("div",{class:"title"},"累计已使用",-1)),s("div",go,C(le(ge)(a.all_use)),1)]),s("div",yo,[v[6]||(v[6]=s("div",{class:"title"},"最近过期时间",-1)),s("div",ko,C(a.min_expiretime),1)]),s("div",ho,[l(ae,{type:"primary",onClick:Ae,block:""},{default:o(()=>v[7]||(v[7]=[d("购买资源包")])),_:1,__:[7]}),l(ae,{onClick:U,block:""},{default:o(()=>v[8]||(v[8]=[d("购买记录")])),_:1,__:[8]})])]),s("div",bo,[l(oe,{value:M.value,"onUpdate:value":v[1]||(v[1]=D=>M.value=D),options:I.value},null,8,["value","options"]),s("div",xo,[v[12]||(v[12]=s("span",null,"模型供应商：",-1)),l(Re,{allowClear:"",onChange:K,value:_.model_supplier,"onUpdate:value":v[2]||(v[2]=D=>_.model_supplier=D),placeholder:"请选择模型供应商",style:{width:"172px"}},{default:o(()=>[l(me,{value:"tongyi"},{default:o(()=>v[9]||(v[9]=[d("通义千问")])),_:1,__:[9]}),l(me,{value:"deepseek"},{default:o(()=>v[10]||(v[10]=[d("DeepSeek")])),_:1,__:[10]}),l(me,{value:"doubao"},{default:o(()=>v[11]||(v[11]=[d("豆包")])),_:1,__:[11]})]),_:1},8,["value"])])]),s("div",Mo,[l(Ne,{sticky:"",style:{"margin-top":"8px"},pagination:!1,"data-source":k.value},{default:o(()=>[l(J,{key:"uni_model_name",width:140,title:"模型","data-index":"uni_model_name"}),l(J,{width:140,key:"model_supplier_desc",title:"模型服务商","data-index":"model_supplier_desc"}),M.value=="LLM"?(n(),x(J,{width:140,key:"thinking_type",title:"深度思考","data-index":"thinking_type"},{default:o(({record:D})=>[D.thinking_type==0?(n(),c("span",wo,"不支持")):f("",!0),D.thinking_type==1?(n(),c("span",Lo,"支持")):f("",!0),D.thinking_type==2?(n(),c("span",$o,"可选")):f("",!0)]),_:1})):f("",!0),M.value=="LLM"?(n(),x(J,{width:140,key:"function_call",title:"工具调用","data-index":"function_call"},{default:o(({record:D})=>[D.function_call==0?(n(),c("span",Eo,"不支持")):f("",!0),D.function_call==1?(n(),c("span",Co,"支持")):f("",!0)]),_:1})):f("",!0),M.value=="TEXT EMBEDDING"?(n(),x(J,{width:120,key:"vector_dimension_list",title:"向量维度","data-index":"vector_dimension_list"})):f("",!0),M.value!="RERANK"?(n(),x(J,{width:100,key:"input_desc",title:"输入","data-index":"input_desc"},{default:o(({record:D})=>[d(C(D.input_desc),1)]),_:1})):f("",!0),M.value=="LLM"?(n(),x(J,{width:100,key:"output_desc",title:"输出","data-index":"output_desc"},{default:o(({record:D})=>[d(C(D.output_desc),1)]),_:1})):f("",!0),l(J,{width:130,key:"price",title:"价格","data-index":"price"},{default:o(({record:D})=>[d(C(D.price)+"积分/千Token",1)]),_:1})]),_:1},8,["data-source"])])])):(n(),x(Zt,{key:1,onAddModel:m,onDelModel:ee,onEditConfig:V,onDelConfig:ve,currentModalItem:j.value},null,8,["currentModalItem"]))])])):f("",!0),g.value==0?(n(),x(ft,{list:r.value,type:2,key:"canAddModelList",onAdd:u,onSee:X},null,8,["list"])):f("",!0)])]),l(Nt,{ref_key:"seeModelAlertRef",ref:O,onNew:te,onEdit:V,onRemove:ve},null,512),l(Dt,{ref_key:"setModelAlertRef",ref:y,onOk:Te},null,512),l(Ut,{list:a.list,ref_key:"buyRecordRef",ref:Y},null,8,["list"]),l(Bt,{ref_key:"kefuModalRef",ref:Z},null,512),l(to,{ref_key:"addModelNewRef",ref:P,onOk:fe},null,512)],64)}}},So=Q(Do,[["__scopeId","data-v-9fe80963"]]);export{So as default};
