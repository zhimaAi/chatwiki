import{_ as ae}from"./cu-scroll-C_QJcxx1.js";import{_ as ie}from"./page-alert-NlbsKG4S.js";import{_ as Q,ce as W,d as le,cf as re,c as ue,cg as de}from"../../index-C5-B0r5-.js";import{r as M,q as pe,ac as h,ad as _,k as t,ar as s,as as n,n as _e,ae as N,az as R,G as m,u as g,at as c,F as I,ax as j,B as J,f as v,o as ce,af as U,aw as me,aA as ge}from"./vue-chunks-CGLjTDrY.js";import{E as fe,v as ve,a9 as G,ae as be,ai as ye,af as he,bB as we,G as ke,M as P,b as D,W as X,F as H,e as xe,$ as Se,a3 as $e,a4 as Ce,m as qe,n as Oe,aB as Fe,H as Ke,T as Re,B as De,by as Ee,k as Le,D as ze,h as Be,i as Ae,bC as Ue}from"./ui-antd-B11sc9DP.js";import{u as Me}from"./util-BwuffJOK.js";import{U as Ne}from"./index-B2MTQrOC.js";import{I as Ie}from"./import-knowledge-modal-BkXck93F.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./index-GO4nEZEO.js";import"./validate-8MtiUsxW.js";import"./model-select-DkFuDwQt.js";import"./index-Btdd0zUd.js";const Qe={class:"subsection-box"},Pe={class:"qa-list-box"},Te={class:"list-item"},Ve={class:"list-content"},je={class:"status-error"},Je={class:"similar-question-list"},Ge={class:"list-item list-item-answer"},He={class:"list-content"},We={class:"fragment-img"},Xe=["src"],Ye={key:0,class:"status-block status-green"},Ze={key:1,class:"status-block status-gray"},et=["href"],tt={class:"right-opration"},st=["onClick"],nt=["onClick"],ot={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1}},emits:["handleDelParagraph","openEditSubscription"],setup(E,{expose:F,emit:L}){const w=L,k=E,f=M({selectedRowKeys:[]}),x=r=>{f.selectedRowKeys=r},l=()=>{f.selectedRowKeys=[]},S=r=>{w("openEditSubscription",r)},q=r=>{P.confirm({title:"提示",icon:t(X),content:"确认是否删除该分段?",onOk(){return new Promise((d,O)=>{W({ids:r}).then(K=>{D.success("删除成功"),w("handleDelParagraph",r),d()}).catch(()=>{d()})})},onCancel(){}})};return F({handleOpenEditModal:S,state:f,resetSelect:l}),(r,d)=>{const O=ve,K=be,u=fe,a=ke,p=pe("viewer");return _(),h("div",Qe,[t(a,{"data-source":E.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:f.selectedRowKeys,onChange:x},pagination:!1,loading:k.isLoading},{default:s(()=>[t(u,{key:"id","data-index":"id",width:1148},{title:s(()=>[m("问答（共"+c(k.total)+"个）",1)]),default:s(({record:o})=>[n("div",Pe,[n("div",Te,[d[0]||(d[0]=n("div",{class:"list-label"},"问题",-1)),n("div",Ve,[o.status==2?(_(),N(O,{key:0,placement:"top"},{title:s(()=>[n("span",null,c(o.errmsg),1)]),default:s(()=>[n("span",null,[n("span",je,[t(g(G))])])]),_:2},1024)):R("",!0),m(" "+c(o.question)+" ",1),o.similar_questions&&o.similar_questions.length?(_(),N(K,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:s(()=>[n("div",Je,[(_(!0),h(I,null,j(o.similar_questions,($,b)=>(_(),h("div",{class:"similar-question-list-item",key:b},c($),1))),128))])]),title:s(()=>[n("span",null,"共 "+c(o.similar_questions.length)+" 个相似问法",1)]),default:s(()=>[n("a",null,"（"+c(o.similar_questions.length)+"）",1)]),_:2},1024)):R("",!0)])]),n("div",Ge,[d[1]||(d[1]=n("div",{class:"list-label"},"答案",-1)),n("div",He,c(o.answer),1)]),_e((_(),h("div",We,[(_(!0),h(I,null,j(o.images,($,b)=>(_(),h("img",{key:b,src:$,alt:""},null,8,Xe))),128))])),[[p]])])]),_:1}),t(u,{title:"是否导入知识库",key:"is_import","data-index":"is_import",width:180},{default:s(({record:o})=>[o.is_import==1?(_(),h("div",Ye,[t(g(ye)),d[2]||(d[2]=m("已导入 ",-1))])):R("",!0),o.is_import==0?(_(),h("div",Ze,[t(g(G)),d[3]||(d[3]=m("未导入 ",-1))])):R("",!0),n("div",null,[n("a",{href:`/#/library/details/knowledge-document?id=${o.library_id}`,target:"_blank"},c(o.library_name),9,et)])]),_:1}),t(u,{title:"操作",key:"action","data-index":"action",width:120},{default:s(({record:o,index:$})=>[n("div",tt,[n("div",{class:"hover-btn-box",onClick:J(b=>S(o),["stop"])},[t(g(he))],8,st),n("div",{class:"hover-btn-box",onClick:J(b=>q(o.id),["stop"])},[t(g(we))],8,nt)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},at=Q(ot,[["__scopeId","data-v-5c44c0f0"]]),it={class:"form-box"},lt={class:"upload-box-wrapper"},rt={key:0},ut={__name:"edit-subsection",emits:["ok"],setup(E,{expose:F,emit:L}){const w=L,k=v(!1),f=v("1"),x=H.useForm,l=M({images:[],question:"",answer:"",id:""}),S=M({question:[{required:!0,message:"请输入分段问题",trigger:"change"}],answer:[{required:!0,message:"请输入分段答案",trigger:"change"}]}),{validate:q,validateInfos:r}=x(l,S),d=()=>{q().then(()=>{O()}).catch(u=>{})},O=()=>{let u={...l},a=new FormData;for(let p in u)Me.isArray(u[p])?u[p].forEach(o=>{a.append(p,o)}):a.append(p,u[p]);re(a).then(p=>{D.success("编辑成功"),k.value=!1,w("ok")})};return F({show:u=>{l.question=u.question,l.answer=u.answer,l.id=u.id,l.title=u.title,l.images=u.images||[],k.value=!0}}),ce(()=>{}),(u,a)=>{const p=Se,o=xe,$=le,b=Ce,z=$e,B=H,i=P;return _(),N(i,{open:k.value,"onUpdate:open":a[4]||(a[4]=e=>k.value=e),onOk:d,title:"编辑分段",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:944},{default:s(()=>[n("div",it,[t(B,{layout:"vertical"},{default:s(()=>[t(o,U({ref:"question",label:"分段问题"},g(r).question),{default:s(()=>[t(p,{placeholder:"请输入分段问题",value:l.question,"onUpdate:value":a[0]||(a[0]=e=>l.question=e),style:{height:"100px"}},null,8,["value"])]),_:1},16),t(o,U({ref:"answer",label:"分段答案"},g(r).answer),{default:s(()=>[t(p,{placeholder:"请输入分段问题",value:l.answer,"onUpdate:value":a[1]||(a[1]=e=>l.answer=e),style:{height:"100px"}},null,8,["value"])]),_:1},16),t(o,U({label:"附件"},g(r).images),{default:s(()=>[n("div",lt,[t(z,{activeKey:f.value,"onUpdate:activeKey":a[2]||(a[2]=e=>f.value=e),size:"small"},{default:s(()=>[t(b,{key:"1"},{tab:s(()=>[n("span",null,[t($,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),a[5]||(a[5]=m(" 图片 ",-1)),l.images.length?(_(),h("span",rt,"("+c(l.images.length)+")",1)):R("",!0)])]),_:1})]),_:1},8,["activeKey"]),t(Ne,{value:l.images,"onUpdate:value":a[3]||(a[3]=e=>l.images=e)},null,8,["value"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])}}},dt=Q(ut,[["__scopeId","data-v-14c8a4a6"]]),pt={class:"main-content-box"},_t={class:"breadcrumb-block"},ct={class:"btn-wrapper-box"},mt={class:"content-block"},gt={class:"pagination-box"},ft={__name:"index",setup(E){const F=ue(),w=me().query,k=w.file_name,f=v(""),x=v(null),l=v(0),S=v(!1),q=v([]),r=v({page:1,size:100}),d=v(null),O=i=>{d.value.show(JSON.parse(JSON.stringify(i)))},K=(i,e)=>{r.value.page=i,r.value.size=e,a()},u=()=>{r.value.page=1,a()},a=()=>{S.value=!0,de({...r.value,id:w.id,is_import:f.value}).then(i=>{let e=i.data.list||[];e.forEach(C=>{C.images&&(C.images=JSON.parse(C.images))}),q.value=e,l.value=i.data.total,B(i.data.total,i.data.import_total),x.value.resetSelect()}).finally(()=>{S.value=!1})};a();const p=v(null),o=()=>{let i=x.value.state.selectedRowKeys;if(i.length==0)return D.error("请选择你要导入的问答");p.value.show({id:w.id,ids:i.join(",")})},$=()=>{let i=x.value.state.selectedRowKeys;if(i.length==0)return D.error("请选择你要删除的问答");P.confirm({title:"提示",icon:t(X),content:"确认是否删除选中的分段?",onOk(){W({ids:i.join(",")}).then(e=>{D.success("删除成功"),a()})},onCancel(){}})},b=i=>{let e=F.getToken,C=`/manage/exportFAQFileAllQA?id=${w.id}&token=${e}&ext=${i}`;window.location.href=C},z=v([]),B=(i,e)=>{z.value=[{value:"",payload:{num:i,title:"全部"}},{value:0,payload:{num:i-e,title:"未导入"}},{value:1,payload:{num:e,title:"已导入"}}]};return(i,e)=>{const C=ge("router-link"),T=Oe,Y=qe,Z=Ke,A=De,V=Ae,ee=Be,te=Le,se=Re,ne=Ue,oe=ae;return _(),h(I,null,[n("div",pt,[t(oe,{style:{"padding-right":"48px"},scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:s(()=>[n("div",_t,[t(Y,null,{default:s(()=>[t(T,null,{default:s(()=>[t(C,{to:"/ai-extract-faq/list"},{default:s(()=>[t(g(Fe)),e[5]||(e[5]=m(" 文档提取FAQ ",-1))]),_:1})]),_:1}),t(T,null,{default:s(()=>[m(c(g(k)),1)]),_:1})]),_:1})]),t(ie,{class:"mb16",title:"使用说明"},{default:s(()=>[...e[6]||(e[6]=[n("div",null,[n("p",null," 您可以查看、编辑提取处的问答对，并直接将问答对导入到知识库中。您也可以将知识库下载成文档，批量导入导问答知识库中。 ")],-1)])]),_:1}),n("div",ct,[t(Z,{onChange:u,value:f.value,"onUpdate:value":e[0]||(e[0]=y=>f.value=y),options:z.value},{label:s(({payload:y={}})=>[n("div",null,c(y.title)+"（"+c(y.num)+"）",1)]),_:1},8,["value","options"]),t(se,{gap:8},{default:s(()=>[t(A,{onClick:o,type:"primary",icon:t(g(Ee))},{default:s(()=>[...e[7]||(e[7]=[m("导入知识库",-1)])]),_:1},8,["icon"]),t(A,{onClick:$},{default:s(()=>[...e[8]||(e[8]=[m("批量删除",-1)])]),_:1}),t(te,null,{overlay:s(()=>[t(ee,null,{default:s(()=>[t(V,{onClick:e[1]||(e[1]=y=>b("docx")),key:"1"},{default:s(()=>[...e[9]||(e[9]=[m("下载为docx",-1)])]),_:1}),t(V,{onClick:e[2]||(e[2]=y=>b("xlsx")),key:"2"},{default:s(()=>[...e[10]||(e[10]=[m("下载为xlsx",-1)])]),_:1})]),_:1})]),default:s(()=>[t(A,{type:"primary"},{default:s(()=>[e[11]||(e[11]=m(" 下载 ",-1)),t(g(ze))]),_:1})]),_:1})]),_:1})]),n("div",mt,[t(at,{ref_key:"subsectionBoxRef",ref:x,total:l.value,isLoading:S.value,paragraphLists:q.value,onOpenEditSubscription:O,onHandleDelParagraph:a},null,8,["total","isLoading","paragraphLists"]),n("div",gt,[t(ne,{current:r.value.page,"onUpdate:current":e[3]||(e[3]=y=>r.value.page=y),"page-size":r.value.size,"onUpdate:pageSize":e[4]||(e[4]=y=>r.value.size=y),total:l.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:K},null,8,["current","page-size","total"])])])]),_:1})]),t(dt,{ref_key:"editSubscriptionRef",ref:d,onOk:a},null,512),t(Ie,{ref_key:"importKnowledgeModalRef",ref:p,onOk:u},null,512)],64)}}},Lt=Q(ft,[["__scopeId","data-v-f8f8a40f"]]);export{Lt as default};
