import{A as K,b as D,k as T,B as X,d as E}from"../../index-UhR4yadr.js";import{C as ee}from"./cu-scroll-jRkjVxy8.js";import{_ as te}from"./empty-DkpCLaix.js";import{k as i,a5 as F,e as y,B as se,b as oe,M as n,N as r,W as e,S as u,Y as h,Q as x,u as w,F as S,$ as R,a6 as ne,a7 as k,Z as m,a1 as Q,a2 as H,a4 as ie}from"./vue-chunks-DWnFCQSz.js";import{t as le}from"./index-DIUiarE3.js";import{_ as ae}from"./recommendation-AQ4_FPQ9.js";import{c as re}from"./index-cS6xwXeR.js";import{D as ce}from"./DownOutlined-CvDOGKH1.js";import{U as _e}from"./UpOutlined-BkQ7BaZ8.js";import{Q as A}from"./QuestionCircleOutlined-CV_adx6X.js";import{_ as de}from"./TextArea-CpTIlaWe.js";import{_ as ue}from"./index-kKxyythX.js";import{_ as me}from"./index-pSHtK2e9.js";import{_ as pe}from"./index-BnhNOVTI.js";import{_ as ve}from"./index-CovtKLUB.js";import{S as fe,a as he,_ as ke}from"./index-9VXz7HRC.js";import{S as ye}from"./index-BWhNhRp3.js";import"./axios-Cm0UX6qg.js";import"./qs-De-rn6vz.js";import"./crypto-js-U6t3rvpm.js";import"./dayjs-BI1HIvBC.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./index-DzhuYAPB.js";import"./FormItemContext-BJa1evck.js";import"./statusUtils--roYFmJe.js";import"./index-DXeZ5ybK.js";import"./Trigger-DcWVD-r5.js";import"./inputProps-CiDWLiIl.js";import"./index-DmSlXGTl.js";import"./colors-BiofrUQp.js";import"./slide-BR5NTmcW.js";import"./CheckOutlined-B_iCQ6FL.js";import"./SearchOutlined-bV5WeZB5.js";import"./move-cWZng2f8.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const ge=be;function j(l){for(var _=1;_<arguments.length;_++){var c=arguments[_]!=null?Object(arguments[_]):{},d=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(p){return Object.getOwnPropertyDescriptor(c,p).enumerable}))),d.forEach(function(p){xe(l,p,c[p])})}return l}function xe(l,_,c){return _ in l?Object.defineProperty(l,_,{value:c,enumerable:!0,configurable:!0,writable:!0}):l[_]=c,l}var U=function(_,c){var d=j({},_,c.attrs);return i(K,j({},d,{icon:ge}),null)};U.displayName="LinkOutlined";U.inheritAttrs=!1;const $e=U,C=l=>(Q("data-v-bfd71793"),l=l(),H(),l),we={class:"recall-settings-box"},Le=C(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),Oe={class:"form-box"},Se={class:"form-item"},Re={class:"form-item-body"},Ce={class:"form-item"},ze={class:"form-item"},Ne={class:"form-item-label"},qe={class:"form-item-body"},Me={class:"retrieval-mode-items"},Te=["onClick"],Ue={class:"retrieval-mode-title"},Be={class:"title-text"},Ie={key:0,style:{width:"32px"},src:ae,alt:""},Pe={class:"retrieval-mode-desc"},Ve={class:"form-item"},Ae={class:"form-item-label"},je=C(()=>e("span",null,"Top K ",-1)),De={class:"form-item-body"},Ee={class:"number-box"},Fe={class:"number-slider-box"},Qe={class:"number-input-box"},He={key:0,class:"form-item"},Ge={class:"form-item-label"},We=C(()=>e("span",null,"相似度阈值 ",-1)),Ye={class:"form-item-body"},Ze={class:"number-box"},Je={class:"number-slider-box"},Ke={class:"number-input-box"},Xe={class:"form-item"},et={class:"form-item-label"},tt=C(()=>e("span",null,"Rerank模型",-1)),st={class:"form-item-body"},ot=["src"],nt={__name:"recall-testing-form",emits:["save","load"],setup(l,{expose:_,emit:c}){const d=F(),p=y(!1),$=c,b=y(!0),f=y([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=se({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:d.query.id}),L=oe(()=>b.value?f.value.filter(v=>v.value==t.search_type):f.value),N=(v,o)=>{t.rerank_model_config_id=o.rerank_model_config_id},q=v=>{t.search_type=v},a=()=>{if(!t.similarity)return T.error("请输入相似度");if(!t.size)return T.error("请输入分段数");if(!t.question)return T.error("请输入测试问题");let v={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(v.rerank_model_config_id=t.rerank_model_config_id),p.value=!0,$("load"),le(v).then(o=>{$("save",o.data)}).catch(()=>{$("save",[])}).finally(()=>{p.value=!1})},M=y([]);return(()=>{re({model_type:"RERANK"}).then(v=>{let o=v.data||[];M.value=o.map(g=>({id:g.model_config.id,name:g.model_info.model_name,icon:g.model_info.model_icon_url,children:g.model_info.rerank_model_list}))})})(),_({open}),(v,o)=>{const g=de,G=X,B=E,I=ue,P=me,V=pe,W=ve,Y=fe,Z=he,J=ke;return n(),r("div",we,[Le,e("div",Oe,[e("div",Se,[e("div",Re,[i(g,{style:{height:"76px"},value:t.question,"onUpdate:value":o[0]||(o[0]=s=>t.question=s),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Ce,[i(G,{loading:p.value,onClick:a,type:"primary",block:""},{default:u(()=>[h("测试")]),_:1},8,["loading"])]),e("div",ze,[e("div",Ne,[e("div",{class:"hover-label",onClick:o[1]||(o[1]=s=>b.value=!b.value)},[h(" 检索模式 "),b.value?(n(),x(w(ce),{key:0})):(n(),x(w(_e),{key:1}))])]),e("div",qe,[e("div",Me,[(n(!0),r(S,null,R(L.value,s=>(n(),r("div",{class:ne(["retrieval-mode-item",{active:t.search_type==s.value}]),key:s.value,onClick:O=>q(s.value)},[t.search_type==s.value?(n(),x(B,{key:0,class:"check-arrow",name:"check-arrow-filled"})):k("",!0),e("div",Ue,[i(B,{name:s.iconName,class:"title-icon"},null,8,["name"]),e("span",Be,m(s.title),1),s.isRecommendation?(n(),r("img",Ie)):k("",!0)]),e("div",Pe,m(s.desc),1)],10,Te))),128))])])]),e("div",Ve,[e("div",Ae,[je,i(I,null,{title:u(()=>[h("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[i(w(A),{class:"question-icon"})]),_:1})]),e("div",De,[e("div",Ee,[e("div",Fe,[i(P,{class:"custom-slider",value:t.size,"onUpdate:value":o[2]||(o[2]=s=>t.size=s),min:1,max:10},null,8,["value"])]),e("div",Qe,[i(V,{value:t.size,"onUpdate:value":o[3]||(o[3]=s=>t.size=s),min:1,max:10},null,8,["value"])])])])]),t.search_type<=2?(n(),r("div",He,[e("div",Ge,[We,i(I,null,{title:u(()=>[h("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:u(()=>[i(w(A),{class:"question-icon"})]),_:1})]),e("div",Ye,[e("div",Ze,[e("div",Je,[i(P,{class:"custom-slider",value:t.similarity,"onUpdate:value":o[4]||(o[4]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ke,[i(V,{value:t.similarity,"onUpdate:value":o[5]||(o[5]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])])])])])):k("",!0),e("div",Xe,[e("div",et,[tt,h("   "),i(W,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":o[6]||(o[6]=s=>t.rerank_status=s)},null,8,["checked"])]),e("div",st,[i(J,{value:t.rerank_use_model,"onUpdate:value":o[7]||(o[7]=s=>t.rerank_use_model=s),placeholder:"请选择Rerank模型",onChange:N,style:{width:"320px"}},{default:u(()=>[(n(!0),r(S,null,R(M.value,s=>(n(),x(Z,{key:s.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:s.icon,alt:""},null,8,ot)])]),default:u(()=>[(n(!0),r(S,null,R(s.children,O=>(n(),x(Y,{value:O,rerank_model_config_id:s.id,key:O},{default:u(()=>[e("span",null,m(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},it=D(nt,[["__scopeId","data-v-bfd71793"]]),z=l=>(Q("data-v-be7f9c8e"),l=l(),H(),l),lt={class:"recall-testing-box"},at={class:"recall-from-box"},rt={class:"content-list-box"},ct={key:0,class:"empty-box"},_t=z(()=>e("img",{src:te,alt:""},null,-1)),dt=z(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),ut=[_t,dt],mt={class:"top-block"},pt={class:"title"},vt={key:0,class:"ml4"},ft={class:"info-block"},ht=z(()=>e("span",{class:"gray-text"},"来自：",-1)),kt=["onClick"],yt={key:0},bt=z(()=>e("span",{class:"v-line"},null,-1)),gt={class:"gray-text"},xt={key:0,class:"content-box"},$t={key:1,class:"content-box"},wt=["innerHTML"],Lt={key:2,class:"loading-box"},Ot={__name:"recall-testing",setup(l){F(),ie();const _=y(!1),c=y(!1),d=y([]),p=f=>{c.value=!1,d.value=f||[]},$=()=>{c.value=!0},b=f=>{if(!f.file_name){window.open(`/#/library/details/categary-manage?id=${f.library_id}`);return}window.open(`/#/library/preview?id=${f.file_id}`)};return(f,t)=>{const L=ee,N=E,q=ye;return n(),r("div",lt,[e("div",at,[i(L,null,{default:u(()=>[i(it,{onLoad:$,onSave:p})]),_:1})]),e("div",rt,[_.value||d.value.length===0?(n(),r("div",ct,ut)):(n(),x(L,{key:1},{default:u(()=>[(n(!0),r(S,null,R(d.value,a=>(n(),r("div",{class:"list-item",key:a.id},[e("div",mt,[e("div",pt,[h(" id："+m(a.id)+" ",1),a.title?(n(),r("div",vt,m(a.title),1)):k("",!0),e("span",null,"共"+m(a.word_total)+"个字符",1)])]),e("div",ft,[ht,e("div",{class:"link-text",onClick:M=>b(a)},[i(w($e)),h(" "+m(a.file_name)+" ",1),a.file_name?k("",!0):(n(),r("span",yt,m(a.library_name)+"-精选",1))],8,kt),bt,e("span",gt,[h("相似度： "),i(N,{name:"similarity",style:{"font-size":"16px"}}),h(" "+m(a.similarity),1)])]),a.question?(n(),r("div",xt,"Q："+m(a.question),1)):k("",!0),a.answer?(n(),r("div",$t,"A："+m(a.answer),1)):k("",!0),e("div",{class:"content-box",innerHTML:a.content},null,8,wt)]))),128))]),_:1})),c.value?(n(),r("div",Lt,[i(q)])):k("",!0)])])}}},cs=D(Ot,[["__scopeId","data-v-be7f9c8e"]]);export{cs as default};
