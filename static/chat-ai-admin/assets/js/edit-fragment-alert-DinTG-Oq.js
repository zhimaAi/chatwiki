import{_ as xe}from"./empty-CzGZrENG.js";import{b as Z,d3 as we,B as me,d as ae,M as ue,dA as qe,k as _e,bO as $e,W as Ie,E as Ce}from"../../index-Bo1NSLpy.js";import{N as _,O as r,X as t,d as x,z as W,b as ce,w as Y,j as n,U as i,a5 as N,Z as u,a6 as I,x as pe,F as M,a1 as X,S as A,_ as P,H as le,u as E,I as re,G as ve,ag as Pe,W as se}from"./vue-chunks-BRsu9_To.js";import{M as de}from"./model-select-BSeLg_eN.js";import{C as Se}from"./index-CEq6_GyH.js";import{M as Ue}from"./index-BMSQkwth.js";import{_ as ze}from"./index-Dc6vrBX7.js";import{_ as fe}from"./index-DrD42LNC.js";import{F as ie,_ as Le}from"./index-COWZrpvC.js";import{a as je,S as De}from"./index-Bs02Ec-o.js";import"./index-Caod9rOO.js";import{I as ge}from"./Input-CCKFAS4o.js";import{Q as oe}from"./QuestionCircleOutlined-VG1FNUnl.js";import{_ as Fe}from"./index-Bbrx8UDU.js";import{_ as ke}from"./index-B4MPC5xv.js";import{_ as Ne}from"./index-Dlji98bI.js";import{_ as ye}from"./TextArea--DLJ7VtX.js";import{_ as Me}from"./index-CNGEafUN.js";import{U as Oe}from"./index-CyCFeYRk.js";import{T as Te,_ as Ae}from"./index-DkO_ejiW.js";const Ee={},Ve={class:"empty-box"};function Be(V,z){return r(),_("div",Ve,z[0]||(z[0]=[t("img",{src:xe,alt:""},null,-1),t("div",{class:"title"},"暂无分段",-1),t("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)]))}const oo=Z(Ee,[["render",Be],["__scopeId","data-v-5569d09d"]]),Qe={class:"ai-generate-wrapper"},Re={class:"ai-generate-wrapper-left"},Ge={class:"form-box-wrapper-options"},He={class:"form-item flex1"},Ke={class:"form-content"},Je={class:"form-item flex1"},We={class:"form-content dual-inputs"},Xe={class:"input-group"},Ze={class:"form-label-input-box"},Ye={class:"form-item generate-btn-box"},et={class:"result-nav"},tt={key:0,class:"tip"},st={key:1,class:"result-nav-text"},ot={key:0,class:"container"},nt={class:"result-container"},lt=["innerHTML"],it={class:"result-footer"},at={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(V,{expose:z,emit:O}){const f=we(),q=x(!1),v=x(!1),s=x(!1),d=x(!1),c=W({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),H=new Ue({html:!0,linkify:!0,typographer:!0}),D=x(""),$=W({content:""}),S=ce(()=>f.initDocumentFragmentList);Y(()=>$.content,()=>{D.value=H.render($.content)});const L=O,B=x(""),j=["azure","ollama","xinference","openaiAgent"],m=x(!1),Q=()=>{v.value=!1,d.value=!1,m.value=!0},h=()=>{_e.success("操作成功"),v.value=!1,d.value=!1,m.value=!1,L("handleEdit",w.value)},w=x("");function F(p,a){let l="",e=0;for(const b of p){if(e>=a)break;const g=b.content.trim()||"",k=a-e;if(g.length<=k)l+=g,e+=g.length;else{l+=g.slice(0,k),e=a;break}}return l}const R=async()=>{$.content="",w.value="",s.value=!0,d.value=!0;try{const p=await F(S.value,c.count);let a={ai_prompt_model_config_id:c.model_config_id,ai_prompt_model:c.use_model,ai_prompt_question:p};const l=await qe(a);w.value=l.data,$.content=`<div class="dialog-message">${l.data}</div>`,v.value=!0}finally{s.value=!1}},T=p=>{c.use_model=j.includes(p.rawData.model_define)&&p.rawData.deployment_name?p.rawData.deployment_name:p.rawData.name,c.use_model_icon=p.icon,c.use_model_name=p.use_model_name,c.model_config_id=p.rawData.id,B.value=p.rawData.model_define},C=x([]),K=p=>{C.value=p,pe(()=>{(!c.ai_chunk_model||!Number(c.ai_chunk_model_config_id))&&y()})},y=()=>{if(C.value.length>0){let p=null,a=null;for(let l of C.value)if(l.model_define==="tongyi"){p=l;for(let e of p.children)if(e.name==="qwen-max"){a=e;break}break}p||(p=C.value[0],a=p.children[0]),p&&a&&(c.use_model=a.name,c.model_config_id=a.model_config_id,c.ai_chunk_model=a.name,c.ai_chunk_model_config_id=a.model_config_id)}};return z({showModal:Q}),(p,a)=>{const l=ze,e=fe,b=ae,g=me,k=ue;return r(),_("div",null,[n(k,{open:m.value,"onUpdate:open":a[2]||(a[2]=U=>m.value=U),onOk:h,maskClosable:!1,width:d.value?"944px":"472px","ok-button-props":{style:{display:"none"}}},{title:i(()=>a[3]||(a[3]=[t("div",{class:"custom-modal-header"},[t("span",null,"AI生成提示词")],-1)])),footer:i(()=>a[10]||(a[10]=[])),default:i(()=>[t("div",Qe,[t("div",{class:N(["form-box-wrapper ai-generate-wrapper-box",{"show-generate":d.value}])},[t("div",Re,[n(l,{class:"alert-box",message:"根据导入的文档的内容生成AI分段的提示词，支持设置导入文档的字数。",type:"info"}),t("div",Ge,[t("div",He,[a[4]||(a[4]=t("div",{class:"form-label required"},"选择模型：",-1)),t("div",Ke,[n(Se,{modelValue:c.use_model,"onUpdate:modelValue":a[0]||(a[0]=U=>c.use_model=U),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":c.model_config_id,onChange:T,onLoaded:K},null,8,["modelValue","model-config-id"])])]),t("div",Je,[t("div",We,[t("div",Xe,[a[6]||(a[6]=t("div",{class:"form-label required"},"根据文档内容前：",-1)),t("div",Ze,[n(e,{value:c.count,"onUpdate:value":a[1]||(a[1]=U=>c.count=U),min:1,max:1e4,style:{width:"137px"}},null,8,["value"]),a[5]||(a[5]=u("个字，自动生成提示词 "))])])])])]),t("div",Ye,[n(g,{onClick:R,loading:s.value,class:"generate-btn"},{default:i(()=>[n(b,{name:"ai-generate-white",style:{"font-size":"16px"}}),a[7]||(a[7]=u(" 开始生成 "))]),_:1,__:[7]},8,["loading"])])]),t("div",{class:N(["ai-generate-wrapper-right",{"show-result":d.value}])},[t("div",et,[n(b,{name:"generate-icon",style:{"font-size":"14px"}}),s.value?(r(),_("span",tt,"提示词生成中...")):(r(),_("div",st,"提示词生成完毕"))]),!$.content&&s.value&&!q.value?(r(),_("div",ot,a[8]||(a[8]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):I("",!0),t("div",nt,[t("div",{class:"dialog-content",innerHTML:D.value},null,8,lt)]),t("div",it,[n(g,{class:"result-footer-btn",disabled:w.value=="",type:"primary",onClick:h},{default:i(()=>a[9]||(a[9]=[u("使用该提示词")])),_:1,__:[9]},8,["disabled"])])],2)],2)])]),_:1},8,["open","width"])])}}},rt=Z(at,[["__scopeId","data-v-dea4b79a"]]),dt={class:"segmentation-setting"},mt={class:"setting-items"},ut={class:"setting-item intelligent-setting active"},_t={class:"setting-item-body"},ct={key:0,class:"custom-setting-form excel-qa-form"},pt={class:"form-item"},vt={class:"form-item-box"},ft={class:"form-item-body"},gt={class:"form-item-box"},kt={class:"form-item-body"},yt={class:"form-item-box"},bt={class:"form-item-body"},ht={class:"indexing-methods-box"},xt={class:"list-title-block"},wt={class:"list-title-block"},qt={class:"btn-box-block"},$t={key:1,class:"custom-setting-form excel-qa-form"},It={class:"form-item"},Ct={class:"form-item-box"},Pt={class:"form-item-body"},St={class:"form-item-box"},Ut={class:"form-item-body"},zt={class:"form-item-box"},Lt={class:"form-item-body"},jt={class:"indexing-methods-box"},Dt={class:"list-title-block"},Ft={class:"list-title-block"},Nt={class:"btn-box-block"},Mt={key:0,class:"custom-setting-form subsection-form"},Ot={class:"form-item"},Tt={key:0,class:"form-item-title"},At={class:"form-item-body"},Et={class:"select-card-box"},Vt={class:"card-title"},Bt={class:"card-title"},Qt={class:"card-title"},Rt={class:"form-item",style:{"margin-bottom":"18px"}},Gt={class:"form-item-body"},Ht={class:"form-item"},Kt={class:"form-item-body"},Jt={class:"form-item"},Wt={class:"form-item-body"},Xt={class:"form-item"},Zt={class:"form-item-body"},Yt={class:"form-item",style:{"margin-bottom":"16px"}},es={class:"form-item-body"},ts={class:"form-item",style:{"margin-bottom":"16px"}},ss={class:"form-item-label"},os={class:"form-item-body"},ns={class:"form-item"},ls={class:"form-item-body"},is={class:"form-item"},as={class:"form-item-body"},rs={class:"form-item",style:{"margin-bottom":"16px"}},ds={class:"form-item-body"},ms={class:"form-item",style:{"margin-bottom":"16px"}},us={class:"form-item-body"},_s={class:"form-item",style:{"margin-bottom":"16px"}},cs={class:"form-item-label"},ps={class:"form-item-body form-item-inptu-numbner-box"},vs={class:"btn-box-block"},fs={class:"btn-box-block"},ne="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",gs={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(V,{expose:z,emit:O}){const f=ie.useForm,q=O,v=V;ce(()=>v.libFileInfo.doc_type=="1"&&(v.libFileInfo.file_ext=="docx"||v.libFileInfo.file_ext=="html")),Y(v,l=>{let e=l.libFileInfo,b=e.separators_no?e.separators_no.split(","):[11,12];s.separators_no=b.map(g=>+g),s.chunk_size=+e.chunk_size||512,s.not_merged_text=e.not_merged_text=="true",s.ai_chunk_size=+e.ai_chunk_size||5e3,s.chunk_overlap=+e.chunk_overlap||50,s.question_lable=e.question_lable,s.similar_label=e.similar_label,s.answer_lable=e.answer_lable,s.question_column=e.question_column||void 0,s.answer_column=e.answer_column||void 0,s.similar_column=e.similar_column||void 0,s.qa_index_type=+e.qa_index_type,s.enable_extract_image=e.enable_extract_image=="true",s.chunk_type=+e.chunk_type,s.semantic_chunk_size=+e.semantic_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.ai_chunk_prumpt=e.ai_chunk_prumpt||ne,s.ai_chunk_model=e.ai_chunk_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:"",s.ai_chunk_model_config_id=e.ai_chunk_model_config_id>0?e.ai_chunk_model_config_id:"",setTimeout(()=>{s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(b=e.normal_chunk_default_separators_no?e.normal_chunk_default_separators_no.split(","):[11,12],s.separators_no=b.map(g=>+g),s.chunk_size=+e.normal_chunk_default_chunk_size||512,s.not_merged_text=e.normal_chunk_default_not_merged_text=="true",s.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,s.chunk_type=+e.default_chunk_type,s.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=e.default_use_model,s.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),s.is_qa_doc=v.library_type==2?1:0});const s=W({separators_no:[],not_merged_text:!1,chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:ne});let d={};setTimeout(()=>{d=JSON.parse(JSON.stringify(s))},500);const c=x([]),H=x(null),D=l=>{c.value=l,pe(()=>{(!s.ai_chunk_model||!Number(s.ai_chunk_model_config_id))&&$()})},$=()=>{if(c.value.length>0){let l=null,e=null;for(let b of c.value)if(b.model_define==="tongyi"){l=b;for(let g of l.children)if(g.name==="qwen-max"){e=g;break}break}l||(l=c.value[0],e=l.children[0]),l&&e&&(s.ai_chunk_model=e.name,s.ai_chunk_model_config_id=e.model_config_id)}},S=()=>{Object.assign(s,d)},L=()=>{q("save")},B=W({question_lable:[{message:"请输入问题开始标识符",validator:async(l,e)=>s.is_qa_doc==1&&v.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(l,e)=>s.is_qa_doc==0&&s.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(l,e)=>s.is_qa_doc==0&&s.chunk_type==3?e?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(l,e)=>s.is_qa_doc==1&&v.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(l,e)=>v.mode!=1&&s.is_qa_doc==0&&e.length==0&&s.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(l,e)=>{if(v.mode!=1&&s.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(s.chunk_type==3&&!e)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(l,e)=>s.chunk_type==3&&!e?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(l,e)=>!s.ai_chunk_prumpt&&!e?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(l,e)=>v.mode!=1&&s.chunk_type==1&&e>parseInt(s.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(l,e)=>v.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(l,e)=>v.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:j,validate:m,validateInfos:Q}=f(s,B),h=x(!1),w=x(!1),F=()=>{h.value=!0,s.chunk_type!=3&&(w.value=!0),R()},R=(l=!0)=>{let e=ve(s);m().then(()=>{q("change",{...e}),q("validate","")}).catch(b=>{const{errorFields:g}=b;if(g.length>0){l&&g[0].name,_e.error(g[0].errors[0]),q("validate",g[0].errors[0]),h.value=!1,w.value=!1;return}q("validate",""),q("change",{...e})})};let T=null;const C=()=>{T&&(clearTimeout(T),T=null),T=setTimeout(()=>{R()},500)},K=x([]);(()=>{$e().then(l=>{K.value=l.data||[]})})();const p=l=>{l!=s.qa_index_type&&(s.qa_index_type=l,R())},a=l=>{s.ai_chunk_prumpt=l};return Y(()=>s.chunk_type,l=>{q("changeChunkType",l)}),Y(()=>h.value,l=>{}),z({formState:s,reLoading:h,saveLoading:w,reChange:F}),(l,e)=>{const b=je,g=De,k=ae,U=me,ee=ge,J=fe,G=Fe,te=ke,be=Ne,he=ye;return r(),_("div",dt,[t("div",mt,[t("div",ut,[t("div",_t,[I("",!0),s.is_qa_doc==1?(r(),_(M,{key:1},[e[48]||(e[48]=t("div",{class:"sub-setting-item-name"},"文件切分",-1)),v.mode==1?(r(),_("div",ct,[t("div",pt,[t("div",vt,[e[28]||(e[28]=t("div",{class:"form-item-label"},"问题所在列：",-1)),t("div",ft,[n(g,{value:s.question_column,"onUpdate:value":e[2]||(e[2]=o=>s.question_column=o),onChange:C,placeholder:"请选择列名",style:{width:"100%"}},{default:i(()=>[(r(!0),_(M,null,X(v.excellQaLists,o=>(r(),A(b,{value:o.value,key:o.value},{default:i(()=>[u(P(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",gt,[e[29]||(e[29]=t("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),t("div",kt,[n(g,{allowClear:"",value:s.similar_column,"onUpdate:value":e[3]||(e[3]=o=>s.similar_column=o),onChange:C,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:i(()=>[(r(!0),_(M,null,X(v.excellQaLists,o=>(r(),A(b,{value:o.value,key:o.value},{default:i(()=>[u(P(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",yt,[e[30]||(e[30]=t("div",{class:"form-item-label"},"答案所在列：",-1)),t("div",bt,[n(g,{value:s.answer_column,"onUpdate:value":e[4]||(e[4]=o=>s.answer_column=o),onChange:C,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:i(()=>[(r(!0),_(M,null,X(v.excellQaLists,o=>(r(),A(b,{value:o.value,key:o.value},{default:i(()=>[u(P(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),e[37]||(e[37]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",ht,[t("div",{class:N(["list-item",{active:s.qa_index_type==1}]),onClick:e[5]||(e[5]=o=>p(1))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),t("div",xt,[n(k,{name:"file-search"}),e[31]||(e[31]=u(" 问题与答案一起生成索引 "))]),e[32]||(e[32]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:N(["list-item",{active:s.qa_index_type==2}]),onClick:e[6]||(e[6]=o=>p(2))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),t("div",wt,[n(k,{name:"comment-search"}),e[33]||(e[33]=u(" 仅对问题生成索引 "))]),e[34]||(e[34]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[36]||(e[36]=t("div",{class:"btn-box-block"},null,-1)),t("div",qt,[n(U,{type:"primary",block:"",onClick:L},{default:i(()=>e[35]||(e[35]=[u("保存")])),_:1,__:[35]})])])])):(r(),_("div",$t,[t("div",It,[t("div",Ct,[e[38]||(e[38]=t("div",{class:"form-item-label"},"问题开始标识符：",-1)),t("div",Pt,[n(ee,{placeholder:"请输入标识符",value:s.question_lable,"onUpdate:value":e[7]||(e[7]=o=>s.question_lable=o),onChange:C},null,8,["value"])])]),t("div",St,[e[39]||(e[39]=t("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),t("div",Ut,[n(ee,{placeholder:"请输入标识符",value:s.similar_label,"onUpdate:value":e[8]||(e[8]=o=>s.similar_label=o),onChange:C},null,8,["value"])])]),t("div",zt,[e[40]||(e[40]=t("div",{class:"form-item-label"},"答案开始标识符：",-1)),t("div",Lt,[n(ee,{placeholder:"请输入标识符",value:s.answer_lable,"onUpdate:value":e[9]||(e[9]=o=>s.answer_lable=o),onChange:C},null,8,["value"])])])]),e[47]||(e[47]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",jt,[t("div",{class:N(["list-item",{active:s.qa_index_type==1}]),onClick:e[10]||(e[10]=o=>p(1))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),t("div",Dt,[n(k,{name:"file-search"}),e[41]||(e[41]=u(" 问题与答案一起生成索引 "))]),e[42]||(e[42]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:N(["list-item",{active:s.qa_index_type==2}]),onClick:e[11]||(e[11]=o=>p(2))},[n(k,{class:"check-icon",name:"check-arrow-filled"}),t("div",Ft,[n(k,{name:"comment-search"}),e[43]||(e[43]=u(" 仅对问题生成索引 "))]),e[44]||(e[44]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[46]||(e[46]=t("div",{class:"btn-box-block"},null,-1)),t("div",Nt,[n(U,{type:"primary",block:"",onClick:L},{default:i(()=>e[45]||(e[45]=[u("保存")])),_:1,__:[45]})])])]))],64)):(r(),_(M,{key:2},[v.mode!=1?(r(),_("div",Mt,[t("div",Ot,[V.status==="paragraphsSegmented"?(r(),_("div",Tt,"分段及清洗规则")):I("",!0),e[56]||(e[56]=t("div",{class:"form-item-label"},"分段方式：",-1)),t("div",At,[e[55]||(e[55]=t("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),t("div",Et,[t("div",{class:N(["select-card-item",{active:s.chunk_type==1}]),onClick:e[12]||(e[12]=o=>s.chunk_type=1)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Vt,[n(k,{name:"ordinary-segmentation",class:"title-icon"}),e[49]||(e[49]=u(" 普通分段 "))]),e[50]||(e[50]=t("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),t("div",{class:N(["select-card-item",{active:s.chunk_type==2}]),onClick:e[13]||(e[13]=o=>s.chunk_type=2)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Bt,[n(k,{name:"semantic-segmentation",class:"title-icon"}),e[51]||(e[51]=u(" 语义分段 "))]),e[52]||(e[52]=t("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),t("div",{class:N(["select-card-item",{active:s.chunk_type==3}]),onClick:e[14]||(e[14]=o=>s.chunk_type=3)},[n(k,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Qt,[n(k,{name:"semantic-segmentation",class:"title-icon"}),e[53]||(e[53]=u(" AI分段 "))]),e[54]||(e[54]=t("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])])]),s.chunk_type==1?(r(),_(M,{key:0},[t("div",Rt,[e[57]||(e[57]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",Gt,[n(g,{placeholder:"请选择",style:{width:"100%"},mode:"multiple",value:s.separators_no,"onUpdate:value":e[15]||(e[15]=o=>s.separators_no=o)},{default:i(()=>[(r(!0),_(M,null,X(K.value,o=>(r(),A(b,{value:o.no,key:o.no},{default:i(()=>[u(P(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),n(G,{gap:16},{default:i(()=>[t("div",Ht,[e[59]||(e[59]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",Kt,[n(G,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.chunk_size,"onUpdate:value":e[16]||(e[16]=o=>s.chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),e[58]||(e[58]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[58]})])]),t("div",Jt,[e[61]||(e[61]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",Wt,[n(G,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.chunk_overlap,"onUpdate:value":e[17]||(e[17]=o=>s.chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),e[60]||(e[60]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[60]})])])]),_:1}),t("div",Xt,[t("div",Zt,[n(G,{align:"center"},{default:i(()=>[t("div",null,[e[62]||(e[62]=u("自动合并较小分段 ")),n(te,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:i(()=>[n(E(oe))]),_:1}),e[63]||(e[63]=u(" ："))]),n(be,{checkedValue:!1,unCheckedValue:!0,checked:s.not_merged_text,"onUpdate:checked":e[18]||(e[18]=o=>s.not_merged_text=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})])])],64)):I("",!0),le(t("div",null,[t("div",Yt,[e[64]||(e[64]=t("div",{class:"form-item-label"},"嵌入模型：",-1)),t("div",es,[n(de,{modelType:"TEXT EMBEDDING",modeName:s.semantic_chunk_use_model,"onUpdate:modeName":e[19]||(e[19]=o=>s.semantic_chunk_use_model=o),modeId:s.semantic_chunk_model_config_id,"onUpdate:modeId":e[20]||(e[20]=o=>s.semantic_chunk_model_config_id=o),style:{width:"100%"},onLoaded:D},null,8,["modeName","modeId"])])]),t("div",ts,[t("div",ss,[e[66]||(e[66]=u(" 分段阈值 ")),n(te,null,{title:i(()=>e[65]||(e[65]=[u("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")])),default:i(()=>[n(E(oe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[67]||(e[67]=u("： "))]),t("div",os,[n(J,{style:{width:"100%"},value:s.semantic_chunk_threshold,"onUpdate:value":e[21]||(e[21]=o=>s.semantic_chunk_threshold=o),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),n(G,{gap:16},{default:i(()=>[t("div",ns,[e[69]||(e[69]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",ls,[n(G,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_size,"onUpdate:value":e[22]||(e[22]=o=>s.semantic_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),e[68]||(e[68]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[68]})])]),t("div",is,[e[71]||(e[71]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",as,[n(G,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_overlap,"onUpdate:value":e[23]||(e[23]=o=>s.semantic_chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),e[70]||(e[70]=t("span",{class:"unit-text"},"字符",-1))]),_:1,__:[70]})])])]),_:1})],512),[[re,s.chunk_type==2]]),le(t("div",null,[t("div",rs,[e[72]||(e[72]=t("div",{class:"form-item-label"},"AI大模型：",-1)),t("div",ds,[n(de,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:s.ai_chunk_model,"onUpdate:modeName":e[24]||(e[24]=o=>s.ai_chunk_model=o),modeId:s.ai_chunk_model_config_id,"onUpdate:modeId":e[25]||(e[25]=o=>s.ai_chunk_model_config_id=o),style:{width:"100%"},onLoaded:D},null,8,["modeName","modeId"])])]),t("div",ms,[e[73]||(e[73]=t("div",{class:"form-item-label-box"},[t("div",{class:"form-item-label"},"提示词设置：")],-1)),t("div",us,[n(he,{maxLength:500,style:{height:"80px"},value:s.ai_chunk_prumpt,"onUpdate:value":e[26]||(e[26]=o=>s.ai_chunk_prumpt=o),placeholder:ne},null,8,["value"])])]),t("div",_s,[t("div",cs,[e[75]||(e[75]=u(" 单次最大字符数 ")),n(te,null,{title:i(()=>e[74]||(e[74]=[u("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")])),default:i(()=>[n(E(oe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[76]||(e[76]=u("： "))]),t("div",ps,[n(J,{class:"form-item-inptu-numbner",value:s.ai_chunk_size,"onUpdate:value":e[27]||(e[27]=o=>s.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),e[77]||(e[77]=u(" 字符 "))])])],512),[[re,s.chunk_type==3]]),t("div",vs,[n(U,{onClick:S,style:{flex:"1"}},{default:i(()=>e[78]||(e[78]=[u("重置")])),_:1,__:[78]}),n(U,{onClick:F,loading:h.value,style:{flex:"1"},type:"primary",ghost:""},{default:i(()=>e[79]||(e[79]=[u("生成分段预览")])),_:1,__:[79]},8,["loading"])]),t("div",fs,[v.hideSave?I("",!0):(r(),A(U,{key:0,type:"primary",block:"",disabled:w.value,onClick:L},{default:i(()=>e[80]||(e[80]=[u("保存")])),_:1,__:[80]},8,["disabled"]))])])):I("",!0)],64))])])]),n(rt,{ref_key:"aiGenerateRef",ref:H,onHandleEdit:a},null,512)])}}},no=Z(gs,[["__scopeId","data-v-6179cb34"]]),ks={class:"document-fragment"},ys={class:"fragment-header"},bs={class:"fragment-info"},hs={class:"fragment-number"},xs={key:0,class:"fragment-title"},ws={class:"fragment-content-lenght"},qs={key:1,class:"fragment-content-status"},$s={class:"cfb363f"},Is={class:"fragment-action"},Cs={class:"fragment-content"},Ps={key:0,class:"fragment-content"},Ss={key:1,class:"fragment-content"},Us={key:2,class:"fragment-content"},zs={class:"fragment-img"},Ls=["src"],js={__name:"document-fragment",props:{number:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}}},emits:["edit","delete"],setup(V,{emit:z}){const O=z,f=V,q=()=>{O("edit")},v=()=>{O("delete")};return(s,d)=>{var $,S,L;const c=ke,H=Me,D=Pe("viewer");return r(),_("div",ks,[t("div",ys,[t("div",bs,[t("span",hs,"#"+P(f.number),1),f.title?(r(),_("span",xs,P(f.title),1)):I("",!0),t("span",ws,"共"+P(f.total)+"个字符",1),f.status==="paragraphsSegmented"?(r(),_("span",qs,[u(P((($=f.currentData)==null?void 0:$.status_text)||"-"),1),((S=f.currentData)==null?void 0:S.status)==3?(r(),A(E(Ie),{key:0})):I("",!0),((L=f.currentData)==null?void 0:L.status)==2&&f.currentData.errmsg?(r(),A(c,{key:1,title:f.currentData.errmsg},{default:i(()=>[t("strong",$s,[d[0]||(d[0]=u("原因")),n(E(Ce),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):I("",!0)])):I("",!0)]),t("div",Is,[t("a",{onClick:q},"编辑"),n(H,{type:"vertical"}),t("a",{onClick:v},"删除")])]),t("div",Cs,P(f.content),1),f.question?(r(),_("div",Ps,"Q："+P(f.question),1)):I("",!0),f.similar_question_list&&f.similar_question_list.join("")?(r(),_("div",Ss," 相似问法："+P(f.similar_question_list.join("/")),1)):I("",!0),f.answer?(r(),_("div",Us,"A："+P(f.answer),1)):I("",!0),le((r(),_("div",zs,[(r(!0),_(M,null,X(f.images,(B,j)=>(r(),_("img",{key:j,src:B,alt:""},null,8,Ls))),128))])),[[D]])])}}},lo=Z(js,[["__scopeId","data-v-50ad2b8c"]]),Ds={class:"upload-box-wrapper"},Fs={key:0},Ns={__name:"edit-fragment-alert",emits:["ok"],setup(V,{expose:z,emit:O}){const f=O,q=x("1"),v=ie.useForm,s=x(!1),d=W({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),c=W({content:[{message:"请输入分段内容",validator:async(j,m)=>S.value||m?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(j,m)=>S.value?m?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(j,m)=>S.value?m?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:H,validate:D,validateInfos:$}=v(d,c),S=x(!1),L=({title:j,content:m,question:Q,answer:h,images:w,similar_question_list:F})=>{d.title=j,d.content=m,d.question=Q,d.answer=h,d.images=w||[],d.similar_question_list=F?F.join(`
`):"",S.value=Q!="",s.value=!0},B=()=>{D().then(()=>{s.value=!1,f("ok",ve(d))})};return z({open:L}),(j,m)=>{const Q=ge,h=Le,w=ye,F=ae,R=Ae,T=Te,C=ie,K=ue;return r(),_("div",null,[n(K,{open:s.value,"onUpdate:open":m[7]||(m[7]=y=>s.value=y),title:"编辑分段",onOk:B,width:"746px"},{default:i(()=>[n(C,{layout:"vertical"},{default:i(()=>[n(h,{label:"分段标题："},{default:i(()=>[n(Q,{type:"text",placeholder:"请输入分段标题",value:d.title,"onUpdate:value":m[0]||(m[0]=y=>d.title=y)},null,8,["value"])]),_:1}),S.value?(r(),_(M,{key:0},[n(h,se({label:"分段问题："},E($).question),{default:i(()=>[n(w,{placeholder:"请输入分段问题",value:d.question,"onUpdate:value":m[1]||(m[1]=y=>d.question=y),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(h,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:i(()=>[n(w,{placeholder:"请输入相似问法",value:d.similar_question_list,"onUpdate:value":m[2]||(m[2]=y=>d.similar_question_list=y),style:{height:"100px"}},null,8,["value"])]),_:1}),n(h,se({label:"分段答案："},E($).answer),{default:i(()=>[n(w,{placeholder:"请输入分段答案",value:d.answer,"onUpdate:value":m[3]||(m[3]=y=>d.answer=y),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(r(),A(h,se({key:1,label:"分段内容："},E($).content),{default:i(()=>[n(w,{placeholder:"请输入分段内容",value:d.content,"onUpdate:value":m[4]||(m[4]=y=>d.content=y),style:{height:"150px"}},null,8,["value"])]),_:1},16)),n(h,{label:"附件"},{default:i(()=>[t("div",Ds,[n(T,{activeKey:q.value,"onUpdate:activeKey":m[5]||(m[5]=y=>q.value=y),size:"small"},{default:i(()=>[n(R,{key:"1"},{tab:i(()=>[t("span",null,[n(F,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),m[8]||(m[8]=u(" 图片 ")),d.images.length?(r(),_("span",Fs,"("+P(d.images.length)+")",1)):I("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Oe,{value:d.images,"onUpdate:value":m[6]||(m[6]=y=>d.images=y)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},io=Z(Ns,[["__scopeId","data-v-24be9e8e"]]);export{lo as D,io as E,no as S,oo as a};
