{"version":3,"file":"index-BJwSn49_.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/components/chart-box.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/components/search-input.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/components/file-list.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/components/entity-details.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/components/collapse-btn.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/knowledge-graph/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.chart-wrapper {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #F2F4F7;\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 100%;\r\n  user-select: none;\r\n  touch-action: none;\r\n}\r\n\r\n.chart-mini-map {\r\n  position: absolute;\r\n  right: 10px;\r\n  bottom: 82px;\r\n  width: 200px;\r\n  height: 160px;\r\n  border-radius: 6px;\r\n  border: 1px solid #fff;\r\n  background-color: #fff;\r\n  filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.1));\r\n}\r\n\r\n.zoom-toolbar-wrapper{\r\n  position: absolute;\r\n  right: 22px;\r\n  bottom: 30px;\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"chart-wrapper\">\r\n    <div class=\"chart\" id=\"chartBox\" ref=\"chartBox\"></div>\r\n    <div class=\"chart-mini-map\" id=\"chatMap\"></div>\r\n    <div class=\"zoom-toolbar-wrapper\">\r\n      <ZoomToolbar :value=\"initialZoom\" @change=\"onZoomChange\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, reactive } from 'vue'\r\nimport { NVL } from '@neo4j-nvl/base'\r\nimport {\r\n  ZoomInteraction,\r\n  PanInteraction,\r\n  // DragNodeInteraction, \r\n  HoverInteraction,\r\n  ClickInteraction\r\n} from '@neo4j-nvl/interaction-handlers'\r\nimport ZoomToolbar from './zoom-toolbar/index.vue'\r\n\r\nconst emit = defineEmits(['nodeClick'])\r\n\r\nconst chartBox = ref(null)\r\nlet nvl = null\r\n\r\nconst state = reactive({\r\n  nodes: [],\r\n  edges: []\r\n})\r\n\r\nconst initialZoom = ref(1)\r\n\r\nconst init = () => {\r\n  if (nvl) {\r\n    nvl.destroy()\r\n  }\r\n\r\n  const options = {\r\n    layout: 'forceDirected',\r\n    initialZoom: initialZoom.value,  // 减小初始缩放比例以显示更多节点\r\n    disableTelemetry: true,\r\n    maxZoom: 10,\r\n    minZoom: 0.1,\r\n    minimapContainer: document.getElementById('chatMap'),\r\n    styling: {\r\n      minimapViewportBoxColor: '#4399FF',\r\n      // dropShadowColor: 'rgba(255, 255, 255, 1)', // 用于悬停节点和关系的投影的颜色\r\n      selectedBorderColor: 'rgba(255, 255, 255, 1)', // 用于节点和关系的选定边界的颜色\r\n      // selectedInnerBorderColor: 'rgba(255, 255, 255, 1)', // 用于选定节点的边框的颜色\r\n    }\r\n  }\r\n\r\n  const container = document.getElementById('chartBox')\r\n\r\n  nvl = new NVL(container, state.nodes, state.edges, options)\r\n\r\n  // 开启缩放和拖拽\r\n  const zoomInteraction = new ZoomInteraction(nvl)\r\n  // eslint-disable-next-line no-unused-vars\r\n  const pan = new PanInteraction(nvl)\r\n\r\n  zoomInteraction.updateCallback('onZoom', (zoomLevel) => {\r\n    initialZoom.value = Number(zoomLevel.toFixed(1))\r\n  })\r\n\r\n  // 用于拖拽节点的交互处理程序\r\n  // const dragNodeInteraction = new DragNodeInteraction(nvl)\r\n\r\n  // 用于悬停节点的交互处理程序\r\n  new HoverInteraction(nvl, { drawShadowOnHover: true })\r\n\r\n  // 用于点击节点的交互处理程序\r\n  const clickInteraction = new ClickInteraction(nvl, {\r\n    selectOnClick: true\r\n  })\r\n  \r\n  clickInteraction.updateCallback('onNodeClick', (node) => {\r\n    emit('nodeClick', node)\r\n  })\r\n}\r\n\r\nconst onZoomChange = (value) => {\r\n  initialZoom.value = value\r\n  if (nvl) {\r\n    nvl.setZoom(value)\r\n  }\r\n}\r\n\r\nconst add = ({ nodes, edges }) => {\r\n  state.nodes = [state.nodes, ...nodes]\r\n  state.edges = [state.edges, ...edges]\r\n\r\n  if (nvl) {\r\n    nvl.addElementsToGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst addAndUpdate = ({ nodes, edges }) => {\r\n  state.nodes = [state.nodes, ...nodes]\r\n  state.edges = [state.edges, ...edges]\r\n\r\n  if (nvl) {\r\n    nvl.addAndUpdateElementsInGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst update = ({ nodes, edges }) => {\r\n  state.nodes = nodes\r\n  state.edges = edges\r\n\r\n  if (nvl) {\r\n    nvl.updateElementsInGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst render = ({ nodes, edges }) => {\r\n  state.nodes = nodes\r\n  state.edges = edges\r\n\r\n  init()\r\n}\r\n\r\nonMounted(() => {\r\n  \r\n})\r\n\r\ndefineExpose({\r\n  render,\r\n  add,\r\n  addAndUpdate,\r\n  update\r\n})\r\n</script>\r\n","\r\n\r\n<template>\r\n  <div class=\"search-input-box\" :class=\"{ 'focused': isFocused }\">\r\n    <input \r\n      ref=\"searchInput\"\r\n      class=\"search-input\" \r\n      v-model=\"localValue\" \r\n      placeholder=\"输入关键词搜索\" \r\n      type=\"text\"\r\n      @keyup.enter=\"handleSearch\"\r\n      @focus=\"isFocused = true\"\r\n      @blur=\"isFocused = false\"\r\n      @input=\"onInput\"\r\n    />\r\n    <div class=\"search-action-box\">\r\n      <span class=\"action-btn\" v-if=\"value.length > 0\" @click=\"clearValue\">\r\n        <CloseCircleFilled class=\"clear-icon\" />\r\n      </span>\r\n      <span class=\"action-btn\" @click=\"handleSearch\">\r\n        <SearchOutlined class=\"search-icon\" />\r\n      </span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, nextTick, watch } from 'vue'\r\nimport { SearchOutlined, CloseCircleFilled } from '@ant-design/icons-vue'\r\n\r\nconst emit = defineEmits(['search', 'clear', 'input', 'update:value'])\r\n\r\nconst props = defineProps({\r\n  value: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst localValue = ref(props.value)\r\nconst isFocused = ref(false)\r\nconst searchInput = ref(null)\r\n\r\nconst onInput = () => {\r\n  emit('update:value', localValue.value)\r\n}\r\n\r\n// 清空输入框内容\r\nconst clearValue = () => {\r\n  localValue.value = ''\r\n  nextTick(() => {\r\n    searchInput.value?.focus()\r\n  })\r\n\r\n  onInput()\r\n\r\n  handleSearch()\r\n}\r\n\r\nconst handleSearch = () => {\r\n  emit('search', localValue.value)\r\n}\r\n\r\nwatch(() => props.value, (val) => {\r\n  if(localValue.value !== val){\r\n    localValue.value = val\r\n  }\r\n})\r\n\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.search-input-box {\r\n  position: relative;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 12px 24px;\r\n  border-radius: 12px;\r\n  border: 1px solid #BFBFBF;\r\n  background-color: #fff;\r\n  transition: all 0.2s ease;\r\n  filter: drop-shadow(0 4px 4px rgba(0, 89, 255, 0.16));\r\n\r\n  &:hover,\r\n  &.focused {\r\n    border: 1px solid #2475FC;\r\n    filter: drop-shadow(0 4px 8px rgba(0, 89, 255, 0.16));\r\n  }\r\n\r\n\r\n  .search-icon{\r\n    color: #595959;\r\n    font-size: 24px;\r\n  }\r\n  .clear-icon{\r\n    color: #BFBFBF;\r\n    font-size: 20px;\r\n  }\r\n  .search-input {\r\n    flex: 1;\r\n    line-height: 24px;\r\n    font-size: 16px;\r\n    font-weight: 400;\r\n    border-radius: 8px;\r\n    color: rgb(38, 38, 38);\r\n    border: none;\r\n    outline: none;\r\n    background-color: #fff;\r\n    &::placeholder {\r\n      color: rgb(140, 140, 140);\r\n    }\r\n  }\r\n  .search-action-box{\r\n    display: flex;\r\n    align-items: center;\r\n\r\n    .action-btn{\r\n      width: 32px;\r\n      height: 32px;\r\n      margin-left: 12px;\r\n      border-radius: 6px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      cursor: pointer;\r\n      &:hover{\r\n        background-color: rgba(228, 230, 235, 1);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\n</style>","<style lang=\"less\" scoped>\r\n.file-list-wrapper {\r\n  position: relative;\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  height: 100%;\r\n  width: 256px;\r\n  height: 100%;\r\n  padding: 16px 0;\r\n  border-radius: 6px;\r\n  background: #fff;\r\n}\r\n\r\n.open-file-box {\r\n  padding: 0 8px;\r\n  user-select: none;\r\n}\r\n\r\n.file-list-box {\r\n  flex: 1;\r\n  overflow: hidden;\r\n  user-select: none;\r\n\r\n  .file-items {\r\n    padding: 0 8px;\r\n  }\r\n\r\n  .loading-box {\r\n    padding-left: 8px !important;\r\n  }\r\n}\r\n\r\n.file-item {\r\n  margin-bottom: 4px;\r\n\r\n  &.active .file-info,\r\n  .file-info:hover {\r\n    color: #2475FC;\r\n    background: #E6EFFF;\r\n  }\r\n\r\n  .file-info {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 5px 8px;\r\n    border-radius: 6px;\r\n    color: #262626;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n\r\n    .caret-icon {\r\n      font-size: 16px;\r\n      color: #595959;\r\n    }\r\n\r\n    .file-icon {\r\n      margin-left: 4px;\r\n      font-size: 16px;\r\n    }\r\n\r\n    .file-name {\r\n      flex: 1;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      margin-left: 4px;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n  }\r\n\r\n  .document-fragments {\r\n    overflow: hidden;\r\n\r\n    .loading-box {\r\n      padding-left: 44px !important;\r\n    }\r\n  }\r\n\r\n  .fragment-list {\r\n    .fragment-item {\r\n      padding: 5px 8px 5px 44px;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n\r\n      &:hover,\r\n      &.active {\r\n        background-color: #F2F4F7;\r\n      }\r\n\r\n      .doc-content {\r\n        line-height: 22px;\r\n        max-height: 44px;\r\n        font-size: 14px;\r\n        font-weight: 400;\r\n        color: #595959;\r\n        -webkit-line-clamp: 2;\r\n        line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        display: -webkit-box;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        white-space: normal;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.fragment-details {\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 264px;\r\n  width: 320px;\r\n  height: 60%;\r\n  border-radius: 12px;\r\n  background: #fff;\r\n\r\n  .fragment-title {\r\n    line-height: 22px;\r\n    padding: 16px 16px 0 16px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #262626;\r\n  }\r\n\r\n  .fragment-details-body {\r\n    flex: 1;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .fragment-content {\r\n    line-height: 22px;\r\n    padding: 8px 16px 16px 16px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    color: #595959;\r\n    overflow: hidden;\r\n  }\r\n}\r\n\r\n.loading-box {\r\n  display: flex;\r\n  align-items: center;\r\n  margin: 10px 0;\r\n\r\n  .loading-text {\r\n    margin-left: 4px;\r\n    font-size: 14px;\r\n    color: #595959;\r\n  }\r\n}\r\n\r\n.slide-fade-enter-active,\r\n.slide-fade-leave-active {\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.slide-fade-enter-from,\r\n.slide-fade-leave-to {\r\n  opacity: 0;\r\n  transform: translateX(-20px);\r\n}\r\n</style>\r\n\r\n<template>\r\n  <transition name=\"slide-fade\">\r\n    <div class=\"file-list-wrapper\" v-if=\"props.show\">\r\n      <div class=\"open-file-box\">\r\n        <div class=\"file-item active\" v-if=\"currentOpenFile.show\">\r\n          <div class=\"file-info\">\r\n            <CaretDownFilled class=\"caret-icon\" @click=\"hideFragmentList()\" v-if=\"fragmentList.show\" />\r\n            <CaretRightOutlined class=\"caret-icon\" @click=\"showFragmentList()\" v-else />\r\n            <svg-icon class=\"file-icon\" name=\"doc-file\" style=\"\"></svg-icon>\r\n            <span class=\"file-name\" @click=\"openFile(currentOpenFile)\">{{ currentOpenFile.file_name }}</span>\r\n          </div>\r\n          <div class=\"document-fragments\" :style=\"{maxHeight: maxHeight + 'px', height: fragmentsHeight > 0 ? fragmentsHeight + 'px' : 'auto' }\"\r\n            v-if=\"fragmentList.show\">\r\n            <cu-scroll ref=\"fragmentsScrollView\" group-id=\"a\" @onScrollEnd=\"onLoadFragmentListt\">\r\n              <div class=\"fragment-list\" ref=\"fragmentListRef\">\r\n                <div class=\"fragment-item\" :class=\"{ active: activeFragmentId == item.id }\"\r\n                  @mouseenter=\"showFragmentDetails(item)\" @mouseleave=\"handleFragmentLeave\" @click=\"openFragment(item)\"\r\n                  v-for=\"item in fragmentList.list\" :key=\"item.id\">\r\n                  <div class=\"doc-content\">{{ item.content }}</div>\r\n                </div>\r\n              </div>\r\n              <template v-if=\"fragmentList.list.length < fragmentList.total\">\r\n                <div class=\"loading-box\"><a-spin size=\"small\" /> <span class=\"loading-text\">加载中...</span></div>\r\n              </template>\r\n            </cu-scroll>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"file-list-box \">\r\n        <cu-scroll group-id=\"a\" @onScrollEnd=\"onLoadFileList\">\r\n          <div class=\"file-items\">\r\n            <template v-for=\"item in fileList.list\" :key=\"item.id\">\r\n              <div class=\"file-item\" v-if=\"item.id != currentOpenFile.id\">\r\n                <div class=\"file-info\" @click=\"openFile(item)\">\r\n                  <CaretRightOutlined class=\"caret-icon\" />\r\n                  <svg-icon class=\"file-icon\" name=\"doc-file\" style=\"\"></svg-icon>\r\n                  <span class=\"file-name\">{{ item.file_name }}</span>\r\n                </div>\r\n              </div>\r\n            </template>\r\n\r\n            <template v-if=\"fileList.showMore\">\r\n              <div class=\"loading-box\"><a-spin size=\"small\" /> <span class=\"loading-text\">加载中...</span></div>\r\n            </template>\r\n          </div>\r\n        </cu-scroll>\r\n      </div>\r\n\r\n      <div class=\"fragment-details\" v-if=\"fragmentDetails.show\" @mouseenter=\"handleDetailsEnter\"\r\n        @mouseleave=\"hideFragmentDetails\">\r\n        <div class=\"fragment-title\">{{ fragmentDetails.title || '无标题片段' }}</div>\r\n        <div class=\"fragment-details-body\">\r\n          <cu-scroll>\r\n            <div class=\"fragment-content\">\r\n              {{ fragmentDetails.content }}\r\n            </div>\r\n          </cu-scroll>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </transition>\r\n\r\n\r\n</template>\r\n\r\n<script setup>\r\nimport { useStorage } from '@/hooks/web/useStorage'\r\nimport { useRoute } from 'vue-router'\r\nimport { getLibraryFileList, getParagraphList, getLibFileInfo } from '@/api/library/index'\r\nimport { reactive, ref, nextTick, computed, onMounted } from 'vue'\r\nimport { CaretDownFilled, CaretRightOutlined } from '@ant-design/icons-vue'\r\nimport CuScroll from './cu-scroll.vue';\r\n\r\nconst { getStorage, removeStorage } = useStorage('localStorage')\r\n\r\nconst emit = defineEmits(['openFile', 'openFragment'])\r\n\r\nconst props = defineProps({\r\n  show: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst route = useRoute()\r\nconst autoOpenFileId = getStorage('graph:autoOpenFileId') || null;\r\n\r\nconst library_id = computed(() => {\r\n  return route.query.id\r\n})\r\n\r\nconst fileList = reactive({\r\n  list: [],\r\n  library_id: library_id.value,\r\n  status: 2,\r\n  page: 1,\r\n  size: 20,\r\n  total: 0,\r\n  showMore: true,\r\n})\r\n\r\nconst getFileList = async () => {\r\n  try {\r\n    const res = await getLibraryFileList({\r\n      library_id: fileList.library_id,\r\n      status: fileList.status,\r\n      page: fileList.page,\r\n      size: fileList.size,\r\n    })\r\n\r\n    if (res.res != 0) {\r\n      return\r\n    }\r\n\r\n    let list = res.data.list || []\r\n\r\n    fileList.total = res.data.total\r\n\r\n    if (autoOpenFileId) {\r\n      // 过滤掉已打开的文件\r\n      list = list.filter(item => item.id != autoOpenFileId)\r\n    }\r\n\r\n    fileList.list = [...fileList.list, ...list]\r\n\r\n    if (fileList.list.length >= fileList.total) {\r\n      fileList.showMore = false\r\n    }\r\n    // 自动打开第一个文件\r\n    if (fileList.page == 1 && fileList.list.length > 0) {\r\n      openFile(fileList.list[0])\r\n    }\r\n\r\n  }catch(err){\r\n    console.log(err);\r\n    fileList.showMore = false\r\n  }\r\n  \r\n}\r\n\r\nconst onLoadFileList = () => {\r\n  if (fileList.list.length >= fileList.total) {\r\n    return\r\n  }\r\n\r\n  fileList.page++\r\n  getFileList()\r\n}\r\n\r\nconst fragmentsScrollView = ref(null)\r\nconst fragmentListRef = ref(null)\r\nconst fragmentsHeight = ref(0)\r\n\r\nconst currentOpenFile = reactive({\r\n  show: false,\r\n  file_name: '',\r\n  id: '',\r\n})\r\n\r\nconst fragmentList = reactive({\r\n  show: true,\r\n  page: 1,\r\n  size: 20,\r\n  total: 0,\r\n  list: [],\r\n  showMore: true,\r\n})\r\n\r\nconst activeFragmentId = ref(null)\r\n\r\nconst fragmentDetails = reactive({\r\n  show: false,\r\n  title: '',\r\n  content: ''\r\n})\r\n\r\nconst openFile = async (item) => {\r\n  if(item.id == currentOpenFile.id){\r\n    activeFragmentId.value = null\r\n    emit('openFile', item)\r\n\r\n    return\r\n  }\r\n  \r\n  currentOpenFile.show = true\r\n  currentOpenFile.file_name = item.file_name\r\n  currentOpenFile.id = item.id\r\n  activeFragmentId.value = null\r\n  fragmentList.page = 1\r\n  fragmentList.total = 0\r\n  fragmentList.list = []\r\n  fragmentList.show = true\r\n  fragmentList.showMore = true\r\n\r\n  await getFragments()\r\n\r\n  emit('openFile', item)\r\n}\r\n\r\nconst hideFragmentList = () => {\r\n  fragmentList.show = false\r\n}\r\n\r\nconst showFragmentList = () => {\r\n  fragmentList.show = true\r\n}\r\n\r\nconst maxHeight = ref(300)\r\n\r\nconst getFragments = async () => {\r\n  const res = await getParagraphList({\r\n    file_id: currentOpenFile.id,\r\n    page: fragmentList.page,\r\n    size: fragmentList.size,\r\n    status: -1,\r\n    graph_status: -1,\r\n    category_id: -1\r\n  })\r\n\r\n  if (res.res != 0) {\r\n    return\r\n  }\r\n\r\n  fragmentList.total = res.data.total\r\n\r\n  if (fragmentList.page == 1) {\r\n    fragmentList.list = res.data.list || []\r\n  } else {\r\n    fragmentList.list = [...fragmentList.list, ...res.data.list]\r\n  }\r\n\r\n  if (fragmentList.list.length >= fragmentList.total) {\r\n    fragmentList.showMore = false\r\n  }\r\n\r\n  nextTick(() => {\r\n    let height = fragmentListRef.value?.offsetHeight || 0\r\n    if (height > maxHeight.value) {\r\n      fragmentsHeight.value = maxHeight.value\r\n    } else {\r\n      fragmentsHeight.value = height\r\n    }\r\n\r\n    nextTick(() => {\r\n      fragmentsScrollView.value?.refresh()\r\n    })\r\n  })\r\n}\r\n\r\nconst onLoadFragmentListt = () => {\r\n  if (fragmentList.list.length >= fragmentList.total) {\r\n    return\r\n  }\r\n\r\n  fragmentList.page++\r\n  getFragments()\r\n}\r\n\r\nconst openFragment = (item) => {\r\n  activeFragmentId.value = item.id\r\n  emit('openFragment', item)\r\n}\r\n\r\nconst showFragmentDetails = (item) => {\r\n  clearTimeout(leaveTimer)\r\n  fragmentDetails.title = item.title\r\n  fragmentDetails.content = item.content\r\n  fragmentDetails.show = true\r\n}\r\n\r\nlet leaveTimer = null\r\n\r\nconst handleFragmentLeave = () => {\r\n  leaveTimer = setTimeout(() => {\r\n    fragmentDetails.show = false\r\n  }, 200)\r\n}\r\n\r\nconst handleDetailsEnter = () => {\r\n  clearTimeout(leaveTimer)\r\n}\r\n\r\nconst hideFragmentDetails = () => {\r\n  fragmentDetails.show = false\r\n}\r\n\r\nconst getFileInfo = async () => {\r\n  try {\r\n    const res = await getLibFileInfo({\r\n      id: autoOpenFileId\r\n    });\r\n\r\n    fileList.list.push(res.data)\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  if(autoOpenFileId){\r\n    await getFileInfo()\r\n    removeStorage('graph:autoOpenFileId')\r\n  }\r\n\r\n  getFileList()\r\n})\r\n\r\ndefineExpose({\r\n  openFile\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.popup-wrapper {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  width: 256px;\r\n  height: 100%;\r\n  border-radius: 6px;\r\n  background-color: #fff;\r\n\r\n  .popup-header {\r\n    display: flex;\r\n    flex-flow: row nowrap;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 16px 16px;\r\n\r\n    .popup-title {\r\n      line-height: 24px;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: #000000;\r\n    }\r\n\r\n    .close-btn {\r\n      font-size: 16px;\r\n      color: #595959;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n  .popup-body {\r\n    flex: 1;\r\n    padding-bottom: 16px;\r\n    overflow: hidden;\r\n\r\n    .popup-content {\r\n      padding: 0 16px;\r\n    }\r\n  }\r\n}\r\n\r\n.entity-details {\r\n  .to-details {\r\n    display: flex;\r\n    padding: 0 8px;\r\n    height: 24px;\r\n    line-height: 24px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    border-radius: 6px;\r\n    color: #595959;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n\r\n    &:hover {\r\n      background: #E4E6EB;\r\n    }\r\n\r\n    .right-icon {\r\n      font-size: 16px;\r\n      color: #595959;\r\n    }\r\n  }\r\n\r\n  .entity-item {\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .entity-item-header {\r\n    display: flex;\r\n    flex-flow: row nowrap;\r\n    justify-content: space-between;\r\n    margin-bottom: 4px;\r\n\r\n    .entity-item-label {\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 600;\r\n      color: #262626;\r\n    }\r\n  }\r\n\r\n  .entity-name,\r\n  .fragment-content {\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    color: #595959;\r\n  }\r\n\r\n  .doc-item {\r\n    margin-bottom: 4px;\r\n\r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n\r\n  .subgraph-item {\r\n    padding-bottom: 8px;\r\n    margin-bottom: 8px;\r\n    border-bottom: 1px solid #f0f0f0;\r\n\r\n    &:last-child {\r\n      margin-bottom: 0;\r\n      border-bottom: 0;\r\n    }\r\n  }\r\n\r\n  .file-info {\r\n    display: flex;\r\n    align-items: center;\r\n    border-radius: 6px;\r\n    color: #2475FC;\r\n    transition: all 0.2s;\r\n    cursor: pointer;\r\n\r\n    .file-icon {\r\n      font-size: 16px;\r\n    }\r\n\r\n    .file-name {\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      margin-left: 4px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"popup-wrapper entity-details-wrapper\" v-if=\"state.show\">\r\n    <div class=\"popup-header\">\r\n      <div class=\"popup-title\">实体详情</div>\r\n      <CloseOutlined class=\"close-btn\" @click=\"close\" />\r\n    </div>\r\n\r\n    <div class=\"popup-body\" v-if=\"state.node\">\r\n      <cu-scroll>\r\n        <div class=\"popup-content\">\r\n          <div class=\"entity-details\">\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">实体</div>\r\n              </div>\r\n              <div class=\"entity-name\">{{ state.node.name }}</div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\" style=\"margin-bottom: 8px;\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">归属文档</div>\r\n              </div>\r\n\r\n              <div class=\"file-info\">\r\n                <svg-icon class=\"file-icon\" name=\"doc-file\" style=\"\"></svg-icon>\r\n                <span class=\"file-name\">{{ state.node.file_name }}</span>\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">分段</div>\r\n                <span class=\"to-details\" @click=\"toDetails\">详情&nbsp;\r\n                  <RightOutlined class=\"right-icon\" />\r\n                </span>\r\n              </div>\r\n\r\n              <div>\r\n                <div class=\"doc-item\">\r\n                  <div class=\"fragment-content\">{{ state.node.content }}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">子图</div>\r\n              </div>\r\n\r\n              <div>\r\n                <div class=\"\" v-if=\"state.fromNodes.length == 0\">无</div>\r\n                <div class=\"subgraph-item\" v-for=\"item in state.fromNodes\" :key=\"item.id\">\r\n                  <div class=\"fragment-content\">{{ item.name }}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </cu-scroll>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, nextTick } from 'vue'\r\nimport { CloseOutlined, RightOutlined } from '@ant-design/icons-vue'\r\nimport CuScroll from './cu-scroll.vue';\r\n\r\nconst emit = defineEmits(['toDetails'])\r\n\r\nconst state = reactive({\r\n  show: false,\r\n  node: null,\r\n  fromNodes: []\r\n})\r\n\r\nconst close = () => {\r\n  state.show = false\r\n}\r\n\r\nconst open = (node, fromNodes) => {\r\n  state.node = node\r\n  state.fromNodes = fromNodes\r\n\r\n  if(state.show){\r\n    state.show = false\r\n    nextTick(() => {\r\n      state.show = true\r\n    })\r\n  }else{\r\n    state.show = true\r\n  }\r\n}\r\n\r\nconst toDetails = () => {\r\n  emit('toDetails', state.node)\r\n}\r\n\r\ndefineExpose({\r\n  open,\r\n  close\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.collapse-btn{\r\n  position: absolute;\r\n  display: flex;\r\n  align-items: center;\r\n  height: 30px;\r\n  padding: 0 12px;\r\n  top: 52px;\r\n  left: 16px;\r\n  padding: 4px 12px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  background-color: #fff;\r\n\r\n  .collapse-icon{\r\n    margin-right: 8px;\r\n    font-size: 16px;\r\n    color: #595959;\r\n  }\r\n\r\n  .collapse-label{\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    color: #262626;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"collapse-btn\" @click=\"toggleCollapse\">\r\n    <span class=\"collapse-icon\">\r\n      <svg-icon name=\"collapse-close\" v-if=\"value\"></svg-icon>\r\n      <svg-icon name=\"collapse-open\" v-else></svg-icon>\r\n    </span>\r\n    <span class=\"collapse-label\">{{value ? '收起' : '展开'}}</span>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\n\r\nconst emit = defineEmits(['change'])\r\n\r\nconst value = ref(true)\r\n\r\nconst toggleCollapse = () => {\r\n  value.value = !value.value\r\n\r\n  emit('change', value.value)\r\n}\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.knowledge-graph-page {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #fff;\r\n  .loading-wrapper{\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(255, 255, 255, 0.8);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 10;\r\n  }\r\n\r\n  .search-box {\r\n    position: absolute;\r\n    top: 24px;\r\n    left: 50%;\r\n    margin-left: -400px;\r\n    width: 800px;\r\n  }\r\n\r\n  .left-box {\r\n    position: absolute;\r\n    top: 98px;\r\n    left: 16px;\r\n    bottom: 24px;\r\n  }\r\n\r\n  .right-box {\r\n    position: absolute;\r\n    top: 98px;\r\n    right: 16px;\r\n    bottom: 24px;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"knowledge-graph-page\">\r\n    <div class=\"loading-wrapper\" v-if=\"loading\"> <a-spin :spinning=\"loading\" /></div>\r\n    <ChartBox ref=\"chartBoxRef\" :loading=\"loading\" @nodeClick=\"onNodeClick\" />\r\n    <CollapseBtn @change=\"toggleFileList\" />\r\n    <div class=\"search-box\">\r\n      <SearchInput v-model:value=\"keyword\" @search=\"handleSearch\" />\r\n    </div>\r\n    <div class=\"left-box\">\r\n      <FileList @openFile=\"onOpenFile\" @openFragment=\"onOpenFragment\" :show=\"fileListShow\" />\r\n    </div>\r\n    <div class=\"right-box\">\r\n      <EntityDetails ref=\"entityDetailsRef\" @toDetails=\"toDetails\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { getFileGraphInfo } from '@/api/library/index'\r\nimport { onMounted, ref, reactive } from 'vue'\r\nimport ChartBox from './components/chart-box.vue'\r\nimport SearchInput from './components/search-input.vue'\r\nimport FileList from './components/file-list.vue'\r\nimport EntityDetails from './components/entity-details.vue'\r\nimport CollapseBtn from './components/collapse-btn.vue'\r\n\r\nconst chartBoxRef = ref(null)\r\nconst entityDetailsRef = ref(null)\r\nconst loading = ref(false)\r\nconst keyword = ref('')\r\n\r\nconst fileListShow = ref(true)\r\nconst state = reactive({\r\n  file_id: '',\r\n  data_id: '',\r\n  search_term: ''\r\n})\r\n\r\nconst chartData = reactive({\r\n  edges: [],\r\n  nodes: []\r\n})\r\n\r\n// 关系映射\r\nlet edgeMap = {}\r\n\r\nconst toggleFileList = (val) => {\r\n  fileListShow.value = val\r\n}\r\n\r\nconst onOpenFile = (item) => {\r\n  state.file_id = item.id\r\n  state.data_id = ''\r\n\r\n  getGraphData()\r\n}\r\n\r\nconst onOpenFragment = (item) => {\r\n  state.data_id = item.id\r\n  getGraphData()\r\n}\r\n\r\nconst getGraphData= () => {\r\n  loading.value = true\r\n  getFileGraphInfo({\r\n    file_id: state.file_id,\r\n    data_id: state.data_id,\r\n    search_term: state.search_term\r\n  }).then(res => {\r\n    loading.value = false\r\n\r\n    let edges = res.data.edges || []\r\n    let nodes = res.data.nodes || []\r\n    // 去重逻辑（包含反向检测）\r\n    const edgeSet = new Map();\r\n    edges = edges.filter(item => {\r\n      const key = `${item.from_id}_${item.to_id}`;\r\n      const reverseKey = `${item.to_id}_${item.from_id}`;\r\n      \r\n      if(edgeSet.has(key) || edgeSet.has(reverseKey)) {\r\n        return false;\r\n      }\r\n      edgeSet.set(key, true);\r\n      return true;\r\n    });\r\n\r\n    edges.forEach(item => {\r\n      item.id = item.id.toString()\r\n      item.from = item.from_id.toString()\r\n      item.to = item.to_id.toString()\r\n      item.caption = item.label\r\n    })\r\n\r\n    const fromNodes = new Set(edges.map(e => e.from));\r\n    const toNodes = new Set(edges.map(e => e.to));\r\n\r\n    nodes.forEach(item => {\r\n      // item.caption = item.name\r\n      item.id = item.id.toString()\r\n\r\n      // 标记节点类型\r\n      item.nodeType = \r\n        fromNodes.has(item.id) && toNodes.has(item.id) ? 'both' :\r\n        fromNodes.has(item.id) ? 'from' :\r\n        toNodes.has(item.id) ? 'to' : 'normal';\r\n\r\n      // 根据类型设置样式\r\n      if(item.nodeType === 'from') {\r\n        item.size = 35;\r\n        item.color = '#FFB1B2';\r\n      } else if(item.nodeType === 'to') {\r\n        item.size = 45; \r\n        item.color = '#005AFF';\r\n      } else {\r\n        item.size = 30;\r\n        item.color = '#69E9BE';\r\n      }\r\n\r\n      item.captions = [{\r\n        value: item.name,\r\n        styles: [],\r\n      }]\r\n    });\r\n\r\n    let data = {\r\n      edges,\r\n      nodes\r\n    }\r\n    \r\n    chartData.edges = data.edges\r\n    chartData.nodes = data.nodes\r\n\r\n    setTimeout(() => {\r\n      chartBoxRef.value.render(data)\r\n    }, 0);\r\n\r\n    edgeMap = {}\r\n    // 提前生成关系映射\r\n    edges.forEach((edge) => {\r\n      if (!edgeMap[edge.to]) {\r\n        edgeMap[edge.to] = [];\r\n      }\r\n      \r\n      edgeMap[edge.to].push(edge.from);\r\n    });\r\n\r\n  }).catch(err => {\r\n    console.log(err)\r\n    loading.value = false\r\n  })\r\n}\r\n\r\nconst onNodeClick = (node) => {\r\n  let edgeIds = edgeMap[node.id] || []\r\n  let fromNodes = []\r\n  \r\n  for (let i = 0; i < chartData.nodes.length; i++) {\r\n    if(edgeIds.indexOf(chartData.nodes[i].id) > -1){\r\n     \r\n      fromNodes.push(chartData.nodes[i])\r\n    }\r\n  }\r\n  \r\n  entityDetailsRef.value.open(node, fromNodes)\r\n}\r\n\r\nconst handleSearch = (val) => {\r\n  state.search_term = val\r\n  getGraphData()\r\n}\r\n\r\nconst toDetails = (node) => {\r\n  window.open(`/#/library/preview?id=${node.file_id}`)\r\n}\r\n\r\n\r\nonMounted(() => {\r\n \r\n})\r\n</script>\r\n"],"names":["emit","__emit","chartBox","ref","nvl","state","reactive","initialZoom","init","options","container","NVL","zoomInteraction","ZoomInteraction","PanInteraction","zoomLevel","HoverInteraction","ClickInteraction","node","onZoomChange","value","add","nodes","edges","addAndUpdate","update","render","onMounted","__expose","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","ZoomToolbar","props","__props","localValue","isFocused","searchInput","onInput","clearValue","nextTick","_a","handleSearch","watch","val","_normalizeClass","$event","_unref","CloseCircleFilled","SearchOutlined","getStorage","removeStorage","useStorage","route","useRoute","autoOpenFileId","library_id","computed","fileList","getFileList","res","getLibraryFileList","list","item","openFile","err","onLoadFileList","fragmentsScrollView","fragmentListRef","fragmentsHeight","currentOpenFile","fragmentList","activeFragmentId","fragmentDetails","getFragments","hideFragmentList","showFragmentList","maxHeight","getParagraphList","height","onLoadFragmentListt","openFragment","showFragmentDetails","leaveTimer","handleFragmentLeave","handleDetailsEnter","hideFragmentDetails","getFileInfo","getLibFileInfo","_createBlock","_Transition","_hoisted_3","_hoisted_4","CaretDownFilled","CaretRightOutlined","_component_svg_icon","_cache","_toDisplayString","_normalizeStyle","CuScroll","_Fragment","_renderList","_hoisted_6","_hoisted_7","_component_a_spin","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","close","open","fromNodes","toDetails","CloseOutlined","_hoisted_5","_hoisted_11","RightOutlined","_hoisted_17","toggleCollapse","chartBoxRef","entityDetailsRef","loading","keyword","fileListShow","chartData","edgeMap","toggleFileList","onOpenFile","getGraphData","onOpenFragment","getFileGraphInfo","edgeSet","key","reverseKey","e","toNodes","data","edge","onNodeClick","edgeIds","i","ChartBox","CollapseBtn","SearchInput","FileList","EntityDetails"],"mappings":"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"}