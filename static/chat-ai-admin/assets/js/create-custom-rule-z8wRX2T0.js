import{u as X,_ as Y}from"../../index-DSFcP5NQ.js";import{c as N,ah as Z,E as O,r as w,j as ee,a as m,p as s,y as r,v as a,u as _,q as h,t as c,F as te,l as le,ag as oe,b as p,_ as u,e as se}from"./vue-chunks-BdaA73Wf.js";import{M as ne}from"./model-select-CMPvMrAQ.js";import{ay as _e,al as re,av as ae}from"./index-Cg7-0swo.js";import{_ as de}from"./emoji-mart-BBMRoEa3.js";import{I as ie,H as ce,E as pe,V as me,r as ue,B as ye,M as ve,N as he,an as fe,s as ge,x as ke,b as y}from"./ui-antd-Dl1wwwCD.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./index-MT9fcN3v.js";const we={class:"default-rule-page"},be={class:"form-row"},Ce={class:"form-label"},Se={class:"form-row"},xe={class:"form-label"},Re={class:"module-card"},ze={class:"module-card-header"},Ue={class:"module-card-title"},Ne={key:0,class:"module-card-body"},Ae={class:"field"},Ie={class:"field-label"},Ve={key:0,class:"field"},Me={class:"field-label"},Oe={class:"tag-list"},Be={key:1,class:"field"},Le={class:"field-label"},Te={key:2,class:"field"},Je={class:"field-label"},Ke={key:3,class:"field"},qe={class:"field-label"},De={class:"module-card"},Ee={class:"module-card-header"},$e={class:"module-card-title"},Fe={key:0,class:"module-card-body"},je={class:"field"},He={class:"field-label"},Pe={class:"field"},Ge={class:"field-label"},Qe={class:"field"},We={class:"field-label"},Xe={class:"module-card"},Ye={class:"module-card-header"},Ze={class:"module-card-title"},et={key:0,class:"module-card-body"},tt={class:"field"},lt={class:"field-label"},ot={class:"page-right-footer"},st={class:"task-modal"},nt={key:0},_t={__name:"create-custom-rule",setup(rt){const f=Z(),B=oe(),{t:l}=X("views.explore.ai-comment-management.create-custom-rule"),C=N(()=>f.name==="exploreAiCommentManagementCreateCustomRule"&&f.query.copy==="1"),S=N(()=>f.name==="exploreAiCommentManagementCreateCustomRule"&&f.query.id),e=O({rule_name:"",use_model:"",model_config_id:"",delete_comment_switch:1,delete_type:[1,2],delete_keywords:[],delete_condition:2,delete_priority:1,delete_prompt:"",reply_comment_switch:1,reply_check_prompt:"",reply_type:1,reply_prompt:"",elect_comment_switch:1,elect_prompt:""}),A=N(()=>e.reply_type===1?l("reply_content_label"):l("reply_content_rule_label")),b=w(""),L=(d,t)=>{e.use_model=t.modelName,e.model_config_id=t.modelId},T=d=>{e.delete_keywords.splice(d,1)},J=()=>{const d=(b.value||"").trim();d&&(e.delete_keywords.includes(d)||e.delete_keywords.push(d),b.value="")},x=w(!1),I=w([]),R=w(!1),v=O({page:1,size:10,total:0}),V=w([]),K=[{title:l("task_column_task_name"),dataIndex:"task_name",key:"task_name"}],q=d=>{V.value=d.map(t=>String(t))},D=()=>{R.value=!0,re({page:v.page,size:v.size}).then(d=>{const t=(d==null?void 0:d.data)||{list:[],total:0};I.value=t.list||[],v.total=+t.total||0}).finally(()=>{R.value=!1})},E=d=>{v.page=d.current,v.size=d.pageSize,D()},$=()=>{const d={};(C.value||S.value)&&(d.id=f.query.id),_e(d).then(t=>{const i=(t==null?void 0:t.data)||null;if(i){if(e.rule_name=i.rule_name||l("rule_name_default"),e.use_model=i.use_model||e.use_model,e.model_config_id=i.model_config_id||e.model_config_id,e.delete_comment_switch=+i.delete_comment_switch||0,e.reply_comment_switch=+i.reply_comment_switch||0,e.elect_comment_switch=+i.elect_comment_switch||0,i.delete_comment_rule){let n=i.delete_comment_rule;if(typeof n=="string")try{n=JSON.parse(n)}catch{}e.delete_type=Array.isArray(n.type)?n.type:[],e.delete_keywords=Array.isArray(n.keywords)?n.keywords:[],e.delete_condition=+n.condition||e.delete_condition,e.delete_priority=+n.priority||e.delete_priority,e.delete_prompt=n.prompt||""}if(i.reply_comment_rule){let n=i.reply_comment_rule;if(typeof n=="string")try{n=JSON.parse(n)}catch{}e.reply_check_prompt=n.check_reply_prompt||"",e.reply_type=+n.reply_type||e.reply_type,e.reply_prompt=n.reply_prompt||""}if(i.elect_comment_rule){let n=i.elect_comment_rule;if(typeof n=="string")try{n=JSON.parse(n)}catch{}e.elect_prompt=n.prompt||""}}})},F=()=>{if(!String(e.rule_name||"").trim())return y.error(l("error_enter_rule_name"));if(!e.use_model)return y.error(l("error_select_model"));if(e.delete_comment_switch==1){const t=Array.isArray(e.delete_type)?e.delete_type:[],i=t.includes(1),n=t.includes(2);if(t.length===0)return y.error(l("error_delete_at_least_one_option"));if(i&&(!e.delete_keywords||e.delete_keywords.length===0))return y.error(l("error_enter_sensitive_words"));if(n&&!String(e.delete_prompt||"").trim())return y.error(l("error_enter_ai_detect_rule"))}if(e.reply_comment_switch==1){if(!String(e.reply_check_prompt||"").trim())return y.error(l("error_enter_auto_reply_rule"));if(!String(e.reply_prompt||"").trim())return y.error(l("error_enter_reply_content",{label:A.value}))}if(e.elect_comment_switch==1&&!String(e.elect_prompt||"").trim())return y.error(l("error_enter_auto_elect_rule"));const d={rule_name:e.rule_name,use_model:e.use_model,model_config_id:e.model_config_id,delete_comment_switch:e.delete_comment_switch,delete_comment_rule:JSON.stringify((()=>{const t=Array.isArray(e.delete_type)?e.delete_type:[],i=t.includes(2),n={type:t,keywords:e.delete_keywords,prompt:e.delete_prompt};return i&&(n.condition=e.delete_condition,n.priority=e.delete_priority),n})()),reply_comment_switch:e.reply_comment_switch,reply_comment_rule:JSON.stringify({check_reply_prompt:e.reply_check_prompt,reply_type:e.reply_type,reply_prompt:e.reply_prompt}),elect_comment_switch:e.elect_comment_switch,elect_comment_rule:JSON.stringify({prompt:e.elect_prompt})};S.value&&!C.value&&(d.id=f.query.id),ae(d).then(()=>{y.success(l("save_success"))}),B.back()};return ee(()=>{(S.value||C.value)&&$()}),(d,t)=>{const i=ie,n=Y,z=ce,M=he,j=pe,H=fe,k=me,g=ge,U=ue,P=ye,G=ke,Q=ve;return p(),m("div",we,[s("div",be,[s("div",Ce,a(_(l)("rule_name_label")),1),r(i,{value:e.rule_name,"onUpdate:value":t[0]||(t[0]=o=>e.rule_name=o),placeholder:_(l)("rule_name_placeholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),s("div",Se,[s("div",xe,a(_(l)("model_label")),1),r(ne,{modelType:"LLM",modeName:e.use_model,"onUpdate:modeName":t[1]||(t[1]=o=>e.use_model=o),modeId:e.model_config_id,"onUpdate:modeId":t[2]||(t[2]=o=>e.model_config_id=o),style:{width:"300px"},placeholder:_(l)("select_model_placeholder"),onChange:L},null,8,["modeName","modeId","placeholder"])]),s("div",Re,[s("div",ze,[s("div",Ue,[r(n,{name:"comment-delete",style:{"font-size":"16px","margin-right":"8px"}}),s("span",null,a(_(l)("module_delete_title")),1)]),r(z,{checked:e.delete_comment_switch,"onUpdate:checked":t[3]||(t[3]=o=>e.delete_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.delete_comment_switch==1?(p(),m("div",Ne,[s("div",Ae,[s("div",Ie,a(_(l)("delete_rule_label")),1),r(j,{value:e.delete_type,"onUpdate:value":t[4]||(t[4]=o=>e.delete_type=o)},{default:c(()=>[r(M,{value:1},{default:c(()=>[u(a(_(l)("delete_rule_sensitive_word")),1)]),_:1}),r(M,{value:2},{default:c(()=>[u(a(_(l)("delete_rule_ai_detection")),1)]),_:1})]),_:1},8,["value"])]),(e.delete_type||[]).includes(1)?(p(),m("div",Ve,[s("div",Me,a(_(l)("delete_sensitive_word_label")),1),s("div",Oe,[(p(!0),m(te,null,le(e.delete_keywords,(o,W)=>(p(),se(H,{key:o,closable:"",onClose:at=>T(W)},{default:c(()=>[u(a(o),1)]),_:2},1032,["onClose"]))),128))]),r(k,{value:b.value,"onUpdate:value":t[5]||(t[5]=o=>b.value=o),placeholder:_(l)("common_input_placeholder"),onBlur:J,"auto-size":{minRows:2}},null,8,["value","placeholder"])])):h("",!0),(e.delete_type||[]).includes(2)?(p(),m("div",Be,[s("div",Le,a(_(l)("delete_ai_rule_label")),1),r(k,{value:e.delete_prompt,"onUpdate:value":t[6]||(t[6]=o=>e.delete_prompt=o),placeholder:_(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])):h("",!0),(e.delete_type||[]).includes(2)?(p(),m("div",Te,[s("div",Je,a(_(l)("condition_label")),1),r(U,{value:e.delete_condition,"onUpdate:value":t[7]||(t[7]=o=>e.delete_condition=o)},{default:c(()=>[r(g,{value:1},{default:c(()=>[u(a(_(l)("condition_all")),1)]),_:1}),r(g,{value:2},{default:c(()=>[u(a(_(l)("condition_any")),1)]),_:1})]),_:1},8,["value"])])):h("",!0),(e.delete_type||[]).includes(2)?(p(),m("div",Ke,[s("div",qe,a(_(l)("priority_label")),1),r(U,{value:e.delete_priority,"onUpdate:value":t[8]||(t[8]=o=>e.delete_priority=o)},{default:c(()=>[r(g,{value:1},{default:c(()=>[u(a(_(l)("priority_sensitive_first")),1)]),_:1}),r(g,{value:2},{default:c(()=>[u(a(_(l)("priority_ai_first")),1)]),_:1})]),_:1},8,["value"])])):h("",!0)])):h("",!0)]),s("div",De,[s("div",Ee,[s("div",$e,[r(n,{name:"comment-reply",style:{"font-size":"16px","margin-right":"8px"}}),s("span",null,a(_(l)("module_reply_title")),1)]),r(z,{checked:e.reply_comment_switch,"onUpdate:checked":t[9]||(t[9]=o=>e.reply_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.reply_comment_switch==1?(p(),m("div",Fe,[s("div",je,[s("div",He,a(_(l)("auto_reply_rule_label")),1),r(k,{value:e.reply_check_prompt,"onUpdate:value":t[10]||(t[10]=o=>e.reply_check_prompt=o),placeholder:_(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])]),s("div",Pe,[s("div",Ge,a(_(l)("reply_content_label")),1),r(U,{value:e.reply_type,"onUpdate:value":t[11]||(t[11]=o=>e.reply_type=o)},{default:c(()=>[r(g,{value:1},{default:c(()=>[u(a(_(l)("reply_type_fixed")),1)]),_:1}),r(g,{value:2},{default:c(()=>[u(a(_(l)("reply_type_ai")),1)]),_:1})]),_:1},8,["value"])]),s("div",Qe,[s("div",We,a(A.value),1),r(k,{value:e.reply_prompt,"onUpdate:value":t[12]||(t[12]=o=>e.reply_prompt=o),placeholder:_(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])])):h("",!0)]),s("div",Xe,[s("div",Ye,[s("div",Ze,[r(n,{name:"comment-selected",style:{"font-size":"16px","margin-right":"8px"}}),s("span",null,a(_(l)("module_elect_title")),1)]),r(z,{checked:e.elect_comment_switch,"onUpdate:checked":t[13]||(t[13]=o=>e.elect_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.elect_comment_switch==1?(p(),m("div",et,[s("div",tt,[s("div",lt,a(_(l)("auto_elect_rule_label")),1),r(k,{value:e.elect_prompt,"onUpdate:value":t[14]||(t[14]=o=>e.elect_prompt=o),placeholder:_(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])])):h("",!0)]),s("div",ot,[r(P,{type:"primary",onClick:F},{default:c(()=>[u(a(_(l)("btn_save_and_apply")),1)]),_:1})]),r(Q,{open:x.value,"onUpdate:open":t[15]||(t[15]=o=>x.value=o),title:_(l)("task_modal_title"),width:720,onOk:d.confirmSelectTasks,onCancel:t[16]||(t[16]=o=>x.value=!1)},{default:c(()=>[s("div",st,[r(G,{columns:K,"data-source":I.value,"row-key":o=>String(o.id),loading:R.value,pagination:{current:v.page,pageSize:v.size,total:v.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:E,"row-selection":{selectedRowKeys:V.value,onChange:q,preserveSelectedRowKeys:!0}},{headerCell:c(({column:o})=>[typeof o.title=="string"?(p(),m("span",nt,a(o.title),1)):h("",!0)]),_:1},8,["data-source","row-key","loading","pagination","row-selection"])])]),_:1},8,["open","title","onOk"])])}}},bt=de(_t,[["__scopeId","data-v-6f724f3d"]]);export{bt as default};
//# sourceMappingURL=create-custom-rule-z8wRX2T0.js.map
