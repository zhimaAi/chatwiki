import{_ as mo}from"./cu-scroll-ufyFyI_5.js";import{t as _e,S as jo,V as Fe,F as Vo,q as Me,y as oo,I as Wo,b as ke,$ as Ao,d0 as Ko,k as N,M as ae,d1 as vo,E as He,d2 as fo,d3 as Qo,d4 as dt,d5 as Yo,d as Rt,B as It,d6 as Xo,bH as Ut,d7 as go,d8 as Jo,d9 as Zo,da as en,db as tn,h as yo,dc as rt,dd as on,bQ as nn,e as sn,W as ln,a2 as wt,bs as st,de as an,bw as un,n as no,bR as dn,c_ as rn,df as _n,dg as cn,dh as pn,di as mn,dj as vn}from"../../index-CzPebXix.js";import{e as so,d as _,j as t,z as le,ag as ho,N as a,O as s,U as n,X as e,H as ut,S as B,a6 as m,u as R,_ as b,F as W,a1 as ue,Z as g,a0 as se,a2 as Dt,a3 as je,b as ve,q as Lt,Y as ko,a5 as re,W as fn,G as Ot,D as gn,I as lo}from"./vue-chunks-BRsu9_To.js";import{S as yn,a as hn,E as kn}from"./edit-subsection-D5oXZYZw.js";import{E as bn}from"./EditOutlined-D08WQbiX.js";import{D as wn}from"./index-7Ecr060x.js";import{_ as xn,a as bo,b as Cn}from"./index-Bh3NMpRp.js";import{_ as Ft}from"./index-BwqnaIPU.js";import{_ as Mt}from"./index-Dhmpqx9n.js";import{P as Te}from"./PlusOutlined-BlmIiILr.js";import{S as _t}from"./SearchOutlined-a_gTycfl.js";import"./index-BFhVTGQQ.js";import{I as Pe}from"./Input-DFtZp9vk.js";import"./index-BSz5XTfh.js";import{D as wo}from"./dropdown-DTOAy9tU.js";import{E as ct,M as xo,_ as Co}from"./index-DlQVT6K6.js";import{S as Ve,a as We}from"./index-6HDf6TPN.js";import{R as $n}from"./index-xXMO8r4G.js";import{_ as Tt}from"./index-BhUXTHsq.js";import{U as $o}from"./upload-input-BmT6L6Xv.js";import{t as ao}from"./validate-8MtiUsxW.js";import{F as pt,_ as Pt}from"./index-BgVvqN-n.js";import"./index-Di5l0R3t.js";import{_ as Sn,R as qn}from"./RadioButton-h1wW1k6O.js";import{M as io}from"./model-select-BRz1sNBY.js";import{O as Ln}from"./open-grapg-modal-BqYwUJsb.js";import{D as On}from"./DownOutlined-DXKkgIsm.js";import{U as Rn}from"./UpOutlined-B_3G2J2r.js";import{_ as In}from"./index-CBmR-lHY.js";import{R as Un}from"./rename-modal-9bdafyUq.js";import{_ as Dn}from"./page-alert-hUfedjgw.js";import{C as Fn}from"./index-DLRiQ5Ho.js";import{g as Mn,c as uo,d as Tn,r as Pn,a as Gn}from"./index-D17QejXF.js";import{u as ro}from"./FormItemContext-B2RmG14m.js";import{d as En}from"./vuedraggable.umd-CIIT_a56.js";import{C as zn}from"./CopyOutlined-Bzd2h6dn.js";import{_ as Nn}from"./index-hvcgcTJ4.js";import{S as Bn}from"./index-0UwCX3b0.js";import{C as xt}from"./ClockCircleFilled-fXuerISb.js";import{_ as Hn}from"./index-DJdJAZVd.js";import{S as jn}from"./SyncOutlined-BnnoShgX.js";import{M as Vn}from"./MoreOutlined-DHg0Dtfc.js";import{_ as Wn}from"./index-Bpi-EtQQ.js";import{_ as An}from"./TextArea-DrgXbuSS.js";const Ct=()=>({format:String,showNow:Fe(),showHour:Fe(),showMinute:Fe(),showSecond:Fe(),use12Hours:Fe(),hourStep:Number,minuteStep:Number,secondStep:Number,hideDisabledOptions:Fe(),popupClassName:String,status:jo()});function Kn(G){const I=Mn(G,_e(_e({},Ct()),{order:{type:Boolean,default:!0}})),{TimePicker:H,RangePicker:U}=I,h=so({name:"ATimePicker",inheritAttrs:!1,props:_e(_e(_e(_e({},uo()),Tn()),Ct()),{addon:{type:Function}}),slots:Object,setup($,E){let{slots:k,expose:w,emit:y,attrs:S}=E;const u=$,O=ro();Vo(!(k.addon||u.addon),"TimePicker","`addon` is deprecated. Please use `v-slot:renderExtraFooter` instead.");const d=_();w({focus:()=>{var f;(f=d.value)===null||f===void 0||f.focus()},blur:()=>{var f;(f=d.value)===null||f===void 0||f.blur()}});const M=(f,Y)=>{y("update:value",f),y("change",f,Y),O.onFieldChange()},A=f=>{y("update:open",f),y("openChange",f)},T=f=>{y("focus",f)},Q=f=>{y("blur",f),O.onFieldBlur()},F=f=>{y("ok",f)};return()=>{const{id:f=O.id.value}=u;return t(H,Me(Me(Me({},S),oo(u,["onUpdate:value","onUpdate:open"])),{},{id:f,dropdownClassName:u.popupClassName,mode:void 0,ref:d,renderExtraFooter:u.addon||k.addon||u.renderExtraFooter||k.renderExtraFooter,onChange:M,onOpenChange:A,onFocus:T,onBlur:Q,onOk:F}),k)}}}),V=so({name:"ATimeRangePicker",inheritAttrs:!1,props:_e(_e(_e(_e({},uo()),Pn()),Ct()),{order:{type:Boolean,default:!0}}),slots:Object,setup($,E){let{slots:k,expose:w,emit:y,attrs:S}=E;const u=$,O=_(),d=ro();w({focus:()=>{var v;(v=O.value)===null||v===void 0||v.focus()},blur:()=>{var v;(v=O.value)===null||v===void 0||v.blur()}});const M=(v,p)=>{y("update:value",v),y("change",v,p),d.onFieldChange()},A=v=>{y("update:open",v),y("openChange",v)},T=v=>{y("focus",v)},Q=v=>{y("blur",v),d.onFieldBlur()},F=(v,p)=>{y("panelChange",v,p)},f=v=>{y("ok",v)},Y=(v,p,D)=>{y("calendarChange",v,p,D)};return()=>{const{id:v=d.id.value}=u;return t(U,Me(Me(Me({},S),oo(u,["onUpdate:open","onUpdate:value"])),{},{id:v,dropdownClassName:u.popupClassName,picker:"time",mode:void 0,ref:O,onChange:M,onOpenChange:A,onFocus:T,onBlur:Q,onPanelChange:F,onOk:f,onCalendarChange:Y}),k)}}});return{TimePicker:h,TimeRangePicker:V}}const{TimePicker:lt,TimeRangePicker:$t}=Kn(Gn),So=_e(lt,{TimePicker:lt,TimeRangePicker:$t,install:G=>(G.component(lt.name,lt),G.component($t.name,$t),G)});var Qn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M742 318V184h86c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h86v134c0 81.5 42.4 153.2 106.4 194-64 40.8-106.4 112.5-106.4 194v134h-86c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h632c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-86V706c0-81.5-42.4-153.2-106.4-194 64-40.8 106.4-112.5 106.4-194z"}}]},name:"hourglass",theme:"filled"};function _o(G){for(var I=1;I<arguments.length;I++){var H=arguments[I]!=null?Object(arguments[I]):{},U=Object.keys(H);typeof Object.getOwnPropertySymbols=="function"&&(U=U.concat(Object.getOwnPropertySymbols(H).filter(function(h){return Object.getOwnPropertyDescriptor(H,h).enumerable}))),U.forEach(function(h){Yn(G,h,H[h])})}return G}function Yn(G,I,H){return I in G?Object.defineProperty(G,I,{value:H,enumerable:!0,configurable:!0,writable:!0}):G[I]=H,G}var Gt=function(I,H){var U=_o({},I,H.attrs);return t(Wo,_o({},U,{icon:Qn}),null)};Gt.displayName="HourglassFilled";Gt.inheritAttrs=!1;const Xn={class:"subsection-box"},Jn=["onDblclick"],Zn={class:"list-item"},es={class:"list-content"},ts={class:"status-error"},os=["onClick"],ns={class:"similar-question-list"},ss={class:"list-item list-item-answer"},ls={class:"list-content"},as={class:"fragment-img"},is=["src"],us={class:"right-opration"},ds=["onClick"],rs=["onClick"],_s=["onClick"],cs=["onClick"],ps={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(G,{expose:I,emit:H}){const U=H,h=G,V=le({selectedRowKeys:[]}),$=u=>{V.selectedRowKeys=u},E=()=>{V.selectedRowKeys=[]},k=u=>{U("openEditSubscription",u)},w=u=>{ae.confirm({title:"提示",icon:t(He),content:"确认是否删除该问答?",onOk(){return new Promise((O,d)=>{vo({id:u}).then(M=>{N.success("删除成功"),U("handleDelParagraph",u),O()}).catch(()=>{O()})})},onCancel(){}})},y=(u,O)=>{Ko({id:u.id,category_id:O}).then(d=>{N.success("设置成功"),U("getList")})},S=(u,O,d)=>{let M=d.field,A=d.order;A?A=A==="ascend"?"asc":"desc":M="",U("handleSort",{sort_field:M,sort_type:A})};return I({handleOpenEditModal:k,state:V,resetSelect:E}),(u,O)=>{const d=Ft,M=Mt,A=xn,T=bo,Q=ho("viewer");return s(),a("div",Xn,[t(T,{"data-source":G.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:V.selectedRowKeys,onChange:$},pagination:!1,loading:h.isLoading,onChange:S},{default:n(()=>[t(A,{key:"id","data-index":"id",width:1148},{title:n(()=>[g("问答（共"+b(h.total)+"个）",1)]),default:n(({record:F})=>[e("div",{class:"qa-list-box",onDblclick:f=>k(F)},[e("div",Zn,[O[0]||(O[0]=e("div",{class:"list-label"},"问题",-1)),e("div",es,[F.status==2?(s(),B(d,{key:0,placement:"top"},{title:n(()=>[e("span",null,b(F.errmsg),1)]),default:n(()=>[e("span",null,[e("span",ts,[t(R(Ao))])])]),_:2},1024)):m("",!0),e("span",{onClick:f=>k(F),class:"question-text"},b(F.question),9,os),F.similar_questions&&F.similar_questions.length?(s(),B(M,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:n(()=>[e("div",ns,[(s(!0),a(W,null,ue(F.similar_questions,(f,Y)=>(s(),a("div",{class:"similar-question-list-item",key:Y},b(f),1))),128))])]),title:n(()=>[e("span",null,"共 "+b(F.similar_questions.length)+" 个相似问法",1)]),default:n(()=>[e("a",null,"（"+b(F.similar_questions.length)+"）",1)]),_:2},1024)):m("",!0)])]),e("div",ss,[O[1]||(O[1]=e("div",{class:"list-label"},"答案",-1)),e("div",ls,b(F.answer),1)]),ut((s(),a("div",as,[(s(!0),a(W,null,ue(F.images,(f,Y)=>(s(),a("img",{key:Y,src:f,alt:""},null,8,is))),128))])),[[Q]])],40,Jn)]),_:1}),t(A,{title:"合计",key:"total_hits","data-index":"total_hits",width:108,sorter:!0}),t(A,{title:"昨日",key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0}),t(A,{title:"今日",key:"today_hits","data-index":"today_hits",width:108,sorter:!0}),t(A,{title:"操作",key:"action","data-index":"action",width:120},{default:n(({record:F,index:f})=>[e("div",us,[F.category_id>0?(s(),a("div",{key:0,class:"hover-btn-box",onClick:Y=>y(F,0)},[t(R(yn),{style:{color:"#F59A23"}})],8,ds)):(s(),a("div",{key:1,class:"hover-btn-box",onClick:Y=>y(F,4)},[t(R(hn))],8,rs)),e("div",{class:"hover-btn-box",onClick:se(Y=>k(F),["stop"])},[t(R(bn))],8,_s),e("div",{class:"hover-btn-box",onClick:se(Y=>w(F.id),["stop"])},[t(R(wn))],8,cs)])]),_:1})]),_:1},8,["data-source","row-selection","loading"])])}}},ms=ke(ps,[["__scopeId","data-v-a84b54e8"]]),vs={class:"alert-box"},fs={class:"upload-file-box"},gs={key:0,class:"hight-set"},ys={key:0,class:"set-box"},hs={class:"form-item"},ks={class:"form-item-body"},bs={class:"form-item"},ws={class:"form-item-body"},xs={class:"form-item"},Cs={class:"form-item-body"},$s={key:1,class:"set-box"},Ss={class:"form-item"},qs={class:"form-item-body"},Ls={class:"form-item"},Os={class:"form-item-body"},Rs={class:"form-item"},Is={class:"form-item-body"},Us={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(G,{expose:I,emit:H}){const U=fo(),{qa_index_type:h}=U;Dt();const $=je().query,E=_(!1),k=_(!1),w=_([]),y=H,S=_([]),u=G,O=ve(()=>u.library_id||$.id),d=le({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"问题：",answer_lable:"答案：",similar_label:"相似问法：",group_id:void 0}),M=_(!0),A=v=>{d.group_id=void 0,v>=0&&(d.group_id=v),E.value=!0},T=()=>{let v=new FormData;w.value.forEach(p=>{v.append("library_files",p)}),Qo(v).then(p=>{let D=[];for(let z in p.data)D.push({lable:p.data[z],value:z});S.value=D})},Q=()=>{if(w.value.length==0){N.error("请选择文件");return}k.value=!0;let v=new FormData;v.append("library_id",O.value);let p=!1;if(w.value.forEach(D=>{(D.name.includes(".xlsx")||D.name.includes(".csv"))&&(p=!0),v.append("library_files",D)}),p){if(!d.question_column)return k.value=!1,N.error("请选择问题所在列");if(!d.answer_column)return k.value=!1,N.error("请选择答案所在列");v.append("question_column",d.question_column),v.append("answer_column",d.answer_column),d.similar_column&&v.append("similar_column",d.similar_column)}else v.append("question_lable",d.question_lable),v.append("answer_lable",d.answer_lable),v.append("similar_label",d.similar_label);v.append("group_id",d.group_id>=0?d.group_id:0),v.append("is_qa_doc",1),v.append("qa_index_type",h),dt(v).then(D=>{y("ok"),E.value=!1,w.value=[],k.value=!1}).catch(()=>{k.value=!1})},F=()=>{w.value=[]},f=_(1),Y=v=>{d.question_column=void 0,d.answer_column=void 0,d.similar_column=void 0,d.question_lable="问题：",d.answer_lable="答案：",d.similar_label="相似问法：",w.value=v,v&&v.length>0&&(v[0].type.includes(".document")?f.value=2:(f.value=1,T()))};return I({show:A}),(v,p)=>{const D=In,z=We,de=Ve,Z=Tt,K=Pe,be=ae;return s(),a("div",null,[t(be,{width:680,open:E.value,"onUpdate:open":p[9]||(p[9]=x=>E.value=x),"confirm-loading":k.value,maskClosable:!1,title:"上传文档",onOk:Q,onCancel:F},{default:n(()=>[e("div",vs,[t(D,{"show-icon":""},{message:n(()=>p[10]||(p[10]=[e("div",null,[g(" 通过word或者Excel形式导入问答，建议您参考"),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},"word导入模板"),g("  "),e("a",{href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},"Excel导入模板"),g("创建导入文档 ")],-1),e("div",null,"如果您不是使用导入模板创建的文档，可以点击高级设置指定提取规则",-1),e("div",null,"知识库已有相同的问题时，会覆盖原有问答",-1)])),_:1})]),t(Z,{align:"center",style:{margin:"16px 0"}},{default:n(()=>[p[11]||(p[11]=e("div",null,"所属分组：",-1)),t(de,{value:d.group_id,"onUpdate:value":p[0]||(p[0]=x=>d.group_id=x),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),a(W,null,ue(u.groupLists.filter(x=>x.id>=0),x=>(s(),B(z,{value:x.id},{default:n(()=>[g(b(x.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[11]}),e("div",fs,[t($o,{type:2,value:w.value,"onUpdate:value":p[1]||(p[1]=x=>w.value=x),onChange:Y},null,8,["value"])]),w.value.length>0?(s(),a("div",gs,[e("a",{onClick:p[2]||(p[2]=x=>M.value=!M.value)},[p[12]||(p[12]=g("高级设置： ")),M.value?(s(),B(R(Rn),{key:1})):(s(),B(R(On),{key:0}))]),M.value?(s(),a(W,{key:0},[f.value==1?(s(),a("div",ys,[e("div",hs,[p[13]||(p[13]=e("div",{class:"form-item-label required"},"问题所在列：",-1)),e("div",ks,[t(de,{value:d.question_column,"onUpdate:value":p[3]||(p[3]=x=>d.question_column=x),placeholder:"请选择列名",style:{width:"100%"}},{default:n(()=>[(s(!0),a(W,null,ue(S.value,x=>(s(),B(z,{value:x.value,key:x.value},{default:n(()=>[g(b(x.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",bs,[p[14]||(p[14]=e("div",{class:"form-item-label"},"相似问法所在列：",-1)),e("div",ws,[t(de,{value:d.similar_column,"onUpdate:value":p[4]||(p[4]=x=>d.similar_column=x),placeholder:"请选择相似问题所在列",style:{width:"100%"}},{default:n(()=>[(s(!0),a(W,null,ue(S.value,x=>(s(),B(z,{value:x.value,key:x.value},{default:n(()=>[g(b(x.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",xs,[p[15]||(p[15]=e("div",{class:"form-item-label required"},"答案所在列：",-1)),e("div",Cs,[t(de,{value:d.answer_column,"onUpdate:value":p[5]||(p[5]=x=>d.answer_column=x),placeholder:"请选择答案所在列",style:{width:"100%"}},{default:n(()=>[(s(!0),a(W,null,ue(S.value,x=>(s(),B(z,{value:x.value,key:x.value},{default:n(()=>[g(b(x.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])):m("",!0),f.value==2?(s(),a("div",$s,[e("div",Ss,[p[16]||(p[16]=e("div",{class:"form-item-label"},"问题开始标识符：",-1)),e("div",qs,[t(K,{placeholder:"请输入标识符",value:d.question_lable,"onUpdate:value":p[6]||(p[6]=x=>d.question_lable=x)},null,8,["value"])])]),e("div",Ls,[p[17]||(p[17]=e("div",{class:"form-item-label"},"相似问法开始标识符：",-1)),e("div",Os,[t(K,{placeholder:"请输入标识符",value:d.similar_label,"onUpdate:value":p[7]||(p[7]=x=>d.similar_label=x)},null,8,["value"])])]),e("div",Rs,[p[18]||(p[18]=e("div",{class:"form-item-label"},"答案开始标识符：",-1)),e("div",Is,[t(K,{placeholder:"请输入标识符",value:d.answer_lable,"onUpdate:value":p[8]||(p[8]=x=>d.answer_lable=x)},null,8,["value"])])])])):m("",!0)],64)):m("",!0)])):m("",!0)]),_:1},8,["open","confirm-loading"])])}}},qo=ke(Us,[["__scopeId","data-v-074eedbe"]]),Ds={class:"form-item"},Fs={class:"form-content"},Ms={__name:"add-group",props:{group_type:{type:String,default:0}},emits:["ok"],setup(G,{expose:I,emit:H}){const U=je().query,h=_(!1),V=H,$=_("新建分组"),E=G,k=le({group_name:"",id:"",library_id:U.id}),w=S=>{k.group_name=S.group_name||"",k.id=S.id||"",$.value=S.id?"编辑分组":"新建分组",k.library_id=S.library_id,h.value=!0},y=()=>{if(!k.group_name)return N.error("请输入分组名称");Yo({...k,group_type:E.group_type}).then(S=>{N.success(`${$.value}成功`),h.value=!1,V("ok")})};return I({show:w}),(S,u)=>{const O=Pe,d=ae;return s(),a("div",null,[t(d,{open:h.value,"onUpdate:open":u[1]||(u[1]=M=>h.value=M),title:$.value,onOk:y},{default:n(()=>[e("div",Ds,[u[2]||(u[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",Fs,[t(O,{maxLength:15,value:k.group_name,"onUpdate:value":u[0]||(u[0]=M=>k.group_name=M),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Lo=ke(Ms,[["__scopeId","data-v-e111b906"]]),Ts={class:"qa-list-wrapper"},Ps={class:"group-head-box"},Gs={class:"head-title"},Es={class:"flex-between-box"},zs={class:"search-box"},Ns={class:"classify-box"},Bs=["onClick"],Hs={class:"classify-title"},js={class:"right-content"},Vs={key:0,class:"btn-box"},Ws={class:"hover-btn-wrap"},As=["onClick"],Ks=["onClick"],Qs={class:"main-content-box"},Ys={class:"head-content"},Xs={class:"title"},Js={class:"pover-group-content-box"},Zs={class:"group-head-box"},el={class:"head-title"},tl={class:"flex-between-box"},ol={class:"search-box"},nl={class:"classify-box classify-scroll-box"},sl=["onClick"],ll={class:"classify-title"},al={class:"right-content"},il={key:0,class:"btn-box"},ul={class:"hover-btn-wrap"},dl=["onClick"],rl=["onClick"],_l={class:"btn-right-box"},cl={class:"des-content-block"},pl={key:0,class:"alert-icon-box"},ml={class:"content-block"},vl={class:"pagination-box"},co="qa_document_group_box_width",at=180,St=256,fl={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(G){const I=_(null),U=je().query,h=_(""),V=_([]),$=_(-1),E=ve(()=>V.value.find(L=>L.id==$.value)||{}),k=ve(()=>V.value.filter(L=>L.group_name.includes(h.value))),w=G,y=ve(()=>w.library_id||U.id),S=_([]),u=_(localStorage.getItem("qa_document_group_hide_key")==1),O=_(0),d=_(0),M={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},A=_({is_qa_doc:"1",library_id:y.value}),T=_({page:1,size:100}),Q=le({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:y.value}),F=L=>{Q.sort_field=L.sort_field,Q.sort_type=L.sort_type,f()},f=()=>{T.value.page=1,Z()},Y=(L,c)=>{T.value.page=L,T.value.size=c,Z()},v=()=>{u.value=!u.value,localStorage.setItem("qa_document_group_hide_key",u.value?1:2)},p=()=>{Zo({id:y.value}).then(()=>{N.success("操作完成"),Z()})},D=_(null),z=L=>{L.group_id||$.value>=0&&(L.group_id=$.value),D.value.showModal(JSON.parse(JSON.stringify(L)))},de=_(!1),Z=()=>{de.value=!0,Xo({...T.value,...Q,group_id:$.value}).then(L=>{de.value=!1;let c=L.data,pe=c.list||[];pe.forEach(P=>{P.status_text=M[P.status],P.similar_questions&&(P.similar_questions=JSON.parse(P.similar_questions))}),S.value=pe,O.value=c.total,d.value=c.exception_total,I.value&&I.value.resetSelect()})};Z();const K=()=>{Ut({library_id:y.value}).then(L=>{let pe=(L.data||[]).reduce((P,$e)=>P+ +$e.total,0);V.value=[{group_name:"全部分组",id:-1,total:pe},...L.data]})};K();const be=_(null),x=L=>{be.value.show({...L,library_id:y.value})},we=()=>{K(),Z()},Ge=L=>{$.value=L.id,f()},xe=L=>{ae.confirm({title:`确认删除分组${L.group_name}`,icon:t(He),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){go({id:L.id}).then(()=>{N.success("删除成功"),K(),$.value==L.id&&($.value=-1,f())})}})},fe=_(null),X=()=>{fe.value.show($.value)},Le=_(!1),ce=le({group_id:void 0,ids:""}),Ae=()=>{if(I.value.state.selectedRowKeys.length==0)return N.error("请选择你要移动的问答");ce.ids=I.value.state.selectedRowKeys.join(","),ce.group_id=void 0,Le.value=!0},mt=()=>{if(I.value.state.selectedRowKeys.length==0)return N.error("请选择你要删除的问答");ae.confirm({title:"提示",icon:t(He),content:"确认是否删除所选问答?",onOk(){vo({id:I.value.state.selectedRowKeys.join(",")}).then(L=>{N.success("删除成功"),Z()})},onCancel(){}})},vt=()=>{if(!ce.group_id)return N.error("请选择分组");tn({...ce}).then(()=>{Le.value=!1,N.success("移动成功"),we()})},ie=_(at),Oe=_(!1);Lt(()=>{const L=parseInt(localStorage.getItem(co));L&&L>=at&&L<=St&&(ie.value=L)});let Re=!1,ge=0,ee=0;const Ce=L=>{u.value||(Re=!0,Oe.value=!0,ge=L.clientX,ee=ie.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Ke),document.addEventListener("mouseup",Ee))},Ke=L=>{if(!Re)return;let c=ee+(L.clientX-ge);c=Math.max(at,Math.min(St,c)),ie.value=c},Ee=()=>{Re&&(Re=!1,Oe.value=!1,localStorage.setItem(co,ie.value),document.body.style.cursor="",document.removeEventListener("mousemove",Ke),document.removeEventListener("mouseup",Ee))},Ie=_(!1),j=()=>{let L="";I.value.state.selectedRowKeys.length>0&&(L=I.value.state.selectedRowKeys.join(",")),Jo({library_id:U.id,export_type:2,group_id:$.value,data_ids:L}).then(c=>{Ie.value=!0})},ft=()=>{en.push({path:"/library/details/export-record",query:U})};return(L,c)=>{const pe=Rt,P=Ft,$e=Pe,Se=Co,Qe=xo,Ye=wo,Xe=mo,gt=Mt,me=It,yt=Cn,ht=We,Je=Ve,kt=Tt,Ze=ae,bt=$n;return s(),a(W,null,[e("div",Ts,[e("div",{class:re(["group-content-box",[{collapsed:u.value},{"no-transition":Oe.value}]]),style:ko(u.value?{}:{width:ie.value+"px",minWidth:at+"px",maxWidth:St+"px"})},[e("div",Ps,[e("div",Gs,[t(P,{title:"收起问答分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:v},[t(pe,{name:"put-away"})])]),_:1}),e("div",Es,[c[15]||(c[15]=e("div",null,"问答分组",-1)),t(P,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:c[0]||(c[0]=C=>x({}))},[t(R(Te))])]),_:1})])]),e("div",zs,[t($e,{value:h.value,"onUpdate:value":c[2]||(c[2]=C=>h.value=C),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(_t),{onClick:c[1]||(c[1]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",Ns,[t(Xe,{style:{"padding-right":"24px"}},{default:n(()=>[(s(!0),a(W,null,ue(k.value,C=>(s(),a("div",{class:re(["classify-item",{active:C.id==$.value}]),onClick:ye=>Ge(C),key:C.id},[e("div",Hs,b(C.group_name),1),e("div",js,[e("div",{class:re(["num",{"num-block":C.id<=0}])},b(C.total),3),C.id>0?(s(),a("div",Vs,[t(Ye,{placement:"bottomRight"},{overlay:n(()=>[t(Qe,null,{default:n(()=>[t(Se,null,{default:n(()=>[e("div",{onClick:se(ye=>x(C),["stop"])},"重命名",8,As)]),_:2},1024),t(Se,null,{default:n(()=>[e("div",{onClick:se(ye=>xe(C),["stop"])},"删 除",8,Ks)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",Ws,[t(R(ct))])]),_:2},1024)])):m("",!0)])],10,Bs))),128))]),_:1})]),u.value?m("",!0):(s(),a("div",{key:0,class:"resize-bar",onMousedown:Ce},null,32))],6),e("div",Qs,[t(Xe,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:n(()=>[e("div",Ys,[e("div",Xs,[u.value?(s(),B(gt,{key:0,title:null,placement:"bottom"},{content:n(()=>[e("div",Js,[e("div",Zs,[e("div",el,[e("div",tl,[c[16]||(c[16]=e("div",null,"问答分组",-1)),t(P,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:c[3]||(c[3]=C=>x({}))},[t(R(Te))])]),_:1})])]),e("div",ol,[t($e,{allowClear:"",value:h.value,"onUpdate:value":c[5]||(c[5]=C=>h.value=C),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(_t),{onClick:c[4]||(c[4]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",nl,[(s(!0),a(W,null,ue(k.value,C=>(s(),a("div",{class:re(["classify-item",{active:C.id==$.value}]),onClick:ye=>Ge(C),key:C.id},[e("div",ll,b(C.group_name),1),e("div",al,[e("div",{class:re(["num",{"num-block":C.id<=0}])},b(C.total),3),C.id>0?(s(),a("div",il,[t(Ye,{placement:"bottomRight"},{overlay:n(()=>[t(Qe,null,{default:n(()=>[t(Se,null,{default:n(()=>[e("div",{onClick:se(ye=>x(C),["stop"])},"重命名",8,dl)]),_:2},1024),t(Se,null,{default:n(()=>[e("div",{onClick:se(ye=>xe(C),["stop"])},"删 除",8,rl)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",ul,[t(R(ct))])]),_:2},1024)])):m("",!0)])],10,sl))),128))])])]),default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:v},[t(pe,{name:"expand"})])]),_:1})):m("",!0),e("div",null,b(E.value.group_name),1),e("div",_l,[t(me,{onClick:mt},{default:n(()=>c[17]||(c[17]=[g("批量删除")])),_:1,__:[17]}),t(me,{onClick:Ae},{default:n(()=>c[18]||(c[18]=[g("批量移动")])),_:1,__:[18]}),t(me,{onClick:c[6]||(c[6]=C=>X())},{default:n(()=>c[19]||(c[19]=[g("批量导入")])),_:1,__:[19]}),t(me,{onClick:c[7]||(c[7]=C=>j())},{default:n(()=>c[20]||(c[20]=[g("批量导出")])),_:1,__:[20]}),t(me,{onClick:c[8]||(c[8]=C=>z({})),type:"primary",icon:t(R(Te))},{default:n(()=>c[21]||(c[21]=[g("问答")])),_:1,__:[21]},8,["icon"])])]),e("div",cl,[d.value>0?(s(),a("div",pl,[t(pe,{name:"alert-icon"}),e("div",null,b(d.value)+"个问答学习失败",1),e("a",{onClick:p},"重新学习")])):m("",!0)])]),e("div",ml,[t(ms,{ref_key:"subsectionBoxRef",ref:I,total:O.value,isLoading:de.value,paragraphLists:S.value,onOpenEditSubscription:z,onHandleDelParagraph:we,onGetList:Z,onHandleSort:F},null,8,["total","isLoading","paragraphLists"]),e("div",vl,[t(yt,{current:T.value.page,"onUpdate:current":c[9]||(c[9]=C=>T.value.page=C),"page-size":T.value.size,"onUpdate:pageSize":c[10]||(c[10]=C=>T.value.size=C),total:O.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:Y},null,8,["current","page-size","total"])])])]),_:1})])]),t(kn,{detailsInfo:A.value,onHandleEdit:we,ref_key:"editSubscriptionRef",ref:D},null,8,["detailsInfo"]),t(Lo,{ref_key:"addGroupRef",ref:be,onOk:we},null,512),t(qo,{groupLists:V.value,library_id:G.library_id,onOk:we,ref_key:"qaUploadModalRef",ref:fe},null,8,["groupLists","library_id"]),t(Ze,{open:Le.value,"onUpdate:open":c[12]||(c[12]=C=>Le.value=C),title:"批量移动分组",onOk:vt},{default:n(()=>[t(kt,{align:"center",style:{margin:"24px 0"}},{default:n(()=>[c[22]||(c[22]=e("div",null,"移动到分组：",-1)),t(Je,{value:ce.group_id,"onUpdate:value":c[11]||(c[11]=C=>ce.group_id=C),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),a(W,null,ue(V.value.filter(C=>C.id>=0),C=>(s(),B(ht,{value:C.id},{default:n(()=>[g(b(C.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1,__:[22]})]),_:1},8,["open"]),t(Ze,{open:Ie.value,"onUpdate:open":c[14]||(c[14]=C=>Ie.value=C),title:null,footer:null,width:640},{default:n(()=>[t(bt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:n(()=>[t(me,{style:{"margin-right":"16px"},onClick:c[13]||(c[13]=C=>Ie.value=!1)},{default:n(()=>c[23]||(c[23]=[g("知道了")])),_:1,__:[23]}),t(me,{onClick:ft,type:"primary"},{default:n(()=>c[24]||(c[24]=[g("去下载")])),_:1,__:[24]})]),_:1})]),_:1},8,["open"])],64)}}},Du=ke(fl,[["__scopeId","data-v-fcf6505a"]]),gl={class:"form-box"},yl={class:"upload-document-type-box"},hl=["onClick"],kl={class:"right-block"},bl={class:"title-block"},wl={class:"title-text"},xl={class:"desc"},Cl={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(G,{expose:I,emit:H}){const U=Dt(),h=je(),V=pt.useForm,$=_(!1),E=_("添加自定义文档"),k=G,w=le({library_id:h.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),y=_([{iconName:"file-search",iconNameActive:"file-search",title:"问题与答案一起生成索引",value:1,desc:"回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复"},{iconName:"comment-search",iconNameActive:"comment-search",title:"仅对问题生成索引",value:2,desc:"回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复"}]),S=F=>{w.qa_index_type=F},u=le({file_name:[{message:"请输入昵称",required:!0}]}),{resetFields:O,validate:d,validateInfos:M}=V(w,u),A=()=>{$.value=!0,O(),w.file_name="",w.is_qa_doc=0,w.qa_index_type=1,w.library_id=k.libraryInfo.id||h.query.id,k.libraryInfo.type==2&&(w.is_qa_doc=1)},T=_(!1),Q=()=>{d().then(()=>{let F={...Ot(w),group_id:k.group_id};T.value=!0,dt(F).then(f=>{N.success(`${E.value}成功`),$.value=!1,U.push("/library/preview?id="+f.data.file_ids[0])}).finally(()=>{T.value=!1})})};return I({add:A}),(F,f)=>{const Y=Pe,v=Pt,p=qn,D=Sn,z=Rt,de=pt,Z=ae;return s(),a("div",null,[t(Z,{open:$.value,"onUpdate:open":f[2]||(f[2]=K=>$.value=K),title:E.value,onOk:Q,width:"472px",confirmLoading:T.value},{default:n(()=>[e("div",gl,[t(de,{layout:"vertical"},{default:n(()=>[t(v,fn({label:"文档名称"},R(M).file_name),{default:n(()=>[t(Y,{type:"text",placeholder:"请输入文档名称",value:w.file_name,"onUpdate:value":f[0]||(f[0]=K=>w.file_name=K)},null,8,["value"])]),_:1},16),m("",!0),w.is_qa_doc==1?(s(),B(v,{key:1,label:"索引方式",required:""},{default:n(()=>[e("div",yl,[(s(!0),a(W,null,ue(y.value,K=>(s(),a("div",{class:re(["type-item",{active:w.qa_index_type==K.value}]),key:K.value,onClick:be=>S(K.value)},[e("div",kl,[e("div",bl,[t(z,{name:w.qa_index_type==K.value?K.iconNameActive:K.iconName},null,8,["name"]),e("div",wl,b(K.title),1)]),e("div",xl,b(K.desc),1)]),w.qa_index_type==K.value?(s(),B(z,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):m("",!0)],10,hl))),128))])]),_:1})):m("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},$l=ke(Cl,[["__scopeId","data-v-2205ab5f"]]),Sl="/assets/img/guide-image-DSu20zRj.png",ql={class:"container"},Ll={class:"guide-content"},Ol={class:"content-box"},Rl={__name:"guide-learning-tips",setup(G,{expose:I}){const H=yo(),U=_(!1),h=_(!1),V=_(""),$=()=>{setTimeout(()=>{U.value=!0},500)},E=()=>{H.setGuideLearningTips(h.value),U.value=!1},k=()=>{H.setGuideLearningTips(h.value),U.value=!1};return I({show:$}),(w,y)=>{const S=Fn,u=It,O=ae;return s(),a("div",ql,[t(O,{open:U.value,"onUpdate:open":y[1]||(y[1]=d=>U.value=d),title:V.value,onOk:E,onCancel:k,width:"472px"},{footer:n(()=>[t(u,{type:"primary",onClick:E},{default:n(()=>y[5]||(y[5]=[g("我知道了")])),_:1,__:[5]})]),default:n(()=>[e("div",Ll,[y[4]||(y[4]=e("img",{src:Sl,alt:"操作引导",class:"guide-image"},null,-1)),e("div",Ol,[y[3]||(y[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),t(S,{checked:h.value,"onUpdate:checked":y[0]||(y[0]=d=>h.value=d)},{default:n(()=>y[2]||(y[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])),_:1,__:[2]},8,["checked"])])])]),_:1},8,["open","title"])])}}},Il=ke(Rl,[["__scopeId","data-v-d94a3a33"]]),Ul={__name:"edit-online-doc",emits:["ok"],setup(G,{expose:I,emit:H}){const U=H,h=le({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),V=_({file_name:[{message:"请文档名称",required:!0}],doc_auto_renew_frequency:[{message:"请选择更新频率",required:!0}]}),$=_(!1),E=S=>{S=JSON.parse(JSON.stringify(S)),h.id=S.id||"",h.file_name=S.file_name||"",h.doc_auto_renew_frequency=+S.doc_auto_renew_frequency||1,S.doc_auto_renew_minute>0&&(h.doc_auto_renew_minute=rt(S.doc_auto_renew_minute)),$.value=!0},k=_(!1),w=_(null),y=()=>{w.value.validate().then(()=>{k.value=!0,on({...h,doc_auto_renew_minute:h.doc_auto_renew_minute?rt(h.doc_auto_renew_minute):0}).then(()=>{$.value=!1,k.value=!1,U("ok")})}).catch(()=>{k.value=!1})};return I({show:E}),(S,u)=>{const O=Pe,d=Pt,M=We,A=Ve,T=So,Q=pt,F=ae;return s(),a("div",null,[t(F,{open:$.value,"onUpdate:open":u[3]||(u[3]=f=>$.value=f),"confirm-loading":k.value,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:y},{default:n(()=>[t(Q,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:w,model:h,rules:V.value},{default:n(()=>[t(d,{name:"file_name",label:"文件名称"},{default:n(()=>[t(O,{value:h.file_name,"onUpdate:value":u[0]||(u[0]=f=>h.file_name=f),placeholder:"请输入"},null,8,["value"])]),_:1}),t(d,{name:"doc_auto_renew_frequency",label:"更新频率"},{default:n(()=>[t(A,{value:h.doc_auto_renew_frequency,"onUpdate:value":u[1]||(u[1]=f=>h.doc_auto_renew_frequency=f),style:{width:"100%"}},{default:n(()=>[t(M,{value:1},{default:n(()=>u[4]||(u[4]=[g("不自动更新")])),_:1,__:[4]}),t(M,{value:2},{default:n(()=>u[5]||(u[5]=[g("每天")])),_:1,__:[5]}),t(M,{value:3},{default:n(()=>u[6]||(u[6]=[g("每3天")])),_:1,__:[6]}),t(M,{value:4},{default:n(()=>u[7]||(u[7]=[g("每7天")])),_:1,__:[7]}),t(M,{value:5},{default:n(()=>u[8]||(u[8]=[g("每30天")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),h.doc_auto_renew_frequency>1?(s(),B(d,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:n(()=>[t(T,{valueFormat:"HH:mm",value:h.doc_auto_renew_minute,"onUpdate:value":u[2]||(u[2]=f=>h.doc_auto_renew_minute=f),format:"HH:mm"},null,8,["value"])]),_:1})):m("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"])])}}},Dl={class:"form-item"},Fl={class:"form-content"},Ml={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(G,{expose:I,emit:H}){const U=_(!1),h=H,V=_("修改分组"),$=G,E=le({group_id:"",file_id:""}),k=_([]),w=u=>{E.group_id=u.group_id||"0",E.file_id=u.id||"",S(),U.value=!0},y=()=>{if(!E.group_id)return N.error("请选择分组");nn({...E,library_id:$.libraryId,sense:$.sense}).then(u=>{N.success(`${V.value}成功`),U.value=!1,h("ok")})},S=()=>{Ut({library_id:$.libraryId,group_type:1}).then(u=>{k.value=u.data||[]})};return I({show:w}),(u,O)=>{const d=We,M=Ve,A=ae;return s(),a("div",null,[t(A,{open:U.value,"onUpdate:open":O[1]||(O[1]=T=>U.value=T),title:V.value,onOk:y},{default:n(()=>[e("div",Dl,[O[2]||(O[2]=e("div",{class:"form-label"},"分组名称：",-1)),e("div",Fl,[t(M,{value:E.group_id,"onUpdate:value":O[0]||(O[0]=T=>E.group_id=T),style:{width:"100%"},placeholder:"请选择分组"},{default:n(()=>[(s(!0),a(W,null,ue(k.value,T=>(s(),B(d,{value:T.id},{default:n(()=>[g(b(T.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},Tl=ke(Ml,[["__scopeId","data-v-b85f6cc4"]]),Pl={class:"details-library-page"},Gl={class:"group-head-box"},El={class:"head-title"},zl={class:"flex-between-box"},Nl={class:"classify-box",style:{"margin-top":"16px"}},Bl=["onClick"],Hl={key:0,class:"drag-btn"},jl={key:1,style:{width:"20px"}},Vl={class:"classify-title"},Wl={class:"right-content"},Al={key:0,class:"btn-box"},Kl={class:"hover-btn-wrap"},Ql=["onClick"],Yl=["onClick"],Xl={class:"main-content-box"},Jl={class:"group-header-title"},Zl={class:"pover-group-content-box"},ea={class:"group-head-box"},ta={class:"head-title"},oa={class:"flex-between-box"},na={class:"search-box"},sa={class:"classify-box classify-scroll-box"},la=["onClick"],aa={class:"classify-title"},ia={class:"right-content"},ua={key:0,class:"btn-box"},da={class:"hover-btn-wrap"},ra=["onClick"],_a=["onClick"],ca={class:"title"},pa={class:"list-tools"},ma={class:"tools-items"},va={class:"right-box"},fa={key:0,class:"status-box"},ga={class:"status-item"},ya={class:"status-content"},ha={class:"status-item"},ka={class:"status-content content-tip"},ba={class:"status-item"},wa={class:"status-content content-tip"},xa={key:1,class:"status-select-box"},Ca={class:"tool-item"},$a={class:"tool-item"},Sa={class:"dropdown-btn-menu"},qa={key:0,class:"desc"},La={key:1,class:"desc"},Oa={class:"dropdown-btn-menu"},Ra={class:"dropdown-btn-menu"},Ia={class:"list-content"},Ua={key:0,class:"doc-name-td"},Da=["href"],Fa=["onClick"],Ma={key:0},Ta={key:1},Pa=["onClick"],Ga={key:0},Ea={key:1},za={key:2,class:"url-remark"},Na=["onClick"],Ba={key:0,class:"pdf-progress-box"},Ha={class:"progress-title"},ja={class:"status-box"},Va=["onClick"],Wa={class:"progress-bar"},Aa={class:"num-box"},Ka={key:0,class:"status-tag running"},Qa={key:2,class:"status-tag running"},Ya={key:3,class:"status-tag complete"},Xa={class:"status-tag status-error"},Ja=["onClick"],Za={class:"status-tag status-error"},ei={class:"status-tag"},ti=["onClick"],oi={key:7,class:"status-tag"},ni={key:8,class:"status-tag running"},si={class:"status-tag error"},li={key:10,class:"status-tag cancel"},ai={key:11,class:"status-tag subning"},ii={class:"status-tag"},ui=["onClick"],di={key:1,class:"status-tag running"},ri={key:2,class:"status-tag complete"},_i={class:"status-tag error"},ci=["onClick"],pi={class:"zm-line1 reason-text"},mi={key:4,class:"status-tag running"},vi={class:"status-tag warning"},fi={class:"reason-text"},gi=["onClick"],yi={key:0},hi={key:1},ki={key:0,class:"text-block"},bi={class:"time-content-box"},wi={key:0},xi={key:1},Ci={key:2},$i={key:3},Si={key:4},qi={key:5,class:"ml4"},Li={key:6},Oi=["onClick"],Ri={key:1},Ii={key:0},Ui={key:1},Di=["onClick"],Fi=["onClick"],Mi={class:"upload-file-box"},Ti={class:"select-card-box"},Pi=["onClick"],Gi={class:"card-title"},Ei={key:0,class:"card-switch-box"},zi={class:"card-desc"},Ni={key:0,class:"card-switch"},po="qa_document_group_box_width",it=180,qt=256,Bi={__name:"knowledge-document",props:{library_id:{type:[Number,String],default:()=>""}},setup(G){const{setStorage:I}=rn("localStorage"),H=fo(),{changeGraphSwitch:U}=H,h=sn(),V=ve(()=>{var l;return((l=h.companyInfo)==null?void 0:l.neo4j_status)=="true"}),$=ve(()=>{var l;return((l=h.companyInfo)==null?void 0:l.ali_ocr_switch)=="1"}),E=G,k=ve(()=>E.library_id||F.id),w=_(localStorage.getItem("document_group_hide_key")==1),y=_(""),S=_([]),u=_(-1),O=ve(()=>S.value.find(l=>l.id==u.value)||{}),d=ve(()=>S.value.filter(l=>l.group_name.includes(y.value))),M=yo(),A=[{key:2,title:"图文OCR解析",icon:"pdf-ocr",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。"},{key:1,title:"纯文本解析",icon:"pdf-text",desc:"只提取pdf中的文字内容，如果文档为扫描件可能提取不到内容。"},{key:3,title:"图文解析",icon:"pdf-img",desc:"提取PDF文档中的图片和文字"},{key:4,title:"阿里云OCR解析",icon:"ali-ocr",desc:"通过阿里云文档智能接口解析提取图片和文字"}],T=je(),Q=Dt(),F=T.query,f=_(!1),Y=_(null),v=_(null),p=_(!1),D=_({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});le({selectedRowKeys:[]});const z=le({use_model:"",model_config_id:""}),de=(l,o)=>{let q=o.modelName,J=o.modelId;xe.value.length>0?ae.confirm({title:`确定切换模型为${q}吗？`,content:"切换后，所有学习文档将自动重新学习。",onOk(){z.use_model=q,z.model_config_id=J,Z()},onCancel(){}}):(z.use_model=q,z.model_config_id=J,Z())},Z=(l=!0,o=null)=>{vn({...Ot(D.value),use_model:z.use_model,model_config_id:z.model_config_id}).then(()=>{D.value.use_model=z.use_model,D.value.model_config_id=z.model_config_id,typeof o=="function"&&o(),l&&N.success("保存成功")})},K=_([]),be=l=>{K.value=l},x=_([]),we=l=>{x.value=l,Ge()},Ge=()=>{if(!D.value.id){setTimeout(()=>{Ge()},100);return}if(x.value.length>0&&!D.value.use_model){let l=null,o=null;for(let q of x.value)if(q.model_define==="chatwiki"){l=q;for(let J of l.children)if(J.name==="text-embedding-v2"){o=J;break}break}l||(l=x.value[0],o=l.children[0]),l&&(z.use_model=o.name,z.model_config_id=o.model_config_id,Z(!1))}},xe=_([]),fe=le({learned_err_count:0,learned_count:0,learned_wait_count:0}),X=le({library_id:k.value,file_name:void 0,status:"",page:1,size:10,total:0}),Le=[{id:"",name:"全部"},{id:"4",name:"待学习"},{id:"8",name:"部分失败"},{id:"3",name:"全部失败"},{id:"2",name:"成功"}],ce=_([]),Ae=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"知识图谱",dataIndex:"graph_status",key:"graph_status",width:200},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"更新频率/时间",dataIndex:"doc_auto_renew_frequency",key:"doc_auto_renew_frequency",width:260},{title:"知识图谱实体数",dataIndex:"graph_entity_count",key:"graph_entity_count",width:160},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:150},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:100}],mt=l=>{ie()},vt=l=>{X.page=l.current,X.size=l.pageSize,ee()},ie=()=>{X.page=1,ee(),Ue()};let Oe=!1;const Re=({id:l})=>{xe.value.length==1&&(Oe=!0),mn({id:l}).then(()=>{Oe&&X.page>1&&X.page--,ee(),Ue(),N.success("删除成功")})},ge=(l,o={})=>{let q=T.name;if(l.status=="4"){if(q=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+l.id+"&page="+X.page);return}return Q.push({path:"/library/document-segmentation",query:{document_id:l.id,page:X.page}})}if(l.status=="3"&&D.value.type!=2)return N.error("学习失败,不可预览");if(l.status=="0")return N.error("转换中,稍候可预览");if(l.status=="1")return N.error("学习中,不可预览");if(l.status=="6")return N.error("获取中,不可预览");if(l.status=="7")return N.error("获取失败,不可预览");if(l.status=="10")return N.error("正在分段,不可预览");if(q=="libraryConfig"){window.open("/#/library/preview?id="+l.id);return}Q.push({name:"libraryPreview",query:{id:l.id,...o}})},ee=()=>{let l=Ot(X);l.status==0&&(l.status=""),l.group_id=u.value,f.value=!0,an(l).then(o=>{let q=o.data.info;!z.use_model&&z.use_model!=q.use_model&&(z.use_model=q.use_model,z.model_config_id=q.model_config_id),D.value={...q},p.value=q.graph_switch==1,q.graph_switch=="0"||!V.value?ce.value=Ae.filter(ne=>!["graph_status","graph_entity_count"].includes(ne.key)):ce.value=Ae;let J=o.data.list||[],he=o.data.count_data||{};X.total=o.data.total,fe.learned_count=he.learned_count,fe.learned_err_count=he.learned_err_count,fe.learned_wait_count=he.learned_wait_count;let te=!1;xe.value=J.map(ne=>(["1","6","0","5"].includes(ne.status)&&(te=!0),ne.file_size_str=un(ne.file_size),ne.update_time=no(ne.update_time*1e3).format("YYYY-MM-DD HH:mm"),ne.doc_last_renew_time_desc=ne.doc_last_renew_time>0?no(ne.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",ne)),te&&Ke(),!te&&clearInterval(Ce.value)}).finally(()=>{f.value=!1})},Ce=_(null),Ke=()=>{clearInterval(Ce.value),Ce.value=setInterval(()=>{ee()},1e3*5)},Ee=_(null),Ie=l=>{if(x.value.length==0){ae.confirm({title:"请先到模型管理中添加嵌入模型？",content:"知识库学习需要使用到嵌入模型，请在系统管理-模型管理中添加。推荐使用通义千问、openai或者火山引擎的嵌入模型。",okText:"去添加",onOk(){Q.push({path:"/user/model"})}});return}let{key:o}=l;o==1&&Qe(),o==2&&ft(),o==3&&Ee.value.add()},j=le({open:!1,urls:"",library_id:k.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:"请输入网页地址",required:!0},{validator:(l,o)=>ao(o)===!1?Promise.reject(new Error("网页地址不合法")):Promise.resolve()}]}}),ft=()=>{j.open=!0,j.confirmLoading=!1,j.urls="",j.doc_auto_renew_minute="02:00",j.doc_auto_renew_frequency=1},L=_(null),c=()=>{L.value.validate().then(()=>{j.confirmLoading=!0,dt({library_id:j.library_id,urls:JSON.stringify(ao(j.urls)),doc_auto_renew_frequency:j.doc_auto_renew_frequency,doc_auto_renew_minute:rt(j.doc_auto_renew_minute),doc_type:2,group_id:u.value}).then(()=>{j.open=!1,j.confirmLoading=!1,ie()})}).catch(()=>{j.confirmLoading=!1})},pe=()=>{j.open=!1},P=le({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),$e=ve(()=>P.fileList.filter(l=>l.type==="application/pdf").length>0),Se=_(null),Qe=()=>{if(D.value.type==2){Se.value.show();return}P.fileList=[],P.open=!0},Ye=()=>{P.fileList=[]},Xe=l=>{P.fileList=l},gt=()=>{if(Y.value&&!M.getGuideLearningTips&&P.fileList.length>1&&Y.value.show(),P.fileList.length==0){N.error("请选择文件");return}P.confirmLoading=!0;let l=new FormData;l.append("library_id",X.library_id),l.append("group_id",u.value||0);let o=!1;P.fileList.forEach(q=>{(q.name.includes(".xlsx")||q.name.includes(".csv"))&&(o=!0),l.append("library_files",q)}),$e.value&&l.append("pdf_parse_type",P.pdf_parse_type),dt(l).then(q=>{ee(),P.open=!1,P.fileList=[],P.confirmLoading=!1,o&&q.data.file_ids.length==1&&Q.push("/library/document-segmentation?document_id="+q.data.file_ids[0])}).catch(()=>{P.confirmLoading=!1})},me=_(null),yt=l=>{me.value.show(l)},ht=l=>{Q.push({path:"/library/document-segmentation",query:{document_id:l.id}})},Je=l=>{cn({id:l.id}).then(()=>{ee()})},kt=()=>{if(p.value){p.value=!1;let l={graph_model_config_id:D.value.graph_model_config_id,graph_use_model:D.value.graph_use_model};if((!l.graph_model_config_id||!l.graph_use_model)&&K.value.length>0){let q=K.value[0].children[0];l.graph_use_model=q.name,l.graph_model_config_id=q.model_config_id}v.value.show(l)}else D.value.graph_switch=0,Z(!1,()=>{ee(),U(0)})},Ze=l=>{p.value=!0,D.value.graph_switch=1,D.value.graph_model_config_id=l.graph_model_config_id,D.value.graph_use_model=l.graph_use_model,Z(!1,()=>{ee(),U(1)})},bt=l=>{if(l.key==4&&!$.value)return!1;P.pdf_parse_type=l.key},C=()=>{window.open("#/user/aliocr")},ye=_(null),Et=l=>{ye.value.show({...l})},Oo=l=>{pn({id:l.id}).then(o=>{N.success("更新成功"),ee()})},Ro=l=>{ae.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){_n({id:l.id}).then(o=>{N.success("取消成功"),ee()})}})},Io=l=>{I("graph:autoOpenFileId",l.id),Q.push({path:"/library/details/knowledge-graph",query:{id:k.value}})},Uo=l=>{let o=`/manage/downloadLibraryFile?id=${l.id}&token=${M.getToken}`;var q=document.createElement("a");q.href=o,q.style.display="none",q.click()},zt=()=>{w.value=!w.value,localStorage.setItem("document_group_hide_key",w.value?1:2)},Ue=()=>{Ut({library_id:k.value,group_type:1}).then(l=>{let q=(l.data||[]).reduce((J,he)=>J+ +he.total,0);S.value=[{group_name:"全部分组",id:-1,total:q},...l.data]})};Ue();const Nt=_(null),et=l=>{Nt.value.show({...l,library_id:k.value})},Bt=_(null),Do=l=>{Bt.value.show({...l,sense:1})},Ht=()=>{Ue(),ee()},jt=l=>{u.value=l.id,ie()},Vt=l=>{ae.confirm({title:`确认删除分组${l.group_name}`,icon:t(He),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){go({id:l.id,sense:1}).then(()=>{N.success("删除成功"),Ue(),u.value==l.id&&(u.value=-1,ie())})}})},ze=_(it),tt=_(!1);Lt(()=>{const l=parseInt(localStorage.getItem(po));l&&l>=it&&l<=qt&&(ze.value=l)});let ot=!1,Wt=0,At=0;const Fo=l=>{w.value||(ot=!0,tt.value=!0,Wt=l.clientX,At=ze.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",Kt),document.addEventListener("mouseup",Qt))},Kt=l=>{if(!ot)return;let o=At+(l.clientX-Wt);o=Math.max(it,Math.min(qt,o)),ze.value=o},Qt=()=>{ot&&(ot=!1,tt.value=!1,localStorage.setItem(po,ze.value),document.body.style.cursor="",document.removeEventListener("mousemove",Kt),document.removeEventListener("mouseup",Qt))},Mo=l=>l.draggedContext.element.id>0&&l.relatedContext.element.id>0,To=async()=>{try{const l=S.value.filter(o=>o.id>0).map((o,q)=>({id:o.id,sort:S.value.length-q}));await dn({library_id:k.value,sense:1,sort_group:JSON.stringify(l)}),N.success("排序已保存")}catch(l){console.error("排序保存失败:",l),Ue()}};return Lt(()=>{F.page&&(X.page=+F.page),ee()}),gn(()=>{Ce.value&&clearInterval(Ce.value)}),(l,o)=>{const q=Rt,J=Ft,he=Pe,te=Co,ne=xo,nt=wo,Yt=mo,Xt=Mt,qe=Tt,De=We,Jt=Ve,Po=Wn,Go=It,Eo=Nn,Ne=Bn,Zt=Hn,zo=bo,Be=Pt,eo=pt,to=ae,No=An,Bo=So,Ho=ho("copy");return s(),a("div",Pl,[e("div",{class:re(["group-content-box",[{collapsed:w.value},{"no-transition":tt.value}]]),style:ko(w.value?{}:{width:ze.value+"px",minWidth:it+"px",maxWidth:qt+"px"})},[e("div",Gl,[e("div",El,[t(J,{title:"收起问答分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:zt},[t(q,{name:"put-away"})])]),_:1}),e("div",zl,[o[17]||(o[17]=e("div",null,"知识分组",-1)),t(J,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:o[0]||(o[0]=r=>et({}))},[t(R(Te))])]),_:1})])]),m("",!0)]),e("div",Nl,[t(Yt,{style:{"padding-right":"24px"}},{default:n(()=>[t(R(En),{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=r=>S.value=r),"item-key":"id",disabled:tt.value,onEnd:To,move:Mo,handle:".drag-btn"},{item:n(({element:r})=>[e("div",{class:re(["classify-item",{active:r.id==u.value}]),onClick:i=>jt(r)},[r.id>0?(s(),a("span",Hl,[t(q,{name:"drag"})])):(s(),a("span",jl)),e("div",Vl,b(r.group_name),1),e("div",Wl,[e("div",{class:re(["num",{"num-block":r.id<=0}])},b(r.total),3),r.id>0?(s(),a("div",Al,[t(nt,{placement:"bottomRight"},{overlay:n(()=>[t(ne,null,{default:n(()=>[t(te,null,{default:n(()=>[e("div",{onClick:se(i=>et(r),["stop"])},"重命名",8,Ql)]),_:2},1024),t(te,null,{default:n(()=>[e("div",{onClick:se(i=>Vt(r),["stop"])},"删 除",8,Yl)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",Kl,[t(R(ct))])]),_:2},1024)])):m("",!0)])],10,Bl)]),_:1},8,["modelValue","disabled"])]),_:1})]),w.value?m("",!0):(s(),a("div",{key:0,class:"resize-bar",onMousedown:Fo},null,32))],6),e("div",Xl,[t(Yt,{scrollbar:!1},{default:n(()=>[e("div",Jl,[w.value?(s(),B(Xt,{key:0,title:null,placement:"bottom"},{content:n(()=>[e("div",Zl,[e("div",ea,[e("div",ta,[e("div",oa,[o[18]||(o[18]=e("div",null,"问答分组",-1)),t(J,{title:"新建分组"},{default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:o[4]||(o[4]=r=>et({}))},[t(R(Te))])]),_:1})])]),e("div",na,[t(he,{allowClear:"",value:y.value,"onUpdate:value":o[6]||(o[6]=r=>y.value=r),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[t(R(_t),{onClick:o[5]||(o[5]=se(()=>{},["stop"]))})]),_:1},8,["value"])])]),e("div",sa,[(s(!0),a(W,null,ue(d.value,r=>(s(),a("div",{class:re(["classify-item",{active:r.id==u.value}]),onClick:i=>jt(r),key:r.id},[e("div",aa,b(r.group_name),1),e("div",ia,[e("div",{class:re(["num",{"num-block":r.id<=0}])},b(r.total),3),r.id>0?(s(),a("div",ua,[t(nt,{placement:"bottomRight"},{overlay:n(()=>[t(ne,null,{default:n(()=>[t(te,null,{default:n(()=>[e("div",{onClick:se(i=>et(r),["stop"])},"重命名",8,ra)]),_:2},1024),t(te,null,{default:n(()=>[e("div",{onClick:se(i=>Vt(r),["stop"])},"删 除",8,_a)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("div",da,[t(R(ct))])]),_:2},1024)])):m("",!0)])],10,la))),128))])])]),default:n(()=>[e("div",{class:"hover-btn-wrap",onClick:zt},[t(q,{name:"expand"})])]),_:1})):m("",!0),e("div",ca,b(O.value.group_name),1)]),e("div",pa,[e("div",ma,[ut(t(qe,{align:"center",class:"tool-item custom-select-box"},{default:n(()=>[o[19]||(o[19]=e("span",null,"嵌入模型：",-1)),t(io,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:z.use_model,modeId:z.model_config_id,style:{width:"240px"},onChange:de,onLoaded:we},null,8,["modeName","modeId"])]),_:1,__:[19]},512),[[lo,!1]])]),e("div",va,[D.value.type==0?(s(),a("div",fa,[e("div",ga,[o[20]||(o[20]=e("div",{class:"status-label"},"已学习：",-1)),e("div",ya,b(fe.learned_count),1)]),e("div",ha,[o[21]||(o[21]=e("div",{class:"status-label"},"，未学习：",-1)),e("div",ka,b(fe.learned_wait_count),1)]),e("div",ba,[o[22]||(o[22]=e("div",{class:"status-label"},"，学习失败：",-1)),e("div",wa,b(fe.learned_err_count),1)])])):m("",!0),D.value.type==0?(s(),a("div",xa,[t(Jt,{value:X.status,"onUpdate:value":o[7]||(o[7]=r=>X.status=r),style:{width:"150px"},placeholder:"请选择",onChange:mt},{default:n(()=>[(s(),a(W,null,ue(Le,r=>t(De,{key:r.id,value:r.id},{default:n(()=>[g(b(r.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])])):m("",!0),e("div",Ca,[t(he,{style:{width:"140px"},value:X.file_name,"onUpdate:value":o[8]||(o[8]=r=>X.file_name=r),placeholder:"文档名称搜索",onChange:ie},{suffix:n(()=>[t(R(_t),{onClick:ie,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),V.value?(s(),B(qe,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:n(()=>[ut(t(io,{modelType:"LLM",onLoaded:be},null,512),[[lo,!1]]),o[23]||(o[23]=e("span",null,"生成知识图谱：",-1)),t(Po,{checked:p.value,"onUpdate:checked":o[9]||(o[9]=r=>p.value=r),onChange:kt,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[23]})):m("",!0),e("div",$a,[t(nt,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:n(()=>[t(ne,{onClick:Ie},{default:n(()=>[(s(),B(te,{key:1},{default:n(()=>[e("div",Sa,[t(qe,{class:"title-block",gap:4},{default:n(()=>[t(q,{name:"doc-icon"}),o[24]||(o[24]=e("div",{class:"title"},"本地文档",-1))]),_:1,__:[24]}),D.value.type==2?(s(),a("div",qa," 上传本地 docx/csv/xlsx 等格式文件 ")):(s(),a("div",La," 上传本地 pdf/docx/ofd/txt/md/xlsx/csv/html 等格式文件 "))])]),_:1})),D.value.type!=2?(s(),B(te,{key:2},{default:n(()=>[e("div",Oa,[t(qe,{class:"title-block",gap:4},{default:n(()=>[t(q,{name:"link-icon"}),o[25]||(o[25]=e("div",{class:"title"},"在线数据",-1))]),_:1,__:[25]}),o[26]||(o[26]=e("div",{class:"desc"},"获取在线网页内容",-1))])]),_:1})):m("",!0),(s(),B(te,{key:3},{default:n(()=>[e("div",Ra,[t(qe,{class:"title-block",gap:4},{default:n(()=>[t(q,{name:"cu-doc-icon"}),o[27]||(o[27]=e("div",{class:"title"},"自定义文档",-1))]),_:1,__:[27]}),o[28]||(o[28]=e("div",{class:"desc"},"自定义一个空文档，手动添加内容",-1))])]),_:1}))]),_:1})]),default:n(()=>[t(Go,{type:"primary"},{icon:n(()=>[t(R(Te))]),default:n(()=>[o[29]||(o[29]=e("span",null,"添加内容",-1))]),_:1,__:[29]})]),_:1})])])]),D.value.type==0?(s(),B(Dn,{key:0,style:{"margin-bottom":"16px"},title:"使用说明"},{default:n(()=>o[30]||(o[30]=[e("div",null,[e("p",null,' 1、如果单次上传一个文档，上传成功后，系统会自动学习；如果单次上传多个文档，上传成功后，需要手动点击文档后面"学习"进行学习；如果解析失败，支持重新学习。 '),e("p",null,"2、未学习的文档数据不会被检索到。")],-1)])),_:1,__:[30]})):m("",!0),e("div",Ia,[t(zo,{columns:ce.value,"data-source":xe.value,scroll:{x:1e3},"row-key":"id",pagination:{current:X.page,total:X.total,pageSize:X.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:vt},{bodyCell:n(({column:r,record:i})=>[r.key==="file_name"?(s(),a("div",Ua,[i.doc_type==2?(s(),B(Xt,{key:0,title:null},{content:n(()=>[o[31]||(o[31]=g(" 原链接：")),e("a",{href:i.doc_url,target:"_blank"},b(i.doc_url),9,Da),ut(t(R(zn),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Ho,`${i.doc_url}`]])]),default:n(()=>[e("a",{onClick:oe=>ge(i)},[["5","6","7"].includes(i.status)?(s(),a("span",Ma,b(i.doc_url),1)):(s(),a("span",Ta,b(i.file_name),1))],8,Fa)]),_:2},1024)):(s(),a("a",{key:1,onClick:oe=>ge(i)},[["5","6","7"].includes(i.status)?(s(),a("span",Ga,b(i.doc_url),1)):(s(),a("span",Ea,b(i.file_name),1))],8,Pa)),i.doc_type==2&&i.remark?(s(),a("div",za," 备注："+b(i.remark),1)):m("",!0)])):m("",!0),r.key==="graph_entity_count"?(s(),a("a",{key:1,onClick:oe=>Io(i)},b(i.graph_entity_count),9,Na)):m("",!0),r.key==="status"?(s(),a(W,{key:2},[i.file_ext=="pdf"&&i.pdf_parse_type>=2?(s(),a(W,{key:0},[i.status==0?(s(),a("div",Ba,[e("div",Ha,[e("span",ja,[t(R(ln)),o[32]||(o[32]=g("文档解析中"))]),e("a",{onClick:oe=>Ro(i)},"取消",8,Va)]),e("div",Wa,[t(Eo,{size:"small",class:"progress-bar-box",percent:parseInt(i.ocr_pdf_index/i.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",Aa,b(i.ocr_pdf_index)+" / "+b(i.ocr_pdf_total),1)])])):m("",!0)],64)):(s(),a(W,{key:1},[i.status==0?(s(),a("span",Ka,[t(Ne,{size:"small"}),o[33]||(o[33]=g(" 转换中"))])):m("",!0)],64)),i.status==1?(s(),a("span",Qa,[t(Ne,{size:"small"}),o[34]||(o[34]=g(" 学习中"))])):m("",!0),i.status==2?(s(),a("span",Ya,[t(R(wt)),o[35]||(o[35]=g(" 学习完成"))])):m("",!0),i.status==3?(s(),B(J,{key:4,placement:"top"},{title:n(()=>[e("span",null,b(i.errmsg),1)]),default:n(()=>[e("span",null,[e("span",Xa,[t(R(st)),o[36]||(o[36]=g(" 转换失败"))]),D.value.type==2?(s(),a("a",{key:0,class:"ml8",onClick:oe=>ge(i)},"学习",8,Ja)):m("",!0)])]),_:2},1024)):m("",!0),i.status==8?(s(),B(J,{key:5,placement:"top"},{title:n(()=>[e("span",null,b(i.errmsg),1)]),default:n(()=>[e("span",null,[e("span",Za,[t(R(st)),o[37]||(o[37]=g(" 转化异常"))])])]),_:2},1024)):m("",!0),i.status==4?(s(),a(W,{key:6},[e("span",ei,[t(R(xt)),o[38]||(o[38]=g(" 待学习"))]),e("a",{class:"ml8",onClick:oe=>ge(i)},"学习",8,ti)],64)):m("",!0),i.status==5?(s(),a("span",oi,[t(R(xt)),o[39]||(o[39]=g(" 待获取"))])):m("",!0),i.status==6?(s(),a("span",ni,[t(Ne,{size:"small"}),o[40]||(o[40]=g(" 获取中"))])):m("",!0),i.status==7?(s(),B(J,{key:9,placement:"top"},{title:n(()=>[e("span",null,b(i.errmsg),1)]),default:n(()=>[e("span",si,[t(R(st)),o[41]||(o[41]=g(" 获取失败"))])]),_:2},1024)):m("",!0),i.status==9?(s(),a("span",li,[t(R(He)),o[42]||(o[42]=g(" 取消解析"))])):m("",!0),i.status==10?(s(),a("span",ai,[t(Ne,{size:"small"}),o[43]||(o[43]=g(" 正在分段 "))])):m("",!0)],64)):m("",!0),r.key==="graph_status"?(s(),a(W,{key:3},[i.graph_status==0?(s(),a(W,{key:0},[e("span",ii,[t(R(xt)),o[44]||(o[44]=g(" 待生成"))]),e("a",{class:"ml8",onClick:oe=>Je(i)},"生成",8,ui)],64)):i.graph_status==1?(s(),a("span",di,[t(R(Gt)),o[45]||(o[45]=g(" 排队中"))])):i.graph_status==2?(s(),a("span",ri,[t(R(wt)),o[46]||(o[46]=g(" 生成完成"))])):i.graph_status==3?(s(),a(W,{key:3},[e("span",_i,[t(R(st)),o[47]||(o[47]=g(" 生成失败"))]),e("a",{class:"ml8",onClick:oe=>Je(i)},"生成",8,ci),i.graph_err_msg?(s(),B(J,{key:0,title:i.graph_err_msg},{default:n(()=>[e("div",pi,"原因："+b(i.graph_err_msg),1)]),_:2},1032,["title"])):m("",!0)],64)):i.graph_status==4?(s(),a("span",mi,[t(Ne,{size:"small"}),o[48]||(o[48]=g(" 生成中"))])):i.graph_status==5?(s(),a(W,{key:5},[e("span",vi,[t(R(wt)),o[49]||(o[49]=g(" 部分成功"))]),e("div",fi,[g(" 失败数："+b(i.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:oe=>ge(i,{graph_status:3})},"详情",8,gi)])],64)):m("",!0)],64)):m("",!0),r.key==="file_size"?(s(),a(W,{key:4},[i.doc_type==3?(s(),a("span",yi,"-")):(s(),a("span",hi,b(i.file_size_str),1))],64)):m("",!0),r.key==="doc_auto_renew_frequency"?(s(),a(W,{key:5},[i.doc_type==2?(s(),a("div",ki,[e("div",bi,[i.doc_auto_renew_frequency==1?(s(),a("span",wi,"不自动更新")):m("",!0),i.doc_auto_renew_frequency==2?(s(),a("span",xi,"每天")):m("",!0),i.doc_auto_renew_frequency==3?(s(),a("span",Ci,"每3天")):m("",!0),i.doc_auto_renew_frequency==4?(s(),a("span",$i,"每7天")):m("",!0),i.doc_auto_renew_frequency==5?(s(),a("span",Si,"每30天")):m("",!0),i.doc_auto_renew_frequency>1&&i.doc_auto_renew_minute>0?(s(),a("span",qi,b(R(rt)(i.doc_auto_renew_minute)),1)):m("",!0),i.doc_auto_renew_frequency>1?(s(),a("span",Li,"更新")):m("",!0),e("a",{class:"ml4 btn-hover-block",onClick:oe=>Et(i)},"修改",8,Oi)]),t(qe,{align:"center"},{default:n(()=>[g(" 最近更新: "+b(i.doc_last_renew_time_desc)+" ",1),t(Zt,{title:"确认更新?",onConfirm:oe=>Oo(i)},{default:n(()=>o[50]||(o[50]=[e("a",{class:"ml4 btn-hover-block"},"更新",-1)])),_:2,__:[50]},1032,["onConfirm"])]),_:2},1024)])):(s(),a("div",Ri,"--"))],64)):m("",!0),r.key==="paragraph_count"?(s(),a(W,{key:6},[i.status==0||i.status==1?(s(),a("span",Ii,"-")):(s(),a("span",Ui,b(i.paragraph_count),1))],64)):m("",!0),r.key==="action"?(s(),B(qe,{key:7,gap:8},{default:n(()=>[t(J,null,{title:n(()=>o[51]||(o[51]=[g("重新分段")])),default:n(()=>[t(R(jn),{class:"btn-hover-block",onClick:oe=>ht(i)},null,8,["onClick"])]),_:2},1024),t(nt,null,{overlay:n(()=>[t(ne,null,{default:n(()=>[i.doc_type==2?(s(),B(te,{key:0},{default:n(()=>[e("div",{onClick:oe=>Et(i)},"编辑",8,Di)]),_:2},1024)):m("",!0),t(te,{disabled:i.status==6||i.status==7||i.status==0},{default:n(()=>[e("div",{onClick:oe=>ge(i)},"预览",8,Fi)]),_:2},1032,["disabled"]),t(te,{onClick:oe=>yt(i)},{default:n(()=>o[52]||(o[52]=[e("div",null,"重命名",-1)])),_:2,__:[52]},1032,["onClick"]),t(Zt,{title:"确定要删除吗?",onConfirm:oe=>Re(i)},{default:n(()=>[t(te,null,{default:n(()=>o[53]||(o[53]=[e("span",null,"删除",-1)])),_:1,__:[53]})]),_:2},1032,["onConfirm"]),t(te,{onClick:oe=>Do(i)},{default:n(()=>o[54]||(o[54]=[e("div",null,"修改分组",-1)])),_:2,__:[54]},1032,["onClick"]),t(te,{onClick:oe=>Uo(i)},{default:n(()=>o[55]||(o[55]=[e("div",null,"下载文档",-1)])),_:2,__:[55]},1032,["onClick"])]),_:2},1024)]),default:n(()=>[e("div",{class:"table-btn",onClick:o[10]||(o[10]=se(()=>{},["prevent"]))},[t(R(Vn),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):m("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1})]),t(to,{open:P.open,"onUpdate:open":o[12]||(o[12]=r=>P.open=r),"confirm-loading":P.confirmLoading,maskClosable:!1,title:"上传文档",onOk:gt,onCancel:Ye,width:"740px"},{default:n(()=>[t(eo,{class:"mt24"},{default:n(()=>[t(Be,{required:"",label:""},{default:n(()=>[e("div",Mi,[t($o,{type:D.value.type,maxCount:20,value:P.fileList,"onUpdate:value":o[11]||(o[11]=r=>P.fileList=r),onChange:Xe},null,8,["type","value"])])]),_:1}),$e.value?(s(),B(Be,{key:0,required:"",label:"PDF解析模式",class:"select-card-main"},{default:n(()=>[e("div",Ti,[(s(),a(W,null,ue(A,r=>e("div",{key:r.key,class:re(["select-card-item",{active:P.pdf_parse_type==r.key},{disabled:r.key==4&&!$.value}]),onClick:se(i=>bt(r),["stop"])},[t(q,{class:"check-arrow",name:"check-arrow-filled"}),e("div",Gi,[t(q,{name:r.icon,style:{"font-size":"16px"}},null,8,["name"]),g(" "+b(r.title)+" ",1),r.key==4&&!$.value?(s(),a("div",Ei,"未开启")):m("",!0)]),e("div",zi,b(r.desc),1),r.key==4&&!$.value?(s(),a("div",Ni,[o[56]||(o[56]=g(" 未开启阿里云OCR ")),e("div",{class:"card-switch-btn",onClick:se(C,["stop"])},"去开启")])):m("",!0)],10,Pi)),64))])]),_:1})):m("",!0)]),_:1})]),_:1},8,["open","confirm-loading"]),t(qo,{onOk:ee,ref_key:"qaUploadModalRef",ref:Se},null,512),t(to,{open:j.open,"onUpdate:open":o[16]||(o[16]=r=>j.open=r),"confirm-loading":j.confirmLoading,maskClosable:!1,title:"添加在线数据",width:"746px",onOk:c,onCancel:pe},{default:n(()=>[t(eo,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:L,model:j,rules:j.rules},{default:n(()=>[t(Be,{name:"urls",label:"网页链接"},{default:n(()=>[t(No,{style:{height:"120px"},value:j.urls,"onUpdate:value":o[13]||(o[13]=r=>j.urls=r),placeholder:"请输入网页链接,形式：一行标题一行网页链接"},null,8,["value"])]),_:1}),t(Be,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:n(()=>[t(Jt,{value:j.doc_auto_renew_frequency,"onUpdate:value":o[14]||(o[14]=r=>j.doc_auto_renew_frequency=r),style:{width:"100%"}},{default:n(()=>[t(De,{value:1},{default:n(()=>o[57]||(o[57]=[g("不自动更新")])),_:1,__:[57]}),t(De,{value:2},{default:n(()=>o[58]||(o[58]=[g("每天")])),_:1,__:[58]}),t(De,{value:3},{default:n(()=>o[59]||(o[59]=[g("每3天")])),_:1,__:[59]}),t(De,{value:4},{default:n(()=>o[60]||(o[60]=[g("每7天")])),_:1,__:[60]}),t(De,{value:5},{default:n(()=>o[61]||(o[61]=[g("每30天")])),_:1,__:[61]})]),_:1},8,["value"])]),_:1}),j.doc_auto_renew_frequency>1?(s(),B(Be,{key:0,name:"doc_auto_renew_minute",label:"更新时间"},{default:n(()=>[t(Bo,{valueFormat:"HH:mm",value:j.doc_auto_renew_minute,"onUpdate:value":o[15]||(o[15]=r=>j.doc_auto_renew_minute=r),format:"HH:mm"},null,8,["value"])]),_:1})):m("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading"]),t($l,{libraryInfo:D.value,group_id:u.value,onOk:ie,ref_key:"addCustomDocumentRef",ref:Ee},null,8,["libraryInfo","group_id"]),t(Un,{onOk:ie,ref_key:"renameModalRef",ref:me},null,512),t(Ln,{onOk:Ze,ref_key:"openGrapgModalRef",ref:v},null,512),t(Il,{ref_key:"guideLearningTipsRef",ref:Y},null,512),t(Ul,{onOk:ee,ref_key:"editOnlineDocRef",ref:ye},null,512),t(Lo,{group_type:"1",ref_key:"addGroupRef",ref:Nt,onOk:Ht},null,512),t(Tl,{libraryId:k.value,sense:1,ref_key:"editGroupRef",ref:Bt,onOk:Ht},null,8,["libraryId"])])}}},Fu=ke(Bi,[["__scopeId","data-v-a58ae991"]]);export{Fu as K,Du as Q};
