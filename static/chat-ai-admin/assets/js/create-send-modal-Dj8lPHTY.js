import{_ as ue}from"./default-cover-Bm8pZ2KF.js";import{r as i,E as Z,e as Y,b as v,t as _,p as u,a as h,y as n,u as a,_ as $,v as r,F as ee,l as ce,q,ag as _e,j as xe,J as Ce}from"./vue-chunks-BdaA73Wf.js";import{d as Re}from"./utils-CvB22N-W.js";import{am as $e,an as ze,ao as Ne,ap as oe}from"./index-Cg7-0swo.js";import{u as de,bj as Ue,bk as Ie}from"../../index-DSFcP5NQ.js";import{_ as re}from"./emoji-mart-BBMRoEa3.js";import{a5 as De,B as ie,ag as me,ai as Oe,r as pe,s as ve,an as Te,H as fe,b3 as he,M as te,b as F,F as Fe,c as Me,I as Be,a1 as Ve,a3 as Le}from"./ui-antd-Dl1wwwCD.js";const Pe={class:"rule-modal"},qe={class:"toolbar"},Ge={class:"table-header"},je={class:"th th-name"},Ae={class:"th"},Ee={class:"th"},Ke={class:"th"},He={class:"th"},Je={key:0,class:"loading-box"},Qe={key:1},We={key:0,class:"empty-box"},Xe={class:"name-col"},Ye={class:"col"},Ze={class:"col"},et={class:"col"},tt={class:"col"},at={class:"pager-box"},st={__name:"comment-rule-modal",emits:["updated","selected"],setup(ae,{expose:G,emit:j}){const U=_e(),{t:d}=de("views.explore.article-group-send.components.comment-rule-modal"),s=i(!1),k=i([]),C=i(!1),z=i(0),c=Z({page:1,size:10,rule_name:"",is_default:-1}),l=i(""),I=i(""),M=i(!1),x=m=>{I.value=String(m.id||m.task_id||""),l.value=String(m.comment_rule_id||""),M.value=!!m.select_only||!I.value,s.value=!0,c.page=1,b()},b=()=>{C.value=!0,$e({page:c.page,size:c.size,rule_name:c.rule_name,is_default:-1}).then(m=>{const f=(m==null?void 0:m.data)||{},y=Array.isArray(f.list)?f.list:[];if(k.value=y.map(p=>({...p,id:String(p.id||""),rule_name:p.rule_name||p.name||""})),z.value=Number(f.total||y.length||0),!l.value){const p=k.value.find(R=>String(R.is_default)==="1");p&&(l.value=String(p.id))}}).finally(()=>{C.value=!1})},D=()=>{c.page=1,b()},A=m=>{c.page=m,b()},O=()=>{U.push({path:"/explore/index/ai-comment-management/create-custom-rule"})},B=async()=>{if(!l.value){F.warning(d("error_select_rule"));return}if(M.value||!I.value){const m=(k.value||[]).find(p=>String(p.id)===String(l.value))||null,f=(m==null?void 0:m.rule_name)||"",y=String((m==null?void 0:m.is_default)||"");w("selected",{rule_id:l.value,rule_name:f,is_default:y}),s.value=!1;return}await ze({task_id:I.value,rule_id:l.value}),F.success(d("message_set_success")),s.value=!1,w("updated")},V=()=>{s.value=!1},w=j;return G({show:x}),(m,f)=>{const y=De,p=ie,R=me,E=Oe,P=ve,K=Te,T=fe,H=pe,J=he,Q=te;return v(),Y(Q,{open:s.value,"onUpdate:open":f[2]||(f[2]=g=>s.value=g),title:a(d)("modal_title"),width:720,onOk:B,onCancel:V},{default:_(()=>[u("div",Pe,[u("div",qe,[n(y,{value:c.rule_name,"onUpdate:value":f[0]||(f[0]=g=>c.rule_name=g),placeholder:a(d)("search_rule_placeholder"),onSearch:D,allowClear:""},null,8,["value","placeholder"]),n(p,{class:"create-btn",onClick:O},{default:_(()=>[$(r(a(d)("btn_go_create_rule")),1)]),_:1})]),u("div",Ge,[u("div",je,r(a(d)("th_rule_name")),1),u("div",Ae,r(a(d)("th_delete_comment")),1),u("div",Ee,r(a(d)("th_reply_comment")),1),u("div",Ke,r(a(d)("th_elect_comment")),1),u("div",He,r(a(d)("th_rule_enable")),1)]),C.value?(v(),h("div",Je,[n(R)])):(v(),h("div",Qe,[k.value.length===0?(v(),h("div",We,[n(E,{description:a(d)("empty_no_rule")},null,8,["description"])])):(v(),Y(H,{key:1,value:l.value,"onUpdate:value":f[1]||(f[1]=g=>l.value=g),class:"radio-list"},{default:_(()=>[(v(!0),h(ee,null,ce(k.value,g=>(v(),h("div",{class:"radio-row",key:g.id},[u("div",Xe,[n(P,{value:String(g.id)},{default:_(()=>[$(r(g.rule_name),1)]),_:2},1032,["value"]),String(g.is_default)==="1"?(v(),Y(K,{key:0,color:"blue",class:"default-tag"},{default:_(()=>[$(r(a(d)("tag_default")),1)]),_:1})):q("",!0)]),u("div",Ye,[n(T,{"checked-children":a(d)("switch_on"),"un-checked-children":a(d)("switch_off"),checked:String(g.delete_comment_switch)==="1",disabled:""},null,8,["checked-children","un-checked-children","checked"])]),u("div",Ze,[n(T,{"checked-children":a(d)("switch_on"),"un-checked-children":a(d)("switch_off"),checked:String(g.reply_comment_switch)==="1",disabled:""},null,8,["checked-children","un-checked-children","checked"])]),u("div",et,[n(T,{"checked-children":a(d)("switch_on"),"un-checked-children":a(d)("switch_off"),checked:String(g.elect_comment_switch)==="1",disabled:""},null,8,["checked-children","un-checked-children","checked"])]),u("div",tt,[n(T,{"checked-children":a(d)("switch_on"),"un-checked-children":a(d)("switch_off"),checked:String(g.switch)==="1",disabled:""},null,8,["checked-children","un-checked-children","checked"])])]))),128))]),_:1},8,["value"])),u("div",at,[n(J,{size:"small",current:c.page,pageSize:c.size,total:z.value,onChange:A},null,8,["current","pageSize","total"])])]))])]),_:1},8,["open","title"])}}},nt=re(st,[["__scopeId","data-v-9c750bf3"]]),lt={key:0,class:"draft-preview"},ot=["src"],ut={key:1,class:"thumb",src:ue},ct={class:"info"},_t={class:"title"},dt={class:"meta"},rt={class:"digest"},it={key:0,class:"desc"},mt={key:0,style:{"margin-top":"8px"}},pt={class:"desc"},vt={class:"select-draft-modal"},ft={key:0,class:"loading-box"},ht={class:"draft-list"},gt=["src"],kt={key:1,class:"thumb",src:ue},bt={class:"info"},wt={class:"title"},yt={class:"meta"},St={class:"digest"},xt={class:"pagination-box"},Ct={__name:"create-send-modal",props:{appId:{type:String,default:""},accessKey:{type:String,default:""},getGroupName:{type:Function,default:null}},emits:["created","updated"],setup(ae,{expose:G,emit:j}){const U=ae,d=_e(),{t:s}=de("views.explore.article-group-send.components.create-send-modal"),k=i(!1),C=i("create"),z=i(null),c=i(null),l=Z({task_name:"",to_user_type:0,comment_status:1,open_status:1}),I={task_name:[{required:!0,message:s("error_enter_task_name")}]},M=i(null),x=i("now"),b=i(null),D=U.getGroupName,A=e=>typeof D=="function"?D(e):e==0?s("group_unassigned"):"",O=i(!1),B=i([]),V=i(!1),w=Z({page:1,size:10}),m=i(0),f=i(void 0),y=i(null),p=i(""),R=i(""),E=()=>{var e;O.value=!0,f.value=(e=c.value)==null?void 0:e.id,P()},P=async()=>{V.value=!0;const e=await Ne({page:w.page,size:w.size,app_id:U.appId}),t=(e==null?void 0:e.data)||{};B.value=t.list||[],m.value=t.total||0,V.value=!1},K=(e,t)=>{w.page=e,w.size=t,P()},T=()=>{if(!f.value){F.error(s("error_select_draft"));return}const e=B.value.find(t=>t.id===f.value);e&&(c.value=e,String(l.task_name||"").trim()||(l.task_name=e.title||"")),O.value=!1},H=(e={})=>{if(e.task){C.value="edit",z.value=e.task,c.value={thumb_url:e.task.thumb_url,title:e.task.title,digest:e.task.digest,group_id:e.task.group_id,group_name:e.task.group_name,id:e.task.draft_id},l.task_name=e.task.task_name||"",l.to_user_type=Number(e.task.to_user_type??0),l.comment_status=Number(e.task.comment_status||0),l.open_status=Number(e.task.open_status||0),p.value=String(e.task.comment_rule_id||""),R.value=e.task.comment_rule_name||"";const N=Number(e.task.send_time||0);N>0?(x.value="custom",b.value=Re(N*1e3)):(x.value="now",b.value=null),k.value=!0;return}C.value="create";const t=e.draft||null;c.value=t,l.task_name=(t==null?void 0:t.title)||"",l.to_user_type=0,l.comment_status=1,l.open_status=1,x.value="now",b.value=null,p.value="",R.value="",k.value=!0},J=()=>{var e;y.value&&y.value.show({select_only:!0,task_id:(e=z.value)==null?void 0:e.id,comment_rule_id:p.value})},Q=e=>{p.value=String((e==null?void 0:e.rule_id)||""),R.value=(e==null?void 0:e.rule_name)||""},g=()=>{W("updated")},ge=async()=>{var N,S;try{await((N=M.value)==null?void 0:N.validate())}catch{return}if(!c.value){F.error(s("error_no_draft_selected"));return}let e=0;x.value==="custom"&&b.value&&(e=Math.floor(b.value.valueOf()/1e3));const t={task_name:l.task_name,app_id:U.appId,access_key:U.accessKey,send_time:e,comment_status:l.comment_status,open_status:l.open_status,to_user_type:l.to_user_type};if(p.value&&(t.comment_rule_id=p.value),(S=c.value)!=null&&S.id&&(t.draft_id=c.value.id),C.value==="edit"){if(!z.value){F.error(s("error_invalid_task"));return}t.task_id=z.value.id,await oe(t),W("updated"),k.value=!1;return}await oe(t),d.currentRoute.value.path!=="/explore/index/article-group-send/group-send"?te.confirm({title:s("modal_task_created_title"),content:s("modal_task_created_content"),okText:s("modal_task_created_ok"),cancelText:s("btn_cancel"),onOk:()=>{d.push({path:"/explore/index/article-group-send/group-send"})}}):F.success(s("message_task_created")),W("created"),k.value=!1},ke=()=>{k.value=!1},W=j;return G({show:H}),xe(()=>{Ue()}),Ce(()=>{Ie()}),(e,t)=>{const N=Be,S=Me,L=ve,X=pe,se=ie,ne=fe,be=Le,we=Fe,le=te,ye=me,Se=he;return v(),h("div",null,[n(le,{class:"create-send-modal",open:k.value,"onUpdate:open":t[6]||(t[6]=o=>k.value=o),title:C.value==="edit"?a(s)("modal_title_edit"):a(s)("modal_title_create"),width:720,onOk:ge,onCancel:ke},{default:_(()=>[n(we,{layout:"vertical",ref_key:"sendFormRef",ref:M,model:l,rules:I,class:"create-send-form"},{default:_(()=>[n(S,{label:a(s)("field_task_name"),name:"task_name",required:""},{default:_(()=>[n(N,{value:l.task_name,"onUpdate:value":t[0]||(t[0]=o=>l.task_name=o),placeholder:a(s)("placeholder_task_name")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(S,{label:a(s)("field_to_user_type"),name:"to_user_type"},{default:_(()=>[n(X,{value:l.to_user_type,"onUpdate:value":t[1]||(t[1]=o=>l.to_user_type=o)},{default:_(()=>[n(L,{value:0},{default:_(()=>[$(r(a(s)("to_user_all_fans")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),n(S,{label:a(s)("field_send_content"),required:""},{default:_(()=>[n(se,{type:"dashed",style:{"margin-bottom":"8px"},onClick:E},{icon:_(()=>[n(a(Ve))]),default:_(()=>[$(" "+r(a(s)("btn_select_draft")),1)]),_:1}),c.value?(v(),h("div",lt,[c.value.thumb_url?(v(),h("img",{key:0,class:"thumb",src:c.value.thumb_url},null,8,ot)):(v(),h("img",ut)),u("div",ct,[u("div",_t,r(c.value.title),1),u("div",dt,r(a(s)("draft_group_label"))+r(c.value.group_name||(a(D)?a(D)(c.value.group_id):"")),1),u("div",rt,r(c.value.digest),1)])])):q("",!0)]),_:1},8,["label"]),n(S,{label:a(s)("field_select_ai_rule")},{default:_(()=>[n(se,{type:"dashed",onClick:J},{default:_(()=>[$(r(a(s)("btn_select_rule")),1)]),_:1}),p.value?(v(),h("div",it,r(a(s)("selected_rule_desc",{name:R.value||"ID "+p.value})),1)):q("",!0)]),_:1},8,["label"]),n(S,{label:a(s)("field_comment_status"),name:"comment_status"},{default:_(()=>[n(ne,{checked:l.comment_status,"onUpdate:checked":t[2]||(t[2]=o=>l.comment_status=o),checkedValue:1,"un-checkedValue":0},null,8,["checked"])]),_:1},8,["label"]),n(S,{label:a(s)("field_send_time")},{default:_(()=>[n(X,{value:x.value,"onUpdate:value":t[3]||(t[3]=o=>x.value=o)},{default:_(()=>[n(L,{value:"now"},{default:_(()=>[$(r(a(s)("send_time_now")),1)]),_:1}),n(L,{value:"custom"},{default:_(()=>[$(r(a(s)("send_time_custom")),1)]),_:1})]),_:1},8,["value"]),x.value==="custom"?(v(),h("div",mt,[n(be,{value:b.value,"onUpdate:value":t[4]||(t[4]=o=>b.value=o),"show-time":"",style:{width:"100%"}},null,8,["value"])])):q("",!0)]),_:1},8,["label"]),n(S,{label:a(s)("field_open_status"),name:"open_status"},{default:_(()=>[n(ne,{checked:l.open_status,"onUpdate:checked":t[5]||(t[5]=o=>l.open_status=o),checkedValue:1,"un-checkedValue":0},null,8,["checked"]),u("div",pt,r(a(s)("desc_open_status")),1)]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]),n(nt,{ref_key:"commentRuleModalRef",ref:y,onUpdated:g,onSelected:Q},null,512),n(le,{open:O.value,"onUpdate:open":t[10]||(t[10]=o=>O.value=o),title:a(s)("modal_select_draft_title"),width:720,onOk:T},{default:_(()=>[u("div",vt,[V.value?(v(),h("div",ft,[n(ye)])):(v(),h(ee,{key:1},[n(X,{value:f.value,"onUpdate:value":t[7]||(t[7]=o=>f.value=o),style:{width:"100%"}},{default:_(()=>[u("div",ht,[(v(!0),h(ee,null,ce(B.value,o=>(v(),h("label",{class:"draft-item",key:o.id},[n(L,{value:o.id},null,8,["value"]),o.thumb_url?(v(),h("img",{key:0,class:"thumb",src:o.thumb_url},null,8,gt)):(v(),h("img",kt)),u("div",bt,[u("div",wt,r(o.title),1),u("div",yt,r(a(s)("draft_group_label"))+r(A(o.group_id)),1),u("div",St,r(o.digest),1)])]))),128))])]),_:1},8,["value"]),u("div",xt,[n(Se,{current:w.page,"onUpdate:current":t[8]||(t[8]=o=>w.page=o),"page-size":w.size,"onUpdate:pageSize":t[9]||(t[9]=o=>w.size=o),total:m.value,pageSizeOptions:["10","20","50"],"show-size-changer":"",onChange:K},null,8,["current","page-size","total"])])],64))])]),_:1},8,["open","title"])])}}},Ot=re(Ct,[["__scopeId","data-v-03e1bf02"]]);export{nt as C,Ot as a};
//# sourceMappingURL=create-send-modal-Dj8lPHTY.js.map
