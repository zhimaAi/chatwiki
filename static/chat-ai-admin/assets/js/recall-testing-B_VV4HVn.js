import{u as V,bE as J,_ as E,bF as W,aD as j}from"../../index-DSFcP5NQ.js";import{_ as A}from"./cu-scroll-CpIj948h.js";import{_ as G}from"./empty-DkpCLaix.js";import{ah as I,r as b,E as K,c as O,j as P,a as _,b as l,p as e,v as i,u as a,q as m,y as d,t as y,_ as v,e as $,F as N,l as U,h as Q,ag as X}from"./vue-chunks-BdaA73Wf.js";import{_ as Y}from"./recommendation-AQ4_FPQ9.js";import{M as Z}from"./model-select-CMPvMrAQ.js";import{W as ee}from"./index-Bm4uv5SC.js";import{_ as D}from"./emoji-mart-BBMRoEa3.js";import{V as se,B as te,D as oe,aq as ie,ac as B,q as le,aB as ae,G as ne,H as re,b as T,ag as _e,ba as ce}from"./ui-antd-Dl1wwwCD.js";import{u as de}from"./useMathJax-6Oa0Io1D.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./index-MT9fcN3v.js";const ue={class:"recall-settings-box"},me={class:"alert-box"},pe={class:"form-box"},ve={class:"form-item"},he={class:"form-item-body"},fe={class:"form-item"},ye={class:"form-item"},be={class:"form-item-label"},ge={class:"form-item-body"},ke={class:"retrieval-mode-items"},xe=["onClick"],we={class:"retrieval-mode-title"},qe={class:"title-text"},$e={key:0,style:{width:"32px"},src:Y,alt:""},Ne={class:"retrieval-mode-desc"},Re={key:0,class:"form-item"},ze={class:"form-item"},Ce={class:"form-item-label"},Se={class:"form-item-body"},Me={class:"number-box"},Te={class:"number-slider-box"},Ue={class:"number-input-box"},Le={key:1,class:"form-item"},Be={class:"form-item-label"},Ve={class:"form-item-body"},Ee={class:"number-box"},Ie={class:"number-slider-box"},Oe={class:"number-input-box"},De={class:"form-item"},Fe={class:"form-item-label"},He={class:"form-item-body"},Je={__name:"recall-testing-form",emits:["save","load"],setup(F,{expose:u,emit:R}){const{t:n}=V("views.library.library-details.components.recall-testing-form"),x=I(),g=b(!1),f=R,h=b(!0),w=b([{iconName:"mix-icon",title:n("mode_mix_title"),value:1,isRecommendation:!0,desc:n("mode_mix_desc")},{iconName:"vector-icon",title:n("mode_vector_title"),value:2,desc:n("mode_vector_desc")},{iconName:"graph-icon",title:n("mode_graph_title"),value:4,desc:n("mode_graph_desc")},{iconName:"search-check-icon",title:n("mode_fulltext_title"),value:3,desc:n("mode_fulltext_desc")}]),s=K({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:x.query.id,rrf_weight:{vector:0,search:0,graph:0}}),z=O(()=>h.value?w.value.filter(c=>c.value==s.search_type):w.value),C=c=>{s.search_type=c},p=()=>{if(!s.similarity)return T.error(n("msg_input_similarity"));if(!s.size)return T.error(n("msg_input_size"));if(!s.question)return T.error(n("msg_input_question"));let c={id:s.id,question:s.question,size:s.size,similarity:s.similarity,search_type:s.search_type,rrf_weight:JSON.stringify(s.rrf_weight)};s.rerank_status==1&&(c.rerank_model_config_id=s.rerank_model_config_id,c.rerank_use_model=s.rerank_use_model),g.value=!0,f("load"),W(c).then(t=>{f("save",t.data)}).catch(()=>{f("save",[])}).finally(()=>{g.value=!1})};return P(()=>{J().then(c=>{s.rrf_weight=c.data||{vector:0,search:0,graph:0}})}),u({open}),(c,t)=>{const S=se,M=te,r=E,k=le,q=ae,L=ne,H=re;return l(),_("div",ue,[e("div",me,i(a(n)("alert_tip")),1),e("div",pe,[e("div",ve,[e("div",he,[d(S,{style:{height:"76px"},value:s.question,"onUpdate:value":t[0]||(t[0]=o=>s.question=o),placeholder:a(n)("ph_test_question")},null,8,["value","placeholder"])])]),e("div",fe,[d(M,{loading:g.value,onClick:p,type:"primary",block:""},{default:y(()=>[v(i(a(n)("btn_test")),1)]),_:1},8,["loading"])]),e("div",ye,[e("div",be,[e("div",{class:"hover-label",onClick:t[1]||(t[1]=o=>h.value=!h.value)},[v(i(a(n)("label_retrieval_mode"))+" ",1),h.value?(l(),$(a(oe),{key:0})):(l(),$(a(ie),{key:1}))])]),e("div",ge,[e("div",ke,[(l(!0),_(N,null,U(z.value,o=>(l(),_("div",{class:Q(["retrieval-mode-item",{active:s.search_type==o.value}]),key:o.value,onClick:cs=>C(o.value)},[s.search_type==o.value?(l(),$(r,{key:0,class:"check-arrow",name:"check-arrow-filled"})):m("",!0),e("div",we,[d(r,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",qe,i(o.title),1),o.isRecommendation?(l(),_("img",$e)):m("",!0)]),e("div",Ne,i(o.desc),1)],10,xe))),128))])])]),s.search_type==1?(l(),_("div",Re,[d(ee,{rrf_weight:s.rrf_weight,"onUpdate:rrf_weight":t[2]||(t[2]=o=>s.rrf_weight=o)},null,8,["rrf_weight"])])):m("",!0),e("div",ze,[e("div",Ce,[e("span",null,i(a(n)("label_top_k"))+" ",1),d(k,null,{title:y(()=>[v(i(a(n)("tooltip_top_k")),1)]),default:y(()=>[d(a(B),{class:"question-icon"})]),_:1})]),e("div",Se,[e("div",Me,[e("div",Te,[d(q,{class:"custom-slider",value:s.size,"onUpdate:value":t[3]||(t[3]=o=>s.size=o),min:1,max:500},null,8,["value"])]),e("div",Ue,[d(L,{value:s.size,"onUpdate:value":t[4]||(t[4]=o=>s.size=o),min:1,max:500},null,8,["value"])])])])]),s.search_type<=2?(l(),_("div",Le,[e("div",Be,[e("span",null,i(a(n)("label_similarity_threshold"))+" ",1),d(k,null,{title:y(()=>[v(i(a(n)("tooltip_similarity_threshold")),1)]),default:y(()=>[d(a(B),{class:"question-icon"})]),_:1})]),e("div",Ve,[e("div",Ee,[e("div",Ie,[d(q,{class:"custom-slider",value:s.similarity,"onUpdate:value":t[5]||(t[5]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Oe,[d(L,{value:s.similarity,"onUpdate:value":t[6]||(t[6]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):m("",!0),e("div",De,[e("div",Fe,[e("span",null,i(a(n)("label_rerank_model")),1),t[10]||(t[10]=v("   ",-1)),d(H,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":t[7]||(t[7]=o=>s.rerank_status=o)},null,8,["checked"])]),e("div",He,[d(Z,{modelType:"RERANK",modeName:s.rerank_use_model,"onUpdate:modeName":t[8]||(t[8]=o=>s.rerank_use_model=o),modeId:s.rerank_model_config_id,"onUpdate:modeId":t[9]||(t[9]=o=>s.rerank_model_config_id=o),style:{width:"320px"},placeholder:a(n)("ph_select_rerank_model")},null,8,["modeName","modeId","placeholder"])])])])])}}},We=D(Je,[["__scopeId","data-v-b135901c"]]),je={class:"recall-testing-box"},Ae={class:"recall-from-box"},Ge={key:0,class:"empty-box"},Ke={class:"title"},Pe={class:"top-block"},Qe={class:"title"},Xe={key:0,class:"ml4"},Ye={class:"info-block"},Ze={class:"gray-text"},es=["onClick"],ss={key:0},ts={class:"gray-text"},os={key:0,class:"content-box"},is={key:1,class:"content-box similar-questions-box"},ls={class:"similar-questions-list"},as={key:2,class:"content-box"},ns=["innerHTML"],rs={key:2,class:"loading-box"},_s={__name:"recall-testing",setup(F){const{t:u}=V("views.library.library-details.recall-testing");I(),X();const R=j(),{renderMath:n}=de(),x=b(null),g=b(!1),f=b(!1),h=b([]),w=O(()=>R.type),s=(p=[])=>{f.value=!1,p.forEach(c=>{c.similar_questions&&(c.similar_questions=JSON.parse(c.similar_questions))}),h.value=p||[],n(x.value)},z=()=>{f.value=!0},C=p=>{if(!p.file_name){window.open(`/#/library/details/categary-manage?id=${p.library_id}`);return}window.open(`/#/library/preview?id=${p.file_id}`)};return(p,c)=>{const t=A,S=E,M=_e;return l(),_("div",je,[e("div",Ae,[d(t,null,{default:y(()=>[d(We,{onLoad:z,onSave:s})]),_:1})]),e("div",{class:"content-list-box",ref_key:"contRef",ref:x},[g.value||h.value.length===0?(l(),_("div",Ge,[c[0]||(c[0]=e("img",{src:G,alt:""},null,-1)),e("div",Ke,i(a(u)("empty_no_results")),1)])):(l(),$(t,{key:1},{default:y(()=>[(l(!0),_(N,null,U(h.value,r=>(l(),_("div",{class:"list-item",key:r.id},[e("div",Pe,[e("div",Qe,[v(i(a(u)("label_id"))+i(r.id)+" ",1),r.title?(l(),_("div",Xe,i(r.title),1)):m("",!0),e("span",null,i(a(u)("text_total_chars",{count:r.word_total})),1)])]),e("div",Ye,[e("span",Ze,i(a(u)("label_from")),1),e("div",{class:"link-text",onClick:k=>C(r)},[d(a(ce)),v(" "+i(r.file_name)+" ",1),r.file_name?m("",!0):(l(),_("span",ss,i(r.library_name)+i(a(u)("text_selected")),1))],8,es),c[1]||(c[1]=e("span",{class:"v-line"},null,-1)),e("span",ts,[v(i(a(u)("label_similarity"))+" ",1),d(S,{name:"similarity",style:{"font-size":"16px"}}),v(" "+i(r.similarity),1)])]),w.value==2?(l(),_(N,{key:0},[r.question?(l(),_("div",os,i(a(u)("label_question"))+i(r.question),1)):m("",!0),r.similar_questions&&r.similar_questions.length?(l(),_("div",is,[e("span",null,i(a(u)("label_similar_questions")),1),e("ul",ls,[(l(!0),_(N,null,U(r.similar_questions,(k,q)=>(l(),_("li",{key:q},i(k),1))),128))])])):m("",!0),r.answer?(l(),_("div",as,i(a(u)("label_answer"))+i(r.answer),1)):m("",!0)],64)):(l(),_("div",{key:1,class:"content-box",innerHTML:r.content},null,8,ns))]))),128))]),_:1})),f.value?(l(),_("div",rs,[d(M)])):m("",!0)],512)])}}},Ss=D(_s,[["__scopeId","data-v-b5f00534"]]);export{Ss as default};
//# sourceMappingURL=recall-testing-B_VV4HVn.js.map
