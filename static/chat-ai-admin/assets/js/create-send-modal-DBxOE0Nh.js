import{_ as oe}from"./default-cover-Bm8pZ2KF.js";import{f as i,r as Y,ae as W,ad as _,ar as c,as as l,ac as m,k as a,G as C,F as Z,ax as ue,az as L,at as x,av as ce,o as ye,b as we,u as X}from"./vue-chunks-CGLjTDrY.js";import{aa as xe,B as ie,al as de,an as Ce,w as re,x as _e,as as Re,Q as me,bC as ve,M as ee,b as O,F as ze,e as Ne,I as Ue,a6 as Ie,a8 as $e,d as De}from"./ui-antd-BHaxN-GS.js";import{am as Oe,an as Te,ao as Fe,ap as le}from"./index-CoChppVN.js";import{_ as pe,bh as Me,bi as Be}from"../../index-CB2DywzJ.js";const Ve={class:"rule-modal"},Le={class:"toolbar"},Pe={key:0,class:"loading-box"},Ge={key:1},qe={key:0,class:"empty-box"},Ae={class:"name-col"},Ke={class:"col"},je={class:"col"},Ee={class:"col"},Qe={class:"col"},He={class:"pager-box"},Je={__name:"comment-rule-modal",emits:["updated","selected"],setup(te,{expose:P,emit:G}){const N=ce(),b=i(!1),p=i([]),y=i(!1),R=i(0),o=Y({page:1,size:10,rule_name:"",is_default:-1}),s=i(""),U=i(""),T=i(!1),S=d=>{U.value=String(d.id||d.task_id||""),s.value=String(d.comment_rule_id||""),T.value=!!d.select_only||!U.value,b.value=!0,o.page=1,f()},f=()=>{y.value=!0,Oe({page:o.page,size:o.size,rule_name:o.rule_name,is_default:-1}).then(d=>{const u=(d==null?void 0:d.data)||{},k=Array.isArray(u.list)?u.list:[];if(p.value=k.map(r=>({...r,id:String(r.id||""),rule_name:r.rule_name||r.name||""})),R.value=Number(u.total||k.length||0),!s.value){const r=p.value.find(w=>String(w.is_default)==="1");r&&(s.value=String(r.id))}}).finally(()=>{y.value=!1})},I=()=>{o.page=1,f()},q=d=>{o.page=d,f()},$=()=>{N.push({path:"/explore/index/ai-comment-management/create-custom-rule"})},F=async()=>{if(!s.value){O.warning("请选择一个规则");return}if(T.value||!U.value){const d=(p.value||[]).find(r=>String(r.id)===String(s.value))||null,u=(d==null?void 0:d.rule_name)||"",k=String((d==null?void 0:d.is_default)||"");g("selected",{rule_id:s.value,rule_name:u,is_default:k}),b.value=!1;return}await Te({task_id:U.value,rule_id:s.value}),O.success("设置成功"),b.value=!1,g("updated")},M=()=>{b.value=!1},g=G;return P({show:S}),(d,u)=>{const k=xe,r=ie,w=de,A=Ce,V=_e,K=Re,D=me,j=re,E=ve,Q=ee;return _(),W(Q,{open:b.value,"onUpdate:open":u[2]||(u[2]=v=>b.value=v),title:"设置AI评论规则",width:720,onOk:F,onCancel:M},{default:c(()=>[l("div",Ve,[l("div",Le,[a(k,{value:o.rule_name,"onUpdate:value":u[0]||(u[0]=v=>o.rule_name=v),placeholder:"请输入规则名搜索",onSearch:I,allowClear:""},null,8,["value"]),a(r,{class:"create-btn",onClick:$},{default:c(()=>[...u[3]||(u[3]=[C("去创建规则",-1)])]),_:1})]),u[5]||(u[5]=l("div",{class:"table-header"},[l("div",{class:"th th-name"},"规则名称"),l("div",{class:"th"},"自动删评"),l("div",{class:"th"},"自动回复评论"),l("div",{class:"th"},"评论精选"),l("div",{class:"th"},"规则启用")],-1)),y.value?(_(),m("div",Pe,[a(w)])):(_(),m("div",Ge,[p.value.length===0?(_(),m("div",qe,[a(A,{description:"暂无规则"})])):(_(),W(j,{key:1,value:s.value,"onUpdate:value":u[1]||(u[1]=v=>s.value=v),class:"radio-list"},{default:c(()=>[(_(!0),m(Z,null,ue(p.value,v=>(_(),m("div",{class:"radio-row",key:v.id},[l("div",Ae,[a(V,{value:String(v.id)},{default:c(()=>[C(x(v.rule_name),1)]),_:2},1032,["value"]),String(v.is_default)==="1"?(_(),W(K,{key:0,color:"blue",class:"default-tag"},{default:c(()=>[...u[4]||(u[4]=[C("默认",-1)])]),_:1})):L("",!0)]),l("div",Ke,[a(D,{"checked-children":"开","un-checked-children":"关",checked:String(v.delete_comment_switch)==="1",disabled:""},null,8,["checked"])]),l("div",je,[a(D,{"checked-children":"开","un-checked-children":"关",checked:String(v.reply_comment_switch)==="1",disabled:""},null,8,["checked"])]),l("div",Ee,[a(D,{"checked-children":"开","un-checked-children":"关",checked:String(v.elect_comment_switch)==="1",disabled:""},null,8,["checked"])]),l("div",Qe,[a(D,{"checked-children":"开","un-checked-children":"关",checked:String(v.switch)==="1",disabled:""},null,8,["checked"])])]))),128))]),_:1},8,["value"])),l("div",He,[a(E,{size:"small",current:o.page,pageSize:o.size,total:R.value,onChange:q},null,8,["current","pageSize","total"])])]))])]),_:1},8,["open"])}}},We=pe(Je,[["__scopeId","data-v-1bd394a4"]]),Xe={key:0,class:"draft-preview"},Ye=["src"],Ze={key:1,class:"thumb",src:oe},et={class:"info"},tt={class:"title"},at={class:"meta"},st={class:"digest"},nt={key:0,class:"desc"},lt={key:0,style:{"margin-top":"8px"}},ot={class:"select-draft-modal"},ut={key:0,class:"loading-box"},ct={class:"draft-list"},it=["src"],dt={key:1,class:"thumb",src:oe},rt={class:"info"},_t={class:"title"},mt={class:"meta"},vt={class:"digest"},pt={class:"pagination-box"},ft={__name:"create-send-modal",props:{appId:{type:String,default:""},accessKey:{type:String,default:""},getGroupName:{type:Function,default:null}},emits:["created","updated"],setup(te,{expose:P,emit:G}){const N=te,b=ce(),p=i(!1),y=i("create"),R=i(null),o=i(null),s=Y({task_name:"",to_user_type:0,comment_status:1,open_status:1}),U={task_name:[{required:!0,message:"请输入群发任务名称"}]},T=i(null),S=i("now"),f=i(null),I=N.getGroupName,q=t=>typeof I=="function"?I(t):t==0?"未分组":"",$=i(!1),F=i([]),M=i(!1),g=Y({page:1,size:10}),d=i(0),u=i(void 0),k=i(null),r=i(""),w=i(""),A=()=>{var t;$.value=!0,u.value=(t=o.value)==null?void 0:t.id,V()},V=async()=>{M.value=!0;const t=await Fe({page:g.page,size:g.size,app_id:N.appId}),e=(t==null?void 0:t.data)||{};F.value=e.list||[],d.value=e.total||0,M.value=!1},K=(t,e)=>{g.page=t,g.size=e,V()},D=()=>{if(!u.value){O.error("请选择草稿");return}const t=F.value.find(e=>e.id===u.value);t&&(o.value=t,String(s.task_name||"").trim()||(s.task_name=t.title||"")),$.value=!1},j=(t={})=>{if(t.task){y.value="edit",R.value=t.task,o.value={thumb_url:t.task.thumb_url,title:t.task.title,digest:t.task.digest,group_id:t.task.group_id,group_name:t.task.group_name,id:t.task.draft_id},s.task_name=t.task.task_name||"",s.to_user_type=Number(t.task.to_user_type??0),s.comment_status=Number(t.task.comment_status||0),s.open_status=Number(t.task.open_status||0),r.value=String(t.task.comment_rule_id||""),w.value=t.task.comment_rule_name||"";const z=Number(t.task.send_time||0);z>0?(S.value="custom",f.value=De(z*1e3)):(S.value="now",f.value=null),p.value=!0;return}y.value="create";const e=t.draft||null;o.value=e,s.task_name=(e==null?void 0:e.title)||"",s.to_user_type=0,s.comment_status=1,s.open_status=1,S.value="now",f.value=null,r.value="",w.value="",p.value=!0},E=()=>{var t;k.value&&k.value.show({select_only:!0,task_id:(t=R.value)==null?void 0:t.id,comment_rule_id:r.value})},Q=t=>{r.value=String((t==null?void 0:t.rule_id)||""),w.value=(t==null?void 0:t.rule_name)||""},v=()=>{H("updated")},fe=async()=>{var z,h;try{await((z=T.value)==null?void 0:z.validate())}catch{return}if(!o.value){O.error("未选择草稿");return}let t=0;S.value==="custom"&&f.value&&(t=Math.floor(f.value.valueOf()/1e3));const e={task_name:s.task_name,app_id:N.appId,access_key:N.accessKey,send_time:t,comment_status:s.comment_status,open_status:s.open_status,to_user_type:s.to_user_type};if(r.value&&(e.comment_rule_id=r.value),(h=o.value)!=null&&h.id&&(e.draft_id=o.value.id),y.value==="edit"){if(!R.value){O.error("无效任务");return}e.task_id=R.value.id,await le(e),H("updated"),p.value=!1;return}await le(e),b.currentRoute.value.path!=="/explore/index/article-group-send/group-send"?ee.confirm({title:"群发任务已创建",content:"您可到群发管理中查看群发进度",okText:"去查看",cancelText:"取消",onOk:()=>{b.push({path:"/explore/index/article-group-send/group-send"})}}):O.success("群发任务已创建"),H("created"),p.value=!1},ge=()=>{p.value=!1},H=G;return P({show:j}),ye(()=>{Me()}),we(()=>{Be()}),(t,e)=>{const z=Ue,h=Ne,B=_e,J=re,ae=ie,se=me,ke=$e,he=ze,ne=ee,be=de,Se=ve;return _(),m("div",null,[a(ne,{class:"create-send-modal",open:p.value,"onUpdate:open":e[6]||(e[6]=n=>p.value=n),title:y.value==="edit"?"编辑群发":"创建群发",width:720,onOk:fe,onCancel:ge},{default:c(()=>[a(he,{layout:"vertical",ref_key:"sendFormRef",ref:T,model:s,rules:U,class:"create-send-form"},{default:c(()=>[a(h,{label:"群发名称",name:"task_name",required:""},{default:c(()=>[a(z,{value:s.task_name,"onUpdate:value":e[0]||(e[0]=n=>s.task_name=n),placeholder:"请输入群发名称"},null,8,["value"])]),_:1}),a(h,{label:"群发对象",name:"to_user_type"},{default:c(()=>[a(J,{value:s.to_user_type,"onUpdate:value":e[1]||(e[1]=n=>s.to_user_type=n)},{default:c(()=>[a(B,{value:0},{default:c(()=>[...e[11]||(e[11]=[C("全部粉丝",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(h,{label:"群发内容",required:""},{default:c(()=>[a(ae,{type:"dashed",style:{"margin-bottom":"8px"},onClick:A},{icon:c(()=>[a(X(Ie))]),default:c(()=>[e[12]||(e[12]=C(" 选择草稿 ",-1))]),_:1}),o.value?(_(),m("div",Xe,[o.value.thumb_url?(_(),m("img",{key:0,class:"thumb",src:o.value.thumb_url},null,8,Ye)):(_(),m("img",Ze)),l("div",et,[l("div",tt,x(o.value.title),1),l("div",at,"所属分组："+x(o.value.group_name||(X(I)?X(I)(o.value.group_id):"")),1),l("div",st,x(o.value.digest),1)])])):L("",!0)]),_:1}),a(h,{label:"选择AI精选评论规则"},{default:c(()=>[a(ae,{type:"dashed",onClick:E},{default:c(()=>[...e[13]||(e[13]=[C("选择规则",-1)])]),_:1}),r.value?(_(),m("div",nt,"已选择："+x(w.value||"规则ID "+r.value),1)):L("",!0)]),_:1}),a(h,{label:"开启留言",name:"comment_status"},{default:c(()=>[a(se,{checked:s.comment_status,"onUpdate:checked":e[2]||(e[2]=n=>s.comment_status=n),checkedValue:1,"un-checkedValue":0},null,8,["checked"])]),_:1}),a(h,{label:"群发时间"},{default:c(()=>[a(J,{value:S.value,"onUpdate:value":e[3]||(e[3]=n=>S.value=n)},{default:c(()=>[a(B,{value:"now"},{default:c(()=>[...e[14]||(e[14]=[C("立即群发",-1)])]),_:1}),a(B,{value:"custom"},{default:c(()=>[...e[15]||(e[15]=[C("自定义群发时间",-1)])]),_:1})]),_:1},8,["value"]),S.value==="custom"?(_(),m("div",lt,[a(ke,{value:f.value,"onUpdate:value":e[4]||(e[4]=n=>f.value=n),"show-time":"",style:{width:"100%"}},null,8,["value"])])):L("",!0)]),_:1}),a(h,{label:"是否开启",name:"open_status"},{default:c(()=>[a(se,{checked:s.open_status,"onUpdate:checked":e[5]||(e[5]=n=>s.open_status=n),checkedValue:1,"un-checkedValue":0},null,8,["checked"]),e[16]||(e[16]=l("div",{class:"desc"},"立即发送默认开启的话，保存后立即发送",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),a(We,{ref_key:"commentRuleModalRef",ref:k,onUpdated:v,onSelected:Q},null,512),a(ne,{open:$.value,"onUpdate:open":e[10]||(e[10]=n=>$.value=n),title:"选择草稿",width:720,onOk:D},{default:c(()=>[l("div",ot,[M.value?(_(),m("div",ut,[a(be)])):(_(),m(Z,{key:1},[a(J,{value:u.value,"onUpdate:value":e[7]||(e[7]=n=>u.value=n),style:{width:"100%"}},{default:c(()=>[l("div",ct,[(_(!0),m(Z,null,ue(F.value,n=>(_(),m("label",{class:"draft-item",key:n.id},[a(B,{value:n.id},null,8,["value"]),n.thumb_url?(_(),m("img",{key:0,class:"thumb",src:n.thumb_url},null,8,it)):(_(),m("img",dt)),l("div",rt,[l("div",_t,x(n.title),1),l("div",mt,"所属分组："+x(q(n.group_id)),1),l("div",vt,x(n.digest),1)])]))),128))])]),_:1},8,["value"]),l("div",pt,[a(Se,{current:g.page,"onUpdate:current":e[8]||(e[8]=n=>g.page=n),"page-size":g.size,"onUpdate:pageSize":e[9]||(e[9]=n=>g.size=n),total:d.value,pageSizeOptions:["10","20","50"],"show-size-changer":"",onChange:K},null,8,["current","page-size","total"])])],64))])]),_:1},8,["open"])])}}},yt=pe(ft,[["__scopeId","data-v-5c8311f5"]]);export{We as C,yt as a};
