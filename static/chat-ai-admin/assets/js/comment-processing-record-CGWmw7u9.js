import{a2 as F}from"./index-CfeGYFjs.js";import{b as O}from"../../index-CuFGOJXl.js";import{u as V,a6 as j,x as L,v as U,p as W}from"./ui-antd-BKjlZQNA.js";import{r as S,f as N,o as H,Y as o,a5 as d,k as w,a2 as m,_ as n,F as C,a9 as T,a1 as h,G as B,a7 as i,ae as g,ad as b}from"./vue-chunks-yZ4gwLzA.js";import"./utils-smNh_pj2.js";const Y={class:"comment-record-page"},q={class:"toolbar"},A={class:"table-box"},G={key:0},P={key:1},J={key:4,class:"ellipsis1"},K={key:5,class:"rule-tags"},Q={key:0},X={style:{cursor:"pointer"}},Z={key:6},tt={__name:"comment-processing-record",setup(et){const r=S({check_result:void 0,comment_text:""}),y=S({}),z=N([]),f=N(!1),_=S({page:1,size:10,total:0}),M=[{title:"评论内容",dataIndex:"content_text",key:"content_text",width:220},{title:"处理结果",dataIndex:"ai_comment_result_text",key:"ai_comment_result_text",width:130},{title:"回复内容",dataIndex:"reply_comment_text",key:"reply_comment_text",width:220},{title:"群发/文章",dataIndex:"draft_title",key:"draft_title",width:120},{title:"触发规则",dataIndex:"rule_name",key:"rule_name",width:120},{title:"触发规则明细",dataIndex:"ai_comment_rule_text",key:"ai_comment_rule_text",width:300},{title:"处理时间",dataIndex:"ai_exec_time",key:"ai_exec_time",width:120}],k=()=>{f.value=!0;const s={page:_.page,size:_.size};r.check_result&&(s.check_result=r.check_result),r.comment_text&&(s.comment_text=r.comment_text),F(s).then(e=>{const p=(e==null?void 0:e.data)||{list:[],total:0,type:{}};z.value=p.list||[],_.total=+p.total||0;const u=p.type||{};Object.keys(y).forEach(c=>delete y[c]),Object.entries(u).forEach(([c,l])=>{y[c]=l})}).finally(()=>{f.value=!1})},I=()=>{_.page=1,k()},D=s=>{_.page=s.current,_.size=s.pageSize,k()},E=s=>{try{const e=new Date(Number(s)*1e3),p=String(e.getFullYear()).slice(2),u=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),x=String(e.getMinutes()).padStart(2,"0");return`${p}-${u}-${c} ${l}:${x}`}catch{return""}};function v(s,e){if(!s)return null;const u=document.createElement("canvas").getContext("2d");u.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const c=u.measureText(s).width,l=document.querySelector(`.titleRef_${e.create_time}`);l&&(e.title_width=l.offsetWidth);const x=(e==null?void 0:e.title_width)||250;return c>x?s:null}return H(()=>{k()}),(s,e)=>{const p=U,u=V,c=j,l=W,x=L;return n(),o("div",Y,[d("div",q,[w(u,{value:r.check_result,"onUpdate:value":e[0]||(e[0]=a=>r.check_result=a),allowClear:"",placeholder:"处理结果",style:{width:"160px"},onChange:I},{default:m(()=>[(n(!0),o(C,null,T(y,(a,t)=>(n(),h(p,{key:t,value:t},{default:m(()=>[B(i(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),w(c,{value:r.comment_text,"onUpdate:value":e[1]||(e[1]=a=>r.comment_text=a),allowClear:"",placeholder:"请输入评论关键词搜索",style:{width:"300px"},onSearch:I},null,8,["value"])]),d("div",A,[w(x,{columns:M,"data-source":z.value,loading:f.value,"row-key":"id",pagination:{current:_.page,pageSize:_.size,total:_.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:D},{headerCell:m(({column:a})=>[typeof a.title=="string"?(n(),o("span",G,i(a.title),1)):g("",!0)]),bodyCell:m(({column:a,record:t})=>[a.key==="content_text"?(n(),h(l,{key:0,title:v(t.content_text,t),placement:"top"},{default:m(()=>[d("div",{class:b(["ellipsis1 title",`titleRef_${t.create_time}`])},i(t.content_text),3)]),_:2},1032,["title"])):a.key==="ai_comment_result_text"?(n(),o("span",P,i(t.ai_comment_result_text),1)):a.key==="reply_comment_text"?(n(),h(l,{key:2,title:v(t.reply_comment_text,t),placement:"top"},{default:m(()=>[d("div",{class:b(["ellipsis1 title",`titleRef_${t.create_time}`])},i(t.reply_comment_text),3)]),_:2},1032,["title"])):a.key==="draft_title"?(n(),h(l,{key:3,title:v(t.draft_title,t),placement:"top"},{default:m(()=>[d("div",{class:b(["ellipsis1 title",`titleRef_${t.create_time}`])},i(t.draft_title),3)]),_:2},1032,["title"])):a.key==="rule_name"?(n(),o("span",J,i(t.rule_name),1)):a.key==="ai_comment_rule_text"?(n(),o("div",K,[(n(!0),o(C,null,T((t.ai_comment_rule_text||[]).slice(0,3),($,R)=>(n(),o(C,{key:$+R},[d("span",null,i($),1),R<(t.ai_comment_rule_text||[]).length-1?(n(),o("span",Q,", ")):g("",!0)],64))),128)),(t.ai_comment_rule_text||[]).length>3?(n(),h(l,{key:0},{title:m(()=>[B(i((t.ai_comment_rule_text||[]).join("，")),1)]),default:m(()=>[d("span",X,"...+"+i((t.ai_comment_rule_text||[]).length-3),1)]),_:2},1024)):g("",!0)])):a.key==="ai_exec_time"?(n(),o("span",Z,i(E(t.ai_exec_time)),1)):g("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},ot=O(tt,[["__scopeId","data-v-97e051f7"]]);export{ot as default};
