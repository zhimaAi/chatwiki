import{h as re}from"./index-BfxXXGE8.js";import{c as ne,l as le,u as se,v as ue}from"./index-jmRHMddk.js";import{d as v,w as ie,N as T,O as p,j as _,U as d,Y as N,S as w,X as h,u as L,z as V,b as W,q as pe,a6 as z,W as S,a1 as de,Z as _e,_ as ve,F as ce,k as me,a2 as fe,a3 as be}from"./vue-chunks-BRsu9_To.js";import{b as $,W as ge,M as P,k as O,bs as ye,ay as he,az as ke}from"../../index-CzPebXix.js";import{F as j,_ as we}from"./index-BgVvqN-n.js";import{P as xe}from"./PlusOutlined-BlmIiILr.js";import{_ as Le}from"./index-7Ecr060x.js";import{u as Ae}from"./robot-CF9aQwVH.js";import"./index-BFhVTGQQ.js";import{I as E}from"./Input-DFtZp9vk.js";import{S as Ce,a as Ie}from"./index-6HDf6TPN.js";import{_ as Oe}from"./TextArea-DrgXbuSS.js";const Re={class:"avatar-uploader"},Ue=["src"],Fe={key:1},Me=["src"],Se={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(R,{emit:U}){function A(t){return new Promise((y,I)=>{const u=new FileReader;u.readAsDataURL(t),u.onload=()=>y(u.result),u.onerror=M=>I(M)})}const c=U,b=R,l=v([]),i=v(!1),g=v("");ie(()=>b.value,t=>{g.value=t},{immediate:!0});const F=j.useInjectFormItemContext(),a=()=>{let t={imageUrl:g.value,file:l.value[0].originFileObj};c("change",t),c("update:value",t.imageUrl),F.onFieldChange()},s=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(l.value=[t],A(t).then(u=>{g.value=u,i.value=!1,a()}),!1):(O.error("机器人头像图片大小不能超过100kb"),!1):(O.error("机器人头像只支持JPG、PNG格式的图片"),!1),m=v(!1),x=v(""),e=v(""),B=()=>{m.value=!1,e.value=""},C=async t=>{!t.url&&!t.preview&&(t.preview=await A(t.originFileObj)),x.value=t.url||t.preview,m.value=!0,e.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,y)=>{const I=Le,u=P;return p(),T("div",Re,[_(I,{"file-list":l.value,"onUpdate:fileList":y[0]||(y[0]=M=>l.value=M),"list-type":b.listType,"show-upload-list":!1,"before-upload":s,accept:".jpg,.png,.jpeg",onPreview:C,style:N(b.style)},{default:d(()=>[R.value?(p(),T("img",{key:0,class:"avatar",style:N(b.style),src:R.value,alt:"avatar"},null,12,Ue)):(p(),T("div",Fe,[i.value?(p(),w(L(ge),{key:0})):(p(),w(L(xe),{key:1})),y[1]||(y[1]=h("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),_(u,{open:m.value,title:e.value,footer:null,onCancel:B},{default:d(()=>[h("img",{alt:"example",style:{width:"100%"},src:x.value},null,8,Me)]),_:1},8,["open","title"])])}}},D=$(Se,[["__scopeId","data-v-34012a20"]]),Te={class:"form-box"},Pe={class:"robot-avatar-box"},Be={__name:"add-robot-alert",emits:["addRobot","editRobot"],setup(R,{expose:U,emit:A}){const c=Ae(),b=A;let l="";const i=be(),g=fe(),F=j.useForm,a=v(!1),s=v(!1),m=v(!1),x=v([]),e=V({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),B=W(()=>e.application_type==0?a.value?"编辑机器人基本信息":"新建聊天机器人":a.value?"编辑工作流基本信息":"新建工作流"),C=W(()=>c.robotInfo),{getRobot:t}=c,y=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:I,validateInfos:u,clearValidate:M}=F(e,y),G=r=>{e.robot_avatar=r.file},H=()=>{let r={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||l,group_id:e.group_id||"0"};m.value=!0;let o=le,f="机器人创建成功";a.value&&(o=se,r.id=i.query.id,f="机器人编辑成功",r.robot_avatar==l&&delete r.robot_avatar),o(r,e.application_type).then(k=>{if(m.value=!1,k.res!=0)return O.error(k.msg);if(O.success(f),!a.value&&i.query.robot_key){b("addRobot"),s.value=!1;return}a.value?(t(i.query.id),b("editRobot"),s.value=!1):e.application_type==0?g.push("/robot/config/basic-config?id="+k.data.id+"&robot_key="+k.data.robot_key):g.push("/robot/config/workflow?id="+k.data.id+"&robot_key="+k.data.robot_key)}).catch(()=>{m.value=!1})},J=async()=>{let r=await re({model_type:"LLM"});return!r||r.data.length==0?(P.confirm({title:"请先添加LLM模型服务商?",icon:me(ye,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){g.push("/user/model")},onCancel(){}}),!1):!0},K=async(r,o)=>{r==0?l=he:l=ke,a.value=o;let f=await J();X(),f&&(e.robot_avatar="",e.robot_avatar_url=l,e.robot_name="",e.robot_intro="",e.application_type=r,s.value=!0,a.value&&C.value&&(e.robot_name=C.value.robot_name,e.robot_intro=C.value.robot_intro,e.robot_avatar_url=C.value.robot_avatar_url))},Z=r=>{e.group_id=r||"0"},X=()=>{ne().then(r=>{x.value=r.data||[]})},Y=()=>{M()},Q=()=>{I().then(()=>{H()}).catch(r=>{})};return pe(()=>{}),U({open:K,setGroupId:Z}),(r,o)=>{const f=we,k=E,ee=Ie,te=Ce,q=Oe,oe=j,ae=P;return p(),w(ae,{width:a.value?"472px":"746px",open:s.value,"onUpdate:open":o[6]||(o[6]=n=>s.value=n),confirmLoading:m.value,title:B.value,onOk:Q,onCancel:Y},{default:d(()=>[h("div",Te,[_(oe,{layout:"vertical"},{default:d(()=>[a.value?(p(),w(f,S({key:0,ref:"name",label:""},L(u).robot_avatar_url),{default:d(()=>[h("div",Pe,[_(D,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":o[0]||(o[0]=n=>e.robot_avatar_url=n),onChange:G},null,8,["value"]),o[7]||(o[7]=h("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):z("",!0),_(f,S({ref:"name",label:"应用名称"},L(u).robot_name),{default:d(()=>[_(k,{value:e.robot_name,"onUpdate:value":o[1]||(o[1]=n=>e.robot_name=n),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),_(f,S({ref:"group_id",label:"分组"},L(u).group_id),{default:d(()=>[_(te,{value:e.group_id,"onUpdate:value":o[2]||(o[2]=n=>e.group_id=n),style:{width:"100%"},placeholder:"请选择分组"},{default:d(()=>[(p(!0),T(ce,null,de(x.value,n=>(p(),w(ee,{value:n.id},{default:d(()=>[_e(ve(n.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},16),_(f,S({label:"简介"},L(u).robot_intro),{default:d(()=>[a.value?(p(),w(q,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":o[4]||(o[4]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(p(),w(q,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":o[3]||(o[3]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),a.value?z("",!0):(p(),w(f,S({key:1,ref:"name",label:"机器人头像"},L(u).robot_avatar_url),{default:d(()=>[_(D,{value:e.robot_avatar_url,"onUpdate:value":o[5]||(o[5]=n=>e.robot_avatar_url=n),onChange:G},null,8,["value"]),o[8]||(o[8]=h("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1,__:[8]},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},Ye=$(Be,[["__scopeId","data-v-e5327864"]]),Ve={class:"form-item"},je={class:"form-content"},$e={__name:"add-group",emits:["ok"],setup(R,{expose:U,emit:A}){const c=v(!1),b=A,l=v("新建分组"),i=V({group_name:"",id:""}),g=a=>{i.group_name=a.group_name||"",i.id=a.id||"",l.value=a.id?"编辑分组":"新建分组",c.value=!0},F=()=>{if(!i.group_name)return O.error("请输入分组名称");ue({...i}).then(a=>{O.success(`${l.value}成功`),c.value=!1,b("ok")})};return U({show:g}),(a,s)=>{const m=E,x=P;return p(),T("div",null,[_(x,{open:c.value,"onUpdate:open":s[1]||(s[1]=e=>c.value=e),title:l.value,onOk:F,zIndex:2e3},{default:d(()=>[h("div",Ve,[s[2]||(s[2]=h("div",{class:"form-label"},"分组名称：",-1)),h("div",je,[_(m,{maxLength:15,value:i.group_name,"onUpdate:value":s[0]||(s[0]=e=>i.group_name=e),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Qe=$($e,[["__scopeId","data-v-0d119043"]]);export{Ye as A,Qe as a};
