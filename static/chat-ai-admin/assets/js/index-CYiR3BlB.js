import{_ as _t}from"./cu-scroll-CpIj948h.js";import{ah as st,r as x,V as ut,a as d,b as c,y as i,t as r,v as _,u as e,p as l,q as N,z as Y,F as z,l as Q,_ as f,e as w,n as U,Y as W,E as dt}from"./vue-chunks-BdaA73Wf.js";import{u as at,b0 as pt,aB as vt,a_ as mt,aD as gt,bJ as X,aK as ht}from"../../index-DSFcP5NQ.js";import{C as ft,S as yt}from"./classification-mark-modal-hssoOOCi.js";import{c as Z,E as bt}from"./edit-subsection-BwSyKVRx.js";import{_ as nt}from"./emoji-mart-BBMRoEa3.js";import{w as xt,b5 as kt,ad as Ct,q as St,aO as qt,ag as Lt,av as wt,b0 as G,b1 as tt,i as Ot,f as Mt,g as Et,ah as $t,au as It,a6 as Dt,x as Pt,b as ot,M as et,O as Nt,b9 as zt,u as Bt,v as Ft,B as Rt}from"./ui-antd-Dl1wwwCD.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./index-XVLbk3qE.js";import"./index-B_UHbFfL.js";import"./model-select-CMPvMrAQ.js";import"./index-MT9fcN3v.js";import"./editor-code-DlsHKXTn.js";const Jt={class:"subsection-box"},Vt=["onClick"],Ht={key:1,class:"file-name-text",style:{color:"#f40"}},Qt={key:2,class:"qa-list-box"},Tt={class:"list-item"},jt={class:"list-label"},At={class:"list-content"},Ut={key:0,class:"list-item"},Gt={class:"list-label"},Kt={class:"list-content"},Yt={class:"list-item"},Wt={class:"list-label"},Xt={class:"list-content"},Zt={class:"fragment-img"},te=["src"],ee={key:3,class:"common-list-box"},se={class:"top-block"},ae={class:"title"},ne={class:"title"},oe=["innerHTML"],ie={class:"fragment-img"},le=["src"],ce={key:0,class:"status-tag"},re={key:1,class:"status-tag complete"},_e={class:"status-tag status-error"},ue={key:3,class:"status-tag running"},de={class:"right-opration"},pe={key:0,class:"hover-btn-box"},ve={class:"hover-btn-box"},me=["onClick"],ge=["onClick"],he={class:"hover-btn-box"},fe=["onClick"],ye=["onClick"],be={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(I,{expose:m,emit:K}){const{t:o}=at("views.library.library-details.categary-manage.components.subsection-box"),B=K,F=I,v=st().query,y=(u,g)=>{let{id:h,title:S,content:H,question:P,answer:q,images:M,category_id:E,library_id:$}=u,L=u.similar_questions||[];et.confirm({title:o("modal_re_convert_title"),icon:null,content:o("modal_re_convert_content",{index:g+1}),onOk(){return new Promise((t,a)=>{mt({id:h,library_id:$,title:S,content:H,question:P,answer:q,images:M,category_id:E,similar_questions:JSON.stringify(L)}).then(s=>{B("handleConvert",u),t()}).catch(()=>{t()})})},onCancel(){}})},R=u=>{B("openEditSubscription",u)},J=u=>{et.confirm({title:o("modal_tip_title"),icon:i(Nt),content:o("modal_tip_content"),onOk(){C(u,{})},onCancel(){}})},b=x([]),D=()=>{pt({library_id:v.id}).then(u=>{b.value=u.data||[],B("getStatrList",u.data||[])})};D();const k=x(null),O=()=>{k.value.show()},V=u=>{var h;let g=(h=b.value.filter(S=>S.id==u.category_id)[0])==null?void 0:h.type;return g?Z[g]:"#F59A23"},C=(u,g={})=>{vt({id:u.id,category_id:g.id||0}).then(h=>{ot.success(o("msg_modify_success")),g.id?u.category_id=g.id:B("handleDelParagraph",u.id),D()})},j=u=>{window.open(`/#/library/preview?id=${u.file_id}`)};return m({handleOpenEditModal:R}),(u,g)=>{const h=xt,S=St,H=Lt,P=wt,q=Et,M=Mt,E=Ot,$=Pt,L=ut("viewer");return c(),d("div",Jt,[i($,{"data-source":I.paragraphLists,pagination:!1},{default:r(()=>[i(h,{key:"id","data-index":"id",width:1148},{title:r(()=>[I.isQaLibray?(c(),d(z,{key:0},[f(_(e(o)("title_qa",{total:F.total})),1)],64)):(c(),d(z,{key:1},[f(_(e(o)("title_segment",{total:F.total})),1)],64))]),default:r(({record:t,index:a})=>[t.file_name?(c(),d("a",{key:0,class:"file-name-text",onClick:s=>j(t)},_(t.file_name),9,Vt)):(c(),d("div",Ht,_(e(o)("text_file_deleted")),1)),I.isQaLibray?(c(),d("div",Qt,[l("div",Tt,[l("div",jt,_(e(o)("label_question")),1),l("div",At,_(t.question),1)]),t.similar_questions&&t.similar_questions.length?(c(),d("div",Ut,[l("div",Gt,_(e(o)("label_similar_questions")),1),l("div",Kt,_(t.similar_questions.join("/")),1)])):N("",!0),l("div",Yt,[l("div",Wt,_(e(o)("label_answer")),1),l("div",Xt,_(t.answer),1)]),Y((c(),d("div",Zt,[(c(!0),d(z,null,Q(t.images,(s,p)=>(c(),d("img",{key:p,src:s,alt:""},null,8,te))),128))])),[[L]])])):(c(),d("div",ee,[l("div",se,[l("div",ae,_(e(o)("text_segment_index",{index:a+1})),1),l("div",ne,_(t.title),1),l("span",null,_(e(o)("text_total_chars",{count:t.word_total})),1)]),l("div",{class:"content-box",innerHTML:t.content},null,8,oe),Y((c(),d("div",ie,[(c(!0),d(z,null,Q(t.images,(s,p)=>(c(),d("img",{key:p,src:s,alt:""},null,8,le))),128))])),[[L]])]))]),_:1}),i(h,{title:e(o)("column_embedding_status"),key:"status_text","data-index":"status_text",width:168},{default:r(({record:t})=>[t.status==0?(c(),d("span",ce,[i(e(kt)),f(" "+_(e(o)("status_unconverted")),1)])):N("",!0),t.status==1?(c(),d("span",re,[i(e(Ct)),f(" "+_(e(o)("status_converted")),1)])):N("",!0),t.status==2?(c(),w(S,{key:2,placement:"top"},{title:r(()=>[l("span",null,_(t.errmsg),1)]),default:r(()=>[l("span",null,[l("span",_e,[i(e(qt)),f(" "+_(e(o)("status_error")),1)])])]),_:2},1024)):N("",!0),t.status==3?(c(),d("span",ue,[i(H,{size:"small"}),f(" "+_(e(o)("status_converting")),1)])):N("",!0)]),_:1},8,["title"]),i(h,{title:e(o)("column_action"),key:"action","data-index":"action",width:120},{default:r(({record:t,index:a})=>[l("div",de,[I.isQaLibray?(c(),d("div",pe,[t.category_id>0?(c(),w(P,{key:0,title:e(o)("confirm_cancel_tag"),"ok-text":e(o)("btn_confirm"),"cancel-text":e(o)("btn_cancel"),onConfirm:s=>C(t,{})},{default:r(()=>[i(e(G),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])):(c(),w(e(tt),{key:1,onClick:s=>C(t,b.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])):(c(),w(E,{key:1},{overlay:r(()=>[i(M,null,{default:r(()=>[(c(!0),d(z,null,Q(b.value,s=>(c(),w(q,{key:s.id},{default:r(()=>[l("div",{class:"start-item",onClick:p=>C(t,s)},[i(e(G),{style:U({color:e(Z)[s.type]})},null,8,["style"]),l("div",null,_(s.name||"-"),1)],8,me)]),_:2},1024))),128)),i(q,null,{default:r(()=>[l("div",{class:"start-item",onClick:O},[i(e($t)),l("div",null,_(e(o)("menu_tag_settings")),1)])]),_:1})]),_:2},1024)]),default:r(()=>[l("div",ve,[t.category_id>0?(c(),w(P,{key:0,title:e(o)("confirm_cancel_tag"),"ok-text":e(o)("btn_confirm"),"cancel-text":e(o)("btn_cancel"),onConfirm:s=>C(t,{})},{default:r(()=>[i(e(G),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])):(c(),w(e(tt),{key:1,onClick:s=>C(t,b.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024)),i(S,null,{title:r(()=>[f(_(e(o)("tooltip_re_convert")),1)]),default:r(()=>[l("div",{class:"hover-btn-box",onClick:s=>y(t,a)},[i(e(It))],8,ge)]),_:2},1024),i(E,{placement:"bottomRight"},{overlay:r(()=>[i(M,null,{default:r(()=>[i(q,null,{default:r(()=>[l("div",{onClick:W(s=>R(t),["stop"])},_(e(o)("menu_edit")),9,fe)]),_:2},1024),i(q,null,{default:r(()=>[l("div",{onClick:W(s=>J(t),["stop"])},_(e(o)("menu_delete")),9,ye)]),_:2},1024)]),_:2},1024)]),default:r(()=>[l("div",he,[i(e(Dt))])]),_:2},1024)])]),_:1},8,["title"])]),_:1},8,["data-source"]),i(ft,{onOk:D,ref_key:"classificationMarkModalRef",ref:k},null,512)])}}},xe=nt(be,[["__scopeId","data-v-c98a5b68"]]),ke={class:"robot-page"},Ce={class:"search-content-block"},Se={class:"selct-star-box"},qe={class:"scroll-box"},Le={class:"content-block"},we={__name:"index",setup(I){const{t:m}=at("views.library.library-details.categary-manage.index"),o=gt().type,F=st().query,T=x([]),v=x([]),y=x(0),R={0:m("status_graph_pending"),4:m("status_graph_generating"),2:m("status_graph_success"),3:m("status_graph_failed")},J={0:m("status_convert_unconverted"),1:m("status_convert_converted"),2:m("status_convert_error"),3:m("status_convert_converting")},b=x({}),D=a=>{T.value=a},k=x({page:1,size:30}),O=dt({status:-1,category_id:-1,library_id:F.id}),V=()=>{k.value.page=1,y.value=0,v.value=[],t()},C=a=>{O.category_id=a,V()},j=()=>{ht({id:F.id}).then(()=>ot.success(m("msg_operation_complete")))},u=x(null),g=a=>{u.value.showModal(JSON.parse(JSON.stringify(a)))},h=a=>{if(!a.id){k.value.page=1,t();return}let s=v.value,p=s.findIndex(n=>n.id==a.id);if(p>-1){let n=s[p];n.title=a.title,n.content=a.content,n.question=a.question,n.answer=a.answer,n.answer=a.answer,n.images=a.images,n.category_id=a.category_id,n.word_total=a.question.length+a.answer.length+a.content.length,n.similar_questions=JSON.parse(a.similar_questions),s.splice(p,1,n),v.value=s}},S=a=>{let s=v.value,p=s.findIndex(n=>n.id==a);p>-1&&(s.splice(p,1),v.value=s,y.value=--y.value,y.value)},H=()=>{L.value||v.value.length>=y.value||P()},P=()=>{k.value.page++,t()},q=()=>{E()};function M(){clearInterval($),v.value.filter(s=>s.status==3).length?$=setInterval(()=>{E()},5e3):clearInterval($)}const E=()=>{X({page:1,size:v.value.length,...O}).then(a=>{let p=a.data.list||[];p.forEach(n=>{n.status_text=J[n.status],n.graph_status_text=R[n.graph_status],n.similar_questions&&(n.similar_questions=JSON.parse(n.similar_questions))}),v.value=p,M()})};let $=null;const L=x(!1),t=()=>{L.value=!0,X({...k.value,...O}).then(a=>{L.value=!1;let s=a.data,p=s.list||[];s.info&&(b.value={...s.info,library_id:s.info.id,is_qa_doc:s.info.type==2?1:0}),p.forEach(n=>{n.status_text=J[n.status],n.graph_status_text=R[n.graph_status],n.similar_questions&&(n.similar_questions=JSON.parse(n.similar_questions))}),k.value.page==1&&(v.value=[]),v.value=[...v.value,...p],y.value=s.total,M()})};return t(),(a,s)=>{const p=Ft,n=Bt,it=Rt,lt=zt,ct=_t;return c(),d("div",ke,[l("div",Ce,[l("div",Se,[e(o)==0?(c(),w(yt,{key:0,hideId:[0],startLists:T.value,onChange:C},null,8,["startLists"])):N("",!0)]),i(lt,null,{default:r(()=>[i(n,{value:O.status,"onUpdate:value":s[0]||(s[0]=A=>O.status=A),placeholder:e(m)("ph_select"),style:{width:"160px"},onChange:V},{default:r(()=>[i(p,{value:-1},{default:r(()=>[f(_(e(m)("option_all_status")),1)]),_:1}),(c(),d(z,null,Q(J,(A,rt)=>i(p,{value:rt},{default:r(()=>[f(_(A),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"]),i(it,{onClick:j},{default:r(()=>[f(_(e(m)("btn_re_embedding")),1)]),_:1})]),_:1})]),l("div",qe,[i(ct,{scrollbar:{minSize:0},onOnScrollEnd:H},{default:r(()=>[l("div",Le,[i(xe,{ref:"subsectionBoxRef",isQaLibray:b.value.is_qa_doc,total:y.value,paragraphLists:v.value,onOpenEditSubscription:g,onHandleDelParagraph:S,onHandleConvert:q,onGetStatrList:D},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),i(bt,{detailsInfo:b.value,onHandleEdit:h,onHandleStatrList:D,ref_key:"editSubscriptionRef",ref:u},null,8,["detailsInfo"])])}}},Ge=nt(we,[["__scopeId","data-v-9de07fbe"]]);export{Ge as default};
//# sourceMappingURL=index-CYiR3BlB.js.map
