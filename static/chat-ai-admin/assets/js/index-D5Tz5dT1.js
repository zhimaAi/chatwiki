import{ac as v,ad as _,as as e,k as s,az as R,G as S,at as E,ak as be,ae as N,ar as l,ah as Te,ai as ae,f as L,c as H,r as B,e as G,n as ue,A as pe,u as C,J as Z,aw as je,F as M,ax as K,aA as bt,E as yt,w as le,l as Ye,h as qe,aE as de,aF as fe,af as et,o as ye,b as gt,B as kt,y as tt,aC as wt,aB as xt,p as $t}from"./vue-chunks-CGLjTDrY.js";import{_ as T,d as ie,a3 as Ct,X as St,$ as qt,ag as Lt,a as It,A as Rt,aa as Ue,c as Ut,af as Et}from"../../index-CB2DywzJ.js";import{B as te,T as we,I as me,$ as xe,an as He,a5 as Ot,as as Vt,al as ot,M as Y,b as F,F as Ee,e as ze,y as Oe,z as Ve,a4 as st,a3 as nt,aG as Pt,v as ne,aH as At,Q as oe,at as ge,a6 as Pe,D as it,av as Nt,aj as Dt,ak as Mt,w as Be,x as Je,ah as Q,aI as lt,O as $e,o as Tt,R as jt,N as zt,V as at,af as rt,J as Bt,W as Se,a1 as Jt,U as Xe,ae as Kt,j as Me,ag as Ft,G as Wt,ao as Qt,aJ as Gt,h as Ht,i as Xt,k as Zt}from"./ui-antd-BHaxN-GS.js";import{C as Yt}from"./cu-upload-CEbua_QF.js";import{u as Ae}from"./robot-BQqgDPGj.js";import{u as eo,v as to,w as oo,x as so,y as no,g as io,z as lo}from"./index-CoChppVN.js";import{_ as ao,a as ro,M as co}from"./meta-filter-box-BegWyvZa.js";import{g as dt,M as Ke,u as _o}from"./model-select-h2ELC74y.js";import{L as uo}from"./library-select-alert-RX0zb24j.js";import{_ as po}from"./recommendation-AQ4_FPQ9.js";import{W as mo}from"./index-BWRAgLeG.js";import{_ as ct}from"./cu-scroll-D9utH_KS.js";import{a as ho}from"./index-CtAQivSJ.js";import{g as _t}from"./index-D_MN-GJN.js";import{_ as vo}from"./empty-CzGZrENG.js";import{d as Ne}from"./vuedraggable.umd-B2hsG2dX.js";import{_ as fo}from"./empty-BFmzY9bl.js";import{i as bo,e as yo,f as go}from"./index-DNhlFGD2.js";import{A as ko}from"./add-collaborator-DBHQY-LF.js";import{R as wo}from"./robot-select-alert-DtQw71Xu.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";import"./index-BcMVDew1.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-Bj6uRJ-9.js";const xo={class:"edit-box-header"},$o={class:"left-box"},Co={class:"edit-box-title"},So={key:0},qo={key:0,class:"title-tip"},Lo={class:"right-box"},Io={class:"extra-box"},Ro={class:"actions-box"},Uo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(m,{emit:a}){const d=a,n=m,r=t=>{d("edit"),d("update:isEdit",t)},o=()=>{d("save")};return(t,h)=>{const y=ie,x=te,f=we;return _(),v("div",{class:ae(["edit-box",{"is-edit":m.isEdit}])},[e("div",xo,[e("div",$o,[s(y,{class:"edit-box-icon",name:n.iconName},null,8,["name"]),e("span",Co,[S(E(n.title)+" ",1),t.$slots.icon?(_(),v("span",So,[be(t.$slots,"icon",{},void 0,!0)])):R("",!0)]),t.$slots.tip?(_(),v("span",qo,[be(t.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",Lo,[e("div",Io,[be(t.$slots,"extra",{},()=>[e("div",Ro,[n.isEdit?(_(),N(f,{key:0,gap:8},{default:l(()=>[s(x,{onClick:o,size:"small",type:"primary"},{default:l(()=>[...h[2]||(h[2]=[S("保存",-1)])]),_:1}),s(x,{onClick:h[0]||(h[0]=U=>r(!1)),size:"small"},{default:l(()=>[...h[3]||(h[3]=[S("取消",-1)])]),_:1})]),_:1})):(_(),N(x,{key:1,onClick:h[1]||(h[1]=U=>r(!0)),size:"small"},{default:l(()=>[...h[4]||(h[4]=[S("修改",-1)])]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:Te({...m.bodyStyle})},[be(t.$slots,"default",{},void 0,!0)],4)],2)}}},X=T(Uo,[["__scopeId","data-v-1b63f826"]]),Eo={class:"robot-form-box"},Oo={class:"form-item"},Vo={class:"form-item-body robot-name-item"},Po={class:"robot-avetar-upload"},Ao=["src"],No={class:"robot-name-box"},Do={class:"form-item"},Mo={class:"form-item-body"},To={class:"robot-info-box"},jo={class:"robot-name-box"},zo=["src"],Bo={class:"robot-name"},Jo={class:"robot-intro"},Ko={__name:"basic-config",setup(m){const a=Ae(),d=L(!1),{robotInfo:n,updateRobotInfo:r}=H("robotInfo"),o=B({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),t=G(()=>a.robotList||[]),h=G(()=>a.robotGroupList||[]),y=G(()=>{let g="未分组",c=t.value.find(w=>w.id==n.id)||{};if(c.group_id>0){let w=h.value.find(u=>u.id==c.group_id);w&&(g=w.group_name)}return g}),x=()=>{r({...Z(o)}),d.value=!1},f=g=>{let c=g[0];return o.robot_avatar=c,Ct(c).then(w=>{o.robot_avatar_url=w}),!1},U=()=>{o.robot_name=n.robot_name,o.robot_intro=n.robot_intro,o.robot_avatar=n.robot_avatar,o.robot_avatar_url=n.robot_avatar_url};return(g,c)=>{const w=me,u=xe;return _(),N(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:d.value,"onUpdate:isEdit":c[2]||(c[2]=b=>d.value=b),onSave:x,onEdit:U},{default:l(()=>[ue(e("div",Eo,[e("div",Oo,[c[3]||(c[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",Vo,[s(Yt,{accept:"image/*",onChange:f},{default:l(()=>[e("div",Po,[o.robot_avatar_url?(_(),v("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,Ao)):R("",!0)])]),_:1}),e("div",No,[s(w,{value:o.robot_name,"onUpdate:value":c[0]||(c[0]=b=>o.robot_name=b),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Do,[c[4]||(c[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",Mo,[s(u,{rows:3,value:o.robot_intro,"onUpdate:value":c[1]||(c[1]=b=>o.robot_intro=b),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[pe,d.value]]),ue(e("div",To,[e("div",jo,[e("img",{class:"robot-avatar",src:C(n).robot_avatar_url,alt:""},null,8,zo),e("span",Bo,E(C(n).robot_name),1)]),e("div",Jo,[e("span",null,"分组："+E(y.value),1),e("span",null,"简介："+E(C(n).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[pe,!d.value]])]),_:1},8,["isEdit"])}}},Fo=T(Ko,[["__scopeId","data-v-0adbabe6"]]),Wo={class:"ai-create-box"},Qo={class:"input-box"},Go={key:1},Ho={key:2},Xo={class:"quick-tags-box"},Zo={class:"ai-list-box"},Yo={key:0,class:"loading-box"},es={key:0,class:"prompt-list-box"},ts={class:"prompt-list"},os={class:"prompt-header"},ss={class:"prompt-title"},ns={class:"prompt-content"},is={class:"prompt-list"},ls={class:"prompt-header"},as={class:"prompt-title"},rs={class:"prompt-content"},ds={class:"prompt-list"},cs={class:"prompt-header"},_s={class:"prompt-title"},us={class:"prompt-content"},ps={class:"prompt-list"},ms={class:"prompt-header"},hs={class:"prompt-title"},vs={class:"prompt-content"},fs={class:"prompt-list"},bs={class:"prompt-header"},ys={class:"prompt-title"},gs={class:"prompt-content"},ks={class:"prompt-header"},ws={class:"prompt-title"},xs={class:"prompt-content"},$s={key:1,class:"empty-box"},Cs={__name:"ai-create-prompt",emits:["handleAiSave"],setup(m,{expose:a,emit:d}){const n=He.PRESENTED_IMAGE_SIMPLE,r=L(!1),o=L(!1),t=je().query,h=d,y=L(""),x=L(!1),f=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],U=L("在上方输入框输入要求，点击生成提示词"),g=()=>{c.value=!1,u.promptStruct=w,y.value="",U.value="在上方输入框输入要求，点击生成提示词",r.value=!0},c=L(!1),w={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},u=B({promptStruct:w}),b=q=>{y.value=q},i=()=>{if(!y.value)return F.error("请输入AI 生成提示词");if(x.value)return F.error("正在生成中...");x.value=!0,eo({id:t.id,demand:y.value}).then(q=>{u.promptStruct=JSON.parse(q.data.promptStruct),c.value=!0}).finally(()=>{x.value=!1}).catch(q=>{c.value=!1,U.value=q.msg})},p=()=>{if(!c.value)return F.error("请先生成提示词");h("handleAiSave",u.promptStruct),r.value=!1};return a({show:g}),(q,k)=>{const P=te,z=xe,V=ie,D=Vt,J=ot,ee=He,O=Y;return _(),v("div",null,[s(O,{open:r.value,"onUpdate:open":k[1]||(k[1]=I=>r.value=I),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:l(()=>[s(P,{type:"primary",loading:o.value,onClick:p},{default:l(()=>[...k[2]||(k[2]=[S("使用该提示",-1)])]),_:1},8,["loading"])]),default:l(()=>[e("div",Wo,[e("div",Qo,[s(z,{style:{width:"100%"},value:y.value,"onUpdate:value":k[0]||(k[0]=I=>y.value=I),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:ae(["btn-box",{"disabed-status":x.value}]),onClick:i},[x.value?(_(),N(C(Ot),{key:0})):R("",!0),s(V,{name:"ai-mark"}),x.value?(_(),v("span",Go,"生成中...")):(_(),v("span",Ho,"生成"))],2)]),e("div",Xo,[k[3]||(k[3]=e("div",{class:"quick-label"},"快捷生成：",-1)),(_(),v(M,null,K(f,I=>s(D,{key:I.title,onClick:se=>b(I.title),color:"blue"},{default:l(()=>[S(E(I.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Zo,[x.value?(_(),v("div",Yo,[s(J,{tip:"正在生成中..."})])):(_(),v(M,{key:1},[c.value?(_(),v("div",es,[e("div",ts,[e("div",os,[e("div",ss,E(u.promptStruct.role.subject),1)]),e("div",ns,E(u.promptStruct.role.describe),1)]),e("div",is,[e("div",ls,[e("div",as,E(u.promptStruct.task.subject),1)]),e("div",rs,E(u.promptStruct.task.describe),1)]),e("div",ds,[e("div",cs,[e("div",_s,E(u.promptStruct.constraints.subject),1)]),e("div",us,E(u.promptStruct.constraints.describe),1)]),e("div",ps,[e("div",ms,[e("div",hs,E(u.promptStruct.output.subject),1)]),e("div",vs,E(u.promptStruct.output.describe),1)]),e("div",fs,[e("div",bs,[e("div",ys,E(u.promptStruct.tone.subject),1)]),e("div",gs,E(u.promptStruct.tone.describe),1)]),(_(!0),v(M,null,K(u.promptStruct.custom,(I,se)=>(_(),v("div",{class:"prompt-list",key:se+I.key?I.key:""},[e("div",ks,[e("div",ws,E(I.subject),1)]),e("div",xs,E(I.describe),1)]))),128))])):(_(),v("div",$s,[s(ee,{image:C(n),description:U.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},Ss=T(Cs,[["__scopeId","data-v-1dd9dabe"]]),qs={__name:"upload-prompt",setup(m,{expose:a}){const d=L(!1),n=B({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),r=L(null),o=f=>{if(f.prompt_type==0&&!f.prompt)return F.error("自定义提示为空,无法上传");r.value&&r.value.resetFields();let U={...f};n.title="",n.group_id=0,n.prompt="",n.prompt_struct={},n.prompt_type=U.prompt_type,U.prompt_type==0?n.prompt=U.prompt:n.prompt_struct=JSON.stringify(U.prompt_struct),d.value=!0},t=L([]);(()=>{St().then(f=>{t.value=[{id:0,group_name:"默认分组"},...f.data]})})();const y=L(!1),x=()=>{r.value.validate().then(()=>{let f={...n};y.value=!0,qt({...f}).then(()=>{F.success("保存成功"),d.value=!1}).finally(()=>{y.value=!1})})};return a({show:o}),(f,U)=>{const g=me,c=ze,w=Ve,u=Oe,b=Ee,i=Y;return _(),v("div",null,[s(i,{open:d.value,"onUpdate:open":U[2]||(U[2]=p=>d.value=p),title:"保存到提示词库",width:580,onOk:x,confirmLoading:y.value},{default:l(()=>[s(b,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:r,model:n},{default:l(()=>[s(c,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:l(()=>[s(g,{value:n.title,"onUpdate:value":U[0]||(U[0]=p=>n.title=p),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),s(c,{name:"group_id",label:"分组"},{default:l(()=>[s(u,{value:n.group_id,"onUpdate:value":U[1]||(U[1]=p=>n.group_id=p),style:{width:"100%"}},{default:l(()=>[(_(!0),v(M,null,K(t.value,p=>(_(),N(w,{value:p.id},{default:l(()=>[S(E(p.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},Ls={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(m){m&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(m){const a=[],d=[],n=(r,o)=>{if(!r||r.length===0)return!1;for(let t=0;t<r.length;t++){const h=r[t],y=h[this.valueKey];if(y===m)return a[o]=h,d[o]=y,!0;if(h[this.childrenKey]&&h[this.childrenKey].length>0){if(a[o]=h,d[o]=y,n(h[this.childrenKey],o+1))return!0;a[o]=null,d[o]=null}}return!1};n(this.options,0),this.selectedPath=a.filter(r=>r),this.selectedValuePath=d.filter(r=>r!=null),this.updateActivePath()},findPathByValues(m){if(!m||m.length===0)return;const a=[];let d=this.options;for(let n=0;n<m.length;n++){const r=m[n],o=d.find(t=>t[this.valueKey]===r);if(o)a.push(o),d=o[this.childrenKey]||[];else break}this.selectedPath=a,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let m=0;m<this.selectedPath.length;m++){const a=this.selectedPath[m];a[this.childrenKey]&&a[this.childrenKey].length>0&&this.activePath.push({title:a[this.labelKey],options:a[this.childrenKey],level:m+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(m,a,d){this.hasChildren(m)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,a),this.selectedPath.push(m),this.selectedValuePath=this.selectedValuePath.slice(0,a),this.selectedValuePath.push(m[this.valueKey]),this.activePath=this.activePath.slice(0,a+1),this.hasChildren(m)&&this.activePath.push({title:m[this.labelKey],options:m[this.childrenKey],level:a+1}),this.$emit("select",m,this.selectedPath,a),this.selectedPath,(this.checkAnyLevel&&!this.isClickRight&&a>0||!this.hasChildren(m))&&(this.$emit("change",m[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:m[this.valueKey])),this.isClickRight=!1},isActive(m,a){return!this.selectedPath||this.selectedPath.length<=a?!1:m[this.valueKey]===this.selectedPath[a][this.valueKey]},hasChildren(m){return m[this.childrenKey]&&m[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const m=this.$el;if(!m)return;const a=m.getBoundingClientRect(),d=window.innerWidth,n=180;a.right+n>d&&a.left>n?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",n)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",n))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},Is={class:"cascade-panel"},Rs={class:"cascade-panel-body"},Us=["onClick"],Es={class:"item-content"},Os={class:"item-label"},Vs={key:0,class:"cascade-panel-empty"};function Ps(m,a,d,n,r,o){return _(),v("div",Is,[e("div",{class:ae(["cascade-panel-container",[`expand-direction-${r.expandDirection}`]])},[(_(!0),v(M,null,K(r.activePath,(t,h)=>(_(),v("div",{class:"cascade-panel-list",key:h},[e("div",Rs,[(_(!0),v(M,null,K(t.options,y=>(_(),v("div",{class:ae(["cascade-panel-item",{active:o.isActive(y,h)}]),key:y.value,onClick:x=>o.handleSelect(y,h,x)},[e("div",Es,[e("span",Os,E(y.label),1),o.hasChildren(y)?(_(),v("span",{key:0,class:"item-icon",onClick:a[0]||(a[0]=(...x)=>o.handleRightClick&&o.handleRightClick(...x))},[...a[1]||(a[1]=[e("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[e("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):R("",!0)])],10,Us))),128)),t.options&&t.options.length===0?(_(),v("div",Vs," 暂无数据 ")):R("",!0)])]))),128))],2)])}const As=T(Ls,[["render",Ps],["__scopeId","data-v-83ffe662"]]),ut=m=>{let a=[];return m.forEach(d=>{d.children&&d.children.length>0?a.push(...ut(d.children)):a.push(d)}),a},Ns={name:"JMention",components:{CascadePanel:As},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(m){return["input","textarea"].includes(m)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(m){m.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(m){this.onOpen(m)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(m){m.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(m){m.target.closest(".dropdown-list")&&m.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(m){this.$emit("open",m)},getText(m){const a=document.createElement("div");a.innerHTML=m;let d="";return Array.from(a.childNodes).forEach(n=>{let r="";this.type==="textarea"?n.nodeName==="BR"?r=`
`:n.classList&&n.classList.contains("j-mention-at")?r=n.dataset.value:r=n.textContent:n.classList&&n.classList.contains("j-mention-at")?r=n.dataset.value:n.nodeName==="BR"?r="":r=n.textContent.replace(/\n/g,""),(r==="&nbsp;"||r===" ")&&(r=""),d+=r}),d},onChange(){const m=this.$refs.JMention;if(!m)return;let a=m.innerHTML,d=this.getText(a);this.localValue=d;let n={};this.selectedList.forEach(o=>{!n[o.value]&&d.indexOf(o.value)!==-1&&(n[o.value]=o)});let r=Object.values(n);this.$emit("change",d.trim(),r)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const m=this.$refs.JMention;let a=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=this.defaultSelectedList||[],n=ut(this.options),r=[...d,...n].filter(t=>t&&t.value&&t.value!=""&&t.typ!=="node");const o=new Set;r.forEach(t=>{const h=new RegExp(`(${t.value})`,"g");h.test(this.defaultValue)&&!o.has(t.value)&&(a=a.replace(h,`<span class="j-mention-at" data-id="${t.id}" contentEditable="false" data-value="${t.value}">${t.label}</span>`),o.add(t.value),this.selectOption(t,!0))}),m.innerHTML=a,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(m=>this.atText?m.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(m.id+""))},getLastChar(m=1){const a=window.getSelection();if(a.rangeCount<=0)return;const d=a.getRangeAt(0),n=d.startOffset,r=d.startContainer;let o="";if(r.nodeType===Node.TEXT_NODE)o=r.textContent.slice(0,n);else if(r.nodeType===Node.ELEMENT_NODE){const t=r.childNodes;for(let h=0;h<t.length;h++){const y=t[h];y.nodeType===Node.TEXT_NODE&&(h===t.length-1?o+=y.textContent.slice(0,n):o+=y.textContent)}}return o.slice(-m)},getLastAtText(){const m=window.getSelection();if(m.rangeCount<=0)return;const a=m.getRangeAt(0),d=a.startOffset,n=a.startContainer;let r="";if(n.nodeType===Node.TEXT_NODE)r=n.textContent.slice(0,d);else if(n.nodeType===Node.ELEMENT_NODE){const t=n.childNodes;for(let h=0;h<t.length;h++){const y=t[h];y.nodeType===Node.TEXT_NODE&&(h===t.length-1?r+=y.textContent.slice(0,d):r+=y.textContent)}}const o=r.lastIndexOf("/");return o===-1?"":r.slice(o+1)},async getCaretPosition(){const m=window.getSelection();if(m.rangeCount<=0)return{top:0,left:0};const d=m.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize(),r=window.innerWidth,o=window.innerHeight;let t=d.bottom,h=d.left;return t+n.height>o&&(t=d.top-n.height),h+n.width>r&&(h=d.right-n.width),t<0&&(t=0),h<0&&(h=0),{top:t,left:h}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const m=this.$refs.dropdownList.offsetWidth,a=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:m,height:a}},updateSelectedList(){const a=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const d of a){let n=d.dataset.value;const r=this.options.find(o=>o.value==n);this.selectedList.push(r),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(a.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(m){return this.options.filter(d=>d.label.startsWith(m)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(m){this.handleDropdownLogic(m),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(m){const a=this.getLastChar();if(m.inputType==="deleteContentBackward"&&!this.atText)a!="/"&&(this.showDropdown=!1);else if(a==="/")this.showDropdown=!0,this.atText="";else{const r=this.getLastAtText();this.atText=r;const o=this.checkStartWith(r);r&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:d,left:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${n}px; top:${d}px;`},insertAtCaret(m,a){let d=this.atText.length+1;this.getLastChar(d)!=="/"+this.atText&&(d=0);const r=window.getSelection();if(r.rangeCount<=0)return;const o=r.getRangeAt(0),t=o.startOffset,h=o.startContainer;let y=t-d,x=h;if(y<0){let f=h.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){y=f.textContent.length-d,x=f;break}f=f.previousSibling}}if(x.nodeType===Node.TEXT_NODE){x.replaceData(y,d,"");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${m}`;for(const g in a)f.dataset[g]=a[g];const U=document.createRange();U.setStart(x,y),U.insertNode(f),o.setStartAfter(f),o.setEndAfter(f),r.removeAllRanges(),r.addRange(o)}},onSelectOption(m,a,d){let n=d[d.length-1];delete n.children,this.selectOption(n)},selectOption(m,a=!1){if(!m)return;this.showDropdown=!1;let d=m.label;const n={id:m.id,label:m.label,value:m.value,text:m.text,index:this.selectedList.length};this.selectedList.push(m),this.selectedIdSet.add(m.value),a||(this.insertAtCaret(d,n),this.initShowOptionList(),this.updateValue())},handleDirectionChange(m,a){const d=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),n=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!d||!n)return;const r=parseFloat(d[1]),o=parseFloat(n[1]);let t;m==="left"?t=r-a:t=r+a,this.positionStyle=`left:${t}px; top:${o}px;`}}},Ds={style:{width:"100%",position:"relative"}},Ms={class:"mention-input-warpper mention-promt-input",ref:"JMentionContainer"},Ts=["placeholder"],js={key:0,class:"placeholder"};function zs(m,a,d,n,r,o){const t=bt("CascadePanel");return _(),v("div",Ds,[a[4]||(a[4]=e("div",null,null,-1)),(_(),N(yt,{to:"body"},[r.showDropdown?(_(),v("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Te(r.positionStyle)},[s(t,{options:r.showOptions,checkAnyLevel:d.checkAnyLevel,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):R("",!0)])),e("div",Ms,[e("div",{ref:"JMention",style:Te([d.inputStyle]),class:ae(["j-mention",[{"show-placeholder":r.localValue.length==0},"type-"+d.type]]),contenteditable:"plaintext-only",placeholder:d.placeholder,onFocus:a[0]||(a[0]=(...h)=>o.onFocus&&o.onFocus(...h)),onInput:a[1]||(a[1]=(...h)=>o.debouncedUpdate&&o.debouncedUpdate(...h)),onClick:a[2]||(a[2]=(...h)=>o.clickJMention&&o.clickJMention(...h)),onBlur:a[3]||(a[3]=(...h)=>o.handleBlur&&o.handleBlur(...h))},null,46,Ts),r.localValue.length==0?(_(),v("span",js,E(d.placeholder),1)):R("",!0)],512)])}const Bs=T(Ns,[["render",zs],["__scopeId","data-v-e0c464c2"]]),Js={class:"prompt-box"},Ks={class:"tab-header"},Fs={key:0,class:"opt-block"},Ws={key:1,class:"opt-block"},Qs={class:"tip-text"},Gs={key:0,class:"prompt-list-box"},Hs={class:"prompt-list"},Xs={class:"prompt-header"},Zs={class:"prompt-title"},Ys={key:0,class:"btn-wrapper-box"},en={class:"prompt-content"},tn={class:"prompt-list"},on={class:"prompt-header"},sn={class:"prompt-title"},nn={key:0,class:"btn-wrapper-box"},ln={class:"prompt-content"},an={class:"prompt-list"},rn={class:"prompt-header"},dn={class:"prompt-title"},cn={key:0,class:"btn-wrapper-box"},_n={class:"prompt-content"},un={class:"prompt-list"},pn={class:"prompt-header"},mn={class:"prompt-title"},hn={key:0,class:"btn-wrapper-box"},vn={class:"prompt-content"},fn={class:"prompt-list"},bn={class:"prompt-header"},yn={class:"prompt-title"},gn={key:0,class:"btn-wrapper-box"},kn={class:"swich-item"},wn={class:"swich-item"},xn={class:"prompt-content"},$n={class:"prompt-list"},Cn={class:"prompt-header"},Sn={class:"prompt-title"},qn={key:0,class:"btn-wrapper-box"},Ln={class:"prompt-content"},In={class:"prompt-header"},Rn={class:"prompt-title",style:{flex:"1"}},Un={key:0,class:"btn-wrapper-box"},En=["onClick"],On={class:"prompt-content"},Vn={key:0,class:"add-theme-block"},Pn={class:"show-more-block"},An={class:"diy-switch-box"},Nn={class:"swich-item"},Dn={class:"swich-item"},Mn={class:"field-list-item"},Tn={class:"field-label"},jn={class:"field-type"},ce="- 请使用markdown格式回答问题。",_e="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",zn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(m){const a=Ae(),d=L(!1),{robotInfo:n,updateRobotInfo:r}=H("robotInfo"),o=m;let t={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const h=L({}),y=L(!1),x=L(!1),f=L(!1),U=L(!1),g=L(null),c=G(()=>a.chatVariables.map($=>{let he=$.variable_key+"（"+$.variable_name+"）",re=`【chat_variable:${$.variable_key}】`;return{...$,label:he,value:re}}));le(()=>c,()=>{setTimeout(()=>{g.value&&g.value.refresh()},500)},{deep:!0});const w=(j,$)=>{u.prompt=j},u=B({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),b=L(localStorage.getItem("system_prompt_words_ishide")=="1"),i=()=>{b.value=!b.value,localStorage.setItem("system_prompt_words_ishide",b.value?1:0)},p=(j,$)=>j.includes($),q=L(n.prompt_type),k=G(()=>n.prompt_type);le(()=>n,()=>{u.prompt=n.prompt,u.prompt_struct=n.prompt_struct,h.value=n.prompt_struct_default},{immediate:!0,deep:!0}),le(()=>u.prompt_struct.output.describe,j=>{y.value=p(j,ce),x.value=p(j,_e)},{immediate:!0,deep:!0}),le(()=>u.prompt,j=>{f.value=p(j,ce),U.value=p(j,_e)},{immediate:!0,deep:!0});const P=(j,$)=>{j?($=="outSwitch"&&(u.prompt_struct.output.describe?u.prompt_struct.output.describe+=`
`+ce:u.prompt_struct.output.describe+=ce),$=="imgSwitch"&&(u.prompt_struct.output.describe?u.prompt_struct.output.describe+=`
`+_e:u.prompt_struct.output.describe+=_e)):($=="outSwitch"&&(u.prompt_struct.output.describe=u.prompt_struct.output.describe.replace(new RegExp(ce,"g"),"")),$=="imgSwitch"&&(u.prompt_struct.output.describe=u.prompt_struct.output.describe.replace(new RegExp(_e,"g"),"")),u.prompt_struct.output.describe=u.prompt_struct.output.describe.trim())},z=(j,$)=>{j?($=="outDiySwitch"&&(u.prompt?u.prompt+=`
`+ce:u.prompt+=ce),$=="imgDiySwitch"&&(u.prompt?u.prompt+=`
`+_e:u.prompt+=_e)):($=="outDiySwitch"&&(u.prompt=u.prompt.replace(new RegExp(ce,"g"),"")),$=="imgDiySwitch"&&(u.prompt=u.prompt.replace(new RegExp(_e,"g"),"")),u.prompt=u.prompt.trim())},V=j=>{u.prompt_struct[j].describe=h.value[j].describe},D=()=>{let j=n.work_flow_ids.split(","),$=o.robotList.filter(re=>j.includes(re.id)),he=[];he=$.map(re=>`- ${re.robot_name} ${re.robot_intro}`).join(`
`),u.prompt_struct.skill.describe=he},J=()=>{u.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),q.value=1},ee=j=>{u.prompt_struct.custom.splice(j,1)},O=()=>{r({...Z(u),prompt_type:q.value}),d.value=!1},I=j=>{q.value=1,r({prompt_type:q.value,prompt:u.prompt,prompt_struct:j}),d.value=!1},se=()=>{q.value==0&&g.value&&g.value.refresh(),d.value=!0},W=()=>{d.value=!1},ke=L(null),De=()=>{ke.value.show()},Fe=L(null),pt=()=>{Fe.value.show()},We=L(null),mt=()=>{We.value.show({...u,prompt_type:q.value})},ht=j=>{j.prompt_type==1?(q.value=1,u.prompt_struct=j.prompt_struct):(q.value=0,u.prompt=j.prompt),O()};return(j,$)=>{const he=st,re=nt,Qe=ne,vt=ie,Le=te,Ge=we,ve=xe,Ie=oe,ft=me;return _(),v("div",Js,[e("div",Ks,[s(re,{activeKey:q.value,"onUpdate:activeKey":$[0]||($[0]=A=>q.value=A)},{default:l(()=>[(_(),N(he,{key:1,tab:"结构化提示词"})),(_(),N(he,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),d.value?(_(),v("div",Fs,[s(Qe,null,{title:l(()=>[...$[22]||($[22]=[S("将当前编辑的提示词保存到提示词库中",-1)])]),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:mt},[s(C(Pt)),$[23]||($[23]=S("上传 ",-1))])]),_:1}),s(Qe,null,{title:l(()=>[...$[24]||($[24]=[S("从提示词库导入提示词",-1)])]),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:pt},[s(C(At)),$[25]||($[25]=S("导入 ",-1))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:De},[s(vt,{name:"ai-mark"}),$[26]||($[26]=S(" AI自动生成 ",-1))]),s(Ge,{gap:8},{default:l(()=>[s(Le,{size:"small",type:"primary",onClick:O},{default:l(()=>[...$[27]||($[27]=[S("保存",-1)])]),_:1}),s(Le,{size:"small",onClick:W},{default:l(()=>[...$[28]||($[28]=[S("取消",-1)])]),_:1})]),_:1})])):(_(),v("div",Ws,[e("span",Qs,"当前类型："+E(k.value==1?"结构化提示词":"自定义提示词"),1),s(Le,{size:"small",onClick:se},{default:l(()=>[...$[29]||($[29]=[S("修改",-1)])]),_:1})]))]),q.value==1?(_(),v("div",Gs,[e("div",Hs,[e("div",Xs,[e("div",Zs,E(u.prompt_struct.role.subject),1),d.value?(_(),v("div",Ys,[e("a",{onClick:$[1]||($[1]=A=>V("role"))},"恢复默认")])):R("",!0)]),e("div",en,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.role.describe,"onUpdate:value":$[2]||($[2]=A=>u.prompt_struct.role.describe=A),placeholder:C(t).role},null,8,["disabled","value","placeholder"])])]),e("div",tn,[e("div",on,[e("div",sn,E(u.prompt_struct.task.subject),1),d.value?(_(),v("div",nn,[e("a",{onClick:$[3]||($[3]=A=>V("task"))},"恢复默认")])):R("",!0)]),e("div",ln,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.task.describe,"onUpdate:value":$[4]||($[4]=A=>u.prompt_struct.task.describe=A),placeholder:C(t).task},null,8,["disabled","value","placeholder"])])]),b.value?(_(),v(M,{key:0},[e("div",an,[e("div",rn,[e("div",dn,E(u.prompt_struct.constraints.subject),1),d.value?(_(),v("div",cn,[e("a",{onClick:$[5]||($[5]=A=>V("constraints"))},"恢复默认")])):R("",!0)]),e("div",_n,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.constraints.describe,"onUpdate:value":$[6]||($[6]=A=>u.prompt_struct.constraints.describe=A),placeholder:C(t).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",un,[e("div",pn,[e("div",mn,E(u.prompt_struct.skill.subject),1),d.value?(_(),v("div",hn,[e("a",{onClick:$[7]||($[7]=A=>D())},"自动导入技能")])):R("",!0)]),e("div",vn,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.skill.describe,"onUpdate:value":$[8]||($[8]=A=>u.prompt_struct.skill.describe=A),placeholder:C(t).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",fn,[e("div",bn,[e("div",yn,E(u.prompt_struct.output.subject),1),d.value?(_(),v("div",gn,[e("div",kn,[$[30]||($[30]=S(" 输出markdown： ",-1)),s(Ie,{onChange:$[9]||($[9]=A=>P(A,"outSwitch")),checked:y.value,"onUpdate:checked":$[10]||($[10]=A=>y.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",wn,[$[31]||($[31]=S(" 回复图片： ",-1)),s(Ie,{onChange:$[11]||($[11]=A=>P(A,"imgSwitch")),checked:x.value,"onUpdate:checked":$[12]||($[12]=A=>x.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:$[13]||($[13]=A=>V("output"))},"恢复默认")])):R("",!0)]),e("div",xn,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.output.describe,"onUpdate:value":$[14]||($[14]=A=>u.prompt_struct.output.describe=A),placeholder:C(t).output},null,8,["disabled","value","placeholder"])])]),e("div",$n,[e("div",Cn,[e("div",Sn,E(u.prompt_struct.tone.subject),1),d.value?(_(),v("div",qn,[e("a",{onClick:$[15]||($[15]=A=>V("tone"))},"恢复默认")])):R("",!0)]),e("div",Ln,[s(ve,{bordered:!1,disabled:!d.value,value:u.prompt_struct.tone.describe,"onUpdate:value":$[16]||($[16]=A=>u.prompt_struct.tone.describe=A),placeholder:C(t).tone},null,8,["disabled","value","placeholder"])])]),(_(!0),v(M,null,K(u.prompt_struct.custom,(A,Ce)=>(_(),v("div",{class:"prompt-list",key:Ce+A.key?A.key:""},[e("div",In,[e("div",Rn,[s(ft,{bordered:!1,disabled:!d.value,style:{width:"100%"},value:A.subject,"onUpdate:value":Re=>A.subject=Re,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),d.value?(_(),v("div",Un,[e("div",{class:"hover-btn-box",onClick:Re=>ee(Ce)},[s(C(ge))],8,En)])):R("",!0)]),e("div",On,[s(ve,{bordered:!1,disabled:!d.value,value:A.describe,"onUpdate:value":Re=>A.describe=Re,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),d.value?(_(),v("div",Vn,[s(Le,{onClick:J,block:"",icon:Ye(C(Pe))},{default:l(()=>[...$[32]||($[32]=[S("添加主题",-1)])]),_:1},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",Pn,[e("div",{class:"btn-item",onClick:i},[b.value?(_(),v(M,{key:1},[$[34]||($[34]=S("收起",-1)),s(C(Nt))],64)):(_(),v(M,{key:0},[$[33]||($[33]=S("展开",-1)),s(C(it))],64))])])])):(_(),v("div",{key:1,class:ae(["diy-prompt-box",{"is-disabled":!d.value}])},[d.value?(_(),N(Ge,{key:0,align:"center",justify:"space-between",style:{margin:"8px 0"}},{default:l(()=>[$[37]||($[37]=e("div",{style:{color:"#8c8c8c"}},' 键入"/"可以插入变量，用户输入的参数会填充变量作为最终的提示词 ',-1)),e("div",An,[e("div",Nn,[$[35]||($[35]=S(" 输出markdown： ",-1)),s(Ie,{onChange:$[17]||($[17]=A=>z(A,"outDiySwitch")),checked:f.value,"onUpdate:checked":$[18]||($[18]=A=>f.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Dn,[$[36]||($[36]=S(" 回复图片： ",-1)),s(Ie,{onChange:$[19]||($[19]=A=>z(A,"imgDiySwitch")),checked:U.value,"onUpdate:checked":$[20]||($[20]=A=>U.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])]),_:1})):R("",!0),s(Bs,{type:"textarea",inputStyle:"height: 126px",defaultValue:u.prompt,options:c.value,disabled:!0,checkAnyLevel:!0,ref_key:"atinputRef",ref:g,onChange:$[21]||($[21]=(A,Ce)=>w(A))},{option:l(({label:A,payload:Ce})=>[e("div",Mn,[e("div",Tn,E(A),1),e("div",jn,E(Ce.typ),1)])]),_:1},8,["defaultValue","options"])],2)),s(Ss,{onHandleAiSave:I,ref_key:"aiCreatePromptRef",ref:ke},null,512),s(ao,{onOk:ht,ref_key:"importPromptRef",ref:Fe},null,512),s(qs,{ref_key:"uploadPromptRef",ref:We},null,512)])}}},Bn=T(zn,[["__scopeId","data-v-20245495"]]),Jn={class:"actions-box"},Kn={class:"setting-info-block"},Fn={class:"set-item w-100"},Wn={class:"set-item"},Qn={class:"set-item"},Gn={class:"set-item"},Hn={class:"set-item"},Xn={class:"form-box"},Zn={class:"form-item"},Yn={class:"form-item-body"},ei={class:"form-item",style:{display:"flex","align-items":"center"}},ti={class:"form-item"},oi={class:"form-item-label"},si={class:"form-item-body"},ni={class:"number-box"},ii={class:"number-slider-box"},li={class:"number-input-box"},ai={class:"form-item"},ri={class:"form-item-label"},di={class:"form-item-body"},ci={class:"number-box"},_i={class:"number-slider-box"},ui={class:"number-input-box"},pi={class:"form-item"},mi={class:"form-item-label"},hi={class:"form-item-body"},vi={class:"number-box"},fi={class:"number-slider-box"},bi={class:"number-input-box"},yi={class:"form-item justify-between"},gi={class:"form-item-label"},ki={class:"form-item justify-between"},wi={class:"form-item-label"},xi={class:"form-item justify-between"},$i={class:"form-item-label"},Ci={__name:"model-settings",setup(m){const a=B({sm:24,md:24,lg:12,xl:24,xxl:24});L([]);const d=L(!1),{robotInfo:n,updateRobotInfo:r,getRobot:o}=H("robotInfo"),t=B({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0,question_multiple_switch:1}),h=L(!1),y=(b,i)=>{const p=i.attrs;t.question_multiple_switch=Number(p.input_image)||0,p&&p.input_image==1?h.value=!1:h.value=!0,t.use_model&&t.use_model.toLowerCase().includes("deepseek-r1")?t.prompt_role_type="1":t.prompt_role_type="0"},x=L({}),f=(b,i)=>{x.value=i},U=G(()=>{if(!t.model_config_id)return!1;let b=t.model_config_id+"#"+t.use_model;return x.value[b]}),g=()=>{let b={...Z(t)};r(b),d.value=!1},c=()=>{o(n.id).then(b=>{t.model_config_id=b.data.model_config_id,t.use_model=b.data.use_model})},w=b=>{t.use_model=n.use_model,t.model_config_id=n.model_config_id,t.temperature=n.temperature,t.max_token=n.max_token,t.context_pair=n.context_pair,t.think_switch=Number(n.think_switch),t.prompt_role_type=n.prompt_role_type,t.enable_thinking=n.enable_thinking,t.question_multiple_switch=Number(n.question_multiple_switch)||0,d.value=b};qe(()=>{t.use_model=n.use_model,t.model_config_id=n.model_config_id,t.temperature=n.temperature,t.max_token=n.max_token,t.context_pair=n.context_pair,t.think_switch=Number(n.think_switch),t.prompt_role_type=n.prompt_role_type,t.enable_thinking=n.enable_thinking,t.question_multiple_switch=Number(n.question_multiple_switch)||0});const u=G(()=>dt(t.model_config_id,t.use_model));return(b,i)=>{const p=te,q=Mt,k=Je,P=Be,z=ne,V=lt,D=$e,J=oe,ee=Dt,O=Y;return _(),N(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:d.value,"onUpdate:isEdit":i[14]||(i[14]=I=>d.value=I)},{extra:l(()=>[e("div",Jn,[s(p,{onClick:i[0]||(i[0]=I=>w(!0)),size:"small"},{default:l(()=>[...i[15]||(i[15]=[S("修改",-1)])]),_:1})])]),default:l(()=>[e("div",Kn,[e("div",Fn,[i[16]||(i[16]=S(" LLM模型： ",-1)),e("span",null,E(u.value),1)]),e("div",Wn,[i[17]||(i[17]=S(" 温度： ",-1)),e("span",null,E(t.temperature),1)]),e("div",Qn,[i[18]||(i[18]=S(" 最大token： ",-1)),e("span",null,E(t.max_token),1)]),e("div",Gn,[i[19]||(i[19]=S(" 上下文数量： ",-1)),e("span",null,E(t.context_pair),1)]),e("div",Hn,[i[20]||(i[20]=S(" 显示推理过程： ",-1)),e("span",null,E(t.think_switch==1?"开":"关"),1)])]),s(O,{open:d.value,"onUpdate:open":i[13]||(i[13]=I=>d.value=I),width:672,title:"模型设置",onCancel:c,onOk:g},{default:l(()=>[e("div",Xn,[s(ee,{gutter:[32,24]},{default:l(()=>[s(q,de(fe(a)),{default:l(()=>[e("div",Zn,[i[21]||(i[21]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",Yn,[s(Ke,{modelType:"LLM",modeName:t.use_model,"onUpdate:modeName":i[1]||(i[1]=I=>t.use_model=I),modeId:t.model_config_id,"onUpdate:modeId":i[2]||(i[2]=I=>t.model_config_id=I),onChange:y,onLoaded:f},null,8,["modeName","modeId"])])])]),_:1},16),s(q,de(fe(a)),{default:l(()=>[e("div",ei,[i[24]||(i[24]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[s(P,{value:t.prompt_role_type,"onUpdate:value":i[3]||(i[3]=I=>t.prompt_role_type=I)},{default:l(()=>[s(k,{value:"0"},{default:l(()=>[...i[22]||(i[22]=[S("系统角色（System）",-1)])]),_:1}),s(k,{value:"1"},{default:l(()=>[...i[23]||(i[23]=[S("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])])])]),_:1},16),s(q,de(fe(a)),{default:l(()=>[e("div",ti,[e("div",oi,[i[26]||(i[26]=e("span",null,"温度 ",-1)),s(z,null,{title:l(()=>[...i[25]||(i[25]=[S("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),e("div",si,[e("div",ni,[e("div",ii,[s(V,{class:"custom-slider",value:t.temperature,"onUpdate:value":i[4]||(i[4]=I=>t.temperature=I),min:0,max:2,step:.1},null,8,["value"])]),e("div",li,[s(D,{value:t.temperature,"onUpdate:value":i[5]||(i[5]=I=>t.temperature=I),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),s(q,de(fe(a)),{default:l(()=>[e("div",ai,[e("div",ri,[i[28]||(i[28]=e("span",null,"最大token ",-1)),s(z,null,{title:l(()=>[...i[27]||(i[27]=[S("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),e("div",di,[e("div",ci,[e("div",_i,[s(V,{class:"custom-slider",value:t.max_token,"onUpdate:value":i[6]||(i[6]=I=>t.max_token=I),min:0,max:100*1024},null,8,["value"])]),e("div",ui,[s(D,{value:t.max_token,"onUpdate:value":i[7]||(i[7]=I=>t.max_token=I),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),s(q,de(fe(a)),{default:l(()=>[e("div",pi,[e("div",mi,[i[30]||(i[30]=e("span",null,"上下文数量 ",-1)),s(z,null,{title:l(()=>[...i[29]||(i[29]=[S("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),e("div",hi,[e("div",vi,[e("div",fi,[s(V,{class:"custom-slider",value:t.context_pair,"onUpdate:value":i[8]||(i[8]=I=>t.context_pair=I),min:0,max:50},null,8,["value"])]),e("div",bi,[s(D,{value:t.context_pair,"onUpdate:value":i[9]||(i[9]=I=>t.context_pair=I),min:0,max:50},null,8,["value"])])])])])]),_:1},16),s(q,de(fe(a)),{default:l(()=>[e("div",yi,[e("div",gi,[i[32]||(i[32]=e("span",null,"多模态输入 ",-1)),s(z,null,{title:l(()=>[...i[31]||(i[31]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),s(ro,{title:"当前选择的模型不支持多模态输入",disabled:!h.value},{default:l(()=>[s(J,{checked:t.question_multiple_switch,"onUpdate:checked":i[10]||(i[10]=I=>t.question_multiple_switch=I),checkedValue:1,unCheckedValue:0,disabled:h.value},null,8,["checked","disabled"])]),_:1},8,["disabled"])])]),_:1},16),U.value?(_(),N(q,de(et({key:0},a)),{default:l(()=>[e("div",ki,[e("div",wi,[i[34]||(i[34]=e("span",null,"深度思考 ",-1)),s(z,null,{title:l(()=>[...i[33]||(i[33]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),s(J,{checked:t.enable_thinking,"onUpdate:checked":i[11]||(i[11]=I=>t.enable_thinking=I),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):R("",!0),s(q,de(fe(a)),{default:l(()=>[e("div",xi,[e("div",$i,[i[36]||(i[36]=e("span",null,"显示推理过程 ",-1)),s(z,null,{title:l(()=>[...i[35]||(i[35]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),s(J,{checked:t.think_switch,"onUpdate:checked":i[12]||(i[12]=I=>t.think_switch=I),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Si=T(Ci,[["__scopeId","data-v-5cd8b1bd"]]),qi={class:"recall-settings-box"},Li={class:"form-box"},Ii={class:"form-item is-required"},Ri={class:"form-item-body"},Ui={class:"retrieval-mode-items"},Ei=["onClick"],Oi={class:"retrieval-mode-title"},Vi={class:"title-text"},Pi={key:0,style:{width:"32px"},src:po,alt:""},Ai={class:"retrieval-mode-desc"},Ni={key:0,class:"form-item"},Di={class:"form-item"},Mi={class:"form-item-label"},Ti={class:"form-item-body"},ji={class:"number-box"},zi={class:"number-slider-box"},Bi={class:"number-input-box"},Ji={key:1,class:"form-item"},Ki={class:"form-item-label"},Fi={class:"form-item-body"},Wi={class:"number-box"},Qi={class:"number-slider-box"},Gi={class:"number-input-box"},Hi={class:"form-item"},Xi={class:"form-item-label"},Zi={class:"form-item-body"},Yi={class:"segment-controls"},el={class:"segment-input"},tl={class:"segment-input"},ol={class:"form-item"},sl={class:"form-item-label"},nl={key:0,class:"form-item-body"},il={class:"form-item"},ll={class:"form-item-label"},al={key:0,class:"form-item-body"},rl={__name:"recall-settings-alert",emits:["change"],setup(m,{expose:a,emit:d}){const n=d,r=L([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=B({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),t=L(null),h=L(!1),y=L({}),x=L([]),f=(i,p=null)=>{y.value=p,U(),o.rerank_status=i.rerank_status||0,o.rerank_use_model=i.rerank_use_model||void 0,o.rerank_model_config_id=i.rerank_model_config_id>0?i.rerank_model_config_id:"",o.top_k=i.top_k,o.similarity=i.similarity,o.search_type=i.search_type,o.meta_search_switch=Number(i.meta_search_switch),o.meta_search_type=Number(i.meta_search_type),o.meta_search_condition_list=i.meta_search_condition_list,o.rrf_weight=i.rrf_weight,o.recall_neighbor_switch=i.recall_neighbor_switch,o.recall_neighbor_before_num=i.recall_neighbor_before_num,o.recall_neighbor_after_num=i.recall_neighbor_after_num,h.value=!0},U=()=>{Lt({id:y.value.id}).then(i=>{x.value=(i==null?void 0:i.data)||[]})},g=i=>{i==0&&(o.rerank_model_config_id="",o.rerank_use_model="")},c=i=>{o.search_type=i},w=()=>o.rerank_status==1&&!o.rerank_model_config_id,u=()=>{if(w())return F.error("请选择Rerank模型");o.meta_search_switch==1&&!t.value.verify()||(h.value=!1,b())},b=()=>{n("change",Z(o))};return a({open:f}),(i,p)=>{const q=ie,k=ne,P=lt,z=$e,V=oe,D=Ve,J=Oe,ee=Y;return _(),N(ee,{width:"746px",open:h.value,"onUpdate:open":p[14]||(p[14]=O=>h.value=O),title:"召回设置",onOk:u},{default:l(()=>[e("div",qi,[e("div",Li,[e("div",Ii,[p[15]||(p[15]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",Ri,[e("div",Ui,[(_(!0),v(M,null,K(r.value,O=>(_(),v("div",{class:ae(["retrieval-mode-item",{active:o.search_type==O.value}]),key:O.value,onClick:I=>c(O.value)},[o.search_type==O.value?(_(),N(q,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",Oi,[s(q,{name:O.iconName,class:"title-icon"},null,8,["name"]),e("span",Vi,E(O.title),1),O.isRecommendation?(_(),v("img",Pi)):R("",!0)]),e("div",Ai,E(O.desc),1)],10,Ei))),128))])])]),o.search_type==1?(_(),v("div",Ni,[s(mo,{rrf_weight:o.rrf_weight,"onUpdate:rrf_weight":p[0]||(p[0]=O=>o.rrf_weight=O)},null,8,["rrf_weight"])])):R("",!0),e("div",Di,[e("div",Mi,[p[17]||(p[17]=e("span",null,"Top K ",-1)),s(k,null,{title:l(()=>[...p[16]||(p[16]=[S("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),e("div",Ti,[e("div",ji,[e("div",zi,[s(P,{class:"custom-slider",value:o.top_k,"onUpdate:value":p[1]||(p[1]=O=>o.top_k=O),min:1,max:500},null,8,["value"])]),e("div",Bi,[s(z,{value:o.top_k,"onUpdate:value":p[2]||(p[2]=O=>o.top_k=O),min:1,max:500},null,8,["value"])])])])]),o.search_type<=2?(_(),v("div",Ji,[e("div",Ki,[p[19]||(p[19]=e("span",null,"相似度阈值 ",-1)),s(k,null,{title:l(()=>[...p[18]||(p[18]=[S("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1})]),e("div",Fi,[e("div",Wi,[e("div",Qi,[s(P,{class:"custom-slider",value:o.similarity,"onUpdate:value":p[3]||(p[3]=O=>o.similarity=O),min:0,max:1,step:.01},null,8,["value"])]),e("div",Gi,[s(z,{value:o.similarity,"onUpdate:value":p[4]||(p[4]=O=>o.similarity=O),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",Hi,[e("div",Xi,[p[21]||(p[21]=e("span",{class:"setting-title"},"召回相邻分段 ",-1)),s(k,{overlayStyle:{maxWidth:"350px"}},{title:l(()=>[...p[20]||(p[20]=[e("div",{style:{"font-size":"13px"}},[e("p",null,"当在知识库检索到相关分段时，会根据配置拼接相关联的上下文。作为最终内容返回给大模型。"),e("p",null,"开启后，注意分段时不要设置分段重叠长度，否则可能影响最终效果。"),e("p",null,"父子分段类型的知识库，或者分段字数超过3000字时，不会做任何处理。")],-1)])]),default:l(()=>[s(C(Q),{class:"question-icon"})]),_:1}),p[22]||(p[22]=S("   ",-1)),s(V,{checked:o.recall_neighbor_switch,"onUpdate:checked":p[5]||(p[5]=O=>o.recall_neighbor_switch=O)},null,8,["checked"])]),e("div",Zi,[e("div",Yi,[e("div",el,[p[23]||(p[23]=e("span",null,"拼接分段前",-1)),p[24]||(p[24]=S("  ",-1)),s(J,{value:o.recall_neighbor_before_num,"onUpdate:value":p[6]||(p[6]=O=>o.recall_neighbor_before_num=O),style:{width:"80px"}},{default:l(()=>[(_(),v(M,null,K(6,O=>s(D,{value:O-1,key:O},{default:l(()=>[S(E(O-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),e("div",tl,[p[25]||(p[25]=e("span",null,"后",-1)),p[26]||(p[26]=S("  ",-1)),s(J,{value:o.recall_neighbor_after_num,"onUpdate:value":p[7]||(p[7]=O=>o.recall_neighbor_after_num=O),style:{width:"80px"}},{default:l(()=>[(_(),v(M,null,K(6,O=>s(D,{value:O-1,key:O},{default:l(()=>[S(E(O-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),p[27]||(p[27]=e("div",{class:"segment-text"},"个分段内容",-1))])])]),e("div",ol,[e("div",sl,[p[28]||(p[28]=e("span",null,"Rerank模型",-1)),p[29]||(p[29]=S("   ",-1)),s(V,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":p[8]||(p[8]=O=>o.rerank_status=O),onChange:g},null,8,["checked"])]),o.rerank_status==1?(_(),v("div",nl,[s(Ke,{modelType:"RERANK",modeName:o.rerank_use_model,"onUpdate:modeName":p[9]||(p[9]=O=>o.rerank_use_model=O),modeId:o.rerank_model_config_id,"onUpdate:modeId":p[10]||(p[10]=O=>o.rerank_model_config_id=O),style:{width:"60%"}},null,8,["modeName","modeId"])])):R("",!0)]),e("div",il,[e("div",ll,[s(k,{title:"元数据过滤是使用元数据属性（例如分组，知识创建时间等）来细化和控制系統内相关信息的检索过程。召回时仅会召回满足要求的知识。"},{default:l(()=>[e("span",null,[p[30]||(p[30]=S("元数据过滤 ",-1)),s(C(Q))])]),_:1}),p[31]||(p[31]=S("   ",-1)),s(V,{checkedValue:1,unCheckedValue:0,checked:o.meta_search_switch,"onUpdate:checked":p[11]||(p[11]=O=>o.meta_search_switch=O)},null,8,["checked"])]),o.meta_search_switch==1?(_(),v("div",al,[s(co,{rule:o.meta_search_condition_list,"onUpdate:rule":p[12]||(p[12]=O=>o.meta_search_condition_list=O),type:o.meta_search_type,"onUpdate:type":p[13]||(p[13]=O=>o.meta_search_type=O),ref_key:"metaFilterRef",ref:t,class:"meta-box","meta-data":x.value},null,8,["rule","type","meta-data"])])):R("",!0)])])])]),_:1},8,["open"])}}},dl=T(rl,[["__scopeId","data-v-40da81a4"]]),cl={class:"list-box"},_l=["onClick"],ul={class:"avater-box"},pl=["src"],ml={class:"content-box"},hl={class:"title-block"},vl={class:"title-text"},fl={class:"desc-box"},bl={class:"right-icon"},yl={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(m,{expose:a,emit:d}){const n=d,r=m,o=L(!1);le(()=>r.list,()=>{r.list.length==0&&(o.value=!1)},{});const t=()=>{o.value=!0},h=()=>{document.visibilityState==="visible"&&n("refreshList")};ye(()=>{document.addEventListener("visibilitychange",h)}),gt(()=>{document.removeEventListener("visibilitychange",h)});const y=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return a({show:t}),(x,f)=>{const U=Tt,g=ct,c=Y;return _(),v("div",null,[s(c,{open:o.value,"onUpdate:open":f[0]||(f[0]=w=>o.value=w),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:l(()=>[s(U,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),s(g,{scrollbar:!1,style:{height:"400px"}},{default:l(()=>[e("div",cl,[(_(!0),v(M,null,K(r.list,w=>(_(),v("div",{class:"list-item",onClick:u=>y(w),key:w.id},[e("div",ul,[e("img",{src:w.avatar,alt:""},null,8,pl)]),e("div",ml,[e("div",hl,[f[1]||(f[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",vl,E(w.library_name),1)]),e("div",fl,E(w.library_intro),1)]),e("div",bl,[s(C(jt))])],8,_l))),128))])]),_:1})]),_:1},8,["open"])])}}},gl=T(yl,[["__scopeId","data-v-0ebe0aeb"]]),kl={class:"actions-box"},wl={key:0,class:"library-list"},xl=["onClick"],$l={class:"library-avatar"},Cl=["src"],Sl={class:"info-content-box"},ql={class:"library-title-block"},Ll={class:"title-text"},Il={class:"desc-info-block"},Rl=["onClick"],Ul={class:"setting-info-block"},El={class:"set-item"},Ol={key:0},Vl={key:1},Pl={key:2},Al={key:3},Nl={class:"set-item"},Dl={key:0,class:"set-item"},Ml={class:"set-item"},Tl={key:0},jl={key:1},zl={__name:"index",setup(m){const a=It();G(()=>{var V;return((V=a.companyInfo)==null?void 0:V.neo4j_status)=="true"});const d=L(!1),{robotInfo:n,updateRobotInfo:r}=H("robotInfo"),o=B({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),t=L([]),h=L(null),y=L(null),x=G(()=>t.value.filter(V=>y.value?o.library_ids.includes(V.id):o.library_ids.includes(V.id)&&V.type!=3)),f=G(()=>x.value.filter(V=>V.graph_switch==0)),U=V=>{let D=o.library_ids.indexOf(V.id);o.library_ids.splice(D,1),p()},g=V=>{o.library_ids=[...V],p()},c=()=>{h.value.open([...o.library_ids])},w=L(null),u=()=>{w.value.open(Z(o),n)},b=L(null),i=V=>{o.rerank_status=V.rerank_status,o.rerank_use_model=V.rerank_use_model,o.rerank_model_config_id=V.rerank_model_config_id,o.top_k=V.top_k,o.similarity=V.similarity,o.search_type=V.search_type,o.meta_search_switch=V.meta_search_switch,o.meta_search_type=V.meta_search_type,o.meta_search_condition_list=V.meta_search_condition_list,o.rrf_weight=V.rrf_weight,o.recall_neighbor_switch=V.recall_neighbor_switch,o.recall_neighbor_before_num=V.recall_neighbor_before_num,o.recall_neighbor_after_num=V.recall_neighbor_after_num,(V.search_type==1||V.search_type==4)&&f.value.length>0&&b.value.show(),p()},p=()=>{let V={...Z(o)};V.library_ids=V.library_ids.join(","),V.op_type_relation_library=1,V.rrf_weight=JSON.stringify(V.rrf_weight),r({...V})},q=async()=>{const V=await Rt({type:"",show_open_docs:1});V&&(t.value=V.data||[])},k=()=>{ho({ability_type:"library_ability_official_account"}).then(V=>{var J;let D=(V==null?void 0:V.data)||{};((J=D==null?void 0:D.user_config)==null?void 0:J.switch_status)==1&&(y.value=D)})};o.rerank_use_model=n.rerank_use_model||void 0,qe(()=>{o.library_ids=n.library_ids.split(","),o.rerank_status=n.rerank_status||0,o.rerank_use_model=n.rerank_use_model||void 0,o.rerank_model_config_id=n.rerank_model_config_id||"",o.top_k=n.top_k,o.similarity=n.similarity,o.search_type=n.search_type,o.meta_search_switch=n.meta_search_switch,o.meta_search_type=n.meta_search_type,o.meta_search_condition_list=n.meta_search_condition_list,o.rrf_weight=n.rrf_weight!=""?JSON.parse(n.rrf_weight):{vector:0,search:0,graph:0},o.recall_neighbor_switch=n.recall_neighbor_switch,o.recall_neighbor_before_num=n.recall_neighbor_before_num,o.recall_neighbor_after_num=n.recall_neighbor_after_num});const P=V=>{window.open(`#/library/details/knowledge-document?id=${V.id}`)},z=G(()=>dt(o.rerank_model_config_id,o.rerank_use_model,"RERANK"));return ye(()=>{k(),q()}),(V,D)=>{const J=te,ee=we;return _(),N(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:d.value,"onUpdate:isEdit":D[0]||(D[0]=O=>d.value=O),bodyStyle:{padding:0}},{extra:l(()=>[e("div",kl,[s(ee,{gap:8},{default:l(()=>[s(J,{size:"small",onClick:u},{default:l(()=>[...D[1]||(D[1]=[S("召回设置",-1)])]),_:1}),s(J,{size:"small",onClick:c},{default:l(()=>[...D[2]||(D[2]=[S("关联知识库",-1)])]),_:1})]),_:1})])]),default:l(()=>[x.value.length>0?(_(),v("div",wl,[(_(!0),v(M,null,K(x.value,O=>(_(),v("div",{class:"library-item",key:O.id,onClick:I=>P(O)},[e("div",$l,[e("img",{src:O.avatar,alt:""},null,8,Cl)]),e("div",Sl,[e("div",ql,[e("div",Ll,E(O.library_name),1)]),e("div",Il,E(O.library_intro),1)]),O.id!=C(n).default_library_id?(_(),v("div",{key:0,class:"close-btn",onClick:kt(I=>U(O),["stop"])},[s(C(ge))],8,Rl)):R("",!0)],8,xl))),128))])):R("",!0),e("div",Ul,[e("div",El,[D[3]||(D[3]=S(" 检索模式： ",-1)),o.search_type==1?(_(),v("span",Ol,"混合检索")):R("",!0),o.search_type==2?(_(),v("span",Vl,"向量检索")):R("",!0),o.search_type==3?(_(),v("span",Pl,"全文检索")):R("",!0),o.search_type==4?(_(),v("span",Al,"知识图谱检索")):R("",!0)]),e("div",Nl,[D[4]||(D[4]=S(" Top K： ",-1)),e("span",null,E(o.top_k),1)]),o.search_type<=2?(_(),v("div",Dl,[D[5]||(D[5]=S(" 相似度阈值： ",-1)),e("span",null,E(o.similarity),1)])):R("",!0),e("div",Ml,[D[6]||(D[6]=S(" Rerank模型： ",-1)),o.rerank_status==0?(_(),v("span",Tl,"关")):(_(),v("span",jl,E(z.value),1))])]),s(uo,{ref_key:"librarySelectAlertRef",ref:h,onChange:g,showWxType:!!y.value},null,8,["showWxType"]),s(dl,{ref_key:"recallSettingsAlertRef",ref:w,onChange:i},null,512),s(gl,{list:f.value,onRefreshList:q,ref_key:"noOpenGraphModalRef",ref:b},null,8,["list"])]),_:1},8,["isEdit"])}}},Bl=T(zl,[["__scopeId","data-v-f228a4de"]]),Jl={class:"library-checkbox-box"},Kl={class:"list-box",ref:"scrollContainer"},Fl={class:"library-name"},Wl={class:"library-desc"},Ql={key:0,class:"empty-box"},Gl={__name:"library-select-alert",emits:["change"],setup(m,{expose:a,emit:d}){const n=d,r=B({indeterminate:!1,checkAll:!1,checkedList:[]}),o=L(!1),t=c=>{f(),r.checkedList=c,o.value=!0},h=()=>{o.value=!1,x()};L("");const y=L([]),x=()=>{n("change",[...r.checkedList])},f=async()=>{const c=await _t();if(c){let w=c.data||[];y.value=w}},U=L(!1),g=()=>{window.open("/#/database/list")};return a({open:t}),(c,w)=>{const u=at,b=zt,i=ot,p=Y;return _(),N(p,{width:"746px",open:o.value,"onUpdate:open":w[1]||(w[1]=q=>o.value=q),title:"关联数据表",onOk:h},{default:l(()=>[e("div",Jl,[s(i,{spinning:U.value,delay:100},{default:l(()=>[s(b,{value:r.checkedList,"onUpdate:value":w[0]||(w[0]=q=>r.checkedList=q),style:{width:"100%"}},{default:l(()=>[e("div",Kl,[(_(!0),v(M,null,K(y.value,q=>(_(),v("div",{class:"list-item-wraapper",key:q.id},[s(u,{class:"list-item",value:q.id},{default:l(()=>[e("div",Fl,E(q.name),1),e("div",Wl,E(q.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!U.value&&!y.value.length?(_(),v("div",Ql,[w[3]||(w[3]=e("img",{src:vo,alt:""},null,-1)),e("div",null,[w[2]||(w[2]=S(" 暂无数据表, 请先去添加数据表 ",-1)),e("a",{onClick:g}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},Hl=T(Gl,[["__scopeId","data-v-890ab853"]]),Xl={class:"actions-box"},Zl={key:0,class:"library-list"},Yl=["onClick"],ea={class:"library-name"},ta={class:"library-intro"},oa={__name:"index",setup(m){const a=L(!1),{robotInfo:d,updateRobotInfo:n}=H("robotInfo"),r=B({form_ids:[]}),o=L([]),t=L(null),h=G(()=>o.value.filter(c=>r.form_ids.includes(c.id))),y=c=>{let w=r.form_ids.indexOf(c.id);r.form_ids.splice(w,1),U()},x=c=>{r.form_ids=[...c],U()},f=()=>{t.value.open([...r.form_ids])},U=()=>{let c={...Z(r)};c.form_ids=c.form_ids.join(","),n({...c})};return(async()=>{const c=await _t();c&&(o.value=c.data||[])})(),qe(()=>{r.form_ids=d.form_ids.split(",")}),(c,w)=>{const u=ne,b=te,i=we;return _(),N(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:a.value,"onUpdate:isEdit":w[0]||(w[0]=p=>a.value=p),bodyStyle:{padding:0}},{tip:l(()=>[s(u,{placement:"top"},{title:l(()=>[...w[1]||(w[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])]),default:l(()=>[s(C(Q))]),_:1})]),extra:l(()=>[e("div",Xl,[s(i,{gap:8},{default:l(()=>[s(b,{size:"small",onClick:f},{default:l(()=>[...w[2]||(w[2]=[S("关联数据表",-1)])]),_:1})]),_:1})])]),default:l(()=>[h.value.length>0?(_(),v("div",Zl,[(_(!0),v(M,null,K(h.value,p=>(_(),v("div",{class:"library-item",key:p.id},[e("span",{class:"close-btn",onClick:q=>y(p)},[s(C(ge))],8,Yl),e("div",ea,E(p.name),1),e("div",ta,E(p.description),1)]))),128))])):R("",!0),s(Hl,{ref_key:"librarySelectAlertRef",ref:t,onChange:x},null,512)]),_:1},8,["isEdit"])}}},sa=T(oa,[["__scopeId","data-v-077d8df6"]]),na={class:"form-box"},ia={class:"question-title"},la={class:"question-options"},aa={class:"question-option"},ra={class:"drag-btn"},da={class:"action-box"},ca={class:"robot-info-box"},_a={class:"robot-welcome-content"},ua={class:"robot-welcome-question"},pa={__name:"welcome-words",setup(m){const a=L(!1),d=L(!1),{robotInfo:n,updateRobotInfo:r,scrollBoxToBottom:o}=H("robotInfo"),t=B({welcomes:{content:"",question:[]}}),h=()=>{let g=!1;if(t.welcomes.question.length>0){for(let c=0;c<t.welcomes.question.length;c++)if(!t.welcomes.question[c].content){g=c+1;break}}return g},y=()=>{t.welcomes.question.push({content:"",id:Ue(8)})},x=g=>{t.welcomes.question.splice(g,1)},f=()=>{if(!t.welcomes.content)return F.error("请输入欢迎语");if(h())return F.error("引导问题内容不能为空");r({...Z(t)}),a.value=!1},U=()=>{let g={...n.welcomes},c=[];g.question.forEach(({content:w,id:u})=>{let b={id:u,content:w};b.id||(b.id=Ue(6)),c.push(b)}),t.welcomes.content=g.content,t.welcomes.question=c};return(g,c)=>{const w=xe,u=ie,b=me;return _(),N(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:a.value,"onUpdate:isEdit":c[4]||(c[4]=i=>a.value=i),onSave:f,onEdit:U},{default:l(()=>[ue(e("div",na,[e("div",ia,[s(w,{value:t.welcomes.content,"onUpdate:value":c[0]||(c[0]=i=>t.welcomes.content=i),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",la,[s(C(Ne),{modelValue:t.welcomes.question,"onUpdate:modelValue":c[1]||(c[1]=i=>t.welcomes.question=i),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=i=>d.value=!0),onEnd:c[3]||(c[3]=i=>d.value=!1)},{item:l(({element:i,index:p})=>[e("div",aa,[e("span",ra,[s(u,{name:"drag"})]),s(b,{class:"question-option-content",value:i.content,"onUpdate:value":q=>i.content=q,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",da,[s(C(ge),{class:"del-btn",onClick:q=>x(p)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:y},[s(C(Pe),{class:"add-btn-icon"}),c[5]||(c[5]=S("添加引导问题 ",-1))])])],512),[[pe,a.value]]),ue(e("div",ca,[e("div",_a,E(C(n).welcomes.content),1),e("div",ua,[(_(!0),v(M,null,K(C(n).welcomes.question,(i,p)=>(_(),v("div",{class:"question-item",key:p},E(i.content),1))),128))])],512),[[pe,!a.value]])]),_:1},8,["isEdit"])}}},ma=T(pa,[["__scopeId","data-v-9b840ded"]]),ha={class:"form-box"},va={class:"question-title"},fa={class:"question-options"},ba={class:"question-option"},ya={class:"drag-btn"},ga={class:"action-box"},ka={class:"robot-info-box"},wa={class:"robot-unknown-content"},xa={class:"robot-unknown-question"},$a={__name:"unknown-problem-prompt",setup(m){const a=L(!1),d=L(!1),{robotInfo:n,updateRobotInfo:r,scrollBoxToBottom:o}=H("robotInfo"),t=B({unknown_question_prompt:{content:"",question:[]}}),h=()=>{t.unknown_question_prompt.question.push({content:"",id:Ue(8)}),tt(()=>{o()})},y=U=>{t.unknown_question_prompt.question.splice(U,1)},x=()=>{r({...Z(t)}),a.value=!1},f=()=>{let U={...n.unknown_question_prompt},g=[];U.question&&U.question.forEach(({content:c,id:w})=>{let u={id:w,content:c};u.id||(u.id=Ue(6)),g.push(u)}),U.content&&(t.unknown_question_prompt.content=U.content),g&&(t.unknown_question_prompt.question=g)};return ye(()=>{}),(U,g)=>{const c=ne,w=xe,u=ie,b=me;return _(),N(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:a.value,"onUpdate:isEdit":g[4]||(g[4]=i=>a.value=i),onSave:x,onEdit:f},{tip:l(()=>[s(c,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...g[5]||(g[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])]),default:l(()=>[s(C(Q))]),_:1})]),default:l(()=>[ue(e("div",ha,[e("div",va,[s(w,{value:t.unknown_question_prompt.content,"onUpdate:value":g[0]||(g[0]=i=>t.unknown_question_prompt.content=i),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",fa,[s(C(Ne),{modelValue:t.unknown_question_prompt.question,"onUpdate:modelValue":g[1]||(g[1]=i=>t.unknown_question_prompt.question=i),"item-key":"id",handle:".drag-btn",onStart:g[2]||(g[2]=i=>d.value=!0),onEnd:g[3]||(g[3]=i=>d.value=!1)},{item:l(({element:i,index:p})=>[e("div",ba,[e("span",ya,[s(u,{name:"drag"})]),s(b,{class:"question-option-content",value:i.content,"onUpdate:value":q=>i.content=q,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ga,[s(C(ge),{class:"del-btn",onClick:q=>y(p)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:h},[s(C(Pe),{class:"add-btn-icon"}),g[6]||(g[6]=S("添加引导问题 ",-1))])])],512),[[pe,a.value]]),ue(e("div",ka,[e("div",wa,E(C(n).unknown_question_prompt.content),1),e("div",xa,[(_(!0),v(M,null,K(C(n).unknown_question_prompt.question,(i,p)=>(_(),v("div",{class:"question-item",key:p},E(i.content),1))),128))])],512),[[pe,!a.value]])]),_:1},8,["isEdit"])}}},Ca=T($a,[["__scopeId","data-v-aca01d0e"]]),Sa={class:"robot-info-box"},qa={class:"modal-box",ref:"modalBoxRef"},La={class:"modal-item-box"},Ia={class:"modal-item"},Ra={class:"modal-item"},Ua={__name:"problem-optimization",setup(m){const a=L(!1);L(!1);const{robotInfo:d,updateRobotInfo:n}=H("robotInfo"),r=L("0"),o=B({optimize_question_use_model:"",optimize_question_model_config_id:""});ye(()=>{r.value=d.optimize_question_model_config_id!=0?"1":"0",o.optimize_question_use_model=d.optimize_question_use_model,o.optimize_question_model_config_id=d.optimize_question_model_config_id});const t=L([]),h=g=>{t.value=g,tt(()=>{(!o.optimize_question_use_model||!Number(o.optimize_question_model_config_id))&&y()})},y=()=>{if(t.value.length>0){let g=null,c=null;for(let w of t.value)if(w.model_define==="tongyi"){g=w;for(let u of g.children)if(u.name==="qwen-max"){c=u;break}break}g||(g=t.value[0],c=g.children[0]),g&&c&&(o.optimize_question_use_model=c.name,o.optimize_question_model_config_id=c.model_config_id)}},x=()=>{a.value=!1,n({...Z(o)})},f=g=>{g!=1&&(o.optimize_question_use_model="",o.optimize_question_model_config_id=0)},U=g=>{n({})};return(g,c)=>{const w=ne,u=oe,b=Je,i=Be,p=xe,q=Y;return _(),N(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:l(()=>[...c[7]||(c[7]=[e("span",null,null,-1)])]),default:l(()=>[e("div",Sa,[c[9]||(c[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),s(w,null,{title:l(()=>[...c[8]||(c[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])]),default:l(()=>[e("div",{class:"dialog-bg-set",onClick:c[0]||(c[0]=k=>a.value=!0)}," 对话背景设置 ")]),_:1})]),s(u,{onChange:U,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(d).enable_question_optimize,"onUpdate:checked":c[1]||(c[1]=k=>C(d).enable_question_optimize=k),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",qa,[s(q,{getContainer:()=>g.$refs.modalBoxRef,open:a.value,"onUpdate:open":c[6]||(c[6]=k=>a.value=k),width:472,title:"用户问题建议设置",onOk:x},{default:l(()=>[e("div",La,[e("div",Ia,[c[12]||(c[12]=e("div",{class:"label"},"模型",-1)),s(i,{value:r.value,"onUpdate:value":c[2]||(c[2]=k=>r.value=k),onChange:f},{default:l(()=>[s(b,{value:"0"},{default:l(()=>[...c[10]||(c[10]=[S("跟随机器人",-1)])]),_:1}),s(b,{value:"1"},{default:l(()=>[...c[11]||(c[11]=[S("指定模型",-1)])]),_:1})]),_:1},8,["value"]),r.value=="1"?(_(),N(Ke,{key:0,modelType:"LLM",modeName:o.optimize_question_use_model,"onUpdate:modeName":c[3]||(c[3]=k=>o.optimize_question_use_model=k),modeId:o.optimize_question_model_config_id,"onUpdate:modeId":c[4]||(c[4]=k=>o.optimize_question_model_config_id=k),style:{width:"100%","margin-top":"8px"},onLoaded:h},null,8,["modeName","modeId"])):R("",!0)]),e("div",Ra,[c[13]||(c[13]=e("div",{class:"label"},"对话背景",-1)),s(p,{style:{height:"120px"},value:C(d).optimize_question_dialogue_background,"onUpdate:value":c[5]||(c[5]=k=>C(d).optimize_question_dialogue_background=k),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Ea=T(Ua,[["__scopeId","data-v-13ab9369"]]),Oa={class:"robot-info-box"},Va={class:"robot-prompt"},Pa={__name:"suggested-issues",setup(m){L(!1);const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=r=>{d({})};return(r,o)=>{const t=$e,h=oe;return _(),N(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:l(()=>[...o[2]||(o[2]=[e("span",null,null,-1)])]),default:l(()=>[e("div",Oa,[e("div",Va,[o[3]||(o[3]=S(" 开启后，机器人回答问题后，自动根据对话内容提供 ",-1)),s(t,{value:C(a).question_guide_num,"onUpdate:value":o[0]||(o[0]=y=>C(a).question_guide_num=y),style:{width:"80px"},precision:0,min:1,max:10,onBlur:n},null,8,["value"]),o[4]||(o[4]=S(" 条用户提问建议，最大不超过10条。 ",-1))])]),s(h,{onChange:n,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).enable_question_guide,"onUpdate:checked":o[1]||(o[1]=y=>C(a).enable_question_guide=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Aa=T(Pa,[["__scopeId","data-v-bec632a5"]]),Na={__name:"sensitive-words",setup(m){L(!1);const{robotInfo:a,updateRobotInfo:d}=H("robotInfo");B({prompt:""});const n=()=>{window.open("/#/user/sensitive-words")},r=o=>{d({})};return(o,t)=>{const h=oe;return _(),N(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:l(()=>[...t[1]||(t[1]=[e("span",null,null,-1)])]),default:l(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[t[2]||(t[2]=S(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，",-1)),e("span",{onClick:n,style:{cursor:"pointer"}},"设置敏词 >")])]),s(h,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(a).sensitive_words_switch,"onUpdate:checked":t[0]||(t[0]=y=>C(a).sensitive_words_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Da=T(Na,[["__scopeId","data-v-f1e5ad50"]]),Ma={class:"direct-title"},Ta={class:"direct-desc"},ja={class:"qa"},za={class:"prompt-form-item-label"},Ba={class:"direct-switch"},Ja={class:"similarity"},Ka={class:"number-input-box"},Fa={__name:"chat-edit-alert",emits:["save"],setup(m,{expose:a,emit:d}){const n=d,r=L(1),o=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],t=B(o()),h=L(!1),y=B({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{y.chat_type=r.value.toString(),t.forEach(g=>{g.chat_type==r.value&&(y.chat_type=="3"?(y.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch==1?"true":"false",y.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score.toString()):y.chat_type=="1"&&(y.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch==1?"true":"false",y.library_qa_direct_reply_score=g.library_qa_direct_reply_score.toString()))}),f(),Object.assign(t,o()),h.value=!1},f=()=>{n("save",Z(y))};ye(()=>{});const U=g=>{r.value=parseInt(g.chat_type),y.chat_type=g.chat_type,y.library_qa_direct_reply_score=g.library_qa_direct_reply_score,y.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch,y.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,y.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch,t.forEach(c=>{c.chat_type=="3"?(c.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,c.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch=="true"?1:0):c.chat_type=="1"&&(c.library_qa_direct_reply_score=g.library_qa_direct_reply_score,c.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch=="true"?1:0)}),h.value=!0};return le(()=>h.value,g=>{g===!1&&Object.assign(t,o())},{immediate:!0}),a({open:U}),(g,c)=>{const w=ne,u=oe,b=$e,i=Je,p=Be,q=Y;return _(),N(q,{width:"746px",open:h.value,"onUpdate:open":c[1]||(c[1]=k=>h.value=k),title:"聊天模式设置",onOk:x},{default:l(()=>[s(p,{class:"direct-box",value:r.value,"onUpdate:value":c[0]||(c[0]=k=>r.value=k)},{default:l(()=>[(_(!0),v(M,null,K(t,k=>(_(),N(i,{class:ae(["direct-item",{active:r.value==k.direct_id}]),value:k.direct_id,key:k.direct_id},{default:l(()=>[e("div",Ma,E(k.direct_title),1),e("div",Ta,E(k.direct_desc),1),ue(e("div",ja,[e("div",za,[c[4]||(c[4]=e("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),s(w,null,wt({default:l(()=>[s(C(Q),{class:"question-icon"})]),_:2},[k.chat_type=="1"?{name:"title",fn:l(()=>[c[2]||(c[2]=S("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"0"}:k.chat_type=="3"?{name:"title",fn:l(()=>[c[3]||(c[3]=S("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"1"}:void 0]),1024),e("div",Ba,[k.chat_type=="1"?(_(),N(u,{key:0,checkedValue:1,unCheckedValue:0,checked:k.library_qa_direct_reply_switch,"onUpdate:checked":P=>k.library_qa_direct_reply_switch=P},null,8,["checked","onUpdate:checked"])):k.chat_type=="3"?(_(),N(u,{key:1,checkedValue:1,unCheckedValue:0,checked:k.mixture_qa_direct_reply_switch,"onUpdate:checked":P=>k.mixture_qa_direct_reply_switch=P},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[pe,k.isQaDirectReply&&r.value==k.direct_id]]),ue(e("div",Ja,[c[5]||(c[5]=e("span",null,"相似度超过",-1)),e("div",Ka,[k.chat_type=="1"?(_(),N(b,{key:0,value:k.library_qa_direct_reply_score,"onUpdate:value":P=>k.library_qa_direct_reply_score=P,disabled:!k.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):k.chat_type=="3"?(_(),N(b,{key:1,value:k.mixture_qa_direct_reply_score,"onUpdate:value":P=>k.mixture_qa_direct_reply_score=P,disabled:!k.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),c[6]||(c[6]=e("span",null,"时直接回复答案",-1))],512),[[pe,k.isQaDirectReply&&r.value==k.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Wa=T(Fa,[["__scopeId","data-v-96e9d8b8"]]),Qa={class:"actions-box"},Ga={class:"setting-info-block"},Ha={class:"set-item"},Xa={key:0},Za={key:1},Ya={key:2},er={class:"set-item"},tr={key:0,class:"set-item"},or={class:"set-item"},sr={key:0,class:"set-item"},nr={class:"form-box"},ir={__name:"index",setup(m){const a=L(!1),d=L(null),{robotInfo:n,updateRobotInfo:r}=H("robotInfo"),o=B({chat_type:n.chat_type,library_qa_direct_reply_score:n.library_qa_direct_reply_score,library_qa_direct_reply_switch:n.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:n.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:n.mixture_qa_direct_reply_switch}),t=x=>{o.chat_type=x.chat_type,o.library_qa_direct_reply_score=x.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,h()},h=()=>{r({...Z(o)}),a.value=!1},y=()=>{d.value.open(Z(o)),a.value=!0};return(x,f)=>{const U=ne,g=te;return _(),N(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:a.value,"onUpdate:isEdit":f[1]||(f[1]=c=>a.value=c),bodyStyle:{padding:0}},{tip:l(()=>[s(U,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...f[2]||(f[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])]),default:l(()=>[s(C(Q))]),_:1})]),extra:l(()=>[e("div",Qa,[s(g,{size:"small",onClick:f[0]||(f[0]=c=>y(!0))},{default:l(()=>[...f[3]||(f[3]=[S("修改",-1)])]),_:1})])]),default:l(()=>[e("div",Ga,[e("div",Ha,[f[4]||(f[4]=S(" 聊天模式： ",-1)),C(n).chat_type=="1"?(_(),v("span",Xa,"仅知识库")):R("",!0),C(n).chat_type=="2"?(_(),v("span",Za,"直连模式")):R("",!0),C(n).chat_type=="3"?(_(),v("span",Ya,"混合模式")):R("",!0)]),C(n).chat_type=="1"?(_(),v(M,{key:0},[e("div",er,[f[5]||(f[5]=S(" 命中问答知识时直接回复答案： ",-1)),e("span",null,E(C(n).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),C(n).library_qa_direct_reply_switch=="true"?(_(),v("div",tr,[f[6]||(f[6]=S(" 相似度阈值： ",-1)),e("span",null,E(C(n).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),C(n).chat_type=="3"?(_(),v(M,{key:1},[e("div",or,[f[7]||(f[7]=S(" 命中问答知识时直接回复答案： ",-1)),e("span",null,E(C(n).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),C(n).mixture_qa_direct_reply_switch=="true"?(_(),v("div",sr,[f[8]||(f[8]=S(" 相似度阈值： ",-1)),e("span",null,E(C(n).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",nr,[s(Wa,{ref_key:"ChatEditAlertRef",ref:d,onSave:t},null,512)])]),_:1},8,["isEdit"])}}},lr=T(ir,[["__scopeId","data-v-ed6b923e"]]),ar={class:"switch-box"},rr={class:"switch-box-body"},dr={class:"switch-box-header"},cr={class:"left-box"},_r={class:"switch-box-title"},ur={key:0,class:"title-tip"},pr={class:"right-box"},mr={class:"extra-box"},hr={class:"switch-desc"},vr={class:"switch-box-right"},fr={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(m,{emit:a}){const d=a,n=m,r=L(n.value),o=t=>{d("update:value",t),d("change",t)};return(t,h)=>{const y=ie,x=oe;return _(),v("div",ar,[e("div",rr,[e("div",dr,[e("div",cr,[s(y,{class:"switch-box-icon",name:n.iconName},null,8,["name"]),e("span",_r,E(n.title),1),t.$slots.tip?(_(),v("span",ur,[be(t.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",pr,[e("div",mr,[be(t.$slots,"extra",{},()=>[h[1]||(h[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",hr,[be(t.$slots,"default",{},void 0,!0)])]),e("div",vr,[s(x,{checked:r.value,"onUpdate:checked":h[0]||(h[0]=f=>r.value=f),onChange:o,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},br=T(fr,[["__scopeId","data-v-0548f52d"]]),yr="/assets/img/phone-head-CDwwPhYa.png",gr="/assets/img/phone-body-CbEf8GZP.png",kr="/assets/img/phone-footer-ClQtNpln.png",wr={class:"common-problem-box"},xr={class:"left-content-box"},$r={key:0,class:"empty-box"},Cr={key:1,class:"lists-box"},Sr={class:"drag-btn"},qr={class:"title"},Lr={class:"opration-box"},Ir={class:"preview-box"},Rr={class:"phone-body"},Ur={key:0,class:"question-box"},Er={__name:"common-problem",setup(m){L(!1);const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=G(()=>a.common_question_list?JSON.parse(a.common_question_list):[]),r=L([]);r.value=n.value,le(n,()=>{r.value=n.value});const o=Ee.useForm,t=L(!1),h=L("添加问题"),y=B({question:"",index:-1}),x=B({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:f,validate:U,validateInfos:g}=o(y,x),c=()=>{if(n.value.length>=10)return F.error("最多设置10条常用问题");t.value=!0,f(),y.question="",y.index=-1},w=(q,k)=>{t.value=!0,f(),y.question=q,y.index=k},u=q=>{let k=[];k=n.value.filter((P,z)=>q!=z),Y.confirm({title:"提醒",icon:s(Se),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){d({common_question_list:JSON.stringify(k)})},onCancel(){}})},b=()=>{U().then(()=>{let q=[];y.index>=0?q=n.value.map((k,P)=>P===y.index?y.question:k):q=[y.question,...n.value],d({common_question_list:JSON.stringify(q)}),t.value=!1})},i=q=>{d({})},p=q=>{d({common_question_list:JSON.stringify(r.value)})};return(q,k)=>{const P=ne,z=oe,V=Bt,D=te,J=ie,ee=me,O=ze,I=Ee,se=Y;return _(),v("div",wr,[e("div",xr,[s(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:l(()=>[s(P,null,{title:l(()=>[...k[4]||(k[4]=[S("最多10条。开启后，常见问题会显示在每条问答后面",-1)])]),default:l(()=>[s(C(Q),{class:"quess-icon"})]),_:1})]),extra:l(()=>[s(z,{onChange:i,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).enable_common_question,"onUpdate:checked":k[0]||(k[0]=W=>C(a).enable_common_question=W),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),s(V,{type:"vertical"}),s(D,{type:"primary",size:"small",onClick:c},{default:l(()=>[...k[5]||(k[5]=[S("添加",-1)])]),_:1})]),default:l(()=>[n.value.length==0?(_(),v("div",$r,[k[7]||(k[7]=e("img",{src:fo,alt:""},null,-1)),k[8]||(k[8]=e("div",{class:"title"},"暂无数据",-1)),k[9]||(k[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),s(D,{onClick:c,type:"primary"},{default:l(()=>[...k[6]||(k[6]=[S("立即添加",-1)])]),_:1})])):(_(),v("div",Cr,[s(C(Ne),{modelValue:r.value,"onUpdate:modelValue":k[1]||(k[1]=W=>r.value=W),handle:".drag-btn","item-key":"index",onEnd:p},{item:l(({element:W,index:ke})=>[(_(),v("div",{class:"list-item",key:ke},[e("span",Sr,[s(J,{name:"drag"})]),e("div",qr,E(W),1),e("div",Lr,[s(C(rt),{onClick:De=>w(W,ke)},null,8,["onClick"]),s(C(ge),{onClick:De=>u(ke)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Ir,[k[12]||(k[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:yr,alt:""})],-1)),e("div",Rr,[k[11]||(k[11]=e("div",null,[e("img",{class:"body-img",src:gr,alt:""})],-1)),n.value.length&&C(a).enable_common_question=="true"?(_(),v("div",Ur,[k[10]||(k[10]=e("div",{class:"name"},"常见问题",-1)),(_(!0),v(M,null,K(n.value,W=>(_(),v("div",{class:"list-item",key:W},E(W),1))),128))])):R("",!0)]),k[13]||(k[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:kr,alt:""})],-1))]),s(se,{open:t.value,"onUpdate:open":k[3]||(k[3]=W=>t.value=W),title:h.value,onOk:b,width:"476px"},{default:l(()=>[s(I,{class:"form-box",layout:"vertical"},{default:l(()=>[s(O,et({label:"问题名称"},C(g).question),{default:l(()=>[s(ee,{maxLength:100,value:y.question,"onUpdate:value":k[2]||(k[2]=W=>y.question=W),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Or=T(Er,[["__scopeId","data-v-dce83f0d"]]),Vr={__name:"display-aitations",setup(m){const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=L(!1);le(()=>a.answer_source_switch,o=>{n.value=o=="true"},{immediate:!0});const r=()=>{d({answer_source_switch:n.value?"true":"false"})};return(o,t)=>(_(),N(br,{title:"显示引文","icon-name":"jibenpeizhi",value:n.value,"onUpdate:value":t[0]||(t[0]=h=>n.value=h),onChange:r},{extra:l(()=>[...t[1]||(t[1]=[e("span",null,null,-1)])]),default:l(()=>[t[2]||(t[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1},8,["value"]))}},Pr={__name:"show-like",setup(m){const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=r=>{d({})};return(r,o)=>{const t=oe;return _(),N(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:l(()=>[...o[1]||(o[1]=[e("span",null,null,-1)])]),default:l(()=>[o[2]||(o[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),s(t,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:C(a).feedback_switch,"onUpdate:checked":o[0]||(o[0]=h=>C(a).feedback_switch=h),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ar=T(Pr,[["__scopeId","data-v-73894b10"]]),Nr={class:"content-box"},Dr={key:0,class:"add-btn-block"},Mr={class:"list-content"},Tr={key:0,class:"user-block"},jr={class:"name-box"},zr={class:"name"},Br={class:"remark-text"},Jr={key:0,class:"hover-btn-box"},Kr={key:0},Fr={key:1},Wr={key:2},Qr={key:1,class:"hover-btn-box"},Gr={class:"role-menu-box"},Hr=["onClick"],Xr={class:"menu-header"},Zr={key:0,class:"check-box"},Yr=["onClick"],ed={class:"menu-header"},td={key:0,class:"check-box"},od=["onClick"],sd={class:"menu-header"},nd={key:0,class:"check-box"},id={class:"hover-btn-box"},ld={key:0},ad={key:1},rd={key:2},dd=["onClick"],cd={__name:"role-permission",setup(m){const a=Ut(),d=G(()=>a.user_name),n=je().query,r=L(Et(n.id)),o=L([]),t=B({object_id:n.id,object_type:1}),h=()=>{bo({...t}).then(c=>{let w=c.data||[];o.value=w})};h();const y=L(null),x=()=>{y.value.show(o.value,[{object_id:+n.id,object_type:1,operate_rights:4}])},f=(c,w)=>{let u=w==4?"管理":w==2?"编辑":"查看";Y.confirm({title:"提示?",icon:s(Se),content:"确认修改该协作者权限为【"+u+"】",okText:"确认",cancelText:"取消",onOk:()=>{let b=[{object_id:+c.object_id,object_type:+c.object_type,operate_rights:+w}];yo({identity_ids:c.identity_id,identity_type:c.identity_type,object_array:JSON.stringify(b)}).then(i=>{F.success("修改成功"),h()})},onCancel(){}})},U=c=>{Y.confirm({title:"提示?",icon:s(Se),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{go({identity_id:c.identity_id,identity_type:c.identity_type,object_id:c.object_id,object_type:c.object_type}).then(w=>{F.success("删除成功"),h()})},onCancel(){}})},g=L([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(c,w)=>{const u=te,b=Jt,i=Kt,p=Wt,q=ct;return _(),N(q,null,{default:l(()=>[e("div",Nr,[r.value==4?(_(),v("div",Dr,[s(u,{type:"primary",onClick:x,icon:Ye(C(Pe))},{default:l(()=>[...w[0]||(w[0]=[S("添加协助者",-1)])]),_:1},8,["icon"])])):R("",!0),e("div",Mr,[s(p,{columns:g.value,"data-source":o.value,pagination:!1},{bodyCell:l(({column:k,record:P})=>[k.key==="name"?(_(),v("div",Tr,[s(b,{shape:"square",src:P.avatar,size:40},{icon:l(()=>[P.avatar?R("",!0):(_(),N(C(Xe),{key:0}))]),_:2},1032,["src"]),e("div",jr,[e("div",zr,E(P.user_name),1),e("div",Br,E(P.name),1)])])):R("",!0),k.key==="operate_rights"?(_(),v(M,{key:1},[r.value==2||P.user_name==d.value?(_(),v("div",Jr,[P.operate_rights==4?(_(),v("span",Kr,"管理")):R("",!0),P.operate_rights==2?(_(),v("span",Fr,"编辑")):R("",!0),P.operate_rights==1?(_(),v("span",Wr,"查看")):R("",!0)])):P.role_type==1||P.is_creator==1?(_(),v("div",Qr,"管理")):(_(),N(i,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[e("div",Gr,[e("div",{class:"role-menu",onClick:z=>f(P,4)},[e("div",Xr,[s(C(Xe)),w[1]||(w[1]=e("span",{class:"title"},"管理",-1))]),w[2]||(w[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),P.operate_rights==4?(_(),v("div",Zr,[s(C(Me))])):R("",!0)],8,Hr),e("div",{class:"role-menu",onClick:z=>f(P,2)},[e("div",ed,[s(C(rt)),w[3]||(w[3]=e("span",{class:"title"},"编辑",-1))]),w[4]||(w[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),P.operate_rights==2?(_(),v("div",td,[s(C(Me))])):R("",!0)],8,Yr),e("div",{class:"role-menu",onClick:z=>f(P,1)},[e("div",sd,[s(C(Ft)),w[5]||(w[5]=e("span",{class:"title"},"查看",-1))]),w[6]||(w[6]=e("div",{class:"desc"},"仅查看",-1)),P.operate_rights==1?(_(),v("div",nd,[s(C(Me))])):R("",!0)],8,od)])]),default:l(()=>[e("div",id,[P.operate_rights==4?(_(),v("span",ld,"管理")):R("",!0),P.operate_rights==2?(_(),v("span",ad,"编辑")):R("",!0),P.operate_rights==1?(_(),v("span",rd,"查看")):R("",!0),s(C(it))])]),_:2},1024))],64)):R("",!0),k.key==="action"?(_(),v(M,{key:2},[r.value==4&&P.user_name!=d.value?(_(),v(M,{key:0},[P.role_type!=1&&P.is_creator!=1?(_(),v("a",{key:0,onClick:z=>U(P)},"移除",8,dd)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),s(ko,{onOk:h,ref_key:"addCollaboratorRef",ref:y},null,512)]),_:1})}}},_d=T(cd,[["__scopeId","data-v-64f2a2fa"]]),ud={class:"actions-box"},pd={key:0,class:"library-list"},md=["onClick"],hd={class:"library-name"},vd={class:"library-intro"},fd={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(m){const a=L(!1),{robotInfo:d,getRobot:n}=H("robotInfo"),r=m,o=B({work_flow_ids:[]}),t=L(null),h=G(()=>r.robotList.filter(g=>o.work_flow_ids.includes(g.id))),y=g=>{let c=o.work_flow_ids.indexOf(g.id);o.work_flow_ids.splice(c,1),U()},x=g=>{o.work_flow_ids=[...g],U()},f=()=>{t.value.open([...o.work_flow_ids])},U=()=>{let g={...Z(o)};g.work_flow_ids=g.work_flow_ids.join(","),to({id:d.id,...g}).then(c=>{F.success("保存成功"),n(d.id)})};return qe(()=>{o.work_flow_ids=d.work_flow_ids.split(",")}),(g,c)=>{const w=ne,u=te,b=we;return _(),N(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:a.value,"onUpdate:isEdit":c[0]||(c[0]=i=>a.value=i),bodyStyle:{padding:0}},{tip:l(()=>[s(w,{placement:"top"},{title:l(()=>[...c[1]||(c[1]=[e("span",null,"支持关联工作流",-1)])]),default:l(()=>[s(C(Q))]),_:1})]),extra:l(()=>[e("div",ud,[s(b,{gap:8},{default:l(()=>[s(u,{size:"small",onClick:f},{default:l(()=>[...c[2]||(c[2]=[S("添加技能",-1)])]),_:1})]),_:1})])]),default:l(()=>[h.value.length>0?(_(),v("div",pd,[(_(!0),v(M,null,K(h.value,i=>(_(),v("div",{class:"library-item",key:i.id},[e("span",{class:"close-btn",onClick:p=>y(i)},[s(C(ge))],8,md),e("div",hd,E(i.robot_name),1),e("div",vd,E(i.robot_intro),1)]))),128))])):R("",!0),s(wo,{ref_key:"robotSelectAlertRef",ref:t,onChange:x},null,512)]),_:1},8,["isEdit"])}}},bd=T(fd,[["__scopeId","data-v-e0ced8ed"]]),yd={class:"robot-info-box"},gd={class:"set-block"},kd={class:"switch-item"},wd={__name:"chat-cache",setup(m){const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=B({valid_time:"",cache_switch:0}),r=B({unix:"h",hValue:24,mValue:1440}),o=()=>{r.unix==="h"?n.valid_time=r.hValue*3600:n.valid_time=r.mValue*60,d({cache_config:{...n}})},t=()=>{o()},h=()=>{r.unix=="h"?r.hValue=parseInt(r.mValue/60):r.mValue=parseInt(r.hValue*60)},y=()=>{Y.confirm({title:"确定清空缓存?",icon:s(Se),content:"确定操作清空缓存吗？",onOk(){oo({id:a.id,robot_key:a.robot_key}).then(x=>{F.success("清空成功")})}})};return le(()=>a.cache_config,()=>{let x=a.cache_config||{};x=JSON.parse(JSON.stringify(x)),n.cache_switch=x.cache_switch,n.valid_time=x.valid_time,x.valid_time%3600==0?(r.unix="h",r.hValue=x.valid_time/3600):(r.unix="m",r.mValue=parseInt(x.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(x,f)=>{const U=$e,g=Ve,c=Oe,w=Qt,u=te,b=oe;return _(),N(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:l(()=>[...f[4]||(f[4]=[e("span",null,null,-1)])]),default:l(()=>[e("div",yd,[f[7]||(f[7]=S(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ",-1)),e("div",gd,[s(w,{compact:""},{default:l(()=>[r.unix=="h"?(_(),N(U,{key:0,onBlur:o,precision:0,value:r.hValue,"onUpdate:value":f[0]||(f[0]=i=>r.hValue=i),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(_(),N(U,{key:1,onBlur:o,precision:0,value:r.mValue,"onUpdate:value":f[1]||(f[1]=i=>r.mValue=i),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),s(c,{value:r.unix,"onUpdate:value":f[2]||(f[2]=i=>r.unix=i),style:{width:"70px"},onChange:h},{default:l(()=>[s(g,{value:"h"},{default:l(()=>[...f[5]||(f[5]=[S("小时",-1)])]),_:1}),s(g,{value:"m"},{default:l(()=>[...f[6]||(f[6]=[S("分钟",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])]),e("div",kd,[s(u,{onClick:y,size:"small"},{default:l(()=>[...f[8]||(f[8]=[S("清空缓存",-1)])]),_:1}),s(b,{onChange:t,checkedValue:1,unCheckedValue:0,checked:n.cache_switch,"onUpdate:checked":f[3]||(f[3]=i=>n.cache_switch=i),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])]),_:1})}}},xd=T(wd,[["__scopeId","data-v-e779aa9b"]]),$d={key:0},Cd={key:1},Sd={key:2,placeholder:"请选择默认值"},qd={key:3,placeholder:"请选择默认值"},Ld={class:"drag-btn"},Id={__name:"add-variable-modal",emits:["ok"],setup(m,{expose:a,emit:d}){const n=je().query,r=L(!1),o=d,t=B({robot_key:n.robot_key,id:"",variable_type:"input_string",variable_key:"",variable_name:"",max_input_length:10,default_value:"",must_input:!1,options:[{label:""}]}),h=G(()=>t.options.filter(u=>u.label)),y=(u={})=>{t.id=u.id||"",t.variable_type=u.variable_type||"input_string",t.variable_key=u.variable_key||"",t.variable_name=u.variable_name||"",t.max_input_length=u.max_input_length||10,t.default_value=u.default_value||"",t.must_input=u.must_input=="1",t.options=u.options||[{label:""}],r.value=!0},x=(u,b)=>b?/^[a-zA-Z_]+$/.test(b)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key"),f=L(),U=()=>{f.value.validate().then(()=>{let u=[];if(t.variable_type=="select_one"&&(u=t.options.filter(i=>i.label!=""),u.length==0))return F.error("请填写选项");let b=t.max_input_length;(t.variable_type=="select_one"||t.variable_type=="checkbox_switch")&&(b=1),so({...t,max_input_length:b,must_input:t.must_input?1:0,options:JSON.stringify(u)}).then(i=>{F.success(t.id?"更新成功":"创建成功"),r.value=!1,o("ok")})})},g=()=>{t.options.push({label:""})},c=u=>{t.options.length>1&&t.options.splice(u,1)},w=()=>{t.options=[{label:""}],t.variable_type=="checkbox_switch"?t.default_value="2":t.default_value=void 0};return a({show:y}),(u,b)=>{const i=Ve,p=Oe,q=ze,k=me,P=$e,z=at,V=te,D=ie,J=Gt,ee=Ee,O=Y;return _(),v("div",null,[s(O,{open:r.value,"onUpdate:open":b[10]||(b[10]=I=>r.value=I),title:"字段详情",onOk:U,width:648,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"70vh","overflow-y":"auto","padding-right":"12px"}},{default:l(()=>[s(ee,{model:t,ref_key:"formRef",ref:f,layout:"vertical","label-col":{span:4},"wrapper-col":{span:24}},{default:l(()=>[s(q,{label:"字段类型",name:"variable_type"},{default:l(()=>[s(p,{onChange:w,value:t.variable_type,"onUpdate:value":b[0]||(b[0]=I=>t.variable_type=I),placeholder:"请选择字段类型"},{default:l(()=>[s(i,{value:"input_string"},{default:l(()=>[...b[11]||(b[11]=[S("文本",-1)])]),_:1}),s(i,{value:"input_number"},{default:l(()=>[...b[12]||(b[12]=[S("数字",-1)])]),_:1}),s(i,{value:"select_one"},{default:l(()=>[...b[13]||(b[13]=[S("下拉单选",-1)])]),_:1}),s(i,{value:"checkbox_switch"},{default:l(()=>[...b[14]||(b[14]=[S("复选框",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s(q,{label:"字段key",name:"variable_key",rules:[{required:!0,validator:(I,se)=>x(I,se)}]},{default:l(()=>[s(k,{value:t.variable_key,"onUpdate:value":b[1]||(b[1]=I=>t.variable_key=I),maxLength:10,placeholder:"请输入字段key"},null,8,["value"])]),_:1},8,["rules"]),s(q,{label:"字段名",name:"variable_name",rules:[{required:!0}]},{default:l(()=>[s(k,{value:t.variable_name,"onUpdate:value":b[2]||(b[2]=I=>t.variable_name=I),maxLength:10,placeholder:"请输入字段名"},null,8,["value"])]),_:1}),["input_string","input_number"].includes(t.variable_type)?(_(),N(q,{key:0,label:"最大长度",name:"max_input_length"},{default:l(()=>[s(P,{value:t.max_input_length,"onUpdate:value":b[3]||(b[3]=I=>t.max_input_length=I),placeholder:"请输入",precision:0,min:1,max:50},null,8,["value"])]),_:1})):R("",!0),s(q,{label:"默认值",name:"default_value"},{default:l(()=>[t.variable_type=="input_string"?(_(),v("div",$d,[s(k,{value:t.default_value,"onUpdate:value":b[4]||(b[4]=I=>t.default_value=I),placeholder:"请输入默认值"},null,8,["value"])])):R("",!0),t.variable_type=="input_number"?(_(),v("div",Cd,[s(P,{maxLength:50,style:{width:"100%"},stringMode:"",value:t.default_value,"onUpdate:value":b[5]||(b[5]=I=>t.default_value=I),placeholder:"请输入默认值"},null,8,["value"])])):R("",!0),t.variable_type=="select_one"?(_(),v("div",Sd,[s(p,{value:t.default_value,"onUpdate:value":b[6]||(b[6]=I=>t.default_value=I),style:{width:"100%"}},{default:l(()=>[(_(!0),v(M,null,K(h.value,I=>(_(),N(i,{value:I.label},{default:l(()=>[S(E(I.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])):R("",!0),t.variable_type=="checkbox_switch"?(_(),v("div",qd,[s(p,{value:t.default_value,"onUpdate:value":b[7]||(b[7]=I=>t.default_value=I),style:{width:"100%"}},{default:l(()=>[s(i,{value:"1"},{default:l(()=>[...b[15]||(b[15]=[S("选中",-1)])]),_:1}),s(i,{value:"2"},{default:l(()=>[...b[16]||(b[16]=[S("不选中",-1)])]),_:1})]),_:1},8,["value"])])):R("",!0)]),_:1}),t.variable_type!="checkbox_switch"?(_(),N(q,{key:1,label:null,name:"must_input"},{default:l(()=>[s(z,{checked:t.must_input,"onUpdate:checked":b[8]||(b[8]=I=>t.must_input=I)},{default:l(()=>[...b[17]||(b[17]=[S("必填",-1)])]),_:1},8,["checked"])]),_:1})):R("",!0),t.variable_type==="select_one"?(_(),N(q,{key:2,label:"选项",name:"options"},{default:l(()=>[s(V,{type:"dashed",onClick:g},{default:l(()=>[...b[18]||(b[18]=[S("+ 添加选项",-1)])]),_:1}),s(J,null,{default:l(()=>[s(C(Ne),{modelValue:t.options,"onUpdate:modelValue":b[9]||(b[9]=I=>t.options=I),"item-key":"index",group:"table-rows",handle:".drag-btn"},{item:l(({element:I,index:se})=>[(_(),v("div",{key:se,class:"option-item"},[e("span",Ld,[s(D,{name:"drag"})]),s(k,{value:I.label,"onUpdate:value":W=>I.label=W,maxLength:50,placeholder:"请输入选项标签"},null,8,["value","onUpdate:value"]),s(V,{type:"link",danger:"",onClick:W=>c(se)},{default:l(()=>[...b[19]||(b[19]=[S("删除",-1)])]),_:1},8,["onClick"])]))]),_:1},8,["modelValue"])]),_:1})]),_:1})):R("",!0)]),_:1},8,["model"])]),_:1},8,["open"])])}}},Rd=T(Id,[["__scopeId","data-v-560786fa"]]),Ud={class:"actions-box"},Ed={class:"form-box"},Od={class:"variable-list-box"},Vd={class:"variable-info-block"},Pd={class:"type-tags"},Ad={class:"btn-box"},Nd=["onClick"],Dd=["onClick"],Md={__name:"index",setup(m){const a=Ae();let d={input_string:"string",input_number:"number",select_one:"string",checkbox_switch:"boolean"};const n=G(()=>a.chatVariables),r=L(null),o=()=>{if(n.value.length>=10)return F.error("最多添加10个变量");r.value.show()},t=x=>{r.value.show(JSON.parse(JSON.stringify(x)))},h=()=>{a.fetchChatVariables()},y=x=>{Y.confirm({title:"删除确认?",icon:s(Se),content:`确认删除该变量【${x.variable_name}】?`,okType:"danger",onOk(){no({robot_key:x.robot_key,id:x.id}).then(f=>{F.success("删除成功"),h()})}})};return ye(()=>{}),(x,f)=>{const U=ne,g=te,c=we,w=ie,u=Xt,b=Ht,i=Zt;return _(),N(X,{class:"setting-box",title:"变量","icon-name":"variable-icon"},{tip:l(()=>[s(U,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...f[0]||(f[0]=[e("span",null,"变量将以表单形式让用户在对话前填写，用户填写的表单内容将自动替换提示词中的变量。提示词中输入/可选择变量",-1)])]),default:l(()=>[s(C(Q))]),_:1})]),extra:l(()=>[e("div",Ud,[s(c,{gap:8},{default:l(()=>[s(g,{size:"small",onClick:o},{default:l(()=>[...f[1]||(f[1]=[S("新增变量",-1)])]),_:1})]),_:1})])]),default:l(()=>[e("div",Ed,[e("div",Od,[(_(!0),v(M,null,K(n.value,p=>(_(),v("div",{class:"variable-item",key:p.id},[e("div",Vd,[e("span",{class:ae({"is-required":p.must_input==1})},E(p.variable_key),3),e("span",null,"（"+E(p.variable_name)+"）",1),e("span",Pd,E(C(d)[p.variable_type]),1)]),s(i,null,{overlay:l(()=>[s(b,null,{default:l(()=>[s(u,null,{default:l(()=>[e("a",{onClick:q=>t(p)},"编 辑",8,Nd)]),_:2},1024),s(u,null,{default:l(()=>[e("a",{onClick:q=>y(p)},"删 除",8,Dd)]),_:2},1024)]),_:2},1024)]),default:l(()=>[e("div",Ad,[s(w,{name:"more-cycle"})])]),_:2},1024)]))),128))])]),s(Rd,{ref_key:"addVariableModalRef",ref:r,onOk:h},null,512)]),_:1})}}},Td=T(Md,[["__scopeId","data-v-e41cfbb3"]]),jd={class:"robot-info-box"},zd={class:"robot-prompt"},Bd={__name:"answer-prompt",setup(m){L(!1);const{robotInfo:a,updateRobotInfo:d}=H("robotInfo"),n=o=>{d({})},r=()=>{a.tips_before_answer_content,a.tips_before_answer_content==""&&(a.tips_before_answer_content="思考中、请稍等"),n()};return(o,t)=>{const h=me,y=oe;return _(),N(X,{class:"setting-box",title:"答案生成中提示语","icon-name":"suggested-issues"},{extra:l(()=>[...t[2]||(t[2]=[e("span",null,null,-1)])]),default:l(()=>[e("div",jd,[e("div",zd,[t[3]||(t[3]=S(" 开启后，WebAPP、嵌入网站对外服务中，答案生成前会显示提示语 ",-1)),s(h,{value:C(a).tips_before_answer_content,"onUpdate:value":t[0]||(t[0]=x=>C(a).tips_before_answer_content=x),style:{width:"280px"},maxLength:10,placeholder:"请输入",onBlur:r},null,8,["value"])])]),s(y,{onChange:n,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:C(a).tips_before_answer_switch,"onUpdate:checked":t[1]||(t[1]=x=>C(a).tips_before_answer_switch=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Jd=T(Bd,[["__scopeId","data-v-a03407ec"]]),Kd={key:0,class:"robot-config-page"},Fd={class:"setting-box"},Wd={class:"setting-box"},Qd={class:"setting-box"},Gd={class:"setting-box"},Hd={class:"setting-box"},Xd={class:"setting-box"},Zd={class:"setting-box"},Yd={class:"setting-box"},ec={class:"setting-box"},tc={class:"setting-box"},oc={class:"setting-box"},sc={class:"setting-box"},nc={class:"setting-box"},ic={class:"setting-box"},lc={class:"setting-box"},ac={class:"setting-box"},rc={class:"setting-box"},dc={key:1,class:"robot-config-page"},cc={key:2,class:"robot-config-page"},Ze="/robot/config/basic-config/activeKey",_c={__name:"index",setup(m){const a=Ae(),d=L(null),{robotInfo:n}=xt(a),{getRobot:r,fetchChatVariables:o}=a,t=_o(),h=()=>{d.value.scrollTop=d.value.scrollHeight},y=L(+localStorage.getItem(Ze)||1),x=L(!1),f=B(n.value),U=b=>{let i=JSON.parse(JSON.stringify(b));b.robot_avatar&&(i.robot_avatar=new File([b.robot_avatar],b.robot_avatar.name)),!i.op_type_relation_library&&f.op_type_relation_library&&delete f.op_type_relation_library,Object.assign(f,i),w()},g=L([]),c=()=>{io({application_type:1}).then(b=>{g.value=b.data||[]})};$t("robotInfo",{robotInfo:f,updateRobotInfo:U,scrollBoxToBottom:h,getRobot:r});const w=()=>{let b;f.robot_avatar&&(b=new File([f.robot_avatar],f.robot_avatar.name));let i=JSON.parse(JSON.stringify(Z(f)));b&&(i.robot_avatar=b);let p=i.welcomes;p.question=p.question.map(k=>k.content),i.welcomes=JSON.stringify(p),i.prompt_struct=JSON.stringify(i.prompt_struct);let q=i.unknown_question_prompt;q.question=q.question.map(k=>k.content),i.unknown_question_prompt=JSON.stringify(q),i.cache_config=JSON.stringify(i.cache_config),delete i.robot_avatar_url,x.value=!0,lo(i).then(k=>{if(k.res!=0)return F.error(k.msg);x.value=!1,F.success("保存成功"),r(f.id)}).catch(()=>{x.value=!1})},u=()=>{localStorage.setItem(Ze,y.value)};return ye(()=>{c(),t.getAllmodelList(),o()}),(b,i)=>{const p=st,q=nt;return _(),v(M,null,[s(q,{class:"tab-wrapper",onChange:u,activeKey:y.value,"onUpdate:activeKey":i[0]||(i[0]=k=>y.value=k)},{default:l(()=>[(_(),N(p,{key:1,tab:"基础配置"})),R("",!0),(_(),N(p,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),y.value==1?(_(),v("div",Kd,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:d},[e("div",Fd,[s(Fo)]),e("div",Wd,[s(Bl)]),e("div",Qd,[s(Si)]),e("div",Gd,[s(lr)]),e("div",Hd,[s(xd)]),e("div",Xd,[s(Bn,{robotList:g.value},null,8,["robotList"])]),e("div",Zd,[s(bd,{robotList:g.value},null,8,["robotList"])]),e("div",Yd,[s(sa)]),e("div",ec,[s(ma)]),e("div",tc,[s(Td)]),e("div",oc,[s(Ca)]),e("div",sc,[s(Da)]),e("div",nc,[s(Ea)]),e("div",ic,[s(Aa)]),e("div",lc,[s(Vr)]),e("div",ac,[s(Jd)]),e("div",rc,[s(Ar)])],512)])):R("",!0),y.value==2?(_(),v("div",dc,[s(Or)])):R("",!0),y.value==3?(_(),v("div",cc,[s(_d)])):R("",!0)],64)}}},Mc=T(_c,[["__scopeId","data-v-8c5676e2"]]);export{Mc as default};
