import{e as u,ab as W,f as F,w as ne,o as Y,Y as l,a5 as a,ae as L,ad as U,k as e,a7 as S,F as P,a9 as q,aa as Q,_ as t,u as C,a2 as i,G as O,a1 as N,af as X,b as re,ag as le,B as ie,r as z,a4 as A,J as ce,a3 as ue,a6 as H}from"./vue-chunks-CXJTX1FC.js";import{b as T,e as Z,j as de,d as ee,k as te,h as j,f as _e,R as pe,r as me}from"../../index-0TFHdij1.js";import{L as ve}from"./layout-logo-TPyfGsQR.js";import{g as be}from"./index-DvPlhmYy.js";import{u as he}from"./guide-CxuG4ATm.js";import{g as ye,b as oe,c as ae,h as J,D as se,i as fe,j as ke,F as K,k as ge,e as we,f as Ce,M as $e,a as Se}from"./ui-antd-D3ZAJ1Vq.js";import{v as xe}from"./validate-8MtiUsxW.js";import{u as Me}from"./global-DhgeMNAC.js";import"./utils-yZpnICoG.js";const Le={class:"navbar-wrapper"},Re={class:"navbar"},Pe={class:"nav-name"},Ie=["onClick"],Te={class:"nav-name"},Be={class:"down-icon"},Ue=["onClick"],Ne={class:"nav-name"},De={__name:"layout-navbar",setup(I){const _=Z(),n=he(),p=de(),b=u(()=>p.role_type),y=u(()=>+n.total_process),r=Q(),m=W(),g=u(()=>m.meta.activeMenu||""),x=u(()=>m.path.split("/")[1]),f=F(localStorage.getItem("local__robot_menu_key")||"robot_detail"),R=[{id:0,key:"explore",label:"explore",title:"探索",icon:"nav-explore",path:"/explore/index",permission:["ExploreManage"]},{id:1,key:"robot",label:"robot",title:"机器人",icon:"nav-robot",path:"/robot/list",permission:["RobotManage"]},{id:2,key:"library",label:"library",title:"知识库",icon:"nav-library",path:"/library/list",permission:["LibraryManage"]},{id:3,key:"PublicLibrary",label:"PublicLibrary",title:"文档",icon:"nav-doc",path:"/public-library/list",permission:["OpenLibDocManage"]},{id:4,key:"library-search",label:"library-search",title:"搜索",icon:"search",path:"/library-search/index",permission:["SearchManage"]},{id:5,key:"chat-monitor",label:"chat-monitor",title:"会话",icon:"nav-chat",path:"/chat-monitor/index",permission:["ChatSessionManage"]}],w=u(()=>_.top_navigate),M=u(()=>w.value.filter(o=>o.open).map(o=>R.find(k=>k.key===o.id)).filter(Boolean)),s=c=>{n.getUseGuideProcess(),r.push(c.path)},v=()=>{n.getUseGuideProcess(),r.push("/guide")},h=(c,o)=>{localStorage.setItem("local__robot_menu_key",c),f.value=c,$(o)},$=c=>{f.value=="robot_detail"?B():s(c)},B=async()=>{try{const{data:c=[]}=await be();if(c.length===0){r.push("/robot/list");return}const o=localStorage.getItem("last_local_robot_id");let k;o&&(k=c.find(d=>d.id==o)),k=k||c[0];const{id:D,robot_key:G,application_type:E}=k;r.push({path:`/robot/config/${E==1?"workflow":"basic-config"}`,query:{id:D,robot_key:G}})}catch{r.push("/robot/list")}};return ne(()=>m.path,()=>{},{immediate:!0}),Y(()=>{n.getUseGuideProcess()}),(c,o)=>{const k=ee,D=ae,G=oe,E=se;return t(),l("div",Le,[a("div",Re,[b.value==1?(t(),l("div",{key:0,class:U(["nav-menu",{active:g.value=="guide"}]),onClick:v},[e(k,{class:"nav-icon",name:"guide"}),a("span",Pe,"新手指引 ("+S(y.value)+"%)",1)],2)):L("",!0),(t(!0),l(P,null,q(M.value,d=>(t(),l(P,null,[C(te)(d.permission)?(t(),l(P,{key:0},[d.key==="robot"?(t(),l("div",{key:0,class:U(["nav-menu",{active:d.key===x.value||d.key===g.value}]),onClick:V=>$(d)},[e(k,{class:"nav-icon",name:d.icon},null,8,["name"]),a("span",Te,S(d.title),1),e(E,null,{overlay:i(()=>[e(G,null,{default:i(()=>[e(D,{key:"1",onClick:V=>h("robot_detail",d)},{default:i(()=>[a("div",{class:U(["robot-ment-item",{"robot-active-item":f.value=="robot_detail"}])},[e(C(J),{class:"anticon-check"}),o[0]||(o[0]=O(" 进入机器人详情 "))],2)]),_:2},1032,["onClick"]),e(D,{key:"2",onClick:V=>h("robot_list",d)},{default:i(()=>[a("div",{class:U(["robot-ment-item",{"robot-active-item":f.value=="robot_list"}])},[e(C(J)),o[1]||(o[1]=O(" 进入机器人管理 "))],2)]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[a("div",Be,[e(C(ye))])]),_:2},1024)],10,Ie)):(t(),l("div",{key:1,class:U(["nav-menu",{active:d.key===x.value||d.key===g.value}]),onClick:V=>s(d)},[e(k,{class:"nav-icon",name:d.icon},null,8,["name"]),a("span",Ne,S(d.title),1)],10,Ue))],64)):L("",!0)],64))),256))])])}}},Fe=T(De,[["__scopeId","data-v-27fabb91"]]),Oe={class:"layout-breadcrumb"},je={key:1,class:"page-title"},Ge={__name:"layout-breadcrumb",props:{title:{type:[String,Boolean],default:""},items:{type:[Array,Boolean],default:()=>[]}},setup(I){const _=I;return(n,p)=>{const b=X("router-link"),y=ke,r=fe;return t(),l("div",Oe,[_.items.length>0?(t(),N(r,{key:0},{default:i(()=>[(t(!0),l(P,null,q(_.items,(m,g)=>(t(),l(P,{key:m.title},[g!==_.items.length-1?(t(),N(y,{key:0},{default:i(()=>[e(b,{to:m.path},{default:i(()=>[O(S(m.title),1)]),_:2},1032,["to"])]),_:2},1024)):(t(),N(y,{key:1},{default:i(()=>[O(S(m.title),1)]),_:2},1024))],64))),128))]),_:1})):(t(),l("div",je,S(_.title),1))])}}},Ee=T(Ge,[["__scopeId","data-v-c69a461d"]]),Ve={class:"layout-footer"},qe={class:"copyright-text"},ze={__name:"layout-footer",setup(I){const _=j(),{t:n}=_e(),p=F(null);return Y(()=>{p.value=setInterval(()=>{setTimeout(()=>{_.refreshToken()},0)},pe)}),re(()=>{clearInterval(p.value),p.value=null}),(b,y)=>(t(),l("div",Ve,[a("div",qe,S(C(n)("common.copyright")),1)]))}},Ae=T(ze,[["__scopeId","data-v-ab337acb"]]),He={key:0,class:"user-dropdown"},Je=["src"],Ke={class:"user-name"},We=["onClick"],Ye={class:"menu-name"},Qe={__name:"user-dropdown",setup(I){const _=Z(),n=Q(),p=j(),{userInfo:b,avatar:y,user_name:r}=le(p),m=u(()=>r.value.length>11?r.value.substring(0,11)+"...":r.value),g=()=>{p.logoutConfirm(!0)},x=()=>{window.open("/#/user/model","_blank","noopener")},f=[{id:1,key:"robot",label:"robot",title:"应用",icon:"nav-robot",path:"/robot/list",permission:["RobotManage"]},{id:2,key:"library",label:"library",title:"知识库",icon:"nav-library",path:"/library/list",permission:["LibraryManage"]},{id:3,key:"PublicLibrary",label:"PublicLibrary",title:"文档",icon:"nav-doc",path:"/public-library/list",permission:["OpenLibDocManage"]},{id:4,key:"library-search",label:"library-search",title:"搜索",icon:"search",path:"/library-search/index",permission:["SearchManage"]},{id:5,key:"chat-monitor",label:"chat-monitor",title:"会话",icon:"nav-chat",path:"/chat-monitor/index",permission:["ChatSessionManage"]}],R=u(()=>_.top_navigate),w=u(()=>R.value.filter(v=>!v.open).map(v=>f.find(h=>h.key===v.id)).filter(Boolean)),M=s=>{n.push(s.path)};return(s,v)=>{const h=ee,$=ae,B=oe,c=se;return C(b)?(t(),l("div",He,[e(c,null,{overlay:i(()=>[e(B,null,{default:i(()=>[e($,null,{default:i(()=>[a("a",{class:"menu-item",href:"javascript:;",onClick:x},[e(h,{class:"menu-icon",name:"system-setting"}),v[1]||(v[1]=a("span",{class:"menu-name"},"系统管理",-1))])]),_:1}),(t(!0),l(P,null,q(w.value,o=>(t(),l(P,{key:o.id},[C(te)(o.permission)?(t(),N($,{key:0},{default:i(()=>[a("a",{class:"menu-item",href:"javascript:;",onClick:k=>M(o)},[e(h,{class:"menu-icon",name:o.icon},null,8,["name"]),a("span",Ye,S(o.title),1)],8,We)]),_:2},1024)):L("",!0)],64))),128)),e($,null,{default:i(()=>[a("a",{class:"menu-item",href:"javascript:;",onClick:g},[e(h,{class:"menu-icon",name:"logout"}),v[2]||(v[2]=a("span",{class:"menu-name"},"退出登录",-1))])]),_:1})]),_:1})]),default:i(()=>[a("div",{class:"user-dropdown-link",onClick:v[0]||(v[0]=ie(()=>{},["prevent"]))},[a("img",{class:"user-avatar",src:C(y),alt:""},null,8,Je),a("span",Ke,S(m.value),1),e(h,{name:"arrow-down",style:{"font-size":"16px",color:"#8c8c8c"}})])]),_:1})])):L("",!0)}}},Xe=T(Qe,[["__scopeId","data-v-4872fb7f"]]),Ze={class:"form-box"},et={__name:"reset-password",setup(I,{expose:_}){const n=j(),p=K.useForm,b=F(!0),y=F("重置登录密码"),r=z({password:"",check_password:"",id:n.userInfo.user_id}),m=z({password:[{message:"请输入登录密码",required:!0},{validator:async(M,s)=>!xe(s)&&s?Promise.reject("密码必须包含字母、数字或者字符中的两种，6-32位"):Promise.resolve()}],check_password:[{message:"请输入确认密码",required:!0},{validator:async(M,s)=>s!=r.password&&s?Promise.reject("两次输入的密码不一致"):Promise.resolve()}]}),{resetFields:g,validate:x,validateInfos:f}=p(r,m),R=()=>{x().then(()=>{me({...ce(r)}).then(M=>{Se.success("修改成功"),b.value=!1,n.reset(!0)})})},w=()=>{n.setResetPassModal()};return _({open}),(M,s)=>{const v=ge,h=Ce,$=we,B=K,c=$e;return t(),l("div",null,[e(c,{open:b.value,"onUpdate:open":s[2]||(s[2]=o=>b.value=o),title:y.value,onOk:R,width:"520px",onCancel:w},{default:i(()=>[e(v,{class:"alert-box",message:"您还未修改初始密码，为了保障您的数据安全，请您尽快重置密码。",type:"info","show-icon":""}),a("div",Ze,[e(B,{layout:"vertical"},{default:i(()=>[e($,A({label:"登录密码"},C(f).password),{default:i(()=>[e(h,{value:r.password,"onUpdate:value":s[0]||(s[0]=o=>r.password=o),placeholder:"密码必须包含字母、数字或者字符中的两种，6-32位"},null,8,["value"])]),_:1},16),e($,A({label:"确认密码"},C(f).check_password),{default:i(()=>[e(h,{value:r.check_password,"onUpdate:value":s[1]||(s[1]=o=>r.check_password=o),placeholder:"请重新输入密码"},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open","title"])])}}},tt=T(et,[["__scopeId","data-v-9de4c189"]]),ot={class:"admin-layout"},at={key:0,class:"layout-header-wrapper"},st={class:"layout-header"},nt={class:"header-left"},rt={class:"header-body"},lt={class:"header-right"},it={class:"item-box"},ct={class:"layout-body"},ut={key:0,class:"layout-breadcrumb-wrapper"},dt={key:1,class:"layout-footer-wrapper"},_t={__name:"index",setup(I){const _=Me(),n=W(),p=j(),b=u(()=>n.name!="robotWorkflow"?!1:_.hideLayoutTopAndBottom||!1),y=u(()=>n.meta.isCustomPage||!1),r=u(()=>n.meta.pageStyle||{}),m=u(()=>n.meta.bgColor||"#ffffff"),g=u(()=>n.meta.breadcrumb||[]),x=u(()=>n.meta.hideTitle||!1),f=u(()=>n.meta.title||!1),R=u(()=>{var w;return((w=p.userInfo)==null?void 0:w.d_pass)==1&&p.isShowResetPassModal});return(w,M)=>{const s=X("router-view");return t(),l("div",ot,[b.value?L("",!0):(t(),l("div",at,[a("div",st,[a("div",nt,[e(ve)]),a("div",rt,[e(Fe)]),a("div",lt,[a("div",it,[e(Xe)])])])])),a("div",ct,[y.value?ue(w.$slots,"default",{key:0},()=>[e(s)],!0):(t(),l("div",{key:1,class:"page-wrapper",style:H({"background-color":m.value})},[x.value?L("",!0):(t(),l("div",ut,[e(Ee,{items:g.value,title:f.value},null,8,["items","title"])])),a("div",{class:"page-container",style:H({...r.value})},[e(s)],4)],4))]),b.value?L("",!0):(t(),l("div",dt,[e(Ae)])),R.value?(t(),N(tt,{key:2})):L("",!0)])}}},wt=T(_t,[["__scopeId","data-v-85411cc0"]]);export{wt as default};
