{"version":3,"file":"index-XVLbk3qE.js","sources":["../../../../front-end/chat-ai-admin-vue/src/components/upload-img/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"upload-box\">\r\n    <!-- <input type=\"text\" v-model=\"inputVal\" @paste=\"pasteUpload()\"> -->\r\n    <a-input class=\"hidden-input\" ref=\"inputRef\" @paste=\"pasteUpload\"></a-input>\r\n    <div @mouseenter=\"handleMouseEnter\" @mouseleave=\"handleMouseLeave\">\r\n      <a-upload-dragger\r\n        v-model:fileList=\"fileList\"\r\n        name=\"file\"\r\n        :multiple=\"false\"\r\n        list-type=\"picture\"\r\n        :show-upload-list=\"false\"\r\n        accept=\".jpg,.png,.jpeg\"\r\n        :before-upload=\"beforeUpload\"\r\n        @drop=\"handleDrop\"\r\n      >\r\n        <div class=\"img-list-box\" @click.stop>\r\n          <div class=\"img-item\" v-for=\"(item, index) in imageUrl\" :key=\"index\">\r\n            <div class=\"mask-box\">\r\n              <EyeOutlined @click=\"preview(item)\" />\r\n              <DeleteOutlined @click=\"del(index)\" />\r\n            </div>\r\n            <img :src=\"item\" alt=\"\" />\r\n          </div>\r\n        </div>\r\n        <p class=\"upload-text\" :class=\"{ 'center-content': imageUrl.length == 0 }\">\r\n          {{ t('msg_upload_hint') }}\r\n        </p>\r\n      </a-upload-dragger>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from 'vue'\r\nimport { InboxOutlined, EyeOutlined, DeleteOutlined } from '@ant-design/icons-vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { uploadFile } from '@/api/app'\r\nimport { api as viewerApi } from 'v-viewer'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('components.upload-img.index')\r\nconst emit = defineEmits(['update:value'])\r\nconst fileList = ref([])\r\nconst imageUrl = ref([])\r\nconst inputVal = ref('')\r\nconst maxUploadNum = 3\r\nconst props = defineProps({\r\n  value: {\r\n    type: [String, Array],\r\n    default: ''\r\n  }\r\n})\r\nwatch(\r\n  () => props.value,\r\n  (val) => {\r\n    imageUrl.value = val\r\n  },\r\n  {\r\n    immediate: true\r\n  }\r\n)\r\nconst beforeUpload = (file) => {\r\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'\r\n\r\n  if (!isJpgOrPng) {\r\n    message.error(t('msg_invalid_format'))\r\n    return false\r\n  }\r\n\r\n  const isLt2M = file.size / 1024 < 1024 * 2\r\n  if (imageUrl.value.length >= maxUploadNum) {\r\n    return message.error(t('msg_max_limit'))\r\n  }\r\n  if (!isLt2M) {\r\n    message.error(t('msg_size_limit'))\r\n    return false\r\n  }\r\n  uploadFile({\r\n    category: 'library_image',\r\n    file\r\n  }).then((res) => {\r\n    imageUrl.value.push(res.data.link)\r\n    emit('update:value', imageUrl.value)\r\n  })\r\n  return false\r\n}\r\nconst preview = (img) => {\r\n  viewerApi({\r\n    images: [img]\r\n  })\r\n}\r\nconst del = (index) => {\r\n  imageUrl.value.splice(index, 1)\r\n}\r\n\r\nlet isUploading = false\r\nconst pasteUpload = async (e) => {\r\n  if (imageUrl.value.length >= maxUploadNum) {\r\n    return message.error(t('msg_max_limit'))\r\n  }\r\n  if (!(e.clipboardData && e.clipboardData.items)) {\r\n    message.error(t('msg_paste_not_supported'))\r\n    return\r\n  }\r\n  if (isUploading) {\r\n    return\r\n  }\r\n  try {\r\n    if (e.clipboardData || e.originalEvent || window.clipboardData) {\r\n      var clipboardData = e.clipboardData || e.originalEvent.clipboardData || window.clipboardData\r\n      var items = clipboardData.items\r\n      let file = null\r\n      // 搜索剪切板items\r\n      for (let i = 0; i < items.length; i++) {\r\n        if (items[i].type.indexOf('image') !== -1) {\r\n          file = items[i].getAsFile()\r\n          break\r\n        }\r\n      }\r\n      inputVal.value = ''\r\n      if (file) {\r\n        e.preventDefault()\r\n        isUploading = true\r\n        uploadFile({\r\n          category: 'library_image',\r\n          file\r\n        }).then((res) => {\r\n          isUploading = false\r\n          imageUrl.value.push(res.data.link)\r\n          emit('update:value', imageUrl.value)\r\n        })\r\n      } else {\r\n        message.error(t('msg_paste_invalid_image'))\r\n        isUploading = false\r\n        inputVal.value = ''\r\n      }\r\n    }\r\n  } catch (e) {\r\n    isUploading = false\r\n    message.error(t('msg_upload_failed'))\r\n  }\r\n}\r\n\r\nconst inputRef = ref(null)\r\nconst handleMouseEnter = ()=>{\r\n  // 移入鼠标 将input聚焦\r\n  inputRef.value.focus();\r\n}\r\nconst handleMouseLeave = ()=>{\r\n  // 移出鼠标 将input 取消焦点\r\n  inputRef.value.blur();\r\n}\r\nfunction handleDrop(e) {\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.upload-box {\r\n  &::v-deep(.ant-upload) {\r\n    padding: 0;\r\n  }\r\n  &::v-deep(.ant-upload.ant-upload-btn) {\r\n    padding: 16px;\r\n    min-height: 86px;\r\n  }\r\n  &::v-deep(.ant-upload.ant-upload-drag) {\r\n    border: none;\r\n    background: #f2f4f7;\r\n    &:hover {\r\n      background: #e6efff;\r\n    }\r\n  }\r\n  .upload-text {\r\n    margin-bottom: 0;\r\n    text-align: left;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n    color: #3a4559;\r\n    &.center-content {\r\n      margin-top: 16px;\r\n      text-align: center;\r\n    }\r\n  }\r\n}\r\n.img-list-box {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-bottom: 8px;\r\n  gap: 8px;\r\n  width: fit-content;\r\n  .img-item {\r\n    width: 104px;\r\n    height: 104px;\r\n    border-radius: 2px;\r\n    padding: 9px;\r\n    border: 1px solid #d9d9d9;\r\n    position: relative;\r\n    &:hover {\r\n      .mask-box {\r\n        opacity: 0.75;\r\n        span {\r\n          cursor: pointer;\r\n        }\r\n      }\r\n    }\r\n    .mask-box {\r\n      position: absolute;\r\n      border-radius: 4px;\r\n      left: 9px;\r\n      right: 9px;\r\n      top: 9px;\r\n      bottom: 9px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      background: #000;\r\n      color: #fff;\r\n      font-weight: 900;\r\n      font-size: 16px;\r\n      gap: 8px;\r\n      opacity: 0;\r\n      transition: all 0.3s;\r\n    }\r\n    img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n.hidden-input{\r\n  position: absolute;\r\n  left: 9999;\r\n  opacity: 0;\r\n}\r\n</style>"],"names":["maxUploadNum","t","useI18n","emit","__emit","fileList","ref","imageUrl","inputVal","props","__props","watch","val","beforeUpload","file","message","isLt2M","uploadFile","res","preview","img","viewerApi","del","index","isUploading","pasteUpload","clipboardData","items","i","inputRef","handleMouseEnter","handleMouseLeave","handleDrop","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_a_input","_createElementVNode","_component_a_upload_dragger","$event","_Fragment","_renderList","item","_hoisted_2","_unref","EyeOutlined","DeleteOutlined","_normalizeClass"],"mappings":"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"}