{"version":3,"file":"voice-message-B7-hRuYw.js","sources":["../../../../front-end/chat-ai-admin-vue/src/utils/textParseProcessing.js","../../../../front-end/chat-ai-admin-vue/src/components/cherry-markdown/index.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/voice-player.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-test/components/voice-message.vue"],"sourcesContent":["// 清除 markdown 标记(...)\r\nfunction clearMarkdownTag(str) {\r\n  // 过滤点开头的```markdown 和结束的```并保留中间的内容\r\n  str = str.replace(/```markdown([\\s\\S]*)```/g, (_, content) => {\r\n    console.log(content)\r\n    return content.trim()\r\n  })\r\n  // 过滤掉没有```结束符的```markdown\r\n  str = str.replace(/```markdown/g, '')\r\n  return str\r\n}\r\n\r\nfunction textParseProcessing(str) {\r\n  str = clearMarkdownTag(str)\r\n  return str\r\n}\r\n\r\nexport default textParseProcessing\r\n","<style lang=\"less\">\r\n.vue-markdown {\r\n  white-space: pre-wrap;\r\n  width: 100%;\r\n  img {\r\n    width: auto;\r\n    height: auto;\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n    display: block;\r\n    margin-top: 8px;\r\n    min-height: 100px;\r\n  }\r\n  p:last-child {\r\n    margin-bottom: 0;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"vue-markdown cherry-markdown\" v-html=\"html\"></div>\r\n</template>\r\n\r\n<script setup>\r\n// cherry-markdow 配置详解 https://github.com/Tencent/cherry-markdown/wiki/%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%85%A8%E8%A7%A3\r\nimport CherryEngine from 'cherry-markdown/dist/cherry-markdown.engine.core'\r\nimport { computed } from 'vue'\r\nimport textParseProcessing from '@/utils/textParseProcessing'\r\n\r\nconst props = defineProps({\r\n  content: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst md = new CherryEngine({\r\n  engine: {\r\n    global: {\r\n      classicBr: true,\r\n      flowSessionContext: true\r\n    },\r\n    syntax: {\r\n      codeBlock: {\r\n        theme: 'dark', // 默认为深色主题\r\n        wrap: true, // 超出长度是否换行，false则显示滚动条\r\n        lineNumber: false, // 默认显示行号\r\n        copyCode: true, // 是否显示“复制”按钮\r\n        editCode: false, // 是否显示“编辑”按钮\r\n        changeLang: true // 是否显示“切换语言”按钮\r\n      },\r\n      link: {\r\n        target: '_blank',\r\n      },\r\n      autoLink: {\r\n        target: '_blank',\r\n        enableShortLink: false\r\n      },\r\n      header: {\r\n        anchorStyle: 'none'\r\n      },\r\n      mathBlock: {\r\n        plugins: true, \r\n        engine: 'MathJax', // katex或MathJax\r\n        src: './libs/MathJax/es5/tex-svg.js',\r\n        // src: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js',\r\n      },\r\n      inlineMath: {\r\n        engine: 'MathJax', // katex或MathJax\r\n      },\r\n    }\r\n  }\r\n})\r\n\r\nconst html = computed(() => {\r\n  let str = textParseProcessing(props.content)\r\n  return md.makeHtml(str)\r\n})\r\n</script>\r\n","<template>\r\n  <div class=\"voice-play-container\">\r\n    <div class=\"voice-controls\">\r\n      <button\r\n        class=\"play-btn\"\r\n        :class=\"{ playing: isPlaying }\"\r\n        @click=\"togglePlay\"\r\n        :disabled=\"!url || loading\"\r\n      >\r\n        <div class=\"play-content\" v-if=\"isPlaying\">\r\n          <img\r\n            class=\"icon1\"\r\n            src=\"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/voice/play-active.gif\"\r\n            alt=\"\"\r\n          />\r\n          <span class=\"text1\">{{ loading ? t('label_loading') : t('label_playing') }}...</span>\r\n          <span class=\"text2\">{{ t('label_click_to_pause') }} </span>\r\n          <img class=\"icon2\" src=\"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/voice/open.svg\" alt=\"\">\r\n        </div>\r\n        <div class=\"play-content\" v-else>\r\n          <img\r\n            class=\"icon1\"\r\n            src=\"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/voice/play-static.svg\"\r\n            alt=\"\"\r\n          />\r\n          <span class=\"text1\">{{ t('label_voice_message') }}</span>\r\n          <span class=\"text2\">{{ t('label_click_to_play') }}</span>\r\n          <img class=\"icon2\" src=\"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/voice/stop.svg\" alt=\"\">\r\n        </div>\r\n      </button>\r\n      <div v-if=\"showProgress\" class=\"progress-container\">\r\n        <input\r\n          type=\"range\"\r\n          class=\"progress-bar\"\r\n          v-model=\"currentTime\"\r\n          :max=\"duration\"\r\n          @input=\"onProgressChange\"\r\n        />\r\n        <div class=\"time-info\">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</div>\r\n      </div>\r\n    </div>\r\n    <audio\r\n      ref=\"audioRef\"\r\n      :src=\"url\"\r\n      @loadedmetadata=\"onLoadedMetadata\"\r\n      @timeupdate=\"onTimeUpdate\"\r\n      @ended=\"onEnded\"\r\n      @error=\"onError\"\r\n    ></audio>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-test.components.voice-player')\r\n\r\nconst props = defineProps({\r\n  url: { type: String, default: '' },\r\n  showProgress: { type: Boolean, default: false }\r\n})\r\n\r\nconst audioRef = ref(null)\r\nconst isPlaying = ref(false)\r\nconst duration = ref(0)\r\nconst currentTime = ref(0)\r\nconst loading = ref(false)\r\n\r\n// 播放/暂停切换\r\nconst togglePlay = () => {\r\n  if (!props.url) return\r\n\r\n  const audio = audioRef.value\r\n  if (isPlaying.value) {\r\n    audio.pause()\r\n    isPlaying.value = false\r\n  } else {\r\n    loading.value = true\r\n    audio\r\n      .play()\r\n      .then(() => {\r\n        isPlaying.value = true\r\n        loading.value = false\r\n      })\r\n      .catch((error) => {\r\n        console.error(t('msg_play_failed'), error)\r\n        loading.value = false\r\n      })\r\n  }\r\n}\r\n\r\n// 音频元数据加载完成\r\nconst onLoadedMetadata = () => {\r\n  duration.value = audioRef.value.duration\r\n}\r\n\r\n// 时间更新\r\nconst onTimeUpdate = () => {\r\n  currentTime.value = audioRef.value.currentTime\r\n}\r\n\r\n// 播放结束\r\nconst onEnded = () => {\r\n  isPlaying.value = false\r\n  currentTime.value = 0\r\n}\r\n\r\n// 音频错误处理\r\nconst onError = () => {\r\n  console.error(t('msg_audio_error'))\r\n  isPlaying.value = false\r\n  loading.value = false\r\n}\r\n\r\n// 进度条改变\r\nconst onProgressChange = () => {\r\n  if (audioRef.value) {\r\n    audioRef.value.currentTime = currentTime.value\r\n  }\r\n}\r\n\r\n// 格式化时间显示\r\nconst formatTime = (time) => {\r\n  if (isNaN(time)) return '00:00'\r\n  const minutes = Math.floor(time / 60)\r\n  const seconds = Math.floor(time % 60)\r\n  return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n}\r\n\r\n// 监听URL变化，重新设置音频源\r\nwatch(\r\n  () => props.url,\r\n  (newUrl) => {\r\n    if (audioRef.value) {\r\n      // 重置状态\r\n      isPlaying.value = false\r\n      currentTime.value = 0\r\n      audioRef.value.load() // 重新加载音频\r\n    }\r\n  }\r\n)\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.voice-play-container {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n\r\n  .voice-controls {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8px;\r\n\r\n    .play-btn {\r\n      padding: 12px;\r\n      border: 1px solid #d9d9d9;\r\n      border-radius: 16px;\r\n      background: #fff;\r\n      cursor: pointer;\r\n      transition: all 0.3s;\r\n      height: 46px;\r\n\r\n      &:hover:not(:disabled) {\r\n        border-color: #2475fc;\r\n        background: #e6f7ff;\r\n      }\r\n\r\n      &:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n    }\r\n\r\n    .play-content {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n      .icon1 {\r\n        width: 16px;\r\n      }\r\n      .text1 {\r\n        color: #262626;\r\n        font-size: 14px;\r\n      }\r\n      .text2 {\r\n        color: #8c8c8c;\r\n        font-size: 14px;\r\n        margin-right: 4px;\r\n      }\r\n      .icon2{\r\n        width: 16px;\r\n      }\r\n    }\r\n    .progress-container {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 10px;\r\n      width: 200px;\r\n\r\n      .progress-bar {\r\n        flex: 1;\r\n        height: 4px;\r\n        -webkit-appearance: none;\r\n        background: #f0f0f0;\r\n        border-radius: 2px;\r\n\r\n        &::-webkit-slider-thumb {\r\n          -webkit-appearance: none;\r\n          width: 16px;\r\n          height: 16px;\r\n          border-radius: 50%;\r\n          background: #1890ff;\r\n          cursor: pointer;\r\n        }\r\n      }\r\n\r\n      .time-info {\r\n        font-size: 12px;\r\n        color: #666;\r\n        min-width: 50px;\r\n        text-align: right;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"voice-list-box\">\r\n    <div class=\"voice-item\" v-for=\"(item, index) in props.voice_content\" :key=\"index\">\r\n      <VoicePlayer :url=\"item.voice\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, nextTick } from 'vue'\r\nimport VoicePlayer from './voice-player.vue'\r\nconst props = defineProps({\r\n  voice_content: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\r\n.voice-list-box{\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n  margin-top: 8px;\r\n}\r\n\r\n</style>\r\n"],"names":["clearMarkdownTag","str","_","content","textParseProcessing","props","__props","md","CherryEngine","html","computed","_createElementBlock","t","useI18n","audioRef","ref","isPlaying","duration","currentTime","loading","togglePlay","audio","error","onLoadedMetadata","onTimeUpdate","onEnded","onError","onProgressChange","formatTime","time","minutes","seconds","watch","newUrl","_openBlock","_hoisted_1","_createElementVNode","_hoisted_2","_normalizeClass","_hoisted_4","_hoisted_5","_toDisplayString","_unref","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","$event","_hoisted_12","_Fragment","item","index","_createVNode","VoicePlayer"],"mappings":"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"}