import{b as M,d as V,by as H,aC as D}from"../../index-ZzVqUZIR.js";import{_ as G}from"./cu-scroll-CeyRYmkN.js";import{_ as K}from"./empty-DkpCLaix.js";import{ab as I,f as y,r as A,e as O,Y as l,_ as n,a5 as e,ae as c,k as a,a2 as p,G as m,a1 as w,u as h,F as R,a9 as z,ad as J,a7 as d,aa as P}from"./vue-chunks-yZ4gwLzA.js";import{_ as Q}from"./recommendation-AQ4_FPQ9.js";import{M as W}from"./model-select-DoQzbsHY.js";import{W as Y,B as j,g as X,ar as Z,ad as B,p as ee,aC as se,G as te,H as oe,a as T,ah as ne,bB as ie}from"./ui-antd-BJtyvQX6.js";import"./utils-smNh_pj2.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./index-CkBKI6U4.js";const le={class:"recall-settings-box"},ae={class:"form-box"},re={class:"form-item"},de={class:"form-item-body"},_e={class:"form-item"},ue={class:"form-item"},ce={class:"form-item-label"},me={class:"form-item-body"},ve={class:"retrieval-mode-items"},pe=["onClick"],fe={class:"retrieval-mode-title"},ye={class:"title-text"},ke={key:0,style:{width:"32px"},src:Q,alt:""},be={class:"retrieval-mode-desc"},he={class:"form-item"},xe={class:"form-item-label"},ge={class:"form-item-body"},$e={class:"number-box"},qe={class:"number-slider-box"},we={class:"number-input-box"},Re={key:0,class:"form-item"},Ne={class:"form-item-label"},Ce={class:"form-item-body"},Te={class:"number-box"},ze={class:"number-slider-box"},Le={class:"number-input-box"},Se={class:"form-item"},Ue={class:"form-item-label"},Be={class:"form-item-body"},Me={__name:"recall-testing-form",emits:["save","load"],setup(E,{expose:N,emit:C}){const k=I(),v=y(!1),b=C,f=y(!0),x=y([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=A({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:k.query.id}),u=O(()=>f.value?x.value.filter(_=>_.value==t.search_type):x.value),r=_=>{t.search_type=_},g=()=>{if(!t.similarity)return T.error("请输入相似度");if(!t.size)return T.error("请输入分段数");if(!t.question)return T.error("请输入测试问题");let _={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(_.rerank_model_config_id=t.rerank_model_config_id,_.rerank_use_model=t.rerank_use_model),v.value=!0,b("load"),H(_).then(s=>{b("save",s.data)}).catch(()=>{b("save",[])}).finally(()=>{v.value=!1})};return N({open}),(_,s)=>{const i=Y,$=j,q=V,L=ee,S=se,U=te,F=oe;return n(),l("div",le,[s[17]||(s[17]=e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),e("div",ae,[e("div",re,[e("div",de,[a(i,{style:{height:"76px"},value:t.question,"onUpdate:value":s[0]||(s[0]=o=>t.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",_e,[a($,{loading:v.value,onClick:g,type:"primary",block:""},{default:p(()=>[...s[9]||(s[9]=[m("测试",-1)])]),_:1},8,["loading"])]),e("div",ue,[e("div",ce,[e("div",{class:"hover-label",onClick:s[1]||(s[1]=o=>f.value=!f.value)},[s[10]||(s[10]=m(" 检索模式 ",-1)),f.value?(n(),w(h(X),{key:0})):(n(),w(h(Z),{key:1}))])]),e("div",me,[e("div",ve,[(n(!0),l(R,null,z(u.value,o=>(n(),l("div",{class:J(["retrieval-mode-item",{active:t.search_type==o.value}]),key:o.value,onClick:ss=>r(o.value)},[t.search_type==o.value?(n(),w(q,{key:0,class:"check-arrow",name:"check-arrow-filled"})):c("",!0),e("div",fe,[a(q,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",ye,d(o.title),1),o.isRecommendation?(n(),l("img",ke)):c("",!0)]),e("div",be,d(o.desc),1)],10,pe))),128))])])]),e("div",he,[e("div",xe,[s[12]||(s[12]=e("span",null,"Top K ",-1)),a(L,null,{title:p(()=>[...s[11]||(s[11]=[m("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:p(()=>[a(h(B),{class:"question-icon"})]),_:1})]),e("div",ge,[e("div",$e,[e("div",qe,[a(S,{class:"custom-slider",value:t.size,"onUpdate:value":s[2]||(s[2]=o=>t.size=o),min:1,max:10},null,8,["value"])]),e("div",we,[a(U,{value:t.size,"onUpdate:value":s[3]||(s[3]=o=>t.size=o),min:1,max:10},null,8,["value"])])])])]),t.search_type<=2?(n(),l("div",Re,[e("div",Ne,[s[14]||(s[14]=e("span",null,"相似度阈值 ",-1)),a(L,null,{title:p(()=>[...s[13]||(s[13]=[m("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:p(()=>[a(h(B),{class:"question-icon"})]),_:1})]),e("div",Ce,[e("div",Te,[e("div",ze,[a(S,{class:"custom-slider",value:t.similarity,"onUpdate:value":s[4]||(s[4]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Le,[a(U,{value:t.similarity,"onUpdate:value":s[5]||(s[5]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):c("",!0),e("div",Se,[e("div",Ue,[s[15]||(s[15]=e("span",null,"Rerank模型",-1)),s[16]||(s[16]=m("   ",-1)),a(F,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":s[6]||(s[6]=o=>t.rerank_status=o)},null,8,["checked"])]),e("div",Be,[a(W,{modelType:"RERANK",modeName:t.rerank_use_model,"onUpdate:modeName":s[7]||(s[7]=o=>t.rerank_use_model=o),modeId:t.rerank_model_config_id,"onUpdate:modeId":s[8]||(s[8]=o=>t.rerank_model_config_id=o),style:{width:"320px"},placeholder:"请选择Rerank模型"},null,8,["modeName","modeId"])])])])])}}},Ve=M(Me,[["__scopeId","data-v-95f1b47f"]]),Ie={class:"recall-testing-box"},Oe={class:"recall-from-box"},Ee={class:"content-list-box"},Fe={key:0,class:"empty-box"},He={class:"top-block"},De={class:"title"},Ge={key:0,class:"ml4"},Ke={class:"info-block"},Ae=["onClick"],Je={key:0},Pe={class:"gray-text"},Qe={key:0,class:"content-box"},We={key:1,class:"content-box similar-questions-box"},Ye={class:"similar-questions-list"},je={key:2,class:"content-box"},Xe=["innerHTML"],Ze={key:2,class:"loading-box"},es={__name:"recall-testing",setup(E){I(),P();const N=D(),C=y(!1),k=y(!1),v=y([]),b=O(()=>N.type),f=(u=[])=>{k.value=!1,u.forEach(r=>{r.similar_questions&&(r.similar_questions=JSON.parse(r.similar_questions))}),v.value=u||[]},x=()=>{k.value=!0},t=u=>{if(!u.file_name){window.open(`/#/library/details/categary-manage?id=${u.library_id}`);return}window.open(`/#/library/preview?id=${u.file_id}`)};return(u,r)=>{const g=G,_=V,s=ne;return n(),l("div",Ie,[e("div",Oe,[a(g,null,{default:p(()=>[a(Ve,{onLoad:x,onSave:f})]),_:1})]),e("div",Ee,[C.value||v.value.length===0?(n(),l("div",Fe,[...r[0]||(r[0]=[e("img",{src:K,alt:""},null,-1),e("div",{class:"title"},"暂无结果，请重试",-1)])])):(n(),w(g,{key:1},{default:p(()=>[(n(!0),l(R,null,z(v.value,i=>(n(),l("div",{class:"list-item",key:i.id},[e("div",He,[e("div",De,[m(" id："+d(i.id)+" ",1),i.title?(n(),l("div",Ge,d(i.title),1)):c("",!0),e("span",null,"共"+d(i.word_total)+"个字符",1)])]),e("div",Ke,[r[2]||(r[2]=e("span",{class:"gray-text"},"来自：",-1)),e("div",{class:"link-text",onClick:$=>t(i)},[a(h(ie)),m(" "+d(i.file_name)+" ",1),i.file_name?c("",!0):(n(),l("span",Je,d(i.library_name)+"-精选",1))],8,Ae),r[3]||(r[3]=e("span",{class:"v-line"},null,-1)),e("span",Pe,[r[1]||(r[1]=m("相似度： ",-1)),a(_,{name:"similarity",style:{"font-size":"16px"}}),m(" "+d(i.similarity),1)])]),b.value==2?(n(),l(R,{key:0},[i.question?(n(),l("div",Qe,"问题："+d(i.question),1)):c("",!0),i.similar_questions&&i.similar_questions.length?(n(),l("div",We,[r[4]||(r[4]=e("span",null,"相似问法：",-1)),e("ul",Ye,[(n(!0),l(R,null,z(i.similar_questions,($,q)=>(n(),l("li",{key:q},d($),1))),128))])])):c("",!0),i.answer?(n(),l("div",je,"答案："+d(i.answer),1)):c("",!0)],64)):(n(),l("div",{key:1,class:"content-box",innerHTML:i.content},null,8,Xe))]))),128))]),_:1})),k.value?(n(),l("div",Ze,[a(s)])):c("",!0)])])}}},ms=M(es,[["__scopeId","data-v-bc3e90f7"]]);export{ms as default};
