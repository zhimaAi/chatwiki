import{_ as j,a as H,co as J,cp as K,ad as W,ae as X,d as Z}from"../../index-C1Xsov4S.js";import{f as r,r as D,e as tt,o as et,aa as ot,Y as p,a5 as t,k as v,ac as E,ae as M,a7 as u,F as R,ab as V,a2 as x,u as m,a1 as C,a9 as at,af as st,_ as l,G as L,B as nt,l as $}from"./vue-chunks-DCKTEHpB.js";import{_ as lt}from"./main-tab-B3vUjkqO.js";import{E as it}from"./empty-box-vvdJX5k0.js";import{L as ct}from"./loading-box-CyUSXD2F.js";/* empty css                                                                     */import{g as rt,a as ut,u as dt}from"./template-Dj_TLj8R.js";import{Y as _t,I as pt,p as vt,bG as ft,M as A,Q as O,a as mt}from"./ui-antd-D64OvTpt.js";import"./utils-D9NMMoMR.js";import"./list-tabs-BOqV1hiy.js";import"./index-BsqRrb1q.js";import"./empty-BFmzY9bl.js";const gt={class:"_container"},ht={class:"header"},kt={class:"main-tab-box"},yt={class:"content"},bt={class:"left-box hide-scrollbar"},xt={class:"cate-box"},Ct={key:0,class:"count"},Tt=["onClick"],wt={class:"count"},St={class:"filter-box"},zt={class:"_plugin-box"},Nt={key:0,class:"plugin-list"},Bt={class:"base-info"},Dt=["src"],Et={class:"info"},Mt={class:"head"},Rt={class:"name zm-line1"},Vt={class:"source"},Lt=["src"],$t={class:"zm-line1"},At={class:"action-box"},Ot={class:"left"},qt={class:"right"},Ft=["onClick"],It={__name:"index",setup(Gt){const T=ot(),q=at(),w=r(null);r(localStorage.getItem("zm:explore:active")||"4");const g=r(!0),S=r(!1),h=r([]),z=r([]),k=r(0),n=D({keyword:"",category:null}),i=D({current:1,pageSize:50,total:0}),F=H(),{companyInfo:b}=F,I=tt(()=>b==null?void 0:b.version);et(()=>{T.query.active>1&&w.value.change(T.query.active),G()});function G(){P(),y()}function P(){rt().then(o=>{let e=(o==null?void 0:o.data)||[];k.value=0,e.map(s=>k.value+=Number((s==null?void 0:s.template_count)||0)),z.value=e})}async function y(){var e;g.value=!0;let o={page:i.current,size:i.pageSize};n.keyword&&(o.keyword=n.keyword),n.category&&(o.category_id=(e=n.category)==null?void 0:e.id),ut(o).then(s=>{var d,_;let c=((d=s==null?void 0:s.data)==null?void 0:d.data)||[];(!c.length||c.length<i.pageSize)&&(S.value=!0),h.value.push(...c),i.current+=1,i.total=Number(((_=s==null?void 0:s.data)==null?void 0:_.total)||0)}).finally(()=>{g.value=!1})}function U(o){g.value||S.value||J(o,y)}function N(){i.current=1,i.total=0,h.value=[],y()}function B(o){n.category=o,N()}function Y(o,e){return o=Number(o.replace(/\D/g,"")),e=Number(e.replace(/\D/g,"")),o>=e}function Q(o){const e=()=>{dt({template_id:o.id,csl_url:o.csl_url}).then(s=>{mt.success("使用成功"),y();const{id:c,robot_key:d}=s.data,_=q.resolve({path:"/robot/config/workflow",query:{id:c,robot_key:d}});window.open(_.href,"_blank")})};Y(I.value,o.version)?A.confirm({title:"提示",content:`确定使用模板【${o.name}】创建应用吗?`,icon:$(O),okText:"确 认",cancelText:"取 消",onOk:e}):A.confirm({title:"提示",content:"当前系统版本过低，可能无法使用此模板；请您升级到最新版本后使用！",icon:$(O),okText:"继续使用",cancelText:"取 消",onOk:e})}return(o,e)=>{const s=pt,c=vt,d=Z,_=st("router-link");return l(),p("div",gt,[t("div",ht,[t("div",kt,[v(lt,{ref_key:"tabRef",ref:w},null,512)])]),t("div",yt,[t("div",bt,[e[3]||(e[3]=t("div",{class:"title"},"模板分类",-1)),t("div",xt,[t("div",{class:E(["cate-item",{active:!n.category}]),onClick:e[0]||(e[0]=a=>B(null))},[e[2]||(e[2]=t("div",null,"全部",-1)),k.value>0?(l(),p("span",Ct,u(k.value),1)):M("",!0)],2),(l(!0),p(R,null,V(z.value,a=>{var f;return l(),p("div",{key:a.id,class:E(["cate-item",{active:a.id==((f=n.category)==null?void 0:f.id)}]),onClick:Pt=>B(a)},[t("div",null,u(a.name),1),t("span",wt,u(a.template_count||0),1)],10,Tt)}),128))])]),t("div",{class:"right-box",onScroll:U},[t("div",St,[v(s,{value:n.keyword,"onUpdate:value":e[1]||(e[1]=a=>n.keyword=a),valueModifiers:{trim:!0},onChange:N,style:{width:"360px"},allowClear:"",placeholder:"输入名称、描述搜索"},{suffix:x(()=>[v(m(_t))]),_:1},8,["value"]),e[4]||(e[4]=t("div",null,null,-1))]),t("div",zt,[h.value.length?(l(),p("div",Nt,[(l(!0),p(R,null,V(h.value,a=>(l(),C(_,{class:"plugin-item",key:a.id,to:`/templates/detail?key=${a.robot_id}`,target:"_blank"},{default:x(()=>[t("div",Bt,[t("img",{class:"avatar",src:a.avatar||m(K)},null,8,Dt),t("div",Et,[t("div",Mt,[t("span",Rt,u(a.name),1)]),t("div",Vt,[t("img",{class:"author-avatar",src:a.account_avatar},null,8,Lt),t("span",$t,u(a.author),1)])])]),v(c,{title:m(W)(a.description,a,14,2.5,60),placement:"top"},{default:x(()=>[t("div",{class:"desc zm-line",ref_for:!0,ref:f=>m(X)(f,a)},u(a.description),513)]),_:2},1032,["title"]),t("div",At,[t("div",Ot,[v(m(ft)),L(" "+u(a.use_count||0),1)]),t("div",qt,[t("a",{onClick:nt(f=>Q(a),["stop","prevent"])},[v(d,{name:"icon-rocket"}),e[5]||(e[5]=L(" 使用模板",-1))],8,Ft)])])]),_:2},1032,["to"]))),128))])):(l(),C(it,{key:1,title:"暂无可用插件"})),g.value?(l(),C(ct,{key:2})):M("",!0)])],32)])])}}},oe=j(It,[["__scopeId","data-v-dbc9e881"]]);export{oe as default};
