import{j as ne}from"./index-B551IHpY.js";import{j as re,q as le,I as se,J as ie}from"./index-DvPlhmYy.js";import{f as v,w as ue,Y as U,_ as i,k as d,a2 as p,a6 as E,a1 as w,a5 as k,u as x,r as V,e as H,o as _e,ae as j,a4 as R,a9 as pe,G as de,a7 as ve,F as me,l as ce,aa as fe,ab as be}from"./vue-chunks-CXJTX1FC.js";import{b as G,w as ge,x as ye}from"../../index-0TFHdij1.js";import{F as q,a0 as ke,a1 as we,o as he,M as $,a as O,e as xe,I as W,u as Le,v as Ae,T as Ie,bd as Ce}from"./ui-antd-D3ZAJ1Vq.js";import{u as Re}from"./robot-L7DXN4U8.js";const Ue={class:"avatar-uploader"},Oe=["src"],Fe={key:1},Te=["src"],Me={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(F,{emit:T}){function I(a){return new Promise((m,C)=>{const s=new FileReader;s.readAsDataURL(a),s.onload=()=>m(s.result),s.onerror=P=>C(P)})}const f=T,b=F,u=v([]),_=v(!1),h=v("");ue(()=>b.value,a=>{h.value=a},{immediate:!0});const M=q.useInjectFormItemContext(),o=()=>{let a={imageUrl:h.value,file:u.value[0].originFileObj};f("change",a),f("update:value",a.imageUrl),M.onFieldChange()},l=a=>a.type==="image/jpeg"||a.type==="image/png"?a.size/1024<100?(u.value=[a],I(a).then(s=>{h.value=s,_.value=!1,o()}),!1):(O.error("机器人头像图片大小不能超过100kb"),!1):(O.error("机器人头像只支持JPG、PNG格式的图片"),!1),g=v(!1),L=v(""),e=v(""),B=()=>{g.value=!1,e.value=""},A=async a=>{!a.url&&!a.preview&&(a.preview=await I(a.originFileObj)),L.value=a.url||a.preview,g.value=!0,e.value=a.name||a.url.substring(a.url.lastIndexOf("/")+1)};return(a,m)=>{const C=he,s=$;return i(),U("div",Ue,[d(C,{"file-list":u.value,"onUpdate:fileList":m[0]||(m[0]=P=>u.value=P),"list-type":b.listType,"show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:A,style:E(b.style)},{default:p(()=>[F.value?(i(),U("img",{key:0,class:"avatar",style:E(b.style),src:F.value,alt:"avatar"},null,12,Oe)):(i(),U("div",Fe,[_.value?(i(),w(x(ke),{key:0})):(i(),w(x(we),{key:1})),m[1]||(m[1]=k("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),d(s,{open:g.value,title:e.value,footer:null,onCancel:B},{default:p(()=>[k("img",{alt:"example",style:{width:"100%"},src:L.value},null,8,Te)]),_:1},8,["open","title"])])}}},J=G(Me,[["__scopeId","data-v-61828ec5"]]),Pe={class:"form-box"},Se={class:"robot-avatar-box"},je={key:0,class:"form-item-tip"},$e={__name:"add-robot-alert",emits:["addRobot","editRobot","ok"],setup(F,{expose:T,emit:I}){const f=Re(),b=I;let u="";const _=be(),h=fe(),M=q.useForm,o=v(!1),l=v(!1),g=v(!1),L=v([]),e=V({robot_name:"",en_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),B=H(()=>e.application_type==0?o.value?"编辑机器人基本信息":"新建聊天机器人":o.value?"编辑工作流基本信息":"新建工作流"),A=H(()=>f.robotInfo),{getRobot:a}=f,m=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}],en_name:[]}),{validate:C,validateInfos:s,clearValidate:P}=M(e,m),D=n=>{e.robot_avatar=n.file},K=()=>{let n={robot_name:e.robot_name,en_name:e.en_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||u,group_id:e.group_id||"0"};g.value=!0;let t=le,c="机器人创建成功";o.value&&(t=se,n.id=_.query.id,c="机器人编辑成功",n.robot_avatar==u&&delete n.robot_avatar),t(n,e.application_type).then(y=>{if(g.value=!1,y.res!=0)return O.error(y.msg);if(O.success(c),!o.value&&_.query.robot_key){b("addRobot"),l.value=!1;return}o.value?(a(_.query.id),b("editRobot"),l.value=!1):e.application_type==0?h.push("/robot/config/basic-config?id="+y.data.id+"&robot_key="+y.data.robot_key):(window.open("/#/robot/config/workflow?id="+y.data.id+"&robot_key="+y.data.robot_key+"&show_tips=1"),l.value=!1,b("ok"))}).catch(()=>{g.value=!1})},Z=async()=>{let n=await ne({model_type:"LLM"});return!n||n.data.length==0?($.confirm({title:"请先添加LLM模型服务商?",icon:ce(Ce,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){h.push("/user/model")},onCancel(){}}),!1):!0},Y=async(n,t)=>{n==0?u=ge:u=ye,o.value=t;let c=await Z();X(),c&&(e.robot_avatar="",e.robot_avatar_url=u,e.robot_name="",e.en_name="",e.robot_intro="",e.application_type=n,l.value=!0,o.value&&A.value&&(e.robot_name=A.value.robot_name,e.en_name=A.value.en_name,e.robot_intro=A.value.robot_intro,e.robot_avatar_url=A.value.robot_avatar_url)),n==0?m.en_name=[]:m.en_name=[{required:!0,message:"请输入工作流名称",trigger:"change"},{validator:async(y,S,N)=>!S||/^[a-zA-Z0-9_\.\-]+$/.test(S)?Promise.resolve():Promise.reject('只能输入英文数字和字符"_"、"."、"-"')}]},Q=n=>{e.group_id=n||"0"},X=()=>{re().then(n=>{L.value=n.data||[]})},ee=()=>{P()},te=()=>{!o.value&&e.application_type!=0&&(e.robot_name||(e.robot_name=e.en_name)),C().then(()=>{K()}).catch(n=>{})};return _e(()=>{}),T({open:Y,setGroupId:Q}),(n,t)=>{const c=xe,y=W,S=Ae,N=Le,z=Ie,ae=q,oe=$;return i(),w(oe,{width:o.value?"472px":"746px",open:l.value,"onUpdate:open":t[7]||(t[7]=r=>l.value=r),confirmLoading:g.value,title:B.value,onOk:te,onCancel:ee},{default:p(()=>[k("div",Pe,[d(ae,{layout:"vertical"},{default:p(()=>[o.value?(i(),w(c,R({key:0,ref:"name",label:""},x(s).robot_avatar_url),{default:p(()=>[k("div",Se,[d(J,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":t[0]||(t[0]=r=>e.robot_avatar_url=r),onChange:D},null,8,["value"]),t[8]||(t[8]=k("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):j("",!0),e.application_type!=0?(i(),w(c,R({key:1,required:"",ref:"en_name",label:"工作流名称"},x(s).en_name),{default:p(()=>[d(y,{value:e.en_name,"onUpdate:value":t[1]||(t[1]=r=>e.en_name=r),maxLength:50,placeholder:"请输入"},null,8,["value"]),t[9]||(t[9]=k("div",{class:"form-item-tip"},'只能输入英文数字和字符"_"、"."、"-"，最多不超过50个字符',-1))]),_:1,__:[9]},16)):j("",!0),d(c,R({ref:"name",label:e.application_type==0?"应用名称":"备注名"},x(s).robot_name),{default:p(()=>[d(y,{value:e.robot_name,"onUpdate:value":t[2]||(t[2]=r=>e.robot_name=r),maxLength:20,placeholder:"请输入"},null,8,["value"]),e.application_type!=0?(i(),U("div",je,"仅用作后台显示，不超过20个字")):j("",!0)]),_:1},16,["label"]),d(c,R({ref:"group_id",label:"分组"},x(s).group_id),{default:p(()=>[d(N,{value:e.group_id,"onUpdate:value":t[3]||(t[3]=r=>e.group_id=r),style:{width:"100%"},placeholder:"请选择分组"},{default:p(()=>[(i(!0),U(me,null,pe(L.value,r=>(i(),w(S,{value:r.id},{default:p(()=>[de(ve(r.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},16),d(c,R({label:"简介"},x(s).robot_intro),{default:p(()=>[o.value?(i(),w(z,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":t[5]||(t[5]=r=>e.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(i(),w(z,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":t[4]||(t[4]=r=>e.robot_intro=r),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),o.value?j("",!0):(i(),w(c,R({key:2,ref:"name",label:"机器人头像"},x(s).robot_avatar_url),{default:p(()=>[d(J,{value:e.robot_avatar_url,"onUpdate:value":t[6]||(t[6]=r=>e.robot_avatar_url=r),onChange:D},null,8,["value"]),t[10]||(t[10]=k("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1,__:[10]},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},Je=G($e,[["__scopeId","data-v-ea44cf24"]]),Be={class:"form-item"},Ve={class:"form-content"},qe={__name:"add-group",emits:["ok"],setup(F,{expose:T,emit:I}){const f=v(!1),b=I,u=v("新建分组"),_=V({group_name:"",id:""}),h=o=>{_.group_name=o.group_name||"",_.id=o.id||"",u.value=o.id?"编辑分组":"新建分组",f.value=!0},M=()=>{if(!_.group_name)return O.error("请输入分组名称");ie({..._}).then(o=>{O.success(`${u.value}成功`),f.value=!1,b("ok")})};return T({show:h}),(o,l)=>{const g=W,L=$;return i(),U("div",null,[d(L,{open:f.value,"onUpdate:open":l[1]||(l[1]=e=>f.value=e),title:u.value,onOk:M,zIndex:2e3},{default:p(()=>[k("div",Be,[l[2]||(l[2]=k("div",{class:"form-label"},"分组名称：",-1)),k("div",Ve,[d(g,{maxLength:15,value:_.group_name,"onUpdate:value":l[0]||(l[0]=e=>_.group_name=e),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},We=G(qe,[["__scopeId","data-v-64dac278"]]);export{J as A,Je as a,We as b};
