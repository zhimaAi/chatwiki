{"version":3,"file":"comment-processing-record-DISk1Ii4.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/explore/ai-comment-management/comment-processing-record.vue"],"sourcesContent":["<template>\r\n  <div class=\"comment-record-page\">\r\n    <div class=\"toolbar\">\r\n      <a-select\r\n        v-model:value=\"filters.check_result\"\r\n        allowClear\r\n        :placeholder=\"t('filter_result_placeholder')\"\r\n        style=\"width: 160px\"\r\n        @change=\"search\"\r\n      >\r\n        <a-select-option v-for=\"(label, val) in typeMap\" :key=\"val\" :value=\"val\">{{ label }}</a-select-option>\r\n      </a-select>\r\n      <a-input-search\r\n        v-model:value=\"filters.comment_text\"\r\n        allowClear\r\n        :placeholder=\"t('search_comment_placeholder')\"\r\n        style=\"width: 300px\"\r\n        @search=\"search\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"table-box\">\r\n      <a-table\r\n        :columns=\"columns\"\r\n        :data-source=\"list\"\r\n        :loading=\"loading\"\r\n        row-key=\"id\"\r\n        :pagination=\"{ current: pager.page, pageSize: pager.size, total: pager.total, showSizeChanger: true, pageSizeOptions: ['10','20','50','100'] }\"\r\n        @change=\"onTableChange\"\r\n      >\r\n        <template #headerCell=\"{ column }\">\r\n          <span v-if=\"typeof column.title === 'string'\">{{ column.title }}</span>\r\n        </template>\r\n        <template #bodyCell=\"{ column, record }\">\r\n          <template v-if=\"column.key==='content_text'\">\r\n            <a-tooltip :title=\"getTooltipTitle(record.content_text, record)\" placement=\"top\">\r\n              <div class=\"ellipsis1 title\" :class=\"`titleRef_${record.create_time}`\">{{record.content_text}}</div>\r\n            </a-tooltip>\r\n          </template>\r\n          <template v-else-if=\"column.key==='ai_comment_result_text'\">\r\n            <span>{{ record.ai_comment_result_text }}</span>\r\n          </template>\r\n          <template v-else-if=\"column.key==='reply_comment_text'\">\r\n            <a-tooltip :title=\"getTooltipTitle(record.reply_comment_text, record)\" placement=\"top\">\r\n              <div class=\"ellipsis1 title\" :class=\"`titleRef_${record.create_time}`\">{{record.reply_comment_text}}</div>\r\n            </a-tooltip>\r\n          </template>\r\n          <template v-else-if=\"column.key==='draft_title'\">\r\n            <a-tooltip :title=\"getTooltipTitle(record.draft_title, record)\" placement=\"top\">\r\n              <div class=\"ellipsis1 title\" :class=\"`titleRef_${record.create_time}`\">{{record.draft_title}}</div>\r\n            </a-tooltip>\r\n          </template>\r\n          <template v-else-if=\"column.key==='rule_name'\">\r\n            <span class=\"ellipsis1\">{{ record.rule_name }}</span>\r\n          </template>\r\n          <template v-else-if=\"column.key==='ai_comment_rule_text'\">\r\n            <div class=\"rule-tags\">\r\n              <template v-for=\"(t, idx) in (record.ai_comment_rule_text || []).slice(0, 3)\" :key=\"t + idx\">\r\n                <span>{{ t }}</span>\r\n                <span v-if=\"idx < (record.ai_comment_rule_text || []).length - 1\">, </span>\r\n              </template>\r\n              <a-tooltip v-if=\"(record.ai_comment_rule_text || []).length > 3\">\r\n                <template #title>{{ (record.ai_comment_rule_text || []).join(', ') }}</template>\r\n                <span style=\"cursor: pointer;\">...+{{ (record.ai_comment_rule_text || []).length - 3 }}</span>\r\n              </a-tooltip>\r\n            </div>\r\n          </template>\r\n          <template v-else-if=\"column.key==='ai_exec_time'\">\r\n            <span>{{ formatDateTime(record.ai_exec_time) }}</span>\r\n          </template>\r\n        </template>\r\n      </a-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { getCommentList } from '@/api/robot'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.explore.ai-comment-management.comment-processing-record')\r\n\r\nconst filters = reactive({ check_result: undefined, comment_text: '' })\r\nconst typeMap = reactive({})\r\nconst list = ref([])\r\nconst loading = ref(false)\r\nconst pager = reactive({ page: 1, size: 10, total: 0 })\r\n\r\nconst columns = [\r\n  { title: t('column_content_text'), dataIndex: 'content_text', key: 'content_text', width: 220 },\r\n  { title: t('column_result'), dataIndex: 'ai_comment_result_text', key: 'ai_comment_result_text', width: 130 },\r\n  { title: t('column_reply_text'), dataIndex: 'reply_comment_text', key: 'reply_comment_text', width: 220 },\r\n  { title: t('column_draft_title'), dataIndex: 'draft_title', key: 'draft_title', width: 120 },\r\n  { title: t('column_rule_name'), dataIndex: 'rule_name', key: 'rule_name', width: 120 },\r\n  { title: t('column_rule_detail'), dataIndex: 'ai_comment_rule_text', key: 'ai_comment_rule_text', width: 300 },\r\n  { title: t('column_exec_time'), dataIndex: 'ai_exec_time', key: 'ai_exec_time', width: 120 },\r\n]\r\n\r\nconst loadList = () => {\r\n  loading.value = true\r\n  const params = { page: pager.page, size: pager.size }\r\n  if (filters.check_result) params.check_result = filters.check_result\r\n  if (filters.comment_text) params.comment_text = filters.comment_text\r\n  getCommentList(params).then((res) => {\r\n    const data = res?.data || { list: [], total: 0, type: {} }\r\n    list.value = data.list || []\r\n    pager.total = +data.total || 0\r\n    const t = data.type || {}\r\n    Object.keys(typeMap).forEach(k => delete typeMap[k])\r\n    Object.entries(t).forEach(([k, v]) => { typeMap[k] = v })\r\n  }).finally(() => { loading.value = false })\r\n}\r\n\r\nconst search = () => { pager.page = 1; loadList() }\r\nconst onTableChange = (pagination) => { pager.page = pagination.current; pager.size = pagination.pageSize; loadList() }\r\n\r\nconst formatDateTime = (ts) => {\r\n  try {\r\n    const d = new Date(Number(ts) * 1000)\r\n    const yy = String(d.getFullYear()).slice(2)\r\n    const m = String(d.getMonth() + 1).padStart(2, '0')\r\n    const dd = String(d.getDate()).padStart(2, '0')\r\n    const hh = String(d.getHours()).padStart(2, '0')\r\n    const mm = String(d.getMinutes()).padStart(2, '0')\r\n    return `${yy}-${m}-${dd} ${hh}:${mm}`\r\n  } catch (e) { return '' }\r\n}\r\n\r\n// 获取 tooltip 标题\r\nfunction getTooltipTitle(text, record) {\r\n  if (!text) return null\r\n  \r\n  // 创建临时元素来测量文本宽度\r\n  const canvas = document.createElement('canvas')\r\n  const context = canvas.getContext('2d')\r\n  // 14px 根据实际字体大小修改\r\n  context.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif'\r\n  \r\n  const textWidth = context.measureText(text).width\r\n\r\n  const titleRef = document.querySelector(`.titleRef_${record.create_time}`)\r\n  if (titleRef) {\r\n    record.title_width = titleRef.offsetWidth\r\n  }\r\n\r\n  const maxWidth = record?.title_width || 250\r\n  return textWidth > maxWidth ? text : null\r\n}\r\n\r\nonMounted(() => { loadList() })\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.comment-record-page {\r\n  padding: 2px 0px 24px;\r\n\r\n  ::v-deep .ant-table-thead >tr>th {\r\n    color: #262626;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 22px;\r\n  }\r\n\r\n  ::v-deep .ant-table-row {\r\n    color: #595959;\r\n  }\r\n}\r\n.toolbar { display: flex; align-items: center; gap: 12px; }\r\n.table-box { margin-top: 16px; }\r\n.ellipsis1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }\r\n.rule-tags { display: flex; flex-wrap: wrap; gap: 4px; }\r\n</style>\r\n"],"names":["t","useI18n","filters","reactive","typeMap","list","ref","loading","pager","columns","loadList","params","getCommentList","res","data","k","v","search","onTableChange","pagination","formatDateTime","ts","d","yy","m","dd","hh","mm","getTooltipTitle","text","record","context","textWidth","titleRef","maxWidth","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_a_select","_cache","$event","_unref","_Fragment","_renderList","label","val","_createBlock","_component_a_select_option","_component_a_input_search","_hoisted_3","_component_a_table","_withCtx","column","_hoisted_4","_toDisplayString","_component_a_tooltip","_normalizeClass","_hoisted_5","_hoisted_6","_hoisted_7","idx","_hoisted_9","_hoisted_10"],"mappings":"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"}