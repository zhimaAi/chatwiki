import{_ as Ie}from"./empty-CzGZrENG.js";import{f as m,ab as te,w as De,r as ee,Y as x,_ as c,k as e,a2 as t,F as Q,a9 as X,a1 as Y,a5 as o,a7 as D,u as V,G as y,n as de,a4 as Ue,A as ie,ae as Z,e as qe}from"./vue-chunks-yZ4gwLzA.js";import{i as Se,j as Te,k as Ee,l as Re,m as Ne,n as Ae,o as Le,p as Ve,q as ye,r as Pe,a as Ye,s as ze,t as Be,v as Je}from"./index-XTtBi9F9.js";import{b as ne,d as je,h as Ke,p as me,bL as Ge}from"../../index-ZzVqUZIR.js";import{F as oe,e as _e,H as he,G as He,I as ke,J as be,p as pe,ad as xe,M as H,a as J,q as we,R as Ce,Q as Qe,bA as We,u as Xe,v as Ze,bD as et,B as fe,z as $e,O as ce,k as tt,at as nt,as as at,bw as lt,aN as ot,d as st,ah as rt,a2 as ve,aB as ut,D as dt,g as it,b as ct,c as _t,a0 as pt,ai as ft,$ as mt,w as vt,x as gt}from"./ui-antd-BJtyvQX6.js";import{a as ge}from"./validate-8MtiUsxW.js";import{d as yt}from"./vuedraggable.umd-BwU7FuvS.js";import{u as ht}from"./database-3H5eui55.js";import"./utils-smNh_pj2.js";const kt={class:"add-data-sheet"},bt={class:"field-name"},xt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(j,{expose:P,emit:z}){const L=m("添加数据"),q=te().query,v=z,b=j;De(()=>b.column,O=>{l()});const $=m([]),l=()=>{let O=[];b.column.forEach(_=>{g[_.name]="",_.rules=[],_.required=="true"&&_.rules.push({required:!0,message:`请输入${_.name}`}),_.type=="number"&&_.rules.push({type:"number",message:`${_.name}必须为数字`}),_.type=="integer"&&_.rules.push({asyncValidator:N}),_.type=="boolean"&&(g[_.name]="false"),O.push({..._}),$.value=O})},N=(O,_)=>new Promise((p,s)=>_==""||Number.isInteger(+_)?p():s("请输入整数")),A=m(!1),g=ee({form_id:q.form_id}),S=O=>{A.value=!0,F.value&&F.value.resetFields(),l(),g.id="",Object.assign(g,E(O)),g.id?L.value="修改数据":L.value="添加数据"},F=m(null),w=()=>{F.value.validate().then(O=>{Se({...g}).then(_=>{let p=g.id?"修改成功":"添加成功";J.success(p),A.value=!1,v("ok")})})};function E(O){const _={};for(let p in O)if(O.hasOwnProperty(p)){const s=O[p];!isNaN(Number(s))&&typeof s=="string"&&s!=""?_[p]=Number(s):_[p]=s}return _}return P({show:S}),(O,_)=>{const p=pe,s=be,R=he,i=He,d=ke,I=_e,r=oe,n=H;return c(),x("div",kt,[e(n,{open:A.value,"onUpdate:open":_[0]||(_[0]=a=>A.value=a),title:L.value,onOk:w,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(r,{style:{"margin-top":"16px"},model:g,ref_key:"formRef",ref:F,layout:"vertical"},{default:t(()=>[(c(!0),x(Q,null,X($.value,a=>(c(),Y(I,{name:a.name,key:a.id,rules:a.rules},{label:t(()=>[e(s,{gap:4,style:{width:"100%"}},{default:t(()=>[o("div",bt,D(a.name),1),e(p,null,{title:t(()=>[y(D(a.description),1)]),default:t(()=>[e(V(xe))]),_:2},1024)]),_:2},1024)]),default:t(()=>[a.type=="boolean"?(c(),Y(R,{key:0,checked:g[a.name],"onUpdate:checked":u=>g[a.name]=u,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):a.type=="number"||a.type=="integer"?(c(),Y(i,{key:1,style:{width:"100%"},value:g[a.name],"onUpdate:value":u=>g[a.name]=u,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(c(),Y(d,{key:2,value:g[a.name],"onUpdate:value":u=>g[a.name]=u,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},wt=ne(xt,[["__scopeId","data-v-878d9bf5"]]),Ct={__name:"export-modal",setup(j,{expose:P}){const L=te().query,T=m("导出数据"),q=m(!1),v=ee({dates:[],type:1}),b=()=>{q.value=!0,v.type=1,v.dates=[]},$=ee({dates:[{validator:async(F,w)=>v.type==2&&!w.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),l=oe.useForm,{resetFields:N,validate:A,validateInfos:g}=l(v,$),S=()=>{A().then(()=>{let F={form_id:L.form_id};v.type==2&&(F.start_date=v.dates[0],F.end_date=v.dates[1]),Te(F),q.value=!1})};return P({show:b}),(F,w)=>{const E=Ce,O=we,_=_e,p=Qe,s=oe,R=H;return c(),x("div",null,[e(R,{open:q.value,"onUpdate:open":w[2]||(w[2]=i=>q.value=i),title:T.value,onOk:S,width:450},{default:t(()=>[e(s,{class:"mt16",layout:"vertical"},{default:t(()=>[e(_,{label:""},{default:t(()=>[e(O,{value:v.type,"onUpdate:value":w[0]||(w[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(E,{value:1},{default:t(()=>[...w[3]||(w[3]=[y("全部数据",-1)])]),_:1}),e(E,{value:2},{default:t(()=>[...w[4]||(w[4]=[y("自定义日期",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),de(e(_,Ue({required:"",label:"选择导出日期"},V(g).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":w[1]||(w[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[ie,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},$t=ne(Ct,[["__scopeId","data-v-80b64322"]]),Ft={class:"add-data-sheet"},Ot={class:"filter-list-box"},Mt={style:{"margin-left":"48px"}},It={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:P,emit:z}){const L=m("添加分类"),q=te().query,v=z,b=j;m([]);const $=m(!1),l=ee({form_id:q.form_id,name:"",condition:[],type:"1",id:""}),N=()=>{let r=[{form_field_id:b.column[0].id,form_filed_type:b.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];l.condition=r},A=r=>{l.condition.splice(r,1)},g=(r,n)=>{r.rule=void 0,r.rule_value1="",r.rule_value2="",r.form_filed_type=b.column.filter(a=>a.id==r.form_field_id)[0].type},S=(r,n)=>n.form_field_id==r.id?!1:l.condition.map(u=>u.form_field_id).includes(r.id),F=()=>{let r=l.condition.map(a=>a.form_field_id),n=b.column.filter(a=>!r.includes(a.id));if(!n.length){J.error("字段已全部添加");return}l.condition.push({form_field_id:n[0].id,form_filed_type:n[0].type,rule:void 0,rule_value1:"",rule_value2:""})},w=r=>!r.rule||r.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(r.rule),E=r=>!r.rule||r.form_filed_type=="boolean"?!1:["between"].includes(r.rule),O=(r,n,a)=>new Promise((u,U)=>w(a)?n?a.form_filed_type=="integer"?Number.isInteger(+n)?u():U("请输入整数"):a.form_filed_type=="number"?ge(n)?u():U("请输入数字"):u():U("请输入"):u()),_=(r,n,a)=>new Promise((u,U)=>E(a)?n?a.form_filed_type=="integer"?Number.isInteger(+n)?+n<+a.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入整数"):a.form_filed_type=="number"?ge(n)?+n<+a.rule_value1?U("右边的值需要大于左边的值"):u():U("请输入数字"):u():U("请输入"):u()),p=()=>{$.value=!0,L.value="添加分类",N(),l.name="",l.type="1",l.id=""},s=r=>{$.value=!0,L.value="编辑分类",Ee({form_id:q.form_id,id:r.id}).then(n=>{let a=n.data.conditions||"[]";a=JSON.parse(a),a=a.map(u=>({form_field_id:u.form_field_id+"",form_filed_type:b.column.filter(U=>U.id==u.form_field_id)[0].type,rule:R(u.rule),rule_value1:u.rule_value1,rule_value2:u.rule_value2})),l.condition=a,l.name=n.data.name,l.type=n.data.type,l.id=n.data.id})};function R(r){const n=["string_","integer_","number_","boolean_"];for(const a of n)if(r.startsWith(a))return r.slice(a.length);return r}const i=m(null),d=()=>{i.value.validate().then(r=>{let n=l.condition.map(f=>({form_field_id:+f.form_field_id,rule:f.form_filed_type+"_"+f.rule,rule_value1:f.rule_value1,rule_value2:f.rule_value2})),a={...l,condition:JSON.stringify(n)},u=Re,U="添加成功";l.id&&(u=Ne,U="编辑成功"),u(a).then(f=>{J.success(U),$.value=!1,v("ok")})}).catch(r=>{})},I=m({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return P({show:p,edit:s}),(r,n)=>{const a=ke,u=_e,U=Ze,f=Xe,h=We,K=fe,G=Ce,le=we,se=oe,re=H;return c(),x("div",Ft,[e(re,{open:$.value,"onUpdate:open":n[2]||(n[2]=M=>$.value=M),title:L.value,onOk:d,width:790},{default:t(()=>[e(se,{class:"form-box",style:{"margin-top":"16px"},model:l,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(u,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(a,{maxLength:64,value:l.name,"onUpdate:value":n[0]||(n[0]=M=>l.name=M),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),n[6]||(n[6]=o("div",{class:"form-required-item"},"筛选条件",-1)),o("div",Ot,[(c(!0),x(Q,null,X(l.condition,(M,B)=>(c(),Y(h,{key:B,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[o("div",null,"条件"+D(B+1)+":",1),e(u,null,{default:t(()=>[e(f,{value:M.form_field_id,"onUpdate:value":k=>M.form_field_id=k,style:{width:"150px"},placeholder:"请选择",onChange:k=>g(M,B)},{default:t(()=>[(c(!0),x(Q,null,X(b.column,k=>(c(),Y(U,{disabled:S(k,M),key:k.id,value:k.id},{default:t(()=>[y(D(k.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(u,{name:["condition",B,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(f,{value:M.rule,"onUpdate:value":k=>M.rule=k,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(c(!0),x(Q,null,X(I.value[M.form_filed_type],k=>(c(),Y(U,{key:k.value,value:k.value},{default:t(()=>[y(D(k.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),de(e(u,{name:["condition",B,"rule_value1"],rules:{asyncValidator:(k,ae)=>O(k,ae,M)}},{default:t(()=>[e(a,{value:M.rule_value1,"onUpdate:value":k=>M.rule_value1=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,w(M)]]),de(e(u,{name:["condition",B,"rule_value2"],rules:{asyncValidator:(k,ae)=>_(k,ae,M),trigger:"blur"}},{default:t(()=>[e(a,{value:M.rule_value2,"onUpdate:value":k=>M.rule_value2=k,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[ie,E(M)]]),l.condition.length>1?(c(),Y(V(et),{key:0,onClick:k=>A(B)},null,8,["onClick"])):Z("",!0)]),_:2},1024))),128)),o("div",Mt,[e(K,{onClick:F},{default:t(()=>[...n[3]||(n[3]=[y("添加条件",-1)])]),_:1})])]),e(u,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:l.type,"onUpdate:value":n[1]||(n[1]=M=>l.type=M)},{default:t(()=>[e(G,{value:"1"},{default:t(()=>[...n[4]||(n[4]=[y("与（And）",-1)])]),_:1}),e(G,{value:"2"},{default:t(()=>[...n[5]||(n[5]=[y("或（Or）",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Fe=ne(It,[["__scopeId","data-v-96f3dd24"]]),Dt={class:"custom-table"},Ut={class:"t-body"},qt={class:"t-row"},St={class:"t-item"},Tt={class:"t-item"},Et={class:"drag-btn"},Rt={key:0},Nt={key:1},At={class:"t-item"},Lt={class:"t-item flex-none",style:{width:"120px"}},Vt=["onClick"],Pt=["onClick"],Yt={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(j,{expose:P,emit:z}){const T=te().query,q=z,v=m("管理分类"),b=m(!1),$=j,l=()=>{ye({form_id:T.form_id}).then(p=>{S.value=p.data.map(s=>({...s}))})},N=()=>{l(),q("ok"),q("change")},A=()=>{l(),b.value=!0},g=()=>{b.value=!1},S=m(),F=()=>{let p=[];S.value.reverse().forEach((s,R)=>{p.push({id:+s.id,sort:+R+1})}),Ae({form_id:T.form_id,filter_sort:JSON.stringify(p)}).then(s=>{J.success("排序成功"),l(),q("change")})},w=p=>{Le({form_id:T.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(s=>{J.success("设置成功"),l(),q("change")})},E=(p,s)=>{H.confirm({title:"删除确认",icon:e(ce),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Ve({id:p.id,form_id:T.form_id}).then(R=>{J.success("删除成功"),S.value.splice(s,1),q("change")})},onCancel(){}})},O=m(null),_=p=>{O.value.edit(p)};return P({show:A}),(p,s)=>{const R=he,i=je,d=pe,I=$e,r=H;return c(),x("div",null,[e(r,{open:b.value,"onUpdate:open":s[1]||(s[1]=n=>b.value=n),title:v.value,onCancel:g,footer:null,width:760},{default:t(()=>[o("div",Dt,[s[6]||(s[6]=o("div",{class:"t-head"},[o("div",{class:"td"},[o("div",{style:{width:"24px"}}),y(" 分类名称 ")]),o("div",{class:"td"},"类型"),o("div",{class:"td"},"启用分类"),o("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),o("div",Ut,[o("div",qt,[s[2]||(s[2]=o("div",{class:"t-item"},[o("div",{style:{width:"24px"}}),y(" 全部 ")],-1)),s[3]||(s[3]=o("div",{class:"t-item"},"系统分类",-1)),o("div",St,[e(R,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),s[4]||(s[4]=o("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1))]),e(V(yt),{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=n=>S.value=n),"item-key":"id",onEnd:F,group:"table-rows",handle:".drag-btn"},{item:t(({element:n,index:a})=>[(c(),x("div",{key:n.id,class:"t-row"},[o("div",Tt,[o("span",Et,[e(i,{name:"drag"})]),n.name.length>10?(c(),x("span",Rt,[e(d,null,{title:t(()=>[y(D(n.name),1)]),default:t(()=>[y(" "+D(n.name.slice(0,10)+"..."),1)]),_:2},1024)])):(c(),x("span",Nt,D(n.name),1))]),s[5]||(s[5]=o("div",{class:"t-item"},"自定义分类",-1)),o("div",At,[e(R,{onChange:u=>w(n),checked:n.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),o("div",Lt,[o("a",{onClick:u=>_(n)},"编辑",8,Vt),e(I,{type:"vertical"}),o("a",{onClick:u=>E(n,a)},"删除",8,Pt)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e(Fe,{onOk:N,column:$.column,ref_key:"addFilrerModalRef",ref:O},null,8,["column"])])}}},zt=ne(Yt,[["__scopeId","data-v-2d0e4f7e"]]),Bt={class:"upload-box"},Jt={class:"ant-upload-drag-icon"},jt={key:0,class:"progress-box"},Kt={key:0},Gt={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(j,{expose:P,emit:z}){const L=Ke(),T=z,q=te().query,v=j,b=m(!1),$=m(!1),l=ee({total:0,success:0,err_data:[]}),N=m([]),A=i=>{const d=i.file.status;if(d==="done")if(i.file.response.res==0){let I=i.file.response.data.task_id;F(I)}else return N.value=[],J.error(i.file.response.msg);else d==="error"&&(N.value=[],J.error(`${i.file.name} file upload failed.`))};function g(i){}let S=null;const F=i=>{S&&clearInterval(S),b.value=!1,p.value=!0,s.value=10,l.total=0,l.success=0,l.err_data=[],S=setInterval(()=>{Pe({task_id:i}).then(d=>{let I=d.data;s.value=(I.processed/I.total).toFixed(),I.finish&&(T("ok"),clearInterval(S),s.value=100),I.total>0&&(l.total=I.total,l.success=I.success,l.err_data=I.err_data)}).catch(()=>{clearInterval(S)})},2e3)},w=()=>{let i;i=v.column.map(d=>d.name),i="id,"+i.join(",")+`
`,me(i,[],[],"导入数据模板.csv")},E=()=>{let i={id:""};v.column.forEach(d=>{i[d.name]=""}),Ge([i],"导入数据模板.json")},O=()=>{N.value=[],b.value=!0},_=()=>{},p=m(!1),s=m(10),R=()=>{let i="id,",d=["id"];for(let n in l.err_data[0])n!="id"&&n!="err_msg"&&(i+=n+",",d.push(n));i=i+`err_msg
`,d.push("err_msg");let I=l.err_data,r="失败数据_"+st().format("YYYY/MM/DD HH:mm")+".xlsx";me(i,I,d,r)};return P({show:O}),(i,d)=>{const I=tt,r=nt,n=H,a=lt,u=fe,U=ot;return c(),x("div",null,[e(n,{open:b.value,"onUpdate:open":d[1]||(d[1]=f=>b.value=f),title:"导入数据","confirm-loading":$.value,onOk:_,footer:null,width:746},{default:t(()=>[e(I,{"show-icon":"",class:"alert-box"},{message:t(()=>[o("div",null,[d[3]||(d[3]=y(" 支持通过Excel或者json文件导入数据。 ",-1)),o("a",{onClick:w,class:"mr8"},"excel模板"),o("a",{onClick:E},"json模板")]),d[4]||(d[4]=o("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1))]),_:1}),o("div",Bt,[e(r,{fileList:N.value,"onUpdate:fileList":d[0]||(d[0]=f=>N.value=f),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:V(L).getToken},data:{form_id:V(q).form_id},action:"/manage/uploadFormFile",onChange:A,onDrop:g},{default:t(()=>[o("p",Jt,[e(V(at))]),d[5]||(d[5]=o("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),d[6]||(d[6]=o("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1))]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(n,{open:p.value,"onUpdate:open":d[2]||(d[2]=f=>p.value=f),title:"导入数据",footer:null,width:746},{default:t(()=>[s.value<100?(c(),x("div",jt,[e(a,{type:"circle",percent:s.value},null,8,["percent"]),d[7]||(d[7]=o("div",{class:"tip"},"数据导入中，请勿关闭页面",-1))])):(c(),Y(U,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[y("导入成功"+D(l.success)+"，导入失败"+D(l.total-l.success)+" ",1),l.total-l.success>0?(c(),x("span",Kt," 您可以下载失败数据，修改后重新导入 ")):Z("",!0)]),extra:t(()=>[l.total-l.success>0?(c(),Y(u,{key:0,onClick:R,type:"primary"},{default:t(()=>[...d[8]||(d[8]=[y("下载失败数据",-1)])]),_:1})):Z("",!0)]),_:1}))]),_:1},8,["open"])])}}},Ht=ne(Gt,[["__scopeId","data-v-6beddc88"]]),Qt={key:0,class:"loading-box"},Wt={key:1,class:"empty-box"},Xt={key:2,class:"field-manage-page"},Zt={class:"page-title"},en={key:0},tn={key:1},nn={class:"table-wrapper customize-scroll-style"},an={key:0},ln={key:1},on={key:0},sn={key:1},rn=["onClick"],un=["onClick"],dn={__name:"index",setup(j){const P=ht(),z=qe(()=>P.databaseInfo.entry_count),T=te().query,q=m([]),v=m([]),b=m(!0),$=ee({form_id:T.form_id,page:1,size:10,total:0}),l=m(!1),N=f=>{$.page=f.current,$.size=f.pageSize,g()},A=()=>{$.page=1,g()},g=()=>{l.value=!0,ze({...$,filter_id:F.value}).then(f=>{q.value=f.data.list||[],$.total=+f.data.total||0,P.getDatabaseInfo({id:T.form_id})}).finally(()=>{l.value=!1})};Ye({form_id:T.form_id}).then(f=>{v.value=f.data,b.value=!1,g()});const S=m([]),F=m(""),w=()=>{ye({form_id:T.form_id}).then(f=>{let h=f.data||[];if(S.value=h.filter(K=>K.enabled=="true"),F.value){let K=h.filter(G=>G.id==F.value);(K.length&&K[0].enabled=="false"||!K.length)&&(F.value="",g())}})};w();const E=()=>{w(),g()},O=()=>{$.page=1,g()},_=m(null),p=(f,h)=>{h==="add"&&_.value.show()},s=f=>{H.confirm({title:"删除确认",icon:e(ce),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Je({id:f.id}).then(h=>{J.success("删除成功"),E()})},onCancel(){}})},R=()=>{H.confirm({title:"清空数据提示",icon:e(ce),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Be({form_id:T.form_id}).then(f=>{J.success("清空成功"),E()})},onCancel(){}})},i=m(null),d=(f={})=>{i.value.show(JSON.parse(JSON.stringify(f)))},I=m(null),r=(f={})=>{I.value.show()},n=m(null),a=()=>{n.value.show()},u=m(null),U=()=>{u.value.show()};return(f,h)=>{const K=rt,G=fe,le=_t,se=ct,re=dt,M=be,B=pt,k=pe,ae=mt,ue=vt,Oe=$e,Me=gt;return c(),x(Q,null,[b.value?(c(),x("div",Qt,[e(K)])):Z("",!0),!b.value&&!v.value.length?(c(),x("div",Wt,[...h[3]||(h[3]=[o("img",{src:Ie,alt:""},null,-1),o("div",null,"暂无字段, 请先去添加字段",-1)])])):Z("",!0),!b.value&&v.value.length?(c(),x("div",Xt,[o("div",Zt,[h[7]||(h[7]=y(" 数据管理 ",-1)),e(M,{gap:16},{default:t(()=>[e(G,{type:"primary",onClick:h[0]||(h[0]=C=>d())},{icon:t(()=>[e(V(ve))]),default:t(()=>[h[4]||(h[4]=y(" 添加数据 ",-1))]),_:1}),e(G,{onClick:h[1]||(h[1]=C=>r())},{icon:t(()=>[e(V(ut))]),default:t(()=>[h[5]||(h[5]=y(" 导入数据 ",-1))]),_:1}),e(re,null,{overlay:t(()=>[e(se,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[o("div",{onClick:a},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[o("div",{onClick:R},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(G,null,{default:t(()=>[h[6]||(h[6]=y(" 更多操作 ",-1)),e(V(it))]),_:1})]),_:1})]),_:1})]),e(ae,{class:"tabs-wrapper",activeKey:F.value,"onUpdate:activeKey":h[2]||(h[2]=C=>F.value=C),type:"editable-card",onEdit:p,onChange:O},{addIcon:t(()=>[e(V(ve)),h[8]||(h[8]=y(" 添加分类 ",-1))]),rightExtra:t(()=>[o("span",{class:"setting-btn",onClick:U},[e(V(ft)),h[9]||(h[9]=y(" 管理分类 ",-1))])]),default:t(()=>[e(B,{key:"",closable:!1},{tab:t(()=>[y("全部 ("+D(z.value)+")",1)]),_:1}),(c(!0),x(Q,null,X(S.value,C=>(c(),Y(B,{key:C.id,closable:!1},{tab:t(()=>[C.name.length>8?(c(),x("span",en,[e(k,null,{title:t(()=>[y(D(C.name),1)]),default:t(()=>[y(" "+D(C.name.slice(0,8)+"..."),1)]),_:2},1024)])):(c(),x("span",tn,D(C.name),1)),y(" ("+D(C.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),o("div",nn,[e(Me,{sticky:"","data-source":q.value,loading:l.value,scroll:{x:1e3},pagination:{current:$.page,total:$.total,pageSize:$.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:N},{default:t(()=>[e(ue,{key:"id","data-index":"id",title:"id",width:60}),(c(!0),x(Q,null,X(v.value,C=>(c(),Y(ue,{key:C.name,"data-index":C.name,width:165},{title:t(()=>[C.name.length>12?(c(),x("span",an,[e(k,null,{title:t(()=>[y(D(C.name),1)]),default:t(()=>[y(" "+D(C.name.slice(0,12)+"..."),1)]),_:2},1024)])):(c(),x("span",ln,D(C.name),1)),e(k,null,{title:t(()=>[y(D(C.description),1)]),default:t(()=>[e(V(xe),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:W})=>[W[C.name].length>10?(c(),x("span",on,[e(k,null,{title:t(()=>[y(D(W[C.name]),1)]),default:t(()=>[y(" "+D(W[C.name].slice(0,9)+"..."),1)]),_:2},1024)])):(c(),x("span",sn,D(W[C.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(ue,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:C})=>[o("span",null,[o("a",{onClick:W=>d(C)},"编辑",8,rn),e(Oe,{type:"vertical"}),o("a",{onClick:W=>s(C)},"删除",8,un)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(wt,{onOk:E,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e(Fe,{onOk:E,column:v.value,ref_key:"addFilrerModalRef",ref:_},null,8,["column"]),e($t,{ref_key:"exportModalRef",ref:n},null,512),e(zt,{onOk:g,onChange:w,column:v.value,ref_key:"filterManageModalRef",ref:u},null,8,["column"]),e(Ht,{onOk:A,column:v.value,ref_key:"importDataModalRef",ref:I},null,8,["column"])])):Z("",!0)],64)}}},kn=ne(dn,[["__scopeId","data-v-782a68fb"]]);export{kn as default};
