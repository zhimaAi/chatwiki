import{_ as ve}from"./cu-scroll-C6Q1olgl.js";import{b as te,e as qe,bc as Be,b6 as Ue,d as Ne,ap as Se,bk as X,aS as Le,h as Oe,ba as Me}from"../../index-BLRnoXQj.js";import{e as ge,ab as ne,aa as ye,r as ee,f,a1 as y,_ as s,a2 as l,a5 as _,k as t,n as de,ae as i,Y as d,a4 as H,u as k,F as I,ad as O,a7 as ce,A as me,G as p,y as Ae,l as be}from"./vue-chunks-Ci-XTWEs.js";import{A as De}from"./avatar-input-DnQvjVW2.js";import{M as pe}from"./model-select-KZ3YhMAM.js";import{O as Te}from"./open-grapg-modal-CTnxkSJS.js";import{C as Ve}from"./index-BEo_93wa.js";import{F as he,e as je,I as Ee,Q as Pe,X as Re,u as Fe,E as Ke,O as Ge,p as Je,ab as j,q as Qe,R as Ye,a as K,M as ae,ac as Xe,B as He,z as Ze,y as We,V as ea,U as ke,a8 as aa,g as ta,h as Z,a9 as na,aa as oa,H as fe,Y as la,Z as _a}from"./ui-antd-BKz8sshA.js";import{i as sa,e as ia,f as ua}from"./index-CSLUyYTS.js";import{A as ra}from"./add-collaborator-CtaTinag.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-ChQO-_r6.js";import"./index-DyZ-tGAB.js";const da={class:"add-library-page"},ca={class:"form-box"};const ma={class:"indexing-methods-box"},pa={class:"list-title-block"},ha={class:"list-title-block"},ka={class:"select-card-box"},fa={class:"card-title"},va={class:"card-title"},ga={class:"card-title"},ya={class:"card-title"},W="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",ba={__name:"knowledge-config",setup(oe){const q=qe(),N=ge(()=>{var n;return((n=q.companyInfo)==null?void 0:n.neo4j_status)=="true"}),x=ne(),v=ye(),C=x.query,b=Be,e=ee({library_name:"",library_intro:"",use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",avatar:b,avatar_file:"",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,normal_chunk_default_not_merged_text:"false",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:W,qa_index_type:1,group_id:0,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512}),B=f(""),M=f(0),w=f({}),G=n=>{e.use_model=r.includes(n.rawData.model_define)&&n.rawData.deployment_name?n.rawData.deployment_name:n.rawData.name,e.use_model_icon=n.icon,e.use_model_name=n.use_model_name,e.model_config_id=n.rawData.id,B.value=n.rawData.model_define,c()},S=f([]);Ue().then(n=>{S.value=n.data.map(a=>({label:a.name,value:a.no}))});const h=f(!0);(()=>{Se({id:C.id}).then(n=>{w.value=n.data,M.value=w.value.is_offline?2:1,e.library_name=n.data.library_name,e.qa_index_type=n.data.qa_index_type,e.library_intro=n.data.library_intro,e.use_model=n.data.use_model,e.is_offline=n.data.is_offline,e.group_id=n.data.group_id,e.model_config_id=n.data.model_config_id,e.avatar=n.data.avatar?n.data.avatar:b,e.avatar_file=n.data.avatar_file?n.data.avatar_file:"",e.graph_switch=n.data.graph_switch!="0",e.graph_model_config_id=n.data.graph_model_config_id>0?n.data.graph_model_config_id:void 0,e.graph_use_model=n.data.graph_use_model,e.chunk_type=+n.data.chunk_type,e.normal_chunk_default_separators_no=X(n.data.normal_chunk_default_separators_no,[12,11]),e.normal_chunk_default_chunk_size=n.data.normal_chunk_default_chunk_size,e.normal_chunk_default_not_merged_text=n.data.normal_chunk_default_not_merged_text,e.normal_chunk_default_chunk_overlap=n.data.normal_chunk_default_chunk_overlap,e.semantic_chunk_default_chunk_size=n.data.semantic_chunk_default_chunk_size,e.semantic_chunk_default_chunk_overlap=n.data.semantic_chunk_default_chunk_overlap,e.semantic_chunk_default_threshold=n.data.semantic_chunk_default_threshold,e.ai_chunk_size=n.data.ai_chunk_size||5e3,e.ai_chunk_model=n.data.ai_chunk_model,e.ai_chunk_model_config_id=n.data.ai_chunk_model_config_id,e.ai_chunk_prumpt=n.data.ai_chunk_prumpt||W,e.father_chunk_paragraph_type=+n.data.father_chunk_paragraph_type||2,e.father_chunk_separators_no=X(n.data.father_chunk_separators_no,[12,11]),e.father_chunk_chunk_size=+n.data.father_chunk_chunk_size||1024,e.son_chunk_separators_no=X(n.data.son_chunk_separators_no,[8,10]),e.son_chunk_chunk_size=+n.data.son_chunk_chunk_size||512,h.value=n.data.type==2})})();const E=f([{iconName:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"}]),A=he.useForm,P=ee({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}]}),{validateInfos:D}=A(e,P),J=n=>{e.avatar=n.imageUrl,e.avatar_file=n.file,c()},R=()=>!1,r=["azure","ollama","xinference","openaiAgent"],T=["azure"],le=()=>{c()},L=f([]),Q=n=>{L.value=n,Ae(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&xe()})},xe=()=>{if(L.value.length>0){let n=null,a=null;for(let z of L.value)if(z.model_define==="tongyi"){n=z;for(let u of n.children)if(u.name==="qwen-max"){a=u;break}break}n||(n=L.value[0],a=n.children[0]),n&&a&&(e.ai_chunk_model=a.name,e.ai_chunk_model_config_id=a.model_config_id)}},_e=f(null),Ce=n=>{if(n){e.graph_switch=!1;let a={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&L.value.length>0){let z=L.value[0];if(z){let u=z.children[0];a.graph_use_model=u.name,a.graph_model_config_id=u.model_config_id}}_e.value.show(a)}else e.graph_switch=!1,c()},F=n=>{e.chunk_type=n,c()},we=n=>{n.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=n.graph_model_config_id,e.graph_use_model=n.graph_use_model,c(()=>{ae.confirm({title:"已开启知识图谱",content:"您可以在文档列表中点击知识图谱学习，系統将在您手动操作后开始抽取知识图谱",cancelText:"知道了",okText:"去学习",icon:be(Xe,{style:{color:"#52c41a"}}),onOk:()=>v.push({path:"/library/details/knowledge-document",query:{id:C.id}})})}))},c=(n=null)=>{if(!e.library_name)return K.error("请输入知识库名称");let a={library_name:e.library_name,qa_index_type:e.qa_index_type,library_intro:e.library_intro,use_model:e.use_model,model_config_id:e.model_config_id,is_offline:e.is_offline,graph_switch:e.graph_switch?1:0,graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model,chunk_type:e.chunk_type,normal_chunk_default_separators_no:JSON.stringify(e.normal_chunk_default_separators_no),normal_chunk_default_chunk_size:e.normal_chunk_default_chunk_size,normal_chunk_default_chunk_overlap:e.normal_chunk_default_chunk_overlap,normal_chunk_default_not_merged_text:e.normal_chunk_default_not_merged_text,semantic_chunk_default_chunk_size:e.semantic_chunk_default_chunk_size,semantic_chunk_default_chunk_overlap:e.semantic_chunk_default_chunk_overlap,semantic_chunk_default_threshold:e.semantic_chunk_default_threshold,ai_chunk_size:e.ai_chunk_size,ai_chunk_model:e.ai_chunk_model,ai_chunk_model_config_id:e.ai_chunk_model_config_id,ai_chunk_prumpt:e.ai_chunk_prumpt,father_chunk_paragraph_type:e.father_chunk_paragraph_type,father_chunk_separators_no:JSON.stringify(e.father_chunk_separators_no),father_chunk_chunk_size:e.father_chunk_chunk_size,son_chunk_separators_no:JSON.stringify(e.son_chunk_separators_no),son_chunk_chunk_size:e.son_chunk_chunk_size,group_id:e.group_id,id:x.query.id};T.indexOf(B.value)>-1&&(a.use_model="默认"),e.avatar_file&&(a.avatar=e.avatar_file),Le(a).then(z=>{typeof n=="function"?n():K.success("修改成功")})},se=n=>{n!=e.qa_index_type&&(e.qa_index_type=n,c())};return(n,a)=>{const z=Ee,u=je,ie=Pe,g=Ne,ue=Re,Y=Fe,$=Ge,U=Ke,V=Je,re=Ye,ze=Qe,$e=he,Ie=ve;return s(),y(Ie,null,{default:l(()=>[_("div",da,[_("div",ca,[t($e,{"label-col":{span:6}},{default:l(()=>[t(u,H({ref:"name",label:"知识库名称"},k(D).library_name),{default:l(()=>[t(z,{onBlur:c,value:e.library_name,"onUpdate:value":a[0]||(a[0]=o=>e.library_name=o),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),t(u,{label:"知识库简介"},{default:l(()=>[t(ie,{onBlur:c,value:e.library_intro,"onUpdate:value":a[1]||(a[1]=o=>e.library_intro=o),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),t(u,H({ref:"name",label:"知识库封面"},k(D).avatar),{default:l(()=>[t(De,{value:e.avatar,"onUpdate:value":a[2]||(a[2]=o=>e.avatar=o),onChange:J},null,8,["value"]),a[28]||(a[28]=_("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[28]},16),t(u,H({label:"嵌入模型"},k(D).use_model),{default:l(()=>[i("",!0),t(Ve,{modelValue:e.use_model,"onUpdate:modelValue":a[3]||(a[3]=o=>e.use_model=o),"label-key":"use_model_name","value-key":"value",modelType:"TEXT EMBEDDING","model-config-id":e.model_config_id,onChange:G,onLoaded:Q},null,8,["modelValue","model-config-id"])]),_:1},16),de(t(u,{label:"生成知识图谱"},{default:l(()=>[t(ue,{onChange:Ce,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),a[29]||(a[29]=_("div",{class:"form-item-tip"},"开启后，可以文档列表手动点击知识图谱学习生成知识图谱",-1))]),_:1,__:[29]},512),[[me,N.value]]),de(t(u,{label:"知识图谱模型"},{default:l(()=>[t(pe,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":a[4]||(a[4]=o=>e.graph_use_model=o),modeId:e.graph_model_config_id,"onUpdate:modeId":a[5]||(a[5]=o=>e.graph_model_config_id=o),style:{width:"300px"},onChange:le,onLoaded:Q},null,8,["modeName","modeId"])]),_:1},512),[[me,e.graph_switch&&N.value]]),h.value?(s(),y(u,{key:0,label:"索引方式"},{default:l(()=>[_("div",ma,[_("div",{class:O(["list-item",{active:e.qa_index_type==1}]),onClick:a[6]||(a[6]=o=>se(1))},[t(g,{class:"check-icon",name:"check-arrow-filled"}),_("div",pa,[t(g,{name:"file-search"}),a[30]||(a[30]=p(" 问题与答案一起生成索引 "))]),a[31]||(a[31]=_("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),_("div",{class:O(["list-item",{active:e.qa_index_type==2}]),onClick:a[7]||(a[7]=o=>se(2))},[t(g,{class:"check-icon",name:"check-arrow-filled"}),_("div",ha,[t(g,{name:"comment-search"}),a[32]||(a[32]=p(" 仅对问题生成索引 "))]),a[33]||(a[33]=_("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2)])]),_:1})):i("",!0),h.value?i("",!0):(s(),d(I,{key:1},[t(u,{label:"分段方式",required:""},{default:l(()=>[a[42]||(a[42]=_("div",{class:"form-alert-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),_("div",ka,[_("div",{class:O(["select-card-item",{active:e.chunk_type==1}]),onClick:a[8]||(a[8]=o=>F(1))},[t(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",fa,[t(g,{name:"ordinary-segmentation",class:"title-icon"}),a[34]||(a[34]=p(" 普通分段 "))]),a[35]||(a[35]=_("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),_("div",{class:O(["select-card-item",{active:e.chunk_type==2}]),onClick:a[9]||(a[9]=o=>F(2))},[t(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",va,[t(g,{name:"semantic-segmentation",class:"title-icon"}),a[36]||(a[36]=p(" 语义分段 "))]),a[37]||(a[37]=_("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),h.value?i("",!0):(s(),d("div",{key:0,class:O(["select-card-item",{active:e.chunk_type==4}]),onClick:a[10]||(a[10]=o=>F(4))},[t(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",ga,[t(g,{name:"semantic-segmentation",class:"title-icon"}),a[38]||(a[38]=p(" 父子分段 "))]),a[39]||(a[39]=_("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2)),_("div",{class:O(["select-card-item",{active:e.chunk_type==3}]),onClick:a[11]||(a[11]=o=>F(3))},[t(g,{class:"check-arrow",name:"check-arrow-filled"}),_("div",ya,[t(g,{name:"semantic-segmentation",class:"title-icon"}),a[40]||(a[40]=p(" AI分段 "))]),a[41]||(a[41]=_("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])]),_:1,__:[42]}),e.chunk_type==1?(s(),d(I,{key:0},[t(u,{label:"分段标识符",required:""},{default:l(()=>[t(Y,{onChange:c,value:e.normal_chunk_default_separators_no,"onUpdate:value":a[12]||(a[12]=o=>e.normal_chunk_default_separators_no=o),mode:"tags",style:{width:"100%"},placeholder:"请选择分段标识符",options:S.value},null,8,["value","options"])]),_:1}),t(u,{label:"分段最大长度",required:""},{default:l(()=>[t(U,{gap:8,align:"center"},{default:l(()=>[t($,{onBlur:c,value:e.normal_chunk_default_chunk_size,"onUpdate:value":a[13]||(a[13]=o=>e.normal_chunk_default_chunk_size=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),a[43]||(a[43]=p(" 字符 "))]),_:1,__:[43]})]),_:1}),t(u,{label:"分段重叠长度"},{default:l(()=>[t(U,{gap:8,align:"center"},{default:l(()=>[t($,{onBlur:c,value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":a[14]||(a[14]=o=>e.normal_chunk_default_chunk_overlap=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),a[44]||(a[44]=p(" 字符 "))]),_:1,__:[44]})]),_:1}),t(u,null,{label:l(()=>[a[45]||(a[45]=p(" 自动合并较小分段 ")),t(V,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:l(()=>[t(k(j))]),_:1})]),default:l(()=>[t(ue,{onChange:c,checkedValue:"false",unCheckedValue:"true",checked:e.normal_chunk_default_not_merged_text,"onUpdate:checked":a[15]||(a[15]=o=>e.normal_chunk_default_not_merged_text=o),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})],64)):i("",!0),e.chunk_type==2?(s(),d(I,{key:1},[e.chunk_type==2?(s(),y(u,{key:0,required:""},{label:l(()=>[a[47]||(a[47]=p(" 分段阈值 ")),t(V,null,{title:l(()=>a[46]||(a[46]=[p("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")])),default:l(()=>[t(k(j),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[t($,{onBlur:c,value:e.semantic_chunk_default_threshold,"onUpdate:value":a[16]||(a[16]=o=>e.semantic_chunk_default_threshold=o),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):i("",!0),t(u,{label:"分段最大长度",required:""},{default:l(()=>[t(U,{gap:8,align:"center"},{default:l(()=>[t($,{onBlur:c,value:e.semantic_chunk_default_chunk_size,"onUpdate:value":a[17]||(a[17]=o=>e.semantic_chunk_default_chunk_size=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),a[48]||(a[48]=p(" 字符 "))]),_:1,__:[48]})]),_:1}),t(u,{label:"分段重叠长度"},{default:l(()=>[t(U,{gap:8,align:"center"},{default:l(()=>[t($,{onBlur:c,value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":a[18]||(a[18]=o=>e.semantic_chunk_default_chunk_overlap=o),style:{width:"220px"},precision:0,min:1,max:1e5},null,8,["value"]),a[49]||(a[49]=p(" 字符 "))]),_:1,__:[49]})]),_:1})],64)):i("",!0),e.chunk_type==3?(s(),d(I,{key:2},[e.chunk_type==3?(s(),y(u,{key:0,required:""},{label:l(()=>a[50]||(a[50]=[p(" AI大模型 ")])),default:l(()=>[t(pe,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":a[19]||(a[19]=o=>e.ai_chunk_model=o),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":a[20]||(a[20]=o=>e.ai_chunk_model_config_id=o),style:{width:"300px"},onChange:le,onLoaded:Q},null,8,["modeName","modeId"])]),_:1})):i("",!0),t(u,{label:"提示词设置",required:""},{default:l(()=>[t(U,{gap:8,align:"center"},{default:l(()=>[t(ie,{onBlur:c,maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":a[21]||(a[21]=o=>e.ai_chunk_prumpt=o),placeholder:W},null,8,["value"])]),_:1})]),_:1}),t(u,null,{label:l(()=>[a[52]||(a[52]=p(" 单次最大字符数 ")),t(V,null,{title:l(()=>a[51]||(a[51]=[p("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")])),default:l(()=>[t(k(j),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:l(()=>[t($,{onBlur:c,class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":a[22]||(a[22]=o=>e.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),a[53]||(a[53]=p(" 字符 "))]),_:1,__:[53]})],64)):i("",!0),e.chunk_type==4&&!h.value?(s(),d(I,{key:3},[a[58]||(a[58]=_("div",{class:"main-title-block"},"父块（用作上下文）",-1)),t(u,{label:"分段类型"},{default:l(()=>[t(ze,{onChange:c,value:e.father_chunk_paragraph_type,"onUpdate:value":a[23]||(a[23]=o=>e.father_chunk_paragraph_type=o)},{default:l(()=>[t(re,{value:1},{default:l(()=>[a[54]||(a[54]=p("全文 ")),t(V,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:l(()=>[t(k(j))]),_:1})]),_:1,__:[54]}),t(re,{value:2},{default:l(()=>[a[55]||(a[55]=p("段落 ")),t(V,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:l(()=>[t(k(j))]),_:1})]),_:1,__:[55]})]),_:1},8,["value"])]),_:1}),e.father_chunk_paragraph_type==2?(s(),y(u,{key:0,label:"分段标识符"},{default:l(()=>[t(Y,{placeholder:"请选择",onChange:c,style:{width:"100%"},mode:"tags",options:S.value,value:e.father_chunk_separators_no,"onUpdate:value":a[24]||(a[24]=o=>e.father_chunk_separators_no=o)},null,8,["options","value"])]),_:1})):i("",!0),e.father_chunk_paragraph_type==2?(s(),y(u,{key:1,label:"分段最大长度"},{default:l(()=>[t(U,{align:"center",gap:8},{default:l(()=>[t($,{style:{flex:"1"},onBlur:c,value:e.father_chunk_chunk_size,"onUpdate:value":a[25]||(a[25]=o=>e.father_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),a[56]||(a[56]=_("span",{class:"unit-text"},"字符",-1))]),_:1,__:[56]})]),_:1})):i("",!0),a[59]||(a[59]=_("div",{class:"main-title-block"},"子块（用于检索）",-1)),t(u,{label:"分段标识符"},{default:l(()=>[t(Y,{placeholder:"请选择",onChange:c,style:{width:"100%"},mode:"tags",options:S.value,value:e.son_chunk_separators_no,"onUpdate:value":a[26]||(a[26]=o=>e.son_chunk_separators_no=o)},null,8,["options","value"])]),_:1}),t(u,{label:"分段最大长度"},{default:l(()=>[t(U,{align:"center",gap:8},{default:l(()=>[t($,{style:{flex:"1"},onBlur:c,value:e.son_chunk_chunk_size,"onUpdate:value":a[27]||(a[27]=o=>e.son_chunk_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),a[57]||(a[57]=_("span",{class:"unit-text"},"字符",-1))]),_:1,__:[57]})]),_:1})],64)):i("",!0)],64))]),_:1})]),t(Te,{onOk:we,ref_key:"openGrapgModalRef",ref:_e},null,512)])]),_:1})}}},xa=te(ba,[["__scopeId","data-v-b9a770b4"]]),Ca={class:"content-box"},wa={key:0,class:"add-btn-block"},za={class:"list-content"},$a={key:0,class:"user-block"},Ia={class:"name-box"},qa={class:"name"},Ba={class:"remark-text"},Ua={key:0,class:"hover-btn-box"},Na={key:0},Sa={key:1},La={key:2},Oa={key:1,class:"hover-btn-box"},Ma={class:"role-menu-box"},Aa=["onClick"],Da={class:"menu-header"},Ta={key:0,class:"check-box"},Va=["onClick"],ja={class:"menu-header"},Ea={key:0,class:"check-box"},Pa=["onClick"],Ra={class:"menu-header"},Fa={key:0,class:"check-box"},Ka={class:"hover-btn-box"},Ga={key:0},Ja={key:1},Qa={key:2},Ya=["onClick"],Xa={__name:"role-permission",setup(oe){const q=ne().query,N=Oe(),x=ge(()=>N.user_name),v=f(Me(q.id)),C=f([]),b=ee({object_id:q.id,object_type:2}),e=()=>{sa({...b}).then(h=>{let m=h.data||[];C.value=m})};e();const B=f(null),M=()=>{B.value.show(C.value,[{object_id:+q.id,object_type:2,operate_rights:4}])},w=(h,m)=>{let E=m==4?"管理":m==2?"编辑":"查看";ae.confirm({title:"提示?",icon:t(fe),content:"确认修改该协作者权限为【"+E+"】",okText:"确认",cancelText:"取消",onOk:()=>{let A=[{object_id:+h.object_id,object_type:+h.object_type,operate_rights:+m}];ia({identity_ids:h.identity_id,identity_type:h.identity_type,object_array:JSON.stringify(A)}).then(P=>{K.success("修改成功"),e()})},onCancel(){}})},G=h=>{ae.confirm({title:"提示?",icon:t(fe),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{ua({identity_id:h.identity_id,identity_type:h.identity_type,object_id:h.object_id,object_type:h.object_type}).then(m=>{K.success("删除成功"),e()})},onCancel(){}})},S=f([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(h,m)=>{const E=He,A=ea,P=aa,D=We,J=ve;return s(),y(J,null,{default:l(()=>[_("div",Ca,[v.value==4?(s(),d("div",wa,[t(E,{type:"primary",onClick:M,icon:be(k(Ze))},{default:l(()=>m[0]||(m[0]=[p("添加协助者")])),_:1,__:[0]},8,["icon"])])):i("",!0),_("div",za,[t(D,{columns:S.value,"data-source":C.value,pagination:!1},{bodyCell:l(({column:R,record:r})=>[R.key==="name"?(s(),d("div",$a,[t(A,{shape:"square",src:r.avatar,size:40},{icon:l(()=>[r.avatar?i("",!0):(s(),y(k(ke),{key:0}))]),_:2},1032,["src"]),_("div",Ia,[_("div",qa,ce(r.user_name),1),_("div",Ba,ce(r.name),1)])])):i("",!0),R.key==="operate_rights"?(s(),d(I,{key:1},[v.value==2||r.user_name==x.value?(s(),d("div",Ua,[r.operate_rights==4?(s(),d("span",Na,"管理")):i("",!0),r.operate_rights==2?(s(),d("span",Sa,"编辑")):i("",!0),r.operate_rights==1?(s(),d("span",La,"查看")):i("",!0)])):r.role_type==1||r.is_creator==1?(s(),d("div",Oa,"管理")):(s(),y(P,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[_("div",Ma,[_("div",{class:"role-menu",onClick:T=>w(r,4)},[_("div",Da,[t(k(ke)),m[1]||(m[1]=_("span",{class:"title"},"管理",-1))]),m[2]||(m[2]=_("div",{class:"desc"},"可编辑，可删除，可查看",-1)),r.operate_rights==4?(s(),d("div",Ta,[t(k(Z))])):i("",!0)],8,Aa),_("div",{class:"role-menu",onClick:T=>w(r,2)},[_("div",ja,[t(k(na)),m[3]||(m[3]=_("span",{class:"title"},"编辑",-1))]),m[4]||(m[4]=_("div",{class:"desc"},"可编辑，可查看",-1)),r.operate_rights==2?(s(),d("div",Ea,[t(k(Z))])):i("",!0)],8,Va),_("div",{class:"role-menu",onClick:T=>w(r,1)},[_("div",Ra,[t(k(oa)),m[5]||(m[5]=_("span",{class:"title"},"查看",-1))]),m[6]||(m[6]=_("div",{class:"desc"},"仅查看",-1)),r.operate_rights==1?(s(),d("div",Fa,[t(k(Z))])):i("",!0)],8,Pa)])]),default:l(()=>[_("div",Ka,[r.operate_rights==4?(s(),d("span",Ga,"管理")):i("",!0),r.operate_rights==2?(s(),d("span",Ja,"编辑")):i("",!0),r.operate_rights==1?(s(),d("span",Qa,"查看")):i("",!0),t(k(ta))])]),_:2},1024))],64)):i("",!0),R.key==="action"?(s(),d(I,{key:2},[v.value==4&&r.user_name!=x.value?(s(),d(I,{key:0},[r.role_type!=1&&r.is_creator!=1?(s(),d("a",{key:0,onClick:T=>G(r)},"移除",8,Ya)):i("",!0)],64)):i("",!0)],64)):i("",!0)]),_:1},8,["columns","data-source"])])]),t(ra,{onOk:e,ref_key:"addCollaboratorRef",ref:B},null,512)]),_:1})}}},Ha=te(Xa,[["__scopeId","data-v-98bbc904"]]),Za={class:"page-container-box"},Wa={class:"content-box"},et={__name:"index",setup(oe){const q=ne(),N=ye(),x=q.query,v=f(+x.activeKey||1),C=()=>{let b={...x};v.value>1?b.activeKey=v.value:delete b.activeKey,N.push({query:{...b}})};return(b,e)=>{const B=_a,M=la;return s(),d("div",Za,[t(M,{activeKey:v.value,"onUpdate:activeKey":e[0]||(e[0]=w=>v.value=w),onChange:C},{default:l(()=>[(s(),y(B,{key:1,tab:"知识库配置"})),i("",!0)]),_:1},8,["activeKey"]),_("div",Wa,[v.value==1?(s(),y(xa,{key:0})):i("",!0),v.value==2?(s(),y(Ha,{key:1})):i("",!0)])])}}},ft=te(et,[["__scopeId","data-v-03720dfe"]]);export{ft as default};
