{"version":3,"file":"library-preview-Boo6hNMO.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/empty.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/graph-model/chart-box.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/graph-model/entity-details.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/graph-model/index.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/subsection-box.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/segmentation-mode.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/update-frequency.vue","../../../../front-end/chat-ai-admin-vue/src/components/pdf-preview/pdf-preview.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/document-segmentation/document-segmentation-model.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/re-segmentation-page.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/qa-subsection-box.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/components/segmentation-setting-modal.vue","../../../../front-end/chat-ai-admin-vue/src/views/library/library-preview/library-preview.vue"],"sourcesContent":["<template>\r\n  <div class=\"empty-box\">\r\n    <img src=\"../../../../assets/img/library/preview/empty.png\" alt=\"\" />\r\n    <div class=\"title\">{{ t('msg_empty') }}</div>\r\n    <div>\r\n      <a-button type=\"primary\" @click=\"handleOpenEditModal\">\r\n        <template #icon>\r\n          <PlusOutlined />\r\n        </template>\r\n        <span>{{ t('btn_add_segment') }}</span>\r\n      </a-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { PlusOutlined } from '@ant-design/icons-vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.empty')\r\nconst emit = defineEmits(['openEditSubscription'])\r\nconst props = defineProps({\r\n  detailsInfo: {\r\n    type: Object\r\n  }\r\n})\r\n\r\nconst handleOpenEditModal = () => {\r\n  emit('openEditSubscription', {})\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.empty-box {\r\n  padding-top: 148px;\r\n  width: 100%;\r\n  height: calc(100% - 20px);\r\n  background: #f2f4f7;\r\n  text-align: center;\r\n  img {\r\n    width: 200px;\r\n    height: 200px;\r\n  }\r\n  .title {\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n    color: #262626;\r\n    margin-bottom: 16px;\r\n  }\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.chart-wrapper {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #F2F4F7;\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 100%;\r\n  user-select: none;\r\n  touch-action: none;\r\n}\r\n\r\n.chart-mini-map {\r\n  position: absolute;\r\n  right: 0px;\r\n  bottom: 82px;\r\n  width: 200px;\r\n  height: 160px;\r\n  border-radius: 6px;\r\n  border: 1px solid #fff;\r\n  background-color: #fff;\r\n  filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.1));\r\n}\r\n\r\n.zoom-toolbar-wrapper{\r\n  position: absolute;\r\n  right: 12px;\r\n  bottom: 30px;\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"chart-wrapper\">\r\n    <div class=\"chart\" id=\"chartBox\" ref=\"chartBox\"></div>\r\n    <div class=\"chart-mini-map\" id=\"chatMap\"></div>\r\n    <div class=\"zoom-toolbar-wrapper\">\r\n      <ZoomToolbar :value=\"initialZoom\" @change=\"onZoomChange\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, reactive } from 'vue'\r\nimport { NVL } from '@neo4j-nvl/base'\r\nimport {\r\n  ZoomInteraction,\r\n  PanInteraction,\r\n  // DragNodeInteraction, \r\n  HoverInteraction,\r\n  ClickInteraction\r\n} from '@neo4j-nvl/interaction-handlers'\r\nimport ZoomToolbar from '@/views/library/knowledge-graph/components/zoom-toolbar/index.vue'\r\n\r\nconst emit = defineEmits(['nodeClick'])\r\n\r\nconst chartBox = ref(null)\r\nlet nvl = null\r\n\r\nconst state = reactive({\r\n  nodes: [],\r\n  edges: []\r\n})\r\n\r\nconst initialZoom = ref(1)\r\n\r\nconst callbacks = {\r\n  // onLayoutDone: () => console.log('Layout done')\r\n}\r\n\r\nconst init = () => {\r\n  if (nvl) {\r\n    nvl.destroy()\r\n  }\r\n\r\n  const options = {\r\n    layout: 'forceDirected',\r\n    initialZoom: initialZoom.value,\r\n    disableTelemetry: true,\r\n    maxZoom: 10,\r\n    minZoom: 0.1,\r\n    minimapContainer: document.getElementById('chatMap'),\r\n    styling: {\r\n      minimapViewportBoxColor: '#4399FF',\r\n      // dropShadowColor: 'rgba(255, 255, 255, 1)', // 用于悬停节点和关系的投影的颜色\r\n      selectedBorderColor: 'rgba(255, 255, 255, 1)', // 用于节点和关系的选定边界的颜色\r\n      // selectedInnerBorderColor: 'rgba(255, 255, 255, 1)', // 用于选定节点的边框的颜色\r\n    }\r\n  }\r\n\r\n  const container = document.getElementById('chartBox')\r\n\r\n  nvl = new NVL(container, state.nodes, state.edges, options, callbacks)\r\n\r\n  // 开启缩放和拖拽\r\n  const zoomInteraction = new ZoomInteraction(nvl)\r\n  // eslint-disable-next-line no-unused-vars\r\n  const pan = new PanInteraction(nvl)\r\n\r\n  zoomInteraction.updateCallback('onZoom', (zoomLevel) => {\r\n    initialZoom.value = Number(zoomLevel.toFixed(1))\r\n  })\r\n\r\n  // 用于拖拽节点的交互处理程序\r\n  // const dragNodeInteraction = new DragNodeInteraction(nvl)\r\n  \r\n  // 用于悬停节点的交互处理程序\r\n  new HoverInteraction(nvl, { drawShadowOnHover: true })\r\n\r\n  // 用于点击节点的交互处理程序\r\n  const clickInteraction = new ClickInteraction(nvl, {\r\n    selectOnClick: true\r\n  })\r\n  clickInteraction.updateCallback('onNodeClick', (node) => {\r\n    emit('nodeClick', node)\r\n  })\r\n\r\n \r\n}\r\n\r\nconst onZoomChange = (value) => {\r\n  initialZoom.value = value\r\n  if (nvl) {\r\n    nvl.setZoom(value)\r\n  }\r\n}\r\n\r\nconst add = ({ nodes, edges }) => {\r\n  state.nodes = [state.nodes, ...nodes]\r\n  state.edges = [state.edges, ...edges]\r\n\r\n  if (nvl) {\r\n    nvl.addElementsToGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst addAndUpdate = ({ nodes, edges }) => {\r\n  state.nodes = [state.nodes, ...nodes]\r\n  state.edges = [state.edges, ...edges]\r\n\r\n  if (nvl) {\r\n    nvl.addAndUpdateElementsInGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst update = ({ nodes, edges }) => {\r\n  state.nodes = nodes\r\n  state.edges = edges\r\n\r\n  if (nvl) {\r\n    nvl.updateElementsInGraph(nodes, edges)\r\n  }\r\n}\r\n\r\nconst destroy = () => {\r\n  if (nvl) {\r\n    nvl.destroy()\r\n  }\r\n}\r\n\r\nconst render = ({ nodes, edges }) => {\r\n  state.nodes = nodes\r\n  state.edges = edges\r\n\r\n  init()\r\n}\r\n\r\nonMounted(() => {\r\n  \r\n})\r\n\r\ndefineExpose({\r\n  render,\r\n  add,\r\n  addAndUpdate,\r\n  update,\r\n  destroy\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.popup-wrapper {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  width: 256px;\r\n  height: 100%;\r\n  border-radius: 6px;\r\n  background-color: #fff;\r\n\r\n  .popup-header {\r\n    display: flex;\r\n    flex-flow: row nowrap;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 16px 16px;\r\n\r\n    .popup-title {\r\n      line-height: 24px;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: #000000;\r\n    }\r\n\r\n    .close-btn {\r\n      font-size: 16px;\r\n      color: #595959;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n  .popup-body {\r\n    flex: 1;\r\n    padding-bottom: 16px;\r\n    overflow: hidden;\r\n\r\n    .popup-content {\r\n      padding: 0 16px;\r\n    }\r\n  }\r\n}\r\n\r\n.entity-details {\r\n  .to-details {\r\n    display: flex;\r\n    padding: 0 8px;\r\n    height: 24px;\r\n    line-height: 24px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    border-radius: 6px;\r\n    color: #595959;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n\r\n    &:hover {\r\n      background: #E4E6EB;\r\n    }\r\n\r\n    .right-icon {\r\n      font-size: 16px;\r\n      color: #595959;\r\n    }\r\n  }\r\n\r\n  .entity-item {\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .entity-item-header {\r\n    display: flex;\r\n    flex-flow: row nowrap;\r\n    justify-content: space-between;\r\n    margin-bottom: 4px;\r\n\r\n    .entity-item-label {\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 600;\r\n      color: #262626;\r\n    }\r\n  }\r\n\r\n  .entity-name,\r\n  .fragment-content {\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n    font-weight: 400;\r\n    color: #595959;\r\n  }\r\n\r\n  .doc-item {\r\n    margin-bottom: 4px;\r\n\r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n\r\n  .subgraph-item {\r\n    padding-bottom: 8px;\r\n    margin-bottom: 8px;\r\n    border-bottom: 1px solid #f0f0f0;\r\n\r\n    &:last-child {\r\n      margin-bottom: 0;\r\n      border-bottom: 0;\r\n    }\r\n  }\r\n\r\n  .file-info {\r\n    display: flex;\r\n    align-items: center;\r\n    border-radius: 6px;\r\n    color: #2475FC;\r\n    transition: all 0.2s;\r\n    cursor: pointer;\r\n\r\n    .file-icon {\r\n      font-size: 16px;\r\n    }\r\n\r\n    .file-name {\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      margin-left: 4px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"popup-wrapper entity-details-wrapper\" v-if=\"state.show\">\r\n    <div class=\"popup-header\">\r\n      <div class=\"popup-title\">实体详情</div>\r\n      <CloseOutlined class=\"close-btn\" @click=\"close\" />\r\n    </div>\r\n\r\n    <div class=\"popup-body\" v-if=\"state.node\">\r\n      <cu-scroll>\r\n        <div class=\"popup-content\">\r\n          <div class=\"entity-details\">\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">实体</div>\r\n              </div>\r\n              <div class=\"entity-name\">{{ state.node.name }}</div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\" style=\"margin-bottom: 8px;\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">归属文档</div>\r\n              </div>\r\n\r\n              <div class=\"file-info\">\r\n                <svg-icon class=\"file-icon\" name=\"doc-file\" style=\"\"></svg-icon>\r\n                <span class=\"file-name\">{{ state.node.file_name }}</span>\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">分段</div>\r\n              </div>\r\n\r\n              <div>\r\n                <div class=\"doc-item\">\r\n                  <div class=\"fragment-content\">{{ state.node.content }}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div class=\"entity-item\">\r\n              <div class=\"entity-item-header\">\r\n                <div class=\"entity-item-label\">子图</div>\r\n              </div>\r\n\r\n              <div>\r\n                <div class=\"\" v-if=\"state.fromNodes.length == 0\">无</div>\r\n                <div class=\"subgraph-item\" v-for=\"item in state.fromNodes\" :key=\"item.id\">\r\n                  <div class=\"fragment-content\">{{ item.name }}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </cu-scroll>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, nextTick } from 'vue'\r\nimport { CloseOutlined } from '@ant-design/icons-vue'\r\nimport CuScroll from '@/views/library/knowledge-graph/components/cu-scroll.vue';\r\n\r\nconst state = reactive({\r\n  show: false,\r\n  node: null,\r\n  fromNodes: []\r\n})\r\n\r\nconst close = () => {\r\n  state.show = false\r\n}\r\n\r\nconst open = (node, fromNodes) => {\r\n  state.node = node\r\n  state.fromNodes = fromNodes\r\n\r\n  if(state.show){\r\n    state.show = false\r\n    nextTick(() => {\r\n      state.show = true\r\n    })\r\n  }else{\r\n    state.show = true\r\n  }\r\n}\r\n\r\ndefineExpose({\r\n  open,\r\n  close\r\n})\r\n</script>\r\n","<template>\r\n  <div ref=\"mymodal\">\r\n    <a-modal wrapClassName=\"graph-model-wrapper\" :zIndex=\"99999\" centered v-model:open=\"show\" title=\"知识图谱\" width=\"90vw\" :footer=\"null\" @ok=\"handleOk\" @cancel=\"handleCancel\">\r\n      <div class=\"graph-model-body\">\r\n        <div class=\"loading-wrapper\" v-if=\"loading\"> <a-spin /></div>\r\n        <chartBox ref=\"chartBoxRef\" :loading=\"loading\" @nodeClick=\"onNodeClick\" />\r\n\r\n        <div class=\"right-box\">\r\n          <EntityDetails ref=\"entityDetailsRef\" />\r\n        </div>\r\n      </div>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { getFileGraphInfo } from '@/api/library/index'\r\nimport { ref, reactive } from 'vue';\r\nimport chartBox from './chart-box.vue';\r\nimport EntityDetails from './entity-details.vue'\r\n\r\nconst show = ref(false);\r\nconst mymodal = ref(null)\r\nconst chartBoxRef = ref(null)\r\nconst entityDetailsRef = ref(null)\r\nconst loading = ref(false)\r\n\r\nconst state = reactive({\r\n  file_id: '',\r\n  data_id: '',\r\n})\r\n\r\nconst chartData = reactive({\r\n  edges: [],\r\n  nodes: []\r\n})\r\n\r\n// 关系映射\r\nlet edgeMap = {}\r\n\r\nconst getData = () => {\r\n  getGraphData()\r\n}\r\n\r\nconst getGraphData= () => {\r\n  loading.value = true\r\n  getFileGraphInfo({\r\n    file_id: state.file_id,\r\n    data_id: state.data_id,\r\n    search_term: state.search_term\r\n  }).then(res => {\r\n    loading.value = false\r\n\r\n    let edges = res.data.edges || []\r\n    let nodes = res.data.nodes || []\r\n    // 去重逻辑（包含反向检测）\r\n    const edgeSet = new Map();\r\n    edges = edges.filter(item => {\r\n      const key = `${item.from_id}_${item.to_id}`;\r\n      const reverseKey = `${item.to_id}_${item.from_id}`;\r\n      \r\n      if(edgeSet.has(key) || edgeSet.has(reverseKey)) {\r\n        return false;\r\n      }\r\n      edgeSet.set(key, true);\r\n      return true;\r\n    });\r\n\r\n    edges.forEach(item => {\r\n      item.id = item.id.toString()\r\n      item.from = item.from_id.toString()\r\n      item.to = item.to_id.toString()\r\n      item.caption = item.label\r\n    })\r\n\r\n    const fromNodes = new Set(edges.map(e => e.from));\r\n    const toNodes = new Set(edges.map(e => e.to));\r\n\r\n    nodes.forEach(item => {\r\n      item.caption = item.name\r\n      item.id = item.id.toString()\r\n\r\n      item.nodeType = \r\n        fromNodes.has(item.id) && toNodes.has(item.id) ? 'both' :\r\n        fromNodes.has(item.id) ? 'from' :\r\n        toNodes.has(item.id) ? 'to' : 'normal';\r\n\r\n      // 根据类型设置样式\r\n      if(item.nodeType === 'from') {\r\n        item.size = 35;\r\n        item.color = '#FFB1B2';\r\n      } else if(item.nodeType === 'to') {\r\n        item.size = 45; \r\n        item.color = '#005AFF';\r\n      } else {\r\n        item.size = 30;\r\n        item.color = '#69E9BE';\r\n      }\r\n    });\r\n\r\n    let data = {\r\n      edges,\r\n      nodes\r\n    }\r\n    \r\n    chartData.edges = data.edges\r\n    chartData.nodes = data.nodes\r\n\r\n    setTimeout(() => {\r\n      chartBoxRef.value.render(data)\r\n    }, 0);\r\n\r\n    edgeMap = {}\r\n    // 提前生成关系映射\r\n    edges.forEach((edge) => {\r\n      if (!edgeMap[edge.to]) {\r\n        edgeMap[edge.to] = [];\r\n      }\r\n      \r\n      edgeMap[edge.to].push(edge.from);\r\n    });\r\n\r\n  }).catch(err => {\r\n    console.log(err)\r\n    loading.value = false\r\n  })\r\n}\r\n\r\nconst onNodeClick = (node) => {\r\n  let edgeIds = edgeMap[node.id] || []\r\n  let fromNodes = []\r\n  \r\n  for (let i = 0; i < chartData.nodes.length; i++) {\r\n    if(edgeIds.indexOf(chartData.nodes[i].id) > -1){\r\n     \r\n      fromNodes.push(chartData.nodes[i])\r\n    }\r\n  }\r\n  \r\n  entityDetailsRef.value.open(node, fromNodes)\r\n}\r\n\r\nconst handleCancel = () => {\r\n  chartBoxRef.value.destroy()\r\n  show.value = false;\r\n};\r\n\r\nconst handleOk = () => {\r\n  show.value = false;\r\n};\r\n\r\nconst open = (data) => {\r\n  state.file_id = data.file_id\r\n  state.data_id = data.id\r\n  show.value = true\r\n\r\n  setTimeout(() => {\r\n    getData()\r\n  }, 350);\r\n};\r\n\r\ndefineExpose({\r\n  open,\r\n})\r\n\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.my-modal{\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n}\r\n.graph-model-body{\r\n  position: relative;\r\n  height: 90vh;\r\n  width: 100%;\r\n  overflow: hidden;\r\n\r\n  .loading-wrapper{\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(242, 244, 247, 0.1);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 10;\r\n  }\r\n\r\n  .right-box{\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n  }\r\n}\r\n</style>\r\n\r\n<style lang=\"less\">\r\n.graph-model-wrapper {\r\n  .ant-modal{\r\n    .ant-modal-body,\r\n    .ant-modal-header,\r\n    .ant-modal-content{\r\n      background: #F2F4F7 !important;\r\n    }\r\n\r\n\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"subsection-box content-container\" ref=\"containerRef\">\r\n    <div class=\"subsection-box-title\">\r\n      {{ t('segmentation_preview') }}\r\n      <span>{{ t('total_segments', { count: props.total }) }}</span>\r\n    </div>\r\n    <div\r\n      class=\"list-item\"\r\n      :class=\"{'fragment-father-son-item': props.detailsInfo.chunk_type == 4, 'dashed-line': getIsNeedDashedLine(item, index), 'mt8': props.detailsInfo.chunk_type == 4 && !getIsNeedDashedLine(item, index)}\"\r\n      v-for=\"(item, index) in props.paragraphLists\"\r\n      :key=\"item.id\"\r\n      @click.stop=\"handleToTargetPage(item, index, $event)\"\r\n      :style=\"{'--status-color': getColor(item)}\"\r\n    >\r\n      <div class=\"top-block\">\r\n        <div class=\"title\">\r\n          <!-- id：{{ item.id }} -->\r\n          {{ t('segment') }} <template v-if=\"props.detailsInfo.chunk_type == 4\">{{ t('segment_father_child', { father: item.father_chunk_paragraph_number, child: item.number }) }}</template><template v-else>{{ item.number }}</template>\r\n          <div class=\"title-block\">\r\n            {{ item.title }}\r\n          </div>\r\n          <span>{{ t('total_characters', { count: item.word_total }) }}</span>\r\n          <span class=\"status-box\">\r\n            {{ t('embedding_status') }}：{{ item.status_text }}<LoadingOutlined v-if=\"item.status == 3\" />\r\n            <a-tooltip v-if=\"item.status == 2 && item.errmsg\" :title=\"item.errmsg\">\r\n              <strong class=\"cfb363f\"\r\n                >{{ t('reason') }}<ExclamationCircleOutlined class=\"err-icon cfb363f\"\r\n              /></strong>\r\n            </a-tooltip>\r\n            <a-tooltip v-if=\"item.split_status == 4 && item.split_err_msg\" :title=\"item.split_err_msg\">\r\n              <div class=\"split-err\">\r\n                <ExclamationCircleFilled style=\"margin-left: 0;\" class=\"cfb363f\" />\r\n                {{ t('segmentation_failed') }}\r\n              </div>\r\n            </a-tooltip>\r\n          </span>\r\n          <span v-if=\"detailsInfo.graph_switch\">\r\n            {{ t('knowledge_graph_status') }}：{{ item.graph_status_text }}\r\n            <a-tooltip\r\n              v-if=\"item.graph_status == 3 && item.graph_err_msg\"\r\n              :title=\"item.graph_err_msg\"\r\n            >\r\n              <strong class=\"cfb363f\"\r\n                >{{ t('reason') }}<ExclamationCircleOutlined class=\"err-icon cfb363f\"\r\n              /></strong>\r\n            </a-tooltip>\r\n          </span>\r\n        </div>\r\n        <div class=\"right-opration\">\r\n          <a-dropdown>\r\n            <div class=\"hover-btn-box\">\r\n              <StarFilled\r\n                @click.stop=\"handleSetCategory(item, {})\"\r\n                :style=\"{ color: getColor(item), 'font-size': '16px' }\"\r\n                v-if=\"item.category_id > 0\"\r\n              />\r\n              <StarOutlined\r\n                @click=\"handleSetCategory(item, startLists[0])\"\r\n                style=\"font-size: 16px;color: #595959;\"\r\n                v-else\r\n              />\r\n            </div>\r\n\r\n            <template #overlay>\r\n              <a-menu>\r\n                <a-menu-item v-for=\"star in startLists\" :key=\"star.id\">\r\n                  <div class=\"start-item\" @click.stop=\"handleSetCategory(item, star)\">\r\n                    <StarFilled :style=\"{ color: colorLists[star.type] }\" />\r\n                    <div>{{ star.name || '-' }}</div>\r\n                  </div>\r\n                </a-menu-item>\r\n                <a-menu-item>\r\n                  <div class=\"start-item\" @click.stop=\"handleOpenSetStartModal\">\r\n                    <SettingOutlined />\r\n                    <div>{{ t('featured_settings') }}</div>\r\n                  </div>\r\n                </a-menu-item>\r\n              </a-menu>\r\n            </template>\r\n          </a-dropdown>\r\n\r\n          <a-tooltip>\r\n            <template #title>{{ t('re_segment') }}</template>\r\n            <div class=\"hover-btn-box\" @click.stop=\"onReSegment(item)\">\r\n              <svg-icon name=\"segmentation-icon\" style=\"font-size: 16px;\"></svg-icon>\r\n            </div>\r\n          </a-tooltip>\r\n\r\n          <template v-if=\"detailsInfo.graph_switch\">\r\n            <a-tooltip>\r\n              <template #title>{{ t('knowledge_graph') }}</template>\r\n              <div class=\"hover-btn-box\" @click=\"openGraphModel(item)\">\r\n                <svg-icon name=\"graph-icon\" style=\"font-size: 16px;color: #595959;\"></svg-icon>\r\n              </div>\r\n            </a-tooltip>\r\n          </template>\r\n\r\n          <a-tooltip>\r\n            <template #title>{{ t('re_convert') }}</template>\r\n            <div class=\"hover-btn-box\">\r\n              <SyncOutlined @click.stop=\"toReSegmentationPage(item, index)\" />\r\n            </div>\r\n          </a-tooltip>\r\n          <a-dropdown placement=\"bottomRight\">\r\n            <div class=\"hover-btn-box\">\r\n              <MoreOutlined style=\"font-size: 16px;color: #595959;\" />\r\n            </div>\r\n            <template #overlay>\r\n              <a-menu>\r\n                <a-menu-item>\r\n                  <div @click.stop=\"handleOpenEditModal(item)\">{{ t('edit') }}</div>\r\n                </a-menu-item>\r\n                <a-menu-item>\r\n                  <div @click.stop=\"hanldleDelete(item.id)\">{{ t('delete') }}</div>\r\n                </a-menu-item>\r\n              </a-menu>\r\n            </template>\r\n          </a-dropdown>\r\n        </div>\r\n      </div>\r\n      <div class=\"content-box\" v-if=\"item.question\">{{ t('question_prefix') }} <span v-html=\"textToHighlight(item.question, props.search)\"></span></div>\r\n      <div class=\"content-box\" v-if=\"item.answer\">{{ t('answer_prefix') }}<span v-html=\"textToHighlight(item.answer, props.search)\"></span></div>\r\n      <div class=\"content-box\" @mouseup.stop=\"handleMouseUp($event, index)\" v-html=\"textToHighlight(item.content, props.search)\"></div>\r\n      <div class=\"fragment-img\" v-if=\"item.images.length > 0\" v-viewer>\r\n        <img v-for=\"(item, imageIndex) in item.images\" :key=\"imageIndex\" :src=\"item\" alt=\"\" />\r\n      </div>\r\n    </div>\r\n    <ClassificationMarkModal @ok=\"getCategoryLists\" ref=\"classificationMarkModalRef\" />\r\n    <GraphModel ref=\"graphModelRef\" />\r\n    <!-- 选择内容气泡 -->\r\n    <div\r\n      v-if=\"showBubble\"\r\n      class=\"bubble-card\"\r\n      :style=\"bubbleStyle\"\r\n    >\r\n      <button class=\"bubble-item\" @click.stop=\"handleAction('separate')\">\r\n        <svg-icon\r\n          name=\"segmentation\"\r\n          style=\"font-size: 16px; color: #262626; margin-right: 4px\"\r\n        ></svg-icon>\r\n        {{ t('separate') }}\r\n      </button>\r\n      <button class=\"bubble-item\" @click.stop=\"handleAction('merge-prev')\">\r\n        <svg-icon\r\n          name=\"segmentation-up\"\r\n          style=\"font-size: 16px; color: #262626; margin-right: 4px\"\r\n        ></svg-icon>\r\n        {{ t('merge_prev') }}\r\n      </button>\r\n      <button class=\"bubble-item\" @click.stop=\"handleAction('merge-next')\">\r\n        <svg-icon\r\n          name=\"segmentation-down\"\r\n          style=\"font-size: 16px; color: #262626; margin-right: 4px\"\r\n        ></svg-icon>\r\n        {{ t('merge_next') }}\r\n      </button>\r\n      <button class=\"bubble-item\" @click.stop=\"handleAction('delete')\">\r\n        <svg-icon\r\n          name=\"delete\"\r\n          style=\"font-size: 16px; color: #262626; margin-right: 4px\"\r\n        ></svg-icon>\r\n        {{ t('delete_content') }}\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, createVNode, computed, onMounted, onUnmounted   } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { message } from 'ant-design-vue'\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  ExclamationCircleFilled,\r\n  MoreOutlined,\r\n  SyncOutlined,\r\n  LoadingOutlined,\r\n  StarOutlined,\r\n  StarFilled,\r\n  SettingOutlined\r\n} from '@ant-design/icons-vue'\r\nimport { Modal } from 'ant-design-vue'\r\nimport ClassificationMarkModal from './classification-mark-modal.vue'\r\nimport GraphModel from './graph-model/index.vue'\r\nimport colorLists from '@/utils/starColors.js'\r\nimport {\r\n  deleteParagraph,\r\n  editParagraph,\r\n  getCategoryList,\r\n  updateParagraphCategory\r\n} from '@/api/library'\r\nimport {useMathJax} from \"@/composables/useMathJax.js\";\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.subsection-box')\r\n\r\nconst route = useRoute()\r\nconst emit = defineEmits([\r\n  'handleDelParagraph',\r\n  'handleScrollTargetPage',\r\n  'openEditSubscription',\r\n  'handleConvert',\r\n  'getStatrList',\r\n  'handleSplit',\r\n  'handleSplitNext',\r\n  'handleSplitUp',\r\n  'handleSplitDelete',\r\n  'handleSegmentation'\r\n])\r\n\r\nconst props = defineProps({\r\n  paragraphLists: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  search: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  detailsInfo:{\r\n    type: Object,\r\n    default: () => {}\r\n  },\r\n  total: {\r\n    type: [Number, String],\r\n    default: 0\r\n  }\r\n})\r\nconst { renderMath } = useMathJax();\r\n\r\nconst toReSegmentationPage = (item, index) => {\r\n  let { id, title, content, question, answer, images, category_id } = item\r\n  let similar_questions = item.similar_questions || []\r\n  Modal.confirm({\r\n    title: t('re_convert_confirm_title'),\r\n    icon: null,\r\n    content: t('re_convert_confirm_content', { index: index + 1 }),\r\n    onOk() {\r\n      return new Promise((resolve) => {\r\n        editParagraph({ id, title, content, question, answer, images, category_id, similar_questions: JSON.stringify(similar_questions)  })\r\n          .then(() => {\r\n            emit('handleConvert', item)\r\n            resolve()\r\n          })\r\n          .catch(() => {\r\n            resolve()\r\n          })\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst handleOpenEditModal = (item) => {\r\n  emit('openEditSubscription', item)\r\n}\r\nconst hanldleDelete = (id) => {\r\n  Modal.confirm({\r\n    title: t('confirm_delete_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('confirm_delete_content'),\r\n    onOk() {\r\n      return new Promise((resolve) => {\r\n        deleteParagraph({ id })\r\n          .then(() => {\r\n            message.success(t('delete_success'))\r\n            emit('handleDelParagraph', id)\r\n            resolve()\r\n          })\r\n          .catch(() => {\r\n            resolve()\r\n          })\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst handleToTargetPage = (item, index, event) => {\r\n  // 如果有选中文本则不执行跳转\r\n  if (window.getSelection().toString().trim()) return;\r\n\r\n  emit('handleScrollTargetPage', {\r\n    page_num: item.page_num,\r\n    index\r\n  })\r\n\r\n  handleClickOutside(event)\r\n}\r\n\r\nconst onReSegment = (item) => {\r\n  emit('handleSegmentation', item)\r\n}\r\n\r\nconst startLists = ref([])\r\nconst getCategoryLists = () => {\r\n  let params = {\r\n    file_id: route.query.id\r\n  }\r\n  getCategoryList(params).then((res) => {\r\n    startLists.value = res.data || []\r\n    emit('getStatrList', res.data || [])\r\n  })\r\n}\r\ngetCategoryLists()\r\n\r\nconst classificationMarkModalRef = ref(null)\r\nconst handleOpenSetStartModal = () => {\r\n  classificationMarkModalRef.value.show()\r\n}\r\n\r\nconst getColor = (data) => {\r\n  let type = startLists.value.filter((item) => item.id == data.category_id)[0]?.type\r\n  if (type) {\r\n    return colorLists[type]\r\n  } else {\r\n    return ''\r\n  }\r\n}\r\nconst handleSetCategory = (item, star = {}) => {\r\n  updateParagraphCategory({\r\n    id: item.id,\r\n    category_id: star.id || 0\r\n  }).then(() => {\r\n    message.success(t('set_success'))\r\n    item.category_id = star.id\r\n    getCategoryLists()\r\n  })\r\n}\r\n\r\nconst graphModelRef = ref(null)\r\nconst openGraphModel = (item) => {\r\n\r\n  graphModelRef.value.open(item)\r\n}\r\n\r\nconst containerRef = ref(null);\r\nconst showBubble = ref(false);\r\nconst position = ref({ x: 0, y: 0 });\r\nconst selectedText = ref('');\r\nconst selectedRange = ref(null);\r\nconst selectedData = ref({\r\n  text: '',\r\n  parentIndex: -1,\r\n  originalHtml: ''\r\n});\r\n\r\n// 计算气泡卡片样式\r\nconst bubbleStyle = computed(() => {\r\n  if (!showBubble.value) return {};\r\n\r\n  // 获取气泡卡片的预估宽度和高度\r\n  const bubbleWidth = 162; // 根据实际样式调整\r\n\r\n  // 计算理想位置\r\n  let left = position.value.x;\r\n  let top = position.value.y;\r\n\r\n  // 获取容器和视口尺寸\r\n  const containerRect = containerRef.value.getBoundingClientRect();\r\n  const viewportWidth = window.innerWidth;\r\n\r\n  // 防止左侧超出\r\n  if (left < 10) {\r\n    left = 10;\r\n  }\r\n  // 防止右侧超出\r\n  else if (left + bubbleWidth > viewportWidth - 50) {\r\n    left = viewportWidth - bubbleWidth - 50;\r\n  }\r\n\r\n  // 转换为相对于容器的位置\r\n  const containerLeft = left - containerRect.left;\r\n  const containerTop = top;\r\n\r\n  return {\r\n    left: `${containerLeft}px`,\r\n    top: `${containerTop}px`,\r\n    // 添加一个箭头指向选中文本\r\n    // '--arrow-offset': `${position.value.x - containerLeft}px`\r\n  };\r\n});\r\n\r\nconst handleMouseUp = (event, parentIndex) => {\r\n  setTimeout(() => {\r\n    const selection = window.getSelection();\r\n    const selectedTextContent = selection.toString().trim();\r\n\r\n    if (selectedTextContent) {\r\n      event.stopPropagation(); // 阻止事件冒泡\r\n      // 保存选中信息\r\n      selectedData.value = {\r\n        text: selectedTextContent,\r\n        parentIndex,\r\n        originalHtml: props.paragraphLists[parentIndex].content\r\n      };\r\n\r\n      selectedText.value = selectedTextContent;\r\n      selectedRange.value = selection.getRangeAt(0).cloneRange();\r\n\r\n      // 获取选中文本的位置\r\n      const range = selection.getRangeAt(0);\r\n      const rect = range.getBoundingClientRect();\r\n\r\n      // 计算相对于内容区域的位置\r\n      const contentRect = containerRef.value.getBoundingClientRect();\r\n\r\n      position.value = {\r\n        x: rect.left + rect.width / 2,\r\n        y: rect.top - contentRect.top - 50 // 向上偏移50px显示气泡\r\n      };\r\n\r\n      showBubble.value = true;\r\n    } else {\r\n      showBubble.value = false;\r\n    }\r\n  }, 50);\r\n};\r\n\r\nconst handleAction = (action) => {\r\n  const { parentIndex } = selectedData.value;\r\n\r\n  switch(action) {\r\n    case 'separate':\r\n      separateParagraph(parentIndex);\r\n      break;\r\n    case 'merge-next':\r\n      mergeWithNext(parentIndex);\r\n      break;\r\n    case 'merge-prev':\r\n      mergeWithPrevious(parentIndex);\r\n      break;\r\n    case 'delete':\r\n      onDeleteParagraph(parentIndex);\r\n      break;\r\n  }\r\n\r\n  showBubble.value = false;\r\n  window.getSelection().removeAllRanges();\r\n};\r\n\r\n// 新增HTML内容拆分方法\r\nconst splitHtmlContent = (container, startOffset, endOffset) => {\r\n  // 增加全选内容判断\r\n  const isFullSelection =\r\n    startOffset === 0 &&\r\n    endOffset === container.textContent.length &&\r\n    container.textContent.trim().length > 0;\r\n\r\n  if (isFullSelection) {\r\n    return ['', container.innerHTML, '']; // 当全选时返回完整内容\r\n  }\r\n  const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT)\r\n  let node\r\n  let count = 0\r\n  let startNode, endNode\r\n  let startIndex, endIndex\r\n\r\n  while ((node = walker.nextNode())) {\r\n    const length = node.nodeValue.length\r\n    if (!startNode && count + length >= startOffset) {\r\n      startNode = node\r\n      startIndex = startOffset - count\r\n    }\r\n    if (!endNode && count + length >= endOffset) {\r\n      endNode = node\r\n      endIndex = endOffset - count\r\n      break\r\n    }\r\n    count += length\r\n  }\r\n\r\n  const range = document.createRange()\r\n  range.setStart(startNode, startIndex)\r\n  range.setEnd(endNode, endIndex)\r\n\r\n  const beforeRange = document.createRange()\r\n  beforeRange.setStart(container, 0)\r\n  beforeRange.setEnd(startNode, startIndex)\r\n\r\n  const afterRange = document.createRange()\r\n  afterRange.setStart(endNode, endIndex)\r\n  afterRange.setEnd(container, container.childNodes.length)\r\n\r\n  return [\r\n    getRangeHtml(beforeRange),\r\n    getRangeHtml(range),\r\n    getRangeHtml(afterRange)\r\n  ]\r\n}\r\n\r\nconst getRangeHtml = (range) => {\r\n  const div = document.createElement('div')\r\n  div.appendChild(range.cloneContents())\r\n  return div.innerHTML\r\n}\r\n\r\n// 修改后的分段方法\r\nconst separateParagraph = (index) => {\r\n  const content = props.paragraphLists[index].content\r\n  const selection = window.getSelection()\r\n  const range = selection.getRangeAt(0)\r\n  const selectedText = range.toString()\r\n\r\n  if (!selectedText) return\r\n\r\n  Modal.confirm({\r\n    title: t('separate_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('separate_content'),\r\n    onOk() {\r\n      // 创建临时容器处理HTML内容\r\n      const tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = content\r\n\r\n      // 拆分选中内容\r\n      const [beforeContent, selectedContent, afterContent] = splitHtmlContent(\r\n        tempDiv,\r\n        range.startOffset,\r\n        range.endOffset\r\n      )\r\n\r\n      // 新增全选判断逻辑\r\n      const isEmptyBefore = beforeContent.replace(/<[^>]+>/g, '').trim() === '';\r\n      const isEmptyAfter = afterContent.replace(/<[^>]+>/g, '').trim() === '';\r\n\r\n      // 触发更新时需要保留原始选中信息\r\n      if (isEmptyBefore && isEmptyAfter) {\r\n        // 当全选内容时直接替换原段落\r\n        emit('handleSplit', {\r\n          index,\r\n          beforeContent: '',       // 清空原内容\r\n          selectedContent,\r\n          afterContent: '',        // 不保留后续内容\r\n          isFullSelection: true    // 添加全选标识\r\n        });\r\n      } else {\r\n        emit('handleSplit', {\r\n          index,\r\n          beforeContent,\r\n          selectedContent,\r\n          afterContent,\r\n          originalSelection: {\r\n            start: range.startOffset,\r\n            end: range.endOffset,\r\n            parentIndex: index\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// 合并到下一分段\r\nconst mergeWithNext = (index) => {\r\n  if (index >= props.paragraphLists.length - 1) {\r\n    return message.error(t('no_next_segment'))\r\n  };\r\n\r\n  const content = props.paragraphLists[index].content\r\n  const selection = window.getSelection()\r\n  const range = selection.getRangeAt(0)\r\n  const selectedText = range.toString()\r\n\r\n  if (!selectedText) return\r\n\r\n  Modal.confirm({\r\n    title: t('merge_next_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('merge_next_content'),\r\n    onOk() {\r\n      // 创建临时容器处理HTML内容\r\n      const tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = content\r\n\r\n      // 拆分选中内容\r\n      const [beforeContent, selectedContent, afterContent] = splitHtmlContent(\r\n        tempDiv,\r\n        range.startOffset,\r\n        range.endOffset\r\n      )\r\n\r\n      // 新增全选判断逻辑\r\n      const isEmptyBefore = beforeContent.replace(/<[^>]+>/g, '').trim() === '';\r\n      const isEmptyAfter = afterContent.replace(/<[^>]+>/g, '').trim() === '';\r\n\r\n      // 触发更新时需要保留原始选中信息\r\n      if (isEmptyBefore && isEmptyAfter) {\r\n        // 当全选内容时直接替换原段落\r\n        emit('handleSplitNext', {\r\n          index,\r\n          beforeContent: '',       // 清空原内容\r\n          selectedContent,\r\n          afterContent: '',        // 不保留后续内容\r\n          isFullSelection: true    // 添加全选标识\r\n        });\r\n      } else {\r\n        // 触发更新时需要保留原始选中信息\r\n        emit('handleSplitNext', {\r\n          index,\r\n          beforeContent,\r\n          selectedContent,\r\n          afterContent,\r\n          originalSelection: {\r\n            start: range.startOffset,\r\n            end: range.endOffset,\r\n            parentIndex: index\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n};\r\n\r\n// 合并到上一分段\r\nconst mergeWithPrevious = (index) => {\r\n  if (index <= 0) {\r\n    return message.error(t('no_prev_segment'))\r\n  };\r\n\r\n  const content = props.paragraphLists[index].content\r\n  const selection = window.getSelection()\r\n  const range = selection.getRangeAt(0)\r\n  const selectedText = range.toString()\r\n\r\n  if (!selectedText) return\r\n\r\n  Modal.confirm({\r\n    title: t('merge_prev_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('merge_prev_content'),\r\n    onOk() {\r\n      // 创建临时容器处理HTML内容\r\n      const tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = content\r\n\r\n      // 拆分选中内容\r\n      const [beforeContent, selectedContent, afterContent] = splitHtmlContent(\r\n        tempDiv,\r\n        range.startOffset,\r\n        range.endOffset\r\n      )\r\n\r\n      // 新增全选判断逻辑\r\n      const isEmptyBefore = beforeContent.replace(/<[^>]+>/g, '').trim() === '';\r\n      const isEmptyAfter = afterContent.replace(/<[^>]+>/g, '').trim() === '';\r\n\r\n\r\n      // 触发更新时需要保留原始选中信息\r\n      if (isEmptyBefore && isEmptyAfter) {\r\n        // 当全选内容时直接替换原段落\r\n        emit('handleSplitUp', {\r\n          index,\r\n          beforeContent: '',       // 清空原内容\r\n          selectedContent,\r\n          afterContent: '',        // 不保留后续内容\r\n          isFullSelection: true    // 添加全选标识\r\n        });\r\n      } else {\r\n        // 触发更新时需要保留原始选中信息\r\n        emit('handleSplitUp', {\r\n          index,\r\n          beforeContent,\r\n          selectedContent,\r\n          afterContent,\r\n          originalSelection: {\r\n            start: range.startOffset,\r\n            end: range.endOffset,\r\n            parentIndex: index\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n};\r\n\r\n// 删除当前分段\r\nconst onDeleteParagraph = (index) => {\r\n  const content = props.paragraphLists[index].content\r\n  const selection = window.getSelection()\r\n  const range = selection.getRangeAt(0)\r\n  const selectedText = range.toString()\r\n\r\n  if (!selectedText) return\r\n\r\n  Modal.confirm({\r\n    title: t('delete_content_title'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('delete_content_content'),\r\n    onOk() {\r\n      // 创建临时容器处理HTML内容\r\n      const tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = content\r\n\r\n      // 拆分选中内容\r\n      const [beforeContent, selectedContent, afterContent] = splitHtmlContent(\r\n        tempDiv,\r\n        range.startOffset,\r\n        range.endOffset\r\n      )\r\n\r\n      // 新增全选判断逻辑\r\n      const isEmptyBefore = beforeContent.replace(/<[^>]+>/g, '').trim() === '';\r\n      const isEmptyAfter = afterContent.replace(/<[^>]+>/g, '').trim() === '';\r\n\r\n      // 触发更新时需要保留原始选中信息\r\n      if (isEmptyBefore && isEmptyAfter) {\r\n        // 当全选内容时直接替换原段落\r\n        emit('handleSplitDelete', {\r\n          index,\r\n          beforeContent: '',       // 清空原内容\r\n          selectedContent: '',     // 删除-不保留选中内容\r\n          afterContent: '',        // 不保留后续内容\r\n          isFullSelection: true    // 添加全选标识\r\n        });\r\n      } else {\r\n        // 触发更新时需要保留原始选中信息\r\n        emit('handleSplitDelete', {\r\n          index,\r\n          beforeContent,\r\n          selectedContent: '',     // 删除-不保留选中内容\r\n          afterContent,\r\n          originalSelection: {\r\n            start: range.startOffset,\r\n            end: range.endOffset,\r\n            parentIndex: index\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n};\r\n\r\n// 点击其他地方隐藏气泡\r\nconst handleClickOutside = (event) => {\r\n  if (showBubble.value && !event.target.closest('.bubble-card')) {\r\n    showBubble.value = false;\r\n  }\r\n};\r\n\r\nfunction getIsNeedDashedLine(item, index) {\r\n  if(props.detailsInfo.chunk_type != 4){\r\n    return false\r\n  }\r\n  if(index == 0){\r\n    return false\r\n  }\r\n  let preItem = props.paragraphLists[index - 1]\r\n  if(item.father_chunk_paragraph_number == preItem.father_chunk_paragraph_number){\r\n    return true\r\n  }\r\n\r\n  return false\r\n\r\n}\r\n\r\nfunction textToHighlight(fullText, highlightText, options = {}) {\r\n  if (!highlightText || !fullText) return fullText;\r\n\r\n  const {\r\n    highlightClass = 'highlight',\r\n    caseSensitive = false,\r\n    wholeWord = false\r\n  } = options;\r\n\r\n  const flags = caseSensitive ? 'g' : 'gi';\r\n  let regexPattern;\r\n\r\n  if (wholeWord) {\r\n    // 使用单词边界匹配完整单词\r\n    regexPattern = new RegExp(`\\\\b${escapeRegExp(highlightText)}\\\\b`, flags);\r\n  } else {\r\n    regexPattern = new RegExp(escapeRegExp(highlightText), flags);\r\n  }\r\n\r\n  return fullText.replace(regexPattern, match =>\r\n    `<span class=\"${highlightClass}\">${match}</span>`\r\n  );\r\n}\r\n\r\n/**\r\n * 转义正则表达式特殊字符\r\n * @param {string} string\r\n * @returns {string}\r\n */\r\nfunction escapeRegExp(string) {\r\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n}\r\n\r\nonMounted(() => {\r\n  document.addEventListener('click', handleClickOutside);\r\n  setTimeout(() => {\r\n    renderMath()\r\n  }, 100)\r\n});\r\n\r\nonUnmounted(() => {\r\n  document.removeEventListener('click', handleClickOutside);\r\n});\r\n\r\ndefineExpose({ handleOpenEditModal })\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.subsection-box {\r\n  background: #f2f4f7;\r\n  padding: 14px 16px;\r\n  width: 100%;\r\n  .hover-btn-box {\r\n    width: 24px;\r\n    height: 24px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r\n    &:hover {\r\n      background: #e4e6eb;\r\n      border-radius: 6px;\r\n    }\r\n  }\r\n  .subsection-box-title {\r\n    display: flex;\r\n    align-items: center;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n    font-weight: 600;\r\n    color: #242933;\r\n    span {\r\n      color: #7a8699;\r\n      font-weight: 400;\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n\r\n  .list-item::before {\r\n    content: \"\";\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 4px;\r\n    height: 100%;\r\n    background-color: var(--status-color, #FFF);\r\n  }\r\n  .list-item {\r\n    position: relative;\r\n    overflow: hidden;\r\n    margin-top: 8px;\r\n    width: 100%;\r\n    background: #fff;\r\n    border-radius: 6px;\r\n    &.fragment-father-son-item{\r\n      margin: 0;\r\n      border-radius: 0;\r\n    }\r\n    &.dashed-line{\r\n      border-top: 2px dashed #d9d9d9;\r\n    }\r\n    &.mt8{\r\n      margin-top: 8px;\r\n    }\r\n    .top-block {\r\n      padding: 16px 16px 0;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      .title {\r\n        display: flex;\r\n        align-items: center;\r\n        font-size: 14px;\r\n        line-height: 22px;\r\n        font-weight: 600;\r\n        color: #000000;\r\n        width: fit-content;\r\n        span {\r\n          color: #8c8c8c;\r\n          font-weight: 400;\r\n          margin-left: 8px;\r\n        }\r\n        .title-block {\r\n          max-width: 320px;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n          white-space: nowrap;\r\n          margin-left: 4px;\r\n        }\r\n      }\r\n      .right-opration {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        line-height: 22px;\r\n        .star-btn {\r\n          cursor: pointer;\r\n        }\r\n      }\r\n    }\r\n    .content-box {\r\n      color: #595959;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      line-height: 22px;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n      padding: 8px 16px 16px;\r\n\r\n      &::v-deep(.highlight) {\r\n        background-color: #FFEB3B; /* 黄色高亮 */\r\n        padding: 0 2px;\r\n        border-radius: 2px;\r\n        box-shadow: 0 1px 1px rgba(0,0,0,0.1);\r\n      }\r\n\r\n    }\r\n    .fragment-img {\r\n      padding: 0px 16px 16px;\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      gap: 8px;\r\n      img {\r\n        width: 80px;\r\n        height: 80px;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n}\r\n@keyframes flash-border {\r\n  0%,\r\n  100% {\r\n    background: transparent;\r\n  }\r\n  50% {\r\n    background: #c8d9f4;\r\n  }\r\n}\r\n\r\n.flash-border {\r\n  background: #c8d9f4;\r\n  animation: flash-border 1s infinite; /* 持续时间1秒，无限次重复 */\r\n}\r\n.cfb363f {\r\n  color: #fb363f !important;\r\n}\r\n.err-icon {\r\n  margin-left: 4px !important;\r\n}\r\n\r\n.start-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  color: #262626;\r\n  font-size: 14px;\r\n  .anticon {\r\n    font-size: 16px;\r\n  }\r\n}\r\n\r\n.status-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.split-err {\r\n  cursor: pointer;\r\n  display: flex;\r\n  padding: 0 6px;\r\n  align-items: center;\r\n  gap: 2px;\r\n  border-radius: 6px;\r\n  background: #FBDDDE;\r\n  color: #fb363f;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 22px;\r\n}\r\n\r\n.content-container {\r\n  position: relative;\r\n  padding: 0 20px 70px;\r\n}\r\n\r\n.content-block {\r\n  margin-bottom: 16px;\r\n  line-height: 1.6;\r\n}\r\n\r\n.bubble-card {\r\n  position: absolute;\r\n  display: inline-flex;\r\n  padding: 2px;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  gap: 2px;\r\n  border-radius: 6px;\r\n  background: #FFF;\r\n  box-shadow: 0 6px 30px 5px #0000000d, 0 16px 24px 2px #0000000a, 0 8px 10px -5px #00000014;\r\n\r\n  .bubble-item {\r\n    display: flex;\r\n    padding: 5px 16px;\r\n    align-items: center;\r\n    gap: 8px;\r\n    align-self: stretch;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    background: white;\r\n    border: none;\r\n\r\n    &:hover {\r\n      background: #E4E6EB;\r\n    }\r\n  }\r\n  /* 添加箭头 */\r\n  // &::after {\r\n  //   content: '';\r\n  //   position: absolute;\r\n  //   bottom: -10px;\r\n  //   left: var(--arrow-offset, 50%);\r\n  //   transform: translateX(-50%);\r\n  //   border-width: 10px 10px 0;\r\n  //   border-style: solid;\r\n  //   border-color: white transparent transparent;\r\n  //   filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));\r\n  // }\r\n\r\n  // /* 箭头边框 */\r\n  // &::before {\r\n  //   content: '';\r\n  //   position: absolute;\r\n  //   bottom: -11px;\r\n  //   left: var(--arrow-offset, 50%);\r\n  //   transform: translateX(-50%);\r\n  //   border-width: 10px 10px 0;\r\n  //   border-style: solid;\r\n  //   border-color: #ddd transparent transparent;\r\n  //   z-index: -1;\r\n  // }\r\n}\r\n\r\n/* 响应式调整 */\r\n@media (max-width: 600px) {\r\n  .bubble-card {\r\n    max-width: 250px;\r\n    flex-direction: column;\r\n    gap: 4px;\r\n  }\r\n}\r\n\r\n/* 为高亮和评论添加样式 */\r\n.highlight {\r\n  background-color: yellow;\r\n}\r\n\r\n.comment {\r\n  background-color: #e6f7ff;\r\n  border-bottom: 1px dashed #1890ff;\r\n}\r\n\r\n\r\n</style>\r\n","<template>\r\n  <div class=\"mode-box\">\r\n    <a-tooltip>\r\n      <template #title>\r\n        <div class=\"tooltip-text-box\" v-html=\"tooltipStr\"></div>\r\n      </template>\r\n      <div class=\"tag-item\">{{ name }}</div>\r\n    </a-tooltip>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.segmentation-mode')\r\n\r\nconst props = defineProps({\r\n  detailsInfo: {\r\n    type: Object\r\n  }\r\n})\r\nconst tooltipStr = ref('')\r\nconst name = computed(() => {\r\n  const {\r\n    is_table_file,\r\n    is_qa_doc,\r\n    is_diy_split,\r\n    question_lable,\r\n    answer_lable,\r\n    separators,\r\n    chunk_size,\r\n    chunk_overlap,\r\n    question_column,\r\n    answer_column,\r\n    qa_index_type,\r\n    doc_type\r\n  } = props.detailsInfo\r\n  if (is_table_file != 1 && is_qa_doc != 1 && is_diy_split != 1) {\r\n    if (doc_type == 3) {\r\n      tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_manual_segmentation')}\\n${t('msg_doc_type')}：${t('msg_normal_doc')}`\r\n      return `${t('msg_custom')}：${t('msg_normal_doc')}`\r\n    }\r\n    tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_smart_segmentation')}\\n${t('msg_doc_type')}：${t('msg_normal_doc')}`\r\n    return `${t('msg_smart_segmentation')}：${t('msg_normal_doc')}`\r\n  }\r\n  if (is_table_file != 1 && is_qa_doc == 1) {\r\n    if (doc_type == 3) {\r\n      tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_manual_segmentation')}\\n${t('msg_doc_type')}：${t('msg_qa_doc')}`\r\n      return `${t('msg_custom')}：${t('msg_qa_doc')}`\r\n    }\r\n    tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_smart_segmentation')}\\n${t('msg_doc_type')}：${t('msg_qa_doc')}\\n${t('msg_question_start_marker')}\"${question_lable}\"\\n${t('msg_answer_start_marker')}\"${answer_lable}\"`\r\n    return `${t('msg_smart_segmentation')}：${t('msg_qa_doc')}`\r\n  }\r\n  if (is_table_file != 1 && is_qa_doc != 1 && is_diy_split == 1) {\r\n    tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_custom_segmentation')}\\n${t('msg_doc_marker')}：${separators}\\n${t('msg_chunk_max_length')}：${chunk_size}${t('msg_characters')}\\n${t('msg_chunk_overlap_length')}：${chunk_overlap}${t('msg_characters')}`\r\n    return t('msg_custom_segmentation')\r\n  }\r\n  if (is_table_file == 1 && is_qa_doc != 1) {\r\n    tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_smart_segmentation')}\\n${t('msg_doc_type')}：${t('msg_normal_table')}`\r\n    return `${t('msg_smart_segmentation')}：${t('msg_normal_table')}`\r\n  }\r\n  if (is_table_file == 1 && is_qa_doc == 1) {\r\n    let qa_type_str = qa_index_type == 1 ? t('msg_qa_generate_index_together') : t('msg_question_only_index')\r\n    tooltipStr.value = `${t('msg_segmentation_mode')}：${t('msg_smart_segmentation')}\\n${t('msg_doc_type')}：${t('msg_qa_doc')}\\n${t('msg_question_column')}\"${question_column}\"\\n${t('msg_answer_column')}\"${answer_column}\"\\n${t('msg_index_method')}：${qa_type_str}`\r\n    return `${t('msg_smart_segmentation')}：${t('msg_qa_doc')}`\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.mode-box {\r\n  margin-left: 8px;\r\n  cursor: context-menu;\r\n}\r\n.tooltip-text-box {\r\n  white-space: pre-wrap;\r\n}\r\n.tag-item {\r\n  border-radius: 2px;\r\n  border: 1px solid #99bffd;\r\n  background: #e9f1fe;\r\n  padding: 0 8px;\r\n  font-size: 12px;\r\n  font-weight: 400;\r\n  line-height: 20px;\r\n  color: #2475fc;\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <a-modal\r\n      v-model:open=\"visible\"\r\n      :confirm-loading=\"loading\"\r\n      :maskClosable=\"false\"\r\n      :title=\"t('modal_title')\"\r\n      @ok=\"handleOk\"\r\n    >\r\n      <a-form style=\"margin: 32px 0\" layout=\"vertical\" :model=\"formState\">\r\n        <a-form-item name=\"doc_auto_renew_frequency\" :label=\"t('label_update_frequency')\" required>\r\n          <a-select v-model:value=\"formState.doc_auto_renew_frequency\" style=\"width: 100%\">\r\n            <a-select-option :value=\"1\">{{ t('option_not_auto_update') }}</a-select-option>\r\n            <a-select-option :value=\"2\">{{ t('option_daily') }}</a-select-option>\r\n            <a-select-option :value=\"3\">{{ t('option_every_3_days') }}</a-select-option>\r\n            <a-select-option :value=\"4\">{{ t('option_every_7_days') }}</a-select-option>\r\n            <a-select-option :value=\"5\">{{ t('option_every_30_days') }}</a-select-option>\r\n          </a-select>\r\n        </a-form-item>\r\n      </a-form>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { editLibFile } from '@/api/library'\r\nimport { message } from 'ant-design-vue'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.update-frequency')\r\nconst emit = defineEmits(['ok'])\r\nconst visible = ref(false)\r\nconst loading = ref(false)\r\nconst formState = reactive({\r\n  doc_auto_renew_frequency: 1,\r\n  id: ''\r\n})\r\nconst open = (data) => {\r\n  let { doc_auto_renew_frequency, id } = data\r\n  formState.doc_auto_renew_frequency = +doc_auto_renew_frequency\r\n  formState.id = id\r\n  visible.value = true\r\n}\r\nconst handleOk = () => {\r\n  loading.value = true\r\n  editLibFile({\r\n    ...formState\r\n  })\r\n    .then((res) => {\r\n      emit('ok', formState.doc_auto_renew_frequency)\r\n      visible.value = false\r\n      message.success(t('msg_set_success'))\r\n    })\r\n    .finally(() => {\r\n      loading.value = false\r\n    })\r\n}\r\ndefineExpose({ open })\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n</style>\r\n","<template>\r\n  <CuScroll :scrollbar=\"scrollbar\" ref=\"scrollRef\" @scroll=\"handleScroll\" @onScrollEnd=\"onScrollEnd\">\r\n    <VuePdfEmbed\r\n      v-for=\"page in visiblePages\"\r\n      @click=\"clickPage(page)\"\r\n      :key=\"page\"\r\n      :source=\"source\"\r\n      :page=\"page\"\r\n      @rendered=\"() => pdfRendered(page)\"\r\n      :style=\"getItemStyle\"\r\n    />\r\n    <div class=\"loading\"><a-spin v-if=\"loading\"/></div>\r\n  </CuScroll>\r\n</template>\r\n\r\n<script setup>\r\nimport {ref, onMounted, nextTick, computed} from 'vue'\r\nimport CuScroll from \"@/components/cu-scroll/cu-scroll.vue\";\r\nimport VuePdfEmbed from 'vue-pdf-embed'\r\n\r\nconst props = defineProps({\r\n  source: {\r\n    type: [String],\r\n    required: true\r\n  },\r\n  pageSize: {\r\n    type: Number,\r\n    default: 10\r\n  },\r\n})\r\n\r\nconst emit = defineEmits(['onScrollEnd', 'select', 'rendered', 'scroll', 'getTotalPage'])\r\nconst scrollRef = ref(null)\r\nconst visiblePages = ref([])\r\nconst totalPages = ref(0)\r\nconst loading = ref(false)\r\n\r\nconst getItemStyle = computed(() => {\r\n  if (!loading.value) {\r\n    return {'border-bottom': '2px solid #d9d9d9'}\r\n  }\r\n  return null\r\n})\r\n\r\nconst scrollbar = ref({\r\n  fade: false,\r\n  scrollbarTrackClickable: true,\r\n  interactive: true,\r\n  minSize: 40,\r\n})\r\n\r\nonMounted(async () => {\r\n  const pdf = await VuePdfEmbed.getDocument(props.source).promise\r\n  // 获取文件总页数\r\n  totalPages.value = pdf.numPages\r\n  emit('getTotalPage', totalPages.value)\r\n  loadMore()\r\n})\r\n\r\nconst loadMore = (callback=null) => {\r\n  const current = visiblePages.value.length\r\n  if (current >= totalPages.value || loading.value) return\r\n  loading.value = true\r\n  const nextPages = []\r\n  for (let i = 1; i <= props.pageSize && current + i <= totalPages.value; i++) {\r\n    nextPages.push(current + i)\r\n  }\r\n  visiblePages.value.push(...nextPages)\r\n  nextTick(() => {\r\n    typeof callback === 'function' && callback()\r\n  })\r\n}\r\n\r\nconst onScrollEnd = (e) => {\r\n  loadMore()\r\n  emit('onScrollEnd', e)\r\n}\r\n\r\nconst pdfRendered = (page) => {\r\n  nextTick(() => {\r\n   if (page === visiblePages.value[visiblePages.value.length - 1]) {\r\n     loading.value = false\r\n     emit('rendered', page, totalPages.value)\r\n   }\r\n  })\r\n}\r\n\r\nconst clickPage = page => {\r\n  emit('select', page)\r\n}\r\n\r\nconst getScrollInstance = () => {\r\n  return scrollRef.value\r\n}\r\n\r\nconst handleScroll = (event)=>{\r\n  emit('scroll', event)\r\n}\r\n\r\ndefineExpose({\r\n  loadMore,\r\n  getScrollInstance,\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.loading {\r\n    padding: 12px;\r\n    text-align: center;\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.breadcrumb-block {\r\n  height: 48px;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.page-title {\r\n  height: 38px;\r\n  border-radius: 2px;\r\n  display: flex;\r\n  gap: 8px;\r\n  align-items: center;\r\n  color: #262626;\r\n  margin-bottom: 16px;\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n  line-height: 22px;\r\n  .title {\r\n    font-weight: 600;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n  }\r\n}\r\n.document-segmentation {\r\n  position: relative;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  .page-container {\r\n    display: flex;\r\n    flex: 1;\r\n    overflow: hidden;\r\n\r\n    .page-left {\r\n      width: 400px;\r\n      height: 100%;\r\n      overflow-y: auto;\r\n      &::-webkit-scrollbar {\r\n        display: none;\r\n      }\r\n    }\r\n    .page-right {\r\n      flex: 1;\r\n      height: 100%;\r\n      padding-left: 24px;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n}\r\n.document-fragment-preview {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  padding: 14px 16px;\r\n  background-color: #f2f4f7;\r\n\r\n  .preview-header {\r\n    display: flex;\r\n    height: 22px;\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n\r\n    .label-text {\r\n      font-weight: 600;\r\n      color: #242933;\r\n    }\r\n    .fragment-number {\r\n      padding-left: 8px;\r\n      color: #7a8699;\r\n    }\r\n  }\r\n\r\n  .preview-box {\r\n    flex: 1;\r\n    overflow-y: auto;\r\n    .fragment-item {\r\n      margin-top: 8px;\r\n    }\r\n  }\r\n}\r\n.footer-btn-box {\r\n  height: 56px;\r\n  position: fixed;\r\n  left: 16px;\r\n  right: 16px;\r\n  bottom: 16px;\r\n  background: #fff;\r\n  border-top: 1px solid #f0f0f0;\r\n  box-shadow: 0 -8px 4px 0 #00000014;\r\n  border-radius: 0 0 8px 8px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 8px;\r\n}\r\n\r\n.loading-wrap {\r\n  position: absolute;\r\n  z-index: 99;\r\n  top: 100px;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.loading-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  color: #595959;\r\n  margin-top: 200px;\r\n}\r\n</style>\r\n\r\n<template>\r\n  <!-- loading -->\r\n  <div class=\"loading-wrap\" v-if=\"spinning\">\r\n    <a-spin></a-spin>\r\n  </div>\r\n\r\n  <div class=\"document-segmentation\">\r\n    <div class=\"page-container\">\r\n      <div class=\"page-left\">\r\n        <SegmentationSetting\r\n          :excellQaLists=\"excellQaLists\"\r\n          :libFileInfo=\"libFileInfo\"\r\n          :library_type=\"library_type\"\r\n          :mode=\"settingMode\"\r\n          :hideSave=\"true\"\r\n          :status=\"'paragraphsSegmented'\"\r\n          ref=\"segmentationSettingRef\"\r\n          @change=\"onChangeSetting\"\r\n          @changeChunkType=\"onChangeChunkType\"\r\n          @save=\"handleSaveLibFileSplit\"\r\n          @validate=\"onValidate\"\r\n        />\r\n      </div>\r\n      <div class=\"page-right\">\r\n        <div class=\"document-fragment-preview\">\r\n          <div class=\"preview-header\">\r\n            <span class=\"label-text\">{{ t('segmentationPreview') }}</span>\r\n            <span class=\"fragment-number\">{{ t('totalSegments', { count: documentFragmentTotal }) }}</span>\r\n          </div>\r\n          <Empty v-if=\"isEmpty && !aiLoading\"></Empty>\r\n          <div v-if=\"aiLoading\" class=\"loading-box\"><a-spin />{{ t('processingData') }}</div>\r\n          <div class=\"preview-box\" ref=\"previewBoxRef\">\r\n            <div\r\n              class=\"fragment-item\"\r\n              v-for=\"(item, index) in documentFragmentList\"\r\n              :key=\"index\"\r\n            >\r\n              <DocumentFragment\r\n                :status=\"'paragraphsSegmented'\"\r\n                :chunk_type=\"formData.chunk_type\"\r\n                :father_chunk_paragraph_number=\"item.father_chunk_paragraph_number\"\r\n                :currentData=\"currentData\"\r\n                :number=\"item.number\"\r\n                :title=\"item.title\"\r\n                :content=\"item.content\"\r\n                :total=\"item.word_total\"\r\n                :question=\"item.question\"\r\n                :answer=\"item.answer\"\r\n                :images=\"item.images\"\r\n                @delete=\"handleDeleteFragment(index)\"\r\n                @edit=\"handleEditFragment(item, index)\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <EditFragmentAlert ref=\"editFragmentAlertRef\" @ok=\"saveFragment\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, createVNode, computed, onUnmounted, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { Modal, message } from 'ant-design-vue'\r\nimport { ExclamationCircleOutlined, LeftOutlined } from '@ant-design/icons-vue'\r\nimport Empty from './components/empty.vue'\r\nimport SegmentationSetting from './components/segmentation-setting.vue'\r\nimport DocumentFragment from './components/document-fragment.vue'\r\nimport EditFragmentAlert from './components/edit-fragment-alert.vue'\r\nimport {\r\n  getLibFileSplit,\r\n  getSplitParagraph,\r\n  getLibFileSplitAiChunks,\r\n  getLibFileInfo,\r\n  saveSplitParagraph,\r\n  getLibFileExcelTitle\r\n} from '@/api/library/index'\r\nimport { useLibraryStore } from '@/stores/modules/library'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst libraryStore = useLibraryStore()\r\nconst { t } = useI18n('views.library.document-segmentation.document-segmentation-model')\r\n\r\nconst { setInitDocumentFragmentList } = libraryStore\r\nconst route = useRoute()\r\n\r\nconst emit = defineEmits(['ok', 'finish', 'loading'])\r\n\r\nconst { id } = route.query\r\nconst spinning = ref(true)\r\nconst settingMode = ref(1) // 1 表格，0 非表格\r\nlet itWasEdited = false\r\n\r\nconst props = defineProps({\r\n  pdfState: {\r\n    type: Object,\r\n    default: () => {}\r\n  },\r\n  currentData: {\r\n    type: Object,\r\n    default: () => {}\r\n  },\r\n  paragraphType: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\nconst current_chunk_type = ref(1)\r\nconst defaultAiChunkPrumpt = 'defaultAiChunkPrumpt'\r\nlet formData = {\r\n  id: id,\r\n  separators_no: '', // 自定义分段-分隔符序号集\r\n  chunk_size: 512, // 自定义分段-分段最大长度 默认512，最大值不得超过2000\r\n  not_merged_text: false,\r\n  chunk_overlap: 50, // 自定义分段-分段重叠长度 默认为50，最小不得低于10，最大不得超过最大分段长度的50%\r\n  is_qa_doc: 0, // 0 普通文档 1 QA文档\r\n  question_lable: '', // QA文档-问题开始标识符\r\n  answer_lable: '', // QA文档-答案开始标识符\r\n  enable_extract_image: true,\r\n  ai_chunk_size: 5000, // ai大模型分段最大字符数\r\n  ai_chunk_model: '', // ai大模型分段模型名称\r\n  ai_chunk_model_config_id: '', // ai大模型分段模型配置id\r\n  ai_chunk_prumpt: defaultAiChunkPrumpt,\r\n  ai_chunk_task_id: '', //  ai分段数据id，如果有ai分段数据就有值\r\n  father_chunk_paragraph_type: 2,\r\n  father_chunk_separators_no: [],\r\n  father_chunk_chunk_size: 1024,\r\n  son_chunk_separators_no: [],\r\n  son_chunk_chunk_size: 512\r\n}\r\nlet isEdit = false\r\n\r\nconst segmentationSettingRef = ref(null)\r\n\r\nconst onChangeSetting = (data) => {\r\n  if (typeof data.separators_no == 'object') {\r\n    data.separators_no = JSON.stringify(data.separators_no)\r\n  }\r\n  if (typeof data.father_chunk_separators_no == 'object') {\r\n    data.father_chunk_separators_no = JSON.stringify(data.father_chunk_separators_no)\r\n  }\r\n  if (typeof data.son_chunk_separators_no == 'object') {\r\n    data.son_chunk_separators_no = JSON.stringify(data.son_chunk_separators_no)\r\n  }\r\n  isEdit = true\r\n  formData = {\r\n    ...formData,\r\n    ...data\r\n  }\r\n  if (itWasEdited) {\r\n    Modal.confirm({\r\n      title: t('reminder'),\r\n      icon: createVNode(ExclamationCircleOutlined),\r\n      content: t('reFetchConfirm'),\r\n      okText: t('confirm'),\r\n      okType: 'danger',\r\n      cancelText: t('cancel'),\r\n      onOk() {\r\n        itWasEdited = false\r\n        getDocumentFragment('create')\r\n      },\r\n      onCancel() {}\r\n    })\r\n  } else {\r\n    itWasEdited = false\r\n    getDocumentFragment('create')\r\n  }\r\n}\r\n\r\n// 获取文档状态（是否已经转换为PDF）\r\nlet maxLoopNumber = 60 * 10\r\nlet loopNumber = 0\r\nlet library_id = null\r\nconst libFileInfo = ref({})\r\n\r\nconst library_type = ref(0)\r\nconst getDocumentStatus = () => {\r\n  if (!spinning.value) {\r\n    spinning.value = true\r\n  }\r\n\r\n  getLibFileInfo({ id: id }).then(async (res) => {\r\n    const { status } = res.data\r\n    library_type.value = res.data.library_type\r\n    libFileInfo.value = res.data\r\n    formData = {\r\n      ...formData,\r\n      separators_no: res.data.separators_no || '[12,11]',\r\n      chunk_size: +res.data.chunk_size || 512,\r\n      not_merged_text: res.data.not_merged_text == 'true',\r\n      ai_chunk_size: +res.data.ai_chunk_size || 5000, // ai模型的默认值是5000\r\n      chunk_overlap: +res.data.chunk_overlap || 50,\r\n      is_qa_doc: library_type.value == 2 ? 1 : 0,\r\n      question_lable: res.data.question_lable,\r\n      answer_lable: res.data.answer_lable,\r\n      question_column: res.data.question_column,\r\n      answer_column: res.data.answer_column,\r\n      enable_extract_image: res.data.enable_extract_image == 'true',\r\n      qa_index_type: +res.data.qa_index_type,\r\n\r\n      chunk_type: +res.data.chunk_type,\r\n      semantic_chunk_size: +res.data.semantic_chunk_size || 512,\r\n      semantic_chunk_overlap: +res.data.semantic_chunk_overlap || 50,\r\n      semantic_chunk_threshold: +res.data.semantic_chunk_threshold || 90,\r\n      semantic_chunk_use_model: res.data.semantic_chunk_use_model || '',\r\n      ai_chunk_prumpt: res.data.ai_chunk_prumpt || t('defaultAiChunkPrumpt'),\r\n      ai_chunk_model: res.data.ai_chunk_model || '',\r\n      semantic_chunk_model_config_id:\r\n        res.data.semantic_chunk_model_config_id > 0 ? res.data.semantic_chunk_model_config_id : '',\r\n      ai_chunk_model_config_id:\r\n        res.data.ai_chunk_model_config_id > 0 ? res.data.ai_chunk_model_config_id : '',\r\n      ai_chunk_task_id: res.data.ai_chunk_task_id || '',\r\n\r\n      father_chunk_paragraph_type: +res.data.father_chunk_paragraph_type || 2,\r\n      father_chunk_separators_no: res.data.father_chunk_separators_no || '[12,11]',\r\n      father_chunk_chunk_size: +res.data.father_chunk_chunk_size || 1024,\r\n      son_chunk_separators_no: res.data.son_chunk_separators_no || '[8,10]',\r\n      son_chunk_chunk_size: +res.data.son_chunk_chunk_size || 512\r\n    }\r\n\r\n    if (res.data.chunk_type == 0) {\r\n      formData = {\r\n        ...formData,\r\n        separators_no: res.data.normal_chunk_default_separators_no,\r\n        chunk_size: res.data.normal_chunk_default_chunk_size,\r\n        not_merged_text: res.data.normal_chunk_default_not_merged_text == 'true',\r\n        chunk_overlap: res.data.normal_chunk_default_chunk_overlap,\r\n        chunk_type: +res.data.default_chunk_type,\r\n        semantic_chunk_size: +res.data.semantic_chunk_default_chunk_size,\r\n        semantic_chunk_overlap: +res.data.semantic_chunk_default_chunk_overlap,\r\n        semantic_chunk_threshold: +res.data.semantic_chunk_default_threshold,\r\n        semantic_chunk_use_model: res.data.default_use_model || '',\r\n        semantic_chunk_model_config_id:\r\n          res.data.default_model_config_id > 0 ? res.data.default_model_config_id : ''\r\n      }\r\n    }\r\n\r\n    // await getInfo(res.data.library_id)\r\n    if (status == 0) {\r\n      loopNumber++\r\n      if (loopNumber > maxLoopNumber) {\r\n        Modal.error({\r\n          title: t('reminder'),\r\n          content: t('documentParsingSlow')\r\n        })\r\n        return\r\n      }\r\n      setTimeout(() => {\r\n        getDocumentStatus()\r\n      }, 1000)\r\n    } else if (status == 4 || status == 2) {\r\n      spinning.value = false\r\n      settingMode.value = parseInt(res.data.is_table_file)\r\n      library_id = res.data.library_id\r\n\r\n      if (library_type.value == 2) {\r\n        if (formData.question_lable || formData.question_column) {\r\n          getDocumentFragment()\r\n        }\r\n      } else {\r\n        getDocumentFragment()\r\n      }\r\n    }\r\n\r\n    if (res.data.is_table_file == 1) {\r\n      getExcelQaTitle()\r\n    }\r\n  })\r\n}\r\n\r\nonMounted(async () => {\r\n  await getDocumentStatus()\r\n})\r\n\r\nconst excellQaLists = ref([])\r\nconst getExcelQaTitle = () => {\r\n  // 获取excel的QA  问题所在列 下拉列表\r\n  getLibFileExcelTitle({ id: id }).then((res) => {\r\n    let datas = []\r\n    for (let key in res.data) {\r\n      datas.push({\r\n        lable: res.data[key],\r\n        value: key\r\n      })\r\n    }\r\n    excellQaLists.value = datas\r\n  })\r\n}\r\n\r\n// 获取文档切片\r\nconst initDocumentFragmentList = ref([])\r\nconst isAiSave = ref(false)\r\nconst aiLoading = ref(false)\r\nconst task_id = ref('')\r\nconst error = ref(null)\r\nlet timer = null // 轮询定时器\r\nconst documentFragmentList = ref([])\r\nconst documentFragmentTotal = ref(0)\r\nconst isEmpty = computed(() => documentFragmentTotal.value <= 0)\r\n\r\nconst getDocumentFragment = (type) => {\r\n  emit('loading', true)\r\n  let params = {\r\n    ...formData,\r\n    semantic_chunk_model_config_id: formData.semantic_chunk_model_config_id\r\n      ? +formData.semantic_chunk_model_config_id\r\n      : 0,\r\n    ai_chunk_model_config_id: formData.ai_chunk_model_config_id\r\n      ? +formData.ai_chunk_model_config_id\r\n      : 0,\r\n    ...props.pdfState\r\n  }\r\n\r\n  if (formData.chunk_type == 3) {\r\n    // 之前有分段数据可以传taskid过去直接获取\r\n    if (formData.ai_chunk_task_id && !type) {\r\n      params.ai_chunk_task_id = formData.ai_chunk_task_id\r\n    }\r\n\r\n    if (params.ai_chunk_task_id && type && type === 'create') {\r\n      // 如果是主动点击的生成分段预览则不传taskid\r\n      delete params.ai_chunk_task_id\r\n    }\r\n  }\r\n\r\n  let requiredUrl = getLibFileSplit\r\n\r\n  if (props.paragraphType && props.paragraphType === 'paragraphsSegmented' && type == 'create') {\r\n    requiredUrl = getSplitParagraph\r\n    delete params.id\r\n  }\r\n\r\n  if (props.paragraphType && props.paragraphType === 'paragraphsSegmented' && !type) {\r\n    // 不请求接口，直接将数据填充进去\r\n    documentFragmentList.value = props.currentData.list || []\r\n    // 这里是点击重新分段选中的数据，只有一条\r\n    documentFragmentTotal.value = props.currentData.list.length\r\n\r\n    if (formData.chunk_type == 3) {\r\n      // ai分段\r\n      task_id.value = props.currentData.split_params?.ai_chunk_task_id || ''\r\n      aiLoading.value = true\r\n      segmentationSettingRef.value.reLoading = true\r\n      error.value = null\r\n\r\n      // 之前没有ai分段数据，重新异步请求ai分段数据\r\n      // 之前不管有没有ai分段数据，只要是点击生成分段预览则重新异步请求ai分段数据\r\n      if ((!formData.ai_chunk_task_id && settingMode.value != 1) || (type && type === 'create')) {\r\n        // 清空之前的页面分段数据，重新请求\r\n        documentFragmentList.value = []\r\n        documentFragmentTotal.value = 0\r\n        startPolling()\r\n      } else {\r\n        aiLoading.value = false\r\n        segmentationSettingRef.value.reLoading = false\r\n      }\r\n    }\r\n\r\n    if (formData.chunk_type != 3) {\r\n      segmentationSettingRef.value.reLoading = false\r\n      segmentationSettingRef.value.saveLoading = false\r\n    }\r\n    emit('loading', false)\r\n\r\n    return false\r\n  }\r\n\r\n  return requiredUrl(params)\r\n    .then((res) => {\r\n      initDocumentFragmentList.value = res.data.list || []\r\n      setInitDocumentFragmentList(initDocumentFragmentList.value)\r\n      documentFragmentList.value = res.data.list || []\r\n      documentFragmentTotal.value = res.data.list.length || 0\r\n\r\n      if (formData.chunk_type == 3) {\r\n        // ai分段\r\n        task_id.value = res.data.split_params?.ai_chunk_task_id || ''\r\n        aiLoading.value = true\r\n        segmentationSettingRef.value.reLoading = true\r\n        segmentationSettingRef.value.saveLoading = true\r\n        error.value = null\r\n\r\n        // 之前没有ai分段数据，重新异步请求ai分段数据\r\n        // 之前不管有没有ai分段数据，只要是点击生成分段预览则重新异步请求ai分段数据\r\n        if ((!formData.ai_chunk_task_id && settingMode.value != 1) || (type && type === 'create')) {\r\n          // 清空之前的页面分段数据，重新请求\r\n          documentFragmentList.value = []\r\n          documentFragmentTotal.value = 0\r\n          startPolling()\r\n        } else {\r\n          aiLoading.value = false\r\n          segmentationSettingRef.value.reLoading = false\r\n          segmentationSettingRef.value.saveLoading = false\r\n        }\r\n      }\r\n    })\r\n    .finally(() => {\r\n      if (formData.chunk_type != 3) {\r\n        segmentationSettingRef.value.reLoading = false\r\n        segmentationSettingRef.value.saveLoading = false\r\n      }\r\n      emit('loading', false)\r\n    })\r\n}\r\n\r\nconst onChangeChunkType = (chunk_type) => {\r\n  current_chunk_type.value = chunk_type\r\n}\r\n\r\n// 轮询查询结果\r\nconst pollData = async () => {\r\n  try {\r\n    const res = await getAiDocumentFragment()\r\n\r\n    // 条件1: 接口返回错误信息\r\n    if (res.data.err_msg) {\r\n      error.value = res.data.err_msg\r\n      return true // 停止轮询\r\n    }\r\n\r\n    // 条件2: 接口返回有效数据\r\n    if (res.data.list?.length > 0) {\r\n      initDocumentFragmentList.value = res.data.list || []\r\n      setInitDocumentFragmentList(initDocumentFragmentList.value)\r\n      documentFragmentList.value = res.data.list || []\r\n      documentFragmentTotal.value = res.data.list.length || 0\r\n      return true // 停止轮询\r\n    }\r\n\r\n    return false // 继续轮询\r\n  } catch (err) {\r\n    error.value = '请求异常，停止轮询'\r\n    return true // 停止轮询\r\n  }\r\n}\r\n\r\nfunction formatError(errorStr) {\r\n  return errorStr.split('message:')[1]\r\n}\r\n\r\n// 启动轮询控制\r\nconst startPolling = () => {\r\n  const executePoll = async () => {\r\n    const shouldStop = await pollData()\r\n    if (!shouldStop) {\r\n      timer = setTimeout(executePoll, 3000) // 3秒后再次执行\r\n    } else {\r\n      aiLoading.value = false\r\n      segmentationSettingRef.value.reLoading = false\r\n      segmentationSettingRef.value.saveLoading = false\r\n      if (timer !== null) {\r\n        clearTimeout(timer)\r\n        timer = null\r\n      }\r\n      if (isAiSave.value) {\r\n        // 保存\r\n        handleSaveLibFileSplit()\r\n      }\r\n\r\n      if (error.value) {\r\n        let errorText = formatError(error.value)\r\n        Modal.error({\r\n          title: t('segmentationFailed'),\r\n          content: errorText ? t('modelCallFailedWithReason', { reason: errorText }) : t('modelCallFailed')\r\n        })\r\n      }\r\n    }\r\n  }\r\n  executePoll() // 立即执行首次查询\r\n}\r\n\r\nconst getAiDocumentFragment = () => {\r\n  return getLibFileSplitAiChunks({\r\n    id: formData.id,\r\n    task_id: task_id.value\r\n  })\r\n}\r\n\r\n// 编辑文档片段\r\nconst editFragmentAlertRef = ref(null)\r\nlet editFragmentIndex = null\r\n\r\nconst handleEditFragment = ({ title, content, question, answer, images }, index) => {\r\n  editFragmentIndex = index\r\n  editFragmentAlertRef.value.open({ title, content, question, answer, images })\r\n}\r\n\r\nconst saveFragment = ({ title, content, question, answer, images }) => {\r\n  if (\r\n    documentFragmentList.value[editFragmentIndex].title != title ||\r\n    documentFragmentList.value[editFragmentIndex].content != content ||\r\n    documentFragmentList.value[editFragmentIndex].question != question ||\r\n    documentFragmentList.value[editFragmentIndex].answer != answer\r\n  ) {\r\n    itWasEdited = true\r\n  }\r\n\r\n  documentFragmentList.value[editFragmentIndex].title = title\r\n  documentFragmentList.value[editFragmentIndex].content = content\r\n  documentFragmentList.value[editFragmentIndex].question = question\r\n  documentFragmentList.value[editFragmentIndex].answer = answer\r\n  documentFragmentList.value[editFragmentIndex].images = images\r\n\r\n  documentFragmentList.value[editFragmentIndex].word_total =\r\n    answer.length + question.length + content.length\r\n}\r\n\r\n// 删除文档片段\r\nconst handleDeleteFragment = (index) => {\r\n  Modal.confirm({\r\n    title: t('reminder'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('deleteSegmentConfirm'),\r\n    okText: t('confirm'),\r\n    okType: 'danger',\r\n    cancelText: t('cancel'),\r\n    onOk() {\r\n      itWasEdited = true\r\n      documentFragmentList.value.splice(index, 1)\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\nconst validateMessage = ref('')\r\nconst onValidate = (data) => {\r\n  // 获取错误信息\r\n  validateMessage.value = data\r\n}\r\n\r\nconst saveLoading = ref(false)\r\n\r\nconst updataFormData = () => {\r\n  let data = segmentationSettingRef.value.formState\r\n  data = JSON.parse(JSON.stringify(data))\r\n  if (typeof data.separators_no == 'object') {\r\n    data.separators_no = JSON.stringify(data.separators_no)\r\n  }\r\n  if (typeof data.father_chunk_separators_no == 'object') {\r\n\r\n    data.father_chunk_separators_no = JSON.stringify(data.father_chunk_separators_no)\r\n  }\r\n  if (typeof data.son_chunk_separators_no == 'object') {\r\n    data.son_chunk_separators_no = JSON.stringify(data.son_chunk_separators_no)\r\n\r\n  }\r\n  formData = {\r\n    ...formData,\r\n    ...data\r\n  }\r\n}\r\n\r\nconst formatWoedTotal = (arr) => {\r\n  let num = 0\r\n  arr.forEach((item) => {\r\n    num += parseInt(item.word_total)\r\n  })\r\n  return num\r\n}\r\nconst handleSaveLibFileSplit = async () => {\r\n  // 如果右侧的数据不是当前保存选中的分段类型则清空内容重新分段\r\n  // 如果之前已经分段成功了，保存的时候不再另外分段了\r\n  if (documentFragmentTotal.value <= 0 || formData.chunk_type != current_chunk_type.value) {\r\n    updataFormData()\r\n    await getDocumentFragment()\r\n  }\r\n\r\n  updataFormData()\r\n  // await getDocumentFragment()\r\n  if (validateMessage.value) {\r\n    return message.error(validateMessage.value)\r\n  }\r\n\r\n  if (formData.chunk_type == 3 && !documentFragmentList.value.length) {\r\n    // ai分段的保存\r\n    isAiSave.value = true\r\n    return false\r\n  }\r\n\r\n  if (task_id.value) {\r\n    formData.ai_chunk_task_id = task_id.value\r\n  }\r\n\r\n  let split_params = {\r\n    ...formData,\r\n    semantic_chunk_model_config_id: formData.semantic_chunk_model_config_id\r\n      ? +formData.semantic_chunk_model_config_id\r\n      : 0,\r\n    ai_chunk_model_config_id: formData.ai_chunk_model_config_id\r\n      ? +formData.ai_chunk_model_config_id\r\n      : 0,\r\n    is_table_file: settingMode.value,\r\n    ...props.pdfState\r\n  }\r\n\r\n  delete split_params.id\r\n\r\n  let parmas = {\r\n    file_id: id,\r\n    word_total: formatWoedTotal(documentFragmentList.value),\r\n    split_params: JSON.stringify(split_params),\r\n    list: JSON.stringify(documentFragmentList.value),\r\n    ...props.pdfState\r\n  }\r\n\r\n  // 非表格的也需要存储qa_index_type\r\n  if (split_params.is_qa_doc == 1) {\r\n    // 表格类型 + QA文档\r\n    parmas.qa_index_type = split_params.qa_index_type\r\n  }\r\n\r\n  saveLoading.value = true\r\n\r\n  if (props.paragraphType && props.paragraphType === 'paragraphsSegmented') {\r\n    // get的接口和save没有统一，多了个s，这里要特殊处理一下\r\n    parmas.data_id = parmas.data_ids\r\n    delete parmas.data_ids\r\n  }\r\n\r\n  saveSplitParagraph(parmas)\r\n    .then(() => {\r\n      emit('ok')\r\n      emit('finish')\r\n    })\r\n    .finally(() => {\r\n      saveLoading.value = false\r\n    })\r\n    .catch((err) => {\r\n      err.data && err.data.index && handleScrollToErrorDom(err.data.index)\r\n      emit('finish')\r\n    })\r\n}\r\n\r\nconst previewBoxRef = ref(null)\r\nconst handleScrollToErrorDom = (index) => {\r\n  index = index - 1\r\n  let fragmentElements = previewBoxRef.value.querySelectorAll('.fragment-item')\r\n  if (fragmentElements.length >= index) {\r\n    let scorllElement = fragmentElements[index]\r\n    scorllElement.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' })\r\n  }\r\n}\r\n\r\n// 组件卸载时清理\r\nonUnmounted(() => {\r\n  if (timer) {\r\n    clearTimeout(timer)\r\n    timer = null\r\n  }\r\n})\r\n\r\ndefineExpose({\r\n  handleSaveLibFileSplit\r\n})\r\n</script>\r\n","<template>\r\n  <div>\r\n    <a-modal\r\n      v-model:open=\"open\"\r\n      :title=\"modalTitle\"\r\n      @ok=\"handleSaveType\"\r\n      @cancel=\"onClose\"\r\n      :width=\"720\"\r\n      :confirmLoading=\"confirmLoading\"\r\n    >\r\n      <div class=\"select-box\">\r\n        <div\r\n          :class=\"['select-list-item', { active: item.pdf_parse_type == formState.pdf_parse_type }, { disabled: item.pdf_parse_type == 4 && !ali_ocr_switch }]\"\r\n          v-for=\"item in analysisLists\"\r\n          @click=\"handleChangeAnalysis(item)\"\r\n          :key=\"item.pdf_parse_type\"\r\n        >\r\n          <div class=\"title\">\r\n            <svg-icon :name=\"item.icon\" style=\"font-size: 16px\"></svg-icon>\r\n            {{ item.title }}\r\n          </div>\r\n          <div class=\"desc\">{{ item.desc }}</div>\r\n          <div class=\"card-switch\" v-if=\"item.pdf_parse_type == 4 && !ali_ocr_switch\">\r\n            {{ t('ali_ocr_not_enabled') }}\r\n            <div class=\"card-switch-btn\" @click.stop=\"onGoSwitch\">{{ t('go_to_enable') }}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </a-modal>\r\n    <a-modal\r\n      v-model:open=\"settingModal\"\r\n      @cancel=\"onClose\"\r\n      :title=\"modalTitle\"\r\n      :maskClosable=\"false\"\r\n      :ok-text=\"isLoading ? t('document_parsing_please_wait') : t('confirm')\"\r\n      :confirmLoading=\"confirmLoading || isLoading\"\r\n      @ok=\"handleSaveSegmentation\"\r\n      :width=\"1000\"\r\n    >\r\n      <div class=\"main-content-box\">\r\n        <DocumentSegmentationModal\r\n          v-if=\"settingModal\"\r\n          @ok=\"handleSaveOk\"\r\n          @finish=\"handleFinish\"\r\n          @loading=\"handleLoading\"\r\n          :pdfState=\"formState\"\r\n          ref=\"documentSegmentationModalRef\"\r\n        />\r\n      </div>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport DocumentSegmentationModal from '@/views/library/document-segmentation/document-segmentation-model.vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { restudyLibraryFile } from '@/api/library'\r\nimport { useCompanyStore } from '@/stores/modules/company'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.re-segmentation-page')\r\n\r\nconst companyStore = useCompanyStore()\r\nconst ali_ocr_switch = computed(() => {\r\n  return companyStore.companyInfo?.ali_ocr_switch == '1'\r\n})\r\nconst query = useRoute().query\r\nconst router = useRouter()\r\nconst props = defineProps({\r\n  detailsInfo: {\r\n    type: Object,\r\n    default: () => {}\r\n  }\r\n})\r\n\r\nconst open = ref(false)\r\nconst settingModal = ref(false)\r\nconst modalTitle = ref('')\r\n\r\nconst emit = defineEmits(['ok', 'enable'])\r\nlet parmas = {}\r\n\r\nconst analysisLists = ref([\r\n  {\r\n    title: t('image_text_ocr'),\r\n    desc: t('image_text_ocr_desc'),\r\n    icon: 'pdf-ocr',\r\n    pdf_parse_type: 2\r\n  },\r\n  {\r\n    title: t('text_only'),\r\n    desc: t('text_only_desc'),\r\n    icon: 'pdf-text',\r\n    pdf_parse_type: 1\r\n  },\r\n  {\r\n    title: t('image_text'),\r\n    desc: t('image_text_desc'),\r\n    icon: 'pdf-img',\r\n    pdf_parse_type: 3\r\n  }\r\n])\r\n\r\nconst formState = reactive({\r\n  pdf_parse_type: 2,\r\n  pdf_page_num: 0\r\n})\r\n\r\nconst onClose = () => {\r\n  // analysisLists.value的数据还原，不要阿里云OCR解析了\r\n  analysisLists.value = analysisLists.value.filter(item => item.pdf_parse_type != 4)\r\n\r\n  emit('enable')\r\n}\r\nconst isLoading = ref(false)\r\nconst handleLoading = (data) => {\r\n  isLoading.value = data\r\n}\r\nconst show = (data) => {\r\n  parmas = {\r\n    ...data\r\n  }\r\n  formState.pdf_parse_type = 2\r\n  formState.pdf_page_num = data.pdf_page_num\r\n  if (data.type == 1) {\r\n    modalTitle.value = t('resegment_current_page', { page: data.pdf_page_num })\r\n  }\r\n  if (data.type == 2) {\r\n    modalTitle.value = t('resegment_document')\r\n  }\r\n  if (data.type == 3) {\r\n    modalTitle.value = t('restudy_document')\r\n    analysisLists.value.push({\r\n      title: t('ali_cloud_ocr'),\r\n      desc: t('ali_cloud_ocr_desc'),\r\n      icon: 'ali-ocr',\r\n      pdf_parse_type: 4\r\n    })\r\n  }\r\n  open.value = true\r\n}\r\n\r\nconst onGoSwitch = () => {\r\n  window.open('#/user/aliocr')\r\n}\r\n\r\nconst handleChangeAnalysis = (item) => {\r\n  if (item.pdf_parse_type == 4 && !ali_ocr_switch.value) {\r\n    return false\r\n  }\r\n  formState.pdf_parse_type = item.pdf_parse_type\r\n}\r\nconst confirmLoading = ref(false)\r\n\r\nconst handleSaveType = () => {\r\n  if (parmas.type == 3) {\r\n    if (formState.pdf_parse_type == 1) {\r\n      // 跳转到文档分段页\r\n      router.push('/library/document-segmentation?document_id=' + query.id + '&source=preview')\r\n      return\r\n    }\r\n    confirmLoading.value = true\r\n    restudyLibraryFile({\r\n      id: query.id,\r\n      pdf_parse_type: formState.pdf_parse_type\r\n    })\r\n      .then((res) => {\r\n        message.success(t('restudy_success'))\r\n        if (formState.pdf_parse_type == 2 || formState.pdf_parse_type == 3 || formState.pdf_parse_type == 4) {\r\n          //跳转回知识库文档列表，当前文档状态进入转换中\r\n          router.push({\r\n            path: '/library/details/knowledge-document',\r\n            query: {\r\n              id: props.detailsInfo.library_id\r\n            }\r\n          })\r\n        }\r\n        if (formState.pdf_parse_type == 1) {\r\n          // 跳转到文档分段页\r\n          router.push('/library/document-segmentation?document_id=' + query.id + '&source=preview')\r\n        }\r\n        open.value = false\r\n      })\r\n      .finally(() => {\r\n        confirmLoading.value = false\r\n      })\r\n    return\r\n  }\r\n  open.value = false\r\n  settingModal.value = true\r\n}\r\n\r\nconst documentSegmentationModalRef = ref(null)\r\n\r\nconst handleSaveSegmentation = () => {\r\n  confirmLoading.value = true\r\n  documentSegmentationModalRef.value.handleSaveLibFileSplit()\r\n}\r\n\r\nconst handleSaveOk = () => {\r\n  message.success(t('save_success'))\r\n  settingModal.value = false\r\n  emit('ok', parmas.type)\r\n}\r\nconst handleFinish = () => {\r\n  confirmLoading.value = false\r\n}\r\n\r\ndefineExpose({\r\n  show\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.select-box {\r\n  .select-list-item {\r\n    padding: 16px;\r\n    margin-top: 16px;\r\n    border: 1px solid #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    &.active {\r\n      border: 1px solid #2475fc;\r\n      .title {\r\n        color: #2475fc;\r\n      }\r\n    }\r\n    .title {\r\n      color: #262626;\r\n      font-weight: 600;\r\n      font-size: 16px;\r\n    }\r\n    .desc {\r\n      color: #595959;\r\n    }\r\n\r\n    .card-switch {\r\n      display: flex;\r\n      gap: 4px;\r\n      color: #595959;\r\n\r\n      .card-switch-btn {\r\n        cursor: pointer;\r\n        color: #2475fc;\r\n\r\n        &:hover {\r\n          opacity: 0.8;\r\n        }\r\n      }\r\n    }\r\n\r\n    &.disabled {\r\n      cursor: no-drop;\r\n\r\n      .title,.desc,.card-switch {\r\n        color: #999;\r\n      }\r\n    }\r\n  }\r\n}\r\n.main-content-box {\r\n  max-height: 650px;\r\n  height: 600px;\r\n  overflow: hidden;\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"subsection-box\">\r\n    <!-- <div class=\"subsection-box-title\">\r\n      分段预览\r\n      <span>共{{ props.total }}个分段</span>\r\n    </div> -->\r\n    <a-table :data-source=\"paragraphLists\" :pagination=\"false\">\r\n      <a-table-column key=\"id\" data-index=\"id\" :width=\"1148\">\r\n        <template #title>{{ t('title_qa_total', { count: props.total }) }}</template>\r\n        <template #default=\"{ record }\">\r\n          <div class=\"qa-list-box\">\r\n            <div class=\"list-item\">\r\n              <div class=\"list-label\">{{ t('label_question') }}</div>\r\n              <div class=\"list-content\" v-html=\"textToHighlight(record.question, props.search)\"></div>\r\n            </div>\r\n            <div class=\"list-item\" v-if=\"record.similar_questions && record.similar_questions.length\">\r\n              <div class=\"list-label\">{{ t('label_similar_questions') }}</div>\r\n              <div class=\"list-content\" v-html=\"textToHighlight(record.similar_questions.join('/'), props.search)\"></div>\r\n            </div>\r\n            <div class=\"list-item\">\r\n              <div class=\"list-label\">{{ t('label_answer') }}</div>\r\n              <div class=\"list-content\" v-html=\"textToHighlight(record.answer, props.search)\"></div>\r\n            </div>\r\n            <div class=\"fragment-img\" v-viewer>\r\n              <img v-for=\"(item, index) in record.images\" :key=\"index\" :src=\"item\" alt=\"\" />\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column :title=\"t('title_embed_status')\" key=\"status_text\" data-index=\"status_text\" :width=\"128\">\r\n        <template #default=\"{ record }\">\r\n          <span class=\"status-tag\" v-if=\"record.status == 0\"><ClockCircleFilled /> {{ t('status_not_converted') }}</span>\r\n          <span class=\"status-tag complete\" v-if=\"record.status == 1\"\r\n            ><CheckCircleFilled /> {{ t('status_converted') }}</span\r\n          >\r\n          <a-tooltip placement=\"top\" v-if=\"record.status == 2\">\r\n            <template #title>\r\n              <span>{{ record.errmsg }}</span>\r\n            </template>\r\n            <span>\r\n              <span class=\"status-tag status-error\"><CloseCircleFilled /> {{ t('status_convert_error') }}</span>\r\n            </span>\r\n          </a-tooltip>\r\n          <span class=\"status-tag running\" v-if=\"record.status == 3\"\r\n            ><a-spin size=\"small\" /> {{ t('status_converting') }}</span\r\n          >\r\n        </template>\r\n      </a-table-column>\r\n      <a-table-column :title=\"t('title_operation')\" key=\"action\" data-index=\"action\" :width=\"120\">\r\n        <template #default=\"{ record, index }\">\r\n          <div class=\"right-opration\">\r\n            <a-dropdown>\r\n              <div class=\"hover-btn-box\">\r\n                <StarFilled\r\n                  @click=\"handleSetCategory(record, {})\"\r\n                  :style=\"{ color: getColor(record), 'font-size': '16px' }\"\r\n                  v-if=\"record.category_id > 0\"\r\n                />\r\n                <StarOutlined\r\n                  @click=\"handleSetCategory(record, startLists[0])\"\r\n                  style=\"font-size: 16px\"\r\n                  v-else\r\n                />\r\n              </div>\r\n              <template #overlay>\r\n                <a-menu>\r\n                  <a-menu-item v-for=\"star in startLists\" :key=\"star.id\">\r\n                    <div class=\"start-item\" @click=\"handleSetCategory(record, star)\">\r\n                      <StarFilled :style=\"{ color: colorLists[star.type] }\" />\r\n                      <div>{{ star.name || '-' }}</div>\r\n                    </div>\r\n                  </a-menu-item>\r\n                  <a-menu-item>\r\n                    <div class=\"start-item\" @click=\"handleOpenSetStartModal\">\r\n                      <SettingOutlined />\r\n                      <div>{{ t('btn_mark_settings') }}</div>\r\n                    </div>\r\n                  </a-menu-item>\r\n                </a-menu>\r\n              </template>\r\n            </a-dropdown>\r\n            <a-tooltip>\r\n              <template #title>{{ t('tooltip_re_convert') }}</template>\r\n              <div class=\"hover-btn-box\" @click=\"toReSegmentationPage(record, index)\">\r\n                <SyncOutlined />\r\n              </div>\r\n            </a-tooltip>\r\n            <a-dropdown placement=\"bottomRight\">\r\n              <div class=\"hover-btn-box\">\r\n                <MoreOutlined />\r\n              </div>\r\n              <template #overlay>\r\n                <a-menu>\r\n                  <a-menu-item>\r\n                    <div @click.stop=\"handleOpenEditModal(record)\">{{ t('btn_edit') }}</div>\r\n                  </a-menu-item>\r\n                  <a-menu-item>\r\n                    <div @click.stop=\"hanldleDelete(record.id)\">{{ t('btn_delete') }}</div>\r\n                  </a-menu-item>\r\n                </a-menu>\r\n              </template>\r\n            </a-dropdown>\r\n          </div>\r\n        </template>\r\n      </a-table-column>\r\n    </a-table>\r\n    <ClassificationMarkModal @ok=\"getCategoryLists\" ref=\"classificationMarkModalRef\" />\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { reactive, ref, computed, createVNode } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleFilled,\r\n  CloseCircleFilled,\r\n  MoreOutlined,\r\n  SyncOutlined,\r\n  ClockCircleFilled,\r\n  LoadingOutlined,\r\n  StarOutlined,\r\n  StarFilled,\r\n  SettingOutlined\r\n} from '@ant-design/icons-vue'\r\nimport { Modal } from 'ant-design-vue'\r\nimport ClassificationMarkModal from './classification-mark-modal.vue'\r\nimport colorLists from '@/utils/starColors.js'\r\nimport {\r\n  deleteParagraph,\r\n  editParagraph,\r\n  getCategoryList,\r\n  updateParagraphCategory\r\n} from '@/api/library'\r\nimport { useRoute } from 'vue-router'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.qa-subsection-box')\r\n\r\nconst route = useRoute()\r\nconst query = route.query\r\nconst emit = defineEmits([\r\n  'handleDelParagraph',\r\n  'handleScrollTargetPage',\r\n  'openEditSubscription',\r\n  'handleConvert',\r\n  'getStatrList'\r\n])\r\nconst props = defineProps({\r\n  paragraphLists: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  search: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  total: {\r\n    type: [Number, String],\r\n    default: 0\r\n  }\r\n})\r\n\r\nconst toReSegmentationPage = (item, index) => {\r\n  let { id, title, content, question, answer, images, category_id } = item\r\n  let similar_questions = item.similar_questions || []\r\n  Modal.confirm({\r\n    title: t('title_confirm_re_convert'),\r\n    icon: null,\r\n    content: t('msg_confirm_re_convert', { index: index + 1 }),\r\n    onOk() {\r\n      return new Promise((resolve, reject) => {\r\n        editParagraph({ id, title, content, question, answer, images, category_id, similar_questions: JSON.stringify(similar_questions) })\r\n          .then((res) => {\r\n            emit('handleConvert', item)\r\n            resolve()\r\n          })\r\n          .catch(() => {\r\n            resolve()\r\n          })\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst handleOpenEditModal = (item) => {\r\n  emit('openEditSubscription', item)\r\n}\r\nconst hanldleDelete = (id) => {\r\n  Modal.confirm({\r\n    title: t('title_tip'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('msg_confirm_delete'),\r\n    onOk() {\r\n      return new Promise((resolve, reject) => {\r\n        deleteParagraph({ id })\r\n          .then((res) => {\r\n            message.success(t('msg_delete_success'))\r\n            emit('handleDelParagraph', id)\r\n            resolve()\r\n          })\r\n          .catch(() => {\r\n            resolve()\r\n          })\r\n      })\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst startLists = ref([])\r\nconst getCategoryLists = () => {\r\n  let params = {}\r\n  if (query.id) {\r\n    params.file_id = query.id\r\n  }\r\n  getCategoryList(params).then((res) => {\r\n    startLists.value = res.data || []\r\n    emit('getStatrList', res.data || [])\r\n  })\r\n}\r\ngetCategoryLists()\r\n\r\nconst classificationMarkModalRef = ref(null)\r\nconst handleOpenSetStartModal = () => {\r\n  classificationMarkModalRef.value.show()\r\n}\r\n\r\nconst getColor = (data) => {\r\n  let type = startLists.value.filter((item) => item.id == data.category_id)[0]?.type\r\n  if (type) {\r\n    return colorLists[type]\r\n  } else {\r\n    return '#F4EA2A'\r\n  }\r\n}\r\nconst handleSetCategory = (item, star = {}) => {\r\n  updateParagraphCategory({\r\n    id: item.id,\r\n    category_id: star.id || 0\r\n  }).then((res) => {\r\n    message.success(t('msg_set_success'))\r\n    item.category_id = star.id\r\n    getCategoryLists()\r\n  })\r\n}\r\n\r\nfunction textToHighlight(fullText, highlightText, options = {}) {\r\n  if (!highlightText || !fullText) return fullText;\r\n\r\n  const {\r\n    highlightClass = 'highlight',\r\n    caseSensitive = false,\r\n    wholeWord = false\r\n  } = options;\r\n\r\n  const flags = caseSensitive ? 'g' : 'gi';\r\n  let regexPattern;\r\n\r\n  if (wholeWord) {\r\n    // 使用单词边界匹配完整单词\r\n    regexPattern = new RegExp(`\\\\b${escapeRegExp(highlightText)}\\\\b`, flags);\r\n  } else {\r\n    regexPattern = new RegExp(escapeRegExp(highlightText), flags);\r\n  }\r\n\r\n  return fullText.replace(regexPattern, match => \r\n    `<span class=\"${highlightClass}\">${match}</span>`\r\n  );\r\n}\r\n\r\n/**\r\n * 转义正则表达式特殊字符\r\n * @param {string} string \r\n * @returns {string}\r\n */\r\nfunction escapeRegExp(string) {\r\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n}\r\n\r\ndefineExpose({ handleOpenEditModal })\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.subsection-box {\r\n  width: 100%;\r\n  .subsection-box-title {\r\n    display: flex;\r\n    align-items: center;\r\n    font-size: 14px;\r\n    line-height: 22px;\r\n    font-weight: 600;\r\n    color: #242933;\r\n    span {\r\n      color: #7a8699;\r\n      font-weight: 400;\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n}\r\n\r\n.qa-list-box {\r\n  .list-item {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    line-height: 22px;\r\n    font-size: 14px;\r\n    color: #595959;\r\n    margin-bottom: 6px;\r\n    .list-label {\r\n      width: 65px;\r\n      font-weight: 600;\r\n      color: #262626;\r\n    }\r\n    .list-content {\r\n      flex: 1;\r\n      word-break: break-all;\r\n      &::v-deep(.highlight) {\r\n        background-color: #FFEB3B; /* 黄色高亮 */\r\n        padding: 0 2px;\r\n        border-radius: 2px;\r\n        box-shadow: 0 1px 1px rgba(0,0,0,0.1);\r\n      }\r\n    }\r\n  }\r\n  .fragment-img {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 8px;\r\n    padding-left: 65px;\r\n    img {\r\n      width: 80px;\r\n      height: 80px;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n\r\n.status-tag {\r\n  display: inline-block;\r\n  height: 24px;\r\n  line-height: 24px;\r\n  padding: 0 6px;\r\n  border-radius: 2px;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  text-align: center;\r\n  color: #3a4559;\r\n  background-color: #edeff2;\r\n\r\n  &.running {\r\n    color: #2475fc;\r\n    background-color: #e8effc;\r\n  }\r\n\r\n  &.complete {\r\n    color: #21a665;\r\n    background: #e8fcf3;\r\n  }\r\n\r\n  &.error {\r\n    cursor: pointer;\r\n    color: #fb363f;\r\n    background-color: #f5c6c8;\r\n  }\r\n\r\n  &.warning {\r\n    cursor: pointer;\r\n    background: #faebe6;\r\n    color: #ed744a;\r\n  }\r\n\r\n  &.status-error {\r\n    cursor: pointer;\r\n    color: #fb363f;\r\n  }\r\n}\r\n\r\n.right-opration {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n.hover-btn-box {\r\n  width: 24px;\r\n  height: 24px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);\r\n  &:hover {\r\n    background: #e4e6eb;\r\n    border-radius: 6px;\r\n  }\r\n}\r\n\r\n.start-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  color: #262626;\r\n  font-size: 14px;\r\n  .anticon {\r\n    font-size: 16px;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <a-modal\r\n      v-model:open=\"settingModal\"\r\n      @cancel=\"onClose\"\r\n      :title=\"modalTitle\"\r\n      :maskClosable=\"false\"\r\n      :ok-text=\"isLoading ? t('btn_ok_parsing') : t('btn_ok')\"\r\n      :confirmLoading=\"confirmLoading || isLoading\"\r\n      @ok=\"handleSaveSegmentation\"\r\n      :width=\"1084\"\r\n    >\r\n      <div class=\"main-content-box\">\r\n        <DocumentSegmentationModal\r\n          v-if=\"settingModal\"\r\n          @ok=\"handleSaveOk\"\r\n          @finish=\"handleFinish\"\r\n          @loading=\"handleLoading\"\r\n          :paragraphType=\"'paragraphsSegmented'\"\r\n          :pdfState=\"formState\"\r\n          :currentData=\"currentData\"\r\n          ref=\"documentSegmentationModalRef\"\r\n        />\r\n      </div>\r\n\r\n      <!-- <template #footer></template> -->\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport DocumentSegmentationModal from '@/views/library/document-segmentation/document-segmentation-model.vue'\r\nimport { message } from 'ant-design-vue'\r\n\r\nconst { t } = useI18n('views.library.library-preview.components.segmentation-setting-modal')\r\n\r\nconst settingModal = ref(false)\r\nconst modalTitle = ref(t('modal_title'))\r\n\r\nconst emit = defineEmits(['ok', 'enable'])\r\nlet parmas = {}\r\n\r\nconst formState = reactive({\r\n  data_ids: 0,\r\n  file_id: 0\r\n})\r\n\r\nconst getListStatusMap = () => ({\r\n  0: t('status_not_converted'),\r\n  1: t('status_converted'),\r\n  2: t('status_conversion_exception'),\r\n  3: t('status_converting'),\r\n  4: t('tab_segmentation_failed'),\r\n  10: t('status_segmenting')\r\n})\r\n\r\nconst currentData = reactive({\r\n  status: '',\r\n  errmsg: '',\r\n  status_text: ''\r\n})\r\n\r\nconst onClose = () => {\r\n  emit('enable')\r\n}\r\nconst isLoading = ref(false)\r\nconst handleLoading = (data) => {\r\n  isLoading.value = data\r\n}\r\nconst show = (data) => {\r\n  settingModal.value = true\r\n  formState.data_ids = data.id\r\n  formState.file_id = data.file_id\r\n  // 点击当前段落的重新分段，需要填充的数据\r\n  currentData.list = [{\r\n    father_chunk_paragraph_number: +data.father_chunk_paragraph_number,\r\n    content: data.content,\r\n    number: +data.number,\r\n    title: data.title,\r\n    word_total: +data.word_total,\r\n    question: data.question,\r\n    answer: data.answer,\r\n    images: data.images\r\n  }]\r\n  currentData.status = data.status\r\n  currentData.errmsg = data.errmsg\r\n  currentData.status_text = getListStatusMap()[data.status]\r\n}\r\n\r\nconst confirmLoading = ref(false)\r\n\r\nconst documentSegmentationModalRef = ref(null)\r\n\r\nconst handleSaveSegmentation = () => {\r\n  confirmLoading.value = true\r\n  documentSegmentationModalRef.value.handleSaveLibFileSplit()\r\n}\r\n\r\nconst handleSaveOk = () => {\r\n  message.success(t('msg_save_success'))\r\n  settingModal.value = false\r\n  emit('ok', parmas.type)\r\n}\r\nconst handleFinish = () => {\r\n  confirmLoading.value = false\r\n}\r\n\r\ndefineExpose({\r\n  show\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.main-content-box {\r\n  max-height: 650px;\r\n  height: 600px;\r\n  overflow: hidden;\r\n}\r\n</style>","<template>\r\n  <div class=\"library-preview-page\">\r\n    <div class=\"breadcrumb-block\">\r\n      <a-breadcrumb>\r\n        <a-breadcrumb-item>\r\n          <router-link to=\"/library/list\"> {{ t('breadcrumb_library_management') }} </router-link></a-breadcrumb-item\r\n        >\r\n        <a-breadcrumb-item>\r\n          <router-link\r\n            :to=\"{\r\n              path: '/library/details/knowledge-document',\r\n              query: {\r\n                id: detailsInfo.library_id\r\n              }\r\n            }\"\r\n          >\r\n            <div class=\"library-line1\">{{ detailsInfo.library_name }}{{ t('breadcrumb_knowledge_base') }}</div>\r\n          </router-link >\r\n        </a-breadcrumb-item>\r\n        <a-breadcrumb-item>{{ t('breadcrumb_knowledge_base_details') }}</a-breadcrumb-item>\r\n      </a-breadcrumb>\r\n      <div class=\"selct-star-box\">\r\n        <SelectStarBox :startLists=\"startLists\" @change=\"handleCategoryChange\" />\r\n      </div>\r\n    </div>\r\n    <div class=\"document-title-block\" style=\"height: 22px;\">\r\n      <LeftOutlined @click=\"goBack\" />\r\n      <span class=\"title\">{{ detailsInfo.file_name }}</span>\r\n      <SegmentationMode :detailsInfo=\"detailsInfo\"></SegmentationMode>\r\n    </div>\r\n    <div class=\"search-content-block\">\r\n      <div class=\"preview-box\">\r\n        <a-button v-if=\"!isCollapsed\" @click=\"toggleCollapse('put')\"><svg-icon class=\"preview-box-icon\" name=\"put-away\"></svg-icon> {{ t('btn_collapse_preview') }}</a-button>\r\n        <a-button v-else @click=\"toggleCollapse('expand')\"><svg-icon class=\"preview-box-icon\" name=\"expand\"></svg-icon> {{ t('btn_expand_preview') }}</a-button>\r\n      </div>\r\n      <a-space>\r\n        <a-input\r\n          v-model:value=\"filterData.search\"\r\n          :placeholder=\"t('ph_search_content')\"\r\n          style=\"width: 200px\"\r\n          allowClear\r\n          @change=\"search\"\r\n        />\r\n        <a-select\r\n          v-model:value=\"filterData.status\"\r\n          :placeholder=\"t('ph_select')\"\r\n          style=\"width: 160px\"\r\n          @change=\"search\"\r\n          v-if=\"is_qa_doc\"\r\n        >\r\n          <a-select-option :value=\"-1\">{{ t('select_all_embed_status') }}</a-select-option>\r\n          <a-select-option v-for=\"(i, key) in listStatusMap\" :key=\"i\" :value=\"key\">{{ i }}</a-select-option>\r\n        </a-select>\r\n        <a-select\r\n          v-if=\"detailsInfo.graph_switch\"\r\n          v-model:value=\"filterData.graph_status\"\r\n          :placeholder=\"t('ph_select')\"\r\n          @change=\"search\"\r\n          style=\"width: 160px\"\r\n        >\r\n          <a-select-option :value=\"-1\">{{ t('select_all_graph_status') }}</a-select-option>\r\n          <a-select-option v-for=\"(i, key) in graphStatusMap\" :key=\"i\" :value=\"key\">{{ i }}</a-select-option>\r\n        </a-select>\r\n        <a-button @click=\"showMetaModal\">{{ t('btn_modify_metadata') }}</a-button>\r\n        <a-dropdown>\r\n          <template #overlay>\r\n            <a-menu>\r\n              <a-menu-item @click=\"reEmbeddingVectors\">{{ t('btn_re_embed_vectors') }}</a-menu-item>\r\n              <a-menu-item v-if=\"detailsInfo.graph_switch\" @click=\"reExtractingGraph\">{{ t('btn_re_extract_graph') }}</a-menu-item>\r\n              <a-menu-item @click=\"handleRenameModal\">{{ t('btn_rename') }}</a-menu-item>\r\n              <a-menu-item v-if=\"doc_type == 2\" @click=\"showUpdateFrequen\"\r\n                >{{ t('btn_set_update_frequency') }}</a-menu-item\r\n              >\r\n            </a-menu>\r\n          </template>\r\n          <a-button>{{ t('btn_other_operations') }} <DownOutlined /></a-button>\r\n        </a-dropdown>\r\n        <a-button v-if=\"doc_type != 3\" @click=\"reSegment\">{{ t('btn_re_segment') }}</a-button>\r\n        <a-button @click=\"openEditSubscription({})\" type=\"primary\">\r\n          <template #icon>\r\n            <PlusOutlined />\r\n          </template>\r\n          <span>{{ t('btn_add_section') }}</span>\r\n        </a-button>\r\n      </a-space>\r\n    </div>\r\n    <template v-if=\"pageLoading\">\r\n      <div class=\"page-loading-box\">\r\n        <a-spin />\r\n      </div>\r\n    </template>\r\n    <template v-else>\r\n      <template v-if=\"is_qa_doc\">\r\n        <!-- qa 类型文档  -->\r\n        <Empty @openEditSubscription=\"openEditSubscription\" v-if=\"isEmpty\"></Empty>\r\n        <cu-scroll :scrollbar=\"{ minSize: 0 }\" v-else @onScrollEnd=\"onScrollEnd\">\r\n          <div class=\"content-block\">\r\n            <QaSubsectionBox\r\n              ref=\"subsectionBoxRef\"\r\n              :total=\"total\"\r\n              :paragraphLists=\"paragraphLists\"\r\n              :search=\"filterData.search\"\r\n              :detailsInfo=\"detailsInfo\"\r\n              @openEditSubscription=\"openEditSubscription\"\r\n              @handleDelParagraph=\"handleDelParagraph\"\r\n              @handleConvert=\"handleConvert\"\r\n              @getStatrList=\"getStatrList\"\r\n            ></QaSubsectionBox>\r\n          </div>\r\n        </cu-scroll>\r\n      </template>\r\n      <template v-else>\r\n        <template v-if=\"isTableType || doc_type == 3\">\r\n          <!-- 表格类型 不支持预览 -->\r\n          <Empty @openEditSubscription=\"openEditSubscription\" v-if=\"isEmpty\"></Empty>\r\n          <cu-scroll :scrollbar=\"{ minSize: 0 }\" v-else @onScrollEnd=\"onScrollEnd\" :disableMouse=\"true\">\r\n            <div class=\"content-block\">\r\n              <SubsectionBox\r\n                ref=\"subsectionBoxRef\"\r\n                :total=\"total\"\r\n                :detailsInfo=\"detailsInfo\"\r\n                :paragraphLists=\"paragraphLists\"\r\n                :search=\"filterData.search\"\r\n                @openEditSubscription=\"openEditSubscription\"\r\n                @handleDelParagraph=\"handleDelParagraph\"\r\n                @handleConvert=\"handleConvert\"\r\n                @handleScrollTargetPage=\"paragraphPosition\"\r\n                @getStatrList=\"getStatrList\"\r\n                @handleSplit=\"handleSplit\"\r\n                @handleSplitNext=\"handleSplitNext\"\r\n                @handleSplitUp=\"handleSplitUp\"\r\n                @handleSplitDelete=\"handleSplitDelete\"\r\n                @handleSegmentation=\"handleSegmentation\"\r\n              ></SubsectionBox>\r\n            </div>\r\n          </cu-scroll>\r\n        </template>\r\n        <template v-else>\r\n          <div class=\"pdf-view-box\">\r\n            <div class=\"view-content-wrap\" :class=\"{ 'collapsed': isCollapsed }\">\r\n              <div v-if=\"detailsInfo?.file_ext == 'pdf'\" class=\"pdf-mode-switch\">\r\n                <a-radio-group v-model:value=\"pdfPreviewMode\">\r\n                  <a-radio-button :value=\"1\">\r\n                    <a-tooltip\r\n                      placement=\"right\"\r\n                      :title=\"t('tooltip_original_preview')\"\r\n                    >\r\n                      {{ t('radio_original_preview') }}\r\n                      <span v-if=\"pdfPreviewMode == 1 && totalPages > 0\"\r\n                        >({{ currentPdfPage }} / {{ totalPages }})</span\r\n                      >\r\n                    </a-tooltip>\r\n                  </a-radio-button>\r\n                  <a-radio-button :value=\"2\">{{ t('radio_plain_text_preview') }}</a-radio-button>\r\n                </a-radio-group>\r\n              </div>\r\n              <div class=\"segmentation-btn\" v-if=\"detailsInfo?.file_ext == 'pdf'\">\r\n                <a-dropdown>\r\n                  <template #overlay>\r\n                    <a-menu @click=\"handleSegmentationMenuClick\">\r\n                      <a-menu-item :key=\"1\" v-if=\"pdfPreviewMode == 1 && totalPages > 0\">\r\n                        <a-tooltip placement=\"right\" :title=\"t('tooltip_re_segment_current_page')\">\r\n                          <div>{{ t('menu_re_segment_current_page') }}</div>\r\n                        </a-tooltip>\r\n                      </a-menu-item>\r\n                      <a-menu-item :key=\"2\">\r\n                        <a-tooltip\r\n                          placement=\"right\"\r\n                          :title=\"t('tooltip_re_segment_document')\"\r\n                        >\r\n                          <div>{{ t('menu_re_segment_document') }}</div>\r\n                        </a-tooltip>\r\n                      </a-menu-item>\r\n                      <a-menu-item :key=\"3\">\r\n                        <a-tooltip\r\n                          placement=\"right\"\r\n                          :title=\"t('tooltip_re_learn_document')\"\r\n                        >\r\n                          <div>{{ t('menu_re_learn_document') }}</div>\r\n                        </a-tooltip>\r\n                      </a-menu-item>\r\n                    </a-menu>\r\n                  </template>\r\n                  <a-button>\r\n                    {{ t('btn_re_segment') }}\r\n                    <DownOutlined />\r\n                  </a-button>\r\n                </a-dropdown>\r\n              </div>\r\n              <PdfPreview\r\n                v-if=\"detailsInfo?.file_ext == 'pdf' && pdfPreviewMode == 1\"\r\n                ref=\"pdfRef\"\r\n                class=\"scroll-box pdf-render-box\"\r\n                :source=\"getFileUrl\"\r\n                @select=\"pdfPageSelect\"\r\n                @scroll=\"pdfPageOnScroll\"\r\n                @rendered=\"pdfPageRendered\"\r\n                @getTotalPage=\"getTotalPage\"\r\n              />\r\n              <cu-scroll\r\n                v-else\r\n                :scrollbar=\"scrollbar\"\r\n                ref=\"leftScrollRef\"\r\n                class=\"scroll-box\"\r\n                @onScrollEnd=\"onScrollEnd\"\r\n              >\r\n                <div class=\"view-content-box\" style=\"padding-top: 60px\">\r\n                  <div\r\n                    class=\"list-item\"\r\n                    @click=\"handleClickItem(index)\"\r\n                    v-for=\"(item, index) in paragraphLists\"\r\n                    :key=\"index\"\r\n                  >\r\n                    <div class=\"content-box\" v-if=\"item.question\">{{ item.question }}</div>\r\n                    <div class=\"content-box\" v-if=\"item.answer\">{{ item.answer }}</div>\r\n                    <div class=\"content-box\" v-html=\"item.content\"></div>\r\n                    <div class=\"fragment-img\" v-viewer>\r\n                      <img v-for=\"(item, index) in item.images\" :key=\"index\" :src=\"item\" alt=\"\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </cu-scroll>\r\n            </div>\r\n            <div class=\"right-contnt-box\">\r\n              <div class=\"right-tabs-box\" v-if=\"!is_qa_doc\">\r\n                <a-tabs\r\n                  v-model:activeKey=\"filterData.status\"\r\n                  style=\"background-color: #f2f4f7; padding: 0px 16px; border-radius: 6px;\"\r\n                  @change=\"search\"\r\n                >\r\n                  <a-tab-pane v-for=\"i in generalListStatusMap\" :key=\"i.value\" :tab=\"`${i.label} (${i.num})`\"></a-tab-pane>\r\n                </a-tabs>\r\n              </div>\r\n              <Empty @openEditSubscription=\"openEditSubscription\" v-if=\"isEmpty\"></Empty>\r\n              <cu-scroll\r\n                :scrollbar=\"scrollbar\"\r\n                :disableMouse=\"true\"\r\n                ref=\"rightScrollRef\"\r\n                v-else\r\n                @onScrollEnd=\"onScrollEnd\"\r\n              >\r\n                <div class=\"content-block\">\r\n                  <SubsectionBox\r\n                    ref=\"subsectionBoxRef\"\r\n                    :total=\"total\"\r\n                    :detailsInfo=\"detailsInfo\"\r\n                    :paragraphLists=\"paragraphLists\"\r\n                    :search=\"filterData.search\"\r\n                    @openEditSubscription=\"openEditSubscription\"\r\n                    @handleDelParagraph=\"handleDelParagraph\"\r\n                    @handleConvert=\"handleConvert\"\r\n                    @handleScrollTargetPage=\"paragraphPosition\"\r\n                    @getStatrList=\"getStatrList\"\r\n                    @handleSplit=\"handleSplit\"\r\n                    @handleSplitNext=\"handleSplitNext\"\r\n                    @handleSplitUp=\"handleSplitUp\"\r\n                    @handleSplitDelete=\"handleSplitDelete\"\r\n                    @handleSegmentation=\"handleSegmentation\"\r\n                  ></SubsectionBox>\r\n                </div>\r\n              </cu-scroll>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </template>\r\n    </template>\r\n    <EditSubscription\r\n      :detailsInfo=\"detailsInfo\"\r\n      @handleEdit=\"handleEditParagraph\"\r\n      ref=\"editSubscriptionRef\"\r\n    ></EditSubscription>\r\n\r\n    <UpdateFrequency @ok=\"saveFrequency\" ref=\"updateFrequencyRef\"></UpdateFrequency>\r\n    <RenameModal @ok=\"handleSaveNameOk\" ref=\"renameModalRef\" />\r\n    <ReSegmentationPage\r\n      @ok=\"handleReSegmentationPageOk\"\r\n      @enable=\"handleeEableScroll\"\r\n      :detailsInfo=\"detailsInfo\"\r\n      ref=\"reSegmentationPageRef\"\r\n    />\r\n    <SegmentationSettingModal ref=\"segmentationSettingModalRef\" @ok=\"onSaveModal\" />\r\n    <MetadataManageModal ref=\"metaRef\" :library-id=\"detailsInfo.library_id\" :file-id=\"route.query.id\"/>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed, nextTick, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { message } from 'ant-design-vue'\r\nimport { LeftOutlined, PlusOutlined, DownOutlined } from '@ant-design/icons-vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.library.library-preview.index')\r\nimport Empty from './components/empty.vue'\r\nimport SubsectionBox from './components/subsection-box.vue'\r\nimport {\r\n  getParagraphCount,\r\n  getLibFileInfo,\r\n  saveLibFileSplit,\r\n  getParagraphList,\r\n  reconstructGraph,\r\n  reconstructVector\r\n} from '@/api/library'\r\nimport CuScroll from '@/components/cu-scroll/cu-scroll.vue'\r\nimport EditSubscription from './components/edit-subsection.vue'\r\nimport SegmentationMode from './components/segmentation-mode.vue'\r\nimport UpdateFrequency from './components/update-frequency.vue'\r\nimport RenameModal from '../library-details/components/rename-modal.vue'\r\nimport PdfPreview from '@/components/pdf-preview/pdf-preview.vue'\r\nimport { useUserStore } from '@/stores/modules/user.js'\r\nimport ReSegmentationPage from './components/re-segmentation-page.vue'\r\nimport QaSubsectionBox from './components/qa-subsection-box.vue'\r\nimport SelectStarBox from './components/selct-star-box.vue'\r\nimport { useCompanyStore } from '@/stores/modules/company'\r\nimport SegmentationSettingModal from './components/segmentation-setting-modal.vue'\r\nimport MetadataManageModal from \"@/views/library/library-details/components/metadata-manage-modal.vue\";\r\n\r\nconst companyStore = useCompanyStore()\r\nconst neo4j_status = computed(()=>{\r\n  return companyStore.companyInfo?.neo4j_status == 'true'\r\n})\r\n\r\nconst metaRef = ref(false)\r\nconst isCollapsed = ref(false)\r\nconst pdfRef = ref(null)\r\nconst pdfLoadedPage = ref(0)\r\nconst pdfTotalPage = ref(0)\r\nconst graphStatusMap = {\r\n  0: t('status_pending_generation'),\r\n  4: t('status_generating'),\r\n  2: t('status_generation_success'),\r\n  3: t('status_generation_failed')\r\n}\r\n\r\nconst startLists = ref([])\r\nconst getStatrList = (data) => {\r\n  startLists.value = data\r\n}\r\n\r\nconst scrollbar = ref({\r\n  fade: false,\r\n  scrollbarTrackClickable: true,\r\n  interactive: true,\r\n  minSize: 40\r\n})\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst userStore = useUserStore()\r\nconst isTableType = computed(() => {\r\n  return detailsInfo.value.is_table_file == '1'\r\n})\r\nconst doc_type = computed(() => {\r\n  return detailsInfo.value.doc_type\r\n})\r\nconst isEmpty = computed(() => {\r\n  // 1学习中,2学习完成,3文件异常 4待用户切分 待学习\r\n  let status = detailsInfo.value.status\r\n  return !(status == '1' || status == '2') || paragraphLists.value.length == 0\r\n})\r\nconst is_qa_doc = computed(() => {\r\n  return detailsInfo.value.is_qa_doc == '1'\r\n})\r\nconst detailsInfo = ref({})\r\nconst metaList = ref([])\r\nconst filterData = reactive({\r\n  status: -1,\r\n  graph_status: -1,\r\n  category_id: -1,\r\n  search: '',\r\n})\r\nconst pdfPreviewMode = ref(1)\r\n\r\nconst getFileUrl = computed(() => {\r\n  return '/manage/getLibRawFile?id=' + route.query.id + '&token=' + userStore.getToken\r\n})\r\n\r\nconst goBack = () => {\r\n  router.back()\r\n}\r\n\r\nconst leftScrollRef = ref(null)\r\nconst rightScrollRef = ref(null)\r\nlet lastIndex = -1\r\nconst handleClickItem = (index, type = 1) => {\r\n  let elClass, scrollRef\r\n  if (type == 1) {\r\n    elClass = '.subsection-box .list-item'\r\n    scrollRef = rightScrollRef.value\r\n  } else {\r\n    elClass = '.view-content-box .list-item'\r\n    scrollRef = leftScrollRef.value\r\n  }\r\n  const el = document.querySelectorAll(elClass)[index]\r\n  el.classList.add('flash-border')\r\n  if (lastIndex >= 0) {\r\n    document.querySelectorAll(elClass)[lastIndex].classList.remove('flash-border')\r\n  }\r\n  setTimeout(() => {\r\n    lastIndex = -1\r\n    el.classList.remove('flash-border')\r\n  }, 2500)\r\n  lastIndex = index\r\n  scrollRef.scrollToElement({\r\n    el,\r\n    time: 1000\r\n  })\r\n}\r\n\r\nconst pageLoading = ref(true)\r\nconst library_type = ref(0)\r\n\r\nconst paginations = ref({\r\n  page: 1,\r\n  size: 1000\r\n})\r\nconst paragraphInfo = ref({})\r\nconst paragraphLists = ref([])\r\nconst total = ref(0)\r\nconst listStatusMap = {\r\n  0: t('status_not_converted'),\r\n  1: t('status_converted'),\r\n  2: t('status_conversion_exception'),\r\n  3: t('status_converting')\r\n}\r\n\r\nconst totalData = reactive({\r\n  \"split_status_exception\": 0, // 分段失败\r\n  \"total\": 0,// 全部\r\n  \"vector_status_converted\": 0, // 已转换\r\n  \"vector_status_converting\": 0, // 转换中\r\n  \"vector_status_exception\": 0,// 转换失败\r\n  \"vector_status_initial\": 0// 待转换\r\n})\r\n\r\nconst generalListStatusMap = reactive([\r\n  {\r\n    value: -1,\r\n    label: t('tab_all'),\r\n    num: computed(() => totalData.total)\r\n  },\r\n  {\r\n    value: 4,\r\n    label: t('tab_segmentation_failed'),\r\n    num: computed(() => totalData.split_status_exception)\r\n  },\r\n  {\r\n    value: 0,\r\n    label: t('tab_not_converted'),\r\n    num: computed(() => totalData.vector_status_initial)\r\n  },\r\n  {\r\n    value: 3,\r\n    label: t('tab_converting'),\r\n    num: computed(() => totalData.vector_status_converting)\r\n  },\r\n  {\r\n    value: 2,\r\n    label: t('tab_conversion_exception'),\r\n    num: computed(() => totalData.vector_status_exception)\r\n  },\r\n  {\r\n    value: 1,\r\n    label: t('tab_converted'),\r\n    num: computed(() => totalData.vector_status_converted)\r\n  }\r\n])\r\n\r\nconst defaultAiChunkPrumpt = t('default_ai_chunk_prompt')\r\nconst settingMode = ref(1) // 1 表格，0 非表格\r\nlet formData = {\r\n  id: route.query.id,\r\n  separators_no: '', // 自定义分段-分隔符序号集\r\n  chunk_size: 512, // 自定义分段-分段最大长度 默认512，最大值不得超过2000\r\n  not_merged_text: false,\r\n  chunk_overlap: 50, // 自定义分段-分段重叠长度 默认为50，最小不得低于10，最大不得超过最大分段长度的50%\r\n  is_qa_doc: 0, // 0 普通文档 1 QA文档\r\n  question_lable: '', // QA文档-问题开始标识符\r\n  similar_label: '', // QA文档-相似度标识符\r\n  answer_lable: '', // QA文档-答案开始标识符\r\n  enable_extract_image: true,\r\n  ai_chunk_size: 5000, // ai大模型分段最大字符数\r\n  ai_chunk_model:'', // ai大模型分段模型名称\r\n  ai_chunk_model_config_id: '', // ai大模型分段模型配置id\r\n  ai_chunk_prumpt: defaultAiChunkPrumpt,\r\n  ai_chunk_task_id: '',  //  ai分段数据id，如果有ai分段数据就有值\r\n  father_chunk_paragraph_type: 2,\r\n  father_chunk_separators_no: [],\r\n  father_chunk_chunk_size: 1024,\r\n  son_chunk_separators_no: [],\r\n  son_chunk_chunk_size: 512,\r\n}\r\nconst saveLoading = ref(false)\r\n\r\nlet isLoading = true\r\n\r\nconst getFileInfo = async () => {\r\n  getLibFileInfo({\r\n    id: route.query.id\r\n  }).then((res) => {\r\n    library_type.value = res.data.library_type\r\n    detailsInfo.value = {\r\n      ...res.data,\r\n      graph_switch: res.data.graph_switch == '1' && neo4j_status.value\r\n    }\r\n    metaList.value = res?.data?.meta_list || []\r\n    let status = res.data.status\r\n    if (status == 1 || status == 2) {\r\n      getParagraphLists()\r\n    } else {\r\n      pageLoading.value = false\r\n    }\r\n\r\n    formData = {\r\n      ...formData,\r\n      separators_no: res.data.separators_no || '[12,11]',\r\n      chunk_size: +res.data.chunk_size || 512,\r\n      not_merged_text: res.data.not_merged_text == 'true',\r\n      ai_chunk_size: +res.data.ai_chunk_size || 5000, // ai模型的默认值是5000\r\n      chunk_overlap: +res.data.chunk_overlap || 50,\r\n      is_qa_doc: library_type.value == 2 ? 1 : 0,\r\n      question_lable: res.data.question_lable,\r\n      similar_label: res.data.similar_label,\r\n      answer_lable: res.data.answer_lable,\r\n      question_column: res.data.question_column,\r\n      similar_column: res.data.similar_column,\r\n      answer_column: res.data.answer_column,\r\n      enable_extract_image: res.data.enable_extract_image == 'true',\r\n      qa_index_type: +res.data.qa_index_type,\r\n\r\n      chunk_type: +res.data.chunk_type,\r\n      semantic_chunk_size: +res.data.semantic_chunk_size || 512,\r\n      semantic_chunk_overlap: +res.data.semantic_chunk_overlap || 50,\r\n      semantic_chunk_threshold: +res.data.semantic_chunk_threshold || 90,\r\n      semantic_chunk_use_model: res.data.semantic_chunk_use_model || '',\r\n      ai_chunk_prumpt: res.data.ai_chunk_prumpt || '',\r\n      ai_chunk_model: res.data.ai_chunk_model || '',\r\n      semantic_chunk_model_config_id:\r\n        res.data.semantic_chunk_model_config_id > 0 ? res.data.semantic_chunk_model_config_id : '',\r\n      ai_chunk_model_config_id:\r\n        res.data.ai_chunk_model_config_id > 0 ? res.data.ai_chunk_model_config_id : '',\r\n      ai_chunk_task_id: res.data.ai_chunk_task_id || '',\r\n\r\n      father_chunk_paragraph_type: +res.data.father_chunk_paragraph_type || 2,\r\n      father_chunk_separators_no: res.data.father_chunk_separators_no || '[12,11]',\r\n      father_chunk_chunk_size: +res.data.father_chunk_chunk_size || 1024,\r\n      son_chunk_separators_no: res.data.son_chunk_separators_no || '[8,10]',\r\n      son_chunk_chunk_size: +res.data.son_chunk_chunk_size || 512,\r\n    }\r\n    console.log(formData, '==')\r\n\r\n    if (res.data.chunk_type == 0) {\r\n      formData = {\r\n        ...formData,\r\n        separators_no: res.data.normal_chunk_default_separators_no,\r\n        chunk_size: +res.data.normal_chunk_default_chunk_size,\r\n        not_merged_text: res.data.normal_chunk_default_not_merged_text == 'true',\r\n        chunk_overlap: +res.data.normal_chunk_default_chunk_overlap,\r\n        chunk_type: +res.data.default_chunk_type,\r\n        semantic_chunk_size: +res.data.semantic_chunk_default_chunk_size,\r\n        semantic_chunk_overlap: +res.data.semantic_chunk_default_chunk_overlap,\r\n        semantic_chunk_threshold: +res.data.semantic_chunk_default_threshold,\r\n        semantic_chunk_use_model: res.data.default_use_model || '',\r\n        semantic_chunk_model_config_id: res.data.default_model_config_id > 0 ? res.data.default_model_config_id : ''\r\n      }\r\n    }\r\n\r\n    if (status == 4 || status == 2) {\r\n      settingMode.value = parseInt(res.data.is_table_file)\r\n    }\r\n\r\n  })\r\n}\r\ngetFileInfo()\r\n\r\nconst getParagraphCountFn = () => {\r\n  getParagraphCount({\r\n    file_id: route.query.id,\r\n    search: filterData.search\r\n  }).then((res) => {\r\n    Object.assign(totalData, res.data)\r\n  })\r\n}\r\n\r\nconst onSaveModal = () => {\r\n  // 先使用最简单的方式，刷新页面\r\n  window.location.reload();\r\n  // getParagraphLists()\r\n  // getParagraphCountFn()\r\n}\r\n\r\nconst search = () => {\r\n  paginations.value.page = 1\r\n  total.value = 0\r\n  paragraphLists.value = []\r\n  getParagraphLists()\r\n  getParagraphCountFn()\r\n}\r\n\r\nconst handleCategoryChange = (id)=>{\r\n  filterData.category_id = id\r\n  search()\r\n}\r\n\r\nconst loadMore = (callback = null) => {\r\n  paginations.value.page++\r\n  getParagraphLists(callback)\r\n}\r\n\r\nconst getParagraphLists = (callback = null) => {\r\n  isLoading = true\r\n  getParagraphList({\r\n    file_id: route.query.id,\r\n    ...paginations.value,\r\n    ...filterData\r\n  }).then((res) => {\r\n    pageLoading.value = false\r\n    isLoading = false\r\n    let data = res.data\r\n    let list = data.list || []\r\n    let isExcelQa = data.info?.is_qa_doc == '1' && data.info?.is_table_file == '1'\r\n    list.forEach((item) => {\r\n      item.status_text = listStatusMap[item.status]\r\n      item.graph_status_text = graphStatusMap[item.graph_status]\r\n      item.isExcelQa = isExcelQa\r\n      if(item.similar_questions){\r\n        item.similar_questions = JSON.parse(item.similar_questions)\r\n      }\r\n    })\r\n\r\n    paragraphInfo.value = data.info\r\n    if (paginations.value.page == 1) {\r\n      paragraphLists.value = []\r\n    }\r\n    paragraphLists.value = [...paragraphLists.value, ...list]\r\n    total.value = data.total\r\n    typeof callback === 'function' && callback()\r\n  })\r\n}\r\nconst onScrollEnd = () => {\r\n  if (isLoading) {\r\n    return\r\n  }\r\n  if (paragraphLists.value.length >= total.value) {\r\n    return\r\n  }\r\n  loadMore()\r\n  // 同时加载pdf\r\n  pdfRef.value && pdfRef.value.loadMore()\r\n}\r\n\r\nconst handleConvert = () => {\r\n  updataList()\r\n}\r\n\r\nlet timer = null\r\n\r\nfunction setIntervalUpStatus() {\r\n  clearInterval(timer)\r\n  // if()\r\n  let list = paragraphLists.value.filter((item) => item.status == 3)\r\n  if (list.length) {\r\n    timer = setInterval(() => {\r\n      updataList()\r\n    }, 5000)\r\n  } else {\r\n    clearInterval(timer)\r\n  }\r\n}\r\n\r\nconst updataList = () => {\r\n  getParagraphList({\r\n    file_id: route.query.id,\r\n    page: 1,\r\n    size: paragraphLists.value.length,\r\n    ...filterData\r\n  }).then((res) => {\r\n    let data = res.data\r\n    let list = data.list || []\r\n    let isExcelQa = data.info?.is_qa_doc == '1' && data.info?.is_table_file == '1'\r\n    list.forEach((item) => {\r\n      item.status_text = listStatusMap[item.status]\r\n      item.graph_status_text = graphStatusMap[item.graph_status]\r\n      item.isExcelQa = isExcelQa\r\n      if(item.similar_questions){\r\n        item.similar_questions = JSON.parse(item.similar_questions)\r\n      }\r\n    })\r\n    paragraphLists.value = list\r\n    setIntervalUpStatus()\r\n  })\r\n}\r\nconst handleEditParagraph = (data) => {\r\n  if (!data.id) {\r\n    paginations.value.page = 1\r\n    getParagraphLists()\r\n    return\r\n  }\r\n  // 更新分段内容 无刷更新\r\n  let lists = paragraphLists.value\r\n  let index = lists.findIndex((item) => item.id == data.id)\r\n  if (index > -1) {\r\n    let lastItem = lists[index]\r\n    lastItem.title = data.title\r\n    lastItem.content = data.content\r\n    lastItem.question = data.question\r\n    lastItem.answer = data.answer\r\n    lastItem.images = data.images\r\n    lastItem.category_id = data.category_id\r\n    lastItem.word_total = data.question.length + data.answer.length + data.content.length\r\n    lastItem.similar_questions = data.similar_questions.length ? JSON.parse(data.similar_questions) : []\r\n    lists.splice(index, 1, lastItem)\r\n    paragraphLists.value = lists\r\n  }\r\n}\r\nconst handleDelParagraph = (id) => {\r\n  // 无刷新 删除列表\r\n  let lists = paragraphLists.value\r\n  let index = lists.findIndex((item) => item.id == id)\r\n  if (index > -1) {\r\n    lists.splice(index, 1)\r\n    paragraphLists.value = lists\r\n    total.value = total.value--\r\n  }\r\n}\r\n\r\nconst editSubscriptionRef = ref(null)\r\nconst openEditSubscription = (data) => {\r\n  editSubscriptionRef.value.showModal(JSON.parse(JSON.stringify(data)))\r\n}\r\n\r\nconst updateFrequencyRef = ref(null)\r\n\r\nconst reEmbeddingVectors = () => {\r\n  reconstructVector({ id: route.query.id }).then(() => message.success(t('msg_operation_completed')))\r\n}\r\n\r\nconst reExtractingGraph = () => {\r\n  reconstructGraph({ id: route.query.id }).then(() => message.success(t('msg_operation_completed')))\r\n}\r\nconst renameModalRef = ref(null)\r\nconst handleRenameModal = () => {\r\n  renameModalRef.value.show(detailsInfo.value)\r\n}\r\n\r\nconst reSegment = () => {\r\n  router.push('/library/document-segmentation?document_id=' + route.query.id + '&source=preview')\r\n}\r\n\r\nconst showUpdateFrequen = () => {\r\n  updateFrequencyRef.value.open({\r\n    id: route.query.id,\r\n    doc_auto_renew_frequency: detailsInfo.value.doc_auto_renew_frequency\r\n  })\r\n}\r\n\r\nconst saveFrequency = (data) => {\r\n  detailsInfo.value.doc_auto_renew_frequency = data\r\n}\r\n\r\nconst handleSaveNameOk = (file_name) => {\r\n  detailsInfo.value.file_name = file_name\r\n}\r\n\r\nconst pdfPageSelect = (page) => {\r\n  const link = () => {\r\n    for (let i in paragraphLists.value) {\r\n      // 查询该页的第一个分段\r\n      if (paragraphLists.value[i].page_num == page) {\r\n        handleClickItem(i)\r\n        return\r\n      }\r\n    }\r\n  }\r\n  if (page > paragraphLists.value[paragraphLists.value.length - 1].page_num) {\r\n    message.warning(t('msg_segment_data_loading'))\r\n    const checkLoadFinished = () => {\r\n      if (page <= paragraphLists.value[paragraphLists.value.length - 1].page_num) {\r\n        message.success(t('msg_loading_completed'))\r\n        nextTick(() => {\r\n          link()\r\n        })\r\n      } else {\r\n        loadMore(checkLoadFinished)\r\n      }\r\n    }\r\n    loadMore(checkLoadFinished)\r\n  } else {\r\n    link()\r\n  }\r\n}\r\n\r\nconst pdfPageRendered = (page, total) => {\r\n  pdfTotalPage.value = total\r\n  pdfLoadedPage.value = page\r\n  const maxPage = paragraphLists.value[paragraphLists.value.length - 1].page_num\r\n  // 当pdf最大页分段未加载时，加载分段\r\n  if (maxPage < page) {\r\n    loadMore()\r\n  }\r\n}\r\n\r\nconst paragraphPosition = (data) => {\r\n  if (detailsInfo.value?.file_ext == 'pdf' && pdfPreviewMode.value == 1) {\r\n    const index = data.page_num - 1\r\n    const getPageEl = () =>\r\n      document.querySelectorAll('.pdf-render-box > .scroll-content .vue-pdf-embed')[index]\r\n    const link = () => {\r\n      const el = getPageEl()\r\n      el.classList.add('flash-border')\r\n      setTimeout(() => el.classList.remove('flash-border'), 2500)\r\n      pdfRef.value.getScrollInstance().scrollToElement({ el, time: 1000 })\r\n    }\r\n    const el = getPageEl()\r\n    if (!el) {\r\n      // 未加载到pdf时\r\n      message.warning(t('msg_pdf_loading'))\r\n      const checkLoadFinished = () => {\r\n        if (!getPageEl()) {\r\n          pdfRef.value && pdfRef.value.loadMore()\r\n        } else {\r\n          message.success(t('msg_loading_completed'))\r\n          link()\r\n        }\r\n      }\r\n      pdfRef.value && pdfRef.value.loadMore(checkLoadFinished)\r\n    } else {\r\n      link()\r\n    }\r\n  } else {\r\n    handleClickItem(data.index, 2)\r\n  }\r\n}\r\nconst currentPdfPage = ref(1)\r\nlet pdfHeight = null\r\n\r\nconst totalPages = ref(0)\r\nconst getTotalPage = (data) => {\r\n  totalPages.value = data\r\n}\r\nconst pdfPageOnScroll = ({ y }) => {\r\n  if (!pdfHeight) {\r\n    // 一页pdf的高度\r\n    const el = document.querySelectorAll('.pdf-render-box > .scroll-content .vue-pdf-embed')[0]\r\n    pdfHeight = el && el.clientHeight\r\n  }\r\n  // 计算一下 现在滚到pdf页码\r\n  let page = Math.floor(Math.abs(y) / pdfHeight) + 1\r\n  currentPdfPage.value = Math.max(page, 1)\r\n}\r\n\r\nconst reSegmentationPageRef = ref(null)\r\nconst segmentationSettingModalRef = ref(null)\r\n\r\nconst handleSegmentationMenuClick = (e) => {\r\n  let { key } = e\r\n  // console.log(pdfRef.value.getScrollInstance(),'==')\r\n  pdfRef.value && pdfRef.value.getScrollInstance().disable()\r\n  if (key == 1) {\r\n    reSegmentationPageRef.value.show({\r\n      type: key,\r\n      pdf_page_num: currentPdfPage.value\r\n    })\r\n  }\r\n  if (key == 2) {\r\n    reSegment()\r\n  }\r\n  if (key == 3) {\r\n    reSegmentationPageRef.value.show({\r\n      type: key,\r\n      pdf_page_num: 0\r\n    })\r\n  }\r\n}\r\n\r\nconst handleSegmentation = (item) => {\r\n  if (segmentationSettingModalRef.value) {\r\n    segmentationSettingModalRef.value.show(item)\r\n  }\r\n}\r\n\r\nconst handleeEableScroll = () => {\r\n  pdfRef.value && pdfRef.value.getScrollInstance().enable()\r\n}\r\nconst handleReSegmentationPageOk = () => {\r\n  handleeEableScroll()\r\n  search()\r\n}\r\n\r\nconst toggleCollapse = () => {\r\n  isCollapsed.value = !isCollapsed.value\r\n}\r\n\r\n// 单独分段\r\nconst createNewParagraph = (item, content) => {\r\n  let newItem = JSON.parse(JSON.stringify(item))\r\n  newItem.content = content\r\n  newItem.word_total = content.length\r\n  return newItem\r\n}\r\n\r\nconst isFullSelectionRef = ref(false)\r\nconst splitType = ref(1) // 1单独分段 2合并到下一分段 3合并到上一分段 4删除\r\n\r\n// 单独分段\r\nconst handleSplit = ({ index, beforeContent, selectedContent, afterContent, isFullSelection }) => {\r\n  const newList = [...paragraphLists.value]\r\n\r\n  isFullSelectionRef.value = isFullSelection\r\n  splitType.value = 1\r\n  if (isFullSelection) {\r\n    // 插入选中内容段落\r\n    newList.splice(index + 1, 0, createNewParagraph(newList[index], selectedContent))\r\n    // 直接删除当前段落\r\n    newList.splice(index, 1);\r\n  } else {\r\n    // 更新原段落\r\n    newList[index].content = beforeContent || ''\r\n    newList[index].word_total = beforeContent.length || 0\r\n\r\n    // 插入剩余内容段落\r\n    if (afterContent.trim()) {\r\n      // 插入选中内容段落\r\n      newList.splice(index + 1, 0, createNewParagraph(newList[index], afterContent))\r\n    }\r\n\r\n    // 插入选中内容段落\r\n    newList.splice(index + 1, 0, createNewParagraph(newList[index], selectedContent))\r\n\r\n    // 不是全选最终数据长度会加1\r\n    newList[index + 1].images = []\r\n    newList.splice(index, 1);\r\n  }\r\n\r\n  paragraphLists.value = newList\r\n\r\n  // 这里直接调用保存接口/manage/saveLibFileSplit\r\n  handleSaveLibFileSplit(newList, index)\r\n}\r\n\r\n// 合并到下一个分段\r\nconst handleSplitNext = ({ index, beforeContent, selectedContent, afterContent, isFullSelection }) => {\r\n  const newList = [...paragraphLists.value]\r\n\r\n  isFullSelectionRef.value = isFullSelection\r\n  splitType.value = 2\r\n  let oldWord_total = newList[index + 1].word_total\r\n\r\n  if (isFullSelection) {\r\n    // 合并内容到下一段落\r\n    newList[index + 1].content = +selectedContent\r\n    newList[index + 1].word_total = parseInt(oldWord_total) + selectedContent.length\r\n    // 删除当前段落\r\n    newList.splice(index, 1);\r\n    paragraphLists.value = newList;\r\n    handleSaveLibFileSplit(newList, index);\r\n  } else {\r\n    // 更新原段落\r\n    newList[index].content = beforeContent || ''\r\n    newList[index].word_total = beforeContent.length || 0\r\n\r\n    // 修改下一个段落的内容\r\n    newList[index + 1].content += selectedContent\r\n    newList[index + 1].word_total = parseInt(oldWord_total) + selectedContent.length\r\n\r\n    // 插入剩余内容到原段落\r\n    if (afterContent.trim()) {\r\n      newList[index].content += afterContent || ''\r\n      newList[index].word_total += afterContent.length || 0\r\n    }\r\n\r\n    paragraphLists.value = newList\r\n\r\n    // 这里直接调用保存接口/manage/saveLibFileSplit\r\n    handleSaveLibFileSplit(newList, index + 1)\r\n  }\r\n}\r\n\r\n// 合并到上一个分段\r\nconst handleSplitUp = ({ index, beforeContent, selectedContent, afterContent, isFullSelection }) => {\r\n  const newList = [...paragraphLists.value]\r\n\r\n  isFullSelectionRef.value = isFullSelection\r\n  splitType.value = 3\r\n  let oldWord_total = newList[index - 1].word_total\r\n\r\n  if (isFullSelection) {\r\n    // 合并内容到上一段落\r\n    newList[index - 1].content += selectedContent\r\n    newList[index - 1].word_total = parseInt(oldWord_total) + selectedContent.length\r\n    // 删除当前段落\r\n    newList.splice(index, 1);\r\n    paragraphLists.value = newList;\r\n    handleSaveLibFileSplit(newList, index);\r\n  } else {\r\n    // 更新原段落\r\n    newList[index].content = beforeContent || ''\r\n    newList[index].word_total = beforeContent.length || 0\r\n\r\n    // 修改上一个段落的内容\r\n    newList[index - 1].content += selectedContent\r\n    newList[index - 1].word_total = parseInt(oldWord_total) + selectedContent.length\r\n\r\n    // 插入剩余内容段落\r\n    if (afterContent.trim()) {\r\n      newList[index].content += afterContent || ''\r\n      newList[index].word_total += afterContent.length || 0\r\n    }\r\n\r\n    paragraphLists.value = newList\r\n\r\n    // 这里直接调用保存接口/manage/saveLibFileSplit\r\n    handleSaveLibFileSplit(newList, index - 1)\r\n  }\r\n}\r\n\r\n// 删除\r\nconst handleSplitDelete = ({ index, beforeContent, afterContent, isFullSelection }) => {\r\n  const newList = [...paragraphLists.value]\r\n\r\n  isFullSelectionRef.value = isFullSelection\r\n  splitType.value = 4\r\n\r\n  if (isFullSelection) {\r\n    // 删除当前段落\r\n    newList.splice(index, 1);\r\n  } else {\r\n    // 更新原段落\r\n    newList[index].content = beforeContent || ''\r\n    newList[index].word_total = beforeContent.length || 0\r\n\r\n    // 插入剩余内容段落\r\n    if (afterContent.trim()) {\r\n      newList[index].content += afterContent || ''\r\n      newList[index].word_total += afterContent.length || 0\r\n    }\r\n  }\r\n\r\n  paragraphLists.value = newList\r\n\r\n  // 这里直接调用保存接口/manage/saveLibFileSplit\r\n  handleSaveLibFileSplit(newList, index)\r\n}\r\n\r\nfunction formatList (array, keys, renameMap = {}, index) {\r\n  let sourceNumber = index + 1  // 索引从0开始\r\n  if (!Array.isArray(array) || !Array.isArray(keys)) {\r\n    return JSON.stringify([]);\r\n  }\r\n  const newArray = array.map((originalObj, originalIndex) => {\r\n      const newObj = {};\r\n      for (const key of keys) {\r\n        const sourceKey = renameMap[key] || key;\r\n        const sourceValue = originalObj[sourceKey];\r\n\r\n        if (!Object.prototype.hasOwnProperty.call(originalObj, sourceKey)) continue;\r\n\r\n        if (key === 'number') {\r\n          newObj[key] = originalIndex + 1;\r\n        } else if (key === 'father_chunk_paragraph_number') {\r\n          newObj[key] = +sourceValue;\r\n        }else if (key === 'page_num' || key === 'word_total') {\r\n          newObj[key] = +sourceValue;\r\n        } else if (key === 'content') {\r\n          if (!sourceValue) return null;\r\n          newObj[key] = sourceValue;\r\n        } else if (key === 'images') {\r\n          if (splitType.value == 1) {\r\n            // 单独分段\r\n            // 是否全选\r\n            if (isFullSelectionRef.value) {\r\n              // 全选最终的数据长度不会改变，因为全选的源数据被删除，然后新插入数据体\r\n              if (sourceNumber == newObj.number) {\r\n                // 如果之前的数据有图片，还是携带\r\n                newObj[key] = sourceValue\r\n              } else {\r\n                // 其他的数据该有图片就有，没有就没有保持原样\r\n                newObj[key] = sourceValue\r\n              }\r\n            } else {\r\n              // 不是全选最终数据长度会加1\r\n              if (sourceNumber + 1 == newObj.number) {\r\n                newObj[key] = []\r\n              } else {\r\n                newObj[key] = sourceValue\r\n              }\r\n            }\r\n          } else if (splitType.value == 2) {\r\n            // 2合并到下一分段\r\n            // 是否全选\r\n            if (isFullSelectionRef.value) {\r\n              // 全选最终的数据长度-1，因为全选的源数据被删除，然后修改了下一分段的内容\r\n              if (sourceNumber == newObj.number) {\r\n                newObj[key] = sourceValue\r\n              } else {\r\n                newObj[key] = sourceValue\r\n              }\r\n            } else {\r\n              // 不是全选最终数据不会发生改变\r\n              if (sourceNumber == newObj.number) {\r\n                newObj[key] = sourceValue\r\n              } else {\r\n                newObj[key] = sourceValue\r\n              }\r\n            }\r\n          } else if (splitType.value == 3) {\r\n            // 3合并到上一分段\r\n            // 是否全选\r\n            if (isFullSelectionRef.value) {\r\n              // 全选最终的数据长度-1，因为全选的源数据被删除，然后修改了下一分段的内容\r\n              if (sourceNumber - 1 == newObj.number) {\r\n                newObj[key] = sourceValue\r\n              } else {\r\n                newObj[key] = sourceValue\r\n              }\r\n            } else {\r\n              // 不是全选最终数据不会发生改变\r\n              if (sourceNumber == newObj.number) {\r\n                newObj[key] = sourceValue\r\n              } else {\r\n                newObj[key] = sourceValue\r\n              }\r\n            }\r\n          } else if (splitType.value == 4) {\r\n            // 4删除\r\n            // 是否全选\r\n            if (isFullSelectionRef.value) {\r\n              // 全选最终的数据长度-1，因为全选的源数据被删除\r\n              newObj[key] = sourceValue\r\n            } else {\r\n              // 不是全选最终数据不会发生改变\r\n              newObj[key] = sourceValue\r\n            }\r\n          }\r\n        } else {\r\n          newObj[key] = sourceValue;\r\n        }\r\n      }\r\n      return newObj;\r\n    })\r\n    .filter(obj => obj !== null && (obj.content !== undefined && obj.content !== ''));\r\n\r\n  return JSON.stringify(newArray);\r\n}\r\n\r\nconst renameMap = {\r\n  similar_question_list: 'similar_questions' // 新属性名: 旧属性名\r\n};\r\n\r\nconst handleSaveLibFileSplit = async (documentFragmentList, index) => {\r\n  // 如果右侧的数据不是当前保存选中的分段类型则清空内容重新分段\r\n  // 如果之前已经分段成功了，保存的时候不再另外分段了\r\n\r\n  let split_params = {\r\n    ...formData,\r\n    semantic_chunk_model_config_id: formData.semantic_chunk_model_config_id\r\n      ? +formData.semantic_chunk_model_config_id\r\n      : 0,\r\n    ai_chunk_model_config_id: formData.ai_chunk_model_config_id\r\n      ? +formData.ai_chunk_model_config_id\r\n      : 0,\r\n    is_table_file: settingMode.value\r\n  }\r\n\r\n  delete split_params.id\r\n\r\n  let parmas = {\r\n    id: route.query.id,\r\n    word_total: total.value,\r\n    split_params: JSON.stringify(split_params),\r\n    list: formatList(documentFragmentList, ['number', 'father_chunk_paragraph_number', 'page_num', 'title', 'content', 'question', 'similar_question_list', 'answer', 'word_total', 'images'], renameMap, index)\r\n  }\r\n\r\n  // 非表格的也需要存储qa_index_type\r\n  if (split_params.is_qa_doc == 1) {\r\n    // 表格类型 + QA文档\r\n    parmas.qa_index_type = split_params.qa_index_type\r\n  }\r\n\r\n  saveLoading.value = true\r\n\r\n  saveLibFileSplit(parmas)\r\n    .then((res) => {\r\n      message.success(t('msg_operation_success'))\r\n      // 后端返回的id替换成新的id\r\n      const newIds = res.data\r\n      for (let index = 0; index < newIds.length; index++) {\r\n        const item = newIds[index];\r\n        const pItem = paragraphLists.value[index]\r\n        if (index < paragraphLists.value.length) {\r\n          pItem.id = item.toString()\r\n          pItem.status = '0'\r\n          pItem.status_text = listStatusMap[pItem.status]\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    })\r\n    .finally(() => {\r\n      saveLoading.value = false\r\n    })\r\n}\r\n\r\nfunction showMetaModal() {\r\n  metaRef.value.show(true, metaList.value)\r\n}\r\n\r\nonMounted(() => {\r\n  getParagraphCountFn()\r\n  if (route.query.graph_status) {\r\n    filterData.graph_status = route.query.graph_status\r\n    search()\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.breadcrumb-block {\r\n  width: 100%;\r\n  position: relative;\r\n  height: 56px;\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  :deep(.ant-breadcrumb-link) {\r\n    display: inline-flex;\r\n  }\r\n\r\n  .library-line1 {\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    max-width: 180px;\r\n  }\r\n}\r\n\r\n.selct-star-box {\r\n  position: absolute;\r\n  top: 10px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n}\r\n.library-preview-page {\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  .page-loading-box {\r\n    flex: 1;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .document-title-block {\r\n    margin-bottom: 16px;\r\n    margin-top: 12px;\r\n    width: 100%;\r\n    height: 38px;\r\n    border-radius: 2px;\r\n    display: flex;\r\n    align-items: center;\r\n    color: #262626;\r\n    .anticon-left {\r\n      cursor: pointer;\r\n    }\r\n    .title {\r\n      font-weight: 600;\r\n      font-size: 14px;\r\n      line-height: 22px;\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n\r\n  .search-content-block{\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 16px;\r\n    justify-content: space-between;\r\n\r\n    .preview-box {\r\n      display: flex;\r\n      gap: 10px;\r\n      color: #595959;\r\n      font-size: 14px;\r\n      font-style: normal;\r\n      font-weight: 400;\r\n      line-height: 22px;\r\n\r\n      .preview-box-icon {\r\n        margin-right: 8px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .pdf-view-box {\r\n    flex: 1;\r\n    display: flex;\r\n    overflow: hidden;\r\n    .view-content-wrap {\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      overflow: hidden;\r\n      position: relative;\r\n      transition: all 0.3s ease;\r\n\r\n      .pdf-mode-switch {\r\n        position: absolute;\r\n        top: 12px;\r\n        left: 12px;\r\n        z-index: 999;\r\n      }\r\n      .segmentation-btn {\r\n        position: absolute;\r\n        right: 36px;\r\n        top: 12px;\r\n        z-index: 999;\r\n      }\r\n\r\n      .scroll-box {\r\n        flex: 1;\r\n        margin-right: 24px;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n      }\r\n      .view-content-box {\r\n        padding: 12px 32px 24px;\r\n        .list-item {\r\n          cursor: pointer;\r\n          padding: 6px 8px;\r\n          border-radius: 4px;\r\n          border: 1px solid #fff;\r\n          transition: all 0.3s;\r\n          &:hover {\r\n            background: #eee;\r\n            border: 1px solid #e0e0e0;\r\n          }\r\n        }\r\n        .content-box {\r\n          color: #333;\r\n          font-size: 14px;\r\n          font-weight: 400;\r\n          line-height: 22px;\r\n          margin-top: 4px;\r\n          white-space: pre-wrap;\r\n          word-wrap: break-word;\r\n        }\r\n        .fragment-img {\r\n          display: flex;\r\n          gap: 8px;\r\n          align-items: baseline;\r\n          flex-wrap: wrap;\r\n          img {\r\n            max-width: 100%;\r\n            max-height: 100%;\r\n            width: auto;\r\n            height: fit-content;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .view-content-wrap.collapsed {\r\n      width: 0;\r\n      opacity: 0;\r\n      flex: 0;\r\n      transform: translateX(-100%);\r\n    }\r\n\r\n    .right-contnt-box {\r\n      flex: 1;\r\n      overflow: hidden;\r\n      transition: all 0.3s ease;\r\n    }\r\n  }\r\n\r\n  ::v-deep(.bscroll-vertical-scrollbar) {\r\n    z-index: 999 !important;\r\n  }\r\n}\r\n.custom-select-box {\r\n  border: 1px solid #d9d9d9;\r\n  border-radius: 4px;\r\n  > span {\r\n    white-space: nowrap;\r\n  }\r\n  :deep(.ant-select-selector) {\r\n    border: none !important;\r\n    padding-left: 0 !important;\r\n    height: unset !important;\r\n  }\r\n  padding-left: 8px;\r\n}\r\n@keyframes flash-border {\r\n  0%,\r\n  100% {\r\n    background: transparent;\r\n  }\r\n  50% {\r\n    background: #c8d9f4;\r\n  }\r\n}\r\n\r\n.flash-border {\r\n  background: #c8d9f4;\r\n  animation: flash-border 1s infinite; /* 持续时间1秒，无限次重复 */\r\n}\r\n.mb8 {\r\n  margin-bottom: 8px;\r\n}\r\n</style>\r\n"],"names":["t","useI18n","emit","__emit","handleOpenEditModal","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_imports_0","_hoisted_2","_toDisplayString","_unref","_createVNode","_component_a_button","PlusOutlined","chartBox","ref","nvl","state","reactive","initialZoom","callbacks","init","options","container","NVL","zoomInteraction","ZoomInteraction","PanInteraction","zoomLevel","HoverInteraction","ClickInteraction","node","onZoomChange","value","add","nodes","edges","addAndUpdate","update","destroy","render","onMounted","__expose","ZoomToolbar","close","fromNodes","nextTick","_cache","CloseOutlined","_hoisted_3","CuScroll","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_component_svg_icon","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_Fragment","_renderList","item","_hoisted_16","show","mymodal","chartBoxRef","entityDetailsRef","loading","chartData","edgeMap","getData","getGraphData","getFileGraphInfo","res","edgeSet","key","reverseKey","e","toNodes","data","edge","err","onNodeClick","edgeIds","i","handleCancel","handleOk","_component_a_modal","$event","_component_a_spin","EntityDetails","route","useRoute","props","__props","renderMath","useMathJax","toReSegmentationPage","index","id","title","content","question","answer","images","category_id","similar_questions","Modal","resolve","editParagraph","hanldleDelete","createVNode","ExclamationCircleOutlined","deleteParagraph","message","handleToTargetPage","event","handleClickOutside","onReSegment","startLists","getCategoryLists","params","getCategoryList","classificationMarkModalRef","handleOpenSetStartModal","getColor","type","_a","colorLists","handleSetCategory","star","updateParagraphCategory","graphModelRef","openGraphModel","containerRef","showBubble","position","selectedText","selectedRange","selectedData","bubbleStyle","computed","bubbleWidth","left","top","containerRect","viewportWidth","containerLeft","containerTop","handleMouseUp","parentIndex","selection","selectedTextContent","rect","contentRect","handleAction","action","separateParagraph","mergeWithNext","mergeWithPrevious","onDeleteParagraph","splitHtmlContent","startOffset","endOffset","walker","count","startNode","endNode","startIndex","endIndex","length","range","beforeRange","afterRange","getRangeHtml","div","tempDiv","beforeContent","selectedContent","afterContent","isEmptyBefore","isEmptyAfter","getIsNeedDashedLine","preItem","textToHighlight","fullText","highlightText","highlightClass","caseSensitive","wholeWord","flags","regexPattern","escapeRegExp","match","string","onUnmounted","_createTextVNode","_normalizeClass","_normalizeStyle","_createBlock","LoadingOutlined","_component_a_tooltip","ExclamationCircleFilled","_component_a_dropdown","_component_a_menu","_component_a_menu_item","_withModifiers","StarFilled","SettingOutlined","StarOutlined","SyncOutlined","_hoisted_18","_hoisted_19","_hoisted_17","MoreOutlined","_hoisted_20","_hoisted_22","_withDirectives","_hoisted_25","imageIndex","ClassificationMarkModal","GraphModel","tooltipStr","name","is_table_file","is_qa_doc","is_diy_split","question_lable","answer_lable","separators","chunk_size","chunk_overlap","question_column","answer_column","qa_index_type","doc_type","qa_type_str","visible","formState","open","doc_auto_renew_frequency","editLibFile","_component_a_form","_component_a_form_item","_component_a_select","_component_a_select_option","scrollRef","visiblePages","totalPages","getItemStyle","scrollbar","pdf","VuePdfEmbed","loadMore","callback","current","nextPages","onScrollEnd","pdfRendered","page","clickPage","getScrollInstance","handleScroll","defaultAiChunkPrumpt","libraryStore","useLibraryStore","setInitDocumentFragmentList","spinning","settingMode","itWasEdited","current_chunk_type","formData","segmentationSettingRef","onChangeSetting","getDocumentFragment","maxLoopNumber","loopNumber","libFileInfo","library_type","getDocumentStatus","getLibFileInfo","status","getExcelQaTitle","excellQaLists","getLibFileExcelTitle","datas","initDocumentFragmentList","isAiSave","aiLoading","task_id","error","timer","documentFragmentList","documentFragmentTotal","isEmpty","requiredUrl","getLibFileSplit","getSplitParagraph","startPolling","onChangeChunkType","chunk_type","pollData","getAiDocumentFragment","formatError","errorStr","executePoll","handleSaveLibFileSplit","errorText","getLibFileSplitAiChunks","editFragmentAlertRef","editFragmentIndex","handleEditFragment","saveFragment","handleDeleteFragment","validateMessage","onValidate","saveLoading","updataFormData","formatWoedTotal","arr","num","split_params","parmas","saveSplitParagraph","handleScrollToErrorDom","previewBoxRef","fragmentElements","SegmentationSetting","Empty","DocumentFragment","EditFragmentAlert","companyStore","useCompanyStore","ali_ocr_switch","query","router","useRouter","settingModal","modalTitle","analysisLists","onClose","isLoading","handleLoading","onGoSwitch","handleChangeAnalysis","confirmLoading","handleSaveType","restudyLibraryFile","documentSegmentationModalRef","handleSaveSegmentation","handleSaveOk","handleFinish","DocumentSegmentationModal","reject","_component_a_table","_component_a_table_column","_withCtx","record","ClockCircleFilled","CheckCircleFilled","CloseCircleFilled","_hoisted_23","_hoisted_24","getListStatusMap","currentData","neo4j_status","metaRef","isCollapsed","pdfRef","pdfLoadedPage","pdfTotalPage","graphStatusMap","getStatrList","userStore","useUserStore","isTableType","detailsInfo","paragraphLists","metaList","filterData","pdfPreviewMode","getFileUrl","goBack","leftScrollRef","rightScrollRef","lastIndex","handleClickItem","elClass","el","pageLoading","paginations","paragraphInfo","total","listStatusMap","totalData","generalListStatusMap","getParagraphLists","getParagraphCountFn","getParagraphCount","onSaveModal","search","handleCategoryChange","getParagraphList","list","isExcelQa","_b","handleConvert","updataList","setIntervalUpStatus","handleEditParagraph","lists","lastItem","handleDelParagraph","editSubscriptionRef","openEditSubscription","updateFrequencyRef","reEmbeddingVectors","reconstructVector","reExtractingGraph","reconstructGraph","renameModalRef","handleRenameModal","reSegment","showUpdateFrequen","saveFrequency","handleSaveNameOk","file_name","pdfPageSelect","link","checkLoadFinished","pdfPageRendered","paragraphPosition","getPageEl","currentPdfPage","pdfHeight","getTotalPage","pdfPageOnScroll","y","reSegmentationPageRef","segmentationSettingModalRef","handleSegmentationMenuClick","handleSegmentation","handleeEableScroll","handleReSegmentationPageOk","toggleCollapse","createNewParagraph","newItem","isFullSelectionRef","splitType","handleSplit","isFullSelection","newList","handleSplitNext","oldWord_total","handleSplitUp","handleSplitDelete","formatList","array","keys","renameMap","sourceNumber","newArray","originalObj","originalIndex","newObj","sourceKey","sourceValue","obj","saveLibFileSplit","newIds","pItem","showMetaModal","_component_a_breadcrumb","_component_a_breadcrumb_item","_component_router_link","SelectStarBox","LeftOutlined","SegmentationMode","_component_a_space","_component_a_input","DownOutlined","QaSubsectionBox","SubsectionBox","_component_a_radio_group","_component_a_radio_button","_c","PdfPreview","_hoisted_21","_component_a_tabs","_component_a_tab_pane","EditSubscription","UpdateFrequency","RenameModal","ReSegmentationPage","SegmentationSettingModal","MetadataManageModal"],"mappings":"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"}