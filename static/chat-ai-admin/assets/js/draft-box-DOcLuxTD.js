import{_ as et}from"./cu-scroll-D9utH_KS.js";import{_ as tt,bh as ot,bi as st,d as at}from"../../index-CB2DywzJ.js";import{f as i,w as Q,e as Z,r as W,o as nt,b as lt,y as ee,ac as d,as as s,k as a,ah as it,ai as D,az as L,ar as n,ad as l,u as C,B as M,F as U,ax as N,at as m,ae as we,G as te}from"./vue-chunks-CGLjTDrY.js";import{_ as dt}from"./empty-BFmzY9bl.js";import{_ as ut}from"./default-cover-Bm8pZ2KF.js";import{aq as ct,ao as Ce,ar as rt,as as pt,at as vt,au as _t}from"./index-CoChppVN.js";import{a as ft}from"./create-send-modal-DBxOE0Nh.js";import{v as mt,I as gt,M as Se,a6 as ze,a0 as Oe,k as ht,ar as Me,h as yt,i as kt,ae as xt,B as bt,az as wt,V as Ct,al as St,bC as zt,T as Ot,y as Mt,z as It,aI as Gt,b as g,W as Dt}from"./ui-antd-BHaxN-GS.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-CSfpjqgw.js";import"./utils-pAinW4BS.js";import"./other-BrZCAsTs.js";const Lt={class:"official-draft-wrapper"},Ut={class:"qa-list-wrapper"},Rt={class:"group-head-box"},Bt={class:"head-title"},Et={class:"flex-between-box"},$t={class:"search-box"},Ht={class:"classify-box"},Tt=["onClick"],Wt={class:"classify-title"},Nt={class:"right-content"},Kt={key:0,class:"btn-box"},Vt={class:"hover-btn-wrap"},Pt=["onClick"],Xt=["onClick"],jt={class:"head-content"},qt={class:"toolbar"},Ft={key:0,class:"title"},Yt={class:"pover-group-content-box"},At={class:"group-head-box"},Jt={class:"head-title"},Qt={class:"flex-between-box"},Zt={class:"search-box"},eo={class:"classify-box classify-scroll-box"},to=["onClick"],oo={class:"classify-title"},so={class:"right-content"},ao={key:0,class:"btn-box"},no={class:"hover-btn-wrap"},lo=["onClick"],io=["onClick"],uo={class:"header-row"},co={class:"content-block"},ro={key:0,class:"loading-box"},po={key:0,class:"empty-box"},vo={key:1,class:"draft-list"},_o=["src"],fo={key:1,class:"thumb",src:ut},mo={class:"info"},go={class:"title"},ho={class:"meta"},yo={class:"digest"},ko={class:"extra"},xo={class:"pagination-box"},bo={class:"sync-modal"},wo={class:"sync-select-box"},Ie="official_draft_group_box_width",Ge="official_draft_group_hide_key",K=180,oe=256,Co={__name:"draft-box",props:{appId:{type:String,default:""},accessKey:{type:String,default:""}},setup(V){const h=V,se=i(null),ae=i(null),P=i(0),R=i(!1);Q(()=>h.appId,()=>{c.value.page=1,h.appId&&me()});const S=i([]),I=i(""),z=i(-1),ne=Z(()=>S.value.filter(o=>(o.group_name||"").includes(I.value))),X=async()=>{let e=(await ct()).data||[];S.value=e.map(u=>({...u,total:0})),await j(),r()},j=async()=>{const o=h.appId,e=S.value.map(async u=>{var w;const p=await Ce({page:1,size:1,app_id:o,group_id:u.id}),b=((w=p==null?void 0:p.data)==null?void 0:w.total)||0;u.total=b});await Promise.all(e)},B=(o={})=>{y.id=o.id||0,y.group_name=o.group_name||"",E.value=!0},E=i(!1),y=W({id:0,group_name:""}),De=async()=>{if(!y.group_name)return g.error("请输入分组名称");await pt({id:y.id,group_name:y.group_name}),E.value=!1,g.success("操作成功"),await X()},le=o=>{Se.confirm({title:`确认删除分组：${o.group_name}`,icon:a(Dt),content:"",okText:"确认",cancelText:"取消",onOk:async()=>{await rt({id:o.id}),await X(),g.success("操作成功"),z.value==o.id&&(z.value=-1,await O())}})},ie=o=>{z.value=o.id,Be()},k=i([]),q=i(!1),de=i(0),c=i({page:1,size:20}),Le=W({title:""}),ue=()=>Object.keys(v).filter(o=>v[o]),v=W({}),Ue=Z(()=>ue().length),ce=Z({get(){return k.value.length>0&&k.value.every(o=>!!v[o.id])},set(o){k.value.forEach(e=>{v[e.id]=o})}}),Re=()=>{Object.keys(v).forEach(o=>delete v[o])};Q(k,()=>{ee(r)},{deep:!0}),Q(S,()=>{ee(r)},{deep:!0});const O=async()=>{q.value=!0;const o=await Ce({page:c.value.page,size:c.value.size,title:Le.title,app_id:h.appId,group_id:z.value}),e=(o==null?void 0:o.data)||{};k.value=e.list||[],de.value=e.total||0,q.value=!1,Re(),r()},Be=()=>{c.value.page=1,O()},Ee=(o,e)=>{c.value.page=o,c.value.size=e,O()},$e=()=>{const o=ue();if(o.length===0)return g.error("请选择你要移动的草稿");x.ids=o.join(","),x.group_id=void 0,$.value=!0},He=()=>{$e()},F=i(null),Te=o=>{F.value&&F.value.show({draft:o})},$=i(!1),x=W({group_id:void 0,ids:""}),We=async()=>{if(!x.group_id)return g.error("请选择分组");await vt({draft_id:x.ids,group_id:x.group_id,app_id:h.appId}),$.value=!1,g.success("移动成功"),await O(),await j()},G=i(K),_=i(localStorage.getItem(Ge)==1),Y=i(!1);nt(()=>{ot();const o=parseInt(localStorage.getItem(Ie));o&&o>=K&&o<=oe&&(G.value=o),h.appId&&me(),window.addEventListener("resize",r)}),lt(()=>{window.removeEventListener("resize",r),st()});const re=()=>{_.value=!_.value,localStorage.setItem(Ge,_.value?1:2),r()};let H=!1,pe=0,ve=0;const Ne=o=>{_.value||(H=!0,Y.value=!0,pe=o.clientX,ve=G.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",_e),document.addEventListener("mouseup",fe))},_e=o=>{if(!H)return;let e=ve+(o.clientX-pe);e=Math.max(K,Math.min(oe,e)),G.value=e},fe=()=>{H&&(H=!1,Y.value=!1,localStorage.setItem(Ie,G.value),document.body.style.cursor="",document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",fe),r())},me=async()=>{await X(),await O(),r()},r=()=>{ee(()=>{const o=se.value,e=ae.value;if(!o||!e)return;const u=o.style.height;o.style.height="auto";const p=o.scrollHeight||o.offsetHeight||0;o.style.height=u;const b=e.scrollHeight||e.offsetHeight||0;P.value=Math.max(p,b)})},ge=o=>{const e=S.value.find(u=>u.id==o);return e?e.group_name:o==0?"未分组":""},Ke=()=>{g.success("创建群发任务成功")},T=i(!1),A=i(0),Ve={0:"前100条",1:"前200条",2:"前1000条",3:"全部"},Pe=[100,200,1e3,0],Xe=()=>{T.value=!0},je=async()=>{const o=Pe[A.value]||0;R.value=!0,await _t({access_key:h.accessKey,limit:o}),R.value=!1,g.success("已提交同步任务，稍后刷新查看"),T.value=!1,setTimeout(()=>{O(),j()},800),setTimeout(()=>{r()},1e3)};return(o,e)=>{const u=at,p=mt,b=gt,w=kt,he=yt,ye=ht,ke=et,qe=xt,xe=bt,be=Ct,Fe=St,Ye=zt,J=Se,Ae=It,Je=Mt,Qe=Ot,Ze=Gt;return l(),d("div",Lt,[s("div",Ut,[s("div",{class:D(["group-content-box",[{collapsed:_.value},{"no-transition":Y.value}]]),ref_key:"groupContentRef",ref:se,style:it(_.value?{}:{width:G.value+"px",minWidth:K+"px",maxWidth:oe+"px",height:P.value?P.value+"px":void 0})},[s("div",Rt,[s("div",Bt,[a(p,{title:"收起分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(u,{name:"put-away"})])]),_:1}),s("div",Et,[e[15]||(e[15]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[0]||(e[0]=t=>B({}))},[a(C(ze))])]),_:1})])]),s("div",$t,[a(b,{value:I.value,"onUpdate:value":e[2]||(e[2]=t=>I.value=t),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(Oe),{onClick:e[1]||(e[1]=M(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",Ht,[a(ke,{style:{"padding-right":"24px"}},{default:n(()=>[(l(!0),d(U,null,N(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==z.value}]),onClick:f=>ie(t),key:t.id},[s("div",Wt,m(t.group_name),1),s("div",Nt,[s("div",{class:D(["num",{"num-block":t.id<=0}])},m(t.total),3),t.id>0?(l(),d("div",Kt,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:M(f=>B(t),["stop"])},"重命名",8,Pt)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:M(f=>le(t),["stop"])},"删 除",8,Xt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",Vt,[a(C(Me))])]),_:2},1024)])):L("",!0)])],10,Tt))),128))]),_:1})]),_.value?L("",!0):(l(),d("div",{key:0,class:"resize-bar",onMousedown:Ne},null,32))],6),s("div",{class:"main-content-box",ref_key:"mainContentRef",ref:ae},[a(ke,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:n(()=>[s("div",jt,[s("div",qt,[_.value?(l(),d("div",Ft,[a(qe,{title:null,placement:"bottom"},{content:n(()=>[s("div",Yt,[s("div",At,[s("div",Jt,[s("div",Qt,[e[16]||(e[16]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[3]||(e[3]=t=>B({}))},[a(C(ze))])]),_:1})])]),s("div",Zt,[a(b,{allowClear:"",value:I.value,"onUpdate:value":e[5]||(e[5]=t=>I.value=t),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(Oe),{onClick:e[4]||(e[4]=M(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",eo,[(l(!0),d(U,null,N(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==z.value}]),onClick:f=>ie(t),key:t.id},[s("div",oo,m(t.group_name),1),s("div",so,[s("div",{class:D(["num",{"num-block":t.id<=0}])},m(t.total),3),t.id>0?(l(),d("div",ao,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:M(f=>B(t),["stop"])},"重命名",8,lo)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:M(f=>le(t),["stop"])},"删 除",8,io)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",no,[a(C(Me))])]),_:2},1024)])):L("",!0)])],10,to))),128))])])]),default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(u,{name:"expand"})])]),_:1})])):L("",!0),a(xe,{type:"primary",onClick:Xe,loading:R.value},{default:n(()=>[R.value?L("",!0):(l(),we(C(wt),{key:0})),e[17]||(e[17]=te("同步草稿 ",-1))]),_:1},8,["loading"]),a(xe,{disabled:Ue.value===0,onClick:He},{default:n(()=>[...e[18]||(e[18]=[te("批量分组",-1)])]),_:1},8,["disabled"])]),s("div",uo,[a(be,{checked:ce.value,"onUpdate:checked":e[6]||(e[6]=t=>ce.value=t)},null,8,["checked"]),e[19]||(e[19]=s("span",{class:"header-text"},"内容",-1))])]),s("div",co,[q.value?(l(),d("div",ro,[a(Fe)])):(l(),d(U,{key:1},[k.value.length===0?(l(),d("div",po,[...e[20]||(e[20]=[s("img",{src:dt},null,-1),s("div",{class:"title"},"暂无草稿",-1)])])):(l(),d("div",vo,[(l(!0),d(U,null,N(k.value,t=>(l(),d("div",{class:"draft-item",key:t.id},[a(be,{checked:v[t.id],"onUpdate:checked":f=>v[t.id]=f},null,8,["checked","onUpdate:checked"]),t.thumb_url?(l(),d("img",{key:0,class:"thumb",src:t.thumb_url},null,8,_o)):(l(),d("img",fo)),s("div",mo,[s("div",go,m(t.title),1),s("div",ho,"所属分组："+m(ge(t.group_id)),1),s("div",yo,m(t.digest),1)]),s("div",ko,[a(u,{name:"group-send",class:"icon",onClick:f=>Te(t),style:{"font-size":"32px",cursor:"pointer",color:"transparent"}},null,8,["onClick"])])]))),128))])),s("div",xo,[a(Ye,{current:c.value.page,"onUpdate:current":e[7]||(e[7]=t=>c.value.page=t),"page-size":c.value.size,"onUpdate:pageSize":e[8]||(e[8]=t=>c.value.size=t),total:de.value,pageSizeOptions:["10","20","50","100"],"show-size-changer":"",onChange:Ee},null,8,["current","page-size","total"])])],64))])]),_:1})],512)]),a(J,{open:E.value,"onUpdate:open":e[10]||(e[10]=t=>E.value=t),title:"添加分组",onOk:De},{default:n(()=>[e[21]||(e[21]=s("div",{style:{margin:"32px 0 4px"}},"分组名称：",-1)),a(b,{value:y.group_name,"onUpdate:value":e[9]||(e[9]=t=>y.group_name=t),placeholder:"请输入分组名称",style:{"margin-bottom":"20px"}},null,8,["value"])]),_:1},8,["open"]),a(J,{open:$.value,"onUpdate:open":e[12]||(e[12]=t=>$.value=t),title:"批量移动分组",onOk:We},{default:n(()=>[a(Qe,{align:"center",style:{margin:"24px 0"}},{default:n(()=>[e[22]||(e[22]=s("div",null,"移动到分组：",-1)),a(Je,{value:x.group_id,"onUpdate:value":e[11]||(e[11]=t=>x.group_id=t),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(l(!0),d(U,null,N(S.value.filter(t=>t.id>0),t=>(l(),we(Ae,{key:t.id,value:t.id},{default:n(()=>[te(m(t.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),a(ft,{ref_key:"createSendModalRef",ref:F,"app-id":V.appId,"access-key":V.accessKey,"get-group-name":ge,onCreated:Ke},null,8,["app-id","access-key"]),a(J,{open:T.value,"onUpdate:open":e[14]||(e[14]=t=>T.value=t),title:"同步草稿箱",width:478,onOk:je},{default:n(()=>[s("div",bo,[e[23]||(e[23]=s("div",{class:"sync-desc-box"}," 由于微信限制了草稿箱每日同步接口次数，为防止同步草箱时出现接口超限的情况，您可以根据个人业务选择草稿箱的同步条数 ",-1)),e[24]||(e[24]=s("div",{class:"sync-select-title"},"选择同步条数",-1)),s("div",wo,[a(Ze,{min:0,max:3,step:null,value:A.value,"onUpdate:value":e[13]||(e[13]=t=>A.value=t),marks:Ve,tooltipOpen:!1},null,8,["value"])])])]),_:1},8,["open"])])}}},Ho=tt(Co,[["__scopeId","data-v-c6e5985e"]]);export{Ho as default};
