import{b as be,e1 as Ce,d as Le,e2 as Ze,M as Ue,c$ as Qe,e3 as Ne,e4 as Ee,e5 as et,e0 as ve,k as ce,E as tt,e6 as Te,e7 as nt,e8 as ot}from"../../index-Bo1NSLpy.js";import{c as me,N as T,F as ne,a1 as we,O as D,a6 as re,u as Y,a5 as V,X as d,j as f,_ as J,d as R,b as te,q as Be,S as de,U as m,G as lt,Z as ee,a0 as B,x as ye,a3 as at,w as _e,H as it,I as st,Y as Re,a7 as ct,a2 as rt,p as dt}from"./vue-chunks-BRsu9_To.js";import{u as ut}from"./useCopyShareUrl-C-0X3aJW.js";import"./index-Bb6fuwF7.js";import{R as pt}from"./RadioButton-CWIeNl_M.js";import{_ as ft,a as vt}from"./index-Cps_2bsD.js";import{P as Me}from"./PlusOutlined-vSxn8uyP.js";import{M as mt,_ as _t}from"./index-Dxy-C30T.js";import"./index-BZOjzqJ2.js";import{D as yt}from"./dropdown-DAy60lp8.js";import"./index-Caod9rOO.js";import{I as ht}from"./Input-CCKFAS4o.js";import{M as bt}from"./MoreOutlined-BVPLZ6JB.js";import{C as kt}from"./CaretDownOutlined-C8EH_hS-.js";import{_ as gt}from"./index-B4MPC5xv.js";import{_ as Dt}from"./index-C_M0mW4F.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./index-C0kilmAu.js";import"./FormItemContext-Cv3f2sEj.js";import"./Checkbox-B_uQPvVs.js";import"./Col-QoogualX.js";import"./responsiveObserve-D3ho5cFZ.js";import"./shallowequal-C0xnIuy8.js";import"./Trigger-DtRTHvld.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-CVAZ5BEM.js";import"./index-BwedndIp.js";import"./Dropdown-hEIgqeS3.js";import"./RightOutlined-zEOifMPB.js";import"./move-DztQgbGg.js";import"./colors-4myZb9T8.js";import"./index-CuPJUS8f.js";import"./Search-BF8URtRh.js";import"./SearchOutlined-CFTHZIcT.js";import"./isPlainObject-CHj0iPA3.js";import"./inputProps--_pnbyjO.js";import"./TextArea--DLJ7VtX.js";import"./Password-CJww1n-s.js";import"./List-qVz67bUg.js";import"./CaretDownFilled-DQ5FyPd3.js";import"./index-BeCYXilq.js";var he={exports:{}},xt=he.exports,Ie;function Rt(){return Ie||(Ie=1,function(A,j){(function(S,_){_()})(xt,function(){function S(o,s){return typeof s>"u"?s={autoBom:!1}:typeof s!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function _(o,s,k){var r=new XMLHttpRequest;r.open("GET",o),r.responseType="blob",r.onload=function(){y(r.response,s,k)},r.onerror=function(){console.error("could not download file")},r.send()}function M(o){var s=new XMLHttpRequest;s.open("HEAD",o,!1);try{s.send()}catch{}return 200<=s.status&&299>=s.status}function C(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(s)}}var v=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof me=="object"&&me.global===me?me:void 0,b=v.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),y=v.saveAs||(typeof window!="object"||window!==v?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(o,s,k){var r=v.URL||v.webkitURL,u=document.createElement("a");s=s||o.name||"download",u.download=s,u.rel="noopener",typeof o=="string"?(u.href=o,u.origin===location.origin?C(u):M(u.href)?_(o,s,k):C(u,u.target="_blank")):(u.href=r.createObjectURL(o),setTimeout(function(){r.revokeObjectURL(u.href)},4e4),setTimeout(function(){C(u)},0))}:"msSaveOrOpenBlob"in navigator?function(o,s,k){if(s=s||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(S(o,k),s);else if(M(o))_(o,s,k);else{var r=document.createElement("a");r.href=o,r.target="_blank",setTimeout(function(){C(r)})}}:function(o,s,k,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof o=="string")return _(o,s,k);var u=o.type==="application/octet-stream",F=/constructor/i.test(v.HTMLElement)||v.safari,$=/CriOS\/[\d]+/.test(navigator.userAgent);if(($||u&&F||b)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var O=E.result;O=$?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=O:location=O,r=null},E.readAsDataURL(o)}else{var P=v.URL||v.webkitURL,q=P.createObjectURL(o);r?r.location=q:location.href=q,r=null,setTimeout(function(){P.revokeObjectURL(q)},4e4)}});v.saveAs=y.saveAs=y,A.exports=y})}(he)),he.exports}var wt=Rt();const Ct={class:"side-meuns"},Lt=["onClick"],St={class:"meun-item-body"},$t={class:"menu-name"},Et={__name:"side-menus",props:{menus:{type:Array,default:()=>[]},active:{type:String,default:""}},emits:["menuClick"],setup(A,{emit:j}){const S=j,_=Ce(),M=A,{checkPermission:C}=_,v=b=>{S("menuClick",b)};return(b,y)=>{const o=Le;return D(),T("div",Ct,[(D(!0),T(ne,null,we(M.menus,s=>(D(),T(ne,{key:s.key},[Y(C)(s.permissions)?(D(),T("div",{key:0,class:V(["side-meun-item",{active:s.key===M.active}]),onClick:k=>v(s)},[d("div",St,[f(o,{class:"menu-icon",name:s.icon},null,8,["name"]),d("span",$t,J(s.name),1)]),y[0]||(y[0]=d("div",{class:"actions-box"},null,-1))],10,Lt)):re("",!0)],64))),128))])}}},Tt=be(Et,[["__scopeId","data-v-629786e2"]]),Mt={__name:"upload-doc",emits:["file-loaded"],setup(A,{expose:j,emit:S}){const _=S,M=R(null);let C={};const v=y=>{C=y||{},M.value.click()},b=y=>{const o=y.target.files[0];if(!o)return;if(!o.name.endsWith(".md")){alert("请选择.md文件");return}const s=new FileReader;s.onload=k=>{_("file-loaded",{content:k.target.result,title:o.name,file:o,...C})},s.readAsText(o),y.target.value=null};return j({triggerUpload:v}),(y,o)=>(D(),T("input",{type:"file",style:{opacity:"0",position:"fixed",bottom:"-9999px",left:"-9999px"},ref_key:"fileInput",ref:M,onChange:b,accept:".md"},null,544))}},It={class:"icon-template-content"},At={class:"template-options"},Ot=["onClick"],Kt={class:"folder-icon"},Ut={class:"template-footer"},Bt={class:"template-name"},jt={__name:"icon-template",emits:["update:open","ok","cancel"],setup(A,{expose:j,emit:S}){const _=S,M=Ce(),{saveEditLibrary:C}=M,v=te(()=>M.libraryInfo),b=R(!1),y=R(!1),o=R([]),s=R("1"),k=()=>{s.value=v.value.icon_template_config_id,b.value=!0},r=$=>{s.value=$},u=()=>{b.value=!1,_("cancel")},F=()=>{let $=lt(v.value);$.icon_template_config_id=s.value,y.value=!0,C($).then(()=>{b.value=!1}).finally(()=>{y.value=!1,_("ok",s.value)})};return j({open:k}),Be(()=>{o.value=Ze()}),($,E)=>{const P=pt,q=vt,O=ft,W=Ue;return D(),de(W,{open:b.value,"onUpdate:open":E[0]||(E[0]=x=>b.value=x),title:"图标模板",width:760,onCancel:u,onOk:F,"confirm-loading":y.value},{default:m(()=>[d("div",It,[d("div",At,[f(O,{gutter:16},{default:m(()=>[(D(!0),T(ne,null,we(o.value,x=>(D(),de(q,{span:8,key:x.id},{default:m(()=>[d("div",{class:V(["template-card",{active:s.value==x.id}])},[d("div",{class:"template-preview",onClick:U=>r(x.id)},[(D(!0),T(ne,null,we(x.preview,U=>(D(),T("div",{class:V(["folder-item",["level-"+U.level]]),key:U.level},[d("span",Kt,J(U.icon),1),d("span",null,J(U.text),1)],2))),128))],8,Ot),d("div",Ut,[f(P,{checked:s.value==x.id,onClick:U=>r(x.id)},{default:m(()=>[d("span",Bt,J(x.name),1)]),_:2},1032,["checked","onClick"])])],2)]),_:2},1024))),128))]),_:1})])])]),_:1},8,["open","confirm-loading"])}}},Ft=be(jt,[["__scopeId","data-v-4381de58"]]),Pt={class:"side-directory"},qt={class:"directory-header"},Wt={class:"action-box"},Ht={class:"action-btn"},zt={class:"directory-body"},Xt={class:"directory-content"},Vt={style:{"margin-right":"4px"}},Gt={class:"action-btn toggle-btn"},Yt=["data-level"],Jt={key:0,class:"doc-icon"},Zt={key:1,class:"doc-icon"},Qt={class:"doc-title"},Nt={key:0,class:"doc-title-text"},en={key:2,class:"doc-action-box"},tn={__name:"side-directory",props:{list:{type:Array,default:()=>[]},loadData:{type:Function,default:()=>{}},selectedKeys:{type:Array,default:()=>[]},iconTemplateConfig:{type:Object,default:()=>({})},draggable:{type:Boolean,default:!0}},emits:["addDoc","importDoc","copyLink","copyDoc","deleteDoc","exportDoc","dragenter","drop","select","renameDoc","saveName"],setup(A,{expose:j,emit:S}){const _=S,M=A,C=(c,n)=>{let w=null;return function(...I){w&&clearTimeout(w),w=setTimeout(()=>{c.apply(this,I)},n)}},v=R([]),b=R([]),y=c=>{b.value.includes(c)||b.value.push(c)},o=(c,n)=>{const w=v.value.indexOf(c);typeof n=="boolean"?w>-1&&n===!1?v.value.splice(w,1):v.value.push(c):w>-1?v.value.splice(w,1):v.value.push(c)},s=c=>{v.value=[]},k=R(null),r=(c,n)=>{_("addDoc",c,n)};let u=null;const F=c=>{u=c,k.value.triggerUpload()},$=R(null),E=()=>{$.value.open()},P=c=>{_("selectTemplate",c)},q=c=>{_("importDoc",u,c)},O=c=>{_("copyLink",c)},W=c=>{_("copyDoc",c)},x=c=>{_("exportDoc",c)},U=c=>{_("renameDoc",c),ye(()=>{let n=document.querySelector(".rename-input-"+c.data.id);n&&(n.focus(),n.select())})},oe=C(c=>{let n=document.querySelector(".rename-input-"+c.data.id);if(!n)return;let w=n.value.trim();_("saveName",c,w)},200),X=c=>{_("deleteDoc",c)},ke=({dropNode:c,dragNode:n,dropPosition:w})=>c.is_dir==0&&n.is_dir==0&&w==0?!1:!(c.is_dir==0&&n.is_dir==1&&w==0),ue=c=>{_("dragenter",c)},ge=c=>{_("drop",c)},De=(c,n)=>{_("select",n.node.dataRef)};return j({toggleExpand:o,addLoadedKey:y}),(c,n)=>{const w=Le,I=_t,le=mt,ae=yt,pe=gt,xe=ht,ie=Dt;return D(),T("div",Pt,[d("div",qt,[f(w,{name:"doc-directory",style:{"font-size":"16px",color:"#595959"}}),n[12]||(n[12]=d("div",{class:"label-text"},"文档目录",-1)),d("div",Wt,[f(ae,null,{overlay:m(()=>[f(le,null,{default:m(()=>[f(I,{key:"addDir",onClick:n[0]||(n[0]=p=>r(null,0))},{default:m(()=>n[7]||(n[7]=[ee(" 添加文档 ")])),_:1,__:[7]}),f(I,{key:"importDoc",onClick:n[1]||(n[1]=p=>F())},{default:m(()=>n[8]||(n[8]=[ee(" 导入文档 ")])),_:1,__:[8]}),f(I,{key:"addDoc",onClick:n[2]||(n[2]=p=>r(null,1))},{default:m(()=>n[9]||(n[9]=[ee(" 添加文件夹 ")])),_:1,__:[9]})]),_:1})]),default:m(()=>[d("span",Ht,[f(Y(Me),{style:{color:"#595959"}})])]),_:1}),f(pe,null,{title:m(()=>n[10]||(n[10]=[ee("收起全部文档")])),default:m(()=>[d("span",{class:"action-btn",onClick:n[3]||(n[3]=p=>s(!1))},[f(w,{name:"menu-expand",style:{"font-size":"16px",color:"#595959"}})])]),_:1}),f(pe,null,{title:m(()=>n[11]||(n[11]=[ee("图标模板设置")])),default:m(()=>[d("span",{class:"action-btn",onClick:E},[f(w,{name:"system-setting",style:{"font-size":"16px",color:"#595959"}})])]),_:1})])]),d("div",zt,[d("div",Xt,[f(ie,{class:"directory-tree","block-node":"",expandedKeys:v.value,"onUpdate:expandedKeys":n[6]||(n[6]=p=>v.value=p),draggable:A.draggable,"selected-keys":A.selectedKeys,loadedKeys:b.value,"tree-data":M.list,"load-data":A.loadData,"field-names":{key:"id",title:"title",children:"children"},allowDrop:ke,onDragenter:ue,onDrop:ge,onSelect:De},{switcherIcon:m(({switcherCls:p})=>[d("div",Vt,[d("span",Gt,[f(Y(kt),{style:{"font-size":"12px"},class:V(p)},null,8,["class"])])])]),title:m(p=>[d("div",{class:V(["doc-item",[{"is-leaf":p.dataRef.isLeaf},p.dataRef.isEdit?"is-edit":"no-edit"]]),"data-level":p.level},[p.data.doc_icon?(D(),T("span",Jt,J(p.data.doc_icon),1)):(D(),T("span",Zt,J(p.data.is_dir==1?A.iconTemplateConfig.levels[p.level].folder_icon:A.iconTemplateConfig.levels[p.level].doc_icon),1)),d("div",Qt,[p.dataRef.isEdit?(D(),de(xe,{key:1,class:V([`rename-input-${p.dataRef.id}`]),name:"rename",defaultValue:p.dataRef.title,placeholder:"请输入标题",onBlur:K=>Y(oe)(p),onPressEnter:K=>Y(oe)(p)},null,8,["class","defaultValue","onBlur","onPressEnter"])):(D(),T("span",Nt,J(p.dataRef.title),1))]),p.dataRef.isEdit?re("",!0):(D(),T("div",en,[p.dataRef.is_dir==1?(D(),de(ae,{key:0},{overlay:m(()=>[f(le,null,{default:m(()=>[f(I,{key:"addDir",onClick:B(K=>r(p,0),["stop","prevent"])},{default:m(()=>n[13]||(n[13]=[d("span",{class:"menu-name"},"添加文档",-1)])),_:2,__:[13]},1032,["onClick"]),f(I,{key:"importDoc",onClick:B(K=>F(p),["stop","prevent"])},{default:m(()=>n[14]||(n[14]=[d("span",{class:"menu-name"},"导入文档",-1)])),_:2,__:[14]},1032,["onClick"]),f(I,{key:"addDoc",onClick:B(K=>r(p,1),["stop","prevent"])},{default:m(()=>n[15]||(n[15]=[d("span",{class:"menu-name"},"添加文件夹",-1)])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),default:m(()=>[d("span",{class:"action-btn",onClick:n[4]||(n[4]=B(()=>{},["stop"]))},[f(Y(Me))])]),_:2},1024)):re("",!0),f(ae,null,{overlay:m(()=>[f(le,null,{default:m(()=>[p.dataRef.is_dir==1?(D(),T(ne,{key:0},[f(I,{key:"rename",onClick:B(K=>U(p),["stop","prevent"])},{default:m(()=>n[16]||(n[16]=[d("span",{class:"menu-name"},"重命名",-1)])),_:2,__:[16]},1032,["onClick"]),f(I,{key:"deleteDoc",onClick:B(K=>X(p),["stop","prevent"])},{default:m(()=>n[17]||(n[17]=[d("span",{class:"menu-name"},"删除",-1)])),_:2,__:[17]},1032,["onClick"])],64)):(D(),T(ne,{key:1},[f(I,{key:"copyLink",onClick:B(K=>O(p),["stop","prevent"])},{default:m(()=>n[18]||(n[18]=[ee(" 复制链接"),d("span",{class:"menu-name"},null,-1)])),_:2,__:[18]},1032,["onClick"]),f(I,{key:"copyDoc",onClick:B(K=>W(p),["stop","prevent"])},{default:m(()=>n[19]||(n[19]=[d("span",{class:"menu-name"},"复制文档",-1)])),_:2,__:[19]},1032,["onClick"]),f(I,{key:"exportDoc",onClick:B(K=>x(p),["stop","prevent"])},{default:m(()=>n[20]||(n[20]=[d("span",{class:"menu-name"},"导出文档",-1)])),_:2,__:[20]},1032,["onClick"]),f(I,{key:"deleteDoc",onClick:B(K=>X(p),["stop","prevent"])},{default:m(()=>n[21]||(n[21]=[d("span",{class:"menu-name"},"删除文档",-1)])),_:2,__:[21]},1032,["onClick"])],64))]),_:2},1024)]),default:m(()=>[d("span",{class:"action-btn",onClick:n[5]||(n[5]=B(()=>{},["stop"]))},[f(Y(bt))])]),_:2},1024)]))],10,Yt)]),_:1},8,["expandedKeys","draggable","selected-keys","loadedKeys","tree-data","load-data"])])]),f(Mt,{ref_key:"uploadDocRef",ref:k,onFileLoaded:q},null,512),f(Ft,{ref_key:"iconTemplateRef",ref:$,onSelect:P},null,512)])}}},nn=be(tn,[["__scopeId","data-v-de41f716"]]),on={class:"public-library-layout"},ln={class:"layout-left-wrapper"},an={class:"layout-left-content"},sn={key:1,class:"side-directory-wrapper"},cn={class:"layout-body"},Ae="public-library-sidebar-width",Oe="public-library-sidebar-collapsed",Ke=0,rn={__name:"index",setup(A){const j=(e,t)=>{const a=new Blob([e],{type:"text/markdown;charset=utf-8"});wt.saveAs(a,t)},S=(e,t)=>{{for(let a=0;a<e.length;a++){const l=e[a];if(l.id==t)return l;if(l.children){const i=S(l.children,t);if(i)return i}}return null}},_=(e,t,a=null)=>{for(let l=0;l<e.length;l++){const i=e[l];if(i.id==t)return a;if(i.children){const h=_(i.children,t,i);if(h)return h}}return null};function M(e="无标题文档",t=[]){const a=new Set(t.map(h=>h.title));let l=1,i=`${e}(${l})`;for(;a.has(i);)l++,i=`${e}(${l})`;return i}const C=Ce(),v=rt(),b=at(),y=te(()=>C.library_id),o=te(()=>C.library_key),s=te(()=>C.iconTemplateConfig),k=te(()=>b.query.doc_id),r=R(null),u=R([]),F=R(!0),$=R([]),E=R(null),P=te(()=>b.meta.subActiveMenu||""),{setStorage:q,getStorage:O}=Qe("localStorage"),W=R(O(Ae)||256),x=R(O(Oe)||!1),U=R(0),oe=R(0),X=R(!1);dt("isDragging",X);const ke=[{name:"首页",key:"home",icon:"ai",path:"/public-library/home",permissions:["*"]}],ue=e=>{v.push({path:e.path,query:{library_id:y.value,library_key:o.value}})},ge=(e,t)=>{e==="homePreviewStyle"&&De(t)},De=e=>{C.changeHomePreviewStyle(),b.path!=="/public-library/home"&&ue(e)},c=e=>{let t={library_key:o.value,pid:e?e.id:0};return Ne(t).then(a=>{let l=a.data||[];l.forEach(i=>{i.id=i.id*1,i.pid=i.pid*1,i.key=i.id,i.level=e?e.level+1:0,i.sort=i.sort*1,i.children_num=i.children_num*1,i.children=[],i.hasLoaded=!1,i.isLeaf=i.children_num==0}),e?(e.hasLoaded=!0,e.children=l,u.value=[...u.value]):u.value=l})},n=e=>new Promise(t=>{if(e.dataRef.hasLoaded){t();return}c(e.dataRef).then(()=>{t()})}),w=()=>{$.value=[]},{copyShareUrl:I}=ut(),le=async e=>{const t=et+"/doc/"+e.doc_key;await I(t)},ae=(e,t)=>{let a=0,l=t.title,i=e?e.dataRef.id:0;l.endsWith(".md")&&(l=l.replace(/\.md$/i,""));let h={library_key:o.value,doc_id:"",doc_type:"4",doc_icon:"",pid:i,title:l,content:t.content,sort:0,is_dir:a};ve(h).then(g=>{ce.success("导入成功"),h.id=g.data.doc_id,h.sort=g.data.sort;let G=e?e.dataRef:null;ie(G,h)})},pe=(e,t)=>{let a=t==1?"新建文件夹":"无标题文档",l=e?e.dataRef.id:0;t==0&&(e?a=M("无标题文档",e.dataRef.children):a=M("无标题文档",u.value));let i={library_key:o.value,doc_id:"",doc_type:"4",doc_icon:"",pid:l,title:a,content:"# 无标题文档",sort:0,is_dir:t};(t==1?Te:ve)(i).then(g=>{ce.success("添加成功"),i.id=g.data.doc_id,i.sort=g.data.sort;let G=e?e.dataRef:null;ie(G,i)})},xe=e=>{Ee({library_key:o.value,doc_id:e.dataRef.id}).then(t=>{let a={library_key:o.value,doc_id:"",doc_type:"4",pid:t.data.pid*1,title:t.data.title+"(副本)",content:t.data.content,doc_icon:t.data.doc_icon||"",sort:0,is_dir:0};ve(a).then(l=>{ce.success("复制成功"),a.id=l.data.doc_id,a.sort=l.data.sort;let i=S(u.value,a.pid);ie(i,a)})})},ie=(e,t)=>{t.children_num=0,t.children=[],t.hasLoaded=!1,t.key=t.id,t.isLeaf=!0,t.level=0,e?(t.level=e.level+1,e.children_num++,e.isLeaf=!1,e.hasLoaded?(e.children.unshift(t),ye(()=>{r.value.toggleExpand(e.id,!0)})):(e.hasLoaded=!1,ye(()=>{r.value.toggleExpand(e.id,!0)}))):(t.level=0,u.value.unshift(t)),se(t)},p=e=>{let t=S(u.value,e.dataRef.id);F.value=!1,t.isEdit=!0},K=(e,t)=>{let a=S(u.value,e.dataRef.id);a.title=t,a.isEdit=!1,setTimeout(()=>{F.value=!0},100);let l={library_key:o.value,doc_id:a.id,doc_type:"4",pid:a.pid,title:t,content:a.content,is_dir:a.is_dir};(a.is_dir==1?Te:ve)(l).then(()=>{ce.success("修改成功")})},je=e=>{Ue.confirm({title:"删除文档",icon:f(tt),content:`确定删除文档 ${e.dataRef.title} 吗？`,onOk(){Fe(e)},onCancel(){}})},Fe=e=>{let t=e.dataRef.id,a=e.dataRef.pid;ot({library_key:o.value,doc_id:e.dataRef.id}).then(()=>{ce.success("删除成功");let l=S(u.value,a);if(l){let i=l.children.findIndex(g=>g.id==t);if(l.children_num--,l.isLeaf=l.children_num==0,l.children.splice(i,1),P.value!="doc"||E.value.id!=t)return;let h=l.children.filter(g=>g.is_dir!=1);if(h.length>0)se(h[0]);else{let g=u.value.filter(G=>G.is_dir!=1);g.length>0?se(g[0]):(E.value=null,v.replace({path:"/public-library/home",query:{library_id:y.value,library_key:o.value}}))}}else{let i=u.value.findIndex(g=>g.id==t);if(u.value.splice(i,1),P.value!="doc"||E.value.id!=t)return;let h=u.value.filter(g=>g.is_dir!=1);h.length>0?se(h[0]):(E.value=null,v.replace({path:"/public-library/home",query:{library_id:y.value,library_key:o.value}}))}})},Pe=e=>{Ee({library_key:o.value,doc_id:e.dataRef.id}).then(t=>{let{content:a,title:l}=t.data;l.endsWith(".md")||(l+=".md"),j(a,l)})},se=e=>{if(e.is_dir==1){r.value.toggleExpand(e.id);return}E.value=e,$.value=[e.id],b.path=="/public-library/editor"?v.replace({path:"/public-library/editor",query:{library_id:y.value,library_key:o.value,doc_id:e.id}}):v.push({path:"/public-library/editor",query:{library_id:y.value,library_key:o.value,doc_id:e.id}})},qe=()=>{},We=e=>{const t=[...u.value],a=e.node,l=e.dragNode,i=a.key,h=l.key,g=a.pos.split("-"),G=e.dropPosition-Number(g[g.length-1]),fe=(L,H,Q=0,N)=>{for(let z=0;z<L.length;z++){if(L[z].key===H){N(L[z],z,Q,L);return}L[z].children&&fe(L[z].children,H,Q+1,N)}};let Z;if(fe(t,h,0,(L,H,Q,N)=>{Z={...L},N.splice(H,1)}),l.parent&&l.parent.node.children_num>0&&(l.parent.node.children_num--,l.parent.node.isLeaf=l.parent.node.children_num==0),!e.dropToGap)fe(t,i,0,(L,H,Q)=>{L.children=L.children||[],L.children_num++,L.isLeaf=!1,Z.level=Q+1,L.children.unshift(Z)});else{let L=[],H=0;fe(t,i,0,(Q,N,z,Je)=>{L=Je,H=N,Z.level=z}),G===-1?L.splice(H,0,Z):L.splice(H+1,0,Z)}u.value=t,He(l,a)},He=(e,t)=>{let a=_(u.value,e.dataRef.id);e.dataRef.pid=a?a.id:0;let l={library_key:o.value,doc_id:e.dataRef.id,pid:e.dataRef.pid,level:a?a.level+1:0,sort:0},i=a?a.children:u.value,h=-1;i.length>1&&(h=i.findIndex(g=>g.id==e.dataRef.id),h===0?(l.top=1,l.sort=i[h+1].sort):l.sort=i[h-1].sort),nt(l).then(g=>{e.dataRef.sort=g.data.sort,e.dataRef.level=l.level,t.pid!=l.pid&&(t.dataRef.children.length>=t.dataRef.children_num?(t.dataRef.hasLoaded=!0,r.value.addLoadedKey(t.id),r.value.toggleExpand(t.id,!0)):c(t.dataRef).then(()=>{i[h]=e.dataRef,ye(()=>{t.dataRef.hasLoaded=!0,r.value.toggleExpand(t.id,!0)})}))})},ze=e=>{let t=S(u.value,e.id);t.title=e.title,t.is_draft=e.is_draft,t.doc_icon=e.doc_icon,E.value=t},Xe=e=>{X.value=!0,U.value=e.clientX,oe.value=W.value,document.addEventListener("mousemove",Se),document.addEventListener("mouseup",$e),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},Ve=R(800),Ge=R(220),Se=e=>{if(!X.value)return;const t=e.clientX-U.value,a=oe.value+t;a>=Ge.value&&a<=Ve.value&&(W.value=a)},$e=()=>{X.value=!1,document.removeEventListener("mousemove",Se),document.removeEventListener("mouseup",$e),document.body.style.cursor="",document.body.style.userSelect="",q(Ae,W.value)},Ye=()=>{x.value=!x.value,q(Oe,x.value)};return _e(()=>b.path,e=>{e!=="/public-library/editor"&&(w(),E.value=null)}),_e(()=>u.value,e=>{C.setDocTreeState(JSON.parse(JSON.stringify(e)))},{deep:!0}),_e(k,e=>{e&&($.value=[Number(k.value)])}),_e(y,()=>{w(),E.value=null,c()}),Be(()=>{c(),k.value&&($.value=[Number(k.value)])}),(e,t)=>{const a=Le,l=ct("router-view");return D(),T("div",on,[it(d("div",{class:V(["drag-line",{dragging:X.value}]),style:Re({left:`${W.value}px`}),onMousedown:Xe},null,38),[[st,!x.value]]),d("div",ln,[d("span",{class:V(["sidebar-toggle-btn",{"is-open":!x.value}]),style:Re({left:`${x.value?Ke:W.value}px`}),onClick:Ye},[f(a,{name:"arrow-left",class:"toggle-icon"})],6),d("div",{class:"layout-left",style:Re({width:`${x.value?Ke:W.value}px`})},[d("div",an,[x.value?re("",!0):(D(),de(Tt,{key:0,menus:ke,active:P.value,onMenuClick:ue,onHandleAction:ge},null,8,["active"])),x.value?re("",!0):(D(),T("div",sn,[f(nn,{ref_key:"docTreeRef",ref:r,list:u.value,"load-data":n,draggable:F.value,selectedKeys:$.value,iconTemplateConfig:s.value,onImportDoc:ae,onAddDoc:pe,onRenameDoc:p,onSaveName:K,onDeleteDoc:je,onCopyDoc:xe,onCopyLink:le,onExportDoc:Pe,onDragenter:qe,onDrop:We,onSelect:se},null,8,["list","draggable","selectedKeys","iconTemplateConfig"])]))])],4)]),d("div",cn,[f(l,{onChangeDoc:ze})])])}}},to=be(rn,[["__scopeId","data-v-d4e0e4d3"]]);export{to as default};
