var Vm=Object.defineProperty;var Hm=(n,e,t)=>e in n?Vm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ai=(n,e,t)=>Hm(n,typeof e!="symbol"?e+"":e,t);import{am as sg,f as G,e as Xe,aw as As,o as ut,ac as R,ad as w,az as ie,as as d,k as y,ar as x,G as U,at as j,F as ae,ax as ye,ai as Ct,av as Um,n as $i,aG as zm,B as St,A as tr,ae as Q,u as K,w as gt,j as no,ak as gi,c as He,aA as Nt,ah as In,E as ag,r as Je,y as Pt,J as Bn,l as Tt,ag as Pu,s as Vf,aC as lg,p as Ui,aH as qm,m as Gm,d as ug,aj as Xm,au as or,aB as Fa,b as Gc,aI as Wm}from"./vue-chunks-CGLjTDrY.js";import{a5 as Xc,A as ja,_ as Te,d as Nn,a7 as Po,ah as Ym,ai as Km,af as Jm,a4 as Os,ag as _n,aj as rs,ak as Wc,a3 as Zm,al as Qm,c as dg,am as ey,an as Yi,ao as ty,ap as ny,aq as id}from"../../index-DxV-PNCd.js";import{g as oy,y as iy,z as Hf,A as ry,B as sy,e as Rr,C as ay,D as ly,E as cg,F as uy,G as dy,H as cy,I as fy,J as py,K as hy,L as vy,M as jd,N as fg,O as Uf,P as gy,Q as pr}from"./index-BNO9ztvM.js";import{u as jn}from"./robot-CbQxxX9E.js";import{v as Qt,aa as Yc,D as Ro,R as Wi,ae as Va,a6 as Ht,B as Kt,aH as ni,aI as _y,I as ln,h as Br,i as Lr,k as Ir,ay as pg,ah as mt,M as vn,F as wn,e as kn,y as It,z as Vt,Q as Ri,$ as Bi,b as xt,av as Ha,aG as Vn,aF as Ns,O as $n,Y as oi,T as ii,aE as my,aJ as Ko,G as Ms,w as Li,x as Ii,a0 as hg,o as Fr,az as yy,al as mo,V as vg,at as Jt,am as Kc,aK as Fn,as as wi,aL as by,aM as Oo,a as Ts,aN as xy,aO as wy,af as kr,aP as Jc,ad as Zc,a9 as Qc,X as Cy,d as ho,ai as Ua,aQ as Sy,aR as Ru,aS as Bu,H as ef,aj as ky,ak as Ey,ao as Dy,aT as Ay,aU as an,aV as Dt,aW as ls,aX as za,aY as rd,aZ as Qr,a_ as Lt,a$ as ir,b0 as ti,b1 as Or,b2 as us,b3 as Qn,s as Oy,b4 as Ny,b5 as ma,b6 as Vd,b7 as My,b8 as gg,b9 as Ty,ba as $y,bb as zf,bc as Py,bd as Hd,be as _g,bf as Ry,bg as mg,bh as el,bi as By,bj as Ly,bk as ta,bl as Iy,bm as Fy,bn as jy,bo as Vy,bp as Hy,ar as Uy,aA as zy}from"./ui-antd-AfNpv4wx.js";import{u as qy}from"./global-CNyN0DwS.js";import{a as Gy,_ as yg,M as Xy}from"./meta-filter-box-DPAUln1z.js";import{_ as Ll}from"./empty-BFmzY9bl.js";import{c as Ud,a as Wy,b as Yy,d as Ky,e as Jy,f as Hs,h as Zy,p as ya,i as Qy,_ as e0,j as t0,k as n0,l as o0,m as i0,n as r0,o as s0,q as a0,r as l0,s as u0,t as d0,u as c0,v as f0,w as p0,x as h0,y as v0,z as g0,A as _0,B as m0,C as y0,D as b0,E as x0,F as w0,G as C0,H as S0,I as k0,J as E0,K as D0,L as A0,M as O0,N as N0,O as M0,P as T0,Q as $0,R as P0,S as R0,T as B0,U as L0,V as I0,W as F0,X as j0,Y as V0,Z as H0,$ as U0,a0 as z0,a1 as q0,a2 as G0,a3 as X0,a4 as W0,a5 as Y0,a6 as K0,a7 as J0,a8 as Z0,a9 as Q0,aa as e1,ab as t1,ac as n1,ad as o1,ae as i1,af as r1,ag as s1,ah as a1,ai as l1,aj as u1,ak as d1,al as c1,am as f1,an as p1,ao as h1,ap as v1,aq as g1,ar as _1,as as m1,at as y1,au as b1,av as x1,aw as w1,ax as C1,ay as S1,az as k1,aA as E1,aB as D1,aC as A1,aD as O1,aE as N1,aF as M1,aG as T1,aH as $1,aI as P1,aJ as R1,aK as B1,aL as L1,aM as I1,aN as F1,aO as j1,aP as V1,aQ as H1,aR as U1,aS as z1,aT as q1,aU as G1,aV as X1,aW as W1,aX as Y1,aY as K1,aZ as J1,a_ as Z1,a$ as Q1,b0 as eb,b1 as tb,b2 as nb,b3 as ob,b4 as ib,b5 as rb,b6 as sb,b7 as ab,b8 as lb,b9 as ub,ba as db,bb as cb,bc as fb,bd as pb,be as hb,bf as vb,bg as gb,bh as _b,bi as mb,bj as yb,bk as bb,bl as xb,bm as wb,bn as Cb,bo as Sb,bp as kb,bq as Eb,br as Db,bs as Ab,bt as Ob,bu as Nb,bv as Mb,bw as Tb,bx as $b,by as Pb,bz as Rb,bA as Bb,bB as Lb,bC as Ib,bD as Fb,bE as jb,bF as Vb,bG as Hb,bH as Ub,bI as zb,bJ as qb,bK as Gb,bL as Xb,bM as Wb,bN as Yb,bO as Kb,bP as Jb,bQ as Zb,bR as Qb,bS as e2,bT as t2,bU as n2,bV as o2,bW as i2,bX as r2,bY as s2,bZ as a2,b_ as l2,b$ as u2,c0 as d2,c1 as c2,c2 as f2,c3 as p2,c4 as h2,c5 as v2,c6 as g2,c7 as _2,c8 as m2,c9 as y2,ca as b2,cb as x2,cc as w2,cd as C2,ce as S2,cf as k2,cg as E2,ch as D2,ci as A2,cj as O2,ck as N2,cl as M2,cm as T2,cn as $2,co as P2,cp as R2,cq as B2,cr as L2,cs as I2,ct as F2,cu as j2,cv as V2,cw as H2,cx as U2,cy as z2,cz as q2,cA as G2,cB as X2,cC as W2,cD as Y2,cE as K2,cF as J2,cG as Z2,cH as Q2,cI as ex,cJ as tx,cK as nx,cL as ox,cM as ix,cN as rx,cO as sx,cP as ax,cQ as lx,cR as ux,cS as dx,cT as cx,cU as fx,cV as px,cW as hx,cX as vx,cY as gx,cZ as _x,c_ as mx,c$ as yx,d0 as bx,d1 as xx,d2 as wx,d3 as Cx,d4 as Sx,d5 as kx,d6 as Ex,d7 as Dx,d8 as Ax,d9 as Ox,da as Nx,db as Mx,dc as Tx,dd as $x,de as Px,df as Rx,dg as Bx,dh as Lx,di as Ix,dj as Fx,dk as jx,dl as Vx,dm as Hx,dn as Ux,dp as zx,dq as qx,dr as Gx,ds as Xx,dt as Wx,du as Yx,dv as Kx,dw as Jx,dx as Zx,dy as Qx,dz as ew,dA as tw,dB as nw,dC as ow,dD as iw,dE as rw,dF as sw,dG as aw,dH as lw,dI as uw,dJ as No,dK as yo,dL as bg,dM as Ci,dN as xg,dO as tf,dP as Lu,g as dw,dQ as wg,dR as ds,dS as cw,dT as fw,dU as qf,dV as pw}from"./util-20cxas0q.js";import{u as hw}from"./usePublicNetworkCheck-Gk3eB7lo.js";import{P as vw}from"./public-network-check-CwdAqxDb.js";import{M as rr,a as gw,u as Cg,b as Sg}from"./model-select-CjmsccZQ.js";import{_ as qa}from"./empty-CzGZrENG.js";import{a as _w,g as mw}from"./index-BlSWNDZy.js";import{_ as yw}from"./cu-scroll-qHaWhCWu.js";import{W as bw}from"./index-igCyWfr0.js";import{a as kg}from"./index-DCeQ7cs_.js";import{r as Eg,R as xw}from"./editor-code-BLYX-bNv.js";import{P as Mo}from"./styles-B3AMWjFt.js";import{d as ww}from"./vuedraggable.umd-BzpNiY3c.js";import{g as Dg}from"./thirdMcp-BGS_aCGX.js";import{r as Bo,g as Ag,o as Cw,d as Sw}from"./index-IIUHUqQG.js";import{F as kw,P as Ew,u as Dw}from"./useOfficialArticleLogin-D9Ts2Pw1.js";import{i as zd}from"./validate-8MtiUsxW.js";import{u as cs}from"./useEventBus-CB_rGuu7.js";import{Z as ko}from"./zm-radio-group-yyUEERzm.js";import{T as Aw,E as Ow}from"./wange-ditor-Dfk_SQJx.js";import{S as Nw}from"./select-wechat-app-CUiuLIfn.js";import{r as Mw}from"./elkjs-K6oZZT_M.js";import{T as Tw}from"./top-header-BMGDvayG.js";import{a as $w}from"./add-group-DudD4r8X.js";import{j as Pw}from"./index-w0T-47HX.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./empty-box-C6xHnjvN.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-CiRf6fZ3.js";import"./loading-box-BFrpPJwN.js";function Rw(n={}){return Xc.get({url:"/manage/getTriggerConfigList",params:n})}function Bw(n={}){return Xc.get({url:"/manage/getTriggerOfficialMessage",params:n})}const $s=sg("workflow",()=>{const n=G([]),e=G([]),t=G([]),o=G([]);return{triggerList:n,getTriggerList:async(a,l)=>{try{if(n.value.length===0||l){const u=await Rw({robot_key:a});n.value=u.data.map(c=>(c.subMenus=[],c.expend=!1,c.trigger_type==4&&(c.subMenus=[{title:"私信消息",value:"message"},{title:"关注/取消关注事件",value:"subscribe_unsubscribe"},{title:"扫描带参数二维码事件",value:"qrcode_scan"},{title:"自定义菜单事件",value:"menu_click"}]),c))}return n.value}catch(u){}},officialList:e,getTriggerOfficialMsg:a=>{Bw({robot_key:a}).then(l=>{t.value=l.data.messages||[],e.value=l.data.apps||[]})},triggerOfficialList:t,getAllLibraryList:()=>{ja().then(a=>{o.value=a.data})},libraryLists:o}}),Lw={key:0,class:"sidebar-handle-wrapper"},Iw={class:"sidebar-container"},Fw={class:"sidebar-menus"},jw=["onClick"],Vw={class:"menu-name"},Hw={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(n){const e=qy(),t=Um(),o=As(),i=Xe(()=>o.path.split("/")[3]),r=G(!0),s=G(!0);function a(){r.value=!r.value,s.value=!1,e.setHideLayoutTopAndBottom(r.value)}const l=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],u=c=>{if(c.isNewWindowOpen){window.open(`/#${c.path}?robot_key=${o.query.robot_key}&id=${o.query.id}`);return}t.push({path:c.path,query:o.query})};return ut(()=>{setTimeout(()=>{s.value=!1},3e3)}),(c,f)=>{const p=Qt,h=Nn;return w(),R("div",{class:Ct(["sidebar-wrapper",{"is-hide":r.value}])},[n.showSidebarBtn?(w(),R("div",Lw,[y(p,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:s.value,"onUpdate:open":f[0]||(f[0]=g=>s.value=g),arrow:!1},{title:x(()=>[U(j(r.value?"展开":"收起"),1)]),default:x(()=>[d("span",{class:"sidebar-handle",onClick:a},[...f[1]||(f[1]=[d("span",{class:"handle-line handle-line01"},null,-1),d("span",{class:"handle-line handle-line02"},null,-1)])])]),_:1},8,["open"])])):ie("",!0),d("div",Iw,[d("div",Fw,[(w(),R(ae,null,ye(l,g=>y(Gy,{key:g.value,disabled:!r.value,title:g.label,placement:"bottom"},{default:x(()=>[d("div",{class:Ct(["sidebar-menu",{active:i.value==g.value}]),onClick:m=>u(g)},[y(h,{name:g.iconName,class:"menu-icon",size:"16"},null,8,["name"]),d("span",Vw,j(g.label),1)],10,jw)]),_:2},1032,["disabled","title"])),64))])])],2)}}},Uw=Te(Hw,[["__scopeId","data-v-0f7c78c6"]]),zw={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(n){n!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${n}%`,this.previousValue=n)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.$emit("update:modelValue",n.value),this.$emit("zoom-change",n.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const n=this.currentValue.replace("%","").trim(),e=parseInt(n.replace(/[^\d]/g,""),10);if(!n){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const n=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(n)&&n>=1&&n<=800?(this.$emit("update:modelValue",n),this.$emit("zoom-change",n),this.currentValue=`${n}%`,this.previousValue=n):this.currentValue=`${this.previousValue}%`},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(n.target)&&n.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},qw={class:"zoom-select"},Gw={class:"zoom-select-options"},Xw=["onClick"];function Ww(n,e,t,o,i,r){return w(),R("div",qw,[d("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=St(()=>{},["stop"]))},[$i(d("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.currentValue=s),onInput:e[1]||(e[1]=(...s)=>r.handleInput&&r.handleInput(...s)),onFocus:e[2]||(e[2]=(...s)=>r.showMenu&&r.showMenu(...s)),onBlur:e[3]||(e[3]=(...s)=>r.handleBlur&&r.handleBlur(...s))},null,544),[[zm,i.currentValue]])]),$i(d("div",Gw,[(w(!0),R(ae,null,ye(i.menus,s=>(w(),R("div",{class:"zoom-select-option",key:s.value,onClick:a=>r.handleMenu(s)},j(s.label),9,Xw))),128)),e[6]||(e[6]=d("div",{class:"option-line"},null,-1)),d("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=s=>r.handleFitView())},"全览")],512),[[tr,i.isShowMenu]])])}const Yw=Te(zw,[["render",Ww],["__scopeId","data-v-c34f40df"]]),Kw={class:"trigger-list-box"},Jw={key:0,class:"trigger-list"},Zw=["onClick"],Qw={class:"trigger-info"},eC=["src"],tC={class:"info"},nC={class:"name"},oC={key:0,class:"right-icon"},iC={key:0,class:"sub-menu-list"},rC=["onClick"],sC={key:1,class:"empty-box"},aC={href:"/#/plugins/index?active=2",target:"_blank"},lC={__name:"trigger-list",emits:["add"],setup(n,{emit:e}){const t=e,o=$s(),i=Xe(()=>o.triggerOfficialList),r=G(""),s=Xe(()=>{let u=o.triggerList;return r.value?u.filter(c=>c.trigger_name.includes(r.value)):u}),a=u=>{if(u.subMenus&&u.subMenus.length){u.expend=!u.expend;return}let c=Ud(u);t("add",c)},l=(u,c)=>{u.trigger_type==4&&(u.trigger_official_config.msg_type=c.value,i.value,u.outputs=i.value.find(p=>p.msg_type==c.value).fields);let f=Ud(u);t("add",f)};return(u,c)=>{const f=Yc;return w(),R("div",Kw,[d("div",{class:"search-box",onClick:c[1]||(c[1]=St(()=>{},["stop"]))},[y(f,{value:r.value,"onUpdate:value":c[0]||(c[0]=p=>r.value=p),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),R("div",Jw,[(w(!0),R(ae,null,ye(s.value,p=>(w(),R("div",{class:"trigger-item",onClick:h=>a(p),key:p.type},[d("div",Qw,[d("img",{class:"avatar",src:p.trigger_icon},null,8,eC),d("div",tC,[d("span",nC,j(p.trigger_name),1)]),p.subMenus&&p.subMenus.length?(w(),R("div",oC,[p.expend?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Wi),{key:1}))])):ie("",!0)]),p.expend&&p.subMenus&&p.subMenus.length?(w(),R("div",iC,[(w(!0),R(ae,null,ye(p.subMenus,h=>(w(),R("div",{class:"sub-item",onClick:St(g=>l(p,h),["stop"]),key:h.value},j(h.title),9,rC))),128))])):ie("",!0)],8,Zw))),128))])):(w(),R("div",sC,[c[3]||(c[3]=d("img",{style:{height:"200px"},src:Ll},null,-1)),c[4]||(c[4]=d("div",null,"暂无可用插件",-1)),d("a",aC,[c[2]||(c[2]=U("去添加 ",-1)),y(K(Wi))])]))])}}},uC=Te(lC,[["__scopeId","data-v-fbea2d6f"]]),dC={class:"trigger-list-box"},cC={key:0,class:"trigger-list"},fC=["onClick"],pC={class:"trigger-info"},hC=["src"],vC={class:"info"},gC={class:"name"},_C={key:1,class:"empty-box"},mC={href:"/#/robot/list?active=1",target:"_blank"},yC={__name:"workflow-list",emits:["add"],setup(n,{emit:e}){const t=e,o=G([]),i=G("");ut(()=>{r()});function r(){oy({application_type:1}).then(l=>{let u=l.data||[];o.value=u.filter(c=>c.has_published==1)})}const s=Xe(()=>i.value?o.value.filter(l=>l.robot_name.includes(i.value)):o.value),a=l=>{let u=Wy(l);t("add",u)};return(l,u)=>{const c=Yc;return w(),R("div",dC,[d("div",{class:"search-box",onClick:u[1]||(u[1]=St(()=>{},["stop"]))},[y(c,{value:i.value,"onUpdate:value":u[0]||(u[0]=f=>i.value=f),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),s.value.length?(w(),R("div",cC,[(w(!0),R(ae,null,ye(s.value,f=>(w(),R("div",{class:"trigger-item",onClick:p=>a(f),key:f.id},[d("div",pC,[d("img",{class:"avatar",src:f.robot_avatar},null,8,hC),d("div",vC,[d("span",gC,j(f.robot_name),1)])])],8,fC))),128))])):(w(),R("div",_C,[u[3]||(u[3]=d("img",{style:{height:"200px"},src:Ll},null,-1)),u[4]||(u[4]=d("div",null,"暂无可用工作流",-1)),d("a",mC,[u[2]||(u[2]=U("去添加 ",-1)),y(K(Wi))])]))])}}},bC=Te(yC,[["__scopeId","data-v-7f279786"]]),xC={class:"node-list-popup"},wC={class:"tabs-box"},CC={class:"node-list-popup-content"},SC={key:0,class:"node-list"},kC={class:"node-type"},EC={class:"node-flex-box"},DC=["onMousedown"],AC=["src","alt"],OC={class:"node-name"},NC={key:1,class:"node-box"},MC={class:"search-box"},TC={key:0,class:"node-list"},$C={class:"node-info-pop"},PC={class:"info"},RC=["src"],BC={class:"name"},LC={class:"extra"},IC=["onClick"],FC=["src"],jC={class:"info"},VC={class:"name"},HC={class:"total"},UC={class:"node-tools"},zC={class:"params-box"},qC={class:"param-item"},GC={class:"field"},XC={class:"name"},WC={class:"desc"},YC={class:"field"},KC={class:"name"},JC={class:"type"},ZC={key:0,class:"required"},QC={class:"desc"},eS=["onMousedown"],tS={key:1,class:"empty-box"},nS={key:1,class:"node-box"},oS={class:"node-list"},iS=["onClick"],rS={class:"node-info"},sS=["src"],aS={class:"info"},lS={class:"name"},uS={key:0,class:"node-item"},dS={class:"node-info-pop"},cS={class:"info"},fS=["src"],pS={class:"name"},hS={class:"extra"},vS=["onClick"],gS=["src"],_S={class:"info"},mS={class:"name"},yS={class:"total"},bS={class:"node-tools"},xS={class:"params-box"},wS={class:"param-item"},CS={class:"field"},SS={class:"name"},kS={class:"desc"},ES={class:"field"},DS={class:"name"},AS={class:"type"},OS={key:0,class:"required"},NS={class:"desc"},MS=["onMousedown"],TS=["onClick"],$S={class:"node-info"},PS=["src"],RS={class:"info"},BS={class:"name"},LS={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},IS={key:1,class:"empty-box"},FS={href:"/#/plugins/index?active=2",target:"_blank"},jS={key:3,class:"node-box"},VS={key:4,class:"node-box"},HS={__name:"index",props:{type:{type:String,default:""},active:{type:Number,default:1},excludedNodeTypes:{type:Array,default:()=>[]}},emits:["addNode","addTrigger","mouseMove","update:active"],setup(n,{emit:e}){const t=e,o=n,{isPublicNetwork:i}=hw(),r=G(o.active);gt(()=>o.active,M=>{r.value=M});const s=G([]),a=G([]),l=G([]),u=G("");gt(()=>o.excludedNodeTypes,()=>{s.value=Yy({excludedNodeTypes:o.excludedNodeTypes})},{immediate:!0}),ut(()=>{Ky().then(M=>{l.value=M}),Jy().then(M=>{a.value=M})});const c=Xe(()=>u.value?l.value.filter(M=>(M.description+M.name).indexOf(u.value)>-1):l.value),f=(M,O)=>{M.preventDefault();let k=!1;const E=M.clientX,S=M.clientY,N=JSON.parse(JSON.stringify(O)),L=document.createElement("div");L.classList.add("node-item-ghost"),L.innerHTML=M.currentTarget.innerHTML,document.body.appendChild(L);const $=D=>{L.style.left=`${D.clientX+5}px`,L.style.top=`${D.clientY+5}px`};$(M);const B=D=>{!k&&(Math.abs(D.clientX-E)>5||Math.abs(D.clientY-S)>5)&&(k=!0),$(D),t("mouseMove")},A=D=>{document.body.removeChild(L),window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",A),k?t("addNode",{node:N,event:D}):p(N)};window.addEventListener("mousemove",B),window.addEventListener("mouseup",A,{once:!0})},p=M=>{M=JSON.parse(JSON.stringify(M)),t("addNode",{node:M})},h=(M,O,k)=>{let E=Zy(O,k);f(M,E)},g=M=>{t("addNode",{node:M,isTriggerNode:!0})},m=M=>{t("addNode",{node:M})},_=(M,O,k,E)=>{O=Qy(O,k,E),M?f(M,O):t("addNode",{node:O})};function v(M){r.value=M,t("update:active",M)}function b(){window.open("/#/robot/list?active=3&mcp=2","_blank")}function C(M){var k,E,S;let O=Po((k=M==null?void 0:M.properties)==null?void 0:k.node_params,{});return ya((E=O==null?void 0:O.plugin)==null?void 0:E.name)||((S=O==null?void 0:O.plugin)==null?void 0:S.multiNode)}return(M,O)=>{const k=Nn,E=Yc,S=Va;return w(),R("div",xC,[d("div",wC,[d("div",{class:Ct(["tab-item",{active:r.value==1}]),onClick:O[0]||(O[0]=N=>v(1))},[y(k,{name:"base-node-type"}),O[6]||(O[6]=U()),O[7]||(O[7]=d("span",null,"基础功能",-1))],2),d("div",{class:Ct(["tab-item",{active:r.value==3}]),onClick:O[1]||(O[1]=N=>v(3))},[y(k,{name:"plugin-node-type"}),O[8]||(O[8]=U()),O[9]||(O[9]=d("span",null,"插件",-1))],2),d("div",{class:Ct(["tab-item",{active:r.value==2}]),onClick:O[2]||(O[2]=N=>v(2))},[y(k,{name:"mcp-node-type"}),O[10]||(O[10]=U()),O[11]||(O[11]=d("span",null,"MCP",-1))],2),o.type=="float-btn"?(w(),R("div",{key:0,class:Ct(["tab-item",{active:o.active==4}]),onClick:O[3]||(O[3]=N=>v(4))},[y(k,{name:"mcp-node-type"}),O[12]||(O[12]=U()),O[13]||(O[13]=d("span",null,"触发器",-1))],2)):ie("",!0),d("div",{class:Ct(["tab-item",{active:r.value==5}]),onClick:O[4]||(O[4]=N=>v(5))},[y(k,{name:"workflow"}),O[14]||(O[14]=U()),O[15]||(O[15]=d("span",null,"工作流",-1))],2)]),d("div",CC,[r.value==1?(w(!0),R(ae,{key:0},ye(s.value,N=>(w(),R(ae,{key:N.key},[N.hidden?ie("",!0):(w(),R("div",SC,[d("div",kC,j(N.name),1),d("div",EC,[(w(!0),R(ae,null,ye(N.nodes,L=>(w(),R(ae,{key:L.type},[L.hidden?ie("",!0):(w(),R("div",{key:0,class:"node-item",onMousedown:$=>f($,L)},[d("img",{src:L.properties.node_icon,alt:L.properties.node_name},null,8,AC),d("div",OC,j(L.properties.node_name),1)],40,DC))],64))),128))])]))],64))),128)):r.value==2?(w(),R("div",NC,[d("div",MC,[y(E,{value:u.value,"onUpdate:value":O[5]||(O[5]=N=>u.value=N),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),c.value.length?(w(),R("div",TC,[(w(!0),R(ae,null,ye(c.value,(N,L)=>(w(),R("div",{key:L,class:"node-item"},[y(S,{placement:"right"},{content:x(()=>[d("div",$C,[d("div",PC,[d("img",{class:"avatar",src:N.avatar},null,8,RC),d("div",BC,j(N.name),1)]),d("div",null,j(N.url),1),d("div",LC,"可用工具："+j(N.tools.length),1)])]),default:x(()=>[d("div",{class:"node-info",onClick:$=>N.expand=!N.expand},[d("img",{class:"avatar",src:N.avatar},null,8,FC),d("div",jC,[d("span",VC,j(N.name),1),d("span",HC,[U(j(N.tools.length)+" ",1),N.expand?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Wi),{key:1}))])])],8,IC)]),_:2},1024),$i(d("div",UC,[(w(!0),R(ae,null,ye(N.tools,($,B)=>(w(),Q(S,{key:B,placement:"right"},{content:x(()=>[d("div",zC,[d("div",qC,[d("div",GC,[d("span",XC,j($.name),1)]),d("div",WC,j($.description),1)]),(w(!0),R(ae,null,ye($.inputSchema.properties,(A,D)=>(w(),R("div",{key:D,class:"param-item"},[d("div",YC,[d("span",KC,j(D),1),d("span",JC,j(A.type),1),$.inputSchema.required&&$.inputSchema.required.includes(D)?(w(),R("span",ZC,"必填")):ie("",!0)]),d("div",QC,j(A.description),1)]))),128))])]),default:x(()=>[d("div",{class:"node-tool-item",onMousedown:A=>h(A,N,$)},j($.name),41,eS)]),_:2},1024))),128))],512),[[tr,N.expand]])]))),128))])):(w(),R("div",tS,[O[17]||(O[17]=d("img",{style:{height:"200px"},src:Ll},null,-1)),O[18]||(O[18]=d("div",null,"暂无可用MCP插件",-1)),d("a",{onClick:b},[O[16]||(O[16]=U("去添加",-1)),y(K(Wi))])]))])):r.value==3?(w(),R(ae,{key:2},[K(i)?(w(),R("div",nS,[a.value.length?(w(),R(ae,{key:0},[d("div",oS,[(w(!0),R(ae,null,ye(a.value,N=>(w(),R(ae,{key:N.type},[C(N)?(w(),R(ae,{key:1},[K(Hs)(N.plugin_name).length>1?(w(),R("div",uS,[y(S,{placement:"right"},{content:x(()=>[d("div",dS,[d("div",cS,[d("img",{class:"avatar",src:N.properties.node_icon},null,8,fS),d("div",pS,j(N.properties.node_name),1)]),d("div",null,j(N.properties.node_desc),1),d("div",hS,"可用工具："+j(K(Hs)(N.plugin_name).length),1)])]),default:x(()=>[d("div",{class:"node-info",onClick:L=>N.expand=!N.expand},[d("img",{class:"avatar",src:N.properties.node_icon},null,8,gS),d("div",_S,[d("span",mS,j(N.properties.node_name),1),d("span",yS,[U(j(K(Hs)(N.plugin_name).length)+" ",1),N.expand?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Wi),{key:1}))])])],8,vS)]),_:2},1024),$i(d("div",bS,[(w(!0),R(ae,null,ye(K(Hs)(N.plugin_name),L=>(w(),Q(S,{key:L.name,placement:"right"},{content:x(()=>[d("div",xS,[d("div",wS,[d("div",CS,[d("span",SS,j(L.title),1)]),d("div",kS,j(L.desc),1)]),(w(!0),R(ae,null,ye(L.params,($,B)=>(w(),R("div",{key:B,class:"param-item"},[d("div",ES,[d("span",DS,j(B),1),d("span",AS,j($.type),1),$.required?(w(),R("span",OS,"必填")):ie("",!0)]),d("div",NS,j($.desc),1)]))),128))])]),default:x(()=>[d("div",{class:"node-tool-item",onMousedown:$=>_($,N,L,L.name)},j(L.title),41,MS)]),_:2},1024))),128))],512),[[tr,N.expand]])])):(w(!0),R(ae,{key:1},ye(K(Hs)(N.plugin_name),L=>(w(),R("div",{onClick:$=>_(null,N,L,L.name),class:"node-item"},[d("div",$S,[d("img",{class:"avatar",src:N.properties.node_icon},null,8,PS),d("div",RS,[d("span",BS,j(N.properties.node_name),1)])])],8,TS))),256))],64)):(w(),R("div",{key:0,onClick:L=>p(N),class:"node-item"},[d("div",rS,[d("img",{class:"avatar",src:N.properties.node_icon},null,8,sS),d("div",aS,[d("span",lS,j(N.properties.node_name),1)])])],8,iS))],64))),128))]),d("a",LS,[O[19]||(O[19]=U("更多插件 ",-1)),y(K(Wi))])],64)):(w(),R("div",IS,[O[21]||(O[21]=d("img",{style:{height:"200px"},src:Ll},null,-1)),O[22]||(O[22]=d("div",null,"暂无可用插件",-1)),d("a",FS,[O[20]||(O[20]=U("去添加",-1)),y(K(Wi))])]))])):(w(),Q(vw,{key:0,style:{margin:"0"}}))],64)):r.value==4?(w(),R("div",jS,[y(uC,{onAdd:g})])):r.value==5?(w(),R("div",VS,[y(bC,{onAdd:m})])):ie("",!0)])])}}},Iu=Te(HS,[["__scopeId","data-v-04820e5a"]]),US={class:"custom-control-warpper"},zS={class:"custom-control-body"},qS={class:"custom-control"},GS={class:"control-item zoom-control"},XS={class:"control-item"},WS={class:"control-item"},YS={class:"control-item"},KS={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(n,{emit:e}){const t=e,o=n,i=G(["terminate-node"]),{eventCenter:r}=o.lf.graphModel,s=G(100),a=()=>{o.lf.fitView()},l=()=>{let E=s.value/100;o.lf.zoom(E),t("zoomChange",E)},u=E=>{s.value=E,l()},c=()=>{let E=s.value-10;E<1&&(E=1),s.value=E,l()},f=()=>{let E=s.value+10;E>800&&(E=800),s.value=E,l()},p=E=>{let S=Math.floor(E.transform.SCALE_X*100);s.value=S},h=G(!1),g=G(null),m=G(1),_=()=>{m.value=1,h.value=!0},v=()=>{t("runTest")},b=()=>{t("autoLayout")},C=E=>{h.value&&(g.value.contains(E.target)||(h.value=!1))},M=()=>{h.value&&(h.value=!1)},O=E=>{t("addNode",E),h.value=!1},k=()=>{m.value=4,h.value=!0};return ut(()=>{document.addEventListener("click",C),r.on("graph:transform",p),r.on("custom:showTriggerLit",k)}),no(()=>{document.removeEventListener("click",C),r.off("graph:transform",p),r.off("custom:showTriggerLit",k)}),(E,S)=>{const N=Nn,L=Kt;return w(),R("div",US,[d("div",zS,[d("div",qS,[d("div",GS,[d("div",{class:"action-btn zoom-btn",onClick:c},[y(N,{name:"minus",size:"16"})]),y(Yw,{modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=$=>s.value=$),onZoomChange:u,onFitView:a},null,8,["modelValue"]),d("div",{class:"action-btn zoom-btn",onClick:f},[y(N,{name:"plus",size:"16"})])]),S[5]||(S[5]=d("i",{class:"control-line"},null,-1)),d("div",XS,[y(L,{type:"primary",onClick:St(_,["stop"])},{icon:x(()=>[y(K(Ht))]),default:x(()=>[S[2]||(S[2]=d("span",null,"新建节点",-1))]),_:1})]),d("div",WS,[y(L,{onClick:v,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(K(ni)),S[3]||(S[3]=d("span",null,"运行测试",-1))]),_:1})]),d("div",YS,[y(L,{onClick:b,type:"default"},{default:x(()=>[y(K(_y)),S[4]||(S[4]=d("span",null,"整理画布",-1))]),_:1})])]),$i(d("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:g},[y(Iu,{excludedNodeTypes:i.value,onAddNode:O,type:"float-btn",onMouseMove:M,active:m.value,"onUpdate:active":S[1]||(S[1]=$=>m.value=$)},null,8,["excludedNodeTypes","active"])],512),[[tr,h.value]])])])}}},JS=Te(KS,[["__scopeId","data-v-ff04cf1b"]]),ZS={},QS={class:"node-form-layout"},ek={class:"layout-header"},tk={class:"layout-body"};function nk(n,e){return w(),R("div",QS,[d("div",ek,[gi(n.$slots,"header",{},void 0,!0)]),d("div",tk,[gi(n.$slots,"default",{},void 0,!0)])])}const cn=Te(ZS,[["render",nk],["__scopeId","data-v-a5d11f7a"]]),ok={class:"node-form-header"},ik={class:"node-title"},rk={class:"title-left"},sk=["src"],ak={class:"title-conttent"},lk={class:"title-right"},uk={class:"node-desc"},dk={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},emits:["changeTitle","deleteNode","close"],setup(n,{emit:e}){const t=He("changeTitle"),o=He("deleteNode"),i=He("close"),r=e,s=n;let a=null;const l=g=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":uw,"../../../../assets/svg/ai-generate-white.svg":lw,"../../../../assets/svg/ai-generate.svg":aw,"../../../../assets/svg/ai-mark.svg":sw,"../../../../assets/svg/ai.svg":rw,"../../../../assets/svg/alarm-clock.svg":iw,"../../../../assets/svg/alert-icon.svg":ow,"../../../../assets/svg/ali-ocr.svg":nw,"../../../../assets/svg/analysis.svg":tw,"../../../../assets/svg/anthrop.svg":ew,"../../../../assets/svg/applet.svg":Qx,"../../../../assets/svg/arrow-down.svg":Zx,"../../../../assets/svg/arrow-left.svg":Jx,"../../../../assets/svg/arrow-right.svg":Kx,"../../../../assets/svg/attachment.svg":Yx,"../../../../assets/svg/auth.svg":Wx,"../../../../assets/svg/auto-reply.svg":Xx,"../../../../assets/svg/azure.svg":Gx,"../../../../assets/svg/back.svg":qx,"../../../../assets/svg/baichuan.svg":zx,"../../../../assets/svg/base-node-type.svg":Ux,"../../../../assets/svg/batch-group-node.svg":Hx,"../../../../assets/svg/book.svg":Vx,"../../../../assets/svg/chat-cache.svg":jx,"../../../../assets/svg/chat-mode.svg":Fx,"../../../../assets/svg/chat-robot-icon.svg":Ix,"../../../../assets/svg/chat.svg":Lx,"../../../../assets/svg/check-arrow-filled.svg":Bx,"../../../../assets/svg/circular-needle2.svg":Rx,"../../../../assets/svg/circularNeedle.svg":Px,"../../../../assets/svg/client.svg":$x,"../../../../assets/svg/close-circle.svg":Tx,"../../../../assets/svg/cmd.svg":Mx,"../../../../assets/svg/code-run-node.svg":Nx,"../../../../assets/svg/cohere.svg":Ox,"../../../../assets/svg/collaborator.svg":Ax,"../../../../assets/svg/collapse-close.svg":Dx,"../../../../assets/svg/collapse-open.svg":Ex,"../../../../assets/svg/colour-edit.svg":kx,"../../../../assets/svg/comment-delete.svg":Sx,"../../../../assets/svg/comment-reply.svg":Cx,"../../../../assets/svg/comment-search.svg":wx,"../../../../assets/svg/comment-selected.svg":xx,"../../../../assets/svg/comment.svg":bx,"../../../../assets/svg/common-quession.svg":yx,"../../../../assets/svg/create_library.svg":mx,"../../../../assets/svg/create_robot.svg":_x,"../../../../assets/svg/cu-doc-active.svg":gx,"../../../../assets/svg/cu-doc-icon.svg":vx,"../../../../assets/svg/custom-group-node.svg":hx,"../../../../assets/svg/data-node.svg":px,"../../../../assets/svg/data-security.svg":fx,"../../../../assets/svg/database-menu-icon.svg":cx,"../../../../assets/svg/deepseek.svg":dx,"../../../../assets/svg/delete-line.svg":ux,"../../../../assets/svg/delete.svg":lx,"../../../../assets/svg/ding-group-node.svg":ax,"../../../../assets/svg/direct-connection.svg":sx,"../../../../assets/svg/dislike-active.svg":rx,"../../../../assets/svg/dislike.svg":ix,"../../../../assets/svg/doc-active-menu-icon.svg":ox,"../../../../assets/svg/doc-directory.svg":nx,"../../../../assets/svg/doc-draft.svg":tx,"../../../../assets/svg/doc-file.svg":ex,"../../../../assets/svg/doc-file2.svg":Q2,"../../../../assets/svg/doc-icon-active.svg":Z2,"../../../../assets/svg/doc-icon.svg":J2,"../../../../assets/svg/doc-menu-icon.svg":K2,"../../../../assets/svg/document.svg":Y2,"../../../../assets/svg/download.svg":W2,"../../../../assets/svg/drag.svg":X2,"../../../../assets/svg/dragv2.svg":G2,"../../../../assets/svg/duiwaifuwu.svg":q2,"../../../../assets/svg/economic-active.svg":z2,"../../../../assets/svg/economic.svg":U2,"../../../../assets/svg/edit-02.svg":H2,"../../../../assets/svg/edit.svg":V2,"../../../../assets/svg/empty-document.svg":j2,"../../../../assets/svg/empty.svg":F2,"../../../../assets/svg/end-node.svg":I2,"../../../../assets/svg/enterprise-active.svg":L2,"../../../../assets/svg/enterprise.svg":B2,"../../../../assets/svg/enterprise2.svg":R2,"../../../../assets/svg/execute.svg":P2,"../../../../assets/svg/execute_array.svg":$2,"../../../../assets/svg/expand.svg":T2,"../../../../assets/svg/explain-node.svg":M2,"../../../../assets/svg/export-record.svg":N2,"../../../../assets/svg/eye-open.svg":O2,"../../../../assets/svg/feishu-doc.svg":A2,"../../../../assets/svg/field-menu-icon.svg":D2,"../../../../assets/svg/file-icon.svg":E2,"../../../../assets/svg/file-search.svg":k2,"../../../../assets/svg/finance.svg":S2,"../../../../assets/svg/function-center.svg":C2,"../../../../assets/svg/gemini.svg":w2,"../../../../assets/svg/generate-icon.svg":x2,"../../../../assets/svg/gou.svg":b2,"../../../../assets/svg/government.svg":y2,"../../../../assets/svg/graph-icon.svg":m2,"../../../../assets/svg/group-send.svg":_2,"../../../../assets/svg/guanlianzhishiku.svg":g2,"../../../../assets/svg/guide.svg":v2,"../../../../assets/svg/high-active.svg":h2,"../../../../assets/svg/high.svg":p2,"../../../../assets/svg/http-node.svg":f2,"../../../../assets/svg/huanyingyu.svg":c2,"../../../../assets/svg/huoshanyinqin.svg":d2,"../../../../assets/svg/icon-all.svg":u2,"../../../../assets/svg/icon-rocket.svg":l2,"../../../../assets/svg/image-generation-node.svg":a2,"../../../../assets/svg/img-icon.svg":s2,"../../../../assets/svg/input.svg":r2,"../../../../assets/svg/jibenpeizhi.svg":i2,"../../../../assets/svg/jichupeizhi.svg":o2,"../../../../assets/svg/jina.svg":n2,"../../../../assets/svg/json-node.svg":t2,"../../../../assets/svg/json-reverse-node.svg":e2,"../../../../assets/svg/judge-node.svg":Qb,"../../../../assets/svg/knowledge-base-node.svg":Zb,"../../../../assets/svg/knowledge-config-active-icon.svg":Jb,"../../../../assets/svg/knowledge-config-icon.svg":Kb,"../../../../assets/svg/lang.svg":Yb,"../../../../assets/svg/law.svg":Wb,"../../../../assets/svg/liaotianceshi.svg":Xb,"../../../../assets/svg/library_ability_official_account.svg":Gb,"../../../../assets/svg/like-active.svg":qb,"../../../../assets/svg/like-icon.svg":zb,"../../../../assets/svg/like.svg":Ub,"../../../../assets/svg/lingyiwanwu.svg":Hb,"../../../../assets/svg/link-icon-active.svg":Vb,"../../../../assets/svg/link-icon.svg":jb,"../../../../assets/svg/link-left.svg":Fb,"../../../../assets/svg/lock-icon.svg":Ib,"../../../../assets/svg/login-success.svg":Lb,"../../../../assets/svg/logout.svg":Bb,"../../../../assets/svg/loop-2.svg":Rb,"../../../../assets/svg/loop-3.svg":Pb,"../../../../assets/svg/loop-icon.svg":$b,"../../../../assets/svg/manufacture.svg":Tb,"../../../../assets/svg/mcp-node-type.svg":Mb,"../../../../assets/svg/mcp-node.svg":Nb,"../../../../assets/svg/medical-treatment.svg":Ob,"../../../../assets/svg/menu-expand.svg":Ab,"../../../../assets/svg/message.svg":Db,"../../../../assets/svg/minus.svg":Eb,"../../../../assets/svg/mix-icon.svg":kb,"../../../../assets/svg/more-compatible.svg":Sb,"../../../../assets/svg/more-cycle.svg":Cb,"../../../../assets/svg/moxingshezhi.svg":wb,"../../../../assets/svg/multimode-box.svg":xb,"../../../../assets/svg/nav-chat.svg":bb,"../../../../assets/svg/nav-doc.svg":yb,"../../../../assets/svg/nav-explore.svg":mb,"../../../../assets/svg/nav-find.svg":_b,"../../../../assets/svg/nav-library.svg":gb,"../../../../assets/svg/nav-robot.svg":vb,"../../../../assets/svg/nav-search.svg":hb,"../../../../assets/svg/network.svg":pb,"../../../../assets/svg/official-trigger-node.svg":fb,"../../../../assets/svg/official_account_ai_comment.svg":cb,"../../../../assets/svg/official_account_batch_send.svg":db,"../../../../assets/svg/official_custom_menu.svg":ub,"../../../../assets/svg/open-ai.svg":lb,"../../../../assets/svg/ordinary-segmentation.svg":ab,"../../../../assets/svg/out-the-box.svg":sb,"../../../../assets/svg/output.svg":rb,"../../../../assets/svg/paper-airplane-new.svg":ib,"../../../../assets/svg/paper-airplane.svg":ob,"../../../../assets/svg/parameter-extraction-node.svg":nb,"../../../../assets/svg/payment.svg":tb,"../../../../assets/svg/pc.svg":eb,"../../../../assets/svg/pdf-img.svg":Q1,"../../../../assets/svg/pdf-ocr.svg":Z1,"../../../../assets/svg/pdf-text.svg":J1,"../../../../assets/svg/phone.svg":K1,"../../../../assets/svg/plugin-node-type.svg":Y1,"../../../../assets/svg/plus.svg":W1,"../../../../assets/svg/point-h.svg":X1,"../../../../assets/svg/problem-optimization-node.svg":G1,"../../../../assets/svg/problem-optimization.svg":q1,"../../../../assets/svg/prompt-icon.svg":z1,"../../../../assets/svg/put-away.svg":U1,"../../../../assets/svg/qa-feedback.svg":H1,"../../../../assets/svg/question-node.svg":V1,"../../../../assets/svg/quick-Instruction.svg":j1,"../../../../assets/svg/quote-file.svg":F1,"../../../../assets/svg/quotes.svg":I1,"../../../../assets/svg/recommendation.svg":L1,"../../../../assets/svg/reply-content-image-text.svg":B1,"../../../../assets/svg/reply-content-image.svg":R1,"../../../../assets/svg/reply-content-link.svg":P1,"../../../../assets/svg/reply-content-smart.svg":$1,"../../../../assets/svg/reply-content-text.svg":T1,"../../../../assets/svg/reply-content.svg":M1,"../../../../assets/svg/reply-settings.svg":N1,"../../../../assets/svg/retail.svg":O1,"../../../../assets/svg/reward-points.svg":A1,"../../../../assets/svg/right-fork-icon.svg":D1,"../../../../assets/svg/robot_auto_reply.svg":E1,"../../../../assets/svg/robot_payment.svg":k1,"../../../../assets/svg/robot_smart_menu.svg":S1,"../../../../assets/svg/robot_subscribe_reply.svg":C1,"../../../../assets/svg/save-draft.svg":w1,"../../../../assets/svg/sdk.svg":x1,"../../../../assets/svg/search-check-icon.svg":b1,"../../../../assets/svg/search-right.svg":y1,"../../../../assets/svg/search-tip.svg":m1,"../../../../assets/svg/search.svg":_1,"../../../../assets/svg/segmentation-down.svg":g1,"../../../../assets/svg/segmentation-icon.svg":v1,"../../../../assets/svg/segmentation-up.svg":h1,"../../../../assets/svg/segmentation.svg":p1,"../../../../assets/svg/select-disabled.svg":f1,"../../../../assets/svg/semantic-segmentation.svg":c1,"../../../../assets/svg/sensitive-icon.svg":d1,"../../../../assets/svg/seo-gray.svg":u1,"../../../../assets/svg/seo-highlight.svg":l1,"../../../../assets/svg/seo-light.svg":a1,"../../../../assets/svg/session-record.svg":s1,"../../../../assets/svg/session-trigger-node.svg":r1,"../../../../assets/svg/session.svg":i1,"../../../../assets/svg/set-keywords.svg":o1,"../../../../assets/svg/set_model.svg":n1,"../../../../assets/svg/setting.svg":t1,"../../../../assets/svg/share.svg":e1,"../../../../assets/svg/similarity.svg":Q0,"../../../../assets/svg/skii.svg":Z0,"../../../../assets/svg/smart-add.svg":J0,"../../../../assets/svg/smart-delete.svg":K0,"../../../../assets/svg/smart-menu.svg":Y0,"../../../../assets/svg/source-energy.svg":W0,"../../../../assets/svg/specify-reply-node.svg":X0,"../../../../assets/svg/start-node.svg":G0,"../../../../assets/svg/statistical-analysis.svg":q0,"../../../../assets/svg/status-fail.svg":z0,"../../../../assets/svg/status-sending.svg":U0,"../../../../assets/svg/status-success.svg":H0,"../../../../assets/svg/steps-success-icon.svg":V0,"../../../../assets/svg/subscribe-reply.svg":j0,"../../../../assets/svg/success.svg":F0,"../../../../assets/svg/suggested-issues.svg":I0,"../../../../assets/svg/support.svg":L0,"../../../../assets/svg/switch-mobile.svg":B0,"../../../../assets/svg/system-setting.svg":R0,"../../../../assets/svg/table-expand.svg":P0,"../../../../assets/svg/table-hide.svg":$0,"../../../../assets/svg/team-manage-active.svg":T0,"../../../../assets/svg/team-manage.svg":M0,"../../../../assets/svg/team-manage2.svg":N0,"../../../../assets/svg/tengxunhunyuan.svg":O0,"../../../../assets/svg/test-active-menu-icon.svg":A0,"../../../../assets/svg/test-menu-icon.svg":D0,"../../../../assets/svg/test_robot.svg":E0,"../../../../assets/svg/think.svg":k0,"../../../../assets/svg/timing-trigger-node.svg":S0,"../../../../assets/svg/tip-icon.svg":C0,"../../../../assets/svg/tongyiqianwen.svg":w0,"../../../../assets/svg/unit.svg":x0,"../../../../assets/svg/unknown-issue.svg":b0,"../../../../assets/svg/unknown-prompt.svg":y0,"../../../../assets/svg/use-token-active.svg":m0,"../../../../assets/svg/use-token.svg":_0,"../../../../assets/svg/user-icon.svg":g0,"../../../../assets/svg/variable-assignment-node.svg":v0,"../../../../assets/svg/variable-icon.svg":h0,"../../../../assets/svg/vector-icon.svg":p0,"../../../../assets/svg/voice-clone-node.svg":f0,"../../../../assets/svg/voice-synthesis-node.svg":c0,"../../../../assets/svg/webhook-trigger-node.svg":d0,"../../../../assets/svg/wenxinyiyan.svg":u0,"../../../../assets/svg/workflow-robot-icon.svg":l0,"../../../../assets/svg/workflow.svg":a0,"../../../../assets/svg/wx-app-icon.svg":s0,"../../../../assets/svg/xitongtishici.svg":r0,"../../../../assets/svg/xunfeixinghuo.svg":i0,"../../../../assets/svg/yuezhianmian.svg":o0,"../../../../assets/svg/zhipuai.svg":n0,"../../../../assets/svg/zm-plugins-node.svg":t0,"../../../../assets/svg/zm-workflow-node.svg":e0})[`../../../../assets/svg/${g}.svg`],import.meta.url).href,u=Xe(()=>l(s.iconName)),c=G(s.title),f=()=>{a&&clearTimeout(a),a=setTimeout(()=>{t(c.value),r("changeTitle")},250)},p=()=>{o(),r("deleteNode")},h=()=>{i()};return(g,m)=>{const _=ln,v=Nn,b=Lr,C=Br,M=Ir;return w(),R("div",ok,[d("div",ik,[d("div",rk,[gi(g.$slots,"node-icon",{},()=>[u.value?(w(),R("img",{key:0,class:"node-icon",src:u.value},null,8,sk)):ie("",!0)],!0)]),d("div",ak,[y(_,{class:"node-name-input",value:c.value,"onUpdate:value":m[0]||(m[0]=O=>c.value=O),placeholder:"请输入节点名称",onChange:St(f,["stop"])},null,8,["value"])]),d("div",lk,[gi(g.$slots,"runBtn",{},void 0,!0),n.hideMenus?ie("",!0):(w(),Q(M,{key:0},{overlay:x(()=>[y(C,{style:{width:"100px"}},{default:x(()=>[y(b,{onClick:m[2]||(m[2]=O=>p())},{default:x(()=>[...m[3]||(m[3]=[d("a",{href:"javascript:;"},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"action-btn delete-btn",onClick:m[1]||(m[1]=St(()=>{},["prevent"]))},[y(v,{name:"point-h",class:"btn-icon"})])]),_:1})),d("div",{class:"action-btn close-btn",onClick:h},[y(K(pg),{class:"btn-icon",style:{"font-size":"12px"}})])])]),d("div",uk,[gi(g.$slots,"desc",{},()=>[U(j(s.desc),1)],!0)])])}}},fn=Te(dk,[["__scopeId","data-v-f867eea8"]]),ck="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",fk=$s(),pk=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}],hk={emits:["close","update-node"],inject:["getGraph"],components:{NodeFormLayout:cn,NodeFormHeader:fn,QuestionCircleOutlined:mt,PlusOutlined:Ht},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1,typOptions:[...pk],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let n=JSON.parse(this.node.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list},methods:{update(){let n=JSON.parse(this.node.node_params);n.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(n)};this.$emit("update-node",e)},handleAddTrigger(){fk.getTriggerList(this.$route.query.robot_key,!0),this.getGraph().eventCenter.emit("custom:showTriggerLit")},getTriggerVariables(){let n={};return this.trigger_list.forEach(e=>{(e.outputs||[]).forEach(o=>{n[o.variable]={...o}})}),n},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(n,e){this.formState={...n},this.editIndex=e,this.show=!0},handleDel(n){this.getTriggerVariables();let e=this.getTriggerVariables(),t=this.diy_global[n];if(e["global."+t.key])return xt.error("该变量被触发器关联，请先解除关联");this.diy_global.splice(n,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},vk={class:"start-node-form"},gk={class:"add-trigger-box"},_k={class:"node-form-content"},mk={class:"start-node"},yk={class:"start-node-options"},bk={class:"options-title"},xk={class:"options-item-body"},wk={class:"option-label"},Ck={class:"option-type"},Sk={class:"item-actions-box"},kk={class:"action-items-box"};function Ek(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("PlusOutlined"),l=Kt,u=Nt("QuestionCircleOutlined"),c=Qt,f=Nn,p=ln,h=kn,g=Vt,m=It,_=Ri,v=Bi,b=wn,C=vn,M=Nt("NodeFormLayout");return w(),Q(M,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:x(()=>[...e[5]||(e[5]=[d("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",vk,[d("div",gk,[y(l,{type:"primary",ghost:"",onClick:St(r.handleAddTrigger,["stop"])},{icon:x(()=>[y(a)]),default:x(()=>[e[6]||(e[6]=d("span",null,"添加触发器",-1))]),_:1},8,["onClick"]),e[7]||(e[7]=d("div",{class:"add-trigger-desc"},"添加触发器后支持定时或者外部事件触发工作流",-1))]),d("div",_k,[d("div",mk,[d("div",yk,[d("div",bk,[e[9]||(e[9]=d("div",null,[d("img",{src:ck,alt:"",class:"title-icon"}),d("span",null,"自定义全局变量")],-1)),d("div",null,[y(c,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:x(()=>[...e[8]||(e[8]=[d("div",null,[U(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),d("br"),U(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),d("br"),U(" 2、通过api访问时，可以再API中传递参数值"),d("br"),U(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])]),default:x(()=>[y(u,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(w(!0),R(ae,null,ye(i.diy_global,(O,k)=>(w(),R("div",{class:Ct(["options-item diy-options-item",{"is-required":O.required}]),key:O.key},[d("div",xk,[d("div",wk,j(O.key),1),d("div",Ck,j(O.typ),1)]),d("div",Sk,[y(f,{class:"action-btn",name:"edit-02",onClick:E=>r.handleEdit(O,k)},null,8,["onClick"]),y(f,{class:"action-btn",name:"close-circle",onClick:E=>r.handleDel(k)},null,8,["onClick"])])],2))),128)),d("div",kk,[y(l,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:r.handleAdd},{icon:x(()=>[y(a)]),default:x(()=>[e[10]||(e[10]=U(" 添加全局变量 ",-1))]),_:1},8,["onClick"])])]),y(C,{open:i.show,"onUpdate:open":e[4]||(e[4]=O=>i.show=O),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:r.handleOk},{default:x(()=>[y(b,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:x(()=>[y(h,{label:"变量名",name:"key"},{default:x(()=>[y(p,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=O=>i.formState.key=O),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),y(h,{label:"类型",name:"typ"},{default:x(()=>[y(m,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=O=>i.formState.typ=O)},{default:x(()=>[(w(!0),R(ae,null,ye(i.typOptions,O=>(w(),Q(g,{value:O.value,key:O.value},{default:x(()=>[d("span",null,j(O.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),y(h,{label:"必填",name:"required"},{default:x(()=>[y(_,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=O=>i.formState.required=O)},null,8,["checked"])]),_:1}),y(h,{label:"描述",name:"desc"},{default:x(()=>[y(v,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=O=>i.formState.desc=O),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const Dk=Te(hk,[["render",Ek],["__scopeId","data-v-7a015c60"]]),Ak={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(n){n&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(n){const e=[],t=[],o=(i,r)=>{if(!i||i.length===0)return!1;for(let s=0;s<i.length;s++){const a=i[s],l=a[this.valueKey];if(l===n)return e[r]=a,t[r]=l,!0;if(a[this.childrenKey]&&a[this.childrenKey].length>0){if(e[r]=a,t[r]=l,o(a[this.childrenKey],r+1))return!0;e[r]=null,t[r]=null}}return!1};o(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(n){if(!n||n.length===0)return;const e=[];let t=this.options;for(let o=0;o<n.length;o++){const i=n[o],r=t.find(s=>s[this.valueKey]===i);if(r)e.push(r),t=r[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let n=0;n<this.selectedPath.length;n++){const e=this.selectedPath[n];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:n+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(n,e,t){this.hasChildren(n)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(n),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(n[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(n)&&this.activePath.push({title:n[this.labelKey],options:n[this.childrenKey],level:e+1}),this.$emit("select",n,this.selectedPath,e),(this.checkAnyLevel&&!this.isClickRight&&e>0||!this.hasChildren(n))&&(this.$emit("change",n[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:n[this.valueKey])),this.isClickRight=!1},isActive(n,e){return!this.selectedPath||this.selectedPath.length<=e?!1:n[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(n){return n[this.childrenKey]&&n[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const n=this.$el;if(!n)return;const e=n.getBoundingClientRect(),t=window.innerWidth,o=180;e.right+o>t&&e.left>o?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",o)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",o))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},Ok={class:"cascade-panel"},Nk={class:"cascade-panel-body"},Mk=["onClick"],Tk={class:"item-content"},$k={class:"item-label"},Pk={key:0,class:"cascade-panel-empty"};function Rk(n,e,t,o,i,r){return w(),R("div",Ok,[d("div",{class:Ct(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(w(!0),R(ae,null,ye(i.activePath,(s,a)=>(w(),R("div",{class:"cascade-panel-list",key:a},[d("div",Nk,[(w(!0),R(ae,null,ye(s.options,l=>(w(),R("div",{class:Ct(["cascade-panel-item",{active:r.isActive(l,a)}]),key:l.value,onClick:u=>r.handleSelect(l,a,u)},[d("div",Tk,[d("span",$k,j(l.label),1),r.hasChildren(l)?(w(),R("span",{key:0,class:"item-icon",onClick:e[0]||(e[0]=(...u)=>r.handleRightClick&&r.handleRightClick(...u))},[...e[1]||(e[1]=[d("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[d("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):ie("",!0)])],10,Mk))),128)),s.options&&s.options.length===0?(w(),R("div",Pk," 暂无数据 ")):ie("",!0)])]))),128))],2)])}const Og=Te(Ak,[["render",Rk],["__scopeId","data-v-e9d3b944"]]),Ng=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...Ng(t.children)):e.push(t)}),e},Bk={name:"JMention",components:{CascadePanel:Og},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(n){n.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(n){n.target.closest(".dropdown-list")&&n.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(n){this.$emit("open",n)},getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){const n=this.$refs.JMention;if(!n)return;let e=n.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t.trim(),i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=Ng(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize(),i=window.innerWidth,r=window.innerHeight;let s=t.bottom,a=t.left;return s+o.height>r&&(s=t.top-o.height),a+o.width>i&&(a=t.right-o.width),s<0&&(s=0),a<0&&(a=0),{top:s,left:a}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(n){this.handleDropdownLogic(n),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(n){const e=this.getLastChar();if(n.inputType==="deleteContentBackward"&&!this.atText)e!="/"&&(this.showDropdown=!1);else if(e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const r=this.checkStartWith(i);i&&(this.showDropdown=r)}if(!this.showDropdown)return;const{top:t,left:o}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${o}px; top:${t}px;`},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,u=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,u=c;break}c=c.previousSibling}}if(u.nodeType===Node.TEXT_NODE){u.replaceData(l,t,"");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const p in e)c.dataset[p]=e[p];const f=document.createRange();f.setStart(u,l),f.insertNode(c),r.setStartAfter(c),r.setEndAfter(c),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())},handleDirectionChange(n,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),o=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!o)return;const i=parseFloat(t[1]),r=parseFloat(o[1]);let s;n==="left"?s=i-e:s=i+e,this.positionStyle=`left:${s}px; top:${r}px;`}}},Lk={style:{width:"100%",position:"relative"}},Ik={class:"mention-input-warpper",ref:"JMentionContainer"},Fk=["placeholder"],jk={key:0,class:"placeholder"};function Vk(n,e,t,o,i,r){const s=Nt("CascadePanel");return w(),R("div",Lk,[e[4]||(e[4]=d("div",null,null,-1)),(w(),Q(ag,{to:"body"},[i.showDropdown?(w(),R("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:In(i.positionStyle)},[y(s,{options:i.showOptions,checkAnyLevel:t.checkAnyLevel,onChange:r.onSelectOption,onDirectionChange:r.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):ie("",!0)])),d("div",Ik,[d("div",{ref:"JMention",style:In([t.inputStyle]),class:Ct(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onFocus:e[0]||(e[0]=(...a)=>r.onFocus&&r.onFocus(...a)),onInput:e[1]||(e[1]=(...a)=>r.debouncedUpdate&&r.debouncedUpdate(...a)),onClick:e[2]||(e[2]=(...a)=>r.clickJMention&&r.clickJMention(...a)),onBlur:e[3]||(e[3]=(...a)=>r.handleBlur&&r.handleBlur(...a))},null,46,Fk),i.localValue.length==0?(w(),R("span",jk,j(t.placeholder),1)):ie("",!0)],512)])}const ot=Te(Bk,[["render",Vk],["__scopeId","data-v-5435d0eb"]]),Hk={class:"problem-optimization-form"},Uk={class:"gray-block"},zk={class:"flex-block-item"},qk={class:"number-box"},Gk={class:"number-slider-box"},Xk={class:"number-input-box"},Wk={class:"number-box"},Yk={class:"number-slider-box"},Kk={class:"number-input-box"},Jk={class:"number-box"},Zk={class:"number-box"},Qk={class:"number-slider-box"},eE={class:"number-input-box"},tE={class:"field-list-item"},nE={class:"field-label"},oE={class:"field-type"},iE={class:"diy-form-item"},rE={class:"form-content"},sE={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=jn(),r=G(null),s=Xe(()=>i.modelList),a=G([]),l=G([]),u=G(!1),c=()=>{u.value=!u.value},f=($,B)=>{v.prompt=$,v.prompt_tags=B};function p(){const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();l.value=h(B)}}function h($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=h(B.children))}),$}const g=()=>{const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();a.value=B}};function m($){if($){let B=$.split("."),A=B[0],D=B.filter((T,F)=>F>0).join(".");return[A,D]}return["global","question"]}const _=G(),v=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),b=()=>{const $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.stringify({question_optimize:JSON.parse($).question_optimize||{}}),A=JSON.stringify({question_optimize:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}});B!=A&&t("update-node",{...o.node,...v,node_params:A})},C=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).question_optimize||{};B=JSON.parse(JSON.stringify(B));let{model_config_id:A,use_model:D,context_pair:T,temperature:F,max_token:V,prompt:P,prompt_tags:X,question_value:oe,enable_thinking:H}=B;g(),p(),v.model_config_id=A,v.use_model=D,v.context_pair=T||0,v.temperature=F,v.max_token=V,v.prompt=P,v.enable_thinking=H,v.prompt_tags=X||[],v.question_value=m(oe),!v.model_config_id&&s.value.length>0&&(v.model_config_id=s.value[0].id,v.use_model=s.value[0].children[0].name)}catch($){}};gt(()=>v,()=>{b()},{deep:!0});const M=G(null),O=$=>{v.prompt="",$.prompt_type==1?v.prompt=$.markdown:v.prompt=$.prompt,Pt(()=>{r.value.initData()})},k=$=>{$||p()},E=G({}),S=($,B)=>{E.value=B},N=Xe(()=>{if(!v.model_config_id)return!1;let $=v.model_config_id+"#"+v.use_model;return E.value[$]}),L=()=>{t("close")};return ut(()=>{C()}),($,B)=>{const A=Kt,D=kn,T=Qt,F=Ns,V=Vn,P=$n,X=Ri,oe=oi,H=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",Hk,[d("div",{class:"node-form-content",onMousedown:B[11]||(B[11]=St(()=>{},["stop"]))},[y(H,{ref_key:"formRef",ref:_,layout:"vertical",model:v},{default:x(()=>[d("div",Uk,[B[24]||(B[24]=d("div",{class:"gray-block-title"},"输入",-1)),y(D,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",zk,[y(rr,{modelType:"LLM",modeName:v.use_model,"onUpdate:modeName":B[0]||(B[0]=W=>v.use_model=W),modeId:v.model_config_id,"onUpdate:modeId":B[1]||(B[1]=W=>v.model_config_id=W),onLoaded:S,style:{width:"348px"}},null,8,["modeName","modeId"]),y(A,{onClick:c},{default:x(()=>[B[12]||(B[12]=U("高级设置 ",-1)),u.value?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Ha),{key:1}))]),_:1})])]),_:1}),u.value?(w(),Q(D,{key:0,name:"temperature"},{label:x(()=>[B[14]||(B[14]=d("span",null,"温度 ",-1)),y(T,null,{title:x(()=>[...B[13]||(B[13]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",qk,[d("div",Gk,[y(V,null,{default:x(()=>[y(F,{class:"custom-slider",value:v.temperature,"onUpdate:value":B[2]||(B[2]=W=>v.temperature=W),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",Xk,[y(P,{value:v.temperature,"onUpdate:value":B[3]||(B[3]=W=>v.temperature=W),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),u.value?(w(),Q(D,{key:1,name:"max_token"},{label:x(()=>[B[16]||(B[16]=d("span",null,"最大token ",-1)),y(T,null,{title:x(()=>[...B[15]||(B[15]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Wk,[d("div",Yk,[y(V,null,{default:x(()=>[y(F,{class:"custom-slider",value:v.max_token,"onUpdate:value":B[4]||(B[4]=W=>v.max_token=W),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",Kk,[y(P,{value:v.max_token,"onUpdate:value":B[5]||(B[5]=W=>v.max_token=W),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),u.value&&N.value?(w(),Q(D,{key:2,name:"enable_thinking"},{label:x(()=>[B[18]||(B[18]=d("span",null,"深度思考 ",-1)),y(T,null,{title:x(()=>[...B[17]||(B[17]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Jk,[y(X,{checked:v.enable_thinking,"onUpdate:checked":B[6]||(B[6]=W=>v.enable_thinking=W)},null,8,["checked"])])]),_:1})):ie("",!0),y(D,{name:"context_pair"},{label:x(()=>[B[20]||(B[20]=d("span",null,"上下文数量 ",-1)),y(T,null,{title:x(()=>[...B[19]||(B[19]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Zk,[d("div",Qk,[y(V,null,{default:x(()=>[y(F,{class:"custom-slider",value:v.context_pair,"onUpdate:value":B[7]||(B[7]=W=>v.context_pair=W),min:0,max:50},null,8,["value"])]),_:1})]),d("div",eE,[y(P,{value:v.context_pair,"onUpdate:value":B[8]||(B[8]=W=>v.context_pair=W),min:0,max:50},null,8,["value"])])])]),_:1}),y(D,{name:"prompt",class:"width-100"},{label:x(()=>[...B[21]||(B[21]=[d("div",{class:"space-between-box"},[d("div",null,"对话背景")],-1)])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:v.prompt_tags,defaultValue:v.prompt,ref_key:"atInputRef",ref:r,onOpen:g,onChange:B[9]||(B[9]=(W,Z)=>f(W,Z)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:x(({label:W,payload:Z})=>[d("div",tE,[d("div",nE,j(W),1),d("div",oE,j(Z.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),B[22]||(B[22]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",iE,[B[23]||(B[23]=d("div",{class:"form-label"},"用户问题",-1)),d("div",rE,[y(oe,{value:v.question_value,"onUpdate:value":B[10]||(B[10]=W=>v.question_value=W),onDropdownVisibleChange:k,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:W})=>W.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),B[25]||(B[25]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"问题优化结果"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),y(yg,{onOk:O,ref_key:"importPromptRef",ref:M},null,512)],32)])]),_:1})}}},aE=Te(sE,[["__scopeId","data-v-1885fba6"]]),lE={class:"input-box"},uE={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(n,{expose:e,emit:t}){const o=G(!1),i=t;gt(()=>o.value,f=>{f||i("ok")});const r=n,s=G(null),a=()=>{o.value=!0,Pt(()=>{s.value.refresh()})},l=f=>{i("open",f)},u=(f,p)=>{i("change",f,p)},c=()=>{o.value=!1};return e({show:a}),(f,p)=>{const h=Kt,g=vn;return w(),R("div",null,[y(g,{open:o.value,"onUpdate:open":p[1]||(p[1]=m=>o.value=m),title:"字段详情",width:746},{footer:x(()=>[y(h,{type:"primary",onClick:c},{default:x(()=>[...p[2]||(p[2]=[U("确定",-1)])]),_:1})]),default:x(()=>[d("div",lE,[y(ot,{inputStyle:"height: 550px;",options:r.options,defaultSelectedList:r.defaultSelectedList,defaultValue:r.defaultValue,placeholder:r.placeholder,type:r.type,ref_key:"atInputRef",ref:s,onOpen:l,onChange:p[0]||(p[0]=(m,_)=>u(m,_))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},jr=Te(uE,[["__scopeId","data-v-62373f0f"]]),dE={class:"problem-optimization-form"},cE={class:"gray-block"},fE={class:"flex-block-item"},pE={class:"number-box"},hE={class:"number-slider-box"},vE={class:"number-input-box"},gE={class:"number-box"},_E={class:"number-slider-box"},mE={class:"number-input-box"},yE={class:"number-box"},bE={class:"number-box"},xE={class:"number-slider-box"},wE={class:"number-input-box"},CE={class:"space-between-box"},SE={class:"field-list-item"},kE={class:"field-label"},EE={class:"field-type"},DE={class:"diy-form-item mt12"},AE={class:"form-content"},OE={class:"gray-block mt16"},NE={class:"diy-form-item question-value-item"},ME={class:"form-content"},TE={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=jn(),s=G(null),a=Xe(()=>r.modelList),l=G([]),u=G([]),c=G(!1),f=G(),p=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),h=()=>{c.value=!c.value},g=(V,P)=>{p.prompt=V,p.prompt_tags=P};function m(){let V=i().getAllParentVariable();u.value=v(V)}const _=Xe(()=>u.value.filter(P=>P.node_type==5));function v(V){return V.forEach(P=>{P.typ=="node"?P.node_type==1?P.value="global":P.value=P.node_id:P.value=P.key,P.children&&P.children.length>0&&(P.children=v(P.children))}),V}const b=()=>{let V=i().getAllParentVariable();l.value=V};function C(V){if(V){let P=V.split("."),X=P[0],oe=P.filter((H,W)=>W>0).join(".");return[X,oe]}return["global","question"]}const M=G(null),O=()=>{M.value.show()},k=V=>{p.prompt="",V.prompt_type==1?p.prompt=V.markdown:p.prompt=V.prompt,Pt(()=>{s.value.initData()})},E=G(null),S=()=>{E.value.show()},N=()=>{s.value.refresh()},L=()=>{const V=JSON.stringify({llm:{...p,question_value:p.question_value.join("."),model_config_id:p.model_config_id?+p.model_config_id:p.model_config_id}});t("update-node",{...o.node,...p,node_params:V})},$=()=>{try{let V=o.node.dataRaw||o.node.node_params||"{}",P=JSON.parse(V).llm||{};P=JSON.parse(JSON.stringify(P));let{model_config_id:X,use_model:oe,context_pair:H,temperature:W,max_token:Z,prompt:le,prompt_tags:te,question_value:q,enable_thinking:re,libs_node_key:ce}=P;b(),m(),p.model_config_id=X,p.use_model=oe,p.context_pair=H||0,p.temperature=W,p.max_token=Z,p.prompt=le,p.enable_thinking=re,p.prompt_tags=te||[],p.libs_node_key=ce,p.question_value=C(q),!p.model_config_id&&a.value.length>0&&(p.model_config_id=a.value[0].id,p.use_model=a.value[0].children[0].name)}catch(V){}};gt(()=>p,()=>{L()},{deep:!0});const B=V=>{V||m()},A=G({}),D=(V,P)=>{A.value=P},T=Xe(()=>{if(!p.model_config_id)return!1;let V=p.model_config_id+"#"+p.use_model;return A.value[V]}),F=()=>{t("close")};return ut(()=>{$()}),(V,P)=>{const X=Kt,oe=kn,H=Qt,W=Ns,Z=Vn,le=$n,te=Ri,q=ii,re=Vt,ce=It,ve=oi,Ne=wn,ge=yg;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:F},null,8,["title","iconName"])]),default:x(()=>[d("div",dE,[d("div",{class:"node-form-content",onMousedown:P[12]||(P[12]=St(()=>{},["stop"]))},[y(Ne,{ref_key:"formRef",ref:f,layout:"vertical",model:p},{default:x(()=>[d("div",cE,[P[27]||(P[27]=d("div",{class:"gray-block-title"},"大模型设置",-1)),y(oe,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",fE,[y(rr,{modelType:"LLM",modeName:p.use_model,"onUpdate:modeName":P[0]||(P[0]=_e=>p.use_model=_e),modeId:p.model_config_id,"onUpdate:modeId":P[1]||(P[1]=_e=>p.model_config_id=_e),onLoaded:D,style:{width:"348px"}},null,8,["modeName","modeId"]),y(X,{onClick:h},{default:x(()=>[P[14]||(P[14]=U("高级设置 ",-1)),c.value?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Ha),{key:1}))]),_:1})])]),_:1}),c.value?(w(),Q(oe,{key:0,name:"temperature"},{label:x(()=>[P[16]||(P[16]=d("span",null,"温度 ",-1)),y(H,null,{title:x(()=>[...P[15]||(P[15]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",pE,[d("div",hE,[y(Z,null,{default:x(()=>[y(W,{class:"custom-slider",value:p.temperature,"onUpdate:value":P[2]||(P[2]=_e=>p.temperature=_e),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",vE,[y(le,{value:p.temperature,"onUpdate:value":P[3]||(P[3]=_e=>p.temperature=_e),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),c.value?(w(),Q(oe,{key:1,name:"max_token"},{label:x(()=>[P[18]||(P[18]=d("span",null,"最大token ",-1)),y(H,null,{title:x(()=>[...P[17]||(P[17]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",gE,[d("div",_E,[y(Z,null,{default:x(()=>[y(W,{class:"custom-slider",value:p.max_token,"onUpdate:value":P[4]||(P[4]=_e=>p.max_token=_e),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",mE,[y(le,{value:p.max_token,"onUpdate:value":P[5]||(P[5]=_e=>p.max_token=_e),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),c.value&&T.value?(w(),Q(oe,{key:2,name:"enable_thinking"},{label:x(()=>[P[20]||(P[20]=d("span",null,"深度思考 ",-1)),y(H,null,{title:x(()=>[...P[19]||(P[19]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",yE,[y(te,{checked:p.enable_thinking,"onUpdate:checked":P[6]||(P[6]=_e=>p.enable_thinking=_e)},null,8,["checked"])])]),_:1})):ie("",!0),y(oe,{name:"context_pair"},{label:x(()=>[P[22]||(P[22]=d("span",null,"上下文数量 ",-1)),y(H,null,{title:x(()=>[...P[21]||(P[21]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",bE,[d("div",xE,[y(Z,null,{default:x(()=>[y(W,{class:"custom-slider",value:p.context_pair,"onUpdate:value":P[7]||(P[7]=_e=>p.context_pair=_e),min:0,max:50},null,8,["value"])]),_:1})]),d("div",wE,[y(le,{value:p.context_pair,"onUpdate:value":P[8]||(P[8]=_e=>p.context_pair=_e),min:0,max:50},null,8,["value"])])])]),_:1}),y(oe,{name:"prompt",class:"width-100"},{label:x(()=>[d("div",CE,[P[24]||(P[24]=d("div",null,"提示词",-1)),y(q,{gap:8},{default:x(()=>[d("div",{class:"btn-hover-wrap",onClick:O},[y(K(my)),P[23]||(P[23]=U("从提示词库导入 ",-1))]),d("div",{class:"btn-hover-wrap",onClick:S},[y(K(Ko))])]),_:1})])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,ref_key:"atInputRef",ref:s,onOpen:b,onChange:P[9]||(P[9]=(_e,st)=>g(_e,st)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:_e,payload:st})=>[d("div",SE,[d("div",kE,j(_e),1),d("div",EE,j(st.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),P[25]||(P[25]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",DE,[P[26]||(P[26]=d("div",{class:"form-label"},"知识库引用",-1)),d("div",AE,[y(ce,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:B,value:p.libs_node_key,"onUpdate:value":P[10]||(P[10]=_e=>p.libs_node_key=_e),style:{width:"220px"}},{default:x(()=>[(w(!0),R(ae,null,ye(_.value,_e=>(w(),Q(re,{value:_e.node_id,key:_e.node_id},{default:x(()=>[U(j(_e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),d("div",OE,[P[29]||(P[29]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",NE,[P[28]||(P[28]=d("div",{class:"form-label"},"输入",-1)),d("div",ME,[y(ve,{value:p.question_value,"onUpdate:value":P[11]||(P[11]=_e=>p.question_value=_e),onDropdownVisibleChange:B,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),P[30]||(P[30]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"AI回复内容"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"])],32),y(ge,{onOk:k,ref_key:"importPromptRef",ref:M},null,512),y(jr,{options:l.value,defaultSelectedList:p.prompt_tags,defaultValue:p.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:b,onChange:P[13]||(P[13]=(_e,st)=>g(_e,st)),onOk:N,ref_key:"fullAtInputRef",ref:E},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},$E=Te(TE,[["__scopeId","data-v-e5c68c53"]]),Zn="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",sr=sg("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(n=>{this.formListQueue.push(n)});this.formListLoading=!0;try{const n=await mw();this.formList=n.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(n){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:n}){if(this.formFieldListMap[n]&&this.formFieldListMap[n].length>0)return[...this.formFieldListMap[n]];if(this.formFieldListLoadingMap[n])return new Promise(e=>{this.formFieldListQueueMap[n]||(this.formFieldListQueueMap[n]=[]),this.formFieldListQueueMap[n].push(e)});this.formFieldListLoadingMap[n]=!0;try{const e=await _w({form_id:n});this.formFieldListMap[n]=e.data||[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}catch(e){this.formFieldListMap[n]=[];const t=[...this.formFieldListMap[n]];return this.formFieldListQueueMap[n]&&(this.formFieldListQueueMap[n].forEach(o=>o(t)),this.formFieldListQueueMap[n]=[]),t}finally{this.formFieldListLoadingMap[n]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:n}){return this.formFieldListMap[n]=[],this.formFieldListLoadingMap[n]=!1,this.formFieldListQueueMap[n]=[],await this.getFormFieldList({form_id:n})}}}),PE={class:"field-select-box"},RE={key:0,class:"field-list-box"},BE={key:1,class:"empty-box"},LE={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=sr(),r=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),s=G([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),a=G([]),l=(g,m)=>{r.selectedRowKeys=g,r.selectedRows=m},u=({formId:g,selectedRowKeys:m,selectedRows:_})=>{r.formId=g,r.selectedRowKeys=m,r.selectedRows=_,h(),r.show=!0},c=()=>{window.open("/#/database/details/field-manage?form_id="+r.formId)},f=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1},p=G(!1),h=()=>{p.value=!0,i.getFormFieldList({form_id:r.formId}).then(g=>{p.value=!1,g.forEach(m=>{m.value="",m.id=m.id*1}),a.value=g}).catch(()=>{p.value=!1})};return e({open:u}),(g,m)=>{const _=Ms,v=vn;return w(),Q(v,{width:"746px",open:r.show,"onUpdate:open":m[0]||(m[0]=b=>r.show=b),title:"关联数据表",onOk:f,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",PE,[a.value.length?(w(),R("div",RE,[y(_,{rowKey:"name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:l},dataSource:a.value,columns:s.value,loading:p.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ie("",!0),a.value.length?ie("",!0):(w(),R("div",BE,[m[2]||(m[2]=d("img",{src:qa,alt:""},null,-1)),d("div",null,[m[1]||(m[1]=U(" 暂无字段, 请先去数据表添加 ",-1)),d("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},IE=Te(LE,[["__scopeId","data-v-226c889a"]]),FE={class:"field-list"},jE={class:"field-list-row"},VE={key:0,class:"field-list-col field-list-col-head field-value-head"},HE={key:1,class:"field-list-col field-list-col-head field-del-head"},UE={key:0,class:"field-list-row"},zE={class:"field-list-col field-value-col"},qE={class:"field-list-col field-name-col"},GE={class:"field-list-col field-type-col"},XE={key:0,class:"field-list-col field-value-col"},WE={key:1,class:"field-list-col field-del-col"},YE=["onClick"],KE={key:0,class:"add-btn-box"},JE={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:o.list});gt(()=>o.list,m=>{r.list=m});const s=G([]),a=()=>{let m=i().getAllParentVariable();s.value=m||[]},l=()=>{a()},u=(m,_,v,b)=>{r.list[b].value=m,r.list[b].atTags=_,p()},c=(m,_)=>{r.list=[..._],p()},f=m=>{r.list.splice(m,1),p()},p=()=>{t("change",[...r.list])},h=G(),g=()=>{h.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(m=>m.name)})};return ut(()=>{a()}),(m,_)=>{const v=ln,b=Qt,C=Nn,M=Kt;return w(),R("div",null,[d("div",FE,[d("div",jE,[_[0]||(_[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),_[1]||(_[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",VE,"字段值")):ie("",!0),o.showDelete?(w(),R("div",HE)):ie("",!0)]),n.showEmptyFieldRow?(w(),R("div",UE,[_[2]||(_[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),_[3]||(_[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",zE,[y(b,{title:"请先选择数据库"},{default:x(()=>[y(v,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),R(ae,null,ye(r.list,(O,k)=>(w(),R("div",{class:"field-list-row",key:O.name},[d("div",qE,j(O.name),1),d("div",GE,j(O.type),1),n.showInput?(w(),R("div",XE,[y(ot,{options:s.value,defaultValue:O.value,defaultSelectedList:O.atTags,onOpen:l,onChange:(E,S)=>u(E,S,O,k),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):ie("",!0),o.showDelete?(w(),R("div",WE,[d("span",{class:"del-btn",onClick:E=>f(k)},[y(C,{class:"del-icon",name:"close-circle"})],8,YE)])):ie("",!0)]))),128))]),o.showAdd?(w(),R("div",KE,[y(M,{class:"add-btn",type:"dashed",block:"",onClick:g},{default:x(()=>[y(K(Ht)),_[4]||(_[4]=U(" 添加更新字段",-1))]),_:1})])):ie("",!0),y(IE,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:h,onOk:c},null,8,["formId"])])}}},nf=Te(JE,[["__scopeId","data-v-8972aaa9"]]),ZE={class:"library-checkbox-box"},QE={class:"list-box",ref:"scrollContainer"},e3={class:"library-name"},t3={class:"library-desc"},n3={key:1,class:"empty-box"},o3={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=G(),s=G(!1),a=f=>{r.value=f,s.value=!0},l=()=>{s.value=!1,u()},u=()=>{let f=i.options.filter(p=>p.id===r.value);o("ok",r.value,JSON.parse(JSON.stringify(f[0])))},c=()=>{window.open("/#/database/list")};return e({open:a}),(f,p)=>{const h=Ii,g=Li,m=vn;return w(),Q(m,{width:"746px",open:s.value,"onUpdate:open":p[1]||(p[1]=_=>s.value=_),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:l},{default:x(()=>[d("div",ZE,[n.options.length?(w(),Q(g,{key:0,value:r.value,"onUpdate:value":p[0]||(p[0]=_=>r.value=_),style:{width:"100%"}},{default:x(()=>[d("div",QE,[(w(!0),R(ae,null,ye(i.options,_=>(w(),R("div",{class:"list-item-wraapper",key:_.id},[y(h,{class:"list-item",value:_.id},{default:x(()=>[d("div",e3,j(_.name),1),d("div",t3,j(_.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):ie("",!0),n.options.length?ie("",!0):(w(),R("div",n3,[p[3]||(p[3]=d("img",{src:qa,alt:""},null,-1)),d("div",null,[p[2]||(p[2]=U(" 暂无数据表, 请先去添加数据表 ",-1)),d("a",{onClick:c}," 去添加")])]))])]),_:1},8,["open"])}}},i3=Te(o3,[["__scopeId","data-v-51756847"]]),r3={class:""},s3={key:0,class:"data-table-info"},a3={class:"data-table-name"},l3={class:"data-table-desc"},u3={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:e}){const t=e,o=n,i=G(null),r=Xe(()=>{let u=o.options.filter(c=>c.id===o.value);return u.length?u[0]:null}),s=()=>{i.value.open()},a=(u,c)=>{t("update:value",u),t("change",u,c)},l=()=>{t("update:value",""),t("change","")};return(u,c)=>{const f=Nn,p=Kt;return w(),R("div",r3,[o.value?(w(),R("div",s3,[d("div",a3,j(r.value?r.value.name:o.title),1),d("div",l3,j(r.value?r.value.description:o.description),1),y(f,{class:"del-btn",name:"close-circle",onClick:l})])):(w(),Q(p,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:s},{default:x(()=>[y(K(Ht)),c[0]||(c[0]=U(" 选择数据表",-1))]),_:1})),y(i3,{ref_key:"tableSelectAlertRef",ref:i,onOk:a,options:n.options},null,8,["options"])])}}},Fu=Te(u3,[["__scopeId","data-v-618f643f"]]),d3={class:"add-data-form"},c3={class:"node-box-content"},f3={class:"setting-box"},p3={class:"setting-box"},h3={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=sr();let r={};const s=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),a=(h,g)=>{g?(s.formData.form_name=g.name,s.formData.form_description=g.description,p(g.id)):(s.formData.form_name="",s.formData.form_description="",s.formData.datas=[]),c()},l=h=>{s.formData.datas=h,c()},u=()=>{let h=o.node.dataRaw||o.node.node_params||"{}";r=JSON.parse(h),s.formData=r.form_insert,c()},c=()=>{r.form_insert=Bn(s.formData),t("update-node",{...o.node,node_params:JSON.stringify(r)})},f=async()=>{const h=await i.getFormList();s.tableList=h},p=async h=>{i.getFormFieldList({form_id:h}).then(g=>{g.forEach(m=>{m.id=m.id*1}),s.formData.datas=g,c()}).catch(()=>{})};return ut(()=>{f(),u()}),(h,g)=>(w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...g[1]||(g[1]=[d("span",null,[U("在指定数据表中插入数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",d3,[d("div",c3,[g[2]||(g[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),g[3]||(g[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",f3,[y(Fu,{options:s.tableList,title:s.formData.form_name,description:s.formData.form_description,value:s.formData.form_id,"onUpdate:value":g[0]||(g[0]=m=>s.formData.form_id=m),onChange:a},null,8,["options","title","description","value"])]),g[4]||(g[4]=d("div",{class:"setting-label"},[d("span",null,"插入数据"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",p3,[y(nf,{"form-id":s.formData.form_id,showEmptyFieldRow:s.formData.form_id=="",list:s.formData.datas,showAdd:!1,showDelete:!1,onChange:l},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},v3=Te(h3,[["__scopeId","data-v-9c25c5a9"]]),g3={class:"library-checkbox-box"},_3={class:"list-group-box"},m3={class:"group-list-box"},y3={style:{"margin-bottom":"16px"}},b3={class:"classify-box"},x3=["onClick"],w3={class:"classify-title"},C3={class:"right-content"},S3={class:"list-item-box"},k3={class:"alert-box"},E3={class:"btn-box"},D3=["onClick"],A3={class:"avatar-box"},O3=["src"],N3={class:"info-content-box"},M3={class:"title-info-block"},T3={key:0,class:"type-tag"},$3={key:1,class:"type-tag"},P3={key:2,class:"type-tag"},R3={key:3,class:"type-tag"},B3={class:"desc-info-block"},L3={class:"check-block"},I3={class:"footer-box"},F3={__name:"library-select-alert",props:{showWxType:{type:Boolean,default:!1},select_type:{type:String,default:"checkbox"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=jn(),{robotInfo:i}=o,r=t,s=n,a=Je({indeterminate:!1,checkAll:!1,checkedList:[]}),l=G(""),u=G([]),c=()=>{Ym().then(N=>{let L=N.data||[],$=0;L.forEach(B=>{$+=+B.total}),u.value=[{group_name:"全部",total:$,id:""},...L]})},f=N=>{l.value=N.id,M()},p=G(!1),h=N=>{l.value="",M(),c(),a.checkedList=N,p.value=!0},g=()=>{p.value=!1,C()},m=G(""),_=()=>{M()},v=G([]),b=Xe(()=>s.showWxType?v.value:v.value.filter(N=>N.type!=3)),C=()=>{r("change",[...a.checkedList])},M=async()=>{k.value=!0;const N=await ja({library_name:m.value,type:"",show_open_docs:1});if(k.value=!1,N){let L=N.data||[];l.value!=""&&(L=L.filter($=>$.group_id==l.value)),v.value=L}},O=N=>{let L=N.id;a.checkedList.includes(L)?a.checkedList=a.checkedList.filter($=>$!=L):s.select_type=="radio"&&a.checkedList.length>0?a.checkedList=[L]:a.checkedList.push(L)},k=G(!1),E=async()=>{k.value=!0,await M(),k.value=!1,xt.success("刷新完成")},S=()=>{window.open("/#/library/list")};return e({open:h}),(N,L)=>{const $=ln,B=yw,A=Fr,D=Kt,T=vg,F=mo,V=vn;return w(),Q(V,{width:916,open:p.value,"onUpdate:open":L[2]||(L[2]=P=>p.value=P),wrapClassName:"correlation-library-modal",title:null,footer:null},{default:x(()=>[d("div",g3,[d("div",_3,[d("div",m3,[L[3]||(L[3]=d("div",{class:"main-title-block"},"关联知识库",-1)),d("div",y3,[y($,{style:{width:"216px"},value:m.value,"onUpdate:value":L[0]||(L[0]=P=>m.value=P),placeholder:"请输入知识库名称搜索",onChange:_},{suffix:x(()=>[y(K(hg),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),y(B,{style:{"padding-right":"16px",height:"480px"}},{default:x(()=>[d("div",b3,[(w(!0),R(ae,null,ye(u.value,P=>(w(),R("div",{class:Ct(["classify-item",{active:P.id==l.value}]),onClick:X=>f(P),key:P.id},[d("div",w3,j(P.group_name),1),d("div",C3,[d("div",{class:Ct(["num",{"num-block":P.id<=0}])},j(P.total),3)])],10,x3))),128))])]),_:1})]),d("div",S3,[d("div",k3,[y(A,{class:"zm-alert-info",message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"})]),d("div",E3,[y(D,{onClick:E},{default:x(()=>[y(K(yy)),L[4]||(L[4]=U(" 刷新 ",-1))]),_:1}),y(D,{type:"primary",ghost:"",onClick:S},{default:x(()=>[...L[5]||(L[5]=[U("新建知识库",-1)])]),_:1})]),y(F,{spinning:k.value,delay:100},{default:x(()=>[y(B,{style:{padding:"0 16px",height:"414px"}},{default:x(()=>[(w(!0),R(ae,null,ye(b.value,P=>(w(),R("div",{class:"library-list-item",onClick:X=>O(P),key:P.id},[d("div",A3,[d("img",{src:P.avatar,alt:""},null,8,O3)]),d("div",N3,[d("div",M3,[U(j(P.library_name)+" ",1),d("span",{class:Ct(["type-tag",{"gray-tag":P.graph_switch==0}])},"Graph",2),P.type==0?(w(),R("span",T3,"普通知识库")):ie("",!0),P.type==1?(w(),R("span",$3,"对外知识库")):ie("",!0),P.type==2?(w(),R("span",P3,"问答知识库")):ie("",!0),P.type==3?(w(),R("span",R3,"公众号知识库")):ie("",!0)]),d("div",B3,j(P.library_intro),1)]),d("div",L3,[y(T,{checked:a.checkedList.includes(P.id)},null,8,["checked"])])],8,D3))),128))]),_:1})]),_:1},8,["spinning"]),d("div",I3,[y(D,{onClick:L[1]||(L[1]=P=>p.value=!1)},{default:x(()=>[...L[6]||(L[6]=[U("取消",-1)])]),_:1}),y(D,{type:"primary",onClick:g},{default:x(()=>[U(" ("+j(a.checkedList.length)+") 确定",1)]),_:1})])])])])]),_:1},8,["open"])}}},Mg=Te(F3,[["__scopeId","data-v-fa77edc8"]]),j3={class:"recall-settings-box"},V3={class:"form-box"},H3={class:"form-item is-required"},U3={class:"form-item-body"},z3={class:"retrieval-mode-items"},q3=["onClick"],G3={class:"retrieval-mode-title"},X3={class:"title-text"},W3={class:"retrieval-mode-desc"},Y3={key:0,class:"form-item"},K3={class:"form-item"},J3={class:"form-item-label"},Z3={class:"form-item-body"},Q3={class:"number-box"},eD={class:"number-slider-box"},tD={class:"number-input-box"},nD={class:"form-item"},oD={class:"form-item-label"},iD={class:"form-item-body"},rD={class:"number-box"},sD={class:"number-slider-box"},aD={class:"number-input-box"},lD={class:"form-item"},uD={class:"form-item-label"},dD={class:"form-item-body"},cD={class:"form-item"},fD={class:"form-item-label"},pD={key:0,class:"form-item-body"},hD={__name:"recall-settings-alert",emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=G([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),r=Je({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{}}),s=G(!1),a=G([]),l=G([]),u=G({}),c=(_,v=null,b=[])=>{u.value=v,l.value=b,f(),r.rerank_status=_.rerank_status||0,r.rerank_use_model=_.rerank_use_model||void 0,r.rerank_model_config_id=_.rerank_model_config_id||"",r.top_k=_.top_k,r.similarity=_.similarity,r.search_type=_.search_type,r.meta_search_switch=Number(_.meta_search_switch),r.meta_search_type=Number(_.meta_search_type),r.meta_search_condition_list=_.meta_search_condition_list,r.rrf_weight=_.rrf_weight,s.value=!0},f=()=>{let _;l.value.length?_=Km({library_ids:l.value.toString()}):_=Jm({id:u.value.id}),_.then(v=>{a.value=(v==null?void 0:v.data)||[]})},p=_=>{r.search_type=_},h=()=>r.rerank_status==1&&!r.rerank_model_config_id,g=()=>{if(h())return xt.error("请选择Rerank模型");s.value=!1,m()},m=()=>{o("change",Bn(r))};return e({open:c}),(_,v)=>{const b=Nn,C=Qt,M=Ns,O=$n,k=Ri,E=vn;return w(),Q(E,{width:"572px",open:s.value,"onUpdate:open":v[11]||(v[11]=S=>s.value=S),title:"召回设置",onOk:g,okText:"确定",cancelText:"取消"},{default:x(()=>[d("div",j3,[d("div",V3,[d("div",H3,[v[12]||(v[12]=d("div",{class:"form-item-label"},[d("span",null,"检索模式")],-1)),d("div",U3,[d("div",z3,[(w(!0),R(ae,null,ye(i.value,S=>(w(),R("div",{class:Ct(["retrieval-mode-item",{active:r.search_type==S.value}]),key:S.value,onClick:N=>p(S.value)},[r.search_type==S.value?(w(),Q(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):ie("",!0),d("div",G3,[y(b,{name:S.iconName,class:"title-icon"},null,8,["name"]),d("span",X3,j(S.title),1),S.isRecommendation?(w(),Q(b,{key:0,class:"recommendation-icon",name:"recommendation"})):ie("",!0)]),d("div",W3,j(S.desc),1)],10,q3))),128))])])]),r.search_type==1?(w(),R("div",Y3,[y(bw,{rrf_weight:r.rrf_weight,"onUpdate:rrf_weight":v[0]||(v[0]=S=>r.rrf_weight=S)},null,8,["rrf_weight"])])):ie("",!0),d("div",K3,[d("div",J3,[v[14]||(v[14]=d("span",null,"Top K ",-1)),y(C,null,{title:x(()=>[...v[13]||(v[13]=[U("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),d("div",Z3,[d("div",Q3,[d("div",eD,[y(M,{class:"custom-slider",value:r.top_k,"onUpdate:value":v[1]||(v[1]=S=>r.top_k=S),min:1,max:500},null,8,["value"])]),d("div",tD,[y(O,{value:r.top_k,"onUpdate:value":v[2]||(v[2]=S=>r.top_k=S),min:1,max:500},null,8,["value"])])])])]),d("div",nD,[d("div",oD,[v[16]||(v[16]=d("span",null,"相似度阈值 ",-1)),y(C,null,{title:x(()=>[...v[15]||(v[15]=[U("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),d("div",iD,[d("div",rD,[d("div",sD,[y(M,{class:"custom-slider",value:r.similarity,"onUpdate:value":v[3]||(v[3]=S=>r.similarity=S),min:0,max:1,step:.01},null,8,["value"])]),d("div",aD,[y(O,{value:r.similarity,"onUpdate:value":v[4]||(v[4]=S=>r.similarity=S),min:0,max:1,step:.01},null,8,["value"])])])])]),d("div",lD,[d("div",uD,[v[17]||(v[17]=d("span",null,"Rerank模型",-1)),v[18]||(v[18]=U("   ",-1)),y(k,{checkedValue:1,unCheckedValue:0,checked:r.rerank_status,"onUpdate:checked":v[5]||(v[5]=S=>r.rerank_status=S)},null,8,["checked"])]),d("div",dD,[y(rr,{modelType:"RERANK",modeName:r.rerank_use_model,"onUpdate:modeName":v[6]||(v[6]=S=>r.rerank_use_model=S),modeId:r.rerank_model_config_id,"onUpdate:modeId":v[7]||(v[7]=S=>r.rerank_model_config_id=S),style:{width:"320px"}},null,8,["modeName","modeId"])])]),d("div",cD,[d("div",fD,[y(C,{title:"元数据过滤是使用元数据属性（例如分组，知识创建时间等）来细化和控制系統内相关信息的检索过程。召回时仅会召回满足要求的知识。"},{default:x(()=>[d("span",null,[v[19]||(v[19]=U("元数据过滤 ",-1)),y(K(mt))])]),_:1}),v[20]||(v[20]=U("   ",-1)),y(k,{checkedValue:1,unCheckedValue:0,checked:r.meta_search_switch,"onUpdate:checked":v[8]||(v[8]=S=>r.meta_search_switch=S)},null,8,["checked"])]),r.meta_search_switch==1?(w(),R("div",pD,[y(Xy,{rule:r.meta_search_condition_list,"onUpdate:rule":v[9]||(v[9]=S=>r.meta_search_condition_list=S),type:r.meta_search_type,"onUpdate:type":v[10]||(v[10]=S=>r.meta_search_type=S),ref:"metaFilterRef",class:"meta-box","meta-data":a.value},null,8,["rule","type","meta-data"])])):ie("",!0)])])])]),_:1},8,["open"])}}},vD=Te(hD,[["__scopeId","data-v-86257b7e"]]),gD={class:"problem-optimization-form"},_D={class:"node-form-content"},mD={class:"gray-block"},yD={class:"avatar-box"},bD=["src"],xD={class:"content-box"},wD={class:"list-name"},CD={class:"list-intro"},SD=["onClick"],kD={class:"btn-block"},ED={class:"diy-form-item"},DD={class:"form-content"},AD={class:"form-content"},OD={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=jn(),o=Xe(()=>t.robotInfo.rrf_weight?JSON.parse(t.robotInfo.rrf_weight):{vector:0,search:0,graph:0}),i=e,r=n,s=G([]);function a(){const $=r.lf.getNodeModelById(r.nodeId);if($){let B=$.getAllParentVariable();s.value=l(B)}}function l($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=l(B.children))}),$}function u($){if($){let B=$.split("."),A=B[0],D=B.filter((T,F)=>F>0).join(".");return[A,D]}return["global","question"]}const c=G(),f=G(null),p=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",question_value:"",rrf_weight:{}}),h=()=>{const $=JSON.stringify({libs:{...p,rerank_model_config_id:p.rerank_model_config_id?+p.rerank_model_config_id:void 0,question_value:p.question_value.join("."),library_ids:p.library_ids.join(","),rrf_weight:JSON.stringify(p.rrf_weight)}});i("update-node",{...r.node,node_params:$})},g=()=>{try{let $=r.node.dataRaw||r.node.node_params||"{}",B=JSON.parse($).libs||{};a(),B=JSON.parse(JSON.stringify(B));for(let A in B)A=="library_ids"?p[A]=B[A]?B[A].split(","):[]:A=="question_value"?p.question_value=u(B.question_value):A=="rrf_weight"?p.rrf_weight=B[A]?JSON.parse(B[A]):B[A]:p[A]=B[A];B.rrf_weight||(p.rrf_weight=o.value),kg({ability_type:"library_ability_official_account"}).then(A=>{var T;let D=(A==null?void 0:A.data)||{};((T=D==null?void 0:D.user_config)==null?void 0:T.switch_status)==1&&(f.value=D)})}catch($){}},m=G([]),_=G(null),v=Xe(()=>m.value.filter($=>f.value?p.library_ids.includes($.id):p.library_ids.includes($.id)&&$.type!=3)),b=$=>{let B=p.library_ids.indexOf($.id);p.library_ids.splice(B,1)},C=$=>{S(),p.library_ids=[...$]},M=()=>{_.value.open([...p.library_ids])},O=G(null),k=()=>{O.value.open(Bn(p),null,p.library_ids)},E=$=>{p.rerank_status=$.rerank_status,p.rerank_use_model=$.rerank_use_model,p.rerank_model_config_id=$.rerank_model_config_id,p.top_k=$.top_k,p.similarity=$.similarity,p.search_type=$.search_type,p.meta_search_switch=Number($.meta_search_switch),p.meta_search_type=Number($.meta_search_type),p.meta_search_condition_list=$.meta_search_condition_list,p.rrf_weight=$.rrf_weight},S=async()=>{const $=await ja({type:""});$&&(m.value=$.data||[])};gt(()=>p,()=>{h()},{deep:!0});const N=$=>{$||a()},L=()=>{i("close")};return ut(()=>{g(),S()}),($,B)=>{const A=Kt,D=kn,T=oi,F=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",gD,[d("div",_D,[y(F,{ref_key:"formRef",ref:c,layout:"vertical",model:p},{default:x(()=>[d("div",mD,[B[4]||(B[4]=d("div",{class:"gray-block-title"},"输入",-1)),y(D,{label:"关联知识库"},{default:x(()=>[(w(!0),R(ae,null,ye(v.value,V=>(w(),R("div",{class:"konwledge-list-item",key:V.id},[d("div",yD,[d("img",{src:V.avatar,alt:""},null,8,bD)]),d("div",xD,[d("div",wD,j(V.library_name),1),d("div",CD,j(V.library_intro),1)]),d("div",{class:"btn-hover-wrap",onClick:P=>b(V)},[y(K(Jt))],8,SD)]))),128)),d("div",kD,[d("div",null,[y(A,{onClick:M,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[1]||(B[1]=[U("添加知识库",-1)])]),_:1},8,["icon"])]),d("div",null,[y(A,{onClick:k,icon:Tt(K(Kc)),block:"",type:"dashed"},{default:x(()=>[...B[2]||(B[2]=[U("召回设置",-1)])]),_:1},8,["icon"])])])]),_:1}),d("div",ED,[B[3]||(B[3]=d("div",{class:"form-label"},"用户问题",-1)),d("div",DD,[d("div",AD,[y(T,{value:p.question_value,"onUpdate:value":B[0]||(B[0]=V=>p.question_value=V),onDropdownVisibleChange:N,style:{width:"220px"},options:s.value,allowClear:!1,displayRender:({labels:V})=>V.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),B[5]||(B[5]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"输出"),d("div",{class:"options-item"},[d("div",{class:"option-label"},"知识库引用"),d("div",{class:"option-type"},"string")])],-1))]),_:1},8,["model"]),y(Mg,{ref_key:"librarySelectAlertRef",ref:_,showWxType:!!f.value,onClose:S,onChange:C},null,8,["showWxType"]),y(vD,{ref_key:"recallSettingsAlertRef",ref:O,onChange:E},null,512)])])]),_:1})}}},ND=Te(OD,[["__scopeId","data-v-2469c3cc"]]),Lo="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",MD={class:"sub-field-item"},TD=["onClick"],$D=["onClick"],PD={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),R(ae,null,ye(e.data,(g,m)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[d("div",MD,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:g.key,"onUpdate:value":_=>g.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(p,{class:"mr12",onChange:_=>s(g),value:g.typ,"onUpdate:value":_=>g.typ=_,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,_=>(w(),Q(f,{value:_.value},{default:x(()=>[U(j(_.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(g)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(m,e.data)},[y(K(Fn))],8,TD)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:_=>r(m,e.data)},[y(K(Jt))],8,$D)]),g.subs&&g.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:g.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},RD=Te(PD,[["__scopeId","data-v-01969e8c"]]);var Gf={exports:{}},Xf;function BD(){return Xf||(Xf=1,(function(n,e){(function(t){t(Eg())})(function(t){t.defineMode("javascript",function(o,i){var r=o.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,u=i.trackScope!==!1,c=i.typescript,f=i.wordCharacters||/[\w$\xa1-\uffff]/,p=(function(){function I(ft){return{type:ft,style:"keyword"}}var Y=I("keyword a"),me=I("keyword b"),Oe=I("keyword c"),rt=I("keyword d"),je=I("operator"),Qe={type:"atom",style:"atom"};return{if:I("if"),while:Y,with:Y,else:me,do:me,try:me,finally:me,return:rt,break:rt,continue:rt,new:I("new"),delete:Oe,void:Oe,throw:Oe,debugger:I("debugger"),var:I("var"),const:I("var"),let:I("var"),function:I("function"),catch:I("catch"),for:I("for"),switch:I("switch"),case:I("case"),default:I("default"),in:je,typeof:je,instanceof:je,true:Qe,false:Qe,null:Qe,undefined:Qe,NaN:Qe,Infinity:Qe,this:I("this"),class:I("class"),super:I("atom"),yield:Oe,export:I("export"),import:I("import"),extends:Oe,await:Oe}})(),h=/[+\-*&%=<>!?|~^@]/,g=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function m(I){for(var Y=!1,me,Oe=!1;(me=I.next())!=null;){if(!Y){if(me=="/"&&!Oe)return;me=="["?Oe=!0:Oe&&me=="]"&&(Oe=!1)}Y=!Y&&me=="\\"}}var _,v;function b(I,Y,me){return _=I,v=me,Y}function C(I,Y){var me=I.next();if(me=='"'||me=="'")return Y.tokenize=M(me),Y.tokenize(I,Y);if(me=="."&&I.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return b("number","number");if(me=="."&&I.match(".."))return b("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(me))return b(me);if(me=="="&&I.eat(">"))return b("=>","operator");if(me=="0"&&I.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return b("number","number");if(/\d/.test(me))return I.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),b("number","number");if(me=="/")return I.eat("*")?(Y.tokenize=O,O(I,Y)):I.eat("/")?(I.skipToEnd(),b("comment","comment")):ee(I,Y,1)?(m(I),I.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),b("regexp","string-2")):(I.eat("="),b("operator","operator",I.current()));if(me=="`")return Y.tokenize=k,k(I,Y);if(me=="#"&&I.peek()=="!")return I.skipToEnd(),b("meta","meta");if(me=="#"&&I.eatWhile(f))return b("variable","property");if(me=="<"&&I.match("!--")||me=="-"&&I.match("->")&&!/\S/.test(I.string.slice(0,I.start)))return I.skipToEnd(),b("comment","comment");if(h.test(me))return(me!=">"||!Y.lexical||Y.lexical.type!=">")&&(I.eat("=")?(me=="!"||me=="=")&&I.eat("="):/[<>*+\-|&?]/.test(me)&&(I.eat(me),me==">"&&I.eat(me))),me=="?"&&I.eat(".")?b("."):b("operator","operator",I.current());if(f.test(me)){I.eatWhile(f);var Oe=I.current();if(Y.lastType!="."){if(p.propertyIsEnumerable(Oe)){var rt=p[Oe];return b(rt.type,rt.style,Oe)}if(Oe=="async"&&I.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return b("async","keyword",Oe)}return b("variable","variable",Oe)}}function M(I){return function(Y,me){var Oe=!1,rt;if(a&&Y.peek()=="@"&&Y.match(g))return me.tokenize=C,b("jsonld-keyword","meta");for(;(rt=Y.next())!=null&&!(rt==I&&!Oe);)Oe=!Oe&&rt=="\\";return Oe||(me.tokenize=C),b("string","string")}}function O(I,Y){for(var me=!1,Oe;Oe=I.next();){if(Oe=="/"&&me){Y.tokenize=C;break}me=Oe=="*"}return b("comment","comment")}function k(I,Y){for(var me=!1,Oe;(Oe=I.next())!=null;){if(!me&&(Oe=="`"||Oe=="$"&&I.eat("{"))){Y.tokenize=C;break}me=!me&&Oe=="\\"}return b("quasi","string-2",I.current())}var E="([{}])";function S(I,Y){Y.fatArrowAt&&(Y.fatArrowAt=null);var me=I.string.indexOf("=>",I.start);if(!(me<0)){if(c){var Oe=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(I.string.slice(I.start,me));Oe&&(me=Oe.index)}for(var rt=0,je=!1,Qe=me-1;Qe>=0;--Qe){var ft=I.string.charAt(Qe),Ot=E.indexOf(ft);if(Ot>=0&&Ot<3){if(!rt){++Qe;break}if(--rt==0){ft=="("&&(je=!0);break}}else if(Ot>=3&&Ot<6)++rt;else if(f.test(ft))je=!0;else if(/["'\/`]/.test(ft))for(;;--Qe){if(Qe==0)return;var Un=I.string.charAt(Qe-1);if(Un==ft&&I.string.charAt(Qe-2)!="\\"){Qe--;break}}else if(je&&!rt){++Qe;break}}je&&!rt&&(Y.fatArrowAt=Qe)}}var N={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function L(I,Y,me,Oe,rt,je){this.indented=I,this.column=Y,this.type=me,this.prev=rt,this.info=je,Oe!=null&&(this.align=Oe)}function $(I,Y){if(!u)return!1;for(var me=I.localVars;me;me=me.next)if(me.name==Y)return!0;for(var Oe=I.context;Oe;Oe=Oe.prev)for(var me=Oe.vars;me;me=me.next)if(me.name==Y)return!0}function B(I,Y,me,Oe,rt){var je=I.cc;for(A.state=I,A.stream=rt,A.marked=null,A.cc=je,A.style=Y,I.lexical.hasOwnProperty("align")||(I.lexical.align=!0);;){var Qe=je.length?je.pop():l?ge:ve;if(Qe(me,Oe)){for(;je.length&&je[je.length-1].lex;)je.pop()();return A.marked?A.marked:me=="variable"&&$(I,Oe)?"variable-2":Y}}}var A={state:null,marked:null,cc:null};function D(){for(var I=arguments.length-1;I>=0;I--)A.cc.push(arguments[I])}function T(){return D.apply(null,arguments),!0}function F(I,Y){for(var me=Y;me;me=me.next)if(me.name==I)return!0;return!1}function V(I){var Y=A.state;if(A.marked="def",!!u){if(Y.context){if(Y.lexical.info=="var"&&Y.context&&Y.context.block){var me=P(I,Y.context);if(me!=null){Y.context=me;return}}else if(!F(I,Y.localVars)){Y.localVars=new H(I,Y.localVars);return}}i.globalVars&&!F(I,Y.globalVars)&&(Y.globalVars=new H(I,Y.globalVars))}}function P(I,Y){if(Y)if(Y.block){var me=P(I,Y.prev);return me?me==Y.prev?Y:new oe(me,Y.vars,!0):null}else return F(I,Y.vars)?Y:new oe(Y.prev,new H(I,Y.vars),!1);else return null}function X(I){return I=="public"||I=="private"||I=="protected"||I=="abstract"||I=="readonly"}function oe(I,Y,me){this.prev=I,this.vars=Y,this.block=me}function H(I,Y){this.name=I,this.next=Y}var W=new H("this",new H("arguments",null));function Z(){A.state.context=new oe(A.state.context,A.state.localVars,!1),A.state.localVars=W}function le(){A.state.context=new oe(A.state.context,A.state.localVars,!0),A.state.localVars=null}Z.lex=le.lex=!0;function te(){A.state.localVars=A.state.context.vars,A.state.context=A.state.context.prev}te.lex=!0;function q(I,Y){var me=function(){var Oe=A.state,rt=Oe.indented;if(Oe.lexical.type=="stat")rt=Oe.lexical.indented;else for(var je=Oe.lexical;je&&je.type==")"&&je.align;je=je.prev)rt=je.indented;Oe.lexical=new L(rt,A.stream.column(),I,null,Oe.lexical,Y)};return me.lex=!0,me}function re(){var I=A.state;I.lexical.prev&&(I.lexical.type==")"&&(I.indented=I.lexical.indented),I.lexical=I.lexical.prev)}re.lex=!0;function ce(I){function Y(me){return me==I?T():I==";"||me=="}"||me==")"||me=="]"?D():T(Y)}return Y}function ve(I,Y){return I=="var"?T(q("vardef",Y),Be,ce(";"),re):I=="keyword a"?T(q("form"),st,ve,re):I=="keyword b"?T(q("form"),ve,re):I=="keyword d"?A.stream.match(/^\s*$/,!1)?T():T(q("stat"),ke,ce(";"),re):I=="debugger"?T(ce(";")):I=="{"?T(q("}"),le,pe,re,te):I==";"?T():I=="if"?(A.state.lexical.info=="else"&&A.state.cc[A.state.cc.length-1]==re&&A.state.cc.pop()(),T(q("form"),st,ve,re,bn)):I=="function"?T(Mn):I=="for"?T(q("form"),le,En,ve,te,re):I=="class"||c&&Y=="interface"?(A.marked="keyword",T(q("form",I=="class"?I:Y),Ei,re)):I=="variable"?c&&Y=="declare"?(A.marked="keyword",T(ve)):c&&(Y=="module"||Y=="enum"||Y=="type")&&A.stream.match(/^\s*\w/,!1)?(A.marked="keyword",Y=="enum"?T(At):Y=="type"?T(ki,ce("operator"),qe,ce(";")):T(q("form"),Ke,ce("{"),q("}"),pe,re,re)):c&&Y=="namespace"?(A.marked="keyword",T(q("form"),ge,ve,re)):c&&Y=="abstract"?(A.marked="keyword",T(ve)):T(q("stat"),Ie):I=="switch"?T(q("form"),st,ce("{"),q("}","switch"),le,pe,re,re,te):I=="case"?T(ge,ce(":")):I=="default"?T(ce(":")):I=="catch"?T(q("form"),Z,Ne,ve,re,te):I=="export"?T(q("stat"),Di,re):I=="import"?T(q("stat"),fr,re):I=="async"?T(ve):Y=="@"?T(ge,ve):D(q("stat"),ge,ce(";"),re)}function Ne(I){if(I=="(")return T(kt,ce(")"))}function ge(I,Y){return tt(I,Y,!1)}function _e(I,Y){return tt(I,Y,!0)}function st(I){return I!="("?D():T(q(")"),ke,ce(")"),re)}function tt(I,Y,me){if(A.state.fatArrowAt==A.stream.start){var Oe=me?se:ne;if(I=="(")return T(Z,q(")"),lt(kt,")"),re,ce("=>"),Oe,te);if(I=="variable")return D(Z,Ke,ce("=>"),Oe,te)}var rt=me?De:he;return N.hasOwnProperty(I)?T(rt):I=="function"?T(Mn,rt):I=="class"||c&&Y=="interface"?(A.marked="keyword",T(q("form"),Vi,re)):I=="keyword c"||I=="async"?T(me?_e:ge):I=="("?T(q(")"),ke,ce(")"),re,rt):I=="operator"||I=="spread"?T(me?_e:ge):I=="["?T(q("]"),ct,re,rt):I=="{"?de(et,"}",null,rt):I=="quasi"?D(Me,rt):I=="new"?T(Ee(me)):T()}function ke(I){return I.match(/[;\}\)\],]/)?D():D(ge)}function he(I,Y){return I==","?T(ke):De(I,Y,!1)}function De(I,Y,me){var Oe=me==!1?he:De,rt=me==!1?ge:_e;if(I=="=>")return T(Z,me?se:ne,te);if(I=="operator")return/\+\+|--/.test(Y)||c&&Y=="!"?T(Oe):c&&Y=="<"&&A.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?T(q(">"),lt(qe,">"),re,Oe):Y=="?"?T(ge,ce(":"),rt):T(rt);if(I=="quasi")return D(Me,Oe);if(I!=";"){if(I=="(")return de(_e,")","call",Oe);if(I==".")return T(Ve,Oe);if(I=="[")return T(q("]"),ke,ce("]"),re,Oe);if(c&&Y=="as")return A.marked="keyword",T(qe,Oe);if(I=="regexp")return A.state.lastType=A.marked="operator",A.stream.backUp(A.stream.pos-A.stream.start-1),T(rt)}}function Me(I,Y){return I!="quasi"?D():Y.slice(Y.length-2)!="${"?T(Me):T(ke,z)}function z(I){if(I=="}")return A.marked="string-2",A.state.tokenize=k,T(Me)}function ne(I){return S(A.stream,A.state),D(I=="{"?ve:ge)}function se(I){return S(A.stream,A.state),D(I=="{"?ve:_e)}function Ee(I){return function(Y){return Y=="."?T(I?Le:fe):Y=="variable"&&c?T(Se,I?De:he):D(I?_e:ge)}}function fe(I,Y){if(Y=="target")return A.marked="keyword",T(he)}function Le(I,Y){if(Y=="target")return A.marked="keyword",T(De)}function Ie(I){return I==":"?T(re,ve):D(he,ce(";"),re)}function Ve(I){if(I=="variable")return A.marked="property",T()}function et(I,Y){if(I=="async")return A.marked="property",T(et);if(I=="variable"||A.style=="keyword"){if(A.marked="property",Y=="get"||Y=="set")return T(nt);var me;return c&&A.state.fatArrowAt==A.stream.start&&(me=A.stream.match(/^\s*:\s*/,!1))&&(A.state.fatArrowAt=A.stream.pos+me[0].length),T(We)}else{if(I=="number"||I=="string")return A.marked=a?"property":A.style+" property",T(We);if(I=="jsonld-keyword")return T(We);if(c&&X(Y))return A.marked="keyword",T(et);if(I=="[")return T(ge,xe,ce("]"),We);if(I=="spread")return T(_e,We);if(Y=="*")return A.marked="keyword",T(et);if(I==":")return D(We)}}function nt(I){return I!="variable"?D(We):(A.marked="property",T(Mn))}function We(I){if(I==":")return T(_e);if(I=="(")return D(Mn)}function lt(I,Y,me){function Oe(rt,je){if(me?me.indexOf(rt)>-1:rt==","){var Qe=A.state.lexical;return Qe.info=="call"&&(Qe.pos=(Qe.pos||0)+1),T(function(ft,Ot){return ft==Y||Ot==Y?D():D(I)},Oe)}return rt==Y||je==Y?T():me&&me.indexOf(";")>-1?D(I):T(ce(Y))}return function(rt,je){return rt==Y||je==Y?T():D(I,Oe)}}function de(I,Y,me){for(var Oe=3;Oe<arguments.length;Oe++)A.cc.push(arguments[Oe]);return T(q(Y,me),lt(I,Y),re)}function pe(I){return I=="}"?T():D(ve,pe)}function xe(I,Y){if(c){if(I==":")return T(qe);if(Y=="?")return T(xe)}}function Ce(I,Y){if(c&&(I==":"||Y=="in"))return T(qe)}function Fe(I){if(c&&I==":")return A.stream.match(/^\s*\w+\s+is\b/,!1)?T(ge,Ue,qe):T(qe)}function Ue(I,Y){if(Y=="is")return A.marked="keyword",T()}function qe(I,Y){if(Y=="keyof"||Y=="typeof"||Y=="infer"||Y=="readonly")return A.marked="keyword",T(Y=="typeof"?_e:qe);if(I=="variable"||Y=="void")return A.marked="type",T(Rt);if(Y=="|"||Y=="&")return T(qe);if(I=="string"||I=="number"||I=="atom")return T(Rt);if(I=="[")return T(q("]"),lt(qe,"]",","),re,Rt);if(I=="{")return T(q("}"),bt,re,Rt);if(I=="(")return T(lt(gn,")"),at,Rt);if(I=="<")return T(lt(qe,">"),qe);if(I=="quasi")return D(Ft,Rt)}function at(I){if(I=="=>")return T(qe)}function bt(I){return I.match(/[\}\)\]]/)?T():I==","||I==";"?T(bt):D(Xt,bt)}function Xt(I,Y){if(I=="variable"||A.style=="keyword")return A.marked="property",T(Xt);if(Y=="?"||I=="number"||I=="string")return T(Xt);if(I==":")return T(qe);if(I=="[")return T(ce("variable"),Ce,ce("]"),Xt);if(I=="(")return D(bo,Xt);if(!I.match(/[;\}\)\],]/))return T()}function Ft(I,Y){return I!="quasi"?D():Y.slice(Y.length-2)!="${"?T(Ft):T(qe,pn)}function pn(I){if(I=="}")return A.marked="string-2",A.state.tokenize=k,T(Ft)}function gn(I,Y){return I=="variable"&&A.stream.match(/^\s*[?:]/,!1)||Y=="?"?T(gn):I==":"?T(qe):I=="spread"?T(gn):D(qe)}function Rt(I,Y){if(Y=="<")return T(q(">"),lt(qe,">"),re,Rt);if(Y=="|"||I=="."||Y=="&")return T(qe);if(I=="[")return T(qe,ce("]"),Rt);if(Y=="extends"||Y=="implements")return A.marked="keyword",T(qe);if(Y=="?")return T(qe,ce(":"),qe)}function Se(I,Y){if(Y=="<")return T(q(">"),lt(qe,">"),re,Rt)}function Ye(){return D(qe,be)}function be(I,Y){if(Y=="=")return T(qe)}function Be(I,Y){return Y=="enum"?(A.marked="keyword",T(At)):D(Ke,xe,dt,Ut)}function Ke(I,Y){if(c&&X(Y))return A.marked="keyword",T(Ke);if(I=="variable")return V(Y),T();if(I=="spread")return T(Ke);if(I=="[")return de(ht,"]");if(I=="{")return de(ze,"}")}function ze(I,Y){return I=="variable"&&!A.stream.match(/^\s*:/,!1)?(V(Y),T(dt)):(I=="variable"&&(A.marked="property"),I=="spread"?T(Ke):I=="}"?D():I=="["?T(ge,ce("]"),ce(":"),ze):T(ce(":"),Ke,dt))}function ht(){return D(Ke,dt)}function dt(I,Y){if(Y=="=")return T(_e)}function Ut(I){if(I==",")return T(Be)}function bn(I,Y){if(I=="keyword b"&&Y=="else")return T(q("form","else"),ve,re)}function En(I,Y){if(Y=="await")return T(En);if(I=="(")return T(q(")"),qt,re)}function qt(I){return I=="var"?T(Be,Hn):I=="variable"?T(Hn):D(Hn)}function Hn(I,Y){return I==")"?T():I==";"?T(Hn):Y=="in"||Y=="of"?(A.marked="keyword",T(ge,Hn)):D(ge,Hn)}function Mn(I,Y){if(Y=="*")return A.marked="keyword",T(Mn);if(I=="variable")return V(Y),T(Mn);if(I=="(")return T(Z,q(")"),lt(kt,")"),re,Fe,ve,te);if(c&&Y=="<")return T(q(">"),lt(Ye,">"),re,Mn)}function bo(I,Y){if(Y=="*")return A.marked="keyword",T(bo);if(I=="variable")return V(Y),T(bo);if(I=="(")return T(Z,q(")"),lt(kt,")"),re,Fe,te);if(c&&Y=="<")return T(q(">"),lt(Ye,">"),re,bo)}function ki(I,Y){if(I=="keyword"||I=="variable")return A.marked="type",T(ki);if(Y=="<")return T(q(">"),lt(Ye,">"),re)}function kt(I,Y){return Y=="@"&&T(ge,kt),I=="spread"?T(kt):c&&X(Y)?(A.marked="keyword",T(kt)):c&&I=="this"?T(xe,dt):D(Ke,xe,dt)}function Vi(I,Y){return I=="variable"?Ei(I,Y):xo(I,Y)}function Ei(I,Y){if(I=="variable")return V(Y),T(xo)}function xo(I,Y){if(Y=="<")return T(q(">"),lt(Ye,">"),re,xo);if(Y=="extends"||Y=="implements"||c&&I==",")return Y=="implements"&&(A.marked="keyword"),T(c?qe:ge,xo);if(I=="{")return T(q("}"),ro,re)}function ro(I,Y){if(I=="async"||I=="variable"&&(Y=="static"||Y=="get"||Y=="set"||c&&X(Y))&&A.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return A.marked="keyword",T(ro);if(I=="variable"||A.style=="keyword")return A.marked="property",T(so,ro);if(I=="number"||I=="string")return T(so,ro);if(I=="[")return T(ge,xe,ce("]"),so,ro);if(Y=="*")return A.marked="keyword",T(ro);if(c&&I=="(")return D(bo,ro);if(I==";"||I==",")return T(ro);if(I=="}")return T();if(Y=="@")return T(ge,ro)}function so(I,Y){if(Y=="!"||Y=="?")return T(so);if(I==":")return T(qe,dt);if(Y=="=")return T(_e);var me=A.state.lexical.prev,Oe=me&&me.info=="interface";return D(Oe?bo:Mn)}function Di(I,Y){return Y=="*"?(A.marked="keyword",T(Ge,ce(";"))):Y=="default"?(A.marked="keyword",T(ge,ce(";"))):I=="{"?T(lt(Hi,"}"),Ge,ce(";")):D(ve)}function Hi(I,Y){if(Y=="as")return A.marked="keyword",T(ce("variable"));if(I=="variable")return D(_e,Hi)}function fr(I){return I=="string"?T():I=="("?D(ge):I=="."?D(he):D(jo,J,Ge)}function jo(I,Y){return I=="{"?de(jo,"}"):(I=="variable"&&V(Y),Y=="*"&&(A.marked="keyword"),T(we))}function J(I){if(I==",")return T(jo,J)}function we(I,Y){if(Y=="as")return A.marked="keyword",T(jo)}function Ge(I,Y){if(Y=="from")return A.marked="keyword",T(ge)}function ct(I){return I=="]"?T():D(lt(_e,"]"))}function At(){return D(q("form"),Ke,ce("{"),q("}"),lt(Zt,"}"),re,re)}function Zt(){return D(Ke,dt)}function Dn(I,Y){return I.lastType=="operator"||I.lastType==","||h.test(Y.charAt(0))||/[,.]/.test(Y.charAt(0))}function ee(I,Y,me){return Y.tokenize==C&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(Y.lastType)||Y.lastType=="quasi"&&/\{\s*$/.test(I.string.slice(0,I.pos-(me||0)))}return{startState:function(I){var Y={tokenize:C,lastType:"sof",cc:[],lexical:new L((I||0)-r,0,"block",!1),localVars:i.localVars,context:i.localVars&&new oe(null,null,!1),indented:I||0};return i.globalVars&&typeof i.globalVars=="object"&&(Y.globalVars=i.globalVars),Y},token:function(I,Y){if(I.sol()&&(Y.lexical.hasOwnProperty("align")||(Y.lexical.align=!1),Y.indented=I.indentation(),S(I,Y)),Y.tokenize!=O&&I.eatSpace())return null;var me=Y.tokenize(I,Y);return _=="comment"?me:(Y.lastType=_=="operator"&&(v=="++"||v=="--")?"incdec":_,B(Y,me,_,v,I))},indent:function(I,Y){if(I.tokenize==O||I.tokenize==k)return t.Pass;if(I.tokenize!=C)return 0;var me=Y&&Y.charAt(0),Oe=I.lexical,rt;if(!/^\s*else\b/.test(Y))for(var je=I.cc.length-1;je>=0;--je){var Qe=I.cc[je];if(Qe==re)Oe=Oe.prev;else if(Qe!=bn&&Qe!=te)break}for(;(Oe.type=="stat"||Oe.type=="form")&&(me=="}"||(rt=I.cc[I.cc.length-1])&&(rt==he||rt==De)&&!/^[,\.=+\-*:?[\(]/.test(Y));)Oe=Oe.prev;s&&Oe.type==")"&&Oe.prev.type=="stat"&&(Oe=Oe.prev);var ft=Oe.type,Ot=me==ft;return ft=="vardef"?Oe.indented+(I.lastType=="operator"||I.lastType==","?Oe.info.length+1:0):ft=="form"&&me=="{"?Oe.indented:ft=="form"?Oe.indented+r:ft=="stat"?Oe.indented+(Dn(I,Y)?s||r:0):Oe.info=="switch"&&!Ot&&i.doubleIndentSwitch!=!1?Oe.indented+(/^(?:case|default)\b/.test(Y)?r:2*r):Oe.align?Oe.column+(Ot?0:1):Oe.indented+(Ot?0:r)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:ee,skipExpression:function(I){B(I,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})})()),Gf.exports}BD();const Wf={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(n,{expose:e,emit:t}){const o=t,i=G(""),r=n;gt(()=>r.value,p=>{i.value=p},{immediate:!0});const s={mode:"text/javascript",theme:"dracula"},a=G(null),l=p=>{o("update:value",p)},u=()=>{a.value.refresh()},c=()=>{},f=()=>{};return e({handleRefresh:u}),(p,h)=>(w(),R("div",null,[y(K(xw),{onWheel:h[0]||(h[0]=St(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":h[1]||(h[1]=g=>i.value=g),options:s,ref_key:"cmRef",ref:a,height:r.height,width:r.width,onChange:l,onInput:f,onReady:c},null,8,["value","height","width"])]))}},LD={class:"flex-content-box"},ID={class:"test-model-box"},FD=["onClick"],jD={key:2,class:"input-list-box"},VD={class:"add-btn-box"},HD={class:"save-btn-box"},UD={class:"preview-box"},zD={class:"preview-content-block"},qD={class:"title-block"},GD={class:"preview-code-box"},XD={class:"preview-content-block"},WD={class:"error-box",style:{"margin-top":"12px"}},YD={key:0,style:{color:"#f50"}},KD={__name:"run-test",props:{variableOptions:{type:Array,default:()=>[]}},emits:["save"],setup(n,{expose:e,emit:t}){const o=n,i=G(!1),r=G(!1);let s=!1;const a=Je({language:"javaScript",main_func:"",test_params:[]});function l(A){if(typeof A!="string")return null;const D=/<([^<>]+)>/,T=A.match(D);return T?T[1]:null}function u(A){var D;if(A&&A.length==2){let T=o.variableOptions.filter(F=>F.value==A[0]);if(T.length>0){let F=((D=T[0].children.filter(V=>V.value==A[1])[0])==null?void 0:D.typ)||"string";return F.includes("array")&&s?l(F):F}}return"string"}let c=[];const f=async A=>{_.value="",a.main_func=A.main_func;let D=localStorage.getItem("code_run_node_test_modal_data")||"{}";c=JSON.parse(D).test_params||[];let T=A.params.filter(F=>F.field&&F.variable&&F.variable.length>0);a.test_params=T.map(F=>{let V=u(F.variable);return{key:Math.random()*1e3,field:F.field,typ:V,value:p(V,F)}}),i.value=!0};function p(A,D){let T=c.filter(F=>F.field==D.field);return A.includes("array")?T.length&&typeof T[0].value=="object"?T[0].value:[{value:"",key:Math.random()*1e4}]:T.length&&typeof T[0].value=="string"?T[0].value:""}const h=(A,D)=>{A.splice(D,1)},g=A=>{A.push({value:"",key:Math.random()*1e4})},m=G(null),_=G(""),v=G(!1),b=G(""),C=()=>{m.value.validate().then(()=>{let A={...a},D=JSON.parse(JSON.stringify(a.test_params)),T={};D.forEach(F=>{T[F.field]=F.value,F.typ.includes("array")&&(T[F.field]=F.value.map(V=>(V.value=V.value.trim(),M(V.value)?JSON.parse(V.value):V.value)),T[F.field]=T[F.field].filter(V=>V)),F.typ==="object"&&M(F.value)&&(T[F.field]=JSON.parse(F.value))}),A.params=JSON.stringify(T),delete A.test_params,localStorage.setItem("code_run_node_test_modal_data",JSON.stringify(a)),r.value=!0,v.value=!1,iy({...A}).then(F=>{xt.success("测试结果生成完成"),_.value=JSON.parse(F.data)}).catch(F=>{v.value=!0,b.value=F.msg}).finally(()=>{r.value=!1})})};function M(A){if(typeof A!="string")return!1;const D=A.trim();if(!(D.startsWith("{")&&D.endsWith("}")||D.startsWith("[")&&D.endsWith("]")))return!1;try{const F=JSON.parse(D);return typeof F=="object"&&F!==null}catch{return!1}}const O=()=>{Os(JSON.stringify(_.value)),xt.success("复制成功")},k=(A,D)=>{v.value=!1,s=D,f(A)},E=G(!1),S=G(!1),N=G(null),L=G(""),$=A=>{N.value=A,S.value=!1,E.value=!0},B=()=>{if(M(L.value)){let A=JSON.parse(L.value).map(F=>({value:typeof F=="string"?F:JSON.stringify(F)})),D=a.test_params[N.value],T={...D,value:[...D.value.filter(F=>F.value!=""),...A]};a.test_params.splice(N.value,1,T),E.value=!1}else S.value=!0};return e({open:k}),(A,D)=>{const T=wi,F=ii,V=ln,P=$n,X=Vn,oe=Kt,H=kn,W=wn,Z=Fr,le=vn,te=Bi;return w(),R("div",null,[y(le,{open:i.value,"onUpdate:open":D[0]||(D[0]=q=>i.value=q),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal"},{default:x(()=>[d("div",LD,[d("div",ID,[d("div",{class:"top-title",onClick:$},"运行参数"),y(W,{model:a,ref_key:"formRef",ref:m,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),R(ae,null,ye(a.test_params,(q,re)=>(w(),Q(H,{key:q.key,name:["test_params",re,"value"],rules:[{required:!0,message:`请输入${q.field}`}]},{label:x(()=>[y(F,{gap:8},{default:x(()=>[U(j(q.field),1),y(T,{style:{margin:"0"}},{default:x(()=>[U(j(q.typ),1)]),_:2},1024),q.typ.includes("array")?(w(),R("a",{key:0,onClick:ce=>$(re)},[y(K(by)),D[3]||(D[3]=U(" 一键导入 ",-1))],8,FD)):ie("",!0)]),_:2},1024)]),default:x(()=>[q.typ!="number"&&!q.typ.includes("array")?(w(),Q(V,{key:0,placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])):ie("",!0),q.typ=="number"?(w(),Q(P,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])):ie("",!0),q.typ.includes("array")?(w(),R("div",jD,[(w(!0),R(ae,null,ye(q.value,(ce,ve)=>(w(),R("div",{class:"input-list-item",key:ve},[y(X,null,{default:x(()=>[y(V,{placeholder:"请输入",value:ce.value,"onUpdate:value":Ne=>ce.value=Ne},null,8,["value","onUpdate:value"])]),_:2},1024),q.value.length>1?(w(),Q(K(Jt),{key:0,onClick:Ne=>h(q.value,ve)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",VD,[y(oe,{onClick:ce=>g(q.value),block:"",type:"dashed"},{default:x(()=>[...D[4]||(D[4]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),d("div",HD,[y(oe,{loading:r.value,onClick:C,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(K(ni)),D[5]||(D[5]=U("运行测试",-1))]),_:1},8,["loading"])])]),d("div",UD,[_.value?(w(),R(ae,{key:0},[D[7]||(D[7]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",zD,[d("div",qD,[D[6]||(D[6]=U("运行日志",-1)),y(K(Oo),{onClick:O})]),d("div",GD,[y(K(Mo),{data:_.value},null,8,["data"])])])],64)):ie("",!0),v.value?(w(),R(ae,{key:1},[D[9]||(D[9]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",XD,[D[8]||(D[8]=d("div",{class:"title-block"},"错误日志",-1)),d("div",WD,[y(Z,{message:b.value,type:"error"},null,8,["message"])])])],64)):ie("",!0)])])]),_:1},8,["open"]),y(le,{open:E.value,"onUpdate:open":D[2]||(D[2]=q=>E.value=q),width:820,title:"批量导入字段值",onOk:B},{default:x(()=>[y(te,{value:L.value,"onUpdate:value":D[1]||(D[1]=q=>L.value=q),valueModifiers:{trim:!0},placeholder:"请输入JSON字符串",style:{"min-height":"200px"}},null,8,["value"]),S.value?(w(),R("div",YD,' json格式错误 请输入正确的json字符串 列如 [{"xxx":"11","id":48985},{"brand":"aaa","id":48986}] ')):ie("",!0)]),_:1},8,["open"])])}}},JD=Te(KD,[["__scopeId","data-v-c0680a8c"]]),ZD={class:"problem-optimization-form"},QD={class:"node-form-content"},eA={class:"gray-block"},tA={class:"array-form-box"},nA={class:"flex-block-item"},oA=["onClick"],iA={class:"code-edit-box"},rA={class:"title-block"},sA={class:"code-box"},aA={class:"flex-block-item"},lA={class:"gray-block mt16"},uA={class:"output-box"},dA={class:"flex-block-item",style:{gap:"12px"}},cA=["onClick"],fA=["onClick"],pA={key:0,class:"sub-field-box"},hA={style:{margin:"40px 0 24px 0"}},Yf=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,vA={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=G([]);function r(){const A=o.lf.getNodeModelById(o.nodeId);if(A){let D=A.getAllParentVariable();i.value=s(D)}i.value}function s(A){return A.forEach(D=>{D.typ=="node"?D.node_type==1?D.value="global":D.value=D.node_id:D.value=D.key,D.children&&D.children.length>0&&(D.children=s(D.children))}),A}const a=G(),l=Je({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),u=()=>{vn.confirm({title:"确认还原为模板？",content:"还原后即被覆盖，不能撤销",okText:"确认",cancelText:"取消",onOk:()=>{l.main_func=Yf}})};function c(A){return A.forEach(D=>{D.cu_key=Math.random()*1e4,D.subs&&D.subs.length?c(D.subs):D.subs=[]}),A}const f=()=>{const A=JSON.stringify({code_run:{...l,params:p()}});t("update-node",{...o.node,...l,node_params:A})};function p(){let A=[];return l.params.forEach(D=>{A.push({field:D.field,variable:D.variable&&D.variable.length>0?D.variable.join("."):""})}),A}const h=()=>{try{let A=o.node.dataRaw||o.node.node_params||"{}",D=JSON.parse(A).code_run||{};D=JSON.parse(JSON.stringify(D)),r();for(let T in D){if(T=="params"){D[T]&&D[T].length>0?l[T]=D[T].map(F=>({...F,cu_key:Math.random()*1e4})):l[T]=[];continue}if(T=="output"){l.output=c(D[T]);continue}l[T]=D[T]}l.main_func=l.main_func||Yf,l.params=l.params.map(T=>{let F="";for(let V=0;V<No.length;V++)if(T.variable.indexOf(No[V])>-1){F=No[V];break}if(F!=""){let V=T.variable.split(".");T.variable=[V[0],F]}else T.variable=T.variable.split(".");return{...T,key:Math.random()*1e4}})}catch(A){}};gt(()=>l,()=>{f()},{deep:!0});const g=()=>{l.params.push({key:"",value:"",cu_key:Math.random()*1e4})},m=A=>{l.params.splice(A,1)},_=()=>{l.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},v=A=>{l.output.splice(A,1)},b=A=>{A.subs=[]},C=A=>{l.output[A].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},M=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],O=A=>{A||r()},k=G(!1),E=G(null),S=()=>{k.value=!0,E.value&&E.value.handleRefresh()},N=()=>{k.value=!1},L=()=>{t("close")},$=G(null),B=()=>{$.value.open(JSON.parse(JSON.stringify(l)),o.node.loop_parent_key!="")};return ut(()=>{h()}),(A,D)=>{const T=Qt,F=ln,V=Vn,P=oi,X=kn,oe=Kt,H=ii,W=$n,Z=Vt,le=It,te=vn,q=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:L},{runBtn:x(()=>[y(T,null,{title:x(()=>[...D[5]||(D[5]=[U("运行测试",-1)])]),default:x(()=>[d("div",{class:"action-btn",onClick:B},[y(K(ni),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",ZD,[d("div",QD,[y(q,{ref_key:"formRef",ref:a,layout:"vertical",model:l},{default:x(()=>[d("div",eA,[D[11]||(D[11]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",tA,[D[7]||(D[7]=d("div",{class:"form-item-label"},"自定义输入参数",-1)),(w(!0),R(ae,null,ye(l.params,(re,ce)=>(w(),R("div",{class:"form-item-list",key:ce},[y(X,{label:null,name:["params",ce,"variable"]},{default:x(()=>[d("div",nA,[y(V,null,{default:x(()=>[y(F,{style:{width:"190px"},value:re.field,"onUpdate:value":ve=>re.field=ve,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),y(P,{value:re.variable,"onUpdate:value":ve=>re.variable=ve,onDropdownVisibleChange:O,style:{width:"400px","max-width":"calc(100% - 190px)"},options:i.value,allowClear:!1,displayRender:({labels:ve})=>ve.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),d("div",{class:"btn-hover-wrap",onClick:ve=>m(ce)},[y(K(Jt))],8,oA)])]),_:2},1032,["name"])]))),128)),y(oe,{onClick:g,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...D[6]||(D[6]=[U("添加参数",-1)])]),_:1},8,["icon"])]),d("div",iA,[d("div",rA,[D[8]||(D[8]=d("div",null,"JavaScript 代码",-1)),y(H,{gap:16,align:"center"},{default:x(()=>[d("a",{onClick:u},"还原为模板"),d("div",{class:"btn-hover-wrap",onClick:S},[y(K(Ko))])]),_:1})]),d("div",sA,[y(Wf,{value:l.main_func,"onUpdate:value":D[0]||(D[0]=re=>l.main_func=re),width:410,height:170},null,8,["value"])])]),y(X,{name:"timeout",class:"mt16"},{label:x(()=>[y(H,{gap:2},{default:x(()=>[...D[9]||(D[9]=[U("超时时长",-1)])]),_:1})]),default:x(()=>[d("div",aA,[y(W,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:l.timeout,"onUpdate:value":D[1]||(D[1]=re=>l.timeout=re),min:0,max:3e3},null,8,["value"]),D[10]||(D[10]=U(" 秒 ",-1))])]),_:1})]),d("div",lA,[D[14]||(D[14]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",uA,[D[13]||(D[13]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:D[2]||(D[2]=St(()=>{},["stop"]))},[(w(!0),R(ae,null,ye(l.output,(re,ce)=>(w(),R("div",{class:"form-item-list",key:ce},[y(X,{label:null,name:["output",ce,"key"]},{default:x(()=>[d("div",dA,[y(F,{style:{width:"214px"},value:re.key,"onUpdate:value":ve=>re.key=ve,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(V,null,{default:x(()=>[y(le,{onChange:ve=>b(re),value:re.typ,"onUpdate:value":ve=>re.typ=ve,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(ae,null,ye(M,ve=>y(Z,{value:ve.value,key:ve.value},{default:x(()=>[U(j(ve.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),re.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:ve=>C(ce)},[y(K(Fn))],8,cA)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:ve=>v(ce)},[y(K(Jt))],8,fA)]),re.subs&&re.subs.length>0?(w(),R("div",pA,[y(V,null,{default:x(()=>[y(RD,{data:re.subs,level:2,typOptions:M},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(oe,{onClick:_,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...D[12]||(D[12]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])]),D[16]||(D[16]=d("div",{class:"gray-block mt16"},[d("div",{class:"gray-block-title"},"异常处理"),d("div",null,"运行代码报错时执行该分支")],-1)),y(te,{open:k.value,"onUpdate:open":D[4]||(D[4]=re=>k.value=re),title:"编辑代码",width:746},{footer:x(()=>[y(oe,{type:"primary",onClick:N},{default:x(()=>[...D[15]||(D[15]=[U("确定",-1)])]),_:1})]),default:x(()=>[d("div",hA,[y(Wf,{ref_key:"codeEditBoxRef",ref:E,value:l.main_func,"onUpdate:value":D[3]||(D[3]=re=>l.main_func=re),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1},8,["model"])])]),y(JD,{variableOptions:i.value,ref_key:"runTestRef",ref:$},null,8,["variableOptions"])]),_:1})}}},gA=Te(vA,[["__scopeId","data-v-20da36a3"]]),_A={class:"sub-field-item"},mA=["onClick"],yA=["onClick"],bA={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),R(ae,null,ye(e.data,(g,m)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[d("div",_A,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:g.key,"onUpdate:value":_=>g.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(p,{class:"mr12",onChange:_=>s(g),value:g.typ,"onUpdate:value":_=>g.typ=_,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,_=>(w(),Q(f,{value:_.value},{default:x(()=>[U(j(_.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(g)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(m,e.data)},[y(K(Fn))],8,mA)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:_=>r(m,e.data)},[y(K(Jt))],8,yA)]),g.subs&&g.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:g.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},xA=Te(bA,[["__scopeId","data-v-31e10652"]]);var tl={exports:{}},sd,Kf;function wA(){if(Kf)return sd;Kf=1;function n(o,i){var r=o;i.slice(0,-1).forEach(function(a){r=r[a]||{}});var s=i[i.length-1];return s in r}function e(o){return typeof o=="number"||/^0x[0-9a-f]+$/i.test(o)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(o)}function t(o,i){return i==="constructor"&&typeof o[i]=="function"||i==="__proto__"}return sd=function(o,i){i||(i={});var r={bools:{},strings:{},unknownFn:null};typeof i.unknown=="function"&&(r.unknownFn=i.unknown),typeof i.boolean=="boolean"&&i.boolean?r.allBools=!0:[].concat(i.boolean).filter(Boolean).forEach(function(E){r.bools[E]=!0});var s={};function a(E){return s[E].some(function(S){return r.bools[S]})}Object.keys(i.alias||{}).forEach(function(E){s[E]=[].concat(i.alias[E]),s[E].forEach(function(S){s[S]=[E].concat(s[E].filter(function(N){return S!==N}))})}),[].concat(i.string).filter(Boolean).forEach(function(E){r.strings[E]=!0,s[E]&&[].concat(s[E]).forEach(function(S){r.strings[S]=!0})});var l=i.default||{},u={_:[]};function c(E,S){return r.allBools&&/^--[^=]+$/.test(S)||r.strings[E]||r.bools[E]||s[E]}function f(E,S,N){for(var L=E,$=0;$<S.length-1;$++){var B=S[$];if(t(L,B))return;L[B]===void 0&&(L[B]={}),(L[B]===Object.prototype||L[B]===Number.prototype||L[B]===String.prototype)&&(L[B]={}),L[B]===Array.prototype&&(L[B]=[]),L=L[B]}var A=S[S.length-1];t(L,A)||((L===Object.prototype||L===Number.prototype||L===String.prototype)&&(L={}),L===Array.prototype&&(L=[]),L[A]===void 0||r.bools[A]||typeof L[A]=="boolean"?L[A]=N:Array.isArray(L[A])?L[A].push(N):L[A]=[L[A],N])}function p(E,S,N){if(!(N&&r.unknownFn&&!c(E,N)&&r.unknownFn(N)===!1)){var L=!r.strings[E]&&e(S)?Number(S):S;f(u,E.split("."),L),(s[E]||[]).forEach(function($){f(u,$.split("."),L)})}}Object.keys(r.bools).forEach(function(E){p(E,l[E]===void 0?!1:l[E])});var h=[];o.indexOf("--")!==-1&&(h=o.slice(o.indexOf("--")+1),o=o.slice(0,o.indexOf("--")));for(var g=0;g<o.length;g++){var m=o[g],_,v;if(/^--.+=/.test(m)){var b=m.match(/^--([^=]+)=([\s\S]*)$/);_=b[1];var C=b[2];r.bools[_]&&(C=C!=="false"),p(_,C,m)}else if(/^--no-.+/.test(m))_=m.match(/^--no-(.+)/)[1],p(_,!1,m);else if(/^--.+/.test(m))_=m.match(/^--(.+)/)[1],v=o[g+1],v!==void 0&&!/^(-|--)[^-]/.test(v)&&!r.bools[_]&&!r.allBools&&(!s[_]||!a(_))?(p(_,v,m),g+=1):/^(true|false)$/.test(v)?(p(_,v==="true",m),g+=1):p(_,r.strings[_]?"":!0,m);else if(/^-[^-]+/.test(m)){for(var M=m.slice(1,-1).split(""),O=!1,k=0;k<M.length;k++){if(v=m.slice(k+2),v==="-"){p(M[k],v,m);continue}if(/[A-Za-z]/.test(M[k])&&v[0]==="="){p(M[k],v.slice(1),m),O=!0;break}if(/[A-Za-z]/.test(M[k])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(v)){p(M[k],v,m),O=!0;break}if(M[k+1]&&M[k+1].match(/\W/)){p(M[k],m.slice(k+2),m),O=!0;break}else p(M[k],r.strings[M[k]]?"":!0,m)}_=m.slice(-1)[0],!O&&_!=="-"&&(o[g+1]&&!/^(-|--)[^-]/.test(o[g+1])&&!r.bools[_]&&(!s[_]||!a(_))?(p(_,o[g+1],m),g+=1):o[g+1]&&/^(true|false)$/.test(o[g+1])?(p(_,o[g+1]==="true",m),g+=1):p(_,r.strings[_]?"":!0,m))}else if((!r.unknownFn||r.unknownFn(m)!==!1)&&u._.push(r.strings._||!e(m)?m:Number(m)),i.stopEarly){u._.push.apply(u._,o.slice(g+1));break}}return Object.keys(l).forEach(function(E){n(u,E.split("."))||(f(u,E.split("."),l[E]),(s[E]||[]).forEach(function(S){f(u,S.split("."),l[E])}))}),i["--"]?u["--"]=h.slice():h.forEach(function(E){u._.push(E)}),u},sd}var ad,Jf;function Tg(){if(Jf)return ad;Jf=1;function n(i){return i.split(/:(.+)/).map(r=>r.trim())}function e(i){return i.split(/=(.+)/)}function t(i,r=n){let s={};var a=r(i);return s[a[0]]=a[1],s}function o(i){if(i==="")return null;let r={};return i.split(/&/).forEach(a=>{const l=a.split(/=/);r[l[0]]=l[1]}),r}return ad={header:i=>{let r={};if(typeof i=="string")r=t(i);else return i.forEach(s=>{r={...r,...t(s,n)}}),r;return r},body:i=>{if(typeof i=="string")try{return JSON.parse(i)}catch{try{return o(i)}catch{return i}}else{let r={};return i.forEach(s=>{r={...r,...t(s,e)}}),r}},parseParamsField:o},ad}var ld,Zf;function CA(){if(Zf)return ld;Zf=1;const n=Tg();return ld=[{name:"url",alias:["url","curl"],description:"Url request",convertor:null},{name:"cookie",alias:["b","cookie"],description:"<name=data> Supply cookie with request. If no =, then specifies the cookie file to use (see -c).",convertor:null},{name:"cookie-jar",alias:["c","cookie-jar"],description:"<file name> File to save response cookies to.",convertor:null},{name:"data",alias:["d","data","data-raw","data-urlencode","data-binary"],description:"<data> Send specified data in POST request. Details provided below.",convertor:n.body},{name:"fail",alias:["f","fail"],description:"Fail silently (don't output HTML error form if returned).",convertor:null},{name:"form",alias:["F","form"],description:"<name=content> Submit form data.",convertor:null},{name:"header",alias:["H","header"],description:"<header> Headers to supply with request.",convertor:n.header},{name:"include",alias:["i","include"],description:"Include HTTP headers in the output.",convertor:null},{name:"head",alias:["I","head"],description:"Fetch headers only.",convertor:null},{name:"insecure",alias:["k","insecure"],description:"Allow insecure connections to succeed.",convertor:null},{name:"location",alias:["L","location"],description:"v",convertor:null},{name:"output",alias:["o","output"],description:"<file> Write output to . Can use --create-dirs in conjunction with this to create any directories specified in the -o path.",convertor:null},{name:"remote-name",alias:["remote-name","O"],description:"Write output to file named like the remote file (only writes to current directory).",convertor:null},{name:"silent",alias:["s","silent"],description:"Silent (quiet) mode. Use with -S to force it to show errors.",convertor:null},{name:"verbose",alias:["v","verbose"],description:"Provide more information (useful for debugging).",convertor:null},{name:"write-out",alias:["write-out","w"],description:`<format> Make curl display information on stdout after a completed transfer. See man page for more details on available variables. Convenient way to force curl to append a newline to output: -w "
" (can add to ~/.curlrc).`,convertor:null},{name:"method",alias:["X","request"],description:"The request method to use.",convertor:null},{name:"user-agent",alias:["A","user-agent"],description:"Specify the User-Agent send to the HTTP server.",convertor:null},{name:"referer",alias:["e","referer"],description:'Sends the "Referrer Page" information to the HTTP server.',convertor:null}],ld}var ud,Qf;function SA(){return Qf||(Qf=1,ud={matchArgv:function(n){return n.replace(/\\\n/g," ").match(/"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|[^\s]+/g).map(e=>e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1):e)}}),ud}var ep;function kA(){return ep||(ep=1,(function(n,e){const t=wA(),o=Tg(),i=CA(),r=SA();n.exports=e.default=function(s){(typeof s=="string"||s instanceof String)&&(s=r.matchArgv(s));const a=t(s);let l={};if(a._[1]&&(l.url=a._[1].replace(/'/g,"")),i.forEach(u=>{let f=u.alias.map(p=>a[p]).filter(p=>p)[0];f&&(u.convertor?l[u.name]=u.convertor(f):l[u.name]=f)}),l.url){let u=new URL(l.url);l.url=u.origin+u.pathname;let c=new URLSearchParams(u.search);Array.from(c).length&&(l.params=o.parseParamsField(c.toString()))}return l.method||(l.method=l.data?"POST":"GET"),l}})(tl,tl.exports)),tl.exports}var EA=kA();const DA=Ts(EA),AA={class:"parse-curl-modal"},OA={key:0,class:"parse-error"},NA={__name:"parse-curl-modal",emits:["parse","close"],setup(n,{expose:e,emit:t}){const o=t,i=G(!1),r=G(!1),s=G(""),a=G(""),l=G(`请粘贴 cURL 命令，例如：curl -X POST https://api.example.com/data -H 'Content-Type: application/json' -d '{"key":"value"}'`),u=()=>{i.value=!0,s.value="",a.value="",r.value=!1},c=()=>{i.value=!1,s.value="",a.value="",o("close")},f=async()=>{if(!s.value.trim()){a.value="请输入 cURL 命令";return}a.value="";try{let p=s.value.trim();const h="__SINGLE_QUOTE_PLACEHOLDER__";let g=p.replace(/'\\''/g,h);g=g.replace(/\\\n/g," ").replace(/\\/g,"");let m=DA(decodeURIComponent(g));if(m.params){const _={};for(const[v,b]of Object.entries(m.params)){const C=decodeURIComponent(v),M=typeof b=="string"?decodeURIComponent(b):b;_[C]=M}m.params=_}if(m.data&&(m.header&&m.header["Content-Type"]?m.header["Content-Type"].toLowerCase():"").includes("application/x-www-form-urlencoded")&&typeof m.data=="object"){const b={};for(const[C,M]of Object.entries(m.data)){const O=decodeURIComponent(C),k=typeof M=="string"?decodeURIComponent(M):M;b[O]=k}m.data=b}if(m=JSON.stringify(m).split(h).join("'"),m=JSON.parse(m),m.method!=="GET"&&m.method!=="POST"){a.value="只支持 GET、POST 请求";return}o("parse",m)}catch(p){a.value=p.message}};return e({show:u,handleClose:c}),(p,h)=>{const g=Fr,m=Bi,_=kn,v=vn;return w(),Q(v,{open:i.value,"onUpdate:open":h[2]||(h[2]=b=>i.value=b),title:"解析 cURL",width:680,"confirm-loading":r.value,onOk:f,onCancel:c,okText:"解析",cancelText:"取消"},{default:x(()=>[d("div",AA,[y(g,{message:"请粘贴 cURL 命令，系统将自动解析并填充到 HTTP 请求配置中。只支持 GET、POST 请求。",type:"info","show-icon":"",class:"mb16"}),y(_,{label:""},{default:x(()=>[y(m,{class:"curl-textarea",value:s.value,"onUpdate:value":h[0]||(h[0]=b=>s.value=b),placeholder:l.value,"auto-size":{minRows:8,maxRows:8},maxlength:5e4,"show-count":""},null,8,["value","placeholder"])]),_:1}),a.value?(w(),R("div",OA,[y(g,{message:a.value,type:"error","show-icon":"",closable:"",onClose:h[1]||(h[1]=b=>a.value="")},null,8,["message"])])):ie("",!0)])]),_:1},8,["open","confirm-loading"])}}},MA=Te(NA,[["__scopeId","data-v-716f52ef"]]),TA={class:"mt24"},$A={class:"add-btn-block"},PA={class:"list-box"},RA={__name:"add-authentication-modal",emits:["ok"],setup(n,{expose:e,emit:t}){const o=G(!1),i=G([]),r=t,s=[{title:"Key",dataIndex:"auth_key"},{title:"Value",dataIndex:"auth_value"},{title:"Add To",dataIndex:"auth_value_addto"},{title:"备注",dataIndex:"auth_remark"},{title:"操作",dataIndex:"action",width:80}],a=Je({selectedRowKeys:[]}),l=_=>{a.selectedRowKeys=_},u=()=>{o.value=!0,a.selectedRowKeys=[],p()},c=()=>{if(i.value.length>=100)return xt.error("最多添加100条");i.value.push({auth_key:"",auth_value:"",auth_value_addto:"HEADERS",auth_remark:"",uni_key:_n(16)})},f=_=>{i.value=i.value.filter(v=>v.uni_key!==_.uni_key)},p=()=>{ry().then(_=>{let v=_.data||[];i.value=v.map(b=>({...b,uni_key:_n(16)}))})};function h(){let _=[],v=[];return i.value.forEach((b,C)=>{v.push({auth_key:b.auth_key,auth_value:b.auth_value,auth_value_addto:b.auth_value_addto,auth_remark:b.auth_remark}),(b.auth_key==""||b.auth_value=="")&&_.push(C+1)}),_.length>0?(xt.error(`请填写第${_.join(",")}行参数`),!1):v.length==0?(xt.error("请添加参数"),!1):v}const g=()=>{let _=h();if(_==!1)return;let v=[];a.selectedRowKeys.forEach(b=>{v.push(i.value.find(C=>C.uni_key==b))}),r("ok",v),Hf({http_auth_config_list:JSON.stringify(_)}).then(b=>{xt.success("保存成功")}).finally(()=>{a.selectedRowKeys=[],o.value=!1})},m=()=>{let _=h();_!=!1&&Hf({http_auth_config_list:JSON.stringify(_)}).then(v=>{xt.success("保存成功")})};return e({show:u}),(_,v)=>{const b=Fr,C=Kt,M=ln,O=Vt,k=It,E=xy,S=Ms,N=vn;return w(),R("div",null,[y(N,{open:o.value,"onUpdate:open":v[1]||(v[1]=L=>o.value=L),title:"鉴权参数",width:700},{footer:x(()=>[y(C,{onClick:v[0]||(v[0]=L=>o.value=!1)},{default:x(()=>[...v[7]||(v[7]=[U("取消",-1)])]),_:1}),y(C,{onClick:m},{default:x(()=>[...v[8]||(v[8]=[U("仅保存参数",-1)])]),_:1}),y(C,{type:"primary",onClick:g},{default:x(()=>[...v[9]||(v[9]=[U("保存并添加",-1)])]),_:1})]),default:x(()=>[d("div",TA,[y(b,{class:"zm-alert-info",message:"选择的参数会自动填充到http节点，鉴权参数在导出CSL或上架模板时会自动清空",type:"info"})]),d("div",$A,[y(C,{type:"primary",icon:Tt(K(Ht)),ghost:"",onClick:c},{default:x(()=>[...v[2]||(v[2]=[U("添加参数",-1)])]),_:1},8,["icon"])]),d("div",PA,[y(S,{"row-selection":{selectedRowKeys:a.selectedRowKeys,onChange:l},columns:s,pagination:!1,"data-source":i.value,"row-key":"uni_key",scroll:{y:550}},{bodyCell:x(({column:L,record:$})=>[L.dataIndex==="auth_key"?(w(),Q(M,{key:0,value:$.auth_key,"onUpdate:value":B=>$.auth_key=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_value"?(w(),Q(M,{key:1,value:$.auth_value,"onUpdate:value":B=>$.auth_value=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_value_addto"?(w(),Q(k,{key:2,value:$.auth_value_addto,"onUpdate:value":B=>$.auth_value_addto=B,style:{width:"100%"}},{default:x(()=>[y(O,{value:"HEADERS"},{default:x(()=>[...v[3]||(v[3]=[U("HEADERS",-1)])]),_:1}),y(O,{value:"PARAMS"},{default:x(()=>[...v[4]||(v[4]=[U("PARAMS",-1)])]),_:1}),y(O,{value:"BODY"},{default:x(()=>[...v[5]||(v[5]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="auth_remark"?(w(),Q(M,{key:3,maxLength:10,value:$.auth_remark,"onUpdate:value":B=>$.auth_remark=B,placeholder:"请输入"},null,8,["value","onUpdate:value"])):ie("",!0),L.dataIndex==="action"?(w(),Q(E,{key:4,title:"确认删除该字段?","ok-text":"确定","cancel-text":"取消",onConfirm:B=>f($)},{default:x(()=>[...v[6]||(v[6]=[d("a",null,"删除",-1)])]),_:1},8,["onConfirm"])):ie("",!0)]),_:1},8,["row-selection","data-source"])])]),_:1},8,["open"])])}}},BA=Te(RA,[["__scopeId","data-v-678c7a6b"]]),LA={class:"flex-content-box"},IA={class:"test-model-box"},FA={class:"auto-extract-tip"},jA={key:2,class:"input-list-box"},VA={class:"add-btn-box"},HA={class:"save-btn-box"},UA={key:0},zA={key:1},qA={class:"preview-box"},GA={class:"preview-content-block"},XA={class:"title-block"},WA={class:"preview-code-box"},YA={class:"preview-content-block"},KA={class:"title-block"},JA={class:"preview-code-box"},ZA={__name:"run-test",props:{node_key:{type:String,default:""}},emits:["save","autoExtract"],setup(n,{expose:e,emit:t}){const o=n,i=t,r=jn(),s=Xe(()=>r.robotInfo.isLockedByOther),a=G(!1),l=G([]),u=G({fields:[],output:{},result:{}}),c=G(!1),f=G(""),p=Je({is_draft:!0,robot_key:r.robotInfo.robot_key}),h=async O=>{if(s.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}u.value={fields:[],output:{},result:{}},f.value="",l.value=O,a.value=!0,l.value.forEach(k=>{k.field.typ.includes("array")&&m(k.field.Vals)})},g=(O,k)=>{O.splice(k,1)},m=O=>{O.push({value:"",key:rs(16)})},_=G(null),v=()=>{_.value.validate().then(()=>{const O={...p,curl_node_key:o.node_key},k=JSON.parse(JSON.stringify(l.value));k.forEach(E=>{E.field.typ.includes("array")&&(E.field.Vals=E.field.Vals.map(S=>S.value))}),O.test_params=JSON.stringify(k),c.value=!0,f.value="loading",sy({...O}).then(E=>{xt.success("测试结果生成完成"),u.value=E.data,f.value="success"}).catch(E=>{xt.error("测试结果生成失败"),f.value="error"}).finally(()=>{c.value=!1})})},b=O=>{Os(JSON.stringify(u.value[O])),xt.success("复制成功")},C=()=>{i("autoExtract",JSON.parse(JSON.stringify(u.value.fields)))};return e({open:O=>{h(O)}}),(O,k)=>{const E=Fr,S=wi,N=ii,L=ln,$=$n,B=Vn,A=Kt,D=kn,T=wn,F=vn;return w(),R("div",null,[y(F,{open:a.value,"onUpdate:open":k[2]||(k[2]=V=>a.value=V),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[...k[3]||(k[3]=[d("div",{class:"modal-title-block"},[d("span",null,"运行测试")],-1)])]),default:x(()=>[d("div",LA,[d("div",IA,[d("div",FA,[y(E,{message:"运行测试成功后，支持自动填充输出参数",type:"info","show-icon":""})]),y(T,{model:p,ref_key:"formRef",ref:_,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),R(ae,null,ye(l.value,V=>(w(),Q(D,{key:V.node_key,rules:[{required:V.field.required,message:`请输入${V.field.label}`}]},{label:x(()=>[y(N,{gap:4},{default:x(()=>[d("span",null,j(V.field.label),1),y(S,{style:{margin:"0"}},{default:x(()=>[U(j(V.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[V.field.typ=="string"?(w(),Q(L,{key:0,placeholder:"请输入",value:V.field.Vals,"onUpdate:value":P=>V.field.Vals=P},null,8,["value","onUpdate:value"])):ie("",!0),V.field.typ=="number"?(w(),Q($,{key:1,style:{width:"100%"},placeholder:"请输入",value:V.field.Vals,"onUpdate:value":P=>V.field.Vals=P},null,8,["value","onUpdate:value"])):ie("",!0),V.field.typ.includes("array")?(w(),R("div",jA,[(w(!0),R(ae,null,ye(V.field.Vals,(P,X)=>(w(),R("div",{class:"input-list-item",key:X},[y(B,null,{default:x(()=>[y(L,{placeholder:"请输入",value:P.value,"onUpdate:value":oe=>P.value=oe},null,8,["value","onUpdate:value"])]),_:2},1024),V.field.Vals.length>1?(w(),Q(K(Jt),{key:0,onClick:oe=>g(V.field.Vals,X)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",VA,[y(A,{onClick:P=>m(V.field.Vals),block:"",type:"dashed"},{default:x(()=>[...k[4]||(k[4]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),d("div",HA,[y(A,{loading:c.value,onClick:v,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[c.value?ie("",!0):(w(),R("span",UA,[y(K(ni)),k[5]||(k[5]=U("运行测试",-1))])),c.value?(w(),R("span",zA,"测试结果生成中...")):ie("",!0)]),_:1},8,["loading"]),f.value==="success"?(w(),Q(A,{key:0,style:{"margin-left":"16px"},type:"primary",onClick:C},{default:x(()=>[...k[6]||(k[6]=[U("自动提取输出参数",-1)])]),_:1})):ie("",!0)])]),d("div",qA,[f.value==="success"?(w(),R(ae,{key:0},[k[9]||(k[9]=d("div",{class:"preview-title"},[d("div",{class:"title-text"},"日志详情")],-1)),d("div",GA,[d("div",XA,[k[7]||(k[7]=U("原始输出",-1)),y(K(Oo),{onClick:k[0]||(k[0]=V=>b("result"))})]),d("div",WA,[y(K(Mo),{data:u.value.result},null,8,["data"])])]),d("div",YA,[d("div",KA,[k[8]||(k[8]=U("运行日志",-1)),y(K(Oo),{onClick:k[1]||(k[1]=V=>b("output"))})]),d("div",JA,[y(K(Mo),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},QA=Te(ZA,[["__scopeId","data-v-221804ef"]]),eO={class:"problem-optimization-form"},tO={class:"node-form-content"},nO={class:"gray-block"},oO={class:"gray-block-title export-curl-title"},iO={class:"flex-block-item"},rO={class:"array-form-box"},sO={class:"flex-block-item"},aO={class:"at-input-flex1"},lO={class:"field-list-item"},uO={class:"field-label"},dO={class:"field-type"},cO=["onClick"],fO={class:"array-form-box"},pO={class:"flex-block-item"},hO={class:"at-input-flex1"},vO={class:"field-list-item"},gO={class:"field-label"},_O={class:"field-type"},mO=["onClick"],yO={key:0},bO={key:0,class:"array-form-box"},xO={class:"flex-block-item"},wO={class:"at-input-flex1"},CO={class:"field-list-item"},SO={class:"field-label"},kO={class:"field-type"},EO=["onClick"],DO={class:"field-list-item"},AO={class:"field-label"},OO={class:"field-type"},NO={class:"flex-block-item"},MO={class:"gray-block mt16"},TO={class:"gray-block-title"},$O={class:"output-box"},PO={class:"flex-block-item",style:{gap:"12px"}},RO=["onClick"],BO={class:"gray-block mt16"},LO={class:"output-box"},IO={class:"flex-block-item",style:{gap:"12px"}},FO=["onClick"],jO=["onClick"],VO={key:0,class:"sub-field-box"},HO={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("handleAutoSaveDraft"),r=G([]),s=Je({}),a=G(null),l=G(),u=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[],http_auth:[]}),c=G(),f=()=>{c.value.show()},p=W=>{let Z=[{key:"",value:""}],le=[{key:"",value:""}],te=[],q="",re=!1;u.method=W.method,u.rawurl=W.url;function ce(ve){return typeof ve=="string"?ve:JSON.stringify(ve)}W.header&&typeof W.header=="object"&&(Z=Object.keys(W.header).map(ve=>(ve.toLowerCase()=="content-type"&&W.header[ve].indexOf("application/json")!==-1&&(re=!0),{key:ve,value:ce(W.header[ve]),cu_key:_n(16)})),Z=Z.filter(ve=>ve.key.toLowerCase()!=="content-type")),W.data&&typeof W.data=="object"&&(te=Object.keys(W.data).map(ve=>({key:ve,value:ce(W.data[ve]),cu_key:_n(16)})),q=JSON.stringify(W.data)),W.params&&typeof W.params=="object"&&(le=Object.keys(W.params).map(ve=>({key:ve,value:ce(W.params[ve]),cu_key:_n(16)}))),re?(u.type=2,u.body_raw=q):(u.type=1,u.body=te),u.headers=Z,u.params=le};function h(W){return W.forEach(Z=>{Z.cu_key=_n(16),Z.subs&&Z.subs.length?h(Z.subs):Z.subs=[]}),W}function g(W){return W.typ.includes("array")?[]:null}const m=async()=>{var le;let W=JSON.parse(JSON.stringify(u));await i();let Z=[];W.headers.forEach(te=>{te.tags&&te.tags.length&&(Z=Z.concat(te.tags))}),W.params.forEach(te=>{te.tags&&te.tags.length&&(Z=Z.concat(te.tags))}),u.type==1?W.body.forEach(te=>{te.tags&&te.tags.length&&(Z=Z.concat(te.tags))}):u.type==2&&W.body_raw_tags.length&&(Z=Z.concat(W.body_raw_tags)),Z=Z.map(te=>({node_key:te.node_id,field:{key:te.original_value,label:te.label,typ:te.typ,Vals:g(te),required:!1,sys:!1}})),(le=a.value)==null||le.open(Z)},_=W=>{u.output=W,xt.success("自动提取成功")},v=(W,Z,le)=>{if(W){let te=`at_input_${Z}_${le}`;s[te]=W}},b=(W,Z,le,te)=>{W=="body_raw"?(u.body_raw=Z,u.body_raw_tags=le):(te.tags=le,te.value=Z)},C=()=>{const W=o.lf.getNodeModelById(o.nodeId);if(W){let Z=W.getAllParentVariable();Z.forEach(le=>{le.tags=le.tags||[]}),r.value=Z}},M=()=>{const W=JSON.stringify({curl:{...u}});t("update-node",{...o.node,...u,node_params:W})},O=()=>{try{let W=o.node.dataRaw||o.node.node_params||"{}",Z=JSON.parse(W).curl||{};Z=JSON.parse(JSON.stringify(Z)),C();for(let le in Z){if(le=="headers"||le=="params"||le=="body"){Z[le]&&Z[le].length>0?u[le]=Z[le].map(te=>({...te,cu_key:_n(16)})):u[le]=[];continue}if(le=="output"){u.output=h(Z[le]);continue}u[le]=Z[le]}u.http_auth=Z.http_auth||[]}catch(W){}};gt(()=>u,()=>{M()},{deep:!0});const k=()=>{u.headers.push({key:"",value:"",cu_key:_n(16)})},E=W=>{u.headers.splice(W,1)},S=()=>{u.params.push({key:"",value:"",cu_key:_n(16)})},N=W=>{u.params.splice(W,1)},L=()=>{u.body.push({key:"",value:"",cu_key:_n(16)})},$=W=>{u.body.splice(W,1)},B=()=>{u.output.push({key:"",typ:"string",subs:[],cu_key:_n(16)})},A=W=>{u.output.splice(W,1)},D=W=>{W.subs=[]},T=W=>{(!u.output[W].subs||!Array.isArray(u.output[W].subs))&&(u.output[W].subs=[]),u.output[W].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],V=G(null),P=()=>{V.value.show()},X=W=>{let Z=W.map(le=>({key:le.auth_key,value:le.auth_value,add_to:le.auth_value_addto}));u.http_auth=[...u.http_auth,...Z]},oe=W=>{u.http_auth.splice(W,1)},H=()=>{t("close")};return ut(()=>{O()}),(W,Z)=>{const le=Qt,te=Kt,q=Vt,re=It,ce=Vn,ve=ln,Ne=kn,ge=Ii,_e=Li,st=ii,tt=$n,ke=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:H},{runBtn:x(()=>[y(le,null,{title:x(()=>[...Z[8]||(Z[8]=[U("运行测试",-1)])]),default:x(()=>[d("div",{class:"run-test-btn",onClick:m},[y(K(ni),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",eO,[d("div",tO,[y(ke,{ref_key:"formRef",ref:l,layout:"vertical",model:u},{default:x(()=>[d("div",nO,[d("div",oO,[Z[10]||(Z[10]=d("span",null," 输入",-1)),y(te,{ghost:"",type:"primary",size:"small",onClick:f},{default:x(()=>[y(K(wy)),Z[9]||(Z[9]=U(" 导入cURL ",-1))]),_:1})]),y(Ne,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:x(()=>[d("div",iO,[y(ce,null,{default:x(()=>[y(re,{value:u.method,"onUpdate:value":Z[0]||(Z[0]=he=>u.method=he),style:{width:"120px"}},{default:x(()=>[y(q,{value:"POST"},{default:x(()=>[...Z[11]||(Z[11]=[U("POST",-1)])]),_:1}),y(q,{value:"GET"},{default:x(()=>[...Z[12]||(Z[12]=[U("GET",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),y(ve,{class:"flex1",value:u.rawurl,"onUpdate:value":Z[1]||(Z[1]=he=>u.rawurl=he),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),d("div",rO,[Z[14]||(Z[14]=d("div",{class:"form-item-label"},"HEADERS",-1)),(w(!0),R(ae,null,ye(u.headers,(he,De)=>(w(),R("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["headers",De,"value"]},{default:x(()=>[d("div",sO,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",aO,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>v(Me,"headers",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,z)=>b("headers",Me,z,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:z})=>[d("div",lO,[d("div",uO,j(Me),1),d("div",dO,j(z.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>E(De)},[y(K(Jt))],8,cO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:k,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...Z[13]||(Z[13]=[U("添加参数",-1)])]),_:1},8,["icon"])]),d("div",fO,[Z[16]||(Z[16]=d("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),R(ae,null,ye(u.params,(he,De)=>(w(),R("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["params",De,"value"]},{default:x(()=>[d("div",pO,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",hO,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>v(Me,"params",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,z)=>b("params",Me,z,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:z})=>[d("div",vO,[d("div",gO,j(Me),1),d("div",_O,j(z.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>N(De)},[y(K(Jt))],8,mO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:S,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...Z[15]||(Z[15]=[U("添加参数",-1)])]),_:1},8,["icon"])]),u.method=="POST"?(w(),R("div",yO,[y(Ne,{label:"BODY",name:"type",class:"line-height-22"},{default:x(()=>[y(_e,{value:u.type,"onUpdate:value":Z[2]||(Z[2]=he=>u.type=he)},{default:x(()=>[y(ge,{value:0},{default:x(()=>[...Z[17]||(Z[17]=[U("none",-1)])]),_:1}),y(ge,{value:1},{default:x(()=>[...Z[18]||(Z[18]=[U("x-www-form-urlencoded",-1)])]),_:1}),y(ge,{value:2},{default:x(()=>[...Z[19]||(Z[19]=[U("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),u.type==1?(w(),R("div",bO,[(w(!0),R(ae,null,ye(u.body,(he,De)=>(w(),R("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["body",De,"value"],rules:{required:!0}},{default:x(()=>[d("div",xO,[y(ce,null,{default:x(()=>[y(ve,{style:{width:"120px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",wO,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:Me=>v(Me,"body",De),options:r.value,defaultSelectedList:he.tags,defaultValue:he.value,onOpen:C,onChange:(Me,z)=>b("body",Me,z,he,De),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:Me,payload:z})=>[d("div",CO,[d("div",SO,j(Me),1),d("div",kO,j(z.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",{class:"btn-hover-wrap",onClick:Me=>$(De)},[y(K(Jt))],8,EO)])]),_:2},1032,["name"])]))),128)),y(te,{onClick:L,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...Z[20]||(Z[20]=[U("添加参数",-1)])]),_:1},8,["icon"])])):ie("",!0),u.type==2?(w(),Q(Ne,{key:1,label:null,name:"body_raw"},{default:x(()=>[y(ot,{type:"textarea",options:r.value,defaultSelectedList:u.body_raw_tags,defaultValue:u.body_raw,ref:he=>v(he,"body","body_raw"),onOpen:C,onChange:Z[3]||(Z[3]=(he,De)=>b("body_raw",he,De)),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:he,payload:De})=>[d("div",DO,[d("div",AO,j(he),1),d("div",OO,j(De.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):ie("",!0)])):ie("",!0),y(Ne,{name:"timeout"},{label:x(()=>[y(st,{gap:2},{default:x(()=>[...Z[21]||(Z[21]=[U("超时时长",-1)])]),_:1})]),default:x(()=>[d("div",NO,[y(tt,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:u.timeout,"onUpdate:value":Z[4]||(Z[4]=he=>u.timeout=he),min:0,max:3e3},null,8,["value"]),Z[22]||(Z[22]=U(" 秒 ",-1))])]),_:1})]),d("div",MO,[d("div",TO,[Z[24]||(Z[24]=U("鉴权 ",-1)),y(le,null,{title:x(()=>[...Z[23]||(Z[23]=[U("鉴权参数：导出模板CSL文件，或者上架模板时，自动清空参数值",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",$O,[Z[29]||(Z[29]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"124px"}},"Key"),d("div",{class:"output-item",style:{width:"124px"}},"Value"),d("div",{class:"output-item",style:{width:"124px"}},"Add To")],-1)),d("div",{class:"array-form-box",onMousedown:Z[5]||(Z[5]=St(()=>{},["stop"]))},[(w(!0),R(ae,null,ye(u.http_auth,(he,De)=>(w(),R("div",{class:"form-item-list",key:De},[y(Ne,{label:null},{default:x(()=>[d("div",PO,[y(ve,{style:{width:"124px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(ce,null,{default:x(()=>[y(ve,{style:{width:"124px"},value:he.value,"onUpdate:value":Me=>he.value=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(re,{value:he.add_to,"onUpdate:value":Me=>he.add_to=Me,style:{width:"124px"}},{default:x(()=>[y(q,{value:"HEADERS"},{default:x(()=>[...Z[25]||(Z[25]=[U("HEADERS",-1)])]),_:1}),y(q,{value:"PARAMS"},{default:x(()=>[...Z[26]||(Z[26]=[U("PARAMS",-1)])]),_:1}),y(q,{value:"BODY"},{default:x(()=>[...Z[27]||(Z[27]=[U("BODY",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:Me=>oe(De)},[y(K(Jt))],8,RO)])]),_:2},1024)]))),128)),y(te,{onClick:P,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...Z[28]||(Z[28]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])]),d("div",BO,[d("div",{class:"gray-block-title output-title",onClick:Z[6]||(Z[6]=(...he)=>W.test&&W.test(...he))},[Z[31]||(Z[31]=d("span",null,"输出 (输出字段提取)",-1)),y(te,{type:"primary",size:"small",onClick:m},{default:x(()=>[...Z[30]||(Z[30]=[U("自动提取输出参数",-1)])]),_:1})]),d("div",LO,[Z[33]||(Z[33]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:Z[7]||(Z[7]=St(()=>{},["stop"]))},[(w(!0),R(ae,null,ye(u.output,(he,De)=>(w(),R("div",{class:"form-item-list",key:De},[y(Ne,{label:null,name:["output",De,"key"]},{default:x(()=>[d("div",IO,[y(ve,{style:{width:"214px"},value:he.key,"onUpdate:value":Me=>he.key=Me,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(ce,null,{default:x(()=>[y(re,{onChange:Me=>D(he),value:he.typ,"onUpdate:value":Me=>he.typ=Me,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(ae,null,ye(F,Me=>y(q,{value:Me.value,key:Me.value},{default:x(()=>[U(j(Me.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),he.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:Me=>T(De)},[y(K(Fn))],8,FO)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:Me=>A(De)},[y(K(Jt))],8,jO)]),he.subs&&he.subs.length>0?(w(),R("div",VO,[y(ce,null,{default:x(()=>[y(xA,{data:he.subs,level:2,typOptions:F},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(te,{onClick:B,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...Z[32]||(Z[32]=[U("添加参数",-1)])]),_:1},8,["icon"])],32)])])]),_:1},8,["model"])])]),y(MA,{ref_key:"parseCurlModalRef",ref:c,onParse:p},null,512),y(BA,{onOk:X,ref_key:"addAuthenticationModalRef",ref:V},null,512),y(QA,{ref_key:"runTestRef",ref:a,node_key:n.nodeId,onAutoExtract:_},null,8,["node_key"])]),_:1})}}},UO=Te(HO,[["__scopeId","data-v-7d51f7da"]]),Tn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},$g={string:[Tn.EQUALITY.IS,Tn.EQUALITY.IS_NOT,Tn.TEXT.CONTAIN,Tn.TEXT.NOT_CONTAIN,Tn.NULLABILITY.EMPTY,Tn.NULLABILITY.NOT_EMPTY],integer:[Tn.COMPARISON.GT,Tn.COMPARISON.LT,Tn.COMPARISON.GTE,Tn.COMPARISON.LTE,Tn.EQUALITY.EQ,Tn.COMPARISON.BETWEEN],number:[Tn.COMPARISON.GT,Tn.COMPARISON.LT,Tn.COMPARISON.GTE,Tn.COMPARISON.LTE,Tn.EQUALITY.EQ,Tn.COMPARISON.BETWEEN],boolean:[Tn.BOOLEAN.TRUE,Tn.BOOLEAN.FALSE]},Pg=n=>$g[n]||[],of=(n,e)=>{const o=Pg(e).find(i=>i.value===n);return(o==null?void 0:o.label)||n},zO={class:"query-condition-filter"},qO={class:"condition-select-box"},GO={class:"select-wrapper"},XO={class:"field-items"},WO={class:"field-select-box"},YO={class:"operator-select-box"},KO={class:"field-value-box"},JO={key:0,class:"site-input-group-wrapper"},ZO={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},QO={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},eN=["onClick"],tN={class:"add-btn-box"},nN={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:o.where,type:o.type});gt(()=>o.where,C=>{r.list=C}),gt(()=>o.type,C=>{r.type=C});const s=Xe(()=>o.where.length>1),a=Xe(()=>$g),l=G([]),u=()=>{let C=i().getAllParentVariable();l.value=C||[]},c=()=>{u()},f=()=>{let C={type:r.type,list:r.list};t("change",C)},p=(C,M,O,k)=>{r.list[k].rule_value1=C,r.list[k].atTags=M,f()},h=(C,M,O,k)=>{r.list[k].rule_value2=C,r.list[k].atTags2=M,f()},g=()=>{let C={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list.push(C),f()},m=C=>{r.list.splice(C,1),f()},_=(C,M)=>{let O=Pg(M.type),k={form_field_id:M.value,field_name:M.name,field_type:M.type,rule:O[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};r.list[C]=k,f()},v=(C,M)=>{let O=r.list[C];O.rule=M.value,O.rule_value1="",O.rule_value2="",O.atTags=[],O.atTags2=[],f()},b=({key:C})=>{r.type=C,t("changeType",C),f()};return ut(()=>{u()}),(C,M)=>{const O=Lr,k=Br,E=Ir,S=Vt,N=It,L=ln,$=Nn,B=Kt,A=Qt;return w(),R("div",{class:Ct(["query-condition-filter-warpper",{"is-multiple":s.value}])},[d("div",zO,[M[5]||(M[5]=d("div",{class:"auxiliary-line"},null,-1)),d("div",qO,[d("div",GO,[y(E,null,{overlay:x(()=>[y(k,{style:{width:"100px"},onClick:b},{default:x(()=>[(w(),Q(O,{key:1},{default:x(()=>[...M[1]||(M[1]=[d("a",{href:"javascript:;"},"且",-1)])]),_:1})),(w(),Q(O,{key:2},{default:x(()=>[...M[2]||(M[2]=[d("a",{href:"javascript:;"},"或",-1)])]),_:1}))]),_:1})]),default:x(()=>[d("a",{class:"ant-dropdown-link",onClick:M[0]||(M[0]=St(()=>{},["prevent"]))},[U(j(r.type==1?"且":"或")+" ",1),y(K(Ro))])]),_:1})])]),d("div",XO,[(w(!0),R(ae,null,ye(r.list,(D,T)=>(w(),R("div",{class:"field-item",key:D.field},[d("div",WO,[y(N,{style:{width:"100px"},value:D.form_field_id,"onUpdate:value":F=>D.form_field_id=F,onChange:(F,V)=>_(T,V)},{default:x(()=>[y(S,{value:0,type:"integer",name:"ID",key:"id"},{default:x(()=>[...M[3]||(M[3]=[U("ID",-1)])]),_:1}),(w(!0),R(ae,null,ye(o.fieldOptions,F=>(w(),Q(S,{value:F.id,type:F.type,name:F.name,key:F.id},{default:x(()=>[U(j(F.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),d("div",YO,[y(N,{value:D.rule,"onUpdate:value":F=>D.rule=F,style:{width:"100px"},onChange:(F,V)=>v(T,V)},{default:x(()=>[(w(!0),R(ae,null,ye(a.value[D.field_type],F=>(w(),Q(S,{value:F.value,key:F.value},{default:x(()=>[U(j(F.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),d("div",KO,[D.rule==="between"?(w(),R("div",JO,[d("div",ZO,[y(ot,{options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,V)=>p(F,V,D,T),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),M[4]||(M[4]=d("span",{class:"site-input-split"},"~",-1)),d("div",QO,[y(ot,{options:l.value,defaultValue:D.rule_value2,defaultSelectedList:D.atTags2,onOpen:c,onChange:(F,V)=>h(F,V,D,T),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(D.field_type)?(w(),Q(L,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(D.field_type)?(w(),Q(ot,{key:2,options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,V)=>p(F,V,D,T),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(w(),Q(ot,{key:3,options:l.value,defaultValue:D.rule_value1,defaultSelectedList:D.atTags,onOpen:c,onChange:(F,V)=>p(F,V,D,T),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),d("span",{class:"field-del-btn",onClick:F=>m(T)},[y($,{class:"del-icon",name:"close-circle"})],8,eN)]))),128))])]),d("div",tN,[n.disabled?(w(),Q(A,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(B,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(K(Ht)),M[6]||(M[6]=U(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Q(B,{key:1,class:"add-btn",type:"dashed",block:"",onClick:g},{default:x(()=>[y(K(Ht)),M[7]||(M[7]=U(" 添加条件 ",-1))]),_:1}))])],2)}}},rf=Te(nN,[["__scopeId","data-v-c3ccab04"]]),oN={class:"delete-data-form"},iN={class:"node-box-content"},rN={class:"setting-box"},sN={class:"setting-box"},aN={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("setData"),o=sr();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),s=({type:g,list:m})=>{r.formData.typ=g,r.formData.where=m,u()},a=(g,m)=>{m?(r.formData.form_name=m.name,r.formData.form_description=m.description,h(m.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.where=[]),u()},l=()=>{let g=e.node.dataRaw||"{}";i=JSON.parse(g);let m=c(i.form_delete.where||[]);i.form_delete.where=m,r.formData=i.form_delete,r.formData.form_id&&h(r.formData.form_id),u()},u=()=>{let g={...Bn(r.formData)};g.where=f(g.where),i.form_delete=g,t({...e.node,node_params:JSON.stringify(i)})},c=g=>{let m=[];return g.forEach(_=>{let v=JSON.parse(JSON.stringify(_)),b=v.rule.split("_");v.form_field_id=v.form_field_id*1,v.field_type=b[0],b.shift(),v.rule=b.join("_"),m.push(v)}),m},f=g=>{let m=[];return g.forEach(_=>{let v=JSON.parse(JSON.stringify(_));v.form_field_id=v.form_field_id*1,v.rule=_.field_type+"_"+_.rule,m.push(v)}),m},p=async()=>{const g=await o.getFormList();g&&(r.tableList=g)},h=async g=>{o.getFormFieldList({form_id:g}).then(m=>{m.forEach(_=>{_.id=_.id*1}),r.fieldList=m}).catch(()=>{})};return ut(()=>{p(),l()}),(g,m)=>(w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...m[1]||(m[1]=[d("span",null,[U("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",oN,[d("div",iN,[m[2]||(m[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),m[3]||(m[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",rN,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":m[0]||(m[0]=_=>r.formData.form_id=_),onChange:a},null,8,["options","title","description","value"])]),m[4]||(m[4]=d("div",{class:"setting-label"},[d("span",null,"删除条件")],-1)),d("div",sN,[y(rf,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},lN=Te(aN,[["__scopeId","data-v-35e370b4"]]),uN={class:"variable-node"},dN={class:"node-form-content"},cN={class:"gray-block"},fN={class:"field-items"},pN={class:"field-name-box"},hN={class:"field-value-box"},vN={class:"field-value-option"},gN={class:"option-label"},_N={class:"option-type"},mN={class:"field-actions"},yN={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=G([]),r=G([]);function s(){const v=o.lf.getNodeModelById(o.nodeId);if(v){let b=v.properties.loop_parent_key;if(b){const O=o.lf.getNodeModelById(b);if(O){let k=O.properties.dataRaw||O.properties.node_params||"{}",E=JSON.parse(k).loop||{};r.value=E.intermediate_params.map(S=>({label:S.key,value:b+"."+S.key}));return}}let M=v.getGlobalVariable().diy_global||[];M.forEach(O=>{O.label=O.key,O.value="global."+O.key}),r.value=M||[]}}function a(){const v=o.lf.getNodeModelById(o.nodeId);if(v){let b=v.getAllParentVariable();i.value=b}}const l=G([]),u=()=>{let v=JSON.parse(o.node.node_params);v.assign=[...l.value],t("update-node",{...o.node,node_params:JSON.stringify(v)})},c=()=>{try{let v=o.node.dataRaw||o.node.node_params||"{}",b=JSON.parse(v).assign||[];b=JSON.parse(JSON.stringify(b)),b.forEach(C=>{C.tags=C.tags||[]}),l.value=b,s()}catch(v){}},f=v=>{v&&a()},p=(v,b,C)=>{C.tags=b,C.value=v,u()},h=()=>{l.value.push({variable:void 0,value:""}),u()},g=v=>{l.value.splice(v,1),u()},m=v=>{v&&s()},_=()=>{t("close")};return ut(()=>{c()}),(v,b)=>{const C=Vt,M=It,O=Kt;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:_},null,8,["title","iconName"])]),default:x(()=>[d("div",uN,[d("div",dN,[d("div",cN,[d("div",fN,[(w(!0),R(ae,null,ye(l.value,(k,E)=>(w(),R("div",{class:"field-item",key:E},[d("div",pN,[y(M,{style:{width:"100%"},placeholder:"请输入选择变量",value:k.variable,"onUpdate:value":S=>k.variable=S,onDropdownVisibleChange:m,onChange:u},{default:x(()=>[(w(!0),R(ae,null,ye(r.value,S=>(w(),Q(C,{value:S.value,key:S.key},{default:x(()=>[d("span",null,j(S.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),d("div",hN,[y(ot,{ref_for:!0,ref:"atInput"+E,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:k.tags,defaultValue:k.value,onOpen:f,onChange:(S,N)=>p(S,N,k,E),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:S,payload:N})=>[d("div",vN,[d("div",gN,j(S),1),d("div",_N,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",mN,[y(K(Jt),{class:"action-btn",onClick:S=>g(E)},null,8,["onClick"])])]))),128))]),d("div",null,[y(O,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:h},{icon:x(()=>[y(K(Ht))]),default:x(()=>[b[0]||(b[0]=U(" 添加赋值变量 ",-1))]),_:1})])])])])]),_:1})}}},bN=Te(yN,[["__scopeId","data-v-c70b3834"]]),xN={class:"update-data-form"},wN={class:"node-box-content"},CN={class:"setting-box"},SN={class:"setting-box"},kN={class:"setting-box"},EN={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=sr();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),s=({type:m,list:_})=>{r.formData.typ=m,r.formData.where=_,c()},a=(m,_)=>{_?(r.formData.form_name=_.name,r.formData.form_description=_.description,g(_.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.datas=[],r.formData.where=[],r.formData.typ=1),c()},l=m=>{r.formData.datas=m,c()},u=()=>{let m=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(m);let _=f(i.form_update.where||[]);i.form_update.where=_,r.formData=i.form_update,r.formData.form_id&&g(r.formData.form_id),c()},c=()=>{let m={...Bn(r.formData)};m.where=p(m.where),i.form_update=m,t({...e.node,node_params:JSON.stringify(i)})},f=m=>{let _=[];return m.forEach(v=>{let b=JSON.parse(JSON.stringify(v)),C=b.rule.split("_");b.form_field_id=b.form_field_id*1,b.field_type=C[0],C.shift(),b.rule=C.join("_"),_.push(b)}),_},p=m=>{let _=[];return m.forEach(v=>{let b=JSON.parse(JSON.stringify(v));b.form_field_id=b.form_field_id*1,b.rule=v.field_type+"_"+v.rule,_.push(b)}),_},h=async()=>{const m=await o.getFormList();m&&(r.tableList=m)},g=async m=>{o.getFormFieldList({form_id:m}).then(_=>{_.forEach(v=>{v.id=v.id*1}),r.fieldList=_}).catch(()=>{})};return ut(()=>{h(),u()}),(m,_)=>(w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[..._[1]||(_[1]=[d("span",null,[U("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",xN,[d("div",wN,[_[2]||(_[2]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),_[3]||(_[3]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",CN,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":_[0]||(_[0]=v=>r.formData.form_id=v),onChange:a},null,8,["options","title","description","value"])]),_[4]||(_[4]=d("div",{class:"setting-label"},[d("span",null,"更新条件")],-1)),d("div",SN,[y(rf,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:s},null,8,["disabled","where","field-options","type"])]),_[5]||(_[5]=d("div",{class:"setting-label"},[d("span",null,"更新数据")],-1)),d("div",kN,[y(nf,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showEmptyFieldRow:r.formData.form_id=="",list:r.formData.datas,onChange:l},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},DN=Te(EN,[["__scopeId","data-v-60a76ec1"]]),Rg={__name:"add-params-modal",emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=G(!1),r=G("新增参数");let s="add";const a=(v,b)=>b?/^[a-zA-Z_]+$/.test(b)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let l=0;const u=Je({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),c=()=>{i.value=!0},f=()=>{Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="add",r.value="新增参数",i.value=!0},p=v=>{l=v,Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),s="addSub",r.value="新增参数",i.value=!0},h=(v,b)=>{l=b,Object.assign(u,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(u,{...v}),s="edit",r.value="编辑参数",i.value=!0},g=G(null),m=()=>{g.value.validate().then(()=>{s=="add"&&o("add",{...u}),s=="addSub"&&o("addSub",{...u},l),s=="edit"&&o("edit",{...u},l),i.value=!1})},_=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:c,add:f,edit:h,addSub:p}),(v,b)=>{const C=ln,M=kn,O=Vt,k=It,E=Ri,S=Bi,N=wn,L=vn;return w(),R("div",null,[y(L,{open:i.value,"onUpdate:open":b[5]||(b[5]=$=>i.value=$),title:r.value,onOk:m,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[y(N,{ref_key:"formRef",ref:g,layout:"vertical",model:u,style:{margin:"24px 0"}},{default:x(()=>[y(M,{label:"参数key",name:"key",rules:[{required:!0,validator:($,B)=>a($,B)}]},{default:x(()=>[y(C,{value:u.key,"onUpdate:value":b[0]||(b[0]=$=>u.key=$),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),y(M,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[y(k,{value:u.typ,"onUpdate:value":b[1]||(b[1]=$=>u.typ=$),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),R(ae,null,ye(_,$=>y(O,{value:$.value},{default:x(()=>[U(j($.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),y(M,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:x(()=>[y(E,{checked:u.required,"onUpdate:checked":b[2]||(b[2]=$=>u.required=$)},null,8,["checked"])]),_:1}),y(M,{label:"默认值",name:"default",rules:[{required:u.required,message:"请输入默认值"}]},{default:x(()=>[y(C,{value:u.default,"onUpdate:value":b[3]||(b[3]=$=>u.default=$),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),y(M,{label:"枚举值",name:"enum"},{default:x(()=>[y(S,{style:{height:"80px"},value:u.enum,"onUpdate:value":b[4]||(b[4]=$=>u.enum=$),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},AN={class:"sub-field-item"},ON=["onClick"],NN=["onClick"],MN=["onClick"],TN={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(h=>h.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px");let i=0;const r=(h,g)=>{g.splice(h,1)},s=h=>{h.subs=[]},a=G(null),l=h=>{i=h,a.value.add()},u=(h,g)=>{a.value.edit(h,g)},c=h=>{e.data[i].subs.push(h)},f=(h,g)=>{e.data.splice(g,1,h)},p=h=>h.typ=="object"&&e.level<=2;return(h,g)=>{const m=ln,_=Vt,v=It,b=Nt("SubsKey",!0);return w(),R(ae,null,[(w(!0),R(ae,null,ye(e.data,(C,M)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:C.cu_key},[d("div",AN,[g[0]||(g[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(m,{class:"mr12",style:In({width:o.value}),value:C.key,"onUpdate:value":O=>C.key=O,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),g[1]||(g[1]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(v,{class:"mr12",onChange:O=>s(C),value:C.typ,"onUpdate:value":O=>C.typ=O,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,O=>(w(),Q(_,{value:O.value},{default:x(()=>[U(j(O.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),p(C)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:O=>l(M,e.data)},[y(K(Fn))],8,ON)):ie("",!0),d("div",{class:"btn-hover-wrap mr12",onClick:O=>u(C,M)},[y(K(kr))],8,NN),d("div",{class:"btn-hover-wrap",onClick:O=>r(M,e.data)},[y(K(Jt))],8,MN)]),C.subs&&C.subs.length>0?(w(),Q(b,{key:0,level:e.level+1,typOptions:e.typOptions,data:C.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)),y(Rg,{onAdd:c,onEdit:f,ref_key:"addParamsModalRef",ref:a},null,512)],64)}}},$N=Te(TN,[["__scopeId","data-v-f6bf59d5"]]),PN={class:"problem-optimization-form"},RN={class:"node-form-content"},BN={class:"gray-block"},LN={class:"flex-block-item"},IN={class:"number-box"},FN={class:"number-slider-box"},jN={class:"number-input-box"},VN={class:"number-box"},HN={class:"number-slider-box"},UN={class:"number-input-box"},zN={class:"number-box"},qN={class:"number-box"},GN={class:"number-slider-box"},XN={class:"number-input-box"},WN={class:"field-list-item"},YN={class:"field-label"},KN={class:"field-type"},JN={class:"diy-form-item"},ZN={class:"form-content"},QN={class:"gray-block mt16"},e8={class:"output-box"},t8={class:"array-form-box"},n8={class:"flex-block-item",style:{gap:"12px"}},o8=["onClick"],i8=["onClick"],r8=["onClick"],s8={key:0,class:"sub-field-box"},a8={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=jn(),r=G(null),s=Xe(()=>i.modelList),a=G([]),l=G([]),u=G(!1),c=()=>{u.value=!u.value},f=(oe,H)=>{v.prompt=oe,v.prompt_tags=H};function p(){const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let H=oe.getAllParentVariable();l.value=h(H)}}function h(oe){return oe.forEach(H=>{H.typ=="node"?H.node_type==1?H.value="global":H.value=H.node_id:H.value=H.key,H.children&&H.children.length>0&&(H.children=h(H.children))}),oe}const g=()=>{const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let H=oe.getAllParentVariable();a.value=H}};function m(oe){if(oe){let H=oe.split("."),W=H[0],Z=H.filter((le,te)=>te>0).join(".");return[W,Z]}return["global","question"]}const _=G(),v=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),b=()=>{const oe=JSON.stringify({params_extractor:{...v,question_value:v.question_value.join("."),model_config_id:v.model_config_id?+v.model_config_id:v.model_config_id}});t("update-node",{...o.node,...v,node_params:oe})},C=()=>{try{let oe=o.node.dataRaw||o.node.node_params||"{}",H=JSON.parse(oe).params_extractor||{};H=JSON.parse(JSON.stringify(H)),g(),p();for(let W in H){if(W=="output"){v.output=M(H[W]);continue}if(W=="question_value"){v.question_value=m(H[W]);continue}v[W]=H[W]}!v.model_config_id&&s.value.length>0&&(v.model_config_id=s.value[0].id,v.use_model=s.value[0].children[0].name)}catch(oe){}};gt(()=>v,()=>{b()},{deep:!0});function M(oe){return oe.forEach(H=>{H.cu_key=Math.random()*1e4,H.subs&&H.subs.length?M(H.subs):H.subs=[]}),oe}const O=G(null),k=()=>{O.value.add()},E=(oe,H)=>{O.value.edit(oe,H)},S=oe=>{v.output.push(oe)},N=(oe,H)=>{v.output.splice(H,1,oe)},L=oe=>{v.output.splice(oe,1)},$=oe=>{oe.subs=[]},B=oe=>{O.value.addSub(oe)},A=(oe,H)=>{v.output[H].subs.push(oe)},D=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],T=oe=>{oe||p()},F=G({}),V=(oe,H)=>{F.value=H},P=Xe(()=>{if(!v.model_config_id)return!1;let oe=v.model_config_id+"#"+v.use_model;return F.value[oe]}),X=()=>{t("close")};return ut(()=>{C()}),(oe,H)=>{const W=Kt,Z=kn,le=Qt,te=Ns,q=Vn,re=$n,ce=Ri,ve=oi,Ne=ln,ge=Vt,_e=It,st=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:X},null,8,["title","iconName"])]),default:x(()=>[d("div",PN,[d("div",RN,[y(st,{ref_key:"formRef",ref:_,layout:"vertical",model:v},{default:x(()=>[d("div",BN,[H[24]||(H[24]=d("div",{class:"gray-block-title"},"输入",-1)),y(Z,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",LN,[y(rr,{modelType:"LLM",modeName:v.use_model,"onUpdate:modeName":H[0]||(H[0]=tt=>v.use_model=tt),modeId:v.model_config_id,"onUpdate:modeId":H[1]||(H[1]=tt=>v.model_config_id=tt),onLoaded:V,style:{width:"348px"}},null,8,["modeName","modeId"]),y(W,{onClick:c},{default:x(()=>[H[12]||(H[12]=U("高级设置 ",-1)),u.value?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Ha),{key:1}))]),_:1})])]),_:1}),u.value?(w(),Q(Z,{key:0,name:"temperature"},{label:x(()=>[H[14]||(H[14]=d("span",null,"温度 ",-1)),y(le,null,{title:x(()=>[...H[13]||(H[13]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",IN,[d("div",FN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:v.temperature,"onUpdate:value":H[2]||(H[2]=tt=>v.temperature=tt),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",jN,[y(re,{value:v.temperature,"onUpdate:value":H[3]||(H[3]=tt=>v.temperature=tt),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),u.value?(w(),Q(Z,{key:1,name:"max_token"},{label:x(()=>[H[16]||(H[16]=d("span",null,"最大token ",-1)),y(le,null,{title:x(()=>[...H[15]||(H[15]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",VN,[d("div",HN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:v.max_token,"onUpdate:value":H[4]||(H[4]=tt=>v.max_token=tt),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",UN,[y(re,{value:v.max_token,"onUpdate:value":H[5]||(H[5]=tt=>v.max_token=tt),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),u.value&&P.value?(w(),Q(Z,{key:2,name:"enable_thinking"},{label:x(()=>[H[18]||(H[18]=d("span",null,"深度思考 ",-1)),y(le,null,{title:x(()=>[...H[17]||(H[17]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",zN,[y(ce,{checked:v.enable_thinking,"onUpdate:checked":H[6]||(H[6]=tt=>v.enable_thinking=tt)},null,8,["checked"])])]),_:1})):ie("",!0),y(Z,{name:"context_pair"},{label:x(()=>[H[20]||(H[20]=d("span",null,"上下文数量 ",-1)),y(le,null,{title:x(()=>[...H[19]||(H[19]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",qN,[d("div",GN,[y(q,null,{default:x(()=>[y(te,{class:"custom-slider",value:v.context_pair,"onUpdate:value":H[7]||(H[7]=tt=>v.context_pair=tt),min:0,max:50},null,8,["value"])]),_:1})]),d("div",XN,[y(re,{value:v.context_pair,"onUpdate:value":H[8]||(H[8]=tt=>v.context_pair=tt),min:0,max:50},null,8,["value"])])])]),_:1}),y(Z,{name:"prompt",class:"width-100"},{label:x(()=>[...H[21]||(H[21]=[d("div",{class:"space-between-box"},[d("div",null,"提示词")],-1)])]),default:x(()=>[y(ot,{type:"textarea",inputStyle:"height: 100px;",options:a.value,defaultSelectedList:v.prompt_tags,defaultValue:v.prompt,ref_key:"atInputRef",ref:r,onOpen:g,onChange:H[9]||(H[9]=(tt,ke)=>f(tt,ke)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:x(({label:tt,payload:ke})=>[d("div",WN,[d("div",YN,j(tt),1),d("div",KN,j(ke.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),H[22]||(H[22]=d("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1}),d("div",JN,[H[23]||(H[23]=d("div",{class:"form-label"},"用户问题",-1)),d("div",ZN,[y(ve,{value:v.question_value,"onUpdate:value":H[10]||(H[10]=tt=>v.question_value=tt),onDropdownVisibleChange:T,style:{width:"220px"},options:l.value,allowClear:!1,displayRender:({labels:tt})=>tt.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),d("div",QN,[d("div",{class:"gray-block-title",onClick:H[11]||(H[11]=(...tt)=>oe.test&&oe.test(...tt))},"输出 (输出字段提取)"),d("div",e8,[H[26]||(H[26]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",t8,[(w(!0),R(ae,null,ye(v.output,(tt,ke)=>(w(),R("div",{class:"form-item-list",key:ke},[y(Z,{label:null,name:["output",ke,"key"]},{default:x(()=>[d("div",n8,[y(Ne,{style:{width:"214px"},value:tt.key,"onUpdate:value":he=>tt.key=he,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(_e,{onChange:he=>$(tt),value:tt.typ,"onUpdate:value":he=>tt.typ=he,placeholder:"请选择",style:{width:"214px"}},{default:x(()=>[(w(),R(ae,null,ye(D,he=>y(ge,{value:he.value,key:he.value},{default:x(()=>[U(j(he.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),tt.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:he=>B(ke)},[y(K(Fn))],8,o8)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:he=>E(tt,ke)},[y(K(kr))],8,i8),d("div",{class:"btn-hover-wrap",onClick:he=>L(ke)},[y(K(Jt))],8,r8)]),tt.subs&&tt.subs.length>0?(w(),R("div",s8,[y(q,null,{default:x(()=>[y($N,{data:tt.subs,level:2,typOptions:D},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128)),y(W,{onClick:k,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...H[25]||(H[25]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])]),y(Rg,{onAdd:S,onEdit:N,onAddSub:A,ref_key:"addParamsModalRef",ref:O},null,512)])]),_:1})}}},l8=Te(a8,[["__scopeId","data-v-00547038"]]),lo="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",u8={class:"collapse-panel-warpper"},d8={class:"collapse-panel-header"},c8={class:"title-text"},f8={class:"collapse-panel-body"},p8={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(n){const t=G(n.defaultCollapsed),o=()=>{t.value=!t.value};return(i,r)=>{const s=Nn;return w(),R("div",u8,[d("div",d8,[d("div",{class:"collapse-panel-title",onClick:St(o,["stop"])},[d("span",c8,[U(j(n.title)+" ",1),n.count?(w(),R(ae,{key:0},[U("（"+j(n.count)+"）",1)],64)):ie("",!0)]),y(s,{name:"arrow-down",class:Ct(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])]),d("div",null,[gi(i.$slots,"extra",{},void 0,!0)])]),$i(d("div",f8,[gi(i.$slots,"default",{},void 0,!0)],512),[[tr,!t.value]])])}}},ss=Te(p8,[["__scopeId","data-v-1e5a3402"]]),h8={class:"field-select-box"},v8={key:0,class:"field-list-box"},g8={key:1,class:"empty-box"},_8={__name:"field-select-alert",emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),r=G([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),s=G([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),a=(c,f)=>{i.selectedRowKeys=c,i.selectedRows=f},l=({formId:c,selectedRowKeys:f,selectedRows:p})=>{i.formId=c,i.selectedRowKeys=f,i.selectedRows=p,i.show=!0},u=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:l}),(c,f)=>{const p=Ms,h=vn;return w(),Q(h,{width:"746px",open:i.show,"onUpdate:open":f[1]||(f[1]=g=>i.show=g),title:"关联数据表",onOk:u,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",h8,[s.value.length?(w(),R("div",v8,[y(p,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:a},dataSource:s.value,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ie("",!0),s.value.length?ie("",!0):(w(),R("div",g8,[f[3]||(f[3]=d("img",{src:qa,alt:""},null,-1)),d("div",null,[f[2]||(f[2]=U(" 暂无字段, 请先去数据表添加 ",-1)),d("a",{onClick:f[0]||(f[0]=(...g)=>c.openAddLibrary&&c.openAddLibrary(...g))}," 去添加")])]))])]),_:1},8,["open"])}}},m8=Te(_8,[["__scopeId","data-v-e0fc750c"]]),y8={class:"field-list"},b8={class:"field-list-col field-drag-col"},x8={class:"drag-btn"},w8={class:"field-list-col field-name-col"},C8={class:"field-name-box"},S8={class:"field-name"},k8={class:"field-type-tag"},E8={class:"field-list-col field-value-col"},D8={key:0,class:"field-list-col field-del-col"},A8={class:"add-btn-box"},O8={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=G([]);gt(()=>o.list,p=>{r.value=p.map(h=>({...h,is_asc:h.is_asc?1:0}))});const s=p=>{r.value.splice(p,1),u()},a=(p,h)=>{r.value=h.map(g=>({...g})),u()},l=()=>{u()},u=()=>{let p=r.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",p)},c=G(),f=()=>{c.value.open({formId:o.formId,selectedRows:o.list,selectedRowKeys:o.list.map(p=>p.name)})};return(p,h)=>{const g=Vt,m=It,_=Nn,v=Kt,b=Qt;return w(),R("div",null,[d("div",y8,[(w(!0),R(ae,null,ye(r.value,C=>(w(),R("div",{class:"field-list-row",key:C.name},[d("div",b8,[d("span",x8,[y(K(Jc))])]),d("div",w8,[d("div",C8,[d("span",S8,j(C.name),1),d("span",k8,j(C.type),1)])]),d("div",E8,[y(m,{value:C.is_asc,"onUpdate:value":M=>C.is_asc=M,style:{width:"100%"},onChange:l},{default:x(()=>[(w(),R(ae,null,ye(i,M=>y(g,{value:M.value,key:M.key},{default:x(()=>[U(j(M.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),R("div",D8,[d("span",{class:"del-btn",onClick:h[0]||(h[0]=M=>s(p.index))},[y(_,{class:"del-icon",name:"close-circle"})])])):ie("",!0)]))),128))]),d("div",A8,[n.disabled?(w(),Q(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(v,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(K(Ht)),h[1]||(h[1]=U(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Q(v,{key:1,class:"add-btn",type:"dashed",block:"",onClick:f},{default:x(()=>[y(K(Ht)),h[2]||(h[2]=U(" 添加排序字段 ",-1))]),_:1}))]),y(m8,{formId:n.formId,ref_key:"fieldSelectAlertRef",ref:c,onOk:a},null,8,["formId"])])}}},N8=Te(O8,[["__scopeId","data-v-fbdcd109"]]),M8={class:"field-item"},T8={class:"field-name"},$8={class:"field-type"},P8={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=G([]);return(o,i)=>{const r=Nn,s=Zc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(s,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=a=>t.value=a),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:x(({switcherCls:a})=>[d("span",{class:Ct(a)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:a})=>[d("div",M8,[d("span",T8,j(a.title),1),d("span",$8,j(a.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},R8=Te(P8,[["__scopeId","data-v-2c5047db"]]),B8={class:"select-data-form"},L8={class:"node-box-content"},I8={class:"setting-box"},F8={class:"setting-box"},j8={class:"node-box-content"},V8={class:"setting-box"},H8={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("setData"),o=sr();let i={};const r=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),s=Xe(()=>[{title:"output_list",key:"output_list",type:"array<object>",children:r.formData.fields.map(C=>({title:C.name,key:C.name,type:C.type}))},{title:"row_num",key:"row_num",type:"integer"}]),a=({type:b,list:C})=>{r.formData.typ=b,r.formData.where=C,h()},l=b=>{r.formData.order=[...b],h()},u=(b,C)=>{C?(r.formData.form_name=C.name,r.formData.form_description=C.description,v(C.id)):(r.formData.form_name="",r.formData.form_description="",r.formData.typ=1,r.formData.fields=[],r.formData.where=[],r.formData.order=[],r.formData.limit=100),h()},c=b=>{r.formData.fields=b,h()},f=()=>{h()},p=()=>{let b=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(b);let C=g(i.form_select.where||[]);i.form_select.where=C,r.formData=i.form_select,r.formData.form_id&&v(r.formData.form_id),h()},h=()=>{let b={...Bn(r.formData)};b.where=m(b.where),i.form_select=b,t({...e.node,node_params:JSON.stringify(i)})},g=b=>{let C=[];return b.forEach(M=>{let O=JSON.parse(JSON.stringify(M)),k=O.rule.split("_");O.form_field_id=O.form_field_id*1,O.field_type=k[0],k.shift(),O.rule=k.join("_"),C.push(O)}),C},m=b=>{let C=[];return b.forEach(M=>{let O=JSON.parse(JSON.stringify(M));O.form_field_id=O.form_field_id*1,O.rule=M.field_type+"_"+M.rule,C.push(O)}),C},_=async()=>{const b=await o.getFormList();b&&(r.tableList=b)},v=async b=>{o.getFormFieldList({form_id:b}).then(C=>{C.forEach(M=>{M.id=M.id*1}),r.fieldList=C}).catch(()=>{})};return ut(()=>{_(),p()}),(b,C)=>{const M=$n;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...C[8]||(C[8]=[d("span",null,[U("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),d("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",B8,[d("div",L8,[C[9]||(C[9]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:Zn,alt:""}),d("span",{class:"text"},"输入")],-1)),C[10]||(C[10]=d("div",{class:"setting-label"},[d("span",null,"数据表")],-1)),d("div",I8,[y(Fu,{options:r.tableList,title:r.formData.form_name,description:r.formData.form_description,value:r.formData.form_id,"onUpdate:value":C[0]||(C[0]=O=>r.formData.form_id=O),onChange:u},null,8,["options","title","description","value"])]),d("div",F8,[y(ss,{title:"查询条件",count:r.formData.where.length},{default:x(()=>[y(rf,{disabled:!r.formData.form_id,where:r.formData.where,"field-options":r.fieldList,type:r.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),d("div",{class:"setting-box",onWheel:C[1]||(C[1]=St(()=>{},["stop"])),onTouchmove:C[2]||(C[2]=St(()=>{},["stop"]))},[y(ss,{title:"查询字段",count:r.formData.fields.length},{default:x(()=>[y(nf,{"form-id":r.formData.form_id,showAdd:r.formData.form_id!="",showInput:!1,showEmptyFieldRow:r.formData.form_id=="",list:r.formData.fields,onChange:c},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),d("div",{class:"setting-box",onWheel:C[3]||(C[3]=St(()=>{},["stop"])),onTouchmove:C[4]||(C[4]=St(()=>{},["stop"]))},[y(ss,{title:"排序",count:r.formData.order.length},{default:x(()=>[y(N8,{"form-id":r.formData.form_id,disabled:!r.formData.form_id,list:r.formData.order,onChange:l},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),C[11]||(C[11]=d("div",{class:"setting-label"},[d("span",null,"查询数量")],-1)),d("div",{class:"setting-box",onWheel:C[6]||(C[6]=St(()=>{},["stop"])),onTouchmove:C[7]||(C[7]=St(()=>{},["stop"]))},[y(M,{min:1,max:1e3,value:r.formData.limit,"onUpdate:value":C[5]||(C[5]=O=>r.formData.limit=O),disabled:!r.formData.form_id,style:{width:"205px"},onChange:f},null,8,["value","disabled"])],32)]),d("div",j8,[C[12]||(C[12]=d("div",{class:"node-box-title"},[d("img",{class:"input-icon",src:lo,alt:""}),d("span",{class:"text"},"输出")],-1)),d("div",V8,[y(R8,{treeData:s.value},null,8,["treeData"])])])])]),_:1})}}},U8=Te(H8,[["__scopeId","data-v-2499b36b"]]),z8={class:"problem-optimization-form"},q8={class:"gray-block"},G8={class:"flex-block-item"},X8={class:"number-box"},W8={class:"number-slider-box"},Y8={class:"number-input-box"},K8={class:"number-box"},J8={class:"number-slider-box"},Z8={class:"number-input-box"},Q8={class:"number-box"},eM={class:"number-box"},tM={class:"number-slider-box"},nM={class:"number-input-box"},oM={class:"diy-form-item"},iM={class:"form-content"},rM={class:"gray-block mt16"},sM={class:"array-form-box"},aM={class:"flex-block-item"},lM=["onClick"],uM={class:"form-item-list"},dM={class:"flex-block-item"},cM={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=jn(),s=Xe(()=>r.modelList),a=G(!1),l=()=>{a.value=!a.value},u=G(),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,categorys:[]}),f=G([]);function p(){let N=i().getAllParentVariable();f.value=h(N)}function h(N){return N.forEach(L=>{L.typ=="node"?L.node_type==1?L.value="global":L.value=L.node_id:L.value=L.key,L.children&&L.children.length>0&&(L.children=h(L.children))}),N}const g=N=>{N||p()};function m(N){if(N){let L=N.split("."),$=L[0],B=L.filter((A,D)=>D>0).join(".");return[$,B]}return["global","question"]}const _=()=>{const N=c.model_config_id?+c.model_config_id:c.model_config_id,L=JSON.stringify({cate:{...c,question_value:c.question_value.join("."),model_config_id:N}});t("update-node",{...o.node,...c,node_params:L})},v=()=>{p();try{let N=o.node.dataRaw||o.node.node_params||"{}",L=JSON.parse(N).cate||{};L=JSON.parse(JSON.stringify(L));for(let $ in L)if($==="question_value")c.question_value=m(L.question_value);else if($=="categorys")if(L.categorys&&L.categorys.length>0){let B=L.categorys.map(A=>({...A}));c[$]=B}else c[$]=[{category:"",next_node_key:"",key:_n(16)}];else c[$]=L[$];!c.model_config_id&&s.value.length>0&&(c.model_config_id=s.value[0].id,c.use_model=s.value[0].children[0].name)}catch(N){}};gt(()=>c,()=>{_()},{deep:!0});const b=()=>{c.categorys.push({category:"",next_node_key:"",key:_n(16)})},C=N=>{c.categorys.splice(N,1)},M=()=>Promise.resolve(),O=G({}),k=(N,L)=>{O.value=L},E=Xe(()=>{if(!c.model_config_id)return!1;let N=c.model_config_id+"#"+c.use_model;return O.value[N]}),S=()=>{t("close")};return ut(()=>{v()}),(N,L)=>{const $=Kt,B=kn,A=Qt,D=Ns,T=Vn,F=$n,V=Ri,P=oi,X=ln,oe=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:S},null,8,["title","iconName"])]),default:x(()=>[d("div",z8,[d("div",{class:"node-form-content",onMousedown:L[10]||(L[10]=St(()=>{},["stop"]))},[y(oe,{ref_key:"formRef",ref:u,layout:"vertical",model:c},{default:x(()=>[d("div",q8,[L[21]||(L[21]=d("div",{class:"gray-block-title"},"输入",-1)),y(B,{label:"LLM模型",name:"use_model"},{default:x(()=>[d("div",G8,[y(rr,{modelType:"LLM",modeName:c.use_model,"onUpdate:modeName":L[0]||(L[0]=H=>c.use_model=H),modeId:c.model_config_id,"onUpdate:modeId":L[1]||(L[1]=H=>c.model_config_id=H),onLoaded:k,style:{width:"348px"}},null,8,["modeName","modeId"]),y($,{onClick:l},{default:x(()=>[L[11]||(L[11]=U("高级设置 ",-1)),a.value?(w(),Q(K(Ro),{key:0})):(w(),Q(K(Ha),{key:1}))]),_:1})])]),_:1}),a.value?(w(),Q(B,{key:0,name:"temperature"},{label:x(()=>[L[13]||(L[13]=d("span",null,"温度 ",-1)),y(A,null,{title:x(()=>[...L[12]||(L[12]=[U("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",X8,[d("div",W8,[y(T,null,{default:x(()=>[y(D,{class:"custom-slider",value:c.temperature,"onUpdate:value":L[2]||(L[2]=H=>c.temperature=H),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),d("div",Y8,[y(F,{value:c.temperature,"onUpdate:value":L[3]||(L[3]=H=>c.temperature=H),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):ie("",!0),a.value?(w(),Q(B,{key:1,name:"max_token"},{label:x(()=>[L[15]||(L[15]=d("span",null,"最大token ",-1)),y(A,null,{title:x(()=>[...L[14]||(L[14]=[U("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",K8,[d("div",J8,[y(T,null,{default:x(()=>[y(D,{class:"custom-slider",value:c.max_token,"onUpdate:value":L[4]||(L[4]=H=>c.max_token=H),min:0,max:100*1024},null,8,["value"])]),_:1})]),d("div",Z8,[y(F,{value:c.max_token,"onUpdate:value":L[5]||(L[5]=H=>c.max_token=H),min:0,max:100*1024},null,8,["value"])])])]),_:1})):ie("",!0),a.value&&E.value?(w(),Q(B,{key:2,name:"enable_thinking"},{label:x(()=>[L[17]||(L[17]=d("span",null,"深度思考 ",-1)),y(A,null,{title:x(()=>[...L[16]||(L[16]=[U("开启时，调用大模型时会指定走深度思考模式",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",Q8,[y(V,{checked:c.enable_thinking,"onUpdate:checked":L[6]||(L[6]=H=>c.enable_thinking=H)},null,8,["checked"])])]),_:1})):ie("",!0),y(B,{name:"context_pair"},{label:x(()=>[L[19]||(L[19]=d("span",null,"上下文数量 ",-1)),y(A,null,{title:x(()=>[...L[18]||(L[18]=[U("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:x(()=>[y(K(mt),{class:"question-icon"})]),_:1})]),default:x(()=>[d("div",eM,[d("div",tM,[y(T,null,{default:x(()=>[y(D,{class:"custom-slider",value:c.context_pair,"onUpdate:value":L[7]||(L[7]=H=>c.context_pair=H),min:0,max:50},null,8,["value"])]),_:1})]),d("div",nM,[y(F,{value:c.context_pair,"onUpdate:value":L[8]||(L[8]=H=>c.context_pair=H),min:0,max:50},null,8,["value"])])])]),_:1}),d("div",oM,[L[20]||(L[20]=d("div",{class:"form-label"},"用户问题",-1)),d("div",iM,[y(P,{value:c.question_value,"onUpdate:value":L[9]||(L[9]=H=>c.question_value=H),onDropdownVisibleChange:g,style:{width:"220px"},options:f.value,allowClear:!1,displayRender:({labels:H})=>H.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),d("div",rM,[L[23]||(L[23]=d("div",{class:"gray-block-title"},"问题分类设置",-1)),d("div",sM,[(w(!0),R(ae,null,ye(c.categorys,(H,W)=>(w(),R("div",{class:"form-item-list",key:H.key},[y(B,{label:null,name:["categorys",W,"category"],rules:{required:!0,validator:(Z,le)=>M(Z,le)}},{default:x(()=>[d("div",aM,[y(X,{class:"flex1",value:H.category,"onUpdate:value":Z=>H.category=Z,placeholder:"请输入"},null,8,["value","onUpdate:value"]),d("div",{class:"btn-hover-wrap",onClick:Z=>C(W)},[y(K(Jt))],8,lM)])]),_:2},1032,["name","rules"])]))),128)),d("div",uM,[y(B,{label:null},{default:x(()=>[d("div",dM,[y(X,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),y($,{onClick:b,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...L[22]||(L[22]=[U("添加问题分类",-1)])]),_:1},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},fM=Te(cM,[["__scopeId","data-v-b7df75e0"]]),pM={class:"judge-node-form"},hM={class:"gray-block-title"},vM=["onClick"],gM={class:"condition-list-box"},_M={class:"left-select-box"},mM={class:"condition-body"},yM=["onClick"],bM={class:"btn-wrap"},xM={class:"add-btn-block"},wM={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})},nodeId:{type:String,default:""},lf:{type:Object,default:null}},setup(n){const e=n,t=He("getNode"),o=He("setData"),i=G(),r=Je({term:[]}),s=G([]);function a(){let k=t().getAllParentVariable(),S=e.lf.getNodeModelById(e.nodeId).properties.loop_parent_key,N=l(k);if(S){k=k.filter($=>$.node_type!="25"),N=l(k);const L=e.lf.getNodeModelById(S);if(L){let $=L.properties.dataRaw||L.properties.node_params||"{}",B=JSON.parse($).loop||{};const A=u(B.intermediate_params,L),D=N.find(T=>(T.node_id||T.value)==L.id);if(D){const T=[],F=new Set;[...D.children||[],...A].forEach(V=>{const P=V.original_value||V.value||V.key;F.has(P)||(F.add(P),T.push(V))}),D.children=T}else N.push({label:L.properties.node_name,node_id:L.id,node_type:L.properties.node_type,typ:"node",value:L.id,children:A})}}s.value=N}function l(k){return k.forEach(E=>{E.typ=="node"?E.node_type==1?E.value="global":E.value=E.node_id:E.value=E.key,E.children&&E.children.length>0&&(E.children=l(E.children))}),k}function u(k,E){let S=[];return k&&k.length&&k.forEach(N=>{N.key&&S.push({id:E.id,key:N.key,value:N.key,label:N.key,node_id:E.id,node_name:E.properties.node_name,node_type:E.properties.node_type,original_value:E.id+"."+N.key,text:N.key,typ:N.typ})}),S}const c=k=>{k||a()},f=()=>{try{let k=JSON.parse(e.node.node_params).term||[];k=k.map(E=>{let S=E.terms.map(N=>{let L="";for(let $=0;$<No.length;$++)if(N.variable.indexOf(No[$])>-1){L=No[$];break}if(L!=""){let $=N.variable.split(".");N.variable=[$[0],L]}else N.variable=N.variable.split(".");return{...N,type:N.type>0?N.type:1,key:Math.random()*1e4}});return{...E,is_or:E.is_or?1:0,terms:S,key:Math.random()*1e4}}),r.term=k,p()}catch(k){}},p=()=>{let k=JSON.parse(JSON.stringify(r.term));k=k.map(E=>({is_or:E.is_or==1,next_node_key:E.next_node_key,terms:E.terms.map(S=>({variable:S.variable.join("."),is_mult:S.is_mult,type:S.type,value:S.value}))})),o({...e.node,term:k,node_params:JSON.stringify({term:k})})},h=k=>{r.term[k].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},g=(k,E)=>{r.term[k].terms.splice(E,1)},m=()=>{r.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},_=k=>{r.term.splice(k,1)},v=k=>{let E=M(k);k.is_mult=E.includes("array"),k.type=void 0};let b=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],C=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function M(k){let E="";if(k.variable&&k.variable.length>0){let S=s.value.filter(N=>N.key==k.variable[0]);S&&S.length&&(E=S[0].typ),E=="object"&&(S[0]&&S[0].children&&(S=S[0].subs.filter(N=>N.key==k.variable[1])),S&&S.length&&(E=S[0].typ),E=="object"&&(S[0]&&S[0].children&&(S=S[0].subs.filter(N=>N.key==k.variable[2])),S&&S.length&&(E=S[0].typ)))}return E}function O(k){if(!k.variable)return[];let E=M(k);return E==""?k.is_mult?C:b:E=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:E.includes("array")?C:b}return gt(()=>r,()=>{p()},{deep:!0}),ut(()=>{a(),f()}),(k,E)=>{const S=ii,N=Vt,L=It,$=oi,B=ln,A=Kt,D=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{desc:x(()=>[...E[2]||(E[2]=[d("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",pM,[d("div",{class:"form-block",onMousedown:E[1]||(E[1]=St(()=>{},["stop"]))},[y(D,{ref_key:"formRef",ref:i,layout:"vertical",model:r},{default:x(()=>[y(K(ww),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:r.term,"onUpdate:modelValue":E[0]||(E[0]=T=>r.term=T),"item-key":"key"},{item:x(({element:T,index:F})=>[(w(),R("div",{class:"gray-block",key:T.key},[d("div",hM,[y(S,{gap:8},{default:x(()=>[y(K(Jc),{class:"icon drag-btn"}),U(j(F==0?"if":"else if"),1)]),_:2},1024),r.term.length>1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:V=>_(F)},[y(K(Jt))],8,vM)):ie("",!0)]),d("div",gM,[d("div",_M,[y(L,{size:"small",value:T.is_or,"onUpdate:value":V=>T.is_or=V,bordered:!1,style:{width:"64px"}},{default:x(()=>[y(N,{value:0},{default:x(()=>[...E[3]||(E[3]=[U("and",-1)])]),_:1}),y(N,{value:1},{default:x(()=>[...E[4]||(E[4]=[U("or",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),d("div",mM,[(w(!0),R(ae,null,ye(T.terms,(V,P)=>(w(),R("div",{class:"condition-item",key:V.key},[y($,{value:V.variable,"onUpdate:value":X=>V.variable=X,onChange:X=>v(V),onDropdownVisibleChange:c,style:{width:"160px"},options:s.value,allowClear:!1,displayRender:({labels:X})=>X.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),y(L,{value:V.type,"onUpdate:value":X=>V.type=X,style:{width:"120px"},placeholder:"请选择"},{default:x(()=>[(w(!0),R(ae,null,ye(O(V),X=>(w(),Q(N,{value:X.value,key:X.value},{default:x(()=>[U(j(X.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),V.type!=5&&V.type!=6?(w(),Q(B,{key:0,placeholder:"请输入",value:V.value,"onUpdate:value":X=>V.value=X,style:{width:"150px"}},null,8,["value","onUpdate:value"])):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:X=>g(F,P)},[y(K(Jt))],8,yM)]))),128))])]),d("div",bM,[y(A,{onClick:V=>h(F),icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...E[5]||(E[5]=[U("添加条件",-1)])]),_:1},8,["onClick","icon"])])]))]),_:1},8,["modelValue"]),d("div",xM,[y(A,{onClick:m,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...E[6]||(E[6]=[U("添加分支",-1)])]),_:1},8,["icon"])]),E[7]||(E[7]=d("div",{class:"gray-block mt8"},[d("div",{class:"gray-block-title"},"else"),d("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1},8,["model"])],32)])]),_:1})}}},CM=Te(wM,[["__scopeId","data-v-3ed4ca9c"]]),SM={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:fn,AtInput:ot,FullscreenOutlined:Ko,FullAtInput:jr,NodeFormLayout:cn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},kM={class:"specify-reply-form"},EM={class:"node-content"},DM={class:"form-item-label"},AM={class:"flex-between-box"},OM={class:"form-item-body"};function NM(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("FullscreenOutlined"),l=Nt("AtInput"),u=Nt("FullAtInput"),c=Nt("NodeFormLayout");return w(),Q(c,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[d("div",kM,[d("div",EM,[e[5]||(e[5]=d("div",{class:"form-label"},"输出",-1)),d("div",{class:"form-item",onMousedown:e[2]||(e[2]=St(()=>{},["stop"]))},[d("div",DM,[d("div",AM,[e[4]||(e[4]=d("div",null,"消息内容",-1)),d("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...f)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...f))},[y(a)])])]),d("div",OM,[y(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(f,p)=>r.changeValue(f,p))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),y(u,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(f,p)=>r.changeValue(f,p)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const MM=Te(SM,[["render",NM],["__scopeId","data-v-fe3648b9"]]),TM={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:fn,AtInput:ot,FullscreenOutlined:Ko,FullAtInput:jr,NodeFormLayout:cn},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.$nextTick(()=>{this.update()})}},mounted(){this.getValueOptions();const n=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const o=JSON.parse(e).immediately_reply||{content:"",content_tags:[]};this.formState.content=o.content,this.formState.content_tags=o.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),n.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(n){this.$refs.atInputRef&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.node.node_params);n.immediately_reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(n)})},showAtList(n){n&&this.getValueOptions()},changeValue(n,e){this.formState.content_tags=e,this.formState.content=n,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},$M={class:"specify-reply-form"},PM={class:"node-content"},RM={class:"form-item-label"},BM={class:"flex-between-box"},LM={class:"form-item-body"};function IM(n,e,t,o,i,r){const s=Nt("NodeFormHeader"),a=Nt("FullscreenOutlined"),l=Nt("AtInput"),u=Nt("FullAtInput"),c=Nt("NodeFormLayout");return w(),Q(c,null,{header:x(()=>[y(s,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将立即给用户回复一条固定消息"},null,8,["title","iconName"])]),default:x(()=>[d("div",$M,[d("div",PM,[e[5]||(e[5]=d("div",{class:"form-label"},"输出",-1)),d("div",{class:"form-item",onMousedown:e[2]||(e[2]=St(()=>{},["stop"]))},[d("div",RM,[d("div",BM,[e[4]||(e[4]=d("div",null,"消息内容",-1)),d("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...f)=>r.handleOpenFullAtModal&&r.handleOpenFullAtModal(...f))},[y(a)])])]),d("div",LM,[y(l,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:r.showAtList,onChange:e[1]||(e[1]=(f,p)=>r.changeValue(f,p))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),y(u,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:r.showAtList,onChange:e[3]||(e[3]=(f,p)=>r.changeValue(f,p)),onOk:r.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const FM=Te(TM,[["render",IM],["__scopeId","data-v-805b62b1"]]),jM=["src"],VM={class:"mcp-form"},HM={class:"node-options"},UM={class:"options-item-tit"},zM={class:"option-label"},qM={class:"option-type"},GM={class:"field-list-item"},XM={class:"field-label"},WM={class:"field-type"},YM={class:"desc"},KM={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i=Je({mcpInfo:{},toolInfo:{}}),r=Je({params:{}}),s=G([]),a=Je({mcp:{}});function l(){u();const h=JSON.parse(o.node.node_params);Object.assign(a,h),p()}function u(){s.value=e().getAllParentVariable()}function c(h,g,m){h.value=g,h.tags=m,f()}function f(){let h={arguments:{},tag_map:{}};for(let g in r.params){let m=r.params[g].value,_=i.toolInfo.inputSchema.properties[g]||{};_.type=="string"?m=String(m):["number","integer"].includes(_.type)&&(m=Number(m)),h.arguments[g]=m,h.tag_map[g]=r.params[g].tags}a.mcp.arguments=h.arguments,a.mcp.tag_map=h.tag_map||[],t({...o.node,node_params:JSON.stringify(a)})}const p=()=>{Dg({provider_id:a.mcp.provider_id}).then(h=>{var b;i.mcpInfo=(h==null?void 0:h.data)||{};let g=Po((b=i.mcpInfo)==null?void 0:b.tools,[]);i.toolInfo=g.find(C=>C.name==a.mcp.tool_name);let m=i.toolInfo.inputSchema||{},_=(m==null?void 0:m.properties)||{},v=(m==null?void 0:m.required)||[];_=JSON.parse(JSON.stringify(_));for(let C in _)_[C].value=String(a.mcp.arguments[C]||""),_[C].tags=a.mcp.tag_map?a.mcp.tag_map[C]:[],_[C].required=v.includes(C);r.params=_})};return ut(()=>{l()}),(h,g)=>(w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name},{"node-icon":x(()=>[d("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,jM)]),desc:x(()=>[d("span",null,j(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",VM,[d("div",HM,[g[0]||(g[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(ae,null,ye(r.params,(m,_)=>(w(),R("div",{key:_,class:Ct(["options-item",{"is-required":m.required}])},[d("div",UM,[d("div",zM,j(_),1),d("div",qM,j(m.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"min-height: 32px;",options:s.value,defaultSelectedList:m.tags,defaultValue:m.value,ref_for:!0,ref:"atInputRef",onOpen:u,onChange:(v,b)=>c(m,v,b),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:v,payload:b})=>[d("div",GM,[d("div",XM,j(v),1),d("div",WM,j(b.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",YM,j(m.description),1)],2))),128))]),g[1]||(g[1]=d("div",{class:"node-options"},[d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])]),d("div",{class:"options-item"},[d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"输出")]),d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"text"),d("div",{class:"option-type"},"string")]),d("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},JM=Te(KM,[["__scopeId","data-v-28a17d8f"]]),ZM="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%2331gmof37u__clip0_10933_119689)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M4.33325%2011.6719H2.33325V13.6719'/%3e%3cpath%20d='M13.6667%2013.6719H11.6667V11.6719'/%3e%3cpath%20d='M11.6667%204.32813H13.6667V2.32812'/%3e%3cpath%20d='M2.33325%202.32812H4.33325V4.32813'/%3e%3cpath%20d='M4.33325%202.42969C2.52585%203.62217%201.33325%205.67097%201.33325%207.99834C1.33325%208.3382%201.35869%208.67214%201.40775%208.99834'/%3e%3cpath%20d='M9.00005%2014.5974C8.67385%2014.6464%208.33991%2014.6719%208.00005%2014.6719C5.67268%2014.6719%203.62388%2013.4793%202.4314%2011.6719'/%3e%3cpath%20d='M14.5922%207C14.6413%207.3262%2014.6667%207.66013%2014.6667%208C14.6667%2010.3274%2013.4741%2012.3762%2011.6667%2013.5687'/%3e%3cpath%20d='M7%201.40262C7.3262%201.35356%207.66013%201.32812%208%201.32812C10.3274%201.32812%2012.3762%202.52072%2013.5687%204.32813'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='31gmof37u__clip0_10933_119689'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",QM="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_12353_121923)'%3e%3cpath%20d='M3.99992%201.33594H1.33325V4.0026H3.99992V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%2012H12V14.6667H14.6667V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M3.99992%2012H1.33325V14.6667H3.99992V12Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%201.33594H12V4.0026H14.6667V1.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.66675%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M13.3333%2012V4'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%202.66406H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%2013.3359H12'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.33325%205.33594H8.53325V7.46927H10.6666V10.6693H7.46659V8.53594H5.33325V5.33594Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_12353_121923'%3e%3crect%20width='16'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",eT="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2010.3307H12.6667V1.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.99992%207H3.33325V14.3333'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.6667%203.66406L12.6667%201.66406L10.6667%203.66406'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.33325%2012.3359L3.33325%2014.3359L1.33325%2012.3359'%20stroke='%23091E41'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ju="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",tT={class:"problem-optimization-form"},nT={class:"node-form-content"},oT={class:"gray-block"},iT={class:"gray-block-title"},rT={class:"flex-form-item"},sT={key:0,class:"gray-block"},aT={class:"gray-block-title"},lT={class:"output-box"},uT={class:"array-form-box"},dT={class:"flex-block-item",style:{gap:"12px"}};const cT={class:"gray-block"},fT={class:"gray-block-title"},pT={class:"output-box"},hT={class:"array-form-box"},vT={class:"flex-block-item",style:{gap:"12px"}},gT={style:{width:"40%"}},_T={class:"field-list-item"},mT={class:"field-label"},yT={class:"field-type"},bT=["onClick"],xT={class:"gray-block"},wT={class:"gray-block-title"},CT={class:"output-box"},ST={class:"array-form-box"},kT={class:"flex-block-item",style:{gap:"12px"}},ET=["onClick"],DT={__name:"custom-group-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=G([]),s=G([]);G([]);const a=Je({}),l=(P,X,oe)=>{if(P){let H=`at_input_${X}_${oe}`;a[H]=P}},u=(P,X,oe)=>{oe.tags=X,oe.value=P};function c(P){return P.forEach(X=>{X.typ=="node"?X.node_type==1?X.value="global":X.value=X.node_id:X.value=X.key,X.children&&X.children.length>0&&(X.children=c(X.children))}),P}const f=()=>{let P=i().getAllParentVariable();P.forEach(X=>{X.tags=X.tags||[]}),P=P.filter(X=>X.group_node_key!=X.loop_parent_key).filter(X=>X.node_id!=X.group_node_key),r.value=P};function p(){let P=i().getAllParentVariable();P=c(P),P=P.filter(X=>X.group_node_key!=X.loop_parent_key).filter(X=>X.node_id!=X.group_node_key),s.value=h(P)}function h(P){const X=oe=>!oe||oe.length===0?[]:oe.map(H=>{const W=X(H.children);return H.typ.includes("array")||W&&W.length>0?{...H,children:W}:null}).filter(Boolean);return X(P)}const g=P=>{P||p()},m=G(),_={key:"",typ:"",value:"",cu_key:Math.random()*1e4},v={key:"",typ:"",value:"",cu_key:Math.random()*1e4},b={key:"",typ:"",value:"",cu_key:Math.random()*1e4},C=Je({loop_type:"array",loop_number:"",loop_arrays:[],intermediate_params:[],output:[]}),M=Xe(()=>{let P=C.intermediate_params,X=[];return P.forEach(oe=>{oe.key&&X.push({children:[],id:o.nodeId,key:oe.key,label:oe.key,node_id:o.nodeId,node_name:o.node.node_name,node_type:"25",original_value:o.nodeId+"."+oe.key,text:oe.key,typ:oe.typ,value:oe.key})}),X.length>0?[{label:o.node.node_name,node_id:o.nodeId,node_type:"25",typ:"node",value:o.nodeId,children:X}]:[]}),O=()=>{const P=JSON.stringify({loop:{...C,loop_arrays:C.loop_arrays.map(X=>({...X,value:X.value?X.value.join("."):""})),output:C.output.map(X=>({...X,value:X.value?X.value.join("."):""}))}});t("update-node",{...o.node,...C,node_params:P})};function k(P){if(P){let X=P.split("."),oe=X[0],H=X.filter((W,Z)=>Z>0).join(".");return[oe,H]}return[]}const E=()=>{try{let P=o.node.dataRaw||o.node.node_params||"{}",X=JSON.parse(P).loop||{};X=JSON.parse(JSON.stringify(X)),f(),p(),C.loop_type=X.loop_type,C.loop_number=X.loop_number,C.loop_arrays=X.loop_arrays.map(oe=>({...oe,value:k(oe.value)})),C.intermediate_params=X.intermediate_params.map(oe=>({...oe})),C.output=X.output.map(oe=>({...oe,value:k(oe.value)})),C.loop_arrays.length==0&&(C.loop_arrays=[_]),C.intermediate_params.length==0&&(C.intermediate_params=[v]),C.output.length==0&&(C.output=[b])}catch(P){}};gt(()=>C,()=>{O()},{deep:!0});const S=()=>{C.loop_arrays.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},N=P=>{C.loop_arrays.splice(P,1)},L=(P,X,oe)=>{oe?X.typ=oe[oe.length-1].typ:X.typ=""},$=()=>{C.intermediate_params.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},B=P=>{C.intermediate_params.splice(P,1)},A=()=>{C.output.push({key:"",typ:"",value:"",cu_key:Math.random()*1e4})},D=P=>{C.output.splice(P,1)},T=(P,X)=>{if(P&&P.length){let oe=M.value.filter(H=>H.value==P[0])[0].children;oe&&oe.length&&(X.typ=oe.filter(H=>H.value==P[1])[0].typ)}else X.typ=""},F=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],V=()=>{t("close")};return ut(()=>{E()}),(P,X)=>{const oe=Qt,H=Vt,W=It,Z=$n,le=ln,te=oi,q=Vn,re=kn,ce=Kt,ve=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于通过设定循环次数和逻辑，重复执行一系列任务",onClose:V},null,8,["title","iconName"])]),default:x(()=>[d("div",tT,[d("div",nT,[y(ve,{ref_key:"formRef",ref:m,layout:"vertical",model:C},{default:x(()=>[d("div",oT,[d("div",iT,[X[3]||(X[3]=d("img",{src:ZM,alt:""},null,-1)),X[4]||(X[4]=U(" 循环设置 ",-1)),y(oe,null,{title:x(()=>[...X[2]||(X[2]=[U("如果引用数组，循环次数为数组的长度；如果指定次数，循环次数为指定的次数；",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",rT,[X[7]||(X[7]=d("div",{class:"form-label"},"循环类型",-1)),y(W,{value:C.loop_type,"onUpdate:value":X[0]||(X[0]=Ne=>C.loop_type=Ne),style:{width:"170px"}},{default:x(()=>[y(H,{value:"array"},{default:x(()=>[...X[5]||(X[5]=[U("使用数组循环",-1)])]),_:1}),y(H,{value:"number"},{default:x(()=>[...X[6]||(X[6]=[U("指定循环次数",-1)])]),_:1})]),_:1},8,["value"]),C.loop_type=="number"?(w(),Q(Z,{key:0,placeholder:"请输入",style:{flex:"1"},value:C.loop_number,"onUpdate:value":X[1]||(X[1]=Ne=>C.loop_number=Ne),min:1,max:100},null,8,["value"])):ie("",!0)])]),C.loop_type=="array"?(w(),R("div",sT,[d("div",aT,[X[9]||(X[9]=d("img",{src:QM,alt:""},null,-1)),X[10]||(X[10]=U(" 循环数组 ",-1)),y(oe,null,{title:x(()=>[...X[8]||(X[8]=[U("仅支持引用数组，循环次数为数组的长度",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",lT,[X[12]||(X[12]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型"),d("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),d("div",uT,[(w(!0),R(ae,null,ye(C.loop_arrays,(Ne,ge)=>(w(),R("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",dT,[y(le,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(le,{style:{width:"25%"},value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(te,{value:Ne.value,"onUpdate:value":_e=>Ne.value=_e,onChange:(_e,st)=>L(_e,Ne,st),onDropdownVisibleChange:g,style:{width:"50%"},options:s.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"])]),_:2},1024),ie("",!0)])]),_:2},1024)]))),128)),C.loop_arrays.length==0?(w(),Q(ce,{key:0,onClick:S,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...X[11]||(X[11]=[U("添加参数",-1)])]),_:1},8,["icon"])):ie("",!0)])])])):ie("",!0),d("div",cT,[d("div",fT,[X[14]||(X[14]=d("img",{src:eT,alt:""},null,-1)),X[15]||(X[15]=U(" 中间变量 ",-1)),y(oe,null,{title:x(()=>[...X[13]||(X[13]=[U("变量可在多次循环中实现共享，可用于在多次循环中传递变量",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",pT,[X[17]||(X[17]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),d("div",{class:"output-item",style:{flex:"1"}},"参数值")],-1)),d("div",hT,[(w(!0),R(ae,null,ye(C.intermediate_params,(Ne,ge)=>(w(),R("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",vT,[y(le,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(W,{value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"请选择",style:{width:"25%"}},{default:x(()=>[(w(),R(ae,null,ye(F,_e=>y(H,{value:_e.value,key:_e.value},{default:x(()=>[U(j(_e.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"]),d("div",gT,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:_e=>l(_e,"intermediate_params",ge),options:r.value,defaultSelectedList:Ne.tags,defaultValue:Ne.value,onOpen:f,onChange:(_e,st)=>u(_e,st,Ne,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:_e,payload:st})=>[d("div",_T,[d("div",mT,j(_e),1),d("div",yT,j(st.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:_e=>B(ge)},[y(K(Jt))],8,bT)])]),_:2},1024)]))),128)),y(ce,{onClick:$,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...X[16]||(X[16]=[U("添加参数",-1)])]),_:1},8,["icon"])])])]),d("div",xT,[d("div",wT,[X[19]||(X[19]=d("img",{src:ju,alt:""},null,-1)),X[20]||(X[20]=U(" 输出 ",-1)),y(oe,null,{title:x(()=>[...X[18]||(X[18]=[U("循环完成后输出的内容，仅支持引用循环体中节点的输出变量",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",CT,[X[22]||(X[22]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item",style:{"margin-left":"4px"}},"类型"),d("div",{class:"output-item",style:{width:"38%"}},"参数值")],-1)),d("div",ST,[(w(!0),R(ae,null,ye(C.output,(Ne,ge)=>(w(),R("div",{class:"form-item-list",key:Ne.cu_key},[y(re,{label:null},{default:x(()=>[d("div",kT,[y(le,{style:{width:"25%"},value:Ne.key,"onUpdate:value":_e=>Ne.key=_e,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(q,null,{default:x(()=>[y(le,{style:{width:"25%"},value:Ne.typ,"onUpdate:value":_e=>Ne.typ=_e,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(te,{onChange:_e=>T(_e,Ne),value:Ne.value,"onUpdate:value":_e=>Ne.value=_e,onDropdownVisibleChange:g,style:{width:"40%"},options:M.value,allowClear:!1,displayRender:({labels:_e})=>_e.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:_e=>D(ge)},[y(K(Jt))],8,ET)])]),_:2},1024)]))),128)),y(ce,{onClick:St(A,["stop"]),icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...X[21]||(X[21]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])])]),_:1})}}},AT=Te(DT,[["__scopeId","data-v-1f51a256"]]),OT={class:"field-select-box"},NT={key:0,class:"field-list-box"},MT={key:1,class:"empty-box"},TT={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=G(!1),r=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),s=G([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]);G([]);const a=(c,f)=>{r.selectedRowKeys=c,r.selectedRows=f},l=({selectedRowKeys:c,selectedRows:f})=>{r.selectedRowKeys=c,r.selectedRows=f,r.show=!0},u=()=>{o("ok",r.selectedRowKeys,r.selectedRows),r.show=!1};return e({open:l}),(c,f)=>{const p=Ms,h=vn;return w(),Q(h,{width:"746px",open:r.show,"onUpdate:open":f[0]||(f[0]=g=>r.show=g),title:"关联数据表",onOk:u,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",OT,[n.fields.length?(w(),R("div",NT,[y(p,{rowKey:"field_name","row-selection":{selectedRowKeys:r.selectedRowKeys,onChange:a},dataSource:n.fields,columns:s.value,loading:i.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):ie("",!0),n.fields.length?ie("",!0):(w(),R("div",MT,[...f[1]||(f[1]=[d("img",{src:qa,alt:""},null,-1),d("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},$T=Te(TT,[["__scopeId","data-v-f2480ca0"]]),PT={class:"field-list"},RT={class:"field-list-row"},BT={key:0,class:"field-list-col field-list-col-head field-value-head"},LT={key:1,class:"field-list-col field-list-col-head field-del-head"},IT={key:0,class:"field-list-row"},FT={class:"field-list-col field-value-col"},jT={class:"field-list-col field-name-col"},VT={class:"field-list-col field-type-col"},HT={key:0,class:"field-list-col field-value-col"},UT={key:1,class:"field-list-col field-del-col"},zT=["onClick"],qT={key:0,class:"add-btn-box"},GT={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:[],keys:[]});gt(()=>o.list,_=>{r.list=_,r.keys=_.map(v=>v.field_name)},{immediate:!0});const s=G([]),a=()=>{let _=i().getAllParentVariable();s.value=_||[]},l=()=>{a()},u=(_,v,b,C)=>{r.list[C].value=_,r.list[C].atTags=v,p()},c=(_,v)=>{r.list=[...v],r.keys=[..._],p()},f=_=>{r.list.splice(_,1),p()},p=()=>{t("change",[...r.list],[...r.keys])},h=G(),g=()=>{h.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(_=>_.field_name)})},m=_=>{switch(_.ui_type){case"Checkbox":return"请输入true或false，键入“/”插入变量";case"MultiSelect":return"多个选项“,”分割，键入“/”插入变量"}return"请输入参数值，键入“/”插入变量"};return ut(()=>{a()}),(_,v)=>{const b=ln,C=Qt,M=Nn,O=Kt;return w(),R("div",null,[d("div",PT,[d("div",RT,[v[0]||(v[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),v[1]||(v[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",BT,"字段值")):ie("",!0),o.showDelete?(w(),R("div",LT)):ie("",!0)]),n.showEmptyFieldRow?(w(),R("div",IT,[v[2]||(v[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),v[3]||(v[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",FT,[y(C,{title:"请先选择数据库"},{default:x(()=>[y(b,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),R(ae,null,ye(r.list,(k,E)=>(w(),R("div",{class:"field-list-row",key:k.field_name},[d("div",jT,j(k.field_name),1),d("div",VT,j(k.ui_type),1),n.showInput?(w(),R("div",HT,[y(ot,{options:s.value,defaultValue:k.value,defaultSelectedList:k.atTags,onOpen:l,onChange:(S,N)=>u(S,N,k,E),placeholder:m(k)},null,8,["options","defaultValue","defaultSelectedList","onChange","placeholder"])])):ie("",!0),o.showDelete?(w(),R("div",UT,[d("span",{class:"del-btn",onClick:S=>f(E)},[y(M,{class:"del-icon",name:"close-circle"})],8,zT)])):ie("",!0)]))),128))]),o.showAdd?(w(),R("div",qT,[y(O,{class:"add-btn",type:"dashed",block:"",onClick:g},{default:x(()=>[y(K(Ht)),v[4]||(v[4]=U(" 添加字段 ",-1))]),_:1})])):ie("",!0),y($T,{ref_key:"fieldSelectAlertRef",ref:h,fields:n.fields,onOk:c},null,8,["fields"])])}}},sf=Te(GT,[["__scopeId","data-v-22ea2394"]]),XT={class:"add-data-form"},WT={class:"node-box-content"},YT={class:"setting-box"},KT={__name:"feishu-insert-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=G([]);function s(u=null){var c,f,p;r.value=[],Array.isArray((p=(f=(c=u==null?void 0:u.plugin)==null?void 0:c.params)==null?void 0:f.arguments)==null?void 0:p.fields)&&u.plugin.params.arguments.fields.length?(u.plugin.params.arguments.fields.map(h=>{h.value=h.value?h.value.toString():""}),r.value=u.plugin.params.arguments.fields):i.fields.map(h=>{r.value.push({value:"",atTags:[],...h})})}const a=u=>{r.value=u,l()},l=()=>{o("update",{fields:Bn(r.value)})};return e({init:s,clear(){r.value=[],l()}}),(u,c)=>(w(),R("div",XT,[d("div",WT,[c[0]||(c[0]=d("div",{class:"setting-label"},[d("span",null,"插入数据"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",YT,[y(sf,{showEmptyFieldRow:!n.tableId,list:r.value,fields:n.fields,showAdd:!1,showDelete:!1,onChange:a},null,8,["showEmptyFieldRow","list","fields"])])])]))}},JT=Te(KT,[["__scopeId","data-v-dfe49656"]]),ZT={class:"add-data-form"},QT={class:"node-box-content"},e4={class:"options-item is-required"},t4={class:"field-list-item"},n4={class:"field-label"},o4={class:"field-type"},i4={class:"setting-box"},r4={__name:"feishu-update-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=G([]),r=Je({tags:[],value:""});function s(c=null){var f,p,h,g,m,_;i.value=[],Array.isArray((h=(p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)==null?void 0:p.arguments)==null?void 0:h.fields)&&c.plugin.params.arguments.fields.length&&(c.plugin.params.arguments.fields.map(v=>{v.value=v.value?v.value.toString():""}),i.value=c.plugin.params.arguments.fields),c&&((_=(m=(g=c==null?void 0:c.plugin)==null?void 0:g.params)==null?void 0:m.arguments)!=null&&_.record_id)&&(r.value=c.plugin.params.arguments.record_id,r.tags=c.plugin.params.arguments.record_tags||[])}const a=c=>{i.value=c,u()};function l(c,f){r.value=c,r.tags=f,u()}const u=()=>{o("update",{record_id:r.value,record_tags:r.tags,fields:Bn(i.value)})};return e({init:s}),(c,f)=>(w(),R("div",ZT,[d("div",QT,[d("div",e4,[f[1]||(f[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"record_id"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:r.tags,defaultValue:r.value,ref:"atInputRef",onOpen:f[0]||(f[0]=p=>o("updateVar")),onChange:l,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:p,payload:h})=>[d("div",t4,[d("div",n4,j(p),1),d("div",o4,j(h.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[2]||(f[2]=d("div",{class:"desc"},'待更新的记录ID；示例值："reCWNXZPQv"',-1))]),d("div",i4,[y(sf,{showEmptyFieldRow:!n.tableId,list:i.value,fields:n.fields,showAdd:!0,showDelete:!0,onChange:a},null,8,["showEmptyFieldRow","list","fields"])])])]))}},s4=Te(r4,[["__scopeId","data-v-8b21a328"]]),a4={class:"options-item is-required"},l4={class:"field-list-item"},u4={class:"field-label"},d4={class:"field-type"},c4={__name:"feishu-del-data",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tags:[],value:""});function r(a=null){var l,u,c;a&&((c=(u=(l=a==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)!=null&&c.record_id)&&(i.value=a.plugin.params.arguments.record_id,i.tags=a.plugin.params.arguments.record_tags||[])}function s(a,l){i.value=a,i.tags=l,o("update",{record_id:a,record_tags:l})}return e({init:r}),(a,l)=>(w(),R("div",a4,[l[1]||(l[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"record_id"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:i.tags,defaultValue:i.value,ref:"atInputRef",onOpen:l[0]||(l[0]=u=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:u,payload:c})=>[d("div",l4,[d("div",u4,j(u),1),d("div",d4,j(c.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),l[2]||(l[2]=d("div",{class:"desc"},'待删除的记录ID；示例值："reCWNXZPQv"',-1))]))}},f4=Te(c4,[["__scopeId","data-v-06518fa2"]]),Bg=[{key:"is",label:"是"},{key:"isNot",label:"不是"},{key:"contains",label:"包含"},{key:"doesNotContain",label:"不包含"},{key:"isEmpty",label:"为空"},{key:"isNotEmpty",label:"不为空"},{key:"isGreater",label:"大于"},{key:"isGreaterEqual",label:"大于等于"},{key:"isLess",label:"小于"},{key:"isLessEqual",label:"小于等于"}];function Lg(){let n={};for(let e of Bg)n[e.key]=e;return n}const p4=["Text","SingleSelect","MultiSelect","DateTime","Number","Checkbox"],h4={Text:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],Number:["is","isNot","isEmpty","isNotEmpty","isGreater","isGreaterEqual","isLess","isLessEqual"],SingleSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],MultiSelect:["is","isNot","isEmpty","isNotEmpty","contains","doesNotContain"],DateTime:["is","isEmpty","isNotEmpty","isGreater","isLess"],Checkbox:["is"]};function v4(n){let e=h4[n]||[];return Bg.filter(t=>e.includes(t.key))}const qd=["batch_create_record","batch_delete_record","batch_get_record","batch_update_record"];function Ig(n){const e=["app_id","app_secret","app_token","table_id"],t={};for(let o in n)!e.includes(o)&&n[o].required&&(t[o]=JSON.parse(JSON.stringify(n[o])));return t}const g4={class:"query-condition-filter"},_4={class:"condition-select-box"},m4={class:"select-wrapper"},y4={class:"field-items"},b4={class:"field-select-box"},x4={class:"operator-select-box"},w4={class:"field-value-box"},C4=["onClick"],S4={class:"add-btn-box"},k4={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},conjunction:{type:String,default:"and"}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=Je({list:[],conjunction:"and"});gt(()=>o.where,v=>{r.list=v},{immediate:!0}),gt(()=>o.conjunction,v=>{r.conjunction=v},{immediate:!0});const s=Xe(()=>o.where.length>1),a=G([]),l=()=>{let v=i().getAllParentVariable();a.value=v||[]},u=()=>{l()},c=()=>{let v={conjunction:r.conjunction,list:r.list};t("change",v)},f=(v,b,C,M)=>{r.list[M].value=v,r.list[M].atTags=b,c()},p=(v,b)=>{r.list[b].value="",c()},h=()=>{let v={field_id:"",field_name:"",field_type:"",operator:void 0,value:"",atTags:[]};r.list.push(v),c()},g=v=>{r.list.splice(v,1),c()},m=(v,b)=>{let C={field_id:b.key,field_name:b.value,field_type:b.type,operator:void 0,value:"",atTags:[]};r.list[v]=C,c()},_=({key:v})=>{r.conjunction=v,c()};return ut(()=>{l()}),(v,b)=>{const C=Lr,M=Br,O=Ir,k=Vt,E=It,S=ln,N=Nn,L=Kt,$=Qt;return w(),R("div",{class:Ct(["query-condition-filter-warpper",{"is-multiple":s.value}])},[d("div",g4,[b[3]||(b[3]=d("div",{class:"auxiliary-line"},null,-1)),d("div",_4,[d("div",m4,[y(O,null,{overlay:x(()=>[y(M,{style:{width:"100px"},onClick:_},{default:x(()=>[y(C,{key:"and"},{default:x(()=>[...b[1]||(b[1]=[d("a",{href:"javascript:;"},"且",-1)])]),_:1}),y(C,{key:"or"},{default:x(()=>[...b[2]||(b[2]=[d("a",{href:"javascript:;"},"或",-1)])]),_:1})]),_:1})]),default:x(()=>[d("a",{class:"ant-dropdown-link",onClick:b[0]||(b[0]=St(()=>{},["prevent"]))},[U(j(r.conjunction=="and"?"且":"或")+" ",1),y(K(Ro))])]),_:1})])]),d("div",y4,[(w(!0),R(ae,null,ye(r.list,(B,A)=>(w(),R("div",{class:"field-item",key:B.field},[d("div",b4,[y(E,{style:{width:"100px"},value:B.field_name,"onUpdate:value":D=>B.field_name=D,onChange:(D,T)=>m(A,T)},{default:x(()=>[(w(!0),R(ae,null,ye(o.fieldOptions,D=>(w(),Q(k,{value:D.field_name,type:D.ui_type,key:D.field_id},{default:x(()=>[U(j(D.field_name),1)]),_:2},1032,["value","type"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),d("div",x4,[y(E,{value:B.operator,"onUpdate:value":D=>B.operator=D,style:{width:"100px"},onChange:()=>p(B,A)},{default:x(()=>[(w(!0),R(ae,null,ye(K(v4)(B.field_type),D=>(w(),Q(k,{value:D.key,key:D.key},{default:x(()=>[U(j(D.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),d("div",w4,[["isEmpty","isNotEmpty"].includes(B.operator)?(w(),Q(S,{key:0,placeholder:"无需输入值",disabled:""})):(w(),Q(ot,{key:1,options:a.value,defaultValue:B.value,defaultSelectedList:B.atTags,onOpen:u,onChange:(D,T)=>f(D,T,B,A),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),d("span",{class:"field-del-btn",onClick:D=>g(A)},[y(N,{class:"del-icon",name:"close-circle"})],8,C4)]))),128))])]),d("div",S4,[n.disabled?(w(),Q($,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(L,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(K(Ht)),b[4]||(b[4]=U(" 添加条件 ",-1))]),_:1})])]),_:1})):(w(),Q(L,{key:1,class:"add-btn",type:"dashed",block:"",onClick:h},{default:x(()=>[y(K(Ht)),b[5]||(b[5]=U(" 添加条件 ",-1))]),_:1}))])],2)}}},E4=Te(k4,[["__scopeId","data-v-dbda544a"]]),D4={class:"field-select-box"},A4={key:0,class:"field-list-box"},O4={key:1,class:"empty-box"},N4={__name:"field-select-alert",props:{fields:{type:Array,default:()=>[]}},emits:["ok"],setup(n,{expose:e,emit:t}){const o=t,i=Je({show:!1,selectedRowKeys:[],selectedRows:[]}),r=G([{title:"字段名称",dataIndex:"field_name"},{title:"数据类型",dataIndex:"ui_type"}]),s=(u,c)=>{i.selectedRowKeys=u,i.selectedRows=c},a=({selectedRowKeys:u,selectedRows:c})=>{i.selectedRowKeys=u,i.selectedRows=c,i.show=!0},l=()=>{o("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:a}),(u,c)=>{const f=Ms,p=vn;return w(),Q(p,{width:"746px",open:i.show,"onUpdate:open":c[0]||(c[0]=h=>i.show=h),title:"关联数据表",onOk:l,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[d("div",D4,[n.fields.length?(w(),R("div",A4,[y(f,{rowKey:"field_name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:s},dataSource:n.fields,columns:r.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):ie("",!0),n.fields.length?ie("",!0):(w(),R("div",O4,[...c[1]||(c[1]=[d("img",{src:qa,alt:""},null,-1),d("div",null,"暂无字段, 请先去数据表添加",-1)])]))])]),_:1},8,["open"])}}},M4=Te(N4,[["__scopeId","data-v-519d2fc8"]]),T4={class:"field-list"},$4={class:"field-list-col field-drag-col"},P4={class:"drag-btn"},R4={class:"field-list-col field-name-col"},B4={class:"field-name-box"},L4={class:"field-name"},I4={class:"field-type-tag"},F4={class:"field-list-col field-value-col"},j4={key:0,class:"field-list-col field-del-col"},V4={class:"add-btn-box"},H4={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],r=G(),s=G([]);gt(()=>o.list,p=>{s.value=p.map(h=>({...h,is_asc:h.is_asc?1:0}))});const a=p=>{s.value.splice(p,1),c()},l=(p,h)=>{s.value=h.map(g=>({...g})),c()},u=()=>{c()},c=()=>{let p=s.value.map(h=>({...h,is_asc:h.is_asc==1}));t("change",p)},f=()=>{r.value.open({selectedRows:o.list,selectedRowKeys:o.list.map(p=>p.field_name)})};return(p,h)=>{const g=Vt,m=It,_=Nn,v=Kt,b=Qt;return w(),R("div",null,[d("div",T4,[(w(!0),R(ae,null,ye(s.value,C=>(w(),R("div",{class:"field-list-row",key:C.name},[d("div",$4,[d("span",P4,[y(K(Jc))])]),d("div",R4,[d("div",B4,[d("span",L4,j(C.field_name),1),d("span",I4,j(C.ui_type),1)])]),d("div",F4,[y(m,{value:C.is_asc,"onUpdate:value":M=>C.is_asc=M,style:{width:"100%"},onChange:u},{default:x(()=>[(w(),R(ae,null,ye(i,M=>y(g,{value:M.value,key:M.key},{default:x(()=>[U(j(M.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onUpdate:value"])]),o.showDelete?(w(),R("div",j4,[d("span",{class:"del-btn",onClick:h[0]||(h[0]=M=>a(p.index))},[y(_,{class:"del-icon",name:"close-circle"})])])):ie("",!0)]))),128))]),d("div",V4,[n.disabled?(w(),Q(b,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:x(()=>[d("span",null,[y(v,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:x(()=>[y(K(Ht)),h[1]||(h[1]=U(" 添加排序字段 ",-1))]),_:1})])]),_:1})):(w(),Q(v,{key:1,class:"add-btn",type:"dashed",block:"",onClick:f},{default:x(()=>[y(K(Ht)),h[2]||(h[2]=U(" 添加排序字段 ",-1))]),_:1}))]),y(M4,{fields:n.fields,ref_key:"fieldSelectAlertRef",ref:r,onOk:l},null,8,["fields"])])}}},U4=Te(H4,[["__scopeId","data-v-b86645fb"]]),z4={class:"select-data-form"},q4={class:"node-box-content"},G4={class:"setting-box"},X4={class:"flex-between"},W4={class:"field-list-item"},Y4={class:"field-label"},K4={class:"field-type"},J4={class:"flex-between"},Z4={class:"field-list-item"},Q4={class:"field-label"},e6={class:"field-type"},t6={class:"flex-between"},n6={class:"field-list-item"},o6={class:"field-label"},i6={class:"field-type"},r6={__name:"feishu-search-data",props:{variableOptions:{type:Array},tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r={field_names:[],filter:{conjunction:"and",conditions:[]},sort:[],page_size:100,field_names_json:"",filter_json:"",sort_json:"",input_type_map:{field_names:1,filter:1,sort:1},tag_map:{}},s=Je(JSON.parse(JSON.stringify(r))),a=G(null),l=G({}),u=G(""),c=G(""),f=G([]);function p(O=null){var k,E,S,N;if(!O)Object.assign(s,JSON.parse(JSON.stringify(r)));else{let{field_names:L,filter:$,sort:B,page_size:A,input_type_map:D,tag_map:T}=((E=(k=O==null?void 0:O.plugin)==null?void 0:k.params)==null?void 0:E.arguments)||{};if(Array.isArray($.conditions)&&$.conditions.length){for(let F of $.conditions)F.field_type==="DateTime"&&(F.value=F.value.replace(/\D/g,""));s.filter=$}else s.filter={conjunction:"and",conditions:[]};Array.isArray(L)&&(D==null?void 0:D.field_names)!=2?L.map(F=>{let V=i.fields.find(P=>P.field_name==F);V&&s.field_names.push(V)}):s.field_names=Array.isArray(L)?L:[],Array.isArray(B)&&(D==null?void 0:D.sort)!=2?s.sort=B.map(F=>({...i.fields.find(P=>P.field_name==F.field_name),is_asc:F.desc?0:1})):s.sort=Array.isArray(B)?B:[],D&&(s.input_type_map=D);for(let F in D)if(D[F]==2){let V=JSON.stringify(s[F]);Array.isArray(s[F])?s[F].length||(V=""):(N=(S=s[F])==null?void 0:S.conditions)!=null&&N.length||(V=""),s[`${F}_json`]=V}s.tag_map=T||{},s.page_size=A||100}}const h=({conjunction:O,list:k})=>{s.filter.conjunction=O,s.filter.conditions=k,C()},g=O=>{s.sort=[...O],C()},m=O=>{s.field_names=O,C()};function _(O,k,E){s[O]=k,s.tag_map[O]=E,C()}function v(O,k){const E=u.value;E&&(s[E]=O,s.tag_map[E]=k,C())}function b(O){var k;u.value=O,c.value=s[O]||"",f.value=((k=s.tag_map)==null?void 0:k[O])||[],a.value.show()}function C(){o("update",JSON.parse(JSON.stringify(s)))}function M(){var E;const O=u.value,k=(E=l.value)==null?void 0:E[O];k&&k.refresh&&k.refresh()}return e({init:p,clearSelections(){var O,k,E;((O=s.input_type_map)==null?void 0:O.filter)==1&&(s.filter.conditions=[]),((k=s.input_type_map)==null?void 0:k.field_names)==1&&(s.field_names=[]),((E=s.input_type_map)==null?void 0:E.sort)==1&&(s.sort=[]),C()}}),(O,k)=>{const E=Vt,S=It,N=$n;return w(),R("div",z4,[d("div",q4,[d("div",G4,[y(ss,{title:"查询条件",count:s.filter.conditions.length},{extra:x(()=>[d("div",X4,[s.input_type_map.filter!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:k[0]||(k[0]=L=>b("filter_json"))},[y(K(Ko))])):ie("",!0),y(S,{value:s.input_type_map.filter,"onUpdate:value":k[1]||(k[1]=L=>s.input_type_map.filter=L),style:{width:"130px"},onChange:C},{default:x(()=>[y(E,{value:1},{default:x(()=>[...k[21]||(k[21]=[U("选择查询条件",-1)])]),_:1}),y(E,{value:2},{default:x(()=>[...k[22]||(k[22]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var L;return[s.input_type_map.filter!=1?(w(),R(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((L=s.tag_map)==null?void 0:L.filter_json)||[],defaultValue:s.filter_json,ref:$=>l.value.filter_json=$,onOpen:k[2]||(k[2]=$=>o("updateVar")),onChange:k[3]||(k[3]=($,B)=>_("filter_json",$,B)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:$,payload:B})=>[d("div",W4,[d("div",Y4,j($),1),d("div",K4,j(B.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),k[23]||(k[23]=d("div",{class:"desc"},'内容示例：{"conditions":[{"field_name":"文章ID","operator":"is","value":"123"}],"conjunction":"and"}',-1))],64)):(w(),Q(E4,{key:1,disabled:!n.tableId,where:s.filter.conditions,"field-options":n.fields,conjunction:s.filter.conjunction,onChange:h},null,8,["disabled","where","field-options","conjunction"]))]}),_:1},8,["count"])]),d("div",{class:"setting-box",onWheel:k[8]||(k[8]=St(()=>{},["stop"])),onTouchmove:k[9]||(k[9]=St(()=>{},["stop"]))},[y(ss,{title:"查询字段",count:s.field_names.length},{extra:x(()=>[d("div",J4,[s.input_type_map.field_names!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:k[4]||(k[4]=L=>b("field_names_json"))},[y(K(Ko))])):ie("",!0),y(S,{value:s.input_type_map.field_names,"onUpdate:value":k[5]||(k[5]=L=>s.input_type_map.field_names=L),style:{width:"130px"},onChange:C},{default:x(()=>[y(E,{value:1},{default:x(()=>[...k[24]||(k[24]=[U("选择查询字段",-1)])]),_:1}),y(E,{value:2},{default:x(()=>[...k[25]||(k[25]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var L;return[s.input_type_map.field_names!=1?(w(),R(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((L=s.tag_map)==null?void 0:L.field_names_json)||[],defaultValue:s.field_names_json,ref:$=>l.value.field_names_json=$,onOpen:k[6]||(k[6]=$=>o("updateVar")),onChange:k[7]||(k[7]=($,B)=>_("field_names_json",$,B)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:$,payload:B})=>[d("div",Z4,[d("div",Q4,j($),1),d("div",e6,j(B.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),k[26]||(k[26]=d("div",{class:"desc"},'内容示例：["文章ID","封面图","创建时间","介绍"]',-1))],64)):(w(),Q(sf,{key:1,showAdd:!!n.tableId,showInput:!1,showEmptyFieldRow:!n.tableId,list:s.field_names,fields:n.fields,onChange:m},null,8,["showAdd","showEmptyFieldRow","list","fields"]))]}),_:1},8,["count"])],32),d("div",{class:"setting-box",onWheel:k[14]||(k[14]=St(()=>{},["stop"])),onTouchmove:k[15]||(k[15]=St(()=>{},["stop"]))},[y(ss,{title:"排序",count:s.sort.length},{extra:x(()=>[d("div",t6,[s.input_type_map.sort!=1?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:k[10]||(k[10]=L=>b("sort_json"))},[y(K(Ko))])):ie("",!0),y(S,{value:s.input_type_map.sort,"onUpdate:value":k[11]||(k[11]=L=>s.input_type_map.sort=L),style:{width:"130px"},onChange:C},{default:x(()=>[y(E,{value:1},{default:x(()=>[...k[27]||(k[27]=[U("选择排序",-1)])]),_:1}),y(E,{value:2},{default:x(()=>[...k[28]||(k[28]=[U("输入变量",-1)])]),_:1})]),_:1},8,["value"])])]),default:x(()=>{var L;return[s.input_type_map.sort!=1?(w(),R(ae,{key:0},[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((L=s.tag_map)==null?void 0:L.sort_json)||[],defaultValue:s.sort_json,ref:$=>l.value.sort_json=$,onOpen:k[12]||(k[12]=$=>o("updateVar")),onChange:k[13]||(k[13]=($,B)=>_("sort_json",$,B)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:$,payload:B})=>[d("div",n6,[d("div",o6,j($),1),d("div",i6,j(B.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),k[29]||(k[29]=d("div",{class:"desc"},'内容示例：[{"desc":false,"field_name":"文章ID"},{"desc":true,"field_name":"更新时间"}]',-1))],64)):(w(),Q(U4,{key:1,disabled:!n.tableId,list:s.sort,fields:n.fields,onChange:g},null,8,["disabled","list","fields"]))]}),_:1},8,["count"])],32),k[30]||(k[30]=d("div",{class:"setting-label"},[d("span",null,"查询数量")],-1)),d("div",{class:"setting-box",onWheel:k[17]||(k[17]=St(()=>{},["stop"])),onTouchmove:k[18]||(k[18]=St(()=>{},["stop"]))},[y(N,{value:s.page_size,"onUpdate:value":k[16]||(k[16]=L=>s.page_size=L),disabled:!n.tableId,min:20,max:500,style:{width:"205px"},onChange:C},null,8,["value","disabled"])],32)]),y(jr,{options:n.variableOptions,defaultSelectedList:f.value,defaultValue:c.value,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:k[19]||(k[19]=L=>o("updateVar")),onChange:k[20]||(k[20]=(L,$)=>v(L,$)),onOk:M,ref_key:"fullAtInputRef",ref:a},null,8,["options","defaultSelectedList","defaultValue"])])}}},s6=Te(r6,[["__scopeId","data-v-ea76d158"]]),a6={class:"field-item"},l6={class:"field-key"},u6={class:"tip-content"},d6={class:"field-type"},c6={class:"field-name"},f6={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=G([]);return(o,i)=>{const r=Nn,s=Qt,a=Zc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[d("span",{class:Ct(l)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[d("div",a6,[d("span",l6,j(l.key),1),l.tip?(w(),Q(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[d("div",u6,j(l.tip),1)]),default:x(()=>[y(K(mt),{style:{"margin-left":"4px"}})]),_:2},1024)):ie("",!0),d("span",d6,j(l.typ),1),d("span",c6,j(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},Fi=Te(f6,[["__scopeId","data-v-9b9c09b2"]]),p6={class:"add-data-form"},h6={class:"node-box-content"},v6={class:"options-item-tit"},g6={class:"flex-between"},_6={class:"option-label"},m6={class:"option-type"},y6=["onClick"],b6={class:"field-list-item"},x6={class:"field-label"},w6={class:"field-type"},C6={class:"desc"},S6={__name:"feishu-batch-box",props:{actionName:{type:String},action:{type:Object},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Je({}),s=G(null),a=G([]),l=G(""),u=G(-1),c=G(""),f=G([]);ut(()=>{h()});function p(b,C){l.value=b,u.value=C;const M=r[b]||{};c.value=M.value||"",f.value=M.tags||[],s.value.show()}function h(b=null){var M,O,k;const C=Ig(((M=i.action)==null?void 0:M.params)||{});for(let E in C){const S=r[E]||{};r[E]={...C[E],value:S.value??C[E].value??"",tags:S.tags??C[E].tags??[]}}if(b){let E=((k=(O=b==null?void 0:b.plugin)==null?void 0:O.params)==null?void 0:k.arguments)||{},S=(E==null?void 0:E.tag_map)||{};for(let N in r){const L=r[N]||{};!!String(L.value||"").length||Array.isArray(L.tags)&&L.tags.length>0||(r[N].value=E[N]??L.value??"",r[N].tags=S[N]??L.tags??[])}}}function g(b,C,M){b.value=C,b.tags=M,_()}function m(b,C){const M=l.value;if(!M)return;const O=r[M];O&&(O.value=b,O.tags=C,_())}const _=()=>{let b={tag_map:{}};for(let C in r)b[C]=r[C].value,b.tag_map[C]=r[C].tags;o("update",b)};function v(){const b=u.value;if(b!=null&&b>-1){const C=a.value||[],M=Array.isArray(C)?C[b]:C;M&&M.refresh&&M.refresh()}}return e({init:h}),(b,C)=>(w(),R("div",p6,[d("div",h6,[(w(!0),R(ae,null,ye(r,(M,O,k)=>(w(),R("div",{key:O,class:"options-item is-required"},[d("div",v6,[d("div",g6,[d("div",_6,j(M.name||O),1),d("div",m6,j(M.type),1)]),d("div",{class:"btn-hover-wrap",onClick:E=>p(O,k)},[y(K(Ko))],8,y6)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:M.tags,defaultValue:M.value,ref_for:!0,ref_key:"atInputRef",ref:a,onOpen:C[0]||(C[0]=E=>o("updateVar")),onChange:(E,S)=>g(M,E,S),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:E,payload:S})=>[d("div",b6,[d("div",x6,j(E),1),d("div",w6,j(S.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",C6,j(M.desc),1)]))),128))]),y(jr,{options:n.variableOptions,defaultSelectedList:f.value,defaultValue:c.value,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:C[1]||(C[1]=M=>o("updateVar")),onChange:C[2]||(C[2]=(M,O)=>m(M,O)),onOk:v,ref_key:"fullAtInputRef",ref:s},null,8,["options","defaultSelectedList","defaultValue"])]))}},k6=Te(S6,[["__scopeId","data-v-1dcb9756"]]),E6={class:"options-item is-required"},D6={class:"min-input"},A6={class:"field-list-item"},O6={class:"field-label"},N6={class:"field-type"},M6={__name:"feishu-create-bitable",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({tag_map:{},name:""});function r(l=null){var u,c,f;l&&((f=(c=(u=l==null?void 0:l.plugin)==null?void 0:u.params)==null?void 0:c.arguments)!=null&&f.name)&&(i.name=l.plugin.params.arguments.name,i.tag_map=l.plugin.params.arguments.tag_map||{})}function s(l,u){i.name=l,i.tag_map.name=u,a()}function a(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:r,update:a}),(l,u)=>(w(),R("div",E6,[u[1]||(u[1]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表格名称"),d("div",{class:"option-type"},"string")],-1)),d("div",D6,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:i.tag_map.name||[],defaultValue:i.name,ref:"atInputRef",onOpen:u[0]||(u[0]=c=>o("updateVar")),onChange:s,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:c,payload:f})=>[d("div",A6,[d("div",O6,j(c),1),d("div",N6,j(f.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),u[2]||(u[2]=d("div",{class:"desc"},'多维表格 App 名称。最长为 255 个字符。 示例值："一篇新的多维表格"',-1))]))}},T6=Te(M6,[["__scopeId","data-v-0b72ab0c"]]),$6={class:"options-item is-required"},P6={class:"min-input"},R6={class:"field-list-item"},B6={class:"field-label"},L6={class:"field-type"},I6={class:"options-item"},F6={class:"min-input"},j6={class:"field-list-item"},V6={class:"field-label"},H6={class:"field-type"},U6={class:"options-item"},z6={class:"options-item-tit flex-between"},q6={class:"field-list-item"},G6={class:"field-label"},X6={class:"field-type"},W6={__name:"feishu-create-table",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=G(null),r=G(null),s=Je({name:"",default_view_name:"",fields:"",tag_map:{}});function a(p=null){var h,g,m,_,v,b;p&&((g=(h=p==null?void 0:p.plugin)==null?void 0:h.params)!=null&&g.arguments)&&(s.name=((m=p.plugin.params.arguments)==null?void 0:m.name)||"",s.default_view_name=((_=p.plugin.params.arguments)==null?void 0:_.default_view_name)||"",s.fields=((v=p.plugin.params.arguments)==null?void 0:v.fields)||"",s.tag_map=((b=p.plugin.params.arguments)==null?void 0:b.tag_map)||{})}function l(p,h,g){s[p]=h,s.tag_map[p]=g,f()}function u(){i.value.show()}function c(){r.value.refresh()}function f(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:f}),(p,h)=>{var g,m,_,v;return w(),R("div",null,[d("div",$6,[h[8]||(h[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"数据表名称"),d("div",{class:"option-type"},"string")],-1)),d("div",P6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((g=s==null?void 0:s.tag_map)==null?void 0:g.name)||[],defaultValue:s.name,ref_key:"atInputRef",ref:r,onOpen:h[0]||(h[0]=b=>o("updateVar")),onChange:h[1]||(h[1]=(b,C)=>l("name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",R6,[d("div",B6,j(b),1),d("div",L6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[9]||(h[9]=d("div",{class:"desc"},'数据表名称；名称中的首尾空格将会被默认去除，不可以包含 / \\\\ ? * : [ ] 等特殊字符"；1 字符 ～ 100 字符 ',-1))]),d("div",I6,[h[10]||(h[10]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"表格视图的名称"),d("div",{class:"option-type"},"string")],-1)),d("div",F6,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((m=s==null?void 0:s.tag_map)==null?void 0:m.default_view_name)||[],defaultValue:s.default_view_name,ref_key:"atInputRef",ref:r,onOpen:h[2]||(h[2]=b=>o("updateVar")),onChange:h[3]||(h[3]=(b,C)=>l("default_view_name",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",j6,[d("div",V6,j(b),1),d("div",H6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[11]||(h[11]=d("div",{class:"desc"},"表格视图的名称；名称中的首尾空格将会被默认去除，名称中不允许包含 [ ] 两个字符",-1))]),d("div",U6,[d("div",z6,[h[12]||(h[12]=d("div",{class:"flex-between"},[d("div",{class:"option-label"},"数据表的初始字段"),d("div",{class:"option-type"},"jsonString")],-1)),d("div",{class:"btn-hover-wrap",onClick:u},[y(K(Ko))])]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((_=s==null?void 0:s.tag_map)==null?void 0:_.fields)||[],defaultValue:s.fields,ref_key:"atInputRef",ref:r,onOpen:h[4]||(h[4]=b=>o("updateVar")),onChange:h[5]||(h[5]=(b,C)=>l("fields",b,C)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:b,payload:C})=>[d("div",q6,[d("div",G6,j(b),1),d("div",X6,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),h[13]||(h[13]=d("div",{class:"desc"},'如果传入了 表格视图的名称，则必须传入 数据表的初始字段。示例：[{"field_name":"索引字段","type":1},{"field_name":"单选","type":3,"ui_type":"SingleSelect","property":{"options":[{"name":"Enabled"},{"name":"Disabled"}]}}] ',-1))]),y(jr,{options:n.variableOptions,defaultSelectedList:((v=s==null?void 0:s.tag_map)==null?void 0:v.fields)||[],defaultValue:s.fields,placeholder:"请输入内容，键入“/”可以插入变量",type:"textarea",onOpen:h[6]||(h[6]=b=>o("updateVar")),onChange:h[7]||(h[7]=(b,C)=>l("fields",b,C)),onOk:c,ref_key:"fullAtInputRef",ref:i},null,8,["options","defaultSelectedList","defaultValue"])])}}},Y6=Te(W6,[["__scopeId","data-v-e75ca588"]]),K6={class:"options-item is-required"},J6={class:"min-input"},Z6={class:"field-list-item"},Q6={class:"field-label"},e$={class:"field-type"},t$={class:"options-item"},n$={class:"min-input"},o$={__name:"feishu-create-view",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=Je({view_name:"",view_type:"grid",tag_map:{}}),r=[{label:"表格视图",value:"grid"},{label:"看板视图",value:"kanban"},{label:"画册视图",value:"gallery"},{label:"甘特视图",value:"gantt"},{label:"表单视图",value:"form"}];function s(u=null){var c,f,p,h,g;u&&((f=(c=u==null?void 0:u.plugin)==null?void 0:c.params)!=null&&f.arguments)&&(i.name=((p=u.plugin.params.arguments)==null?void 0:p.name)||"",i.view_name=((h=u.plugin.params.arguments)==null?void 0:h.view_name)||"",i.tag_map=((g=u.plugin.params.arguments)==null?void 0:g.tag_map)||{})}function a(u,c,f){i[u]=c,i.tag_map[u]=f,l()}function l(){o("update",JSON.parse(JSON.stringify(i)))}return e({init:s,update:l}),(u,c)=>{var p;const f=It;return w(),R("div",null,[d("div",K6,[c[3]||(c[3]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"视图名称"),d("div",{class:"option-type"},"string")],-1)),d("div",J6,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((p=i==null?void 0:i.tag_map)==null?void 0:p.view_name)||[],defaultValue:i.view_name,ref:"atInputRef",onOpen:c[0]||(c[0]=h=>o("updateVar")),onChange:c[1]||(c[1]=(h,g)=>a("view_name",h,g)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:h,payload:g})=>[d("div",Z6,[d("div",Q6,j(h),1),d("div",e$,j(g.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),c[4]||(c[4]=d("div",{class:"desc"},"视图名称。名称不能包含特殊字符；不可以包含 [ ] 等特殊字符；1 字符 ～ 100 字符",-1))]),d("div",t$,[c[5]||(c[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"视图类型"),d("div",{class:"option-type"},"string")],-1)),d("div",n$,[y(f,{value:i.view_type,"onUpdate:value":c[2]||(c[2]=h=>i.view_type=h),options:r,placeholder:"选择视图",style:{width:"100%"}},null,8,["value"])]),c[6]||(c[6]=d("div",{class:"desc"},"视图类型，默认为表格视图。",-1))])])}}},i$=Te(o$,[["__scopeId","data-v-e8b3ac59"]]),r$={class:"options-item is-required"},s$={class:"min-input"},a$={class:"field-list-item"},l$={class:"field-label"},u$={class:"field-type"},d$={class:"options-item is-required"},c$={class:"min-input"},f$={class:"options-item is-required"},p$={class:"min-input"},h$={class:"field-list-item"},v$={class:"field-label"},g$={class:"field-type"},_$={__name:"feishu-add-members",props:{config:{type:Object,default:()=>({app_id:"",app_secret:"",app_token:""})},variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=["user_id"],r=G(null);G([]);const s=Je({member_id:"",role_id:void 0,role_name:"",member_id_type:"user_id",tag_map:{}});function a(c=null){var f,p;c&&((p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)!=null&&p.arguments)&&Object.assign(s,c.plugin.params.arguments)}function l(c,f,p){s[c]=f,s.tag_map[c]=p,u()}function u(){o("update",JSON.parse(JSON.stringify(s)))}return e({init:a,update:u}),(c,f)=>{var g,m;const p=Vt,h=It;return w(),R("div",null,[d("div",r$,[f[5]||(f[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择角色"),d("div",{class:"option-type"},"string")],-1)),d("div",s$,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((g=s==null?void 0:s.tag_map)==null?void 0:g.role_id)||[],defaultValue:s.role_id,ref_key:"atInputRef",ref:r,onOpen:f[0]||(f[0]=_=>o("updateVar")),onChange:f[1]||(f[1]=(_,v)=>l("role_id",_,v)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:_,payload:v})=>[d("div",a$,[d("div",l$,j(_),1),d("div",u$,j(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",d$,[f[6]||(f[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"协作者ID的类型"),d("div",{class:"option-type"},"string")],-1)),d("div",c$,[y(h,{value:s.member_id_type,"onUpdate:value":f[2]||(f[2]=_=>s.member_id_type=_),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(),R(ae,null,ye(i,_=>y(p,{key:_},{default:x(()=>[U(j(_),1)]),_:2},1024)),64))]),_:1},8,["value"])]),f[7]||(f[7]=d("div",{class:"desc"},"协作者ID的类型，仅支持 user_id",-1))]),d("div",f$,[f[8]||(f[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"协作者ID"),d("div",{class:"option-type"},"string")],-1)),d("div",p$,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((m=s==null?void 0:s.tag_map)==null?void 0:m.member_id)||[],defaultValue:s.member_id,ref_key:"atInputRef",ref:r,onOpen:f[3]||(f[3]=_=>o("updateVar")),onChange:f[4]||(f[4]=(_,v)=>l("member_id",_,v)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:_,payload:v})=>[d("div",h$,[d("div",v$,j(_),1),d("div",g$,j(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[9]||(f[9]=d("div",{class:"desc"},[U("协作者ID，"),d("a",{href:"https://open.feishu.cn/document/platform-overveiw/basic-concepts/user-identity-introduction/open-id",target:"_blank"},"如何获取协作者ID")],-1))])])}}},m$=Te(_$,[["__scopeId","data-v-127e6c85"]]),y$={class:"options-item is-required"},b$={class:"min-input"},x$={class:"field-list-item"},w$={class:"field-label"},C$={class:"field-type"},S$={class:"options-item is-required"},k$={class:"flex-between"},E$={class:"min-input"},D$={__name:"feishu-update-advanced",props:{variableOptions:{type:Array}},emits:["update","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=G(null),r=Je({name:"",is_advanced:"0",tag_map:{}});function s(c=null){var f,p;c&&((p=(f=c==null?void 0:c.plugin)==null?void 0:f.params)!=null&&p.arguments)&&Object.assign(r,c.plugin.params.arguments)}function a(c,f,p){r[c]=f,r.tag_map[c]=p,u()}function l(c){r.is_advanced=c?"1":"0",u()}function u(){o("update",JSON.parse(JSON.stringify(r)))}return e({init:s,update:u}),(c,f)=>{var m;const p=Ri,h=Ii,g=Li;return w(),R("div",null,[d("div",y$,[f[3]||(f[3]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表格的名称"),d("div",{class:"option-type"},"string")],-1)),d("div",b$,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((m=r==null?void 0:r.tag_map)==null?void 0:m.name)||[],defaultValue:r.name,ref_key:"atInputRef",ref:i,onOpen:f[0]||(f[0]=_=>o("updateVar")),onChange:f[1]||(f[1]=(_,v)=>a("name",_,v)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:_,payload:v})=>[d("div",x$,[d("div",w$,j(_),1),d("div",C$,j(v.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f[4]||(f[4]=d("div",{class:"desc"},"更新多维表格的名称",-1))]),d("div",S$,[d("div",k$,[f[5]||(f[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"开启高级权限"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(p,{checked:r.is_advanced>0,onChange:l},null,8,["checked"])])]),d("div",E$,[y(g,{value:r.is_advanced,"onUpdate:value":f[2]||(f[2]=_=>r.is_advanced=_),disabled:r.is_advanced<1,onChange:u},{default:x(()=>[y(h,{value:"1"},{default:x(()=>[...f[6]||(f[6]=[U("开启",-1)])]),_:1}),y(h,{value:"2"},{default:x(()=>[...f[7]||(f[7]=[U("关闭",-1)])]),_:1})]),_:1},8,["value","disabled"])]),f[8]||(f[8]=d("div",{class:"desc"},"多维表格是否已开启高级权限，开关关闭则不更新设置",-1))])])}}},A$=Te(D$,[["__scopeId","data-v-870e11fb"]]),O$={class:"main-box"},N$={key:0,class:"loading-box"},M$={class:"node-options"},T$={class:"options-title"},$$={class:"options-item is-required"},P$={class:"min-input"},R$={class:"field-list-item"},B$={class:"field-label"},L$={class:"field-type"},I$={key:0,class:"options-item is-required"},F$={class:"flex-center min-input"},j$={class:"field-list-item"},V$={class:"field-label"},H$={class:"field-type"},U$={class:"node-options"},z$={class:"options-item"},tp="feishu_bitable",q$={__name:"feishu-bittable-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r={search_records:s6,create_record:JT,update_record:s4,delete_record:f4,create_bitable:T6,create_tables:Y6,create_views:i$,table_add_members:m$,update_advanced:A$},s=G(null),a=G(null),l=G({}),u=G(null),c=Je({app_token:"",table_id:void 0,tag_map:{},table_set_type:"1"}),f=G(!1),p=G(!1),h=G({}),g=G([]),m=G([]),_=Xe(()=>{var V;return((V=l.value)==null?void 0:V[u.value])||{}}),v=G([]);ut(()=>{b()});async function b(){await M(),S(),F()}function C(){a.value.show(l.value)}async function M(V=!1){await bg(tp,V).then(P=>{l.value=P||{};for(let X in l.value)if(l.value[X].is_default){u.value=X;break}u.value||(u.value=Object.keys(l.value)[0])})}function O(){var V;return f.value=!0,h.value={},g.value=[],!zd(c.app_token)||Array.isArray((V=c.tag_map)==null?void 0:V.app_token)&&c.tag_map.app_token.length?(f.value=!1,Promise.resolve(null)):Bo({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_tables",arguments:{app_id:_.value.appid,app_secret:_.value.app_secret,app_token:c.app_token}})}).then(P=>(h.value=(P==null?void 0:P.data)||{},g.value=h.value.items||[],!c.table_id&&g.value.length==1&&(c.table_id=g.value[0].table_id,A()),P)).catch(()=>(h.value={},g.value=[],c.table_set_type==1&&(c.table_id=void 0),m.value=[],null)).finally(()=>{f.value=!1})}function k(){var V,P;return p.value=!0,!zd(c.app_token)||!c.table_id||(P=(V=c.tag_map)==null?void 0:V.table_id)!=null&&P.length?(p.value=!1,Promise.resolve(null)):Bo({name:"feishu_bitable",action:"default/exec",params:JSON.stringify({business:"get_table_fields",arguments:{app_id:_.value.appid,app_secret:_.value.app_secret,app_token:c.app_token,table_id:c.table_id}})}).then(X=>{var H;let oe=((H=X==null?void 0:X.data)==null?void 0:H.items)||[];return m.value=oe.filter(W=>p4.includes(W.ui_type)),X}).finally(()=>{p.value=!1})}function E(V){var P,X,oe;if(!V)return xg(tp,o.actionName);V=JSON.parse(JSON.stringify(V));for(let H in V)switch(H){case"filter":if(Array.isArray(V.filter.conditions)&&V.filter.conditions.length)for(let W of V.filter.conditions)W.field_type==="DateTime"&&W.value&&(W.value<1e11&&(W.value*=1e3),W.value=["ExactDate",W.value].join(","));break;case"fields":for(let W of V.fields)if(!((P=W==null?void 0:W.atTags)!=null&&P.length)){if(W.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(W.ui_type)&&(W.value=Number(W.value)),W.ui_type==="Currency"&&(W.value=W.value.toFixed(2))),W.ui_type==="Checkbox"&&(W.value=W.value=="true"),W.ui_type==="MultiSelect"&&!Array.isArray(W.value))if(typeof W.value=="string"){const Z=W.value.trim();W.value=Z?Z.replace(/，/g,",").split(","):[]}else W.value=[];W.ui_type==="DateTime"&&W.value<1e11&&(W.value*=1e3)}break;case"field_names":V.field_names=V.field_names.map(W=>W.field_name);break;case"sort":V.sort=V.sort.map(W=>({field_name:W.field_name,desc:W.is_asc!=1}));break;case"input_type_map":for(let W in V[H])V[H][W]==2&&(V[W]=Po(V[`${W}_json`],W=="filter"?{}:[]));break}return V.tag_map&&(c.tag_map={...V.tag_map,app_token:((X=c==null?void 0:c.tag_map)==null?void 0:X.app_token)||[],table_id:((oe=c==null?void 0:c.tag_map)==null?void 0:oe.table_id)||[]}),delete V.field_names_json,delete V.filter_json,delete V.sort_json,V}function S(){var X,oe;let V=JSON.parse(o.node.node_params),P=((oe=(X=V==null?void 0:V.plugin)==null?void 0:X.params)==null?void 0:oe.arguments)||{};if(P.table_set_type&&(c.table_set_type=P.table_set_type),P.tag_map&&(c.tag_map=P.tag_map),P.app_token&&(c.app_token=P.app_token),P.table_id&&(c.table_id=P.table_id),P.app_id&&P.app_secret)for(let H in l.value){let W=l.value[H];W.appid==P.app_id&&W.app_secret==P.app_secret&&(u.value=H)}D(V),c.app_token&&!["table_add_members","update_advanced"].includes(o.actionName)&&O(),c.table_id&&k().then(()=>D(V))}function N(){var V,P;c.table_set_type==1?(c.table_id=((P=(V=g.value)==null?void 0:V[0])==null?void 0:P.table_id)||void 0,c.tag_map.table_id=[],m.value=[],k().then(()=>D())):(c.table_id="",m.value=[],o.actionName==="create_record"?D({plugin:{params:{arguments:{fields:[]}}}}):D()),T({fields:[]})}function L(V,P,X){c[V]=P,c.tag_map[V]=X,V==="app_token"?B():V==="table_id"?A():T()}function $(){c.app_token?O().then(()=>D()):D(),c.table_id&&k().then(()=>D()),T()}function B(){const V=c.table_id;m.value=[],O().then(()=>{var X,oe,H,W;const P=g.value.find(Z=>Z.table_id==V);c.table_set_type==2?(c.table_id=V,o.actionName==="create_record"&&typeof((X=s.value)==null?void 0:X.clear)=="function"&&s.value.clear(),o.actionName==="search_records"&&typeof((oe=s.value)==null?void 0:oe.clearSelections)=="function"&&s.value.clearSelections(),D()):P?(c.table_id=V,k().then(()=>{var Z,le;o.actionName==="create_record"?typeof((Z=s.value)==null?void 0:Z.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D(),o.actionName==="search_records"&&typeof((le=s.value)==null?void 0:le.clearSelections)=="function"&&s.value.clearSelections()})):(c.table_id=void 0,o.actionName==="create_record"?typeof((H=s.value)==null?void 0:H.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D(),o.actionName==="search_records"&&typeof((W=s.value)==null?void 0:W.clearSelections)=="function"&&s.value.clearSelections())}).catch(()=>{var P,X,oe;g.value=[],m.value=[],c.table_set_type==1?(c.table_id=void 0,o.actionName==="create_record"?typeof((P=s.value)==null?void 0:P.clear)=="function"&&s.value.clear():o.actionName!=="create_tables"&&o.actionName!=="create_views"&&o.actionName!=="create_bitable"?D({plugin:{params:{arguments:{fields:[]}}}}):D()):o.actionName==="create_record"?typeof((X=s.value)==null?void 0:X.clear)=="function"&&s.value.clear():D(),o.actionName==="search_records"&&typeof((oe=s.value)==null?void 0:oe.clearSelections)=="function"&&s.value.clearSelections()}),T()}function A(){m.value=[],k().then(()=>{T({fields:[]}),D()})}function D(V=null){Pt(()=>{var X;const P=V??JSON.parse(o.node.node_params);typeof((X=s.value)==null?void 0:X.init)=="function"&&s.value.init(P)})}function T(V=null){var le,te;let P=JSON.parse(o.node.node_params),X=g.value.find(q=>q.table_id==c.table_id);const oe=((te=(le=P==null?void 0:P.plugin)==null?void 0:le.params)==null?void 0:te.arguments)||{},H=V?E(V):{},W={...(oe==null?void 0:oe.tag_map)||{},...(H==null?void 0:H.tag_map)||{},...(c==null?void 0:c.tag_map)||{}},Z={...oe,...H,...c,tag_map:W,app_id:_.value.appid,app_secret:_.value.app_secret};P.plugin.output_obj=v.value,P.plugin.params=P.plugin.params||{},P.plugin.params.config_name=u.value,P.plugin.params.table_name=(X==null?void 0:X.name)||"",P.plugin.params.arguments=Z,i({...o.node,node_params:JSON.stringify(P)})}function F(){v.value=Ci(o.action.output)}return(V,P)=>{var Z,le;const X=mo,oe=Vt,H=It,W=Kt;return w(),R("div",O$,[p.value||f.value?(w(),R("div",N$,[y(X)])):ie("",!0),d("div",M$,[d("div",T$,[P[11]||(P[11]=d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")],-1)),Object.keys(l.value).length?(w(),Q(H,{key:0,value:u.value,"onUpdate:value":P[0]||(P[0]=te=>u.value=te),onChange:$},{default:x(()=>[(w(!0),R(ae,null,ye(l.value,te=>(w(),Q(oe,{key:te.name,value:te.name},{default:x(()=>[U(j(te.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(W,{key:1,onClick:C},{default:x(()=>[P[10]||(P[10]=U("未授权 ",-1)),y(K(Ro))]),_:1}))]),n.actionName!="create_bitable"?(w(),R(ae,{key:0},[d("div",$$,[P[12]||(P[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"多维表")],-1)),d("div",P$,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Z=c.tag_map)==null?void 0:Z.app_token)||[],defaultValue:c.app_token,ref:"atInputRef",onOpen:P[1]||(P[1]=te=>t("updateVar")),onChange:P[2]||(P[2]=(te,q)=>L("app_token",te,q)),placeholder:"请输入文档url，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",R$,[d("div",B$,j(te),1),d("div",L$,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),P[13]||(P[13]=d("div",{class:"desc"},"多维表格的唯一标识符，支持输入文档 url",-1))]),["table_add_members","update_advanced","roles_list","create_tables"].includes(n.actionName)?ie("",!0):(w(),R("div",I$,[P[16]||(P[16]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择数据表")],-1)),d("div",F$,[y(H,{value:c.table_set_type,"onUpdate:value":P[3]||(P[3]=te=>c.table_set_type=te),onChange:N,style:{width:"112px","flex-shrink":"0"}},{default:x(()=>[y(oe,{value:"1"},{default:x(()=>[...P[14]||(P[14]=[U("选择数据表",-1)])]),_:1}),y(oe,{value:"2"},{default:x(()=>[...P[15]||(P[15]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value"]),c.table_set_type==1?(w(),Q(H,{key:0,value:c.table_id,"onUpdate:value":P[4]||(P[4]=te=>c.table_id=te),onChange:A,placeholder:c.app_token?"请选择数据表":"请先输入多维表文档url",style:{width:"100%"}},{default:x(()=>[(w(!0),R(ae,null,ye(g.value,te=>(w(),Q(oe,{key:te.table_id,value:te.table_id},{default:x(()=>[U(j(te.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(w(),Q(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((le=c.tag_map)==null?void 0:le.table_id)||[],defaultValue:c.table_id,ref:"atInputRef",onOpen:P[5]||(P[5]=te=>t("updateVar")),onChange:P[6]||(P[6]=(te,q)=>L("table_id",te,q)),placeholder:"请输入表格id，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",j$,[d("div",V$,j(te),1),d("div",H$,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))]),P[17]||(P[17]=d("div",{class:"desc"},"输入表格id，table_id 例如：tblz2wmlWiB1JGxS",-1))]))],64)):ie("",!0),K(qd).includes(n.actionName)?(w(),Q(k6,{key:1,ref_key:"childRef",ref:s,variableOptions:n.variableOptions,actionName:n.actionName,action:n.action,onUpdateVar:P[7]||(P[7]=te=>t("updateVar")),onUpdate:T},null,8,["variableOptions","actionName","action"])):(w(),Q(Pu(r[n.actionName]),{key:2,ref_key:"childRef",ref:s,tableId:c.table_id,fields:m.value,variableOptions:n.variableOptions,config:{..._.value,...c},onUpdate:T,onUpdateVar:P[8]||(P[8]=te=>t("updateVar"))},null,40,["tableId","fields","variableOptions","config"]))]),d("div",U$,[P[18]||(P[18]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",z$,[y(Fi,{"tree-data":v.value},null,8,["tree-data"])])]),y(kw,{ref_key:"configModalRef",ref:a,onChange:P[9]||(P[9]=te=>M(!0))},null,512)])}}},G$=Te(q$,[["__scopeId","data-v-2577d232"]]),X$={class:"node-options"},W$={class:"options-title"},Y$={class:"options-item-tit"},K$={class:"option-label"},J$={class:"option-type"},Z$={class:"field-list-item"},Q$={class:"field-label"},eP={class:"field-type"},tP={class:"desc"},nP={key:0,class:"desc",style:{color:"#FB363F"}},oP={class:"node-options"},iP={class:"options-item"},Vu={__name:"pluginFormRender",props:{node:{type:Object,default:()=>({})},params:{type:Object},output:{type:Object},variableOptions:{type:Array},keepFormatField:{type:Array,default:()=>[]}},emits:["updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=He("setData"),s=Je({}),a=G([]),l=JSON.parse(i.node.node_params),u={url:{label:(_,v)=>(_==null?void 0:_.name)||v,placeholder:"键入/选择参数，或者输入文本，以https:/开头",validate:_=>{if(Array.isArray(_.tags)&&_.tags.length>0)return _.__error=null,!0;const C=String(_.value||"").trim().startsWith("https:/");return _.__error=C?null:"请输入以https:/开头的网址",C}}};gt(s,_=>{g()},{deep:!0}),gt(()=>i.params,_=>{var C,M,O;Object.assign(s,JSON.parse(JSON.stringify(_||"{}")));let v=((M=(C=l==null?void 0:l.plugin)==null?void 0:C.params)==null?void 0:M.arguments)||{},b;for(let k in s)b=v[k]||"",!b&&Object.hasOwn(s[k],"default")&&(b=s[k].default),i.keepFormatField.includes(k)||(b=String(b)),b==="null"&&(b=null),s[k].value=b,s[k].tags=((O=v==null?void 0:v.tag_map)==null?void 0:O[k])||[]},{deep:!0,immediate:!0}),gt(()=>i.output,_=>{a.value=Ci(JSON.parse(JSON.stringify(i.output||"{}")))},{deep:!0,immediate:!0});function c(_,v,b,C){_.value=v,_.tags=b,h(C,_),g()}function f(_,v){const b=u[v];return b&&b.label?b.label(_,v):(_==null?void 0:_.name)||v}function p(_){const v=u[_];return v&&v.placeholder?v.placeholder:"请输入内容，键入“/”可以插入变量"}function h(_,v){const b=u[_];return b&&b.validate?b.validate(v):(v.__error=null,!0)}function g(){var C,M;let _=JSON.parse(i.node.node_params);_.plugin.output_obj=a.value;let v={tag_map:{}},b;for(let O in s)b=s[O].value,(M=(C=s[O])==null?void 0:C.tags)!=null&&M.length||(s[O].type=="string"?b=String(b):["number","integer"].includes(s[O].type)&&(b=Number(b))),v[O]=b,v.tag_map[O]=s[O].tags;Object.assign(_.plugin.params,{arguments:{...v}}),r({...i.node,node_params:JSON.stringify(_)})}function m(_={}){Object.assign(s,_),g()}return e({setState:m}),(_,v)=>(w(),R("div",null,[d("div",X$,[d("div",W$,[v[1]||(v[1]=d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")],-1)),gi(_.$slots,"input-title-extra")]),(w(!0),R(ae,null,ye(s,(b,C)=>(w(),R(ae,{key:C},[_.$slots[C]?gi(_.$slots,C,{key:0,state:s,item:b,keyName:C}):(w(),R("div",{key:1,class:Ct(["options-item",{"is-required":b.required}])},[d("div",Y$,[d("div",K$,j(f(b,C)),1),d("div",J$,j(b.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:b.tags,defaultValue:b.value,ref_for:!0,ref:"atInputRef",onOpen:v[0]||(v[0]=M=>o("updateVar")),onChange:(M,O)=>c(b,M,O,C),placeholder:p(C)},{option:x(({label:M,payload:O})=>[d("div",Z$,[d("div",Q$,j(M),1),d("div",eP,j(O.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])]),d("div",tP,j(b.desc),1),b.__error?(w(),R("div",nP,j(b.__error),1)):ie("",!0)],2))],64))),128))]),d("div",oP,[v[2]||(v[2]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",iP,[y(Fi,{"tree-data":a.value},null,8,["tree-data"])])])]))}},rP={class:"options-item is-required"},sP={class:"options-item is-required"},aP={class:"options-item-tit"},lP={class:"tag-box"},uP={class:"field-list-item"},dP={class:"field-label"},cP={class:"field-type"},fP={__name:"official-account-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=G([]),r=G([]),s=G({}),a=G(!1),l=G({app_id:"",app_secret:""});ut(()=>{var b,C,M;if(c(),u(),o.actionName==="getTagFans"){let O=Po((b=o.node)==null?void 0:b.node_params);if(O){let k=((M=(C=O==null?void 0:O.plugin)==null?void 0:C.params)==null?void 0:M.arguments)||{};const{app_id:E,app_secret:S}=k;E&&S&&(l.value={app_id:E,app_secret:S},p())}}});function u(){const b={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};o.actionName==="getTagFans"?(Object.assign(b,{tagid:{...o.action.params.tagid,default:null},tag_name:{desc:"标签名称",type:"string"},tag_type:{desc:"标签类型",type:"number",default:1}}),s.value=Wc(b,["app_id","tagid"])):s.value=b}function c(){Rr({app_type:"official_account"}).then(b=>{i.value=(b==null?void 0:b.data)||[]})}function f(){if(!l.value.app_secret||!l.value.app_id)return xt.warning("请先选择公众号");a.value||(a.value=!0,p().then(()=>{xt.success("同步完成")}).finally(()=>{a.value=!1}))}function p(){return Bo({name:"official_account_profile",action:"default/exec",params:JSON.stringify({business:"getTags",arguments:l.value})}).then(b=>{var C;return r.value=((C=b==null?void 0:b.data)==null?void 0:C.tags)||[],b})}function h(b,C){b.app_secret.value=C.secret,b.app_name.value=C.name,o.actionName==="getTagFans"&&(l.value={app_id:C.key,app_secret:C.secret},p())}function g(b){b.tag_name.value="",b.tag_type.value==1?b.tagid.value=null:b.tagid.value=""}function m(b,C,M){b.tag_name.value=M.name}function _(b,C,M){b.value=C,b.tags=M}const v=(b,C)=>C.name.toLowerCase().indexOf(b.toLowerCase())>=0;return(b,C)=>{const M=Vt,O=It,k=mo,E=Qt;return w(),Q(Vu,{node:n.node,params:s.value,output:n.action.output,variableOptions:n.variableOptions,keepFormatField:["tagid","tag_type"],onUpdateVar:C[1]||(C[1]=S=>t("updateVar"))},{tag_name:x(()=>[...C[2]||(C[2]=[])]),tag_type:x(()=>[...C[3]||(C[3]=[])]),app_name:x(()=>[...C[4]||(C[4]=[])]),app_secret:x(()=>[...C[5]||(C[5]=[])]),app_id:x(({state:S,item:N,keyName:L})=>[d("div",rP,[C[6]||(C[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(O,{value:N.value,"onUpdate:value":$=>N.value=$,placeholder:"请选择公众号",style:{width:"100%"},onChange:($,B)=>h(S,B)},{default:x(()=>[(w(!0),R(ae,null,ye(i.value,$=>(w(),Q(M,{key:$.app_id,value:$.app_id,name:$.app_name,secret:$.app_secret},{default:x(()=>[U(j($.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])])])]),tagid:x(({state:S,item:N,keyName:L})=>[d("div",sP,[d("div",aP,[C[8]||(C[8]=d("div",{class:"option-label"},"公众号标签",-1)),y(E,{title:"同步最新的公众号标签"},{default:x(()=>[d("a",{onClick:f},[C[7]||(C[7]=U("同步 ",-1)),a.value?(w(),Q(k,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",lP,[y(O,{value:S.tag_type.value,"onUpdate:value":$=>S.tag_type.value=$,onChange:$=>g(S),style:{width:"120px"}},{default:x(()=>[y(M,{value:1},{default:x(()=>[...C[9]||(C[9]=[U("选择标签",-1)])]),_:1}),y(M,{value:2},{default:x(()=>[...C[10]||(C[10]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onUpdate:value","onChange"]),S.tag_type.value==1?(w(),Q(O,{key:0,value:N.value,"onUpdate:value":$=>N.value=$,placeholder:"请选择标签","show-search":"","filter-option":v,style:{width:"100%"},onChange:($,B)=>m(S,$,B)},{default:x(()=>[(w(!0),R(ae,null,ye(r.value,$=>(w(),Q(M,{key:$.id,value:$.id,name:$.name},{default:x(()=>[U(j($.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):(w(),Q(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:N.tags||[],defaultValue:N.value,ref:"atInputRef",onOpen:C[0]||(C[0]=$=>t("updateVar")),onChange:($,B)=>_(N,$,B),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:$,payload:B})=>[d("div",uP,[d("div",dP,j($),1),d("div",cP,j(B.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))])])]),_:1},8,["node","params","output","variableOptions"])}}},pP=Te(fP,[["__scopeId","data-v-3fb4ac5a"]]),hP={class:"tpl-container"},vP={class:"node-options"},gP={class:"options-item is-required"},_P={class:"options-item is-required"},mP={class:"options-item-tit"},yP={class:"options-item is-required"},bP={class:"field-list-item"},xP={class:"field-label"},wP={class:"field-type"},CP={class:"options-item-tit"},SP={class:"option-label"},kP={class:"field-list-item"},EP={class:"field-label"},DP={class:"field-type"},AP={class:"options-item is-required"},OP={key:0,class:"options-item is-required"},NP={class:"field-list-item"},MP={class:"field-label"},TP={class:"field-type"},$P={class:"options-item is-required"},PP={class:"field-list-item"},RP={class:"field-label"},BP={class:"field-type"},LP={class:"options-item is-required"},IP={class:"field-list-item"},FP={class:"field-label"},jP={class:"field-type"},VP={class:"node-options"},HP={class:"options-item"},UP="official_send_template_message",zP={__name:"official-template-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=G([]),s=G([]),a=G(!1),l=G([]),u=Je({app_id:void 0,template_id:void 0,app_secret:"",touser:"",url:"",data:{},miniprogram:{appid:{value:"",tags:[]},pagepath:{value:"",tags:[]}},link_type:0,tag_map:{}}),c={thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20个以内字符,可汉字、数字、字母或符号组合"},short_thing:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,5}$/,txt:"5个以内字符,可汉字、数字、字母或符号组合"},number:{reg:/^\d{1,32}(.\d{1,2})?$/,txt:"32位以内数字,只能数字，可带小数"},const:{reg:/^[\u4e00-\u9fa5a-zA-Z0-9\W_]{1,20}$/,txt:"20位以内字符，超过无法下发注"},letter:{reg:/^[a-zA-Z]{1,32}$/,txt:"32位以内字母，只能字母"},symbol:{reg:/^[\W_]{1,5}$/,txt:"5位以内符号，只能符号"},character_string:{reg:/^[a-zA-Z0-9\W_]{1,32}$/,txt:"32位以内数字、字母或符号，可数字、字母或符号组合"},time:{reg:/^\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"24小时制时间格式（支持+年月日），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},date:{reg:/^\d{4}年\d{1,2}月\d{1,2}日(\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?(~\d{4}年\d{1,2}月\d{1,2}日\s+\d{1,2}:\d{1,2}(:\d{1,2})?)?$/,txt:"年月日格式（支持+24小时制时间），支持填时间段，两个时间点之间用“~”符号连接 例如：2019年10月1日 15:01~2019年10月1日 18:01"},amount:{reg:/^[$¥]?\d{1,10}(.\d{1,2})?[元]?$/,txt:"金额，1个币种符号+10位以内纯数字，可带小数，结尾可带“元”	可带小数 例如：¥200元、$200"},phone_number:{reg:/^[0-9-+*# ]{5,17}$/,txt:"电话，17位以内，数字、符号"},car_number:{reg:/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[a-zA-Z0-9]{6,7}[\u4e00-\u9fa5]{0,1}$/,txt:"车牌，8位以内，第一位与最后一位可为汉字，其余为字母或数字"},name:{reg:/^(?:[\u4e00-\u9fa5]{1,10}|[a-zA-Z\p{P}]{1,20})$/,txt:"10个以内纯汉字或20个以内纯字母或符号"},phrase:{reg:/^[\u4e00-\u9fa5]{1,5}$/,txt:"汉字，5个以内汉字"}};ut(()=>{f()}),gt(()=>o.action,()=>{var S;r.value=Ci(JSON.parse(JSON.stringify(((S=o.action)==null?void 0:S.output)||"{}")))},{deep:!0,immediate:!0});function f(){p(),h()}function p(){Rr({app_type:"official_account"}).then(S=>{s.value=(S==null?void 0:S.data)||[]})}function h(){var L,$;let S=JSON.parse(o.node.node_params),N=(($=(L=S==null?void 0:S.plugin)==null?void 0:L.params)==null?void 0:$.arguments)||{};Object.assign(u,N),u.template_id&&v()}function g(S,N){const{key:L,secret:$,name:B}=N;u.app_secret=$,u.app_name=B,v()}function m(S,N){const{name:L,content:$}=N;u.template_name=L,u.data=k($)}function _(){if(!u.app_secret||!u.app_id)return xt.warning("请先选择公众号");a.value||(a.value=!0,v().then(()=>{xt.success("同步完成")}).finally(()=>{a.value=!1}))}function v(){return Bo({name:UP,action:"default/exec",params:JSON.stringify({business:"getAllTemplates",arguments:{app_id:u.app_id,app_secret:u.app_secret}})}).then(S=>{var N;l.value=((N=S==null?void 0:S.data)==null?void 0:N.template_list)||[]})}function b(S,N,L,$=null){S.value=N,S.tags=L,$&&(L.length?S.format_err=!1:E($,S)),O()}function C(S,N,L){u[S]=N,u.tag_map[S]=L,O()}function M(){switch(u.link_type){case 0:u.miniprogram.appid={value:"",tags:[]},u.miniprogram.pagepath={value:"",tags:[]},u.url="";break;case 1:u.miniprogram.appid={value:"",tags:[]},u.miniprogram.pagepath={value:"",tags:[]};break;case 2:u.url="";break}O()}function O(){let S=JSON.parse(o.node.node_params);S.plugin.output_obj=r.value,Object.assign(S.plugin.params,{arguments:{...u}}),i({...o.node,node_params:JSON.stringify(S)})}function k(S){var $;const N={},L=S.split(`
`).map(B=>B.trim()).filter(Boolean);for(const B of L){let A=B.match(/^(.*?):\s*\{\{([\w]+)\.DATA\}\}$/);if(A){let D=A[2].replace(/\d/g,"");N[A[2]]={title:A[1],value:"",tags:[],desc:(($=c[D])==null?void 0:$.txt)||"",format_err:!1};continue}if(A=B.match(/^\{\{([\w]+)\.DATA\}\}$/),A){N[A[1]]={title:A[1],value:"",tags:[]};continue}}return N}function E(S,N){let L=S.replace(/\d/g,"");c[L]&&!c[L].reg.test(N.value)?N.format_err=!0:N.format_err=!1}return(S,N)=>{var F,V;const L=Vt,$=It,B=mo,A=Qt,D=Ii,T=Li;return w(),R("div",hP,[d("div",vP,[N[25]||(N[25]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),d("div",gP,[N[12]||(N[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y($,{value:u.app_id,"onUpdate:value":N[0]||(N[0]=P=>u.app_id=P),placeholder:"请选择公众号",style:{width:"100%"},onChange:g},{default:x(()=>[(w(!0),R(ae,null,ye(s.value,P=>(w(),Q(L,{key:P.app_id,name:P.app_name,secret:P.app_secret},{default:x(()=>[U(j(P.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",_P,[d("div",mP,[N[14]||(N[14]=d("div",{class:"option-label"},"公众号模板",-1)),y(A,{title:"同步最新的公众号模板"},{default:x(()=>[d("a",{onClick:_},[N[13]||(N[13]=U("同步 ",-1)),a.value?(w(),Q(B,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",null,[y($,{value:u.template_id,"onUpdate:value":N[1]||(N[1]=P=>u.template_id=P),placeholder:"请选择模板",style:{width:"100%"},onChange:m},{default:x(()=>[(w(!0),R(ae,null,ye(l.value,P=>(w(),Q(L,{key:P.template_id,name:P.title,content:P.content},{default:x(()=>[U(j(P.title),1)]),_:2},1032,["name","content"]))),128))]),_:1},8,["value"])])]),d("div",yP,[N[15]||(N[15]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"接收者（用户）openid"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",options:n.variableOptions,defaultSelectedList:((F=u.tag_map)==null?void 0:F.touser)||[],defaultValue:u.touser,ref:"atInputRef",onOpen:N[2]||(N[2]=P=>t("updateVar")),onChange:N[3]||(N[3]=(P,X)=>C("touser",P,X)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:P,payload:X})=>[d("div",bP,[d("div",xP,j(P),1),d("div",wP,j(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),N[16]||(N[16]=d("div",{class:"desc"},"普通用户的标识，对当前公众号唯一",-1))]),(w(!0),R(ae,null,ye(u.data,(P,X)=>(w(),R("div",{class:"options-item is-required",key:X},[d("div",CP,[d("div",SP,j(P.title),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:P.tags,defaultValue:P.value,ref_for:!0,ref:"atInputRef",onOpen:N[4]||(N[4]=oe=>t("updateVar")),onChange:(oe,H)=>b(P,oe,H,X),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:oe,payload:H})=>[d("div",kP,[d("div",EP,j(oe),1),d("div",DP,j(H.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),P.desc?(w(),R("div",{key:0,class:Ct(["desc",{error:P.format_err}])},j(P.desc),3)):ie("",!0)]))),128)),d("div",AP,[N[20]||(N[20]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"跳转方式")],-1)),d("div",null,[y(T,{value:u.link_type,"onUpdate:value":N[5]||(N[5]=P=>u.link_type=P),onChange:M},{default:x(()=>[y(D,{value:0},{default:x(()=>[...N[17]||(N[17]=[U("不跳转",-1)])]),_:1}),y(D,{value:1},{default:x(()=>[...N[18]||(N[18]=[U("链接",-1)])]),_:1}),y(D,{value:2},{default:x(()=>[...N[19]||(N[19]=[U("小程序",-1)])]),_:1})]),_:1},8,["value"])])]),u.link_type==1?(w(),R("div",OP,[N[21]||(N[21]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"链接")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((V=u.tag_map)==null?void 0:V.url)||[],defaultValue:u.url,ref:"atInputRef",onOpen:N[6]||(N[6]=P=>t("updateVar")),onChange:N[7]||(N[7]=(P,X)=>C("url",P,X)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:P,payload:X})=>[d("div",NP,[d("div",MP,j(P),1),d("div",TP,j(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])):u.link_type==2?(w(),R(ae,{key:1},[d("div",$P,[N[22]||(N[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"小程序APPID")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:u.miniprogram.appid.value,defaultSelectedList:u.miniprogram.appid.tags,ref:"atInputRef",onOpen:N[8]||(N[8]=P=>t("updateVar")),onChange:N[9]||(N[9]=(P,X)=>b(u.miniprogram.appid,P,X)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:P,payload:X})=>[d("div",PP,[d("div",RP,j(P),1),d("div",BP,j(X.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])]),N[23]||(N[23]=d("div",{class:"desc"},"小程序appid必须与发模板消息的公众号是关联关系",-1))]),d("div",LP,[N[24]||(N[24]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"小程序路径")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultValue:u.miniprogram.pagepath.value,defaultSelectedList:u.miniprogram.pagepath.tags,ref:"atInputRef",onOpen:N[10]||(N[10]=P=>t("updateVar")),onChange:N[11]||(N[11]=(P,X)=>b(u.miniprogram.pagepath,P,X)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:P,payload:X})=>[d("div",IP,[d("div",FP,j(P),1),d("div",jP,j(X.typ),1)])]),_:1},8,["options","defaultValue","defaultSelectedList"])])])],64)):ie("",!0)]),d("div",VP,[N[26]||(N[26]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",HP,[y(Fi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},qP=Te(zP,[["__scopeId","data-v-13e1d9be"]]),GP={class:"tag-container"},XP={class:"node-options"},WP={class:"options-item is-required"},YP={class:"options-item is-required"},KP={class:"options-item-tit"},JP={class:"tag-box"},ZP={class:"field-list-item"},QP={class:"field-label"},eR={class:"field-type"},tR={class:"options-item is-required"},nR={class:"field-list-item"},oR={class:"field-label"},iR={class:"field-type"},rR={class:"node-options"},sR={class:"options-item"},aR="official_batch_tag",lR={__name:"official-tag-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=G([]),s=G([]),a=G([]),l=Je({app_id:void 0,app_secret:"",openid_list:"",tagid:"",tag_type:1,tag_name:1,tag_map:{}}),u=G(!1);ut(()=>{c()}),gt(()=>o.action,()=>{var O;r.value=Ci(JSON.parse(JSON.stringify(((O=o.action)==null?void 0:O.output)||"{}")))},{deep:!0,immediate:!0});function c(){f(),p()}function f(){Rr({app_type:"official_account"}).then(O=>{s.value=(O==null?void 0:O.data)||[]})}function p(){var E,S;let O=JSON.parse(o.node.node_params),k=((S=(E=O==null?void 0:O.plugin)==null?void 0:E.params)==null?void 0:S.arguments)||{};Object.assign(l,k),l.tagid&&(l.tagid>0?l.tag_type=1:l.tag_type=2,m())}function h(O,k){const{key:E,secret:S,name:N}=k;l.app_secret=S,l.app_name=N,m()}function g(){if(!l.app_secret||!l.app_id)return xt.warning("请先选择公众号");u.value||(u.value=!0,m().then(()=>{xt.success("同步完成")}).finally(()=>{u.value=!1}))}function m(){return Bo({name:aR,action:"default/exec",params:JSON.stringify({business:"getTags",arguments:{app_id:l.app_id,app_secret:l.app_secret}})}).then(O=>{var k;return a.value=((k=O==null?void 0:O.data)==null?void 0:k.tags)||[],O})}function _(O,k,E){O==="openid_list"&&(k=k.trim(),k=k.replace(/，/g,",")),l[O]=k,l.tag_map[O]=E,C()}function v(O,k){l.tag_name=k.name,C()}function b(){l.tag_name="",l.tag_type==1?l.tagid=null:l.tagid=""}function C(){let O=JSON.parse(o.node.node_params);O.plugin.output_obj=r.value,Object.assign(O.plugin.params,{arguments:{...l}}),i({...o.node,node_params:JSON.stringify(O)})}const M=(O,k)=>k.name.toLowerCase().indexOf(O.toLowerCase())>=0;return(O,k)=>{var $,B;const E=Vt,S=It,N=mo,L=Qt;return w(),R("div",GP,[d("div",XP,[k[14]||(k[14]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),d("div",WP,[k[7]||(k[7]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(S,{value:l.app_id,"onUpdate:value":k[0]||(k[0]=A=>l.app_id=A),placeholder:"请选择公众号",style:{width:"100%"},onChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(s.value,A=>(w(),Q(E,{key:A.app_id,name:A.app_name,secret:A.app_secret},{default:x(()=>[U(j(A.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",YP,[d("div",KP,[k[9]||(k[9]=d("div",{class:"option-label"},"公众号标签",-1)),y(L,{title:"同步最新的公众号标签"},{default:x(()=>[d("a",{onClick:g},[k[8]||(k[8]=U("同步 ",-1)),u.value?(w(),Q(N,{key:0,size:"small"})):ie("",!0)])]),_:1})]),d("div",JP,[y(S,{value:l.tag_type,"onUpdate:value":k[1]||(k[1]=A=>l.tag_type=A),onChange:b,style:{width:"120px"}},{default:x(()=>[y(E,{value:1},{default:x(()=>[...k[10]||(k[10]=[U("选择标签",-1)])]),_:1}),y(E,{value:2},{default:x(()=>[...k[11]||(k[11]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value"]),l.tag_type==1?(w(),Q(S,{key:0,value:l.tagid,"onUpdate:value":k[2]||(k[2]=A=>l.tagid=A),placeholder:"请选择标签",style:{width:"100%"},onChange:v,"show-search":"","filter-option":M},{default:x(()=>[(w(!0),R(ae,null,ye(a.value,A=>(w(),Q(E,{key:A.id,value:A.id,name:A.name},{default:x(()=>[U(j(A.name),1)]),_:2},1032,["value","name"]))),128))]),_:1},8,["value"])):(w(),Q(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:(($=l.tag_map)==null?void 0:$.tagid)||[],defaultValue:l.tagid,ref:"atInputRef",onOpen:k[3]||(k[3]=A=>t("updateVar")),onChange:k[4]||(k[4]=(A,D)=>_("tagid",A,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:A,payload:D})=>[d("div",ZP,[d("div",QP,j(A),1),d("div",eR,j(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),d("div",tR,[k[12]||(k[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"粉丝openid列表"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:((B=l.tag_map)==null?void 0:B.openid_list)||[],defaultValue:l.openid_list,ref:"atInputRef",onOpen:k[5]||(k[5]=A=>t("updateVar")),onChange:k[6]||(k[6]=(A,D)=>_("openid_list",A,D)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:A,payload:D})=>[d("div",nR,[d("div",oR,j(A),1),d("div",iR,j(D.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),k[13]||(k[13]=d("div",{class:"desc"},"粉丝openid列表，最多50个，逗号分割",-1))])]),d("div",rR,[k[15]||(k[15]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",sR,[y(Fi,{"tree-data":r.value},null,8,["tree-data"])])])])}}},uR=Te(lR,[["__scopeId","data-v-90b0cfa9"]]),dR={class:"field-list-row"},cR={key:0,class:"field-list-col field-list-col-head field-value-head"},fR={key:1,class:"field-list-col field-list-col-head field-del-head"},pR={key:0,class:"field-list-row"},hR={class:"field-list-col field-value-col"},vR={class:"field-list-col field-name-col"},gR={key:0,style:{color:"#FB363F","margin-right":"2px"}},_R={class:"field-list-col field-type-col"},mR={key:0,class:"field-list-col field-value-col"},yR={key:0,class:"field-value-inline"},bR={class:"inline-input"},xR={key:2,style:{color:"#FB363F","margin-top":"4px"}},wR={key:1,class:"field-list-col field-del-col"},CR=["onClick"],SR={__name:"index",props:{showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},msgtype:{type:String,default:""}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=He("getNode"),s=Je({list:[],keys:[]}),a=Xe(()=>s.list.some(E=>b(E)));function l(){const E=String(i.msgtype||"").toLowerCase();return E==="link"?"imageText":E==="miniprogrampage"?"card":["text","image","url"].includes(E)?E:"text"}const u={imageText:{url:{required:!0,validator:E=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(E||""))?!0:/^https?:\/\//.test(String(E||"")),validationTip:"链接需以http或https开头",functionalTip:"跳转到外链，支持插入变量，链接需以http或https开头。"},title:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请输入标题",functionalTip:"展示在链接卡片的标题位置"},description:{required:!0,validator:E=>String(E||"").trim().length>0&&String(E||"").length<=300,validationTip:"请输入描述，最多300字",functionalTip:"展示在链接卡片的描述位置"},thumb_url:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请上传链接图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},text:{content:{required:!0,validator:E=>String(E||"").trim().length>0&&String(E||"").length<=300,validationTip:"请输入文本内容，最多300字",functionalTip:"支持插入变量，最多300字"}},image:{thumb_url:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请上传图片",functionalTip:"支持png/jpg/jpeg，建议≤2M"}},url:{title:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请输入标题",functionalTip:"展示在卡片标题位置"},url:{required:!0,validator:E=>/^【([a-f0-9]{32}\.)?[a-zA-Z_][a-zA-Z0-9_\-.]*】$/.test(String(E||""))?!0:/^https?:\/\//.test(String(E||"")),validationTip:"链接需以http或https开头",functionalTip:"点击后跳转的链接，链接需以http或https开头。"}},card:{title:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请输入小程序标题",functionalTip:"展示在卡片标题位置"},appid:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请输入小程序appID",functionalTip:"小程序右上角>名字>更多资料>AppID；公众号需与小程序关联"},page_path:{required:!0,validator:E=>/^\//.test(String(E||"")),validationTip:"请输入以/开头的小程序路径",functionalTip:"向开发者获取路径，如/pages/index/index"},thumb_url:{required:!0,validator:E=>!!String(E||"").trim(),validationTip:"请上传小程序封面",functionalTip:"支持png/jpg/jpeg，建议≤2M"}}};function c(){const E=l(),S=u[E]||{};s.list.forEach((N,L)=>{var F;const $=(N.field_name||"").toLowerCase(),B=S[$]||{};let A={};(typeof N.description<"u"||typeof N.desc<"u"||typeof N.required<"u")&&(A={functionalTip:N.description||N.desc,required:N.required});let D={};if(b(N)){const V=(F=N.properties)==null?void 0:F[N.current_properties_key];V&&(typeof V.description<"u"||typeof V.desc<"u"||typeof V.required<"u")&&(D={functionalTip:V.description||V.desc,required:V.required})}const T={functionalTip:D.functionalTip??A.functionalTip??B.functionalTip??"",required:!!(D.required??A.required??B.required??N.required)};s.list[L].__functionalTip=T.functionalTip,s.list[L].__required=!!T.required,s.list[L].__error=null})}function f(E){var D,T,F,V,P;const S=l(),N=u[S]||{},L=(E.field_name||"").toLowerCase();let $=N[L];if(!$&&b(E)){const X=(D=E.properties)==null?void 0:D[E.current_properties_key];X&&($={required:!!X.required})}const B=b(E)?((F=(T=E.properties)==null?void 0:T[E.current_properties_key])==null?void 0:F.value)??"":E.value;if(!$)return E.__error=null,!0;const A=b(E)?((P=(V=E.properties)==null?void 0:V[E.current_properties_key])==null?void 0:P.atTags)??[]:E.atTags;return $.required&&!String(B||"").trim()&&(!Array.isArray(A)||A.length===0)||$.validator&&!$.validator(B)?(E.__error=$.validationTip,!1):(E.__error=null,!0)}gt(()=>i.list,E=>{s.list=E,s.keys=E.map(S=>S.field_name),s.list.forEach(M),c()},{immediate:!0});const p=G([]),h=()=>{let E=r().getAllParentVariable();p.value=E||[]},g=()=>{h()},m=(E,S,N,L)=>{if(b(N)){const $=N.current_properties_key;N.properties[$]||(N.properties[$]={}),N.properties[$].value=E,N.properties[$].atTags=S}else s.list[L].value=E,s.list[L].atTags=S;v()},_=E=>{s.list.splice(E,1),v()},v=()=>{s.keys=s.list.map(E=>E.field_name),o("change",[...s.list],[...s.keys])};ut(()=>{h()});function b(E){return E.media_component}function C(E,S){var L;const N=(L=E.properties)==null?void 0:L[S];E.current_properties_key=S,E.ui_type=O(N==null?void 0:N.type),E.__functionalTip=(N==null?void 0:N.desc)||"",E.__required=!!(N!=null&&N.required),E.properties[S]||(E.properties[S]={}),E.properties[S].value=E.properties[S].value??"",E.properties[S].atTags=E.properties[S].atTags??[],v()}function M(E){if(!b(E))return;const S=Object.keys(E.properties);if(!E.current_properties_key){const N=S[0];C(E,N)}}function O(E){switch((E||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return E||"Text"}}function k(){let E=!0;const S=[];return s.list.forEach(N=>{var L;if(!f(N)){E=!1;const $=b(N)?((L=N.properties)==null?void 0:L[N.current_properties_key])||{}:null;S.push({field_name:($==null?void 0:$.name)||N.name||N.field_name,message:($==null?void 0:$.error)||N.__error,functionalTip:($==null?void 0:$.desc)||N.__functionalTip})}}),{ok:E,errors:S}}return e({validateAll:k}),(E,S)=>{const N=ln,L=Qt,$=Vt,B=It,A=Nn;return w(),R("div",null,[d("div",{class:Ct(["field-list",{"wide-value-col":a.value}])},[d("div",dR,[S[0]||(S[0]=d("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),S[1]||(S[1]=d("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),n.showInput?(w(),R("div",cR,"字段值")):ie("",!0),i.showDelete?(w(),R("div",fR)):ie("",!0)]),n.showEmptyFieldRow?(w(),R("div",pR,[S[2]||(S[2]=d("div",{class:"field-list-col field-name-col"},"--",-1)),S[3]||(S[3]=d("div",{class:"field-list-col field-type-col"},"--",-1)),d("div",hR,[y(L,{title:"请先选择数据库"},{default:x(()=>[y(N,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):ie("",!0),(w(!0),R(ae,null,ye(s.list,(D,T)=>{var F,V,P,X,oe,H;return w(),R("div",{class:"field-list-row",key:D.field_name},[d("div",vR,[D.__required?(w(),R("span",gR,"*")):ie("",!0),U(" "+j(((V=(F=D.properties)==null?void 0:F[D.current_properties_key])==null?void 0:V.name)||D.name)+" ",1),D.__functionalTip?(w(),Q(L,{key:1,title:D.__functionalTip},{default:x(()=>[y(K(mt),{style:{cursor:"pointer"}})]),_:1},8,["title"])):ie("",!0)]),d("div",_R,j(D.ui_type),1),n.showInput?(w(),R("div",mR,[b(D)?(w(),R("div",yR,[y(B,{value:D.current_properties_key,"onUpdate:value":W=>D.current_properties_key=W,onChange:W=>C(D,W)},{default:x(()=>[(w(!0),R(ae,null,ye(D.properties||{},(W,Z)=>(w(),Q($,{key:Z,value:Z},{default:x(()=>[U(j(W.name||Z),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"]),d("div",bR,[y(ot,{options:p.value,defaultValue:((X=(P=D.properties)==null?void 0:P[D.current_properties_key])==null?void 0:X.value)??"",defaultSelectedList:((H=(oe=D.properties)==null?void 0:oe[D.current_properties_key])==null?void 0:H.atTags)??[],onOpen:g,onChange:(W,Z)=>m(W,Z,D,T),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):(w(),Q(ot,{key:1,options:p.value,defaultValue:D.value,defaultSelectedList:D.atTags,onOpen:g,onChange:(W,Z)=>m(W,Z,D,T),placeholder:'请输入参数，键入"/"插入变量'},null,8,["options","defaultValue","defaultSelectedList","onChange"])),D.__error?(w(),R("div",xR,j(D.__error),1)):ie("",!0)])):ie("",!0),i.showDelete?(w(),R("div",wR,[d("span",{class:"del-btn",onClick:W=>_(T)},[y(A,{class:"del-icon",name:"close-circle"})],8,CR)])):ie("",!0)])}),128))],2)])}}},kR=Te(SR,[["__scopeId","data-v-f8a681e7"]]),ER={class:"add-data-form"},DR={class:"node-box-content"},AR={class:"setting-box"},OR={__name:"reply-data",props:{tableId:{type:[String,Number]},fields:{type:Array,default:()=>[]}},emits:["update"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=G([]),s=G(null);function a(f=null){var p,h,g;r.value=[],Array.isArray((g=(h=(p=f==null?void 0:f.plugin)==null?void 0:p.params)==null?void 0:h.arguments)==null?void 0:g.fields)&&f.plugin.params.arguments.fields.length?(f.plugin.params.arguments.fields.map(m=>{m.value=m.value.toString()}),r.value=f.plugin.params.arguments.fields):i.fields.map(m=>{r.value.push({value:"",atTags:[],...m})})}const l=f=>{r.value=f,u()},u=()=>{o("update",{fields:Bn(r.value)})};function c(){var f,p;return(p=(f=s.value)==null?void 0:f.validateAll)==null?void 0:p.call(f)}return e({init:a,validateAll:c}),(f,p)=>(w(),R("div",ER,[d("div",DR,[p[0]||(p[0]=d("div",{class:"setting-label"},[d("span",null,"回复内容"),d("span",{class:"tip"},"（不填写字段值则为空）")],-1)),d("div",AR,[y(kR,{ref_key:"fieldRef",ref:s,showEmptyFieldRow:!n.tableId,list:r.value,fields:n.fields,msgtype:n.tableId,showAdd:!1,showDelete:!1,onChange:l},null,8,["showEmptyFieldRow","list","fields","msgtype"])])])]))}},NR=Te(OR,[["__scopeId","data-v-8c782d57"]]),MR={class:"main-box"},TR={key:0,class:"loading-box"},$R={class:"node-options"},PR={class:"options-item is-required"},RR={class:"options-item is-required"},BR={class:"options-item-tit"},LR={class:"option-label"},IR={class:"field-list-item"},FR={class:"field-label"},jR={class:"field-type"},VR={class:"options-item is-required"},HR={class:"node-options"},UR={class:"options-item"},np="official_send_message",zR={__name:"official-send-message-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=G(null),s=Je({app_id:null,msgtype:void 0,receiver:"",receiver_tags:[],app_secret:"",app_name:""}),a=G(!1),l=G(!1),u=G({}),c=G([]),f=G([]),p=G([]),h=G([]);ut(()=>{g(),cs({name:"workflow:validate",callback:S})});async function g(){await m(),M(),$()}function m(){return Rr({app_type:"official_account"}).then(B=>{c.value=(B==null?void 0:B.data)||[]})}function _(){return a.value=!0,Bo({name:np,action:"default/exec",params:JSON.stringify({business:"getMsgType",arguments:{app_id:s.app_id}})}).then(B=>(u.value=(B==null?void 0:B.data)||{},f.value=u.value.items||[],!s.msgtype&&f.value.length==1&&(s.msgtype=f.value[0].msgtype,k()),B)).finally(()=>{a.value=!1})}function v(){return l.value=!0,Bo({name:np,action:"default/exec",params:JSON.stringify({business:"getMsgInput",arguments:{app_id:s.app_id,app_secret:s.app_secret,msgtype:s.msgtype}})}).then(B=>{var D;let A=((D=B==null?void 0:B.data)==null?void 0:D.items)||[];return p.value=A.map(T=>({field_name:T.field||T.name,ui_type:b(T.type),name:T.name,description:T.desc,required:!!T.required,media_component:!!T.media_component,properties:T.properties||null})),B}).finally(()=>{l.value=!1})}function b(B){switch((B||"").toLowerCase()){case"string":return"Text";case"number":return"Number";case"integer":return"Number";case"boolean":return"Checkbox";case"array<string>":return"MultiSelect";default:return B||"Text"}}function C(B){if(!B)return xg(o.actionName);B=JSON.parse(JSON.stringify(B));for(let A in B)switch(A){case"filter":if(Array.isArray(B.filter.conditions)&&B.filter.conditions.length)for(let D of B.filter.conditions)D.field_type==="DateTime"&&D.value&&(D.value<1e11&&(D.value*=1e3),D.value=["ExactDate",D.value].join(","));break;case"fields":for(let D of B.fields)D.value!=""&&(["DateTime","Number","Rating","Progress","Currency"].includes(D.ui_type)&&(D.value=Number(D.value)),D.ui_type==="Currency"&&(D.value=D.value.toFixed(2))),D.ui_type==="Checkbox"&&(D.value=D.value=="true"),D.ui_type==="MultiSelect"&&(D.value=D.value.replace(/，/g,",").split(",")),D.ui_type==="DateTime"&&D.value<1e11&&(D.value*=1e3);break;case"field_names":B.field_names=B.field_names.map(D=>D.field_name);break;case"sort":B.sort=B.sort.map(D=>({field_name:D.field_name,desc:D.is_asc!=1}));break}return B}function M(){var D,T;let B=JSON.parse(o.node.node_params),A=((T=(D=B==null?void 0:B.plugin)==null?void 0:D.params)==null?void 0:T.arguments)||{};A.app_id&&(s.app_id=A.app_id),A.msgtype&&(s.msgtype=A.msgtype),A.receiver&&(s.receiver=String(A.receiver)),A.openid&&(s.receiver=String(A.openid)),A.touser&&(s.receiver=String(A.touser)),A.tag_map&&A.tag_map.receiver&&(s.receiver_tags=A.tag_map.receiver),A.app_secret&&(s.app_secret=String(A.app_secret)),A.app_name&&(s.app_name=String(A.app_name)),s.app_id&&_(),s.msgtype&&v().then(()=>E(B))}function O(B,A){u.value={},f.value=[],p.value=[],s.msgtype=void 0,A&&A.app_secret&&(s.app_secret=A.app_secret),A&&A.name&&(s.app_name=A.name),s.app_id?_().then(()=>E()):E(),N()}function k(){p.value=[],v().then(()=>E()),N()}function E(B=null){Pt(()=>{r.value&&typeof r.value.init=="function"&&r.value.init(B)})}function S(){const B=cs();if(r.value&&typeof r.value.validateAll=="function"){const A=r.value.validateAll(),D=f.value.find(T=>T.msgtype==s.msgtype);A&&A.ok===!1&&B.emit&&B.emit("workflow:validate:error",{component:"公众号发送消息",type:s.msgtype,typeDisplay:(D==null?void 0:D.name)||s.msgtype,message:"请完善发送消息的必填项",errors:A.errors||[]})}}function N(B=null){let A=JSON.parse(o.node.node_params),D=f.value.find(T=>T.msgtype==s.msgtype);A.plugin.output_obj=h.value,Object.assign(A.plugin.params,{arguments:{app_id:String(s.app_id||""),app_secret:String(s.app_secret||""),msgtype:String(s.msgtype||""),touser:String(s.receiver||""),fields:(C(B)||{}).fields||[],app_name:String(s.app_name||""),msg_type_name:String((D==null?void 0:D.name)||"")}}),i({...o.node,node_params:JSON.stringify(A)})}function L(B,A){s.receiver=B,s.receiver_tags=A,N()}function $(){h.value=Ci(o.action.output)}return(B,A)=>{const D=mo,T=Vt,F=It,V=Qt;return w(),R("div",MR,[l.value||a.value?(w(),R("div",TR,[y(D)])):ie("",!0),d("div",$R,[A[9]||(A[9]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),d("div",PR,[A[6]||(A[6]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(F,{value:s.app_id,"onUpdate:value":A[0]||(A[0]=P=>s.app_id=P),placeholder:"请选择公众号",style:{width:"100%"},onChange:A[1]||(A[1]=(P,X)=>O(P,X))},{default:x(()=>[(w(!0),R(ae,null,ye(c.value,P=>(w(),Q(T,{key:P.app_id,value:P.app_id,name:P.app_name,app_secret:P.app_secret},{default:x(()=>[U(j(P.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"])])]),d("div",RR,[d("div",BR,[d("div",LR,[A[7]||(A[7]=U(" 接收人 ",-1)),y(V,{title:"用户的openid"},{default:x(()=>[y(K(mt))]),_:1})])]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:n.variableOptions,defaultSelectedList:s.receiver_tags,defaultValue:s.receiver,onOpen:A[2]||(A[2]=P=>t("updateVar")),onChange:A[3]||(A[3]=(P,X)=>L(P,X)),placeholder:"请输入接收人，键入“/”可以插入变量"},{option:x(({label:P,payload:X})=>[d("div",IR,[d("div",FR,j(P),1),d("div",jR,j(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",VR,[A[8]||(A[8]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"消息类型")],-1)),d("div",null,[y(F,{value:s.msgtype,"onUpdate:value":A[4]||(A[4]=P=>s.msgtype=P),onChange:k,placeholder:s.app_id?"请选择消息类型":"请先选择公众号",style:{width:"100%"}},{default:x(()=>[(w(!0),R(ae,null,ye(f.value,P=>(w(),Q(T,{key:P.msgtype,value:P.msgtype},{default:x(()=>[U(j(P.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),y(NR,{ref_key:"childRef",ref:r,tableId:s.msgtype,fields:p.value,variableOptions:n.variableOptions,onUpdate:N,onUpdateVar:A[5]||(A[5]=P=>t("updateVar"))},null,8,["tableId","fields","variableOptions"])]),d("div",HR,[A[10]||(A[10]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",UR,[y(Fi,{"tree-data":h.value},null,8,["tree-data"])])])])}}},qR=Te(zR,[["__scopeId","data-v-1df0f292"]]),Fg="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.0946%2014.4079C4.97757%2014.0753%203.98327%2013.4579%203.19596%2012.6398C3.48967%2012.2917%203.66667%2011.8419%203.66667%2011.3508C3.66667%2010.2462%202.77124%209.35078%201.66667%209.35078C1.59985%209.35078%201.5338%209.35408%201.46867%209.36048C1.37993%208.92665%201.33334%208.47752%201.33334%208.01745C1.33334%207.32058%201.44026%206.64868%201.6386%206.01725C1.64794%206.01738%201.6573%206.01745%201.66667%206.01745C2.77124%206.01745%203.66667%205.12202%203.66667%204.01745C3.66667%203.70035%203.59287%203.40052%203.46154%203.13412C4.2325%202.41725%205.1735%201.88076%206.21737%201.5918C6.54814%202.24015%207.22224%202.68413%208%202.68413C8.77777%202.68413%209.45187%202.24015%209.78264%201.5918C10.8265%201.88076%2011.7675%202.41725%2012.5385%203.13412C12.4071%203.40052%2012.3333%203.70035%2012.3333%204.01745C12.3333%205.12202%2013.2288%206.01745%2014.3333%206.01745C14.3427%206.01745%2014.3521%206.01738%2014.3614%206.01725C14.5597%206.64868%2014.6667%207.32058%2014.6667%208.01745C14.6667%208.47752%2014.6201%208.92665%2014.5313%209.36048C14.4662%209.35408%2014.4002%209.35078%2014.3333%209.35078C13.2288%209.35078%2012.3333%2010.2462%2012.3333%2011.3508C12.3333%2011.8419%2012.5103%2012.2917%2012.804%2012.6398C12.0167%2013.4579%2011.0224%2014.0753%209.9054%2014.4079C9.6476%2013.6014%208.892%2013.0175%208%2013.0175C7.108%2013.0175%206.3524%2013.6014%206.0946%2014.4079Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M8%2010.3503C9.28866%2010.3503%2010.3333%209.30559%2010.3333%208.01693C10.3333%206.72826%209.28866%205.68359%208%205.68359C6.71133%205.68359%205.66666%206.72826%205.66666%208.01693C5.66666%209.30559%206.71133%2010.3503%208%2010.3503Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e";/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function op(n){return Object.prototype.toString.call(n)==="[object Object]"}function Yn(n){var e,t;return op(n)===!1?!1:(e=n.constructor,e===void 0?!0:(t=e.prototype,!(op(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}function Xo(n){for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Nr(n){return!!n&&!!n[go]}function Mr(n){var e;return!!n&&((function(t){if(!t||typeof t!="object")return!1;var o=Object.getPrototypeOf(t);if(o===null)return!0;var i=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===QR})(n)||Array.isArray(n)||!!n[cp]||!!(!((e=n.constructor)===null||e===void 0)&&e[cp])||af(n)||lf(n))}function ba(n,e,t){t===void 0&&(t=!1),Ps(n)===0?(t?Object.keys:pf)(n).forEach((function(o){t&&typeof o=="symbol"||e(o,n[o],n)})):n.forEach((function(o,i){return e(i,o,n)}))}function Ps(n){var e=n[go];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:af(n)?2:lf(n)?3:0}function Gd(n,e){return Ps(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function GR(n,e){return Ps(n)===2?n.get(e):n[e]}function jg(n,e,t){var o=Ps(n);o===2?n.set(e,t):o===3?n.add(t):n[e]=t}function XR(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function af(n){return JR&&n instanceof Map}function lf(n){return ZR&&n instanceof Set}function _r(n){return n.o||n.t}function uf(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=e5(n);delete e[go];for(var t=pf(e),o=0;o<t.length;o++){var i=t[o],r=e[i];r.writable===!1&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(e[i]={configurable:!0,writable:!0,enumerable:r.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function df(n,e){return e===void 0&&(e=!1),cf(n)||Nr(n)||!Mr(n)||(Ps(n)>1&&(n.set=n.add=n.clear=n.delete=WR),Object.freeze(n),e&&ba(n,(function(t,o){return df(o,!0)}),!0)),n}function WR(){Xo(2)}function cf(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function _i(n){var e=t5[n];return e||Xo(18,n),e}function ip(){return xa}function dd(n,e){e&&(_i("Patches"),n.u=[],n.s=[],n.v=e)}function Il(n){Xd(n),n.p.forEach(YR),n.p=null}function Xd(n){n===xa&&(xa=n.l)}function rp(n){return xa={p:[],l:xa,h:n,m:!0,_:0}}function YR(n){var e=n[go];e.i===0||e.i===1?e.j():e.g=!0}function cd(n,e){e._=e.p.length;var t=e.p[0],o=n!==void 0&&n!==t;return e.h.O||_i("ES5").S(e,n,o),o?(t[go].P&&(Il(e),Xo(4)),Mr(n)&&(n=Fl(e,n),e.l||jl(e,n)),e.u&&_i("Patches").M(t[go].t,n,e.u,e.s)):n=Fl(e,t,[]),Il(e),e.u&&e.v(e.u,e.s),n!==Vg?n:void 0}function Fl(n,e,t){if(cf(e))return e;var o=e[go];if(!o)return ba(e,(function(a,l){return sp(n,o,e,a,l,t)}),!0),e;if(o.A!==n)return e;if(!o.P)return jl(n,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var i=o.i===4||o.i===5?o.o=uf(o.k):o.o,r=i,s=!1;o.i===3&&(r=new Set(i),i.clear(),s=!0),ba(r,(function(a,l){return sp(n,o,i,a,l,t,s)})),jl(n,i,!1),t&&n.u&&_i("Patches").N(o,t,n.u,n.s)}return o.o}function sp(n,e,t,o,i,r,s){if(Nr(i)){var a=Fl(n,i,r&&e&&e.i!==3&&!Gd(e.R,o)?r.concat(o):void 0);if(jg(t,o,a),!Nr(a))return;n.m=!1}else s&&t.add(i);if(Mr(i)&&!cf(i)){if(!n.h.D&&n._<1)return;Fl(n,i),e&&e.A.l||jl(n,i)}}function jl(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&df(e,t)}function fd(n,e){var t=n[go];return(t?_r(t):n)[e]}function ap(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var o=Object.getOwnPropertyDescriptor(t,e);if(o)return o;t=Object.getPrototypeOf(t)}}function Wd(n){n.P||(n.P=!0,n.l&&Wd(n.l))}function pd(n){n.o||(n.o=uf(n.t))}function Yd(n,e,t){var o=af(e)?_i("MapSet").F(e,t):lf(e)?_i("MapSet").T(e,t):n.O?(function(i,r){var s=Array.isArray(i),a={i:s?1:0,A:r?r.A:ip(),P:!1,I:!1,R:{},l:r,t:i,k:null,o:null,j:null,C:!1},l=a,u=Kd;s&&(l=[a],u=Ys);var c=Proxy.revocable(l,u),f=c.revoke,p=c.proxy;return a.k=p,a.j=f,p})(e,t):_i("ES5").J(e,t);return(t?t.A:ip()).p.push(o),o}function KR(n){return Nr(n)||Xo(22,n),(function e(t){if(!Mr(t))return t;var o,i=t[go],r=Ps(t);if(i){if(!i.P&&(i.i<4||!_i("ES5").K(i)))return i.t;i.I=!0,o=lp(t,r),i.I=!1}else o=lp(t,r);return ba(o,(function(s,a){i&&GR(i.t,s)===a||jg(o,s,e(a))})),r===3?new Set(o):o})(n)}function lp(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return uf(n)}var up,xa,ff=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",JR=typeof Map<"u",ZR=typeof Set<"u",dp=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Vg=ff?Symbol.for("immer-nothing"):((up={})["immer-nothing"]=!0,up),cp=ff?Symbol.for("immer-draftable"):"__$immer_draftable",go=ff?Symbol.for("immer-state"):"__$immer_state",QR=""+Object.prototype.constructor,pf=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,e5=Object.getOwnPropertyDescriptors||function(n){var e={};return pf(n).forEach((function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)})),e},t5={},Kd={get:function(n,e){if(e===go)return n;var t=_r(n);if(!Gd(t,e))return(function(i,r,s){var a,l=ap(r,s);return l?"value"in l?l.value:(a=l.get)===null||a===void 0?void 0:a.call(i.k):void 0})(n,t,e);var o=t[e];return n.I||!Mr(o)?o:o===fd(n.t,e)?(pd(n),n.o[e]=Yd(n.A.h,o,n)):o},has:function(n,e){return e in _r(n)},ownKeys:function(n){return Reflect.ownKeys(_r(n))},set:function(n,e,t){var o=ap(_r(n),e);if(o!=null&&o.set)return o.set.call(n.k,t),!0;if(!n.P){var i=fd(_r(n),e),r=i==null?void 0:i[go];if(r&&r.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(XR(t,i)&&(t!==void 0||Gd(n.t,e)))return!0;pd(n),Wd(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return fd(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,pd(n),Wd(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=_r(n),o=Reflect.getOwnPropertyDescriptor(t,e);return o&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:o.enumerable,value:t[e]}},defineProperty:function(){Xo(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){Xo(12)}},Ys={};ba(Kd,(function(n,e){Ys[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),Ys.deleteProperty=function(n,e){return Ys.set.call(this,n,e,void 0)},Ys.set=function(n,e,t){return Kd.set.call(this,n[0],e,t,n[0])};var n5=(function(){function n(t){var o=this;this.O=dp,this.D=!0,this.produce=function(i,r,s){if(typeof i=="function"&&typeof r!="function"){var a=r;r=i;var l=o;return function(m){var _=this;m===void 0&&(m=a);for(var v=arguments.length,b=Array(v>1?v-1:0),C=1;C<v;C++)b[C-1]=arguments[C];return l.produce(m,(function(M){var O;return(O=r).call.apply(O,[_,M].concat(b))}))}}var u;if(typeof r!="function"&&Xo(6),s!==void 0&&typeof s!="function"&&Xo(7),Mr(i)){var c=rp(o),f=Yd(o,i,void 0),p=!0;try{u=r(f),p=!1}finally{p?Il(c):Xd(c)}return typeof Promise<"u"&&u instanceof Promise?u.then((function(m){return dd(c,s),cd(m,c)}),(function(m){throw Il(c),m})):(dd(c,s),cd(u,c))}if(!i||typeof i!="object"){if((u=r(i))===void 0&&(u=i),u===Vg&&(u=void 0),o.D&&df(u,!0),s){var h=[],g=[];_i("Patches").M(i,u,h,g),s(h,g)}return u}Xo(21,i)},this.produceWithPatches=function(i,r){if(typeof i=="function")return function(u){for(var c=arguments.length,f=Array(c>1?c-1:0),p=1;p<c;p++)f[p-1]=arguments[p];return o.produceWithPatches(u,(function(h){return i.apply(void 0,[h].concat(f))}))};var s,a,l=o.produce(i,r,(function(u,c){s=u,a=c}));return typeof Promise<"u"&&l instanceof Promise?l.then((function(u){return[u,s,a]})):[l,s,a]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){Mr(t)||Xo(8),Nr(t)&&(t=KR(t));var o=rp(this),i=Yd(this,t,void 0);return i[go].C=!0,Xd(o),i},e.finishDraft=function(t,o){var i=t&&t[go],r=i.A;return dd(r,o),cd(void 0,r)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!dp&&Xo(20),this.O=t},e.applyPatches=function(t,o){var i;for(i=o.length-1;i>=0;i--){var r=o[i];if(r.path.length===0&&r.op==="replace"){t=r.value;break}}i>-1&&(o=o.slice(i+1));var s=_i("Patches").$;return Nr(t)?s(t,o):this.produce(t,(function(a){return s(a,o)}))},n})(),_o=new n5,Hu=_o.produce;_o.produceWithPatches.bind(_o);_o.setAutoFreeze.bind(_o);_o.setUseProxies.bind(_o);_o.applyPatches.bind(_o);var fp=_o.createDraft.bind(_o),pp=_o.finishDraft.bind(_o);function ji(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var hp=new WeakMap,vp=new WeakMap,gp=new WeakMap,_p=new WeakMap,mp=new WeakMap,yp=new WeakMap;function o5(n,e){if(n==null)return{};var t={},o=Object.keys(n),i,r;for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function Pi(n,e){if(n==null)return{};var t=o5(n,e),o,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)o=r[i],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(t[o]=n[o])}return t}var hf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=!t,i=t?u5(e):e,r=Bt.None,s=Bt.None,a=0,l=null,u=null;for(var c of i){var f=c.codePointAt(0);if(!f)break;var p=x5(c,f);if([r,s]=o?[s,p]:[p,r],es(r,Bt.ZWJ)&&es(s,Bt.ExtPict)&&(o?l=bp(e.substring(0,a)):l=bp(e.substring(0,e.length-a)),!l)||es(r,Bt.RI)&&es(s,Bt.RI)&&(u!==null?u=!u:o?u=!0:u=E5(e.substring(0,e.length-a)),!u)||r!==Bt.None&&s!==Bt.None&&C5(r,s))break;a+=c.length}return a||1},i5=/\s/,r5=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,s5=/['\u2018\u2019]/,a5=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=0,i=!1;e.length>0;){var r=hf(e,t),[s,a]=vf(e,r,t);if(l5(s,a,t))i=!0,o+=r;else if(!i)o+=r;else break;e=a}return o},vf=(n,e,t)=>{if(t){var o=n.length-e;return[n.slice(o,n.length),n.slice(0,o)]}return[n.slice(0,e),n.slice(e)]},l5=function n(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(i5.test(e))return!1;if(s5.test(e)){var i=hf(t,o),[r,s]=vf(t,i,o);if(n(r,s,o))return!0}return!r5.test(e)},u5=function*(e){for(var t=e.length-1,o=0;o<e.length;o++){var i=e.charAt(t-o);if(c5(i.charCodeAt(0))){var r=e.charAt(t-o-1);if(d5(r.charCodeAt(0))){yield r+i,o++;continue}}yield i}},d5=n=>n>=55296&&n<=56319,c5=n=>n>=56320&&n<=57343,Bt;(function(n){n[n.None=0]="None",n[n.Extend=1]="Extend",n[n.ZWJ=2]="ZWJ",n[n.RI=4]="RI",n[n.Prepend=8]="Prepend",n[n.SpacingMark=16]="SpacingMark",n[n.L=32]="L",n[n.V=64]="V",n[n.T=128]="T",n[n.LV=256]="LV",n[n.LVT=512]="LVT",n[n.ExtPict=1024]="ExtPict",n[n.Any=2048]="Any"})(Bt||(Bt={}));var f5=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,p5=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,h5=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,v5=/^[\u1100-\u115F\uA960-\uA97C]$/,g5=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,_5=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,m5=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,y5=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,b5=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,x5=(n,e)=>{var t=Bt.Any;return n.search(f5)!==-1&&(t|=Bt.Extend),e===8205&&(t|=Bt.ZWJ),e>=127462&&e<=127487&&(t|=Bt.RI),n.search(p5)!==-1&&(t|=Bt.Prepend),n.search(h5)!==-1&&(t|=Bt.SpacingMark),n.search(v5)!==-1&&(t|=Bt.L),n.search(g5)!==-1&&(t|=Bt.V),n.search(_5)!==-1&&(t|=Bt.T),n.search(m5)!==-1&&(t|=Bt.LV),n.search(y5)!==-1&&(t|=Bt.LVT),n.search(b5)!==-1&&(t|=Bt.ExtPict),t};function es(n,e){return(n&e)!==0}var w5=[[Bt.L,Bt.L|Bt.V|Bt.LV|Bt.LVT],[Bt.LV|Bt.V,Bt.V|Bt.T],[Bt.LVT|Bt.T,Bt.T],[Bt.Any,Bt.Extend|Bt.ZWJ],[Bt.Any,Bt.SpacingMark],[Bt.Prepend,Bt.Any],[Bt.ZWJ,Bt.ExtPict],[Bt.RI,Bt.RI]];function C5(n,e){return w5.findIndex(t=>es(n,t[0])&&es(e,t[1]))===-1}var S5=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,bp=n=>n.search(S5)!==-1,k5=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,E5=n=>{var e=n.match(k5);if(e===null)return!1;var t=e[0].length/2;return t%2===1},xp=n=>Yn(n)&&_t.isNodeList(n.children)&&!ue.isEditor(n),An={isAncestor(n){return Yn(n)&&_t.isNodeList(n.children)},isElement:xp,isElementList(n){return Array.isArray(n)&&n.every(e=>An.isElement(e))},isElementProps(n){return n.children!==void 0},isElementType:function(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return xp(e)&&e[o]===t},matches(n,e){for(var t in e)if(t!=="children"&&n[t]!==e[t])return!1;return!0}},D5=["text"],A5=["text"];function wp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Vr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wp(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var Cp=new WeakMap,ue={above(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:t=!1,mode:o="lowest",at:i=n.selection,match:r}=e;if(i){var s=ue.path(n,i),a=o==="lowest";for(var[l,u]of ue.levels(n,{at:s,voids:t,match:r,reverse:a}))if(!jt.isText(l)&&!Ae.equals(s,u))return[l,u]}},addMark(n,e,t){n.addMark(e,t)},after(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ue.point(n,e,{edge:"end"}),i=ue.end(n,[]),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var u of ue.positions(n,Vr(Vr({},t),{},{at:r}))){if(a>s)break;a!==0&&(l=u),a++}return l},before(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ue.start(n,[]),i=ue.point(n,e,{edge:"start"}),r={anchor:o,focus:i},{distance:s=1}=t,a=0,l;for(var u of ue.positions(n,Vr(Vr({},t),{},{at:r,reverse:!0}))){if(a>s)break;a!==0&&(l=u),a++}return l},deleteBackward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteBackward(t)},deleteForward(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:t="character"}=e;n.deleteForward(t)},deleteFragment(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:t="forward"}=e;n.deleteFragment(t)},edges(n,e){return[ue.start(n,e),ue.end(n,e)]},end(n,e){return ue.point(n,e,{edge:"end"})},first(n,e){var t=ue.path(n,e,{edge:"start"});return ue.node(n,t)},fragment(n,e){var t=ue.range(n,e),o=_t.fragment(n,t);return o},hasBlocks(n,e){return e.children.some(t=>ue.isBlock(n,t))},hasInlines(n,e){return e.children.some(t=>jt.isText(t)||ue.isInline(n,t))},hasTexts(n,e){return e.children.every(t=>jt.isText(t))},insertBreak(n){n.insertBreak()},insertFragment(n,e){n.insertFragment(e)},insertNode(n,e){n.insertNode(e)},insertText(n,e){n.insertText(e)},isBlock(n,e){return An.isElement(e)&&!n.isInline(e)},isEditor(n){if(!Yn(n))return!1;var e=Cp.get(n);if(e!==void 0)return e;var t=typeof n.addMark=="function"&&typeof n.apply=="function"&&typeof n.deleteBackward=="function"&&typeof n.deleteForward=="function"&&typeof n.deleteFragment=="function"&&typeof n.insertBreak=="function"&&typeof n.insertFragment=="function"&&typeof n.insertNode=="function"&&typeof n.insertText=="function"&&typeof n.isInline=="function"&&typeof n.isVoid=="function"&&typeof n.normalizeNode=="function"&&typeof n.onChange=="function"&&typeof n.removeMark=="function"&&(n.marks===null||Yn(n.marks))&&(n.selection===null||it.isRange(n.selection))&&_t.isNodeList(n.children)&&Ks.isOperationList(n.operations);return Cp.set(n,t),t},isEnd(n,e,t){var o=ue.end(n,t);return un.equals(e,o)},isEdge(n,e,t){return ue.isStart(n,e,t)||ue.isEnd(n,e,t)},isEmpty(n,e){var{children:t}=e,[o]=t;return t.length===0||t.length===1&&jt.isText(o)&&o.text===""&&!n.isVoid(e)},isInline(n,e){return An.isElement(e)&&n.isInline(e)},isNormalizing(n){var e=gp.get(n);return e===void 0?!0:e},isStart(n,e,t){if(e.offset!==0)return!1;var o=ue.start(n,t);return un.equals(e,o)},isVoid(n,e){return An.isElement(e)&&n.isVoid(e)},last(n,e){var t=ue.path(n,e,{edge:"end"});return ue.node(n,t)},leaf(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ue.path(n,e,t),i=_t.leaf(n,o);return[i,o]},*levels(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,reverse:o=!1,voids:i=!1}=e,{match:r}=e;if(r==null&&(r=()=>!0),!!t){var s=[],a=ue.path(n,t);for(var[l,u]of _t.levels(n,a))if(r(l,u)&&(s.push([l,u]),!i&&ue.isVoid(n,l)))break;o&&s.reverse(),yield*s}},marks(n){var{marks:e,selection:t}=n;if(!t)return null;if(e)return e;if(it.isExpanded(t)){var[o]=ue.nodes(n,{match:jt.isText});if(o){var[i]=o,r=Pi(i,D5);return r}else return{}}var{anchor:s}=t,{path:a}=s,[l]=ue.leaf(n,a);if(s.offset===0){var u=ue.previous(n,{at:a,match:jt.isText}),c=ue.above(n,{match:m=>ue.isBlock(n,m)});if(u&&c){var[f,p]=u,[,h]=c;Ae.isAncestor(h,p)&&(l=f)}}var g=Pi(l,A5);return g},next(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=ue.after(n,r,{voids:o});if(s){var[,a]=ue.last(n,[]),l=[s.path,a];if(Ae.isPath(r)&&r.length===0)throw new Error("Cannot get the next node from the root node!");if(i==null)if(Ae.isPath(r)){var[u]=ue.parent(n,r);i=f=>u.children.includes(f)}else i=()=>!0;var[c]=ue.nodes(n,{at:l,match:i,mode:t,voids:o});return c}}},node(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ue.path(n,e,t),i=_t.get(n,o);return[i,o]},*nodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,mode:o="all",universal:i=!1,reverse:r=!1,voids:s=!1}=e,{match:a}=e;if(a||(a=()=>!0),!!t){var l,u;if(O5.isSpan(t))l=t[0],u=t[1];else{var c=ue.path(n,t,{edge:"start"}),f=ue.path(n,t,{edge:"end"});l=r?f:c,u=r?c:f}var p=_t.nodes(n,{reverse:r,from:l,to:u,pass:C=>{var[M]=C;return s?!1:ue.isVoid(n,M)}}),h=[],g;for(var[m,_]of p){var v=g&&Ae.compare(_,g[1])===0;if(!(o==="highest"&&v)){if(!a(m,_)){if(i&&!v&&jt.isText(m))return;continue}if(o==="lowest"&&v){g=[m,_];continue}var b=o==="lowest"?g:[m,_];b&&(i?h.push(b):yield b),g=[m,_]}}o==="lowest"&&g&&(i?h.push(g):yield g),i&&(yield*h)}},normalize(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:t=!1}=e,o=l=>hp.get(l)||[],i=l=>vp.get(l)||new Set,r=l=>{var u=o(l).pop(),c=u.join(",");return i(l).delete(c),u};if(ue.isNormalizing(n)){if(t){var s=Array.from(_t.nodes(n),l=>{var[,u]=l;return u}),a=new Set(s.map(l=>l.join(",")));hp.set(n,s),vp.set(n,a)}o(n).length!==0&&ue.withoutNormalizing(n,()=>{for(var l of o(n))if(_t.has(n,l)){var u=ue.node(n,l),[c,f]=u;An.isElement(c)&&c.children.length===0&&n.normalizeNode(u)}for(var p=o(n).length*42,h=0;o(n).length!==0;){if(h>p)throw new Error(`
            Could not completely normalize the editor after `.concat(p,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var g=r(n);if(_t.has(n,g)){var m=ue.node(n,g);n.normalizeNode(m)}h++}})}},parent(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=ue.path(n,e,t),i=Ae.parent(o),r=ue.node(n,i);return r},path(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:o,edge:i}=t;if(Ae.isPath(e)){if(i==="start"){var[,r]=_t.first(n,e);e=r}else if(i==="end"){var[,s]=_t.last(n,e);e=s}}return it.isRange(e)&&(i==="start"?e=it.start(e):i==="end"?e=it.end(e):e=Ae.common(e.anchor.path,e.focus.path)),un.isPoint(e)&&(e=e.path),o!=null&&(e=e.slice(0,o)),e},hasPath(n,e){return _t.has(n,e)},pathRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=ue.pathRefs(n);return a.delete(i),i.current=null,s}},r=ue.pathRefs(n);return r.add(i),i},pathRefs(n){var e=_p.get(n);return e||(e=new Set,_p.set(n,e)),e},point(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:o="start"}=t;if(Ae.isPath(e)){var i;if(o==="end"){var[,r]=_t.last(n,e);i=r}else{var[,s]=_t.first(n,e);i=s}var a=_t.get(n,i);if(!jt.isText(a))throw new Error("Cannot get the ".concat(o," point in the node at path [").concat(e,"] because it has no ").concat(o," text node."));return{path:i,offset:o==="end"?a.text.length:0}}if(it.isRange(e)){var[l,u]=it.edges(e);return o==="start"?l:u}return e},pointRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=ue.pointRefs(n);return a.delete(i),i.current=null,s}},r=ue.pointRefs(n);return r.add(i),i},pointRefs(n){var e=mp.get(n);return e||(e=new Set,mp.set(n,e)),e},*positions(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:t=n.selection,unit:o="offset",reverse:i=!1,voids:r=!1}=e;if(!t)return;var s=ue.range(n,t),[a,l]=it.edges(s),u=i?l:a,c=!1,f="",p=0,h=0,g=0;for(var[m,_]of ue.nodes(n,{at:t,reverse:i,voids:r})){if(An.isElement(m)){if(!r&&n.isVoid(m)){yield ue.start(n,_);continue}if(n.isInline(m))continue;if(ue.hasInlines(n,m)){var v=Ae.isAncestor(_,l.path)?l:ue.end(n,_),b=Ae.isAncestor(_,a.path)?a:ue.start(n,_);f=ue.string(n,{anchor:b,focus:v},{voids:r}),c=!0}}if(jt.isText(m)){var C=Ae.equals(_,u.path);for(C?(h=i?u.offset:m.text.length-u.offset,g=u.offset):(h=m.text.length,g=i?h:0),(C||c||o==="offset")&&(yield{path:_,offset:g},c=!1);;){if(p===0){if(f==="")break;p=M(f,o,i),f=vf(f,p,i)[1]}if(g=i?g-p:g+p,h=h-p,h<0){p=-h;break}p=0,yield{path:_,offset:g}}}}function M(O,k,E){return k==="character"?hf(O,E):k==="word"?a5(O,E):k==="line"||k==="block"?O.length:1}},previous(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection}=e;if(r){var s=ue.before(n,r,{voids:o});if(s){var[,a]=ue.first(n,[]),l=[s.path,a];if(Ae.isPath(r)&&r.length===0)throw new Error("Cannot get the previous node from the root node!");if(i==null)if(Ae.isPath(r)){var[u]=ue.parent(n,r);i=f=>u.children.includes(f)}else i=()=>!0;var[c]=ue.nodes(n,{reverse:!0,at:l,match:i,mode:t,voids:o});return c}}},range(n,e,t){if(it.isRange(e)&&!t)return e;var o=ue.start(n,e),i=ue.end(n,t||e);return{anchor:o,focus:i}},rangeRef(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:o="forward"}=t,i={current:e,affinity:o,unref(){var{current:s}=i,a=ue.rangeRefs(n);return a.delete(i),i.current=null,s}},r=ue.rangeRefs(n);return r.add(i),i},rangeRefs(n){var e=yp.get(n);return e||(e=new Set,yp.set(n,e)),e},removeMark(n,e){n.removeMark(e)},setNormalizing(n,e){gp.set(n,e)},start(n,e){return ue.point(n,e,{edge:"start"})},string(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,i=ue.range(n,e),[r,s]=it.edges(i),a="";for(var[l,u]of ue.nodes(n,{at:i,match:jt.isText,voids:o})){var c=l.text;Ae.equals(u,s.path)&&(c=c.slice(0,s.offset)),Ae.equals(u,r.path)&&(c=c.slice(r.offset)),a+=c}return a},unhangRange(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:o=!1}=t,[i,r]=it.edges(e);if(i.offset!==0||r.offset!==0||it.isCollapsed(e))return e;var s=ue.above(n,{at:r,match:h=>ue.isBlock(n,h)}),a=s?s[1]:[],l=ue.start(n,i),u={anchor:l,focus:r},c=!0;for(var[f,p]of ue.nodes(n,{at:u,match:jt.isText,reverse:!0,voids:o})){if(c){c=!1;continue}if(f.text!==""||Ae.isBefore(p,a)){r={path:p,offset:f.text.length};break}}return{anchor:i,focus:r}},void(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ue.above(n,Vr(Vr({},e),{},{match:t=>ue.isVoid(n,t)}))},withoutNormalizing(n,e){var t=ue.isNormalizing(n);ue.setNormalizing(n,!1);try{e()}finally{ue.setNormalizing(n,t)}ue.normalize(n)}},O5={isSpan(n){return Array.isArray(n)&&n.length===2&&n.every(Ae.isPath)}},N5=["children"],M5=["text"],Sp=new WeakMap,_t={ancestor(n,e){var t=_t.get(n,e);if(jt.isText(t))throw new Error("Cannot get the ancestor node at path [".concat(e,"] because it refers to a text node instead: ").concat(t));return t},*ancestors(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Ae.ancestors(e,t)){var i=_t.ancestor(n,o),r=[i,o];yield r}},child(n,e){if(jt.isText(n))throw new Error("Cannot get the child of a text node: ".concat(JSON.stringify(n)));var t=n.children[e];if(t==null)throw new Error("Cannot get child at index `".concat(e,"` in node: ").concat(JSON.stringify(n)));return t},*children(n,e){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:o=!1}=t,i=_t.ancestor(n,e),{children:r}=i,s=o?r.length-1:0;o?s>=0:s<r.length;){var a=_t.child(i,s),l=e.concat(s);yield[a,l],s=o?s-1:s+1}},common(n,e,t){var o=Ae.common(e,t),i=_t.get(n,o);return[i,o]},descendant(n,e){var t=_t.get(n,e);if(ue.isEditor(t))throw new Error("Cannot get the descendant node at path [".concat(e,"] because it refers to the root editor node instead: ").concat(t));return t},*descendants(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))o.length!==0&&(yield[t,o])},*elements(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))An.isElement(t)&&(yield[t,o])},extractProps(n){if(An.isAncestor(n)){var e=Pi(n,N5);return e}else{var e=Pi(n,M5);return e}},first(n,e){for(var t=e.slice(),o=_t.get(n,t);o&&!(jt.isText(o)||o.children.length===0);)o=o.children[0],t.push(0);return[o,t]},fragment(n,e){if(jt.isText(n))throw new Error("Cannot get a fragment starting from a root text node: ".concat(JSON.stringify(n)));var t=Hu({children:n.children},o=>{var[i,r]=it.edges(e),s=_t.nodes(o,{reverse:!0,pass:p=>{var[,h]=p;return!it.includes(e,h)}});for(var[,a]of s){if(!it.includes(e,a)){var l=_t.parent(o,a),u=a[a.length-1];l.children.splice(u,1)}if(Ae.equals(a,r.path)){var c=_t.leaf(o,a);c.text=c.text.slice(0,r.offset)}if(Ae.equals(a,i.path)){var f=_t.leaf(o,a);f.text=f.text.slice(i.offset)}}ue.isEditor(o)&&(o.selection=null)});return t.children},get(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(jt.isText(t)||!t.children[i])throw new Error("Cannot find a descendant at path [".concat(e,"] in node: ").concat(JSON.stringify(n)));t=t.children[i]}return t},has(n,e){for(var t=n,o=0;o<e.length;o++){var i=e[o];if(jt.isText(t)||!t.children[i])return!1;t=t.children[i]}return!0},isNode(n){return jt.isText(n)||An.isElement(n)||ue.isEditor(n)},isNodeList(n){if(!Array.isArray(n))return!1;var e=Sp.get(n);if(e!==void 0)return e;var t=n.every(o=>_t.isNode(o));return Sp.set(n,t),t},last(n,e){for(var t=e.slice(),o=_t.get(n,t);o&&!(jt.isText(o)||o.children.length===0);){var i=o.children.length-1;o=o.children[i],t.push(i)}return[o,t]},leaf(n,e){var t=_t.get(n,e);if(!jt.isText(t))throw new Error("Cannot get the leaf node at path [".concat(e,"] because it refers to a non-leaf node: ").concat(t));return t},*levels(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var o of Ae.levels(e,t)){var i=_t.get(n,o);yield[i,o]}},matches(n,e){return An.isElement(n)&&An.isElementProps(e)&&An.matches(n,e)||jt.isText(n)&&jt.isTextProps(e)&&jt.matches(n,e)},*nodes(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:t,reverse:o=!1}=e,{from:i=[],to:r}=e,s=new Set,a=[],l=n;!(r&&(o?Ae.isBefore(a,r):Ae.isAfter(a,r)));){if(s.has(l)||(yield[l,a]),!s.has(l)&&!jt.isText(l)&&l.children.length!==0&&(t==null||t([l,a])===!1)){s.add(l);var u=o?l.children.length-1:0;Ae.isAncestor(a,i)&&(u=i[a.length]),a=a.concat(u),l=_t.get(n,a);continue}if(a.length===0)break;if(!o){var c=Ae.next(a);if(_t.has(n,c)){a=c,l=_t.get(n,a);continue}}if(o&&a[a.length-1]!==0){var f=Ae.previous(a);a=f,l=_t.get(n,a);continue}a=Ae.parent(a),l=_t.get(n,a),s.add(l)}},parent(n,e){var t=Ae.parent(e),o=_t.get(n,t);if(jt.isText(o))throw new Error("Cannot get the parent of path [".concat(e,"] because it does not exist in the root."));return o},string(n){return jt.isText(n)?n.text:n.children.map(_t.string).join("")},*texts(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[t,o]of _t.nodes(n,e))jt.isText(t)&&(yield[t,o])}};function kp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Cn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?kp(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):kp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var Ks={isNodeOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_node")},isOperation(n){if(!Yn(n))return!1;switch(n.type){case"insert_node":return Ae.isPath(n.path)&&_t.isNode(n.node);case"insert_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Ae.isPath(n.path);case"merge_node":return typeof n.position=="number"&&Ae.isPath(n.path)&&Yn(n.properties);case"move_node":return Ae.isPath(n.path)&&Ae.isPath(n.newPath);case"remove_node":return Ae.isPath(n.path)&&_t.isNode(n.node);case"remove_text":return typeof n.offset=="number"&&typeof n.text=="string"&&Ae.isPath(n.path);case"set_node":return Ae.isPath(n.path)&&Yn(n.properties)&&Yn(n.newProperties);case"set_selection":return n.properties===null&&it.isRange(n.newProperties)||n.newProperties===null&&it.isRange(n.properties)||Yn(n.properties)&&Yn(n.newProperties);case"split_node":return Ae.isPath(n.path)&&typeof n.position=="number"&&Yn(n.properties);default:return!1}},isOperationList(n){return Array.isArray(n)&&n.every(e=>Ks.isOperation(e))},isSelectionOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_selection")},isTextOperation(n){return Ks.isOperation(n)&&n.type.endsWith("_text")},inverse(n){switch(n.type){case"insert_node":return Cn(Cn({},n),{},{type:"remove_node"});case"insert_text":return Cn(Cn({},n),{},{type:"remove_text"});case"merge_node":return Cn(Cn({},n),{},{type:"split_node",path:Ae.previous(n.path)});case"move_node":{var{newPath:e,path:t}=n;if(Ae.equals(e,t))return n;if(Ae.isSibling(t,e))return Cn(Cn({},n),{},{path:e,newPath:t});var o=Ae.transform(t,n),i=Ae.transform(Ae.next(t),n);return Cn(Cn({},n),{},{path:o,newPath:i})}case"remove_node":return Cn(Cn({},n),{},{type:"insert_node"});case"remove_text":return Cn(Cn({},n),{},{type:"insert_text"});case"set_node":{var{properties:r,newProperties:s}=n;return Cn(Cn({},n),{},{properties:s,newProperties:r})}case"set_selection":{var{properties:a,newProperties:l}=n;return a==null?Cn(Cn({},n),{},{properties:l,newProperties:null}):l==null?Cn(Cn({},n),{},{properties:null,newProperties:a}):Cn(Cn({},n),{},{properties:l,newProperties:a})}case"split_node":return Cn(Cn({},n),{},{type:"merge_node",path:Ae.next(n.path)})}}},Ae={ancestors(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=Ae.levels(n,e);return t?o=o.slice(1):o=o.slice(0,-1),o},common(n,e){for(var t=[],o=0;o<n.length&&o<e.length;o++){var i=n[o],r=e[o];if(i!==r)break;t.push(i)}return t},compare(n,e){for(var t=Math.min(n.length,e.length),o=0;o<t;o++){if(n[o]<e[o])return-1;if(n[o]>e[o])return 1}return 0},endsAfter(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Ae.equals(o,i)&&r>s},endsAt(n,e){var t=n.length,o=n.slice(0,t),i=e.slice(0,t);return Ae.equals(o,i)},endsBefore(n,e){var t=n.length-1,o=n.slice(0,t),i=e.slice(0,t),r=n[t],s=e[t];return Ae.equals(o,i)&&r<s},equals(n,e){return n.length===e.length&&n.every((t,o)=>t===e[o])},hasPrevious(n){return n[n.length-1]>0},isAfter(n,e){return Ae.compare(n,e)===1},isAncestor(n,e){return n.length<e.length&&Ae.compare(n,e)===0},isBefore(n,e){return Ae.compare(n,e)===-1},isChild(n,e){return n.length===e.length+1&&Ae.compare(n,e)===0},isCommon(n,e){return n.length<=e.length&&Ae.compare(n,e)===0},isDescendant(n,e){return n.length>e.length&&Ae.compare(n,e)===0},isParent(n,e){return n.length+1===e.length&&Ae.compare(n,e)===0},isPath(n){return Array.isArray(n)&&(n.length===0||typeof n[0]=="number")},isSibling(n,e){if(n.length!==e.length)return!1;var t=n.slice(0,-1),o=e.slice(0,-1),i=n[n.length-1],r=e[e.length-1];return i!==r&&Ae.equals(t,o)},levels(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,o=[],i=0;i<=n.length;i++)o.push(n.slice(0,i));return t&&o.reverse(),o},next(n){if(n.length===0)throw new Error("Cannot get the next path of a root path [".concat(n,"], because it has no next index."));var e=n[n.length-1];return n.slice(0,-1).concat(e+1)},operationCanTransformPath(n){switch(n.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(n){if(n.length===0)throw new Error("Cannot get the parent path of the root path [".concat(n,"]."));return n.slice(0,-1)},previous(n){if(n.length===0)throw new Error("Cannot get the previous path of a root path [".concat(n,"], because it has no previous index."));var e=n[n.length-1];if(e<=0)throw new Error("Cannot get the previous path of a first child path [".concat(n,"] because it would result in a negative index."));return n.slice(0,-1).concat(e-1)},relative(n,e){if(!Ae.isAncestor(e,n)&&!Ae.equals(n,e))throw new Error("Cannot get the relative path of [".concat(n,"] inside ancestor [").concat(e,"], because it is not above or equal to the path."));return n.slice(e.length)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{var{affinity:i="forward"}=t;if(!(!n||(n==null?void 0:n.length)===0)){if(o===null)return null;switch(e.type){case"insert_node":{var{path:r}=e;(Ae.equals(r,o)||Ae.endsBefore(r,o)||Ae.isAncestor(r,o))&&(o[r.length-1]+=1);break}case"remove_node":{var{path:s}=e;if(Ae.equals(s,o)||Ae.isAncestor(s,o))return null;Ae.endsBefore(s,o)&&(o[s.length-1]-=1);break}case"merge_node":{var{path:a,position:l}=e;Ae.equals(a,o)||Ae.endsBefore(a,o)?o[a.length-1]-=1:Ae.isAncestor(a,o)&&(o[a.length-1]-=1,o[a.length]+=l);break}case"split_node":{var{path:u,position:c}=e;if(Ae.equals(u,o)){if(i==="forward")o[o.length-1]+=1;else if(i!=="backward")return null}else Ae.endsBefore(u,o)?o[u.length-1]+=1:Ae.isAncestor(u,o)&&n[u.length]>=c&&(o[u.length-1]+=1,o[u.length]-=c);break}case"move_node":{var{path:f,newPath:p}=e;if(Ae.equals(f,p))return;if(Ae.isAncestor(f,o)||Ae.equals(f,o)){var h=p.slice();return Ae.endsBefore(f,p)&&f.length<p.length&&(h[f.length-1]-=1),h.concat(o.slice(f.length))}else Ae.isSibling(f,p)&&(Ae.isAncestor(p,o)||Ae.equals(p,o))?Ae.endsBefore(f,o)?o[f.length-1]-=1:o[f.length-1]+=1:Ae.endsBefore(p,o)||Ae.equals(p,o)||Ae.isAncestor(p,o)?(Ae.endsBefore(f,o)&&(o[f.length-1]-=1),o[p.length-1]+=1):Ae.endsBefore(f,o)&&(Ae.equals(p,o)&&(o[p.length-1]+=1),o[f.length-1]-=1);break}}}})}};function Ep(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Dp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ep(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ep(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var un={compare(n,e){var t=Ae.compare(n.path,e.path);return t===0?n.offset<e.offset?-1:n.offset>e.offset?1:0:t},isAfter(n,e){return un.compare(n,e)===1},isBefore(n,e){return un.compare(n,e)===-1},equals(n,e){return n.offset===e.offset&&Ae.equals(n.path,e.path)},isPoint(n){return Yn(n)&&typeof n.offset=="number"&&Ae.isPath(n.path)},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{if(o===null)return null;var{affinity:i="forward"}=t,{path:r,offset:s}=o;switch(e.type){case"insert_node":case"move_node":{o.path=Ae.transform(r,e,t);break}case"insert_text":{Ae.equals(e.path,r)&&e.offset<=s&&(o.offset+=e.text.length);break}case"merge_node":{Ae.equals(e.path,r)&&(o.offset+=e.position),o.path=Ae.transform(r,e,t);break}case"remove_text":{Ae.equals(e.path,r)&&e.offset<=s&&(o.offset-=Math.min(s-e.offset,e.text.length));break}case"remove_node":{if(Ae.equals(e.path,r)||Ae.isAncestor(e.path,r))return null;o.path=Ae.transform(r,e,t);break}case"split_node":{if(Ae.equals(e.path,r)){if(e.position===s&&i==null)return null;(e.position<s||e.position===s&&i==="forward")&&(o.offset-=e.position,o.path=Ae.transform(r,e,Dp(Dp({},t),{},{affinity:"forward"})))}else o.path=Ae.transform(r,e,t);break}}})}},T5=["anchor","focus"];function Ap(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function $5(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ap(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ap(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var it={edges(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:t=!1}=e,{anchor:o,focus:i}=n;return it.isBackward(n)===t?[o,i]:[i,o]},end(n){var[,e]=it.edges(n);return e},equals(n,e){return un.equals(n.anchor,e.anchor)&&un.equals(n.focus,e.focus)},includes(n,e){if(it.isRange(e)){if(it.includes(n,e.anchor)||it.includes(n,e.focus))return!0;var[t,o]=it.edges(n),[i,r]=it.edges(e);return un.isBefore(t,i)&&un.isAfter(o,r)}var[s,a]=it.edges(n),l=!1,u=!1;return un.isPoint(e)?(l=un.compare(e,s)>=0,u=un.compare(e,a)<=0):(l=Ae.compare(e,s.path)>=0,u=Ae.compare(e,a.path)<=0),l&&u},intersection(n,e){var t=Pi(n,T5),[o,i]=it.edges(n),[r,s]=it.edges(e),a=un.isBefore(o,r)?r:o,l=un.isBefore(i,s)?i:s;return un.isBefore(l,a)?null:$5({anchor:a,focus:l},t)},isBackward(n){var{anchor:e,focus:t}=n;return un.isAfter(e,t)},isCollapsed(n){var{anchor:e,focus:t}=n;return un.equals(e,t)},isExpanded(n){return!it.isCollapsed(n)},isForward(n){return!it.isBackward(n)},isRange(n){return Yn(n)&&un.isPoint(n.anchor)&&un.isPoint(n.focus)},*points(n){yield[n.anchor,"anchor"],yield[n.focus,"focus"]},start(n){var[e]=it.edges(n);return e},transform(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Hu(n,o=>{if(o===null)return null;var{affinity:i="inward"}=t,r,s;if(i==="inward"){var a=it.isCollapsed(o);it.isForward(o)?(r="forward",s=a?r:"backward"):(r="backward",s=a?r:"forward")}else i==="outward"?it.isForward(o)?(r="backward",s="forward"):(r="forward",s="backward"):(r=i,s=i);var l=un.transform(o.anchor,e,{affinity:r}),u=un.transform(o.focus,e,{affinity:s});if(!l||!u)return null;o.anchor=l,o.focus=u})}},Hg=(n,e)=>{for(var t in n){var o=n[t],i=e[t];if(Yn(o)&&Yn(i)){if(!Hg(o,i))return!1}else if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;for(var r=0;r<o.length;r++)if(o[r]!==i[r])return!1}else if(o!==i)return!1}for(var s in e)if(n[s]===void 0&&e[s]!==void 0)return!1;return!0},P5=["text"],R5=["anchor","focus"];function Op(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Ai(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Op(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Op(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var jt={equals(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:o=!1}=t;function i(r){var s=Pi(r,P5);return s}return Hg(o?i(n):n,o?i(e):e)},isText(n){return Yn(n)&&typeof n.text=="string"},isTextList(n){return Array.isArray(n)&&n.every(e=>jt.isText(e))},isTextProps(n){return n.text!==void 0},matches(n,e){for(var t in e)if(t!=="text"&&(!n.hasOwnProperty(t)||n[t]!==e[t]))return!1;return!0},decorations(n,e){var t=[Ai({},n)];for(var o of e){var i=Pi(o,R5),[r,s]=it.edges(o),a=[],l=0;for(var u of t){var{length:c}=u.text,f=l;if(l+=c,r.offset<=f&&s.offset>=l){Object.assign(u,i),a.push(u);continue}if(r.offset!==s.offset&&(r.offset===l||s.offset===f)||r.offset>l||s.offset<f||s.offset===f&&f!==0){a.push(u);continue}var p=u,h=void 0,g=void 0;if(s.offset<l){var m=s.offset-f;g=Ai(Ai({},p),{},{text:p.text.slice(m)}),p=Ai(Ai({},p),{},{text:p.text.slice(0,m)})}if(r.offset>f){var _=r.offset-f;h=Ai(Ai({},p),{},{text:p.text.slice(0,_)}),p=Ai(Ai({},p),{},{text:p.text.slice(_)})}Object.assign(p,i),h&&a.push(h),a.push(p),g&&a.push(g)}t=a}return t}};function Np(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Us(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Np(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Np(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var B5=(n,e,t)=>{switch(t.type){case"insert_node":{var{path:o,node:i}=t,r=_t.parent(n,o),s=o[o.length-1];if(s>r.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(o,"] because the destination is past the end of the node."));if(r.children.splice(s,0,i),e)for(var[a,l]of it.points(e))e[l]=un.transform(a,t);break}case"insert_text":{var{path:u,offset:c,text:f}=t;if(f.length===0)break;var p=_t.leaf(n,u),h=p.text.slice(0,c),g=p.text.slice(c);if(p.text=h+f+g,e)for(var[m,_]of it.points(e))e[_]=un.transform(m,t);break}case"merge_node":{var{path:v}=t,b=_t.get(n,v),C=Ae.previous(v),M=_t.get(n,C),O=_t.parent(n,v),k=v[v.length-1];if(jt.isText(b)&&jt.isText(M))M.text+=b.text;else if(!jt.isText(b)&&!jt.isText(M))M.children.push(...b.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(v,"] to nodes of different interfaces: ").concat(b," ").concat(M));if(O.children.splice(k,1),e)for(var[E,S]of it.points(e))e[S]=un.transform(E,t);break}case"move_node":{var{path:N,newPath:L}=t;if(Ae.isAncestor(N,L))throw new Error("Cannot move a path [".concat(N,"] to new path [").concat(L,"] because the destination is inside itself."));var $=_t.get(n,N),B=_t.parent(n,N),A=N[N.length-1];B.children.splice(A,1);var D=Ae.transform(N,t),T=_t.get(n,Ae.parent(D)),F=D[D.length-1];if(T.children.splice(F,0,$),e)for(var[V,P]of it.points(e))e[P]=un.transform(V,t);break}case"remove_node":{var{path:X}=t,oe=X[X.length-1],H=_t.parent(n,X);if(H.children.splice(oe,1),e)for(var[W,Z]of it.points(e)){var le=un.transform(W,t);if(e!=null&&le!=null)e[Z]=le;else{var te=void 0,q=void 0;for(var[re,ce]of _t.texts(n))if(Ae.compare(ce,X)===-1)te=[re,ce];else{q=[re,ce];break}var ve=!1;te&&q&&(Ae.equals(q[1],X)?ve=!Ae.hasPrevious(q[1]):ve=Ae.common(te[1],X).length<Ae.common(q[1],X).length),te&&!ve?(W.path=te[1],W.offset=te[0].text.length):q?(W.path=q[1],W.offset=0):e=null}}break}case"remove_text":{var{path:Ne,offset:ge,text:_e}=t;if(_e.length===0)break;var st=_t.leaf(n,Ne),tt=st.text.slice(0,ge),ke=st.text.slice(ge+_e.length);if(st.text=tt+ke,e)for(var[he,De]of it.points(e))e[De]=un.transform(he,t);break}case"set_node":{var{path:Me,properties:z,newProperties:ne}=t;if(Me.length===0)throw new Error("Cannot set properties on the root node!");var se=_t.get(n,Me);for(var Ee in ne){if(Ee==="children"||Ee==="text")throw new Error('Cannot set the "'.concat(Ee,'" property of nodes!'));var fe=ne[Ee];fe==null?delete se[Ee]:se[Ee]=fe}for(var Le in z)ne.hasOwnProperty(Le)||delete se[Le];break}case"set_selection":{var{newProperties:Ie}=t;if(Ie==null)e=Ie;else{if(e==null){if(!it.isRange(Ie))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(JSON.stringify(Ie)," when there is no current selection."));e=Us({},Ie)}for(var Ve in Ie){var et=Ie[Ve];if(et==null){if(Ve==="anchor"||Ve==="focus")throw new Error('Cannot remove the "'.concat(Ve,'" selection property'));delete e[Ve]}else e[Ve]=et}}break}case"split_node":{var{path:nt,position:We,properties:lt}=t;if(nt.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(nt,"] because the root node cannot be split."));var de=_t.get(n,nt),pe=_t.parent(n,nt),xe=nt[nt.length-1],Ce;if(jt.isText(de)){var Fe=de.text.slice(0,We),Ue=de.text.slice(We);de.text=Fe,Ce=Us(Us({},lt),{},{text:Ue})}else{var qe=de.children.slice(0,We),at=de.children.slice(We);de.children=qe,Ce=Us(Us({},lt),{},{children:at})}if(pe.children.splice(xe+1,0,Ce),e)for(var[bt,Xt]of it.points(e))e[Xt]=un.transform(bt,t);break}}return e},L5={transform(n,e){n.children=fp(n.children);var t=n.selection&&fp(n.selection);try{t=B5(n,t,e)}finally{n.children=pp(n.children),t?n.selection=Nr(t)?pp(t):t:n.selection=null}}},I5=["text"],F5=["children"];function Mp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Tp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mp(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Mp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var j5={insertNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1,mode:r="lowest"}=t,{at:s,match:a,select:l}=t;if(_t.isNode(e)&&(e=[e]),e.length!==0){var[u]=e;if(s||(n.selection?s=n.selection:n.children.length>0?s=ue.end(n,[]):s=[0],l=!0),l==null&&(l=!1),it.isRange(s))if(o||(s=ue.unhangRange(n,s)),it.isCollapsed(s))s=s.anchor;else{var[,c]=it.edges(s),f=ue.pointRef(n,c);$t.delete(n,{at:s}),s=f.unref()}if(un.isPoint(s)){a==null&&(jt.isText(u)?a=k=>jt.isText(k):n.isInline(u)?a=k=>jt.isText(k)||ue.isInline(n,k):a=k=>ue.isBlock(n,k));var[p]=ue.nodes(n,{at:s.path,match:a,mode:r,voids:i});if(p){var[,h]=p,g=ue.pathRef(n,h),m=ue.isEnd(n,s,h);$t.splitNodes(n,{at:s,match:a,mode:r,voids:i});var _=g.unref();s=m?Ae.next(_):_}else return}var v=Ae.parent(s),b=s[s.length-1];if(!(!i&&ue.void(n,{at:v}))){for(var C of e){var M=v.concat(b);b++,n.apply({type:"insert_node",path:M,node:C}),s=Ae.next(s)}if(s=Ae.previous(s),l){var O=ue.end(n,s);O&&$t.select(n,O)}}}})},liftNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{at:t=n.selection,mode:o="lowest",voids:i=!1}=e,{match:r}=e;if(r==null&&(r=Ae.isPath(t)?Hr(n,t):C=>ue.isBlock(n,C)),!!t){var s=ue.nodes(n,{at:t,match:r,mode:o,voids:i}),a=Array.from(s,C=>{var[,M]=C;return ue.pathRef(n,M)});for(var l of a){var u=l.unref();if(u.length<2)throw new Error("Cannot lift node at a path [".concat(u,"] because it has a depth of less than `2`."));var c=ue.node(n,Ae.parent(u)),[f,p]=c,h=u[u.length-1],{length:g}=f.children;if(g===1){var m=Ae.next(p);$t.moveNodes(n,{at:u,to:m,voids:i}),$t.removeNodes(n,{at:p,voids:i})}else if(h===0)$t.moveNodes(n,{at:u,to:p,voids:i});else if(h===g-1){var _=Ae.next(p);$t.moveNodes(n,{at:u,to:_,voids:i})}else{var v=Ae.next(u),b=Ae.next(p);$t.splitNodes(n,{at:v,voids:i}),$t.moveNodes(n,{at:u,to:b,voids:i})}}}})},mergeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{match:t,at:o=n.selection}=e,{hanging:i=!1,voids:r=!1,mode:s="lowest"}=e;if(o){if(t==null)if(Ae.isPath(o)){var[a]=ue.parent(n,o);t=N=>a.children.includes(N)}else t=N=>ue.isBlock(n,N);if(!i&&it.isRange(o)&&(o=ue.unhangRange(n,o)),it.isRange(o))if(it.isCollapsed(o))o=o.anchor;else{var[,l]=it.edges(o),u=ue.pointRef(n,l);$t.delete(n,{at:o}),o=u.unref(),e.at==null&&$t.select(n,o)}var[c]=ue.nodes(n,{at:o,match:t,voids:r,mode:s}),f=ue.previous(n,{at:o,match:t,voids:r,mode:s});if(!(!c||!f)){var[p,h]=c,[g,m]=f;if(!(h.length===0||m.length===0)){var _=Ae.next(m),v=Ae.common(h,m),b=Ae.isSibling(h,m),C=Array.from(ue.levels(n,{at:h}),N=>{var[L]=N;return L}).slice(v.length).slice(0,-1),M=ue.above(n,{at:h,mode:"highest",match:N=>C.includes(N)&&Ug(n,N)}),O=M&&ue.pathRef(n,M[1]),k,E;if(jt.isText(p)&&jt.isText(g)){var S=Pi(p,I5);E=g.text.length,k=S}else if(An.isElement(p)&&An.isElement(g)){var S=Pi(p,F5);E=g.children.length,k=S}else throw new Error("Cannot merge the node at path [".concat(h,"] with the previous sibling because it is not the same kind: ").concat(JSON.stringify(p)," ").concat(JSON.stringify(g)));b||$t.moveNodes(n,{at:h,to:_,voids:r}),O&&$t.removeNodes(n,{at:O.current,voids:r}),An.isElement(g)&&ue.isEmpty(n,g)||jt.isText(g)&&g.text===""&&m[m.length-1]!==0?$t.removeNodes(n,{at:m,voids:r}):n.apply({type:"merge_node",path:_,position:E,properties:k}),O&&O.unref()}}}})},moveNodes(n,e){ue.withoutNormalizing(n,()=>{var{to:t,at:o=n.selection,mode:i="lowest",voids:r=!1}=e,{match:s}=e;if(o){s==null&&(s=Ae.isPath(o)?Hr(n,o):h=>ue.isBlock(n,h));var a=ue.pathRef(n,t),l=ue.nodes(n,{at:o,match:s,mode:i,voids:r}),u=Array.from(l,h=>{var[,g]=h;return ue.pathRef(n,g)});for(var c of u){var f=c.unref(),p=a.current;f.length!==0&&n.apply({type:"move_node",path:f,newPath:p}),a.current&&Ae.isSibling(p,f)&&Ae.isAfter(p,f)&&(a.current=Ae.next(a.current))}a.unref()}})},removeNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{hanging:t=!1,voids:o=!1,mode:i="lowest"}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Ae.isPath(r)?Hr(n,r):p=>ue.isBlock(n,p)),!t&&it.isRange(r)&&(r=ue.unhangRange(n,r));var a=ue.nodes(n,{at:r,match:s,mode:i,voids:o}),l=Array.from(a,p=>{var[,h]=p;return ue.pathRef(n,h)});for(var u of l){var c=u.unref();if(c){var[f]=ue.node(n,c);n.apply({type:"remove_node",path:c,node:f})}}}})},setNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue.withoutNormalizing(n,()=>{var{match:o,at:i=n.selection}=t,{hanging:r=!1,mode:s="lowest",split:a=!1,voids:l=!1}=t;if(i){if(o==null&&(o=Ae.isPath(i)?Hr(n,i):O=>ue.isBlock(n,O)),!r&&it.isRange(i)&&(i=ue.unhangRange(n,i)),a&&it.isRange(i)){if(it.isCollapsed(i)&&ue.leaf(n,i.anchor)[0].text.length>0)return;var u=ue.rangeRef(n,i,{affinity:"inward"}),[c,f]=it.edges(i),p=s==="lowest"?"lowest":"highest",h=ue.isEnd(n,f,f.path);$t.splitNodes(n,{at:f,match:o,mode:p,voids:l,always:!h});var g=ue.isStart(n,c,c.path);$t.splitNodes(n,{at:c,match:o,mode:p,voids:l,always:!g}),i=u.unref(),t.at==null&&$t.select(n,i)}for(var[m,_]of ue.nodes(n,{at:i,match:o,mode:s,voids:l})){var v={},b={};if(_.length!==0){var C=!1;for(var M in e)M==="children"||M==="text"||e[M]!==m[M]&&(C=!0,m.hasOwnProperty(M)&&(v[M]=m[M]),e[M]!=null&&(b[M]=e[M]));C&&n.apply({type:"set_node",path:_,properties:v,newProperties:b})}}}})},splitNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{mode:t="lowest",voids:o=!1}=e,{match:i,at:r=n.selection,height:s=0,always:a=!1}=e;if(i==null&&(i=V=>ue.isBlock(n,V)),it.isRange(r)&&(r=V5(n,r)),Ae.isPath(r)){var l=r,u=ue.point(n,l),[c]=ue.parent(n,l);i=V=>V===c,s=u.path.length-l.length+1,r=u,a=!0}if(r){var f=ue.pointRef(n,r,{affinity:"backward"}),[p]=ue.nodes(n,{at:r,match:i,mode:t,voids:o});if(p){var h=ue.void(n,{at:r,mode:"highest"}),g=0;if(!o&&h){var[m,_]=h;if(An.isElement(m)&&n.isInline(m)){var v=ue.after(n,_);if(!v){var b={text:""},C=Ae.next(_);$t.insertNodes(n,b,{at:C,voids:o}),v=ue.point(n,C)}r=v,a=!0}var M=r.path.length-_.length;s=M+1,a=!0}var O=ue.pointRef(n,r),k=r.path.length-s,[,E]=p,S=r.path.slice(0,k),N=s===0?r.offset:r.path[k]+g;for(var[L,$]of ue.levels(n,{at:S,reverse:!0,voids:o})){var B=!1;if($.length<E.length||$.length===0||!o&&ue.isVoid(n,L))break;var A=f.current,D=ue.isEnd(n,A,$);if(a||!f||!ue.isEdge(n,A,$)){B=!0;var T=_t.extractProps(L);n.apply({type:"split_node",path:$,position:N,properties:T})}N=$[$.length-1]+(B||D?1:0)}if(e.at==null){var F=O.current||ue.end(n,[]);$t.select(n,F)}f.unref(),O.unref()}}})},unsetNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(e)||(e=[e]);var o={};for(var i of e)o[i]=null;$t.setNodes(n,o,t)},unwrapNodes(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{mode:t="lowest",split:o=!1,voids:i=!1}=e,{at:r=n.selection,match:s}=e;if(r){s==null&&(s=Ae.isPath(r)?Hr(n,r):p=>ue.isBlock(n,p)),Ae.isPath(r)&&(r=ue.range(n,r));var a=it.isRange(r)?ue.rangeRef(n,r):null,l=ue.nodes(n,{at:r,match:s,mode:t,voids:i}),u=Array.from(l,p=>{var[,h]=p;return ue.pathRef(n,h)}).reverse(),c=function(h){var g=h.unref(),[m]=ue.node(n,g),_=ue.range(n,g);o&&a&&(_=it.intersection(a.current,_)),$t.liftNodes(n,{at:_,match:v=>An.isAncestor(m)&&m.children.includes(v),voids:i})};for(var f of u)c(f);a&&a.unref()}})},wrapNodes(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue.withoutNormalizing(n,()=>{var{mode:o="lowest",split:i=!1,voids:r=!1}=t,{match:s,at:a=n.selection}=t;if(a){if(s==null&&(Ae.isPath(a)?s=Hr(n,a):n.isInline(e)?s=_=>ue.isInline(n,_)||jt.isText(_):s=_=>ue.isBlock(n,_)),i&&it.isRange(a)){var[l,u]=it.edges(a),c=ue.rangeRef(n,a,{affinity:"inward"});$t.splitNodes(n,{at:u,match:s,voids:r}),$t.splitNodes(n,{at:l,match:s,voids:r}),a=c.unref(),t.at==null&&$t.select(n,a)}var f=Array.from(ue.nodes(n,{at:a,match:n.isInline(e)?_=>ue.isBlock(n,_):_=>ue.isEditor(_),mode:"lowest",voids:r}));for(var[,p]of f){var h=it.isRange(a)?it.intersection(a,ue.range(n,p)):a;if(h){var g=Array.from(ue.nodes(n,{at:h,match:s,mode:o,voids:r}));if(g.length>0){var m=(function(){var[_]=g,v=g[g.length-1],[,b]=_,[,C]=v;if(b.length===0&&C.length===0)return"continue";var M=Ae.equals(b,C)?Ae.parent(b):Ae.common(b,C),O=ue.range(n,b,C),k=ue.node(n,M),[E]=k,S=M.length+1,N=Ae.next(C.slice(0,S)),L=Tp(Tp({},e),{},{children:[]});$t.insertNodes(n,L,{at:N,voids:r}),$t.moveNodes(n,{at:O,match:$=>An.isAncestor(E)&&E.children.includes($),to:N.concat(0),voids:r})})();if(m==="continue")continue}}}}})}},Ug=(n,e)=>{if(An.isElement(e)){var t=e;return ue.isVoid(n,e)?!0:t.children.length===1?Ug(n,t.children[0]):!1}else return!ue.isEditor(e)},V5=(n,e)=>{if(it.isCollapsed(e))return e.anchor;var[,t]=it.edges(e),o=ue.pointRef(n,t);return $t.delete(n,{at:e}),o.unref()},Hr=(n,e)=>{var[t]=ue.node(n,e);return o=>o===t};function $p(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function Pp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$p(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$p(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var H5={collapse(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:t="anchor"}=e,{selection:o}=n;if(o){if(t==="anchor")$t.select(n,o.anchor);else if(t==="focus")$t.select(n,o.focus);else if(t==="start"){var[i]=it.edges(o);$t.select(n,i)}else if(t==="end"){var[,r]=it.edges(o);$t.select(n,r)}}else return},deselect(n){var{selection:e}=n;e&&n.apply({type:"set_selection",properties:e,newProperties:null})},move(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:t}=n,{distance:o=1,unit:i="character",reverse:r=!1}=e,{edge:s=null}=e;if(t){s==="start"&&(s=it.isBackward(t)?"focus":"anchor"),s==="end"&&(s=it.isBackward(t)?"anchor":"focus");var{anchor:a,focus:l}=t,u={distance:o,unit:i},c={};if(s==null||s==="anchor"){var f=r?ue.before(n,a,u):ue.after(n,a,u);f&&(c.anchor=f)}if(s==null||s==="focus"){var p=r?ue.before(n,l,u):ue.after(n,l,u);p&&(c.focus=p)}$t.setSelection(n,c)}},select(n,e){var{selection:t}=n;if(e=ue.range(n,e),t){$t.setSelection(n,e);return}if(!it.isRange(e))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(JSON.stringify(e)));n.apply({type:"set_selection",properties:t,newProperties:e})},setPoint(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:o}=n,{edge:i="both"}=t;if(o){i==="start"&&(i=it.isBackward(o)?"focus":"anchor"),i==="end"&&(i=it.isBackward(o)?"anchor":"focus");var{anchor:r,focus:s}=o,a=i==="anchor"?r:s;$t.setSelection(n,{[i==="anchor"?"anchor":"focus"]:Pp(Pp({},a),e)})}},setSelection(n,e){var{selection:t}=n,o={},i={};if(t){for(var r in e)(r==="anchor"&&e.anchor!=null&&!un.equals(e.anchor,t.anchor)||r==="focus"&&e.focus!=null&&!un.equals(e.focus,t.focus)||r!=="anchor"&&r!=="focus"&&e[r]!==t[r])&&(o[r]=t[r],i[r]=e[r]);Object.keys(o).length>0&&n.apply({type:"set_selection",properties:o,newProperties:i})}}},U5={delete(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ue.withoutNormalizing(n,()=>{var{reverse:t=!1,unit:o="character",distance:i=1,voids:r=!1}=e,{at:s=n.selection,hanging:a=!1}=e;if(s){if(it.isRange(s)&&it.isCollapsed(s)&&(s=s.anchor),un.isPoint(s)){var l=ue.void(n,{at:s,mode:"highest"});if(!r&&l){var[,u]=l;s=u}else{var c={unit:o,distance:i},f=t?ue.before(n,s,c)||ue.start(n,[]):ue.after(n,s,c)||ue.end(n,[]);s={anchor:s,focus:f},a=!0}}if(Ae.isPath(s)){$t.removeNodes(n,{at:s,voids:r});return}if(!it.isCollapsed(s)){if(!a){var[,p]=it.edges(s),h=ue.end(n,[]);un.equals(p,h)||(s=ue.unhangRange(n,s,{voids:r}))}var[g,m]=it.edges(s),_=ue.above(n,{match:ve=>ue.isBlock(n,ve),at:g,voids:r}),v=ue.above(n,{match:ve=>ue.isBlock(n,ve),at:m,voids:r}),b=_&&v&&!Ae.equals(_[1],v[1]),C=Ae.equals(g.path,m.path),M=r?null:ue.void(n,{at:g,mode:"highest"}),O=r?null:ue.void(n,{at:m,mode:"highest"});if(M){var k=ue.before(n,g);k&&_&&Ae.isAncestor(_[1],k.path)&&(g=k)}if(O){var E=ue.after(n,m);E&&v&&Ae.isAncestor(v[1],E.path)&&(m=E)}var S=[],N;for(var L of ue.nodes(n,{at:s,voids:r})){var[$,B]=L;N&&Ae.compare(B,N)===0||(!r&&ue.isVoid(n,$)||!Ae.isCommon(B,g.path)&&!Ae.isCommon(B,m.path))&&(S.push(L),N=B)}var A=Array.from(S,ve=>{var[,Ne]=ve;return ue.pathRef(n,Ne)}),D=ue.pointRef(n,g),T=ue.pointRef(n,m);if(!C&&!M){var F=D.current,[V]=ue.leaf(n,F),{path:P}=F,{offset:X}=g,oe=V.text.slice(X);oe.length>0&&n.apply({type:"remove_text",path:P,offset:X,text:oe})}for(var H of A){var W=H.unref();$t.removeNodes(n,{at:W,voids:r})}if(!O){var Z=T.current,[le]=ue.leaf(n,Z),{path:te}=Z,q=C?g.offset:0,re=le.text.slice(q,m.offset);re.length>0&&n.apply({type:"remove_text",path:te,offset:q,text:re})}!C&&b&&T.current&&D.current&&$t.mergeNodes(n,{at:T.current,hanging:!0,voids:r});var ce=t?D.unref()||T.unref():T.unref()||D.unref();e.at==null&&ce&&$t.select(n,ce)}}})},insertFragment(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue.withoutNormalizing(n,()=>{var{hanging:o=!1,voids:i=!1}=t,{at:r=n.selection}=t;if(e.length){if(r)if(it.isRange(r))if(o||(r=ue.unhangRange(n,r)),it.isCollapsed(r))r=r.anchor;else{var[,s]=it.edges(r);if(!i&&ue.void(n,{at:s}))return;var a=ue.pointRef(n,s);$t.delete(n,{at:r}),r=a.unref()}else Ae.isPath(r)&&(r=ue.start(n,r));else return;if(!(!i&&ue.void(n,{at:r}))){var l=ue.above(n,{at:r,match:le=>ue.isInline(n,le),mode:"highest",voids:i});if(l){var[,u]=l;if(ue.isEnd(n,r,u)){var c=ue.after(n,u);r=c}else if(ue.isStart(n,r,u)){var f=ue.before(n,u);r=f}}var p=ue.above(n,{match:le=>ue.isBlock(n,le),at:r,voids:i}),[,h]=p,g=ue.isStart(n,r,h),m=ue.isEnd(n,r,h),_=g&&m,v=!g||g&&m,b=!m,[,C]=_t.first({children:e},[]),[,M]=_t.last({children:e},[]),O=[],k=le=>{var[te,q]=le,re=q.length===0;return re?!1:_?!0:!(v&&Ae.isAncestor(q,C)&&An.isElement(te)&&!n.isVoid(te)&&!n.isInline(te)||b&&Ae.isAncestor(q,M)&&An.isElement(te)&&!n.isVoid(te)&&!n.isInline(te))};for(var E of _t.nodes({children:e},{pass:k}))k(E)&&O.push(E);var S=[],N=[],L=[],$=!0,B=!1;for(var[A]of O)An.isElement(A)&&!n.isInline(A)?($=!1,B=!0,N.push(A)):$?S.push(A):L.push(A);var[D]=ue.nodes(n,{at:r,match:le=>jt.isText(le)||ue.isInline(n,le),mode:"highest",voids:i}),[,T]=D,F=ue.isStart(n,r,T),V=ue.isEnd(n,r,T),P=ue.pathRef(n,m?Ae.next(h):h),X=ue.pathRef(n,V?Ae.next(T):T),oe=ue.pathRef(n,h);$t.splitNodes(n,{at:r,match:le=>B?ue.isBlock(n,le):jt.isText(le)||ue.isInline(n,le),mode:B?"lowest":"highest",voids:i});var H=ue.pathRef(n,!F||F&&V?Ae.next(T):T);if($t.insertNodes(n,S,{at:H.current,match:le=>jt.isText(le)||ue.isInline(n,le),mode:"highest",voids:i}),_&&N.length&&$t.delete(n,{at:oe.unref(),voids:i}),$t.insertNodes(n,N,{at:P.current,match:le=>ue.isBlock(n,le),mode:"lowest",voids:i}),$t.insertNodes(n,L,{at:X.current,match:le=>jt.isText(le)||ue.isInline(n,le),mode:"highest",voids:i}),!t.at){var W;L.length>0?W=Ae.previous(X.current):N.length>0?W=Ae.previous(P.current):W=Ae.previous(H.current);var Z=ue.end(n,W);$t.select(n,Z)}H.unref(),P.unref(),X.unref()}}})},insertText(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ue.withoutNormalizing(n,()=>{var{voids:o=!1}=t,{at:i=n.selection}=t;if(i){if(Ae.isPath(i)&&(i=ue.range(n,i)),it.isRange(i))if(it.isCollapsed(i))i=i.anchor;else{var r=it.end(i);if(!o&&ue.void(n,{at:r}))return;var s=it.start(i),a=ue.pointRef(n,s);$t.delete(n,{at:i,voids:o}),i=a.unref(),$t.setSelection(n,{anchor:i,focus:i})}if(!(!o&&ue.void(n,{at:i}))){var{path:l,offset:u}=i;e.length>0&&n.apply({type:"insert_text",path:l,offset:u,text:e})}}})}};function Rp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function nl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rp(Object(t),!0).forEach(function(o){ji(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rp(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}var $t=nl(nl(nl(nl({},L5),j5),H5),U5);const z5={class:"editor-box"},q5={class:"field-list-item"},G5={class:"field-label"},X5={class:"field-type"},W5={__name:"draft-news-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=G(!1),s=Vf(),a=Vf(null),l=G("default"),u=G(""),c=G({excludeKeys:["insertTable","codeBlock","uploadVideo","group-video"]}),f={placeholder:"请输入内容，键入“/”可以插入变量",MENU_CONF:{uploadImage:{async customUpload(D,T){var P;const F=await Zm(D),V=await Bo({name:"official_draft",action:"default/exec",params:JSON.stringify({business:"upload_image",arguments:{...i.appData,media:F}})});T((P=V==null?void 0:V.data)==null?void 0:P.url)}}}},p=G(!1),h=G({});G([]);const g=G([]),m=G([]),_=G(new Set);no(()=>{const D=s.value;D!=null&&D.destroy()});function v(D="",T=[]){b(D,T),r.value=!0}function b(D,T){let F=Qm(i.variableOptions);m.value=T,g.value=[...T,...F].filter(P=>P&&P.value&&P.value!=""&&P.typ!=="node");const V=new Set;for(let P of g.value)D=C(D,P,V);u.value=D}function C(D,T,F){const V=new RegExp(`(${T.value})`,"g");if(!F.has(T.value)&&V.test(D)){let P=T.node_name+"."+T.text;P=P.replace(/\./g,"/"),D=D.replace(V,`<a href="zm-variable:${T.value}" target="_blank"><strong>${P}</strong></a>`),F.add(T.value)}return D}function M(D){s.value=D}function O(D){const{selection:T}=D;if(!T||!it.isCollapsed(T)){p.value=!1;return}const F=T.focus.path,V=T.focus.offset;ue.string(D,F)[V-1]==="/"?(a.value=D,p.value=!0,E()):p.value=!1}function k(){const D=window.getSelection();if(!D||D.rangeCount===0)return null;const T=D.getRangeAt(0);if(!T.collapsed)return null;let F=T.getClientRects()[0];if(F)return F;const V=document.createElement("span");return V.textContent="​",V.style.display="inline-block",T.insertNode(V),F=V.getBoundingClientRect(),V.remove(),F}function E(D){const T=k();if(!T)return;const F=T.left+window.scrollX,V=T.bottom+window.scrollY+6;h.value=`left:${F}px; top:${V}px;`}function S(D,T,F){let V=F[F.length-1];delete V.children,N(V)}function N(D,T=!1){if(!D)return;p.value=!1;let F=D.node_name+"."+D.text;F=F.replace(/\./g,"/");const V={id:D.id,label:D.label,value:D.value,text:D.text,index:m.value.length};m.value.push(D);const P=new Set(_.value);P.add(D.value),_.value=P,T||L(F,V)}function L(D,T){const F=a.value,{selection:V}=F;V&&(it.isCollapsed(V)||ue.deleteFragment(F),ue.deleteBackward(F,"character"),ue.insertNode(F,{type:"link",url:`zm-variable:${T.value}`,children:[{text:D,bold:!0}]}),ue.insertText(F," "))}function $(D,T){const F=h.value.match(/left:\s*(-?\d+\.?\d*)px/),V=h.value.match(/top:\s*(-?\d+\.?\d*)px/);if(!F||!V)return;const P=parseFloat(F[1]),X=parseFloat(V[1]);let oe;D==="left"?oe=P-T:oe=P+T,h.value=`left:${oe}px; top:${X}px;`}function B(D){if(typeof D!="string")return"";const T=D.match(/^<div[^>]*class=["'][^"']*\bzm-editor-root\b[^"']*["'][^>]*>([\s\S]*)<\/div>$/);return T?T[1]:D}function A(){let D=Bn(u.value),T={};m.value.forEach(V=>{!T[V.value]&&D.indexOf(V.value)>-1&&(T[V.value]=V)});let F=Object.values(T);D=B(D),D=D.replace(/<a[^>]*href="zm-variable:([^"]+)"[^>]*>[\s\S]*?<\/a>/g,"$1"),o("change",D,Bn(F)),r.value=!1}return e({show:v}),(D,T)=>{const F=Fr,V=vn;return w(),Q(V,{title:"正文内容",width:"880px",open:r.value,"onUpdate:open":T[1]||(T[1]=P=>r.value=P),onOk:A},{default:x(()=>[y(F,{type:"info",class:"zm-alert-info"},{message:x(()=>[...T[2]||(T[2]=[U(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),d("div",z5,[y(K(Aw),{style:{"border-bottom":"1px solid #ccc"},editor:s.value,defaultConfig:c.value,mode:l.value},null,8,["editor","defaultConfig","mode"]),y(K(Ow),{style:{height:"480px","overflow-y":"hidden"},modelValue:u.value,"onUpdate:modelValue":T[0]||(T[0]=P=>u.value=P),defaultConfig:f,mode:l.value,onOnCreated:M,onOnChange:O},null,8,["modelValue","mode"])]),p.value?(w(),R("div",{key:0,style:In(h.value),class:"dropdown-list",ref:"dropdownList"},[y(Og,{options:n.variableOptions,onChange:S,onDirectionChange:$},{option:x(({label:P,payload:X})=>[d("div",q5,[d("div",G5,j(P),1),d("div",X5,j(X.typ),1)])]),_:1},8,["options"])],4)):ie("",!0)]),_:1},8,["open"])}}},Y5=Te(W5,[["__scopeId","data-v-1306ac74"]]),K5={class:"field-list-item"},J5={class:"field-label"},Z5={class:"field-type"},Q5={__name:"draft-newspic-cont",props:{appData:{type:Object,default:()=>({})},variableOptions:{type:Array},defaultSelectedList:{type:Array,default:()=>[]}},emits:["change","updateVar"],setup(n,{expose:e,emit:t}){const o=t,i=G(!1),r=G(""),s=G([]);function a(c="",f=[]){r.value=c,s.value=f,i.value=!0}function l(c,f){r.value=c,s.value=f}function u(){o("change",Bn(r.value),Bn(s.value)),i.value=!1}return e({show:a}),(c,f)=>{const p=Fr,h=vn;return w(),Q(h,{title:"正文内容",width:"880px",open:i.value,"onUpdate:open":f[1]||(f[1]=g=>i.value=g),onOk:u},{default:x(()=>[y(p,{type:"info",class:"zm-alert-info"},{message:x(()=>[...f[2]||(f[2]=[U(' 图文消息的具体内容，支持HTML标签，必须少于2万字符，小于1M，且此处会去除JS,涉及图片url必须来源 "上传图文消息内的图片获取URL"接口获取。外部图片url将被过滤。 图片消息则仅支持纯文本和部分特殊功能标签如商品，商品个数不可超过50个 ',-1)])]),_:1}),y(ot,{style:{"margin-top":"16px"},type:"textarea",inputStyle:"height: 420px;",options:n.variableOptions,defaultSelectedList:s.value||[],defaultValue:r.value,ref:"atInputRef",onOpen:f[0]||(f[0]=g=>o("updateVar")),onChange:l,placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:g,payload:m})=>[d("div",K5,[d("div",J5,j(g),1),d("div",Z5,j(m.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1},8,["open"])}}},eB={class:"article-container"},tB={class:"node-options"},nB={class:"options-item is-required"},oB={class:"options-item is-required"},iB={class:"node-options article-form-box"},rB={key:0,class:"options-item"},sB={class:"news-tabs"},aB=["onClick"],lB={class:"options-item baseline is-required"},uB={style:{width:"100%"}},dB={class:"field-list-item"},cB={class:"field-label"},fB={class:"field-type"},pB={class:"options-item baseline is-required"},hB={class:"field-list-item"},vB={class:"field-label"},gB={class:"field-type"},_B={class:"options-item is-required"},mB={class:"field-list-item"},yB={class:"field-label"},bB={class:"field-type"},xB={class:"options-item"},wB={class:"field-list-item"},CB={class:"field-label"},SB={class:"field-type"},kB={class:"options-item"},EB={class:"field-list-item"},DB={class:"field-label"},AB={class:"field-type"},OB={class:"options-item is-required"},NB={class:"cont-box"},MB={class:"field-list-item"},TB={class:"field-label"},$B={class:"field-type"},PB={class:"options-item"},RB={class:"field-list-item"},BB={class:"field-label"},LB={class:"field-type"},IB={class:"options-item is-required baseline"},FB={style:{flex:"1"}},jB={class:"field-list-item"},VB={class:"field-label"},HB={class:"field-type"},UB={class:"options-item"},zB={class:"options-item"},qB={class:"options-item is-required baseline"},GB={class:"img-box"},XB={class:"field-list-item"},WB={class:"field-label"},YB={class:"field-type"},KB={class:"options-item baseline"},JB={class:"img-box"},ZB={class:"field-list-item"},QB={class:"field-label"},eL={class:"field-type"},tL={class:"node-options"},nL={class:"options-item"},oL={__name:"official-draft-store",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=G(null),s=G([]),a=G([]),l={title:"",article_type:"",author:"",digest:"",content:"",content_source_url:"",need_open_comment:0,only_fans_can_comment:0,pic_crop_235_1:"",pic_crop_1_1:"",thumb_type:1,thumb_media_id:"",image_info:[{value:"",tags:[]}],product_info:[{value:"",tags:[]}],cover_info:[{value:"",tags:[]}],tag_map:{}},u=Je({app_id:void 0,app_secret:"",app_name:"",article_type:"news",articles:[],media_id:"",index:0,tag_map:{}}),c=G(0),f=Xe(()=>u.articles[c.value]||l),p=[{label:"素材url",value:1},{label:"素材MedialD",value:2}],h=[{label:"关闭",value:0},{label:"打开",value:1}],g=[{label:"所有人可评论",value:0},{label:"粉丝才可评论",value:1}];ut(()=>{m()}),gt(()=>o.action,()=>{var T;s.value=Ci(JSON.parse(JSON.stringify(((T=o.action)==null?void 0:T.output)||"{}")))},{deep:!0,immediate:!0});function m(){_(),L(),v()}function _(){Rr({app_type:"official_account"}).then(T=>{a.value=(T==null?void 0:T.data)||[]})}function v(){var V,P;let T=JSON.parse(o.node.node_params),F=((P=(V=T==null?void 0:T.plugin)==null?void 0:V.params)==null?void 0:P.arguments)||{};if(o.actionName==="update_draft"&&F.articles&&Object.keys(F.articles).length&&(F.articles=[F.articles]),Object.assign(u,F),!u.app_id){let X=Po(window.localStorage.getItem("zm:ai:draft:last:app"));X&&(Object.assign(u,X),D())}}function b(T,F){const{key:V,secret:P,name:X}=F;u.app_secret=P,u.app_name=X,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:V,app_secret:P,app_name:X})),D()}function C(){u.articles=[],L()}function M(T,F){c.value=F}function O(T,F,V){u[T]=F,u.tag_map[T]=V,D()}function k(T,F,V){f.value[T]=F,f.value.tag_map[T]=V,D()}function E(T,F,V){T.value=F,T.tags=V,D()}function S(){r.value.show(f.value.content,f.value.tag_map.content||[])}function N(T,F){f.value.content=T,f.value.tag_map.content=F||[],D()}function L(){let T=JSON.parse(JSON.stringify(l));T.article_type=u.article_type,u.articles.push(T)}function $(T){u.articles.splice(T,1),D()}function B(T){u.articles[c.value][T].push({value:"",tags:[]})}function A(T,F){u.articles[c.value][T].splice(F,1)}function D(){Pt(()=>{let T=JSON.parse(o.node.node_params);T.plugin.output_obj=s.value;let F={...u};o.actionName==="update_draft"&&(F.articles=F.articles[0]),Object.assign(T.plugin.params,{arguments:{...F}}),i({...o.node,node_params:JSON.stringify(T)})})}return(T,F)=>{var Z,le,te,q,re,ce,ve,Ne;const V=Vt,P=It,X=Ii,oe=Li,H=Qt,W=Kt;return w(),R("div",eB,[d("div",tB,[F[29]||(F[29]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Fg,class:"title-icon"}),U(" 基础信息")])],-1)),d("div",nB,[F[25]||(F[25]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(P,{value:u.app_id,"onUpdate:value":F[0]||(F[0]=ge=>u.app_id=ge),placeholder:"请选择公众号",style:{width:"100%"},onChange:b},{default:x(()=>[(w(!0),R(ae,null,ye(a.value,ge=>(w(),Q(V,{key:ge.app_id,name:ge.app_name,secret:ge.app_secret},{default:x(()=>[U(j(ge.app_name),1)]),_:2},1032,["name","secret"]))),128))]),_:1},8,["value"])])]),d("div",oB,[F[28]||(F[28]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章类型")],-1)),d("div",null,[y(oe,{value:u.article_type,"onUpdate:value":F[1]||(F[1]=ge=>u.article_type=ge),onChange:C},{default:x(()=>[y(X,{value:"news"},{default:x(()=>[...F[26]||(F[26]=[U("图文消息",-1)])]),_:1}),y(X,{value:"newspic"},{default:x(()=>[...F[27]||(F[27]=[U("图片消息",-1)])]),_:1})]),_:1},8,["value"])])])]),d("div",iB,[F[46]||(F[46]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")]),d("a",{href:"https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_add.html",style:{"font-weight":"400"},target:"_blank"},"查看帮助文档")],-1)),n.actionName==="add_draft"?(w(),R("div",rB,[d("div",sB,[(w(!0),R(ae,null,ye(u.articles,(ge,_e)=>(w(),R("div",{key:_e,class:Ct(["news-item",{active:_e==c.value}]),onClick:st=>M(ge,_e)},[U(j(_e==0?"主图文":`副图文${_e}`)+" ",1),u.articles.length>1?(w(),Q(K(pg),{key:0,class:"del-icon",onClick:St(st=>$(_e),["stop"])},null,8,["onClick"])):ie("",!0)],10,aB))),128)),u.articles.length<8?(w(),R("div",{key:0,class:"news-item",onClick:L},[y(K(Ht))])):ie("",!0)])])):(w(),R(ae,{key:1},[d("div",lB,[F[31]||(F[31]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章ID")],-1)),d("div",uB,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Z=u.tag_map)==null?void 0:Z.media_id)||[],defaultValue:u.media_id,ref:"atInputRef",onOpen:F[2]||(F[2]=ge=>t("updateVar")),onChange:F[3]||(F[3]=(ge,_e)=>O("media_id",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",dB,[d("div",cB,j(ge),1),d("div",fB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[30]||(F[30]=d("div",{class:"desc"},"文章media_id",-1))])]),d("div",pB,[F[33]||(F[33]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章位置")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((le=u.tag_map)==null?void 0:le.index)||[],defaultValue:u.index,ref:"atInputRef",onOpen:F[4]||(F[4]=ge=>t("updateVar")),onChange:F[5]||(F[5]=(ge,_e)=>O("index",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",hB,[d("div",vB,j(ge),1),d("div",gB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),F[32]||(F[32]=d("div",{class:"desc"},"要更新的文章在图文消息中的位置（多图文消息时，此字段才有意义），第一篇为0（输入0~7的正整数）",-1))])])],64)),d("div",_B,[F[34]||(F[34]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"标题")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((te=f.value.tag_map)==null?void 0:te.title)||[],defaultValue:f.value.title,ref:"atInputRef",onOpen:F[6]||(F[6]=ge=>t("updateVar")),onChange:F[7]||(F[7]=(ge,_e)=>k("title",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",mB,[d("div",yB,j(ge),1),d("div",bB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),f.value.article_type==="news"?(w(),R(ae,{key:2},[d("div",xB,[F[35]||(F[35]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"作者")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((q=f.value.tag_map)==null?void 0:q.author)||[],defaultValue:f.value.author,ref:"atInputRef",onOpen:F[8]||(F[8]=ge=>t("updateVar")),onChange:F[9]||(F[9]=(ge,_e)=>k("author",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",wB,[d("div",CB,j(ge),1),d("div",SB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),d("div",kB,[F[36]||(F[36]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"摘要")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((re=f.value.tag_map)==null?void 0:re.digest)||[],defaultValue:f.value.digest,ref:"atInputRef",onOpen:F[10]||(F[10]=ge=>t("updateVar")),onChange:F[11]||(F[11]=(ge,_e)=>k("digest",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",EB,[d("div",DB,j(ge),1),d("div",AB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])],64)):ie("",!0),d("div",OB,[F[37]||(F[37]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"正文内容")],-1)),d("div",NB,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ce=f.value.tag_map)==null?void 0:ce.content)||[],defaultValue:f.value.content,ref:"atInputRef",onOpen:F[12]||(F[12]=ge=>t("updateVar")),onChange:F[13]||(F[13]=(ge,_e)=>k("content",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",MB,[d("div",TB,j(ge),1),d("div",$B,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),y(H,{title:"编辑窗口"},{default:x(()=>[y(K(Ko),{class:"edit-icon",onClick:S})]),_:1})])]),f.value.article_type==="news"?(w(),R(ae,{key:3},[d("div",PB,[F[38]||(F[38]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"原文地址")],-1)),y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((ve=f.value.tag_map)==null?void 0:ve.content_source_url)||[],defaultValue:f.value.content_source_url,ref:"atInputRef",onOpen:F[14]||(F[14]=ge=>t("updateVar")),onChange:F[15]||(F[15]=(ge,_e)=>k("content_source_url",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",RB,[d("div",BB,j(ge),1),d("div",LB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),d("div",IB,[F[39]||(F[39]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"封面素材")],-1)),d("div",FB,[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:((Ne=f.value.tag_map)==null?void 0:Ne.thumb_media_id)||[],defaultValue:f.value.thumb_media_id,ref:"atInputRef",onOpen:F[16]||(F[16]=ge=>t("updateVar")),onChange:F[17]||(F[17]=(ge,_e)=>k("thumb_media_id",ge,_e)),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:ge,payload:_e})=>[d("div",jB,[d("div",VB,j(ge),1),d("div",HB,j(_e.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),y(ko,{class:"mt4",value:f.value.thumb_type,"onUpdate:value":F[18]||(F[18]=ge=>f.value.thumb_type=ge),options:p,onChange:D},null,8,["value"])])])],64)):ie("",!0),d("div",UB,[F[40]||(F[40]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文章评论")],-1)),y(ko,{value:f.value.need_open_comment,"onUpdate:value":F[19]||(F[19]=ge=>f.value.need_open_comment=ge),options:h,onChange:D},null,8,["value"])]),d("div",zB,[F[41]||(F[41]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"评论人群")],-1)),y(ko,{value:f.value.only_fans_can_comment,"onUpdate:value":F[20]||(F[20]=ge=>f.value.only_fans_can_comment=ge),options:g,onChange:D},null,8,["value"])]),f.value.article_type==="news"?(w(),R(ae,{key:4},[],64)):(w(),R(ae,{key:5},[d("div",qB,[F[43]||(F[43]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"图片")],-1)),d("div",GB,[(w(!0),R(ae,null,ye(f.value.image_info,(ge,_e)=>(w(),R("div",{key:_e,class:"img-item"},[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:ge.tags||[],defaultValue:ge.value,ref_for:!0,ref:"atInputRef",onOpen:F[21]||(F[21]=st=>t("updateVar")),onChange:(st,tt)=>E(ge,st,tt),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:st,payload:tt})=>[d("div",XB,[d("div",WB,j(st),1),d("div",YB,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),y(K(Jt),{onClick:st=>A("image_info",_e)},null,8,["onClick"])]))),128)),f.value.image_info.length<20?(w(),Q(W,{key:0,type:"dashed",icon:Tt(K(Ht)),onClick:F[22]||(F[22]=ge=>B("image_info"))},{default:x(()=>[...F[42]||(F[42]=[U("新增图片 ",-1)])]),_:1},8,["icon"])):ie("",!0)])]),d("div",KB,[F[45]||(F[45]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"封面信息")],-1)),d("div",JB,[(w(!0),R(ae,null,ye(f.value.cover_info,(ge,_e)=>(w(),R("div",{key:_e,class:"img-item"},[y(ot,{type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:ge.tags||[],defaultValue:ge.value,ref_for:!0,ref:"atInputRef",onOpen:F[23]||(F[23]=st=>t("updateVar")),onChange:(st,tt)=>E(ge,st,tt),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:st,payload:tt})=>[d("div",ZB,[d("div",QB,j(st),1),d("div",eL,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),y(K(Jt),{onClick:st=>A("cover_info",_e)},null,8,["onClick"])]))),128)),f.value.cover_info.length<5?(w(),Q(W,{key:0,type:"dashed",icon:Tt(K(Ht)),onClick:F[24]||(F[24]=ge=>B("cover_info"))},{default:x(()=>[...F[44]||(F[44]=[U("新增封面 ",-1)])]),_:1},8,["icon"])):ie("",!0)])])],64))]),d("div",tL,[F[47]||(F[47]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",nL,[y(Fi,{"tree-data":s.value},null,8,["tree-data"])])]),u.article_type==="news"?(w(),Q(Y5,{key:0,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,appData:{app_id:u.app_id,app_secret:u.app_secret},onChange:N},null,8,["variable-options","appData"])):(w(),Q(Q5,{key:1,ref_key:"newsContRef",ref:r,"variable-options":n.variableOptions,onChange:N},null,8,["variable-options"]))])}}},Bp=Te(oL,[["__scopeId","data-v-a576d9ae"]]),iL={class:"options-item is-required"},rL={key:0,class:"desc"},sL={class:"options-item is-required"},zs={__name:"official-draft-operate",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=G({}),r=G([]);ut(()=>{a(),s()});function s(){const u={...o.action.params,app_id:{...o.action.params.app_id,default:null},app_name:{desc:"公众号名称",type:"string"}};let c=Po(window.localStorage.getItem("zm:ai:draft:last:app"));c&&(u.app_id.default=c.app_id,u.app_name.default=c.app_name,u.app_secret.default=c.app_secret),o.actionName==="preview_message"?(u.type={...o.action.params.type,default:"touser"},i.value=Wc(u,["app_id","media_id","type","account"])):i.value=u}function a(){Rr({app_type:"official_account"}).then(u=>{r.value=(u==null?void 0:u.data)||[]})}function l(u,c){const{key:f,secret:p,name:h}=c;u.app_secret.value=p,u.app_name.value=h,window.localStorage.setItem("zm:ai:draft:last:app",JSON.stringify({app_id:f,app_secret:p,app_name:h}))}return(u,c)=>{const f=Vt,p=It,h=Ii,g=Li;return w(),Q(Vu,{node:n.node,params:i.value,output:n.action.output,variableOptions:n.variableOptions,onUpdateVar:c[0]||(c[0]=m=>t("updateVar"))},lg({app_name:x(()=>[]),app_secret:x(()=>[]),app_id:x(({state:m,item:_,keyName:v})=>[d("div",iL,[c[2]||(c[2]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"公众号")],-1)),d("div",null,[y(p,{value:_.value,"onUpdate:value":b=>_.value=b,placeholder:"请选择公众号",style:{width:"100%"},onChange:(b,C)=>l(m,C)},{default:x(()=>[(w(!0),R(ae,null,ye(r.value,b=>(w(),Q(f,{key:b.app_id,value:b.app_id,name:b.app_name,secret:b.app_secret},{default:x(()=>[U(j(b.app_name),1)]),_:2},1032,["value","name","secret"]))),128))]),_:1},8,["value","onUpdate:value","onChange"])]),["publish_draft","preview_message"].includes(n.actionName)?(w(),R("div",rL,[y(K(Qc)),c[1]||(c[1]=U(" 暂不支持未认证公众号、服务号 ",-1))])):ie("",!0)])]),_:2},[n.actionName==="preview_message"?{name:"type",fn:x(({state:m,item:_})=>[d("div",sL,[c[5]||(c[5]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"接受消息用户类型")],-1)),d("div",null,[y(g,{value:_.value,"onUpdate:value":v=>_.value=v},{default:x(()=>[y(h,{value:"touser"},{default:x(()=>[...c[3]||(c[3]=[U("公众号用户openid",-1)])]),_:1}),y(h,{value:"towxname"},{default:x(()=>[...c[4]||(c[4]=[U("用户微信号（每日最高100次）",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])])])]),key:"0"}:void 0]),1032,["node","params","output","variableOptions"])}}},aL={__name:"official-draft-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t={add_draft:Bp,update_draft:Bp,delete_draft:zs,publish_draft:zs,preview_message:zs,get_draft:zs},o=e,i=n,r=Xe(()=>t[i.actionName]||zs);return(s,a)=>(w(),Q(Pu(r.value),{action:n.action,actionName:n.actionName,variableOptions:n.variableOptions,node:n.node,onUpdateVar:a[0]||(a[0]=l=>o("updateVar"))},null,40,["action","actionName","variableOptions","node"]))}},lL={class:"field-item"},uL={class:"field-key"},dL={class:"tip-content"},cL={class:"field-type"},fL={class:"field-name"},pL={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(n){const e=n,t=G([]);return(o,i)=>{const r=Nn,s=Qt,a=Zc;return w(),R("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=St(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=St(()=>{},["stop"]))},[y(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData,fieldNames:{children:"subs",key:"cu_key"}},{switcherIcon:x(({switcherCls:l})=>[d("span",{class:Ct(l)},[y(r,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:x(({dataRef:l})=>[d("div",lL,[d("span",uL,j(l.key),1),l.tip?(w(),Q(s,{key:0,overlayStyle:{maxWidth:"800px"}},{title:x(()=>[d("div",dL,j(l.tip),1)]),default:x(()=>[y(K(mt),{style:{"margin-left":"4px"}})]),_:2},1024)):ie("",!0),d("span",cL,j(l.typ),1),d("span",fL,j(l.name),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},hL=Te(pL,[["__scopeId","data-v-d58d8a03"]]),vL={class:"options-item-tit"},gL={class:"option-label"},_L=["onClick"],mL={class:"tip-content"},yL={class:"option-type"},bL={key:1,style:{"margin-left":"auto","margin-bottom":"4px"}},xL={key:0},wL={class:"desc"},CL={key:0,class:"desc",style:{color:"#FB363F"}},SL={key:1},kL={class:"desc"},EL={key:0,class:"desc",style:{color:"#FB363F"}},DL={key:2},AL={class:"desc"},OL={key:0,class:"desc",style:{color:"#FB363F"}},NL={key:3},ML={class:"desc"},TL={key:0,class:"desc",style:{color:"#FB363F"}},$L={key:4},PL={class:"tag-box"},RL={class:"field-list-item"},BL={class:"field-label"},LL={class:"field-type"},IL={class:"field-list-item"},FL={class:"field-label"},jL={class:"field-type"},VL={class:"desc"},HL={key:0,class:"desc",style:{color:"#FB363F"}},UL={key:5},zL={class:"tag-box"},qL={class:"field-list-item"},GL={class:"field-label"},XL={class:"field-type"},WL={class:"desc"},YL={key:0,class:"desc",style:{color:"#FB363F"}},KL={key:6},JL={class:"field-list-item"},ZL={class:"field-label"},QL={class:"field-type"},e7={class:"desc"},t7={key:0,class:"desc",style:{color:"#FB363F"}},n7={__name:"field-list",props:{items:{type:Array,default:()=>[]},formState:{type:Object,default:()=>({})},errors:{type:Object,default:()=>({})},apps:{type:Array,default:()=>[]},variableOptions:{type:Array,default:()=>[]},tagTypes:{type:Object,default:()=>({})},tagLists:{type:Object,default:()=>({})},showTagComponents:{type:Boolean,default:!1},sortedEnum:{type:Function},appChange:{type:Function},update:{type:Function},onFieldChange:{type:Function},onChangeDynamic:{type:Function},filterOption:{type:Function},tagTypeChange:{type:Function},tagChange:{type:Function},syncFieldTags:{type:Function},syncingTags:{type:Object,default:()=>({})},dateRangeTypes:{type:Object,default:()=>({})},dateRangeTypeChange:{type:Function},getRangeValue:{type:Function},onDateRangeCalendarChange:{type:Function},onDateRangeChange:{type:Function},getDisabledDateForRange:{type:Function},onOpenVar:{type:Function},onToggleAdvanced:{type:Function}},setup(n){const e=[{label:"开启",value:"true"},{label:"关闭",value:"false"}];return(t,o)=>{const i=mo,r=Qt,s=Vt,a=It,l=Ii,u=Li,c=Cy;return w(!0),R(ae,null,ye(n.items,f=>{var p,h,g,m,_,v,b,C,M,O,k,E,S,N,L,$,B,A,D,T,F,V,P,X,oe,H,W,Z,le;return w(),R("div",{key:f.key,class:Ct(["options-item",{"is-required":(p=f.meta)==null?void 0:p.required}])},[d("div",vL,[d("div",gL,[U(j(((h=f.meta)==null?void 0:h.name)||f.key)+" ",1),(g=f.meta)!=null&&g.tag_component?(w(),Q(r,{key:0,title:"同步最新的标签",overlayStyle:{maxWidth:"600px"},placement:"top"},{default:x(()=>[d("a",{onClick:te=>n.syncFieldTags&&n.syncFieldTags(f.key,f.meta)},[o[6]||(o[6]=U(" 同步 ",-1)),n.syncingTags&&n.syncingTags[f.key]?(w(),Q(i,{key:0,size:"small"})):ie("",!0)],8,_L)]),_:2},1024)):ie("",!0),(m=f.meta)!=null&&m.tip?(w(),Q(r,{key:1,overlayStyle:{maxWidth:"600px"},placement:"top"},{title:x(()=>{var te;return[d("div",mL,j((te=f.meta)==null?void 0:te.tip),1)]}),default:x(()=>[y(K(mt))]),_:2},1024)):ie("",!0)]),d("div",yL,j(((_=f.meta)==null?void 0:_.type)||"string"),1),(v=f.meta)!=null&&v.switch_component?(w(),Q(ko,{key:0,style:{"margin-left":"8px"},value:String(n.formState[f.key]||"").toLowerCase()==="true"?"true":"false",options:e,onChange:te=>{n.onFieldChange&&n.onFieldChange(f.key,te),n.update&&n.update()}},null,8,["value","onChange"])):ie("",!0),(b=f.meta)!=null&&b.show_advanced_settings_icon?(w(),R("div",bL,[y(r,{title:"高级设置"},{default:x(()=>[d("span",{onClick:o[0]||(o[0]=te=>n.onToggleAdvanced&&n.onToggleAdvanced()),style:{color:"#2475FC",padding:"4px 8px",borderRadius:"24px",border:"1px solid #D9D9D9",background:"#E5EFFF",cursor:"pointer"}},[y(K(Kc))])]),_:1})])):ie("",!0)]),(C=f.meta)!=null&&C.select_official_component?(w(),R("div",xL,[y(a,{value:n.formState.app_id,placeholder:"请选择公众号",style:{width:"100%"},onChange:o[1]||(o[1]=(te,q)=>{n.onFieldChange&&n.onFieldChange("app_id",te),n.appChange&&n.appChange(te,q)})},{default:x(()=>[(w(!0),R(ae,null,ye(n.apps,te=>(w(),Q(s,{key:te.app_id,value:te.app_id,name:te.app_name,app_secret:te.app_secret},{default:x(()=>[U(j(te.app_name),1)]),_:2},1032,["value","name","app_secret"]))),128))]),_:1},8,["value"]),d("div",wL,j((M=f.meta)==null?void 0:M.desc),1),n.errors[f.key]?(w(),R("div",CL,j(n.errors[f.key]),1)):ie("",!0)])):(O=f.meta)!=null&&O.enum_component?(w(),R("div",SL,[y(a,{value:n.formState[f.key],placeholder:(k=f.meta)!=null&&k.required?"请选择":"请选择（非必填）",style:{width:"100%"},onChange:te=>{n.onFieldChange&&n.onFieldChange(f.key,te),n.update&&n.update()}},{default:x(()=>{var te,q;return[(w(!0),R(ae,null,ye(n.sortedEnum?n.sortedEnum((te=f.meta)==null?void 0:te.enum):((q=f.meta)==null?void 0:q.enum)||[],re=>(w(),Q(s,{key:re.value,value:re.value},{default:x(()=>[U(j(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","placeholder","onChange"]),d("div",kL,j((E=f.meta)==null?void 0:E.desc),1),n.errors[f.key]?(w(),R("div",EL,j(n.errors[f.key]),1)):ie("",!0)])):(S=f.meta)!=null&&S.radio_component?(w(),R("div",DL,[y(u,{value:n.formState[f.key],onChange:te=>{var re;const q=((re=te==null?void 0:te.target)==null?void 0:re.value)??te;n.onFieldChange&&n.onFieldChange(f.key,q),n.update&&n.update()}},{default:x(()=>{var te,q;return[(w(!0),R(ae,null,ye(n.sortedEnum?n.sortedEnum((te=f.meta)==null?void 0:te.enum):((q=f.meta)==null?void 0:q.enum)||[],re=>(w(),Q(l,{key:re.value,value:re.value},{default:x(()=>[U(j(re.name),1)]),_:2},1032,["value"]))),128))]}),_:2},1032,["value","onChange"]),d("div",AL,j((N=f.meta)==null?void 0:N.desc),1),n.errors[f.key]?(w(),R("div",OL,j(n.errors[f.key]),1)):ie("",!0)])):(L=f.meta)!=null&&L.switch_component?(w(),R("div",NL,[d("div",ML,j(($=f.meta)==null?void 0:$.desc),1),n.errors[f.key]?(w(),R("div",TL,j(n.errors[f.key]),1)):ie("",!0)])):(B=f.meta)!=null&&B.date_range_begin_component?(w(),R("div",$L,[d("div",PL,[y(a,{value:n.dateRangeTypes[(A=f.meta)==null?void 0:A.begin_date_key],onChange:te=>n.dateRangeTypeChange&&n.dateRangeTypeChange(f.meta,te),style:{width:"120px","padding-right":"4px"}},{default:x(()=>[y(s,{value:1},{default:x(()=>[...o[7]||(o[7]=[U("选择日期",-1)])]),_:1}),y(s,{value:2},{default:x(()=>[...o[8]||(o[8]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.dateRangeTypes[(D=f.meta)==null?void 0:D.begin_date_key]==1?(w(),Q(c,{key:0,value:n.getRangeValue?n.getRangeValue(f.meta):null,format:"YYYY-MM-DD",style:{width:"100%"},onCalendarChange:te=>n.onDateRangeCalendarChange&&n.onDateRangeCalendarChange(f.meta,te),onChange:(te,q)=>n.onDateRangeChange&&n.onDateRangeChange(f.meta,te,q),"disabled-date":te=>n.getDisabledDateForRange?n.getDisabledDateForRange(f.meta,te):!1},null,8,["value","onCalendarChange","onChange","disabled-date"])):(w(),R(ae,{key:1},[y(ot,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((T=f.meta)==null?void 0:T.begin_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(F=f.meta)==null?void 0:F.begin_date_key]||"",onOpen:o[2]||(o[2]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=f.meta)==null?void 0:re.begin_date_key,te,q)},placeholder:"请输入开始日期，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",RL,[d("div",BL,j(te),1),d("div",LL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),o[9]||(o[9]=d("div",{class:"date-range-separator"},"-",-1)),y(ot,{inputStyle:"height: 33px; width: 214px;",options:n.variableOptions,defaultSelectedList:n.formState[(((V=f.meta)==null?void 0:V.end_date_key)||"")+"_tags"]||[],defaultValue:n.formState[(P=f.meta)==null?void 0:P.end_date_key]||"",onOpen:o[3]||(o[3]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>{var re;return n.onChangeDynamic&&n.onChangeDynamic((re=f.meta)==null?void 0:re.end_date_key,te,q)},placeholder:"请输入结束日期，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",IL,[d("div",FL,j(te),1),d("div",jL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])],64))]),d("div",VL,j((X=f.meta)==null?void 0:X.desc),1),n.errors[f.key]?(w(),R("div",HL,j(n.errors[f.key]),1)):ie("",!0)])):(oe=f.meta)!=null&&oe.tag_component&&n.showTagComponents?(w(),R("div",UL,[d("div",zL,[y(a,{value:n.tagTypes[f.key],onChange:te=>n.tagTypeChange&&n.tagTypeChange(f.key,te,f.meta),style:{width:"120px"}},{default:x(()=>[y(s,{value:1},{default:x(()=>[...o[10]||(o[10]=[U("选择标签",-1)])]),_:1}),y(s,{value:2},{default:x(()=>[...o[11]||(o[11]=[U("插入变量",-1)])]),_:1})]),_:1},8,["value","onChange"]),n.tagTypes[f.key]==1?(w(),Q(a,{key:0,value:n.formState[f.key],placeholder:"请选择标签",style:{width:"100%"},onChange:(te,q)=>n.tagChange&&n.tagChange(f.key,te,q),"show-search":"","filter-option":n.filterOption},{default:x(()=>[(w(!0),R(ae,null,ye(n.tagLists[f.key]||[],te=>(w(),Q(s,{key:te.id,value:te.id,name:te.name},{default:x(()=>[U(j(te.name),1)]),_:2},1032,["value","name"]))),128))]),_:2},1032,["value","onChange","filter-option"])):(w(),Q(ot,{key:1,type:"textarea",inputStyle:"height: 33px;",options:n.variableOptions,defaultSelectedList:n.formState[f.key+"_tags"]||[],defaultValue:n.formState[f.key]||"",onOpen:o[4]||(o[4]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>n.onChangeDynamic&&n.onChangeDynamic(f.key,te,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",qL,[d("div",GL,j(te),1),d("div",XL,j(q.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]))]),d("div",WL,j((H=f.meta)==null?void 0:H.desc),1),n.errors[f.key]?(w(),R("div",YL,j(n.errors[f.key]),1)):ie("",!0)])):(w(),R("div",KL,[y(ot,{type:((W=f.meta)==null?void 0:W.in)==="body"?"textarea":void 0,inputStyle:((Z=f.meta)==null?void 0:Z.in)==="body"?"height: 64px;":void 0,options:n.variableOptions,defaultSelectedList:n.formState[f.key+"_tags"]||[],defaultValue:n.formState[f.key]||"",onOpen:o[5]||(o[5]=te=>n.onOpenVar&&n.onOpenVar()),onChange:(te,q)=>n.onChangeDynamic&&n.onChangeDynamic(f.key,te,q),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:te,payload:q})=>[d("div",JL,[d("div",ZL,j(te),1),d("div",QL,j(q.typ),1)])]),_:1},8,["type","inputStyle","options","defaultSelectedList","defaultValue","onChange"]),d("div",e7,j((le=f.meta)==null?void 0:le.desc),1),n.errors[f.key]?(w(),R("div",t7,j(n.errors[f.key]),1)):ie("",!0)]))],2)}),128)}}},hd=Te(n7,[["__scopeId","data-v-266a6761"]]),o7={class:"main-box"},i7={key:0,class:"loading-box"},r7={key:1,class:"node-options"},s7={class:"options-title"},a7={key:0,class:"acton-box"},l7=["href"],u7={class:"node-options"},d7={class:"options-title"},c7={class:"node-options"},f7={class:"options-item"},p7={__name:"dynamic-api-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,o=n,i=He("setData"),r=As();let s="";const a=Xe(()=>(p.value||[]).some(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.setting_cache_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),l=Xe(()=>String(g.click_url||"").trim()),u=Xe(()=>String(g.click_title||"").trim()),c=Xe(()=>{var de;return((de=o.action)==null?void 0:de.params)||{}}),f=Xe(()=>!!(c.value.app_id&&c.value.app_secret)),p=Xe(()=>Object.entries(c.value||{}).map(([pe,xe])=>({key:pe,meta:xe})).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.hide_official_component)}).sort((pe,xe)=>{var Ce,Fe;return+(((Ce=pe.meta)==null?void 0:Ce.sort_num)||0)-+(((Fe=xe.meta)==null?void 0:Fe.sort_num)||0)}));function h(de){return(de||[]).slice().sort((pe,xe)=>+(pe.sort_num||0)-+(xe.sort_num||0))}const g=Je({app_id:"",app_secret:"",app_name:""}),m=G(!1),_=G(!1),v=G([]),b=Je({}),C=G([]),M=Je({}),O=Je({}),k=Je({}),E=Je({}),S=Je({}),N=G(null),L=G({}),$=G(null),B=G(!1),A=Xe(()=>p.value.some(pe=>{var xe;return(xe=pe.meta)==null?void 0:xe.tag_component})?p.value.some(pe=>{const xe=pe.meta||{},Ce=Array.isArray(xe.enum)?xe.enum:[];if(!(xe.enum_component||xe.radio_component||xe.switch_component)||Ce.length===0)return!1;const Fe=String(g[pe.key]??""),Ue=Ce.find(at=>String(at==null?void 0:at.value)===Fe),qe=Ue==null?void 0:Ue.related_tags;return qe===!0||qe===1||qe==="true"||qe==="1"}):!1),D=Xe(()=>(p.value||[]).some(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.plugin_config_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),T=Xe(()=>{var xe;const de=(xe=o.action)==null?void 0:xe.use_advanced_settings,pe=(p.value||[]).some(Ce=>{var Ue;const Fe=(Ue=Ce.meta)==null?void 0:Ue.advanced_settings;return Fe===!0||Fe===1||Fe==="true"||Fe==="1"});return de===!0||de===1||de==="true"||de==="1"||pe}),F=Xe(()=>{const de=pe=>{const xe=pe==null?void 0:pe.setting_cache_component;return xe===!0||xe===1||xe==="true"||xe==="1"};return(p.value||[]).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.tag_component&&!A.value)}).filter(pe=>{var xe;return!((xe=pe.meta)!=null&&xe.plugin_config_component)}).filter(pe=>{var Fe;const xe=(Fe=pe.meta)==null?void 0:Fe.advanced_settings;return!(xe===!0||xe===1||xe==="true"||xe==="1")}).filter(pe=>!de(pe.meta))}),V=Xe(()=>(p.value||[]).filter(de=>{var xe;const pe=(xe=de.meta)==null?void 0:xe.setting_cache_component;return pe===!0||pe===1||pe==="true"||pe==="1"})),P=Xe(()=>(p.value||[]).filter(de=>{var Ue,qe;const pe=(Ue=de.meta)==null?void 0:Ue.advanced_settings,xe=pe===!0||pe===1||pe==="true"||pe==="1",Ce=(qe=de.meta)==null?void 0:qe.plugin_config_component;return xe&&!(Ce===!0||Ce===1||Ce==="true"||Ce==="1")}));gt(A,de=>{if(!de){let pe=!1;p.value.forEach(xe=>{var Ce;(Ce=xe.meta)!=null&&Ce.tag_component&&(g[xe.key]&&(g[xe.key]="",pe=!0),Array.isArray(g[xe.key+"_tags"])&&g[xe.key+"_tags"].length&&(g[xe.key+"_tags"]=[],pe=!0))}),pe&&le()}}),ut(()=>{X(),cs({name:"workflow:validate",callback:Z})});async function X(){f.value&&await oe(),H(),D.value&&await Ve(),p.value.forEach(async de=>{var xe,Ce,Fe,Ue,qe,at;const pe=String(((xe=de.meta)==null?void 0:xe.enum_default)||"").trim();((Ce=de.meta)!=null&&Ce.radio_component||(Fe=de.meta)!=null&&Fe.enum_component||(Ue=de.meta)!=null&&Ue.switch_component)&&!String(g[de.key]||"").trim()&&pe&&(g[de.key]=pe),(qe=de.meta)!=null&&qe.tag_component&&(O[de.key]=typeof O[de.key]=="number"?O[de.key]:1,await Me(de.key,(at=de.meta)==null?void 0:at.query_tag_service))}),ve(),tt()}function oe(){return Rr({app_type:"official_account"}).then(de=>{v.value=(de==null?void 0:de.data)||[]})}function H(){var xe,Ce,Fe;let de=JSON.parse(o.node.node_params);s=((xe=de==null?void 0:de.plugin)==null?void 0:xe.name)||"";let pe=((Fe=(Ce=de==null?void 0:de.plugin)==null?void 0:Ce.params)==null?void 0:Fe.arguments)||{};p.value.forEach(Ue=>{var at,bt,Xt,Ft,pn,gn;g[Ue.key]=Ue.key!=="app_id"?String(pe[Ue.key]||"").trim():pe[Ue.key];const qe=(pe==null?void 0:pe.tag_map)||{};if(g[Ue.key+"_tags"]=Array.isArray(qe[Ue.key])?qe[Ue.key]:[],(at=Ue.meta)!=null&&at.date_range_begin_component){const Rt=(bt=Ue.meta)==null?void 0:bt.end_date_key,Se=(Xt=Ue.meta)==null?void 0:Xt.date_type_key;g[Rt]=String(pe[Rt]||"").trim(),g[Rt+"_tags"]=Array.isArray(qe[Rt])?qe[Rt]:[];const Ye=pe[Se];E[(Ft=Ue.meta)==null?void 0:Ft.begin_date_key]=typeof E[(pn=Ue.meta)==null?void 0:pn.begin_date_key]=="number"?E[(gn=Ue.meta)==null?void 0:gn.begin_date_key]:Ye==null?1:Number(Ye)||1}}),pe.app_secret&&(g.app_secret=String(pe.app_secret)),pe.app_name&&(g.app_name=String(pe.app_name))}function W(de,pe){pe&&pe.app_secret&&(g.app_secret=pe.app_secret),pe&&pe.name&&(g.app_name=pe.name),le(),p.value.forEach(async xe=>{var Ce,Fe;(Ce=xe.meta)!=null&&Ce.tag_component&&await Me(xe.key,(Fe=xe.meta)==null?void 0:Fe.query_tag_service)})}function Z(){const de=cs(),pe=ke();pe&&pe.ok===!1&&de.emit&&de.emit("workflow:validate:error",{component:"公众号智能API",type:"",typeDisplay:"",message:"请完善字段后再继续",errors:pe.errors||[]})}function le(de=null){let pe=JSON.parse(o.node.node_params);pe.plugin.output_obj=C.value;const xe=st();lt(xe),Object.assign(pe.plugin.params,{arguments:{...xe,tag_map:{..._e()}},rendering:ge()}),D.value&&(pe.plugin.params.config_name=$.value||""),pe.plugin.params.use_plugin_config=!!D.value,i({...o.node,node_params:JSON.stringify(pe)}),Ne()}function te(de,pe,xe){g[de]=pe,g[de+"_tags"]=xe,le()}function q(de,pe){g[de]=pe,le()}function re(de){return String(de||"").replace(/`/g,"").trim()}function ce(de){return`${String(r.query.id||"")}:${s}:${de}`}function ve(){var xe,Ce,Fe;if(!a.value)return;let de="",pe="";for(const Ue of p.value||[]){const qe=(xe=Ue.meta)==null?void 0:xe.setting_cache_component;if(!(qe===!0||qe===1||qe==="true"||qe==="1"))continue;if(!de){const Ft=re((Ce=Ue.meta)==null?void 0:Ce.click_url),pn=re((Fe=Ue.meta)==null?void 0:Fe.click_title);Ft&&(de=Ft,pe=pn)}const bt=Ue.key;if(!String(g[bt]==null?"":g[bt]).trim()){const Ft=localStorage.getItem(ce(bt));Ft!=null&&(g[bt]=Ue.key==="app_id"?Ft:String(Ft))}}de&&(g.click_url=de),pe&&(g.click_title=pe)}function Ne(){a.value&&p.value.forEach(de=>{var Ue;const pe=(Ue=de.meta)==null?void 0:Ue.setting_cache_component;if(!(pe===!0||pe===1||pe==="true"||pe==="1"))return;const Ce=de.key,Fe=String(g[Ce]==null?"":g[Ce]);localStorage.setItem(ce(Ce),Fe)})}function ge(){return p.value.filter(de=>{var Ce,Fe,Ue,qe;if((Ce=de.meta)!=null&&Ce.tag_component&&!A.value)return!1;const pe=(Fe=de.meta)==null?void 0:Fe.setting_cache_component;return!(pe===!0||pe===1||pe==="true"||pe==="1"||(Ue=de.meta)!=null&&Ue.plugin_config_component||(qe=de.meta)!=null&&qe.advanced_settings)}).map(de=>{var Fe,Ue,qe,at,bt,Xt,Ft,pn,gn;let pe=((Fe=de.meta)==null?void 0:Fe.name)||de.key,xe=String(g[de.key]??"");const Ce=Array.isArray(g[de.key+"_tags"])?g[de.key+"_tags"]:[];if(de.key==="app_id"&&(pe="公众号名称",xe=String(g.app_name??"")),(Ue=de.meta)!=null&&Ue.enum_component||(qe=de.meta)!=null&&qe.radio_component||(at=de.meta)!=null&&at.switch_component){const Rt=(((bt=de.meta)==null?void 0:bt.enum)||[]).find(Se=>String(Se==null?void 0:Se.value)===xe);Rt&&Rt.name&&(xe=String(Rt.name))}if((Xt=de.meta)!=null&&Xt.tag_component&&O[de.key]==1){const Rt=(M[de.key]||[]).find(Se=>String(Se.id)===String(xe));Rt&&Rt.name&&(xe=String(Rt.name))}if((Ft=de.meta)!=null&&Ft.date_range_begin_component){const Rt=(pn=de.meta)==null?void 0:pn.begin_date_key,Se=(gn=de.meta)==null?void 0:gn.end_date_key,Ye=String(g[Rt]||""),be=String(g[Se]||""),Be=Array.isArray(g[Rt+"_tags"])?g[Rt+"_tags"]:[],Ke=Array.isArray(g[Se+"_tags"])?g[Se+"_tags"]:[];xe=[Ye,be].filter(Boolean).join(" ~ ");const ze=[...Be,...Ke];return{label:pe,value:xe,key:de.key,tags:ze}}return{label:pe,value:xe,key:de.key,tags:Ce}})}function _e(){const de={};return p.value.forEach(pe=>{var Ce,Fe,Ue,qe;if((Ce=pe.meta)!=null&&Ce.plugin_config_component||(Fe=pe.meta)!=null&&Fe.tag_component&&!A.value)return;const xe=Array.isArray(g[pe.key+"_tags"])?g[pe.key+"_tags"]:[];if(xe.length&&(de[pe.key]=xe),(Ue=pe.meta)!=null&&Ue.date_range_begin_component){const at=(qe=pe.meta)==null?void 0:qe.end_date_key,bt=Array.isArray(g[at+"_tags"])?g[at+"_tags"]:[];bt.length&&(de[at]=bt)}}),de}function st(){const de={};return p.value.forEach(pe=>{var xe,Ce,Fe,Ue,qe,at;if(!((xe=pe.meta)!=null&&xe.plugin_config_component)&&!((Ce=pe.meta)!=null&&Ce.tag_component&&!A.value)&&(de[pe.key]=String(g[pe.key]||""),(Fe=pe.meta)!=null&&Fe.date_range_begin_component)){const bt=(Ue=pe.meta)==null?void 0:Ue.end_date_key,Xt=(qe=pe.meta)==null?void 0:qe.date_type_key;de[bt]=String(g[bt]||"");const Ft=E[(at=pe.meta)==null?void 0:at.begin_date_key]||1;de[Xt]=String(Ft)}}),g.app_secret&&(de.app_secret=String(g.app_secret||"")),g.app_name&&(de.app_name=String(g.app_name||"")),de}function tt(){C.value=Ci(o.action.output),le()}function ke(){Object.keys(b).forEach(pe=>{b[pe]=""});const de={ok:!0,errors:[]};return p.value.forEach(pe=>{const xe=pe.key,Ce=pe.meta||{},Fe=g[xe],Ue=String(Fe??"").trim(),qe=Array.isArray(g[xe+"_tags"])?g[xe+"_tags"]:[];if(!Ce.plugin_config_component){if(Ce.select_official_component){if(Ce.required&&!Ue){const at=Ce.error||"请选择公众号";b[xe]=at,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:at})}return}if(Ce.enum_component||Ce.radio_component||Ce.switch_component){const at=(Ce.enum||[]).map(bt=>String(bt.value));if(Ce.required&&!Ue){const bt=Ce.error||"请选择";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}else if(Ue&&at.length&&!at.includes(Ue)){const bt=Ce.error||"选择不合法";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}return}if(Ce.date_range_begin_component){const at=Ce.begin_date_key,bt=Ce.end_date_key,Xt=String(g[at]||"").trim(),Ft=String(g[bt]||"").trim(),pn=Array.isArray(g[at+"_tags"])?g[at+"_tags"]:[],gn=Array.isArray(g[bt+"_tags"])?g[bt+"_tags"]:[];if(Ce.required&&(!Xt&&pn.length===0||!Ft&&gn.length===0)){const Se=Ce.error||"请选择起止时间";b[xe]=Se,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Se});return}if(E[at]===2){const Se=Ye=>/^\d{4}-\d{2}-\d{2}$/.test(Ye)?ho(Ye).isValid():!1;if(Xt&&pn.length===0&&!Se(Xt)){const Ye=Ce.error||"开始日期格式需为YYYY-MM-DD";b[xe]=Ye,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ye});return}if(Ft&&gn.length===0&&!Se(Ft)){const Ye=Ce.error||"结束日期格式需为YYYY-MM-DD";b[xe]=Ye,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ye});return}}if(Xt&&Ft){const Se=ho(Xt),Ye=ho(Ft);if(Ye.isBefore(Se)){const Ke=Ce.error||"结束时间不能早于开始时间";b[xe]=Ke,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ke});return}const be=Ye.diff(Se,"day"),Be=Number(Ce.date_range_max_interval||0);if(Be>0&&be+1>Be){const Ke=Ce.error||`时间跨度不能超过${Be}天`;b[xe]=Ke,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:Ke});return}}return}if(Ce.required&&!Ue&&(!Array.isArray(qe)||qe.length===0)){const at=Ce.error||"请输入内容";b[xe]=at,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:at})}else if(xe.toLowerCase().includes("url")&&Ue&&(!Array.isArray(qe)||qe.length===0)&&!(/^https?:\/\//.test(Ue)||zd(Ue))){const bt=Ce.error||"请输入正确的URL";b[xe]=bt,de.ok=!1,de.errors.push({field_name:Ce.name||xe,message:bt})}}}),de}function he(de,pe,xe){O[de]=pe,pe==1&&Me(de,xe==null?void 0:xe.query_tag_service)}function De(de,pe,xe){g[de]=pe,g[de+"_name"]=(xe==null?void 0:xe.name)||"",le()}function Me(de,pe){var Fe;const xe=JSON.parse(o.node.node_params),Ce=(Fe=xe==null?void 0:xe.plugin)==null?void 0:Fe.name;return!Ce||!pe?(M[de]=[],Promise.resolve([])):!g.app_id||!g.app_secret?(M[de]=[],Promise.resolve([])):Bo({name:Ce,action:"default/exec",params:JSON.stringify({business:pe,arguments:{app_id:g.app_id,app_secret:g.app_secret}})}).then(Ue=>{var qe;return M[de]=((qe=Ue==null?void 0:Ue.data)==null?void 0:qe.tags)||[],Ue})}function z(de,pe){if(!g.app_id||!g.app_secret)return xt.warning("请先选择公众号");k[de]||(k[de]=!0,Me(de,pe==null?void 0:pe.query_tag_service).then(()=>{xt.success("同步完成")}).finally(()=>{k[de]=!1}))}const ne=(de,pe)=>pe.name.toLowerCase().indexOf(de.toLowerCase())>=0;function se(de,pe){E[de.begin_date_key]=pe;const xe=de==null?void 0:de.date_type_key;xe&&(g[xe]=String(pe));const Ce=de.begin_date_key,Fe=de.end_date_key;pe===1?(g[Ce]="",g[Fe]="",g[Ce+"_tags"]=[],g[Fe+"_tags"]=[],S[Ce]=null):pe===2&&(g[Ce]="",g[Fe]="",S[Ce]=null),le()}function Ee(de){const pe=g[de.begin_date_key],xe=g[de.end_date_key];return[pe?ho(pe):null,xe?ho(xe):null]}function fe(de,pe){const xe=de.begin_date_key;Array.isArray(pe)&&pe[0]?S[xe]=pe[0]:S[xe]=null}function Le(de,pe,xe){g[de.begin_date_key]=xe[0]||"",g[de.end_date_key]=xe[1]||"",!xe[0]&&!xe[1]&&(S[de.begin_date_key]=null),le()}function Ie(de,pe){if(!pe)return!1;const xe=de.end_date_max?ho(de.end_date_max):null;if(xe&&pe.isAfter(xe,"day"))return!0;const Ce=S[de.begin_date_key],Fe=Number(de.date_range_max_interval||0);if(Ce&&Fe>0){const Ue=ho(Ce).add(Fe-1,"day");return pe.isAfter(Ue,"day")}return!1}function Ve(de=!1){return bg(s,de).then(pe=>{var Ue,qe;L.value=pe||{};const xe=Object.keys(L.value),Ce=xe.find(at=>{var bt;return(bt=L.value[at])==null?void 0:bt.is_default});let Fe=null;try{const at=JSON.parse(o.node.node_params);Fe=((qe=(Ue=at==null?void 0:at.plugin)==null?void 0:Ue.params)==null?void 0:qe.config_name)||""}catch{}Fe&&xe.includes(Fe)?$.value=Fe:$.value=Ce||xe[0]||null})}function et(){const de={[o.actionName||"default"]:o.action||{}};N.value&&N.value.show(L.value,s,de)}function nt(){le()}function We(){B.value=!B.value}function lt(de){var pe;try{const xe=$.value||"",Ce=xe?((pe=L.value)==null?void 0:pe[xe])||{}:{};if(!Ce||Object.keys(Ce).length===0)return;p.value.forEach(Fe=>{const Ue=Fe.meta||{};if(!(Ue.plugin_config_component===!0||Ue.plugin_config_component===1||Ue.plugin_config_component==="true"||Ue.plugin_config_component==="1"))return;const at=Fe.key,bt=Ce[at];bt!=null&&(de[at]=re(bt))})}catch{}}return(de,pe)=>{const xe=mo,Ce=Vt,Fe=It,Ue=Kt;return w(),R("div",o7,[_.value||m.value?(w(),R("div",i7,[y(xe)])):ie("",!0),a.value?(w(),R("div",r7,[d("div",s7,[pe[2]||(pe[2]=d("div",null,[d("img",{src:Fg,class:"title-icon"}),U("设置")],-1)),l.value?(w(),R("div",a7,[d("a",{href:l.value,target:"_blank",rel:"noopener noreferrer"},j(u.value||l.value),9,l7)])):ie("",!0)]),y(hd,{items:V.value,formState:g,errors:b,apps:v.value,variableOptions:n.variableOptions,tagTypes:O,tagLists:M,showTagComponents:A.value,sortedEnum:h,appChange:W,onFieldChange:q,update:le,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:z,syncingTags:k,dateRangeTypes:E,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])])):ie("",!0),d("div",u7,[d("div",d7,[pe[4]||(pe[4]=d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")],-1)),D.value?(w(),R(ae,{key:0},[Object.keys(L.value).length?(w(),Q(Fe,{key:0,value:$.value,"onUpdate:value":pe[0]||(pe[0]=qe=>$.value=qe),onChange:nt,style:{"min-width":"160px"}},{default:x(()=>[(w(!0),R(ae,null,ye(L.value,(qe,at)=>(w(),Q(Ce,{key:at,value:at},{default:x(()=>[U(j(qe.name||at),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(Ue,{key:1,onClick:et},{default:x(()=>[pe[3]||(pe[3]=U("未授权 ",-1)),y(K(Ro))]),_:1}))],64)):ie("",!0)]),y(hd,{items:F.value,formState:g,errors:b,apps:v.value,variableOptions:n.variableOptions,tagTypes:O,tagLists:M,showTagComponents:A.value,sortedEnum:h,appChange:W,onFieldChange:q,update:le,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:z,syncingTags:k,dateRangeTypes:E,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"]),T.value&&B.value?(w(),Q(hd,{key:0,items:P.value,formState:g,errors:b,apps:v.value,variableOptions:n.variableOptions,tagTypes:O,tagLists:M,showTagComponents:A.value,sortedEnum:h,appChange:W,onFieldChange:q,update:le,onChangeDynamic:te,filterOption:ne,tagTypeChange:he,tagChange:De,syncFieldTags:z,syncingTags:k,dateRangeTypes:E,dateRangeTypeChange:se,getRangeValue:Ee,onDateRangeCalendarChange:fe,onDateRangeChange:Le,getDisabledDateForRange:Ie,onToggleAdvanced:We,onOpenVar:()=>t("updateVar")},null,8,["items","formState","errors","apps","variableOptions","tagTypes","tagLists","showTagComponents","syncingTags","dateRangeTypes","onOpenVar"])):ie("",!0)]),d("div",c7,[pe[5]||(pe[5]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",f7,[y(hL,{"tree-data":C.value},null,8,["tree-data"])])]),y(Ew,{ref_key:"configModalRef",ref:N,onChange:pe[1]||(pe[1]=qe=>Ve(!0))},null,512)])}}},h7=Te(p7,[["__scopeId","data-v-2ce2e4f9"]]),v7={__name:"qrcode-box",setup(n,{expose:e}){const t=G(!1);function o(){t.value=!0}return e({show:o}),(i,r)=>{const s=vn;return w(),Q(s,{open:t.value,"onUpdate:open":r[0]||(r[0]=a=>t.value=a),footer:null,wrapClassName:"qrcode-wrap",width:"380px"},{default:x(()=>[...r[1]||(r[1]=[d("div",{class:"qrcode-box"},[d("div",{class:"title"},"扫码登录"),d("div",{class:"content"},[d("div",{class:"tip"},"请使用微信扫描下方二维码登员"),d("img",{class:"qrcode",src:"https://xiaokefu.com.cn/static/home/img/zhima.jpg"}),d("div",{class:"desc"},"二妞码有效期为5分钟，请尽快扫描")])],-1)])]),_:1},8,["open"])}}},g7=Te(v7,[["__scopeId","data-v-e13b70ff"]]),_7={class:"_main-box"},m7={key:0,class:"login-info-box"},y7={class:"desc"},b7={class:"official-info"},x7=["src"],w7={__name:"official-article-box",props:{node:{type:Object,default:()=>({})},action:{type:Object},actionName:{type:String},variableOptions:{type:Array}},emits:["updateVar"],setup(n,{emit:e}){const t=e,{loginInfo:o,loginStatus:i,loading:r,refresh:s,goLogin:a}=Dw();dg();const l=G(null),u=G("admin");return ut(()=>{l.value.setState({username:{value:u.value,tags:[]}})}),(c,f)=>{const p=Kt;return w(),R("div",_7,[K(i)?ie("",!0):(w(),R("div",m7,[f[4]||(f[4]=d("div",{class:"tit"},"请先完成登录",-1)),y(p,{type:"primary",class:"link",onClick:K(a)},{default:x(()=>[...f[1]||(f[1]=[U("去登录",-1)])]),_:1},8,["onClick"]),d("div",y7,[f[3]||(f[3]=U("已登录？ ",-1)),y(p,{type:"link",onClick:K(s),loading:K(r)},{default:x(()=>[...f[2]||(f[2]=[U("点击刷新",-1)])]),_:1},8,["onClick","loading"])])])),y(Vu,{ref_key:"formRef",ref:l,node:n.node,params:n.action.params,output:n.action.output,variableOptions:n.variableOptions,onUpdateVar:f[0]||(f[0]=h=>t("updateVar"))},lg({username:x(({state:h,keyName:g,item:m})=>[]),_:2},[K(i)?{name:"input-title-extra",fn:x(()=>{var h,g;return[d("div",b7,[d("img",{class:"avatar",src:(h=K(o))==null?void 0:h.headimgurl},null,8,x7),d("span",null,j((g=K(o))==null?void 0:g.nickname),1),y(K(Ua),{class:"icon"})])]}),key:"0"}:void 0]),1032,["node","params","output","variableOptions"]),y(g7)])}}},C7=Te(w7,[["__scopeId","data-v-ddd236de"]]),S7=["src"],k7={key:2,class:"node-options"},E7={class:"options-item-tit"},D7={class:"option-label"},A7={class:"option-type"},O7={class:"field-list-item"},N7={class:"field-label"},M7={class:"field-type"},T7={class:"desc"},$7={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i={feishu_bitable:G$,official_account_profile:pP,official_batch_tag:uR,official_send_template_message:qP,official_send_message:qR,official_draft:aL,official_article:C7},r={"official_article:get_official_article":["url","number"]},s=Je({}),a=G({}),l=G(null),u=G([]),c=G(!1),f=G({}),p=Xe(()=>l.value?l.value.desc:a.value.description);let h={};async function g(){v(),h=JSON.parse(o.node.node_params),await m(),await _()}function m(){var M;return Ag({name:(M=h==null?void 0:h.plugin)==null?void 0:M.name}).then(O=>{var E;let k=(O==null?void 0:O.data)||{};f.value=k.remote,c.value=((E=k==null?void 0:k.local)==null?void 0:E.multiNode)||!1})}function _(){var M;return Bo({name:((M=h==null?void 0:h.plugin)==null?void 0:M.name)||"",action:"default/get-schema",params:{}}).then(O=>{var S,N,L;let k=(O==null?void 0:O.data)||{};a.value=f.value;const E=(S=h==null?void 0:h.plugin)==null?void 0:S.name;if(ya(E)||c.value){const $=h.plugin.params.business;l.value=k[$];let B=r[`${E}:${$}`];Array.isArray(B)&&(l.value.params=Wc(l.value.params,B))}else{Object.assign(s,k);for(let $ in s)s[$].value=String((h==null?void 0:h.plugin.params[$])||""),s[$].tags=((L=(N=h==null?void 0:h.plugin)==null?void 0:N.tag_map)==null?void 0:L[$])||[]}})}function v(){u.value=e().getAllParentVariable()}function b(M,O,k){M.value=O,M.tags=k,C()}function C(){let M={params:{},tag_map:{}};for(let O in s){let k=s[O].value;s[O].type=="string"?k=String(k):["number","integer"].includes(s[O].type)&&(k=Number(k)),M.params[O]=k,M.tag_map[O]=s[O].tags}h.plugin.params=M.params,h.plugin.tag_map=M.tag_map,t({...o.node,node_params:JSON.stringify(h)})}return ut(()=>{g()}),(M,O)=>{const k=mo;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,desc:p.value},{"node-icon":x(()=>[a.value.icon?(w(),R("img",{key:0,class:"node-icon",src:a.value.icon},null,8,S7)):(w(),Q(k,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:x(()=>{var E,S,N;return[(E=l.value)!=null&&E.common_template?(w(),Q(h7,{key:0,node:n.node,action:l.value,actionName:K(h).plugin.params.business,variableOptions:u.value,onUpdateVar:v},null,8,["node","action","actionName","variableOptions"])):K(ya)((N=(S=K(h))==null?void 0:S.plugin)==null?void 0:N.name)?(w(),R(ae,{key:1},[i[K(h).plugin.name]?(w(),Q(Pu(i[K(h).plugin.name]),{key:0,node:n.node,action:l.value,actionName:K(h).plugin.params.business,variableOptions:u.value,onUpdateVar:v},null,40,["node","action","actionName","variableOptions"])):(w(),Q(Vu,{key:1,node:n.node,params:l.value.params,output:l.value.output,variableOptions:u.value,onUpdateVar:v},null,8,["node","params","output","variableOptions"]))],64)):(w(),R("div",k7,[O[0]||(O[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(ae,null,ye(s,(L,$)=>(w(),R("div",{key:$,class:Ct(["options-item",{"is-required":L.required}])},[d("div",E7,[d("div",D7,j($),1),d("div",A7,j(L.type),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:u.value,defaultSelectedList:L.tags,defaultValue:L.value,ref_for:!0,ref:"atInputRef",onOpen:v,onChange:(B,A)=>b(L,B,A),placeholder:"请输入内容，键入“/”可以插入变量"},{option:x(({label:B,payload:A})=>[d("div",O7,[d("div",N7,j(B),1),d("div",M7,j(A.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",T7,j(L.description),1)],2))),128))]))]}),_:1})}}},P7=Te($7,[["__scopeId","data-v-d3098952"]]),R7={class:"variable-node"},B7={class:"node-form-content"},L7={class:"gray-block multi-modal-box"},I7={class:"output-label"},F7={class:"multi-modal-input"},j7={style:{color:"#8c8c8c"}},V7={class:"gray-block"},H7={class:"field-items"},U7={class:"field-name-box"},z7={class:"field-name"},q7={class:"field-value-box"},G7={__name:"session-trigger-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=He("getGraph"),s=G([]),a=G([]),l=Je({question_multiple_switch:!1}),u=Xe(()=>s.value.map(v=>v.variable)),c=v=>{m()};function f(){const v=i();if(v){let C=v.getGlobalVariable().diy_global||[];C.forEach(M=>{M.label=M.key,M.value="global."+M.key}),a.value=C||[]}}function p(v){v&&f()}const h=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},g=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},m=()=>{let v=JSON.parse(o.node.node_params);v.trigger.outputs=[...s.value],v.trigger.chat_config={...l};let b={...o.node,node_params:JSON.stringify(v)};t("update-node",b),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",b)},10)},_=()=>{f();try{let v=o.node.dataRaw||o.node.node_params||"{}";v=JSON.parse(v);const b=v.trigger||{outputs:[],chat_config:{question_multiple_switch:!1}};l.question_multiple_switch=b.chat_config.question_multiple_switch,s.value=b.outputs.map(C=>(C.tags=C.tags||[],C))}catch(v){}};return ut(()=>{_()}),(v,b)=>{const C=Ri,M=Qt,O=Vt,k=It;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:h,onDeleteNode:g,desc:"chatwiki对外服务，用户发起会话时触发工作流"},null,8,["title","iconName"])]),default:x(()=>[d("div",R7,[d("div",B7,[d("div",L7,[d("div",I7,[b[1]||(b[1]=d("img",{src:lo,alt:"",class:"output-label-icon"},null,-1)),b[2]||(b[2]=d("span",{class:"output-label-text"},"多模态输入",-1)),b[3]||(b[3]=U("    ",-1)),y(C,{checked:l.question_multiple_switch,"onUpdate:checked":b[0]||(b[0]=E=>l.question_multiple_switch=E),onChange:c},null,8,["checked"])]),d("div",F7,[d("div",j7,[b[5]||(b[5]=U("开启后，支持用户输入文字+图片消息。用户输入的文字消息依然会作为question变量输出，还会额外增加一个变量question_multiple ",-1)),y(M,{placement:"left"},{title:x(()=>[...b[4]||(b[4]=[d("div",null,"question_multiple是一个对象数组，包含用户输入的文字和图片消息示例如下：",-1),d("pre",null,[d("code",null,`"question_multiple":[
  {
    "type":"text",
    "text":"这是什么"
  },{
    "type":"image_url",
    "image_url":{
      "url":"这里是图片的ur"
    }
  }
]
              `)],-1)])]),default:x(()=>[y(K(mt))]),_:1})])])]),d("div",V7,[b[6]||(b[6]=d("div",{class:"output-label"},[d("img",{src:lo,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"输出"),d("span",{class:"output-desc"},"（输出参数已自动映射到开始节点）")],-1)),d("div",H7,[(w(!0),R(ae,null,ye(s.value,(E,S)=>(w(),R("div",{class:"field-item",key:S},[d("div",U7,[d("span",z7,j(E.key),1),y(M,null,{title:x(()=>[U(j(E.desc),1)]),default:x(()=>[y(K(mt))]),_:2},1024)]),d("div",q7,[y(k,{style:{width:"200px"},placeholder:"请输入选择变量",value:E.variable,"onUpdate:value":N=>E.variable=N,allowClear:"",onDropdownVisibleChange:p,onChange:m},{default:x(()=>[(w(!0),R(ae,null,ye(a.value,N=>(w(),Q(O,{disabled:u.value.includes(N.value),value:N.value,key:N.key},{default:x(()=>[d("span",null,j(N.label),1)]),_:2},1032,["disabled","value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])])])]),_:1})}}},X7=Te(G7,[["__scopeId","data-v-ed0fada3"]]),W7="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23hp676wcw9__clip0_12661_41280)'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linejoin='round'%3e%3cpath%20d='M7.99993%2014.7779C11.375%2014.7779%2014.1111%2012.0418%2014.1111%208.66678C14.1111%205.29171%2011.375%202.55566%207.99993%202.55566C4.62487%202.55566%201.88883%205.29171%201.88883%208.66678C1.88883%2012.0418%204.62487%2014.7779%207.99993%2014.7779Z'/%3e%3cpath%20d='M7.9198%205.11768L7.9194%208.78728L10.5102%2011.378'%20stroke-linecap='round'/%3e%3cpath%20d='M1.33334%203.00016L3.66667%201.3335'%20stroke-linecap='round'/%3e%3cpath%20d='M14.6667%203.00016L12.3333%201.3335'%20stroke-linecap='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='hp676wcw9__clip0_12661_41280'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";var Lp={exports:{}},Ip;function Y7(){return Ip||(Ip=1,(function(n,e){(function(t){t(Eg())})(function(t){t.defineMode("shell",function(){var o={};function i(g,m){for(var _=0;_<m.length;_++)o[m[_]]=g}var r=["true","false"],s=["if","then","do","else","elif","while","until","for","in","esac","fi","fin","fil","done","exit","set","unset","export","function"],a=["ab","awk","bash","beep","cat","cc","cd","chown","chmod","chroot","clear","cp","curl","cut","diff","echo","find","gawk","gcc","get","git","grep","hg","kill","killall","ln","ls","make","mkdir","openssl","mv","nc","nl","node","npm","ping","ps","restart","rm","rmdir","sed","service","sh","shopt","shred","source","sort","sleep","ssh","start","stop","su","sudo","svn","tee","telnet","top","touch","vi","vim","wall","wc","wget","who","write","yes","zsh"];t.registerHelper("hintWords","shell",r.concat(s,a)),i("atom",r),i("keyword",s),i("builtin",a);function l(g,m){if(g.eatSpace())return null;var _=g.sol(),v=g.next();if(v==="\\")return g.next(),null;if(v==="'"||v==='"'||v==="`")return m.tokens.unshift(u(v,v==="`"?"quote":"string")),h(g,m);if(v==="#")return _&&g.eat("!")?(g.skipToEnd(),"meta"):(g.skipToEnd(),"comment");if(v==="$")return m.tokens.unshift(f),h(g,m);if(v==="+"||v==="=")return"operator";if(v==="-")return g.eat("-"),g.eatWhile(/\w/),"attribute";if(v=="<"){if(g.match("<<"))return"operator";var b=g.match(/^<-?\s*['"]?([^'"]*)['"]?/);if(b)return m.tokens.unshift(p(b[1])),"string-2"}if(/\d/.test(v)&&(g.eatWhile(/\d/),g.eol()||!/\w/.test(g.peek())))return"number";g.eatWhile(/[\w-]/);var C=g.current();return g.peek()==="="&&/\w+/.test(C)?"def":o.hasOwnProperty(C)?o[C]:null}function u(g,m){var _=g=="("?")":g=="{"?"}":g;return function(v,b){for(var C,M=!1;(C=v.next())!=null;){if(C===_&&!M){b.tokens.shift();break}else if(C==="$"&&!M&&g!=="'"&&v.peek()!=_){M=!0,v.backUp(1),b.tokens.unshift(f);break}else{if(!M&&g!==_&&C===g)return b.tokens.unshift(u(g,m)),h(v,b);if(!M&&/['"]/.test(C)&&!/['"]/.test(g)){b.tokens.unshift(c(C,"string")),v.backUp(1);break}}M=!M&&C==="\\"}return m}}function c(g,m){return function(_,v){return v.tokens[0]=u(g,m),_.next(),h(_,v)}}var f=function(g,m){m.tokens.length>1&&g.eat("$");var _=g.next();return/['"({]/.test(_)?(m.tokens[0]=u(_,_=="("?"quote":_=="{"?"def":"string"),h(g,m)):(/\d/.test(_)||g.eatWhile(/\w/),m.tokens.shift(),"def")};function p(g){return function(m,_){return m.sol()&&m.string==g&&_.tokens.shift(),m.skipToEnd(),"string-2"}}function h(g,m){return(m.tokens[0]||l)(g,m)}return{startState:function(){return{tokens:[]}},token:function(g,m){return h(g,m)},closeBrackets:"()[]{}''\"\"``",lineComment:"#",fold:"brace"}}),t.defineMIME("text/x-sh","shell"),t.defineMIME("application/x-sh","shell")})})()),Lp.exports}Y7();const K7={class:"variable-node"},J7={class:"node-form-content"},Z7={class:"gray-block"},Q7={class:"form-item"},eI={key:0,class:"form-item"},tI={key:1,class:"form-item custom-textarea"},nI={__name:"timing-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n;function i(){let p=[];for(let h=0;h<31;h++)p.push({label:h+1+"号",value:h+1+""});return p}const r=[{value:"day",label:"每天执行"},{value:"week",label:"每周执行",children:[{value:"0",label:"星期日"},{value:"1",label:"星期一"},{value:"2",label:"星期二"},{value:"3",label:"星期三"},{value:"4",label:"星期四"},{value:"5",label:"星期五"},{value:"6",label:"星期六"}]},{value:"month",label:"每月执行",children:i()}],s=Je({type:"select_time",time_value:[],every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""});gt(()=>s,()=>{c()},{deep:!0}),He("getNode");const a=He("getGraph"),l=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",{...o.node})},10)},u=()=>{setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",null)},10)},c=()=>{let p=JSON.parse(o.node.node_params),h="",g="",m="";s.time_value&&s.time_value.length&&(h=s.time_value[0],s.time_value[0]=="week"&&(g=s.time_value[1]),s.time_value[0]=="month"&&(m=s.time_value[1])),p.trigger.cron_config={...s,every_type:h,week_number:g,month_day:m};let _={...o.node,node_params:JSON.stringify(p)};t("update-node",_),setTimeout(()=>{a().eventCenter.emit("custom:trigger-change",_)},10)},f=()=>{try{let p=o.node.dataRaw||o.node.node_params||"{}";p=JSON.parse(p);let h=p.trigger.cron_config;s.type=h.type,s.linux_crontab=h.linux_crontab,s.every_type=h.every_type,s.week_number=h.week_number,s.month_day=h.month_day,s.hour_minute=h.hour_minute;let g=h.every_type;g=="day"&&(s.time_value=["day"]),g=="week"&&(s.time_value=["week",h.week_number]),g=="month"&&(s.time_value=["month",h.month_day])}catch(p){}};return ut(()=>{f()}),(p,h)=>{const g=Ii,m=Li,_=oi,v=Sy,b=ii,C=Bi;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:l,onDeleteNode:u,desc:"在设定的时间点，自动执行工作流"},null,8,["title","iconName"])]),default:x(()=>[d("div",K7,[d("div",J7,[d("div",Z7,[h[6]||(h[6]=d("div",{class:"output-label"},[d("img",{src:W7,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"触发时间")],-1)),d("div",Q7,[y(m,{value:s.type,"onUpdate:value":h[0]||(h[0]=M=>s.type=M)},{default:x(()=>[y(g,{value:"select_time"},{default:x(()=>[...h[4]||(h[4]=[U("选择触发时间",-1)])]),_:1}),y(g,{value:"linux_crontab"},{default:x(()=>[...h[5]||(h[5]=[U("Linux Crontab 代码",-1)])]),_:1})]),_:1},8,["value"])]),s.type==="select_time"?(w(),R("div",eI,[y(b,{gap:8},{default:x(()=>[y(_,{value:s.time_value,"onUpdate:value":h[1]||(h[1]=M=>s.time_value=M),options:r,placeholder:"请选择",style:{width:"194px"}},null,8,["value"]),y(v,{allowClear:!1,value:s.hour_minute,"onUpdate:value":h[2]||(h[2]=M=>s.hour_minute=M),valueFormat:"HH:mm",format:"HH:mm",style:{width:"124px"}},null,8,["value"])]),_:1})])):(w(),R("div",tI,[y(C,{value:s.linux_crontab,"onUpdate:value":h[3]||(h[3]=M=>s.linux_crontab=M),placeholder:"请输入代码",style:{"min-height":"142px",background:"#262626",color:"#bfbfbf"}},null,8,["value"])]))])])])]),_:1})}}},oI=Te(nI,[["__scopeId","data-v-8b46e137"]]),iI="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1763712774665'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1849'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='300'%20height='300'%3e%3cpath%20d='M692.352%20335.04c11.712%200.128%2023.36%200.96%2034.944%202.432-31.232-156.8-186.88-273.152-365.184-273.152C163.008%2064.32%200%20210.048%200%20394.88c0%20106.944%2054.336%20194.688%20144.768%20262.784l-36.096%20117.12%20126.592-68.224c41.536%2011.2%2084.032%2017.728%20126.848%2019.584h33.856a312%20312%200%200%201-11.136-81.6%20306.88%20306.88%200%200%201%20307.84-308.032l-0.32-1.536z%20m-194.56-105.408a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312c-27.328%202.176-51.328-19.328-54.4-48.64%202.88-29.312%2027.008-50.816%2054.4-48.512z%20m-253.44%2097.152c-27.456%202.304-51.648-19.2-54.656-48.64%203.008-29.312%2027.2-50.88%2054.656-48.512a41.088%2041.088%200%200%201%2032.768%2013.312%2047.808%2047.808%200%200%201%2012.416%2035.2%2047.808%2047.808%200%200%201-12.416%2035.328%2041.088%2041.088%200%200%201-32.768%2013.312z'%20fill='currentColor'%20p-id='1850'%3e%3c/path%3e%3cpath%20d='M1024%20638.464c0-155.52-145.92-283.52-308.608-283.52-172.416%200-308.096%20126.784-308.096%20282.304%200%20155.52%20135.68%20282.368%20308.096%20282.368a426.176%20426.176%200%200%200%20109.44-18.304L924.16%20960l-28.416-97.216C968.832%20803.84%201024%20726.208%201024%20638.464z%20m-408.448-48.832c-19.968%200-36.16-17.408-36.16-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.56%2042.56%2014.72%2045.184%2038.784-2.624%2024.064-22.784%2041.344-45.184%2038.848z%20m199.04%200c-19.84%200-36.096-17.408-36.096-38.848%200-21.44%2016.192-38.784%2036.16-38.784%2022.4-2.368%2042.432%2014.848%2045.248%2038.784-2.688%2024.064-22.848%2041.344-45.248%2038.848z'%20fill='currentColor'%20p-id='1851'%3e%3c/path%3e%3c/svg%3e",rI={class:"variable-node"},sI={class:"node-form-content"},aI={class:"gray-block"},lI={class:"app-item-list"},uI=["onClick"],dI={class:"form-item"},cI={class:"form-item-content"},fI={class:"gray-block"},pI={class:"field-items"},hI={class:"field-name-box"},vI={class:"field-name"},gI={class:"field-value-box"},_I={__name:"official-trigger-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=$s(),o=Xe(()=>t.officialList),i=Xe(()=>t.triggerOfficialList),r=e,s=n,a=He("getNode"),l=He("getGraph"),u=G([{label:"私信消息",value:"message"},{label:"关注/取消关注事件",value:"subscribe_unsubscribe"},{label:"扫描带参数二维码事件",value:"qrcode_scan"},{label:"自定义菜单事件",value:"menu_click"}]),c=Je({msg_type:"",app_ids:[]}),f=Xe(()=>c.app_ids.map(S=>o.value.find(N=>N.app_id==S)).filter(Boolean)),p=G([]),h=G([]);Xe(()=>p.value.map(S=>S.variable));function g(){const S=a();if(S){let L=S.getGlobalVariable().diy_global||[];L.forEach($=>{$.label=$.key,$.value="global."+$.key}),h.value=L||[]}}function m(S){S&&g()}const _=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",{...s.node})},10)},v=()=>{setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",null)},10)},b=()=>{let S=JSON.parse(s.node.node_params);S.trigger.outputs=[...p.value],S.trigger.trigger_official_config={msg_type:c.msg_type,app_ids:c.app_ids.join(",")};let N={...s.node,node_params:JSON.stringify(S)};r("update-node",N),setTimeout(()=>{l().eventCenter.emit("custom:trigger-change",N)},10)},C=()=>{g();try{let S=s.node.dataRaw||s.node.node_params||"{}";S=JSON.parse(S);const N=S.trigger||{outputs:[]};let L=N.trigger_official_config;c.msg_type=L.msg_type,c.app_ids=L.app_ids?L.app_ids.split(","):[];let $=N.outputs;$||($=i.value.find(B=>B.msg_type==L.msg_type).fields),p.value=$.map(B=>(B.tags=B.tags||[],B))}catch(S){}},M=()=>{O.value.open({},JSON.parse(JSON.stringify(c.app_ids)))},O=G(null),k=S=>{c.app_ids=S||[],O.value.close(),b()},E=S=>{c.app_ids=c.app_ids.filter(N=>N!=S.app_id),b()};return ut(()=>{C()}),(S,N)=>{const L=Kt,$=It,B=Qt,A=Vt;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:_,onDeleteNode:v,desc:"当对接的公众号触发相关事件时，自动触发流程"},null,8,["title","iconName"])]),default:x(()=>[d("div",rI,[d("div",sI,[d("div",aI,[N[3]||(N[3]=d("div",{class:"output-label"},[d("img",{src:iI,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"公众号")],-1)),d("div",null,[y(L,{onClick:M,type:"dashed"},{default:x(()=>[y(K(Ht)),N[1]||(N[1]=U("添加公众号",-1))]),_:1}),d("div",lI,[(w(!0),R(ae,null,ye(f.value,D=>(w(),R("div",{class:"app-item",key:D.app_id},[U(j(D.app_name)+" ",1),d("span",{onClick:T=>E(D),class:"close-icon"},[y(K(Ru))],8,uI)]))),128))])]),d("div",dI,[N[2]||(N[2]=d("div",{class:"form-item-label"},"触发事件",-1)),d("div",cI,[y($,{options:u.value,value:c.msg_type,"onUpdate:value":N[0]||(N[0]=D=>c.msg_type=D),style:{width:"100%"},showArrow:!1,disabled:""},null,8,["options","value"])])])]),d("div",fI,[N[4]||(N[4]=d("div",{class:"output-label"},[d("img",{src:ju,alt:"",class:"output-label-icon"}),d("span",{class:"output-label-text"},"输出"),d("a",{class:"ml8",href:"https://developers.weixin.qq.com/doc/subscription/guide/product/message/Receiving_standard_messages.html",target:"_blank"},"查看官方接口文档")],-1)),d("div",pI,[(w(!0),R(ae,null,ye(p.value,(D,T)=>(w(),R("div",{class:"field-item",key:T},[d("div",hI,[d("span",vI,j(D.key),1),y(B,null,{title:x(()=>[U(j(D.desc),1)]),default:x(()=>[y(K(mt))]),_:2},1024)]),d("div",gI,[y($,{style:{width:"200px"},placeholder:"请输入选择变量",value:D.variable,"onUpdate:value":F=>D.variable=F,allowClear:"",onDropdownVisibleChange:m,onChange:b},{default:x(()=>[(w(!0),R(ae,null,ye(h.value,F=>(w(),Q(A,{value:F.value,key:F.key},{default:x(()=>[d("span",null,j(F.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])])]))),128))])])]),y(Nw,{ref_key:"wxAppRef",ref:O,title:"添加公众号",onOk:k},null,512)])]),_:1})}}},mI=Te(_I,[["__scopeId","data-v-78ddcd5e"]]),yI="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%234f9846fr4__clip0_12833_126304)'%20stroke='%23262626'%20stroke-width='1.33333'%3e%3cpath%20d='M4%203.30905V2.33337C4%201.78109%204.4477%201.33337%205%201.33337H13.6667C14.219%201.33337%2014.6667%201.78109%2014.6667%202.33337V11C14.6667%2011.5523%2014.219%2012%2013.6667%2012H12.6725'/%3e%3cpath%20d='M11.6667%203.33337H2.33337C1.78109%203.33337%201.33337%203.78109%201.33337%204.33337V13.6667C1.33337%2014.219%201.78109%2014.6667%202.33337%2014.6667H11.6667C12.219%2014.6667%2012.6667%2014.219%2012.6667%2013.6667V4.33337C12.6667%203.78109%2012.219%203.33337%2011.6667%203.33337Z'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%209L10%209'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%206L10%209L7%2012'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='4f9846fr4__clip0_12833_126304'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",bI="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M8%201.66663H2V12.3333H8V1.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%203.66663H8V14.3333H14V3.66663Z'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4.33337%205.66663L5.66671%206.92979L4.44447%208.33329'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.3334%207.66663L11.6667%208.92979L10.4445%2010.3333'%20stroke='%23262626'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",xI={class:"modal-title-block"},wI={key:0,class:"run-detail"},CI={class:"flex-content-box"},SI={class:"test-model-box"},kI={key:2,class:"input-list-box"},EI={class:"add-btn-box"},DI={key:0,class:"result-list-box loading-box"},AI={key:1,class:"result-list-box"},OI=["onClick"],NI={class:"status-block"},MI={class:"icon-name-box"},TI=["src"],$I={class:"node-name"},PI={key:0,class:"time-tag"},RI={class:"right-active-icon"},BI={class:"save-btn-box"},LI={class:"preview-box"},II={class:"preview-title"},FI={class:"icon-name-box"},jI=["src"],VI={class:"node-name"},HI={key:0,class:"time-tag"},UI={class:"preview-content-block"},zI={class:"title-block"},qI={class:"preview-code-box"},GI={class:"preview-content-block"},XI={class:"title-block"},WI={class:"preview-code-box"},YI={class:"preview-content-block"},KI={class:"title-block"},JI={class:"preview-code-box"},ZI={__name:"run-test",props:{batch_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo.isLockedByOther),r=n;Xe(()=>[]);const s=G(!1),a=G(""),l=G([]),u=Xe(()=>a.value?l.value.filter(A=>A.node_key==a.value)[0]:null),c=G(!1),f=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),p=async()=>{if(i.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Pt();let A=localStorage.getItem("workflow_batch_run_test_data")||"{}";A=JSON.parse(A),f.question=A.question||"",f.openid=A.openid||"",f.global=A.global||"",l.value=[],a.value="",setTimeout(()=>{_()},1e3),s.value=!0},h=G([]),g=G(!1),m=G(!1),_=()=>{ly({robot_key:f.robot_key,batch_node_key:r.batch_node_key}).then(A=>{g.value=A.data.is_need_question,m.value=A.data.is_need_openid,g.value||(f.question=""),h.value=A.data.loop_test_params.map(D=>({...D,field:{...D.field,Vals:v(D.field)}}))})};function v(A){return A.typ=="string"||A.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const b=(A,D)=>{A.splice(D,1)},C=A=>{A.push({value:"",key:Math.random()*1e4})},M=G(null),O=G(0),k=G(0),E=()=>{M.value.validate().then(()=>{let A={...f,batch_node_key:r.batch_node_key},D=JSON.parse(JSON.stringify(h.value));D.forEach(T=>{T.field.typ.includes("array")&&(T.field.Vals=T.field.Vals.map(F=>F.value))}),A.batch_test_params=JSON.stringify(D),c.value=!0,l.value=[],localStorage.setItem("workflow_batch_run_test_data",JSON.stringify({...A})),ay({...A}).then(T=>{xt.success("测试结果生成完成");let F=T.data.node_logs||[];O.value=T.data.use_token,k.value=T.data.use_mills,S(F)}).catch(T=>{l.value=[];let F=T.data.node_logs||[];F&&F.length&&S(F)}).finally(()=>{c.value=!1})})},S=A=>{var D;l.value=A.map(T=>({...T,is_success:T.error_msg==="<nil>",node_icon:Lu(T.node_type)})),a.value=(D=l.value[0])==null?void 0:D.node_key},N=A=>{a.value=A.node_key},L=A=>{Os(JSON.stringify(u.value[A])),xt.success("复制成功")};function $(A){return A.field.key.replace(A.node_key+".","")}return e({open:()=>{p()}}),(A,D)=>{const T=wi,F=ii,V=ln,P=kn,X=$n,oe=Vn,H=Kt,W=wn,Z=mo,le=vn;return w(),R("div",null,[y(le,{open:s.value,"onUpdate:open":D[5]||(D[5]=te=>s.value=te),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",xI,[D[6]||(D[6]=U("运行测试 ",-1)),l.value.length?(w(),R("div",wI,[d("span",null,"总耗时："+j(K(tf)(k.value)),1),d("span",null,"token消耗："+j(O.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",CI,[d("div",SI,[D[13]||(D[13]=d("div",{class:"top-title"},"开始节点参数",-1)),y(W,{model:f,ref_key:"formRef",ref:M,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[g.value?(w(),Q(P,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[D[8]||(D[8]=U("question ",-1)),y(T,{style:{margin:"0"}},{default:x(()=>[...D[7]||(D[7]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(V,{placeholder:"请输入",value:f.question,"onUpdate:value":D[0]||(D[0]=te=>f.question=te)},null,8,["value"])]),_:1})):ie("",!0),m.value?(w(),Q(P,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[D[10]||(D[10]=U("openid ",-1)),y(T,{style:{margin:"0"}},{default:x(()=>[...D[9]||(D[9]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(V,{placeholder:"请输入",value:f.openid,"onUpdate:value":D[1]||(D[1]=te=>f.openid=te)},null,8,["value"])]),_:1})):ie("",!0),(w(!0),R(ae,null,ye(h.value,te=>(w(),Q(P,{key:te.node_key,rules:[{required:te.field.required,message:`请输入${te.node_name}`}]},{label:x(()=>[y(F,{gap:4},{default:x(()=>[U(j(te.node_name)+" "+j($(te)),1),y(T,{style:{margin:"0"}},{default:x(()=>[U(j(te.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[te.field.typ=="string"?(w(),Q(V,{key:0,placeholder:"请输入",value:te.field.Vals,"onUpdate:value":q=>te.field.Vals=q},null,8,["value","onUpdate:value"])):ie("",!0),te.field.typ=="number"?(w(),Q(X,{key:1,style:{width:"100%"},placeholder:"请输入",value:te.field.Vals,"onUpdate:value":q=>te.field.Vals=q},null,8,["value","onUpdate:value"])):ie("",!0),te.field.typ.includes("array")?(w(),R("div",kI,[(w(!0),R(ae,null,ye(te.field.Vals,(q,re)=>(w(),R("div",{class:"input-list-item",key:re},[y(oe,null,{default:x(()=>[y(V,{placeholder:"请输入",value:q.value,"onUpdate:value":ce=>q.value=ce},null,8,["value","onUpdate:value"])]),_:2},1024),te.field.Vals.length>1?(w(),Q(K(Jt),{key:0,onClick:ce=>b(te.field.Vals,re)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",EI,[y(H,{onClick:q=>C(te.field.Vals),block:"",type:"dashed"},{default:x(()=>[...D[11]||(D[11]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),c.value?(w(),R("div",DI,[c.value?(w(),Q(Z,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),l.value.length>0?(w(),R("div",AI,[(w(!0),R(ae,null,ye(l.value,(te,q)=>(w(),R("div",{class:Ct(["list-item-block",{active:a.value==te.node_key}]),onClick:re=>N(te),key:q},[d("div",NI,[te.is_success?(w(),Q(K(Ua),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Ru),{key:1,style:{color:"#d81e06"}}))]),d("div",MI,[d("img",{src:te.node_icon,alt:""},null,8,TI),d("div",$I,j(te.node_name),1)]),te.is_success?(w(),R("div",PI,j(te.use_time)+"ms",1)):ie("",!0),d("div",RI,[y(K(Bu))])],10,OI))),128))])):ie("",!0),d("div",BI,[y(H,{loading:c.value,onClick:E,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(K(ni)),D[12]||(D[12]=U("运行测试",-1))]),_:1},8,["loading"])])]),d("div",LI,[u.value?(w(),R(ae,{key:0},[d("div",II,[D[14]||(D[14]=d("div",{class:"title-text"},"日志详情",-1)),d("div",FI,[d("img",{src:u.value.node_icon,alt:""},null,8,jI),d("div",VI,j(u.value.node_name),1)]),u.value.is_success?(w(),R("div",HI,j(u.value.use_time)+"ms",1)):ie("",!0)]),d("div",UI,[d("div",zI,[D[15]||(D[15]=U("输入",-1)),y(K(Oo),{onClick:D[2]||(D[2]=te=>L("input"))})]),d("div",qI,[y(K(Mo),{data:u.value.input},null,8,["data"])])]),d("div",GI,[d("div",XI,[D[16]||(D[16]=U("输出",-1)),y(K(Oo),{onClick:D[3]||(D[3]=te=>L("node_output"))})]),d("div",WI,[y(K(Mo),{data:u.value.node_output},null,8,["data"])])]),d("div",YI,[d("div",KI,[D[17]||(D[17]=U("运行日志",-1)),y(K(Oo),{onClick:D[4]||(D[4]=te=>L("output"))})]),d("div",JI,[y(K(Mo),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},zg=Te(ZI,[["__scopeId","data-v-1a9300dc"]]),QI={class:"problem-optimization-form"},e9={class:"node-form-content"},t9={class:"gray-block"},n9={class:"row-form-item"},o9={class:"form-label"},i9={class:"row-form-item"},r9={class:"form-label"},s9={class:"gray-block"},a9={class:"gray-block-title"},l9={class:"output-box"},u9={class:"array-form-box"},d9={class:"flex-block-item",style:{gap:"12px"}},c9={class:"gray-block"},f9={class:"gray-block-title"},p9={class:"output-box"},h9={class:"array-form-box"},v9={class:"flex-block-item",style:{gap:"12px"}},g9=["onClick"],_9={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=He("getNode"),r=G([]),s=G([]),a=G(null);function l($){return $.forEach(B=>{B.typ=="node"?B.node_type==1?B.value="global":B.value=B.node_id:B.value=B.key,B.children&&B.children.length>0&&(B.children=l(B.children))}),$}function u(){let $=i().getAllParentVariable();$=l($),$=$.filter(B=>B.group_node_key!=B.loop_parent_key).filter(B=>B.node_id!=B.group_node_key),r.value=c($)}function c($){const B=A=>!A||A.length===0?[]:A.map(D=>{const T=B(D.children);return D.typ.includes("array")||T&&T.length>0?{...D,children:T}:null}).filter(Boolean);return B($)}const f=()=>{let $=i().getAllParentVariable();$.forEach(B=>{B.tags=B.tags||[]}),$=$.filter(B=>B.group_node_key==B.loop_parent_key),s.value=l($)},p=$=>{$||f()},h=G(),g={key:"",typ:"",value:"",_id:rs(16)},m={key:"",typ:"",value:"",_id:rs(16)},_=Je({chan_number:10,max_run_number:500,batch_arrays:[],output:[]});function v($){if($){let B=$.split("."),A=B[0],D=B.filter((T,F)=>F>0).join(".");return[A,D]}return[]}const b=$=>{$&&u()},C=($,B,A)=>{A?B.typ=A[A.length-1].typ:B.typ=""},M=()=>{_.output.push({key:"",typ:"",value:"",_id:rs(16)})},O=$=>{_.output.splice($,1)},k=($,B)=>{if($&&$.length){let A=s.value.filter(D=>D.value==$[0])[0].children;if(A&&A.length){let D=A.filter(T=>T.value==$[1])[0].typ;B.typ=B.typ=D.startsWith("array")?D:`array<${D}>`}}else B.typ=""},E=()=>{t("close")},S=()=>{var B;let $=_.batch_arrays[0];$&&$.key&&$.typ&&$.value?(B=a.value)==null||B.open():xt.error("请填写执行数组")},N=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).batch||{};u(),f(),_.chan_number=B.chan_number,_.max_run_number=B.max_run_number,_.batch_arrays=B.batch_arrays.map(A=>({...A,value:v(A.value)})),_.output=B.output.map(A=>({...A,value:v(A.value)})),_.batch_arrays.length==0&&(_.batch_arrays=[g]),_.output.length==0&&(_.output=[m])}catch($){}},L=()=>{const $=JSON.stringify({batch:{..._,batch_arrays:_.batch_arrays.map(B=>({...B,value:B.value?B.value.join("."):""})),chan_number:_.chan_number,max_run_number:_.max_run_number,output:_.output.map(B=>{let A=B.value?B.value.join("."):"";return{...B,value:A}})}});t("update-node",{...o.node,node_params:$})};return gt(()=>_,()=>{L()},{deep:!0}),ut(()=>{N()}),($,B)=>{const A=Qt,D=$n,T=ln,F=oi,V=Vn,P=kn,X=Kt,oe=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过设定批量运行次数和逻辑，运行批处理体内的任务",onClose:E},{runBtn:x(()=>[y(A,null,{title:x(()=>[...B[2]||(B[2]=[U("运行测试",-1)])]),default:x(()=>[d("div",{class:"action-btn",onClick:S},[y(K(ni),{style:{color:"rgb(0, 173, 58)"}})])]),_:1})]),_:1},8,["title","iconName"])]),default:x(()=>[d("div",QI,[d("div",e9,[y(oe,{ref_key:"formRef",ref:h,layout:"vertical",model:_},{default:x(()=>[d("div",t9,[B[7]||(B[7]=d("div",{class:"gray-block-title"},[d("img",{src:yI,alt:""}),d("span",null,"执行设置")],-1)),d("div",n9,[d("div",o9,[B[4]||(B[4]=d("span",null,"并行运行数量",-1)),y(A,null,{title:x(()=>[...B[3]||(B[3]=[U("并行运行数量，最大一次执行10个",-1)])]),default:x(()=>[y(K(mt),{class:"tip-icon"})]),_:1})]),d("div",null,[y(D,{style:{width:"300px"},max:10,min:1,precision:0,step:1,placeholder:"请输入",value:_.chan_number,"onUpdate:value":B[0]||(B[0]=H=>_.chan_number=H)},null,8,["value"])])]),d("div",i9,[d("div",r9,[B[6]||(B[6]=d("span",null,"最大执行次数",-1)),y(A,null,{title:x(()=>[...B[5]||(B[5]=[U("批量执行运行总次数不超过该上限，超过时会直接进入下一个节点",-1)])]),default:x(()=>[y(K(mt),{class:"tip-icon"})]),_:1})]),d("div",null,[y(D,{style:{width:"300px"},max:500,min:1,precision:0,step:1,placeholder:"请输入",value:_.max_run_number,"onUpdate:value":B[1]||(B[1]=H=>_.max_run_number=H)},null,8,["value"])])])]),d("div",s9,[d("div",a9,[B[9]||(B[9]=d("img",{src:bI,alt:""},null,-1)),B[10]||(B[10]=U(" 执行数组 ",-1)),y(A,null,{title:x(()=>[...B[8]||(B[8]=[U("批处理体中节点要使用的变量，仅支持引用数组，循环次数为数组的长度，执行时会按顺序输出单个数组",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",l9,[B[11]||(B[11]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"25%"}},"参数Key"),d("div",{class:"output-item",style:{width:"30%"}},"类型"),d("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),d("div",u9,[(w(!0),R(ae,null,ye(_.batch_arrays,(H,W)=>(w(),R("div",{class:"form-item-list",key:H._id},[y(P,{label:null},{default:x(()=>[d("div",d9,[y(T,{style:{width:"25%"},value:H.key,"onUpdate:value":Z=>H.key=Z,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(V,null,{default:x(()=>[y(T,{style:{width:"30%"},value:H.typ,"onUpdate:value":Z=>H.typ=Z,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(F,{onChange:(Z,le)=>C(Z,H,le),value:H.value,"onUpdate:value":Z=>H.value=Z,onDropdownVisibleChange:b,style:{width:"45%"},options:r.value,allowClear:!1,displayRender:({labels:Z})=>Z.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024)])]),_:2},1024)]))),128))])])]),d("div",c9,[d("div",f9,[B[13]||(B[13]=d("img",{src:ju,alt:""},null,-1)),B[14]||(B[14]=U(" 输出 ",-1)),y(A,null,{title:x(()=>[...B[12]||(B[12]=[U("循环完成后输出的内容，仅支持引用循环体中节点的输出变量，输出的内容会自动组装为数组类型",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",p9,[B[16]||(B[16]=d("div",{class:"output-block"},[d("div",{class:"output-item",style:{width:"23%"}},"参数Key"),d("div",{class:"output-item",style:{width:"27%"}},"类型"),d("div",{class:"output-item",style:{width:"45%"}},"参数值")],-1)),d("div",h9,[(w(!0),R(ae,null,ye(_.output,(H,W)=>(w(),R("div",{class:"form-item-list",key:H._id},[y(P,{label:null},{default:x(()=>[d("div",v9,[y(T,{style:{width:"25%"},value:H.key,"onUpdate:value":Z=>H.key=Z,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(V,null,{default:x(()=>[y(T,{style:{width:"30%"},value:H.typ,"onUpdate:value":Z=>H.typ=Z,placeholder:"",readonly:""},null,8,["value","onUpdate:value"]),y(F,{onChange:Z=>k(Z,H),value:H.value,"onUpdate:value":Z=>H.value=Z,onDropdownVisibleChange:p,style:{width:"45%"},options:s.value,allowClear:!1,displayRender:({labels:Z})=>Z.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["onChange","value","onUpdate:value","options","displayRender"])]),_:2},1024),d("div",{class:"btn-hover-wrap",onClick:Z=>O(W)},[y(K(Jt))],8,g9)])]),_:2},1024)]))),128)),y(X,{onClick:St(M,["stop"]),icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[15]||(B[15]=[U("添加参数",-1)])]),_:1},8,["icon"])])])])]),_:1},8,["model"])])]),y(zg,{batch_node_key:n.nodeId,ref_key:"runTestRef",ref:a},null,8,["batch_node_key"])]),_:1})}}},m9=Te(_9,[["__scopeId","data-v-5120569a"]]),y9={class:"sub-field-item"},b9={style:{width:"200px"}},x9={class:"field-list-item"},w9={class:"field-label"},C9={class:"field-type"},S9=["onClick"],k9={key:1,class:"btn-hover-wrap",style:{opacity:"0"}},E9=["onClick"],D9={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array},variableOptions:{type:Array,default:()=>[]}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"165px":"130px"),i=(u,c)=>{c[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(u,c)=>{c.splice(u,1)},s=u=>{u.subs=[]},a=u=>u.typ=="object"&&e.level<=2,l=(u,c,f)=>{f.tags=c,f.desc=u};return(u,c)=>{const f=ln,p=ii,h=Vt,g=It,m=Nt("SubsKey",!0);return w(!0),R(ae,null,ye(e.data,(_,v)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:_.cu_key},[d("div",y9,[y(p,null,{default:x(()=>[c[0]||(c[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(f,{style:In({width:o.value}),value:_.key,"onUpdate:value":b=>_.key=b,placeholder:"请输入"},null,8,["style","value","onUpdate:value"])]),_:2},1024),y(g,{onChange:b=>s(_),value:_.typ,"onUpdate:value":b=>_.typ=b,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,b=>(w(),Q(h,{value:b.value},{default:x(()=>[U(j(b.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value"]),d("div",b9,[_.typ!="object"?(w(),Q(ot,{key:0,options:n.variableOptions,defaultSelectedList:_.tags,defaultValue:_.desc,onChange:(b,C)=>l(b,C,_),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:b,payload:C})=>[d("div",x9,[d("div",w9,j(b),1),d("div",C9,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ie("",!0)]),a(_)?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:b=>i(v,e.data)},[y(K(Fn))],8,S9)):(w(),R("div",k9,[y(K(Fn))])),d("div",{class:"btn-hover-wrap",onClick:b=>r(v,e.data)},[y(K(Jt))],8,E9)]),_.subs&&_.subs.length>0?(w(),Q(m,{key:0,level:e.level+1,typOptions:e.typOptions,variableOptions:e.variableOptions,data:_.subs},null,8,["level","typOptions","variableOptions","data"])):ie("",!0)],2))),128)}}},A9=Te(D9,[["__scopeId","data-v-a1254e93"]]),O9={class:"problem-optimization-form"},N9={class:"node-form-content"},M9={class:"gray-block"},T9={key:0,class:"gray-block",style:{"margin-top":"12px"}},$9={class:"array-form-box"},P9={class:"form-item-list"},R9={class:"flex-block-item",style:{gap:"8px"}},B9={class:"flex-block-item",style:{gap:"8px"}},L9={style:{width:"200px"}},I9={class:"field-list-item"},F9={class:"field-label"},j9={class:"field-type"},V9=["onClick"],H9=["onClick"],U9={key:0,class:"sub-field-box"},z9={class:"gray-block",style:{"margin-top":"12px"}},q9={class:"array-form-box"},G9={class:"input-block-item"},X9={class:"input-header"},W9={key:0},Y9={key:1},K9={key:2},J9=["onClick"],Z9={class:"field-list-item"},Q9={class:"field-label"},eF={class:"field-type"},tF={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i={text:"请输入文本消息内容，键入/可以插入变量",image:"请输入图片消息的url（系统发送时会自动转成图片发送），键入/可插入变量",voice:"请输入语音的url（系统发送时会自动转成语音发送），键入/可插入变量"},r=[{label:"返回消息",value:"message"},{label:"返回消息和变量",value:"variable"}],s=G([]),a=Je({}),l=(N,L)=>{if(N){let $=`at_input_${L}`;a[$]=N}},u=(N,L,$)=>{$.tags=L,$.content=N},c=(N,L,$)=>{$.tags=L,$.desc=N},f=()=>{const N=o.lf.getNodeModelById(o.nodeId);if(N){let L=N.getAllParentVariable();L.forEach($=>{$.tags=$.tags||[]}),s.value=L}};function p(N){return N.typ?h(s.value,N.typ):s.value}function h(N,L){function $(B){const A=[];for(const D of B)if(D.children&&D.children.length>0){const T=$(D.children);if(T.length>0){const F={...D,children:T};A.push(F)}}else D.typ&&D.typ===L&&A.push({...D});return A}return $(N)}const g=Je({out_type:"message",messages:[{key:_n(16),type:"text",content:""}],outputs:[{key:"",typ:"",subs:[]}]}),m=()=>{const N=JSON.stringify({finish:{...g}});t("update-node",{...o.node,node_params:N})},_=()=>{try{let N=o.node.dataRaw||o.node.node_params||"{}",L=JSON.parse(N).finish||{};L=JSON.parse(JSON.stringify(L)),f(),g.out_type=L.out_type||"message",g.messages=L.messages||[],g.messages.length==0&&(g.messages=[{key:_n(16),type:"text",content:""}]),g.outputs=L.outputs||[]}catch(N){}};gt(()=>g,()=>{m()},{deep:!0});const v=N=>{if(g.messages.length>=5)return xt.warning("最多添加5条消息");g.messages.push({key:_n(16),type:N,content:""})},b=N=>{if(g.messages.length<=1)return xt.warning("最少添加1条消息");g.messages.splice(N,1)},C=()=>{t("close")},M=()=>{g.outputs.push({key:"",typ:"string",subs:[],cu_key:_n(16)})},O=N=>{g.outputs.splice(N,1)},k=N=>{N.subs=[],N.desc=void 0,N.tags=[]},E=N=>{g.outputs[N].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},S=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return ut(()=>{_()}),(N,L)=>{const $=ef,B=ln,A=Vt,D=It,T=Vn,F=kn,V=Kt,P=Lr,X=Br,oe=Ir,H=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"工作流完结的节点，在此节点可以定义工作流返回的信息",onClose:C},null,8,["title","iconName"])]),default:x(()=>[d("div",O9,[d("div",N9,[y(H,{ref:"formRef",layout:"vertical",model:g},{default:x(()=>[d("div",M9,[L[4]||(L[4]=d("div",{class:"gray-block-title"},"输出类型",-1)),y($,{class:"customer-segmented",value:g.out_type,"onUpdate:value":L[0]||(L[0]=W=>g.out_type=W),options:r},null,8,["value"])]),g.out_type=="variable"?(w(),R("div",T9,[L[8]||(L[8]=d("div",{class:"gray-block-title"},"输出变量",-1)),d("div",$9,[L[7]||(L[7]=d("div",{class:"field-key-title"},[d("div",{class:"field-key",style:{width:"200px"}},"参数key"),d("div",{class:"field-key",style:{width:"114px"}},"类型"),d("div",{class:"field-key",style:{flex:"1"}},"参数值")],-1)),d("div",P9,[y(F,{label:null},{default:x(()=>[d("div",R9,[y(B,{style:{width:"200px"},disabled:"",value:"content",placeholder:"请输入"}),y(T,null,{default:x(()=>[y(D,{value:"string",disabled:"",placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),R(ae,null,ye(S,W=>y(A,{value:W.value,key:W.value},{default:x(()=>[U(j(W.value),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1}),d("div",null,[y(K(Qc),{style:{color:"#faad14"}}),L[5]||(L[5]=U(" content的返回值请在下方消息中设置 ",-1))])])]),_:1})]),(w(!0),R(ae,null,ye(g.outputs,(W,Z)=>(w(),R("div",{class:"form-item-list",key:Z},[y(F,{label:null},{default:x(()=>[d("div",B9,[y(B,{style:{width:"200px"},value:W.key,"onUpdate:value":le=>W.key=le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(T,null,{default:x(()=>[y(D,{onChange:le=>k(W),value:W.typ,"onUpdate:value":le=>W.typ=le,placeholder:"请选择",style:{width:"114px"}},{default:x(()=>[(w(),R(ae,null,ye(S,le=>y(A,{value:le.value,key:le.value},{default:x(()=>[U(j(le.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),d("div",L9,[W.typ!="object"?(w(),Q(ot,{key:0,options:p(W),defaultSelectedList:W.tags,defaultValue:W.desc,onOpen:f,onChange:(le,te)=>c(le,te,W,Z),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:le,payload:te})=>[d("div",I9,[d("div",F9,j(le),1),d("div",j9,j(te.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])):ie("",!0)]),W.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:le=>E(Z)},[y(K(Fn))],8,V9)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:le=>O(Z)},[y(K(Jt))],8,H9)]),W.subs&&W.subs.length>0?(w(),R("div",U9,[y(T,null,{default:x(()=>[y(A9,{data:W.subs,level:2,typOptions:S,variableOptions:s.value},null,8,["data","variableOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128)),y(V,{onClick:M,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...L[6]||(L[6]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),d("div",z9,[L[13]||(L[13]=d("div",{class:"gray-block-title"},"自定义消息",-1)),d("div",q9,[L[12]||(L[12]=d("div",{class:"form-item-label",style:{"margin-bottom":"8px"}}," 未自定义消息内容，系统默认将结束节点的上一级大模型节点的输出或者指 定回复节点的输出作为消息返回。最多添加5条消息。 ",-1)),(w(!0),R(ae,null,ye(g.messages,(W,Z)=>(w(),R("div",{class:"form-item-list",key:Z},[y(F,{label:null},{default:x(()=>[d("div",G9,[d("div",X9,[d("div",null,[U(j(Z+1)+"、 ",1),W.type=="text"?(w(),R("span",W9,"文本消息")):ie("",!0),W.type=="image"?(w(),R("span",Y9,"图片消息")):ie("",!0),W.type=="voice"?(w(),R("span",K9,"语音消息")):ie("",!0)]),d("div",{class:"btn-hover-wrap",onClick:le=>b(Z)},[y(K(Jt))],8,J9)]),y(ot,{inputStyle:"height: 100px;",ref_for:!0,ref:le=>l(le,Z),options:s.value,defaultSelectedList:W.tags,defaultValue:W.content,onOpen:f,type:"textarea",onChange:(le,te)=>u(le,te,W,Z),placeholder:i[W.type]},{option:x(({label:le,payload:te})=>[d("div",Z9,[d("div",Q9,j(le),1),d("div",eF,j(te.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange","placeholder"])])]),_:2},1024)]))),128)),y(oe,null,{overlay:x(()=>[y(X,null,{default:x(()=>[y(P,{onClick:L[1]||(L[1]=W=>v("text"))},{default:x(()=>[...L[9]||(L[9]=[d("a",null,"文本",-1)])]),_:1}),y(P,{onClick:L[2]||(L[2]=W=>v("image"))},{default:x(()=>[...L[10]||(L[10]=[d("a",null,"图片",-1)])]),_:1}),y(P,{onClick:L[3]||(L[3]=W=>v("voice"))},{default:x(()=>[...L[11]||(L[11]=[d("a",null,"语音",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",null,[y(V,{type:"dashed",block:""},{default:x(()=>[y(K(Ht)),U("添加消息 （"+j(g.messages.length)+" / 5）",1)]),_:1})])]),_:1})])])]),_:1},8,["model"])])])]),_:1})}}},nF=Te(tF,[["__scopeId","data-v-45bb4bd1"]]),Sr=[{label:"关闭",value:!1},{label:"开启",value:!0}],ol=[{label:"男生",value:"male-qn-jingying"},{label:"女生",value:"female-chengshu"},{label:"男童",value:"clever_boy"},{label:"女童",value:"lovely_girl"}],oF={happy:"高兴",sad:"悲伤",angry:"愤怒",fearful:"害怕",disgusted:"厌恶",surprised:"惊讶",calm:"中性",fluent:"生动",whisper:"低语"},iF=[8e3,16e3,22050,24e3,32e3,44100],rF=[32e3,64e3,128e3,256e3],sF=["mp3","pcm","flac","wav"],aF=[{label:"单声道",value:1},{label:"双声道",value:2}],lF={url:"url",hex:"hex"},uF={spacious_echo:"空旷回音",auditorium_echo:"礼堂广播",lofi_telephone:"电话失真",robotic:"电音"},qg={auto:"自动检测",Chinese:"中文",Yue:"粤语",English:"英语",Arabic:"阿拉伯语",Russian:"俄语",Spanish:"西班牙语",French:"法语",Portuguese:"葡萄牙语",German:"德语",Turkish:"土耳其语",Dutch:"荷兰语",Ukrainian:"乌克兰语",Vietnamese:"越南语",Indonesian:"印度尼西亚语",Japanese:"日语",Italian:"意大利语",Korean:"韩语",Thai:"泰语",Polish:"波兰语",Romanian:"罗马尼亚语",Greek:"希腊语",Czech:"捷克语",Finnish:"芬兰语",Hindi:"印地语",Bulgarian:"保加利亚语",Danish:"丹麦语",Hebrew:"希伯来语",Malay:"马来语",Persian:"波斯语",Slovak:"斯洛伐克语",Swedish:"瑞典语",Croatian:"克罗地亚语",Filipino:"菲律宾语",Hungarian:"匈牙利语",Norwegian:"挪威语",Slovenian:"斯洛文尼亚语",Catalan:"加泰罗尼亚语",Nynorsk:"新挪威语",Tamil:"泰米尔语",Afrikaans:"南非荷兰语"},li={speed:{ui_type:"slider",key:"voice_setting.speed",label:"语速",type:"number",required:!0,tooltip:"合成音频的语速，取值范围 [0.5, 2]，默认值为 1.0",default:1,min:.5,max:2,step:.1,marks:{.5:"0.5",2:"2"}},vol:{ui_type:"slider",key:"voice_setting.vol",label:"音量",type:"number",required:!0,tooltip:"合成音频的音量，取值越大，音量越高。取值范围 (0,10]，默认值为 1",default:1,min:0,max:10,step:1,marks:{0:"0",10:"10"}},pitch:{ui_type:"slider",key:"voice_setting.pitch",label:"音高",type:"number",required:!0,tooltip:"合成音频的语调，取值范围 [-12,12]，默认值为 0，其中 0 为原音色输出",default:0,min:-12,max:12,step:1,marks:{"-12":"-12",12:"12"}}},ui={pitch:{ui_type:"slider",key:"voice_modify.pitch",label:"音高",type:"number",tooltip:"音高调整（低沉/明亮），范围 [-100,100]，数值接近 -100，声音更低沉；接近 100，声音更明亮",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},intensity:{ui_type:"slider",key:"voice_modify.intensity",label:"强度",type:"number",tooltip:"强度调整（力量感/柔和），范围 [-100,100]，数值接近 -100，声音更刚劲；接近 100，声音更轻柔",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}},timbre:{ui_type:"slider",key:"voice_modify.timbre",label:"音色",type:"number",tooltip:"音色调整（磁性/清脆），范围 [-100,100]，数值接近 -100，声音更浑厚；数值接近 100，声音更清脆",default:0,min:-100,max:100,step:1,marks:{"-100":"-100",100:"100"}}},dF={data:{desc:"音频合成结果",type:"object",properties:{audio:{desc:"音频数据（hex 编码）",type:"string"},status:{desc:"音频合成状态",type:"number"}}},extra_info:{desc:"音频附加信息",type:"object",properties:{audio_length:{desc:"音频时长（毫秒）",type:"number"},audio_sample_rate:{desc:"音频采样率",type:"number"},audio_size:{desc:"音频大小（字节）",type:"number"},bitrate:{desc:"音频码率",type:"number"},word_count:{desc:"文本字数",type:"number"},invisible_character_ratio:{desc:"不可见字符比例",type:"number"},usage_characters:{desc:"实际消耗字符数",type:"number"},audio_format:{desc:"音频格式",type:"string"},audio_channel:{desc:"音频声道数",type:"number"}}},trace_id:{desc:"请求追踪 ID",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},cF={input_sensitive:{desc:"输入内容是否命中敏感信息",type:"boolean"},input_sensitive_type:{desc:"敏感类型标识（0 表示无敏感）",type:"number"},demo_audio:{desc:"示例音频数据",type:"string"},base_resp:{desc:"基础响应信息",type:"object",properties:{status_code:{desc:"状态码，0 表示成功",type:"number"},status_msg:{desc:"状态描述",type:"string"}}}},fF={class:"node-options"},pF={class:"options-item is-required"},hF={class:"field-list-item"},vF={class:"field-label"},gF={class:"field-type"},_F={class:"options-item is-required"},mF={class:"field-list-item"},yF={class:"field-label"},bF={class:"field-type"},xF={class:"options-item"},wF={class:"options-item-tit flex-between"},CF={class:"options-item"},SF={class:"form-box"},kF={class:"form-item"},EF={class:"form-tit"},DF={class:"form-cont"},AF={class:"field-list-item"},OF={class:"field-label"},NF={class:"field-type"},MF={class:"form-item"},TF={class:"form-tit"},$F={class:"form-cont"},PF={class:"field-list-item"},RF={class:"field-label"},BF={class:"field-type"},LF={class:"options-item"},IF={class:"form-box"},FF={class:"form-item"},jF={class:"form-tit"},VF={class:"form-cont"},HF={class:"field-list-item"},UF={class:"field-label"},zF={class:"field-type"},qF={class:"form-item"},GF={class:"form-tit"},XF={class:"form-cont"},WF={class:"options-item"},YF={class:"form-box"},KF={class:"form-item"},JF={class:"form-tit c262626"},ZF={class:"form-cont"},QF={class:"options-item"},ej={class:"form-box"},tj={class:"form-item"},nj={class:"form-tit"},oj={class:"form-cont"},ij={class:"form-item"},rj={class:"form-tit"},sj={class:"form-cont"},aj={class:"form-item"},lj={class:"form-tit"},uj={class:"form-cont"},dj={class:"node-options"},cj={class:"options-item"},fj={__name:"voice-clone-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("getNode"),o=He("setData");G(null);const i=G([]),r=G([]);G([]);const s=Je({model_id:0,model:"",model_config_id:0,file_url:"",voice_id:"",clone_prompt:{prompt_audio_url:"",prompt_text:"",tag_map:{}},text:"",language_boost:"auto",need_noise_reduction:!1,need_volume_normalization:!1,aigc_watermark:!1,tag_map:{}}),a=G(!1);ut(()=>{l()});function l(){c(),r.value=Ci(cF),u()}function u(){var _;let g=JSON.parse(e.node.node_params),m=((_=g==null?void 0:g.voice_clone)==null?void 0:_.arguments)||{};m.tag_map=m.tag_map?m.tag_map:{},Object.assign(s,m)}function c(){i.value=t().getAllParentVariable()}function f(g,m,_,v=null){v=v||s,v[g]=m,s.tag_map[g]=_,h()}function p(){a.value=!a.value}function h(){let g=JSON.parse(e.node.node_params);s.model_id=Number(s.model_id||0),Object.assign(g.voice_clone,{model_config_id:s.model_config_id,arguments:s,output:r.value}),o({...e.node,node_params:JSON.stringify(g)})}return(g,m)=>{const _=Qt,v=Vt,b=It;return w(),Q(cn,null,{default:x(()=>{var C,M,O,k,E;return[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"支持音色快速复制"},null,8,["title","iconName"]),d("div",fF,[m[27]||(m[27]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),d("div",pF,[m[12]||(m[12]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"复刻音频文件"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((C=s.tag_map)==null?void 0:C.file_url)||[],defaultValue:s.file_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:m[0]||(m[0]=(S,N)=>f("file_url",S,N))},{option:x(({label:S,payload:N})=>[d("div",hF,[d("div",vF,j(S),1),d("div",gF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),m[13]||(m[13]=d("div",{class:"desc"},"待复刻音频",-1))]),d("div",_F,[m[14]||(m[14]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音频ID"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((M=s.tag_map)==null?void 0:M.voice_id)||[],defaultValue:s.voice_id,ref:"atInputRef",placeholder:"请输入参数值，键入/插入变量",onOpen:c,onChange:m[1]||(m[1]=(S,N)=>f("voice_id",S,N))},{option:x(({label:S,payload:N})=>[d("div",mF,[d("div",yF,j(S),1),d("div",bF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),m[15]||(m[15]=d("div",{class:"desc"},'克隆音色的 voice_id，正确示例：“MiniMax001"”，长度范围［8,256］，首字符必须为英文字母允许数字、字母、_未位字符不可为-._，不可与已有id 重复',-1))]),d("div",xF,[d("div",wF,[m[17]||(m[17]=d("div",{class:"option-label"},"复刻示例音频",-1)),d("a",{onClick:p},[m[16]||(m[16]=U("高级设置 ",-1)),a.value?(w(),Q(K(Ha),{key:1})):(w(),Q(K(Ro),{key:0}))])])]),a.value?(w(),R(ae,{key:0},[d("div",CF,[d("div",SF,[d("div",kF,[d("div",EF,[y(_,{title:"音色复刻示例音频，提供本参数将有助于增强语音合成的音色相似度和稳定性"},{default:x(()=>[m[18]||(m[18]=U(" 音频文件 ",-1)),y(K(mt))]),_:1})]),d("div",DF,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((O=s.tag_map)==null?void 0:O.prompt_audio_url)||[],defaultValue:s.clone_prompt.prompt_audio_url,ref:"atInputRef",placeholder:"输入文件的url，键入/插入变量",onOpen:c,onChange:m[2]||(m[2]=(S,N)=>f("prompt_audio_url",S,N,s.clone_prompt))},{option:x(({label:S,payload:N})=>[d("div",AF,[d("div",OF,j(S),1),d("div",NF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",MF,[d("div",TF,[y(_,{title:"示例音频的对应文本，需确保和音频内容一致，句末需有标点符号做结尾"},{default:x(()=>[m[19]||(m[19]=U(" 文本 ",-1)),y(K(mt))]),_:1})]),d("div",$F,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((k=s.tag_map)==null?void 0:k.prompt_text)||[],defaultValue:s.clone_prompt.prompt_text,ref:"atInputRef",placeholder:"输入示例音频的对应文本，键入/插入变量",onOpen:c,onChange:m[3]||(m[3]=(S,N)=>f("prompt_text",S,N,s.clone_prompt))},{option:x(({label:S,payload:N})=>[d("div",PF,[d("div",RF,j(S),1),d("div",BF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])])])]),d("div",LF,[m[22]||(m[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"复刻试听参数")],-1)),d("div",IF,[d("div",FF,[d("div",jF,[y(_,{title:"复刻试听参数，限制 1000 字符以内。模型将使用复刻后的音色朗读本段文本内容，并返回试听音频链接。"},{default:x(()=>[m[20]||(m[20]=U(" 文本 ",-1)),y(K(mt))]),_:1})]),d("div",VF,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:i.value,defaultSelectedList:((E=s.tag_map)==null?void 0:E.text)||[],defaultValue:s.text,ref:"atInputRef",placeholder:"输入复刻试听的文本，键入/插入变量",onOpen:c,onChange:m[4]||(m[4]=(S,N)=>f("text",S,N))},{option:x(({label:S,payload:N})=>[d("div",HF,[d("div",UF,j(S),1),d("div",zF,j(N.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])])]),d("div",qF,[d("div",GF,[y(_,{title:"是否增强对指定的小语种和方言的识别能力。默认值为 null，可设置为 auto 让模型自主判断。"},{default:x(()=>[m[21]||(m[21]=U(" 小语种识别能力 ",-1)),y(K(mt))]),_:1})]),d("div",XF,[y(b,{value:s.language_boost,"onUpdate:value":m[5]||(m[5]=S=>s.language_boost=S),placeholder:"请选择",onChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(K(qg),(S,N)=>(w(),Q(v,{key:N,value:N},{default:x(()=>[U(j(S),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",WF,[d("div",YF,[d("div",KF,[d("div",JF,[y(_,{title:"指定合成试听音频使用的语音模型，提供 text(文本) 字段时必传此字段"},{default:x(()=>[m[23]||(m[23]=U(" 试听音频语音模型 ",-1)),y(K(mt))]),_:1})]),d("div",ZF,[y(rr,{style:{width:"276px"},"model-type":"TTS",modeName:s.model,"onUpdate:modeName":m[6]||(m[6]=S=>s.model=S),modeId:s.model_id,"onUpdate:modeId":m[7]||(m[7]=S=>s.model_id=S),useConfigId:s.model_config_id,"onUpdate:useConfigId":m[8]||(m[8]=S=>s.model_config_id=S),onChange:h},null,8,["modeName","modeId","useConfigId"])])])])]),d("div",QF,[d("div",ej,[d("div",tj,[d("div",nj,[y(_,{title:"音频复刻参数，表示是否开启降噪"},{default:x(()=>[m[24]||(m[24]=U(" 降噪 ",-1)),y(K(mt))]),_:1})]),d("div",oj,[y(ko,{value:s.need_noise_reduction,"onUpdate:value":m[9]||(m[9]=S=>s.need_noise_reduction=S),options:K(Sr),onChange:h},null,8,["value","options"])])]),d("div",ij,[d("div",rj,[y(_,{title:"音频复刻参数，是否开启音量归一化"},{default:x(()=>[m[25]||(m[25]=U(" 音量归一化 ",-1)),y(K(mt))]),_:1})]),d("div",sj,[y(ko,{value:s.need_volume_normalization,"onUpdate:value":m[10]||(m[10]=S=>s.need_volume_normalization=S),options:K(Sr),onChange:h},null,8,["value","options"])])]),d("div",aj,[d("div",lj,[y(_,{title:"是否在合成试听音频的末尾添加音频节奏标识"},{default:x(()=>[m[26]||(m[26]=U(" 音频节奏标识 ",-1)),y(K(mt))]),_:1})]),d("div",uj,[y(ko,{value:s.aigc_watermark,"onUpdate:value":m[11]||(m[11]=S=>s.aigc_watermark=S),options:K(Sr),onChange:h},null,8,["value","options"])])])])])],64)):ie("",!0)]),d("div",dj,[m[28]||(m[28]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",cj,[y(Fi,{"tree-data":r.value},null,8,["tree-data"])])])]}),_:1})}}},pj=Te(fj,[["__scopeId","data-v-5f428456"]]);function hj(n={}){return Xc.get({url:"/manage/getMiniMaxVoiceList",params:n})}const vj={class:"zm-line2"},gj={__name:"select-voice-modal",props:{modelConfigId:{type:[Number,String]},voiceType:{type:String,default:"all"}},emits:["change"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=G(!1),s=G(!1),a=G(""),l=G([]),u=G([]),c=G([]),f=[{title:"序号",dataIndex:"index",key:"index",width:80},{title:"名称",dataIndex:"voice_name",width:120},{title:"ID",dataIndex:"voice_id",width:80},{title:"描述",dataIndex:"description",width:200}],p=Xe(()=>a.value?l.value.filter(v=>v.voice_name.indexOf(a.value)>-1||v.voice_id==a.value):l.value);function h(v=[]){u.value=v,g(),r.value=!0}function g(){s.value=!0,hj({model_config_id:i.modelConfigId,voice_type:i.voiceType}).then(v=>{l.value=(v==null?void 0:v.data)||[],l.value.forEach((b,C)=>{var M;b.index=C+1,b.description=((M=b==null?void 0:b.description)==null?void 0:M[0])||""}),c.value=l.value.filter(b=>u.value.includes(b.voice_id))}).finally(()=>{s.value=!1})}function m(v,b){u.value=v,c.value=b}function _(){o("change",Bn(u.value),Bn(c.value)),r.value=!1}return e({show:h}),(v,b)=>{const C=ln,M=Qt,O=Ms,k=vn;return w(),Q(k,{open:r.value,"onUpdate:open":b[1]||(b[1]=E=>r.value=E),title:"选择音色",width:"670px",onOk:_},{default:x(()=>[y(C,{value:a.value,"onUpdate:value":b[0]||(b[0]=E=>a.value=E),valueModifiers:{trim:!0},placeholder:"请输入音色名称/ID搜索","allow-clear":"",style:{width:"240px"}},{suffix:x(()=>[y(K(hg))]),_:1},8,["value"]),y(O,{class:"mt16",loading:s.value,columns:f,"data-source":p.value,pagination:!1,"row-key":"voice_id","row-selection":{type:"radio",selectedRowKeys:u.value,onChange:m},scroll:{y:500}},{bodyCell:x(({column:E,record:S})=>[E.dataIndex==="description"?(w(),Q(M,{key:0,title:S.description},{default:x(()=>[d("div",vj,j(S.description),1)]),_:2},1032,["title"])):ie("",!0)]),_:1},8,["loading","data-source","row-selection"])]),_:1},8,["open"])}}},_j=Te(gj,[["__scopeId","data-v-fe60fd78"]]),mj={class:"node-options"},yj={class:"options-item is-required"},bj={class:"options-item is-required"},xj={class:"field-list-item"},wj={class:"field-label"},Cj={class:"field-type"},Sj={class:"options-item is-required"},kj={class:"flex-between"},Ej={class:"options-item is-required"},Dj={class:"flex-between"},Aj={class:"field-list-item"},Oj={class:"field-label"},Nj={class:"field-type"},Mj={class:"options-item"},Tj={class:"form-box"},$j={class:"option-type"},Pj={class:"form-cont"},Rj={class:"form-item"},Bj={class:"form-tit required"},Lj={class:"form-cont"},Ij={class:"form-item"},Fj={class:"form-tit required"},jj={class:"form-cont"},Vj={class:"options-item"},Hj={class:"form-box"},Uj={class:"form-item"},zj={class:"form-tit"},qj={class:"form-cont"},Gj={class:"form-item"},Xj={class:"form-tit"},Wj={class:"form-cont"},Yj={class:"form-item"},Kj={class:"form-tit"},Jj={class:"form-cont"},Zj={class:"form-item"},Qj={class:"form-tit"},eV={class:"form-cont"},tV={class:"options-item"},nV={class:"form-box"},oV={class:"option-type"},iV={class:"form-cont"},rV={class:"form-item"},sV={class:"form-tit"},aV={class:"form-cont"},lV={class:"options-item"},uV={class:"form-box"},dV={class:"form-item"},cV={class:"form-tit"},fV={class:"form-cont"},pV={class:"form-item"},hV={class:"form-tit"},vV={class:"form-cont"},gV={class:"form-item"},_V={class:"form-tit"},mV={class:"form-cont"},yV={class:"form-item"},bV={class:"form-tit"},xV={class:"form-cont"},wV={class:"form-item"},CV={class:"form-tit"},SV={class:"form-cont"},kV={class:"node-options"},EV={class:"options-item"},DV={__name:"voice-synthesis-form",props:{lf:{type:Object,default:null},node:{type:Object,default:()=>({})}},setup(n){const e=n,t=He("getNode"),o=He("setData"),i=G(null),r=G([]),s=G([]),a=G([]),l=Je({model_id:0,use_model:"",model_config_id:0,text:"",voice_set_type:1,voice_setting:{voice_id:"male-qn-jingying",voice_name:"",speed:1,vol:1,pitch:0,emotion:"happy",text_normalization:!1},audio_setting:{sample_rate:32e3,bitrate:128e3,format:"mp3",channel:1,force_cbr:!1},voice_modify:{pitch:0,intensity:0,timbre:0,sound_effects:""},language_boost:"auto",output_format:"url",subtitle_enable:!1,aigc_watermark:!1,tag_map:{}}),u=G(!1),c=Xe(()=>{var L,$;const E=l.voice_setting.voice_id,N=ol.some(B=>B.value==E)?"-1":(($=(L=a.value)==null?void 0:L[0])==null?void 0:$.voice_id)??E;return[...ol,{label:"自定义",value:N}]}),f=Xe(()=>[...ol,...a.value.map(E=>({label:E.voice_name,value:E.voice_id}))]);ut(()=>{p()});function p(){g(),s.value=Ci(dF),h()}function h(){var N,L;let E=JSON.parse(e.node.node_params),S=((N=E==null?void 0:E.text_to_audio)==null?void 0:N.arguments)||{};if(S.tag_map=S.tag_map?S.tag_map:{},Object.assign(l,S),(L=l.voice_setting)!=null&&L.voice_id&&ol.findIndex($=>{var B;return $.value==((B=l.voice_setting)==null?void 0:B.voice_id)})<0){const{voice_id:$,voice_name:B}=l.voice_setting;a.value=[{voice_id:$,voice_name:B}]}}function g(){r.value=t().getAllParentVariable()}function m(E,S,N){l[E]=S,l.tag_map[E]=N,k()}function _(E,S){l.voice_setting.voice_id=E,l.tag_map.voice_setting_voice_id=S,k()}function v(){if(!l.model_config_id)return xt.warning("请先选择语音模型");i.value.show([l.voice_setting.voice_id])}function b(){l.voice_setting.voice_id="male-qn-jingying",k()}function C(){k()}function M(E,S){l.voice_setting.voice_id=E[0],l.voice_setting.voice_name=S[0].voice_name,a.value=S,k()}function O(){u.value=!u.value}function k(){let E=JSON.parse(e.node.node_params);l.model_id=Number(l.model_id||0),Object.assign(E.text_to_audio,{voice_type:"all",model_config_id:l.model_config_id,arguments:l,output:s.value}),o({...e.node,node_params:JSON.stringify(E)})}return(E,S)=>{const N=Qt,L=Vt,$=It,B=Ns,A=Ey,D=$n,T=ky;return w(),Q(cn,null,{default:x(()=>{var F,V;return[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"调用大模型，生成回复。"},null,8,["title","iconName"]),d("div",mj,[S[50]||(S[50]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),d("div",yj,[S[19]||(S[19]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"语音模型")],-1)),y(rr,{"model-type":"TTS",modeName:l.use_model,"onUpdate:modeName":S[0]||(S[0]=P=>l.use_model=P),modeId:l.model_id,"onUpdate:modeId":S[1]||(S[1]=P=>l.model_id=P),useConfigId:l.model_config_id,"onUpdate:useConfigId":S[2]||(S[2]=P=>l.model_config_id=P),onChange:b},null,8,["modeName","modeId","useConfigId"])]),d("div",bj,[S[20]||(S[20]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"文本"),d("div",{class:"option-type"},"string")],-1)),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:((F=l.tag_map)==null?void 0:F.text)||[],defaultValue:l.text,ref:"atInputRef",onOpen:g,onChange:S[3]||(S[3]=(P,X)=>m("text",P,X))},{option:x(({label:P,payload:X})=>[d("div",xj,[d("div",wj,j(P),1),d("div",Cj,j(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),S[21]||(S[21]=d("div",{class:"desc"},"需要合成语音的文本，长度限制小于 10000字符；文本长度尽量不要超过3000字，否则生成速度较慢",-1))]),d("div",Sj,[S[22]||(S[22]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"选择音色")],-1)),d("div",kj,[y(ko,{value:l.voice_setting.voice_id,"onUpdate:value":S[4]||(S[4]=P=>l.voice_setting.voice_id=P),options:c.value,onChange:k},null,8,["value","options"]),y(N,{title:"高级设置"},{default:x(()=>[d("span",{class:"setting-icon",onClick:O},[y(K(Kc))])]),_:1})])]),d("div",Ej,[S[26]||(S[26]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音色设置"),d("div",{class:"option-type"},"string")],-1)),d("div",Dj,[y($,{value:l.voice_set_type,"onUpdate:value":S[5]||(S[5]=P=>l.voice_set_type=P),onChange:C},{default:x(()=>[y(L,{value:1},{default:x(()=>[...S[23]||(S[23]=[U("选择音色",-1)])]),_:1}),y(L,{value:2},{default:x(()=>[...S[24]||(S[24]=[U("设置音色",-1)])]),_:1})]),_:1},8,["value"]),l.voice_set_type==1?(w(),Q($,{key:0,value:l.voice_setting.voice_id,"onUpdate:value":S[6]||(S[6]=P=>l.voice_setting.voice_id=P),open:!1,onDropdownVisibleChange:v,style:{width:"100%"}},{default:x(()=>[y(L,{value:"-1"},{default:x(()=>[...S[25]||(S[25]=[U("请选择",-1)])]),_:1}),(w(!0),R(ae,null,ye(f.value,P=>(w(),Q(L,{value:P.value,key:P.item},{default:x(()=>[U(j(P.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(w(),Q(ot,{key:1,type:"textarea",inputStyle:"height: 33px",options:r.value,defaultSelectedList:((V=l.tag_map)==null?void 0:V.voice_setting_voice_id)||[],defaultValue:l.voice_setting.voice_id,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:g,onChange:_},{option:x(({label:P,payload:X})=>[d("div",Aj,[d("div",Oj,j(P),1),d("div",Nj,j(X.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]))])]),u.value?(w(),R(ae,{key:0},[d("div",Mj,[S[30]||(S[30]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"声音设置")],-1)),d("div",Tj,[(w(),R(ae,null,ye(["speed","vol","pitch"],P=>d("div",{key:P,class:"form-item"},[d("div",{class:Ct(["form-tit",{required:K(li)[P]}.required])},[y(N,{title:K(li)[P].tooltip},{default:x(()=>[U(j(K(li)[P].label)+" ",1),y(K(mt)),d("span",$j,j(K(li)[P].type),1)]),_:2},1032,["title"])],2),d("div",Pj,[y(T,null,{default:x(()=>[y(A,{span:15},{default:x(()=>[y(B,{value:l.voice_setting[P],"onUpdate:value":X=>l.voice_setting[P]=X,step:K(li)[P].step,min:K(li)[P].min,max:K(li)[P].max,marks:K(li)[P].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),y(A,{span:7},{default:x(()=>[y(D,{value:l.voice_setting[P],"onUpdate:value":X=>l.voice_setting[P]=X,placeholder:"请输入",min:K(li)[P].min,max:K(li)[P].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),d("div",Rj,[d("div",Bj,[y(N,{title:"控制合成语音的情绪，模型会根据输入文本自动匹配合适的情绪，一般无需手动指定；该参数仅对 speech-2.6-hd, speech-2.6-turbo, speech-02-hd, speech-02-turbo, speech-01-hd, speech-01-turbo 模型生效"},{default:x(()=>[S[27]||(S[27]=U(" 情绪 ",-1)),y(K(mt)),S[28]||(S[28]=d("span",{class:"option-type"},"string",-1))]),_:1})]),d("div",Lj,[y($,{value:l.voice_setting.emotion,"onUpdate:value":S[7]||(S[7]=P=>l.voice_setting.emotion=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(oF),(P,X)=>(w(),Q(L,{key:X},{default:x(()=>[U(j(P),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",Ij,[d("div",Fj,[y(N,{title:"是否启用中文、英语文本规范化，开启后可提升数字阅读场景的性能，但会略微增加延迟，默认值为 false"},{default:x(()=>[S[29]||(S[29]=U(" 中/英文本规范化 ",-1)),y(K(mt))]),_:1})]),d("div",jj,[y(ko,{value:l.voice_setting.text_normalization,"onUpdate:value":S[8]||(S[8]=P=>l.voice_setting.text_normalization=P),options:K(Sr),onChange:k},null,8,["value","options"])])])])]),d("div",Vj,[S[39]||(S[39]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"音频设置")],-1)),d("div",Hj,[d("div",Uj,[d("div",zj,[y(N,{title:"生成音频的采样率。可选范围[8000，16000，22050，24000，32000，44100]，默认为 32000"},{default:x(()=>[S[31]||(S[31]=U(" 采样率 ",-1)),y(K(mt))]),_:1}),S[32]||(S[32]=d("span",{class:"option-type"},"Number",-1))]),d("div",qj,[y($,{value:l.audio_setting.sample_rate,"onUpdate:value":S[9]||(S[9]=P=>l.audio_setting.sample_rate=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(iF),P=>(w(),Q(L,{key:P},{default:x(()=>[U(j(P),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",Gj,[d("div",Xj,[y(N,{title:"生成音频的比特率。可选范围[32000，64000，128000，256000]，默认值为 128000。该参数仅对 mp3 格式的音频生效"},{default:x(()=>[S[33]||(S[33]=U(" 比特率 ",-1)),y(K(mt))]),_:1}),S[34]||(S[34]=d("span",{class:"option-type"},"Number",-1))]),d("div",Wj,[y($,{value:l.audio_setting.bitrate,"onUpdate:value":S[10]||(S[10]=P=>l.audio_setting.bitrate=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(rF),P=>(w(),Q(L,{key:P},{default:x(()=>[U(j(P),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",Yj,[d("div",Kj,[y(N,{title:"生成音频的格式，wav 仅在非流式输出下支持"},{default:x(()=>[S[35]||(S[35]=U(" 格式 ",-1)),y(K(mt))]),_:1}),S[36]||(S[36]=d("span",{class:"option-type"},"string",-1))]),d("div",Jj,[y($,{value:l.audio_setting.format,"onUpdate:value":S[11]||(S[11]=P=>l.audio_setting.format=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(sF),P=>(w(),Q(L,{key:P},{default:x(()=>[U(j(P),1)]),_:2},1024))),128))]),_:1},8,["value"])])]),d("div",Zj,[d("div",Qj,[y(N,{title:"生成音频的声道数"},{default:x(()=>[S[37]||(S[37]=U(" 声道数 ",-1)),y(K(mt))]),_:1}),S[38]||(S[38]=d("span",{class:"option-type"},"Number",-1))]),d("div",eV,[y($,{value:l.audio_setting.channel,"onUpdate:value":S[12]||(S[12]=P=>l.audio_setting.channel=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(aF),P=>(w(),Q(L,{key:P.value,value:P.value},{default:x(()=>[U(j(P.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",tV,[S[43]||(S[43]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"声音效果器设置")],-1)),d("div",nV,[(w(),R(ae,null,ye(["pitch","intensity","timbre"],P=>d("div",{key:P,class:"form-item"},[d("div",{class:Ct(["form-tit",{required:K(ui)[P]}.required])},[y(N,{title:K(ui)[P].tooltip},{default:x(()=>[U(j(K(ui)[P].label)+" ",1),y(K(mt)),d("span",oV,j(K(ui)[P].type),1)]),_:2},1032,["title"])],2),d("div",iV,[y(T,null,{default:x(()=>[y(A,{span:15},{default:x(()=>[y(B,{value:l.voice_modify[P],"onUpdate:value":X=>l.voice_modify[P]=X,step:K(ui)[P].step,min:K(ui)[P].min,max:K(ui)[P].max,marks:K(ui)[P].marks},null,8,["value","onUpdate:value","step","min","max","marks"])]),_:2},1024),y(A,{span:7},{default:x(()=>[y(D,{value:l.voice_modify[P],"onUpdate:value":X=>l.voice_modify[P]=X,placeholder:"请输入",min:K(ui)[P].min,max:K(ui)[P].max,class:"ml16"},null,8,["value","onUpdate:value","min","max"])]),_:2},1024)]),_:2},1024)])])),64)),d("div",rV,[d("div",sV,[y(N,{title:"音效设置，单次仅能选择一种，可选"},{default:x(()=>[S[40]||(S[40]=U(" 音效 ",-1)),y(K(mt)),S[41]||(S[41]=d("span",{class:"option-type"},"string",-1))]),_:1})]),d("div",aV,[y($,{value:l.voice_modify.sound_effects,"onUpdate:value":S[13]||(S[13]=P=>l.voice_modify.sound_effects=P),placeholder:"请选择",onChange:k},{default:x(()=>[y(L,{value:""},{default:x(()=>[...S[42]||(S[42]=[U("无",-1)])]),_:1}),(w(!0),R(ae,null,ye(K(uF),(P,X)=>(w(),Q(L,{key:X,value:X},{default:x(()=>[U(j(P),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),d("div",lV,[S[49]||(S[49]=d("div",{class:"options-item-tit"},[d("div",{class:"option-label"},"其他设置")],-1)),d("div",uV,[d("div",dV,[d("div",cV,[y(N,{title:"是否增强对指定的小语种和方言的识别能力"},{default:x(()=>[S[44]||(S[44]=U(" 小语种识别能力 ",-1)),y(K(mt))]),_:1})]),d("div",fV,[y($,{value:l.language_boost,"onUpdate:value":S[14]||(S[14]=P=>l.language_boost=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(qg),(P,X)=>(w(),Q(L,{key:X,value:X},{default:x(()=>[U(j(P),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",pV,[d("div",hV,[y(N,{title:"控制输出结果形式的参数，可选值范围为[url, hex]。该参数仅在非流式场景生效，流式场景仅支持返回 hex 形式。返回的 url 有效期为 24 小时"},{default:x(()=>[S[45]||(S[45]=U(" 输出结果形式 ",-1)),y(K(mt))]),_:1})]),d("div",vV,[y($,{value:l.output_format,"onUpdate:value":S[15]||(S[15]=P=>l.output_format=P),placeholder:"请选择",onChange:k},{default:x(()=>[(w(!0),R(ae,null,ye(K(lF),(P,X)=>(w(),Q(L,{key:X,value:X},{default:x(()=>[U(j(P),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",gV,[d("div",_V,[y(N,{title:"对于音频恒定比特率（cbr）控制，可选 false、 true。当此参数设置为 true，将以恒定比特率方式进行音频编码。注意：本参数仅当音频设置为流式输出，且音频格式为 mp3 时生效。"},{default:x(()=>[S[46]||(S[46]=U(" 恒定比特率控制 ",-1)),y(K(mt))]),_:1})]),d("div",mV,[y(ko,{value:l.audio_setting.force_cbr,"onUpdate:value":S[16]||(S[16]=P=>l.audio_setting.force_cbr=P),options:K(Sr),onChange:k},null,8,["value","options"])])]),d("div",yV,[d("div",bV,[y(N,{title:"控制是否开启字幕服务，默认值为 false。此参数仅在非流式输出场景下有效，且仅对 speech-2.6-hd speech-2.6-turbo speech-02-turbo speech-02-hd speech-01-turbo speech-01-hd 模型有效"},{default:x(()=>[S[47]||(S[47]=U(" 开启字幕服务 ",-1)),y(K(mt))]),_:1})]),d("div",xV,[y(ko,{value:l.subtitle_enable,"onUpdate:value":S[17]||(S[17]=P=>l.subtitle_enable=P),options:K(Sr),onChange:k},null,8,["value","options"])])]),d("div",wV,[d("div",CV,[y(N,{title:"控制在合成音频的末尾添加音频节奏标识，默认值为 False。该参数仅对非流式合成生效"},{default:x(()=>[S[48]||(S[48]=U(" 合成音频的末尾添加音频节奏标识 ",-1)),y(K(mt))]),_:1})]),d("div",SV,[y(ko,{value:l.aigc_watermark,"onUpdate:value":S[18]||(S[18]=P=>l.aigc_watermark=P),options:K(Sr),onChange:k},null,8,["value","options"])])])])])],64)):ie("",!0)]),d("div",kV,[S[51]||(S[51]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",EV,[y(Fi,{"tree-data":s.value},null,8,["tree-data"])])]),y(_j,{ref_key:"voiceModalRef",ref:i,modelConfigId:l.model_config_id,onChange:M},null,8,["modelConfigId"])]}),_:1})}}},AV=Te(DV,[["__scopeId","data-v-1efe69ee"]]),OV="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M6.09452%2014.4098C4.97749%2014.0772%203.98319%2013.4598%203.19588%2012.6417C3.48959%2012.2936%203.66659%2011.8438%203.66659%2011.3527C3.66659%2010.2482%202.77116%209.35274%201.66659%209.35274C1.59977%209.35274%201.53372%209.35604%201.46858%209.36244C1.37985%208.9286%201.33325%208.47947%201.33325%208.0194C1.33325%207.32254%201.44018%206.65064%201.63852%206.0192C1.64786%206.01934%201.65721%206.0194%201.66659%206.0194C2.77116%206.0194%203.66659%205.12397%203.66659%204.0194C3.66659%203.7023%203.59279%203.40247%203.46145%203.13607C4.23242%202.4192%205.17342%201.88271%206.21729%201.59375C6.54805%202.2421%207.22215%202.68608%207.99992%202.68608C8.77769%202.68608%209.45179%202.2421%209.78255%201.59375C10.8264%201.88271%2011.7674%202.4192%2012.5384%203.13607C12.4071%203.40247%2012.3333%203.7023%2012.3333%204.0194C12.3333%205.12397%2013.2287%206.0194%2014.3333%206.0194C14.3426%206.0194%2014.352%206.01934%2014.3613%206.0192C14.5597%206.65064%2014.6666%207.32254%2014.6666%208.0194C14.6666%208.47947%2014.62%208.9286%2014.5313%209.36244C14.4661%209.35604%2014.4001%209.35274%2014.3333%209.35274C13.2287%209.35274%2012.3333%2010.2482%2012.3333%2011.3527C12.3333%2011.8438%2012.5103%2012.2936%2012.804%2012.6417C12.0167%2013.4598%2011.0224%2014.0772%209.90532%2014.4098C9.64752%2013.6034%208.89192%2013.0194%207.99992%2013.0194C7.10792%2013.0194%206.35232%2013.6034%206.09452%2014.4098Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.99984%2010.3542C9.2885%2010.3542%2010.3332%209.3095%2010.3332%208.02083C10.3332%206.73217%209.2885%205.6875%207.99984%205.6875C6.71117%205.6875%205.6665%206.73217%205.6665%208.02083C5.6665%209.3095%206.71117%2010.3542%207.99984%2010.3542Z'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linejoin='round'/%3e%3c/svg%3e",NV="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",MV={class:"problem-optimization-form"},TV={class:"node-form-content"},$V={class:"gray-block"},PV={class:"model-setting-form"},RV={class:"model-content"},BV={class:"model-setting-form"},LV={class:"model-content"},IV={class:"model-setting-form"},FV={class:"model-label"},jV={class:"model-content"},VV={key:0,class:"model-setting-form"},HV={class:"model-content"},UV={key:1,class:"model-setting-form"},zV={class:"model-content"},qV={key:0,class:"gray-block mt16"},GV={style:{width:"409px"},class:"flex-between-box"},XV={class:"array-form-box"},WV={class:"flex-block-item"},YV={class:"field-list-item"},KV={class:"field-label"},JV={class:"field-type"},ZV=["onClick"],QV={class:"gray-block mt16"},eH={class:"key-label"},tH={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"显示",value:"1"},{label:"不显示",value:"0"}],r=[{label:"开启",value:"1"},{label:"关闭",value:"0"}],s=G([]),a=He("getNode"),l=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[{value:"",key:_n(16)}],image_watermark:"1",image_optimize_prompt:"1"}),u=G(null),c=G(null),f=()=>{u.value.refresh()},p=()=>{c.value.show()},h=Xe(()=>{let oe=[];if(l.image_num>0)for(let H=0;H<+l.image_num;H++){let W=String.fromCharCode(97+H);oe.push(`picture_url_${W}`)}return oe}),g=()=>{l.size=void 0,l.image_num="1",l.input_images=[{value:"",key:_n(16)}]},m=Xe(()=>gw(l.model_config_id,l.use_model,"IMAGE")||{}),_=Xe(()=>m.value.image_generation?JSON.parse(m.value.image_generation):{}),v=dw(),b=Xe(()=>_.value.image_sizes?_.value.image_sizes.split(",").map(oe=>v.find(H=>H.value==oe)):[]),C=Xe(()=>+_.value.image_max||1),M=Xe(()=>_.value.image_optimize_prompt=="1"),O=Xe(()=>_.value.image_watermark=="1"),k=Xe(()=>+_.value.image_inputs_image_max||1),E=()=>{let oe=[{key:"msg",typ:"string"}];h.value.forEach(W=>{oe.push({key:W,typ:"string"})});const H=JSON.stringify({image_generation:{...l,image_num:l.image_num>0?l.image_num+"":"1",input_images:l.input_images.map(W=>W.value).filter(Boolean),output:oe}});t("update-node",{...o.node,node_params:H})},S=()=>{try{let oe=o.node.dataRaw||o.node.node_params||"{}",H=JSON.parse(oe).image_generation||{};$(),A(),H=JSON.parse(JSON.stringify(H)),l.model_config_id=H.model_config_id,l.use_model=H.use_model,l.size=H.size,l.image_num=H.image_num,l.prompt=H.prompt,l.prompt_tags=H.prompt_tags,l.input_images=H.input_images.map(W=>({value:W,key:_n(16)})),l.image_watermark=H.image_watermark,l.image_optimize_prompt=H.image_optimize_prompt}catch(oe){}},N=G([]),L=oe=>{oe&&$()},$=()=>{let oe=a().getAllParentVariable();N.value=oe||[]},B=(oe,H)=>{l.prompt_tags=H,l.prompt=oe},A=()=>{const oe=o.lf.getNodeModelById(o.nodeId);if(oe){let H=oe.getAllParentVariable();H.forEach(W=>{W.tags=W.tags||[]}),s.value=H}},D=Je({}),T=(oe,H,W)=>{if(oe){let Z=`at_input_${H}_${W}`;D[Z]=oe}},F=(oe,H,W)=>{W.tags=H,W.value=oe},V=()=>{if(l.input_images.length>=k.value)return xt.error("最多添加"+k.value+"张参考图");l.input_images.push({value:"",key:_n(16)})},P=oe=>{l.input_images.splice(oe,1)};gt(()=>l,()=>{E()},{deep:!0});const X=()=>{t("close")};return ut(()=>{S()}),(oe,H)=>{const W=Vt,Z=It,le=Qt,te=$n,q=ef,re=kn,ce=Kt,ve=Vn,Ne=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"通过文字描述/添加参考图片生成图片",onClose:X},null,8,["title","iconName"])]),default:x(()=>[d("div",MV,[d("div",TV,[y(Ne,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",$V,[H[14]||(H[14]=d("div",{class:"gray-block-title"},[d("img",{src:OV,alt:""}),U("模型设置 ")],-1)),d("div",PV,[H[8]||(H[8]=d("div",{class:"model-label"},"模型",-1)),d("div",RV,[y(rr,{modelType:"IMAGE",modeName:l.use_model,"onUpdate:modeName":H[0]||(H[0]=ge=>l.use_model=ge),modeId:l.model_config_id,"onUpdate:modeId":H[1]||(H[1]=ge=>l.model_config_id=ge),onChange:g},null,8,["modeName","modeId"])])]),d("div",BV,[H[9]||(H[9]=d("div",{class:"model-label"},"比例",-1)),d("div",LV,[y(Z,{placeholder:"请选择",value:l.size,"onUpdate:value":H[2]||(H[2]=ge=>l.size=ge),style:{width:"100%"}},{default:x(()=>[(w(!0),R(ae,null,ye(b.value,ge=>(w(),Q(W,{value:ge.value,key:ge.value},{default:x(()=>[U(j(ge.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),d("div",IV,[d("div",FV,[H[11]||(H[11]=U(" 最大生成数量 ",-1)),y(le,null,{title:x(()=>[...H[10]||(H[10]=[U("最多生成几张图片，实际生成图片数量请在提示词里面指定（比如：请生成4张图片），但是不会超过最大数量。",-1)])]),default:x(()=>[y(K(mt))]),_:1})]),d("div",jV,[y(te,{placeholder:"请输入",style:{width:"100%"},value:l.image_num,"onUpdate:value":H[3]||(H[3]=ge=>l.image_num=ge),min:1,max:C.value},null,8,["value","max"])])]),O.value?(w(),R("div",VV,[H[12]||(H[12]=d("div",{class:"model-label"},"右下水印",-1)),d("div",HV,[y(q,{class:"customer-segmented",value:l.image_watermark,"onUpdate:value":H[4]||(H[4]=ge=>l.image_watermark=ge),options:i},null,8,["value"])])])):ie("",!0),M.value?(w(),R("div",UV,[H[13]||(H[13]=d("div",{class:"model-label"},"优化提示词",-1)),d("div",zV,[y(q,{class:"customer-segmented",value:l.image_optimize_prompt,"onUpdate:value":H[5]||(H[5]=ge=>l.image_optimize_prompt=ge),options:r},null,8,["value"])])])):ie("",!0)]),m.value.input_image==1||m.value.input_text==1?(w(),R("div",qV,[H[17]||(H[17]=d("div",{class:"gray-block-title"},[d("img",{src:NV,alt:""}),U("输入")],-1)),m.value.input_text==1?(w(),Q(re,{key:0,name:"use_model"},{label:x(()=>[d("div",GV,[H[15]||(H[15]=d("div",null,"提示词",-1)),d("div",{class:"btn-hover-wrap",onClick:p},[y(K(Ko))])])]),default:x(()=>[y(ot,{options:N.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,ref_key:"promptInputRef",ref:u,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:L,onChange:H[6]||(H[6]=(ge,_e)=>B(ge,_e))},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):ie("",!0),m.value.input_image==1?(w(),Q(re,{key:1,label:"参考图URL",name:"use_model"},{default:x(()=>[y(ve,null,{default:x(()=>[d("div",XV,[(w(!0),R(ae,null,ye(l.input_images,(ge,_e)=>(w(),R("div",{class:"form-item-list",key:ge.key},[d("div",WV,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:st=>T(st,"input_images",_e),options:s.value,defaultSelectedList:ge.tags,defaultValue:ge.value,onOpen:A,onChange:(st,tt)=>F(st,tt,ge),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:st,payload:tt})=>[d("div",YV,[d("div",KV,j(st),1),d("div",JV,j(tt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"]),d("div",{class:"btn-hover-wrap",onClick:st=>P(_e)},[y(K(Jt))],8,ZV)])]))),128)),y(ce,{onClick:V,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...H[16]||(H[16]=[U("新增参考图",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1})):ie("",!0)])):ie("",!0),d("div",QV,[H[19]||(H[19]=d("div",{class:"gray-block-title"},[d("img",{src:ju,alt:""}),U("输出")],-1)),H[20]||(H[20]=d("div",{class:"output-item"},[d("div",{class:"key-label"},"msg"),d("div",{class:"key-value"},"string")],-1)),(w(!0),R(ae,null,ye(h.value,ge=>(w(),R("div",{class:"output-item",key:ge},[d("div",eH,j(ge),1),H[18]||(H[18]=d("div",{class:"key-value"},"string",-1))]))),128))])]),_:1},8,["model"])])]),y(jr,{options:N.value,defaultSelectedList:l.prompt_tags,defaultValue:l.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 76px",type:"textarea",onOpen:L,onChange:H[7]||(H[7]=(ge,_e)=>B(ge,_e)),onOk:f,ref_key:"fullAtInputRef",ref:c},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})}}},nH=Te(tH,[["__scopeId","data-v-d7a9900e"]]),oH={class:"problem-optimization-form"},iH={class:"node-form-content"},rH={class:"gray-block"},sH={class:"model-setting-form"},aH={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({content:""}),r=()=>{const l=JSON.stringify({...i});t("update-node",{...o.node,node_params:l})},s=()=>{try{let l=o.node.dataRaw||o.node.node_params||"{}",u=JSON.parse(l);i.content=u.content}catch(l){}};gt(()=>i,()=>{r()},{deep:!0});const a=()=>{t("close")};return ut(()=>{s()}),(l,u)=>{const c=Bi,f=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"",onClose:a},null,8,["title","iconName"])]),default:x(()=>[d("div",oH,[d("div",iH,[y(f,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[d("div",rH,[u[1]||(u[1]=d("div",{class:"gray-block-title"},null,-1)),d("div",sH,[y(c,{style:{"min-height":"300px"},value:i.content,"onUpdate:value":u[0]||(u[0]=p=>i.content=p),valueModifiers:{trim:!0},"auto-size":"",placeholder:"请输入注释"},null,8,["value"])])])]),_:1},8,["model"])])])]),_:1})}}},lH=Te(aH,[["__scopeId","data-v-e8093fb2"]]),Gg={__name:"add-key-modal",props:{request_content_type:{type:String,default:""},level:{type:Number,default:1}},emits:["add","edit","addSub"],setup(n,{expose:e,emit:t}){const o=t,i=n,r=Xe(()=>{if(i.request_content_type=="multipart/form-data")return[{lable:"string",value:"string"},{lable:"file",value:"file"}];if(i.request_content_type=="application/x-www-form-urlencoded")return[{lable:"string",value:"string"}];if(i.request_content_type=="application/json"){let b=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<object>",value:"array<object>"}];return i.level>=2?b.filter(C=>C.value!="object"):b}return[{lable:"string",value:"string"}]}),s=G(!1),a=G("新增参数");let l="add";const u=(b,C)=>C?/^[a-zA-Z_]+$/.test(C)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let c=0;const f=Je({key:"",typ:"string",cu_key:"",desc:void 0,subs:[]}),p=()=>{f.typ="string",s.value=!0},h=()=>{Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),l="add",a.value="新增参数",s.value=!0},g=b=>{c=b,Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),l="addSub",a.value="新增参数",s.value=!0},m=(b,C)=>{c=C,Object.assign(f,{key:"",typ:"string",cu_key:_n(16),subs:[]}),Object.assign(f,{...b}),l="edit",a.value="编辑参数",s.value=!0},_=G(null),v=()=>{_.value.validate().then(()=>{l=="add"&&o("add",{...f}),l=="addSub"&&o("addSub",{...f},c),l=="edit"&&o("edit",{...f},c),s.value=!1})};return e({show:p,add:h,edit:m,addSub:g}),(b,C)=>{const M=ln,O=kn,k=Vt,E=It,S=wn,N=vn;return w(),R("div",null,[y(N,{open:s.value,"onUpdate:open":C[2]||(C[2]=L=>s.value=L),title:a.value,onOk:v,width:472,"ok-text":"确定","cancel-text":"取消"},{default:x(()=>[y(S,{ref_key:"formRef",ref:_,layout:"vertical",model:f,style:{margin:"24px 0"}},{default:x(()=>[y(O,{label:"参数key",name:"key",rules:[{required:!0,validator:(L,$)=>u(L,$)}]},{default:x(()=>[y(M,{value:f.key,"onUpdate:value":C[0]||(C[0]=L=>f.key=L),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),y(O,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:x(()=>[y(E,{value:f.typ,"onUpdate:value":C[1]||(C[1]=L=>f.typ=L),placeholder:"请选择",style:{width:"100%"}},{default:x(()=>[(w(!0),R(ae,null,ye(r.value,L=>(w(),Q(k,{value:L.value},{default:x(()=>[U(j(L.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},uH={class:"sub-field-item"},dH={class:"key-title-item"},cH={class:"typ-title-item"},fH={class:"value-title-item"},pH=["onClick"],hH=["onClick"],vH=["onClick"],gH={__name:"subs-key",props:{data:{},level:{type:Number},globalOptions:{type:Array},request_content_type:{type:String,default:""}},setup(n){const e=n;Xe(()=>e.level>2?f.filter(p=>p.value!="object"):f);let t=0;const o=(p,h)=>{h.splice(p,1)},i=G(null),r=p=>{t=p,i.value.add()},s=(p,h)=>{i.value.edit(p,h)},a=p=>{e.data[t].subs.push(p)},l=(p,h)=>{e.data[h].typ!=p.typ&&(p.desc=void 0),e.data.splice(h,1,p)},u=p=>p.typ=="object"&&e.level<=2,c=p=>{let h=p.typ;return h=="file"&&(h="string"),h?e.globalOptions.filter(g=>g.typ==h):e.globalOptions};let f=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return(p,h)=>{const g=Vt,m=It,_=Nt("SubsKey",!0);return w(),R(ae,null,[(w(!0),R(ae,null,ye(e.data,(v,b)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:v.cu_key},[d("div",uH,[h[0]||(h[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),d("div",dH,j(v.key),1),d("div",cH,j(v.typ),1),d("div",fH,[v.typ!="object"?(w(),Q(m,{key:0,placeholder:"请输入选择变量",value:v.desc,"onUpdate:value":C=>v.desc=C,style:{width:"90%"}},{default:x(()=>[(w(!0),R(ae,null,ye(c(v),C=>(w(),Q(g,{value:C.value,key:C.key},{default:x(()=>[d("span",null,j(C.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ie("",!0)]),u(v)?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:C=>r(b,e.data)},[y(K(Fn))],8,pH)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:C=>s(v,b)},[y(K(kr))],8,hH),d("div",{class:"btn-hover-wrap",onClick:C=>o(b,e.data)},[y(K(Jt))],8,vH)]),v.subs&&v.subs.length>0?(w(),Q(_,{key:0,request_content_type:e.request_content_type,level:e.level+1,data:v.subs,globalOptions:e.globalOptions},null,8,["request_content_type","level","data","globalOptions"])):ie("",!0)],2))),128)),y(Gg,{onAdd:a,level:e.level,request_content_type:e.request_content_type,onEdit:l,ref_key:"addParamsModalRef",ref:i},null,8,["level","request_content_type"])],64)}}},Fp=Te(gH,[["__scopeId","data-v-9e0ee61d"]]),_H={class:"variable-node"},mH={class:"node-form-content"},yH={class:"gray-block"},bH={class:"mt8"},xH={class:"array-form-box"},wH={class:"flex-block-item"},CH={class:"at-input-flex1"},SH=["onClick"],kH={key:0,class:"array-form-box"},EH={class:"array-form-box"},DH={class:"key-block-item"},AH={class:"key-item",style:{width:"180px"}},OH={class:"key-item",style:{width:"90px"}},NH={class:"key-item",style:{width:"160px"}},MH={class:"key-item btn-block",style:{flex:"1"}},TH=["onClick"],$H=["onClick"],PH=["onClick"],RH={key:0,class:"sub-field-box"},BH={class:"mt8"},LH={key:1,class:"array-form-box"},IH={class:"array-form-box"},FH={class:"key-block-item"},jH={class:"key-item",style:{width:"180px"}},VH={class:"key-item",style:{width:"90px"}},HH={class:"key-item",style:{width:"160px"}},UH={class:"key-item btn-block",style:{flex:"1"}},zH=["onClick"],qH=["onClick"],GH={class:"mt8"},XH={key:2,class:"array-form-box"},WH={class:"array-form-box"},YH={class:"key-block-item"},KH={class:"key-item",style:{width:"180px"}},JH={class:"key-item",style:{width:"90px"}},ZH={class:"key-item",style:{width:"160px"}},QH={class:"key-item btn-block",style:{flex:"1"}},eU=["onClick"],tU=["onClick"],nU=["onClick"],oU={key:0,class:"sub-field-box"},iU={class:"mt8"},rU={class:"gray-block mt16"},sU={key:0,class:"mt8"},aU={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""});gt(()=>i,()=>{l()},{deep:!0}),He("getNode");const r=He("getGraph"),s=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",{...o.node})},10)},a=()=>{setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",null)},10)},l=()=>{let L=JSON.parse(o.node.node_params);L.trigger.trigger_web_hook_config={...i};let $={...o.node,node_params:JSON.stringify(L)};t("update-node",$),setTimeout(()=>{r().eventCenter.emit("custom:trigger-change",$)},10)},u=()=>{try{let L=o.node.dataRaw||o.node.node_params||"{}";L=JSON.parse(L),f();let $=L.trigger.trigger_web_hook_config;i.url=$.url,i.method=$.method||"GET",i.switch_verify=$.switch_verify||"1",i.switch_allow_ip=$.switch_allow_ip||"0",i.allow_ips=$.allow_ips?$.allow_ips.split(",").join(`
`):"",i.params=$.params||[],i.form=$.form||[],i.x_form=$.x_form||[],i.json=$.json||[],i.request_content_type=$.request_content_type||"none",i.response_type=$.response_type||"now",i.response_now=$.response_now||""}catch(L){}},c=G([]);function f(){const L=o.lf.getNodeModelById(o.nodeId);if(L){let B=L.getGlobalVariable().diy_global||[];B.forEach(A=>{A.label=A.key,A.value="global."+A.key}),c.value=B||[]}c.value}const p=Xe(()=>c.value.filter(L=>L.typ=="string")),h=L=>{L&&f()},g=L=>{let $=L.typ;return $=="file"&&($="string"),$?c.value.filter(B=>B.typ==$):c.value},m=()=>{i.params.push({key:"",typ:"string",desc:void 0})},_=L=>{i.params.splice(L,1)},v=(L,$)=>{i[$].splice(L,1)},b=G(null),C=()=>{b.value.add()},M=L=>{b.value.addSub(L)},O=(L,$)=>{b.value.edit(L,$)},k=L=>{i.request_content_type=="multipart/form-data"&&i.form.push(L),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.push(L),i.request_content_type=="application/json"&&i.json.push(L)},E=(L,$)=>{i.request_content_type=="multipart/form-data"&&i.form.splice($,1,L),i.request_content_type=="application/x-www-form-urlencoded"&&i.x_form.splice($,1,L),i.request_content_type=="application/json"&&i.json.splice($,1,L)},S=(L,$)=>{i.request_content_type=="multipart/form-data"&&(i.form[$].subs||(i.form[$].subs=[]),i.form[$].subs.push(L)),i.request_content_type=="application/x-www-form-urlencoded"&&(i.x_form[$].subs||(i.x_form[$].subs=[]),i.x_form[$].subs.push(L)),i.request_content_type=="application/json"&&(i.json[$].subs||(i.json[$].subs=[]),i.json[$].subs.push(L))},N=()=>{Os(i.url),xt.success("复制成功")};return ut(()=>{u()}),(L,$)=>{const B=Vt,A=It,D=ln,T=Kt,F=Dy,V=kn,P=Ii,X=Li,oe=Bi,H=Vn,W=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,onChangeTitle:s,onDeleteNode:a,desc:"向服务器发送请求，触发工作流。"},null,8,["title","iconName"])]),default:x(()=>[d("div",_H,[d("div",mH,[y(W,{ref:"formRef",layout:"vertical",model:i},{default:x(()=>[d("div",yH,[y(V,{label:"请求地址"},{default:x(()=>[y(F,{compact:""},{default:x(()=>[y(A,{value:i.method,"onUpdate:value":$[0]||($[0]=Z=>i.method=Z),style:{width:"20%"}},{default:x(()=>[y(B,{value:"POST"},{default:x(()=>[...$[9]||($[9]=[U("POST",-1)])]),_:1}),y(B,{value:"GET"},{default:x(()=>[...$[10]||($[10]=[U("GET",-1)])]),_:1})]),_:1},8,["value"]),y(D,{readonly:"",value:i.url,"onUpdate:value":$[1]||($[1]=Z=>i.url=Z),style:{width:"65%"}},null,8,["value"]),y(T,{onClick:$[2]||($[2]=Z=>N()),style:{width:"15%"},type:"primary"},{default:x(()=>[...$[11]||($[11]=[U("复制",-1)])]),_:1})]),_:1})]),_:1}),y(V,{label:"鉴权"},{default:x(()=>[y(X,{value:i.switch_verify,"onUpdate:value":$[3]||($[3]=Z=>i.switch_verify=Z)},{default:x(()=>[y(P,{value:"1"},{default:x(()=>[...$[12]||($[12]=[U("需要鉴权",-1)])]),_:1}),y(P,{value:"0"},{default:x(()=>[...$[13]||($[13]=[U("无需鉴权",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),y(V,{label:"IP白名单"},{default:x(()=>[y(X,{value:i.switch_allow_ip,"onUpdate:value":$[4]||($[4]=Z=>i.switch_allow_ip=Z)},{default:x(()=>[y(P,{value:"0"},{default:x(()=>[...$[14]||($[14]=[U("不启用",-1)])]),_:1}),y(P,{value:"1"},{default:x(()=>[...$[15]||($[15]=[U("启用",-1)])]),_:1})]),_:1},8,["value"]),d("div",bH,[y(oe,{value:i.allow_ips,"onUpdate:value":$[5]||($[5]=Z=>i.allow_ips=Z),style:{"min-height":"74px"},placeholder:"请输入ip，一行一个"},null,8,["value"])])]),_:1}),d("div",xH,[$[17]||($[17]=d("div",{class:"form-item-label"},"PARAMS",-1)),(w(!0),R(ae,null,ye(i.params,(Z,le)=>(w(),R("div",{class:"form-item-list",key:le},[y(V,{label:null},{default:x(()=>[d("div",wH,[y(H,null,{default:x(()=>[y(D,{style:{width:"120px"},value:Z.key,"onUpdate:value":te=>Z.key=te,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),d("div",CH,[y(A,{style:{width:"100%"},placeholder:"请输入选择变量",value:Z.desc,"onUpdate:value":te=>Z.desc=te,onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(p.value,te=>(w(),Q(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onUpdate:value"])]),d("div",{class:"btn-hover-wrap",onClick:te=>_(le)},[y(K(Jt))],8,SH)])]),_:2},1024)]))),128)),y(T,{onClick:m,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[16]||($[16]=[U("添加参数",-1)])]),_:1},8,["icon"])]),i.method=="POST"?(w(),R(ae,{key:0},[y(V,{label:"BODY"},{default:x(()=>[y(X,{value:i.request_content_type,"onUpdate:value":$[6]||($[6]=Z=>i.request_content_type=Z)},{default:x(()=>[y(P,{value:"none"},{default:x(()=>[...$[18]||($[18]=[U("none",-1)])]),_:1}),y(P,{value:"multipart/form-data"},{default:x(()=>[...$[19]||($[19]=[U("form-data",-1)])]),_:1}),y(P,{value:"application/x-www-form-urlencoded"},{default:x(()=>[...$[20]||($[20]=[U("x-www-form-urlencoded",-1)])]),_:1}),y(P,{value:"application/json"},{default:x(()=>[...$[21]||($[21]=[U("JSON",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),i.request_content_type=="multipart/form-data"?(w(),R("div",kH,[d("div",EH,[$[22]||($[22]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(ae,null,ye(i.form,(Z,le)=>(w(),R("div",{class:"form-item-list",key:le},[y(V,{label:null},{default:x(()=>[d("div",DH,[d("div",AH,j(Z.key),1),d("div",OH,j(Z.typ),1),d("div",NH,[y(A,{placeholder:"请输入选择变量",value:Z.desc,"onUpdate:value":te=>Z.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(g(Z),te=>(w(),Q(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),d("div",MH,[Z.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:te=>M(le)},[y(K(Fn))],8,TH)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:te=>O(Z,le)},[y(K(kr))],8,$H),d("div",{class:"btn-hover-wrap",onClick:te=>v(le,"form")},[y(K(Jt))],8,PH)])]),Z.subs&&Z.subs.length>0?(w(),R("div",RH,[y(H,null,{default:x(()=>[y(Fp,{data:Z.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128))]),d("div",BH,[y(T,{onClick:C,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[23]||($[23]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),i.request_content_type=="application/x-www-form-urlencoded"?(w(),R("div",LH,[d("div",IH,[$[24]||($[24]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(ae,null,ye(i.x_form,(Z,le)=>(w(),R("div",{class:"form-item-list",key:le},[y(V,{label:null},{default:x(()=>[d("div",FH,[d("div",jH,j(Z.key),1),d("div",VH,j(Z.typ),1),d("div",HH,[y(A,{placeholder:"请输入选择变量",value:Z.desc,"onUpdate:value":te=>Z.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(g(Z),te=>(w(),Q(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),d("div",UH,[d("div",{class:"btn-hover-wrap",onClick:te=>O(Z,le)},[y(K(kr))],8,zH),d("div",{class:"btn-hover-wrap",onClick:te=>v(le,"x_form")},[y(K(Jt))],8,qH)])])]),_:2},1024)]))),128))]),d("div",GH,[y(T,{onClick:C,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[25]||($[25]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0),i.request_content_type=="application/json"?(w(),R("div",XH,[d("div",WH,[$[26]||($[26]=d("div",{class:"th-header-block"},[d("div",{class:"td-title",style:{width:"180px"}},"key"),d("div",{class:"td-title",style:{width:"90px"}},"类型"),d("div",{class:"td-title",style:{width:"160px"}},"全部变量"),d("div",{class:"td-title",style:{flex:"1"}},"操作")],-1)),(w(!0),R(ae,null,ye(i.json,(Z,le)=>(w(),R("div",{class:"form-item-list",key:le},[y(V,{label:null},{default:x(()=>[d("div",YH,[d("div",KH,j(Z.key),1),d("div",JH,j(Z.typ),1),d("div",ZH,[Z.typ!="object"?(w(),Q(A,{key:0,placeholder:"请输入选择变量",value:Z.desc,"onUpdate:value":te=>Z.desc=te,style:{width:"90%"},onDropdownVisibleChange:h},{default:x(()=>[(w(!0),R(ae,null,ye(g(Z),te=>(w(),Q(B,{value:te.value,key:te.key},{default:x(()=>[d("span",null,j(te.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):ie("",!0)]),d("div",QH,[Z.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:te=>M(le)},[y(K(Fn))],8,eU)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:te=>O(Z,le)},[y(K(kr))],8,tU),d("div",{class:"btn-hover-wrap",onClick:te=>v(le,"json")},[y(K(Jt))],8,nU)])]),Z.subs&&Z.subs.length>0?(w(),R("div",oU,[y(H,null,{default:x(()=>[y(Fp,{data:Z.subs,request_content_type:i.request_content_type,level:2,globalOptions:c.value},null,8,["data","request_content_type","globalOptions"])]),_:2},1024)])):ie("",!0)]),_:2},1024)]))),128))]),d("div",iU,[y(T,{onClick:C,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...$[27]||($[27]=[U("添加参数",-1)])]),_:1},8,["icon"])])])):ie("",!0)],64)):ie("",!0)]),d("div",rU,[y(V,{label:"RESPONSE"},{default:x(()=>[y(X,{value:i.response_type,"onUpdate:value":$[7]||($[7]=Z=>i.response_type=Z)},{default:x(()=>[y(P,{value:"message_variable"},{default:x(()=>[...$[28]||($[28]=[U("工作流执行结束返回",-1)])]),_:1}),y(P,{value:"now"},{default:x(()=>[...$[29]||($[29]=[U("立即返回",-1)])]),_:1})]),_:1},8,["value"]),i.response_type=="now"?(w(),R("div",sU,[y(oe,{value:i.response_now,"onUpdate:value":$[8]||($[8]=Z=>i.response_now=Z),style:{"min-height":"74px"},placeholder:"请在这里输入返回的json"},null,8,["value"])])):ie("",!0)]),_:1})])]),_:1},8,["model"]),y(Gg,{request_content_type:i.request_content_type,onAdd:k,onEdit:E,onAddSub:S,ref_key:"addKeyModalRef",ref:b},null,8,["request_content_type"])])])]),_:1})}}},lU=Te(aU,[["__scopeId","data-v-d0f74a3d"]]),uU={class:"problem-optimization-form"},dU={class:"node-form-content"},cU={class:"gray-block"},fU={class:"gray-block-title"},pU={class:"avatar-box"},hU=["src"],vU={class:"content-box"},gU={class:"list-name"},_U={class:"list-intro"},mU=["onClick"],yU={class:"btn-block"},bU={class:"gray-block mt16"},xU={class:"gray-block-title"},wU={key:0,class:"flex-block-item"},CU={class:"form-content-box flex1"},SU={class:"field-list-item"},kU={class:"field-label"},EU={class:"field-type"},DU={key:1,class:"flex-block-item"},AU={class:"form-content-box flex1"},OU={class:"field-list-item"},NU={class:"field-label"},MU={class:"field-type"},TU={key:2,class:"flex-block-item"},$U={class:"form-content-box flex1"},PU={class:"field-list-item"},RU={class:"field-label"},BU={class:"field-type"},LU={class:"flex-block-item"},IU={class:"form-content-box flex1"},FU={class:"field-list-item"},jU={class:"field-label"},VU={class:"field-type"},HU={class:"flex-block-item"},UU={class:"form-content-box flex1"},zU={class:"field-list-item"},qU={class:"field-label"},GU={class:"field-type"},XU={class:"flex-block-item"},WU={class:"form-item-label"},YU={class:"form-content-box flex1"},KU={class:"field-list-item"},JU={class:"field-label"},ZU={class:"field-type"},QU={class:"flex-block-item"},ez={class:"form-item-label"},tz={class:"form-content-box flex1"},nz={class:"field-list-item"},oz={class:"field-label"},iz={class:"field-type"},rz={class:"gray-block mt16"},sz={class:"gray-block-title"},az={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=[{label:"导入文档内容",value:"content"},{label:"导入url",value:"url"}],r=[{label:"依然导入",value:"import"},{label:"不导入",value:"not import"},{label:"更新内容",value:"update"}],s=G({}),a=G([]),l=G([]),u=()=>{const $=o.lf.getNodeModelById(o.nodeId);if($){let B=$.getAllParentVariable();B.forEach(A=>{A.tags=A.tags||[]}),a.value=B,l.value=c(B)}};function c($){function B(A){const D=[];for(const T of A)if(T.children&&T.children.length>0){const F=B(T.children);if(F.length>0){const V={...T,children:F};D.push(V)}}else T.typ&&T.typ==="array<string>"&&D.push({...T});return D}return B($)}const f=G(null),p=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),h=()=>{const $=JSON.stringify({library_import:{...p,library_id:p.library_id.join(",")}});t("update-node",{...o.node,node_params:$})},g=()=>{try{let $=o.node.dataRaw||o.node.node_params||"{}",B=JSON.parse($).library_import||{};u(),B=JSON.parse(JSON.stringify(B));for(let A in B)A=="library_id"?p.library_id=B[A]?B[A].split(","):[]:p[A]=B[A];kg({ability_type:"library_ability_official_account"}).then(A=>{var T;let D=(A==null?void 0:A.data)||{};((T=D==null?void 0:D.user_config)==null?void 0:T.switch_status)==1&&(f.value=D)}),setTimeout(()=>{S()},300)}catch($){}},m=Xe(()=>{let $=p.library_id[0],B=[{group_name:"未分组",id:"0"}];return $&&s.value[$]||B}),_=G([]),v=G(null),b=Xe(()=>_.value.filter($=>f.value?p.library_id.includes($.id):p.library_id.includes($.id)&&$.type!=3)),C=Xe(()=>b.value&&b.value.length?b.value[0].type:-1),M=$=>{let B=p.library_id.indexOf($.id);p.library_id.splice(B,1)},O=$=>{E(),p.library_id=[...$],p.library_group_id="0",Pt(()=>{S()})},k=()=>{v.value.open([...p.library_id])},E=async()=>{const $=await ja({type:""});$&&(_.value=$.data||[])},S=()=>{Pt(()=>{p.library_id.length!=0&&ey({group_type:C.value==0?1:0,library_id:p.library_id[0]}).then($=>{s.value={...s.value,[p.library_id[0]]:$.data}})})},N=($,B,A)=>{p[A]=$};gt(()=>p,()=>{h()},{deep:!0}),gt(()=>p.library_id,()=>{S()},{deep:!0});const L=()=>{t("close")};return ut(()=>{g(),E()}),($,B)=>{const A=Nn,D=Kt,T=kn,F=Vt,V=It,P=ef,X=Qt,oe=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"将相关内容导入到对应知识库",onClose:L},null,8,["title","iconName"])]),default:x(()=>[d("div",uU,[d("div",dU,[y(oe,{ref:"formRef",layout:"vertical",model:p},{default:x(()=>[d("div",cU,[d("div",fU,[y(A,{name:"nav-library",style:{"font-size":"14px",color:"#333"}}),B[11]||(B[11]=U(" 知识库 ",-1))]),y(T,{label:null},{default:x(()=>[(w(!0),R(ae,null,ye(b.value,H=>(w(),R("div",{class:"konwledge-list-item",key:H.id},[d("div",pU,[d("img",{src:H.avatar,alt:""},null,8,hU)]),d("div",vU,[d("div",gU,j(H.library_name),1),d("div",_U,j(H.library_intro),1)]),d("div",{class:"btn-hover-wrap",onClick:W=>M(H)},[y(K(Jt))],8,mU)]))),128)),d("div",yU,[d("div",null,[y(D,{onClick:k,icon:Tt(K(Ht)),block:"",type:"dashed"},{default:x(()=>[...B[12]||(B[12]=[U("添加知识库",-1)])]),_:1},8,["icon"])])])]),_:1}),y(T,{label:"知识分组"},{default:x(()=>[y(V,{value:p.library_group_id,"onUpdate:value":B[0]||(B[0]=H=>p.library_group_id=H),style:{width:"100%"},placeholder:"请选择"},{default:x(()=>[(w(!0),R(ae,null,ye(m.value,H=>(w(),Q(F,{value:H.id,key:H.id},{default:x(()=>[U(j(H.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),C.value!=2&&C.value>=0?(w(),Q(T,{key:0,label:"导入类型"},{default:x(()=>[y(P,{class:"customer-segmented",value:p.import_type,"onUpdate:value":B[1]||(B[1]=H=>p.import_type=H),options:i},null,8,["value"])]),_:1})):ie("",!0),C.value==2?(w(),Q(T,{key:1,label:"分段问题重复"},{default:x(()=>[y(P,{class:"customer-segmented",value:p.qa_repeat_op,"onUpdate:value":B[2]||(B[2]=H=>p.qa_repeat_op=H),options:r},null,8,["value"])]),_:1})):ie("",!0),C.value!=2&&C.value>=0&&p.import_type=="url"?(w(),Q(T,{key:2,label:"文档URL重复"},{default:x(()=>[y(P,{class:"customer-segmented",value:p.normal_url_repeat_op,"onUpdate:value":B[3]||(B[3]=H=>p.normal_url_repeat_op=H),options:r},null,8,["value"])]),_:1})):ie("",!0)]),d("div",bU,[d("div",xU,[y(A,{name:"input",style:{"font-size":"14px",color:"#333"}}),B[13]||(B[13]=U(" 输入 ",-1))]),C.value!=2&&C.value>=0?(w(),R(ae,{key:0},[p.import_type=="content"?(w(),R("div",wU,[B[14]||(B[14]=d("div",{class:"form-item-label required"},"文档标题",-1)),d("div",CU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_title,onOpen:u,onChange:B[4]||(B[4]=(H,W)=>N(H,W,"normal_title")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",SU,[d("div",kU,j(H),1),d("div",EU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0),p.import_type=="content"?(w(),R("div",DU,[B[15]||(B[15]=d("div",{class:"form-item-label required"},"文档内容",-1)),d("div",AU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_content,onOpen:u,onChange:B[5]||(B[5]=(H,W)=>N(H,W,"normal_content")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",OU,[d("div",NU,j(H),1),d("div",MU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0),p.import_type=="url"?(w(),R("div",TU,[B[16]||(B[16]=d("div",{class:"form-item-label"},"文档URL",-1)),d("div",$U,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.normal_url,onOpen:u,onChange:B[6]||(B[6]=(H,W)=>N(H,W,"normal_url")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",PU,[d("div",RU,j(H),1),d("div",BU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])])):ie("",!0)],64)):ie("",!0),C.value==2?(w(),R(ae,{key:1},[d("div",LU,[B[17]||(B[17]=d("div",{class:"form-item-label required"},"分段问题",-1)),d("div",IU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.qa_question,onOpen:u,onChange:B[7]||(B[7]=(H,W)=>N(H,W,"qa_question")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",FU,[d("div",jU,j(H),1),d("div",VU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",HU,[B[18]||(B[18]=d("div",{class:"form-item-label required"},"分段答案",-1)),d("div",UU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:a.value,defaultValue:p.qa_answer,onOpen:u,onChange:B[8]||(B[8]=(H,W)=>N(H,W,"qa_answer")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",zU,[d("div",qU,j(H),1),d("div",GU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",XU,[d("div",WU,[B[19]||(B[19]=U(" 答案附图 ",-1)),y(X,{title:"图片url，<array string>格式，支持传入多个"},{default:x(()=>[y(K(mt))]),_:1})]),d("div",YU,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:p.qa_images_variable,onOpen:u,onChange:B[9]||(B[9]=(H,W)=>N(H,W,"qa_images_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",KU,[d("div",JU,j(H),1),d("div",ZU,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])]),d("div",QU,[d("div",ez,[B[20]||(B[20]=U(" 相似问法 ",-1)),y(X,{title:"<array string>格式，支持传入多个"},{default:x(()=>[y(K(mt))]),_:1})]),d("div",tz,[y(ot,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:l.value,defaultValue:p.qa_similar_question_variable,onOpen:u,onChange:B[10]||(B[10]=(H,W)=>N(H,W,"qa_similar_question_variable")),placeholder:"请输入变量值，键入“/”插入变量"},{option:x(({label:H,payload:W})=>[d("div",nz,[d("div",oz,j(H),1),d("div",iz,j(W.typ),1)])]),_:1},8,["options","defaultValue"])])])],64)):ie("",!0)]),d("div",rz,[d("div",sz,[y(A,{name:"output",style:{"font-size":"14px",color:"#333"}}),B[21]||(B[21]=U(" 输出 ",-1))]),B[22]||(B[22]=d("div",{class:"options-item"},[d("div",{class:"option-label"},"msg"),d("div",{class:"desc"},"ok表示成功，其他输出为报错日志")],-1))])]),_:1},8,["model"]),y(Mg,{ref_key:"librarySelectAlertRef",ref:v,showWxType:!!f.value,select_type:"radio",onChange:O},null,8,["showWxType"])])])]),_:1})}}},lz=Te(az,[["__scopeId","data-v-0a068430"]]),uz={class:"sub-field-item"},dz=["onClick"],cz=["onClick"],fz={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),R(ae,null,ye(e.data,(g,m)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[d("div",uz,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:g.key,"onUpdate:value":_=>g.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(p,{class:"mr12",onChange:_=>s(g),value:g.typ,"onUpdate:value":_=>g.typ=_,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,_=>(w(),Q(f,{value:_.value},{default:x(()=>[U(j(_.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(g)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(m,e.data)},[y(K(Fn))],8,dz)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:_=>r(m,e.data)},[y(K(Jt))],8,cz)]),g.subs&&g.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:g.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},pz=Te(fz,[["__scopeId","data-v-2ed06465"]]),hz={class:"problem-optimization-form"},vz={class:"node-form-content"},gz={class:"gray-block"},_z={class:"array-form-box"},mz={class:"gray-block mt16"},yz={class:"output-box"},bz={class:"flex-block-item",style:{gap:"12px"}},xz=["onClick"],wz={key:0,class:"sub-field-box"},Cz={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=G([]);function r(){const _=o.lf.getNodeModelById(o.nodeId);if(_){let v=_.getAllParentVariable();i.value=s(v)}}function s(_){function v(b){const C=[];for(const M of b)if(M.children&&M.children.length>0){const O=v(M.children);if(O.length>0){const k={...M,children:O};C.push(k)}}else M.typ&&(M.typ.startsWith("array<")||M.typ==="object")&&C.push({...M});return C}return v(_)}const a=_=>{_&&r()},l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),u=()=>{const _=JSON.stringify({json_encode:{...l}});t("update-node",{...o.node,node_params:_})},c=(_,v)=>{l.input_tags=v,l.input_variable=_},f=()=>{try{let _=o.node.dataRaw||o.node.node_params||"{}",v=JSON.parse(_).json_encode||{};v=JSON.parse(JSON.stringify(v)),r(),l.input_variable=v.input_variable,v.output.length>0&&(l.output=v.output)}catch(_){}};gt(()=>l,()=>{u()},{deep:!0});const p=_=>{_.subs=[]},h=_=>{l.output[_].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},g=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],m=()=>{t("close")};return ut(()=>{f()}),(_,v)=>{const b=ln,C=Vt,M=It,O=Vn,k=kn,E=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把变量转化为JSON字符串",onClose:m},null,8,["title","iconName"])]),default:x(()=>[d("div",hz,[d("div",vz,[y(E,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",gz,[v[2]||(v[2]=d("div",{class:"gray-block-title"},"输入",-1)),d("div",_z,[y(ot,{options:i.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,checkAnyLevel:!0,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量",onOpen:a,onChange:v[0]||(v[0]=(S,N)=>c(S,N))},null,8,["options","defaultSelectedList","defaultValue"])])]),d("div",mz,[v[4]||(v[4]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",yz,[v[3]||(v[3]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:v[1]||(v[1]=St(()=>{},["stop"]))},[(w(!0),R(ae,null,ye(l.output,(S,N)=>(w(),R("div",{class:"form-item-list",key:N},[y(k,{label:null,name:["output",N,"key"]},{default:x(()=>[d("div",bz,[y(b,{style:{width:"214px"},value:S.key,"onUpdate:value":L=>S.key=L,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(O,null,{default:x(()=>[y(M,{onChange:L=>p(S),value:S.typ,"onUpdate:value":L=>S.typ=L,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),R(ae,null,ye(g,L=>y(C,{value:L.value,key:L.value},{default:x(()=>[U(j(L.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),S.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:L=>h(N)},[y(K(Fn))],8,xz)):ie("",!0)]),S.subs&&S.subs.length>0?(w(),R("div",wz,[y(O,null,{default:x(()=>[y(pz,{data:S.subs,level:2,typOptions:g},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},Sz=Te(Cz,[["__scopeId","data-v-e7427d24"]]),kz={class:"sub-field-item"},Ez=["onClick"],Dz=["onClick"],Az={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(n){const e=n,t=Xe(()=>e.level>2?e.typOptions.filter(l=>l.value!="object"):e.typOptions),o=Xe(()=>e.level==2?"180px":"146px"),i=(l,u)=>{u[l].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},r=(l,u)=>{u.splice(l,1)},s=l=>{l.subs=[]},a=l=>l.typ=="object"&&e.level<=2;return(l,u)=>{const c=ln,f=Vt,p=It,h=Nt("SubsKey",!0);return w(!0),R(ae,null,ye(e.data,(g,m)=>(w(),R("div",{class:Ct(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:g.cu_key},[d("div",kz,[u[0]||(u[0]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(c,{class:"mr12",style:In({width:o.value}),value:g.key,"onUpdate:value":_=>g.key=_,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),u[1]||(u[1]=d("img",{class:"fork-icon",src:Lo,alt:""},null,-1)),y(p,{class:"mr12",onChange:_=>s(g),value:g.typ,"onUpdate:value":_=>g.typ=_,placeholder:"请选择",style:In({width:o.value})},{default:x(()=>[(w(!0),R(ae,null,ye(t.value,_=>(w(),Q(f,{value:_.value},{default:x(()=>[U(j(_.value),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange","value","onUpdate:value","style"]),a(g)?(w(),R("div",{key:0,class:"btn-hover-wrap mr12",onClick:_=>i(m,e.data)},[y(K(Fn))],8,Ez)):ie("",!0),d("div",{class:"btn-hover-wrap",onClick:_=>r(m,e.data)},[y(K(Jt))],8,Dz)]),g.subs&&g.subs.length>0?(w(),Q(h,{key:0,level:e.level+1,typOptions:e.typOptions,data:g.subs},null,8,["level","typOptions","data"])):ie("",!0)],2))),128)}}},Oz=Te(Az,[["__scopeId","data-v-eff9a42d"]]),Nz={class:"problem-optimization-form"},Mz={class:"node-form-content"},Tz={class:"gray-block"},$z={class:"array-form-box"},Pz={class:"gray-block mt16"},Rz={class:"output-box"},Bz={class:"flex-block-item",style:{gap:"12px"}},Lz=["onClick"],Iz={key:0,class:"sub-field-box"},Fz={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(n,{emit:e}){const t=e,o=n,i=G([]);function r(){const _=o.lf.getNodeModelById(o.nodeId);if(_){let v=_.getAllParentVariable();i.value=s(a(v)),i.value}}function s(_){return _.forEach(v=>{v.typ=="node"?v.node_type==1?v.value="global":v.value=v.node_id:v.value=v.key,v.children&&v.children.length>0&&(v.children=s(v.children))}),_}function a(_){function v(b){const C=[];for(const M of b)if(o.node,M.children&&M.children.length>0){const O=v(M.children);if(O.length>0){const k={...M,children:O};C.push(k)}}else M.typ&&(o.node.loop_parent_key&&(M.node_type==25||M.node_type==30)?(M.typ==="object"||M.typ=="string"||M.typ=="array<object>")&&C.push({...M}):(M.typ==="object"||M.typ=="string")&&C.push({...M}));return C}return v(_)}const l=Je({input_variable:[],input_tags:[],output:[{key:"",typ:"object",subs:[]}]}),u=()=>{const _=JSON.stringify({json_decode:{...l,input_variable:l.input_variable?l.input_variable.join("."):""}});t("update-node",{...o.node,node_params:_})},c=()=>{try{let _=o.node.dataRaw||o.node.node_params||"{}",v=JSON.parse(_).json_decode||{};v=JSON.parse(JSON.stringify(v)),r(),l.input_variable=wg(v.input_variable),v.output.length>0&&(l.output=v.output)}catch(_){}};gt(()=>l,()=>{u()},{deep:!0});const f=_=>{_.subs=[]},p=_=>{l.output[_].subs.push({key:"",value:"",subs:[],cu_key:_n(16)})},h=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],g=_=>{_||r()},m=()=>{t("close")};return ut(()=>{c()}),(_,v)=>{const b=oi,C=ln,M=Vt,O=It,k=Vn,E=kn,S=wn;return w(),Q(cn,null,{header:x(()=>[y(fn,{title:n.node.node_name,iconName:n.node.node_icon_name,desc:"用于把JSON字符串转化为变量",onClose:m},null,8,["title","iconName"])]),default:x(()=>[d("div",Nz,[d("div",Mz,[y(S,{ref:"formRef",layout:"vertical",model:l},{default:x(()=>[d("div",Tz,[v[2]||(v[2]=d("div",{class:"gray-block-title"},"输入 (string格式数据)",-1)),d("div",$z,[y(b,{value:l.input_variable,"onUpdate:value":v[0]||(v[0]=N=>l.input_variable=N),onDropdownVisibleChange:g,style:{width:"400px"},options:i.value,"change-on-select":"",allowClear:!1,displayRender:({labels:N})=>N.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),d("div",Pz,[v[4]||(v[4]=d("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),d("div",Rz,[v[3]||(v[3]=d("div",{class:"output-block"},[d("div",{class:"output-item"},"参数Key"),d("div",{class:"output-item"},"类型")],-1)),d("div",{class:"array-form-box",onMousedown:v[1]||(v[1]=St(()=>{},["stop"]))},[(w(!0),R(ae,null,ye(l.output,(N,L)=>(w(),R("div",{class:"form-item-list",key:L},[y(E,{label:null,name:["output",L,"key"]},{default:x(()=>[d("div",Bz,[y(C,{style:{width:"214px"},value:N.key,"onUpdate:value":$=>N.key=$,placeholder:"请输入"},null,8,["value","onUpdate:value"]),y(k,null,{default:x(()=>[y(O,{onChange:$=>f(N),value:N.typ,"onUpdate:value":$=>N.typ=$,placeholder:"请选择",showArrow:!1,disabled:"",style:{width:"214px"}},{default:x(()=>[(w(),R(ae,null,ye(h,$=>y(M,{value:$.value,key:$.value},{default:x(()=>[U(j($.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["onChange","value","onUpdate:value"])]),_:2},1024),N.typ=="object"?(w(),R("div",{key:0,class:"btn-hover-wrap",onClick:$=>p(L)},[y(K(Fn))],8,Lz)):ie("",!0)]),N.subs&&N.subs.length>0?(w(),R("div",Iz,[y(k,null,{default:x(()=>[y(Oz,{data:N.subs,level:2,typOptions:h},null,8,["data"])]),_:2},1024)])):ie("",!0)]),_:2},1032,["name"])]))),128))],32)])])]),_:1},8,["model"])])])]),_:1})}}},jz=Te(Fz,[["__scopeId","data-v-c1b75305"]]),Vz=["src"],Hz={class:"workflow-form"},Uz={class:"node-options"},zz={class:"options-item-tit"},qz={class:"option-label"},Gz={class:"option-type"},Xz={class:"field-list-item"},Wz={class:"field-label"},Yz={class:"field-type"},Kz={class:"desc"},Jz={class:"node-options"},Zz={class:"options-item"},Qz={__name:"zm-workflow-node-form",props:{node:{type:Object,default:()=>({})}},setup(n){const e=He("getNode"),t=He("setData"),o=n,i=G([]),r=G([]),s=G({}),a=G([]);let l={};async function u(){var g,m;f(),l=JSON.parse(o.node.node_params),a.value=((g=l==null?void 0:l.workflow)==null?void 0:g.output)||[],s.value=((m=l==null?void 0:l.workflow)==null?void 0:m.robot_info)||{},c()}function c(){var g;cg({robot_id:(g=l==null?void 0:l.workflow)==null?void 0:g.robot_id}).then(m=>{var b,C,M;let _=Po((b=m==null?void 0:m.data)==null?void 0:b.node_params),v=((C=l==null?void 0:l.workflow)==null?void 0:C.params)||[];i.value=((M=_==null?void 0:_.start)==null?void 0:M.diy_global)||[];for(let O of i.value){let k=v.find(E=>O.key==E.key);O.variable=(k==null?void 0:k.variable)||"",O.tags=Array.isArray(k==null?void 0:k.tags)?k.tags:[]}})}function f(){r.value=e().getAllParentVariable()}function p(g,m,_){g.variable=m,g.tags=_,h()}function h(){let g=JSON.parse(JSON.stringify(i.value));for(let m of g)m.variable=String(m.variable);l.workflow.params=g,t({...o.node,node_params:JSON.stringify(l)})}return ut(()=>{u()}),(g,m)=>{const _=mo;return w(),Q(cn,null,{header:x(()=>{var v;return[y(fn,{title:n.node.node_name,desc:(v=s.value)==null?void 0:v.robot_intro},{"node-icon":x(()=>[s.value.robot_avatar?(w(),R("img",{key:0,class:"node-icon",src:s.value.robot_avatar},null,8,Vz)):(w(),Q(_,{key:1,size:"small"}))]),_:1},8,["title","desc"])]}),default:x(()=>[d("div",Hz,[d("div",Uz,[m[0]||(m[0]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:Zn,class:"title-icon"}),U("输入")])],-1)),(w(!0),R(ae,null,ye(i.value,v=>(w(),R("div",{key:v.key,class:Ct(["options-item",{"is-required":v.required}])},[d("div",zz,[d("div",qz,j(v.name||v.key),1),d("div",Gz,j(v.typ),1)]),d("div",null,[y(ot,{type:"textarea",inputStyle:"height: 64px;",options:r.value,defaultSelectedList:v.tags,defaultValue:v.variable,ref_for:!0,ref:"atInputRef",placeholder:"请输入内容，键入“/”可以插入变量",onOpen:f,onChange:(b,C)=>p(v,b,C)},{option:x(({label:b,payload:C})=>[d("div",Xz,[d("div",Wz,j(b),1),d("div",Yz,j(C.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue","onChange"])]),d("div",Kz,j(v.desc),1)],2))),128))]),d("div",Jz,[m[1]||(m[1]=d("div",{class:"options-title"},[d("div",null,[d("img",{src:lo,class:"title-icon"}),U("输出")])],-1)),d("div",Zz,[y(Fi,{"tree-data":a.value},null,8,["tree-data"])])])])]),_:1})}}},eq=Te(Qz,[["__scopeId","data-v-d0944414"]]),tq=["width"],nq={class:"node-form-drawer-body"},oq=["node-key"],iq={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(n,{expose:e,emit:t}){const o={"start-node":Dk,"problem-optimization-node":aE,"ai-dialogue-node":$E,"add-data-node":v3,"knowledge-base-node":ND,"code-run-node":gA,"http-node":UO,"delete-data-node":lN,"variable-assignment-node":bN,"update-data-node":DN,"parameter-extraction-node":l8,"select-data-node":U8,"question-node":fM,"judge-node":CM,"specify-reply-node":MM,"immediately-reply-node":FM,"mcp-node":JM,"custom-group":AT,"batch-group":m9,"zm-plugins-node":P7,"session-trigger-node":X7,"timing-trigger-node":oI,"end-node":nF,"official-trigger-node":mI,"image-generation-node":nH,"voice-clone-node":pj,"voice-synthesis-node":AV,"explain-node":lH,"webhook-trigger-node":lU,"import-library-node":lz,"json-node":Sz,"json-reverse-node":jz,"zm-workflow-node":eq},i=t,r=n,s=Xe({get:()=>r.open,set:v=>i("update:open",v)}),a=()=>{s.value=!1},l=Xe(()=>{var M,O,k;let v=Po((M=r.node)==null?void 0:M.node_params);return((O=v==null?void 0:v.plugin)==null?void 0:O.name)=="feishu_bitable"||((k=v==null?void 0:v.plugin)==null?void 0:k.name)=="official_send_message"?600:(()=>{var L;const E=(L=v==null?void 0:v.plugin)==null?void 0:L.params;if(!E)return!1;const S=E==null?void 0:E.params;if(S&&typeof S=="object")for(const $ in S){const B=S[$];if(B&&B.date_range_begin_component)return!0}const N=E==null?void 0:E.arguments;if(N&&typeof N=="object"){const $=Object.keys(N||{});if($.includes("date_type")||$.includes("begin_date")&&$.includes("end_date"))return!0}return!1})()?640:{"delete-data-node":600,"update-data-node":600,"select-data-node":600,"judge-node":600,"custom-group":640,"timing-trigger-node":420,"batch-group":640,"webhook-trigger-node":620,"end-node":650}[r.nodeType]||480}),u=()=>r.lf.getNodeModelById(r.nodeId),c=()=>r.lf.graphModel,f=v=>{m(v)},p=v=>{i("change-title",v)},h=()=>{s.value=!1;let v=u();c().eventCenter.emit("custom:node:delete",v)};Ui("lf",r.lf),Ui("getNode",u),Ui("getGraph",c),Ui("setData",f),Ui("changeTitle",p),Ui("deleteNode",h),Ui("close",a);const g=Xe(()=>{const v=`${r.nodeType}`;return o[v]||null}),m=v=>{v.dataRaw=v.node_params,i("update-node",v)},_=()=>{s.value=!1};return e({open}),(v,b)=>{const C=Kt,M=Ay;return w(),Q(Gm,{name:"slide-right",appear:""},{default:x(()=>[s.value?(w(),R("div",{key:0,width:l.value,style:In({width:l.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:qm(_,["esc"])},[d("div",nq,[d("div",{class:"drawer-form","node-key":r.nodeType},[g.value?(w(),Q(Pu(g.value),{lf:r.lf,"node-id":r.nodeId,"node-type":r.nodeType,node:r.node,key:r.nodeId,onClose:_,onUpdateNode:m},null,40,["lf","node-id","node-type","node"])):(w(),Q(M,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:x(()=>[y(C,{type:"primary",onClick:_},{default:x(()=>[...b[0]||(b[0]=[U("关闭",-1)])]),_:1})]),_:1}))],8,oq)])],44,tq)):ie("",!0)]),_:1})}}},rq=Te(iq,[["__scopeId","data-v-7458020d"]]);var Uu,Gt,Xg,mr,jp,Wg,Yg,Kg,gf,Jd,Zd,wa={},Jg=[],sq=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ga=Array.isArray;function Mi(n,e){for(var t in e)n[t]=e[t];return n}function _f(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Ze(n,e,t){var o,i,r,s={};for(r in e)r=="key"?o=e[r]:r=="ref"?i=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?Uu.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)s[r]===void 0&&(s[r]=n.defaultProps[r]);return Ol(n,s,o,i,null)}function Ol(n,e,t,o,i){var r={type:n,props:e,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Xg,__i:-1,__u:0};return i==null&&Gt.vnode!=null&&Gt.vnode(r),r}function zu(){return{current:null}}function fs(n){return n.children}function Yt(n,e){this.props=n,this.context=e}function ps(n,e){if(e==null)return n.__?ps(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?ps(n):null}function Zg(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return Zg(n)}}function Vp(n){(!n.__d&&(n.__d=!0)&&mr.push(n)&&!Vl.__r++||jp!=Gt.debounceRendering)&&((jp=Gt.debounceRendering)||Wg)(Vl)}function Vl(){for(var n,e,t,o,i,r,s,a=1;mr.length;)mr.length>a&&mr.sort(Yg),n=mr.shift(),a=mr.length,n.__d&&(t=void 0,o=void 0,i=(o=(e=n).__v).__e,r=[],s=[],e.__P&&((t=Mi({},o)).__v=o.__v+1,Gt.vnode&&Gt.vnode(t),mf(e.__P,t,o,e.__n,e.__P.namespaceURI,32&o.__u?[i]:null,r,i??ps(o),!!(32&o.__u),s),t.__v=o.__v,t.__.__k[t.__i]=t,t_(r,t,s),o.__e=o.__=null,t.__e!=i&&Zg(t)));Vl.__r=0}function Qg(n,e,t,o,i,r,s,a,l,u,c){var f,p,h,g,m,_,v,b=o&&o.__k||Jg,C=e.length;for(l=aq(t,e,b,l,C),f=0;f<C;f++)(h=t.__k[f])!=null&&(p=h.__i==-1?wa:b[h.__i]||wa,h.__i=f,_=mf(n,h,p,i,r,s,a,l,u,c),g=h.__e,h.ref&&p.ref!=h.ref&&(p.ref&&yf(p.ref,null,h),c.push(h.ref,h.__c||g,h)),m==null&&g!=null&&(m=g),(v=!!(4&h.__u))||p.__k===h.__k?l=e_(h,l,n,v):typeof h.type=="function"&&_!==void 0?l=_:g&&(l=g.nextSibling),h.__u&=-7);return t.__e=m,l}function aq(n,e,t,o,i){var r,s,a,l,u,c=t.length,f=c,p=0;for(n.__k=new Array(i),r=0;r<i;r++)(s=e[r])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=n.__k[r]=Ol(null,s,null,null,null):Ga(s)?s=n.__k[r]=Ol(fs,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=n.__k[r]=Ol(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):n.__k[r]=s,l=r+p,s.__=n,s.__b=n.__b+1,(u=s.__i=lq(s,t,l,f))!=-1&&(f--,(a=t[u])&&(a.__u|=2)),a==null||a.__v==null?(u==-1&&(i>c?p--:i<c&&p++),typeof s.type!="function"&&(s.__u|=4)):u!=l&&(u==l-1?p--:u==l+1?p++:(u>l?p--:p++,s.__u|=4))):n.__k[r]=null;if(f)for(r=0;r<c;r++)(a=t[r])!=null&&(2&a.__u)==0&&(a.__e==o&&(o=ps(a)),o_(a,a));return o}function e_(n,e,t,o){var i,r;if(typeof n.type=="function"){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,e=e_(i[r],e,t,o));return e}n.__e!=e&&(o&&(e&&n.type&&!e.parentNode&&(e=ps(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Hl(n,e){return e=e||[],n==null||typeof n=="boolean"||(Ga(n)?n.some(function(t){Hl(t,e)}):e.push(n)),e}function lq(n,e,t,o){var i,r,s,a=n.key,l=n.type,u=e[t],c=u!=null&&(2&u.__u)==0;if(u===null&&a==null||c&&a==u.key&&l==u.type)return t;if(o>(c?1:0)){for(i=t-1,r=t+1;i>=0||r<e.length;)if((u=e[s=i>=0?i--:r++])!=null&&(2&u.__u)==0&&a==u.key&&l==u.type)return s}return-1}function Hp(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||sq.test(e)?t:t+"px"}function il(n,e,t,o,i){var r,s;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof o=="string"&&(n.style.cssText=o=""),o)for(e in o)t&&e in t||Hp(n.style,e,"");if(t)for(e in t)o&&t[e]==o[e]||Hp(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(Kg,"$1")),s=e.toLowerCase(),e=s in n||e=="onFocusOut"||e=="onFocusIn"?s.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?o?t.u=o.u:(t.u=gf,n.addEventListener(e,r?Zd:Jd,r)):n.removeEventListener(e,r?Zd:Jd,r);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Up(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=gf++;else if(e.t<t.u)return;return t(Gt.event?Gt.event(e):e)}}}function mf(n,e,t,o,i,r,s,a,l,u){var c,f,p,h,g,m,_,v,b,C,M,O,k,E,S,N,L,$=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(c=Gt.__b)&&c(e);e:if(typeof $=="function")try{if(v=e.props,b="prototype"in $&&$.prototype.render,C=(c=$.contextType)&&o[c.__c],M=c?C?C.props.value:c.__:o,t.__c?_=(f=e.__c=t.__c).__=f.__E:(b?e.__c=f=new $(v,M):(e.__c=f=new Yt(v,M),f.constructor=$,f.render=dq),C&&C.sub(f),f.state||(f.state={}),f.__n=o,p=f.__d=!0,f.__h=[],f._sb=[]),b&&f.__s==null&&(f.__s=f.state),b&&$.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=Mi({},f.__s)),Mi(f.__s,$.getDerivedStateFromProps(v,f.__s))),h=f.props,g=f.state,f.__v=e,p)b&&$.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),b&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(b&&$.getDerivedStateFromProps==null&&v!==h&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(v,M),e.__v==t.__v||!f.__e&&f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(v,f.__s,M)===!1){for(e.__v!=t.__v&&(f.props=v,f.state=f.__s,f.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(B){B&&(B.__=e)}),O=0;O<f._sb.length;O++)f.__h.push(f._sb[O]);f._sb=[],f.__h.length&&s.push(f);break e}f.componentWillUpdate!=null&&f.componentWillUpdate(v,f.__s,M),b&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(h,g,m)})}if(f.context=M,f.props=v,f.__P=n,f.__e=!1,k=Gt.__r,E=0,b){for(f.state=f.__s,f.__d=!1,k&&k(e),c=f.render(f.props,f.state,f.context),S=0;S<f._sb.length;S++)f.__h.push(f._sb[S]);f._sb=[]}else do f.__d=!1,k&&k(e),c=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++E<25);f.state=f.__s,f.getChildContext!=null&&(o=Mi(Mi({},o),f.getChildContext())),b&&!p&&f.getSnapshotBeforeUpdate!=null&&(m=f.getSnapshotBeforeUpdate(h,g)),N=c,c!=null&&c.type===fs&&c.key==null&&(N=n_(c.props.children)),a=Qg(n,Ga(N)?N:[N],e,t,o,i,r,s,a,l,u),f.base=e.__e,e.__u&=-161,f.__h.length&&s.push(f),_&&(f.__E=f.__=null)}catch(B){if(e.__v=null,l||r!=null)if(B.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else{for(L=r.length;L--;)_f(r[L]);Qd(e)}else e.__e=t.__e,e.__k=t.__k,B.then||Qd(e);Gt.__e(B,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=uq(t.__e,e,t,o,i,r,s,l,u);return(c=Gt.diffed)&&c(e),128&e.__u?void 0:a}function Qd(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Qd)}function t_(n,e,t){for(var o=0;o<t.length;o++)yf(t[o],t[++o],t[++o]);Gt.__c&&Gt.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(r){r.call(i)})}catch(r){Gt.__e(r,i.__v)}})}function n_(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:Ga(n)?n.map(n_):Mi({},n)}function uq(n,e,t,o,i,r,s,a,l){var u,c,f,p,h,g,m,_=t.props||wa,v=e.props,b=e.type;if(b=="svg"?i="http://www.w3.org/2000/svg":b=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(u=0;u<r.length;u++)if((h=r[u])&&"setAttribute"in h==!!b&&(b?h.localName==b:h.nodeType==3)){n=h,r[u]=null;break}}if(n==null){if(b==null)return document.createTextNode(v);n=document.createElementNS(i,b,v.is&&v),a&&(Gt.__m&&Gt.__m(e,r),a=!1),r=null}if(b==null)_===v||a&&n.data==v||(n.data=v);else{if(r=r&&Uu.call(n.childNodes),!a&&r!=null)for(_={},u=0;u<n.attributes.length;u++)_[(h=n.attributes[u]).name]=h.value;for(u in _)if(h=_[u],u!="children"){if(u=="dangerouslySetInnerHTML")f=h;else if(!(u in v)){if(u=="value"&&"defaultValue"in v||u=="checked"&&"defaultChecked"in v)continue;il(n,u,null,h,i)}}for(u in v)h=v[u],u=="children"?p=h:u=="dangerouslySetInnerHTML"?c=h:u=="value"?g=h:u=="checked"?m=h:a&&typeof h!="function"||_[u]===h||il(n,u,h,_[u],i);if(c)a||f&&(c.__html==f.__html||c.__html==n.innerHTML)||(n.innerHTML=c.__html),e.__k=[];else if(f&&(n.innerHTML=""),Qg(e.type=="template"?n.content:n,Ga(p)?p:[p],e,t,o,b=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,s,r?r[0]:t.__k&&ps(t,0),a,l),r!=null)for(u=r.length;u--;)_f(r[u]);a||(u="value",b=="progress"&&g==null?n.removeAttribute("value"):g!=null&&(g!==n[u]||b=="progress"&&!g||b=="option"&&g!=_[u])&&il(n,u,g,_[u],i),u="checked",m!=null&&m!=n[u]&&il(n,u,m,_[u],i))}return n}function yf(n,e,t){try{if(typeof n=="function"){var o=typeof n.__u=="function";o&&n.__u(),o&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Gt.__e(i,t)}}function o_(n,e,t){var o,i;if(Gt.unmount&&Gt.unmount(n),(o=n.ref)&&(o.current&&o.current!=n.__e||yf(o,null,e)),(o=n.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(r){Gt.__e(r,e)}o.base=o.__P=null}if(o=n.__k)for(i=0;i<o.length;i++)o[i]&&o_(o[i],e,t||typeof n.type!="function");t||_f(n.__e),n.__c=n.__=n.__e=void 0}function dq(n,e,t){return this.constructor(n,t)}function cq(n,e,t){var o,i,r,s;e==document&&(e=document.documentElement),Gt.__&&Gt.__(n,e),i=(o=!1)?null:e.__k,r=[],s=[],mf(e,n=e.__k=Ze(fs,null,[n]),i||wa,wa,e.namespaceURI,i?null:e.firstChild?Uu.call(e.childNodes):null,r,i?i.__e:e.firstChild,o,s),t_(r,n,s)}Uu=Jg.slice,Gt={__e:function(n,e,t,o){for(var i,r,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(n)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,o||{}),s=i.__d),s)return i.__E=i}catch(a){n=a}throw n}},Xg=0,Yt.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Mi({},this.state),typeof n=="function"&&(n=n(Mi({},t),this.props)),n&&Mi(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Vp(this))},Yt.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Vp(this))},Yt.prototype.render=fs,mr=[],Wg=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Yg=function(n,e){return n.__v.__b-e.__v.__b},Vl.__r=0,Kg=/(PointerCapture)$|Capture$/i,gf=0,Jd=Up(!1),Zd=Up(!0);var fq="An invariant failed, however the error is obfuscated because this is a production build.",Ul=[];Object.freeze(Ul);var bf={};Object.freeze(bf);function uo(){return++yt.mobxGuid}function dn(n){throw Er(!1,n),"X"}function Er(n,e){if(!n)throw new Error("[mobx] "+(e||fq))}function i_(n){var e=!1;return function(){if(!e)return e=!0,n.apply(this,arguments)}}var rl=function(){};function pq(n){var e=[];return n.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function xf(n){return n!==null&&typeof n=="object"}function Rs(n){if(n===null||typeof n!="object")return!1;var e=Object.getPrototypeOf(n);return e===Object.prototype||e===null}function hq(n){if(Ls(n)||co(n))return n;if(Array.isArray(n))return new Map(n);if(Rs(n)){var e=new Map;for(var t in n)e.set(t,n[t]);return e}else return dn("Cannot convert to map from '"+n+"'")}function Bs(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function vq(n,e,t){Object.defineProperty(n,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function gq(n,e){var t=Object.getOwnPropertyDescriptor(n,e);return!t||t.configurable!==!1&&t.writable!==!1}function ar(n,e){var t="isMobX"+n;return e.prototype[t]=!0,function(o){return xf(o)&&o[t]===!0}}function Ls(n){return n instanceof Map}function Xa(n){return n instanceof Set}function r_(n){var e=new Set;for(var t in n)e.add(t);return Object.getOwnPropertySymbols(n).forEach(function(o){Object.getOwnPropertyDescriptor(n,o).enumerable&&e.add(o)}),Array.from(e)}function Ki(n){return n&&n.toString?n.toString():new String(n).toString()}function s_(n){return n===null?null:typeof n=="object"?""+n:n}var _q=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Mt=Symbol("mobx administration"),Is=(function(){function n(e){e===void 0&&(e="Atom@"+uo()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=hn.NOT_TRACKING}return n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.reportObserved=function(){return __(this)},n.prototype.reportChanged=function(){Jo(),Fq(this),Zo()},n.prototype.toString=function(){return this.name},n})(),wf=ar("Atom",Is);function Cf(n,e,t){e===void 0&&(e=rl),t===void 0&&(t=rl);var o=new Is(n);return e!==rl&&Zq(o,e),t!==rl&&C_(o,t),o}function mq(n,e){return $_(n,e)}function yq(n,e){return Object.is(n,e)}var hs={structural:mq,default:yq};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ec=function(n,e){return ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])},ec(n,e)};function bq(n,e){ec(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var zl=function(){return zl=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++){t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},zl.apply(this,arguments)};function vi(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}function ts(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r}function Sf(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(ts(arguments[e]));return n}var ql=Symbol("mobx did run lazy initializers"),Js=Symbol("mobx pending decorators"),xq={},wq={};function Cq(n,e){var t=e?xq:wq;return t[n]||(t[n]={configurable:!0,enumerable:e,get:function(){return Tr(this),this[n]},set:function(o){Tr(this),this[n]=o}})}function Tr(n){var e,t;if(n[ql]!==!0){var o=n[Js];if(o){Bs(n,ql,!0);var i=Sf(Object.getOwnPropertySymbols(o),Object.keys(o));try{for(var r=vi(i),s=r.next();!s.done;s=r.next()){var a=s.value,l=o[a];l.propertyCreator(n,l.prop,l.descriptor,l.decoratorTarget,l.decoratorArguments)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}}}function a_(n,e){return function(){var o,i=function(s,a,l,u){if(u===!0)return e(s,a,l,s,o),null;if(!Object.prototype.hasOwnProperty.call(s,Js)){var c=s[Js];Bs(s,Js,zl({},c))}return s[Js][a]={prop:a,propertyCreator:e,descriptor:l,decoratorTarget:s,decoratorArguments:o},Cq(a,n)};return Sq(arguments)?(o=Ul,i.apply(null,arguments)):(o=Array.prototype.slice.call(arguments),i)}}function Sq(n){return(n.length===2||n.length===3)&&(typeof n[1]=="string"||typeof n[1]=="symbol")||n.length===4&&n[3]===!0}function Wa(n,e,t){return ms(n)?n:Array.isArray(n)?Pe.array(n,{name:t}):Rs(n)?Pe.object(n,void 0,{name:t}):Ls(n)?Pe.map(n,{name:t}):Xa(n)?Pe.set(n,{name:t}):n}function kq(n,e,t){return n==null||ri(n)||Si(n)||co(n)||Io(n)?n:Array.isArray(n)?Pe.array(n,{name:t,deep:!1}):Rs(n)?Pe.object(n,void 0,{name:t,deep:!1}):Ls(n)?Pe.map(n,{name:t,deep:!1}):Xa(n)?Pe.set(n,{name:t,deep:!1}):dn(!1)}function qu(n){return n}function Eq(n,e,t){return $_(n,e)?e:n}function Gu(n){Er(n);var e=a_(!0,function(o,i,r,s,a){var l=r?r.initializer?r.initializer.call(o):r.value:void 0;Of(o).addObservableProp(i,l,n)}),t=e;return t.enhancer=n,t}var l_={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(l_);function Zr(n){return n==null?l_:typeof n=="string"?{name:n,deep:!0,proxy:!0}:n}var kf=Gu(Wa),Dq=Gu(kq),u_=Gu(qu),Aq=Gu(Eq);function sl(n){return n.defaultDecorator?n.defaultDecorator.enhancer:n.deep===!1?qu:Wa}function Oq(n,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return kf.apply(null,arguments);if(ms(n))return n;var o=Rs(n)?Pe.object(n,e,t):Array.isArray(n)?Pe.array(n,e):Ls(n)?Pe.map(n,e):Xa(n)?Pe.set(n,e):n;if(o!==n)return o;dn(!1)}var zp={box:function(n,e){arguments.length>2&&qs("box");var t=Zr(e);return new Ar(n,sl(t),t.name,!0,t.equals)},array:function(n,e){arguments.length>2&&qs("array");var t=Zr(e);return pG(n,sl(t),t.name)},map:function(n,e){arguments.length>2&&qs("map");var t=Zr(e);return new Af(n,sl(t),t.name)},set:function(n,e){arguments.length>2&&qs("set");var t=Zr(e);return new M_(n,sl(t),t.name)},object:function(n,e,t){typeof arguments[1]=="string"&&qs("object");var o=Zr(t);if(o.proxy===!1)return sc({},n,e,o);var i=k_(o),r=sc({},void 0,void 0,o),s=dG(r);return E_(s,n,e,i),s},ref:u_,shallow:Dq,deep:kf,struct:Aq},Pe=Oq;Object.keys(zp).forEach(function(n){return Pe[n]=zp[n]});function qs(n){dn("Expected one or two arguments to observable."+n+". Did you accidentally try to use observable."+n+" as decorator?")}var Gl=a_(!1,function(n,e,t,o,i){var r=t.get,s=t.set,a=i[0]||{};Of(n).addComputedProp(n,e,zl({get:r,set:s,context:n},a))}),Nq=Gl({equals:hs.structural}),mn=function(e,t,o){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return Gl.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new gs(i)};mn.struct=Nq;var hn;(function(n){n[n.NOT_TRACKING=-1]="NOT_TRACKING",n[n.UP_TO_DATE=0]="UP_TO_DATE",n[n.POSSIBLY_STALE=1]="POSSIBLY_STALE",n[n.STALE=2]="STALE"})(hn||(hn={}));var mi;(function(n){n[n.NONE=0]="NONE",n[n.LOG=1]="LOG",n[n.BREAK=2]="BREAK"})(mi||(mi={}));var Xl=(function(){function n(e){this.cause=e}return n})();function Zs(n){return n instanceof Xl}function tc(n){switch(n.dependenciesState){case hn.UP_TO_DATE:return!1;case hn.NOT_TRACKING:case hn.STALE:return!0;case hn.POSSIBLY_STALE:{for(var e=Ef(!0),t=Fs(),o=n.observing,i=o.length,r=0;r<i;r++){var s=o[r];if(_s(s)){if(yt.disableErrorBoundaries)s.get();else try{s.get()}catch{return Qi(t),na(e),!0}if(n.dependenciesState===hn.STALE)return Qi(t),na(e),!0}}return f_(n),Qi(t),na(e),!1}}}function vs(n){var e=n.observers.size>0;yt.computationDepth>0&&e&&dn(!1),!yt.allowStateChanges&&(e||yt.enforceActions==="strict")&&dn(!1)}function d_(n,e,t){var o=Ef(!0);f_(n),n.newObserving=new Array(n.observing.length+100),n.unboundDepsCount=0,n.runId=++yt.runId;var i=yt.trackingDerivation;yt.trackingDerivation=n;var r;if(yt.disableErrorBoundaries===!0)r=e.call(t);else try{r=e.call(t)}catch(s){r=new Xl(s)}return yt.trackingDerivation=i,Mq(n),na(o),r}function Mq(n){for(var e=n.observing,t=n.observing=n.newObserving,o=hn.UP_TO_DATE,i=0,r=n.unboundDepsCount,s=0;s<r;s++){var a=t[s];a.diffValue===0&&(a.diffValue=1,i!==s&&(t[i]=a),i++),a.dependenciesState>o&&(o=a.dependenciesState)}for(t.length=i,n.newObserving=null,r=e.length;r--;){var a=e[r];a.diffValue===0&&v_(a,n),a.diffValue=0}for(;i--;){var a=t[i];a.diffValue===1&&(a.diffValue=0,Iq(a,n))}o!==hn.UP_TO_DATE&&(n.dependenciesState=o,n.onBecomeStale())}function nc(n){var e=n.observing;n.observing=[];for(var t=e.length;t--;)v_(e[t],n);n.dependenciesState=hn.NOT_TRACKING}function c_(n){var e=Fs();try{return n()}finally{Qi(e)}}function Fs(){var n=yt.trackingDerivation;return yt.trackingDerivation=null,n}function Qi(n){yt.trackingDerivation=n}function Ef(n){var e=yt.allowStateReads;return yt.allowStateReads=n,e}function na(n){yt.allowStateReads=n}function f_(n){if(n.dependenciesState!==hn.UP_TO_DATE){n.dependenciesState=hn.UP_TO_DATE;for(var e=n.observing,t=e.length;t--;)e[t].lowestObserverState=hn.UP_TO_DATE}}var Wl=0,Tq=1,qp=Object.getOwnPropertyDescriptor(function(){},"name");qp&&qp.configurable;function Dr(n,e,t){var o=function(){return p_(n,e,t||this,arguments)};return o.isMobxAction=!0,o}function p_(n,e,t,o){var i=$q();try{return e.apply(t,o)}catch(r){throw i.error=r,r}finally{Pq(i)}}function $q(n,e,t){var o=To(),i=0,r=Fs();Jo();var s=Xu(!0),a=Ef(!0),l={prevDerivation:r,prevAllowStateChanges:s,prevAllowStateReads:a,notifySpy:o,startTime:i,actionId:Tq++,parentActionId:Wl};return Wl=l.actionId,l}function Pq(n){Wl!==n.actionId&&dn("invalid action stack. did you forget to finish an action?"),Wl=n.parentActionId,n.error!==void 0&&(yt.suppressReactionErrors=!0),Wu(n.prevAllowStateChanges),na(n.prevAllowStateReads),Zo(),Qi(n.prevDerivation),n.notifySpy,yt.suppressReactionErrors=!1}function Xu(n){var e=yt.allowStateChanges;return yt.allowStateChanges=n,e}function Wu(n){yt.allowStateChanges=n}var Ar=(function(n){bq(e,n);function e(t,o,i,r,s){i===void 0&&(i="ObservableValue@"+uo()),s===void 0&&(s=hs.default);var a=n.call(this,i)||this;return a.enhancer=o,a.name=i,a.equals=s,a.hasUnreportedChange=!1,a.value=o(t,void 0,i),a}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==yt.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(vs(this),yi(this)){var o=bi(this,{object:this,type:"update",newValue:t});if(!o)return yt.UNCHANGED;t=o.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?yt.UNCHANGED:t},e.prototype.setNewValue=function(t){var o=this.value;this.value=t,this.reportChanged(),Qo(this)&&ei(this,{type:"update",object:this,newValue:t,oldValue:o})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return Ya(this,t)},e.prototype.observe=function(t,o){return o&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),Ka(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return s_(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e})(Is),Rq=ar("ObservableValue",Ar),gs=(function(){function n(e){this.dependenciesState=hn.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=hn.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+uo(),this.value=new Xl(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=mi.NONE,Er(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+uo(),e.set&&(this.setter=Dr(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?hs.structural:hs.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return n.prototype.onBecomeStale=function(){Vq(this)},n.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},n.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},n.prototype.get=function(){this.isComputing&&dn("Cycle detected in computation "+this.name+": "+this.derivation),yt.inBatch===0&&this.observers.size===0&&!this.keepAlive?tc(this)&&(this.warnAboutUntrackedRead(),Jo(),this.value=this.computeValue(!1),Zo()):(__(this),tc(this)&&this.trackAndCompute()&&jq(this));var e=this.value;if(Zs(e))throw e.cause;return e},n.prototype.peek=function(){var e=this.computeValue(!1);if(Zs(e))throw e.cause;return e},n.prototype.set=function(e){if(this.setter){Er(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else Er(!1,!1)},n.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===hn.NOT_TRACKING,o=this.computeValue(!0),i=t||Zs(e)||Zs(o)||!this.equals(e,o);return i&&(this.value=o),i},n.prototype.computeValue=function(e){this.isComputing=!0,yt.computationDepth++;var t;if(e)t=d_(this,this.derivation,this.scope);else if(yt.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(o){t=new Xl(o)}return yt.computationDepth--,this.isComputing=!1,t},n.prototype.suspend=function(){this.keepAlive||(nc(this),this.value=void 0)},n.prototype.observe=function(e,t){var o=this,i=!0,r=void 0;return Yq(function(){var s=o.get();if(!i||t){var a=Fs();e({type:"update",object:o,newValue:s,oldValue:r}),Qi(a)}i=!1,r=s})},n.prototype.warnAboutUntrackedRead=function(){},n.prototype.toJSON=function(){return this.get()},n.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},n.prototype.valueOf=function(){return s_(this.get())},n.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},n})(),_s=ar("ComputedValue",gs),Nl=(function(){function n(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return n})(),Bq={};function oc(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:Bq}var Ml=!0,h_=!1,yt=(function(){var n=oc();return n.__mobxInstanceCount>0&&!n.__mobxGlobals&&(Ml=!1),n.__mobxGlobals&&n.__mobxGlobals.version!==new Nl().version&&(Ml=!1),Ml?n.__mobxGlobals?(n.__mobxInstanceCount+=1,n.__mobxGlobals.UNCHANGED||(n.__mobxGlobals.UNCHANGED={}),n.__mobxGlobals):(n.__mobxInstanceCount=1,n.__mobxGlobals=new Nl):(setTimeout(function(){h_||dn("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new Nl)})();function Lq(){(yt.pendingReactions.length||yt.inBatch||yt.isRunningReactions)&&dn("isolateGlobalState should be called before MobX is running any reactions"),h_=!0,Ml&&(--oc().__mobxInstanceCount===0&&(oc().__mobxGlobals=void 0),yt=new Nl)}function ic(){return yt}function Iq(n,e){n.observers.add(e),n.lowestObserverState>e.dependenciesState&&(n.lowestObserverState=e.dependenciesState)}function v_(n,e){n.observers.delete(e),n.observers.size===0&&g_(n)}function g_(n){n.isPendingUnobservation===!1&&(n.isPendingUnobservation=!0,yt.pendingUnobservations.push(n))}function Jo(){yt.inBatch++}function Zo(){if(--yt.inBatch===0){b_();for(var n=yt.pendingUnobservations,e=0;e<n.length;e++){var t=n[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof gs&&t.suspend())}yt.pendingUnobservations=[]}}function __(n){var e=yt.trackingDerivation;return e!==null?(e.runId!==n.lastAccessedBy&&(n.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=n,n.isBeingObserved||(n.isBeingObserved=!0,n.onBecomeObserved())),!0):(n.observers.size===0&&yt.inBatch>0&&g_(n),!1)}function Fq(n){n.lowestObserverState!==hn.STALE&&(n.lowestObserverState=hn.STALE,n.observers.forEach(function(e){e.dependenciesState===hn.UP_TO_DATE&&(e.isTracing!==mi.NONE&&m_(e,n),e.onBecomeStale()),e.dependenciesState=hn.STALE}))}function jq(n){n.lowestObserverState!==hn.STALE&&(n.lowestObserverState=hn.STALE,n.observers.forEach(function(e){e.dependenciesState===hn.POSSIBLY_STALE?e.dependenciesState=hn.STALE:e.dependenciesState===hn.UP_TO_DATE&&(n.lowestObserverState=hn.UP_TO_DATE)}))}function Vq(n){n.lowestObserverState===hn.UP_TO_DATE&&(n.lowestObserverState=hn.POSSIBLY_STALE,n.observers.forEach(function(e){e.dependenciesState===hn.UP_TO_DATE&&(e.dependenciesState=hn.POSSIBLY_STALE,e.isTracing!==mi.NONE&&m_(e,n),e.onBecomeStale())}))}function m_(n,e){if(""+n.name+e.name,n.isTracing===mi.BREAK){var t=[];y_(eG(n),t,1),new Function(`debugger;
/*
Tracing '`+n.name+`'

You are entering this break point because derivation '`+n.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(n instanceof gs?n.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function y_(n,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+n.name),n.dependencies&&n.dependencies.forEach(function(o){return y_(o,e,t+1)})}var Ca=(function(){function n(e,t,o,i){e===void 0&&(e="Reaction@"+uo()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=o,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=hn.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+uo(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=mi.NONE}return n.prototype.onBecomeStale=function(){this.schedule()},n.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,yt.pendingReactions.push(this),b_())},n.prototype.isScheduled=function(){return this._isScheduled},n.prototype.runReaction=function(){if(!this.isDisposed){if(Jo(),this._isScheduled=!1,tc(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&To()}catch(e){this.reportExceptionInDerivation(e)}}Zo()}},n.prototype.track=function(e){if(!this.isDisposed){Jo(),this._isRunning=!0;var t=d_(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&nc(this),Zs(t)&&this.reportExceptionInDerivation(t.cause),Zo()}},n.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(yt.disableErrorBoundaries)throw e;var o="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";yt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(o,e),yt.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(Jo(),nc(this),Zo()))},n.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[Mt]=this,e},n.prototype.toString=function(){return"Reaction["+this.name+"]"},n.prototype.trace=function(e){e===void 0&&(e=!1),aG(this,e)},n})(),Gp=100,rc=function(n){return n()};function b_(){yt.inBatch>0||yt.isRunningReactions||rc(Hq)}function Hq(){yt.isRunningReactions=!0;for(var n=yt.pendingReactions,e=0;n.length>0;){++e===Gp&&(console.error("Reaction doesn't converge to a stable state after "+Gp+" iterations."+(" Probably there is a cycle in the reactive function: "+n[0])),n.splice(0));for(var t=n.splice(0),o=0,i=t.length;o<i;o++)t[o].runReaction()}yt.isRunningReactions=!1}var Yl=ar("Reaction",Ca);function Uq(n){var e=rc;rc=function(t){return n(function(){return e(t)})}}function To(){return!1}function zq(n){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function qq(){dn(!1)}function Xp(n){return function(e,t,o){if(o){if(o.value)return{value:Dr(n,o.value),enumerable:!1,configurable:!0,writable:!0};var i=o.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return Dr(n,i.call(this))}}}return Gq(n).apply(this,arguments)}}function Gq(n){return function(e,t,o){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){Bs(this,t,$e(n,i))}})}}function Xq(n,e,t,o){return o===!0?(vd(n,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return vd(this,e,t.value||t.initializer.call(this)),this[e]},set:qq}:{enumerable:!1,configurable:!0,set:function(i){vd(this,e,i)},get:function(){}}}var $e=function(e,t,o,i){if(arguments.length===1&&typeof e=="function")return Dr(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return Dr(e,t);if(arguments.length===1&&typeof e=="string")return Xp(e);if(i===!0)Bs(e,t,Dr(e.name||t,o.value,this));else return Xp(t).apply(null,arguments)};$e.bound=Xq;function Wq(n,e){var t=typeof n=="string"?n:n.name||"<unnamed action>",o=typeof n=="function"?n:e;return p_(t,o,this,void 0)}function vd(n,e,t){Bs(n,e,Dr(e,t.bind(n)))}function Yq(n,e){e===void 0&&(e=bf);var t=e&&e.name||n.name||"Autorun@"+uo(),o=!e.scheduler&&!e.delay,i;if(o)i=new Ca(t,function(){this.track(a)},e.onError,e.requiresObservable);else{var r=x_(e),s=!1;i=new Ca(t,function(){s||(s=!0,r(function(){s=!1,i.isDisposed||i.track(a)}))},e.onError,e.requiresObservable)}function a(){n(i)}return i.schedule(),i.getDisposer()}var Kq=function(n){return n()};function x_(n){return n.scheduler?n.scheduler:n.delay?function(e){return setTimeout(e,n.delay)}:Kq}function w_(n,e,t){t===void 0&&(t=bf);var o=t.name||"Reaction@"+uo(),i=$e(o,t.onError?Jq(t.onError,e):e),r=!t.scheduler&&!t.delay,s=x_(t),a=!0,l=!1,u,c=t.compareStructural?hs.structural:t.equals||hs.default,f=new Ca(o,function(){a||r?p():l||(l=!0,s(p))},t.onError,t.requiresObservable);function p(){if(l=!1,!f.isDisposed){var h=!1;f.track(function(){var g=n(f);h=a||!c(u,g),u=g}),a&&t.fireImmediately&&i(u,f),!a&&h===!0&&i(u,f),a&&(a=!1)}}return f.schedule(),f.getDisposer()}function Jq(n,e){return function(){try{return e.apply(this,arguments)}catch(t){n.call(this,t)}}}function Zq(n,e,t){return S_("onBecomeObserved",n,e)}function C_(n,e,t){return S_("onBecomeUnobserved",n,e)}function S_(n,e,t,o){var i=nr(e),r=t,s=n+"Listeners";i[s]?i[s].add(r):i[s]=new Set([r]);var a=i[n];return typeof a!="function"?dn(!1):function(){var l=i[s];l&&(l.delete(r),l.size===0&&delete i[s])}}function Qq(n){var e=n.enforceActions,t=n.computedRequiresReaction,o=n.computedConfigurable,i=n.disableErrorBoundaries,r=n.reactionScheduler,s=n.reactionRequiresObservable,a=n.observableRequiresReaction;if(Lq(),e!==void 0){var l=void 0;switch(e){case!0:case"observed":l=!0;break;case!1:case"never":l=!1;break;case"strict":case"always":l="strict";break;default:dn("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}yt.enforceActions=l,yt.allowStateChanges=!(l===!0||l==="strict")}t!==void 0&&(yt.computedRequiresReaction=!!t),s!==void 0&&(yt.reactionRequiresObservable=!!s),a!==void 0&&(yt.observableRequiresReaction=!!a,yt.allowStateReads=!yt.observableRequiresReaction),o!==void 0&&(yt.computedConfigurable=!!o),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),yt.disableErrorBoundaries=!!i),r&&Uq(r)}function sc(n,e,t,o){o=Zr(o);var i=k_(o);return Tr(n),Of(n,o.name,i.enhancer),e&&E_(n,e,t,i),n}function k_(n){return n.defaultDecorator||(n.deep===!1?u_:kf)}function E_(n,e,t,o){var i,r,s,a,l,u;Jo();try{var s=_q(e);try{for(var c=vi(s),f=c.next();!f.done;f=c.next()){var u=f.value,p=Object.getOwnPropertyDescriptor(e,u),h=t&&u in t?t[u]:p.get?Gl:o,g=h(n,u,p,!0);g&&Object.defineProperty(n,u,g)}}catch(_){i={error:_}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}finally{Zo()}}function eG(n,e){return D_(nr(n,e))}function D_(n){var e={name:n.name};return n.observing&&n.observing.length>0&&(e.dependencies=pq(n.observing).map(D_)),e}function A_(n,e){if(n==null)return!1;if(e!==void 0){if(ri(n)===!1||!n[Mt].values.has(e))return!1;var t=nr(n,e);return _s(t)}return _s(n)}function tG(n){return arguments.length>1?dn(!1):A_(n)}function Wp(n,e){return typeof e!="string"?dn(!1):A_(n,e)}function nG(n,e){return n==null?!1:ri(n)||!!n[Mt]||wf(n)||Yl(n)||_s(n)}function ms(n){return arguments.length!==1&&dn(!1),nG(n)}function ys(n){return ri(n)?n[Mt].getKeys():co(n)||Io(n)?Array.from(n.keys()):Si(n)?n.map(function(e,t){return t}):dn(!1)}function oG(n){return ri(n)?ys(n).map(function(e){return n[e]}):co(n)?ys(n).map(function(e){return n.get(e)}):Io(n)?Array.from(n.values()):Si(n)?n.slice():dn(!1)}function iG(n){return ri(n)?ys(n).map(function(e){return[e,n[e]]}):co(n)?ys(n).map(function(e){return[e,n.get(e)]}):Io(n)?Array.from(n.entries()):Si(n)?n.map(function(e,t){return[t,e]}):dn(!1)}function Df(n,e,t){if(arguments.length===2&&!Io(n)){Jo();var o=e;try{for(var i in o)Df(n,i,o[i])}finally{Zo()}return}if(ri(n)){var r=n[Mt],s=r.values.get(e);s?r.write(e,t):r.addObservableProp(e,t,r.defaultEnhancer)}else if(co(n))n.set(e,t);else if(Io(n))n.add(e);else if(Si(n))typeof e!="number"&&(e=parseInt(e,10)),Er(e>=0,"Not a valid index: '"+e+"'"),Jo(),e>=n.length&&(n.length=e+1),n[e]=t,Zo();else return dn(!1)}function O_(n,e,t,o){return rG(n,e,t)}function rG(n,e,t){return Yu(n).observe(e,t)}var sG={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Ur(n,e,t,o){return o.detectCycles&&n.set(e,t),t}function zi(n,e,t){if(!e.recurseEverything&&!ms(n)||typeof n!="object")return n;if(n===null)return null;if(n instanceof Date)return n;if(Rq(n))return zi(n.get(),e,t);ms(n)&&ys(n);var o=e.detectCycles===!0;if(o&&n!==null&&t.has(n))return t.get(n);if(Si(n)||Array.isArray(n)){var i=Ur(t,n,[],e),r=n.map(function(h){return zi(h,e,t)});i.length=r.length;for(var s=0,a=r.length;s<a;s++)i[s]=r[s];return i}if(Io(n)||Object.getPrototypeOf(n)===Set.prototype)if(e.exportMapsAsObjects===!1){var l=Ur(t,n,new Set,e);return n.forEach(function(h){l.add(zi(h,e,t))}),l}else{var u=Ur(t,n,[],e);return n.forEach(function(h){u.push(zi(h,e,t))}),u}if(co(n)||Object.getPrototypeOf(n)===Map.prototype)if(e.exportMapsAsObjects===!1){var c=Ur(t,n,new Map,e);return n.forEach(function(h,g){c.set(g,zi(h,e,t))}),c}else{var f=Ur(t,n,{},e);return n.forEach(function(h,g){f[g]=zi(h,e,t)}),f}var p=Ur(t,n,{},e);return r_(n).forEach(function(h){p[h]=zi(n[h],e,t)}),p}function qo(n,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=sG),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),zi(n,e,t)}function aG(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=!1;typeof n[n.length-1]=="boolean"&&(t=n.pop());var o=lG(n);if(!o)return dn(!1);o.isTracing===mi.NONE&&""+o.name,o.isTracing=t?mi.BREAK:mi.LOG}function lG(n){switch(n.length){case 0:return yt.trackingDerivation;case 1:return nr(n[0]);case 2:return nr(n[0],n[1])}}function Wo(n,e){e===void 0&&(e=void 0),Jo();try{return n.apply(e)}finally{Zo()}}function al(n){return n[Mt]}function ll(n){return typeof n=="string"||typeof n=="number"||typeof n=="symbol"}var uG={has:function(n,e){if(e===Mt||e==="constructor"||e===ql)return!0;var t=al(n);return ll(e)?t.has(e):e in n},get:function(n,e){if(e===Mt||e==="constructor"||e===ql)return n[e];var t=al(n),o=t.values.get(e);if(o instanceof Is){var i=o.get();return i===void 0&&t.has(e),i}return ll(e)&&t.has(e),n[e]},set:function(n,e,t){return ll(e)?(Df(n,e,t),!0):!1},deleteProperty:function(n,e){if(!ll(e))return!1;var t=al(n);return t.remove(e),!0},ownKeys:function(n){var e=al(n);return e.keysAtom.reportObserved(),Reflect.ownKeys(n)},preventExtensions:function(n){return dn("Dynamic observable objects cannot be frozen"),!1}};function dG(n){var e=new Proxy(n,uG);return n[Mt].proxy=e,e}function yi(n){return n.interceptors!==void 0&&n.interceptors.length>0}function Ya(n,e){var t=n.interceptors||(n.interceptors=[]);return t.push(e),i_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function bi(n,e){var t=Fs();try{for(var o=Sf(n.interceptors||[]),i=0,r=o.length;i<r&&(e=o[i](e),Er(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{Qi(t)}}function Qo(n){return n.changeListeners!==void 0&&n.changeListeners.length>0}function Ka(n,e){var t=n.changeListeners||(n.changeListeners=[]);return t.push(e),i_(function(){var o=t.indexOf(e);o!==-1&&t.splice(o,1)})}function ei(n,e){var t=Fs(),o=n.changeListeners;if(o){o=o.slice();for(var i=0,r=o.length;i<r;i++)o[i](e);Qi(t)}}var cG=1e4,fG={get:function(n,e){return e===Mt?n[Mt]:e==="length"?n[Mt].getArrayLength():typeof e=="number"?Ni.get.call(n,e):typeof e=="string"&&!isNaN(e)?Ni.get.call(n,parseInt(e)):Ni.hasOwnProperty(e)?Ni[e]:n[e]},set:function(n,e,t){return e==="length"&&n[Mt].setArrayLength(t),typeof e=="number"&&Ni.set.call(n,e,t),typeof e=="symbol"||isNaN(e)?n[e]=t:Ni.set.call(n,parseInt(e),t),!0},preventExtensions:function(n){return dn("Observable arrays cannot be frozen"),!1}};function pG(n,e,t,o){t===void 0&&(t="ObservableArray@"+uo()),o===void 0&&(o=!1);var i=new N_(t,e,o);vq(i.values,Mt,i);var r=new Proxy(i.values,fG);if(i.proxy=r,n&&n.length){var s=Xu(!0);i.spliceWithArray(0,0,n),Wu(s)}return r}var N_=(function(){function n(e,t,o){this.owned=o,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new Is(e||"ObservableArray@"+uo()),this.enhancer=function(i,r){return t(i,r,e+"[..]")}}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},n.prototype.intercept=function(e){return Ya(this,e)},n.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),Ka(this,e)},n.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},n.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var o=new Array(e-t),i=0;i<e-t;i++)o[i]=void 0;this.spliceWithArray(t,0,o)}else this.spliceWithArray(e,t-e)},n.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},n.prototype.spliceWithArray=function(e,t,o){var i=this;vs(this.atom);var r=this.values.length;if(e===void 0?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),arguments.length===1?t=r-e:t==null?t=0:t=Math.max(0,Math.min(t,r-e)),o===void 0&&(o=Ul),yi(this)){var s=bi(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:o});if(!s)return Ul;t=s.removedCount,o=s.added}o=o.length===0?o:o.map(function(l){return i.enhancer(l,void 0)});var a=this.spliceItemsIntoValues(e,t,o);return(t!==0||o.length!==0)&&this.notifyArraySplice(e,o,a),this.dehanceValues(a)},n.prototype.spliceItemsIntoValues=function(e,t,o){var i;if(o.length<cG)return(i=this.values).splice.apply(i,Sf([e,t],o));var r=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(o,this.values.slice(e+t)),r},n.prototype.notifyArrayChildUpdate=function(e,t,o){var i=!this.owned&&To(),r=Qo(this),s=r||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:o}:null;this.atom.reportChanged(),r&&ei(this,s)},n.prototype.notifyArraySplice=function(e,t,o){var i=!this.owned&&To(),r=Qo(this),s=r||i?{object:this.proxy,type:"splice",index:e,removed:o,added:t,removedCount:o.length,addedCount:t.length}:null;this.atom.reportChanged(),r&&ei(this,s)},n})(),Ni={intercept:function(n){return this[Mt].intercept(n)},observe:function(n,e){e===void 0&&(e=!1);var t=this[Mt];return t.observe(n,e)},clear:function(){return this.splice(0)},replace:function(n){var e=this[Mt];return e.spliceWithArray(0,e.values.length,n)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(n,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var i=this[Mt];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(n);case 2:return i.spliceWithArray(n,e)}return i.spliceWithArray(n,e,t)},spliceWithArray:function(n,e,t){var o=this[Mt];return o.spliceWithArray(n,e,t)},push:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Mt];return t.spliceWithArray(t.values.length,0,n),t.values.length},pop:function(){return this.splice(Math.max(this[Mt].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this[Mt];return t.spliceWithArray(0,0,n),t.values.length},reverse:function(){var n=this.slice();return n.reverse.apply(n,arguments)},sort:function(n){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(n){var e=this[Mt],t=e.dehanceValues(e.values).indexOf(n);return t>-1?(this.splice(t,1),!0):!1},get:function(n){var e=this[Mt];if(e){if(n<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[n]);console.warn("[mobx.array] Attempt to read an array index ("+n+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(n,e){var t=this[Mt],o=t.values;if(n<o.length){vs(t.atom);var i=o[n];if(yi(t)){var r=bi(t,{type:"update",object:t.proxy,index:n,newValue:e});if(!r)return;e=r.newValue}e=t.enhancer(e,i);var s=e!==i;s&&(o[n]=e,t.notifyArrayChildUpdate(n,e,i))}else if(n===o.length)t.spliceWithArray(n,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+n+" is larger than "+o.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Ni[n]=function(){var e=this[Mt];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[n].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(n){typeof Array.prototype[n]=="function"&&(Ni[n]=function(e,t){var o=this,i=this[Mt];i.atom.reportObserved();var r=i.dehanceValues(i.values);return r[n](function(s,a){return e.call(t,s,a,o)},t)})});["reduce","reduceRight"].forEach(function(n){Ni[n]=function(){var e=this,t=this[Mt];t.atom.reportObserved();var o=arguments[0];return arguments[0]=function(i,r,s){return r=t.dehanceValue(r),o(i,r,s,e)},t.values[n].apply(t.values,arguments)}});var hG=ar("ObservableArrayAdministration",N_);function Si(n){return xf(n)&&hG(n[Mt])}var Yp,vG={},Af=(function(){function n(e,t,o){if(t===void 0&&(t=Wa),o===void 0&&(o="ObservableMap@"+uo()),this.enhancer=t,this.name=o,this[Yp]=vG,this._keysAtom=Cf(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return n.prototype._has=function(e){return this._data.has(e)},n.prototype.has=function(e){var t=this;if(!yt.trackingDerivation)return this._has(e);var o=this._hasMap.get(e);if(!o){var i=o=new Ar(this._has(e),qu,this.name+"."+Ki(e)+"?",!1);this._hasMap.set(e,i),C_(i,function(){return t._hasMap.delete(e)})}return o.get()},n.prototype.set=function(e,t){var o=this._has(e);if(yi(this)){var i=bi(this,{type:o?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return o?this._updateValue(e,t):this._addValue(e,t),this},n.prototype.delete=function(e){var t=this;if(vs(this._keysAtom),yi(this)){var o=bi(this,{type:"delete",object:this,name:e});if(!o)return!1}if(this._has(e)){var i=To(),r=Qo(this),o=r||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return Wo(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var a=t._data.get(e);a.setNewValue(void 0),t._data.delete(e)}),r&&ei(this,o),!0}return!1},n.prototype._updateHasMapEntry=function(e,t){var o=this._hasMap.get(e);o&&o.setNewValue(t)},n.prototype._updateValue=function(e,t){var o=this._data.get(e);if(t=o.prepareNewValue(t),t!==yt.UNCHANGED){var i=To(),r=Qo(this),s=r||i?{type:"update",object:this,oldValue:o.value,name:e,newValue:t}:null;o.setNewValue(t),r&&ei(this,s)}},n.prototype._addValue=function(e,t){var o=this;vs(this._keysAtom),Wo(function(){var a=new Ar(t,o.enhancer,o.name+"."+Ki(e),!1);o._data.set(e,a),t=a.value,o._updateHasMapEntry(e,!0),o._keysAtom.reportChanged()});var i=To(),r=Qo(this),s=r||i?{type:"add",object:this,name:e,newValue:t}:null;r&&ei(this,s)},n.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},n.prototype.values=function(){var e=this,t=this.keys();return Kl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:e.get(r)}}})},n.prototype.entries=function(){var e=this,t=this.keys();return Kl({next:function(){var o=t.next(),i=o.done,r=o.value;return{done:i,value:i?void 0:[r,e.get(r)]}}})},n.prototype[Yp=Mt,Symbol.iterator]=function(){return this.entries()},n.prototype.forEach=function(e,t){var o,i;try{for(var r=vi(this),s=r.next();!s.done;s=r.next()){var a=ts(s.value,2),l=a[0],u=a[1];e.call(t,u,l,this)}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},n.prototype.merge=function(e){var t=this;return co(e)&&(e=e.toJS()),Wo(function(){var o=Xu(!0);try{Rs(e)?r_(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var r=ts(i,2),s=r[0],a=r[1];return t.set(s,a)}):Ls(e)?(e.constructor!==Map&&dn("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,r){return t.set(r,i)})):e!=null&&dn("Cannot initialize map from "+e)}finally{Wu(o)}}),this},n.prototype.clear=function(){var e=this;Wo(function(){c_(function(){var t,o;try{for(var i=vi(e.keys()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.replace=function(e){var t=this;return Wo(function(){var o,i,r,s,a=hq(e),l=new Map,u=!1;try{for(var c=vi(t._data.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;if(!a.has(p)){var h=t.delete(p);if(h)u=!0;else{var g=t._data.get(p);l.set(p,g)}}}}catch(S){o={error:S}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}try{for(var m=vi(a.entries()),_=m.next();!_.done;_=m.next()){var v=ts(_.value,2),p=v[0],g=v[1],b=t._data.has(p);if(t.set(p,g),t._data.has(p)){var C=t._data.get(p);l.set(p,C),b||(u=!0)}}}catch(S){r={error:S}}finally{try{_&&!_.done&&(s=m.return)&&s.call(m)}finally{if(r)throw r.error}}if(!u)if(t._data.size!==l.size)t._keysAtom.reportChanged();else for(var M=t._data.keys(),O=l.keys(),k=M.next(),E=O.next();!k.done;){if(k.value!==E.value){t._keysAtom.reportChanged();break}k=M.next(),E=O.next()}t._data=l}),this},Object.defineProperty(n.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.toPOJO=function(){var e,t,o={};try{for(var i=vi(this),r=i.next();!r.done;r=i.next()){var s=ts(r.value,2),a=s[0],l=s[1];o[typeof a=="symbol"?a:Ki(a)]=l}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n.prototype.toJS=function(){return new Map(this)},n.prototype.toJSON=function(){return this.toPOJO()},n.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return Ki(t)+": "+(""+e.get(t))}).join(", ")+" }]"},n.prototype.observe=function(e,t){return Ka(this,e)},n.prototype.intercept=function(e){return Ya(this,e)},n})(),co=ar("ObservableMap",Af),Kp,gG={},M_=(function(){function n(e,t,o){if(t===void 0&&(t=Wa),o===void 0&&(o="ObservableSet@"+uo()),this.name=o,this[Kp]=gG,this._data=new Set,this._atom=Cf(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,r){return t(i,r,o)},e&&this.replace(e)}return n.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},n.prototype.clear=function(){var e=this;Wo(function(){c_(function(){var t,o;try{for(var i=vi(e._data.values()),r=i.next();!r.done;r=i.next()){var s=r.value;e.delete(s)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}})})},n.prototype.forEach=function(e,t){var o,i;try{for(var r=vi(this),s=r.next();!s.done;s=r.next()){var a=s.value;e.call(t,a,a,this)}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}},Object.defineProperty(n.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),n.prototype.add=function(e){var t=this;if(vs(this._atom),yi(this)){var o=bi(this,{type:"add",object:this,newValue:e});if(!o)return this}if(!this.has(e)){Wo(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=To(),r=Qo(this),o=r||i?{type:"add",object:this,newValue:e}:null;r&&ei(this,o)}return this},n.prototype.delete=function(e){var t=this;if(yi(this)){var o=bi(this,{type:"delete",object:this,oldValue:e});if(!o)return!1}if(this.has(e)){var i=To(),r=Qo(this),o=r||i?{type:"delete",object:this,oldValue:e}:null;return Wo(function(){t._atom.reportChanged(),t._data.delete(e)}),r&&ei(this,o),!0}return!1},n.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},n.prototype.entries=function(){var e=0,t=Array.from(this.keys()),o=Array.from(this.values());return Kl({next:function(){var i=e;return e+=1,i<o.length?{value:[t[i],o[i]],done:!1}:{done:!0}}})},n.prototype.keys=function(){return this.values()},n.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,o=Array.from(this._data.values());return Kl({next:function(){return t<o.length?{value:e.dehanceValue(o[t++]),done:!1}:{done:!0}}})},n.prototype.replace=function(e){var t=this;return Io(e)&&(e=e.toJS()),Wo(function(){var o=Xu(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):Xa(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&dn("Cannot initialize set from "+e)}finally{Wu(o)}}),this},n.prototype.observe=function(e,t){return Ka(this,e)},n.prototype.intercept=function(e){return Ya(this,e)},n.prototype.toJS=function(){return new Set(this)},n.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},n.prototype[Kp=Mt,Symbol.iterator]=function(){return this.values()},n})(),Io=ar("ObservableSet",M_),T_=(function(){function n(e,t,o,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=o,this.defaultEnhancer=i,this.keysAtom=new Is(o+".keys")}return n.prototype.read=function(e){return this.values.get(e).get()},n.prototype.write=function(e,t){var o=this.target,i=this.values.get(e);if(i instanceof gs){i.set(t);return}if(yi(this)){var r=bi(this,{type:"update",object:this.proxy||o,name:e,newValue:t});if(!r)return;t=r.newValue}if(t=i.prepareNewValue(t),t!==yt.UNCHANGED){var s=Qo(this),a=To(),r=s||a?{type:"update",object:this.proxy||o,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),s&&ei(this,r)}},n.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),o=t.get(e);if(o)return o.get();var i=!!this.values.get(e);return o=new Ar(i,qu,this.name+"."+Ki(e)+"?",!1),t.set(e,o),o.get()},n.prototype.addObservableProp=function(e,t,o){o===void 0&&(o=this.defaultEnhancer);var i=this.target;if(yi(this)){var r=bi(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!r)return;t=r.newValue}var s=new Ar(t,o,this.name+"."+Ki(e),!1);this.values.set(e,s),t=s.value,Object.defineProperty(i,e,_G(e)),this.notifyPropertyAddition(e,t)},n.prototype.addComputedProp=function(e,t,o){var i=this.target;o.name=o.name||this.name+"."+Ki(t),this.values.set(t,new gs(o)),(e===i||gq(e,t))&&Object.defineProperty(e,t,mG(t))},n.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(yi(this)){var o=bi(this,{object:this.proxy||t,name:e,type:"remove"});if(!o)return}try{Jo();var i=Qo(this),r=To(),s=this.values.get(e),a=s&&s.get();if(s&&s.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var l=this.pendingKeys.get(e);l&&l.set(!1)}delete this.target[e];var o=i||r?{type:"remove",object:this.proxy||t,oldValue:a,name:e}:null;i&&ei(this,o)}finally{Zo()}}},n.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},n.prototype.observe=function(e,t){return Ka(this,e)},n.prototype.intercept=function(e){return Ya(this,e)},n.prototype.notifyPropertyAddition=function(e,t){var o=Qo(this),i=To(),r=o||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(o&&ei(this,r),this.pendingKeys){var s=this.pendingKeys.get(e);s&&s.set(!0)}this.keysAtom.reportChanged()},n.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var o=[];try{for(var i=vi(this.values),r=i.next();!r.done;r=i.next()){var s=ts(r.value,2),a=s[0],l=s[1];l instanceof Ar&&o.push(a)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},n})();function Of(n,e,t){if(e===void 0&&(e=""),t===void 0&&(t=Wa),Object.prototype.hasOwnProperty.call(n,Mt))return n[Mt];Rs(n)||(e=(n.constructor.name||"ObservableObject")+"@"+uo()),e||(e="ObservableObject@"+uo());var o=new T_(n,new Map,Ki(e),t);return Bs(n,Mt,o),o}var Jp=Object.create(null),Zp=Object.create(null);function _G(n){return Jp[n]||(Jp[n]={configurable:!0,enumerable:!0,get:function(){return this[Mt].read(n)},set:function(e){this[Mt].write(n,e)}})}function Qp(n){var e=n[Mt];return e||(Tr(n),n[Mt])}function mG(n){return Zp[n]||(Zp[n]={configurable:yt.computedConfigurable,enumerable:!1,get:function(){return Qp(this).read(n)},set:function(e){Qp(this).write(n,e)}})}var yG=ar("ObservableObjectAdministration",T_);function ri(n){return xf(n)?(Tr(n),yG(n[Mt])):!1}function nr(n,e){if(typeof n=="object"&&n!==null){if(Si(n))return e!==void 0&&dn(!1),n[Mt].atom;if(Io(n))return n[Mt];if(co(n)){var t=n;if(e===void 0)return t._keysAtom;var o=t._data.get(e)||t._hasMap.get(e);return o||dn(!1),o}if(Tr(n),e&&!n[Mt]&&n[e],ri(n)){if(!e)return dn(!1);var o=n[Mt].values.get(e);return o||dn(!1),o}if(wf(n)||_s(n)||Yl(n))return n}else if(typeof n=="function"&&Yl(n[Mt]))return n[Mt];return dn(!1)}function Yu(n,e){if(n||dn("Expecting some object"),e!==void 0)return Yu(nr(n,e));if(wf(n)||_s(n)||Yl(n)||co(n)||Io(n))return n;if(Tr(n),n[Mt])return n[Mt];dn(!1)}function bG(n,e){var t;return e!==void 0?t=nr(n,e):ri(n)||co(n)||Io(n)?t=Yu(n):t=nr(n),t.name}var eh=Object.prototype.toString;function $_(n,e,t){return t===void 0&&(t=-1),ac(n,e,t)}function ac(n,e,t,o,i){if(n===e)return n!==0||1/n===1/e;if(n==null||e==null)return!1;if(n!==n)return e!==e;var r=typeof n;if(r!=="function"&&r!=="object"&&typeof e!="object")return!1;var s=eh.call(n);if(s!==eh.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+n==""+e;case"[object Number]":return+n!=+n?+e!=+e:+n==0?1/+n===1/e:+n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(n)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}n=th(n),e=th(e);var a=s==="[object Array]";if(!a){if(typeof n!="object"||typeof e!="object")return!1;var l=n.constructor,u=e.constructor;if(l!==u&&!(typeof l=="function"&&l instanceof l&&typeof u=="function"&&u instanceof u)&&"constructor"in n&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),o=o||[],i=i||[];for(var c=o.length;c--;)if(o[c]===n)return i[c]===e;if(o.push(n),i.push(e),a){if(c=n.length,c!==e.length)return!1;for(;c--;)if(!ac(n[c],e[c],t-1,o,i))return!1}else{var f=Object.keys(n),p=void 0;if(c=f.length,Object.keys(e).length!==c)return!1;for(;c--;)if(p=f[c],!(xG(e,p)&&ac(n[p],e[p],t-1,o,i)))return!1}return o.pop(),i.pop(),!0}function th(n){return Si(n)?n.slice():Ls(n)||co(n)||Xa(n)||Io(n)?Array.from(n.entries()):n}function xG(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Kl(n){return n[Symbol.iterator]=wG,n}function wG(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:zq,extras:{getDebugName:bG},$mobx:Mt});function CG(n){return!(n.prototype&&n.prototype.render)&&!Yt.isPrototypeOf(n)}function P_(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,o=t===void 0?"":t,i=e.suffix,r=i===void 0?"":i,s=n.displayName||n.name||n.constructor&&n.constructor.name||"<component>";return o+s+r}var nh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},R_=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},B_=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),L_=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},I_=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},oh=console;function SG(n){var e=ic().allowStateChanges;return ic().allowStateChanges=n,e}function kG(n){ic().allowStateChanges=n}function EG(n,e,t,o,i){var r=SG(n),s=void 0;try{s=e(t,o,i)}finally{kG(r)}return s}function ih(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=n[e],i=F_[e],r=o?t===!0?function(){i.apply(this,arguments),o.apply(this,arguments)}:function(){o.apply(this,arguments),i.apply(this,arguments)}:i;n[e]=r}function rh(n,e){if(n==null||e==null||(typeof n>"u"?"undefined":nh(n))!=="object"||(typeof e>"u"?"undefined":nh(e))!=="object")return n!==e;var t=Object.keys(n);if(t.length!==Object.keys(e).length)return!0;for(var o=void 0,i=t.length-1;o=t[i];i--)if(e[o]!==n[o])return!0;return!1}var F_={componentWillMount:function(){var e=this,t=P_(this),o=!1,i=!1;function r(f){var p=this[f],h=Cf("reactive "+f);Object.defineProperty(this,f,{configurable:!0,enumerable:!0,get:function(){return h.reportObserved(),p},set:function(m){!i&&rh(p,m)?(p=m,o=!0,h.reportChanged(),o=!1):p=m}})}r.call(this,"props"),r.call(this,"state");var s=this.render.bind(this),a=null,l=!1,u=function(){return a=new Ca(t+".render()",function(){if(!l&&(l=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var p=!0;try{i=!0,o||Yt.prototype.forceUpdate.call(e),p=!1}finally{i=!1,p&&a.dispose()}}}),a.reactComponent=e,c.$mobx=a,e.render=c,c(e.props,e.state,e.context)},c=function(p,h,g){l=!1;var m=void 0,_=void 0;if(a.track(function(){try{_=EG(!1,s,p,h,g)}catch(v){m=v}}),m)throw m;return _};this.render=u},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:rh(this.props,e)}};function Nf(n){if(arguments.length>1&&oh.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),n.isMobxInjector===!0&&oh.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),CG(n)){var e,t;return Nf((t=e=(function(i){L_(r,i);function r(){return R_(this,r),I_(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return B_(r,[{key:"render",value:function(){return n.call(this,this.props,this.context)}}]),r})(Yt),e.displayName=P_(n),t))}if(!n)throw new Error("Please pass a valid component to 'observer'");var o=n.prototype||n;return DG(o),n.isMobXReactObserver=!0,n}function DG(n){ih(n,"componentWillMount",!0),ih(n,"componentDidMount"),n.shouldComponentUpdate||(n.shouldComponentUpdate=F_.shouldComponentUpdate)}var AG=Nf(function(n){var e=n.children;return e[0]()});AG.displayName="Observer";var OG=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function NG(n,e){return e={exports:{}},n(e,e.exports),e.exports}NG(function(n,e){(function(t,o){n.exports=o()})(OG,(function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,r=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,u=l&&l(Object);return function c(f,p,h){if(typeof p!="string"){if(u){var g=l(p);g&&g!==u&&c(f,g,h)}var m=r(p);s&&(m=m.concat(s(p)));for(var _=0;_<m.length;++_){var v=m[_];if(!t[v]&&!o[v]&&(!h||!h[v])){var b=a(p,v);try{i(f,v,b)}catch{}}}return f}return f}}))});var sh={children:!0,key:!0,ref:!0},ah=console;(function(n){L_(e,n);function e(){return R_(this,e),I_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return B_(e,[{key:"render",value:function(o){var i=o.children;return i.length>1?Ze("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var o={},i=this.context.mobxStores;if(i)for(var r in i)o[r]=i[r];for(var s in this.props)!sh[s]&&s!=="suppressChangedStoreWarning"&&(o[s]=this.props[s]);return{mobxStores:o}}},{key:"componentWillReceiveProps",value:function(o){if(Object.keys(o).length!==Object.keys(this.props).length&&ah.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!o.suppressChangedStoreWarning)for(var i in o)!sh[i]&&this.props[i]!==o[i]&&ah.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Yt);if(!Yt)throw new Error("mobx-preact requires Preact to be available");var pi,gd,lh,j_=[],Gn=Gt,uh=Gn.__b,dh=Gn.__r,ch=Gn.diffed,fh=Gn.__c,ph=Gn.unmount,hh=Gn.__;function MG(){for(var n;n=j_.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Tl),n.__H.__h.forEach(lc),n.__H.__h=[]}catch(e){n.__H.__h=[],Gn.__e(e,n.__v)}}Gn.__b=function(n){pi=null,uh&&uh(n)},Gn.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),hh&&hh(n,e)},Gn.__r=function(n){dh&&dh(n);var e=(pi=n.__c).__H;e&&(gd===pi?(e.__h=[],pi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(Tl),e.__h.forEach(lc),e.__h=[])),gd=pi},Gn.diffed=function(n){ch&&ch(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(j_.push(e)!==1&&lh===Gn.requestAnimationFrame||((lh=Gn.requestAnimationFrame)||TG)(MG)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),gd=pi=null},Gn.__c=function(n,e){e.some(function(t){try{t.__h.forEach(Tl),t.__h=t.__h.filter(function(o){return!o.__||lc(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Gn.__e(o,t.__v)}}),fh&&fh(n,e)},Gn.unmount=function(n){ph&&ph(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(o){try{Tl(o)}catch(i){e=i}}),t.__H=void 0,e&&Gn.__e(e,t.__v))};var vh=typeof requestAnimationFrame=="function";function TG(n){var e,t=function(){clearTimeout(o),vh&&cancelAnimationFrame(e),setTimeout(n)},o=setTimeout(t,35);vh&&(e=requestAnimationFrame(t))}function Tl(n){var e=pi,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),pi=e}function lc(n){var e=pi;n.__c=n.__(),pi=e}function $G(n,e){for(var t in e)n[t]=e[t];return n}function gh(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var o in e)if(o!=="__source"&&n[o]!==e[o])return!0;return!1}function _h(n,e){this.props=n,this.context=e}(_h.prototype=new Yt).isPureReactComponent=!0,_h.prototype.shouldComponentUpdate=function(n,e){return gh(this.props,n)||gh(this.state,e)};var mh=Gt.__b;Gt.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),mh&&mh(n)};var PG=Gt.__e;Gt.__e=function(n,e,t,o){if(n.then){for(var i,r=e;r=r.__;)if((i=r.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(n,e)}PG(n,e,t,o)};var yh=Gt.unmount;function V_(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(o){typeof o.__c=="function"&&o.__c()}),n.__c.__H=null),(n=$G({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c.__e=!0,n.__c=null),n.__k=n.__k&&n.__k.map(function(o){return V_(o,e,t)})),n}function H_(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(o){return H_(o,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function _d(){this.__u=0,this.o=null,this.__b=null}function U_(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function ul(){this.i=null,this.l=null}Gt.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),yh&&yh(n)},(_d.prototype=new Yt).__c=function(n,e){var t=e.__c,o=this;o.o==null&&(o.o=[]),o.o.push(t);var i=U_(o.__v),r=!1,s=function(){r||(r=!0,t.__R=null,i?i(a):a())};t.__R=s;var a=function(){if(!--o.__u){if(o.state.__a){var l=o.state.__a;o.__v.__k[0]=H_(l,l.__c.__P,l.__c.__O)}var u;for(o.setState({__a:o.__b=null});u=o.o.pop();)u.forceUpdate()}};o.__u++||32&e.__u||o.setState({__a:o.__b=o.__v.__k[0]}),n.then(s,s)},_d.prototype.componentWillUnmount=function(){this.o=[]},_d.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),o=this.__v.__k[0].__c;this.__v.__k[0]=V_(this.__b,t,o.__O=o.__P)}this.__b=null}var i=e.__a&&Ze(fs,null,n.fallback);return i&&(i.__u&=-33),[Ze(fs,null,e.__a?null:n.children),i]};var bh=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(ul.prototype=new Yt).__a=function(n){var e=this,t=U_(e.__v),o=e.l.get(n);return o[0]++,function(i){var r=function(){e.props.revealOrder?(o.push(i),bh(e,n,o)):i()};t?t(r):r()}},ul.prototype.render=function(n){this.i=null,this.l=new Map;var e=Hl(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},ul.prototype.componentDidUpdate=ul.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){bh(n,t,e)})};var RG=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,BG=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,LG=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,IG=/[A-Z0-9]/g,FG=typeof document<"u",jG=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};function xh(n,e,t){return e.__k==null&&(e.textContent=""),cq(n,e),typeof t=="function"&&t(),n?n.__c:null}Yt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Yt.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var wh=Gt.event;function VG(){}function HG(){return this.cancelBubble}function UG(){return this.defaultPrevented}Gt.event=function(n){return wh&&(n=wh(n)),n.persist=VG,n.isPropagationStopped=HG,n.isDefaultPrevented=UG,n.nativeEvent=n};var zG={enumerable:!1,configurable:!0,get:function(){return this.class}},Ch=Gt.vnode;Gt.vnode=function(n){typeof n.type=="string"&&(function(e){var t=e.props,o=e.type,i={},r=o.indexOf("-")===-1;for(var s in t){var a=t[s];if(!(s==="value"&&"defaultValue"in t&&a==null||FG&&s==="children"&&o==="noscript"||s==="class"||s==="className")){var l=s.toLowerCase();s==="defaultValue"&&"value"in t&&t.value==null?s="value":s==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?s="ondblclick":l!=="onchange"||o!=="input"&&o!=="textarea"||jG(t.type)?l==="onfocus"?s="onfocusin":l==="onblur"?s="onfocusout":LG.test(s)&&(s=l):l=s="oninput":r&&BG.test(s)?s=s.replace(IG,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[s=l]&&(s="oninputCapture"),i[s]=a}}o=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=Hl(t.children).forEach(function(u){u.props.selected=i.value.indexOf(u.props.value)!=-1})),o=="select"&&i.defaultValue!=null&&(i.value=Hl(t.children).forEach(function(u){u.props.selected=i.multiple?i.defaultValue.indexOf(u.props.value)!=-1:i.defaultValue==u.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",zG)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i})(n),n.$$typeof=RG,Ch&&Ch(n)};var Sh=Gt.__r;Gt.__r=function(n){Sh&&Sh(n),n.__c};var kh=Gt.diffed;Gt.diffed=function(n){kh&&kh(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var qG=0;function Re(n,e,t,o,i,r){e||(e={});var s,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?s=e[a]:l[a]=e[a];var u={type:n,props:l,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--qG,__i:-1,__u:0,__source:i,__self:r};if(typeof n=="function"&&(s=n.defaultProps))for(a in s)l[a]===void 0&&(l[a]=s[a]);return Gt.vnode&&Gt.vnode(u),u}var GG=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Sa;(function(n){function e(t){var o=GG(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return an({},n.defaults,o)}n.get=e})(Sa||(Sa={}));(function(n){n.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Sa||(Sa={}));var Eh={node:!1,edge:!1},XG={node:!0,edge:!0},WG=function(n){return!n||typeof n=="boolean"?n===!0?Dt(XG):Dt(Eh):ls(Dt(Eh),n)},YG=function(){return za(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function Jn(n){try{return JSON.parse(JSON.stringify(n))}catch{return n}}var dl=200,KG=9999,JG=10,en;(function(n){n[n.DEFAULT=1]="DEFAULT",n[n.TEXT_EDIT=2]="TEXT_EDIT",n[n.SHOW_MENU=3]="SHOW_MENU",n[n.ALLOW_CONNECT=4]="ALLOW_CONNECT",n[n.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(en||(en={}));var Sn;(function(n){n.NODE="node",n.EDGE="edge",n.GRAPH="graph"})(Sn||(Sn={}));var zt;(function(n){n.NODE="node",n.CIRCLE_NODE="circle-node",n.POLYGON_NODE="polygon-node",n.RECT_NODE="rect-node",n.TEXT_NODE="text-node",n.ELLIPSE_NODE="ellipse-node",n.DIAMOND_NODE="diamond-node",n.HTML_NODE="html-node",n.CUSTOM_HTML_NODE="custom-html-node",n.EDGE="edge",n.LINE_EDGE="line-edge",n.POLYLINE_EDGE="polyline-edge",n.BEZIER_EDGE="bezier-edge",n.GRAPH="graph"})(zt||(zt={}));var pt;(function(n){n.ELEMENT_CLICK="element:click",n.NODE_ADD="node:add",n.NODE_DELETE="node:delete",n.NODE_CLICK="node:click",n.NODE_DBCLICK="node:dbclick",n.NODE_GROUP_COPY="node:group-copy-add",n.NODE_DND_ADD="node:dnd-add",n.NODE_DND_DRAG="node:dnd-drag",n.NODE_MOUSEDOWN="node:mousedown",n.NODE_DRAGSTART="node:dragstart",n.NODE_DRAG="node:drag",n.NODE_DROP="node:drop",n.NODE_MOUSEUP="node:mouseup",n.NODE_MOUSEMOVE="node:mousemove",n.NODE_MOUSEENTER="node:mouseenter",n.NODE_MOUSELEAVE="node:mouseleave",n.NODE_CONTEXTMENU="node:contextmenu",n.NODE_ROTATE="node:rotate",n.NODE_RESIZE="node:resize",n.NODE_FOCUS="node:focus",n.NODE_BLUR="node:blur",n.NODE_PROPERTIES_CHANGE="node:properties-change",n.NODE_PROPERTIES_DELETE="node:properties-delete",n.EDGE_ADD="edge:add",n.EDGE_DELETE="edge:delete",n.EDGE_CLICK="edge:click",n.EDGE_DBCLICK="edge:dbclick",n.EDGE_FOCUS="edge:focus",n.EDGE_BLUR="edge:blur",n.EDGE_MOUSEENTER="edge:mouseenter",n.EDGE_MOUSELEAVE="edge:mouseleave",n.EDGE_CONTEXTMENU="edge:contextmenu",n.EDGE_ADJUST="edge:adjust",n.EDGE_EXCHANGE_NODE="edge:exchange-node",n.ANCHOR_CLICK="anchor:click",n.ANCHOR_MOUSEDOWN="anchor:mousedown",n.ANCHOR_DRAGSTART="anchor:dragstart",n.ANCHOR_DRAG="anchor:drag",n.ANCHOR_DROP="anchor:drop",n.ANCHOR_DRAGEND="anchor:dragend",n.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",n.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",n.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",n.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",n.ADJUST_POINT_DRAG="adjustPoint:drag",n.ADJUST_POINT_DROP="adjustPoint:drop",n.ADJUST_POINT_DRAGEND="adjustPoint:dragend",n.BLANK_MOUSEDOWN="blank:mousedown",n.BLANK_DRAGSTART="blank:dragstart",n.BLANK_DRAG="blank:drag",n.BLANK_DROP="blank:drop",n.BLANK_MOUSEMOVE="blank:mousemove",n.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",n.BLANK_MOUSEUP="blank:mouseup",n.BLANK_CLICK="blank:click",n.BLANK_CONTEXTMENU="blank:contextmenu",n.SELECTION_MOUSEDOWN="selection:mousedown",n.SELECTION_DRAGSTART="selection:dragstart",n.SELECTION_DRAG="selection:drag",n.SELECTION_DROP="selection:drop",n.SELECTION_MOUSEMOVE="selection:mousemove",n.SELECTION_MOUSEUP="selection:mouseup",n.SELECTION_CONTEXTMENU="selection:contextmenu",n.CONNECTION_NOT_ALLOWED="connection:not-allowed",n.TEXT_MOUSEDOWN="text:mousedown",n.TEXT_DRAGSTART="text:dragstart",n.TEXT_DRAG="text:drag",n.TEXT_DROP="text:drop",n.TEXT_CLICK="text:click",n.TEXT_DBCLICK="text:dbclick",n.TEXT_BLUR="text:blur",n.TEXT_MOUSEMOVE="text:mousemove",n.TEXT_MOUSEUP="text:mouseup",n.TEXT_FOCUS="text:focus",n.TEXT_ADD="text:add",n.TEXT_UPDATE="text:update",n.TEXT_CLEAR="text:clear",n.LABEL_MOUSEDOWN="label:mousedown",n.LABEL_DRAGSTART="label:dragstart",n.LABEL_DRAG="label:drag",n.LABEL_DROP="label:drop",n.LABEL_CLICK="label:click",n.LABEL_DBCLICK="label:dbclick",n.LABEL_BLUR="label:blur",n.LABEL_MOUSEMOVE="label:mousemove",n.LABEL_MOUSEUP="label:mouseup",n.LABEL_FOCUS="label:focus",n.LABEL_ADD="label:add",n.LABEL_UPDATE="label:update",n.LABEL_CLEAR="label:clear",n.LABEL_DELETE="label:delete",n.LABEL_SHOULD_ADD="label:should-add",n.LABEL_BATCH_ADD="label:batch-add",n.LABEL_SHOULD_UPDATE="label:should-update",n.LABEL_SHOULD_DELETE="label:should-delete",n.LABEL_BATCH_DELETE="label:batch-delete",n.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",n.HISTORY_CHANGE="history:change",n.GRAPH_TRANSFORM="graph:transform",n.GRAPH_RENDERED="graph:rendered",n.GRAPH_UPDATED="graph:updated",n.EDIT_CONFIG_CHANGED="editConfig:changed"})(pt||(pt={}));var Ln;(function(n){n[n.STATIC=-1]="STATIC",n[n.DEFAULT=0]="DEFAULT",n[n.INCREASE=1]="INCREASE",n[n.EDGE_TOP=2]="EDGE_TOP"})(Ln||(Ln={}));var xn;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(xn||(xn={}));var $o;(function(n){n.TEXT="text",n.LABEL="label"})($o||($o={}));var ZG=0,Fo=(function(){function n(e){var t=e.onDragStart,o=t===void 0?rd:t,i=e.onDragging,r=i===void 0?rd:i,s=e.onDragEnd,a=s===void 0?rd:s,l=e.eventType,u=l===void 0?"":l,c=e.eventCenter,f=e.step,p=f===void 0?1:f,h=e.isStopPropagation,g=h===void 0?!0:h,m=e.model,_=e.data,v=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(b){var C,M,O=window==null?void 0:window.document;if(b.button===ZG){v.isStopPropagation&&b.stopPropagation(),b.preventDefault(),v.isStartDragging=!0,v.startX=b.clientX,v.startY=b.clientY,O.addEventListener("pointermove",v.handleMouseMove,!1),O.addEventListener("pointerup",v.handleMouseUp,!1);var k=(C=v.model)===null||C===void 0?void 0:C.getData();(M=v.eventCenter)===null||M===void 0||M.emit(pt["".concat(v.eventType,"_MOUSEDOWN")],{e:b,data:v.data||k}),v.startTime=new Date().getTime()}},this.handleMouseMove=function(b){var C,M;if(v.isStopPropagation&&b.stopPropagation(),b.preventDefault(),!!v.isStartDragging&&(v.sumDeltaX+=b.clientX-v.startX,v.sumDeltaY+=b.clientY-v.startY,v.startX=b.clientX,v.startY=b.clientY,v.step<=1||Math.abs(v.sumDeltaX)>v.step||Math.abs(v.sumDeltaY)>v.step)){var O=v.sumDeltaX%v.step,k=v.sumDeltaY%v.step,E=v.sumDeltaX-O,S=v.sumDeltaY-k;v.sumDeltaX=O,v.sumDeltaY=k;var N=(C=v.model)===null||C===void 0?void 0:C.getData();v.isDragging||((M=v.eventCenter)===null||M===void 0||M.emit(pt["".concat(v.eventType,"_DRAGSTART")],{e:b,data:v.data||N}),v.onDragStart({event:b})),v.isDragging=!0,Promise.resolve().then(function(){var L,$;v.onDragging({deltaX:E,deltaY:S,event:b}),(L=v.eventCenter)===null||L===void 0||L.emit(pt["".concat(v.eventType,"_MOUSEMOVE")],{deltaX:E,deltaY:S,e:b,data:v.data||N}),($=v.eventCenter)===null||$===void 0||$.emit(pt["".concat(v.eventType,"_DRAG")],{e:b,data:v.data||N})})}},this.handleMouseUp=function(b){var C=window.document;v.isStartDragging=!1,v.isStopPropagation&&b.stopPropagation();var M=b.target;M&&typeof M.releasePointerCapture=="function"&&M.releasePointerCapture(b.pointerId),Promise.resolve().then(function(){var O,k,E;C.removeEventListener("pointermove",v.handleMouseMove,!1),C.removeEventListener("pointerup",v.handleMouseUp,!1);var S=(O=v.model)===null||O===void 0?void 0:O.getData();(k=v.eventCenter)===null||k===void 0||k.emit(pt["".concat(v.eventType,"_MOUSEUP")],{e:b,data:v.data||S}),v.isDragging&&(v.isDragging=!1,v.onDragEnd({event:b}),(E=v.eventCenter)===null||E===void 0||E.emit(pt["".concat(v.eventType,"_DROP")],{e:b,data:v.data||S}))})},this.cancelDrag=function(){var b=window==null?void 0:window.document;b.removeEventListener("pointermove",v.handleMouseMove,!1),b.removeEventListener("pointerup",v.handleMouseUp,!1),v.onDragEnd({event:void 0}),v.isDragging=!1},this.destroy=function(){v.isStartDragging&&v.cancelDrag()},this.onDragStart=o,this.onDragging=r,this.onDragEnd=a,this.step=p,this.isStopPropagation=g,this.eventType=u,this.eventCenter=c,this.model=m,this.data=_}return n.prototype.setStep=function(e){this.step=e},n.prototype.setModel=function(e){this.model=e},n})(),QG=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{x:e-o/2,y:t-i/2,x1:e+o/2,y1:t+i/2}},eX=function(n){var e=n.startPoint,t=n.endPoint,o=(e.x+t.x)/2,i=(e.y+t.y)/2,r=Math.abs(e.x-t.x)+10,s=Math.abs(e.y-t.y)+10;return{x:o-r/2,y:i-s/2,x1:o+r/2,y1:i+s/2}},tX=function(n){var e=n.points,t=$r(e),o=Da(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},nX=function(n){var e=n.path,t=Mf(e),o=Da(t,8),i=o.x,r=o.y,s=o.width,a=o.height;return{x:i-s/2,y:r-a/2,x1:i+s/2,y1:r+a/2}},oX=function(n){if(n.modelType===zt.LINE_EDGE)return eX(n);if(n.modelType===zt.POLYLINE_EDGE)return tX(n);if(n.modelType===zt.BEZIER_EDGE)return nX(n)},iX=function(n,e,t,o){var i=(e.y-n.y)*(o.x-t.x)-(n.x-e.x)*(t.y-o.y);if(i===0)return!1;var r=((e.x-n.x)*(o.x-t.x)*(t.y-n.y)+(e.y-n.y)*(o.x-t.x)*n.x-(o.y-t.y)*(e.x-n.x)*t.x)/i,s=-((e.y-n.y)*(o.y-t.y)*(t.x-n.x)+(e.x-n.x)*(o.y-t.y)*n.y-(o.x-t.x)*(e.y-n.y)*t.y)/i;return(r-n.x)*(r-e.x)<=0&&(s-n.y)*(s-e.y)<=0&&(r-t.x)*(r-o.x)<=0&&(s-t.y)*(s-o.y)<=0?{x:r,y:s}:!1},ka=function(n,e,t){var o=n.x,i=n.y,r=e.x,s=e.y,a=t.x,l=t.y,u=(l-s)/(a-r),c=s-u*r;return(o>=r&&o<=a||o<=r&&o>=a)&&(i>=s&&i<=l||i<=s&&i>=l)&&Math.abs(i-u*o-c)<Number.EPSILON},Ea=function(n){var e=n.start,t=n.end,o=n.offset,i=n.verticalLength,r=n.type,s={leftX:0,leftY:0,rightX:0,rightY:0},a=Math.atan((t.y-e.y)/(t.x-e.x)),l=Math.atan(o/i),u=Math.sqrt(i*i+o*o);return r==="start"?t.x>=e.x?(s.leftX=e.x+u*Math.sin(a+l),s.leftY=e.y-u*Math.cos(a+l),s.rightX=e.x-u*Math.sin(a-l),s.rightY=e.y+u*Math.cos(a-l)):(s.leftX=e.x-u*Math.sin(a+l),s.leftY=e.y+u*Math.cos(a+l),s.rightX=e.x+u*Math.sin(a-l),s.rightY=e.y-u*Math.cos(a-l)):r==="end"&&(t.x>=e.x?(s.leftX=t.x+u*Math.sin(a-l),s.leftY=t.y-u*Math.cos(a-l),s.rightX=t.x-u*Math.sin(a+l),s.rightY=t.y+u*Math.cos(a+l)):(s.leftX=t.x-u*Math.sin(a-l),s.leftY=t.y+u*Math.cos(a-l),s.rightX=t.x+u*Math.sin(a+l),s.rightY=t.y-u*Math.cos(a+l))),s},ns=function(){return ns=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ns.apply(this,arguments)},Do=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ji=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},rX=function(n,e){return Math.abs(n.centerX-e.centerX)*2<n.width+e.width&&Math.abs(n.centerY-e.centerY)*2<n.height+e.height},uc=function(n){var e=[],t={};return n.forEach(function(o){var i="".concat(o.x,"-").concat(o.y);o.id=i,t[i]=o}),Object.keys(t).forEach(function(o){e.push(t[o])}),e},Jl=function(n,e){return n.width===0&&n.height===0?n:{x:n.x,y:n.y,centerX:n.centerX,centerY:n.centerY,minX:n.minX-e,minY:n.minY-e,maxX:n.maxX+e,maxY:n.maxY+e,height:n.height+2*e,width:n.width+2*e}},sX=function(n,e){var t=Math.abs(n.x-e.centerX),o=Math.abs(n.y-e.centerY);return t/e.width>o/e.height?xn.HORIZONTAL:xn.VERTICAL},Zl=function(n,e,t){var o=sX(t,e);return o===xn.HORIZONTAL?{x:t.x>n.centerX?n.maxX:n.minX,y:t.y}:{x:t.x,y:t.y>n.centerY?n.maxY:n.minY}},Dh=function(n,e){var t=Math.min(n.minX,e.minX),o=Math.min(n.minY,e.minY),i=Math.max(n.maxX,e.maxX),r=Math.max(n.maxY,e.maxY);return{x:(t+i)/2,y:(o+r)/2,centerX:(t+i)/2,centerY:(o+r)/2,minX:t,minY:o,maxX:i,maxY:r,height:r-o,width:i-t}},Da=function(n,e){n===void 0&&(n=[]);var t=[],o=[];n.forEach(function(c){t.push(c.x),o.push(c.y)});var i=Math.min.apply(Math,Ji([],Do(t),!1)),r=Math.max.apply(Math,Ji([],Do(t),!1)),s=Math.min.apply(Math,Ji([],Do(o),!1)),a=Math.max.apply(Math,Ji([],Do(o),!1)),l=r-i,u=a-s;return e&&(l+=e,u+=e),{centerX:(i+r)/2,centerY:(s+a)/2,maxX:r,maxY:a,minX:i,minY:s,x:(i+r)/2,y:(s+a)/2,height:u,width:l}},Ql=function(n){var e=n.minX,t=n.minY,o=n.maxX,i=n.maxY;return[{x:e,y:t},{x:o,y:t},{x:o,y:i},{x:e,y:i}]},cl=function(n,e){var t=n.x,o=n.y;return t<e.minX||t>e.maxX||o<e.minY||o>e.maxY},aX=function(n,e){return e<n.minX||e>n.maxX?[]:[{x:e,y:n.minY},{x:e,y:n.maxY}]},lX=function(n,e){return e<n.minY||e>n.maxY?[]:[{x:n.minX,y:e},{x:n.maxX,y:e}]},uX=function(n,e){return Ji(Ji([],Do(aX(n,e.x)),!1),Do(lX(n,e.y)),!1)},dc=function(n,e){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},dX=function(n,e){var t=-2,o=0;return e.forEach(function(i){i&&(n.x===i.x&&(o+=t),n.y===i.y&&(o+=t))}),o},Ah=function(n,e,t,o,i){return dc(n,e)+dc(n,t)+dX(n,[e,t,o,i])},z_=function(n,e,t,o,i){i||(i=0),n.unshift(e[o]),t[o]&&t[o]!==o&&i<=100&&z_(n,e,t,t[o],i+1)},cX=function(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)},Qs=function(n,e,t,o){var i=e.x-n.x,r=e.y-n.y,s=o.x-t.x,a=o.y-t.y,l=(-r*(n.x-t.x)+i*(n.y-t.y))/(-s*r+i*a),u=(s*(n.y-t.y)-a*(n.x-t.x))/(-s*r+i*a);return l>=0&&l<=1&&u>=0&&u<=1},Oh=function(n,e,t){if(t.width===0&&t.height===0)return!1;var o=Do(Ql(t),4),i=o[0],r=o[1],s=o[2],a=o[3];return Qs(n,e,i,r)||Qs(n,e,i,a)||Qs(n,e,r,s)||Qs(n,e,s,a)},fX=function(n,e,t,o){var i=[];return n.forEach(function(r){r!==e&&(r.x===e.x||r.y===e.y)&&!Oh(r,e,t)&&!Oh(r,e,o)&&i.push(r)}),uc(i)},pX=function(n,e,t,o,i,r,s){var a=[],l=[e],u={},c={},f={};e.id&&(c[e.id]=0,f[e.id]=Ah(e,t,e));var p={};n.forEach(function(m){m.id&&(p[m.id]=m)});for(var h=function(){var m,_=1/0;if(l.forEach(function(b){b.id&&f[b.id]<_&&(_=f[b.id],m=b)}),m===t&&t.id){var v=[];return z_(v,p,u,t.id),{value:v}}if(!m)return{value:[e,t]};cX(l,m),a.push(m),fX(n,m,o,i).forEach(function(b){if(a.indexOf(b)===-1&&(l.indexOf(b)===-1&&l.push(b),m!=null&&m.id&&(b!=null&&b.id))){var C=f[m.id]+dc(m,b);if(c[b.id]&&C>=c[b.id])return;u[b.id]=m.id,c[b.id]=C,f[b.id]=c[b.id]+Ah(b,t,e,r,s)}})};l.length;){var g=h();if(typeof g=="object")return g.value}return[e,t]},Nh=function(n){return vo(n)},q_=function(n){for(var e=1;e<n.length-1;){var t=n[e-1],o=n[e],i=n[e+1];t.x===o.x&&o.x===i.x||t.y===o.y&&o.y===i.y?n.splice(e,1):e++}return n},Mh=function(n,e,t,o,i){var r=Nh(t),s=Nh(o),a=Jl(r,i),l=Jl(s,i),u=Zl(a,r,n),c=Zl(l,s,e);if(rX(a,l)){var f=vX(n,e,u,c);return Ji(Ji([n,u],Do(f),!1),[c,e],!1)}var p=Da([u,c]),h=Dh(a,p),g=Dh(l,p),m=[];m=m.concat(Ql(h)),m=m.concat(Ql(g));var _={x:(n.x+e.x)/2,y:(n.y+e.y)/2};[p,h,g].forEach(function(b){m=m.concat(uX(b,_).filter(function(C){return cl(C,a)&&cl(C,l)}))}),[{x:u.x,y:c.y},{x:c.x,y:u.y}].forEach(function(b){cl(b,a)&&cl(b,l)&&m.push(b)}),m.unshift(u),m.push(c),m=uc(m);var v=pX(m,u,c,r,s,n,e);return v.unshift(n),v.push(e),v.length>2&&(v=q_(v)),uc(v)},hX=function(n){if(n.length===1){var e=Do(n,1),t=e[0];return[t,t]}else{for(var o=n[0],i=n[1],r=Yo(o.x,o.y,i.x,i.y),s=1;s<n.length-1;s++){var a=n[s],l=n[s+1],u=Yo(a.x,a.y,l.x,l.y);u>r&&(r=u,o=a,i=l)}return[o,i]}},Th=function(n,e,t){var o=Ti(n,t),i=Ti(e,t);return o&&i},$h=function(n,e,t){var o=Ti(n,t),i=Ti(e,t),r=o&&i,s=o||i;return!r&&s},Ph=function(n,e,t){for(var o=void 0,i=vo(t),r=Ql(i),s=0;s<r.length;s++){var a=Qs(n,e,r[s],r[(s+1)%r.length]);a&&(o=[r[s],r[(s+1)%r.length]])}if(o)return iX(n,e,o[0],o[1])},eu=function(n,e){var t=void 0;return n.x===e.x?t=xn.VERTICAL:n.y===e.y&&(t=xn.HORIZONTAL),t},$r=function(n){var e=n.split(" "),t=[];return e&&e.forEach(function(o){var i=Do(o.split(","),2),r=i[0],s=i[1];t.push({x:Number(r),y:Number(s)})}),t},vX=function(n,e,t,o){var i=[],r=eu(n,t),s=eu(e,o);if(r===s)n.y===t.y?(i.push({x:t.x,y:(t.y+o.y)/2}),i.push({x:o.x,y:(t.y+o.y)/2})):(i.push({x:(t.x+o.x)/2,y:t.y}),i.push({x:(t.x+o.x)/2,y:o.y}));else{var a={x:t.x,y:o.y},l=ka(a,n,t),u=ka(a,e,o);if(l||u)a={x:o.x,y:t.y};else{var c=Rh(a,n,t),f=Rh(a,e,o);c&&f&&(a={x:o.x,y:t.y})}i.push(a)}return i},Rh=function(n,e,t){return n.x===e.x&&n.x===t.x||n.y===e.y&&n.y===t.y},G_=function(n){if(!n)return 0;for(var e=0,t=0;t<n.length;t++){var o=n.charCodeAt(t);n.match(/[A-Z]/)?e+=1.5:o>=1&&o<=126||o>=65376&&o<=65439?e+=1:e+=2}return e},gX=function(n){var e=n.start,t=n.end,o;if(e.x===t.x&&e.y===t.y)o="";else{var i={start:e,end:t,offset:10,verticalLength:5},r=Ea(ns(ns({},i),{type:"start"})),s=Ea(ns(ns({},i),{type:"end"}));o="M".concat(r.leftX," ").concat(r.leftY,`
    L`).concat(r.rightX," ").concat(r.rightY,`
    L`).concat(s.rightX," ").concat(s.rightY,`
    L`).concat(s.leftX," ").concat(s.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},Bh=function(n){var e=n.start,t=n.end,o=n.sourceNode,i=n.targetNode,r=n.offset,s=vo(o),a=vo(i),l=Jl(s,r),u=Jl(a,r),c=Zl(l,s,e),f=Zl(u,a,t);return{sNext:c,ePre:f}},Mf=function(n){var e=n.replace(/M/g,"").replace(/C/g,",").split(","),t=fl(e[0]),o=fl(e[1]),i=fl(e[2]),r=fl(e[3]);return[t,o,i,r]},fl=function(n){var e=Do(n.replace(/(^\s*)/g,"").split(" "),2),t=e[0],o=e[1];return{x:+t,y:+o}},Lh=function(n,e){var t=Do(n,4),o=t[0],i=t[1],r=t[2],s=t[3],a=sW(o,i,r,s,e);return[a,n[3]]},X_=function(n,e){for(var t=n.x,o=n.y,i=$r(e),r=Number.MAX_SAFE_INTEGER,s,a=[],l=0;l<i.length;l++)a.push({start:i[l],end:i[(l+1)%i.length]});if(a.forEach(function(p){var h=p.start,g=p.end;if(h.x===g.x){var m={x:h.x,y:o},_=ka(m,h,g);if(_){var v=Math.abs(h.x-t);v<r&&(r=v,s=m)}}else if(h.y===g.y){var m={x:t,y:h.y},_=ka(m,h,g);if(_){var v=Math.abs(h.y-o);v<r&&(r=v,s=m)}}}),!s){var u=a[0],c=u.start,f=u.end;s={x:c.x+(f.x-c.x)/2,y:c.y+(f.y-c.y)/2}}return s},_X=function(n){return Qr(n,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},Ih=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))};function mX(n,e){return typeof e!="function"?function(t,o,i){return Object.assign({type:n.edgeType},i)}:function(t,o,i){var r=e(t,o,i);return r?typeof r=="string"?Object.assign({},i,{type:r}):Object.assign({type:r},i):{type:n.edgeType}}}var yX=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return Lt(e,function(r){var s=G_(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},zr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},pl=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};function bs(n,e,t){return t&&e*Math.round(n/e)||n}function bX(n,e,t){if(!n)return[];var o=Math.min.apply(Math,pl([],zr(n.map(function(m){return m[0]})),!1)),i=Math.max.apply(Math,pl([],zr(n.map(function(m){return m[0]})),!1)),r=Math.min.apply(Math,pl([],zr(n.map(function(m){return m[1]})),!1)),s=Math.max.apply(Math,pl([],zr(n.map(function(m){return m[1]})),!1)),a=-o,l=-r,u=n.map(function(m){var _=zr(m,2),v=_[0],b=_[1];return[v+a,b+l]}),c=i-o,f=s-r,p=e?e/c:1,h=t?t/f:1,g=Math.min(p,h);return u.map(function(m){var _=zr(m,2),v=_[0],b=_[1];return[v*g,b*g]})}var md=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},yd=function(n,e,t){var o=md(n,2),i=o[0],r=o[1],s=md(e,2),a=s[0],l=s[1],u=md(t,2),c=u[0],f=u[1];return i>a&&i<c&&r>l&&r<f},W_=function(n,e){var t=e.multipleSelectKey,o=!1;switch(t){case"meta":o=n.metaKey;break;case"alt":o=n.altKey;break;case"shift":o=n.shiftKey;break;case"ctrl":o=n.ctrlKey;break;default:o=!1;break}return o},Tf=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();function Fh(n,e){return n instanceof Xn&&e instanceof Xn}var Y_=(function(n){Tf(e,n);function e(t,o,i){var r=n.call(this,3)||this;return r[0]=t,r[1]=o,r[2]=i,r.x=t,r.y=o,r.z=i,Object.setPrototypeOf(r,e.prototype),r}return e.prototype.add=function(t){if(Fh(this,t))return new Xn(this.x+t.x,this.y+t.y);var o=this.z+t.z;return new cc((this.x+t.x)/o,(this.y+t.y)/o)},e.prototype.subtract=function(t){if(Fh(this,t))return new Xn(this.x-t.x,this.y-t.y);var o=this.z-t.z;return o===0?new Xn(this.x-t.x,this.y-t.y):new cc((this.x-t.x)/o,(this.y-t.y)/o)},e})(Array),Xn=(function(n){Tf(e,n);function e(t,o,i){var r=n.call(this,t,o,i??0)||this;return Object.setPrototypeOf(r,e.prototype),r}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var o=this;return t.reduce(function(i,r,s){return i+r*o[s]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var o=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return o>=0?i:-i},e})(Y_),cc=(function(n){Tf(e,n);function e(t,o){var i=n.call(this,t,o,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e})(Y_),Ku=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),qr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},bd=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Ja=(function(n){Ku(e,n);function e(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var i=n.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(r,s){i[s]=r}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return bd([],qr(this.map(function(o){return o[t]})),!1)},e.prototype.transpose=function(){for(var t=[],o=0;o<this.columns;o++)t.push(this.getColumn(o));return new(e.bind.apply(e,bd([void 0],qr(t),!1)))},e.prototype.cross=function(t){var o=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var r=this.getRow(i),s=function(l){var u=t.getColumn(l);o[i][l]=r.reduce(function(c,f,p){return c+f*u[p]},0)},a=0;a<t.columns;a++)s(a);return new(e.bind.apply(e,bd([void 0],qr(o),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new cc(t[0],t[1])})},e.prototype.toString=function(){var t=qr(this[0],2),o=t[0],i=t[1],r=qr(this[1],2),s=r[0],a=r[1],l=qr(this[2],2),u=l[0],c=l[1];return"matrix(".concat(o," ").concat(i," ").concat(s," ").concat(a," ").concat(u," ").concat(c,")")},e.prototype.translate=function(t,o){return this.cross(new tu(t,o))},e.prototype.rotate=function(t){return this.cross(new xX(t))},e.prototype.scale=function(t,o){return this.cross(new wX(t,o))},e})(Array),xX=(function(n){Ku(e,n);function e(t){var o=n.call(this,new Xn(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new Xn(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new Xn(0,0,1))||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return this.transpose()},e})(Ja),wX=(function(n){Ku(e,n);function e(t,o){var i=n.call(this,new Xn(t,0,0),new Xn(0,o,0),new Xn(0,0,1))||this;return i.sx=t,i.sy=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e})(Ja),tu=(function(n){Ku(e,n);function e(t,o){var i=n.call(this,new Xn(1,0,0),new Xn(0,1,0),new Xn(t,o,1))||this;return i.tx=t,i.ty=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e})(Ja);Qq({});var nu=function(){return nu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},nu.apply(this,arguments)},CX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},fc=function(n){var e=n.anchors;return e},ou=function(n,e){for(var t=e.nodes,o,i=t.length-1;i>=0;i--){var r=t[i],s=EX(n,r);if(s){var a=r.getTargetAnchor(n);if(a){var l={node:r,anchorIndex:a.index,anchor:a.anchor};(!o||SX(r,o.node,e))&&(o=l)}}}return o},SX=function(n,e,t){return n.zIndex>e.zIndex?!0:t.nodesMap[n.id].index>t.nodesMap[e.id].index},kX=function(n,e){for(var t=fc(e),o,i=Number.MAX_SAFE_INTEGER,r=0;r<t.length;r++){var s=Yo(n.x,n.y,t[r].x,t[r].y);s<i&&(i=s,o={index:r,anchor:nu(nu({},t[r]),{x:t[r].x,y:t[r].y,id:t[r].id})})}return o},Yo=function(n,e,t,o){return Math.hypot(n-t,e-o)},Ti=function(n,e,t){t===void 0&&(t=0);var o=!1,i=vo(e),r=CX(new Ja([n.x,n.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),s=r[0],a=r[1],l={x:s,y:a};return l.x>=i.minX-t&&l.x<=i.maxX+t&&l.y>=i.minY-t&&l.y<=i.maxY+t&&(o=!0),o},EX=function(n,e){return Ti(n,e,5)},vo=function(n){var e=n.x,t=n.y,o=n.width,i=n.height;return{minX:e-o/2,minY:t-i/2,maxX:e+o/2,maxY:t+i/2,x:e,y:t,width:o,height:i,centerX:e,centerY:t}},DX=function(n){var e=n,t=e.x,o=e.y,i=e.width,r=e.height,s=e.radius;return[{x:t-i/2+s,y:o-r/2+s,r:s},{x:t+i/2-s,y:o-r/2+s,r:s},{x:t-i/2+s,y:o+r/2-s,r:s},{x:t+i/2-s,y:o+r/2-s,r:s}]},jh=function(n,e,t){var o=DX(t),i,r=Number.MAX_SAFE_INTEGER;return o.forEach(function(s){var a=Yo(n.x,n.y,s.x,s.y);a<r&&(r=a,i=s)}),pc(n,e,i)},pc=function(n,e,t){var o,i=t.x,r=t.y,s=t.r;if(e===xn.HORIZONTAL){var a=i-Math.sqrt(s*s-(n.y-r)*(n.y-r)),l=i+Math.sqrt(s*s-(n.y-r)*(n.y-r)),u=Math.abs(a-n.x)<Math.abs(l-n.x)?a:l;o={x:u,y:n.y}}else if(e===xn.VERTICAL){var c=r-Math.sqrt(s*s-(n.x-i)*(n.x-i)),f=r+Math.sqrt(s*s-(n.x-i)*(n.x-i)),p=Math.abs(c-n.y)<Math.abs(f-n.y)?c:f;o={x:n.x,y:p}}return o},Vh=function(n,e){var t=e,o=!1,i=t.x,r=t.y,s=t.width,a=t.height,l=t.radius,u={minX:i-s/2+l,maxX:i+s/2-l,minY:r-a/2+l,maxY:r+a/2-l};return n.y===r+a/2||n.y===r-a/2?o=n.x>u.minX&&n.x<u.maxX:(n.x===i+s/2||n.x===i-s/2)&&(o=n.y>u.minY&&n.y<u.maxY),o},Hh=function(n,e,t){var o,i=t,r=i.x,s=i.y,a=i.rx,l=i.ry;if(e===xn.HORIZONTAL){var u=r-Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),c=r+Math.sqrt(a*a-(n.y-s)*(n.y-s)*a*a/(l*l)),f=Math.abs(u-n.x)<Math.abs(c-n.x)?u:c;o={x:f,y:n.y}}else if(e===xn.VERTICAL){var p=s-Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),h=s+Math.sqrt(l*l-(n.x-r)*(n.x-r)*l*l/(a*a)),g=Math.abs(p-n.y)<Math.abs(h-n.y)?p:h;o={x:n.x,y:g}}return o},hl=function(n,e,t){for(var o=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,r,s=[],a=0;a<o.length;a++)s.push({start:o[a],end:o[(a+1)%o.length]});return s.forEach(function(l){var u=l.start,c=l.end,f=u,p=c;u.x>c.x&&(f=c,p=u);var h={x:n.x,y:n.y};if(f.x===p.x&&e===xn.HORIZONTAL&&(h={x:f.x,y:n.y}),f.y===p.y&&e===xn.VERTICAL&&(h={x:n.x,y:f.y}),f.x!==p.x&&f.y!==p.y){var g=(p.y-f.y)/(p.x-f.x),m=(f.x*p.y-p.x*f.y)/(f.x-p.x);e===xn.HORIZONTAL?h={x:(n.y-m)/g,y:n.y}:e===xn.VERTICAL&&(h={x:n.x,y:g*n.x+m})}var _=ka(h,u,c);if(_){var v=Yo(h.x,h.y,n.x,n.y);v<i&&(i=v,r=h)}}),r},AX=function(n){var e=Qr(n,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},Uh=function(n,e,t,o){var i=n.x,r=n.y;return e.x>n.x?i=n.x+t/2:e.x<n.x&&(i=n.x-t/2),e.y>n.y?r=n.y+o/2:e.y<n.y&&(r=n.y-o/2),{x:i,y:r}},K_=function(n){var e=n.rows,t=n.style,o=n.rowsLength,i=n.className,r=document.createElement("div");r.className=i,r.style.fontSize="".concat(t.fontSize),r.style.width="".concat(t.width),r.style.lineHeight="".concat(t.lineHeight),r.style.padding="".concat(t.padding),t.fontFamily&&(r.style.fontFamily="".concat(t.fontFamily)),o>1?e.forEach(function(a){var l=document.createElement("div");l.textContent=a,r.appendChild(l)}):r.textContent=e[0],document.body.appendChild(r);var s=r.clientHeight;return document.body.removeChild(r),s},zh=function(n){var e=n.rows,t=n.rowsLength,o=n.fontSize,i=0;return e&&e.forEach(function(r){var s=G_(r);i=s>i?s:i}),{width:Math.ceil(i/2)*o+o/4,height:t*(o+2)+o/4}},iu=function(n){return typeof n!="object"?{isAllPass:!!n,msg:n?"":"不允许连接"}:n};let vl;const OX=new Uint8Array(16);function NX(){if(!vl&&(vl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vl(OX)}const qn=[];for(let n=0;n<256;++n)qn.push((n+256).toString(16).slice(1));function MX(n,e=0){return qn[n[e+0]]+qn[n[e+1]]+qn[n[e+2]]+qn[n[e+3]]+"-"+qn[n[e+4]]+qn[n[e+5]]+"-"+qn[n[e+6]]+qn[n[e+7]]+"-"+qn[n[e+8]]+qn[n[e+9]]+"-"+qn[n[e+10]]+qn[n[e+11]]+qn[n[e+12]]+qn[n[e+13]]+qn[n[e+14]]+qn[n[e+15]]}const TX=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qh={randomUUID:TX};function $X(n,e,t){if(qh.randomUUID&&!n)return qh.randomUUID();n=n||{};const o=n.random||(n.rng||NX)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,MX(o)}var er=function(){return $X()},oa=new Map,J_=function(n){var e=er();function t(){n();var i=oa.get(e);if(i){var r=window.requestAnimationFrame(t);oa.set(e,r)}}var o=window.requestAnimationFrame(t);return oa.set(e,o),e},ru=function(n){var e=oa.get(n);e&&(window.cancelAnimationFrame(e),oa.delete(n))},Aa=function(){return Aa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Aa.apply(this,arguments)},PX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Z_(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.value,s=n.fontSize,a=s===void 0?12:s,l=n.fill,u=l===void 0?"currentColor":l,c=n.overflowMode,f=c===void 0?"default":c,p=n.textWidth,h=p===void 0?void 0:p,g=n.model,m={x:t,y:i,fill:u,fontSize:a,textAnchor:"middle",dominantBaseline:"central"};if(Lt(ir(n),function(O){var k=PX(O,2),E=k[0],S=k[1];typeof S!="object"&&(m[E]=S)}),r){var _=String(r).split(/[\r\n]/g),v=_.length;if(f!=="default"){var b=g.BaseType,C=g.modelType;if(b===Sn.NODE&&C!==zt.TEXT_NODE||b===Sn.EDGE&&h)return RX(n)}if(v>1){var M=_.map(function(O,k){var E=a+2,S=(k-(v-1)/2)*E;return Re("tspan",{className:"lf-text-tspan",x:t,y:i+S,children:O})});return Re("text",Aa({},m,{children:M}))}return Re("text",Aa({},m,{children:r}))}return null}function RX(n){var e=n.x,t=n.y,o=n.value,i=n.model,r=n.textWidth,s=n.fontSize,a=s===void 0?12:s,l=n.lineHeight,u=n.fontFamily,c=u===void 0?"":u,f=n.wrapPadding,p=f===void 0?"0, 0":f,h=n.overflowMode,g=i.width,m=i.height,_=i.textHeight,v=r||g,b=String(o).split(/[\r\n]/g),C=b.length,M=K_({rows:b,style:{fontSize:"".concat(a,"px"),width:"".concat(v,"px"),fontFamily:c,lineHeight:l,padding:p},rowsLength:C,className:"lf-get-text-height"}),O=m>M?m:M;_&&(O=_);var k=h==="ellipsis";return k&&(O=a+2),Re("g",{children:Re("foreignObject",{width:v,height:O,x:e-v/2,y:t-O/2,style:{overflow:"visible",textAlign:"left"},children:Re("div",{className:"lf-node-text-auto-wrap",style:{minHeight:O,width:v,padding:p},children:Re("div",{className:k?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:k?b.join(""):"",style:Aa({},n),children:b.map(function(E){return Re("div",{className:"lf-node-text--auto-wrap-inner",children:E})})})})})})}var hc=function(){return hc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},hc.apply(this,arguments)},BX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function xs(n){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return Lt(ir(n),function(t){var o=BX(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Re("line",hc({},e))}var vc=function(){return vc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vc.apply(this,arguments)},LX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Ao(n){var e=n.x,t=n.y,o=n.width,i=n.height,r=n.className,s=n.strokeWidth,a=n.radius,l=a===void 0?0:a,u=e-o/2,c=t-i/2,f={};return f["stroke-width"]=s,Lt(ir(n),function(p){var h=LX(p,2),g=h[0],m=h[1];typeof m!="object"&&(f[g]=m)}),r?f.className="lf-basic-shape ".concat(r):f.className="lf-basic-shape",l&&(f.rx=l,f.ry=l),f.x=u,f.y=c,Re("rect",vc({},f))}var gc=function(){return gc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gc.apply(this,arguments)},IX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function Oa(n){var e={d:""};return Lt(ir(n),function(t){var o=IX(t,2),i=o[0],r=o[1];(i==="style"||typeof r!="object")&&(e[i]=r)}),Re("path",gc({},e))}var _c=function(){return _c=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_c.apply(this,arguments)},FX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function ws(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.r,s=r===void 0?4:r,a=n.className,l={cx:t,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Lt(ir(n),function(u){var c=FX(u,2),f=c[0],p=c[1];typeof p!="object"&&(l[f]=p)}),a?l.className="lf-basic-shape ".concat(a):l.className="lf-basic-shape",Re("circle",_c({},l))}var mc=function(){return mc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mc.apply(this,arguments)},jX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function VX(n){var e=n.x,t=e===void 0?0:e,o=n.y,i=o===void 0?0:o,r=n.rx,s=r===void 0?4:r,a=n.ry,l=a===void 0?4:a,u=n.className,c={cx:t,cy:i,rx:s,ry:l,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return Lt(ir(n),function(f){var p=jX(f,2),h=p[0],g=p[1];typeof g!="object"&&(c[h]=g)}),u?c.className="lf-basic-shape ".concat(u):c.className="lf-basic-shape",Re("ellipse",mc({},c))}var su=function(){return su=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},su.apply(this,arguments)},HX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function UX(n,e){var t=n.map(function(b){return{x:b[0],y:b[1]}}),o=t.length;if(o<3)return"";for(var i=Math.abs(e),r="",s=0;s<o;s++){var a=t[(s-1+o)%o],l=t[s],u=t[(s+1)%o],c={x:l.x-a.x,y:l.y-a.y},f={x:u.x-l.x,y:u.y-l.y},p=Math.hypot(c.x,c.y),h=Math.hypot(f.x,f.y),g={x:c.x/p,y:c.y/p},m={x:f.x/h,y:f.y/h},_={x:l.x-g.x*i,y:l.y-g.y*i},v={x:l.x+m.x*i,y:l.y+m.y*i};s===0?r+="M ".concat(_.x," ").concat(_.y," "):r+="L ".concat(_.x," ").concat(_.y," "),r+="Q ".concat(l.x," ").concat(l.y," ").concat(v.x," ").concat(v.y," ")}return r+="Z",r}function $f(n){var e=n.points,t=e===void 0?[]:e,o=n.className,i=n.radius,r={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(Lt(ir(n),function(a){var l=HX(a,2),u=l[0],c=l[1];typeof c!="object"&&(r[u]=c)}),o?r.classNmae="lf-basic-shape ".concat(o):r.className="lf-basic-shape",i){var s=UX(t,i);return r.d=s,Re("path",su({},r))}else return r.points=t.map(function(a){return a.join(",")}).join(" "),Re("polygon",su({},r))}var yc=function(){return yc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},yc.apply(this,arguments)},zX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r};function qX(n){var e=n.className,t={points:"",fill:"none"};return Lt(ir(n),function(o){var i=zX(o,2),r=i[0],s=i[1];(r==="style"||typeof s!="object")&&(t[r]=s)}),e&&(t.className="".concat(e)),Re("polyline",yc({},t))}var Q_=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Na=function(){return Na=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Na.apply(this,arguments)},GX=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},XX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},sn;(function(n){n[n.LEFT_TOP=0]="LEFT_TOP",n[n.RIGHT_TOP=1]="RIGHT_TOP",n[n.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(sn||(sn={}));var WX=(function(n){Q_(e,n);function e(t){var o=n.call(this)||this;o.isShiftPressed=!1,o.bindKeyboardEvents=function(){document.addEventListener("keydown",o.handleKeyDown),document.addEventListener("keyup",o.handleKeyUp)},o.handleKeyDown=function(a){a.key==="Shift"&&(o.isShiftPressed=!0)},o.handleKeyUp=function(a){a.key==="Shift"&&(o.isShiftPressed=!1)},o.updateEdgePointByAnchors=function(){var a=o.nodeModel,l=a.id,u=a.anchors,c=o.graphModel.getNodeEdges(l);Lt(c,function(f){if(f.sourceNodeId===l){var p=Or(u,function(h){return h.id===f.sourceAnchorId});p&&f.updateStartPoint({x:p.x,y:p.y})}else if(f.targetNodeId===l){var p=Or(u,function(g){return g.id===f.targetAnchorId});p&&f.updateEndPoint({x:p.x,y:p.y})}})},o.triggerResizeEvent=function(a,l,u,c,f,p){o.graphModel.eventCenter.emit(pt.NODE_RESIZE,{preData:a,data:l,deltaX:u,deltaY:c,index:f,model:p})},o.recalcResizeInfo=function(a,l,u,c,f){u===void 0&&(u=1),c===void 0&&(c=!1),f===void 0&&(f=!1);var p=Dt(l),h=p.deltaX,g=p.deltaY,m=p.width,_=p.height,v=p.PCTResizeInfo;if(v){var b=4,C=0,M=0;switch(a){case sn.LEFT_TOP:M=(h*-1-g)/b;break;case sn.RIGHT_TOP:M=(h-g)/b;break;case sn.RIGHT_BOTTOM:M=(h+g)/b;break;case sn.LEFT_BOTTOM:M=(h*-1+g)/b;break}M!==0&&(C=Math.round(M/v.ResizeBasis.basisHeight*1e5)/1e3),v.ResizePCT.widthPCT=Math.max(Math.min(v.ResizePCT.widthPCT+C,v.ScaleLimit.maxScaleLimit),v.ScaleLimit.minScaleLimit),v.ResizePCT.heightPCT=Math.max(Math.min(v.ResizePCT.heightPCT+C,v.ScaleLimit.maxScaleLimit),v.ScaleLimit.minScaleLimit);var O=Math.round(v.ResizePCT.widthPCT*v.ResizeBasis.basisWidth/100),k=Math.round(v.ResizePCT.heightPCT*v.ResizeBasis.basisHeight/100);switch(a){case sn.LEFT_TOP:h=m-O,g=_-k;break;case sn.RIGHT_TOP:h=O-m,g=_-k;break;case sn.RIGHT_BOTTOM:h=O-m,g=k-_;break;case sn.LEFT_BOTTOM:h=m-O,g=k-_;break}return p}switch(a){case sn.LEFT_TOP:p.width=c?m:m-h*u,p.height=f?_:_-g*u;break;case sn.RIGHT_TOP:p.width=c?m:m+h*u,p.height=f?_:_-g*u;break;case sn.RIGHT_BOTTOM:p.width=c?m:m+h*u,p.height=f?_:_+g*u;break;case sn.LEFT_BOTTOM:p.width=c?m:m-h*u,p.height=f?_:_+g*u;break}return p},o.resizeNode=function(a){var l=a.deltaX,u=a.deltaY,c=o.index,f=o.props,p=f.model,h=f.graphModel,g=f.x,m=f.y;em({x:g,y:m,deltaX:l,deltaY:u,index:c,nodeModel:p,graphModel:h,forceProportional:o.isShiftPressed,cancelCallback:function(){o.dragHandler.cancelDrag()}})},o.onDragStart=function(){o.graphModel.selectNodeById(o.nodeModel.id)},o.onDragging=function(a){var l=a.deltaX,u=a.deltaY,c=o.graphModel.transformModel,f=XX(c.fixDeltaXY(l,u),2),p=f[0],h=f[1];o.resizeNode({deltaX:p,deltaY:h})},o.onDragEnd=function(){var a=o.nodeModel.x,l=o.nodeModel.y;o.nodeModel.moveTo(a,l),o.updateEdgePointByAnchors()};var i=t.index,r=t.model,s=t.graphModel;return o.index=i,o.nodeModel=r,o.graphModel=s,o.dragHandler=new Fo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:s.gridSize}),o.bindKeyboardEvents(),o}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.direction,s=t.model,a=s.getResizeControlStyle(),l=a.width,u=a.height,c=GX(a,["width","height"]);return Re("g",{className:"lf-resize-control lf-resize-control-".concat(r),children:[Re(Ao,Na({className:"lf-resize-control-content",x:o,y:i,width:l??7,height:u??7},c)),Re(Ao,{className:"lf-resize-control-content",x:o,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onPointerDown:this.dragHandler.handleMouseDown})]})},e})(Yt),YX=(function(n){Q_(e,n);function e(){return n.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=vo(o),s=r.minX,a=r.minY,l=r.maxX,u=r.maxY,c=[{index:sn.LEFT_TOP,direction:"nw",x:s,y:a},{index:sn.RIGHT_TOP,direction:"ne",x:l,y:a},{index:sn.RIGHT_BOTTOM,direction:"se",x:l,y:u},{index:sn.LEFT_BOTTOM,direction:"sw",x:s,y:u}];return ti(c,function(f){return Re(WX,Na({},f,{model:o,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Re(Ao,Na({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Re("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e})(Yt);function KX(n,e){var t=n.x,o=n.y,i=e.x,r=e.y,s={x:t+(i-t)/2,y:o+(r-o)/2};return s}function ea(n,e,t){var o=JX(t),i=n.x-e.x,r=n.y-e.y,s=i*Math.cos(o)-r*Math.sin(o)+e.x,a=i*Math.sin(o)+r*Math.cos(o)+e.y;return{x:s,y:a}}function JX(n){return n*Math.PI/180}function ZX(n){return n/Math.PI*180}function QX(n,e,t,o,i,r,s,a){i===void 0&&(i=!1),r===void 0&&(r=!1);var l={x:t.x-(n.x-t.x),y:t.y-(n.y-t.y)},u=KX(l,e),c=ea(e,u,-o),f=ea(l,u,-o);if(i){var p=Math.abs(c.x-f.x),h=p-s;u.x>c.x?u.x=u.x+h/2:u.x=u.x-h/2}if(r){var g=Math.abs(c.y-f.y),m=g-a;u.y>c.y?u.y=u.y+m/2:u.y=u.y-m/2}if(i||r){var _=ea(f,u,o),v=_.x-l.x,b=_.y-l.y;u.x=u.x-v,u.y=u.y-b,f=ea(l,u,-o),c={x:u.x-(f.x-u.x),y:u.y-(f.y-u.y)}}var C=Math.abs(c.x-f.x),M=Math.abs(c.y-f.y);return i&&(C=s),r&&(M=a),{width:C,height:M,center:u}}function eW(n,e,t,o,i,r,s,a,l){a===void 0&&(a=!1),l===void 0&&(l=!1);var u=e.deltaX,c=e.deltaY,f=e.width,p=e.height,h=ZX(t),g={x:o,y:i},m={x:r,y:s},_=ea(g,m,h),v={x:_.x+u,y:_.y+c},b=QX(_,v,m,h,a,l,f,p),C=b.width,M=b.height,O=b.center;return e.width=C*n,e.height=M*n,e.deltaX=(O.x-m.x)*2,e.deltaY=(O.y-m.y)*2,e}var tW=function(n,e,t,o,i,r,s,a,l,u,c){t===void 0&&(t=1),o===void 0&&(o=!1),i===void 0&&(i=!1),r===void 0&&(r=0),c===void 0&&(c=!1);var f=Dt(e),p=f.deltaX,h=f.deltaY,g=f.width,m=f.height,_=f.PCTResizeInfo;if(_){var v=4,b=0,C=0;switch(n){case sn.LEFT_TOP:C=(p*-1-h)/v;break;case sn.RIGHT_TOP:C=(p-h)/v;break;case sn.RIGHT_BOTTOM:C=(p+h)/v;break;case sn.LEFT_BOTTOM:C=(p*-1+h)/v;break}C!==0&&(b=Math.round(C/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+b,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+b,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var M=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),O=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(n){case sn.LEFT_TOP:p=g-M,h=m-O;break;case sn.RIGHT_TOP:p=M-g,h=m-O;break;case sn.RIGHT_BOTTOM:p=M-g,h=O-m;break;case sn.LEFT_BOTTOM:p=g-M,h=O-m;break}return f}if(r%(2*Math.PI)!==0&&s!==void 0&&a!==void 0)return eW(t,f,r,s,a,l,u,o,i);if(c){var k=g/m,E=0,S=g,N=m;switch(n){case sn.LEFT_TOP:E=Math.abs(p)>Math.abs(h)?-p:-h,k>=1?(S=g+E,N=S/k):(N=m+E,S=N*k),f.width=S,f.height=N,f.deltaX=g-S,f.deltaY=m-N;break;case sn.RIGHT_TOP:E=Math.abs(p)>Math.abs(h)?p:-h,k>=1?(S=g+E,N=S/k):(N=m-E,S=N*k),f.width=S,f.height=N,f.deltaX=S-g,f.deltaY=m-N;break;case sn.RIGHT_BOTTOM:E=Math.abs(p)>Math.abs(h)?p:h,k>=1?(S=g+E,N=S/k):(N=m+E,S=N*k),f.width=S,f.height=N,f.deltaX=S-g,f.deltaY=N-m;break;case sn.LEFT_BOTTOM:E=Math.abs(p)>Math.abs(h)?-p:h,k>=1?(S=g-E,N=S/k):(N=m+E,S=N*k),f.width=S,f.height=N,f.deltaX=g-S,f.deltaY=N-m;break}return f}switch(n){case sn.LEFT_TOP:f.width=o?g:g-p*t,f.height=i?m:m-h*t;break;case sn.RIGHT_TOP:f.width=o?g:g+p*t,f.height=i?m:m-h*t;break;case sn.RIGHT_BOTTOM:f.width=o?g:g+p*t,f.height=i?m:m+h*t;break;case sn.LEFT_BOTTOM:f.width=o?g:g-p*t,f.height=i?m:m+h*t;break}return f},nW=function(n,e){var t=n.id,o=n.anchors,i=e.getNodeEdges(t);Lt(i,function(r){if(r.sourceNodeId===t){var s=Or(o,function(a){return a.id===r.sourceAnchorId});s&&r.updateStartPoint({x:s.x,y:s.y})}else if(r.targetNodeId===t){var s=Or(o,function(l){return l.id===r.targetAnchorId});s&&r.updateEndPoint({x:s.x,y:s.y})}})},oW=function(n,e,t,o,i,r,s){s.eventCenter.emit(pt.NODE_RESIZE,{preData:n,data:e,deltaX:t,deltaY:o,index:i,model:r})},em=function(n){var e=n.x,t=n.y,o=n.deltaX,i=n.deltaY,r=n.index,s=n.nodeModel,a=n.graphModel,l=n.cancelCallback,u=n.forceProportional,c=u===void 0?!1:u,f=s.r,p=s.rx,h=s.ry,g=s.width,m=s.height,_=s.PCTResizeInfo,v=s.minWidth,b=s.minHeight,C=s.maxWidth,M=s.maxHeight,O=s.rotate,k=s.x,E=s.y,S=v===C,N=b===M,L={width:f||p||g,height:f||h||m,deltaX:o,deltaY:i,PCTResizeInfo:_},$=f||p&&h?1/2:1,B=e,A=t,D=tW(r,L,$,S,N,O,B,A,k,E,c);if(D.width<v||D.width>C||D.height<b||D.height>M){l==null||l();return}(O%(2*Math.PI)==0||_||B===void 0||A===void 0)&&(D.deltaX=S?0:D.deltaX,D.deltaY=N?0:D.deltaY);var T=s.getData(),F=s.resize(D);T.x===F.x&&T.y===F.y||(nW(s,a),oW(T,F,o,i,r,s,a))},iW=100,rW={x:1,y:0};function sW(n,e,t,o,i){for(var r=function(h){if(h<0||h>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:n.x*Math.pow(1-h,3)+3*e.x*h*Math.pow(1-h,2)+3*t.x*Math.pow(h,2)*(1-h)+o.x*Math.pow(h,3),y:n.y*Math.pow(1-h,3)+3*e.y*h*Math.pow(1-h,2)+3*t.y*Math.pow(h,2)*(1-h)+o.y*Math.pow(h,3)}},s=0,a=2,l=o.x,u=o.y,c=o;s<i&&a<50;){c=r(1-a/iW);var f=c.x,p=c.y;s=Yo(l,u,f,p),a++}return c}function aW(n,e){return n.x*e.y-n.y*e.x}function lW(n,e){var t=[n.x,n.y,n.z],o=[e.x,e.y,e.z];return o.reduce(function(i,r,s){return i+r*t[s]})}function uW(n,e){var t=aW(n,e),o=Math.acos(lW(Gh(n),Gh(e)));return t>=0?o:-o}function Gh(n){var e=Math.hypot(n.x,n.y);return{x:n.x/e,y:n.y/e,z:0}}function dW(n){return uW(rW,n)}function cW(n){return n*(180/Math.PI)}var tm={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},fW={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},pW={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},hW={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Ma={colorful:hW,dark:pW,radius:fW,default:tm},vW={background:"#23272e"},gW={background:"#fefeff"},bc={background:"#ffffff"},Ta={colorful:gW,dark:vW,radius:bc,default:bc},_W={color:"#66676a",thickness:1},mW={color:"#dadada",thickness:1},xc={color:"#acacac",thickness:1},$a={colorful:mW,dark:_W,radius:xc,default:xc},nm=function(n,e){var t=Dt(tm);return e&&(t=ls(t,Ma[e])),n&&(t=ls(t,n)),t},yW=function(n,e){if(Ma[n]){console.warn("theme mode ".concat(n," already exists"));return}Ma[n]=e,Ta[n]=e.background||bc,$a[n]=e.grid||xc},bW=function(n){delete Ma[n],delete Ta[n],delete $a[n]},Xh=function(){var n={colorful:{},dark:{},radius:{},default:{}};an(Ma,n),an(Ta,n),an($a,n)},xW=nm,wW=1e3,CW=999,Pa=function(){return++wW},SW=function(){return--CW},On=function(){return On=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},On.apply(this,arguments)},wt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Ju=(function(){function n(e,t){var o;this.BaseType=Sn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=$o.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=en.DEFAULT,this.modelType=zt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initEdgeData(e),this.setAttributes()}return n.prototype.initEdgeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||er()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var s=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=s,an(this,_X(e));var a=this.graphModel,l=a.overlapMode,u=a.eventCenter;this.updateZIndexByOverlap(l,e.zIndex||Pa()),this.setAnchors(),this.initPoints(),this.formatText(e),u.on("overlap:change",function(c){var f=c.overlapMode;t.updateZIndexByOverlap(f,t.zIndex||Pa())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.getEdgeStyle=function(){return On(On({},this.graphModel.theme.baseEdge),this.style)},n.prototype.getAdjustPointStyle=function(){return On({},this.graphModel.theme.edgeAdjust)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Dt(e)},n.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Dt(e)},n.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),o=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return On(On(On({},e),{fill:i,stroke:i}),o)},n.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Dt(t)},n.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(n.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),n.prototype.getBeginAnchor=function(e,t,o){var i,r,s=fc(e);if(o){if(i=Or(s,function(a){return a.id===o}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(o,"，已使用默认锚点作为起点"))}return s.forEach(function(a){var l=Ih(a,t);(r===void 0||l<r)&&(r=l,i=a)}),i},n.prototype.getEndAnchor=function(e,t){var o=this,i,r,s=fc(e);if(t){if(i=Or(s,function(a){return a.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return s.forEach(function(a){if(o.startPoint){var l=Ih(a,o.startPoint);(r===void 0||l<r)&&(r=l,i=a)}}),i},n.prototype.getProperties=function(){return qo(this.properties)},n.prototype.getData=function(){var e=this.properties;ms(e)&&(e=qo(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:an({},this.startPoint),endPoint:an({},this.endPoint)};[Ln.INCREASE,Ln.STATIC].includes(this.graphModel.overlapMode)&&(t.zIndex=this.zIndex);var o=this.text,i=o.x,r=o.y,s=o.value;return s&&(t.text={x:i,y:r,value:s}),t},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.setProperty=function(e,t){Df(this.properties,e,Jn(t)),this.setAttributes()},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setProperties=function(e){this.properties=On(On({},qo(this.properties)),Jn(e)),this.setAttributes()},n.prototype.changeEdgeId=function(e){var t=this.arrowConfig,o=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),o&&o==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},n.prototype.setStyle=function(e,t){var o;this.style=On(On({},this.style),(o={},o[e]=Jn(t),o))},n.prototype.setStyles=function(e){this.style=On(On({},this.style),Jn(e))},n.prototype.updateStyles=function(e){this.style=On({},Jn(e))},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.edgeTextDraggable,a=r.edgeTextEdit,l=this.textPosition,u=l.x,c=l.y,f=e.text,p={value:"",x:u,y:c,draggable:s,editable:a};f&&(typeof f=="string"?p=On(On({},p),{value:f}):(p=On(On({},p),{x:(t=f.x)!==null&&t!==void 0?t:u,y:(o=f.y)!==null&&o!==void 0?o:c,value:(i=f.value)!==null&&i!==void 0?i:""}),us(f.draggable)||(p.draggable=f.draggable),us(f.editable)||(p.editable=f.editable))),this.text=p},n.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,o=e.y;this.text.x=t,this.text.y=o},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.setText=function(e){e&&an(this.text,e)},n.prototype.updateText=function(e){this.text=On(On({},qo(this.text)),{value:e})},n.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.openEdgeAnimation=function(){this.isAnimation=!0},n.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateStartPoint=function(e){this.startPoint=e},n.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},n.prototype.updateEndPoint=function(e){this.endPoint=e},n.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},n.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},n.prototype.initPoints=function(){},n.prototype.updateAttributes=function(e){an(this,e)},n.prototype.getAdjustStart=function(){return this.startPoint},n.prototype.getAdjustEnd=function(){return this.endPoint},n.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,o=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:o.x,y:o.y})},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case Ln.DEFAULT:this.zIndex=0;break;case Ln.EDGE_TOP:this.zIndex=1;break;case Ln.INCREASE:this.zIndex=t;break}},n.BaseType=Sn.EDGE,wt([Pe],n.prototype,"type",void 0),wt([Pe],n.prototype,"sourceNodeId",void 0),wt([Pe],n.prototype,"targetNodeId",void 0),wt([Pe],n.prototype,"startPoint",void 0),wt([Pe],n.prototype,"endPoint",void 0),wt([Pe],n.prototype,"textMode",void 0),wt([Pe],n.prototype,"text",void 0),wt([Pe],n.prototype,"properties",void 0),wt([Pe],n.prototype,"points",void 0),wt([Pe],n.prototype,"pointsList",void 0),wt([Pe],n.prototype,"isSelected",void 0),wt([Pe],n.prototype,"isHovered",void 0),wt([Pe],n.prototype,"isHitable",void 0),wt([Pe],n.prototype,"isHittable",void 0),wt([Pe],n.prototype,"draggable",void 0),wt([Pe],n.prototype,"visible",void 0),wt([Pe],n.prototype,"isAnimation",void 0),wt([Pe],n.prototype,"isShowAdjustPoint",void 0),wt([Pe],n.prototype,"zIndex",void 0),wt([Pe],n.prototype,"state",void 0),wt([Pe],n.prototype,"style",void 0),wt([Pe],n.prototype,"arrowConfig",void 0),wt([mn],n.prototype,"sourceNode",null),wt([mn],n.prototype,"targetNode",null),wt([mn],n.prototype,"textPosition",null),wt([$e],n.prototype,"setProperty",null),wt([$e],n.prototype,"deleteProperty",null),wt([$e],n.prototype,"setProperties",null),wt([$e],n.prototype,"changeEdgeId",null),wt([$e],n.prototype,"setStyle",null),wt([$e],n.prototype,"setStyles",null),wt([$e],n.prototype,"updateStyles",null),wt([$e],n.prototype,"setTextMode",null),wt([$e],n.prototype,"formatText",null),wt([$e],n.prototype,"resetTextPosition",null),wt([$e],n.prototype,"moveText",null),wt([$e],n.prototype,"setText",null),wt([$e],n.prototype,"updateText",null),wt([$e],n.prototype,"setAnchors",null),wt([$e],n.prototype,"setSelected",null),wt([$e],n.prototype,"setHovered",null),wt([$e],n.prototype,"setHitable",null),wt([$e],n.prototype,"setHittable",null),wt([$e],n.prototype,"openEdgeAnimation",null),wt([$e],n.prototype,"closeEdgeAnimation",null),wt([$e],n.prototype,"setElementState",null),wt([$e],n.prototype,"updateStartPoint",null),wt([$e],n.prototype,"moveStartPoint",null),wt([$e],n.prototype,"updateEndPoint",null),wt([$e],n.prototype,"moveEndPoint",null),wt([$e],n.prototype,"setZIndex",null),wt([$e],n.prototype,"initPoints",null),wt([$e],n.prototype,"updateAttributes",null),wt([$e],n.prototype,"getAdjustStart",null),wt([$e],n.prototype,"getAdjustEnd",null),wt([$e],n.prototype,"updateAfterAdjustStartAndEnd",null),wt([$e],n.prototype,"updateZIndexByOverlap",null),n})(),kW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),yr=function(){return yr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},yr.apply(this,arguments)},Co=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},xd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},wc=(function(n){kW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=za(t,"properties.offset",100),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return yr(yr(yr({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,o=0;return this.pointsList.forEach(function(i){var r=i.x,s=i.y;t+=r,o+=s}),{x:t/this.pointsList.length,y:o/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return yr(yr({},t),{pointsList:o})},e.prototype.getControls=function(){var t=this.startPoint,o=this.endPoint,i=Bh({start:t,end:o,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var o=xd(t,4),i=o[0],r=o[1],s=o[2],a=o[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(r.x," ").concat(r.y,`,
    `).concat(s.x," ").concat(s.y,`,
    `).concat(a.x," ").concat(a.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),o=t.sNext,i=t.ePre;this.updatePath(o,i)},e.prototype.updatePath=function(t,o){t=Dt(t),o=Dt(o);var i={x:this.startPoint.x,y:this.startPoint.y},r={x:this.endPoint.x,y:this.endPoint.y};if(!t||!o){var s=this.getControls();t=s.sNext,o=s.ePre}this.pointsList=[i,t,o,r],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o;var i=xd(this.pointsList,3),r=i[1],s=i[2];r.x+=t,r.y+=o,this.updatePath(r,s)},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o;var i=xd(this.pointsList,3),r=i[1],s=i[2];s.x+=t,s.y+=o,this.updatePath(r,s)},e.prototype.updateAdjustAnchor=function(t,o){var i;o==="sNext"?this.pointsList[1]=t:o==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode,a=Bh({start:o,end:i,sourceNode:r,targetNode:s,offset:this.offset}),l=a.sNext,u=a.ePre;this.pointsList=[o,l,u,i],this.initPoints()},Co([Pe],e.prototype,"offset",void 0),Co([Pe],e.prototype,"path",void 0),Co([$e],e.prototype,"initPoints",null),Co([$e],e.prototype,"updatePoints",null),Co([$e],e.prototype,"updateStartPoint",null),Co([$e],e.prototype,"updateEndPoint",null),Co([$e],e.prototype,"moveStartPoint",null),Co([$e],e.prototype,"moveEndPoint",null),Co([$e],e.prototype,"updateAdjustAnchor",null),Co([$e],e.prototype,"getAdjustStart",null),Co([$e],e.prototype,"getAdjustEnd",null),Co([$e],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ju),EW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ia=function(){return ia=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ia.apply(this,arguments)},Wh=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},DW=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Yh=(function(n){EW(e,n);function e(){var t=n.apply(this,DW([],Wh(arguments),!1))||this;return t.modelType=zt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return ia(ia(ia({},o),Dt(t)),Dt(r))},e.prototype.initEdgeData=function(t){n.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var o=Wh(t,2),i=o[0],r=o[1];return"".concat(i.x,",").concat(i.y," ").concat(r.x,",").concat(r.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e})(Ju),AW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ra=function(){return ra=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ra.apply(this,arguments)},zn=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Kh=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},OW=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Cs=(function(n){AW(e,n);function e(){var t=n.apply(this,OW([],Kh(arguments),!1))||this;return t.modelType=zt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=za(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),n.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,o=n.prototype.getEdgeStyle.call(this),i=this.properties.style,r=i===void 0?{}:i;return ra(ra(ra({},o),Dt(t)),Dt(r))},e.prototype.getTextPosition=function(){var t,o=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!o){var i=this.dbClickPosition,r=i.x,s=i.y;return{x:r,y:s}}var a=$r(this.points),l=Kh(hX(a),2),u=l[0],c=l[1];return{x:(u.x+c.x)/2,y:(u.y+c.y)/2}},e.prototype.getAfterAnchor=function(t,o,i){var r,s;return i.forEach(function(a){var l;t===xn.HORIZONTAL?l=Math.abs(o.y-a.y):t===xn.VERTICAL&&(l=Math.abs(o.x-a.x)),(!s||s>l)&&(s=l,r=a)}),r},e.prototype.getCrossPoint=function(t,o,i){var r;return t===xn.HORIZONTAL?r={x:i.x,y:o.y}:t===xn.VERTICAL&&(r={x:o.x,y:i.y}),r},e.prototype.removeCrossPoints=function(t,o,i){var r=i.map(function(v){return v});if(t===1){var s=r[t],a=r[o],l=r[t-1],u=Th(l,s,this.sourceNode);if(u){var c=$h(s,a,this.sourceNode);if(c){var f=Ph(s,a,this.sourceNode);f&&(r[t]=f,r.splice(t-1,1),t--,o--)}}else{var p=this.sourceNode.anchors;p.forEach(function(v){if(v.x===l.x&&v.x===s.x||v.y===l.y&&v.y===s.y){var b=Yo(v.x,v.y,s.x,s.y),C=Yo(l.x,l.y,s.x,s.y);b<C&&(r[t-1]=v)}})}}if(o===i.length-2){var h=r[t],g=r[o],m=r[o+1],_=Th(g,m,this.targetNode);if(_){var c=$h(h,g,this.targetNode);if(c){var f=Ph(h,g,this.targetNode);f&&(r[o]=f,r.splice(o+1,1))}}else{var p=this.targetNode.anchors;p.forEach(function(b){if(b.x===m.x&&b.x===g.x||b.y===m.y&&b.y===g.y){var C=Yo(b.x,b.y,g.x,g.y),M=Yo(m.x,m.y,g.x,g.y);C<M&&(r[o+1]=b)}})}}return r},e.prototype.getDraggingPoints=function(t,o,i,r,s){var a=s.map(function(c){return c}),l=this.getAfterAnchor(t,i,r),u=this.getCrossPoint(t,i,l);return o==="start"?(a.unshift(u),a.unshift(l)):(a.push(u),a.push(l)),a},e.prototype.updateCrossPoints=function(t){var o=t.map(function(b){return b}),i=t[0],r=t[1],s=t[o.length-2],a=t[o.length-1],l=this,u=l.sourceNode,c=l.targetNode,f=u.modelType,p=c.modelType,h=eu(i,r),g=o[0];switch(f){case zt.RECT_NODE:if(u.radius!==0){var m=Vh(i,u);m||(g=jh(i,h,u))}break;case zt.CIRCLE_NODE:g=pc(i,h,u);break;case zt.ELLIPSE_NODE:g=Hh(i,h,u);break;case zt.DIAMOND_NODE:g=hl(i,h,u);break;case zt.POLYGON_NODE:g=hl(i,h,u);break}g&&(o[0]=g);var _=eu(s,a),v=o[o.length-1];switch(p){case zt.RECT_NODE:if(c.radius!==0){var m=Vh(a,c);m||(v=jh(a,_,c))}break;case zt.CIRCLE_NODE:v=pc(a,_,c);break;case zt.ELLIPSE_NODE:v=Hh(a,_,c);break;case zt.DIAMOND_NODE:v=hl(a,_,c);break;case zt.POLYGON_NODE:v=hl(a,_,c);break}return v&&(o[o.length-1]=v),o},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=n.prototype.getData.call(this),o=this.pointsList.map(function(i){var r=i.x,s=i.y;return{x:r,y:s}});return Object.assign({},t,{pointsList:o})},e.prototype.getPath=function(t){return t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=Mh({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,o){this.startPoint.x+=t,this.startPoint.y+=o,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,o){this.endPoint.x+=t,this.endPoint.y+=o,this.updatePoints()},e.prototype.updatePointsList=function(t,o){this.pointsList.forEach(function(s){s.x+=t,s.y+=o});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var r=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},r),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,u=t.direction,c=this.pointsList,f=c;return u===xn.HORIZONTAL?(c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y},f=this.pointsList.map(function(p){return p})):u===xn.VERTICAL&&(c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y},f=this.pointsList.map(function(p){return p})),this.updatePointsAfterDrag(f),this.draggingPointList=f,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition)),{start:an({},c[a]),end:an({},c[l]),startIndex:a,endIndex:l,direction:u}},e.prototype.dragAppend=function(t,o){var i;this.isDragging=!0;var r=t.start,s=t.end,a=t.startIndex,l=t.endIndex,u=t.direction,c=this.pointsList;if(u===xn.HORIZONTAL){c[a]={x:r.x,y:r.y+o.y},c[l]={x:s.x,y:s.y+o.y};var f=this.pointsList.map(function(_){return _});if(a!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(a,l,f)),a===0){var p={x:r.x,y:r.y+o.y},h=Ti(p,this.sourceNode);if(!h){var g=this.sourceNode.anchors;f=this.getDraggingPoints(u,"start",p,g,f)}}if(l===this.pointsList.length-1){var m={x:s.x,y:s.y+o.y},h=Ti(m,this.targetNode);if(!h){var g=this.targetNode.anchors;f=this.getDraggingPoints(u,"end",m,g,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}else if(u===xn.VERTICAL){c[a]={x:r.x+o.x,y:r.y},c[l]={x:s.x+o.x,y:s.y};var f=this.pointsList.map(function(v){return v});if(a!==0&&l!==this.pointsList.length-1&&(f=this.removeCrossPoints(a,l,f)),a===0){var p={x:r.x+o.x,y:r.y},h=Ti(p,this.sourceNode);if(!h){var g=this.sourceNode.anchors;f=this.getDraggingPoints(u,"start",p,g,f)}}if(l===this.pointsList.length-1){var m={x:s.x+o.x,y:s.y},h=Ti(m,this.targetNode);if(!h){var g=this.targetNode.anchors;f=this.getDraggingPoints(u,"end",m,g,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(an({},this.text,this.textPosition)),{start:an({},c[a]),end:an({},c[l]),startIndex:a,endIndex:l,direction:u}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=q_($r(this.points));this.pointsList=t.map(function(r){return r}),this.draggingPointList=[];var o=t[0];this.startPoint=an({},o);var i=t[t.length-1];this.endPoint=an({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var o=this.updateCrossPoints(t);this.points=o.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var o=t.startPoint,i=t.endPoint,r=t.sourceNode,s=t.targetNode;this.pointsList=Mh({x:o.x,y:o.y},{x:i.x,y:i.y},r,s,this.offset||0),this.initPoints()},zn([Pe],e.prototype,"offset",void 0),zn([Pe],e.prototype,"dbClickPosition",void 0),zn([$e],e.prototype,"initPoints",null),zn([$e],e.prototype,"updatePoints",null),zn([$e],e.prototype,"updateStartPoint",null),zn([$e],e.prototype,"moveStartPoint",null),zn([$e],e.prototype,"updateEndPoint",null),zn([$e],e.prototype,"moveEndPoint",null),zn([$e],e.prototype,"updatePointsList",null),zn([$e],e.prototype,"dragAppendStart",null),zn([$e],e.prototype,"dragAppendSimple",null),zn([$e],e.prototype,"dragAppend",null),zn([$e],e.prototype,"dragAppendEnd",null),zn([$e],e.prototype,"updatePointsAfterDrag",null),zn([$e],e.prototype,"getAdjustStart",null),zn([$e],e.prototype,"getAdjustEnd",null),zn([$e],e.prototype,"updateAfterAdjustStartAndEnd",null),e})(Ju),Rn=function(){return Rn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Rn.apply(this,arguments)},Et=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Jh=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},NW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},lr=(function(){function n(e,t){var o;this.BaseType=Sn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=$o.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=en.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=zt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(o=e.properties)!==null&&o!==void 0?o:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,o=t.x,i=o===void 0?0:o,r=t.y,s=r===void 0?0:r;this.transform=new tu(-i,-s).rotate(e).translate(i,s).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),n.prototype.initNodeData=function(e){var t=this;if(e.properties||(e.properties={}),!e.id){var o=this.graphModel.idGenerator,i=o&&o(e.type),r=this.createId();e.id=r||i||er()}this.formatText(e),an(this,AX(e));var s=this.graphModel,a=s.overlapMode,l=s.eventCenter;this.updateZIndexByOverlap(a,e.zIndex||Pa()),l.on("overlap:change",function(u){var c=u.overlapMode;t.updateZIndexByOverlap(c,t.zIndex||Pa())})},n.prototype.setAttributes=function(){},n.prototype.createId=function(){return null},n.prototype.setTextMode=function(e){this.textMode=e},n.prototype.formatText=function(e){var t,o,i,r=this.graphModel.editConfigModel,s=r.nodeTextDraggable,a=r.nodeTextEdit,l=e.x,u=e.y,c=e.text,f={value:"",x:l,y:u,draggable:s,editable:a};c&&(typeof c=="string"?f.value=c:(f=Rn(Rn({},f),{x:(t=c.x)!==null&&t!==void 0?t:l,y:(o=c.y)!==null&&o!==void 0?o:u,value:(i=c.value)!==null&&i!==void 0?i:""}),us(c.draggable)||(f.draggable=c.draggable),us(c.editable)||(f.editable=c.editable))),e.text=f},n.prototype.resize=function(e){var t=e.width,o=e.height,i=e.deltaX,r=e.deltaY,s=this.isAllowResizeNode(i,r,t,o);return s?(this.move(i/2,r/2),this.width=t,this.height=o,this.setProperties({width:t,height:o}),this.getData()):this.getData()},n.prototype.proportionalResize=function(){},n.prototype.getData=function(){var e=this.text,t=e.x,o=e.y,i=e.value,r=this.properties;ms(r)&&(r=qo(r)),Qn(r.width)&&(r.width=this.width),Qn(r.height)&&(r.height=this.height);var s={id:this.id,type:this.type,x:this.x,y:this.y,properties:r};return this.rotate&&(s.rotate=this.rotate),[Ln.INCREASE,Ln.STATIC].includes(this.graphModel.overlapMode)&&(s.zIndex=this.zIndex),i&&(s.text={x:t,y:o,value:i}),s},n.prototype.getHistoryData=function(){return this.getData()},n.prototype.getProperties=function(){return qo(this.properties)},n.prototype.getOuterGAttributes=function(){return{className:""}},n.prototype.getNodeStyle=function(){return Rn(Rn({},this.graphModel.theme.baseNode),this.style)},n.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,o=t===void 0?{}:t;return Rn(Rn({},Dt(e)),Dt(o))},n.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Dt(e)},n.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Dt(e)},n.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Dt(e)},n.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Dt(t)},n.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Dt(t)},n.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Dt(e)},n.prototype.isAllowConnectedAsSource=function(e,t,o,i){var r=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var u=r[l];if(!u.validate.call(this,this,e,t,o,i)){s=!1,a=u.message;break}}return{isAllPass:s,msg:a}},n.prototype.getConnectedSourceRules=function(){return this.sourceRules},n.prototype.isAllowConnectedAsTarget=function(e,t,o,i){var r=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var s=!0,a="",l=0;l<r.length;l++){var u=r[l];if(!u.validate.call(this,e,this,t,o,i)){s=!1,a=u.message;break}}return{isAllPass:s,msg:a}},n.prototype.isAllowMoveNode=function(e,t){var o,i,r=!0,s=!0,a=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var l=Jh(a),u=l.next();!u.done;u=l.next()){var c=u.value,f=c(this,e,t);if(!f)return!1;if(typeof f=="object"){var p=f;if(!p.x&&!p.y)return!1;r=r&&p.x,s=s&&p.y}}}catch(h){o={error:h}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}return{x:r,y:s}},n.prototype.getConnectedTargetRules=function(){return this.targetRules},n.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,o=e.id,i=e.x,r=e.y;return t&&t.length>0?t.map(function(s,a){return s.length?(s=s,{id:"".concat(o,"_").concat(a),x:i+s[0],y:r+s[1]}):(s=s,Rn(Rn({},s),{x:i+s.x,y:r+s.y,id:s.id||"".concat(o,"_").concat(a)}))}):this.getDefaultAnchor()},n.prototype.getDefaultAnchor=function(){return[]},n.prototype.getTargetAnchor=function(e){return kX(e,this)},n.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(n.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,o=t.x,i=t.y,r=t.rotate;return e.forEach(function(s){var a=s.x,l=s.y,u=NW(new Ja([a,l,1]).translate(-o,-i).rotate(r).translate(o,i)[0],2),c=u[0],f=u[1];s.x=c,s.y=f}),e},enumerable:!1,configurable:!0}),n.prototype.getAnchorInfo=function(e){if(!Qn(e))for(var t=0;t<this.anchors.length;t++){var o=this.anchors[t];if(o.id===e)return o}},n.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},n.prototype.isAllowMoveByXORY=function(e,t,o){var i,r;if(o)i=!0,r=!0;else{var s=this.isAllowMoveNode(e,t);typeof s=="boolean"?(i=s,r=s):(i=s.x,r=s.y)}return{isAllowMoveX:i,isAllowMoveY:r}},n.prototype.move=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY;return r&&(this.x=this.x+e,this.text&&this.moveText(e,0)),s&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(r||s)&&(this.rotate=this._rotate),r||s},n.prototype.getMoveDistance=function(e,t,o){o===void 0&&(o=!1);var i=this.isAllowMoveByXORY(e,t,o),r=i.isAllowMoveX,s=i.isAllowMoveY,a=0,l=0;return r&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),a=e),s&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),l=t),this.transform=new tu(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[a,l]},n.prototype.moveTo=function(e,t,o){o===void 0&&(o=!1);var i=e-this.x,r=t-this.y;return!o&&!this.isAllowMoveNode(i,r)?!1:(this.text&&this.moveText(i,r),this.x=e,this.y=t,!0)},n.prototype.moveText=function(e,t){var o=this.text,i=o.x,r=o.y,s=o.value,a=o.draggable,l=o.editable;this.text={value:s,editable:l,draggable:a,x:i+e,y:r+t}},n.prototype.updateText=function(e){this.text=Rn(Rn({},qo(this.text)),{value:e})},n.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},n.prototype.isAllowResizeNode=function(e,t,o,i){var r,s,a=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var l=Jh(a),u=l.next();!u.done;u=l.next()){var c=u.value,f=c(this,e,t,o,i);if(!f)return!1}}catch(p){r={error:p}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}return!0},n.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},n.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},n.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},n.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},n.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},n.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},n.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},n.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},n.prototype.updateProperties=function(e,t){var o=qo(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(pt.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:o,properties:e})},n.prototype.setProperty=function(e,t){var o=qo(this.properties),i=Dt(o);Oy(i,e,Jn(t)),this.updateProperties(i,[e])},n.prototype.setProperties=function(e){var t=qo(this.properties),o=Rn(Rn({},t),Jn(e)),i=[];Ny(e,function(r,s){(ma(t,s)&&t[s]!==r||!ma(t,s))&&i.push(s)}),this.updateProperties(o,i)},n.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},n.prototype.setStyle=function(e,t){var o;this.style=Rn(Rn({},this.style),(o={},o[e]=Jn(t),o))},n.prototype.setStyles=function(e){this.style=Rn(Rn({},this.style),Jn(e))},n.prototype.updateStyles=function(e){this.style=Rn({},Jn(e))},n.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},n.prototype.updateAttributes=function(e){an(this,e)},n.prototype.updateZIndexByOverlap=function(e,t){switch(e){case Ln.DEFAULT:this.zIndex=1;break;case Ln.EDGE_TOP:this.zIndex=0;break;case Ln.INCREASE:this.zIndex=t;break}},n.BaseType=Sn.NODE,Et([Pe],n.prototype,"type",void 0),Et([Pe],n.prototype,"x",void 0),Et([Pe],n.prototype,"y",void 0),Et([Pe],n.prototype,"textMode",void 0),Et([Pe],n.prototype,"text",void 0),Et([Pe],n.prototype,"properties",void 0),Et([Pe],n.prototype,"_width",void 0),Et([Pe],n.prototype,"_height",void 0),Et([Pe],n.prototype,"anchorsOffset",void 0),Et([Pe],n.prototype,"isSelected",void 0),Et([Pe],n.prototype,"isHovered",void 0),Et([Pe],n.prototype,"isShowAnchor",void 0),Et([Pe],n.prototype,"isDragging",void 0),Et([Pe],n.prototype,"isHitable",void 0),Et([Pe],n.prototype,"isHittable",void 0),Et([Pe],n.prototype,"draggable",void 0),Et([Pe],n.prototype,"visible",void 0),Et([Pe],n.prototype,"rotatable",void 0),Et([Pe],n.prototype,"resizable",void 0),Et([Pe],n.prototype,"zIndex",void 0),Et([Pe],n.prototype,"state",void 0),Et([Pe],n.prototype,"autoToFront",void 0),Et([Pe],n.prototype,"style",void 0),Et([Pe],n.prototype,"transform",void 0),Et([Pe],n.prototype,"_rotate",void 0),Et([mn],n.prototype,"incoming",null),Et([mn],n.prototype,"outgoing",null),Et([$e],n.prototype,"setTextMode",null),Et([$e],n.prototype,"addNodeMoveRules",null),Et([$e],n.prototype,"move",null),Et([$e],n.prototype,"getMoveDistance",null),Et([$e],n.prototype,"moveTo",null),Et([$e],n.prototype,"moveText",null),Et([$e],n.prototype,"updateText",null),Et([$e],n.prototype,"addNodeResizeRules",null),Et([$e],n.prototype,"setSelected",null),Et([$e],n.prototype,"setHovered",null),Et([$e],n.prototype,"setIsShowAnchor",null),Et([$e],n.prototype,"setRotatable",null),Et([$e],n.prototype,"setResizable",null),Et([$e],n.prototype,"setHitable",null),Et([$e],n.prototype,"setHittable",null),Et([$e],n.prototype,"setElementState",null),Et([$e],n.prototype,"setProperty",null),Et([$e],n.prototype,"setProperties",null),Et([$e],n.prototype,"deleteProperty",null),Et([$e],n.prototype,"setStyle",null),Et([$e],n.prototype,"setStyles",null),Et([$e],n.prototype,"updateStyles",null),Et([$e],n.prototype,"setZIndex",null),Et([$e],n.prototype,"updateAttributes",null),Et([$e],n.prototype,"updateZIndexByOverlap",null),n})(),MW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),sa=function(){return sa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},sa.apply(this,arguments)},wd=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},au=(function(n){MW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.circle,i=this.properties.style,r=i===void 0?{}:i;return sa(sa(sa({},t),Dt(o)),Dt(r))},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.r;return[{x:o,y:i-r,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+r,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.deltaX,r=t.deltaY;return this.move(i/2,r/2),this.r=o,this.setProperties({r:o}),this.getData()},wd([Pe],e.prototype,"r",void 0),wd([mn],e.prototype,"width",null),wd([mn],e.prototype,"height",null),e})(lr),TW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),aa=function(){return aa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},aa.apply(this,arguments)},Gr=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},gl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Cc=(function(n){TW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.diamond,i=this.properties.style,r=i===void 0?{}:i;return aa(aa(aa({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[[o,i-s],[o+r,i],[o,i+s],[o-r,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return ti(this.points,function(t){var o=gl(t,2),i=o[0],r=o[1];return{x:i,y:r}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Lt(this.points,function(i){var r=gl(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return Lt(this.points,function(i){var r=gl(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return ti(this.points,function(o,i){var r=gl(o,2),s=r[0],a=r[1];return{x:s,y:a,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},Gr([Pe],e.prototype,"rx",void 0),Gr([Pe],e.prototype,"ry",void 0),Gr([mn],e.prototype,"points",null),Gr([mn],e.prototype,"pointsPosition",null),Gr([mn],e.prototype,"width",null),Gr([mn],e.prototype,"height",null),e})(lr),$W=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),la=function(){return la=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},la.apply(this,arguments)},_l=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Sc=(function(n){$W(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.rx,i=t.ry;o&&(this.rx=o),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.ellipse,i=this.properties.style,r=i===void 0?{}:i;return la(la(la({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.rx,s=t.ry;return[{x:o,y:i-s,id:"".concat(this.id,"_0")},{x:o+r,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s,id:"".concat(this.id,"_2")},{x:o-r,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var o=t.width,i=t.height,r=t.deltaX,s=t.deltaY;return this.move(r/2,s/2),this.rx=o,this.ry=i,this.setProperties({rx:o,ry:i}),this.getData()},_l([Pe],e.prototype,"rx",void 0),_l([Pe],e.prototype,"ry",void 0),_l([mn],e.prototype,"width",null),_l([mn],e.prototype,"height",null),e})(lr),PW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ua=function(){return ua=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ua.apply(this,arguments)},ml=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},yl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},lu=(function(n){PW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.points,i=t.width,r=t.height,s=o||this.points;this.points=bX(s,i,r)},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.polygon,i=this.properties.style,r=i===void 0?{}:i;return ua(ua(ua({},t),Dt(o)),Dt(r))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return this.points.map(function(a){return{x:a[0]+o-r/2,y:a[1]+i-s/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=yl(i,1),s=r[0];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var r=yl(i,2),s=r[1];s<t&&(t=s),s>o&&(o=s)}),o-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,o=this,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points;return l.map(function(u,c){var f=yl(u,2),p=f[0],h=f[1];return{x:i+p-s/2,y:r+h-a/2,id:"".concat(t.id,"_").concat(c)}})},e.prototype.resize=function(t){var o=this,i=t.width,r=t.height,s=t.deltaX,a=t.deltaY;this.move(s/2,a/2);var l=ti(this.points,function(u){var c=yl(u,2),f=c[0],p=c[1];return[f*i/o.width,p*r/o.height]});return this.points=l,this.properties.points=l,this.getData()},ml([Pe],e.prototype,"points",void 0),ml([mn],e.prototype,"pointsPosition",null),ml([mn],e.prototype,"width",null),ml([mn],e.prototype,"height",null),e})(lr),RW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),da=function(){return da=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},da.apply(this,arguments)},BW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Ss=(function(n){RW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height,r=t.radius,s=this.getNodeStyle().radius;Qn(o)||(this.width=o),Qn(i)||(this.height=i),Qn(r)||(this.radius=r),Qn(s)||(this.radius=s)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.graphModel.theme.rect,i=this.properties.style,r=i===void 0?{}:i;return da(da(da({},t),Dt(o)),Dt(r))},BW([Pe],e.prototype,"radius",void 0),e})(lr),LW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ca=function(){return ca=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ca.apply(this,arguments)},Zh=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},IW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},FW=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Qh=(function(n){LW(e,n);function e(){var t=n.apply(this,FW([],IW(arguments),!1))||this;return t.modelType=zt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=n.prototype.getTextStyle.call(this),o=this.graphModel.theme.text,i=this.properties.textStyle;return ca(ca(ca({},t),Dt(o)),Dt(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=zh({rows:t,fontSize:o,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),o=this.getTextStyle().fontSize,i=zh({rows:t,fontSize:o,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),Zh([mn],e.prototype,"width",null),Zh([mn],e.prototype,"height",null),e})(lr),jW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ra=(function(n){jW(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.modelType=zt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this);var t=this.properties,o=t.width,i=t.height;o&&(this.width=o),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,o=t.x,i=t.y,r=t.width,s=t.height;return[{x:o,y:i-s/2,id:"".concat(this.id,"_0")},{x:o+r/2,y:i,id:"".concat(this.id,"_1")},{x:o,y:i+s/2,id:"".concat(this.id,"_2")},{x:o-r/2,y:i,id:"".concat(this.id,"_3")}]},e})(lr),rn=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},VW={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},bl=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical","isPinching"],HW=(function(){function n(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.isPinching=!1,this.textMode=$o.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=$o.TEXT,this.edgeTextMode=$o.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",an(this,this.computeConfig(e))}return n.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);an(this,t)},n.prototype.computeConfig=function(e){var t=e.isSilentMode,o=e.textDraggable,i=e.textMode,r=e.textEdit,s=e.adjustEdgeStartAndEnd,a={};if(t===!1&&an(a,this.stagedConfig),t===!0&&t!==this.isSilentMode){var l=Qr(VW,bl);this.stagedConfig=Qr(this,bl),an(a,l)}us(r)||an(a,{nodeTextEdit:r,edgeTextEdit:r}),us(o)||an(a,{nodeTextDraggable:o,edgeTextDraggable:o}),i&&an(a,{nodeTextMode:i,edgeTextMode:i}),Vd(s)&&an(a,{adjustEdgeStart:s,adjustEdgeEnd:s});var u=Qr(e,bl);return an(a,u)},n.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},n.prototype.getConfig=function(){return Qr(this,bl)},rn([Pe],n.prototype,"isSilentMode",void 0),rn([Pe],n.prototype,"stopZoomGraph",void 0),rn([Pe],n.prototype,"stopMoveGraph",void 0),rn([Pe],n.prototype,"stopScrollGraph",void 0),rn([Pe],n.prototype,"snapGrid",void 0),rn([Pe],n.prototype,"isPinching",void 0),rn([Pe],n.prototype,"textMode",void 0),rn([Pe],n.prototype,"textEdit",void 0),rn([Pe],n.prototype,"textDraggable",void 0),rn([Pe],n.prototype,"nodeTextEdit",void 0),rn([Pe],n.prototype,"nodeTextDraggable",void 0),rn([Pe],n.prototype,"nodeTextMultiple",void 0),rn([Pe],n.prototype,"nodeTextVertical",void 0),rn([Pe],n.prototype,"nodeTextMode",void 0),rn([Pe],n.prototype,"edgeTextMode",void 0),rn([Pe],n.prototype,"edgeTextEdit",void 0),rn([Pe],n.prototype,"edgeTextDraggable",void 0),rn([Pe],n.prototype,"edgeTextMultiple",void 0),rn([Pe],n.prototype,"edgeTextVertical",void 0),rn([Pe],n.prototype,"hideAnchors",void 0),rn([Pe],n.prototype,"allowRotate",void 0),rn([Pe],n.prototype,"allowResize",void 0),rn([Pe],n.prototype,"hoverOutline",void 0),rn([Pe],n.prototype,"nodeSelectedOutline",void 0),rn([Pe],n.prototype,"adjustNodePosition",void 0),rn([Pe],n.prototype,"autoExpand",void 0),rn([Pe],n.prototype,"adjustEdge",void 0),rn([Pe],n.prototype,"adjustEdgeMiddle",void 0),rn([Pe],n.prototype,"adjustEdgeStartAndEnd",void 0),rn([Pe],n.prototype,"adjustEdgeStart",void 0),rn([Pe],n.prototype,"adjustEdgeEnd",void 0),rn([Pe],n.prototype,"edgeSelectedOutline",void 0),rn([$e],n.prototype,"updateEditConfig",null),rn([$e],n.prototype,"updateTextMode",null),n})(),UW="*",zW=(function(){function n(){this._events={}}return n.prototype.on=function(e,t,o){var i=this;e==null||e.split(",").forEach(function(r){r=r.trim(),i._events[r]||(i._events[r]=[]),i._events[r].push({callback:t,once:!!o})})},n.prototype.once=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){i=i.trim(),o.on(i,t,!0)})},n.prototype.emit=function(e,t){var o=this;e==null||e.split(",").forEach(function(i){var r=o._events[i]||[],s=o._events[UW]||[],a=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var f=l[c],p=f.callback,h=f.once;h&&(l.splice(c,1),l.length===0&&delete o._events[i],u--,c--),p.apply(o,[t])}};a(r),a(s)})},n.prototype.off=function(e,t){var o=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete o._events[i];else{for(var r=o._events[i]||[],s=r.length,a=0;a<s;a++)r[a].callback===t&&(r.splice(a,1),s--,a--);r.length===0&&delete o._events[i]}})},n.prototype.getEvents=function(){return this._events},n.prototype.destroy=function(){this._events={}},n})(),qW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),GW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},XW=(function(n){qW(e,n);function e(t){var o=n.call(this)||this;o.stepScrollX=0,o.stepScrollY=0,o.pointers=new Map,o.onDragging=function(a){var l=a.deltaX,u=a.deltaY;o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.setState({isDragging:!0});var c=o.props.graphModel,f=c.transformModel,p=c.editConfigModel;p.stopMoveGraph!==!0&&f.translate(l,u)},o.onDragEnd=function(){o.setState({isDragging:!1})},o.zoomHandler=function(a){var l=o.props,u=l.graphModel,c=u.editConfigModel,f=u.transformModel,p=u.gridSize,h=l.graphModel,g=a.deltaX,m=a.deltaY,_=c.stopScrollGraph,v=c.stopZoomGraph;if(!_&&!a.ctrlKey&&!a.metaKey){if(a.preventDefault(),o.stepScrollX+=g,o.stepScrollY+=m,Math.abs(o.stepScrollX)>=p){var b=o.stepScrollX%p,C=o.stepScrollX-b;f.translate(-C*f.SCALE_X,0),o.stepScrollX=b}if(Math.abs(o.stepScrollY)>=p){var M=o.stepScrollY%p,O=o.stepScrollY-M;f.translate(0,-O*f.SCALE_Y),o.stepScrollY=M}return}if(!v){a.preventDefault();var k=h.getPointByClient({x:a.clientX,y:a.clientY}),E=k.canvasOverlayPosition,S=E.x,N=E.y;f.zoom(a.deltaY<0,[S,N])}},o.clickHandler=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){var u=o.props.graphModel,c=u.selectElements;c.size>0&&u.clearSelectElements(),u.eventCenter.emit(pt.BLANK_CLICK,{e:a})}},o.handleContextMenu=function(a){var l=a.target;if(l.getAttribute("name")==="canvas-overlay"){a.preventDefault();var u=o.props.graphModel,c=u.getPointByClient({x:a.clientX,y:a.clientY});u.eventCenter.emit(pt.BLANK_CONTEXTMENU,{e:a,position:c})}},o.pointerDownHandler=function(a){var l=o.props.graphModel,u=l.eventCenter,c=l.editConfigModel,f=l.transformModel.SCALE_X,p=l.gridSize;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.longPressTimer&&clearTimeout(o.longPressTimer),a.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.handleContextMenu(a)},500)),o.pointers.size===2){var h=o.props.graphModel,g=h.transformModel,m=h.editConfigModel,_=Array.from(o.pointers.values()),v=_[0].x-_[1].x,b=_[0].y-_[1].y,C=(_[0].x+_[1].x)/2,M=(_[0].y+_[1].y)/2;o.pinchStartDistance=Math.hypot(v,b),o.pinchStartScale=g.SCALE_X,o.stepDrag.cancelDrag(),o.pinchLastCenterX=C,o.pinchLastCenterY=M,m.updateEditConfig({isPinching:!0});return}var O=c.adjustEdge,k=c.adjustNodePosition,E=c.stopMoveGraph,S=a.target,N=!O&&!k;(S.getAttribute("name")==="canvas-overlay"||N)&&(E!==!0?(o.stepDrag.setStep(p*f),o.stepDrag.handleMouseDown(a)):u.emit(pt.BLANK_MOUSEDOWN,{e:a}),o.clickHandler(a))},o.pointerMoveHandler=function(a){var l;if(o.pointers.set(a.pointerId,{x:a.clientX,y:a.clientY}),o.pinchStartDistance&&o.pointers.size>=2){var u=o.props,c=u.graphModel,f=u.graphModel,p=f.editConfigModel,h=f.transformModel;if(p.stopZoomGraph)return;o.longPressTimer&&clearTimeout(o.longPressTimer);var g=Array.from(o.pointers.values()),m=g[0].x-g[1].x,_=g[0].y-g[1].y,v=Math.hypot(m,_),b=((l=o.pinchStartScale)!==null&&l!==void 0?l:h.SCALE_X)*(v/o.pinchStartDistance),C=(g[0].x+g[1].x)/2,M=(g[0].y+g[1].y)/2,O=c.getPointByClient({x:C,y:M}),k=O.canvasOverlayPosition,E=k.x,S=k.y;if(h.zoom(b,[E,S]),!p.stopMoveGraph||p.isPinching){var N=o.pinchLastCenterX===void 0?0:C-o.pinchLastCenterX,L=o.pinchLastCenterY===void 0?0:M-o.pinchLastCenterY;h.translate(N,L),o.pinchLastCenterX=C,o.pinchLastCenterY=M}a.preventDefault()}},o.pointerUpHandler=function(a){if(o.pointers.delete(a.pointerId),o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0),o.pointers.size<2){o.pinchStartDistance=void 0,o.pinchStartScale=void 0,o.pinchLastCenterX=void 0,o.pinchLastCenterY=void 0;var l=o.props.graphModel.editConfigModel;l.updateEditConfig({isPinching:!1})}};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new Fo({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"BLANK",isStopPropagation:!1,eventCenter:s,model:void 0}),o.state={isDragging:!1},o}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children,r=this.state.isDragging;return Re("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onPointerDown:this.pointerDownHandler,onPointerMove:this.pointerMoveHandler,onPointerUp:this.pointerUpHandler,onPointerCancel:this.pointerUpHandler,onContextMenu:this.handleContextMenu,style:{touchAction:"none",WebkitUserSelect:"none"},className:r?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able",children:Re("g",{transform:o,children:i})})},e=GW([eo],e),e})(Yt),om=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ba=function(){return Ba=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ba.apply(this,arguments)},WW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},YW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},ev=(function(n){om(e,n);function e(){var t=n.call(this)||this;return t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.bezierModel,l=r.type,u=s.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,c=u.x,f=u.y;a.updateAdjustAnchor({x:c,y:f},l),s.eventCenter.emit(pt.EDGE_ADJUST,{data:a.getData()})},t.onDragEnd=function(){var o=t.props.bezierModel;o.isDragging=!1},t.dragHandler=new Fo({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,o=this.props.position,i=o.x,r=o.y,s=this.props.bezierModel,a=s.getEdgeStyle().adjustAnchor;return Re(ws,Ba({className:"lf-bezier-adjust-anchor",x:i,y:r},a,{onPointerDown:function(l){t.dragHandler.handleMouseDown(l)}}))},e})(Yt),KW=(function(n){om(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,o){var i=t.path,r=t.id,s=Mf(i),a=YW(s,4),l=a[0],u=a[1],c=a[2],f=a[3],p=t.getEdgeStyle().adjustLine,h=[];return h.push(Re(xs,Ba({x1:l.x,y1:l.y,x2:u.x,y2:u.y},p))),h.push(Re(ev,{position:u,bezierModel:t,graphModel:o,type:"sNext"},"".concat(r,"_ePre"))),h.push(Re(xs,Ba({x1:f.x,y1:f.y,x2:c.x,y2:c.y},p))),h.push(Re(ev,{position:c,bezierModel:t,graphModel:o,type:"ePre"},"".concat(r,"_sNext"))),h},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,o=t.edges,i=[],r=0;r<o.length;r++){var s=o[r];s.isSelected&&s.modelType===zt.BEZIER_EDGE&&s.draggable&&i.push(this.getBezierAdjust(s,t))}return i},e.prototype.render=function(){return Re("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=WW([eo],e),e})(Yt),JW=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ZW=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},QW=(function(n){JW(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return Re("div",{className:"lf-background",children:Re("div",{style:My(t)?t:{},className:"lf-background-area"})})},e=ZW([eo],e),e})(Yt),eY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),tY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},as=(function(n){eY(e,n);function e(t){var o=n.call(this,t)||this;return o.id=er(),o.gridOptions=o.props.graphModel.grid,o}return e.prototype.renderDot=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,u=a.thickness,c=u===void 0?2:u,f=Math.min(Math.max(2,c),r/4),p=s?1:0;return Re("g",{fill:l,opacity:p,children:[Re("circle",{cx:0,cy:0,r:f/2}),Re("circle",{cx:0,cy:r,r:f/2}),Re("circle",{cx:r,cy:0,r:f/2}),Re("circle",{cx:r,cy:r,r:f/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,o=t.config,i=t.size,r=i===void 0?1:i,s=t.visible,a=o??{},l=a.color,u=a.thickness,c=u===void 0?1:u,f=Math.min(Math.max(1,c),r/2),p="M 0 0 H ".concat(r," V ").concat(r," H 0 Z"),h=s?1:0;return Re("path",{d:p,stroke:l,strokeWidth:f/2,opacity:h,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,o=t.transformModel,i=t.grid;this.gridOptions=i;var r=this.gridOptions,s=r.type,a=r.size,l=a===void 0?1:a,u=o.SCALE_X,c=o.SKEW_Y,f=o.SKEW_X,p=o.SCALE_Y,h=o.TRANSLATE_X,g=o.TRANSLATE_Y,m=[u,c,f,p,h,g].join(","),_="matrix(".concat(m,")");return Re("div",{className:"lf-grid",children:Re("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[Re("defs",{children:Re("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:_,x:"0",y:"0",width:l,height:l,children:[s==="dot"&&this.renderDot(),s==="mesh"&&this.renderMesh()]})}),Re("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=tY([eo],e),e})(Yt);(function(n){n.defaultProps={size:JG,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var o=Dt(n.defaultProps);return typeof t=="number"?an(o,{size:t}):typeof t=="boolean"?an(o,{visible:t}):an(o,t)}n.getGridOptions=e})(as||(as={}));var nY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),oY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},iY=(function(n){nY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,o=t.getTransformStyle().transform,i=this.props.children;return Re("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:Re("g",{transform:o,children:i})})},e=oY([eo],e),e})(Yt),rY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),qi=function(){return qi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},qi.apply(this,arguments)},sY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},aY=(function(n){rY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,o=t.nodes,i=t.editConfigModel,r=i.hoverOutline,s=i.nodeSelectedOutline,a=[];return o.forEach(function(l){if(l.isHovered||l.isSelected){var u=l.isHovered,c=l.isSelected,f=l.x,p=l.y,h=l.width,g=l.height;if(s&&c||r&&u){var m=l.getOutlineStyle(),_={};if(Object.keys(m).forEach(function(b){b!=="hover"&&(_[b]=m[b])}),u){var v=m.hover;_=qi(qi({},_),v)}a.push(Re(Ao,qi({transform:l.transform,className:"lf-outline-node",x:f,y:p,width:h+10,height:g+10},_)))}}}),a},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,o=t.edges,i=t.editConfigModel,r=i.edgeSelectedOutline,s=i.hoverOutline,a=[],l=0;l<o.length;l++){var u=o[l];(r&&u.isSelected||s&&u.isHovered)&&(u.modelType===zt.LINE_EDGE?a.push(this.getLineOutline(u)):u.modelType===zt.POLYLINE_EDGE?a.push(this.getPolylineOutline(u)):u.modelType===zt.BEZIER_EDGE&&a.push(this.getBezierOutline(u)))}return a},e.prototype.getLineOutline=function(t){var o=t.startPoint,i=t.endPoint,r=(o.x+i.x)/2,s=(o.y+i.y)/2,a=Math.abs(o.x-i.x)+10,l=Math.abs(o.y-i.y)+10,u=t.getOutlineStyle();return Re(Ao,qi({className:"lf-outline-edge",x:r,y:s,width:a,height:l},u))},e.prototype.getPolylineOutline=function(t){var o=t.points,i=$r(o),r=Da(i,8),s=r.x,a=r.y,l=r.width,u=r.height,c=t.getOutlineStyle();return Re(Ao,qi({className:"lf-outline",x:s,y:a,width:l,height:u},c))},e.prototype.getBezierOutline=function(t){var o=t.path,i=Mf(o),r=Da(i,8),s=r.x,a=r.y,l=r.width,u=r.height,c=t.getOutlineStyle();return Re(Ao,qi({className:"lf-outline",x:s,y:a,width:l,height:u},c))},e.prototype.render=function(){return Re("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=sY([eo],e),e})(Yt),lY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Gi=function(){return Gi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Gi.apply(this,arguments)},uY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},dY=(function(n){lY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,o=t??{},i=o.position,r=o.isShowHorizontal,s=o.isShowVertical,a=t==null?void 0:t.getStyle(),l=i??{},u=l.x,c=u===void 0?0:u,f=l.y,p=f===void 0?0:f,h=Gi(Gi({x1:-1e5,y1:p,x2:1e5,y2:p},a),{stroke:r?a==null?void 0:a.stroke:"none"}),g=Gi(Gi({x1:c,y1:-1e5,x2:c,y2:1e5},a),{stroke:s?a==null?void 0:a.stroke:"none"});return Re("g",{className:"lf-snapline",children:[Re(xs,Gi({},h)),Re(xs,Gi({},g))]})},e=uY([eo],e),e})(Yt),cY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},pY=(function(n){cY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,o=t.tool,i=t.graphModel,r=i.textEditElement,s=o.getTools(),a=s.map(function(l){return Ze(l,{textEditElement:r,graphModel:i,lf:o.instance})});return o.components=a,a},e.prototype.triggerToolRender=function(){var t=this.props,o=t.tool,i=t.graphModel,r=document.querySelector("#ToolOverlay_".concat(i.flowId)),s=o.getInstance();s.components.forEach(function(a){return a(s,r)}),s.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return Re("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=fY([eo],e),e})(Yt),Vo=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Xr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},hY={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},vY=(function(){function n(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var o=t.stopMoveGraph,i=o===void 0?!1:o;this.updateTranslateLimits(i)}return n.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},n.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},n.prototype.HtmlPointToCanvasPoint=function(e){var t=Xr(e,2),o=t[0],i=t[1];return[(o-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},n.prototype.CanvasPointToHtmlPoint=function(e){var t=Xr(e,2),o=t[0],i=t[1];return[o*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},n.prototype.moveCanvasPointByHtml=function(e,t,o){var i=Xr(e,2),r=i[0],s=i[1];return[r+t/this.SCALE_X,s+o/this.SCALE_Y]},n.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},n.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},n.prototype.zoom=function(e,t){e===void 0&&(e=!1);var o=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(o=e,i=e):e?(o+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(o-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),o<this.MINI_SCALE_SIZE||o>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(o-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=o,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},n.prototype.emitGraphTransform=function(e){this.eventCenter.emit(pt.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},n.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},n.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},n.prototype.focusOn=function(e,t,o,i){var r=Xr(this.CanvasPointToHtmlPoint([e,t]),2),s=r[0],a=r[1],l=Xr([o/2-s,i/2-a],2),u=l[0],c=l[1];this.TRANSLATE_X+=u,this.TRANSLATE_Y+=c,this.emitGraphTransform("focusOn")},n.prototype.updateTranslateLimits=function(e){var t;t=Xr(Array.isArray(e)&&e.length===4?e:hY[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},Vo([Pe],n.prototype,"SCALE_X",void 0),Vo([Pe],n.prototype,"SKEW_Y",void 0),Vo([Pe],n.prototype,"SKEW_X",void 0),Vo([Pe],n.prototype,"SCALE_Y",void 0),Vo([Pe],n.prototype,"TRANSLATE_X",void 0),Vo([Pe],n.prototype,"TRANSLATE_Y",void 0),Vo([Pe],n.prototype,"ZOOM_SIZE",void 0),Vo([$e],n.prototype,"zoom",null),Vo([$e],n.prototype,"resetZoom",null),Vo([$e],n.prototype,"translate",null),Vo([$e],n.prototype,"focusOn",null),n})(),gY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Cd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},_Y=(function(n){gY(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.parentTransform=o.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,o=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,o*=i.scaleY}else t*=this.parentTransform.SCALE_X,o*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:o}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,o=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),r=i.scaleX,s=i.scaleY;t=r*t,o=s*o}return{translateX:t,translateY:o}},e.prototype.HtmlPointToCanvasPoint=function(t){var o=Cd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,u=this.getCumulativeTranslate(),c=u.translateX,f=u.translateY;return[(i-c)/a,(r-f)/l]},e.prototype.CanvasPointToHtmlPoint=function(t){var o=Cd(t,2),i=o[0],r=o[1],s=this.getCumulativeScale(),a=s.scaleX,l=s.scaleY,u=this.getCumulativeTranslate(),c=u.translateX,f=u.translateY;return[i*a+c,r*l+f]},e.prototype.moveCanvasPointByHtml=function(t,o,i){var r=Cd(t,2),s=r[0],a=r[1],l=this.getCumulativeScale(),u=l.scaleX,c=l.scaleY;return[s+o/u,a+i/c]},e.prototype.fixDeltaXY=function(t,o){var i=this.getCumulativeScale(),r=i.scaleX,s=i.scaleY;return[t/r,o/s]},e})(vY),Wn=function(){return Wn=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wn.apply(this,arguments)},vt=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},mY=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Pn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},po=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},yY=(function(){function n(e){var t=this,o,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=Ln.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var r=e.container,s=e.partial,a=e.background,l=a===void 0?{}:a,u=e.grid,c=e.idGenerator,f=e.edgeGenerator,p=e.animation,h=e.customTrajectory;this.rootEl=r,this.partial=!!s,this.background=l,typeof u=="object"&&e.snapGrid&&(this.gridSize=u.size||1),this.customStyles=e.style||{},this.grid=as.getGridOptions(u??!1),this.theme=nm(e.style,e.themeMode),this.theme.grid=Dt(this.grid),this.theme.background=Dt(this.background),this.edgeType=e.edgeType||"polyline",this.animation=WG(p),this.overlapMode=e.overlapMode||Ln.DEFAULT,this.isMiniMap=e.isMiniMap||!1,this.width=(o=e.width)!==null&&o!==void 0?o:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Qn(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Qn(e.height);var g=new ResizeObserver(gg((function(m){var _,v;try{for(var b=mY(m),C=b.next();!C.done;C=b.next()){var M=C.value;M.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:M.contentRect}))}}catch(O){_={error:O}}finally{try{C&&!C.done&&(v=b.return)&&v.call(b)}finally{if(_)throw _.error}}}),16));g.observe(this.rootEl),this.waitCleanEffects.push(function(){g.disconnect()}),this.eventCenter=new zW,this.editConfigModel=new HW(e),this.transformModel=new _Y(this.eventCenter,e),this.flowId=er(),this.idGenerator=c,this.edgeGenerator=mX(this,f),this.customTrajectory=h}return Object.defineProperty(n.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,o){return e[t.id]={index:o,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelsMap",{get:function(){return po(po([],Pn(this.nodes),!1),Pn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortElements",{get:function(){for(var e=function(l){return po([],Pn(l),!1).sort(function(u,c){return u.zIndex-c.zIndex})},t=e(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1)),o=[],i=[-dl,-dl],r=[this.width+dl,this.height+dl],s=0;s<t.length;s++){var a=t[s];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,i,r,!1,!1))&&o.push(a)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(o){return o.state===en.TEXT_EDIT}),t=this.edges.find(function(o){return o.state===en.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),n.prototype.getAreaElement=function(e,t,o,i,r){var s=this;o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1);var a=[];return Lt(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1),function(l){var u=s.isElementInArea(l,e,t,o,i);(!r||l.visible)&&u&&a.push(l)}),a},n.prototype.getModel=function(e){return this.modelMap.get(e)},n.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getPointByClient=function(e){var t=e.x,o=e.y,i=this.rootEl.getBoundingClientRect(),r={x:t-i.left,y:o-i.top},s=Pn(this.transformModel.HtmlPointToCanvasPoint([r.x,r.y]),2),a=s[0],l=s[1],u={x:a,y:l};return{domOverlayPosition:r,canvasOverlayPosition:u}},n.prototype.isElementInArea=function(e,t,o,i,r){var s;if(i===void 0&&(i=!0),r===void 0&&(r=!0),e.BaseType===Sn.NODE){e=e;for(var a=vo(e),l=a.minX,u=a.minY,c=a.maxX,f=a.maxY,p=[{x:l,y:u},{x:c,y:u},{x:c,y:f},{x:l,y:f}],h=r,g=0;g<p.length;g++){var m=p[g],_=m.x,v=m.y;if(s=Pn(this.transformModel.CanvasPointToHtmlPoint([_,v]),2),_=s[0],v=s[1],yd([_,v],t,o)!==r){h=!r;break}}return h}if(e.BaseType===Sn.EDGE){e=e;var b=e.startPoint,C=e.endPoint,M=this.transformModel.CanvasPointToHtmlPoint([b.x,b.y]),O=this.transformModel.CanvasPointToHtmlPoint([C.x,C.y]),k=yd(M,t,o),E=yd(O,t,o);return i?k&&E:k||E}return!1},n.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=ti(e.nodes,function(i){var r=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(r.id,r),t.nodeModelMap.set(r.id,r),r}):this.nodes=[],e.edges){var o=this.edgeType;this.edges=ti(e.edges,function(i){var r,s=t.getModel((r=i.type)!==null&&r!==void 0?r:o);if(!s)throw new Error("找不到".concat(i.type,"对应的边。"));var a=new s(i,t);return t.edgeModelMap.set(a.id,a),t.elementsModelMap.set(a.id,a),a})}else this.edges=[]},n.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(o){var i=o.getData();i&&!o.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(o){var i=o.getData();i&&!o.virtual&&t.push(i)}),{nodes:t,edges:e}},n.prototype.modelToHistoryData=function(){for(var e=!1,t=[],o=0;o<this.nodes.length;o++){var i=this.nodes[o];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var r=!1,s=[],a=0;a<this.edges.length;a++){var l=this.edges[a];if(l.isDragging){r=!0;break}else s.push(l.getHistoryData())}return r?!1:{nodes:t,edges:s}},n.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},n.prototype.getElement=function(e){return this.modelsMap[e]},n.prototype.getNodeEdges=function(e){for(var t=[],o=0;o<this.edges.length;o++){var i=this.edges[o],r=i.sourceNodeId===e,s=i.targetNodeId===e;(r||s)&&t.push(i)}return t},n.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,o={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===Sn.NODE&&o.nodes.push(i.getData()),i.BaseType===Sn.EDGE){var r=i.getData(),s=t.get(r.sourceNodeId)&&t.get(r.targetNodeId);(e||s)&&o.edges.push(r)}}),o},n.prototype.updateAttributes=function(e,t){var o=this.getElement(e);o==null||o.updateAttributes(t)},n.prototype.changeNodeId=function(e,t){return t||(t=er()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(o){o.sourceNodeId===e&&(o.sourceNodeId=t),o.targetNodeId===e&&(o.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},n.prototype.changeEdgeId=function(e,t){return t||(t=er()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(o){o.id===e&&o.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},n.prototype.getTextModel=function(e){var t=this.editConfigModel,o=t.textMode,i=t.nodeTextMode,r=t.edgeTextMode;if(e.BaseType===Sn.NODE)return e.textMode||i||o||$o.TEXT;if(e.BaseType===Sn.EDGE)return e.textMode||r||o||$o.TEXT},n.prototype.setOverlapMode=function(e){this.overlapMode=e,this.eventCenter.emit("overlap:change",{overlapMode:e})},n.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},n.prototype.setFakeNode=function(e){this.fakeNode=e},n.prototype.removeFakeNode=function(){this.fakeNode=null},n.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},n.prototype.toFront=function(e){var t,o,i,r=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((o=this.edgesMap[e])===null||o===void 0?void 0:o.model);if(r){if(this.overlapMode===Ln.STATIC)return;if(this.overlapMode===Ln.INCREASE){this.setElementZIndex(e,"top");return}(i=this.topElement)===null||i===void 0||i.setZIndex(),r.setZIndex(KG),this.topElement=r}},n.prototype.setElementZIndex=function(e,t){var o,i,r=((o=this.nodesMap[e])===null||o===void 0?void 0:o.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(r){var s=void 0;typeof t=="number"?s=t:(t==="top"&&(s=Pa()),t==="bottom"&&(s=SW())),r.setZIndex(s)}},n.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,o=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(pt.NODE_DELETE,{data:o,model:t})},n.prototype.addNode=function(e,t,o){t===void 0&&(t=pt.NODE_ADD);var i=Jn(e),r=i.id;r&&this.nodesMap[r]&&delete i.id;var s=this.getModelAfterSnapToGrid(i);this.nodes.push(s);var a=s.getData(),l={data:a};return o&&(l.e=o),this.eventCenter.emit(t,l),s},n.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),o=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,r=e.y;i&&r&&(e.x=bs(i,this.gridSize,o),e.y=bs(r,this.gridSize,o),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-r));var s=new t(e,this);return this.nodeModelMap.set(s.id,s),this.elementsModelMap.set(s.id,s),s},n.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){o.x+=30,o.y+=30,o.id="",typeof o.text=="object"&&o.text!==null&&(o.text.x+=30,o.text.y+=30);var i=this.addNode(o);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},n.prototype.moveNode=function(e,t,o,i){var r;i===void 0&&(i=!1);var s=this.nodesMap[e];if(!s){console.warn("不存在id为".concat(e,"的节点"));return}var a=s.model;r=Pn(a.getMoveDistance(t,o,i),2),t=r[0],o=r[1],this.moveEdge(e,t,o)},n.prototype.moveNode2Coordinate=function(e,t,o,i){i===void 0&&(i=!1);var r=this.nodesMap[e];if(!r){console.warn("不存在id为".concat(e,"的节点"));return}var s=r.model,a=s.x,l=s.y,u=t-a,c=o-l;this.moveNode(e,u,c,i)},n.prototype.editText=function(e){this.setElementStateById(e,en.TEXT_EDIT)},n.prototype.addEdge=function(e){var t=Jn(e),o=t.type;o||(o=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(o);if(!i)throw new Error("找不到".concat(o,"对应的边，请确认是否已注册此类型边。"));var r=new i(Wn(Wn({},t),{type:o}),this);this.edgeModelMap.set(r.id,r),this.elementsModelMap.set(r.id,r);var s=r.getData();return this.edges.push(r),this.eventCenter.emit(pt.EDGE_ADD,{data:s}),r},n.prototype.moveEdge=function(e,t,o){for(var i=0;i<this.edges.length;i++){var r=this.edges[i],s=r.textPosition,a=s.x,l=s.y,u=this.edges[i].sourceNodeId===e,c=this.edges[i].targetNodeId===e;u&&r.moveStartPoint(t,o),c&&r.moveEndPoint(t,o),(u||c)&&this.handleEdgeTextMove(r,a,l)}},n.prototype.handleEdgeTextMove=function(e,t,o){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===zt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var r=e.text,s=X_(r,e.points);e.moveText(s.x-r.x,s.y-r.y)}var a=e.textPosition,l=a.x,u=a.y;e.moveText(l-t,u-o)},n.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var o=0;o<this.edges.length;o++)if(this.edges[o].sourceNodeId===e&&this.edges[o].targetNodeId===t){var i=this.edges[o].getData();this.edges.splice(o,1),o--,this.eventCenter.emit(pt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var o=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(o,1),this.eventCenter.emit(pt.EDGE_DELETE,{data:i})}},n.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(pt.EDGE_DELETE,{data:o})}},n.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var o=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(pt.EDGE_DELETE,{data:o})}},n.prototype.setElementStateById=function(e,t,o){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(en.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,o):i.setElementState(en.DEFAULT)})},n.prototype.updateText=function(e,t){var o=Or(po(po([],Pn(this.nodes),!1),Pn(this.edges),!1),function(i){return i.id===e});o==null||o.updateText(t)},n.prototype.selectNodeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.nodesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectEdgeById=function(e,t){var o;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(o=this.edgesMap[e])===null||o===void 0?void 0:o.model;i==null||i.setSelected(!0)},n.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var o=this.getElement(e);o==null||o.setSelected(!0)},n.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},n.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1),t==null||t.setHovered(!1)}),this.selectElements.clear(),[Ln.DEFAULT,Ln.EDGE_TOP].includes(this.overlapMode)&&((e=this.topElement)===null||e===void 0||e.setZIndex())},n.prototype.moveNodes=function(e,t,o,i){var r,s,a,l=this;i===void 0&&(i=!1);for(var u=e.reduce(function(C,M){var O,k=(O=l.nodesMap[M])===null||O===void 0?void 0:O.model;return k&&(C[M]=k.getMoveDistance(t,o,i)),C},{}),c=0;c<this.edges.length;c++){var f=this.edges[c],p=f.textPosition,h=p.x,g=p.y,m=u[f.sourceNodeId],_=u[f.targetNodeId],v=void 0,b=void 0;m&&_&&f.modelType===zt.POLYLINE_EDGE?(r=Pn(m,2),v=r[0],b=r[1],f.updatePointsList(v,b)):(m&&(s=Pn(m,2),v=s[0],b=s[1],f.moveStartPoint(v,b)),_&&(a=Pn(_,2),v=a[0],b=a[1],f.moveEndPoint(v,b))),(m||_)&&this.handleEdgeTextMove(f,h,g)}},n.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},n.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},n.prototype.setDefaultEdgeType=function(e){this.edgeType=e},n.prototype.changeNodeType=function(e,t){var o=this.getNodeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的节点"));return}var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var s=new r(i,this);this.nodes.splice(this.nodesMap[e].index,1,s);var a=this.getNodeEdges(e);a.forEach(function(l){if(l.sourceNodeId===e){var u=Uh(s,l.startPoint,s.width,s.height);l.updateStartPoint(u)}if(l.targetNodeId===e){var u=Uh(s,l.endPoint,s.width,s.height);l.updateEndPoint(u)}})},n.prototype.changeEdgeType=function(e,t){var o=this.getEdgeModelById(e);if(!o){console.warn("找不到id为".concat(e,"的边"));return}if(o.type!==t){var i=o.getData();i.type=t;var r=this.getModel(t);if(!r)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var s=new r(i,this);this.edges.splice(this.edgesMap[e].index,1,s)}},n.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetNodeId===e&&t.push(o)}),t},n.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceNodeId===e&&t.push(o)}),t},n.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.targetAnchorId===e&&t.push(o)}),t},n.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(o){o.sourceAnchorId===e&&t.push(o)}),t},n.prototype.getNodeIncomingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){var r;i.targetNodeId===e&&o.push((r=t.nodesMap[i.sourceNodeId])===null||r===void 0?void 0:r.model)}),o},n.prototype.getNodeOutgoingNode=function(e){var t=this,o=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&o.push(t.nodesMap[i.targetNodeId].model)}),o},n.prototype.setTheme=function(e,t){var o;if(t&&(Ta[t]&&this.updateBackgroundOptions(Wn(Wn({},typeof this.background=="object"?this.background:{}),Ta[t])),$a[t]&&this.updateGridOptions(as.getGridOptions(Wn(Wn({},this.grid),$a[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=as.getGridOptions((o=e.grid)!==null&&o!==void 0?o:!1);this.updateGridOptions(i)}this.theme=xW(Wn(Wn({},this.customStyles),e),t),this.customStyles=Wn(Wn({},this.customStyles),e)},n.prototype.getTheme=function(){var e=this,t=e.background,o=e.grid,i=Wn(Wn({},Dt(this.theme)),{background:t,grid:o});return i},n.prototype.updateGridOptions=function(e){ls(this.grid,e)},n.prototype.updateGridSize=function(e){this.gridSize=e},n.prototype.updateBackgroundOptions=function(e){Vd(e)||Vd(this.background)?this.background=e:this.background=Wn(Wn({},this.background),e)},n.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=Qn(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=Qn(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},n.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},n.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],o=[];e.forEach(function(p){var h=p.x,g=p.y,m=p.width,_=p.height,v=p.getNodeStyle().strokeWidth,b=v===void 0?0:v,C=h+m/2+b,M=h-m/2-b,O=g+_/2+b,k=g-_/2-b;t=t.concat([C,M].filter(function(E){return!Number.isNaN(E)})),o=o.concat([O,k].filter(function(E){return!Number.isNaN(E)}))});var i=Math.min.apply(Math,po([],Pn(t),!1)),r=Math.max.apply(Math,po([],Pn(t),!1)),s=Math.min.apply(Math,po([],Pn(o),!1)),a=Math.max.apply(Math,po([],Pn(o),!1)),l=r-i||0,u=a-s||0,c=i+l/2,f=s+u/2;return{width:l,height:u,x:c,y:f}},n.prototype.translateCenter=function(){var e=this,t=e.nodes,o=e.width,i=e.height,r=e.rootEl,s=e.transformModel;if(t.length){var a=o||r.clientWidth,l=i||r.clientHeight,u=this.getVirtualRectSize(),c=u.x,f=u.y;s.focusOn(c,f,a,l)}},n.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var o=this,i=o.nodes,r=o.width,s=o.height,a=o.rootEl,l=o.transformModel;if(i.length){var u=r||a.clientWidth,c=s||a.clientHeight,f=this.getVirtualRectSize(),p=f.width,h=f.height,g=f.x,m=f.y,_=(p+t)/u,v=(h+e)/c,b=1/Math.max(_,v),C=[u/2,c/2];l.zoom(b,C),l.focusOn(g,m,u,c)}},n.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},n.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},n.prototype.getPartial=function(){return this.partial},n.prototype.setPartial=function(e){this.partial=e},n.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},vt([Pe],n.prototype,"width",void 0),vt([Pe],n.prototype,"height",void 0),vt([Pe],n.prototype,"theme",void 0),vt([Pe],n.prototype,"grid",void 0),vt([Pe],n.prototype,"edgeType",void 0),vt([Pe],n.prototype,"nodes",void 0),vt([Pe],n.prototype,"edges",void 0),vt([Pe],n.prototype,"fakeNode",void 0),vt([Pe],n.prototype,"overlapMode",void 0),vt([Pe],n.prototype,"background",void 0),vt([Pe],n.prototype,"gridSize",void 0),vt([Pe],n.prototype,"transformModel",void 0),vt([Pe],n.prototype,"editConfigModel",void 0),vt([Pe],n.prototype,"partial",void 0),vt([mn],n.prototype,"nodesMap",null),vt([mn],n.prototype,"edgesMap",null),vt([mn],n.prototype,"modelsMap",null),vt([mn],n.prototype,"sortElements",null),vt([mn],n.prototype,"textEditElement",null),vt([mn],n.prototype,"selectElements",null),vt([mn],n.prototype,"selectNodes",null),vt([$e],n.prototype,"setOverlapMode",null),vt([$e],n.prototype,"setTextMode",null),vt([$e],n.prototype,"setFakeNode",null),vt([$e],n.prototype,"removeFakeNode",null),vt([$e],n.prototype,"setModel",null),vt([$e],n.prototype,"toFront",null),vt([$e],n.prototype,"setElementZIndex",null),vt([$e],n.prototype,"deleteNode",null),vt([$e],n.prototype,"addNode",null),vt([$e],n.prototype,"cloneNode",null),vt([$e],n.prototype,"moveNode",null),vt([$e],n.prototype,"moveNode2Coordinate",null),vt([$e],n.prototype,"editText",null),vt([$e],n.prototype,"addEdge",null),vt([$e],n.prototype,"moveEdge",null),vt([$e],n.prototype,"deleteEdgeBySourceAndTarget",null),vt([$e],n.prototype,"deleteEdgeById",null),vt([$e],n.prototype,"deleteEdgeBySource",null),vt([$e],n.prototype,"deleteEdgeByTarget",null),vt([$e],n.prototype,"setElementStateById",null),vt([$e],n.prototype,"updateText",null),vt([$e],n.prototype,"selectNodeById",null),vt([$e],n.prototype,"selectEdgeById",null),vt([$e],n.prototype,"selectElementById",null),vt([$e],n.prototype,"deselectElementById",null),vt([$e],n.prototype,"clearSelectElements",null),vt([$e],n.prototype,"moveNodes",null),vt([$e],n.prototype,"setDefaultEdgeType",null),vt([$e],n.prototype,"changeNodeType",null),vt([$e],n.prototype,"changeEdgeType",null),vt([$e],n.prototype,"getNodeIncomingEdge",null),vt([$e],n.prototype,"getNodeOutgoingEdge",null),vt([$e],n.prototype,"getAnchorIncomingEdge",null),vt([$e],n.prototype,"getAnchorOutgoingEdge",null),vt([$e],n.prototype,"getNodeIncomingNode",null),vt([$e],n.prototype,"getNodeOutgoingNode",null),vt([$e],n.prototype,"setTheme",null),vt([$e],n.prototype,"getTheme",null),vt([$e],n.prototype,"resize",null),vt([$e],n.prototype,"clearData",null),vt([$e],n.prototype,"translateCenter",null),vt([$e],n.prototype,"fitView",null),vt([$e],n.prototype,"openEdgeAnimation",null),vt([$e],n.prototype,"closeEdgeAnimation",null),vt([$e],n.prototype,"setPartial",null),n})(),br=function(){return br=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},br.apply(this,arguments)},Gs=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bY=(function(){function n(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return n.prototype.getStyle=function(){return br({},this.graphModel.theme.snapline)},n.prototype.getCenterSnapLine=function(e,t){for(var o=e.x,i=e.y,r=!1,s=!1,a=0;a<t.length;a++){var l=t[a];if(l.id!==e.id&&(Ho(o,l.x,this.epsilon)&&(r=!0),Ho(i,l.y,this.epsilon)&&(s=!0),r&&s))break}return{isShowVertical:r,isShowHorizontal:s,position:{x:o,y:i}}},n.prototype.getHorizontalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=vo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=vo(l))}}for(var u=0;u<t.length;u++){var c=t[u];if(c.id!==e.id){var f=vo(c);if(Ho(f.minY,s==null?void 0:s.minY,this.epsilon)||Ho(f.maxY,s==null?void 0:s.minY,this.epsilon)){o=!0,i=s.minY;break}if(Ho(f.minY,s==null?void 0:s.maxY,this.epsilon)||Ho(f.maxY,s==null?void 0:s.maxY,this.epsilon)){o=!0,i=s.maxY;break}}}return{isShowHorizontal:o,isShowVertical:this.isShowVertical,position:br(br({},this.position),{y:i})}},n.prototype.getVerticalSnapline=function(e,t){var o=!1,i=0,r=e.id,s;if(r){var a=this.graphModel.fakeNode;if(a&&a.id===r)s=vo(a);else{var l=this.graphModel.getNodeModelById(r);l&&(s=vo(l))}}for(var u=0;u<t.length;u++){var c=t[u];if(c.id!==e.id){var f=vo(c);if(Ho(f.minX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(Ho(f.minX,s==null?void 0:s.minX,this.epsilon)||Ho(f.maxX,s==null?void 0:s.minX,this.epsilon)){o=!0,i=s.minX;break}if(Ho(f.minX,s==null?void 0:s.maxX,this.epsilon)||Ho(f.maxX,s==null?void 0:s.maxX,this.epsilon)){o=!0,i=s.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:o,position:br(br({},this.position),{x:i})}},n.prototype.getSnapLinePosition=function(e,t){var o=this.getCenterSnapLine(e,t),i=o.isShowHorizontal,r=o.isShowVertical;if(!i){var s=this.getHorizontalSnapline(e,t);s.isShowHorizontal&&(o.isShowHorizontal=s.isShowHorizontal,o.position.y=s.position.y)}if(!r){var a=this.getVerticalSnapline(e,t);a.isShowVertical&&(o.isShowVertical=a.isShowVertical,o.position.x=a.position.x)}return o},n.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,o=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=o},n.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},n.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,o=this.getSnapLinePosition(e,t);this.setSnaplineInfo(o)},Gs([Pe],n.prototype,"isShowHorizontal",void 0),Gs([Pe],n.prototype,"isShowVertical",void 0),Gs([Pe],n.prototype,"position",void 0),Gs([$e],n.prototype,"clearSnapline",null),Gs([$e],n.prototype,"setNodeSnapLine",null),n})();function Ho(n,e,t){return Math.abs(n-e)<=t}var xY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wY=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},CY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},SY=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},kY=(function(n){xY(e,n);function e(){var t=n.apply(this,SY([],CY(arguments),!1))||this;return t.handleResize=function(){var o=t.props,i=o.graphModel,r=o.options,s=i.width,a=i.height,l=i.isContainerWidth,u=i.isContainerHeight,c=s,f=a,p=!1;l&&(c=void 0,p=!0),u&&(f=void 0,p=!0),p&&i.resize(c,f),r.width=s,r.height=a},t.throttleResize=Ty(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(pt.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,o,i){i===void 0&&(i="canvas-overlay");var r=this.props.getView,s=r(t.type);return s?Re(s,{model:t,graphModel:o,overlay:i},t.id):null},e.prototype.render=function(){var t=this,o=this.props,i=o.graphModel,r=o.tool,s=o.options,a=o.dnd,l=o.snaplineModel,u={};s.width&&(u.width="".concat(i.width,"px")),s.height&&(u.height="".concat(i.height,"px"));var c=i.fakeNode,f=i.editConfigModel,p=i.background,h=f.adjustEdge;return Re("div",{className:"lf-graph","flow-id":i.flowId,style:u,children:[Re(XW,{graphModel:i,dnd:a,children:[Re("g",{className:"lf-base",children:ti(i.sortElements,function(g){return t.getComponent(g,i)})}),c?this.getComponent(c,i):""]}),Re(iY,{graphModel:i,children:[Re(aY,{graphModel:i}),h?Re(KW,{graphModel:i}):"",s.snapline!==!1?Re(dY,{snaplineModel:l}):""]}),Re(pY,{graphModel:i,tool:r}),p&&Re(QW,{background:p}),Re(as,{graphModel:i})]})},e=wY([eo],e),e})(Yt),EY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fi=function(){return fi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fi.apply(this,arguments)},DY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},AY=(function(n){EY(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(o){var i=o.event,r=t.props,s=r.anchorData,a=r.nodeModel,l=r.graphModel;l.selectNodeById(a.id),a.autoToFront&&l.toFront(a.id),l.eventCenter.emit(pt.ANCHOR_DRAGSTART,{data:s,e:i,nodeModel:a}),t.setState({startX:s.x,startY:s.y,endX:s.x,endY:s.y})},t.onDragging=function(o){var i=o.event,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,u=s.transformModel,c=s.eventCenter,f=s.width,p=s.height,h=s.editConfigModel,g=h.autoExpand,m=h.stopMoveGraph;if(i){var _=i.clientX,v=i.clientY,b=s.getPointByClient({x:_,y:v}),C=b.domOverlayPosition,M=C.x,O=C.y,k=b.canvasOverlayPosition,E=k.x,S=k.y;t.t&&ru(t.t);var N=[],L=10;M<10?N=[L,0]:M+10>f?N=[-L,0]:O<10?N=[0,L]:O+10>p&&(N=[0,-L]),t.setState({endX:E,endY:S,dragging:!0}),t.moveAnchorEnd(E,S,i),N.length>0&&!m&&g&&(t.t=J_(function(){var $=DY(N,2),B=$[0],A=$[1];u.translate(B,A);var D=t.state,T=D.endX,F=D.endY;t.setState({endX:T-B,endY:F-A}),t.moveAnchorEnd(T-B,F-A,i)})),c.emit(pt.ANCHOR_DRAG,{data:l,e:i,nodeModel:a})}},t.onDragEnd=function(o){var i=o.event;t.t&&ru(t.t);var r=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var s=t.props,a=s.graphModel,l=s.nodeModel,u=s.anchorData;t.preTargetNode&&(t.preTargetNode.setHovered(!1),t.preTargetNode=void 0),a.eventCenter.emit(pt.ANCHOR_DRAGEND,{data:u,e:i,nodeModel:l,edgeModel:r??void 0})},t.checkEnd=function(o){var i,r=t.props,s=r.graphModel,a=r.nodeModel,l=r.anchorData,u=l.x,c=l.y,f=l.id,p=t.state,h=p.endX,g=p.endY,m=p.dragging,_=ou({x:h,y:g},s);if(t.preTargetNode&&t.preTargetNode.state!==en.DEFAULT&&t.preTargetNode.setElementState(en.DEFAULT),!!m&&_&&_.node){var v=_.node,b=_.anchor.id,C="".concat(a.id,"_").concat(v.id,"_").concat(b,"_").concat(f),M=t.sourceRuleResults.get(C)||{},O=M.isAllPass,k=M.msg,E=t.targetRuleResults.get(C)||{},S=E.isAllPass,N=E.msg;if(O&&S){v.setElementState(en.DEFAULT);var L=s.getNodeModelById(_.node.id),$=(i=s.edgeGenerator)===null||i===void 0?void 0:i.call(s,a.getData(),L==null?void 0:L.getData()),B=s.addEdge(fi(fi({},$),{sourceNodeId:a.id,sourceAnchorId:f,startPoint:{x:u,y:c},targetNodeId:_.node.id,targetAnchorId:_.anchor.id,endPoint:{x:_.anchor.x,y:_.anchor.y}})),A=t.props.anchorData;return s.eventCenter.emit(pt.ANCHOR_DROP,{data:A,e:o,nodeModel:a,edgeModel:B}),B}var D=v.getData();return s.eventCenter.emit(pt.CONNECTION_NOT_ALLOWED,{data:D,msg:N||k||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new Fo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,o=t.anchorData,i=t.style,r=t.node,s=r.getAnchorShape(o);if(s)return s;var a=o.x,l=o.y,u=fi(fi({},i),i==null?void 0:i.hover);return Re("g",{children:[Re(ws,fi({className:"lf-node-anchor-hover"},u,{x:a,y:l})),Re(ws,fi({className:"lf-node-anchor"},i,{x:a,y:l}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,o=t.graphModel,i=o.getAnchorIncomingEdge,r=o.getAnchorOutgoingEdge,s=t.anchorData.id;return{incomingEdgeList:i(s),outgoingEdgeList:r(s)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,o,i){var r,s,a=this.props,l=a.graphModel,u=a.nodeModel,c=a.anchorData,f=ou({x:t,y:o},l);if(f){var p=f.node,h=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(en.DEFAULT),c.id===h)return;this.preTargetNode=p;var g="".concat(u.id,"_").concat(p.id,"_").concat(h,"_").concat(c.id);if(!this.targetRuleResults.has(g)){var m=f.anchor,_=u.isAllowConnectedAsSource(p,c,m),v=p.isAllowConnectedAsTarget(u,c,m);this.sourceRuleResults.set(g,iu(_)),this.targetRuleResults.set(g,iu(v))}var b=((r=this.sourceRuleResults.get(g))!==null&&r!==void 0?r:{}).isAllPass,C=((s=this.targetRuleResults.get(g))!==null&&s!==void 0?s:{}).isAllPass;if(b&&C?p.setElementState(en.ALLOW_CONNECT):p.setElementState(en.NOT_ALLOW_CONNECT),!p.isHovered){var M=p.getData();i&&l.eventCenter.emit(pt.NODE_MOUSEENTER,{data:M,e:i}),p.setHovered(!0)}}else if(this.preTargetNode&&this.preTargetNode.state!==en.DEFAULT){this.preTargetNode.setElementState(en.DEFAULT);var O=this.preTargetNode.getData();i&&l.eventCenter.emit(pt.NODE_MOUSELEAVE,{data:O,e:i}),this.preTargetNode.setHovered(!1),this.preTargetNode=void 0}},e.prototype.isShowLine=function(){var t=this.state,o=t.startX,i=t.startY,r=t.endX,s=t.endY,a=Yo(o,i,r,s);return a>10},e.prototype.render=function(){var t=this,o=this.state,i=o.startX,r=o.startY,s=o.endX,a=o.endY,l=this.props,u=l.anchorData,c=l.edgeStyle,f=l.nodeModel,p=l.graphModel,h=u.edgeAddable;return Re("g",{className:"lf-anchor",children:[Re("g",{onClick:function(g){g.stopPropagation(),p.eventCenter.emit(pt.ANCHOR_CLICK,{data:u,e:g,nodeModel:f})},onPointerDown:function(g){p.eventCenter.emit(pt.ANCHOR_MOUSEDOWN,{data:u,e:g,nodeModel:f}),h!==!1&&t.dragHandler.handleMouseDown(g)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(fi({sourcePoint:{x:i,y:r},targetPoint:{x:s,y:a}},c)):Re(xs,fi({x1:i,y1:r,x2:s,y2:a},c,{"pointer-events":"none"})))]})},e})(Yt),OY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),kc=function(){return kc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},kc.apply(this,arguments)},NY=(function(n){OY(e,n);function e(t){var o=n.call(this,t)||this;return o.style={},o.onDragging=function(i){var r,s=i.event,a=o.props,l=a.graphModel,u=a.nodeModel,c=a.eventCenter,f=l.selectNodes,p=u.x,h=u.y,g=s.clientX,m=s.clientY,_=l.getPointByClient({x:g,y:m}).canvasOverlayPosition,v=_.x,b=_.y,C=new Xn(v-p,b-h),M=((r=o.normal)===null||r===void 0?void 0:r.angle(C))-o.defaultAngle,O=new tu(-p,-h).rotate(M).translate(p,h).toString();u.transform=O,u.rotate=M;var k=ti(f,function(S){return S.id});k.indexOf(u.id)===-1&&(k=[u.id]);var E=$y(k,function(S,N){var L=l.getNodeModelById(N);return S[N]=L==null?void 0:L.getMoveDistance(0,0,!1),S},{});k.forEach(function(S){var N=l.getNodeEdges(S);N.forEach(function(L){if(E[L.sourceNodeId]){var $=l.getNodeModelById(L.sourceNodeId),B=$.anchors.find(function(A){return A.id===L.sourceAnchorId});L.updateStartPoint(B)}if(E[L.targetNodeId]){var $=l.getNodeModelById(L.targetNodeId),B=$.anchors.find(function(T){return T.id===L.targetAnchorId});L.updateEndPoint(B)}})}),c.emit(pt.NODE_ROTATE,{e:s,model:u,data:u.getData()})},o.style=t.style,o.stepperDrag=new Fo({onDragging:o.onDragging}),o}return e.prototype.render=function(){var t=this,o=this.props.nodeModel,i=o.x,r=o.y,s=o.width,a=o.height,l=i+s/2+20,u=r-a/2-20;return this.normal=new Xn(1,0),this.defaultAngle=this.normal.angle(new Xn(l-i,u-r)),o.defaultAngle=this.defaultAngle,Re("g",{className:"lf-rotate-control",children:Re("g",{onPointerDown:function(c){t.stepperDrag.handleMouseDown(c)},children:Re(ws,kc({},this.style,{cx:l,cy:u}))})})},e})(Yt),Sd={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var tv;function MY(){return tv||(tv=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(r=i(r,o(a)))}return r}function o(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return t.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var s="";for(var a in r)e.call(r,a)&&r[a]&&(s=i(s,a));return s}function i(r,s){return s?r?r+" "+s:r+s:r}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(Sd)),Sd.exports}var TY=MY();const Ec=Ts(TY);var $Y=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Dc=function(){return Dc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Dc.apply(this,arguments)},PY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},im=(function(n){$Y(e,n);function e(t){var o=n.call(this)||this;o.mouseDownHandler=function(r){var s=o.props,a=s.draggable,l=s.model,u=s.graphModel,c=u.editConfigModel.nodeTextDraggable;(a??c)&&(r.stopPropagation(),o.stepperDrag.model=l,o.stepperDrag.handleMouseDown(r))},o.onDragging=function(r){var s=r.deltaX,a=r.deltaY,l=o.props,u=l.model,c=l.graphModel.transformModel;if(s||a){var f=PY(c.fixDeltaXY(s,a),2),p=f[0],h=f[1];u.moveText(p,h)}},o.dbClickHandler=function(){var r=o.props,s=r.editable,a=r.graphModel.eventCenter,l=r.model;s&&l.setElementState(en.TEXT_EDIT),a.emit(pt.TEXT_DBCLICK,{data:l.text,model:l})};var i=t.draggable;return o.stepperDrag=new Fo({onDragging:o.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),o}return e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=o.text,a=s.value,l=s.x,u=s.y,c=s.editable,f=s.draggable,p={x:l,y:u,className:"",value:a},h=o.getTextStyle(),g=r.nodeTextDraggable||f;return Re(Z_,Dc({},p,h,{className:Ec({"lf-element-text":c,"lf-text-draggable":!c&&g,"lf-text-disabled":!c&&!g}),model:o}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return Re("g",{onPointerDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e})(Yt),RY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Uo=function(){return Uo=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Uo.apply(this,arguments)},xl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},BY=(function(n){RY(e,n);function e(t){var o=n.call(this,t)||this;return o.setHoverOn=function(){o.setState({isHovered:!0})},o.setHoverOff=function(){o.setState({isHovered:!1})},o.state={isHovered:!1},o}return e.prototype.getBackground=function(){var t=this.state.isHovered,o=this.props.model,i=o.text,r=o.getTextStyle(),s=r.background||{};if(t&&r.hover&&r.hover.background&&(s=Uo(Uo({},s),r.hover.background)),i!=null&&i.value&&(s==null?void 0:s.fill)!=="transparent"){var a=r.fontSize,l=r.textWidth,u=r.lineHeight,c=r.overflowMode,f=s.wrapPadding,p=i==null?void 0:i.value.split(/[\r\n]/g),h=p.length,g=i.x,m=i.y,_={};if(c==="autoWrap"&&l){var v=K_({rows:p,style:{fontSize:"".concat(a,"px"),width:"".concat(l,"px"),lineHeight:u,padding:f},rowsLength:h,className:"lf-get-text-height"});_=Uo(Uo({},s),{x:g,y:m,width:l,height:v})}else{var b=yX({rows:p,rowsLength:h,fontSize:a}),C=b.width,M=b.height;if(c==="ellipsis"&&(C=l,M=a+2),typeof s.wrapPadding=="string"){var O=s.wrapPadding.split(",").filter(function(X){return X.trim()}).map(function(X){return parseFloat(X.trim())});if(O.length>0&&O.length<=4){if(O.length===1){var k=xl(O,1),E=k[0];O=[E,E,E,E]}else if(O.length===2){var S=xl(O,2),N=S[0],L=S[1];O=[N,L,N,L]}else if(O.length===3){var $=xl(O,3),B=$[0],L=$[1],A=$[2];O=[B,L,A,L]}var D=xl(O,4),T=D[0],F=D[1],V=D[2],P=D[3];C+=F+P,M+=T+V,g=g+(F-P)/2,m=m+(V-T)/2}}_=Uo(Uo({},s),{x:g-1,y:m-1,width:C,height:M})}return Re(Ao,Uo({},_))}return null},e.prototype.getShape=function(){var t=this.props.model,o=t.text,i=o.x,r=o.y,s=o.value;if(!s)return null;var a=t.getTextStyle(),l=Uo({x:i,y:r,value:s,model:t,className:"lf-element-text"},a);return Re("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),Re(Z_,Uo({},l))]})},e})(im),LY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),uu=function(){return uu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},uu.apply(this,arguments)},IY=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},wl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},ur=(function(n){LY(e,n);function e(t){var o=n.call(this)||this;o.onDragStart=function(l){var u=l.event,c=o.props,f=c.model,p=c.graphModel;if(u){var h=p.getPointByClient({x:u.clientX,y:u.clientY}).canvasOverlayPosition,g=h.x,m=h.y;o.moveOffset={dx:f.x-g,dy:f.y-m}}},o.onDragging=function(l){var u,c,f,p,h=l.event,g=o.props,m=g.model,_=g.graphModel,v=_.editConfigModel,b=v.stopMoveGraph,C=v.autoExpand,M=v.snapGrid,O=_.transformModel,k=_.selectNodes,E=_.width,S=_.height,N=_.gridSize;m.isDragging=!0;var L=h,$=L.clientX,B=L.clientY,A=_.getPointByClient({x:$,y:B}).canvasOverlayPosition,D=A.x,T=A.y,F=wl(O.CanvasPointToHtmlPoint([D,T]),2),V=F[0],P=F[1];if(D=D+((c=(u=o.moveOffset)===null||u===void 0?void 0:u.dx)!==null&&c!==void 0?c:0),T=T+((p=(f=o.moveOffset)===null||f===void 0?void 0:f.dy)!==null&&p!==void 0?p:0),D=bs(D,N,M),T=bs(T,N,M),!E||!S){_.moveNode2Coordinate(m.id,D,T);return}var X=V<0||P<0||V>E||P>S;if(!(C&&!b&&X)){var oe=wl(O.CanvasPointToHtmlPoint([D-m.width/2,T-m.height/2]),2),H=oe[0],W=oe[1],Z=wl(O.CanvasPointToHtmlPoint([D+m.width/2,T+m.height/2]),2),le=Z[0],te=Z[1],q=Math.max(N,20),re=[];H<0?re=[q,0]:le>_.width?re=[-q,0]:W<0?re=[0,q]:te>_.height&&(re=[0,-q]),o.t&&ru(o.t);var ce=k.map(function(ve){return ve.id});ce.indexOf(m.id)===-1&&(ce=[m.id]),re.length>0&&!b&&C?o.t=J_(function(){var ve=wl(re,2),Ne=ve[0],ge=ve[1];O.translate(Ne??0,ge??0);var _e=-(Ne??0)/O.SCALE_X,st=-(ge??0)/O.SCALE_X;_.moveNodes(ce,_e,st)}):_.moveNodes(ce,D-m.x,T-m.y)}},o.onDragEnd=function(){o.t&&ru(o.t);var l=o.props.model;l.isDragging=!1},o.onMouseOut=function(l){YG()&&o.setHoverOff(l)},o.handleMouseUp=function(){var l=o.props.model;o.mouseUpDrag=l.isDragging,o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=void 0)},o.handleClick=function(l){var u=o.mouseUpDrag===!1,c=new Date().getTime();if(o.startTime){var f=c-o.startTime,p=o.props,h=p.model,g=p.graphModel;if(!(!u&&f>100)){u||(o.onDragEnd(),o.handleMouseUp());var m=h.getData(),_=g.getPointByClient({x:l.clientX,y:l.clientY}),v={data:m,e:l,position:_,isSelected:!1,isMultiple:!1},b=l.button===2,C=l.detail===2;if(!b){var M=g.editConfigModel,O=W_(l,M);v.isMultiple=O,h.isSelected&&!C&&O?(v.isSelected=!1,h.setSelected(!1)):(g.selectNodeById(h.id,O),v.isSelected=!0,M.isSilentMode||o.toFront()),C?(M.nodeTextEdit&&h.text.editable&&M.textMode===$o.TEXT&&(h.setSelected(!1),g.setElementStateById(h.id,en.TEXT_EDIT)),g.eventCenter.emit(pt.NODE_DBCLICK,v)):(g.eventCenter.emit(pt.ELEMENT_CLICK,v),g.eventCenter.emit(pt.NODE_CLICK,v))}}}},o.handleContextMenu=function(l){l.preventDefault();var u=o.props,c=u.model,f=u.graphModel,p=f.editConfigModel,h=c.getData(),g=f.getPointByClient({x:l.clientX,y:l.clientY});f.setElementStateById(c.id,en.SHOW_MENU,g.domOverlayPosition),c.isSelected||f.selectNodeById(c.id),f.eventCenter.emit(pt.NODE_CONTEXTMENU,{data:h,e:l,position:g}),p.isSilentMode||o.toFront()},o.handleMouseDown=function(l){var u=o.props,c=u.model,f=u.graphModel;o.startTime=new Date().getTime();var p=f.editConfigModel;p.adjustNodePosition&&c.draggable&&o.stepDrag&&o.stepDrag.handleMouseDown(l),o.longPressTimer&&clearTimeout(o.longPressTimer),l.pointerType==="touch"&&(o.longPressTimer=window.setTimeout(function(){o.props.model.isDragging||o.handleContextMenu(l)},500))},o.handleFocus=function(){var l=o.props,u=l.model,c=l.graphModel;c.eventCenter.emit(pt.NODE_FOCUS,{data:u.getData()})},o.handleBlur=function(){if(o.props){var l=o.props,u=l.model,c=l.graphModel;c.eventCenter.emit(pt.NODE_BLUR,{data:u.getData()})}},o.setHoverOn=function(l){var u=o.props,c=u.model,f=u.graphModel;if(!c.isHovered){var p=c.getData();c.setHovered(!0),f.eventCenter.emit(pt.NODE_MOUSEENTER,{data:p,e:l})}},o.setHoverOff=function(l){var u=o.props,c=u.model,f=u.graphModel,p=c.getData();c.isHovered&&(c.setHovered(!1),f.eventCenter.emit(pt.NODE_MOUSELEAVE,{data:p,e:l}))};var i=t.graphModel,r=i.gridSize,s=i.eventCenter,a=t.model;return o.stepDrag=new Fo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"NODE",isStopPropagation:!1,eventCenter:s,model:a}),o.modelDisposer=w_(function(){return o.props},function(l){l&&l.model&&o.stepDrag.setModel(l.model)}),o}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.isSelected,a=i.isHitable,l=i.isDragging,u=i.isShowAnchor;return a&&(s||u)&&!l?ti(i.anchors,function(c,f){var p=i.getAnchorLineStyle(c),h=i.getAnchorStyle(c);return Re(AY,{anchorData:c,node:t,style:h,edgeStyle:p,anchorIndex:f,nodeModel:i,graphModel:r,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowRotate,l=o.isSelected,u=o.isHitable,c=o.rotatable,f=o.isHovered,p=a&&c,h=o.getRotateControlStyle();if(!s&&u&&(l||f)&&p)return Re(NY,{graphModel:i,nodeModel:o,eventCenter:i.eventCenter,style:h})},e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.isSilentMode,a=r.allowResize,l=o.isSelected,u=o.isHitable,c=o.resizable,f=o.isHovered,p=a&&c,h=o.getResizeControlStyle();return!s&&u&&(l||f)&&p?Re(YX,{style:h,model:o,graphModel:i}):null},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.nodeTextMode!==$o.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var a=!1;return s.nodeTextDraggable&&i.text.draggable&&(a=!0),Re(im,{editable:s.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,o=t.state,i=t.isDragging,r=t.isSelected,s="lf-node";switch(o){case en.ALLOW_CONNECT:s+=" lf-node-allow";break;case en.NOT_ALLOW_CONNECT:s+=" lf-node-not-allow";break;default:s+=" lf-node-default";break}return i&&(s+=" lf-dragging"),r&&(s+=" lf-node-selected"),s},e.prototype.toFront=function(){var t=this.props,o=t.model,i=t.graphModel;o.autoToFront&&i.toFront(o.id)},e.prototype.render=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.hideAnchors,a=r.adjustNodePosition,l=r.allowRotate,u=r.allowResize,c=i.gridSize,f=i.transformModel.SCALE_X,p=o.isHitable,h=o.draggable,g=o.transform,m=o.getOuterGAttributes(),_=m.className,v=_===void 0?"":_,b=IY(m,["className"]),C=Re("g",{className:"lf-node-content",children:[Re("g",{transform:g,children:[this.getShape(),this.getText(),l&&this.getRotateControl(),u&&this.getResizeControl()]}),!s&&this.getAnchors()]}),M;return p?(a&&h&&this.stepDrag.setStep(c*f),M=Re("g",uu({className:"".concat(this.getStateClassName()," ").concat(v),onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},b,{children:C}))):M=Re("g",uu({className:"".concat(this.getStateClassName()," ").concat(v)},b,{children:C})),M},e.isObserved=!1,e})(Yt),FY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ac=function(){return Ac=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ac.apply(this,arguments)},Pr=(function(n){FY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re(Ao,Ac({},o,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e})(ur),jY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Oc=function(){return Oc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Oc.apply(this,arguments)},du=(function(n){jY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.r,s=t.getNodeStyle();return Re(ws,Oc({},s,{x:o,y:i,r}))},e})(ur),VY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),cu=function(){return cu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},cu.apply(this,arguments)},fu=(function(n){VY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,u=t.getNodeStyle(),c={transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")};return Re("g",cu({},c,{children:Re($f,cu({},u,{points:l,x:i,y:r}))}))},e})(ur),HY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Nc=function(){return Nc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Nc.apply(this,arguments)},Mc=(function(n){HY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re("g",{children:Re($f,Nc({},o,{points:t.points,x:t.x,y:t.y}))})},e})(ur),UY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Tc=function(){return Tc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tc.apply(this,arguments)},$c=(function(n){UY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return Re(VX,Tc({},o,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e})(ur),zY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fa=function(){return fa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},fa.apply(this,arguments)},nv=(function(n){zY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,o=t.getTextStyle(),i=t.width,r=t.height,s=t.x,a=t.y,l=fa(fa({},o.background),{x:s,y:a,width:i,height:r});return Re(Ao,fa({},l))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return Re("g",{children:this.getBackground()})},e})(ur),qY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Pc=function(){return Pc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Pc.apply(this,arguments)},GY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},XY=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},La=(function(n){qY(e,n);function e(){var t=n.apply(this,XY([],GY(arguments),!1))||this;return t.ref=zu(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.height,s=t.width,a=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),Re("foreignObject",Pc({},a,{x:o-s/2,y:i-r/2,width:s,height:r,ref:this.ref}))},e})(ur),WY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),zo=function(){return zo=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zo.apply(this,arguments)},YY=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},KY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},hi;(function(n){n.SOURCE="SOURCE",n.TARGET="TARGET"})(hi||(hi={}));var ov=(function(n){WY(e,n);function e(t){var o=n.call(this)||this;o.handleMouseDown=function(l){o.stepDrag&&o.stepDrag.handleMouseDown(l)},o.onDragStart=function(){var l=o.props,u=l.x,c=l.y,f=l.edgeModel,p=f.startPoint,h=f.endPoint,g=f.pointsList;o.oldEdge={startPoint:p,endPoint:h,pointsList:g},o.setState({endX:u,endY:c,dragging:!0})},o.onDragging=function(l){var u=l.deltaX,c=l.deltaY,f=o.state,p=f.endX,h=f.endY,g=o.props,m=g.graphModel,_=g.type,v=m.transformModel,b=m.editConfigModel,C=KY(v.moveCanvasPointByHtml([p,h],u,c),2),M=C[0],O=C[1];o.setState({endX:M,endY:O,dragging:!0});var k=o.props.edgeModel,E=ou({x:p,y:h},m);if(E&&E.node&&o.isAllowAdjust(E).pass){var S=k.startPoint,N=k.endPoint,L=k.sourceNode,$=k.targetNode,B=_===hi.SOURCE?{startPoint:{x:E.anchor.x,y:E.anchor.y},endPoint:{x:N.x,y:N.y},sourceNode:E.node,targetNode:$}:{startPoint:{x:S.x,y:S.y},endPoint:{x:E.anchor.x,y:E.anchor.y},sourceNode:L,targetNode:E.node};k.updateAfterAdjustStartAndEnd(B)}else _===hi.SOURCE?k.updateStartPoint({x:M,y:O}):k.updateEndPoint({x:M,y:O});k.text.value&&b.adjustEdge&&k.setText(Object.assign({},k.text,k.textPosition))},o.onDragEnd=function(l){var u,c,f,p=l.event;try{o.setState({dragging:!1});var h=o.props,g=h.graphModel,m=h.edgeModel,_=h.type,v=o.state,b=v.endX,C=v.endY,M=v.dragging,O=ou({x:b,y:C},g);if(!M)return;var k=!1,E=void 0;if(O&&O.node){var S=o.isAllowAdjust(O),N=S.pass,L=S.msg,$=S.newTargetNode;if(N){var B=m.getData(),A=B.text,D=B.sourceAnchorId,T=D===void 0?"":D,F=B.targetAnchorId,V=F===void 0?"":F,P=YY(B,["text","sourceAnchorId","targetAnchorId"]);if(E=zo(zo({sourceAnchorId:T,targetAnchorId:V},P),{text:(A==null?void 0:A.value)||""}),_===hi.SOURCE){var X=g.getNodeModelById(O.node.id),oe=g.getNodeModelById(m.targetNodeId),H=(u=g.edgeGenerator)===null||u===void 0?void 0:u.call(g,X==null?void 0:X.getData(),oe==null?void 0:oe.getData(),E);E=zo(zo({},H),{sourceNodeId:O.node.id,sourceAnchorId:O.anchor.id,startPoint:{x:O.anchor.x,y:O.anchor.y},targetNodeId:m.targetNodeId,endPoint:zo({},m.endPoint)}),m.sourceNodeId===O.node.id&&m.sourceAnchorId===O.anchor.id&&(k=!0)}else if(_===hi.TARGET){var X=g.getNodeModelById(m.sourceNodeId),oe=g.getNodeModelById(O.node.id),H=(c=g.edgeGenerator)===null||c===void 0?void 0:c.call(g,X==null?void 0:X.getData(),oe==null?void 0:oe.getData(),E);E=zo(zo({},H),{sourceNodeId:m.sourceNodeId,startPoint:zo({},m.startPoint),targetNodeId:O.node.id,targetAnchorId:O.anchor.id,endPoint:{x:O.anchor.x,y:O.anchor.y}}),m.targetNodeId===O.node.id&&m.targetAnchorId===O.anchor.id&&(k=!0)}}else{k=!0;var W=$.getData();g.eventCenter.emit(pt.CONNECTION_NOT_ALLOWED,{data:W,msg:L})}}else k=!0;if(k)o.recoveryEdge();else{var Z=m.getData();g.deleteEdgeById(m.id);var le=g.addEdge(zo({},E));g.eventCenter.emit(pt.EDGE_EXCHANGE_NODE,{data:{newEdge:le.getData(),oldEdge:Z}})}(f=o.preTargetNode)===null||f===void 0||f.setElementState(en.DEFAULT)}finally{var g=o.props.graphModel;g.eventCenter.emit(pt.ADJUST_POINT_DRAGEND,{e:p,data:o.stepDragData})}},o.recoveryEdge=function(){var l=o.props.edgeModel,u=o.oldEdge,c=u.startPoint,f=u.endPoint,p=u.pointsList;l.updateStartPoint(c),l.updateEndPoint(f),l.modelType!==zt.LINE_EDGE&&(l.pointsList=p??[],l.initPoints())},o.getAdjustPointStyle=function(){var l=o.props.graphModel.theme,u=l.edgeAdjust;return u},o.state={dragging:!1,endX:0,endY:0},o.targetRuleResults=new Map,o.sourceRuleResults=new Map;var i=t.type,r=t.edgeModel,s=t.graphModel,a=s.eventCenter;return o.stepDragData={type:i,edgeData:r.getData()},o.stepDrag=new Fo({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:a,data:o.stepDragData}),o}return e.prototype.isAllowAdjust=function(t){var o=this.props,i=o.edgeModel,r=i.id,s=i.sourceNode,a=i.targetNode,l=i.sourceAnchorId,u=i.targetAnchorId,c=o.type,f,p,h,g;if(c===hi.SOURCE?(f=t.node,p=a,h=t.anchor,g=a.getAnchorInfo(u)):(f=s,p=t.node,g=t.anchor,h=s.getAnchorInfo(l)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(en.DEFAULT),this.preTargetNode=t.node,g.id===h.id)return{pass:!1,msg:"",newTargetNode:p};var m="".concat(f.id,"_").concat(p.id,"_").concat(h.id,"_").concat(g.id);if(!this.targetRuleResults.has(m)){var _=f.isAllowConnectedAsSource(p,h,g,r),v=p.isAllowConnectedAsTarget(f,h,g,r);this.sourceRuleResults.set(m,iu(_)),this.targetRuleResults.set(m,iu(v))}var b=this.sourceRuleResults.get(m),C=b.isAllPass,M=b.msg,O=this.targetRuleResults.get(m),k=O.isAllPass,E=O.msg,S=C&&k?en.ALLOW_CONNECT:en.NOT_ALLOW_CONNECT;return c===hi.SOURCE?f.setElementState(S):p.setElementState(S),{pass:C&&k,msg:E||M,newTargetNode:p}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.getAdjustPointShape,s=t.edgeModel,a=this.state.dragging;return Re("g",{pointerEvents:a?"none":"",onPointerDown:this.handleMouseDown,children:a?"":r(o,i,s)})},e})(Yt),JY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Rc=function(){return Rc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Rc.apply(this,arguments)};(function(n){JY(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,o=t.arrowInfo,i=t.style,r=o.start,s=o.end,a={start:r,end:s,offset:i.offset,verticalLength:i.verticalLength,type:"end"},l=Ea(a),u=l.leftX,c=l.leftY,f=l.rightX,p=l.rightY;return Rc({d:"M".concat(u," ").concat(c," L").concat(s.x," ").concat(s.y," L").concat(f," ").concat(p," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),o=t.d,i=t.strokeWidth,r=t.stroke,s=t.fill;return Re(Oa,{d:o,fill:s,strokeWidth:i,stroke:r})},e.prototype.render=function(){return Re("g",{className:"lf-arrow",children:this.getShape()})},e})(Yt);var ZY=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),pa=function(){return pa=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},pa.apply(this,arguments)},QY=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Zu=(function(n){ZY(e,n);function e(){var t=n.call(this)||this;return t.textRef=zu(),t.handleHover=function(o,i){var r=t.props,s=r.model,a=r.graphModel.eventCenter;s.setHovered(o);var l=o?pt.EDGE_MOUSEENTER:pt.EDGE_MOUSELEAVE,u=s.getData();a.emit(l,{data:u,e:i})},t.setHoverOn=function(o){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,o))},t.setHoverOff=function(o){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,o))},t.handleContextMenu=function(o){o.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,r=i.model,s=i.graphModel,a=s.editConfigModel,l=s.getPointByClient({x:o.clientX,y:o.clientY});s.setElementStateById(r.id,en.SHOW_MENU,l.domOverlayPosition),a.isSilentMode||t.toFront(),r.isSelected||s.selectEdgeById(r.id);var u=r==null?void 0:r.getData();s.eventCenter.emit(pt.EDGE_CONTEXTMENU,{data:u,e:o,position:l})},t.handleMouseDown=function(o){o.stopPropagation(),t.startTime=new Date().getTime(),t.longPressTimer&&clearTimeout(t.longPressTimer),o.pointerType==="touch"&&(t.longPressTimer=window.setTimeout(function(){t.props.model.isDragging||t.handleContextMenu(o)},500))},t.handleMouseUp=function(){var o=t.props.model;t.mouseUpDrag=o.isDragging,t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=void 0)},t.handleClick=function(o){if(t.startTime&&!t.mouseUpDrag){var i=o.button===2;if(!i){var r=o.detail===2,s=t.props,a=s.model,l=s.graphModel,u=a==null?void 0:a.getData(),c=l.getPointByClient({x:o.clientX,y:o.clientY});if(r){var f=l.editConfigModel,p=l.textEditElement,h=a.id,g=a.text,m=a.modelType;if(p&&p.id===h&&l.setElementStateById(h,en.DEFAULT),f.edgeTextEdit&&g.editable&&(a.setSelected(!1),l.setElementStateById(h,en.TEXT_EDIT)),m===zt.POLYLINE_EDGE){var _=a,v=l.getPointByClient({x:o.x,y:o.y}).canvasOverlayPosition,b=v.x,C=v.y;_.dbClickPosition=X_({x:b,y:C},_.points)}l.eventCenter.emit(pt.EDGE_DBCLICK,{data:u,e:o,position:c})}else l.eventCenter.emit(pt.ELEMENT_CLICK,{data:u,e:o,position:c}),l.eventCenter.emit(pt.EDGE_CLICK,{data:u,e:o,position:c});var M=l.editConfigModel;l.selectEdgeById(a.id,W_(o,M)),M.isSilentMode||t.toFront()}}},t.handleFocus=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(pt.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var o=t.props,i=o.model,r=o.graphModel;r.eventCenter.emit(pt.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return Re("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,o=this.props,i=o.model,r=o.graphModel,s=r.editConfigModel;if(s.edgeTextMode!==$o.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var a=!1;return s.edgeTextDraggable&&i.text.draggable&&(a=!0),Re(BY,{ref:this.textRef,editable:s.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:r,draggable:a})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isSelected,s=this.state.hover;return{start:o,end:i,hover:s,isSelected:r}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint;return[o,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,o=t.id,i=t.getArrowStyle(),r=i.refY,s=r===void 0?0:r,a=i.refX,l=a===void 0?2:a,u=QY(this.getLastTwoPoints(),2),c=u[0],f=u[1],p="auto";if(c&&f){var h=f.x-c.x,g=f.y-c.y;if(h!==0||g!==0){var m=cW(dW({x:h,y:g}));Number.isFinite(m)&&!Number.isNaN(m)&&(p=m)}}return Re("g",{children:Re("defs",{children:[Re("marker",{id:"marker-start-".concat(o),refX:-l,refY:s,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),Re("marker",{id:"marker-end-".concat(o),refX:l,refY:s,overflow:"visible",orient:p,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,o){var i=o.stroke,r=o.fill,s=r===void 0?i:r,a=o.strokeWidth,l=o.offset,u=l===void 0?10:l,c=o.verticalLength,f=o.strokeLinecap,p=o.strokeLinejoin,h=o.transform,g="";switch(t){case"solid":g="M".concat(-u/4,",0 L").concat(3*u/4,",").concat(c," L").concat(3*u/4,",-").concat(c," Z");break;case"hollow":g="M".concat(-u/4,",0 L").concat(3*u/4,",").concat(c," L").concat(-u/4,",0 L").concat(3*u/4,",-").concat(c," L").concat(-u/4,",0 Z");break;case"diamond":g="M".concat(-u/2,",0 L0,").concat(c," L").concat(u/2,",0 L0,-").concat(c," L").concat(-u/2,",0 Z");break;case"circle":g="M".concat(-u/2,",0 A").concat(u/4,",").concat(u/4," 0 1,0 ").concat(u/2,",0 A").concat(u/4,",").concat(u/4," 0 1,0 ").concat(-u/2,",0 Z");break;default:g="";break}return Re("path",{d:g,stroke:i,fill:s,strokeWidth:a,strokeLinecap:f,strokeLinejoin:p,transform:h})},e.prototype.getStartArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.startArrowType,u=l===void 0?"none":l,c=o.strokeLinecap,f=o.strokeLinejoin;return this.getArrowPath(u,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:f})},e.prototype.getEndArrow=function(){var t=this.props.model,o=t.getArrowStyle(),i=o.stroke,r=o.strokeWidth,s=o.offset,a=o.verticalLength,l=o.endArrowType,u=l===void 0?"solid":l,c=o.strokeLinecap,f=o.strokeLinejoin;return this.getArrowPath(u,{stroke:i,strokeWidth:r,offset:s,verticalLength:a,strokeLinecap:c,strokeLinejoin:f,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,o,i){var r=i.getAdjustPointStyle();return Re(ws,pa({className:"lf-edge-adjust-point"},r,{x:t,y:o}))},e.prototype.getAdjustPoints=function(){var t=this.props,o=t.model,i=t.graphModel,r=i.editConfigModel,s=r.adjustEdgeStartAndEnd,a=r.adjustEdgeStart,l=r.adjustEdgeEnd,u=o.getAdjustStart(),c=o.getAdjustEnd();return Re("g",{children:[s&&a&&Re(ov,pa({type:hi.SOURCE},u,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i})),s&&l&&Re(ov,pa({type:hi.TARGET},c,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return Re("g",{})},e.prototype.getAppend=function(){return Re("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,o=t.graphModel,i=t.model;o.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,o=t.isSelected,i=t.isHitable,r=t.isShowAdjustPoint;return Re("g",{children:[Re("g",{className:["lf-edge",!i&&"pointer-none",o&&"lf-edge-selected"].filter(Boolean).join(" "),style:{touchAction:"none",WebkitTouchCallout:"none"},onClick:this.handleClick,onContextMenu:this.handleContextMenu,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onPointerCancel:this.handleMouseUp,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),r&&o?this.getAdjustPoints():""]})},e.isObserved=!1,e})(Yt),eK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Bc=function(){return Bc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Bc.apply(this,arguments)},tK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Lc=(function(n){eK(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.getEdgeStyle(),i=t,r=i.path,s=i.isAnimation,a=i.arrowConfig,l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,p=l.animationName,h=l.animationDuration,g=l.animationIterationCount,m=l.animationTimingFunction,_=l.animationDirection;return Re(Oa,Bc({d:r},o,a,s?{strokeDasharray:u,stroke:c,style:{strokeDashoffset:f,animationName:p,animationDuration:h,animationIterationCount:g,animationTimingFunction:m,animationDirection:_}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return Re(Oa,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,o=this.state.hover,i=t.isSelected,r=t.getArrowStyle().offset,s=t.pointsList.map(function(f){return{x:f.x,y:f.y}}),a=tK(Lh(s,r),2),l=a[0],u=a[1],c={start:l,end:u,hover:o,isSelected:i};return c},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.getArrowStyle().offset,i=t.pointsList.map(function(r){return{x:r.x,y:r.y}});return Lh(i,o)},e})(Zu),nK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Ic=function(){return Ic=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ic.apply(this,arguments)},iv=(function(n){nK(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r=t.isAnimation,s=t.arrowConfig,a=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,c=l.stroke,f=l.strokeDashoffset,p=l.animationName,h=l.animationDuration,g=l.animationIterationCount,m=l.animationTimingFunction,_=l.animationDirection;return Re(xs,Ic({},a,{x1:o.x,y1:o.y,x2:i.x,y2:i.y},s,r?{strokeDasharray:u,stroke:c,style:{strokeDashoffset:f,animationName:p,animationDuration:h,animationIterationCount:g,animationTimingFunction:m,animationDirection:_}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,o=t.startPoint,i=t.endPoint,r={start:o,end:i},s=gX(r),a=s.d,l=s.strokeWidth,u=s.fill,c=s.strokeDasharray,f=s.stroke;return Re(Oa,{d:a,fill:u,strokeWidth:l,stroke:f,strokeDasharray:c})},e})(Zu),oK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xr=function(){return xr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xr.apply(this,arguments)},iK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},ks=(function(n){oK(e,n);function e(){var t=n.call(this)||this;return t.onDragStart=function(){var o=t.props.model;o.dragAppendStart(),t.isShowAdjustPointTemp=o.isShowAdjustPoint,o.isShowAdjustPoint=!1},t.onDragging=function(o){var i=o.deltaX,r=o.deltaY,s=t.props,a=s.model,l=s.graphModel;t.isDragging=!0;var u=l.transformModel,c=l.editConfigModel,f=iK(u.fixDeltaXY(i,r),2),p=f[0],h=f[1],g=a,m=c.adjustEdgeMiddle;m?t.appendInfo=g.dragAppendSimple(t.appendInfo,{x:p,y:h}):t.appendInfo=g.dragAppend(t.appendInfo,{x:p,y:h})},t.onDragEnd=function(){var o,i=t.props,r=i.model,s=i.graphModel.eventCenter,a=r;a.dragAppendEnd(),t.isDragging=!1,a.isShowAdjustPoint=(o=t.isShowAdjustPointTemp)!==null&&o!==void 0?o:!1,t.appendInfo=void 0,s.emit(pt.EDGE_ADJUST,{data:a.getData()})},t.beforeDragStart=function(o,i){i.draggable&&t.drag.handleMouseDown(o),t.appendInfo=i},t.drag=new Fo({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.getEdgeStyle(),a=t.getEdgeAnimationStyle(),l=a.strokeDasharray,u=a.stroke,c=a.strokeDashoffset,f=a.animationName,p=a.animationDuration,h=a.animationIterationCount,g=a.animationTimingFunction,m=a.animationDirection;return Re(qX,xr({points:o},s,r,i?{strokeDasharray:l,stroke:u,style:{strokeDashoffset:c,animationName:f,animationDuration:p,animationIterationCount:h,animationTimingFunction:g,animationDirection:m}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,o=t.points,i=t.isSelected,r=this.state.hover,s=$r(o),a=s[0],l=s[0];return s.length>=2&&(a=s[s.length-2],l=s[s.length-1]),{start:a,end:l,hover:r,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,o=t.points,i=$r(o),r=i[0],s=i[0];return i.length>=2&&(r=i[i.length-2],s=i[i.length-1]),[r,s]},e.prototype.getAppendAttributes=function(t){var o=t.start,i=t.end,r;if(o.x===i.x&&o.y===i.y)r="";else{var s={start:o,end:i,offset:10,verticalLength:5},a=Ea(xr(xr({},s),{type:"start"})),l=Ea(xr(xr({},s),{type:"end"}));r="M".concat(a.leftX," ").concat(a.leftY,`
      L`).concat(a.rightX," ").concat(a.rightY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(l.leftX," ").concat(l.leftY," z")}return{d:r,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var o=this.getAppendAttributes(t),i=o.d,r=o.strokeWidth,s=o.fill,a=o.strokeDasharray,l=o.stroke;return Re(Oa,{d:i,fill:s,strokeWidth:r,stroke:l,strokeDasharray:a})},e.prototype.getAppendWidth=function(){for(var t=this,o=this.props,i=o.model,r=o.graphModel,s=i.pointsList,a=i.draggable,l=[],u=s.length,c=function(h){var g="lf-polyline-append",m={start:{x:s[h].x,y:s[h].y},end:{x:s[h+1].x,y:s[h+1].y},startIndex:h,endIndex:h+1,direction:xn.HORIZONTAL,draggable:!0},_=Re("g",{className:g,children:f.getAppendShape(m)}),v=r.editConfigModel,b=v.adjustEdge,C=v.adjustEdgeMiddle;if(b&&a){var M=m.startIndex,O=m.endIndex,k=C&&(M===0||O===u-1);m.draggable=!k,m.start.x===m.end.x?(m.draggable&&(g+="-ew-resize"),m.direction=xn.VERTICAL):m.start.y===m.end.y&&(m.draggable&&(g+="-ns-resize"),m.direction=xn.HORIZONTAL),_=Re("g",{className:f.isDragging?"lf-dragging":"lf-drag-able",onPointerDown:function(E){return t.beforeDragStart(E,m)},children:Re("g",{className:g,children:f.getAppendShape(m)})})}l.push(_)},f=this,p=0;p<u-1;p++)c(p);return Re("g",{children:l})},e})(Zu),os=function(){return os=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},os.apply(this,arguments)},rK=(function(){function n(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,t.docPointerMove&&window.document.removeEventListener("pointermove",t.docPointerMove),t.docPointerUp&&window.document.removeEventListener("pointerup",t.docPointerUp)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(os(os({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(pt.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var r=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),s=r.x,a=r.y;t.fakeNode.moveTo(s,a);var l=t.fakeNode.getData();t.lf.setNodeSnapLine(l),t.lf.graphModel.eventCenter.emit(pt.NODE_DND_DRAG,{data:l,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(os(os({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),pt.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var o=e.lf;this.lf=o}return n.prototype.clientToLocalPoint=function(e){var t=e.x,o=e.y,i=za(this.lf.options,["grid","size"]),r=this.lf.graphModel.getPointByClient({x:t,y:o}),s=r.canvasOverlayPosition,a=s.x,l=s.y,u=this.lf.graphModel.editConfigModel.snapGrid;return{x:bs(a,i,u),y:bs(l,i,u)}},n.prototype.isInsideCanvas=function(e){var t=this.lf.graphModel.rootEl.querySelector('[name="canvas-overlay"]'),o=window.document.elementFromPoint(e.clientX,e.clientY);return o===t||o!==null&&!!t&&t.contains(o)},n.prototype.startDrag=function(e){var t=this,o=this.lf.graphModel.editConfigModel;o!=null&&o.isSilentMode||(this.nodeConfig=e,this.docPointerMove=function(i){if(t.nodeConfig){if(!t.isInsideCanvas(i)){t.onDragLeave();return}if(!t.fakeNode){t.dragEnter(i);return}t.onDragOver(i)}},this.docPointerUp=function(i){t.nodeConfig&&(t.isInsideCanvas(i)?t.onDrop(i):t.onDragLeave(),i.preventDefault(),i.stopPropagation(),t.stopDrag())},window.document.addEventListener("pointermove",this.docPointerMove),window.document.addEventListener("pointerup",this.docPointerUp))},n})();function sK(n,e){n.on("node:mousemove",function(t){var o=t.data;e.setNodeSnapLine(o)}),n.on("node:mouseup",function(){e.clearSnapline()})}var aK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Oi=function(){return Oi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Oi.apply(this,arguments)},lK=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},uK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},dK=(function(n){aK(e,n);function e(t){var o=n.call(this,t)||this;return o.ref=zu(),o.__prevText={type:"",text:"",id:""},o.keyupHandler=function(i){var r=o.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(r==null||r.setElementState(en.DEFAULT))},o.inputHandler=function(i){var r=i.target.innerText,s=o.props.graphModel.textEditElement;s&&(o.__prevText={type:s.type,text:r.replace(/(\r\n)+$|(\n)+$/,""),id:s.id})},o.keydownHandler=function(i){i.stopPropagation()},o.state={style:{left:0,top:0}},o}return e.getDerivedStateFromProps=function(t){var o,i=t.textEditElement,r=t.graphModel,s=r.transformModel,a=r.theme,l=a.inputText,u;if(i){if(!(!((o=i.text)===null||o===void 0)&&o.value)&&i.BaseType===Sn.EDGE){var c=i.text,f=i.textPosition,p=f.x,h=f.y;c.x=p,c.y=h,i.setText(c)}var g={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===Sn.EDGE){var m=a.edgeText,_=m.overflowMode,v=m.lineHeight,b=m.wrapPadding,C=m.textWidth;C&&_==="autoWrap"&&(u=Oi(Oi({},g),{width:C,minWidth:C,lineHeight:v,padding:b}))}else if(i.BaseType===Sn.NODE){var M=a.nodeText,_=M.overflowMode,v=M.lineHeight,b=M.wrapPadding,C=M.textWidth,O=i.width,k=i.modelType,E=i.textWidth,S=E||C||O;(k!==zt.TEXT_NODE&&_==="autoWrap"||k===zt.TEXT_NODE&&C)&&(u=Oi(Oi({},g),{width:S,minWidth:S,lineHeight:v,padding:b}))}var N=i.text,L=N.x,$=N.y,B=uK(s.CanvasPointToHtmlPoint([L,$]),2),A=B[0],D=B[1];return{style:Oi(Oi({left:A,top:D},u),l)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var o=this.__prevText,i=o.text,r=o.id;t.updateText(r,i),t.eventCenter.emit(pt.TEXT_UPDATE,{data:Oi({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var o=document.createRange();o.selectNodeContents(t),o.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(o)}},e.prototype.render=function(){var t,o=this.props.graphModel.textEditElement,i=this.state.style;return o?Re("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=o.text)===null||t===void 0?void 0:t.value},o.id):null},e.toolName="text-edit-tool",e=lK([eo],e),e})(Yt),cK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),fK=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},kd=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},pK=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},hK=(function(n){cK(e,n);function e(t){var o=n.call(this,t)||this;o.handleMouseDown=function(a){o.stepDrag.handleMouseDown(a)},o.handleWheelEvent=function(a){var l,u;a.preventDefault();var c=a.deltaX,f=a.deltaY,p=a.clientX,h=a.clientY,g=a.ctrlKey,m=new WheelEvent("wheel",{deltaX:c,deltaY:f,clientX:p,clientY:h,ctrlKey:g});(u=(l=o.props.lf.container)===null||l===void 0?void 0:l.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||u===void 0||u.dispatchEvent(m)},o.onDragging=function(a){var l=a.deltaX,u=a.deltaY,c=o.props,f=c.graphModel,p=c.lf,h=p.getTransform(),g=h.SCALE_X,m=h.SCALE_Y,_=f.getSelectElements(!0);f.moveNodes(_.nodes.map(function(v){return v.id}),l/g,u/m)},o.handleContextMenu=function(a){a.preventDefault();var l=o.props,u=l.graphModel,c=l.graphModel,f=c.eventCenter,p=c.selectElements,h=u.getPointByClient({x:a.clientX,y:a.clientY}),g={nodes:[],edges:[]},m=pK([],kd(p.values()),!1);m.forEach(function(_){_.BaseType===Sn.NODE&&g.nodes.push(_.getData()),_.BaseType===Sn.EDGE&&g.edges.push(_.getData())}),f.emit(pt.SELECTION_CONTEXTMENU,{data:g,e:a,position:h})};var i=t.graphModel,r=i.gridSize,s=i.eventCenter;return o.stepDrag=new Fo({onDragging:o.onDragging,step:r,eventType:"SELECTION",eventCenter:s}),o}return e.prototype.render=function(){var t,o,i=this.props.graphModel,r=i.selectElements,s=i.transformModel,a=this.props.lf.getTransform(),l=a.SCALE_X,u=a.SCALE_Y;if(!(r.size<=1)){var c=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;r.forEach(function(m){var _;m.BaseType===Sn.NODE&&(_=QG(m)),m.BaseType===Sn.EDGE&&(_=oX(m)),_!==void 0&&(c=Math.min(c,_.x),f=Math.min(f,_.y),p=Math.max(p,_.x1),h=Math.max(h,_.y1))}),t=kd(s.CanvasPointToHtmlPoint([c,f]),2),c=t[0],f=t[1],o=kd(s.CanvasPointToHtmlPoint([p,h]),2),p=o[0],h=o[1];var g={left:"".concat(c-20*l/2,"px"),top:"".concat(f-20*u/2,"px"),width:"".concat(p-c+20*l,"px"),height:"".concat(h-f+20*u,"px"),"border-width":"".concat(2*l,"px")};return Re("div",{className:"lf-multiple-select",style:g,onPointerDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=fK([eo],e),e})(Yt),Ed=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},vK=[dK,hK],gK=(function(){function n(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,Lt(vK,function(r){t.isDisabled(r.toolName)||t.registerTool(r.toolName,r)});var o=e.graphModel,i=o.eventCenter;i.on("".concat(pt.GRAPH_TRANSFORM,",").concat(pt.NODE_CLICK,",").concat(pt.BLANK_CLICK," "),function(){var r,s=o.textEditElement,a=o.editConfigModel,l=a.edgeTextEdit,u=a.nodeTextEdit;(l||u)&&s&&((r=o.textEditElement)===null||r===void 0||r.setElementState(en.DEFAULT))})}return n.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},n.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},n.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},n.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},n.prototype.getTools=function(){return Array.from(this.toolMap.values())},n.prototype.getInstance=function(){return this.instance},n.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},Ed([Pe],n.prototype,"toolMap",void 0),Ed([$e],n.prototype,"disableTool",null),Ed([$e],n.prototype,"enableTool",null),n})();function _K(n){throw new Error("[mobx-utils] "+n)}function pu(n,e){e===void 0&&(e="Illegal state"),n||_K(e)}var rm=function(n){return n&&n!==Object.prototype&&Object.getOwnPropertyNames(n).concat(rm(Object.getPrototypeOf(n))||[])},mK=function(n){var e=rm(n),t=e.filter(function(o,i){return e.indexOf(o)===i});return t},yK=function(n){return mK(n).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},sm="pending",hu="fulfilled",Pf="rejected";function bK(n){switch(this.state){case sm:return n.pending&&n.pending(this.value);case Pf:return n.rejected&&n.rejected(this.value);case hu:return n.fulfilled?n.fulfilled(this.value):this.value}}function rv(n,e){if(pu(arguments.length<=2,"fromPromise expects up to two arguments"),pu(typeof n=="function"||typeof n=="object"&&n&&typeof n.then=="function","Please pass a promise or function to fromPromise"),n.isPromiseBasedObservable===!0)return n;typeof n=="function"&&(n=new Promise(n));var t=n;n.then($e("observableFromPromise-resolve",function(i){t.value=i,t.state=hu}),$e("observableFromPromise-reject",function(i){t.value=i,t.state=Pf})),t.isPromiseBasedObservable=!0,t.case=bK;var o=e&&e.state===hu?e.value:void 0;return sc(t,{value:o,state:sm},{},{deep:!1}),t}(function(n){n.reject=$e("fromPromise.reject",function(t){var o=n(Promise.reject(t));return o.state=Pf,o.value=t,o});function e(t){t===void 0&&(t=void 0);var o=n(Promise.resolve(t));return o.state=hu,o.value=t,o}n.resolve=$e("fromPromise.resolve",e)})(rv||(rv={}));var Cl=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r};(function(){function n(e,t){var o=this;Wq(function(){o.current=t,o.subscription=e.subscribe(o)})}return n.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},n.prototype.next=function(e){this.current=e},n.prototype.complete=function(){this.dispose()},n.prototype.error=function(e){this.current=e,this.dispose()},Cl([Pe.ref],n.prototype,"current",void 0),Cl([$e.bound],n.prototype,"next",null),Cl([$e.bound],n.prototype,"complete",null),Cl([$e.bound],n.prototype,"error",null),n})();var vu=function(){return vu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},vu.apply(this,arguments)},Xs=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},xK=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function n(e){var t=this;this.model=e,this.localValues=Pe.map({}),this.localComputedValues=Pe.map({}),this.isPropertyDirty=function(o){return t.localValues.has(o)},pu(ri(e),"createViewModel expects an observable object"),yK(e).forEach(function(o){if(!(o===Mt||o==="__mobxDidRunLazyInitializers")){if(pu(xK.indexOf(o)===-1,"The propertyname "+o+" is reserved and cannot be used with viewModels"),Wp(e,o)){var i=Yu(e,o).derivation;t.localComputedValues.set(o,mn(i.bind(t)))}var r=Object.getOwnPropertyDescriptor(e,o),s=r?{enumerable:r.enumerable}:{};Object.defineProperty(t,o,vu(vu({},s),{configurable:!0,get:function(){return Wp(e,o)?t.localComputedValues.get(o).get():t.isPropertyDirty(o)?t.localValues.get(o):t.model[o]},set:$e(function(a){a!==t.model[o]?t.localValues.set(o,a):t.localValues.delete(o)})}))}})}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),n.prototype.submit=function(){var e=this;ys(this.localValues).forEach(function(t){var o=e.localValues.get(t),i=e.model[t];Si(i)?i.replace(o):co(i)?(i.clear(),i.merge(o)):tG(o)||(e.model[t]=o)}),this.localValues.clear()},n.prototype.reset=function(){this.localValues.clear()},n.prototype.resetProperty=function(e){this.localValues.delete(e)},Xs([mn],n.prototype,"isDirty",null),Xs([mn],n.prototype,"changedValues",null),Xs([$e.bound],n.prototype,"submit",null),Xs([$e.bound],n.prototype,"reset",null),Xs([$e.bound],n.prototype,"resetProperty",null),n})();function Dd(n){if(!n)return"ROOT";for(var e=[];n.parent;)e.push(n.path),n=n.parent;return e.reverse().join("/")}function Ad(n){return ri(n)||Si(n)||co(n)}function wK(n,e){var t=new WeakMap;function o(a){var l=t.get(a.object);i(a,l),e(a,Dd(l),n)}function i(a,l){switch(a.type){case"add":r(a.newValue,l,a.name);break;case"update":s(a.oldValue),r(a.newValue,l,a.name||""+a.index);break;case"remove":case"delete":s(a.oldValue);break;case"splice":a.removed.map(s),a.added.forEach(function(f,p){return r(f,l,""+(a.index+p))});for(var u=a.index+a.addedCount;u<a.object.length;u++)if(Ad(a.object[u])){var c=t.get(a.object[u]);c&&(c.path=""+u)}break}}function r(a,l,u){if(Ad(a)){var c=t.get(a);if(c){if(c.parent!==l||c.path!==u)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Dd(l)+"/"+u+"',")+(" but it already exists at '"+Dd(c.parent)+"/"+c.path+"'"))}else{var f={parent:l,path:u,dispose:O_(a,o)};t.set(a,f),iG(a).forEach(function(p){var h=p[0],g=p[1];return r(g,f,h)})}}}function s(a){if(Ad(a)){var l=t.get(a);if(!l)return;t.delete(a),l.dispose(),oG(a).forEach(s)}}return r(n,void 0,""),function(){s(n)}}var CK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)i.hasOwnProperty(r)&&(o[r]=i[r])},n(e,t)};return function(e,t){n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){CK(e,n);function e(t,o,i){var r=i===void 0?{}:i,s=r.name,a=s===void 0?"ogm"+(Math.random()*1e3|0):s,l=r.keyToName,u=l===void 0?function(p){return""+p}:l,c=n.call(this)||this;c._keyToName=u,c._groupBy=o,c._ogmInfoKey=Symbol("ogmInfo"+a),c._base=t;for(var f=0;f<t.length;f++)c._addItem(t[f]);return c._disposeBaseObserver=O_(c._base,function(p){if(p.type==="splice")Wo(function(){for(var h=0,g=p.removed;h<g.length;h++){var m=g[h];c._removeItem(m)}for(var _=0,v=p.added;_<v.length;_++){var b=v[_];c._addItem(b)}});else if(p.type==="update")Wo(function(){c._removeItem(p.oldValue),c._addItem(p.newValue)});else throw new Error("illegal state")}),c}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,o){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var o=this._base[t],i=o[this._ogmInfoKey];i.reaction(),delete o[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var o=n.prototype.get.call(this,t);return o===void 0&&(o=Pe([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),n.prototype.set.call(this,t,o)),o},e.prototype._removeFromGroupArr=function(t,o){var i=n.prototype.get.call(this,t);i.length===1?n.prototype.delete.call(this,t):(o===i.length-1||(i[o]=i[i.length-1],i[o][this._ogmInfoKey].groupArrIndex=o),i.length--)},e.prototype._addItem=function(t){var o=this,i=this._groupBy(t),r=this._getGroupArr(i),s={groupByValue:i,groupArrIndex:r.length,reaction:w_(function(){return o._groupBy(t)},function(a,l){var u=t[o._ogmInfoKey];o._removeFromGroupArr(u.groupByValue,u.groupArrIndex);var c=o._getGroupArr(a),f=c.length;c.push(t),u.groupByValue=a,u.groupArrIndex=f})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:s}),r.push(t)},e.prototype._removeItem=function(t){var o=t[this._ogmInfoKey];this._removeFromGroupArr(o.groupByValue,o.groupArrIndex),o.reaction(),delete t[this._ogmInfoKey]},e})(Af);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var Fc=function(){return Fc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Fc.apply(this,arguments)},SK=(function(){function n(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return n.prototype.add=function(e){zf(Py(this.undos),e)||(this.undos.push(e),zf(this.curData,e)||(this.redos=[]),this.eventCenter.emit(pt.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},n.prototype.undoAble=function(){return this.undos.length>1},n.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Dt(t),t}},n.prototype.redoAble=function(){return this.redos.length>0},n.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Dt(e),e}},n.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=wK(e,gg(function(){var o=e.modelToHistoryData();o&&t.add(Fc({},o))},this.waitTime))},n.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},n})(),Od={exports:{}},sv;function kK(){return sv||(sv=1,(function(n){(function(e,t,o){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},a={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},l,u=1;u<20;++u)i[111+u]="f"+u;for(u=0;u<=9;++u)i[u+96]=u.toString();function c(E,S,N){if(E.addEventListener){E.addEventListener(S,N,!1);return}E.attachEvent("on"+S,N)}function f(E){if(E.type=="keypress"){var S=String.fromCharCode(E.which);return E.shiftKey||(S=S.toLowerCase()),S}return i[E.which]?i[E.which]:r[E.which]?r[E.which]:String.fromCharCode(E.which).toLowerCase()}function p(E,S){return E.sort().join(",")===S.sort().join(",")}function h(E){var S=[];return E.shiftKey&&S.push("shift"),E.altKey&&S.push("alt"),E.ctrlKey&&S.push("ctrl"),E.metaKey&&S.push("meta"),S}function g(E){if(E.preventDefault){E.preventDefault();return}E.returnValue=!1}function m(E){if(E.stopPropagation){E.stopPropagation();return}E.cancelBubble=!0}function _(E){return E=="shift"||E=="ctrl"||E=="alt"||E=="meta"}function v(){if(!l){l={};for(var E in i)E>95&&E<112||i.hasOwnProperty(E)&&(l[i[E]]=E)}return l}function b(E,S,N){return N||(N=v()[E]?"keydown":"keypress"),N=="keypress"&&S.length&&(N="keydown"),N}function C(E){return E==="+"?["+"]:(E=E.replace(/\+{2}/g,"+plus"),E.split("+"))}function M(E,S){var N,L,$,B=[];for(N=C(E),$=0;$<N.length;++$)L=N[$],a[L]&&(L=a[L]),S&&S!="keypress"&&s[L]&&(L=s[L],B.push("shift")),_(L)&&B.push(L);return S=b(L,B,S),{key:L,modifiers:B,action:S}}function O(E,S){return E===null||E===t?!1:E===S?!0:O(E.parentNode,S)}function k(E){var S=this;if(E=E||t,!(S instanceof k))return new k(E);S.target=E,S._callbacks={},S._directMap={};var N={},L,$=!1,B=!1,A=!1;function D(H){H=H||{};var W=!1,Z;for(Z in N){if(H[Z]){W=!0;continue}N[Z]=0}W||(A=!1)}function T(H,W,Z,le,te,q){var re,ce,ve=[],Ne=Z.type;if(!S._callbacks[H])return[];for(Ne=="keyup"&&_(H)&&(W=[H]),re=0;re<S._callbacks[H].length;++re)if(ce=S._callbacks[H][re],!(!le&&ce.seq&&N[ce.seq]!=ce.level)&&Ne==ce.action&&(Ne=="keypress"&&!Z.metaKey&&!Z.ctrlKey||p(W,ce.modifiers))){var ge=!le&&ce.combo==te,_e=le&&ce.seq==le&&ce.level==q;(ge||_e)&&S._callbacks[H].splice(re,1),ve.push(ce)}return ve}function F(H,W,Z,le){S.stopCallback(W,W.target||W.srcElement,Z,le)||H(W,Z)===!1&&(g(W),m(W))}S._handleKey=function(H,W,Z){var le=T(H,W,Z),te,q={},re=0,ce=!1;for(te=0;te<le.length;++te)le[te].seq&&(re=Math.max(re,le[te].level));for(te=0;te<le.length;++te){if(le[te].seq){if(le[te].level!=re)continue;ce=!0,q[le[te].seq]=1,F(le[te].callback,Z,le[te].combo,le[te].seq);continue}ce||F(le[te].callback,Z,le[te].combo)}var ve=Z.type=="keypress"&&B;Z.type==A&&!_(H)&&!ve&&D(q),B=ce&&Z.type=="keydown"};function V(H){typeof H.which!="number"&&(H.which=H.keyCode);var W=f(H);if(W){if(H.type=="keyup"&&$===W){$=!1;return}S.handleKey(W,h(H),H)}}function P(){clearTimeout(L),L=setTimeout(D,1e3)}function X(H,W,Z,le){N[H]=0;function te(Ne){return function(){A=Ne,++N[H],P()}}function q(Ne){F(Z,Ne,H),le!=="keyup"&&($=f(Ne)),setTimeout(D,10)}for(var re=0;re<W.length;++re){var ce=re+1===W.length,ve=ce?q:te(le||M(W[re+1]).action);oe(W[re],ve,le,H,re)}}function oe(H,W,Z,le,te){S._directMap[H+":"+Z]=W,H=H.replace(/\s+/g," ");var q=H.split(" "),re;if(q.length>1){X(H,q,W,Z);return}re=M(H,Z),S._callbacks[re.key]=S._callbacks[re.key]||[],T(re.key,re.modifiers,{type:re.action},le,H,te),S._callbacks[re.key][le?"unshift":"push"]({callback:W,modifiers:re.modifiers,action:re.action,seq:le,level:te,combo:H})}S._bindMultiple=function(H,W,Z){for(var le=0;le<H.length;++le)oe(H[le],W,Z)},c(E,"keypress",V),c(E,"keydown",V),c(E,"keyup",V)}k.prototype.bind=function(E,S,N){var L=this;return E=E instanceof Array?E:[E],L._bindMultiple.call(L,E,S,N),L},k.prototype.unbind=function(E,S){var N=this;return N.bind.call(N,E,function(){},S)},k.prototype.trigger=function(E,S){var N=this;return N._directMap[E+":"+S]&&N._directMap[E+":"+S]({},E),N},k.prototype.reset=function(){var E=this;return E._callbacks={},E._directMap={},E},k.prototype.stopCallback=function(E,S){var N=this;if((" "+S.className+" ").indexOf(" mousetrap ")>-1||O(S,N.target))return!1;if("composedPath"in E&&typeof E.composedPath=="function"){var L=E.composedPath()[0];L!==E.target&&(S=L)}return S.tagName=="INPUT"||S.tagName=="SELECT"||S.tagName=="TEXTAREA"||S.isContentEditable},k.prototype.handleKey=function(){var E=this;return E._handleKey.apply(E,arguments)},k.addKeycodes=function(E){for(var S in E)E.hasOwnProperty(S)&&(i[S]=E[S]);l=null},k.init=function(){var E=k(t);for(var S in E)S.charAt(0)!=="_"&&(k[S]=(function(N){return function(){return E[N].apply(E,arguments)}})(S))},k.init(),e.Mousetrap=k,n.exports&&(n.exports=k)})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(Od)),Od.exports}var EK=kK();const DK=Ts(EK);var Zi=function(){return Zi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Zi.apply(this,arguments)},AK=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},di=null;function av(n,e){var t,o;return n.x+=e,n.y+=e,Hd(n.text)||(n.text.x+=e,n.text.y+=e),Hd((t=n.properties)===null||t===void 0?void 0:t._label)||(o=n.properties)===null||o===void 0||o._label.forEach(function(i){i.x+=e,i.y+=e}),n}function lv(n,e){return n.startPoint&&(n.startPoint.x+=e,n.startPoint.y+=e),n.endPoint&&(n.endPoint.x+=e,n.endPoint.y+=e),n.pointsList&&n.pointsList.length>0&&n.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Hd(n.text)||(n.text.x+=e,n.text.y+=e),n}function OK(n,e){var t=n.x,o=n.y,i=n.text,r=i?{x:i.x+e,y:i.y+e,value:i.value}:void 0;return Zi(Zi({},n),{id:"",x:t+e,y:o+e,text:r})}function NK(n,e){var t=n.startPoint,o=n.endPoint,i=n.pointsList,r=n.text,s=AK(n,["startPoint","endPoint","pointsList","text"]);s.id="";var a={x:t.x+e,y:t.y+e},l={x:o.x+e,y:o.y+e},u=ti(i,function(f){return{x:f.x+e,y:f.y+e}}),c=r?Zi(Zi({},r),{x:r.x+e,y:r.y+e}):void 0;return Zi(Zi({},s),{startPoint:a,endPoint:l,pointsList:u,text:c})}var Wr=40,Sl=40;function MK(n,e){var t=n.keyboard,o=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(Sl=Wr,!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=n.options.guards,r=e.getSelectElements(!1),s=i&&i.beforeClone?i.beforeClone(r):!0;return!s||r.nodes.length===0&&r.edges.length===0?(di=null,!0):(di=r,di.nodes.forEach(function(a){return av(a,Wr)}),di.edges.forEach(function(a){return lv(a,Wr)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;if(di&&(di.nodes||di.edges)){n.clearSelectElements();var i=n.addElements(di,Sl);if(!i)return!0;i.nodes.forEach(function(r){return n.selectElementById(r.id,!0)}),i.edges.forEach(function(r){return n.selectElementById(r.id,!0)}),di.nodes.forEach(function(r){return av(r,Wr)}),di.edges.forEach(function(r){return lv(r,Wr)}),Sl=Sl+Wr}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(o!=null&&o.enabled)||e.textEditElement?!0:(n.redo(),!1)}),t.on(["backspace"],function(){if(!(o!=null&&o.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return n.clearSelectElements(),i.edges.forEach(function(r){return r.id&&n.deleteEdge(r.id)}),i.nodes.forEach(function(r){return r.id&&n.deleteNode(r.id)}),!1})}var TK=(function(){function n(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new DK(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return n.prototype.initShortcuts=function(){var e=this,t,o=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(o)if(_g(o))o.forEach(function(a){var l=a.keys,u=a.callback,c=a.action;return e.on(l,u,c)});else{var i=o.keys,r=o.callback,s=o.action;this.on(i,r,s)}},n.prototype.on=function(e,t,o){this.mousetrap.bind(this.getKeys(e),t,o)},Object.defineProperty(n.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),n.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},n.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},n.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},n.prototype.destroy=function(){this.mousetrap.reset()},n.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(o){return t.formatKey(o)})},n.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},n})(),Xi=function(){return Xi=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Xi.apply(this,arguments)},kl=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Nd=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Md=Symbol("plugin registered by Logicflow.use"),jc=(function(){function n(e){var t=this,o;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(u,c){return t.viewMap.set(u,c)},this.getView=function(u){return t.viewMap.get(u)};var i=Sa.get(e),r=i.container,s=i.width,a=i.height;this.options=i,this.container=this.initContainer(r,s,a),this.graphModel=new yY(Xi(Xi({},i),{container:this.container})),this.plugins=(o=i.plugins)!==null&&o!==void 0?o:[];var l=this.graphModel.eventCenter;this.tool=new gK(this),this.dnd=new rK({lf:this}),this.history=new SK(l),this.keyboard=new TK({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new bY(this.graphModel,i.snaplineEpsilon),sK(l,this.snaplineModel)),i.isSilentMode||(MK(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return n.prototype.initContainer=function(e,t,o){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=o?"".concat(o,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return n.toStringTag},enumerable:!1,configurable:!0}),n.prototype.register=function(e,t,o){if(o===void 0&&(o=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:Zu,BaseEdgeModel:Ju,BaseNode:ur,BaseNodeModel:lr,RectNode:Pr,RectNodeModel:Ss,CircleNode:du,CircleNodeModel:au,PolygonNode:fu,PolygonNodeModel:lu,TextNode:nv,TextNodeModel:Qh,LineEdge:iv,LineEdgeModel:Yh,DiamondNode:Mc,DiamondNodeModel:Cc,PolylineEdge:ks,PolylineEdgeModel:Cs,BezierEdge:Lc,BezierEdgeModel:wc,EllipseNode:$c,EllipseNodeModel:Sc,HtmlNode:La,HtmlNodeModel:Ra,h:Ze,type:e};if(this.viewMap.forEach(function(u){var c=u.extendKey;c&&(i[c]=u)}),this.graphModel.modelMap.forEach(function(u){var c=u.extendKey;c&&(i[c]=u)}),t){var r=t(i),s=r.view,a=r.model,l=s;o&&!l.isObserved&&(l.isObserved=!0,l=eo(l)),this.setView(e,l),this.graphModel.setModel(e,a)}},n.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=eo(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},n.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),Lt(e,function(o){t.registerElement(o)})},n.prototype.defaultRegister=function(){var e=[{type:"rect",view:Pr,model:Ss},{type:"circle",view:du,model:au},{type:"polygon",view:fu,model:lu},{type:"text",view:nv,model:Qh},{type:"ellipse",view:$c,model:Sc},{type:"diamond",view:Mc,model:Cc},{type:"html",view:La,model:Ra},{type:"line",view:iv,model:Yh},{type:"polyline",view:ks,model:Cs},{type:"bezier",view:Lc,model:wc}];this.batchRegister(e)},n.prototype.addNode=function(e,t,o){return t===void 0&&(t=pt.NODE_ADD),this.graphModel.addNode(e,t,o)},n.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteNode(e),r},n.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),o=t==null?void 0:t.getData();if(o){var i=this.options.guards,r=i!=null&&i.beforeClone?i.beforeClone(o):!0;if(r)return this.graphModel.cloneNode(e)}},n.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},n.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},n.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},n.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},n.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},n.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},n.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},n.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},n.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var o=new t(Xi(Xi({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(o),o},n.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},n.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},n.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},n.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},n.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},n.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},n.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},n.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,o=e.targetNodeId,i=[],r=this.graphModel.edges;return t&&o?Lt(r,function(s){s.sourceNodeId===t&&s.targetNodeId===o&&i.push(s)}):t?Lt(r,function(s){s.sourceNodeId===t&&i.push(s)}):o&&Lt(r,function(s){s.targetNodeId===o&&i.push(s)}),i},n.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},n.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},n.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var o=t.getData(),i=this.options.guards,r=i!=null&&i.beforeDelete?i.beforeDelete(o):!0;return r&&this.graphModel.deleteEdgeById(e),r},n.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,o=e.targetNodeId;t&&o?this.graphModel.deleteEdgeBySourceAndTarget(t,o):t?this.graphModel.deleteEdgeBySource(t):o&&this.graphModel.deleteEdgeByTarget(o)},n.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},n.prototype.addElements=function(e,t){var o=this,i=e.nodes,r=e.edges;t===void 0&&(t=40);var s={},a={nodes:[],edges:[]};return Lt(i,function(l){var u=l.id,c=o.addNode(l);u&&(s[u]=c.id),a.nodes.push(c)}),Lt(r,function(l){var u=l.sourceNodeId,c=l.targetNodeId;s[u]&&(u=s[u]),s[c]&&(c=s[c]);var f=o.graphModel.addEdge(Xi(Xi({},l),{sourceNodeId:u,targetNodeId:c}));a.edges.push(f)}),a},n.prototype.selectElementById=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=!0),this.graphModel.selectElementById(e,t),!t&&o&&this.graphModel.toFront(e)},n.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},n.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},n.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},n.prototype.getModelById=function(e){return this.graphModel.getElement(e)},n.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},n.prototype.deleteElement=function(e){var t,o,i,r=this.getModelById(e);if(!r)return!1;var s=(t={},t[Sn.NODE]=this.deleteNode,t[Sn.EDGE]=this.deleteEdge,t);return(i=(o=s[r.BaseType])===null||o===void 0?void 0:o.call(this,e))!==null&&i!==void 0?i:!1},n.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},n.prototype.getAreaElement=function(e,t,o,i,r){return o===void 0&&(o=!0),i===void 0&&(i=!0),r===void 0&&(r=!1),this.graphModel.getAreaElement(e,t,o,i,r).map(function(s){return s.getData()})},n.prototype.setProperties=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.setProperties(Jn(t))},n.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},n.prototype.deleteProperty=function(e,t){var o;(o=this.graphModel.getElement(e))===null||o===void 0||o.deleteProperty(t)},n.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},n.prototype.editText=function(e){this.graphModel.editText(e)},n.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},n.prototype.updateEditConfig=function(e){var t=this.graphModel,o=t.editConfigModel,i=t.transformModel,r=o.snapGrid;if(o.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!Qn(e==null?void 0:e.snapGrid)&&e.snapGrid!==r){var s=this.graphModel.grid.size,a=s===void 0?1:s;this.graphModel.updateGridSize(e.snapGrid?a:1)}this.emit(pt.EDIT_CONFIG_CHANGED,{data:o.getConfig()})},n.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},n.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},n.prototype.getTheme=function(){return this.graphModel.getTheme()},n.prototype.focusByElement=function(e){var t=void 0,o=this.getNodeModelById(e);if(o){var i=o.getData(),r=i.x,s=i.y;t={x:r,y:s}}var a=this.getEdgeModelById(e);if(a){var l=a.textPosition,r=l.x,s=l.y;t={x:r,y:s}}t&&this.focusByCoordinate(t)},n.prototype.focusByCoordinate=function(e){var t=this.graphModel,o=t.transformModel,i=t.width,r=t.height,s=e.x,a=e.y;o.focusOn(s,a,i,r)},n.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,o=e.coordinate;t&&this.focusByElement(t),o&&this.focusByCoordinate(o)}},n.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},n.prototype.toFront=function(e){this.graphModel.toFront(e)},n.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},n.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Nd([o],kl(e),!1)):o},n.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},n.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},n.prototype.setOverlapMode=function(e){this.graphModel.setOverlapMode(e)},n.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(Jn(e)),this.options.history!==!1&&this.history.watch(this.graphModel),xh(Re(kY,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(pt.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},n.prototype.render=function(e){var t=Dt(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},n.prototype.undo=function(){if(this.history.undoAble()){var e=Jn(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.redo=function(){if(this.history.redoAble()){var e=Jn(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},n.prototype.zoom=function(e,t){var o=this.graphModel.transformModel;return o.zoom(e,t)},n.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},n.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},n.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},n.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,o=e.SCALE_Y,i=e.TRANSLATE_X,r=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:o,TRANSLATE_X:i,TRANSLATE_Y:r}},n.prototype.translate=function(e,t){var o=this.graphModel.transformModel;o.translate(e,t)},n.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,o=e.TRANSLATE_Y;this.translate(-t,-o)},n.prototype.translateCenter=function(){this.graphModel.translateCenter()},n.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},n.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},n.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},n.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},n.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},n.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},n.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},n.use=function(e,t){var o,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(o={},o[Md]=Md,o.extension=e,o.props=t,o))},n.addThemeMode=function(e,t){yW(e,t)},n.removeThemeMode=function(e){bW(e)},n.clearThemeMode=function(){Xh()},n.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var o=Array.from(n.extensions,function(r){var s=kl(r,2),a=s[1];return a}),i=Nd(Nd([],kl(this.plugins),!1),kl(o),!1);Lt(i,function(r){var s,a;Md in r?(s=r.extension,a=r.props):s=r;var l=s==null?void 0:s.pluginName;Ry(e,l)===-1&&t.installPlugin(s,a)})},n.prototype.installPlugin=function(e,t){var o,i;if("pluginName"in e&&"install"in e){var r=e.pluginName,s=e.install,a=e.render;r&&(s&&s.call(e,this,n),a&&this.components.push(a.bind(e)),this.extension[r]=e);return}var l=e,u=l.pluginName,c=new l({lf:this,LogicFlow:n,props:t,options:(i=(o=this.options.pluginsOptions)===null||o===void 0?void 0:o[u])!==null&&i!==void 0?i:{}});c.render&&this.components.push(c.render.bind(c)),this.extension[u]=c},n.prototype.destroy=function(){var e;this.clearData(),xh(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Xh();for(var t in this.extension){var o=this.extension[t];"destroy"in o&&((e=o.destroy)===null||e===void 0||e.call(o))}},n.extensions=new Map,n})();(function(n){n.toStringTag="LF.".concat(n.name)})(jc||(jc={}));const $K=jc;function eo(n){return Nf(n)}var uv={width:40,height:40},dv={width:40,height:40},cv={width:40,height:40},fv={width:100,height:80},pv={width:100,height:80},PK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),RK=(globalThis==null?void 0:globalThis._ids)||new PK;function js(){return RK.next()}var am=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){am(e,n);function e(t,o){return t.id||(t.id="Event_".concat(js())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=n.prototype.getConnectedTargetRules.call(this),o={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(o),t},e.extendKey="StartEventModel",e})(au);(function(n){am(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(du);var lm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),gu=function(){return gu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},gu.apply(this,arguments)};(function(n){lm(e,n);function e(t,o){return t.id||(t.id="Event_".concat(js())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),n.call(this,t,o)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=n.prototype.getConnectedSourceRules.call(this),o={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(o),t},e.extendKey="EndEventModel",e})(au);(function(n){lm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle(),i=t,r=i.x,s=i.y,a=i.r,l=n.prototype.getShape.call(this);return Ze("g",{},l,Ze("circle",gu(gu({},o),{cx:r,cy:s,r:a-5})))},e.extendKey="EndEventView",e})(du);var um=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){um(e,n);function e(t,o){return t.id||(t.id="Flow_".concat(js())),n.call(this,t,o)||this}return e.extendKey="SequenceFlowModel",e})(Cs);(function(n){um(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(ks);var dm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ha=function(){return ha=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ha.apply(this,arguments)};(function(n){dm(e,n);function e(t,o){var i=this;return t.id||(t.id="Gateway_".concat(js())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=n.call(this,t,o)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(lu);(function(n){dm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,o=t,i=o.x,r=o.y,s=o.width,a=o.height,l=o.points,u=t.getNodeStyle();return Ze("g",{transform:"matrix(1 0 0 1 ".concat(i-s/2," ").concat(r-a/2,")")},Ze("polygon",ha(ha({},u),{x:i,y:r,points:l})),Ze("path",ha({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},u)))},e.extendKey="ExclusiveGatewayNode",e})(fu);var cm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Vc=function(){return Vc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Vc.apply(this,arguments)};(function(n){cm(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(js())),n.call(this,t,o)||this}return e.extendKey="ServiceTaskModel",e})(Ss);(function(n){cm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return Ze("svg",{x:o-r/2+5,y:i-s/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},Ze("path",{fill:a.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return Ze("g",{},[Ze("rect",Vc({x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s},l)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(Pr);var fm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),_u=function(){return _u=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},_u.apply(this,arguments)};(function(n){fm(e,n);function e(t,o){return t.id||(t.id="Activity_".concat(js())),n.call(this,t,o)||this}return e.extendKey="UserTaskModel",e})(Ss);(function(n){fm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getNodeStyle();return Ze("svg",{x:o-r/2+5,y:i-s/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},Ze("path",{fill:a.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.radius,l=t.getNodeStyle();return Ze("g",{},[Ze("rect",_u(_u({},l),{x:o-r/2,y:i-s/2,rx:a,ry:a,width:r,height:s})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(Pr);var BK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,o=e==="x"?t:t&3|8;return o.toString(16)})},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),LK=(globalThis==null?void 0:globalThis._ids)||new BK;function hv(){return LK.next()}function pm(n){return Object.prototype.toString.call(n)}function IK(n){return"  ".repeat(n)}function mu(n){var e=n;return pm(n)==="[object Object]"?(e={},Object.keys(n).forEach(function(t){var o=t;t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=mu(n[t])})):Array.isArray(n)&&(e=[],n.forEach(function(t,o){e[o]=mu(t)})),e}function yu(n){return n==null?"":n.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function FK(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(mu(n)).replace(/"/g,"'")}return yu(String(e))}var hr=`	
`;function $l(n,e,t){var o=IK(t);if(n!==0&&n!==!1&&!n)return hr+o+"<".concat(e," />");var i="";if(e==="#text")return hr+o+yu(String(n));if(e==="#cdata-section")return hr+o+"<![CDATA["+n+"]]>";if(e==="#comment")return hr+o+"<!--"+n+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+FK(n)+'"';if(Array.isArray(n))n.forEach(function(l){i+=$l(l,e,t+1)});else if(pm(n)==="[object Object]"){var r=Object.keys(n),s="",a="";i+=(t===0?"":hr+o)+"<"+e,r.forEach(function(l){l.charAt(0)==="-"?s+=$l(n[l],l,t+1):a+=$l(n[l],l,t+1)}),i+=s+(a!==""?">".concat(a).concat(hr+o,"</").concat(e,">"):" />")}else i+=hr+o+"<".concat(e,">").concat(yu(String(n)),"</").concat(e,">");return i}function jK(n){var e="";for(var t in n)e+=$l(n[t],t,0);return e}var oo=function(){};oo.ObjTree=function(){return this};oo.ObjTree.VERSION="0.23";oo.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;oo.ObjTree.prototype.attr_prefix="-";oo.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e)return this.parseDOM(e)};oo.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var f;c&&c.responseXML&&c.responseXML.documentElement&&(f=r.parseDOM(c.responseXML.documentElement)),s(f,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var u=new HTTP.Request(o);u&&(l=u.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var u=new Ajax.Request(n,o);u&&(l=u.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};oo.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!=11){var o={};o[n.nodeName]=t,t=o}return t}};oo.ObjTree.prototype.parseElement=function(n){if(n.nodeType!=7){if(n.nodeType==3||n.nodeType==4||n.nodeType==8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l==3||l==4||l==8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};oo.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t==1&&(n[e]=[]),n[e][n[e].length]=o):t==1?n[e]=o:t==2?n[e]=[n[e],o]:n[e][n[e].length]=o};oo.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};oo.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];i.charAt(0)!=this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<"+i+" />":typeof r=="object"&&r.constructor==Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" "+i.substring(1)+'="'+this.xml_escape(r)+'"'}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<"+n+s+`>
`+a+"</"+n+`>
`:a="<"+n+s+">"+a+"</"+n+`>
`:a="<"+n+s+` />
`),a};oo.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<"+n+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};oo.ObjTree.prototype.scalar_to_xml=function(n,e){return n=="#text"?this.xml_escape(e):"<"+n+">"+this.xml_escape(e)+"</"+n+`>
`};oo.ObjTree.prototype.xml_escape=yu;var VK=function(n){return new oo.ObjTree().parseXML(n)},HK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Hc=function(){return Hc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Hc.apply(this,arguments)},Qu=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},xi;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow"})(xi||(xi={}));var hm=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],vv=["properties","startPoint","endPoint","pointsList"],vm=function(n){return String(n||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function gv(n){var e=n?vv.concat(n):vv;return function(t){function o(i){var r={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(s){return o(s)}):(Object.entries(i).forEach(function(s){var a=Qu(s,2),l=a[0],u=a[1];typeof u!="object"?l.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(l)?r[l]=u:r["-".concat(l)]=u:e.includes(l)?r["-".concat(l)]=o(u):r[l]=o(u)}),r)}return o(t)}}function bu(n){var e={};return Object.entries(n).forEach(function(t){var o=Qu(t,2),i=o[0],r=o[1];i.indexOf("-")===0?e[i.substring(1)]=mu(r):typeof r=="string"?e[i]=r:Object.prototype.toString.call(r)==="[object Object]"?e[i]=bu(r):Array.isArray(r)?e[i]=r.map(function(s){return bu(s)}):e[i]=r}),e}function UK(n,e,t){var o=new Map;e.nodes.forEach(function(r){var s,a={"-id":r.id};if(!((s=r.text)===null||s===void 0)&&s.value&&(a["-name"]=r.text.value),r.properties){var l=gv(t)(r.properties);Object.assign(a,l)}o.set(r.id,a),n[r.type]?Array.isArray(n[r.type])?n[r.type].push(a):n[r.type]=[n[r.type],a]:n[r.type]=a});var i=e.edges.map(function(r){var s,a,l=o.get(r.targetNodeId);l["bpmn:incoming"]?Array.isArray(l["bpmn:incoming"])?l["bpmn:incoming"].push(r.id):l["bpmn:incoming"]=[l["bpmn:incoming"],r.id]:l["bpmn:incoming"]=r.id;var u={"-id":r.id,"-sourceRef":r.sourceNodeId,"-targetRef":r.targetNodeId};if(!((s=r.text)===null||s===void 0)&&s.value&&(u["-name"]=(a=r.text)===null||a===void 0?void 0:a.value),r.properties){var c=gv(t)(r.properties);Object.assign(u,c)}return u});e.edges.forEach(function(r){var s=o.get(r.sourceNodeId);s["bpmn:outgoing"]?Array.isArray(s["bpmn:outgoing"])?s["bpmn:outgoing"].push(r.id):s["bpmn:outgoing"]=[s["bpmn:outgoing"],r.id]:s["bpmn:outgoing"]=r.id}),n[xi.FLOW]=i}function zK(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,u=a.y;return{"-x":l,"-y":u}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,u=dr.shapeConfigMap.get(t.type);u&&(r=u.width,s=u.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}function qK(n){var e=[],t=[],o=n["bpmn:definitions"];if(o){var i=o["bpmn:process"],r=o["bpmndi:BPMNDiagram"],s=r==null?void 0:r["bpmndi:BPMNPlane"];if(!i||!s)return{nodes:e,edges:t};Object.keys(i).forEach(function(a){if(a.indexOf("bpmn:")===0){var l=i[a];if(a===xi.FLOW){var u=s["bpmndi:BPMNEdge"],c=(Array.isArray(u),u);t=XK(l,c)}else{var f=s["bpmndi:BPMNShape"],p=(Array.isArray(f),f);e=e.concat(GK(l,p,a))}}})}return{nodes:e,edges:t}}function GK(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(u){return u["-bpmnElement"]===s["-id"]}):a=e;var l=_v(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=_v(i,t,n);o.push(r)}return o}function _v(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=vm(t["-name"]),s=dr.shapeConfigMap.get(e);s&&(o+=s.width/2,i+=s.height/2);var a;Object.entries(t).forEach(function(f){var p=Qu(f,2),h=p[0],g=p[1];hm.indexOf(h)===-1&&(a||(a={}),a[h]=g)}),a&&(a=bu(a));var l;if(r&&(l={x:o,y:i,value:r},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var u=n["bpmndi:BPMNLabel"]["dc:Bounds"];l.x=Number(u["-x"])+Number(u["-width"])/2,l.y=Number(u["-y"])+Number(u["-height"])/2}var c={id:n["-bpmnElement"],type:e,x:o,y:i,properties:a};return l&&(c.text=l),c}function XK(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(mv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(mv(o,n))}return t}function mv(n,e){var t,o=e["-name"]?vm("".concat(e["-name"])):"";if(o){var i=void 0;n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=n["bpmndi:BPMNLabel"]["dc:Bounds"]);var r=0;if(o.split(`
`).forEach(function(h){r<h.length&&(r=h.length)}),i)t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7};else{var s=n["di:waypoint"]||[],a=s[0],l=s[s.length-1]||a,u=(Number((a==null?void 0:a["-x"])||0)+Number((l==null?void 0:l["-x"])||0))/2,c=(Number((a==null?void 0:a["-y"])||0)+Number((l==null?void 0:l["-y"])||0))/2;t={value:o,x:u,y:c}}}var f;Object.entries(e).forEach(function(h){var g=Qu(h,2),m=g[0],_=g[1];hm.indexOf(m)===-1&&(f||(f={}),f[m]=_)}),f&&(f=bu(f));var p={id:e["-id"],type:xi.FLOW,pointsList:n["di:waypoint"].map(function(h){return{x:Number(h["-x"]),y:Number(h["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:f};return t&&(p.text=t),p}var dr=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s=Hc({},o.processAttributes);UK(s,i,r);var a={"-id":"BPMNPlane_1","-bpmnElement":s["-id"]};zK(a,i);var l=o.definitionAttributes;l["bpmn:process"]=s,l["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":a};var u={"bpmn:definitions":l};return u},this.adapterIn=function(i){if(i)return qK(i)},t.adapterIn=function(i){return o.adapterIn(i)},t.adapterOut=function(i,r){return o.adapterOut(i,r)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(hv())},this.definitionAttributes={"-id":"Definitions_".concat(hv()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();dr.shapeConfigMap.set(xi.START,{width:uv.width,height:uv.height});dr.shapeConfigMap.set(xi.END,{width:dv.width,height:dv.height});dr.shapeConfigMap.set(xi.GATEWAY,{width:cv.width,height:cv.height});dr.shapeConfigMap.set(xi.SYSTEM,{width:fv.width,height:fv.height});dr.shapeConfigMap.set(xi.USER,{width:pv.width,height:pv.height});(function(n){HK(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(r){var s=typeof r=="string"?o.sanitizeNameAttributes(r):r,a=VK(s);return o.adapterIn(a)},o.adapterXmlOut=function(r,s){var a=o.adapterOut(r,s);return jK(a)};var i=t.lf;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(o,i){var r=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(r,'"')})},e.pluginName="bpmnXmlAdapter",e})(dr);var WK=(function(){function n(){globalThis._ids=this,this._ids=new Set}return n.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var o=Math.random()*16|0,i=t==="x"?o:o&3|8;return i.toString(16)});return e},n.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},n})(),YK=(globalThis==null?void 0:globalThis._ids)||new WK;function KK(){return YK.next()}Ze("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),Ze("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),Ze("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});Ze("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});Ze("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var JK=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wr=function(){return wr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wr.apply(this,arguments)},ZK=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},QK=Fo,eJ=(function(n){JK(e,n);function e(t){var o=n.call(this)||this;return o.updatePosition=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,u=a.y;o.nodeModel.x=l+r/2,o.nodeModel.y=u+s/2,o.nodeModel.moveText(r/2,s/2)},o.getResize=function(i){var r=i.index,s=i.deltaX,a=i.deltaY,l=i.width,u=i.height,c=i.PCTResizeInfo,f=i.pct,p=f===void 0?1:f,h=i.freezeWidth,g=h===void 0?!1:h,m=i.freezeHeight,_=m===void 0?!1:m,v={width:l,height:u,deltaX:s,deltaY:a};if(c){var b=4,C=0,M=0;switch(r){case 0:M=(s*-1-a)/b;break;case 1:M=(s-a)/b;break;case 2:M=(s+a)/b;break;case 3:M=(s*-1+a)/b;break}M!==0&&(C=Math.round(M/c.ResizeBasis.basisHeight*1e5)/1e3),c.ResizePCT.widthPCT=Math.max(Math.min(c.ResizePCT.widthPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit),c.ResizePCT.heightPCT=Math.max(Math.min(c.ResizePCT.heightPCT+C,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit);var O=Math.round(c.ResizePCT.widthPCT*c.ResizeBasis.basisWidth/100),k=Math.round(c.ResizePCT.heightPCT*c.ResizeBasis.basisHeight/100);switch(r){case 0:s=l-O,a=u-k;break;case 1:s=O-l,a=u-k;break;case 2:s=O-l,a=k-u;break;case 3:s=l-O,a=k-u;break}return v.width=O,v.height=k,v.deltaX=s/p,v.deltaY=a/p,v}switch(r){case 0:v.width=g?l:l-s*p,v.height=_?u:u-a*p;break;case 1:v.width=g?l:l+s*p,v.height=_?u:u-a*p;break;case 2:v.width=g?l:l+s*p,v.height=_?u:u+a*p;break;case 3:v.width=g?l:l-s*p,v.height=_?u:u+a*p;break}return v},o.updateEdgePointByAnchors=function(){var i=o.nodeModel,r=i.id,s=i.anchors,a=o.getNodeEdges(r);a.sourceEdges.forEach(function(l){var u=s.find(function(c){return c.id===l.sourceAnchorId});u&&l.updateStartPoint({x:u.x,y:u.y})}),a.targetEdges.forEach(function(l){var u=s.find(function(c){return c.id===l.targetAnchorId});u&&l.updateEndPoint({x:u.x,y:u.y})})},o.updateRect=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.x,u=a.y,c=a.width,f=a.height,p=a.radius,h=a.PCTResizeInfo,g=o.nodeModel,m=g.minWidth,_=g.minHeight,v=g.maxWidth,b=g.maxHeight,C=o.index,M=m===v,O=_===b,k=o.getResize({index:C,deltaX:r,deltaY:s,width:c,height:f,PCTResizeInfo:h,pct:1,freezeWidth:M,freezeHeight:O});if(k.width<m||k.width>v||k.height<_||k.height>b){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:M?0:k.deltaX,deltaY:O?0:k.deltaY}),o.nodeModel.width=k.width,o.nodeModel.height=k.height,o.nodeModel.setProperties({nodeSize:{width:k.width,height:k.height}});var E={x:l,y:u,width:c,height:f,radius:p},S={x:o.nodeModel.x,y:o.nodeModel.y,width:o.nodeModel.width,height:o.nodeModel.height,radius:p};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:E,afterNode:S})},o.updateEllipse=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,u=a.ry,c=a.x,f=a.y,p=a.PCTResizeInfo,h=o.index,g=o.nodeModel,m=g.minWidth,_=g.minHeight,v=g.maxWidth,b=g.maxHeight,C=m===v,M=_===b,O=l,k=u,E=o.getResize({index:h,deltaX:r,deltaY:s,width:O,height:k,PCTResizeInfo:p,pct:1/2,freezeWidth:C,freezeHeight:M});if(E.width<m/2||E.width>v/2||E.height<_/2||E.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:E.deltaX,deltaY:M?0:E.deltaY}),o.nodeModel.rx=E.width,o.nodeModel.ry=E.height,o.nodeModel.setProperties({nodeSize:{rx:E.width,ry:E.height}});var S={x:c,y:f},N={rx:E.width,ry:E.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:wr(wr({},S),{rx:l,ry:u}),afterNode:N})},o.updateDiamond=function(i){var r=i.deltaX,s=i.deltaY,a=o.nodeModel,l=a.rx,u=a.ry,c=a.x,f=a.y,p=a.PCTResizeInfo,h=o.index,g=o.nodeModel,m=g.minWidth,_=g.minHeight,v=g.maxWidth,b=g.maxHeight,C=m===v,M=_===b,O=l,k=u,E=o.getResize({index:h,deltaX:r,deltaY:s,width:O,height:k,PCTResizeInfo:p,pct:1/2,freezeWidth:C,freezeHeight:M});if(E.width<m/2||E.width>v/2||E.height<_/2||E.height>b/2){o.dragHandler.cancelDrag();return}o.updatePosition({deltaX:C?0:E.deltaX,deltaY:M?0:E.deltaY}),o.nodeModel.rx=E.width,o.nodeModel.ry=E.height,o.nodeModel.setProperties({nodeSize:{rx:E.width,ry:E.height}});var S={x:c,y:f,rx:l,ry:u},N={rx:E.width,ry:E.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:r,deltaY:s,beforeNode:S,afterNode:N})},o.eventEmit=function(i){var r=i.deltaX,s=i.deltaY,a=i.beforeNode,l=i.afterNode,u=o.nodeModel,c=u.id,f=u.modelType,p=u.type,h=wr({id:c,modelType:f,type:p},a),g=wr({id:c,modelType:f,type:p},l);o.graphModel.eventCenter.emit("node:resize",{preData:h,data:g,deltaX:r,deltaY:s,index:o.index,model:o.nodeModel})},o.onDragging=function(i){var r,s=i.deltaX,a=i.deltaY,l=o.graphModel.transformModel,u=o.nodeModel.modelType;r=ZK(l.fixDeltaXY(s,a),2),s=r[0],a=r[1],u===zt.RECT_NODE||u===zt.HTML_NODE?o.updateRect({deltaX:s,deltaY:a}):u===zt.ELLIPSE_NODE?o.updateEllipse({deltaX:s,deltaY:a}):u===zt.DIAMOND_NODE&&o.updateDiamond({deltaX:s,deltaY:a})},o.onDragEnd=function(){var i=o.graphModel.gridSize,r=i===void 0?1:i,s=r*Math.round(o.nodeModel.x/r),a=r*Math.round(o.nodeModel.y/r);o.nodeModel.moveTo(s,a),o.updateEdgePointByAnchors()},o.index=t.index,o.nodeModel=t.model,o.graphModel=t.graphModel,o.dragHandler=new QK({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:1}),o}return e.prototype.getNodeEdges=function(t){for(var o=this.graphModel,i=o.edges,r=[],s=[],a=0;a<i.length;a++){var l=i[a];l.sourceNodeId===t?r.push(l):i[a].targetNodeId===t&&s.push(l)}return{sourceEdges:r,targetEdges:s}},e.prototype.render=function(){var t=this.props,o=t.x,i=t.y,r=t.index,s=t.model,a=s.getControlPointStyle();return Re("g",{className:"lf-resize-control-".concat(r),children:Re(Ao,wr({className:"lf-node-control",x:o,y:i},a,{onMouseDown:this.dragHandler.handleMouseDown}))})},e})(Yt),tJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xu=function(){return xu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},xu.apply(this,arguments)},ed=(function(n){tJ(e,n);function e(){var t=n.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,o=t.model,i=t.graphModel,r=o.x,s=o.y,a=o.width,l=o.height,u={minX:r-a/2,minY:s-l/2,maxX:r+a/2,maxY:s+l/2},c=u.minX,f=u.minY,p=u.maxX,h=u.maxY,g=[{x:c,y:f},{x:p,y:f},{x:p,y:h},{x:c,y:h}];return g.map(function(m,_){return Re(eJ,xu({index:_},m,{model:o,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.getResizeOutlineStyle();return Re(Ao,xu({},a,{x:o,y:i,width:r,height:s}))},e.prototype.render=function(){return Re("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e})(Yt),gm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){gm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Sc);(function(n){gm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o.isSelected&&!i?this.getControlGroup():""]})},e})($c);var _m=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Uc=function(){return Uc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Uc.apply(this,arguments)};(function(n){_m(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.rx=r.rx,i.ry=r.ry),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},r={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Cc);(function(n){_m(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,o=t.points,i=t.getNodeStyle();return Re("g",{children:Re($f,Uc({},i,{points:o}))})},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Mc);var mm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})();(function(n){mm(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Ra);(function(n){mm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(La);var ym=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),nJ=(function(n){ym(e,n);function e(t,o){var i=n.call(this,t,o)||this,r=t.properties.nodeSize;return r&&(i.width=r.width,i.height=r.height),i}return e.prototype.initNodeData=function(t){n.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=n.prototype.getOutlineStyle.call(this),o=this.graphModel.editConfigModel.isSilentMode;return o||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var o={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},r={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:o,ResizeBasis:i,ScaleLimit:r}}else delete this.PCTResizeInfo},e})(Ss),oJ=(function(n){ym(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,o=t.model,i=t.graphModel;return Re(ed,{model:o,graphModel:i})},e.prototype.getResizeShape=function(){return n.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Re("g",{children:[this.getResizeShape(),o&&!i?this.getControlGroup():""]})},e})(Pr),bm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),wu=function(){return wu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},wu.apply(this,arguments)},vr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},gr=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},yv=500,bv=300,iJ=-1e4;(function(n){bm(e,n);function e(){var t=n.apply(this,gr([],vr(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=yv,t.unfoldedHeight=bv,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var o=this;n.prototype.initNodeData.call(this,t);var i=[];_g(t.children)&&(i=t.children),this.children=new Set(i),this.width=yv,this.height=bv,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=iJ,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){o.isFolded&&o.foldGroup(o.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var o=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=gr(gr([],vr(this.incoming.edges),!1),vr(this.outgoing.edges),!1);this.children.forEach(function(r){var s=o.graphModel.getElement(r);if(s){var a=s.isFolded;if(s.isGroup&&!s.isFolded&&s.foldGroup(t),s.isGroup&&!t){var l=o.childrenLastFoldStatus[r];l!==void 0&&l!==s.isFolded&&s.foldGroup(l)}o.childrenLastFoldStatus[r]=!!a,s.visible=!t;var u=s.incoming.edges,c=s.outgoing.edges;i=gr(gr(gr([],vr(i),!1),vr(u),!1),vr(c),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var o=n.prototype.getAnchorStyle.call(this,t);return o.stroke="transparent",o.fill="transparent",o.hover.fill="transparent",o.hover.stroke="transparent",o},e.prototype.foldEdge=function(t,o){var i=this;o.forEach(function(r,s){var a=r.id,l=r.sourceNodeId,u=r.targetNodeId,c=r.startPoint,f=r.endPoint,p=r.type,h=r.text,g=r.getProperties(),m={id:"".concat(a,"__").concat(s),sourceNodeId:l,targetNodeId:u,startPoint:c,endPoint:f,type:p,properties:g,text:h==null?void 0:h.value};r.virtual&&i.graphModel.deleteEdgeById(r.id);var _=i.graphModel.group.getNodeGroup(u);_||(_=i.graphModel.getNodeModelById(u));var v=i.graphModel.group.getNodeGroup(l);v||(v=i.graphModel.getNodeModelById(l)),t&&r.visible!==!1&&(i.children.has(l)||i.id===l?(m.startPoint=void 0,m.sourceNodeId=i.id):(m.endPoint=void 0,m.targetNodeId=i.id),(_.id!==i.id||v.id!==i.id)&&i.createVirtualEdge(m),r.visible=!1),!t&&r.visible===!1&&(_&&_.isGroup&&_.isFolded?(m.targetNodeId=_.id,m.endPoint=void 0,i.createVirtualEdge(m)):v&&v.isGroup&&v.isFolded?(m.sourceNodeId=v.id,m.startPoint=void 0,i.createVirtualEdge(m)):r.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isFoldedEdge=!0},e.prototype.isInRange=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return o>=this.x-this.width/2&&r<=this.x+this.width/2&&i>=this.y-this.height/2&&s<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var o=t.minX,i=t.minY,r=t.maxX,s=t.maxY;return{x:o>=this.x-this.width/2&&r<=this.x+this.width/2,y:i>=this.y-this.height/2&&s<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this);o.children=[],this.children.forEach(function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&o.children.push(r)});var i=o.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,o},e.prototype.getHistoryData=function(){var t=n.prototype.getData.call(this);t.children=gr([],vr(this.children),!1),t.isGroup=!0;var o=t.properties;return o==null||delete o.groupAddable,o!=null&&o.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(nJ);(function(n){bm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,o=t.resizable,i=t.properties;return o&&!i.isFolded?n.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.properties,u=t.getAddableOutlineStyle;if(!l.groupAddable)return null;var c=this.props.model.getNodeStyle().strokeWidth,f=c===void 0?0:c,p=u(),h=o+f+8,g=i+f+8;return Ze("rect",wu(wu({},p),{width:h,height:g,x:r-h/2,y:s-g/2,rx:a,ry:a}))},e.prototype.getFoldIcon=function(){var t=this.props.model,o=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var r=Ze("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," M").concat(o+7,",").concat(i+2," ").concat(o+7,",").concat(i+10):"M ".concat(o+3,",").concat(i+6," ").concat(o+11,",").concat(i+6," ")});return Ze("g",{},[Ze("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),r])},e.prototype.getResizeShape=function(){return Ze("g",{},[this.getAddableShape(),n.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(oJ);var xv=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),va=function(){return va=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},va.apply(this,arguments)};function rJ(n){var e=(function(o){xv(i,o);function i(r,s){r.id||(r.id="Flow_".concat(KK()));var a=va(va(va({},{}),r.properties),{isDefaultFlow:!1});return r.properties=a,o.call(this,r,s)||this}return i.extendKey="SequenceFlowModel",i})(Cs),t=(function(o){xv(i,o);function i(){return o!==null&&o.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var r=this.props.model,s=r.properties.isDefaultFlow;return s?Ze("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):Ze("path",{d:""})},i.extendKey="SequenceFlowEdge",i})(ks);return{type:"bpmn:sequenceFlow",view:t,model:e}}rJ();var wv={width:40,height:40},Cv={width:40,height:40},Sv={width:100,height:80},Cu={width:100,height:80},kv={width:100,height:80},Ev={width:100,height:80},Dv={width:100,height:80},Av={width:100,height:80},Ov={width:100,height:80},Nv={width:100,height:80},io=function(){};io.ObjTree=function(){return this};io.ObjTree.VERSION="0.23";io.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;io.ObjTree.prototype.attr_prefix="-";io.ObjTree.prototype.parseXML=function(n){var e;if(window.DOMParser){var t=new DOMParser,o=t.parseFromString(n,"application/xml");if(!o)return;e=o.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};io.ObjTree.prototype.parseHTTP=function(n,e,t){var o={};for(var i in e)o[i]=e[i];if(o.method||(typeof o.postBody>"u"&&typeof o.postbody>"u"&&typeof o.parameters>"u"?o.method="get":o.method="post"),t){o.asynchronous=!0;var r=this,s=t,a=o.onComplete;o.onComplete=function(c){var f;c&&c.responseXML&&c.responseXML.documentElement&&(f=r.parseDOM(c.responseXML.documentElement)),s(f,c),a&&a(c)}}else o.asynchronous=!1;var l;if(typeof HTTP<"u"&&HTTP.Request){o.uri=n;var u=new HTTP.Request(o);u&&(l=u.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var u=new Ajax.Request(n,o);u&&(l=u.transport)}if(t)return l;if(l&&l.responseXML&&l.responseXML.documentElement)return this.parseDOM(l.responseXML.documentElement)};io.ObjTree.prototype.parseDOM=function(n){if(n){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(n);if(this.__force_array[n.nodeName]&&(t=[t]),n.nodeType!==11){var o={};o[n.nodeName]=t,t=o}return t}};io.ObjTree.prototype.parseElement=function(n){if(n.nodeType!==7){if(n.nodeType===3||n.nodeType===4||n.nodeType===8){var e=n.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:n.nodeValue}var t=null,o={};if(n.attributes&&n.attributes.length){t={};for(var i=0;i<n.attributes.length;i++){var r=n.attributes[i].nodeName;if(typeof r=="string"){var s=n.attributes[i].nodeValue;try{s=JSON.parse(n.attributes[i].nodeValue.replace(/'/g,'"'))}catch{s=n.attributes[i].nodeValue}s!=null&&(r=this.attr_prefix+r,typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}if(n.childNodes&&n.childNodes.length){var a=!0;t&&(a=!1);for(var i=0;i<n.childNodes.length&&a;i++){var l=n.childNodes[i].nodeType;l===3||l===4||l===8||(a=!1)}if(a){t||(t="");for(var i=0;i<n.childNodes.length;i++)t+=n.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i].nodeName;if(typeof r=="string"){var s=this.parseElement(n.childNodes[i]);s&&(typeof o[r]>"u"&&(o[r]=0),o[r]++,this.addNode(t,r,o[r],s))}}}}else t===null&&(t={});return t}};io.ObjTree.prototype.addNode=function(n,e,t,o){this.__force_array[e]?(t===1&&(n[e]=[]),n[e][n[e].length]=o):t===1?n[e]=o:t===2?n[e]=[n[e],o]:n[e][n[e].length]=o};io.ObjTree.prototype.writeXML=function(n){var e=this.hash_to_xml(null,n);return this.xmlDecl+e};io.ObjTree.prototype.hash_to_xml=function(n,e){var t=[],o=[];for(var i in e)if(ma(e,i)){var r=e[i];i.charAt(0)!==this.attr_prefix?typeof r>"u"||r==null?t[t.length]="<".concat(i," />"):typeof r=="object"&&r.constructor===Array?t[t.length]=this.array_to_xml(i,r):typeof r=="object"?t[t.length]=this.hash_to_xml(i,r):t[t.length]=this.scalar_to_xml(i,r):o[o.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(r),'"')}var s=o.join(""),a=t.join("");return typeof n>"u"||n==null||(t.length>0?a.match(/\n/)?a="<".concat(n).concat(s,`>
`).concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,">").concat(a,"</").concat(n,`>
`):a="<".concat(n).concat(s,` />
`)),a};io.ObjTree.prototype.array_to_xml=function(n,e){for(var t=[],o=0;o<e.length;o++){var i=e[o];typeof i>"u"||i==null?t[t.length]="<".concat(n," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(n,i):typeof i=="object"?t[t.length]=this.hash_to_xml(n,i):t[t.length]=this.scalar_to_xml(n,i)}return t.join("")};io.ObjTree.prototype.scalar_to_xml=function(n,e){return n==="#text"?this.xml_escape(e):"<".concat(n,">").concat(this.xml_escape(e),"</").concat(n,`>
`)};io.ObjTree.prototype.xml_escape=function(n){return n.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var sJ=function(n){return new io.ObjTree().parseXML(n)};function xm(n){return Object.prototype.toString.call(n)}function Mv(n){return"  ".repeat(n)}function Su(n){return xm(n)==="[object Object]"?Object.keys(n).reduce(function(e,t){var o=t;return t.charAt(0)==="-"&&(o=t.substring(1)),e[o]=Su(n[t]),e},{}):Array.isArray(n)?n.map(function(e){return Su(e)}):n}function aJ(n){var e=n;try{typeof e!="string"&&(e=JSON.parse(n))}catch{e=JSON.stringify(Su(n)).replace(/"/g,"'")}return e}var Tv=`	
`;function Pl(n,e,t){var o=Mv(t),i="",r=Tv+o;if(e==="-json")return"";if(e==="#text")return r+n;if(e==="#cdata-section")return"".concat(r,"<![CDATA[").concat(n,"]]>");if(e==="#comment")return"".concat(r,"<!--").concat(n,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(aJ(n),'"');if(Array.isArray(n))i+=n.map(function(u){return Pl(u,e,t+1)}).join("");else if(xm(n)==="[object Object]"){var s=Object.keys(n),a="",l=n["-json"]?Tv+Mv(t+1)+n["-json"]:"";i+="".concat(t===0?"":r,"<").concat(e),s.forEach(function(u){u.charAt(0)==="-"?a+=Pl(n[u],u,t+1):l+=Pl(n[u],u,t+1)}),i+=a+(l!==""?">".concat(l).concat(r,"</").concat(e,">"):" />")}else i+="".concat(r,"<").concat(e,">").concat(n.toString(),"</").concat(e,">");return i}function lJ(n){var e="";for(var t in n)e+=Pl(n[t],t,0);return e}var uJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),zc=function(){return zc=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zc.apply(this,arguments)},$v=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]]);return t},Rf=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kn=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Go=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},to;(function(n){n.START="bpmn:startEvent",n.END="bpmn:endEvent",n.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",n.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",n.BOUNDARY="bpmn:boundaryEvent",n.PARALLEL_GATEWAY="bpmn:parallelGateway",n.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",n.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",n.USER="bpmn:userTask",n.SYSTEM="bpmn:serviceTask",n.FLOW="bpmn:sequenceFlow",n.SUBPROCESS="bpmn:subProcess"})(to||(to={}));var wm=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],dJ=["properties","startPoint","endPoint","pointsList"],ku={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},Cm=function(n,e){var t=Object.keys(e||{});return t.forEach(function(o){if(n[o]){var i=e[o],r=i.in,s=i.out;r&&(n[o].in=r),s&&(n[o].out=s)}else n[o]=e[o]}),n},Eo={"bpmn:startEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateCatchEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:intermediateThrowEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:boundaryEvent":{out:function(n){var e,t,o=n.properties;return((t=(e=Eo[o.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,n))||{}}},"bpmn:sequenceFlow":{out:function(n){var e=n.properties,t=e.expressionType,o=e.condition;return o?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(o,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(o,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(n){var e=n.properties,t=e.timerType,o=e.timerValue,i=e.definitionId,r=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(o,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&o?">".concat(r(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(n,e){var t,o,i,r,s=n,a=e["-id"],l="",u="";try{for(var c=Rf(Object.keys(e)),f=c.next();!f.done;f=c.next()){var p=f.value;p.includes("bpmn:")&&(i=Kn(p.split(":"),2),l=i[1],u=(r=e[p])===null||r===void 0?void 0:r["#text"])}}catch(h){t={error:h}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(t)throw t.error}}return{"-definitionId":a,"-definitionType":s,"-timerType":l,"-timerValue":u}}},"bpmn:conditionExpression":{in:function(n,e){var t,o="",i="";return e["#cdata-section"]?(i="cdata",o=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",o=e["#text"]),{"-condition":o,"-expressionType":i}}}};function cJ(n){var e=n??{},t=e.retainedAttrsFields,o=e.excludeFields,i=e.transformer,r=new Set(Go(Go([],Kn(dJ),!1),Kn(t||[]),!1)),s={in:new Set(Go(Go([],Kn(ku.in),!1),Kn((o==null?void 0:o.in)||[]),!1)),out:new Set(Go(Go([],Kn(ku.out),!1),Kn((o==null?void 0:o.out)||[]),!1))};return Eo=Cm(Eo,i),function(a){var l=a.nodes,u=a.edges;function c(f,p){var h,g;if((f==null?void 0:f.flag)!==1){var m;if((m=Eo[f.type])&&m.out){var _=m.out(f),v=Object.keys(_);v.length>0&&v.forEach(function(N){f[N]=_[N]})}f!=null&&f.children&&(f.children=f.children.map(function(N){var L=l.find(function($){return $.id===N})||u.find(function($){return $.id===N});return L||{}}));var b={};if(typeof f=="string")return f;if(Array.isArray(f))return f.map(function(N){return c(N,"")}).filter(function(N){return N!=null});try{for(var C=Rf(Object.entries(f)),M=C.next();!M.done;M=C.next()){var O=Kn(M.value,2),k=O[0],E=O[1];if((E==null?void 0:E.flag)===1)return;var S=[p,k].filter(function(N){return N}).join(".");s.out.has(S)||(typeof E!="object"?k.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(k)?b[k]=E:b["-".concat(k)]=E:r.has(S)?b["-".concat(k)]=c(E,S):b[k]=c(E,S))}}catch(N){h={error:N}}finally{try{M&&!M.done&&(g=C.return)&&g.call(C)}finally{if(h)throw h.error}}return b}}return c(a,"")}}function Eu(n){var e,t,o={};try{for(var i=Rf(Object.entries(n)),r=i.next();!r.done;r=i.next()){var s=Kn(r.value,2),a=s[0],l=s[1];a.indexOf("-")===0?o[a.substring(1)]=Su(l):typeof l=="string"?o[a]=l:Object.prototype.toString.call(l)==="[object Object]"?o[a]=Eu(l):Array.isArray(l)?o[a]=l.map(function(u){return Eu(u)}):o[a]=l}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o}function fJ(n,e,t){var o,i=new Map,r=cJ(t)(e);r.nodes.forEach(function(a){var l=a["-id"],u=a["-type"],c=a.text,f=a.children,p=$v(a,["-id","-type","text","children"]),h={"-id":l};c!=null&&c["-value"]&&(h["-name"]=c["-value"]),p["-json"]&&(h["-json"]=p["-json"]),p["-properties"]&&Object.assign(h,p["-properties"]),f&&(h.children=f),n[u]||(n[u]=[]),n[u].push(h),i.set(l,h)});var s=r.edges.map(function(a){var l=a["-id"],u=a["-sourceNodeId"],c=a["-targetNodeId"],f=a.text,p=$v(a,["-id","-sourceNodeId","-targetNodeId","text"]),h=i.get(c);h["bpmn:incoming"]||(h["bpmn:incoming"]=[]),h["bpmn:incoming"].push(l);var g={"-id":l,"-sourceRef":u,"-targetRef":c};return f!=null&&f["-value"]&&(g["-name"]=f["-value"]),p["-json"]&&(g["-json"]=p["-json"]),p["-properties"]&&Object.assign(g,p["-properties"]),g});return e.edges.forEach(function(a){var l=a.sourceNodeId,u=a.id,c=i.get(l);c["bpmn:outgoing"]||(c["bpmn:outgoing"]=[]),c["bpmn:outgoing"].push(u)}),(o=n["bpmn:subProcess"])===null||o===void 0||o.forEach(function(a){var l={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},u=[];a.children.forEach(function(m){var _,v=i.get(m["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(C){v[C]&&v[C].forEach(function(M){l[C].add(M)})});var b=(_=n[m["-type"]])===null||_===void 0?void 0:_.findIndex(function(C){return C["-id"]===m["-id"]});b>=0&&n[m["-type"]].splice(b,1),i.delete(m["-id"]),a[m["-type"]]||(a[m["-type"]]=[]),a[m["-type"]].push(v)});var c=l["bpmn:incoming"],f=l["bpmn:outgoing"];f.forEach(function(m){c.has(m)&&u.push(m)});for(var p=function(m){var _=s.findIndex(function(v){return v["-id"]===u[m]});_>=0?(a["bpmn:sequenceFlow"]||(a["bpmn:sequenceFlow"]=[]),a["bpmn:sequenceFlow"].push(s[_]),s.splice(_,1)):m++,h=m},h,g=0;g<u.length;)p(g),g=h;delete a.children}),n[to.FLOW]=s,n}function pJ(n,e){n["bpmndi:BPMNEdge"]=e.edges.map(function(t){var o,i=t.id,r=t.pointsList.map(function(a){var l=a.x,u=a.y;return{"-x":l,"-y":u}}),s={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":r};return!((o=t.text)===null||o===void 0)&&o.value&&(s["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),s}),n["bpmndi:BPMNShape"]=e.nodes.map(function(t){var o,i=t.id,r=100,s=80,a=t.x,l=t.y,u=fo.shapeConfigMap.get(t.type);u&&(r=u.width,s=u.height),a-=r/2,l-=s/2;var c={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":a,"-y":l,"-width":r,"-height":s}};return!((o=t.text)===null||o===void 0)&&o.value&&(c["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),c})}var hJ=["bpmn:incoming","bpmn:outgoing"];function vJ(n,e){var t=[],o=[],i=new Map,r=e??{},s=r.transformer,a=r.excludeFields,l={in:new Set(Go(Go([],Kn(ku.in),!1),Kn((a==null?void 0:a.in)||[]),!1)),out:new Set(Go(Go([],Kn(ku.out),!1),Kn((a==null?void 0:a.out)||[]),!1))};Eo=Cm(Eo,s);var u=n["bpmn:definitions"];if(u){var c=u["bpmn:process"];(function(p,h){h.forEach(function(g){try{Object.keys(p).forEach(function(m){try{g(m)}catch(_){console.error(_)}})}catch(m){console.error(m)}})})(c,[function(p){function h(m){m["-children"]||(m["-children"]=[]),Object.keys(m).forEach(function(_){var v;_.indexOf("bpmn:")===0&&!hJ.includes(_)&&(c[_]||(c[_]=[]),!Array.isArray(c[_])&&(c[_]=[c[_]]),Array.isArray(m[_])?(v=c[_]).push.apply(v,Go([],Kn(m[_]),!1)):c[_].push(m[_]),Array.isArray(m[_])?m[_].forEach(function(b){!_.includes("Flow")&&m["-children"].push(b["-id"])}):!_.includes("Flow")&&m["-children"].push(m[_]["-id"]),delete m[_])})}if(p==="bpmn:subProcess"){var g=c[p];Array.isArray(g)?g.forEach(function(m){p==="bpmn:subProcess"&&h(m)}):h(g)}},function(p){var h=function(m){Object.keys(m).forEach(function(_){var v,b;if(_.includes("bpmn:")){var C={};Eo[_]&&Eo[_].in?(C=(b=(v=Eo[_]).in)===null||b===void 0?void 0:b.call(v,_,mg.cloneDeep(m[_])),delete m[_]):g(m[_]);var M=void 0;(M=Reflect.ownKeys(C)).length>0&&M.forEach(function(O){Reflect.set(m,O,C[O])})}})};function g(m){i.set(m["-id"],m),Array.isArray(m)?m.forEach(function(_){g(_)}):typeof m=="object"&&h(m)}g(c[p])},function(p){if(p.indexOf("bpmn:")===0){var h=c[p];if(p==="bpmn:sequenceFlow"){var g=u["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];o=_J(h,g)}else{var m=u["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(p==="bpmn:boundaryEvent"){var _=c[p],v=function(b){var C=b["-attachedToRef"],M=i.get(C);M["-boundaryEvents"]||(M["-boundaryEvents"]=[]),M["-boundaryEvents"].push(b["-id"])};Array.isArray(_)?_.forEach(function(b){v(b)}):v(_)}t=t.concat(gJ(h,m,p))}}}])}var f=function(p,h,g){Object.keys(p).forEach(function(m){var _=g?"".concat(g,".").concat(m):m;h.has(_)?delete p[m]:typeof p[m]=="object"&&f(p[m],h,_)})};return t.forEach(function(p){var h,g;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var m=(g=e==null?void 0:e.mapping)===null||g===void 0?void 0:g.in,_=p.type;m[_]&&(p.type=m[_])}f(p,l.in,"")}),o.forEach(function(p){var h,g;if(!((h=e==null?void 0:e.mapping)===null||h===void 0)&&h.in){var m=(g=e==null?void 0:e.mapping)===null||g===void 0?void 0:g.in,_=p.type;m[_]&&(p.type=m[_])}f(p,l.in,"")}),{nodes:t,edges:o}}function gJ(n,e,t){var o=[];if(Array.isArray(n))n.forEach(function(s){var a;Array.isArray(e)?a=e.find(function(u){return u["-bpmnElement"]===s["-id"]}):a=e;var l=Pv(a,t,s);o.push(l)});else{var i=void 0;Array.isArray(e)?i=e.find(function(s){return s["-bpmnElement"]===n["-id"]}):i=e;var r=Pv(i,t,n);o.push(r)}return o}function Pv(n,e,t){var o=Number(n["dc:Bounds"]["-x"]),i=Number(n["dc:Bounds"]["-y"]),r=t["-children"],s=t["-name"],a=fo.shapeConfigMap.get(e);a&&(o+=a.width/2,i+=a.height/2);var l={};Object.entries(t).forEach(function(p){var h=Kn(p,2),g=h[0],m=h[1];wm.includes(g)||(l[g]=m)}),l=Eu(l);var u;if(s&&(u={x:o,y:i,value:s},n["bpmndi:BPMNLabel"]&&n["bpmndi:BPMNLabel"]["dc:Bounds"])){var c=n["bpmndi:BPMNLabel"]["dc:Bounds"];u.x=Number(c["-x"])+Number(c["-width"])/2,u.y=Number(c["-y"])+Number(c["-height"])/2}var f={id:n["-bpmnElement"],type:e,x:o,y:i,properties:l};return r&&(f.children=r),u&&(f.text=u),f}function _J(n,e){var t=[];if(Array.isArray(n))n.forEach(function(i){var r;Array.isArray(e)?r=e.find(function(s){return s["-bpmnElement"]===i["-id"]}):r=e,t.push(Rv(r,i))});else{var o=void 0;Array.isArray(e)?o=e.find(function(i){return i["-bpmnElement"]===n["-id"]}):o=e,t.push(Rv(o,n))}return t}function Rv(n,e){var t,o=e["-name"]?"".concat(e["-name"]):"";if(o){var i=n["bpmndi:BPMNLabel"]["dc:Bounds"],r=0;o.split(`
`).forEach(function(u){r<u.length&&(r=u.length)}),t={value:o,x:Number(i["-x"])+r*10/2,y:Number(i["-y"])+7}}var s={};Object.entries(e).forEach(function(u){var c=Kn(u,2),f=c[0],p=c[1];wm.includes(f)||(s[f]=p)}),s=Eu(s);var a=n["di:waypoint"].map(function(u){return{x:Number(u["-x"]),y:Number(u["-y"])}}),l={id:e["-id"],type:to.FLOW,pointsList:a,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:s};return t&&(l.text=t),l}var fo=(function(){function n(e){var t=e.lf,o=this;this.adapterOut=function(i,r){var s,a,l=zc({},o.processAttributes);fJ(l,i,r);var u={"-id":"BPMNPlane_1","-bpmnElement":l["-id"]};pJ(u,i);var c=o.definitionAttributes;c["bpmn:process"]=l,c["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":u};var f={"bpmn:definitions":c};if(!((s=r==null?void 0:r.mapping)===null||s===void 0)&&s.out){var p=(a=r==null?void 0:r.mapping)===null||a===void 0?void 0:a.out,h=function(g){Array.isArray(g)&&g.forEach(function(m){return h(m)}),typeof g=="object"&&Object.keys(g).forEach(function(m){var _;(_=p[m])?(g[_]=mg.cloneDeep(g[m]),delete g[m],h(g[_])):h(g[m])})};h(f)}return f},this.adapterIn=function(i,r){if(i)return vJ(i,r)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return n.prototype.setCustomShape=function(e,t){n.shapeConfigMap.set(e,t)},n.pluginName="bpmn-adapter",n.shapeConfigMap=new Map,n})();fo.shapeConfigMap.set(to.START,{width:wv.width,height:wv.height});fo.shapeConfigMap.set(to.END,{width:Cv.width,height:Cv.height});fo.shapeConfigMap.set(to.INTERMEDIATE_CATCH,{width:Cu.width,height:Cu.height});fo.shapeConfigMap.set(to.INTERMEDIATE_THROW,{width:Cu.width,height:Cu.height});fo.shapeConfigMap.set(to.BOUNDARY,{width:Sv.width,height:Sv.height});fo.shapeConfigMap.set(to.PARALLEL_GATEWAY,{width:kv.width,height:kv.height});fo.shapeConfigMap.set(to.INCLUSIVE_GATEWAY,{width:Ev.width,height:Ev.height});fo.shapeConfigMap.set(to.EXCLUSIVE_GATEWAY,{width:Dv.width,height:Dv.height});fo.shapeConfigMap.set(to.SYSTEM,{width:Av.width,height:Av.height});fo.shapeConfigMap.set(to.USER,{width:Ov.width,height:Ov.height});fo.shapeConfigMap.set(to.SUBPROCESS,{width:Nv.width,height:Nv.height});(function(n){uJ(e,n);function e(t){var o=n.call(this,t)||this;o.adapterXmlIn=function(s){var a=sJ(s);return o.adapterIn(a,o.props)},o.adapterXmlOut=function(s){var a=o.adapterOut(s,o.props);return lJ(a)};var i=t.lf,r=t.props;return i.adapterIn=o.adapterXmlIn,i.adapterOut=o.adapterXmlOut,o.props=r,o}return e.pluginName="BPMNAdapter",e})(fo);function mJ(n,e,t){var o=e.x,i=e.y,r=n.x,s=n.y,a=r-o,l=s-i,u=a*Math.cos(t)-l*Math.sin(t),c=a*Math.sin(t)+l*Math.cos(t),f=u+o,p=c+i;return{x:f,y:p}}var yJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Du=function(){return Du=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Du.apply(this,arguments)},bJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},xJ=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},wJ=(function(n){yJ(e,n);function e(){var t=n.apply(this,xJ([],bJ(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(o){var i=o.model,r=t.props,s=r.model,a=r.graphModel,l=s.transformWithContainer,u=s.isRestrict,c=t.childrenPositionMap;if(!(!l||u)&&i.id===s.id){var f={x:s.x,y:s.y};Lt(Array.from(s.children),function(p){var h=a.getNodeModelById(p);if(h){var g={x:h.x,y:h.y};c.has(h.id)?g=c.get(h.id):c.set(h.id,g);var m=i.rotate*(180/Math.PI);m<0&&(m+=360);var _=m*(Math.PI/180),v=mJ(g,f,_);h.moveTo(v.x,v.y),h.rotate=i.rotate}})}},t.onNodeResize=function(o){var i=o.deltaX,r=o.deltaY,s=o.index,a=o.model,l=o.preData,u=t.props,c=u.model,f=u.graphModel,p=c.transformWithContainer,h=c.isRestrict;if(!(!p||h)&&a.id===c.id){var g=l.properties,m=g||{},_=m.width,v=m.height;Lt(Array.from(c.children),function(b){var C=f.getNodeModelById(b);if(C){var M=C.width/_*i,O=C.height/v*r;em({deltaX:M,deltaY:O,index:s,nodeModel:C,graphModel:f,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var o=t.props.model;o.isCollapsed&&o.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,o){var i=this,r=[];return t.isGroup&&Lt(Array.from(t.children),function(s){r.push(s);var a=o.getNodeModelById(s);a!=null&&a.isGroup&&(r=r.concat(i.getNodesInGroup(a,o)))}),r},e.prototype.getResizeControl=function(){var t=this.props.model,o=t.resizable,i=t.isCollapsed,r=o&&!i;return r?n.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,o=t.width,i=t.height,r=t.x,s=t.y,a=t.radius,l=t.groupAddable;if(!l)return null;var u=t.getNodeStyle().strokeWidth,c=u===void 0?0:u,f=t.getAddableOutlineStyle(),p=o+c+8,h=i+c+8;return Ze("rect",Du(Du({},f),{width:p,height:h,x:r-p/2,y:s-h/2,rx:a,ry:a}))},e.prototype.getCollapseIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," M").concat(t+7,",").concat(o+2," ").concat(t+7,",").concat(o+10)},e.prototype.getExpandIcon=function(t,o){return"M ".concat(t+3,",").concat(o+6," ").concat(t+11,",").concat(o+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=o-r/2+10,l=i-s/2+10;if(!t.collapsible)return null;var u=t!=null&&t.isCollapsed?this.getCollapseIcon(a,l):this.getExpandIcon(a,l),c=Ze("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:u});return Ze("g",{},[Ze("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:a,y:l,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),c])},e.prototype.getShape=function(){return Ze("g",{},[this.getAppendAreaShape(),n.prototype.getShape.call(this),this.getOperateIcon()])},e})(Pr),CJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Au=function(){return Au=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Au.apply(this,arguments)},Td=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Yr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Ws=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},SJ=400,kJ=230,EJ=80,DJ=60,AJ=-1e4,OJ=(function(n){CJ(e,n);function e(t,o){var i=n.call(this,t,o)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var o;n.prototype.initNodeData.call(this,t);var i=(o=t.properties)!==null&&o!==void 0?o:{},r=i.children,s=i.width,a=i.height,l=i.collapsedWidth,u=i.collapsedHeight,c=i.collapsible,f=i.isCollapsed,p=i.zIndex,h=i.isRestrict,g=i.autoResize,m=i.autoToFront,_=i.transformWithContainer;this.children=r?new Set(r):new Set,this.zIndex=p??AJ,this.isCollapsed=f??!1,this.setProperties({isCollapsed:f??!1});var v=s??SJ,b=a??kJ;this.width=v,this.height=b,this.expandWidth=v,this.expandHeight=b,this.collapsedWidth=l??EJ,this.collapsedHeight=u??DJ,this.isRestrict=h??!1,this.transformWithContainer=_??!1,this.autoResize=g??!1,this.collapsible=c??!0,this.autoToFront=m??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){n.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,o=n.prototype.getData.call(this),i=[];return Lt(Array.from(this.children),function(r){var s=t.graphModel.getNodeModelById(r);s&&!s.virtual&&i.push(r)}),o.children=i,o.properties&&(o.properties.children=i,o.properties.isCollapsed=this.isCollapsed),o},e.prototype.getNodesInGroup=function(t){var o=[];return t.isGroup&&Lt(Array.from(t.children),function(i){o.push(i)}),o},e.prototype.getMoveDistance=function(t,o,i){i===void 0&&(i=!1);var r=Yr(n.prototype.getMoveDistance.call(this,t,o,i),2),s=r[0],a=r[1],l=this.getNodesInGroup(this);return this.graphModel.moveNodes(l,t,o,i),[s,a]},e.prototype.getHistoryData=function(){var t=n.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var o=this,i=o.x,r=o.y,s=o.collapsedWidth,a=o.collapsedHeight,l=o.expandWidth,u=o.expandHeight,c=o.isCollapsed;return c&&(t.x=i+l/2-s/2,t.y=r+u/2-a/2,t.text&&(t.text.x=t.text.x+l/2-s/2,t.text.y=t.text.y+u/2-a/2)),t},e.prototype.toggleCollapse=function(t){var o=this,i=this.graphModel,r=!!t;this.isCollapsed=r,this.setProperties({isCollapsed:r}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:r,nodeModel:this}),r?this.collapse():this.expand();var s=Ws(Ws([],Yr(this.incoming.edges),!1),Yr(this.outgoing.edges),!1),a=Array.from(this.children);Lt(a,function(l){var u,c,f=o.graphModel.elementsModelMap.get(l);if(f){var p=f.isCollapsed;if(f.isGroup){var h=f;if(h.isCollapsed||h.toggleCollapse(t),!t){var g=(u=o.childrenLastCollapseStateDict)===null||u===void 0?void 0:u.get(l);g!==void 0&&g!==f.isCollapsed&&h.toggleCollapse(g)}}if((c=o.childrenLastCollapseStateDict)===null||c===void 0||c.set(l,!!p),f.visible=!t,f.BaseType===Sn.NODE){var m=f.incoming.edges,_=f.outgoing.edges;s=Ws(Ws(Ws([],Yr(s),!1),Yr(m),!1),Yr(_),!1)}}}),this.collapseEdge(r,s)},e.prototype.collapse=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.width,a=t.height,l=t.collapsedWidth,u=t.collapsedHeight;this.x=o-s/2+l/2,this.y=i-a/2+u/2,this.text.x=r.x-s/2+l/2,this.text.y=r.y-a/2+u/2,this.expandWidth=s,this.expandHeight=a,this.width=l,this.height=u},e.prototype.expand=function(){var t=this,o=t.x,i=t.y,r=t.text,s=t.expandWidth,a=t.expandHeight,l=t.collapsedWidth,u=t.collapsedHeight;this.width=s,this.height=a,this.x=o+this.width/2-l/2,this.y=i+this.height/2-u/2,this.text.x=r.x+this.width/2-l/2,this.text.y=r.y+this.height/2-u/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var o=this.graphModel.addEdge(t);o.virtual=!0,o.text.editable=!1,o.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,o){var i=this,r=this.graphModel;Lt(o,function(s,a){var l,u=s.getData(),c=u.targetNodeId,f=u.sourceNodeId,p=Au(Au({},u),{id:"".concat(u.id,"__").concat(a),text:(l=u.text)===null||l===void 0?void 0:l.value});s.virtual&&r.deleteEdgeById(s.id);var h=r.dynamicGroup.getGroupByNodeId(c);h||(h=r.getNodeModelById(c));var g=r.dynamicGroup.getGroupByNodeId(f);g||(g=r.getNodeModelById(f)),t&&s.visible&&(i.children.has(f)||i.id===f?(p.startPoint=void 0,p.sourceNodeId=i.id):(p.endPoint=void 0,p.targetNodeId=i.id),(h.id!==i.id||g.id!==i.id)&&i.createVirtualEdge(p),s.visible=!1),!t&&!s.visible&&(h&&h.isGroup&&h.isCollapsed?(p.targetNodeId=h.id,p.endPoint=void 0,i.createVirtualEdge(p)):g&&g.isGroup&&g.isCollapsed?(p.sourceNodeId=g.id,p.startPoint=void 0,i.createVirtualEdge(p)):s.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var o=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:o,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var o=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:o})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=n.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=n.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Td([Pe],e.prototype,"isCollapsed",void 0),Td([Pe],e.prototype,"groupAddable",void 0),Td([Pe],e.prototype,"transformWithContainer",void 0),e})(Ss);function NJ(n,e){var t=n.minX,o=n.minY,i=n.maxX,r=n.maxY,s=e.x,a=e.y,l=e.width,u=e.height;return t>=s-l/2&&i<=s+l/2&&o>=a-u/2&&r<=a+u/2}function MJ(n,e,t,o){var i=n.minX,r=n.minY,s=n.maxX,a=n.maxY,l=e.x,u=e.y,c=e.width,f=e.height,p=i+c/2,h=r+f/2,g=s-c/2,m=a-f/2;return{x:l+t>=p&&l+t<=g,y:u+o>=h&&u+o<=m}}var Ou=function(){return Ou=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ou.apply(this,arguments)},Kr=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Jr=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},Za={type:"dynamic-group",view:wJ,model:OJ},TJ=-1e3,El=-1e4,$J=(function(){function n(e){var t=e.lf,o=e.options,i=this;this.topGroupZIndex=El,this.nodeGroupMap=new Map,this.onSelectionDrop=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.addNodeToGroup(s)})},this.onNodeAddOrDrop=function(r){var s=r.data;i.addNodeToGroup(s)},this.addNodeToGroup=function(r){var s=i.nodeGroupMap.get(r.id);if(s){var a=i.lf.getNodeModelById(s);a.removeChild(r.id),i.nodeGroupMap.delete(r.id),a.setAllowAppendChild(!1)}var l=i.lf.getNodeModelById(r.id),u=l==null?void 0:l.getBounds();if(l&&u){if(l.isGroup){var c=l;Lt(Array.from(c.children),function(h){i.nodeGroupMap.set(h,r.id)}),i.calibrateTopGroupZIndex([r]),i.onNodeSelect({data:r,isSelected:!1,isMultiple:!1})}var a=i.getGroupByBounds(u,r);if(a){var f=a.isAllowAppendIn(r);f?(a.addChild(r.id),a.setAllowAppendChild(!1)):i.lf.emit("group:not-allowed",{group:a.getData(),node:r})}}},this.onGroupAddNode=function(r){var s=r.data,a=r.childId;i.nodeGroupMap.set(a,s.id)},this.removeNodeFromGroup=function(r){var s=r.data,a=r.model;a.isGroup&&s.children&&Lt(Array.from(s.children),function(c){i.nodeGroupMap.delete(c),i.lf.deleteNode(c)});var l=i.nodeGroupMap.get(s.id);if(l){var u=i.lf.getNodeModelById(l);u&&u.removeChild(s.id),i.nodeGroupMap.delete(s.id)}},this.onSelectionDrag=function(){var r=i.lf.graphModel.getSelectElements().nodes;r.forEach(function(s){i.setActiveGroup(s)})},this.onNodeDrag=function(r){var s=r.data;i.setActiveGroup(s)},this.setActiveGroup=function(r){var s=i.lf.getNodeModelById(r.id),a=s==null?void 0:s.getBounds();if(s&&a){var l=i.getGroupByBounds(a,r);if(i.activeGroup&&i.activeGroup.setAllowAppendChild(!1),!l||s.isGroup&&l.id===r.id)return;var u=l.isAllowAppendIn(r);if(!u)return;i.activeGroup=l,i.activeGroup.setAllowAppendChild(!0)}},this.onNodeSelect=function(r){var s=r.data,a=r.isMultiple,l=r.isSelected,u=i.lf.getNodeModelById(s.id);if(i.sendNodeToFront(u),i.topGroupZIndex>TJ){var c=i.lf.graphModel.nodes;i.topGroupZIndex=El;var f=By(el(c,function(_){return!!_.isGroup}),"zIndex"),p=0;Lt(f,function(_){_.zIndex!==p&&(i.topGroupZIndex++,p=_.zIndex),_.setZIndex(i.topGroupZIndex)})}if(a&&l)if(u!=null&&u.isGroup){var h=u.children;Lt(Array.from(h),function(_){var v=i.lf.getNodeModelById(_);v==null||v.setSelected(!1)})}else{var g=i.nodeGroupMap.get(s.id);if(g){var m=i.lf.getNodeModelById(g);m!=null&&m.isSelected&&(u==null||u.setSelected(!1))}}},this.onNodeMove=function(r){var s=r.deltaX,a=r.deltaY,l=r.data,u=l.id,c=l.x,f=l.y,p=l.properties;if(p){var h=p.width,g=p.height,m=i.nodeGroupMap.get(u);if(m){var _=i.lf.getNodeModelById(m);if(!(!_||!_.isRestrict||!_.autoResize)){var v=c+s/2,b=f+a/2,C=v-h/2,M=b-g/2,O=v+h/2,k=b+g/2,E=!1,S=_.getBounds(),N=Object.assign({},S);if(C<N.minX&&(N.minX=C,E=!0),M<N.minY&&(N.minY=M,E=!0),O>N.maxX&&(N.maxX=O,E=!0),k>N.maxY&&(N.maxY=k,E=!0),!!E){var L=N.minX+(N.maxX-N.minX)/2,$=N.minY+(N.maxY-N.minY)/2,B=N.maxX-N.minX,A=N.maxY-N.minY;_.moveTo(L,$),_.width=B,_.height=A}}}}},this.onGraphRendered=function(r){var s=r.data;Lt(s.nodes,function(a){a.children&&Lt(a.children,function(l){i.nodeGroupMap.set(l,a.id)})}),i.calibrateTopGroupZIndex(s.nodes)},t.register(Za),this.lf=t,an(this,o),this.init()}return n.prototype.getGroupByNodeId=function(e){var t=this.nodeGroupMap.get(e);if(t)return this.lf.getNodeModelById(t)},n.prototype.getGroupByBounds=function(e,t){var o=this.lf.graphModel.nodes,i=el(o,function(l){return!!l.isGroup&&NJ(e,l)&&l.id!==t.id}),r=i.length;if(r<=1)return i[0];for(var s=i[r-1],a=r-2;a>=0;a--)i[a].zIndex>s.zIndex&&(s=i[a]);return s},n.prototype.sendNodeToFront=function(e){var t=this;if(!(!e||!e.isGroup)&&(this.topGroupZIndex++,e.setZIndex(this.topGroupZIndex),e.children)){var o=e.children;Lt(Array.from(o),function(i){var r=t.lf.getNodeModelById(i);t.sendNodeToFront(r)})}},n.prototype.getMaxZIndex=function(e){var t=this,o=El;if(e.isGroup&&(o=Math.max(o,e.zIndex)),e.children){var i=e.children;Lt(Array.from(i),function(r){var s=t.lf.getNodeModelById(r);if(s!=null&&s.isGroup){var a=t.getMaxZIndex(s);o=Math.max(o,a)}})}return o},n.prototype.calibrateTopGroupZIndex=function(e){var t=this,o=El;if(Lt(e,function(a){var l=t.lf.getNodeModelById(a.id);if(l){var u=t.getMaxZIndex(l);u>o&&(o=u)}}),!(this.topGroupZIndex>=o)){var i=this.lf.graphModel.nodes,r=el(i,function(a){return!!a.isGroup}),s=this.topGroupZIndex;Lt(r,function(a){a.zIndex>s&&(s=a.zIndex)}),this.topGroupZIndex=s}},n.prototype.removeChildrenInGroupNodeData=function(e){var t,o=Dt(e);return delete o.children,!((t=o.properties)===null||t===void 0)&&t.children&&delete o.properties.children,o},n.prototype.initGroupChildNodes=function(e,t,o,i){var r=this,s=[],a=[],l=[];Lt(Array.from(t),function(f){var p=r.lf.getNodeModelById(f);if(p){var h=p.children,g=p.getData(),m=pt.NODE_GROUP_COPY||"node:group-copy-add",_=OK(r.removeChildrenInGroupNodeData(g),i),v=r.lf.addNode(_,m);if(o.addChild(v.id),e[f]=v.id,s.push(v),l.push.apply(l,Jr([],Kr(Jr(Jr([],Kr(v.incoming.edges),!1),Kr(v.outgoing.edges),!1)),!1)),h instanceof Set){var b=r.initGroupChildNodes(e,h,v,i),C=b.childNodes,M=b.edgesData;s.push.apply(s,Jr([],Kr(C),!1)),a.push.apply(a,Jr([],Kr(M),!1))}}});var u=el(l,function(f){return ma(e,f.sourceNodeId)&&ma(e,f.targetNodeId)}),c=ti(u,function(f){return f.getData()});return{childNodes:s,edgesData:a.concat(c)}},n.prototype.createEdge=function(e,t,o){var i,r,s=e.sourceNodeId,a=e.targetNodeId,l=(i=t[s])!==null&&i!==void 0?i:s,u=(r=t[a])!==null&&r!==void 0?r:a,c=Dt(e);return e.id&&typeof e.text=="object"&&e.text!==null&&(c=NK(e,o)),this.lf.graphModel.addEdge(Ou(Ou({},c),{sourceNodeId:l,targetNodeId:u}))},n.prototype.checkGroupBoundsWithChildren=function(e,t,o,i,r){if(e.children)for(var s=e.children,a=e.x,l=e.y,u=a+t/2,c=l+o/2,f=u-i/2,p=c-r/2,h=u+i/2,g=c+r/2,m=Array.from(s),_=0;_<m.length;_++){var v=m[_],b=this.lf.getNodeModelById(v);if(b){var C=b.getBounds(),M=C.minX,O=C.minY,k=C.maxX,E=C.maxY,S=f<=M&&p<=O&&h>=k&&g>=E;if(!S)return!1}}return!0},n.prototype.init=function(){var e=this,t=this.lf,o=t.graphModel;o.addNodeMoveRules(function(i,r,s){if(i.isGroup)return!0;var a=e.nodeGroupMap.get(i.id),l=e.lf.getNodeModelById(a);if(l&&l.isRestrict){if(l.autoResize)return!0;var u=l.getBounds();return MJ(u,i,r,s)}return!0}),o.addNodeResizeRules(function(i,r,s,a,l){return i.isGroup&&i.isRestrict?e.checkGroupBoundsWithChildren(i,r,s,a,l):!0}),o.dynamicGroup=this,t.on("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),t.on("selection:drop",this.onSelectionDrop),t.on("node:delete",this.removeNodeFromGroup),t.on("node:drag,node:dnd-drag",this.onNodeDrag),t.on("selection:drag",this.onSelectionDrag),t.on("node:click",this.onNodeSelect),t.on("node:mousemove",this.onNodeMove),t.on("graph:rendered",this.onGraphRendered),t.on("group:add-node",this.onGroupAddNode),t.addElements=function(i,r){var s=i.nodes,a=i.edges;r===void 0&&(r=40);var l={},u={nodes:[],edges:[]},c=[];return Lt(s,function(f){var p,h,g=f.id,m=(h=(p=f.properties)===null||p===void 0?void 0:p.children)!==null&&h!==void 0?h:f.children,_=t.addNode(e.removeChildrenInGroupNodeData(f));if(g&&(l[g]=_.id),u.nodes.push(_),_.isGroup){var v=e.initGroupChildNodes(l,m,_,r).edgesData;c.push.apply(c,Jr([],Kr(v),!1))}}),Lt(c,function(f){e.createEdge(f,l,r)}),Lt(a,function(f){u.edges.push(e.createEdge(f,l,r))}),u},this.render()},n.prototype.render=function(){},n.prototype.destroy=function(){this.lf.off("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),this.lf.off("selection:drop",this.onSelectionDrop),this.lf.off("node:delete",this.removeNodeFromGroup),this.lf.off("node:drag,node:dnd-drag",this.onNodeDrag),this.lf.off("selection:drag",this.onSelectionDrag),this.lf.off("node:click",this.onNodeSelect),this.lf.off("node:mousemove",this.onNodeMove),this.lf.off("graph:rendered",this.onGraphRendered),this.lf.off("group:add-node",this.onGroupAddNode)},n.pluginName="dynamicGroup",n})(),Bv;(function(n){n.HORIZONTAL="horizontal",n.VERTICAL="vertical"})(Bv||(Bv={}));var PJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ga=function(){return ga=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ga.apply(this,arguments)},RJ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},BJ=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},LJ=(function(n){PJ(e,n);function e(t){var o=n.call(this,t)||this;o.textRef=zu(),o.setHoverOn=function(){var l=o.props.element;l.isDragging||o.state.isHovered||(o.setState({isHovered:!0}),l.setHovered(!0))},o.setHoverOff=function(){var l=o.props.element;o.state.isHovered&&(o.setState({isHovered:!1}),l.setHovered(!1))},o.handleMouseDown=function(l){var u,c=o.props,f=c.label,p=c.graphModel,h=p.editConfigModel.nodeTextDraggable;((u=f.draggable)!==null&&u!==void 0?u:h)&&!o.state.isDragging&&!o.state.isEditing&&o.stepDrag.handleMouseDown(l)},o.handleMouseUp=function(l){o.state.isDragging&&o.stepDrag.handleMouseUp(l)},o.handleDragging=function(l){var u=l.deltaX,c=l.deltaY;o.state.isDragging||o.setState({isDragging:!0});var f=o.props,p=f.label,h=f.graphModel,g=h.transformModel,m=BJ(g.fixDeltaXY(u,c),2),_=m[0],v=m[1];o.setElementModelLabelInfo({x:p.x+_,y:p.y+v}),h.eventCenter.emit("label:drag",{data:p.getData(),model:p})},o.handleDragEnd=function(){o.setState({isDragging:!1})},o.handleClick=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel;f.setSelected(!o.state.isSelected),o.setState({isSelected:!o.state.isSelected}),o.setElementModelLabelInfo({isSelected:!0}),p.eventCenter.emit("label:click",{data:c.getData(),e:l,model:f})},o.handleDbClick=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel;if(p.eventCenter.emit("label:dblclick",{data:c.getData(),e:l,model:f}),!c.editable){f.setSelected(!0);return}if(f.setSelected(),f.setElementState(en.TEXT_EDIT),o.setState({isEditing:!0}),o.textRef.current){o.textRef.current.contentEditable="true",o.textRef.current.focus();var h=document.createRange(),g=window.getSelection();h.selectNodeContents(o.textRef.current),h.collapse(!1),g==null||g.removeAllRanges(),g==null||g.addRange(h)}},o.handleBlur=function(l){var u=o.props,c=u.label,f=u.element,p=u.graphModel.eventCenter;p.emit("label:blur",{e:l,model:f,data:c.getData(),element:o.textRef.current}),o.setState({isDragging:!1,isHovered:!1,isSelected:!1})},o.handleInput=function(l){var u=o.props,c=u.label,f=u.graphModel;f.eventCenter.emit("label:input",{e:l,data:c.getData()})},o.reCalcLabelSize=function(){};var i=t.label,r=t.graphModel,s=r.gridSize,a=r.eventCenter;return o.stepDrag=new Fo({onDragging:o.handleDragging,onDragEnd:o.handleDragEnd,step:s,eventType:"LABEL",model:i,eventCenter:a}),o.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},o}return e.prototype.setElementModelLabelInfo=function(t){var o=this.props,i=o.label,r=o.element,s=o.graphModel,a=r.properties._label,l=a,u=Ly(l,function(p){return p.id===i.id}),c=l[u];l[u]=ga(ga({},c),t);var f=s.getElement(r.id);f==null||f.setProperty("_label",l)},e.prototype.componentDidMount=function(){var t=this,o=this.props,i=o.label,r=o.element,s=o.graphModel;s.eventCenter.on("blank:click,node:click,edge:click,label:click",function(a){var l,u,c,f,p=a.data;if(((p==null?void 0:p.type)!=="label"||p.type==="label"&&p.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((p==null?void 0:p.type)!=="label"||p.type=="label"&&p.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var h=(u=(l=t.textRef.current)===null||l===void 0?void 0:l.innerText)!==null&&u!==void 0?u:"",g=(f=(c=t.textRef.current)===null||c===void 0?void 0:c.innerHTML)!==null&&f!==void 0?f:"";t.setElementModelLabelInfo({value:h,content:g,isSelected:!1}),r.setElementState(en.DEFAULT)}((p==null?void 0:p.type)!=="label"||p.type=="label"&&p.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,o=this.props,i=o.label,r=o.element,s=o.graphModel,a=this.state,l=a.isDragging,u=a.isHovered,c=a.isSelected,f=a.isEditing,p=s.transformModel,h=p.getTransformStyle().transform,g=i.id,m=i.x,_=i.y,v=i.zIndex,b=i.vertical,C=i.style,M=i.rotate,O=i.content,k=i.labelWidth,E=i.textOverflowMode,S=k??(r.BaseType==="node"?r.width-20:80),N={left:"".concat(m-S/2,"px"),top:"".concat(_-10,"px"),width:"".concat(S,"px"),height:"20px",zIndex:v??1,transform:M?"".concat(h," rotate(").concat(M,"deg)"):"".concat(h," rotate(").concat(b?-.25:0,"turn)")};return Re("div",{id:"element-container-".concat(g),className:Ec("lf-label-editor-container"),style:N,onPointerDown:this.handleMouseDown,onPointerUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:Re("div",{ref:this.textRef,id:"editor-container-".concat(g),className:Ec("lf-label-editor",(t={"lf-label-editor-dragging":l,"lf-label-editor-editing":f,"lf-label-editor-hover":!f&&(u||c)},t["lf-label-editor-".concat(E)]=!f,t)),onInput:this.handleInput,style:ga({maxWidth:"".concat(S,"px"),boxSizing:"border-box",display:"inline-block",background:f||r.BaseType==="edge"?"#fff":"transparent"},C),dangerouslySetInnerHTML:{__html:O}})})},e=RJ([eo],e),e})(Yt),So=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},IJ=er,FJ=(function(){function n(e,t,o){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=o,this.id=(i=e.id)!==null&&i!==void 0?i:IJ(),this.initLabelData(e)}return n.prototype.initLabelData=function(e){an(this,e)},n.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:qo(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},So([Pe],n.prototype,"x",void 0),So([Pe],n.prototype,"y",void 0),So([Pe],n.prototype,"content",void 0),So([Pe],n.prototype,"value",void 0),So([Pe],n.prototype,"rotate",void 0),So([Pe],n.prototype,"style",void 0),So([Pe],n.prototype,"zIndex",void 0),So([Pe],n.prototype,"vertical",void 0),So([Pe],n.prototype,"editable",void 0),So([Pe],n.prototype,"draggable",void 0),So([Pe],n.prototype,"labelWidth",void 0),So([Pe],n.prototype,"textOverflowMode",void 0),n})(),Rl={exports:{}},$d=Rl.exports,Lv;function jJ(){return Lv||(Lv=1,(function(n){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||(function(e){if("Element"in e){var t="classList",o="prototype",i=e.Element[o],r=Object,s=String[o].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[o].indexOf||function(g){for(var m=0,_=this.length;m<_;m++)if(m in this&&this[m]===g)return m;return-1},l=function(g,m){this.name=g,this.code=DOMException[g],this.message=m},u=function(g,m){if(m==="")throw new l("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(m))throw new l("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(g,m)},c=function(g){for(var m=s.call(g.getAttribute("class")||""),_=m?m.split(/\s+/):[],v=0,b=_.length;v<b;v++)this.push(_[v]);this._updateClassName=function(){g.setAttribute("class",this.toString())}},f=c[o]=[],p=function(){return new c(this)};if(l[o]=Error[o],f.item=function(g){return this[g]||null},f.contains=function(g){return g+="",u(this,g)!==-1},f.add=function(){var g=arguments,m=0,_=g.length,v,b=!1;do v=g[m]+"",u(this,v)===-1&&(this.push(v),b=!0);while(++m<_);b&&this._updateClassName()},f.remove=function(){var g=arguments,m=0,_=g.length,v,b=!1,C;do for(v=g[m]+"",C=u(this,v);C!==-1;)this.splice(C,1),b=!0,C=u(this,v);while(++m<_);b&&this._updateClassName()},f.toggle=function(g,m){g+="";var _=this.contains(g),v=_?m!==!0&&"remove":m!==!1&&"add";return v&&this[v](g),m===!0||m===!1?m:!_},f.toString=function(){return this.join(" ")},r.defineProperty){var h={get:p,enumerable:!0,configurable:!0};try{r.defineProperty(i,t,h)}catch(g){g.number===-2146823252&&(h.enumerable=!1,r.defineProperty(i,t,h))}}else r[o].__defineGetter__&&i.__defineGetter__(t,p)}})(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||(function(i){var r=function(E){return Object.prototype.toString.call(E).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},a=function(S,N,L){this.data=S,this.size=S.length,this.type=N,this.encoding=L},l=s.prototype,u=a.prototype,c=i.FileReaderSync,f=function(E){this.code=this[this.name=E]},p="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),h=p.length,g=i.URL||i.webkitURL||i,m=g.createObjectURL,_=g.revokeObjectURL,v=g,b=i.btoa,C=i.atob,M=i.ArrayBuffer,O=i.Uint8Array,k=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(a.fake=u.fake=!0;h--;)f.prototype[p[h]]=h+1;return g.createObjectURL||(v=i.URL=function(E){var S=document.createElementNS("http://www.w3.org/1999/xhtml","a"),N;return S.href=E,"origin"in S||(S.protocol.toLowerCase()==="data:"?S.origin=null:(N=E.match(k),S.origin=N&&N[1])),S}),v.createObjectURL=function(E){var S=E.type,N;if(S===null&&(S="application/octet-stream"),E instanceof a)return N="data:"+S,E.encoding==="base64"?N+";base64,"+E.data:E.encoding==="URI"?N+","+decodeURIComponent(E.data):b?N+";base64,"+b(E.data):N+","+encodeURIComponent(E.data);if(m)return m.call(g,E)},v.revokeObjectURL=function(E){E.substring(0,5)!=="data:"&&_&&_.call(g,E)},l.append=function(E){var S=this.data;if(O&&(E instanceof M||E instanceof O)){for(var N="",L=new O(E),$=0,B=L.length;$<B;$++)N+=String.fromCharCode(L[$]);S.push(N)}else if(r(E)==="Blob"||r(E)==="File")if(c){var A=new c;S.push(A.readAsBinaryString(E))}else throw new f("NOT_READABLE_ERR");else E instanceof a?E.encoding==="base64"&&C?S.push(C(E.data)):E.encoding==="URI"?S.push(decodeURIComponent(E.data)):E.encoding==="raw"&&S.push(E.data):(typeof E!="string"&&(E+=""),S.push(unescape(encodeURIComponent(E))))},l.getBlob=function(E){return arguments.length||(E=null),new a(this.data.join(""),E,"raw")},l.toString=function(){return"[object BlobBuilder]"},u.slice=function(E,S,N){var L=arguments.length;return L<3&&(N=null),new a(this.data.slice(E,L>1?S:this.data.length),N,this.encoding)},u.toString=function(){return"[object Blob]"},u.close=function(){this.size=0,delete this.data},s})(e);e.Blob=function(i,r){var s=r&&r.type||"",a=new t;if(i)for(var l=0,u=i.length;l<u;l++)Uint8Array&&i[l]instanceof Uint8Array?a.append(i[l].buffer):a.append(i[l]);var c=a.getBlob(s);return!c.slice&&c.webkitSlice&&(c.slice=c.webkitSlice),c};var o=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=o(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||$d.content||$d),(function(e,t){var o=typeof process<"u"&&process&&process.versions&&process.versions.electron;o?e.MediumEditor=t:n.exports=t})($d,(function(){function e(t,o){return this.init(t,o)}return e.extensions={},(function(t){function o(l,u){var c,f=Array.prototype.slice.call(arguments,2);u=u||{};for(var p=0;p<f.length;p++){var h=f[p];if(h)for(c in h)h.hasOwnProperty(c)&&typeof h[c]<"u"&&(l||u.hasOwnProperty(c)===!1)&&(u[c]=h[c])}return u}var i=!1;try{var r=document.createElement("div"),s=document.createTextNode(" ");r.appendChild(s),i=r.contains(s)}catch{}var a={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(l){return!!(a.isMac&&l.metaKey||!a.isMac&&l.ctrlKey)},isKey:function(l,u){var c=a.getKeyCode(l);return Array.isArray(u)===!1?c===u:u.indexOf(c)!==-1},getKeyCode:function(l){var u=l.which;return u===null&&(u=l.charCode!==null?l.charCode:l.keyCode),u},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var u=[!0].concat(Array.prototype.slice.call(arguments));return o.apply(this,u)},defaults:function(){var u=[!1].concat(Array.prototype.slice.call(arguments));return o.apply(this,u)},createLink:function(l,u,c,f){var p=l.createElement("a");return a.moveTextRangeIntoElement(u[0],u[u.length-1],p),p.setAttribute("href",c),f&&(f==="_blank"&&p.setAttribute("rel","noopener noreferrer"),p.setAttribute("target",f)),p},findOrCreateMatchingTextNodes:function(l,u,c){for(var f=l.createTreeWalker(u,NodeFilter.SHOW_ALL,null,!1),p=[],h=0,g=!1,m=null,_=null;(m=f.nextNode())!==null;)if(!(m.nodeType>3))if(m.nodeType===3){if(!g&&c.start<h+m.nodeValue.length&&(g=!0,_=a.splitStartNodeIfNeeded(m,c.start,h)),g&&a.splitEndNodeIfNeeded(m,_,c.end,h),g&&h===c.end)break;if(g&&h>c.end+1)throw new Error("PerformLinking overshot the target!");g&&p.push(_||m),h+=m.nodeValue.length,_!==null&&(h+=_.nodeValue.length,f.nextNode()),_=null}else m.tagName.toLowerCase()==="img"&&(!g&&c.start<=h&&(g=!0),g&&p.push(m));return p},splitStartNodeIfNeeded:function(l,u,c){return u!==c?l.splitText(u-c):null},splitEndNodeIfNeeded:function(l,u,c,f){var p,h;p=f+l.nodeValue.length+(u?u.nodeValue.length:0)-1,h=c-f-(u?l.nodeValue.length:0),p>=c&&f!==p&&h!==0&&(u||l).splitText(h)},splitByBlockElements:function(l){if(l.nodeType!==3&&l.nodeType!==1)return[];var u=[],c=e.util.blockContainerElementNames.join(",");if(l.nodeType===3||l.querySelectorAll(c).length===0)return[l];for(var f=0;f<l.childNodes.length;f++){var p=l.childNodes[f];if(p.nodeType===3)u.push(p);else if(p.nodeType===1){var h=p.querySelectorAll(c);h.length===0?u.push(p):u=u.concat(e.util.splitByBlockElements(p))}}return u},findAdjacentTextNodeWithContent:function(u,c,f){var p=!1,h,g=f.createNodeIterator(u,NodeFilter.SHOW_TEXT,null,!1);for(h=g.nextNode();h;){if(h===c)p=!0;else if(p&&h.nodeType===3&&h.nodeValue&&h.nodeValue.trim().length>0)break;h=g.nextNode()}return h},findPreviousSibling:function(l){if(!l||a.isMediumEditorElement(l))return!1;for(var u=l.previousSibling;!u&&!a.isMediumEditorElement(l.parentNode);)l=l.parentNode,u=l.previousSibling;return u},isDescendant:function(u,c,f){if(!u||!c)return!1;if(u===c)return!!f;if(u.nodeType!==1)return!1;if(i||c.nodeType!==3)return u.contains(c);for(var p=c.parentNode;p!==null;){if(p===u)return!0;p=p.parentNode}return!1},isElement:function(u){return!!(u&&u.nodeType===1)},throttle:function(l,u){var c=50,f,p,h,g=null,m=0,_=function(){m=Date.now(),g=null,h=l.apply(f,p),g||(f=p=null)};return!u&&u!==0&&(u=c),function(){var v=Date.now(),b=u-(v-m);return f=this,p=arguments,b<=0||b>u?(g&&(clearTimeout(g),g=null),m=v,h=l.apply(f,p),g||(f=p=null)):g||(g=setTimeout(_,b)),h}},traverseUp:function(l,u){if(!l)return!1;do{if(l.nodeType===1){if(u(l))return l;if(a.isMediumEditorElement(l))return!1}l=l.parentNode}while(l);return!1},htmlEntities:function(l){return String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(l,u){var c,f,p,h,g,m,_,v=!1,b=["insertHTML",!1,u];if(!e.util.isEdge&&l.queryCommandSupported("insertHTML"))try{return l.execCommand.apply(l,b)}catch{}if(c=l.getSelection(),c.rangeCount){if(f=c.getRangeAt(0),_=f.commonAncestorContainer,a.isMediumEditorElement(_)&&!_.firstChild)f.selectNode(_.appendChild(l.createTextNode("")));else if(_.nodeType===3&&f.startOffset===0&&f.endOffset===_.nodeValue.length||_.nodeType!==3&&_.innerHTML===f.toString()){for(;!a.isMediumEditorElement(_)&&_.parentNode&&_.parentNode.childNodes.length===1&&!a.isMediumEditorElement(_.parentNode);)_=_.parentNode;f.selectNode(_)}for(f.deleteContents(),p=l.createElement("div"),p.innerHTML=u,h=l.createDocumentFragment();p.firstChild;)g=p.firstChild,m=h.appendChild(g);f.insertNode(h),m&&(f=f.cloneRange(),f.setStartAfter(m),f.collapse(!0),e.selection.selectRange(l,f)),v=!0}return l.execCommand.callListeners&&l.execCommand.callListeners(b,v),v},execFormatBlock:function(l,u){var c=a.getTopBlockContainer(e.selection.getSelectionStart(l)),f;if(u==="blockquote"){if(c&&(f=Array.prototype.slice.call(c.childNodes),f.some(function(p){return a.isBlockContainer(p)})))return l.execCommand("outdent",!1,null);if(a.isIE)return l.execCommand("indent",!1,u)}if(c&&u===c.nodeName.toLowerCase()&&(u="p"),a.isIE&&(u="<"+u+">"),c&&c.nodeName.toLowerCase()==="blockquote"){if(a.isIE&&u==="<p>")return l.execCommand("outdent",!1,u);if((a.isFF||a.isEdge)&&u==="p")return f=Array.prototype.slice.call(c.childNodes),f.some(function(p){return!a.isBlockContainer(p)})&&l.execCommand("formatBlock",!1,u),l.execCommand("outdent",!1,u)}return l.execCommand("formatBlock",!1,u)},setTargetBlank:function(l,u){var c,f=u||!1;if(l.nodeName.toLowerCase()==="a")l.target="_blank",l.rel="noopener noreferrer";else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)(f===!1||f===l[c].attributes.href.value)&&(l[c].target="_blank",l[c].rel="noopener noreferrer")},removeTargetBlank:function(l,u){var c;if(l.nodeName.toLowerCase()==="a")l.removeAttribute("target"),l.removeAttribute("rel");else for(l=l.getElementsByTagName("a"),c=0;c<l.length;c+=1)u===l[c].attributes.href.value&&(l[c].removeAttribute("target"),l[c].removeAttribute("rel"))},addClassToAnchors:function(l,u){var c=u.split(" "),f,p;if(l.nodeName.toLowerCase()==="a")for(p=0;p<c.length;p+=1)l.classList.add(c[p]);else{var h=l.getElementsByTagName("a");if(h.length===0){var g=a.getClosestTag(l,"a");l=g?[g]:[]}else l=h;for(f=0;f<l.length;f+=1)for(p=0;p<c.length;p+=1)l[f].classList.add(c[p])}},isListItem:function(l){if(!l)return!1;if(l.nodeName.toLowerCase()==="li")return!0;for(var u=l.parentNode,c=u.nodeName.toLowerCase();c==="li"||!a.isBlockContainer(u)&&c!=="div";){if(c==="li")return!0;if(u=u.parentNode,u)c=u.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(l,u){if(u.nodeName.toLowerCase()==="li"){var c=u.parentElement;c.parentElement.nodeName.toLowerCase()==="p"&&(a.unwrap(c.parentElement,l),e.selection.moveCursor(l,u.firstChild,u.firstChild.textContent.length))}},splitOffDOMTree:function(l,u,c){for(var f=u,p=null,h=!c;f!==l;){var g=f.parentNode,m=g.cloneNode(!1),_=h?f:g.firstChild,v;for(p&&(h?m.appendChild(p):v=p),p=m;_;){var b=_.nextSibling;_===f?(_.hasChildNodes()?_=_.cloneNode(!1):_.parentNode.removeChild(_),_.textContent&&p.appendChild(_),_=h?b:null):(_.parentNode.removeChild(_),(_.hasChildNodes()||_.textContent)&&p.appendChild(_),_=b)}v&&p.appendChild(v),f=g}return p},moveTextRangeIntoElement:function(l,u,c){if(!l||!u)return!1;var f=a.findCommonRoot(l,u);if(!f)return!1;if(u===l){var p=l.parentNode,h=l.nextSibling;return p.removeChild(l),c.appendChild(l),h?p.insertBefore(c,h):p.appendChild(c),c.hasChildNodes()}for(var g=[],m,_,v,b=0;b<f.childNodes.length;b++)if(v=f.childNodes[b],!m)a.isDescendant(v,l,!0)&&(m=v);else if(a.isDescendant(v,u,!0)){_=v;break}else g.push(v);var C=_.nextSibling,M=f.ownerDocument.createDocumentFragment();return m===l?(m.parentNode.removeChild(m),M.appendChild(m)):M.appendChild(a.splitOffDOMTree(m,l)),g.forEach(function(O){O.parentNode.removeChild(O),M.appendChild(O)}),_===u?(_.parentNode.removeChild(_),M.appendChild(_)):M.appendChild(a.splitOffDOMTree(_,u,!0)),c.appendChild(M),_.parentNode===f?f.insertBefore(c,_):C?f.insertBefore(c,C):f.appendChild(c),c.hasChildNodes()},depthOfNode:function(l){for(var u=0,c=l;c.parentNode!==null;)c=c.parentNode,u++;return u},findCommonRoot:function(l,u){for(var c=a.depthOfNode(l),f=a.depthOfNode(u),p=l,h=u;c!==f;)c>f?(p=p.parentNode,c-=1):(h=h.parentNode,f-=1);for(;p!==h;)p=p.parentNode,h=h.parentNode;return p},isElementAtBeginningOfBlock:function(l){for(var u,c;!a.isBlockContainer(l)&&!a.isMediumEditorElement(l);){for(c=l;c=c.previousSibling;)if(u=c.nodeType===3?c.nodeValue:c.textContent,u.length>0)return!1;l=l.parentNode}return!0},isMediumEditorElement:function(l){return l&&l.getAttribute&&!!l.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(l){return a.traverseUp(l,function(u){return a.isMediumEditorElement(u)})},isBlockContainer:function(l){return l&&l.nodeType!==3&&a.blockContainerElementNames.indexOf(l.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(l){return a.traverseUp(l,function(u){return a.isBlockContainer(u)||a.isMediumEditorElement(u)})},getTopBlockContainer:function(l){var u=a.isBlockContainer(l)?l:!1;return a.traverseUp(l,function(c){return a.isBlockContainer(c)&&(u=c),!u&&a.isMediumEditorElement(c)?(u=c,!0):!1}),u},getFirstSelectableLeafNode:function(l){for(;l&&l.firstChild;)l=l.firstChild;if(l=a.traverseUp(l,function(c){return a.emptyElementNames.indexOf(c.nodeName.toLowerCase())===-1}),l.nodeName.toLowerCase()==="table"){var u=l.querySelector("th, td");u&&(l=u)}return l},getFirstTextNode:function(l){return a.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),a._getFirstTextNode(l)},_getFirstTextNode:function(l){if(l.nodeType===3)return l;for(var u=0;u<l.childNodes.length;u++){var c=a._getFirstTextNode(l.childNodes[u]);if(c!==null)return c}return null},ensureUrlHasProtocol:function(l){return l.indexOf("://")===-1?"http://"+l:l},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(l,u,c){var f=l+" is deprecated, please use "+u+" instead.";c&&(f+=" Will be removed in "+c),a.warn(f)},deprecatedMethod:function(l,u,c,f){a.deprecated(l,u,f),typeof this[u]=="function"&&this[u].apply(this,c)},cleanupAttrs:function(l,u){u.forEach(function(c){l.removeAttribute(c)})},cleanupTags:function(l,u){u.indexOf(l.nodeName.toLowerCase())!==-1&&l.parentNode.removeChild(l)},unwrapTags:function(l,u){u.indexOf(l.nodeName.toLowerCase())!==-1&&e.util.unwrap(l,document)},getClosestTag:function(l,u){return a.traverseUp(l,function(c){return c.nodeName.toLowerCase()===u.toLowerCase()})},unwrap:function(l,u){for(var c=u.createDocumentFragment(),f=Array.prototype.slice.call(l.childNodes),p=0;p<f.length;p++)c.appendChild(f[p]);c.childNodes.length?l.parentNode.replaceChild(c,l):l.parentNode.removeChild(l)},guid:function(){function l(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()}};e.util=a})(window),(function(){var t=function(o){e.util.extend(this,o)};t.extend=function(o){var i=this,r;o&&o.hasOwnProperty("constructor")?r=o.constructor:r=function(){return i.apply(this,arguments)},e.util.extend(r,i);var s=function(){this.constructor=r};return s.prototype=i.prototype,r.prototype=new s,o&&e.util.extend(r.prototype,o),r},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(o){return this.base.options[o]}},["execAction","on","off","subscribe","trigger"].forEach(function(o){t.prototype[o]=function(){return this.base[o].apply(this.base,arguments)}}),e.Extension=t})(),(function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var o={findMatchingSelectionParent:function(i,r){var s=r.getSelection(),a,l;return s.rangeCount===0?!1:(a=s.getRangeAt(0),l=a.commonAncestorContainer,e.util.traverseUp(l,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(r){return e.util.isMediumEditorElement(r)},i)},exportSelection:function(i,r){if(!i)return null;var s=null,a=r.getSelection();if(a.rangeCount>0){var l=a.getRangeAt(0),u=l.cloneRange(),c;u.selectNodeContents(i),u.setEnd(l.startContainer,l.startOffset),c=u.toString().length,s={start:c,end:c+l.toString().length},this.doesRangeStartWithImages(l,r)&&(s.startsWithImage=!0);var f=this.getTrailingImageCount(i,s,l.endContainer,l.endOffset);if(f&&(s.trailingImageCount=f),c!==0){var p=this.getIndexRelativeToAdjacentEmptyBlocks(r,i,l.startContainer,l.startOffset);p!==-1&&(s.emptyBlocksIndex=p)}}return s},importSelection:function(i,r,s,a){if(!(!i||!r)){var l=s.createRange();l.setStart(r,0),l.collapse(!0);var u=r,c=[],f=0,p=!1,h=!1,g=0,m=!1,_,v=!1,b=null;for((a||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(v=!0);!m&&u;){if(u.nodeType>3){u=c.pop();continue}if(u.nodeType===3&&!h)_=f+u.length,!p&&i.start>=f&&i.start<=_&&(v||i.start<_?(l.setStart(u,i.start-f),p=!0):b=u),p&&i.end>=f&&i.end<=_&&(i.trailingImageCount?h=!0:(l.setEnd(u,i.end-f),m=!0)),f=_;else{if(i.trailingImageCount&&h&&(u.nodeName.toLowerCase()==="img"&&g++,g===i.trailingImageCount)){for(var C=0;u.parentNode.childNodes[C]!==u;)C++;l.setEnd(u.parentNode,C+1),m=!0}if(!m&&u.nodeType===1)for(var M=u.childNodes.length-1;M>=0;)c.push(u.childNodes[M]),M-=1}m||(u=c.pop())}!p&&b&&(l.setStart(b,b.length),l.setEnd(b,b.length)),typeof i.emptyBlocksIndex<"u"&&(l=this.importSelectionMoveCursorPastBlocks(s,r,i.emptyBlocksIndex,l)),a&&(l=this.importSelectionMoveCursorPastAnchor(i,l)),this.selectRange(s,l)}},importSelectionMoveCursorPastAnchor:function(i,r){var s=function(f){return f.nodeName.toLowerCase()==="a"};if(i.start===i.end&&r.startContainer.nodeType===3&&r.startOffset===r.startContainer.nodeValue.length&&e.util.traverseUp(r.startContainer,s)){for(var a=r.startContainer,l=r.startContainer.parentNode;l!==null&&l.nodeName.toLowerCase()!=="a";)l.childNodes[l.childNodes.length-1]!==a?l=null:(a=l,l=l.parentNode);if(l!==null&&l.nodeName.toLowerCase()==="a"){for(var u=null,c=0;u===null&&c<l.parentNode.childNodes.length;c++)l.parentNode.childNodes[c]===l&&(u=c);r.setStart(l.parentNode,u+1),r.collapse(!0)}}return r},importSelectionMoveCursorPastBlocks:function(i,r,s,a){var l=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),u=a.startContainer,c,f,p=0;for(s=s||1,u.nodeType===3&&e.util.isBlockContainer(u.previousSibling)?c=u.previousSibling:c=e.util.getClosestBlockContainer(u);l.nextNode();)if(!f)c===l.currentNode&&(f=l.currentNode);else if(f=l.currentNode,p++,p===s||f.textContent.length>0)break;return f||(f=c),a.setStart(e.util.getFirstSelectableLeafNode(f),0),a},getIndexRelativeToAdjacentEmptyBlocks:function(i,r,s,a){if(s.textContent.length>0&&a>0)return-1;var l=s;if(l.nodeType!==3&&(l=s.childNodes[a]),l){if(!e.util.isElementAtBeginningOfBlock(l))return-1;var u=e.util.findPreviousSibling(l);if(u){if(u.nodeValue)return-1}else return-1}for(var c=e.util.getClosestBlockContainer(s),f=i.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),p=0;f.nextNode();){var h=f.currentNode.textContent==="";if((h||p>0)&&(p+=1),f.currentNode===c)return p;h||(p=0)}return p},doesRangeStartWithImages:function(i,r){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var s=i.startContainer.querySelector("img");if(!s)return!1;for(var a=r.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);a.nextNode();){var l=a.currentNode;if(l===s)break;if(l.nodeValue)return!1}return!0},getTrailingImageCount:function(i,r,s,a){if(a===0||s.nodeType!==1||s.nodeName.toLowerCase()!=="img"&&!s.querySelector("img"))return 0;for(var l=s.childNodes[a-1];l.hasChildNodes();)l=l.lastChild;for(var u=i,c=[],f=0,p=!1,h=!1,g=!1,m,_=0;!g&&u;){if(u.nodeType>3){u=c.pop();continue}if(u.nodeType===3&&!h)_=0,m=f+u.length,!p&&r.start>=f&&r.start<=m&&(p=!0),p&&r.end>=f&&r.end<=m&&(h=!0),f=m;else if(u.nodeName.toLowerCase()==="img"&&_++,u===l)g=!0;else if(u.nodeType===1)for(var v=u.childNodes.length-1;v>=0;)c.push(u.childNodes[v]),v-=1;g||(u=c.pop())}return _},selectionContainsContent:function(i){var r=i.getSelection();if(!r||r.isCollapsed||!r.rangeCount)return!1;if(r.toString().trim()!=="")return!0;var s=this.getSelectedParentElement(r.getRangeAt(0));return!!(s&&(s.nodeName.toLowerCase()==="img"||s.nodeType===1&&s.querySelector("img")))},selectionInContentEditableFalse:function(i){var r,s=this.findMatchingSelectionParent(function(a){var l=a&&a.getAttribute("contenteditable");return l==="true"&&(r=!0),a.nodeName!=="#text"&&l==="false"},i);return!r&&s},getSelectionHtml:function(r){var s,a="",l=r.getSelection(),u,c;if(l.rangeCount){for(c=r.createElement("div"),s=0,u=l.rangeCount;s<u;s+=1)c.appendChild(l.getRangeAt(s).cloneContents());a=c.innerHTML}return a},getCaretOffsets:function(r,s){var a,l;return s||(s=window.getSelection().getRangeAt(0)),a=s.cloneRange(),l=s.cloneRange(),a.selectNodeContents(r),a.setEnd(s.endContainer,s.endOffset),l.selectNodeContents(r),l.setStart(s.endContainer,s.endOffset),{left:a.toString().length,right:l.toString().length}},rangeSelectsSingleNode:function(i){var r=i.startContainer;return r===i.endContainer&&r.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var r=i.getSelection(),s,a,l;if(!r.rangeCount||r.isCollapsed||!r.getRangeAt(0).commonAncestorContainer)return[];if(s=r.getRangeAt(0),s.commonAncestorContainer.nodeType===3){for(a=[],l=s.commonAncestorContainer;l.parentNode&&l.parentNode.childNodes.length===1;)a.push(l.parentNode),l=l.parentNode;return a}return[].filter.call(s.commonAncestorContainer.getElementsByTagName("*"),function(u){return typeof r.containsNode=="function"?r.containsNode(u,!0):!0})},selectNode:function(i,r){var s=r.createRange();s.selectNodeContents(i),this.selectRange(r,s)},select:function(i,r,s,a,l){var u=i.createRange();return u.setStart(r,s),a?u.setEnd(a,l):u.collapse(!0),this.selectRange(i,u),u},clearSelection:function(i,r){r?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,r,s){this.select(i,r,s)},getSelectionRange:function(i){var r=i.getSelection();return r.rangeCount===0?null:r.getRangeAt(0)},selectRange:function(i,r){var s=i.getSelection();s.removeAllRanges(),s.addRange(r)},getSelectionStart:function(i){var r=i.getSelection().anchorNode,s=r&&r.nodeType===3?r.parentNode:r;return s}};e.selection=o})(),(function(){function t(i,r){return i?i.some(function(s){if(typeof s.getInteractionElements!="function")return!1;var a=s.getInteractionElements();return a?(Array.isArray(a)||(a=[a]),a.some(function(l){return e.util.isDescendant(l,r,!0)})):!1}):!1}var o=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};o.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,r,s,a){var l=this.base.options.contentWindow,u=this.base.options.ownerDocument;i=e.util.isElement(i)||[l,u].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(c){c.addEventListener(r,s,a),this.events.push([c,r,s,a])}).bind(this))},detachDOMEvent:function(i,r,s,a){var l,u,c=this.base.options.contentWindow,f=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[c,f].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(p){l=this.indexOfListener(p,r,s,a),l!==-1&&(u=this.events.splice(l,1)[0],u[0].removeEventListener(u[1],u[2],u[3]))}).bind(this)))},indexOfListener:function(i,r,s,a){var l,u,c;for(l=0,u=this.events.length;l<u;l=l+1)if(c=this.events[l],c[0]===i&&c[1]===r&&c[2]===s&&c[3]===a)return l;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var r=this.events.filter(function(u){return u&&u[0].getAttribute&&u[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),s=0,a=r.length;s<a;s++){var l=r[s];this.detachDOMEvent(l[0],l[1],l[2],l[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(r){this.attachDOMEvent(i,r.name,r.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,r){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(r)},detachCustomEvent:function(i,r){var s=this.indexOfCustomListener(i,r);s!==-1&&this.customEvents[i].splice(s,1)},indexOfCustomListener:function(i,r){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(r)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,r,s){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(a){a(r,s)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var r=i.execCommand.listeners.indexOf(this.execCommandListener);r!==-1&&i.execCommand.listeners.splice(r,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var r=function(a,l){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(u){u({command:a[0],value:a[2],args:a,result:l})})},s=function(){var a=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return a;var l=Array.prototype.slice.call(arguments);return r(l,a),a};s.orig=i.execCommand,s.listeners=[],s.callListeners=r,i.execCommand=s}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(r){this.contentCache[r.getAttribute("medium-editor-index")]=r.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,r){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(s){this.attachDOMEvent(s,i,r.bind(this))},this),this.eventsCache.push({name:i,handler:r})},cleanupElement:function(i){var r=i.getAttribute("medium-editor-index");r&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[r])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,r){var s=this.base.getFocusedElement(),a;s&&r.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(s,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(a=s),a||this.base.elements.some(function(u){return!a&&e.util.isDescendant(u,i,!0)&&(a=u),!!a},this);var l=!e.util.isDescendant(s,i,!0)&&!t(this.base.extensions,i);a!==s&&(s&&l&&(s.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",r,s)),a&&(a.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",r,a))),l&&this.triggerCustomEvent("externalInteraction",r)},updateInput:function(i,r){if(this.contentCache){var s=i.getAttribute("medium-editor-index"),a=i.innerHTML;a!==this.contentCache[s]&&this.triggerCustomEvent("editableInput",r,i),this.contentCache[s]=a}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var r=i.currentTarget.activeElement,s;this.base.elements.some(function(a){return e.util.isDescendant(a,r,!0)?(s=a,!0):!1},this),s&&this.updateInput(s,{target:r,currentTarget:s})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var r={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(r.currentTarget,r)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=o})(),(function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(o){t.isBuiltInButton(o)?e.Extension.call(this,this.defaults[o]):e.Extension.call(this,o)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var o=this.document.createElement("button"),i=this.contentDefault,r=this.getAria(),s=this.getEditorOption("buttonLabels");return o.classList.add("medium-editor-action"),o.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(a){o.classList.add(a)}),o.setAttribute("data-action",this.getAction()),r&&(o.setAttribute("title",r),o.setAttribute("aria-label",r)),this.attrs&&Object.keys(this.attrs).forEach(function(a){o.setAttribute(a,this.attrs[a])},this),s==="fontawesome"&&this.contentFA&&(i=this.contentFA),o.innerHTML=i,o},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var o=null;return this.useQueryState&&(o=this.base.queryCommandState(this.getAction())),o},isAlreadyApplied:function(o){var i=!1,r=this.getTagNames(),s,a;return this.knownState===!1||this.knownState===!0?this.knownState:(r&&r.length>0&&(i=r.indexOf(o.nodeName.toLowerCase())!==-1),!i&&this.style&&(s=this.style.value.split("|"),a=this.window.getComputedStyle(o,null).getPropertyValue(this.style.prop),s.forEach(function(l){this.knownState||(i=a.indexOf(l)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(o){return typeof o=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(o)},e.extensions.button=t})(),(function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}})(),(function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var o=this.base.getExtensionByName("toolbar");o&&o.hideToolbarDefaultActions()},setToolbarPosition:function(){var o=this.base.getExtensionByName("toolbar");o&&o.setToolbarPosition()}});e.extensions.form=t})(),(function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(o){o.preventDefault(),o.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(o){e.util.isKey(o,e.util.keyCode.K)&&e.util.isMetaCtrlKey(o)&&!o.shiftKey&&this.handleClick(o)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var o=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return o.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),o.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&o.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),o.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(o){var i=this.getInput(),r=this.getAnchorTargetCheckbox(),s=this.getAnchorButtonCheckbox();if(o=o||{value:""},typeof o=="string"&&(o={value:o}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=o.value,i.focus(),r&&(r.checked=o.target==="_blank"),s){var a=o.buttonClass?o.buttonClass.split(" "):[];s.checked=a.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var o=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),r={value:this.getInput().value.trim()};return this.linkValidation&&(r.value=this.checkLinkFormat(r.value)),r.target="_self",o&&o.checked&&(r.target="_blank"),i&&i.checked&&(r.buttonClass=this.customClassOption),r},doFormSave:function(){var o=this.getFormOpts();this.completeFormSave(o)},completeFormSave:function(o){this.base.restoreSelection(),this.execAction(this.action,o),this.base.checkSelection()},ensureEncodedUri:function(o){return o===decodeURI(o)?encodeURI(o):o},ensureEncodedUriComponent:function(o){return o===decodeURIComponent(o)?encodeURIComponent(o):o},ensureEncodedParam:function(o){var i=o.split("="),r=i[0],s=i[1];return r+(s===void 0?"":"="+this.ensureEncodedUriComponent(s))},ensureEncodedQuery:function(o){return o.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(o){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,r=i.test(o),s="",a=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,l=o.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),u=l[1],c=l[2],f=l[3];if(a.test(o))return"tel:"+o;if(!r){var p=u.split("/")[0];(p.match(/.+(\.|:).+/)||p==="localhost")&&(s="http://")}return s+this.ensureEncodedUri(u)+(c===void 0?"":"?"+this.ensureEncodedQuery(c))+(f===void 0?"":"#"+f)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(o){var i=o.querySelector(".medium-editor-toolbar-close"),r=o.querySelector(".medium-editor-toolbar-save"),s=o.querySelector(".medium-editor-toolbar-input");this.on(o,"click",this.handleFormClick.bind(this)),this.on(s,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(r,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var o=this.document,i=o.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(o){if(o.keyCode===e.util.keyCode.ENTER){o.preventDefault(),this.doFormSave();return}o.keyCode===e.util.keyCode.ESCAPE&&(o.preventDefault(),this.doFormCancel())},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t})(),(function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var o=this.document.createElement("div");return o.id="medium-editor-anchor-preview-"+this.getEditorId(),o.className="medium-editor-anchor-preview",o.innerHTML=this.getTemplate(),this.on(o,"click",this.handleClick.bind(this)),o},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(o){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||o.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=o.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=o.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=o,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(o){o=o||this.activeAnchor;var i=this.window.innerWidth,r=this.anchorPreview.offsetHeight,s=o.getBoundingClientRect(),a=this.diffLeft,l=this.diffTop,u=this.getEditorOption("elementsContainer"),c=["absolute","fixed"].indexOf(window.getComputedStyle(u).getPropertyValue("position"))>-1,f={},p,h,g,m,_;p=this.anchorPreview.offsetWidth/2;var v=this.base.getExtensionByName("toolbar");v&&(a=v.diffLeft,l=v.diffTop),h=a-p,c?(m=u.getBoundingClientRect(),["top","left"].forEach(function(b){f[b]=s[b]-m[b]}),f.width=s.width,f.height=s.height,s=f,i=m.width,_=u.scrollTop):_=this.window.pageYOffset,g=s.left+s.width/2,_+=r+s.top+s.height-l-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(_)+"px",this.anchorPreview.style.right="initial",g<p?(this.anchorPreview.style.left=h+p+"px",this.anchorPreview.style.right="initial"):i-g<p?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=h+g+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(o){var i=this.base.getExtensionByName("anchor"),r=this.activeAnchor;i&&r&&(o.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(r){var s={value:r.attributes.href.value,target:r.getAttribute("target"),buttonClass:r.getAttribute("class")};i.showForm(s),r=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(o){var i=e.util.getClosestTag(o.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(o){(!o.relatedTarget||!/anchor-preview/.test(o.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var o=new Date().getTime()-this.lastOver;o>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t})(),(function(){var t,o,i,r,s;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],o="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+o+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+o+"))",r=new RegExp("^("+o+")$","i"),s=new RegExp(i,"gi");function a(u){return!e.util.getClosestTag(u,"a")}var l=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var u=0,c=0;c<this.window._mediumEditors.length;c++){var f=this.window._mediumEditors[c];f!==null&&f.getExtensionByName("autoLink")!==void 0&&u++}return u===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(u,c){this.performLinking(c)},onKeypress:function(u){this.disableEventHandling||e.util.isKey(u,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var c=this.base.exportSelection();this.performLinking(u.target)&&this.base.importSelection(c,!0)}catch(f){window.console&&window.console.error("Failed to perform linking",f),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(u){var c=e.util.splitByBlockElements(u),f=!1;c.length===0&&(c=[u]);for(var p=0;p<c.length;p++)f=this.removeObsoleteAutoLinkSpans(c[p])||f,f=this.performLinkingWithinElement(c[p])||f;return this.base.events.updateInput(u,{target:u,currentTarget:u}),f},removeObsoleteAutoLinkSpans:function(u){if(!u||u.nodeType===3)return!1;for(var c=u.querySelectorAll('span[data-auto-link="true"]'),f=!1,p=0;p<c.length;p++){var h=c[p].textContent;if(h.indexOf("://")===-1&&(h=e.util.ensureUrlHasProtocol(h)),c[p].getAttribute("data-href")!==h&&a(c[p])){f=!0;var g=h.replace(/\s+$/,"");if(c[p].getAttribute("data-href")===g){var m=h.length-g.length,_=e.util.splitOffDOMTree(c[p],this.splitTextBeforeEnd(c[p],m));c[p].parentNode.insertBefore(_,c[p].nextSibling)}else e.util.unwrap(c[p],this.document)}}return f},splitTextBeforeEnd:function(u,c){for(var f=this.document.createTreeWalker(u,NodeFilter.SHOW_TEXT,null,!1),p=!0;p;)p=f.lastChild()!==null;for(var h,g,m;c>0&&m!==null;)h=f.currentNode,g=h.nodeValue,g.length>c?(m=h.splitText(g.length-c),c=0):(m=f.previousNode(),c-=g.length);return m},performLinkingWithinElement:function(u){for(var c=this.findLinkableText(u),f=!1,p=0;p<c.length;p++){var h=e.util.findOrCreateMatchingTextNodes(this.document,u,c[p]);this.shouldNotLink(h)||this.createAutoLink(h,c[p].href)}return f},shouldNotLink:function(u){for(var c=!1,f=0;f<u.length&&c===!1;f++)c=!!e.util.traverseUp(u[f],function(p){return p.nodeName.toLowerCase()==="a"||p.getAttribute&&p.getAttribute("data-auto-link")==="true"});return c},findLinkableText:function(u){for(var c=u.textContent,f=null,p=[];(f=s.exec(c))!==null;){var h=!0,g=f.index+f[0].length;h=(f.index===0||t.indexOf(c[f.index-1])!==-1)&&(g===c.length||t.indexOf(c[g])!==-1),h=h&&(f[0].indexOf("/")!==-1||r.test(f[0].split(".").pop().split("?").shift())),h&&p.push({href:f[0],start:f.index,end:g})}return p},createAutoLink:function(u,c){c=e.util.ensureUrlHasProtocol(c);var f=e.util.createLink(this.document,u,c,this.getEditorOption("targetBlank")?"_blank":null),p=this.document.createElement("span");for(p.setAttribute("data-auto-link","true"),p.setAttribute("data-href",c),f.insertBefore(p,f.firstChild);f.childNodes.length>1;)p.appendChild(f.childNodes[1])}});e.extensions.autoLink=l})(),(function(){var t="medium-editor-dragover";function o(r){var s=e.util.getContainerEditorElement(r),a=Array.prototype.slice.call(s.parentElement.querySelectorAll("."+t));a.forEach(function(l){l.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(r){r.preventDefault(),r.dataTransfer.dropEffect="copy";var s=r.target.classList?r.target:r.target.parentElement;o(s),r.type==="dragover"&&s.classList.add(t)},handleDrop:function(r){r.preventDefault(),r.stopPropagation(),this.base.selectElement(r.target);var s=this.base.exportSelection();s.start=s.end,this.base.importSelection(s),r.dataTransfer.files&&Array.prototype.slice.call(r.dataTransfer.files).forEach(function(a){this.isAllowedFile(a)&&a.type.match("image")&&this.insertImageFile(a)},this),o(r.target)},isAllowedFile:function(r){return this.allowedTypes.some(function(s){return!!r.type.match(s)})},insertImageFile:function(r){if(typeof FileReader=="function"){var s=new FileReader;s.readAsDataURL(r),s.addEventListener("load",(function(a){var l=this.document.createElement("img");l.src=a.target.result,e.util.insertHTMLCommand(this.document,l.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i})(),(function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(o){var i=o.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(o)},this)},handleKeydown:function(o){var i=e.util.getKeyCode(o);if(this.keys[i]){var r=e.util.isMetaCtrlKey(o),s=!!o.shiftKey,a=!!o.altKey;this.keys[i].forEach(function(l){l.meta===r&&l.shift===s&&(l.alt===a||l.alt===void 0)&&(o.preventDefault(),o.stopPropagation(),typeof l.command=="function"?l.command.apply(this):l.command!==!1&&this.execAction(l.command))},this)}}});e.extensions.keyboardCommands=t})(),(function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(o){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("select"),s=o.createElement("a"),a=o.createElement("a"),l;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var u=0;u<this.fonts.length;u++)l=o.createElement("option"),l.innerHTML=this.fonts[u],l.value=this.fonts[u],r.appendChild(l);return r.className="medium-editor-toolbar-select",i.appendChild(r),this.on(r,"change",this.handleFontChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("face")&&o.removeAttribute("face")})},handleFontChange:function(){var o=this.getSelect().value;o===""?this.clearFontName():this.execAction("fontName",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t})(),(function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(o){if(o.preventDefault(),o.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(o){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=o||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var o=this.document,i=o.createElement("div"),r=o.createElement("input"),s=o.createElement("a"),a=o.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),r.setAttribute("type","range"),r.setAttribute("min","1"),r.setAttribute("max","7"),r.className="medium-editor-toolbar-input",i.appendChild(r),this.on(r,"change",this.handleSliderChange.bind(this)),a.setAttribute("href","#"),a.className="medium-editor-toobar-save",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(a),this.on(a,"click",this.handleSaveClick.bind(this),!0),s.setAttribute("href","#"),s.className="medium-editor-toobar-close",s.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(s),this.on(s,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(o){o.nodeName.toLowerCase()==="font"&&o.hasAttribute("size")&&o.removeAttribute("size")})},handleSliderChange:function(){var o=this.getInput().value;o==="4"?this.clearFontSize():this.execAction("fontSize",{value:o})},handleFormClick:function(o){o.stopPropagation()},handleSaveClick:function(o){o.preventDefault(),this.doFormSave()},handleCloseClick:function(o){o.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t})(),(function(){var t="%ME_PASTEBIN%",o=null,i=null,r=function(u){u.stopPropagation()};function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function a(u,c,f){var p=u.clipboardData||c.clipboardData||f.dataTransfer,h={};if(!p)return h;if(p.getData){var g=p.getData("Text");g&&g.length>0&&(h["text/plain"]=g)}if(p.types)for(var m=0;m<p.types.length;m++){var _=p.types[m];h[_]=p.getData(_)}return h}var l=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(u){this.on(u,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(u,c){this.on(c,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(u,c){if(!u.defaultPrevented){var f=a(u,this.window,this.document),p=f["text/html"],h=f["text/plain"];this.window.clipboardData&&u.clipboardData===void 0&&!p&&(p=h),(p||h)&&(u.preventDefault(),this.doPaste(p,h,c))}},doPaste:function(u,c,f){var p,h="",g;if(this.cleanPastedHTML&&u)return this.cleanPaste(u);if(c){if(this.getEditorOption("disableReturn")||f&&f.getAttribute("data-disable-return"))h=e.util.htmlEntities(c);else if(p=c.split(/[\r\n]+/g),p.length>1)for(g=0;g<p.length;g+=1)p[g]!==""&&(h+="<p>"+e.util.htmlEntities(p[g])+"</p>");else h=e.util.htmlEntities(p[0]);e.util.insertHTMLCommand(this.document,h)}},handlePasteBinPaste:function(u){if(u.defaultPrevented){this.removePasteBin();return}var c=a(u,this.window,this.document),f=c["text/html"],p=c["text/plain"],h=i;if(!this.cleanPastedHTML||f){u.preventDefault(),this.removePasteBin(),this.doPaste(f,p,h),this.trigger("editablePaste",{currentTarget:h,target:h},h);return}setTimeout((function(){this.cleanPastedHTML&&(f=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(f,p,h),this.trigger("editablePaste",{currentTarget:h,target:h},h)}).bind(this),0)},handleKeydown:function(u,c){e.util.isKey(u,e.util.keyCode.V)&&e.util.isMetaCtrlKey(u)&&(u.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(c))},createPasteBin:function(u){var c,f=e.selection.getSelectionRange(this.document),p=this.window.pageYOffset;i=u,f&&(c=f.getClientRects(),c.length?p+=c[0].top:f.startContainer.getBoundingClientRect!==void 0?p+=f.startContainer.getBoundingClientRect().top:p+=f.getBoundingClientRect().top),o=f;var h=this.document.createElement("div");h.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),h.setAttribute("style","border: 1px red solid; position: absolute; top: "+p+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),h.setAttribute("contentEditable",!0),h.innerHTML=t,this.document.body.appendChild(h),this.on(h,"focus",r),this.on(h,"focusin",r),this.on(h,"focusout",r),h.focus(),e.selection.selectNode(h,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(h,"paste",this.boundHandlePaste)},removePasteBin:function(){o!==null&&(e.selection.selectRange(this.document,o),o=null),i!==null&&(i=null);var u=this.getPasteBin();u&&u&&(this.off(u,"focus",r),this.off(u,"focusin",r),this.off(u,"focusout",r),this.off(u,"paste",this.boundHandlePaste),u.parentElement.removeChild(u))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var u=this.getPasteBin();if(!u||u.firstChild&&u.firstChild.id==="mcepastebin")return!1;var c=u.innerHTML;return!c||c===t?!1:c},cleanPaste:function(u){var c,f,p,h,g=/<p|<br|<div/.test(u),m=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(c=0;c<m.length;c+=1)u=u.replace(m[c][0],m[c][1]);if(!g)return this.pasteHTML(u);for(p=this.document.createElement("div"),p.innerHTML="<p>"+u.split("<br><br>").join("</p><p>")+"</p>",f=p.querySelectorAll("a,p,div,br"),c=0;c<f.length;c+=1)switch(h=f[c],h.innerHTML=h.innerHTML.replace(/\n/gi," "),h.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(h);break;case"br":this.filterLineBreak(h);break}this.pasteHTML(p.innerHTML)},pasteHTML:function(u,c){c=e.util.defaults({},c,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var f,p,h,g,m=this.document.createDocumentFragment();for(m.appendChild(this.document.createElement("body")),g=m.querySelector("body"),g.innerHTML=u,this.cleanupSpans(g),f=g.querySelectorAll("*"),h=0;h<f.length;h+=1)p=f[h],p.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(p),e.util.cleanupAttrs(p,c.cleanAttrs),e.util.cleanupTags(p,c.cleanTags),e.util.unwrapTags(p,c.unwrapTags);e.util.insertHTMLCommand(this.document,g.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(u){return u&&(u.nodeName.toLowerCase()==="p"||u.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(u){/^\s*$/.test(u.textContent)&&u.parentNode&&u.parentNode.removeChild(u)},filterLineBreak:function(u){this.isCommonBlock(u.previousElementSibling)?this.removeWithParent(u):this.isCommonBlock(u.parentNode)&&(u.parentNode.firstChild===u||u.parentNode.lastChild===u)?this.removeWithParent(u):u.parentNode&&u.parentNode.childElementCount===1&&u.parentNode.textContent===""&&this.removeWithParent(u)},removeWithParent:function(u){u&&u.parentNode&&(u.parentNode.parentNode&&u.parentNode.childElementCount===1?u.parentNode.parentNode.removeChild(u.parentNode):u.parentNode.removeChild(u))},cleanupSpans:function(u){var c,f,p,h=u.querySelectorAll(".replace-with"),g=function(m){return m&&m.nodeName!=="#text"&&m.getAttribute("contenteditable")==="false"};for(c=0;c<h.length;c+=1)f=h[c],p=this.document.createElement(f.classList.contains("bold")?"b":"i"),f.classList.contains("bold")&&f.classList.contains("italic")?p.innerHTML="<i>"+f.innerHTML+"</i>":p.innerHTML=f.innerHTML,f.parentNode.replaceChild(p,f);for(h=u.querySelectorAll("span"),c=0;c<h.length;c+=1){if(f=h[c],e.util.traverseUp(f,g))return!1;e.util.unwrap(f,this.document)}}});e.extensions.paste=l})(),(function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(o,i){this.initElement(i)},initElement:function(o){o.getAttribute("data-placeholder")||o.setAttribute("data-placeholder",this.text),this.updatePlaceholder(o)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(o,i){this.cleanupElement(i)},cleanupElement:function(o){o.getAttribute("data-placeholder")===this.text&&o.removeAttribute("data-placeholder")},showPlaceholder:function(o){o&&(e.util.isFF&&o.childNodes.length===0?(o.classList.add("medium-editor-placeholder-relative"),o.classList.remove("medium-editor-placeholder")):(o.classList.add("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(o){o&&(o.classList.remove("medium-editor-placeholder"),o.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(o,i){if(o.querySelector("img, blockquote, ul, ol, table")||o.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(o);i||this.showPlaceholder(o)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(o,i){var r=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,r)},handleFocus:function(o,i){this.hidePlaceholder(i)},handleBlur:function(o,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t})(),(function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(o,i){return this.base.extensions.forEach(function(r){if(r!==this)return o.apply(i||this,arguments)},this)},createToolbar:function(){var o=this.document.createElement("div");return o.id="medium-editor-toolbar-"+this.getEditorId(),o.className="medium-editor-toolbar",this.static?o.className+=" static-toolbar":this.relativeContainer?o.className+=" medium-editor-relative-toolbar":o.className+=" medium-editor-stalker-toolbar",o.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&o.appendChild(i.getForm())}),this.attachEventHandlers(),o},createToolbarButtons:function(){var o=this.document.createElement("ul"),i,r,s,a,l,u;return o.id="medium-editor-toolbar-actions"+this.getEditorId(),o.className="medium-editor-toolbar-actions",o.style.display="block",this.buttons.forEach(function(c){typeof c=="string"?(l=c,u=null):(l=c.name,u=c),a=this.base.addBuiltInExtension(l,u),a&&typeof a.getButton=="function"&&(r=a.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(r)?i.appendChild(r):i.innerHTML=r,o.appendChild(i))},this),s=o.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),o},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(o){if(o&&o.target&&e.util.isDescendant(this.getToolbarElement(),o.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(o){o.hasForm&&o.isDisplayed()&&o.hideForm()})},multipleBlockElementsSelected:function(){var o=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),r=e.selection.getSelectionHtml(this.document).replace(o,""),s=r.match(i);return!!s&&s.length>1},modifySelection:function(){var o=this.window.getSelection(),i=o.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var r=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(r){for(var s=0;r.nodeValue.substr(s,1).trim().length===0;)s=s+1;i=e.selection.select(this.document,r,s,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var o=e.selection.getSelectionElement(this.window);if(!o||this.getEditorElements().indexOf(o)===-1||o.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(o){typeof o.isActive=="function"&&typeof o.setInactive=="function"&&o.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var o=[],i=null,r=e.selection.getSelectionRange(this.document),s,a=function(l){typeof l.checkState=="function"?l.checkState(s):typeof l.isActive=="function"&&typeof l.isAlreadyApplied=="function"&&typeof l.setActive=="function"&&!l.isActive()&&l.isAlreadyApplied(s)&&l.setActive()};if(r&&(this.forEachExtension(function(l){if(typeof l.queryCommandState=="function"&&(i=l.queryCommandState(),i!==null)){i&&typeof l.setActive=="function"&&l.setActive();return}o.push(l)}),s=e.selection.getSelectedParentElement(r),!!this.getEditorElements().some(function(l){return e.util.isDescendant(l,s,!0)})))for(;s&&(o.forEach(a),!e.util.isMediumEditorElement(s));)s=s.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var o=this.base.getFocusedElement(),i=this.window.getSelection();if(!o)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(o):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(o){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,r=this.window.innerWidth,s=this.getToolbarElement(),a=o.getBoundingClientRect(),l=a.top+i,u=a.left+a.width/2,c=s.offsetHeight,f=s.offsetWidth,p=f/2,h;switch(this.sticky?i>l+o.offsetHeight-c-this.stickyTopOffset?(s.style.top=l+o.offsetHeight-c+"px",s.classList.remove("medium-editor-sticky-toolbar")):i>l-c-this.stickyTopOffset?(s.classList.add("medium-editor-sticky-toolbar"),s.style.top=this.stickyTopOffset+"px"):(s.classList.remove("medium-editor-sticky-toolbar"),s.style.top=l-c+"px"):s.style.top=l-c+"px",this.align){case"left":h=a.left;break;case"right":h=a.right-f;break;case"center":h=u-p;break}h<0?h=0:h+f>r&&(h=r-Math.ceil(f)-1),s.style.left=h+"px"},positionToolbar:function(o){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=o.getRangeAt(0),r=i.getBoundingClientRect();(!r||r.height===0&&r.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?r=i.startContainer.querySelector("img").getBoundingClientRect():r=i.startContainer.getBoundingClientRect());var s=this.window.innerWidth,a=this.getToolbarElement(),l=a.offsetHeight,u=a.offsetWidth,c=u/2,f=50,p=this.diffLeft-c,h=this.getEditorOption("elementsContainer"),g=["absolute","fixed"].indexOf(window.getComputedStyle(h).getPropertyValue("position"))>-1,m={},_={},v,b;g?(b=h.getBoundingClientRect(),["top","left"].forEach(function(C){_[C]=r[C]-b[C]}),_.width=r.width,_.height=r.height,r=_,s=b.width,m.top=h.scrollTop):m.top=this.window.pageYOffset,v=r.left+r.width/2,m.top+=r.top-l,r.top<f?(a.classList.add("medium-toolbar-arrow-over"),a.classList.remove("medium-toolbar-arrow-under"),m.top+=f+r.height-this.diffTop):(a.classList.add("medium-toolbar-arrow-under"),a.classList.remove("medium-toolbar-arrow-over"),m.top+=this.diffTop),v<c?(m.left=p+c,m.right="initial"):s-v<c?(m.left="auto",m.right=0):(m.left=p+v,m.right="initial"),["top","left","right"].forEach(function(C){a.style[C]=m[C]+(isNaN(m[C])?"":"px")})}});e.extensions.toolbar=t})(),(function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){var i="medium-editor-dragover";o.preventDefault(),o.dataTransfer.dropEffect="copy",o.type==="dragover"?o.target.classList.add(i):o.type==="dragleave"&&o.target.classList.remove(i)},handleDrop:function(o){var i="medium-editor-dragover",r;o.preventDefault(),o.stopPropagation(),o.dataTransfer.files&&(r=Array.prototype.slice.call(o.dataTransfer.files,0),r.some((function(s){if(s.type.match("image")){var a,l;a=new FileReader,a.readAsDataURL(s),l="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+l+'" />'),a.onload=(function(){var u=this.document.getElementById(l);u&&(u.removeAttribute("id"),u.removeAttribute("class"),u.src=a.result)}).bind(this)}}).bind(this))),o.target.classList.remove(i)}});e.extensions.imageDragging=t})(),(function(){function t(A){var D=e.selection.getSelectionStart(this.options.ownerDocument),T=D.textContent,F=e.selection.getCaretOffsets(D);(T[F.left-1]===void 0||T[F.left-1].trim()===""||T[F.left]!==void 0&&T[F.left].trim()==="")&&A.preventDefault()}function o(A,D){if(this.options.disableReturn||D.getAttribute("data-disable-return"))A.preventDefault();else if(this.options.disableDoubleReturn||D.getAttribute("data-disable-double-return")){var T=e.selection.getSelectionStart(this.options.ownerDocument);(T&&T.textContent.trim()===""&&T.nodeName.toLowerCase()!=="li"||T.previousElementSibling&&T.previousElementSibling.nodeName.toLowerCase()!=="br"&&T.previousElementSibling.textContent.trim()==="")&&A.preventDefault()}}function i(A){var D=e.selection.getSelectionStart(this.options.ownerDocument),T=D&&D.nodeName.toLowerCase();T==="pre"&&(A.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(D)&&(A.preventDefault(),A.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function r(A){var D,T=e.selection.getSelectionStart(this.options.ownerDocument),F=T.nodeName.toLowerCase(),V=/^(\s+|<br\/?>)?$/i,P=/h\d/i;e.util.isKey(A,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&T.previousElementSibling&&P.test(F)&&e.selection.getCaretOffsets(T).left===0?e.util.isKey(A,e.util.keyCode.BACKSPACE)&&V.test(T.previousElementSibling.innerHTML)?(T.previousElementSibling.parentNode.removeChild(T.previousElementSibling),A.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(A,e.util.keyCode.ENTER)&&(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",T.previousElementSibling.parentNode.insertBefore(D,T),A.preventDefault()):e.util.isKey(A,e.util.keyCode.DELETE)&&T.nextElementSibling&&T.previousElementSibling&&!P.test(F)&&V.test(T.innerHTML)&&P.test(T.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,T.nextElementSibling),T.previousElementSibling.parentNode.removeChild(T),A.preventDefault()):e.util.isKey(A,e.util.keyCode.BACKSPACE)&&F==="li"&&V.test(T.innerHTML)&&!T.previousElementSibling&&!T.parentElement.previousElementSibling&&T.nextElementSibling&&T.nextElementSibling.nodeName.toLowerCase()==="li"?(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",T.parentElement.parentElement.insertBefore(D,T.parentElement),e.selection.moveCursor(this.options.ownerDocument,D),T.parentElement.removeChild(T),A.preventDefault()):e.util.isKey(A,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(T,"blockquote")!==!1&&e.selection.getCaretOffsets(T).left===0?(A.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(A,e.util.keyCode.ENTER)&&e.util.getClosestTag(T,"blockquote")!==!1&&e.selection.getCaretOffsets(T).right===0?(D=this.options.ownerDocument.createElement("p"),D.innerHTML="<br>",T.parentElement.insertBefore(D,T.nextSibling),e.selection.moveCursor(this.options.ownerDocument,D),A.preventDefault()):e.util.isKey(A,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(T.parentElement)&&!T.previousElementSibling&&T.nextElementSibling&&V.test(T.innerHTML)&&(A.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,T.nextSibling),T.parentElement.removeChild(T))}function s(A){var D=e.selection.getSelectionStart(this.options.ownerDocument),T;D&&(e.util.isMediumEditorElement(D)&&D.children.length===0&&!e.util.isBlockContainer(D)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(A,e.util.keyCode.ENTER)&&!e.util.isListItem(D)&&!e.util.isBlockContainer(D)&&(T=D.nodeName.toLowerCase(),T==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!A.shiftKey&&!A.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function a(A,D){var T=D.parentNode.querySelector('textarea[medium-editor-textarea-id="'+D.getAttribute("medium-editor-textarea-id")+'"]');T&&(T.value=D.innerHTML.trim())}function l(A){A._mediumEditors||(A._mediumEditors=[null]),this.id||(this.id=A._mediumEditors.length),A._mediumEditors[this.id]=this}function u(A){!A._mediumEditors||!A._mediumEditors[this.id]||(A._mediumEditors[this.id]=null)}function c(A,D,T){var F=[];if(A||(A=[]),typeof A=="string"&&(A=D.querySelectorAll(A)),e.util.isElement(A)&&(A=[A]),T)for(var V=0;V<A.length;V++){var P=A[V];e.util.isElement(P)&&!P.getAttribute("data-medium-editor-element")&&!P.getAttribute("medium-editor-textarea-id")&&F.push(P)}else F=Array.prototype.slice.apply(A);return F}function f(A){var D=A.parentNode.querySelector('textarea[medium-editor-textarea-id="'+A.getAttribute("medium-editor-textarea-id")+'"]');D&&(D.classList.remove("medium-editor-hidden"),D.removeAttribute("medium-editor-textarea-id")),A.parentNode&&A.parentNode.removeChild(A)}function p(A,D){return Object.keys(D).forEach(function(T){A[T]===void 0&&(A[T]=D[T])}),A}function h(A,D,T){var F={window:T.options.contentWindow,document:T.options.ownerDocument,base:T};return A=p(A,F),typeof A.init=="function"&&A.init(),A.name||(A.name=D),A}function g(){return this.elements.every(function(A){return!!A.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function m(){return g.call(this)?this.options.anchorPreview!==!1:!1}function _(){return this.options.placeholder!==!1}function v(){return this.options.autoLink!==!1}function b(){return this.options.imageDragging!==!1}function C(){return this.options.keyboardCommands!==!1}function M(){return!this.options.extensions.imageDragging}function O(A){for(var D=this.options.ownerDocument.createElement("div"),T=Date.now(),F="medium-editor-"+T,V=A.attributes;this.options.ownerDocument.getElementById(F);)T++,F="medium-editor-"+T;D.className=A.className,D.id=F,D.innerHTML=A.value,A.setAttribute("medium-editor-textarea-id",F);for(var P=0,X=V.length;P<X;P++)D.hasAttribute(V[P].nodeName)||D.setAttribute(V[P].nodeName,V[P].value);return A.form&&this.on(A.form,"reset",(function(oe){oe.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(F))}).bind(this)),A.classList.add("medium-editor-hidden"),A.parentNode.insertBefore(D,A),D}function k(A,D){if(!A.getAttribute("data-medium-editor-element")){A.nodeName.toLowerCase()==="textarea"&&(A=O.call(this,A),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=a.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!A.getAttribute("data-disable-editing")&&(A.setAttribute("contentEditable",!0),A.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(A.getAttribute("data-disable-return")||A.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!A.getAttribute("data-disable-return")&&this.on(A,"keyup",s.bind(this));var T=e.util.guid();A.setAttribute("data-medium-editor-element",!0),A.classList.add("medium-editor-element"),A.setAttribute("role","textbox"),A.setAttribute("aria-multiline",!0),A.setAttribute("data-medium-editor-editor-index",D),A.setAttribute("medium-editor-index",T),B[T]=A.innerHTML,this.events.attachAllEventsToElement(A)}return A}function E(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",r.bind(this)),this.subscribe("editableKeydownEnter",r.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=o.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function S(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(V){V!=="toolbar"&&this.options.extensions[V]&&this.extensions.push(h(this.options.extensions[V],V,this))},this),M.call(this)){var A=this.options.fileDragging;A||(A={},b.call(this)||(A.allowedTypes=[])),this.addBuiltInExtension("fileDragging",A)}var D={paste:!0,"anchor-preview":m.call(this),autoLink:v.call(this),keyboardCommands:C.call(this),placeholder:_.call(this)};Object.keys(D).forEach(function(V){D[V]&&this.addBuiltInExtension(V)},this);var T=this.options.extensions.toolbar;if(!T&&g.call(this)){var F=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});T=new e.extensions.toolbar(F)}T&&this.extensions.push(h(T,"toolbar",this))}function N(A,D){var T=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return D&&T.forEach(function(F){D.hasOwnProperty(F[0])&&D[F[0]]!==void 0&&e.util.deprecated(F[0],F[1],"v6.0.0")}),e.util.defaults({},D,A)}function L(A,D){var T=/^append-(.+)$/gi,F=/justify([A-Za-z]*)$/g,V,P;if(V=T.exec(A),V)return e.util.execFormatBlock(this.options.ownerDocument,V[1]);if(A==="fontSize")return D.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),P=D.value||D.size,this.options.ownerDocument.execCommand("fontSize",!1,P);if(A==="fontName")return D.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),P=D.value||D.name,this.options.ownerDocument.execCommand("fontName",!1,P);if(A==="createLink")return this.createLink(D);if(A==="image"){var X=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,X)}if(A==="html"){var oe=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,oe)}if(F.exec(A)){var H=this.options.ownerDocument.execCommand(A,!1,null),W=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return W&&$.call(this,e.util.getTopBlockContainer(W)),H}return P=D&&D.value,this.options.ownerDocument.execCommand(A,!1,P)}function $(A){if(A){var D,T=Array.prototype.slice.call(A.childNodes).filter(function(F){var V=F.nodeName.toLowerCase()==="div";return V&&!D&&(D=F.style.textAlign),V});T.length&&(this.saveSelection(),T.forEach(function(F){if(F.style.textAlign===D){var V=F.lastChild;if(V){e.util.unwrap(F,this.options.ownerDocument);var P=this.options.ownerDocument.createElement("BR");V.parentNode.insertBefore(P,V.nextSibling)}}},this),A.style.textAlign=D,this.restoreSelection())}}var B={};e.prototype={init:function(A,D){return this.options=N.call(this,this.defaults,D),this.origElements=A,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(l.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,S.call(this),E.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(A){typeof A.destroy=="function"&&A.destroy()},this),this.events.destroy(),this.elements.forEach(function(A){this.options.spellcheck&&(A.innerHTML=A.innerHTML),A.removeAttribute("contentEditable"),A.removeAttribute("spellcheck"),A.removeAttribute("data-medium-editor-element"),A.classList.remove("medium-editor-element"),A.removeAttribute("role"),A.removeAttribute("aria-multiline"),A.removeAttribute("medium-editor-index"),A.removeAttribute("data-medium-editor-editor-index"),A.getAttribute("medium-editor-textarea-id")&&f(A)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,u.call(this,this.options.contentWindow))},on:function(A,D,T,F){return this.events.attachDOMEvent(A,D,T,F),this},off:function(A,D,T,F){return this.events.detachDOMEvent(A,D,T,F),this},subscribe:function(A,D){return this.events.attachCustomEvent(A,D),this},unsubscribe:function(A,D){return this.events.detachCustomEvent(A,D),this},trigger:function(A,D,T){return this.events.triggerCustomEvent(A,D,T),this},delay:function(A){var D=this;return setTimeout(function(){D.isActive&&A()},this.options.delay)},serialize:function(){var A,D,T={},F=this.elements.length;for(A=0;A<F;A+=1)D=this.elements[A].id!==""?this.elements[A].id:"element-"+A,T[D]={value:this.elements[A].innerHTML.trim()};return T},getExtensionByName:function(A){var D;return this.extensions&&this.extensions.length&&this.extensions.some(function(T){return T.name===A?(D=T,!0):!1}),D},addBuiltInExtension:function(A,D){var T=this.getExtensionByName(A),F;if(T)return T;switch(A){case"anchor":F=e.util.extend({},this.options.anchor,D),T=new e.extensions.anchor(F);break;case"anchor-preview":T=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":T=new e.extensions.autoLink;break;case"fileDragging":T=new e.extensions.fileDragging(D);break;case"fontname":T=new e.extensions.fontName(this.options.fontName);break;case"fontsize":T=new e.extensions.fontSize(D);break;case"keyboardCommands":T=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":T=new e.extensions.paste(this.options.paste);break;case"placeholder":T=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(A)&&(D?(F=e.util.defaults({},D,e.extensions.button.prototype.defaults[A]),T=new e.extensions.button(F)):T=new e.extensions.button(A))}return T&&this.extensions.push(h(T,A,this)),T},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var A=this.getExtensionByName("toolbar");return A&&A.checkState(),this},queryCommandState:function(A){var D=/^full-(.+)$/gi,T,F=null;T=D.exec(A),T&&(A=T[1]);try{F=this.options.ownerDocument.queryCommandState(A)}catch{F=null}return F},execAction:function(A,D){var T=/^full-(.+)$/gi,F,V;return F=T.exec(A),F?(this.saveSelection(),this.selectAllContents(),V=L.call(this,F[1],D),this.restoreSelection()):V=L.call(this,A,D),(A==="insertunorderedlist"||A==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),V},getSelectedParentElement:function(A){return A===void 0&&(A=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(A)},selectAllContents:function(){var A=e.selection.getSelectionElement(this.options.contentWindow);if(A){for(;A.children.length===1;)A=A.children[0];this.selectElement(A)}},selectElement:function(A){e.selection.selectNode(A,this.options.ownerDocument);var D=e.selection.getSelectionElement(this.options.contentWindow);D&&this.events.focusElement(D)},getFocusedElement:function(){var A;return this.elements.some(function(D){return!A&&D.getAttribute("data-medium-focused")&&(A=D),!!A},this),A},exportSelection:function(){var A=e.selection.getSelectionElement(this.options.contentWindow),D=this.elements.indexOf(A),T=null;return D>=0&&(T=e.selection.exportSelection(A,this.options.ownerDocument)),T!==null&&D!==0&&(T.editableElementIndex=D),T},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(A,D){if(A){var T=this.elements[A.editableElementIndex||0];e.selection.importSelection(A,T,this.options.ownerDocument,D)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(A){var D=e.selection.getSelectionElement(this.options.contentWindow),T={},F;if(this.elements.indexOf(D)!==-1){try{if(this.events.disableCustomEvent("editableInput"),A.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),F=A.url||A.value,F&&F.trim().length>0){var V=this.options.contentWindow.getSelection();if(V){var P=V.getRangeAt(0),X=P.commonAncestorContainer,oe,H,W,Z;if(P.endContainer.nodeType===3&&P.startContainer.nodeType!==3&&P.startOffset===0&&P.startContainer.firstChild===P.endContainer&&(X=P.endContainer),H=e.util.getClosestBlockContainer(P.startContainer),W=e.util.getClosestBlockContainer(P.endContainer),X.nodeType!==3&&X.textContent.length!==0&&H===W){var le=H||D,te=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),oe=this.exportSelection(),te.appendChild(le.cloneNode(!0)),D===le?e.selection.select(this.options.ownerDocument,le.firstChild,0,le.lastChild,le.lastChild.nodeType===3?le.lastChild.nodeValue.length:le.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,le,0,le,le.childNodes.length);var q=this.exportSelection();Z=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,te,{start:oe.start-q.start,end:oe.end-q.start,editableElementIndex:oe.editableElementIndex}),Z.length===0&&(te=this.options.ownerDocument.createDocumentFragment(),te.appendChild(X.cloneNode(!0)),Z=[te.firstChild.firstChild,te.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Z,F.trim());var re=(te.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,te.firstChild.innerHTML.replace(/^\s+/,"")),oe.start-=re,oe.end-=re,this.importSelection(oe)}else this.options.ownerDocument.execCommand("createLink",!1,F);this.options.targetBlank||A.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),F),A.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),A.buttonClass)}}if(this.options.targetBlank||A.target==="_blank"||A.buttonClass){T=this.options.ownerDocument.createEvent("HTMLEvents"),T.initEvent("input",!0,!0,this.options.contentWindow);for(var ce=0,ve=this.elements.length;ce<ve;ce+=1)this.elements[ce].dispatchEvent(T)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",T,D)}},cleanPaste:function(A){this.getExtensionByName("paste").cleanPaste(A)},pasteHTML:function(A,D){this.getExtensionByName("paste").pasteHTML(A,D)},setContent:function(A,D){if(D=D||0,this.elements[D]){var T=this.elements[D];T.innerHTML=A,this.checkContentChanged(T)}},getContent:function(A){return A=A||0,this.elements[A]?this.elements[A].innerHTML.trim():null},checkContentChanged:function(A){A=A||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(A,{target:A,currentTarget:A})},resetContent:function(A){if(A){var D=this.elements.indexOf(A);D!==-1&&this.setContent(B[A.getAttribute("medium-editor-index")],D);return}this.elements.forEach(function(T,F){this.setContent(B[T.getAttribute("medium-editor-index")],F)},this)},addElements:function(A){var D=c(A,this.options.ownerDocument,!0);if(D.length===0)return!1;D.forEach(function(T){T=k.call(this,T,this.id),this.elements.push(T),this.trigger("addElement",{target:T,currentTarget:T},T)},this)},removeElements:function(A){var D=c(A,this.options.ownerDocument),T=D.map(function(F){return F.getAttribute("medium-editor-textarea-id")&&F.parentNode?F.parentNode.querySelector('div[medium-editor-textarea-id="'+F.getAttribute("medium-editor-textarea-id")+'"]'):F});this.elements=this.elements.filter(function(F){return T.indexOf(F)!==-1?(this.events.cleanupElement(F),F.getAttribute("medium-editor-textarea-id")&&f(F),this.trigger("removeElement",{target:F,currentTarget:F},F),!1):!0},this)}},e.getEditorFromElement=function(A){var D=A.getAttribute("data-medium-editor-editor-index"),T=A&&A.ownerDocument&&(A.ownerDocument.defaultView||A.ownerDocument.parentWindow);return T&&T._mediumEditors&&T._mediumEditors[D]?T._mediumEditors[D]:null}})(),(function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}})(),e.parseVersionString=function(t){var o=t.split("-"),i=o[0].split("."),r=o.length>1?o[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:r,toString:function(){return[i[0],i[1],i[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e})())})(Rl)),Rl.exports}var VJ=jJ();const Nu=Ts(VJ);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var Bf=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},Lf=(function(){function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}})(),Dl=(function(){function n(e,t){var o=[],i=!0,r=!1,s=void 0;try{for(var a=e[Symbol.iterator](),l;!(i=(l=a.next()).done)&&(o.push(l.value),!(t&&o.length===t));i=!0);}catch(u){r=!0,s=u}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return o}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})();String.prototype.startsWith=String.prototype.startsWith||function(n){return this.indexOf(n)===0};String.prototype.padStart=String.prototype.padStart||function(n,e){for(var t=this;t.length<n;)t=e+t;return t};var HJ={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function Iv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?n.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):n.toString();return t||"0"}var UJ=(function(){function n(e,t,o,i){Bf(this,n);var r=this;function s(l){if(l.startsWith("hsl")){var u=l.match(/([\-\d\.e]+)/g).map(Number),c=Dl(u,4),f=c[0],p=c[1],h=c[2],g=c[3];g===void 0&&(g=1),f/=360,p/=100,h/=100,r.hsla=[f,p,h,g]}else if(l.startsWith("rgb")){var m=l.match(/([\-\d\.e]+)/g).map(Number),_=Dl(m,4),v=_[0],b=_[1],C=_[2],M=_[3];M===void 0&&(M=1),r.rgba=[v,b,C,M]}else l.startsWith("#")?r.rgba=n.hexToRgb(l):r.rgba=n.nameToRgb(l)||n.hexToRgb(l)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(o===void 0){var a=e&&""+e;a&&s(a.toLowerCase())}else this.rgba=[e,t,o,i===void 0?1:i]}return Lf(n,[{key:"printRGB",value:function(t){var o=t?this.rgba:this.rgba.slice(0,3),i=o.map(function(r,s){return Iv(r,s===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var o=[360,100,100,1],i=["","%","%",""],r=t?this.hsla:this.hsla.slice(0,3),s=r.map(function(a,l){return Iv(a*o[l],l===3?3:1)+i[l]});return t?"hsla("+s+")":"hsl("+s+")"}},{key:"printHex",value:function(t){var o=this.hex;return t?o:o.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=n.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=n.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,o=t.map(function(i,r){return r<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+o.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=n.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var o=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!o.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=o.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(r){return parseInt(r,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var o=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=HJ[o];return i===void 0?i:n.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var o=Dl(t,4),i=o[0],r=o[1],s=o[2],a=o[3];i/=255,r/=255,s/=255;var l=Math.max(i,r,s),u=Math.min(i,r,s),c=void 0,f=void 0,p=(l+u)/2;if(l===u)c=f=0;else{var h=l-u;switch(f=p>.5?h/(2-l-u):h/(l+u),l){case i:c=(r-s)/h+(r<s?6:0);break;case r:c=(s-i)/h+2;break;case s:c=(i-r)/h+4;break}c/=6}return[c,f,p,a]}},{key:"hslToRgb",value:function(t){var o=Dl(t,4),i=o[0],r=o[1],s=o[2],a=o[3],l=void 0,u=void 0,c=void 0;if(r===0)l=u=c=s;else{var f=function(_,v,b){return b<0&&(b+=1),b>1&&(b-=1),b<.16666666666666666?_+(v-_)*6*b:b<.5?v:b<.6666666666666666?_+(v-_)*(.6666666666666666-b)*6:_},p=s<.5?s*(1+r):s+r-s*r,h=2*s-p;l=f(h,p,i+1/3),u=f(h,p,i),c=f(h,p,i-1/3)}var g=[l*255,u*255,c*255].map(Math.round);return g[3]=a,g}}]),n})(),zJ=(function(){function n(){Bf(this,n),this._events=[]}return Lf(n,[{key:"add",value:function(t,o,i){t.addEventListener(o,i,!1),this._events.push({target:t,type:o,handler:i})}},{key:"remove",value:function(t,o,i){this._events=this._events.filter(function(r){var s=!0;return t&&t!==r.target&&(s=!1),o&&o!==r.type&&(s=!1),i&&i!==r.handler&&(s=!1),s&&n._doRemove(r.target,r.type,r.handler),!s})}},{key:"destroy",value:function(){this._events.forEach(function(t){return n._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,o,i){t.removeEventListener(o,i,!1)}}]),n})();function qJ(n){var e=document.createElement("div");return e.innerHTML=n,e.firstElementChild}function Pd(n,e,t){var o=!1;function i(l,u,c){return Math.max(u,Math.min(l,c))}function r(l,u,c){if(c&&(o=!0),!!o){l.preventDefault();var f=e.getBoundingClientRect(),p=f.width,h=f.height,g=u.clientX,m=u.clientY,_=i(g-f.left,0,p),v=i(m-f.top,0,h);t(_/p,v/h)}}function s(l,u){var c=l.buttons===void 0?l.which:l.buttons;c===1?r(l,l,u):o=!1}function a(l,u){l.touches.length===1?r(l,l.touches[0],u):o=!1}n.add(e,"mousedown",function(l){s(l,!0)}),n.add(e,"touchstart",function(l){a(l,!0)}),n.add(window,"mousemove",s),n.add(e,"touchmove",a),n.add(window,"mouseup",function(l){o=!1}),n.add(e,"touchend",function(l){o=!1}),n.add(e,"touchcancel",function(l){o=!1})}var GJ=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,XJ=360,Sm="keydown",Al="mousedown",Rd="focusin";function ci(n,e){return(e||document).querySelector(n)}function WJ(n){n.preventDefault(),n.stopPropagation()}function Bd(n,e,t,o,i){n.add(e,Sm,function(r){t.indexOf(r.key)>=0&&o(r)})}var km=(function(){function n(e){Bf(this,n),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new zJ,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return Lf(n,[{key:"setOptions",value:function(t){var o=this;if(!t)return;var i=this.settings;function r(u,c,f){for(var p in u)c[p]=u[p]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),r(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var s=t.color||t.colour;s&&this._setColor(s)}var a=i.parent;if(a&&i.popup&&!this._popupInited){var l=function(c){return o.openHandler(c)};this._events.add(a,"click",l),Bd(this._events,a,[" ","Spacebar","Enter"],l),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var o=t&&t.type===Sm?this._domEdit:this.domElement;setTimeout(function(){return o.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var o=t&&t.type,i=!1;if(!t)i=!0;else if(o===Al||o===Rd){var r=(this.__containedEvent||0)+100;t.timeStamp>r&&(i=!0)}else WJ(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",o!==Al&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,o){this.closeHandler(),this.setOptions(t),o&&this.openHandler()}},{key:"setColor",value:function(t,o){this._setColor(t,{silent:o})}},{key:"_setColor",value:function(t,o){if(typeof t=="string"&&(t=t.trim()),!!t){o=o||{};var i=void 0;try{i=new UJ(t)}catch(s){if(o.failSilently)return;throw s}if(!this.settings.alpha){var r=i.hsla;r[3]=1,i.hsla=r}this.colour=this.color=i,this._setHSLA(null,null,null,null,o)}}},{key:"setColour",value:function(t,o){this.setColor(t,o)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var o=this._toggleDOM(!0);return this._setPosition(),o}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',r=qJ(i);return this.domElement=r,this._domH=ci(".picker_hue",r),this._domSL=ci(".picker_sl",r),this._domA=ci(".picker_alpha",r),this._domEdit=ci(".picker_editor input",r),this._domSample=ci(".picker_sample",r),this._domOkay=ci(".picker_done button",r),this._domCancel=ci(".picker_cancel button",r),r.classList.add("layout_"+this.settings.layout),this.settings.alpha||r.classList.add("no_alpha"),this.settings.editor||r.classList.add("no_editor"),this.settings.cancelButton||r.classList.add("no_cancel"),this._ifPopup(function(){return r.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,o=this,i=this.domElement,r=this._events;function s(u,c,f){r.add(u,c,f)}s(i,"click",function(u){return u.preventDefault()}),Pd(r,this._domH,function(u,c){return o._setHSLA(u)}),Pd(r,this._domSL,function(u,c){return o._setHSLA(null,u,1-c)}),this.settings.alpha&&Pd(r,this._domA,function(u,c){return o._setHSLA(null,null,null,1-c)});var a=this._domEdit;s(a,"input",function(u){o._setColor(this.value,{fromEditor:!0,failSilently:!0})}),s(a,"focus",function(u){var c=this;c.selectionStart===c.selectionEnd&&c.select()}),this._ifPopup(function(){var u=function(p){return t.closeHandler(p)};s(window,Al,u),s(window,Rd,u),Bd(r,i,["Esc","Escape"],u);var c=function(p){t.__containedEvent=p.timeStamp};s(i,Al,c),s(i,Rd,c),s(t._domCancel,"click",u)});var l=function(c){t._ifPopup(function(){return t.closeHandler(c)}),t.onDone&&t.onDone(t.colour)};s(this._domOkay,"click",l),Bd(r,i,["Enter"],l)}},{key:"_setPosition",value:function(){var t=this.settings.parent,o=this.domElement;t!==o.parentNode&&t.appendChild(o),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var r=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(s){s===r?o.classList.add(s):o.classList.remove(s)}),o.classList.add(r)})}},{key:"_setHSLA",value:function(t,o,i,r,s){s=s||{};var a=this.colour,l=a.hsla;[t,o,i,r].forEach(function(u,c){(u||u===0)&&(l[c]=u)}),a.hsla=l,this._updateUI(s),this.onChange&&!s.silent&&this.onChange(a)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var o=this.colour,i=o.hsla,r="hsl("+i[0]*XJ+", 100%, 50%)",s=o.hslString,a=o.hslaString,l=this._domH,u=this._domSL,c=this._domA,f=ci(".picker_selector",l),p=ci(".picker_selector",u),h=ci(".picker_selector",c);function g(k,E,S){E.style.left=S*100+"%"}function m(k,E,S){E.style.top=S*100+"%"}g(l,f,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=r,g(u,p,i[1]),m(u,p,1-i[2]),u.style.color=s,m(c,h,1-i[3]);var _=s,v=_.replace("hsl","hsla").replace(")",", 0)"),b="linear-gradient("+[_,v]+")";if(this._domA.style.background=b+", "+GJ,!t.fromEditor){var C=this.settings.editorFormat,M=this.settings.alpha,O=void 0;switch(C){case"rgb":O=o.printRGB(M);break;case"hsl":O=o.printHSL(M);break;default:O=o.printHex(M)}this._domEdit.value=O}this._domSample.style.color=a}},{key:"_ifPopup",value:function(t,o){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):o&&o()}},{key:"_toggleDOM",value:function(t){var o=this.domElement;if(!o)return!1;var i=t?"":"none",r=o.style.display!==i;return r&&(o.style.display=i),r}}]),n})();{var Ld=document.createElement("style");Ld.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(Ld),km.StyleElement=Ld}var Id={exports:{}},Fv;function Em(){return Fv||(Fv=1,(function(n,e){(function(t,o){n.exports=t()})(function(){var t="object",o="function",i="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function u(q,re){var ce=typeof q[re];return ce==o||!!(ce==t&&q[re])||ce=="unknown"}function c(q,re){return!!(typeof q[re]==t&&q[re])}function f(q,re){return typeof q[re]!=i}function p(q){return function(re,ce){for(var ve=ce.length;ve--;)if(!q(re,ce[ve]))return!1;return!0}}var h=p(u),g=p(c),m=p(f);function _(q){return q&&h(q,l)&&m(q,a)}function v(q){return c(q,"body")?q.body:q.getElementsByTagName("body")[0]}var b=[].forEach?function(q,re){q.forEach(re)}:function(q,re){for(var ce=0,ve=q.length;ce<ve;++ce)re(q[ce],ce)},C={},M=typeof window!=i&&typeof document!=i,O={isHostMethod:u,isHostObject:c,isHostProperty:f,areHostMethods:h,areHostObjects:g,areHostProperties:m,isTextRange:_,getBody:v,forEach:b},k={version:"1.3.2",initialized:!1,isBrowser:M,supported:!0,util:O,features:{},modules:C,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function E(q){typeof console!=i&&u(console,"log")}function S(q,re){M&&re?alert(q):E(q)}function N(q){k.initialized=!0,k.supported=!1,S("Rangy is not supported in this environment. Reason: "+q,k.config.alertOnFail)}k.fail=N;function L(q){S("Rangy warning: "+q,k.config.alertOnWarn)}k.warn=L;var $;({}).hasOwnProperty?(O.extend=$=function(q,re,ce){var ve,Ne;for(var ge in re)ge==="__proto__"||ge==="constructor"||ge==="prototype"||re.hasOwnProperty(ge)&&(ve=q[ge],Ne=re[ge],ce&&ve!==null&&typeof ve=="object"&&Ne!==null&&typeof Ne=="object"&&$(ve,Ne,!0),q[ge]=Ne);return re.hasOwnProperty("toString")&&(q.toString=re.toString),q},O.createOptions=function(q,re){var ce={};return $(ce,re),q&&$(ce,q),ce}):N("hasOwnProperty not supported"),M||N("Rangy can only run in a browser"),(function(){var q;if(M){var re=document.createElement("div");re.appendChild(document.createElement("span"));var ce=[].slice;try{ce.call(re.childNodes,0)[0].nodeType==1&&(q=function(ve){return ce.call(ve,0)})}catch{}}q||(q=function(ve){for(var Ne=[],ge=0,_e=ve.length;ge<_e;++ge)Ne[ge]=ve[ge];return Ne}),O.toArray=q})();var B;M&&(u(document,"addEventListener")?B=function(q,re,ce){q.addEventListener(re,ce,!1)}:u(document,"attachEvent")?B=function(q,re,ce){q.attachEvent("on"+re,ce)}:N("Document does not have required addEventListener or attachEvent method"),O.addListener=B);var A=[];function D(q){return q.message||q.description||String(q)}function T(){if(!(!M||k.initialized)){var q,re=!1,ce=!1;u(document,"createRange")&&(q=document.createRange(),h(q,s)&&m(q,r)&&(re=!0));var ve=v(document);if(!ve||ve.nodeName.toLowerCase()!="body"){N("No body element found");return}if(ve&&u(ve,"createTextRange")&&(q=ve.createTextRange(),_(q)&&(ce=!0)),!re&&!ce){N("Neither Range nor TextRange are available");return}k.initialized=!0,k.features={implementsDomRange:re,implementsTextRange:ce};var Ne,ge;for(var _e in C)(Ne=C[_e])instanceof oe&&Ne.init(Ne,k);for(var st=0,tt=A.length;st<tt;++st)try{A[st](k)}catch(ke){ge="Rangy init listener threw an exception. Continuing. Detail: "+D(ke),E(ge)}}}function F(q,re,ce){ce&&(q+=" in module "+ce.name),k.warn("DEPRECATED: "+q+" is deprecated. Please use "+re+" instead.")}function V(q,re,ce,ve){q[re]=function(){return F(re,ce,ve),q[ce].apply(q,O.toArray(arguments))}}O.deprecationNotice=F,O.createAliasForDeprecatedMethod=V,k.init=T,k.addInitListener=function(q){k.initialized?q(k):A.push(q)};var P=[];k.addShimListener=function(q){P.push(q)};function X(q){q=q||window,T();for(var re=0,ce=P.length;re<ce;++re)P[re](q)}M&&(k.shim=k.createMissingNativeApi=X,V(k,"createMissingNativeApi","shim"));function oe(q,re,ce){this.name=q,this.dependencies=re,this.initialized=!1,this.supported=!1,this.initializer=ce}oe.prototype={init:function(){for(var q=this.dependencies||[],re=0,ce=q.length,ve,Ne;re<ce;++re){if(Ne=q[re],ve=C[Ne],!ve||!(ve instanceof oe))throw new Error("required module '"+Ne+"' not found");if(ve.init(),!ve.supported)throw new Error("required module '"+Ne+"' not supported")}this.initializer(this)},fail:function(q){throw this.initialized=!0,this.supported=!1,new Error(q)},warn:function(q){k.warn("Module "+this.name+": "+q)},deprecationNotice:function(q,re){k.warn("DEPRECATED: "+q+" in module "+this.name+" is deprecated. Please use "+re+" instead")},createError:function(q){return new Error("Error in Rangy "+this.name+" module: "+q)}};function H(q,re,ce){var ve=new oe(q,re,function(Ne){if(!Ne.initialized){Ne.initialized=!0;try{ce(k,Ne),Ne.supported=!0}catch(_e){var ge="Module '"+q+"' failed to load: "+D(_e);E(ge),_e.stack&&E(_e.stack)}}});return C[q]=ve,ve}k.createModule=function(q){var re,ce;arguments.length==2?(re=arguments[1],ce=[]):(re=arguments[2],ce=arguments[1]);var ve=H(q,ce,re);k.initialized&&k.supported&&ve.init()},k.createCoreModule=function(q,re,ce){H(q,re,ce)};function W(){}k.RangePrototype=W,k.rangePrototype=new W;function Z(){}k.selectionPrototype=new Z,k.createCoreModule("DomUtil",[],function(q,re){var ce="undefined",ve=q.util,Ne=ve.getBody;ve.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||re.fail("document missing a Node creation method"),ve.isHostMethod(document,"getElementsByTagName")||re.fail("document missing getElementsByTagName method");var ge=document.createElement("div");ve.areHostMethods(ge,["insertBefore","appendChild","cloneNode"])||re.fail("Incomplete Element implementation"),ve.isHostProperty(ge,"innerHTML")||re.fail("Element is missing innerHTML property");var _e=document.createTextNode("test");ve.areHostMethods(_e,["splitText","deleteData","insertData","appendData","cloneNode"])||re.fail("Incomplete Text Node implementation");var st=function(Se,Ye){for(var be=Se.length;be--;)if(Se[be]===Ye)return!0;return!1};function tt(Se){var Ye;return typeof Se.namespaceURI==ce||(Ye=Se.namespaceURI)===null||Ye=="http://www.w3.org/1999/xhtml"}function ke(Se){var Ye=Se.parentNode;return Ye.nodeType==1?Ye:null}function he(Se){for(var Ye=0;Se=Se.previousSibling;)++Ye;return Ye}function De(Se){switch(Se.nodeType){case 7:case 10:return 0;case 3:case 8:return Se.length;default:return Se.childNodes.length}}function Me(Se,Ye){var be=[],Be;for(Be=Se;Be;Be=Be.parentNode)be.push(Be);for(Be=Ye;Be;Be=Be.parentNode)if(st(be,Be))return Be;return null}function z(Se,Ye,be){for(var Be=be?Ye:Ye.parentNode;Be;){if(Be===Se)return!0;Be=Be.parentNode}return!1}function ne(Se,Ye){return z(Se,Ye,!0)}function se(Se,Ye,be){for(var Be,Ke=be?Se:Se.parentNode;Ke;){if(Be=Ke.parentNode,Be===Ye)return Ke;Ke=Be}return null}function Ee(Se){var Ye=Se.nodeType;return Ye==3||Ye==4||Ye==8}function fe(Se){if(!Se)return!1;var Ye=Se.nodeType;return Ye==3||Ye==8}function Le(Se,Ye){var be=Ye.nextSibling,Be=Ye.parentNode;return be?Be.insertBefore(Se,be):Be.appendChild(Se),Se}function Ie(Se,Ye,be){var Be=Se.cloneNode(!1);if(Be.deleteData(0,Ye),Se.deleteData(Ye,Se.length-Ye),Le(Be,Se),be)for(var Ke=0,ze;ze=be[Ke++];)ze.node==Se&&ze.offset>Ye?(ze.node=Be,ze.offset-=Ye):ze.node==Se.parentNode&&ze.offset>he(Se)&&++ze.offset;return Be}function Ve(Se){if(Se.nodeType==9)return Se;if(typeof Se.ownerDocument!=ce)return Se.ownerDocument;if(typeof Se.document!=ce)return Se.document;if(Se.parentNode)return Ve(Se.parentNode);throw re.createError("getDocument: no document found for node")}function et(Se){var Ye=Ve(Se);if(typeof Ye.defaultView!=ce)return Ye.defaultView;if(typeof Ye.parentWindow!=ce)return Ye.parentWindow;throw re.createError("Cannot get a window object for node")}function nt(Se){if(typeof Se.contentDocument!=ce)return Se.contentDocument;if(typeof Se.contentWindow!=ce)return Se.contentWindow.document;throw re.createError("getIframeDocument: No Document object found for iframe element")}function We(Se){if(typeof Se.contentWindow!=ce)return Se.contentWindow;if(typeof Se.contentDocument!=ce)return Se.contentDocument.defaultView;throw re.createError("getIframeWindow: No Window object found for iframe element")}function lt(Se){return Se&&ve.isHostMethod(Se,"setTimeout")&&ve.isHostObject(Se,"document")}function de(Se,Ye,be){var Be;if(Se?ve.isHostProperty(Se,"nodeType")?Be=Se.nodeType==1&&Se.tagName.toLowerCase()=="iframe"?nt(Se):Ve(Se):lt(Se)&&(Be=Se.document):Be=document,!Be)throw Ye.createError(be+"(): Parameter must be a Window object or DOM node");return Be}function pe(Se){for(var Ye;Ye=Se.parentNode;)Se=Ye;return Se}function xe(Se,Ye,be,Be){var Ke,ze,ht,dt,Ut;if(Se==be)return Ye===Be?0:Ye<Be?-1:1;if(Ke=se(be,Se,!0))return Ye<=he(Ke)?-1:1;if(Ke=se(Se,be,!0))return he(Ke)<Be?-1:1;if(ze=Me(Se,be),!ze)throw new Error("comparePoints error: nodes have no common ancestor");if(ht=Se===ze?ze:se(Se,ze,!0),dt=be===ze?ze:se(be,ze,!0),ht===dt)throw re.createError("comparePoints got to case 4 and childA and childB are the same!");for(Ut=ze.firstChild;Ut;){if(Ut===ht)return-1;if(Ut===dt)return 1;Ut=Ut.nextSibling}}var Ce=!1;function Fe(Se){var Ye;try{return Ye=Se.parentNode,!1}catch{return!0}}(function(){var Se=document.createElement("b");Se.innerHTML="1";var Ye=Se.firstChild;Se.innerHTML="<br />",Ce=Fe(Ye),q.features.crashyTextNodes=Ce})();function Ue(Se){if(!Se)return"[No node]";if(Ce&&Fe(Se))return"[Broken node]";if(Ee(Se))return'"'+Se.data+'"';if(Se.nodeType==1){var Ye=Se.id?' id="'+Se.id+'"':"";return"<"+Se.nodeName+Ye+">[index:"+he(Se)+",length:"+Se.childNodes.length+"]["+(Se.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return Se.nodeName}function qe(Se){for(var Ye=Ve(Se).createDocumentFragment(),be;be=Se.firstChild;)Ye.appendChild(be);return Ye}var at;typeof window.getComputedStyle!=ce?at=function(Se,Ye){return et(Se).getComputedStyle(Se,null)[Ye]}:typeof document.documentElement.currentStyle!=ce?at=function(Se,Ye){return Se.currentStyle?Se.currentStyle[Ye]:""}:re.fail("No means of obtaining computed style properties found");function bt(Se,Ye,be){var Be=Ne(Se),Ke=Se.createElement("div");Ke.contentEditable=""+!!be,Ye&&(Ke.innerHTML=Ye);var ze=Be.firstChild;return ze?Be.insertBefore(Ke,ze):Be.appendChild(Ke),Ke}function Xt(Se){return Se.parentNode.removeChild(Se)}function Ft(Se){this.root=Se,this._next=Se}Ft.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var Se=this._current=this._next,Ye,be;if(this._current)if(Ye=Se.firstChild,Ye)this._next=Ye;else{for(be=null;Se!==this.root&&!(be=Se.nextSibling);)Se=Se.parentNode;this._next=be}return this._current},detach:function(){this._current=this._next=this.root=null}};function pn(Se){return new Ft(Se)}function gn(Se,Ye){this.node=Se,this.offset=Ye}gn.prototype={equals:function(Se){return!!Se&&this.node===Se.node&&this.offset==Se.offset},inspect:function(){return"[DomPosition("+Ue(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function Rt(Se){this.code=this[Se],this.codeName=Se,this.message="DOMException: "+this.codeName}Rt.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},Rt.prototype.toString=function(){return this.message},q.dom={arrayContains:st,isHtmlNamespace:tt,parentElement:ke,getNodeIndex:he,getNodeLength:De,getCommonAncestor:Me,isAncestorOf:z,isOrIsAncestorOf:ne,getClosestAncestorIn:se,isCharacterDataNode:Ee,isTextOrCommentNode:fe,insertAfter:Le,splitDataNode:Ie,getDocument:Ve,getWindow:et,getIframeWindow:We,getIframeDocument:nt,getBody:Ne,isWindow:lt,getContentDocument:de,getRootContainer:pe,comparePoints:xe,isBrokenNode:Fe,inspectNode:Ue,getComputedStyleProperty:at,createTestElement:bt,removeNode:Xt,fragmentFromNodeChildren:qe,createIterator:pn,DomPosition:gn},q.DOMException=Rt}),k.createCoreModule("DomRange",["DomUtil"],function(q,re){var ce=q.dom,ve=q.util,Ne=ce.DomPosition,ge=q.DOMException,_e=ce.isCharacterDataNode,st=ce.getNodeIndex,tt=ce.isOrIsAncestorOf,ke=ce.getDocument,he=ce.comparePoints,De=ce.splitDataNode,Me=ce.getClosestAncestorIn,z=ce.getNodeLength,ne=ce.arrayContains,se=ce.getRootContainer,Ee=q.features.crashyTextNodes,fe=ce.removeNode;function Le(ee,I){return ee.nodeType!=3&&(tt(ee,I.startContainer)||tt(ee,I.endContainer))}function Ie(ee){return ee.document||ke(ee.startContainer)}function Ve(ee){return se(ee.startContainer)}function et(ee){return new Ne(ee.parentNode,st(ee))}function nt(ee){return new Ne(ee.parentNode,st(ee)+1)}function We(ee,I,Y){var me=ee.nodeType==11?ee.firstChild:ee;return _e(I)?Y==I.length?ce.insertAfter(ee,I):I.parentNode.insertBefore(ee,Y==0?I:De(I,Y)):Y>=I.childNodes.length?I.appendChild(ee):I.insertBefore(ee,I.childNodes[Y]),me}function lt(ee,I,Y){if(qt(ee),qt(I),Ie(I)!=Ie(ee))throw new ge("WRONG_DOCUMENT_ERR");var me=he(ee.startContainer,ee.startOffset,I.endContainer,I.endOffset),Oe=he(ee.endContainer,ee.endOffset,I.startContainer,I.startOffset);return Y?me<=0&&Oe>=0:me<0&&Oe>0}function de(ee){for(var I,Y,me=Ie(ee.range).createDocumentFragment(),Oe;Y=ee.next();){if(I=ee.isPartiallySelectedSubtree(),Y=Y.cloneNode(!I),I&&(Oe=ee.getSubtreeIterator(),Y.appendChild(de(Oe)),Oe.detach()),Y.nodeType==10)throw new ge("HIERARCHY_REQUEST_ERR");me.appendChild(Y)}return me}function pe(ee,I,Y){var me,Oe;Y=Y||{stop:!1};for(var rt,je;rt=ee.next();)if(ee.isPartiallySelectedSubtree()){if(I(rt)===!1){Y.stop=!0;return}else if(je=ee.getSubtreeIterator(),pe(je,I,Y),je.detach(),Y.stop)return}else for(me=ce.createIterator(rt);Oe=me.next();)if(I(Oe)===!1){Y.stop=!0;return}}function xe(ee){for(var I;ee.next();)ee.isPartiallySelectedSubtree()?(I=ee.getSubtreeIterator(),xe(I),I.detach()):ee.remove()}function Ce(ee){for(var I,Y=Ie(ee.range).createDocumentFragment(),me;I=ee.next();){if(ee.isPartiallySelectedSubtree()?(I=I.cloneNode(!1),me=ee.getSubtreeIterator(),I.appendChild(Ce(me)),me.detach()):ee.remove(),I.nodeType==10)throw new ge("HIERARCHY_REQUEST_ERR");Y.appendChild(I)}return Y}function Fe(ee,I,Y){var me=!!(I&&I.length),Oe,rt=!!Y;me&&(Oe=new RegExp("^("+I.join("|")+")$"));var je=[];return pe(new qe(ee,!1),function(Qe){if(!(me&&!Oe.test(Qe.nodeType))&&!(rt&&!Y(Qe))){var ft=ee.startContainer;if(!(Qe==ft&&_e(ft)&&ee.startOffset==ft.length)){var Ot=ee.endContainer;Qe==Ot&&_e(Ot)&&ee.endOffset==0||je.push(Qe)}}}),je}function Ue(ee){var I=typeof ee.getName>"u"?"Range":ee.getName();return"["+I+"("+ce.inspectNode(ee.startContainer)+":"+ee.startOffset+", "+ce.inspectNode(ee.endContainer)+":"+ee.endOffset+")]"}function qe(ee,I){if(this.range=ee,this.clonePartiallySelectedTextNodes=I,!ee.collapsed){this.sc=ee.startContainer,this.so=ee.startOffset,this.ec=ee.endContainer,this.eo=ee.endOffset;var Y=ee.commonAncestorContainer;this.sc===this.ec&&_e(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===Y&&!_e(this.sc)?this.sc.childNodes[this.so]:Me(this.sc,Y,!0),this._last=this.ec===Y&&!_e(this.ec)?this.ec.childNodes[this.eo-1]:Me(this.ec,Y,!0))}}qe.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var ee=this._current=this._next;return ee&&(this._next=ee!==this._last?ee.nextSibling:null,_e(ee)&&this.clonePartiallySelectedTextNodes&&(ee===this.ec&&(ee=ee.cloneNode(!0)).deleteData(this.eo,ee.length-this.eo),this._current===this.sc&&(ee=ee.cloneNode(!0)).deleteData(0,this.so))),ee},remove:function(){var ee=this._current,I,Y;_e(ee)&&(ee===this.sc||ee===this.ec)?(I=ee===this.sc?this.so:0,Y=ee===this.ec?this.eo:ee.length,I!=Y&&ee.deleteData(I,Y-I)):ee.parentNode&&fe(ee)},isPartiallySelectedSubtree:function(){var ee=this._current;return Le(ee,this.range)},getSubtreeIterator:function(){var ee;if(this.isSingleCharacterDataNode)ee=this.range.cloneRange(),ee.collapse(!1);else{ee=new Dn(Ie(this.range));var I=this._current,Y=I,me=0,Oe=I,rt=z(I);tt(I,this.sc)&&(Y=this.sc,me=this.so),tt(I,this.ec)&&(Oe=this.ec,rt=this.eo),Zt(ee,Y,me,Oe,rt)}return new qe(ee,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var at=[1,3,4,5,7,8,10],bt=[2,9,11],Xt=[5,6,10,12],Ft=[1,3,4,5,7,8,10,11],pn=[1,3,4,5,7,8];function gn(ee){return function(I,Y){for(var me,Oe=Y?I:I.parentNode;Oe;){if(me=Oe.nodeType,ne(ee,me))return Oe;Oe=Oe.parentNode}return null}}var Rt=gn([9,11]),Se=gn(Xt),Ye=gn([6,10,12]),be=gn([1]);function Be(ee,I){if(Ye(ee,I))throw new ge("INVALID_NODE_TYPE_ERR")}function Ke(ee,I){if(!ne(I,ee.nodeType))throw new ge("INVALID_NODE_TYPE_ERR")}function ze(ee,I){if(I<0||I>(_e(ee)?ee.length:ee.childNodes.length))throw new ge("INDEX_SIZE_ERR")}function ht(ee,I){if(Rt(ee,!0)!==Rt(I,!0))throw new ge("WRONG_DOCUMENT_ERR")}function dt(ee){if(Se(ee,!0))throw new ge("NO_MODIFICATION_ALLOWED_ERR")}function Ut(ee,I){if(!ee)throw new ge(I)}function bn(ee,I){return I<=(_e(ee)?ee.length:ee.childNodes.length)}function En(ee){return!!ee.startContainer&&!!ee.endContainer&&!(Ee&&(ce.isBrokenNode(ee.startContainer)||ce.isBrokenNode(ee.endContainer)))&&se(ee.startContainer)==se(ee.endContainer)&&bn(ee.startContainer,ee.startOffset)&&bn(ee.endContainer,ee.endOffset)}function qt(ee){if(!En(ee))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+ee.inspect()+")")}var Hn=document.createElement("style"),Mn=!1;try{Hn.innerHTML="<b>x</b>",Mn=Hn.firstChild.nodeType==3}catch{}q.features.htmlParsingConforms=Mn;var bo=Mn?function(ee){var I=this.startContainer,Y=ke(I);if(!I)throw new ge("INVALID_STATE_ERR");var me=null;return I.nodeType==1?me=I:_e(I)&&(me=ce.parentElement(I)),me===null||me.nodeName=="HTML"&&ce.isHtmlNamespace(ke(me).documentElement)&&ce.isHtmlNamespace(me)?me=Y.createElement("body"):me=me.cloneNode(!1),me.innerHTML=ee,ce.fragmentFromNodeChildren(me)}:function(ee){var I=Ie(this),Y=I.createElement("body");return Y.innerHTML=ee,ce.fragmentFromNodeChildren(Y)};function ki(ee,I){qt(ee);var Y=ee.startContainer,me=ee.startOffset,Oe=ee.endContainer,rt=ee.endOffset,je=Y===Oe;_e(Oe)&&rt>0&&rt<Oe.length&&De(Oe,rt,I),_e(Y)&&me>0&&me<Y.length&&(Y=De(Y,me,I),je?(rt-=me,Oe=Y):Oe==Y.parentNode&&rt>=st(Y)&&rt++,me=0),ee.setStartAndEnd(Y,me,Oe,rt)}function kt(ee){qt(ee);var I=ee.commonAncestorContainer.parentNode.cloneNode(!1);return I.appendChild(ee.cloneContents()),I.innerHTML}var Vi=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Ei=0,xo=1,ro=2,so=3,Di=0,Hi=1,fr=2,jo=3;ve.extend(q.rangePrototype,{compareBoundaryPoints:function(ee,I){qt(this),ht(this.startContainer,I.startContainer);var Y,me,Oe,rt,je=ee==so||ee==Ei?"start":"end",Qe=ee==xo||ee==Ei?"start":"end";return Y=this[je+"Container"],me=this[je+"Offset"],Oe=I[Qe+"Container"],rt=I[Qe+"Offset"],he(Y,me,Oe,rt)},insertNode:function(ee){if(qt(this),Ke(ee,Ft),dt(this.startContainer),tt(ee,this.startContainer))throw new ge("HIERARCHY_REQUEST_ERR");var I=We(ee,this.startContainer,this.startOffset);this.setStartBefore(I)},cloneContents:function(){qt(this);var ee,I;if(this.collapsed)return Ie(this).createDocumentFragment();if(this.startContainer===this.endContainer&&_e(this.startContainer))return ee=this.startContainer.cloneNode(!0),ee.data=ee.data.slice(this.startOffset,this.endOffset),I=Ie(this).createDocumentFragment(),I.appendChild(ee),I;var Y=new qe(this,!0);return ee=de(Y),Y.detach(),ee},canSurroundContents:function(){qt(this),dt(this.startContainer),dt(this.endContainer);var ee=new qe(this,!0),I=ee._first&&Le(ee._first,this)||ee._last&&Le(ee._last,this);return ee.detach(),!I},surroundContents:function(ee){if(Ke(ee,pn),!this.canSurroundContents())throw new ge("INVALID_STATE_ERR");var I=this.extractContents();if(ee.hasChildNodes())for(;ee.lastChild;)ee.removeChild(ee.lastChild);We(ee,this.startContainer,this.startOffset),ee.appendChild(I),this.selectNode(ee)},cloneRange:function(){qt(this);for(var ee=new Dn(Ie(this)),I=Vi.length,Y;I--;)Y=Vi[I],ee[Y]=this[Y];return ee},toString:function(){qt(this);var ee=this.startContainer;if(ee===this.endContainer&&_e(ee))return ee.nodeType==3||ee.nodeType==4?ee.data.slice(this.startOffset,this.endOffset):"";var I=[],Y=new qe(this,!0);return pe(Y,function(me){(me.nodeType==3||me.nodeType==4)&&I.push(me.data)}),Y.detach(),I.join("")},compareNode:function(ee){qt(this);var I=ee.parentNode,Y=st(ee);if(!I)throw new ge("NOT_FOUND_ERR");var me=this.comparePoint(I,Y),Oe=this.comparePoint(I,Y+1);return me<0?Oe>0?fr:Di:Oe>0?Hi:jo},comparePoint:function(ee,I){return qt(this),Ut(ee,"HIERARCHY_REQUEST_ERR"),ht(ee,this.startContainer),he(ee,I,this.startContainer,this.startOffset)<0?-1:he(ee,I,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:bo,toHtml:function(){return kt(this)},intersectsNode:function(ee,I){if(qt(this),se(ee)!=Ve(this))return!1;var Y=ee.parentNode,me=st(ee);if(!Y)return!0;var Oe=he(Y,me,this.endContainer,this.endOffset),rt=he(Y,me+1,this.startContainer,this.startOffset);return I?Oe<=0&&rt>=0:Oe<0&&rt>0},isPointInRange:function(ee,I){return qt(this),Ut(ee,"HIERARCHY_REQUEST_ERR"),ht(ee,this.startContainer),he(ee,I,this.startContainer,this.startOffset)>=0&&he(ee,I,this.endContainer,this.endOffset)<=0},intersectsRange:function(ee){return lt(this,ee,!1)},intersectsOrTouchesRange:function(ee){return lt(this,ee,!0)},intersection:function(ee){if(this.intersectsRange(ee)){var I=he(this.startContainer,this.startOffset,ee.startContainer,ee.startOffset),Y=he(this.endContainer,this.endOffset,ee.endContainer,ee.endOffset),me=this.cloneRange();return I==-1&&me.setStart(ee.startContainer,ee.startOffset),Y==1&&me.setEnd(ee.endContainer,ee.endOffset),me}return null},union:function(ee){if(this.intersectsOrTouchesRange(ee)){var I=this.cloneRange();return he(ee.startContainer,ee.startOffset,this.startContainer,this.startOffset)==-1&&I.setStart(ee.startContainer,ee.startOffset),he(ee.endContainer,ee.endOffset,this.endContainer,this.endOffset)==1&&I.setEnd(ee.endContainer,ee.endOffset),I}else throw new ge("Ranges do not intersect")},containsNode:function(ee,I){return I?this.intersectsNode(ee,!1):this.compareNode(ee)==jo},containsNodeContents:function(ee){return this.comparePoint(ee,0)>=0&&this.comparePoint(ee,z(ee))<=0},containsRange:function(ee){var I=this.intersection(ee);return I!==null&&ee.equals(I)},containsNodeText:function(ee){var I=this.cloneRange();I.selectNode(ee);var Y=I.getNodes([3]);if(Y.length>0){I.setStart(Y[0],0);var me=Y.pop();return I.setEnd(me,me.length),this.containsRange(I)}else return this.containsNodeContents(ee)},getNodes:function(ee,I){return qt(this),Fe(this,ee,I)},getDocument:function(){return Ie(this)},collapseBefore:function(ee){this.setEndBefore(ee),this.collapse(!1)},collapseAfter:function(ee){this.setStartAfter(ee),this.collapse(!0)},getBookmark:function(ee){var I=Ie(this),Y=q.createRange(I);ee=ee||ce.getBody(I),Y.selectNodeContents(ee);var me=this.intersection(Y),Oe=0,rt=0;return me&&(Y.setEnd(me.startContainer,me.startOffset),Oe=Y.toString().length,rt=Oe+me.toString().length),{start:Oe,end:rt,containerNode:ee}},moveToBookmark:function(ee){var I=ee.containerNode,Y=0;this.setStart(I,0),this.collapse(!0);for(var me=[I],Oe,rt=!1,je=!1,Qe,ft,Ot;!je&&(Oe=me.pop());)if(Oe.nodeType==3)Qe=Y+Oe.length,!rt&&ee.start>=Y&&ee.start<=Qe&&(this.setStart(Oe,ee.start-Y),rt=!0),rt&&ee.end>=Y&&ee.end<=Qe&&(this.setEnd(Oe,ee.end-Y),je=!0),Y=Qe;else for(Ot=Oe.childNodes,ft=Ot.length;ft--;)me.push(Ot[ft])},getName:function(){return"DomRange"},equals:function(ee){return Dn.rangesEqual(this,ee)},isValid:function(){return En(this)},inspect:function(){return Ue(this)},detach:function(){}});function J(ee){ee.START_TO_START=Ei,ee.START_TO_END=xo,ee.END_TO_END=ro,ee.END_TO_START=so,ee.NODE_BEFORE=Di,ee.NODE_AFTER=Hi,ee.NODE_BEFORE_AND_AFTER=fr,ee.NODE_INSIDE=jo}function we(ee){J(ee),J(ee.prototype)}function Ge(ee,I){return function(){qt(this);var Y=this.startContainer,me=this.startOffset,Oe=this.commonAncestorContainer,rt=new qe(this,!0),je,Qe;Y!==Oe&&(je=Me(Y,Oe,!0),Qe=nt(je),Y=Qe.node,me=Qe.offset),pe(rt,dt),rt.reset();var ft=ee(rt);return rt.detach(),I(this,Y,me,Y,me),ft}}function ct(ee,I){function Y(je,Qe){return function(ft){Ke(ft,at),Ke(se(ft),bt);var Ot=(je?et:nt)(ft);(Qe?me:Oe)(this,Ot.node,Ot.offset)}}function me(je,Qe,ft){var Ot=je.endContainer,Un=je.endOffset;(Qe!==je.startContainer||ft!==je.startOffset)&&((se(Qe)!=se(Ot)||he(Qe,ft,Ot,Un)==1)&&(Ot=Qe,Un=ft),I(je,Qe,ft,Ot,Un))}function Oe(je,Qe,ft){var Ot=je.startContainer,Un=je.startOffset;(Qe!==je.endContainer||ft!==je.endOffset)&&((se(Qe)!=se(Ot)||he(Qe,ft,Ot,Un)==-1)&&(Ot=Qe,Un=ft),I(je,Ot,Un,Qe,ft))}var rt=function(){};rt.prototype=q.rangePrototype,ee.prototype=new rt,ve.extend(ee.prototype,{setStart:function(je,Qe){Be(je,!0),ze(je,Qe),me(this,je,Qe)},setEnd:function(je,Qe){Be(je,!0),ze(je,Qe),Oe(this,je,Qe)},setStartAndEnd:function(){var je=arguments,Qe=je[0],ft=je[1],Ot=Qe,Un=ft;switch(je.length){case 3:Un=je[2];break;case 4:Ot=je[2],Un=je[3];break}Be(Qe,!0),ze(Qe,ft),Be(Ot,!0),ze(Ot,Un),I(this,Qe,ft,Ot,Un)},setBoundary:function(je,Qe,ft){this["set"+(ft?"Start":"End")](je,Qe)},setStartBefore:Y(!0,!0),setStartAfter:Y(!1,!0),setEndBefore:Y(!0,!1),setEndAfter:Y(!1,!1),collapse:function(je){qt(this),je?I(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):I(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(je){Be(je,!0),I(this,je,0,je,z(je))},selectNode:function(je){Be(je,!1),Ke(je,at);var Qe=et(je),ft=nt(je);I(this,Qe.node,Qe.offset,ft.node,ft.offset)},extractContents:Ge(Ce,I),deleteContents:Ge(xe,I),canSurroundContents:function(){qt(this),dt(this.startContainer),dt(this.endContainer);var je=new qe(this,!0),Qe=je._first&&Le(je._first,this)||je._last&&Le(je._last,this);return je.detach(),!Qe},splitBoundaries:function(){ki(this)},splitBoundariesPreservingPositions:function(je){ki(this,je)},normalizeBoundaries:function(){qt(this);var je=this.startContainer,Qe=this.startOffset,ft=this.endContainer,Ot=this.endOffset,Un=function(ao){var si=ao.nextSibling;si&&si.nodeType==ao.nodeType&&(ft=ao,Ot=ao.length,ao.appendData(si.data),fe(si))},Ff=function(ao){var si=ao.previousSibling;if(si&&si.nodeType==ao.nodeType){je=ao;var jm=ao.length;if(Qe=si.length,ao.insertData(0,si.data),fe(si),je==ft)Ot+=Qe,ft=je;else if(ft==ao.parentNode){var jf=st(ao);Ot==jf?(ft=ao,Ot=jm):Ot>jf&&Ot--}}},td=!0,wo;if(_e(ft))Ot==ft.length?Un(ft):Ot==0&&(wo=ft.previousSibling,wo&&wo.nodeType==ft.nodeType&&(Ot=wo.length,je==ft&&(td=!1),wo.appendData(ft.data),fe(ft),ft=wo));else{if(Ot>0){var nd=ft.childNodes[Ot-1];nd&&_e(nd)&&Un(nd)}td=!this.collapsed}if(td){if(_e(je))Qe==0?Ff(je):Qe==je.length&&(wo=je.nextSibling,wo&&wo.nodeType==je.nodeType&&(ft==wo&&(ft=je,Ot+=je.length),je.appendData(wo.data),fe(wo)));else if(Qe<je.childNodes.length){var od=je.childNodes[Qe];od&&_e(od)&&Ff(od)}}else je=ft,Qe=Ot;I(this,je,Qe,ft,Ot)},collapseToPoint:function(je,Qe){Be(je,!0),ze(je,Qe),this.setStartAndEnd(je,Qe)},parentElement:function(){qt(this);var je=this.commonAncestorContainer;return je?be(this.commonAncestorContainer,!0):null}}),we(ee)}function At(ee){ee.collapsed=ee.startContainer===ee.endContainer&&ee.startOffset===ee.endOffset,ee.commonAncestorContainer=ee.collapsed?ee.startContainer:ce.getCommonAncestor(ee.startContainer,ee.endContainer)}function Zt(ee,I,Y,me,Oe){ee.startContainer=I,ee.startOffset=Y,ee.endContainer=me,ee.endOffset=Oe,ee.document=ce.getDocument(I),At(ee)}function Dn(ee){Zt(this,ee,0,ee,0)}ct(Dn,Zt),ve.extend(Dn,{rangeProperties:Vi,RangeIterator:qe,copyComparisonConstants:we,createPrototypeRange:ct,inspect:Ue,toHtml:kt,getRangeDocument:Ie,rangesEqual:function(ee,I){return ee.startContainer===I.startContainer&&ee.startOffset===I.startOffset&&ee.endContainer===I.endContainer&&ee.endOffset===I.endOffset}}),q.DomRange=Dn}),k.createCoreModule("WrappedRange",["DomRange"],function(q,re){var ce,ve,Ne=q.dom,ge=q.util,_e=Ne.DomPosition,st=q.DomRange,tt=Ne.getBody,ke=Ne.getContentDocument,he=Ne.isCharacterDataNode;if(q.features.implementsDomRange&&(function(){var fe,Le=st.rangeProperties;function Ie(Ce){for(var Fe=Le.length,Ue;Fe--;)Ue=Le[Fe],Ce[Ue]=Ce.nativeRange[Ue];Ce.collapsed=Ce.startContainer===Ce.endContainer&&Ce.startOffset===Ce.endOffset}function Ve(Ce,Fe,Ue,qe,at){var bt=Ce.startContainer!==Fe||Ce.startOffset!=Ue,Xt=Ce.endContainer!==qe||Ce.endOffset!=at,Ft=!Ce.equals(Ce.nativeRange);(bt||Xt||Ft)&&(Ce.setEnd(qe,at),Ce.setStart(Fe,Ue))}var et;ce=function(Ce){if(!Ce)throw re.createError("WrappedRange: Range must be specified");this.nativeRange=Ce,Ie(this)},st.createPrototypeRange(ce,Ve),fe=ce.prototype,fe.selectNode=function(Ce){this.nativeRange.selectNode(Ce),Ie(this)},fe.cloneContents=function(){return this.nativeRange.cloneContents()},fe.surroundContents=function(Ce){this.nativeRange.surroundContents(Ce),Ie(this)},fe.collapse=function(Ce){this.nativeRange.collapse(Ce),Ie(this)},fe.cloneRange=function(){return new ce(this.nativeRange.cloneRange())},fe.refresh=function(){Ie(this)},fe.toString=function(){return this.nativeRange.toString()};var nt=document.createTextNode("test");tt(document).appendChild(nt);var We=document.createRange();We.setStart(nt,0),We.setEnd(nt,0);try{We.setStart(nt,1),fe.setStart=function(Ce,Fe){this.nativeRange.setStart(Ce,Fe),Ie(this)},fe.setEnd=function(Ce,Fe){this.nativeRange.setEnd(Ce,Fe),Ie(this)},et=function(Ce){return function(Fe){this.nativeRange[Ce](Fe),Ie(this)}}}catch{fe.setStart=function(Fe,Ue){try{this.nativeRange.setStart(Fe,Ue)}catch{this.nativeRange.setEnd(Fe,Ue),this.nativeRange.setStart(Fe,Ue)}Ie(this)},fe.setEnd=function(Fe,Ue){try{this.nativeRange.setEnd(Fe,Ue)}catch{this.nativeRange.setStart(Fe,Ue),this.nativeRange.setEnd(Fe,Ue)}Ie(this)},et=function(Fe,Ue){return function(qe){try{this.nativeRange[Fe](qe)}catch{this.nativeRange[Ue](qe),this.nativeRange[Fe](qe)}Ie(this)}}}fe.setStartBefore=et("setStartBefore","setEndBefore"),fe.setStartAfter=et("setStartAfter","setEndAfter"),fe.setEndBefore=et("setEndBefore","setStartBefore"),fe.setEndAfter=et("setEndAfter","setStartAfter"),fe.selectNodeContents=function(Ce){this.setStartAndEnd(Ce,0,Ne.getNodeLength(Ce))},We.selectNodeContents(nt),We.setEnd(nt,3);var lt=document.createRange();lt.selectNodeContents(nt),lt.setEnd(nt,4),lt.setStart(nt,2),We.compareBoundaryPoints(We.START_TO_END,lt)==-1&&We.compareBoundaryPoints(We.END_TO_START,lt)==1?fe.compareBoundaryPoints=function(Ce,Fe){return Fe=Fe.nativeRange||Fe,Ce==Fe.START_TO_END?Ce=Fe.END_TO_START:Ce==Fe.END_TO_START&&(Ce=Fe.START_TO_END),this.nativeRange.compareBoundaryPoints(Ce,Fe)}:fe.compareBoundaryPoints=function(Ce,Fe){return this.nativeRange.compareBoundaryPoints(Ce,Fe.nativeRange||Fe)};var de=document.createElement("div");de.innerHTML="123";var pe=de.firstChild,xe=tt(document);xe.appendChild(de),We.setStart(pe,1),We.setEnd(pe,2),We.deleteContents(),pe.data=="13"&&(fe.deleteContents=function(){this.nativeRange.deleteContents(),Ie(this)},fe.extractContents=function(){var Ce=this.nativeRange.extractContents();return Ie(this),Ce}),xe.removeChild(de),xe=null,ge.isHostMethod(We,"createContextualFragment")&&(fe.createContextualFragment=function(Ce){return this.nativeRange.createContextualFragment(Ce)}),tt(document).removeChild(nt),fe.getName=function(){return"WrappedRange"},q.WrappedRange=ce,q.createNativeRange=function(Ce){return Ce=ke(Ce,re,"createNativeRange"),Ce.createRange()}})(),q.features.implementsTextRange){var De=function(fe){var Le=fe.parentElement(),Ie=fe.duplicate();Ie.collapse(!0);var Ve=Ie.parentElement();Ie=fe.duplicate(),Ie.collapse(!1);var et=Ie.parentElement(),nt=Ve==et?Ve:Ne.getCommonAncestor(Ve,et);return nt==Le?nt:Ne.getCommonAncestor(Le,nt)},Me=function(fe){return fe.compareEndPoints("StartToEnd",fe)==0},z=function(fe,Le,Ie,Ve,et){var nt=fe.duplicate();nt.collapse(Ie);var We=nt.parentElement();if(Ne.isOrIsAncestorOf(Le,We)||(We=Le),!We.canHaveHTML){var lt=new _e(We.parentNode,Ne.getNodeIndex(We));return{boundaryPosition:lt,nodeInfo:{nodeIndex:lt.offset,containerElement:lt.node}}}var de=Ne.getDocument(We).createElement("span");de.parentNode&&Ne.removeNode(de);for(var pe,xe=Ie?"StartToStart":"StartToEnd",Ce,Fe,Ue,qe,at=et&&et.containerElement==We?et.nodeIndex:0,bt=We.childNodes.length,Xt=bt,Ft=Xt;Ft==bt?We.appendChild(de):We.insertBefore(de,We.childNodes[Ft]),nt.moveToElementText(de),pe=nt.compareEndPoints(xe,fe),!(pe==0||at==Xt);){if(pe==-1){if(Xt==at+1)break;at=Ft}else Xt=Xt==at+1?at:Ft;Ft=Math.floor((at+Xt)/2),We.removeChild(de)}if(qe=de.nextSibling,pe==-1&&qe&&he(qe)){nt.setEndPoint(Ie?"EndToStart":"EndToEnd",fe);var pn;if(/[\r\n]/.test(qe.data)){var gn=nt.duplicate(),Rt=gn.text.replace(/\r\n/g,"\r").length;for(pn=gn.moveStart("character",Rt);(pe=gn.compareEndPoints("StartToEnd",gn))==-1;)pn++,gn.moveStart("character",1)}else pn=nt.text.length;Ue=new _e(qe,pn)}else Ce=(Ve||!Ie)&&de.previousSibling,Fe=(Ve||Ie)&&de.nextSibling,Fe&&he(Fe)?Ue=new _e(Fe,0):Ce&&he(Ce)?Ue=new _e(Ce,Ce.data.length):Ue=new _e(We,Ne.getNodeIndex(de));return Ne.removeNode(de),{boundaryPosition:Ue,nodeInfo:{nodeIndex:Ft,containerElement:We}}},ne=function(fe,Le){var Ie,Ve,et=fe.offset,nt=Ne.getDocument(fe.node),We,lt,de=tt(nt).createTextRange(),pe=he(fe.node);return pe?(Ie=fe.node,Ve=Ie.parentNode):(lt=fe.node.childNodes,Ie=et<lt.length?lt[et]:null,Ve=fe.node),We=nt.createElement("span"),We.innerHTML="&#feff;",Ie?Ve.insertBefore(We,Ie):Ve.appendChild(We),de.moveToElementText(We),de.collapse(!Le),Ve.removeChild(We),pe&&de[Le?"moveStart":"moveEnd"]("character",et),de};ve=function(fe){this.textRange=fe,this.refresh()},ve.prototype=new st(document),ve.prototype.refresh=function(){var fe,Le,Ie,Ve=De(this.textRange);Me(this.textRange)?Le=fe=z(this.textRange,Ve,!0,!0).boundaryPosition:(Ie=z(this.textRange,Ve,!0,!1),fe=Ie.boundaryPosition,Le=z(this.textRange,Ve,!1,!1,Ie.nodeInfo).boundaryPosition),this.setStart(fe.node,fe.offset),this.setEnd(Le.node,Le.offset)},ve.prototype.getName=function(){return"WrappedTextRange"},st.copyComparisonConstants(ve);var se=function(fe){if(fe.collapsed)return ne(new _e(fe.startContainer,fe.startOffset),!0);var Le=ne(new _e(fe.startContainer,fe.startOffset),!0),Ie=ne(new _e(fe.endContainer,fe.endOffset),!1),Ve=tt(st.getRangeDocument(fe)).createTextRange();return Ve.setEndPoint("StartToStart",Le),Ve.setEndPoint("EndToEnd",Ie),Ve};if(ve.rangeToTextRange=se,ve.prototype.toTextRange=function(){return se(this)},q.WrappedTextRange=ve,!q.features.implementsDomRange||q.config.preferTextRange){var Ee=(function(fe){return fe("return this;")()})(Function);typeof Ee.Range>"u"&&(Ee.Range=ve),q.createNativeRange=function(fe){return fe=ke(fe,re,"createNativeRange"),tt(fe).createTextRange()},q.WrappedRange=ve}}q.createRange=function(fe){return fe=ke(fe,re,"createRange"),new q.WrappedRange(q.createNativeRange(fe))},q.createRangyRange=function(fe){return fe=ke(fe,re,"createRangyRange"),new st(fe)},ge.createAliasForDeprecatedMethod(q,"createIframeRange","createRange"),ge.createAliasForDeprecatedMethod(q,"createIframeRangyRange","createRangyRange"),q.addShimListener(function(fe){var Le=fe.document;typeof Le.createRange>"u"&&(Le.createRange=function(){return q.createRange(Le)}),Le=fe=null})}),k.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(q,re){q.config.checkSelectionRanges=!0;var ce="boolean",ve="number",Ne=q.dom,ge=q.util,_e=ge.isHostMethod,st=q.DomRange,tt=q.WrappedRange,ke=q.DOMException,he=Ne.DomPosition,De,Me,z=q.features,ne="Control",se=Ne.getDocument,Ee=Ne.getBody,fe=st.rangesEqual;function Le(J){return typeof J=="string"?/^backward(s)?$/i.test(J):!!J}function Ie(J,we){if(J){if(Ne.isWindow(J))return J;if(J instanceof qt)return J.win;var Ge=Ne.getContentDocument(J,re,we);return Ne.getWindow(Ge)}else return window}function Ve(J){return Ie(J,"getWinSelection").getSelection()}function et(J){return Ie(J,"getDocSelection").document.selection}function nt(J){var we=!1;return J.anchorNode&&(we=Ne.comparePoints(J.anchorNode,J.anchorOffset,J.focusNode,J.focusOffset)==1),we}var We=_e(window,"getSelection"),lt=ge.isHostObject(document,"selection");z.implementsWinGetSelection=We,z.implementsDocSelection=lt;var de=lt&&(!We||q.config.preferTextRange);if(de)De=et,q.isSelectionValid=function(J){var we=Ie(J,"isSelectionValid").document,Ge=we.selection;return Ge.type!="None"||se(Ge.createRange().parentElement())==we};else if(We)De=Ve,q.isSelectionValid=function(){return!0};else return re.fail("Neither document.selection or window.getSelection() detected."),!1;q.getNativeSelection=De;var pe=De();if(!pe)return re.fail("Native selection was null (possibly issue 138?)"),!1;var xe=q.createNativeRange(document),Ce=Ee(document),Fe=ge.areHostProperties(pe,["anchorNode","focusNode","anchorOffset","focusOffset"]);z.selectionHasAnchorAndFocus=Fe;var Ue=_e(pe,"extend");z.selectionHasExtend=Ue;var qe=_e(pe,"setBaseAndExtent");z.selectionHasSetBaseAndExtent=qe;var at=typeof pe.rangeCount==ve;z.selectionHasRangeCount=at;var bt=!1,Xt=!0,Ft=Ue?function(J,we){var Ge=st.getRangeDocument(we),ct=q.createRange(Ge);ct.collapseToPoint(we.endContainer,we.endOffset),J.addRange(Be(ct)),J.extend(we.startContainer,we.startOffset)}:null;ge.areHostMethods(pe,["addRange","getRangeAt","removeAllRanges"])&&typeof pe.rangeCount==ve&&z.implementsDomRange&&(function(){var J=window.getSelection();if(J){for(var we=J.rangeCount,Ge=we>1,ct=[],At=nt(J),Zt=0;Zt<we;++Zt)ct[Zt]=J.getRangeAt(Zt);var Dn=Ne.createTestElement(document,"",!1),ee=Dn.appendChild(document.createTextNode("   ")),I=document.createRange();if(I.setStart(ee,1),I.collapse(!0),J.removeAllRanges(),J.addRange(I),Xt=J.rangeCount==1,J.removeAllRanges(),!Ge){var Y=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(Y&&parseInt(Y[1])>=36)bt=!1;else{var me=I.cloneRange();I.setStart(ee,0),me.setEnd(ee,3),me.setStart(ee,2),J.addRange(I),J.addRange(me),bt=J.rangeCount==2}}for(Ne.removeNode(Dn),J.removeAllRanges(),Zt=0;Zt<we;++Zt)Zt==0&&At?Ft?Ft(J,ct[Zt]):(q.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),J.addRange(ct[Zt])):J.addRange(ct[Zt])}})(),z.selectionSupportsMultipleRanges=bt,z.collapsedNonEditableSelectionsSupported=Xt;var pn=!1,gn;Ce&&_e(Ce,"createControlRange")&&(gn=Ce.createControlRange(),ge.areHostProperties(gn,["item","add"])&&(pn=!0)),z.implementsControlRange=pn,Fe?Me=function(J){return J.anchorNode===J.focusNode&&J.anchorOffset===J.focusOffset}:Me=function(J){return J.rangeCount?J.getRangeAt(J.rangeCount-1).collapsed:!1};function Rt(J,we,Ge){var ct=Ge?"end":"start",At=Ge?"start":"end";J.anchorNode=we[ct+"Container"],J.anchorOffset=we[ct+"Offset"],J.focusNode=we[At+"Container"],J.focusOffset=we[At+"Offset"]}function Se(J){var we=J.nativeSelection;J.anchorNode=we.anchorNode,J.anchorOffset=we.anchorOffset,J.focusNode=we.focusNode,J.focusOffset=we.focusOffset}function Ye(J){J.anchorNode=J.focusNode=null,J.anchorOffset=J.focusOffset=0,J.rangeCount=0,J.isCollapsed=!0,J._ranges.length=0,be(J)}function be(J){J.type=J.rangeCount==0?"None":Me(J)?"Caret":"Range"}function Be(J){var we;return J instanceof st?(we=q.createNativeRange(J.getDocument()),we.setEnd(J.endContainer,J.endOffset),we.setStart(J.startContainer,J.startOffset)):J instanceof tt?we=J.nativeRange:z.implementsDomRange&&J instanceof Ne.getWindow(J.startContainer).Range&&(we=J),we}function Ke(J){if(!J.length||J[0].nodeType!=1)return!1;for(var we=1,Ge=J.length;we<Ge;++we)if(!Ne.isAncestorOf(J[0],J[we]))return!1;return!0}function ze(J){var we=J.getNodes();if(!Ke(we))throw re.createError("getSingleElementFromRange: range "+J.inspect()+" did not consist of a single element");return we[0]}function ht(J){return!!J&&typeof J.text<"u"}function dt(J,we){var Ge=new tt(we);J._ranges=[Ge],Rt(J,Ge,!1),J.rangeCount=1,J.isCollapsed=Ge.collapsed,be(J)}function Ut(J){if(J._ranges.length=0,J.docSelection.type=="None")Ye(J);else{var we=J.docSelection.createRange();if(ht(we))dt(J,we);else{J.rangeCount=we.length;for(var Ge,ct=se(we.item(0)),At=0;At<J.rangeCount;++At)Ge=q.createRange(ct),Ge.selectNode(we.item(At)),J._ranges.push(Ge);J.isCollapsed=J.rangeCount==1&&J._ranges[0].collapsed,Rt(J,J._ranges[J.rangeCount-1],!1),be(J)}}}function bn(J,we){for(var Ge=J.docSelection.createRange(),ct=ze(we),At=se(Ge.item(0)),Zt=Ee(At).createControlRange(),Dn=0,ee=Ge.length;Dn<ee;++Dn)Zt.add(Ge.item(Dn));try{Zt.add(ct)}catch{throw re.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}Zt.select(),Ut(J)}var En;_e(pe,"getRangeAt")?En=function(J,we){try{return J.getRangeAt(we)}catch{return null}}:Fe&&(En=function(J){var we=se(J.anchorNode),Ge=q.createRange(we);return Ge.setStartAndEnd(J.anchorNode,J.anchorOffset,J.focusNode,J.focusOffset),Ge.collapsed!==this.isCollapsed&&Ge.setStartAndEnd(J.focusNode,J.focusOffset,J.anchorNode,J.anchorOffset),Ge});function qt(J,we,Ge){this.nativeSelection=J,this.docSelection=we,this._ranges=[],this.win=Ge,this.refresh()}qt.prototype=q.selectionPrototype;function Hn(J){J.win=J.anchorNode=J.focusNode=J._ranges=null,J.rangeCount=J.anchorOffset=J.focusOffset=0,J.detached=!0,be(J)}var Mn=[];function bo(J,we){for(var Ge=Mn.length,ct,At;Ge--;)if(ct=Mn[Ge],At=ct.selection,we=="deleteAll")Hn(At);else if(ct.win==J)return we=="delete"?(Mn.splice(Ge,1),!0):At;return we=="deleteAll"&&(Mn.length=0),null}var ki=function(J){if(J&&J instanceof qt)return J.refresh(),J;J=Ie(J,"getNativeSelection");var we=bo(J),Ge=De(J),ct=lt?et(J):null;return we?(we.nativeSelection=Ge,we.docSelection=ct,we.refresh()):(we=new qt(Ge,ct,J),Mn.push({win:J,selection:we})),we};q.getSelection=ki,ge.createAliasForDeprecatedMethod(q,"getIframeSelection","getSelection");var kt=qt.prototype;function Vi(J,we){for(var Ge=se(we[0].startContainer),ct=Ee(Ge).createControlRange(),At=0,Zt,Dn=we.length;At<Dn;++At){Zt=ze(we[At]);try{ct.add(Zt)}catch{throw re.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}ct.select(),Ut(J)}if(!de&&Fe&&ge.areHostMethods(pe,["removeAllRanges","addRange"])){kt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),Ye(this)};var Ei=function(J,we){Ft(J.nativeSelection,we),J.refresh()};at?kt.addRange=function(J,we){if(pn&&lt&&this.docSelection.type==ne)bn(this,J);else if(Le(we)&&Ue)Ei(this,J);else{var Ge;bt?Ge=this.rangeCount:(this.removeAllRanges(),Ge=0);var ct=Be(J).cloneRange();try{this.nativeSelection.addRange(ct)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Ge+1){if(q.config.checkSelectionRanges){var At=En(this.nativeSelection,this.rangeCount-1);At&&!fe(At,J)&&(J=new tt(At))}this._ranges[this.rangeCount-1]=J,Rt(this,J,so(this.nativeSelection)),this.isCollapsed=Me(this),be(this)}else this.refresh()}}:kt.addRange=function(J,we){Le(we)&&Ue?Ei(this,J):(this.nativeSelection.addRange(Be(J)),this.refresh())},kt.setRanges=function(J){if(pn&&lt&&J.length>1)Vi(this,J);else{this.removeAllRanges();for(var we=0,Ge=J.length;we<Ge;++we)this.addRange(J[we])}}}else if(_e(pe,"empty")&&_e(xe,"select")&&pn&&de)kt.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var J;if(this.anchorNode)J=se(this.anchorNode);else if(this.docSelection.type==ne){var we=this.docSelection.createRange();we.length&&(J=se(we.item(0)))}if(J){var Ge=Ee(J).createTextRange();Ge.select(),this.docSelection.empty()}}}catch{}Ye(this)},kt.addRange=function(J){this.docSelection.type==ne?bn(this,J):(q.WrappedTextRange.rangeToTextRange(J).select(),this._ranges[0]=J,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,Rt(this,J,!1),be(this))},kt.setRanges=function(J){this.removeAllRanges();var we=J.length;we>1?Vi(this,J):we&&this.addRange(J[0])};else return re.fail("No means of selecting a Range or TextRange was found"),!1;kt.getRangeAt=function(J){if(J<0||J>=this.rangeCount)throw new ke("INDEX_SIZE_ERR");return this._ranges[J].cloneRange()};var xo;if(de)xo=function(J){var we;q.isSelectionValid(J.win)?we=J.docSelection.createRange():(we=Ee(J.win.document).createTextRange(),we.collapse(!0)),J.docSelection.type==ne?Ut(J):ht(we)?dt(J,we):Ye(J)};else if(_e(pe,"getRangeAt")&&typeof pe.rangeCount==ve)xo=function(J){if(pn&&lt&&J.docSelection.type==ne)Ut(J);else if(J._ranges.length=J.rangeCount=J.nativeSelection.rangeCount,J.rangeCount){for(var we=0,Ge=J.rangeCount;we<Ge;++we)J._ranges[we]=new q.WrappedRange(J.nativeSelection.getRangeAt(we));Rt(J,J._ranges[J.rangeCount-1],so(J.nativeSelection)),J.isCollapsed=Me(J),be(J)}else Ye(J)};else if(Fe&&typeof pe.isCollapsed==ce&&typeof xe.collapsed==ce&&z.implementsDomRange)xo=function(J){var we,Ge=J.nativeSelection;Ge.anchorNode?(we=En(Ge,0),J._ranges=[we],J.rangeCount=1,Se(J),J.isCollapsed=Me(J),be(J)):Ye(J)};else return re.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;kt.refresh=function(J){var we=J?this._ranges.slice(0):null,Ge=this.anchorNode,ct=this.anchorOffset;if(xo(this),J){var At=we.length;if(At!=this._ranges.length||this.anchorNode!=Ge||this.anchorOffset!=ct)return!0;for(;At--;)if(!fe(we[At],this._ranges[At]))return!0;return!1}};var ro=function(J,we){var Ge=J.getAllRanges();J.removeAllRanges();for(var ct=0,At=Ge.length;ct<At;++ct)fe(we,Ge[ct])||J.addRange(Ge[ct]);J.rangeCount||Ye(J)};pn&&lt?kt.removeRange=function(J){if(this.docSelection.type==ne){for(var we=this.docSelection.createRange(),Ge=ze(J),ct=se(we.item(0)),At=Ee(ct).createControlRange(),Zt,Dn=!1,ee=0,I=we.length;ee<I;++ee)Zt=we.item(ee),Zt!==Ge||Dn?At.add(we.item(ee)):Dn=!0;At.select(),Ut(this)}else ro(this,J)}:kt.removeRange=function(J){ro(this,J)};var so;!de&&Fe&&z.implementsDomRange?(so=nt,kt.isBackward=function(){return so(this)}):so=kt.isBackward=function(){return!1},kt.isBackwards=kt.isBackward,kt.toString=function(){for(var J=[],we=0,Ge=this.rangeCount;we<Ge;++we)J[we]=""+this._ranges[we];return J.join("")};function Di(J,we){if(J.win.document!=se(we))throw new ke("WRONG_DOCUMENT_ERR")}function Hi(J,we){if(we<0||we>(Ne.isCharacterDataNode(J)?J.length:J.childNodes.length))throw new ke("INDEX_SIZE_ERR")}kt.collapse=function(J,we){Di(this,J);var Ge=q.createRange(J);Ge.collapseToPoint(J,we),this.setSingleRange(Ge),this.isCollapsed=!0},kt.collapseToStart=function(){if(this.rangeCount){var J=this._ranges[0];this.collapse(J.startContainer,J.startOffset)}else throw new ke("INVALID_STATE_ERR")},kt.collapseToEnd=function(){if(this.rangeCount){var J=this._ranges[this.rangeCount-1];this.collapse(J.endContainer,J.endOffset)}else throw new ke("INVALID_STATE_ERR")},kt.selectAllChildren=function(J){Di(this,J);var we=q.createRange(J);we.selectNodeContents(J),this.setSingleRange(we)},qe?kt.setBaseAndExtent=function(J,we,Ge,ct){this.nativeSelection.setBaseAndExtent(J,we,Ge,ct),this.refresh()}:Ue&&(kt.setBaseAndExtent=function(J,we,Ge,ct){Hi(J,we),Hi(Ge,ct),Di(this,J),Di(this,Ge);var At=q.createRange(node),Zt=Ne.comparePoints(J,we,Ge,ct)==-1;Zt?At.setStartAndEnd(Ge,ct,J,we):At.setStartAndEnd(J,we,Ge,ct),this.setSingleRange(At,Zt)}),kt.deleteFromDocument=function(){if(pn&&lt&&this.docSelection.type==ne){for(var J=this.docSelection.createRange(),we;J.length;)we=J.item(0),J.remove(we),Ne.removeNode(we);this.refresh()}else if(this.rangeCount){var Ge=this.getAllRanges();if(Ge.length){this.removeAllRanges();for(var ct=0,At=Ge.length;ct<At;++ct)Ge[ct].deleteContents();this.addRange(Ge[At-1])}}},kt.eachRange=function(J,we){for(var Ge=0,ct=this._ranges.length;Ge<ct;++Ge)if(J(this.getRangeAt(Ge)))return we},kt.getAllRanges=function(){var J=[];return this.eachRange(function(we){J.push(we)}),J},kt.setSingleRange=function(J,we){this.removeAllRanges(),this.addRange(J,we)},kt.callMethodOnEachRange=function(J,we){var Ge=[];return this.eachRange(function(ct){Ge.push(ct[J].apply(ct,we||[]))}),Ge};function fr(J){return function(we,Ge){var ct;this.rangeCount?(ct=this.getRangeAt(0),ct["set"+(J?"Start":"End")](we,Ge)):(ct=q.createRange(this.win.document),ct.setStartAndEnd(we,Ge)),this.setSingleRange(ct,this.isBackward())}}kt.setStart=fr(!0),kt.setEnd=fr(!1),q.rangePrototype.select=function(J){ki(this.getDocument()).setSingleRange(this,J)},kt.changeEachRange=function(J){var we=[],Ge=this.isBackward();this.eachRange(function(ct){J(ct),we.push(ct)}),this.removeAllRanges(),Ge&&we.length==1?this.addRange(we[0],"backward"):this.setRanges(we)},kt.containsNode=function(J,we){return this.eachRange(function(Ge){return Ge.containsNode(J,we)},!0)||!1},kt.getBookmark=function(J){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[J])}},kt.moveToBookmark=function(J){for(var we=[],Ge=0,ct,At;ct=J.rangeBookmarks[Ge++];)At=q.createRange(this.win),At.moveToBookmark(ct),we.push(At);J.backward?this.setSingleRange(we[0],"backward"):this.setRanges(we)},kt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},kt.restoreRanges=function(J){this.removeAllRanges();for(var we=0,Ge;Ge=J.ranges[we];++we)this.addRange(Ge,J.backward&&we==0)},kt.toHtml=function(){var J=[];return this.eachRange(function(we){J.push(st.toHtml(we))}),J.join("")},z.implementsTextRange&&(kt.getNativeTextRange=function(){var J;if(J=this.docSelection){var we=J.createRange();if(ht(we))return we;throw re.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return q.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw re.createError("getNativeTextRange: selection contains no range")}});function jo(J){var we=[],Ge=new he(J.anchorNode,J.anchorOffset),ct=new he(J.focusNode,J.focusOffset),At=typeof J.getName=="function"?J.getName():"Selection";if(typeof J.rangeCount<"u")for(var Zt=0,Dn=J.rangeCount;Zt<Dn;++Zt)we[Zt]=st.inspect(J.getRangeAt(Zt));return"["+At+"(Ranges: "+we.join(", ")+")(anchor: "+Ge.inspect()+", focus: "+ct.inspect()+"]"}kt.getName=function(){return"WrappedSelection"},kt.inspect=function(){return jo(this)},kt.detach=function(){bo(this.win,"delete"),Hn(this)},qt.detachAll=function(){bo(null,"deleteAll")},qt.inspect=jo,qt.isDirectionBackward=Le,q.Selection=qt,q.selectionPrototype=kt,q.addShimListener(function(J){typeof J.getSelection>"u"&&(J.getSelection=function(){return ki(J)}),J=null})});var le=!1,te=function(q){le||(le=!0,!k.initialized&&k.config.autoInitialize&&T())};return M&&(document.readyState=="complete"?te():(u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",te,!1),B(window,"load",te))),k})})(Id)),Id.exports}var YJ=Em();const jv=Ts(YJ);var Fd={exports:{}},Vv;function KJ(){return Vv||(Vv=1,(function(n,e){(function(t,o){n.exports=t(Em())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(o,i){var r=o.dom,s=r.DomPosition,a=r.arrayContains,l=o.util,u=l.forEach,c="span",f=l.isHostMethod(document,"createElementNS");function p(z,ne){for(var se in z)if(z.hasOwnProperty(se)&&ne(se,z[se])===!1)return!1;return!0}function h(z){return z.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function g(z,ne){return!!z&&new RegExp("(?:^|\\s)"+ne+"(?:\\s|$)").test(z)}function m(z,ne){if(typeof z.classList=="object")return z.classList.contains(ne);var se=typeof z.className=="string",Ee=se?z.className:z.getAttribute("class");return g(Ee,ne)}function _(z,ne){if(typeof z.classList=="object")z.classList.add(ne);else{var se=typeof z.className=="string",Ee=se?z.className:z.getAttribute("class");Ee?g(Ee,ne)||(Ee+=" "+ne):Ee=ne,se?z.className=Ee:z.setAttribute("class",Ee)}}var v=(function(){function z(ne,se,Ee){return se&&Ee?" ":""}return function(ne,se){if(typeof ne.classList=="object")ne.classList.remove(se);else{var Ee=typeof ne.className=="string",fe=Ee?ne.className:ne.getAttribute("class");fe=fe.replace(new RegExp("(^|\\s)"+se+"(\\s|$)"),z),Ee?ne.className=fe:ne.setAttribute("class",fe)}}})();function b(z){var ne=typeof z.className=="string";return ne?z.className:z.getAttribute("class")}function C(z){return z&&z.split(/\s+/).sort().join(" ")}function M(z){return C(b(z))}function O(z,ne){return M(z)==M(ne)}function k(z,ne){for(var se=ne.split(/\s+/),Ee=0,fe=se.length;Ee<fe;++Ee)if(!m(z,h(se[Ee])))return!1;return!0}function E(z){var ne=z.parentNode;return ne&&ne.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(ne.nodeName)}function S(z,ne,se,Ee,fe){var Le=z.node,Ie=z.offset,Ve=Le,et=Ie;Le==Ee&&Ie>fe&&++et,Le==ne&&(Ie==se||Ie==se+1)&&(Ve=Ee,et+=fe-se),Le==ne&&Ie>se+1&&--et,z.node=Ve,z.offset=et}function N(z,ne,se){z.node==ne&&z.offset>se&&--z.offset}function L(z,ne,se,Ee){se==-1&&(se=ne.childNodes.length);var fe=z.parentNode,Le=r.getNodeIndex(z);u(Ee,function(Ie){S(Ie,fe,Le,ne,se)}),ne.childNodes.length==se?ne.appendChild(z):ne.insertBefore(z,ne.childNodes[se])}function $(z,ne){var se=z.parentNode,Ee=r.getNodeIndex(z);u(ne,function(fe){N(fe,se,Ee)}),r.removeNode(z)}function B(z,ne,se,Ee,fe){for(var Le,Ie=[];Le=z.firstChild;)L(Le,ne,se++,fe),Ie.push(Le);return $(z,fe),Ie}function A(z,ne){return B(z,z.parentNode,r.getNodeIndex(z),!0,ne)}function D(z,ne){var se=z.cloneRange();se.selectNodeContents(ne);var Ee=se.intersection(z),fe=Ee?Ee.toString():"";return fe!=""}function T(z){for(var ne=z.getNodes([3]),se=0,Ee;(Ee=ne[se])&&!D(z,Ee);)++se;for(var fe=ne.length-1;(Ee=ne[fe])&&!D(z,Ee);)--fe;return ne.slice(se,fe+1)}function F(z,ne){if(z.attributes.length!=ne.attributes.length)return!1;for(var se=0,Ee=z.attributes.length,fe,Le,Ie;se<Ee;++se)if(fe=z.attributes[se],Ie=fe.name,Ie!="class"&&(Le=ne.attributes.getNamedItem(Ie),fe===null!=(Le===null)||fe.specified!=Le.specified||fe.specified&&fe.nodeValue!==Le.nodeValue))return!1;return!0}function V(z,ne){for(var se=0,Ee=z.attributes.length,fe;se<Ee;++se)if(fe=z.attributes[se].name,!(ne&&a(ne,fe))&&z.attributes[se].specified&&fe!="class")return!0;return!1}var P=r.getComputedStyleProperty,X=(function(){var z=document.createElement("div");return typeof z.isContentEditable=="boolean"?function(ne){return ne&&ne.nodeType==1&&ne.isContentEditable}:function(ne){return!ne||ne.nodeType!=1||ne.contentEditable=="false"?!1:ne.contentEditable=="true"||X(ne.parentNode)}})();function oe(z){var ne;return z&&z.nodeType==1&&((ne=z.parentNode)&&ne.nodeType==9&&ne.designMode=="on"||X(z)&&!X(z.parentNode))}function H(z){return(X(z)||z.nodeType!=1&&X(z.parentNode))&&!oe(z)}var W=/^inline(-block|-table)?$/i;function Z(z){return z&&z.nodeType==1&&!W.test(P(z,"display"))}var le=/[^\r\n\t\f \u200B]/;function te(z){if(z.data.length==0)return!0;if(le.test(z.data))return!1;var ne=P(z.parentNode,"whiteSpace");switch(ne){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(z.data))return!1}return Z(z.previousSibling)||Z(z.nextSibling)}function q(z){var ne=[],se,Ee;for(se=0;Ee=z[se++];)ne.push(new s(Ee.startContainer,Ee.startOffset),new s(Ee.endContainer,Ee.endOffset));return ne}function re(z,ne){for(var se=0,Ee,fe,Le,Ie=z.length;se<Ie;++se)Ee=z[se],fe=ne[se*2],Le=ne[se*2+1],Ee.setStartAndEnd(fe.node,fe.offset,Le.node,Le.offset)}function ce(z,ne){return r.isCharacterDataNode(z)?ne==0?!!z.previousSibling:ne==z.length?!!z.nextSibling:!0:ne>0&&ne<z.childNodes.length}function ve(z,ne,se,Ee){var fe,Le,Ie=se==0;if(r.isAncestorOf(ne,z))return z;if(r.isCharacterDataNode(ne)){var Ve=r.getNodeIndex(ne);if(se==0)se=Ve;else if(se==ne.length)se=Ve+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+se+" in "+ne.data);ne=ne.parentNode}if(ce(ne,se)){fe=ne.cloneNode(!1),Le=ne.parentNode,fe.id&&fe.removeAttribute("id");for(var et,nt=0;et=ne.childNodes[se];)L(et,fe,nt++,Ee);return L(fe,Le,r.getNodeIndex(ne)+1,Ee),ne==z?fe:ve(z,Le,r.getNodeIndex(fe),Ee)}else if(z!=ne){fe=ne.parentNode;var We=r.getNodeIndex(ne);return Ie||We++,ve(z,fe,We,Ee)}return z}function Ne(z,ne){return z.namespaceURI==ne.namespaceURI&&z.tagName.toLowerCase()==ne.tagName.toLowerCase()&&O(z,ne)&&F(z,ne)&&P(z,"display")=="inline"&&P(ne,"display")=="inline"}function ge(z){var ne=z?"nextSibling":"previousSibling";return function(se,Ee){var fe=se.parentNode,Le=se[ne];if(Le){if(Le&&Le.nodeType==3)return Le}else if(Ee&&(Le=fe[ne],Le&&Le.nodeType==1&&Ne(fe,Le))){var Ie=Le[z?"firstChild":"lastChild"];if(Ie&&Ie.nodeType==3)return Ie}return null}}var _e=ge(!1),st=ge(!0);function tt(z){this.isElementMerge=z.nodeType==1,this.textNodes=[];var ne=this.isElementMerge?z.lastChild:z;ne&&(this.textNodes[0]=ne)}tt.prototype={doMerge:function(z){var ne=this.textNodes,se=ne[0];if(ne.length>1){var Ee=r.getNodeIndex(se),fe=[],Le=0,Ie;u(ne,function(Ve,et){Ie=Ve.parentNode,et>0&&(Ie.removeChild(Ve),Ie.hasChildNodes()||r.removeNode(Ie),z&&u(z,function(nt){nt.node==Ve&&(nt.node=se,nt.offset+=Le),nt.node==Ie&&nt.offset>Ee&&(--nt.offset,nt.offset==Ee+1&&et<ne.length-1&&(nt.node=se,nt.offset=Le))})),fe[et]=Ve.data,Le+=Ve.data.length}),se.data=fe.join("")}return se.data},getLength:function(){for(var z=this.textNodes.length,ne=0;z--;)ne+=this.textNodes[z].length;return ne},toString:function(){var z=[];return u(this.textNodes,function(ne,se){z[se]="'"+ne.data+"'"}),"[Merge("+z.join(",")+")]"}};var ke=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],he={};function De(z,ne,se){var Ee,fe,Le,Ie,Ve=this;Ve.cssClass=Ve.className=z;var et=null,nt={};if(typeof ne=="object"&&ne!==null){for(typeof ne.elementTagName<"u"&&(ne.elementTagName=ne.elementTagName.toLowerCase()),se=ne.tagNames,et=ne.elementProperties,nt=ne.elementAttributes,fe=0;Ie=ke[fe++];)ne.hasOwnProperty(Ie)&&(Ve[Ie]=ne[Ie]);Ee=ne.normalize}else Ee=ne;Ve.normalize=typeof Ee>"u"?!0:Ee,Ve.attrExceptions=[];var We=document.createElement(Ve.elementTagName);Ve.elementProperties=Ve.copyPropertiesToElement(et,We,!0),p(nt,function(de,pe){Ve.attrExceptions.push(de),nt[de]=""+pe}),Ve.elementAttributes=nt,Ve.elementSortedClassName=Ve.elementProperties.hasOwnProperty("className")?C(Ve.elementProperties.className+" "+z):z,Ve.applyToAnyTagName=!1;var lt=typeof se;if(lt=="string")se=="*"?Ve.applyToAnyTagName=!0:Ve.tagNames=h(se.toLowerCase()).split(/\s*,\s*/);else if(lt=="object"&&typeof se.length=="number")for(Ve.tagNames=[],fe=0,Le=se.length;fe<Le;++fe)se[fe]=="*"?Ve.applyToAnyTagName=!0:Ve.tagNames.push(se[fe].toLowerCase());else Ve.tagNames=[Ve.elementTagName]}De.prototype={elementTagName:c,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(z,ne,se){var Ee,fe,Le={},Ie,Ve,et,nt;for(var We in z)if(z.hasOwnProperty(We))if(Ve=z[We],et=ne[We],We=="className")_(ne,Ve),_(ne,this.className),ne[We]=C(ne[We]),se&&(Le[We]=Ve);else if(We=="style"){fe=et,se&&(Le[We]=Ie={});for(Ee in z[We])z[We].hasOwnProperty(Ee)&&(fe[Ee]=Ve[Ee],se&&(Ie[Ee]=fe[Ee]));this.attrExceptions.push(We)}else ne[We]=Ve,se&&(Le[We]=ne[We],nt=he.hasOwnProperty(We)?he[We]:We,this.attrExceptions.push(nt));return se?Le:""},copyAttributesToElement:function(z,ne){for(var se in z)z.hasOwnProperty(se)&&!/^class(?:Name)?$/i.test(se)&&ne.setAttribute(se,z[se])},appliesToElement:function(z){return a(this.tagNames,z.tagName.toLowerCase())},getEmptyElements:function(z){var ne=this;return z.getNodes([1],function(se){return ne.appliesToElement(se)&&!se.hasChildNodes()})},hasClass:function(z){return z.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(z))&&m(z,this.className)},getSelfOrAncestorWithClass:function(z){for(;z;){if(this.hasClass(z))return z;z=z.parentNode}return null},isModifiable:function(z){return!this.applyToEditableOnly||H(z)},isIgnorableWhiteSpaceNode:function(z){return this.ignoreWhiteSpace&&z&&z.nodeType==3&&te(z)},postApply:function(z,ne,se,Ee){var fe=z[0],Le=z[z.length-1],Ie=[],Ve,et=fe,nt=Le,We=0,lt=Le.length,de;u(z,function(Fe){de=_e(Fe,!Ee),de?(Ve||(Ve=new tt(de),Ie.push(Ve)),Ve.textNodes.push(Fe),Fe===fe&&(et=Ve.textNodes[0],We=et.length),Fe===Le&&(nt=Ve.textNodes[0],lt=Ve.getLength())):Ve=null});var pe=st(Le,!Ee);if(pe&&(Ve||(Ve=new tt(Le),Ie.push(Ve)),Ve.textNodes.push(pe)),Ie.length){for(var xe=0,Ce=Ie.length;xe<Ce;++xe)Ie[xe].doMerge(se);ne.setStartAndEnd(et,We,nt,lt)}},createContainer:function(z){var ne=r.getDocument(z),se=f&&!r.isHtmlNamespace(z)&&z.namespaceURI?ne.createElementNS(z.namespaceURI,this.elementTagName):ne.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,se,!1),this.copyAttributesToElement(this.elementAttributes,se),_(se,this.className),this.onElementCreate&&this.onElementCreate(se,this),se},elementHasProperties:function(z,ne){var se=this;return p(ne,function(Ee,fe){if(Ee=="className")return k(z,fe);if(typeof fe=="object"){if(!se.elementHasProperties(z[Ee],fe))return!1}else if(z[Ee]!==fe)return!1})},elementHasAttributes:function(z,ne){return p(ne,function(se,Ee){if(z.getAttribute(se)!==Ee)return!1})},applyToTextNode:function(z,ne){if(E(z)){var se=z.parentNode;if(se.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(se)&&this.elementHasProperties(se,this.elementProperties)&&this.elementHasAttributes(se,this.elementAttributes))_(se,this.className);else{var Ee=z.parentNode,fe=this.createContainer(Ee);Ee.insertBefore(fe,z),fe.appendChild(z)}}},isRemovable:function(z){return z.tagName.toLowerCase()==this.elementTagName&&M(z)==this.elementSortedClassName&&this.elementHasProperties(z,this.elementProperties)&&!V(z,this.attrExceptions)&&this.elementHasAttributes(z,this.elementAttributes)&&this.isModifiable(z)},isEmptyContainer:function(z){var ne=z.childNodes.length;return z.nodeType==1&&this.isRemovable(z)&&(ne==0||ne==1&&this.isEmptyContainer(z.firstChild))},removeEmptyContainers:function(z){var ne=this,se=z.getNodes([1],function(Le){return ne.isEmptyContainer(Le)}),Ee=[z],fe=q(Ee);u(se,function(Le){$(Le,fe)}),re(Ee,fe)},undoToTextNode:function(z,ne,se,Ee){if(!ne.containsNode(se)){var fe=ne.cloneRange();fe.selectNode(se),fe.isPointInRange(ne.endContainer,ne.endOffset)&&(ve(se,ne.endContainer,ne.endOffset,Ee),ne.setEndAfter(se)),fe.isPointInRange(ne.startContainer,ne.startOffset)&&(se=ve(se,ne.startContainer,ne.startOffset,Ee))}this.isRemovable(se)?A(se,Ee):v(se,this.className)},splitAncestorWithClass:function(z,ne,se){var Ee=this.getSelfOrAncestorWithClass(z);Ee&&ve(Ee,z,ne,se)},undoToAncestor:function(z,ne){this.isRemovable(z)?A(z,ne):v(z,this.className)},applyToRange:function(z,ne){var se=this;ne=ne||[];var Ee=q(ne||[]);z.splitBoundariesPreservingPositions(Ee),se.removeEmptyElements&&se.removeEmptyContainers(z);var fe=T(z);if(fe.length){u(fe,function(Ve){!se.isIgnorableWhiteSpaceNode(Ve)&&!se.getSelfOrAncestorWithClass(Ve)&&se.isModifiable(Ve)&&se.applyToTextNode(Ve,Ee)});var Le=fe[fe.length-1];z.setStartAndEnd(fe[0],0,Le,Le.length),se.normalize&&se.postApply(fe,z,Ee,!1),re(ne,Ee)}var Ie=se.getEmptyElements(z);u(Ie,function(Ve){_(Ve,se.className)})},applyToRanges:function(z){for(var ne=z.length;ne--;)this.applyToRange(z[ne],z);return z},applyToSelection:function(z){var ne=o.getSelection(z);ne.setRanges(this.applyToRanges(ne.getAllRanges()))},undoToRange:function(z,ne){var se=this;ne=ne||[];var Ee=q(ne);z.splitBoundariesPreservingPositions(Ee),se.removeEmptyElements&&se.removeEmptyContainers(z,Ee);var fe=T(z),Le,Ie,Ve=fe[fe.length-1];if(fe.length){se.splitAncestorWithClass(z.endContainer,z.endOffset,Ee),se.splitAncestorWithClass(z.startContainer,z.startOffset,Ee);for(var et=0,nt=fe.length;et<nt;++et)Le=fe[et],Ie=se.getSelfOrAncestorWithClass(Le),Ie&&se.isModifiable(Le)&&se.undoToAncestor(Ie,Ee);z.setStartAndEnd(fe[0],0,Ve,Ve.length),se.normalize&&se.postApply(fe,z,Ee,!0),re(ne,Ee)}var We=se.getEmptyElements(z);u(We,function(lt){v(lt,se.className)})},undoToRanges:function(z){for(var ne=z.length;ne--;)this.undoToRange(z[ne],z);return z},undoToSelection:function(z){var ne=o.getSelection(z),se=o.getSelection(z).getAllRanges();this.undoToRanges(se),ne.setRanges(se)},isAppliedToRange:function(z){if(z.collapsed||z.toString()=="")return!!this.getSelfOrAncestorWithClass(z.commonAncestorContainer);var ne=z.getNodes([3]);if(ne.length){for(var se=0,Ee;Ee=ne[se++];)if(!this.isIgnorableWhiteSpaceNode(Ee)&&D(z,Ee)&&this.isModifiable(Ee)&&!this.getSelfOrAncestorWithClass(Ee))return!1}return!0},isAppliedToRanges:function(z){var ne=z.length;if(ne==0)return!1;for(;ne--;)if(!this.isAppliedToRange(z[ne]))return!1;return!0},isAppliedToSelection:function(z){var ne=o.getSelection(z);return this.isAppliedToRanges(ne.getAllRanges())},toggleRange:function(z){this.isAppliedToRange(z)?this.undoToRange(z):this.applyToRange(z)},toggleSelection:function(z){this.isAppliedToSelection(z)?this.undoToSelection(z):this.applyToSelection(z)},getElementsWithClassIntersectingRange:function(z){var ne=[],se=this;return z.getNodes([3],function(Ee){var fe=se.getSelfOrAncestorWithClass(Ee);fe&&!a(ne,fe)&&ne.push(fe)}),ne},detach:function(){}};function Me(z,ne,se){return new De(z,ne,se)}De.util={hasClass:m,addClass:_,removeClass:v,getClass:b,hasSameClasses:O,hasAllClasses:k,replaceWithOwnChildren:A,elementsHaveSameNonClassAttributes:F,elementHasNonClassAttributes:V,splitNodeAt:ve,isEditableElement:X,isEditingHost:oe,isEditable:H},o.CssClassApplier=o.ClassApplier=De,o.createClassApplier=Me,l.createAliasForDeprecatedMethod(o,"createCssClassApplier","createClassApplier",i)}),t})})(Fd)),Fd.exports}KJ();var Hv={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},Uv=Nu.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var n=this;jv.init(),Nu.extensions.button.prototype.init.call(this),this.colorPicker=new km({parent:this.button,color:"#000",onDone:function(e){n.coloredText&&n.coloredText.isAppliedToSelection()&&n.coloredText.undoToSelection(),n.coloredText=jv.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),n.coloredText.toggleSelection(),n.base.checkContentChanged(),n.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(n){return n.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),JJ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),ZJ=function(n,e,t,o){var i=arguments.length,r=i<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,o);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(i<3?s(r):i>3?s(e,t,r):s(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},zv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},qv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))};(function(n){JJ(e,n);function e(t){var o=n.call(this,t)||this;o.labelMap=new Map;var i=t.lf,r=t.graphModel;return o.lf=i,o.graphModel=r,o.state={tick:0},o}return e.prototype.componentDidMount=function(){var t=this,o=this.props.graphModel;this.editor=new Nu(".lf-label-editor",ls(Hv,{autoLink:!0,extensions:{colorPicker:new Uv}})),o.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),o.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new Nu(".lf-label-editor",ls(Hv,{autoLink:!0,extensions:{colorPicker:new Uv}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,o=this.props,i=o.lf.extension,r=o.graphModel,s=qv(qv([],zv(r.nodes),!1),zv(r.edges),!1),a=i.label;if(a){var l=[];return Lt(s,function(u){var c,f,p=u.getData(),h=(f=(c=p.properties)===null||c===void 0?void 0:c._label)!==null&&f!==void 0?f:[];Lt(h,function(g){var m=t.labelMap,_=new FJ(g,u,r);m.set(_.id,_),l.push(Re(LJ,{label:_,element:u,graphModel:r},_.id))})}),l}return null},e.prototype.render=function(){return Re("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=ZJ([eo],e),e})(Yt);var QJ=(function(){function n(e){var t=e.lf,o=this;this.lf=t,this.lf.setPatternItems=function(i){o.setPatternItems(i)}}return n.prototype.render=function(e,t){var o=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.panelEl.addEventListener("touchmove",function(i){i.preventDefault()},{passive:!1}),this.shapeList.forEach(function(i){var r;(r=o.panelEl)===null||r===void 0||r.appendChild(o.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},n.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},n.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},n.prototype.createDndItem=function(e){var t=this,o=document.createElement("div");o.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),o.appendChild(i),e.label){var r=document.createElement("div");r.innerText=e.label,r.className="lf-dnd-text",o.appendChild(r)}return e.disabled?(o.classList.add("disabled"),o.onpointerdown=function(){e.callback&&e.callback(t.lf,t.domContainer)},o):(o.onpointerdown=function(s){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer),s.preventDefault()},o.ondblclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:s,data:e})},o.onclick=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:s,data:e})},o.oncontextmenu=function(s){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:s,data:e})},o)},n.pluginName="dndPanel",n})(),eZ=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},tZ=(function(){function n(e){var t=e.lf,o=e.LogicFlow,i=e.options,r=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){r.updateViewPortBounds(),r.isShow&&r.updateViewPort()},this.render=function(a,l){r.container=l,r.lf.on("history:change",function(){r.isShow&&r.setView()}),r.lf.on("graph:transform",function(){r.isShow&&r.setView(!1)})},this.show=function(a,l){r.isShow||(r.initMiniMap(),r.lf.on("graph:resize",r.onGraphResize),r.createMiniMap(a,l),r.setView(!0)),r.isShow=!0},this.hide=function(){r.isShow&&(r.lf.off("graph:resize",r.onGraphResize),r.lfMap.destroy(),r.translateX=0,r.translateY=0,r.removeMiniMap(),r.lf.emit("miniMap:close",{})),r.isShow=!1},this.updatePosition=function(a){if(typeof a=="object")(a.left!==void 0||a.right!==void 0)&&(r.leftPosition=a.left,r.rightPosition=a.right),(a.top!==void 0||a.bottom!==void 0)&&(r.topPosition=a.top,r.bottomPosition=a.bottom);else switch(a){case"left-top":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=0,r.bottomPosition=void 0;break;case"right-top":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=0,r.bottomPosition=void 0;break;case"left-bottom":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=void 0,r.bottomPosition=0;break;case"right-bottom":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=void 0,r.bottomPosition=0;break}r.updateMiniMapPosition()},this.reset=function(){r.lf.resetTranslate(),r.lf.resetZoom()},this.setShowEdge=function(a){r.showEdge!==a&&(r.showEdge=a,r.setView())},this.startDrag=function(a){document.addEventListener("pointermove",r.drag),document.addEventListener("pointerup",r.drop);var l=a.x,u=a.y;r.startPosition={x:l,y:u}},this.drag=function(a){var l=a.x,u=a.y,c=(l-r.startPosition.x)/r.scale,f=(u-r.startPosition.y)/r.scale,p=r.viewPortLeft+c+r.viewPortWidth/r.scale/2,h=r.viewPortTop+f+r.viewPortHeight/r.scale/2;r.startPosition={x:l,y:u},r.lf.focusOn({coordinate:{x:p,y:h}})},this.drop=function(){document.removeEventListener("pointermove",r.drag),document.removeEventListener("pointerup",r.drop)},this.mapClick=function(a){var l=a.offsetX,u=a.offsetY,c=r.translateX+l/r.scale,f=r.translateY+u/r.scale;r.lf.focusOn({coordinate:{x:c,y:f}})},this.lf=t,this.LFCtor=o,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var s={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=s,this.elementAreaBounds=s,this.viewPortBounds=s}return n.prototype.setOption=function(e){var t=e.width,o=t===void 0?150:t,i=e.height,r=i===void 0?220:i,s=e.showEdge,a=s===void 0?!1:s,l=e.isShowHeader,u=l===void 0?!1:l,c=e.isShowCloseIcon,f=c===void 0?!1:c,p=e.leftPosition,h=e.topPosition,g=e.rightPosition,m=g===void 0?0:g,_=e.bottomPosition,v=_===void 0?0:_,b=e.headerTitle,C=b===void 0?"导航":b;this.width=o,this.height=r,this.showEdge=a,this.isShowHeader=u,this.isShowCloseIcon=f,this.leftPosition=p,this.rightPosition=p!==void 0?void 0:m,this.topPosition=h,this.bottomPosition=h!==void 0?void 0:v,this.headerTitle=C},n.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins,isMiniMap:!0}),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},n.prototype.createMiniMap=function(e,t){var o,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(o=this.container)===null||o===void 0||o.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var r=document.createElement("div");r.className="lf-mini-map-header",r.innerText=this.headerTitle,i.appendChild(r);var s=document.createElement("span");s.className="lf-mini-map-close",s.addEventListener("click",this.hide),i.appendChild(s)},n.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},n.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},n.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},n.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},o=e.nodes;o&&o.length>0&&o.forEach(function(i){var r,s,a=i.x,l=i.y,u=(r=i.width)!==null&&r!==void 0?r:200,c=(s=i.height)!==null&&s!==void 0?s:200,f=a-u/2,p=a+u/2,h=l-c/2,g=l+c/2;t.left=Math.min(f,t.left),t.right=Math.max(p,t.right),t.top=Math.min(h,t.top),t.bottom=Math.max(g,t.bottom)}),this.elementAreaBounds=t},n.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,o=e.TRANSLATE_Y,i=e.SCALE_X,r=e.SCALE_Y,s=this.lf.graphModel,a=s.width,l=s.height;this.viewPortBounds={left:-t/i,right:(-t+a)/i,top:-o/r,bottom:(-o+l)/r}},n.prototype.resetData=function(e){var t=e.nodes,o=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&o.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?o:[]}},n.prototype.setView=function(e){var t,o;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),r=this.resetData(i),s=this.lf.viewMap,a=this.lf.graphModel.modelMap,l=this.lfMap.viewMap;try{for(var u=eZ(s.keys()),c=u.next();!c.done;c=u.next()){var f=c.value;l.has(f)||this.lfMap.register({type:f,view:s.get(f),model:a.get(f)})}}catch(N){t={error:N}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(t)throw t.error}}this.lfMap.render(r),this.updateBounds(r)}else this.updateBounds();var p=this.bounds,h=p.left,g=p.top,m=p.right,_=p.bottom,v=m-h,b=_-g,C=this.width/v,M=this.height/b,O=Math.min(C,M);this.scale=O;var k=h-(this.width/O-v)/2,E=g-(this.height/O-b)/2;if(this.lfMap.graphModel.transformModel.translate(-k+this.translateX,-E+this.translateY),this.translateX=k,this.translateY=E,this.miniMapWrap.firstChild){var S=this.miniMapWrap.firstChild.style;S.pointerEvents="none",S.transform="matrix(".concat(O,", 0, 0, ").concat(O,", 0, 0)"),S.transformOrigin="left top",S.height="".concat(this.height/O,"px"),S.width="".concat(this.width/O,"px"),this.updateViewPort()}},n.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),o=t.TRANSLATE_X,i=t.TRANSLATE_Y,r=t.SCALE_X,s=t.SCALE_Y,a=this.lf.graphModel,l=a.width,u=a.height;this.viewPortLeft=-o/r,this.viewPortTop=-i/s,this.viewPortWidth=l/r*this.scale,this.viewPortHeight=u/s*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},n.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.style.touchAction="none",e.addEventListener("pointerdown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},n.prototype.destroy=function(){this.lf.off("graph:resize",this.onGraphResize)},n.pluginName="miniMap",n})(),Gv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Xv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},nZ=(function(){function n(e){var t=e.lf,o=e.options,i=this,r;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.originStatusSaved=!1,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(s){var a=s.e;i.handleMouseDown(a)},this.draw=function(s){if(i.lf.graphModel.editConfigModel.isPinching){i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.cleanupSelectionState();return}var a=i.lf.getPointByClient(s.clientX,s.clientY).domOverlayPosition,l=a.x,u=a.y;if(i.endPoint={x:l,y:u},i.startPoint){var c=i.startPoint,f=c.x,p=c.y,h=f,g=p,m=l-f,_=u-p;l<f&&(h=l,m=f-l),u<p&&(g=u,_=p-u),i.wrapper&&(i.wrapper.style.left="".concat(h,"px"),i.wrapper.style.top="".concat(g,"px"),i.wrapper.style.width="".concat(m,"px"),i.wrapper.style.height="".concat(_,"px"))}},this.drawOff=function(s){if(i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),i.originStatusSaved=!1,i.mouseDownInfo){var a=i.mouseDownInfo,l=a.x,u=a.y,c=a.time,f=Math.abs(s.clientX-l)<5&&Math.abs(s.clientY-u)<5&&Date.now()-c<200;if(f){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var p=Dt(i.startPoint),h=Dt(i.endPoint);if(document.removeEventListener("pointermove",i.draw),i.exclusiveMode||document.removeEventListener("pointerup",i.drawOff),p&&h){var l=p.x,u=p.y,g=h.x,m=h.y,_=[Math.min(l,g),Math.min(u,m)],v=[Math.max(l,g),Math.max(u,m)];if(i.lf.emit("selection:selected-area",{topLeft:_,bottomRight:v}),Math.abs(g-l)<10&&Math.abs(m-u)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var b=i.lf.graphModel.getAreaElement(_,v,i.isWholeEdge,i.isWholeNode,!0),C=i.lf.graphModel,M=C.dynamicGroup,O=C.group,k=[],E=i.lf.getSelectElements(),S=new Set(Xv(Xv([],Gv(E.nodes.map(function($){return $.id})),!1),Gv(E.edges.map(function($){return $.id})),!1));b.forEach(function($){if(O){var B=O.getNodeGroup($.id);if(b.includes(B))return}if(M){var B=M.getGroupByNodeId($.id);if(b.includes(B))return}if(i.exclusiveMode&&S.has($.id)){i.lf.deselectElementById($.id);return}i.lf.selectElementById($.id,!0),k.push($)}),i.startPoint=void 0,i.endPoint=void 0,k.length>0&&i.lf.emit("selection:drop",{e:s}),i.lf.emit("selection:selected",{elements:k,leftTopPoint:_,rightBottomPoint:v})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(r=o==null?void 0:o.exclusiveMode)!==null&&r!==void 0?r:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(s){i.setExclusiveMode(s)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return n.prototype.render=function(e,t){this.container=t},n.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("pointermove",this.draw),document.removeEventListener("pointerup",this.drawOff)},n.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},n.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.style.touchAction="none",this.container.addEventListener("pointerdown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},n.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("pointerdown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},n.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)&&!this.lf.graphModel.editConfigModel.isPinching){var o=e.button===2;if(!o){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originStatusSaved||(this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.originStatusSaved=!0),this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,r=i.x,s=i.y;this.startPoint={x:r,y:s},this.endPoint={x:r,y:s};var a=document.createElement("div");a.className="lf-selection-select",a.oncontextmenu=function(u){u.preventDefault()},a.style.top="".concat(this.startPoint.y,"px"),a.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(a),this.wrapper=a,document.addEventListener("pointermove",this.draw),document.addEventListener("pointerup",this.drawOff)}}},n.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},n.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},n.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=Dt(this.endPoint),t=new PointerEvent("pointerup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},n.prototype.open=function(){this.disabled=!1},n.prototype.close=function(){this.disabled=!0},n.pluginName="selectionSelect",n})();var Dm=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),is=function(){return is=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},is.apply(this,arguments)},_a=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},oZ={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function iZ(n){for(var e=n,t=1;t<e.length-1;){var o=_a(e[t-1],2),i=o[0],r=o[1],s=_a(e[t],2),a=s[0],l=s[1],u=_a(e[t+1],2),c=u[0],f=u[1];i===a&&a===c||r===l&&l===f?e.splice(t,1):t++}return e}function rZ(n,e,t,o){var i=[n[0],n[1]],r=[n[0],n[1]];switch(t){case"tl":return e==="tr"?(i[1]+=o,r[0]+=o):e==="lb"&&(i[0]+=o,r[1]+=o),[i,r];case"tr":return e==="tl"?(i[1]+=o,r[0]-=o):e==="rb"&&(i[0]-=o,r[1]+=o),[i,r];case"bl":return e==="br"?(i[1]-=o,r[0]+=o):e==="lt"&&(i[0]+=o,r[1]-=o),[i,r];case"br":return e==="bl"?(i[1]-=o,r[0]-=o):e==="rt"&&(i[0]-=o,r[1]-=o),[i,r];default:return[]}}function sZ(n,e,t,o){var i,r="",s="";n[0]===e[0]?r=n[1]>e[1]?"t":"b":n[1]===e[1]&&(r=n[0]>e[0]?"l":"r"),e[0]===t[0]?s=e[1]>t[1]?"t":"b":e[1]===t[1]&&(s=e[0]>t[0]?"l":"r");var a=Math.min(Math.hypot(e[0]-n[0],e[1]-n[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,o)||1/5*o,l="".concat(r).concat(s),u=oZ[l]||"-",c="L ".concat(n[0]," ").concat(n[1]);if(u==="-")c+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var f=_a(rZ(e,l,u,a),2),p=f[0],h=f[1];p&&h&&(c+="L ".concat(p[0]," ").concat(p[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(h[0]," ").concat(h[1]),i=_a(h,2),e[0]=i[0],e[1]=i[1])}return c}function aZ(n,e){var t=0,o="";if(n.length===2)o+="M".concat(n[t][0]," ").concat(n[t++][1]," L ").concat(n[t][0]," ").concat(n[t][1]);else{for(o+="M".concat(n[t][0]," ").concat(n[t++][1]);t+1<n.length;){var i=n[t-1],r=n[t],s=n[t+++1];o+=sZ(i,r,s,e)}o+="L ".concat(n[t][0]," ").concat(n[t][1])}return o}(function(n){Dm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,o=t.points,i=t.isAnimation,r=t.arrowConfig,s=t.radius,a=s===void 0?5:s,l=t.getEdgeStyle(),u=t.getEdgeAnimationStyle(),c=iZ(o.split(" ").map(function(h){return h.split(",").map(function(g){return+g})})),f=aZ(c,a),p=is(is(is({style:i?u:{}},l),r),{fill:"none"});return Ze("path",is({d:f},p))},e})(ks);(function(n){Dm(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(Cs);var Am=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Mu=function(){return Mu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Mu.apply(this,arguments)},Wv=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var o=t.call(n),i,r=[],s;try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return r},Yv=function(n,e,t){if(t||arguments.length===2)for(var o=0,i=e.length,r;o<i;o++)(r||!(o in e))&&(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))},lZ=(function(n){Am(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.id,i=t.x,r=t.y,s=t.width,a=t.height,l=t.properties,u=this.props.model.getNodeStyle();return Ze("svg",{x:i-s/2,y:r-a/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[l.labelText?Ze("text",{x:0,y:-5,fontSize:"16px",fill:u.stroke},l.labelText):"",l.disabledDelete?"":Ze("text",{x:l.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:u.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,o)},"x")])},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.id,l=this.props.model.getNodeStyle();return Ze("g",{},[Ze("rect",Mu(Mu({},l),{x:o-r/2,y:i-s/2,width:r,height:s,id:a})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var o=this.props.graphModel;o.deleteNode(t)},e})(fu),uZ=(function(n){Am(e,n);function e(){var t=n.apply(this,Yv([],Wv(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},n.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,o;this.points=[],((o=this.properties)===null||o===void 0?void 0:o.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var o=t.x,i=t.y;this.x=o,this.y=i},e.prototype.updatePointsByNodes=function(t){var o=this,i=[],r=1/0,s=1/0,a=-1/0,l=-1/0;t.forEach(function(u){var c=o.graphModel.getNodeModelById(u);if(c){var f=c.width,p=c.height,h=c.x,g=c.y;r=Math.min(r,h-f/2-o.d),s=Math.min(s,g-p/2-o.d),a=Math.max(a,h+f/2+o.d),l=Math.max(l,g+p/2+o.d)}}),i.push([r,s],[a,s],[a,l],[r,l]),![r,s,a,l].some(function(u){return Math.abs(u)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(a+r)/2,y:(l+s)/2}))},e.prototype.resize=function(t){var o;this.isResize=!0;for(var i=t.width,r=t.height,s={x:i/this.width,y:r/this.height},a=(this.properties.node_selection_ids||[]).slice(),l=[],u=new Set;a.length;){var c=a.shift(),f=(o=this.graphModel.nodesMap[c])===null||o===void 0?void 0:o.model;if(f){if(!Bl(f)){l.push(f);continue}u.has(f.id)||(u.add(f.id),a.push.apply(a,Yv([],Wv(f.properties.node_selection_ids||[]),!1)))}}var p={x:this.x-this.width/2,y:this.y-this.height/2},h=n.prototype.resize.call(this,t),g={x:this.x-this.width/2,y:this.y-this.height/2};return l.forEach(function(m){m.width=m.width*s.x,m.height=m.height*s.y;var _=(m.x-p.x)*s.x+g.x-m.x,v=(m.y-p.y)*s.y+g.y-m.y;m.move(_,v,!0)}),this.isResize=!1,h},e})(lu),qc="node-selection";(function(){function n(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:qc,view:lZ,model:uZ})}return Object.defineProperty(n.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),n.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},n.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},n.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,o=this.lf.getGraphRawData(),i=t.filter(function(r){return r!==e.currentClickNode.id});return o.nodes.find(function(r){if(r.type==="node-selection"){var s=za(r,"properties.node_selection_ids",[]);return i.every(function(a){return s.includes(a)})}return!1})},n.prototype.onNodeChange=function(e,t){var o=e.graphModel.nodes.filter(function(i){if(!Bl(i))return!1;var r=i.properties.node_selection_ids||[];return r.includes(t.id)});Promise.resolve().then(function(){o.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},n.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(o){var i;if(!(!o.e.shiftKey||o.data.type===qc)){t.currentClickNode=o.data;var r=!1;t.selectNodesIds.includes(o.data.id)&&((i=t.lf.getNodeModelById(o.data.id))===null||i===void 0||i.setSelected(!1),r=!0);var s=e.getSelectElements(!0).nodes;t.selectNodes=s,t.selectNodes.length===1?r?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(o,i,r){if(t.onNodeChange(e,o),Bl(o)&&!o.isResize){var s=o.properties.node_selection_ids||[];return e.graphModel.moveNodes(s,i,r,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(o){return Bl(o)||t.onNodeChange(e,o),!0})},n.pluginName="node-selection",n})();var Bl=function(n){return!!(n&&n.type===qc)},dZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Tu=function(){return Tu=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Tu.apply(this,arguments)};(function(n){dZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=t.properties;return Ze("text",{x:o-r/2+5,y:i-s/2+16,fontSize:12,fill:"blue"},a.moreText)},e.prototype.getShape=function(){var t=this.props.model,o=t.x,i=t.y,r=t.width,s=t.height,a=this.props.model.getNodeStyle();return Ze("g",{},[Ze("rect",Tu(Tu({},a),{fill:"#FFFFFF",x:o-r/2,y:i-s/2})),this.getLabelShape()])},e})(Pr);var cZ=Mw();const fZ=Ts(cZ);function pZ(n,e="id",t="parentId",o="children"){const i=[],r=new Map;for(const s of n)r.set(s[e],{...s,[o]:[]});for(const s of n){const a=r.get(s[e]),l=s[t];l!=null&&r.has(l)?r.get(l)[o].push(a):i.push(a)}return i}class Om{constructor({lf:e}){this.lf=e,this.elk=new fZ}async layout(e){const t=JSON.parse(JSON.stringify(e)),{nodes:o,edges:i}=t,r=new Map(o.map(h=>[h.id,h])),s=o.map(h=>{var m;let g={id:h.id,parentId:((m=h.properties)==null?void 0:m.loop_parent_key)||null};return h.children&&h.children.length>0?g.layoutOptions={"elk.padding":"[top=112, right=32, bottom=32, left=32]","elk.nodeSize.constraints":"MINIMUM_SIZE","elk.nodeSize.minimum":"[600, 420]","elk.spacing.nodeNode":100,"elk.layered.spacing.nodeNodeBetweenLayers":120}:(g.width=h.properties.width||420,g.height=h.properties.height||100,g.layoutOptions={"elk.nodeSize.constraints":"FIXED"}),g}),a=new Map;i.forEach(h=>{a.set(h.id,{...h})});const l=pZ(s),u=i.map(h=>({id:h.id,sources:[h.sourceNodeId],targets:[h.targetNodeId]})),c={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"RIGHT","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.nodePlacement.bk.fixedAlignment":"TOP","elk.spacing.nodeNode":200,"elk.layered.spacing.nodeNodeBetweenLayers":200,"elk.layered.considerHierarchy":"true","elk.spacing.componentComponent":80},children:l,edges:u},f=await this.elk.layout(c);function p(h,g=null,m=0,_=0){for(const v of h){const b=r.get(v.id);if(!b)continue;let C,M;g?(C=m+v.x,M=_+v.y):(C=v.x,M=v.y),b.x=C+v.width/2,b.y=M+v.height/2,b.properties||(b.properties={}),b.width=v.width,b.height=v.height,b.properties.width=v.width,b.properties.height=v.height,v.children&&v.children.length>0&&p(v.children,v,C,M)}}p(f.children),i.forEach(h=>{const g=a.get(h.id),m=f.edges.find(_=>_.id===h.id);if(m&&m.sections&&m.sections.length>0){const _=m.sections[0];if(_){g&&(h.sourceAnchorId=g.sourceAnchorId,h.targetAnchorId=g.targetAnchorId),h.startPoint={..._.startPoint},h.endPoint={..._.endPoint};const v=_.startPoint,b=_.endPoint,C=b.x-v.x,M=b.y-v.y;let S=50+Math.sqrt(C*C+M*M)*.3;S=Math.max(10,Math.min(S,100));const $={x:v.x+Math.abs(C)*.3,y:v.y},B={x:b.x-Math.abs(C)*.3,y:b.y};Math.abs(M)>Math.abs(C)?($.x=v.x,$.y=v.y+Math.abs(M)*.3,B.x=b.x,B.y=b.y-Math.abs(M)*.3):($.x=v.x+Math.abs(C)*.3,$.y=v.y,B.x=b.x-Math.abs(C)*.3,B.y=b.y),h.pointsList=[{...v},$,B,{...b}],h.properties||(h.properties={}),h.properties.offset=Math.round(S)}}else if(g&&(h.sourceAnchorId=g.sourceAnchorId,h.targetAnchorId=g.targetAnchorId,h.type=g.type||"custom-bezier-edge",h.startPoint&&h.endPoint&&(!h.pointsList||h.pointsList.length===0))){const _=h.endPoint.x-h.startPoint.x,v=h.endPoint.y-h.startPoint.y;let O=50+Math.sqrt(_*_+v*v)*.3;O=Math.max(10,Math.min(O,100));const S={x:h.startPoint.x+Math.abs(_)*.3,y:h.startPoint.y},N={x:h.endPoint.x-Math.abs(_)*.3,y:h.endPoint.y};Math.abs(v)>Math.abs(_)?(S.x=h.startPoint.x,S.y=h.startPoint.y+Math.abs(v)*.3,N.x=h.endPoint.x,N.y=h.endPoint.y-Math.abs(v)*.3):(S.x=h.startPoint.x+Math.abs(_)*.3,S.y=h.startPoint.y,N.x=h.endPoint.x-Math.abs(_)*.3,N.y=h.endPoint.y),h.pointsList=[{...h.startPoint},S,N,{...h.endPoint}],h.properties||(h.properties={}),h.properties.offset=Math.round(O)}}),this.lf.clearSelectElements(),this.lf.clearData(),this.lf.graphModel.graphDataToModel(t),this.fitView(t.nodes),t.nodes.forEach(h=>{if(h.children&&h.children.length){let g=this.lf.graphModel.getElement(h.id);g&&g.setZIndex(-9999)}})}fitView(e){if(!e||e.length===0){this.lf.resetZoom(),this.lf.resetTranslate();return}const{width:t,height:o}=this.lf.graphModel;let i=1/0,r=1/0,s=-1/0,a=-1/0;e.forEach(g=>{const m=(g.width||g.properties.width)/2,_=(g.height||g.properties.height)/2;i=Math.min(i,g.x-m),r=Math.min(r,g.y-_),s=Math.max(s,g.x+m),a=Math.max(a,g.y+_)});const l=s-i,u=a-r;if(l===0||u===0)return;const c=.1,f=t/(l*(1+c)),p=o/(u*(1+c));let h=Math.min(f,p);h>1?h=1:h<.3&&(h=.3),this.lf.zoom(h),this.lf.translateCenter()}}ai(Om,"pluginName","elk");class Nm{constructor({lf:e}){this.lf=e,this.padding={top:94,right:16,bottom:16,left:16},this.resize_padding=30,this.handleNodeDrag=this.handleNodeDrag.bind(this),e.on("node:drag",this.handleNodeDrag)}handleNodeDrag({data:e}){this.lf.off("node:drag",this.handleNodeDrag);try{const t=this.lf.graphModel.getNodeModelById(e.id);if(!t)return;const{x:o,y:i,width:r,height:s}=t,a=t.getProperties();if(a.loop_parent_key){const l=this.lf.graphModel.getNodeModelById(a.loop_parent_key);if(l){const{x:u,y:c,width:f,height:p}=l,h=o-r/2,g=o+r/2,m=i-s/2,_=i+s/2,v=u-f/2+this.padding.left,b=u+f/2-this.padding.right,C=c-p/2+this.padding.top,M=c+p/2-this.padding.bottom;let O=f,k=p,E=u,S=c,N=!1;if(h<v){const L=v-h+this.resize_padding;O+=L,E-=L/2,N=!0}if(g>b){const L=g-b+this.resize_padding;O+=L,E+=L/2,N=!0}if(m<C){const L=C-m+this.resize_padding;k+=L,S-=L/2,N=!0}if(_>M){const L=_-M+this.resize_padding;k+=L,S+=L/2,N=!0}N&&(l.x=E,l.y=S,l._width=l.width=O,l._height=l.height=k)}}}finally{this.lf.on("node:drag",this.handleNodeDrag)}}}ai(Nm,"pluginName","groupAutoResize");var hZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),Cr=function(){return Cr=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Cr.apply(this,arguments)},vZ=(function(n){hZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,o=t.width,i=t.height,r=t.radius;Qn(o)||(this.width=o),Qn(i)||(this.height=i),Qn(r)||(this.radius=r)},e.prototype.getTextStyle=function(){var t=this.properties,o=t.refX,i=o===void 0?0:o,r=t.refY,s=r===void 0?0:r,a=t.textStyle,l=n.prototype.getTextStyle.call(this);return Cr(Cr(Cr({},l),Dt(a)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(s,")")})},e.prototype.getNodeStyle=function(){var t=n.prototype.getNodeStyle.call(this),o=this.properties.style;return Cr(Cr({},t),Dt(o)||{})},e})(Ra),Mm={};function Wt(n,e){var t=n.type,o=n.component,i=n.effect,r=n.view,s=n.model;if(!t)throw new Error("You should specify type in config");Mm[t]={component:o,effect:i},e.register({type:t,view:r||xZ,model:s||vZ})}var Vs=!1,Es=new Map,Ds=new Map,$u=Je({});function gZ(n,e,t,o,i){Vs&&(i.isMiniMap&&mZ(t,i.flowId),$u[n]=Xm(ug({render:function(){return Tt(ag,{to:t},[Tt(e,{node:o,graph:i})])},provide:function(){return{getNode:function(){return o},getGraph:function(){return i}}}})))}function _Z(n,e){if(Vs&&(delete $u[n],Es.has(e))){var t=Ds.get(e)||[],o=t.indexOf(n);o>-1&&(t.splice(o,1),t.length===0?yZ(e):Ds.set(e,t))}}function Kv(){return Vs}function Tm(){return Vs=!0,ug({props:{flowId:{type:String,required:!0}},setup:function(n){return function(){var e=[];return Object.keys($u).forEach(function(t){if(t.startsWith(n.flowId)){if(Es.has(n.flowId)){var o=Ds.get(n.flowId)||[];o.includes(t)||(o.push(t),Ds.set(n.flowId,o))}e.push($u[t])}}),Tt(ae,{},e.map(function(t){return Tt(t)}))}}})}function mZ(n,e){if(!(!e||!n||!Vs)){var t=Tm();if(!Es.has(e)){var o=document.createElement("div");n.appendChild(o);var i=or(t,{flowId:e});i.mount(o),Es.set(e,i),Ds.set(e,[])}}}function yZ(n){if(!(!n||!Vs)){var e=Es.get(n);e&&(e.unmount(),Es.delete(n),Ds.delete(n))}}var bZ=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}})(),xZ=(function(n){bZ(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){n.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var o=document.createElement("div");o.className="custom-vue-node-content",this.root=o,t.appendChild(o),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var o=this.getComponentContainer(),i=this.props,r=i.model,s=i.graphModel;if(o){var a=Mm[r.type].component;a&&(Kv()?gZ(this.targetId(),a,o,r,s):(this.vm=or({render:function(){return Tt(a,{node:r,graph:s})},provide:function(){return{getNode:function(){return r},getGraph:function(){return s}}}}),(t=this.vm)===null||t===void 0||t.mount(o)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){Kv()&&_Z(this.targetId(),this.props.graphModel.flowId),this.unmountVueComponent()},e})(La);const wZ={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},CZ={class:"custom-line-popup"};function SZ(n,e,t,o,i,r){return $i((w(),R("div",CZ,[d("button",{class:"delete-btn",onClick:e[0]||(e[0]=St((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))},"删 除")],512)),[[tr,i.isDeleteConfirmShow]])}const kZ=Te(wZ,[["render",SZ],["__scopeId","data-v-4b6cc0a8"]]),EZ=70,DZ=36;let AZ=class extends ks{constructor(e){super(e),this.isMounted=!1,this.r=Tt(kZ,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=or({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=EZ,customHeight:o=DZ}=e.getProperties(),i=e.id,{startPoint:r,endPoint:s,arrowConfig:a,pointsList:l}=e;let u={x:(r.x+s.x-t)/2,y:(r.y+s.y-o)/2,width:t,height:o};if(l.length>2){let f=Math.round(l.length/2);u.x=l[f-1].x+5,u.y=l[f-1].y}const c={width:t,height:o};return setTimeout(()=>{const f=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(f))},0),Ze("foreignObject",{...u,id:"line_"+i},[Ze("div",{id:i,style:c,className:"vue-app-wrapper"})])}},OZ=class extends Cs{initEdgeData(e){super.initEdgeData(e)}createId(){return Yi("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}};const NZ={type:"custom-edge",view:AZ,model:OZ},MZ={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(n){if(n){const e=this.getGraphModel(),t=this.getModel();if(e.getNodeModelById(t.sourceNodeId).properties.isTriggerNode){this.isDeleteConfirmShow=!1;return}const i=e.getSelectElements(!0);i.nodes.length===0&&i.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const n=this.getGraphModel(),e=this.getModel();n.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},TZ={class:"custom-line-popup"};function $Z(n,e,t,o,i,r){return $i((w(),R("div",TZ,[d("div",{class:"minus-circle-outlined",onClick:e[0]||(e[0]=St((...s)=>r.handleDelete&&r.handleDelete(...s),["stop"]))})],512)),[[tr,i.isDeleteConfirmShow]])}const PZ=Te(MZ,[["render",$Z],["__scopeId","data-v-8519e918"]]);class RZ extends Lc{constructor(e){super(e),this.isMounted=!1,this.r=Tt(PZ,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=or({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:e}=this.props,{stroke:t,strokeWidth:o}=e.getArrowStyle();return Ze("path",{stroke:t,strokeWidth:o,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:e}=this.props,{startPoint:t,endPoint:o,pointsList:i}=e,r=e.id,s=24,a=24,l=s/2,u=a/2,c=v=>{const{x:b,y:C}=t,{x:M,y:O}=i[1],{x:k,y:E}=i[2],{x:S,y:N}=o,L=v*v,$=L*v,B=1-v,A=B*B,D=A*B;return{x:b*D+3*M*A*v+3*k*B*L+S*$,y:C*D+3*O*A*v+3*E*B*L+N*$}},f=(v=5)=>{let b=0,C=c(0);for(let M=1;M<=v;M++){const O=M/v,k=c(O),E=k.x-C.x,S=k.y-C.y;b+=Math.sqrt(E*E+S*S),C=k}return b},p=v=>{const b=v/2;let C=0,M=1,O=.5,k=1e-4;for(;M-C>k;)O=(C+M)/2,E(O)<b?C=O:M=O;function E(S){let N=0,L=c(0);const $=5;for(let B=1;B<=$;B++){const A=B/$*S,D=c(A),T=D.x-L.x,F=D.y-L.y;N+=Math.sqrt(T*T+F*F),L=D}return N}return c(O)},h=f(),g=p(h),m={x:g.x-l,y:g.y-u,width:s,height:a},_={width:s,height:a};return setTimeout(()=>{var b,C;const v=(b=document.querySelector(`#line_${r}`))==null?void 0:b.querySelector(".vue-app-wrapper");!this.isMounted&&v?(this.isMounted=!0,this.app.mount(v)):(C=this.r)!=null&&C.component&&(this.r.component.props.isSelected=e.isSelected,this.r.component.props.isHovered=e.isHovered,this.r.component.props.properties=e.getProperties())},0),Ze("foreignObject",{...m,id:`line_${r}`},[Ze("div",{id:r,style:_,className:"vue-app-wrapper"})])}}class BZ extends wc{initEdgeData(e){super.initEdgeData(e)}setAttributes(e){super.setAttributes(e);let t=this.getProperties().offset;t&&(this.offset=t,this.pointsList=[],this.initPoints())}createId(){return Yi("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#37e1ffff":e.stroke="#2475FC",e.strokeWidth=2,e}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(r=>r.id===this.sourceAnchorId),o=this.graphModel.getNodeModelById(this.targetNodeId),i=o==null?void 0:o.getDefaultAnchor().find(r=>r.id===this.targetAnchorId);if(t){const r={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(r)}if(i){const r={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(r)}this.pointsList=[],this.initPoints()}}const LZ={type:"custom-bezier-edge",view:RZ,model:BZ},IZ={name:"QuestionNode",components:{PopupMenu:Iu},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{type:"node",excludedNodeTypes:[],nodeListTabActive:1}},mounted(){this.getGraph().eventCenter.on("custom:showPopupMenu",this.onShowPopupMenu)},methods:{onShowPopupMenu(n){const{type:e,loop_parent_key:t}=n.model.properties;if(t){let o=["custom-group","batch-group","end-node"];this.getGraph().getNodeModelById(t).type=="batch-group"&&o.push("terminate-node"),this.excludedNodeTypes=o}else this.excludedNodeTypes=["explain-node","terminate-node"]},handleAddNode(n){this.$emit("click-item",n)}}};function FZ(n,e,t,o,i,r){const s=Nt("PopupMenu");return w(),Q(s,{onAddNode:r.handleAddNode,type:i.type,excludedNodeTypes:i.excludedNodeTypes,active:i.nodeListTabActive,"onUpdate:active":e[0]||(e[0]=a=>i.nodeListTabActive=a)},null,8,["onAddNode","type","excludedNodeTypes","active"])}const jZ=Te(IZ,[["render",FZ]]),Jv=444,Zv=620;class VZ{constructor({lf:e}){ai(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${Jv}px`,this.__menuDOM.style.height=`${Zv}px`,this.isMounted=!1,this.r=Tt(jZ,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:o})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:o,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=or({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:o,model:i})=>{this._activeData=i,this._activeAnchorData=o,this.createMenu()}),e.on("node:click",({data:o})=>{this.hideMenu()}),e.on("edge:click",({data:o})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,o=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,o])}showMenu(){const[e,t]=this.getContextMenuPosition(),o=this.lf.graphModel.height-64,i=this.lf.graphModel.width-64;this.__menuDOM.style.display="flex";const r=Math.min(525,o-20),s=Jv;let a=e+10;a+s>i&&(a=e-s-20),a<0&&(a=4),this.__menuDOM.style.left=`${a}px`;let l=t;t+r>o?l=t-(t+r-o)-10:l=t-10,l<0&&(l=4),this.__menuDOM.style.top=`${l}px`,this.__menuDOM.style.height=`${r>0?r:Zv}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class $m{constructor({lf:e}){ai(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:o,metaKey:i}=e,r=t||i;if(r&&o.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(r&&(o.toLowerCase()==="y"||o.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let o=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:o||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),e.nodes.forEach(t=>{t.width=t.properties.width,t.height=t.properties.height}),this.lf.graphModel.graphDataToModel({nodes:e.nodes||[],edges:e.edges||[]}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let o=e;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return!0;o=o.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,o){this.maxHistorySize=o&&o.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),o=this.redoStack.map((r,s)=>({index:s,timestamp:r.timestamp,operation:r.operation,nodeCount:r.nodes?r.nodes.length:0,edgeCount:r.edges?r.edges.length:0,nodes:r.nodes||[],edges:r.edges||[],selectedElementIds:r.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:o,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}ai($m,"pluginName","canvasHistory");class Pm{constructor({lf:e}){ai(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let o=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*o,100*i):this.lf.translate(100*o,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[o,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]),r=this.lf.getTransform();this.zoom=r.SCALE_X,e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[o,i])}});ai(this,"keydownListener",e=>{var s;const t=(s=e==null?void 0:e.key)==null?void 0:s.toLowerCase(),{graphModel:{eventCenter:o}}=this.lf,i=e.target,r=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!r)return;let a=this.lf.getSelectElements(!0);if(a=JSON.parse(JSON.stringify(a)),a.nodes.length===0)return;a.edges=[];const l=a.nodes.filter(u=>u.type!=="start-node"&&u.type!=="custom-group"&&u.properties.isTriggerNode!=!0);if(l.length>0){this.basePointX=20,this.basePointY=20;let u={x:1/0,y:1/0};l.forEach(c=>{c.id="",c.nodeSortKey="",c.properties.id="",c.properties.next_node_key="",c.properties.nodeSortKey="",c.properties.node_key="",!c.width&&c.properties.width&&(c.width=c.properties.width),!c.height&&c.properties.height&&(c.height=c.properties.height),c.x<u.x&&(u.x=c.x),c.y<u.y&&(u.y=c.y)}),this.clipboard={nodes:l,basePoint:u}}else this.clipboard=null;return}if(t==="v"){if(!r||!this.clipboard||this.clipboard.nodes.length===0)return;if(this.clipboard&&this.clipboard.nodes.length>0){const a={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};o.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:a}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&r){o.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});ai(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}ai(Pm,"pluginName","custom-keyboard");function Rm(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=Rm(f.children,f)),f})}class tn extends La{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=Tt(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=or({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let o=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:o},t.model.width=i,t.model.height=o,t.model._width=i,t.model._height=o,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:o=>{t.model.properties.anchorList=o},setData:o=>{o.dataRaw=o.node_params,Pt(()=>{t.model.properties={...t.model.properties,...o};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model.height=i||o.height||t.model.properties.height,t.model._height=i||o.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:o=>{t.model.properties.node_name=o,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:o,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(g=>g.sourceAnchorId),i=t.map(g=>g.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:g=>{g.stopPropagation();const{graphModel:m,model:_}=this.props;l==="right"&&!r&&m.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:_})}},c,f,p)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class nn extends Ra{createId(){return Yi(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(r=>r.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let o=JSON.parse(t.properties.node_params);return{sys_global:o.start.sys_global,diy_global:o.start.diy_global,all_global:[...o.start.sys_global,...o.start.diy_global]}}getAllParentVariable(){var l,u,c;const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(f=>f.type==="start-node");r&&(t.add(r.id),e.push(r));const s=f=>{var p;for(let h=0;h<f.length;h++){let m=f[h].sourceNode;if(!t.has(m.id)){if(t.add(m.id),ds.includes(m.type))if(m.type==="zm-plugins-node"){let _=Po(m.properties.node_params);(cw.includes(_.plugin.name)||(p=_.plugin)!=null&&p.output_obj.length)&&e.push(m)}else e.push(m);s(m.incoming.edges)}}};s(o);let a=[];if(this.properties.loop_parent_key){let f=i.find(p=>p.id==this.properties.loop_parent_key);f&&(e.filter(h=>h.id==this.properties.loop_parent_key).length>0||e.push(f))}for(const f of e){if(!ds.includes(f.type))continue;let p=JSON.parse(f.properties.node_params),h={label:f.properties.node_name,value:f.id,node_id:f.id,node_type:f.properties.node_type,typ:"node",children:[],loop_parent_key:f.properties.loop_parent_key};if(f.type==="http-node"&&(h.children=p.curl.output),f.type==="zm-workflow-node"&&(h.children=p.workflow.output),f.type==="voice-synthesis-node"&&(h.children=p.text_to_audio.output),f.type==="voice-clone-node"&&(h.children=p.voice_clone.output),f.type==="zm-plugins-node"&&(h.children=p.plugin.output||p.plugin.output_obj),f.type==="code-run-node"&&(h.children=p.code_run.output),f.type==="parameter-extraction-node"&&(h.children=p.params_extractor.output),f.type==="start-node"&&(h.children=[...p.start.diy_global,...p.start.sys_global]),f.type==="custom-group"&&(this.properties.loop_parent_key==f.id?h.children=[...((l=p.loop)==null?void 0:l.intermediate_params)||[],...((u=p.loop)==null?void 0:u.loop_arrays)||[]]:h.children=p.loop.output),f.type==="batch-group"&&(this.properties.loop_parent_key==f.id?h.children=[...((c=p.batch)==null?void 0:c.batch_arrays)||[]]:h.children=p.batch.output),f.type==="import-library-node"&&(h.children=p.library_import.outputs),f.type==="json-node"&&(h.children=p.json_encode.output),f.type==="json-reverse-node"&&(h.children=p.json_decode.output),f.type==="select-data-node"&&(h.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),f.type==="knowledge-base-node"&&(h.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),f.type==="ai-dialogue-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),f.type==="specify-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),f.type==="immediately-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),f.type==="problem-optimization-node"&&(h.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),f.type==="mcp-node"&&(h.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),f.type==="image-generation-node"){let g=p.image_generation.image_num;if(g>0){let m=[];for(let _=0;_<+g;_++){let v=String.fromCharCode(97+_);m.push({key:`picture_url_${v}`,typ:"string",name:`picture_url_${v}`,label:`picture_url_${v}`})}h.children=m}}h.children=Array.isArray(h.children)?h.children:[],h.children.forEach(g=>{g.node_id=f.id,g.node_name=f.properties.node_name,g.node_type=f.properties.node_type}),h.children=Rm(h.children,null),a.push(h)}return a}getTriggerNodes(){const{nodes:e}=this.graphModel;return e.filter(o=>o.properties.isTriggerNode)}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const If="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",HZ={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[],node_header_bg_color:""}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(n){this.isShowMenu=!1,this.$emit("handleMenu",n)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){this.isShowMenu=!1;let n=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",n)},documentClick(n){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(n.target)&&n.target!==this.$el.querySelector(".node-menu-btn")&&n.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return Lu(this.node_type)},updateTitle(n){this.setTitle(n)}}},UZ=["data-node-name","data-node-type"],zZ={class:"node-header-left"},qZ={key:0,class:"node-icon"},GZ=["src"],XZ={class:"node-title"},WZ={key:0,class:"node-menu-wrapper"},YZ={class:"node-menus"},KZ=["onClick"],JZ={class:"node-body"};function ZZ(n,e,t,o,i,r){return w(),R("div",{class:Ct(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[d("div",{class:Ct(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[d("div",{class:"node-header",style:In({background:t.properties.node_header_bg_color||"none"})},[d("div",zZ,[t.iconUrl||t.iconName?(w(),R("span",qZ,[d("img",{src:t.iconUrl||r.getImgUrl(t.iconName),alt:""},null,8,GZ)])):ie("",!0),d("span",XZ,j(t.title),1)]),d("div",null,[t.hideMenus?ie("",!0):(w(),R("div",WZ,[d("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=St((...s)=>r.showMenu&&r.showMenu(...s),["stop"]))},[...e[2]||(e[2]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])]),$i(d("div",YZ,[(w(!0),R(ae,null,ye(r.allMenus,s=>(w(),R("div",{class:"node-menu",key:s.key,onClick:St(a=>r.handleMenu(s),["stop"])},j(s.name),9,KZ))),128)),d("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=St(s=>r.handleDelete(n.item),["stop"]))},"删除")],512),[[tr,i.isShowMenu]])]))])],4),d("div",JZ,[gi(n.$slots,"default",{},void 0,!0)])],2)],10,UZ)}const on=Te(HZ,[["render",ZZ],["__scopeId","data-v-9e6fff32"]]),QZ={name:"StartNode",components:{NodeCommon:on},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{outputs:[],show:!1}},computed:{options(){return[...this.outputs]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.outputs=n.trigger.outputs,this.$nextTick(()=>{this.resetSize()})}}},eQ={class:"start-node"},tQ={class:"start-node-options"},nQ={class:"options-list"},oQ={class:"option-label"},iQ={class:"option-type"};function rQ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-url":t.properties.node_icon,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",eQ,[d("div",tQ,[e[0]||(e[0]=d("div",{class:"options-title"},"输出",-1)),d("div",nQ,[(w(!0),R(ae,null,ye(r.options,a=>(w(),R("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",oQ,j(a.key),1),d("div",iQ,j(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}const sQ=Te(QZ,[["render",rQ],["__scopeId","data-v-b11bcdb2"]]);let aQ=class extends tn{constructor(e){super(e),this.renderVue(sQ,e)}},lQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const uQ={type:"session-trigger-node",model:lQ,view:aQ},dQ={name:"StartNode",components:{NodeCommon:on},inject:["resetSize","setData","getGraph","getNode"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],trigger_list:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(n,e){const t=n.node_params||"{}",o=e.node_params||"{}";t!=o&&this.reset()},deep:!0}},mounted(){this.reset();const n=this.getGraph();n.eventCenter.on("custom:trigger-add",this.onTriggerAdd),n.eventCenter.on("custom:trigger-change",this.onTriggerChange)},beforeUnmount(){const n=this.getGraph();n.eventCenter.off("custom:trigger-change",this.onTriggerChange),n.eventCenter.off("custom:trigger-add",this.onTriggerAdd)},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let n=JSON.parse(this.properties.node_params);this.sys_global=n.start.sys_global,this.diy_global=n.start.diy_global,this.trigger_list=n.start.trigger_list,this.$nextTick(()=>{this.resetSize()})},update(){let n=JSON.parse(this.properties.node_params);n.start.sys_global=this.sys_global,n.start.diy_global=this.diy_global,n.start.trigger_list=this.trigger_list,this.setData({node_params:JSON.stringify(n)})},onTriggerAdd(n){const{trigger:e}=JSON.parse(n.properties.node_params);this.trigger_list.push(e);const{outputs:t}=e,o=new Map(this.diy_global.map((i,r)=>[i.key,{item:i,index:r}]));t&&Array.isArray(t)&&t.forEach(i=>{if(o.has(i.key)){const{index:r}=o.get(i.key);this.diy_global[r]=i}else this.diy_global.push(i)}),this.update()},onTriggerChange(n){const t=this.getNode().getTriggerNodes(),o=[];t.forEach(i=>{const s=JSON.parse(i.properties.node_params).trigger||null;s&&(s.trigger_name=i.properties.node_name,o.push(s))}),this.trigger_list=o,this.update()}}},cQ={class:"start-node"},fQ={class:"start-node-options"},pQ={class:"options-list"},hQ={class:"option-label"},vQ={class:"option-type"};function gQ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:x(()=>[d("div",cQ,[d("div",fQ,[e[0]||(e[0]=d("div",{class:"options-title"},"输出",-1)),d("div",pQ,[(w(!0),R(ae,null,ye(r.options,a=>(w(),R("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",hQ,j(a.key),1),d("div",vQ,j(a.typ),1)],2))),128))])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const _Q=Te(dQ,[["render",gQ],["__scopeId","data-v-65229b4e"]]);let mQ=class extends tn{constructor(e){super(e),this.renderVue(_Q,e)}},yQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(r,s,a,l)=>{if(r.id==s.id)return!1;const u=r.graphModel.edges.map(f=>f.sourceAnchorId),c=a.id;return a.type==="right"&&!u.includes(c)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(r,s,a,l)=>r.properties.loop_parent_key?r.properties.loop_parent_key===s.properties.loop_parent_key:!s.properties.loop_parent_key};this.sourceRules=[e,t];const o=["session-trigger-node"],i={message:"只允许连接左边的锚点",validate:(r,s,a,l)=>r.id==s.id?!1:l.type==="left"||o.includes(r.type)};this.targetRules=[i]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+25,id:l+"-anchor_left",type:"anchor_left",isHovered:s,isSelected:a,nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const bQ={type:"start-node",model:yQ,view:mQ},Qa={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(n){const e=n,t=Cg(),{allModelList:o}=Fa(t);let i=Sg(o.value).newList;const r=G(""),s=()=>{if(!e.useModel){r.value="";return}for(const a of i)if(a.children){for(const l of a.children)if(e.useModel==l.name&&e.modelConfigId==a.id){r.value=l.show_model_name||l.deployment_name||l.name;return}}};return gt(()=>[e.useModel,e.modelConfigId],()=>{s()},{immediate:!0}),(a,l)=>(w(),R("span",null,j(r.value),1))}},cr={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(n,{expose:e}){const t=n,o=He("getNode"),i=G([]),r=G("");function s(){let f=o().getAllParentVariable();i.value=a(f)}function a(f){return f.forEach(p=>{p.typ=="node"?p.node_type==1?p.value="global":p.value=p.node_id:p.value=p.key,p.children&&p.children.length>0&&(p.children=a(p.children))}),f}const l=(f,p)=>{for(const h of f){if(h.value===p)return h.label;if(h.children&&h.children.length>0){const g=l(h.children,p);if(g)return g}}return null},u=()=>{if(!t.value||t.value.length===0)return"";s();let f=[];t.value.forEach(p=>{const h=l(i.value,p);h&&f.push(h)}),r.value=f.join("/")},c=()=>{u()};return gt(()=>t.value,()=>{u()},{immediate:!0}),e({refresh:c}),(f,p)=>(w(),R("span",null,j(r.value),1))}},xQ={class:"ai-dialogue-node"},wQ={class:"field-list"},CQ={class:"field-item"},SQ={class:"field-item-content"},kQ={class:"field-value"},EQ={class:"field-key"},DQ={class:"field-item"},AQ={class:"field-item-content"},OQ={class:"field-value"},NQ={class:"field-key"},MQ={class:"field-item"},TQ={class:"field-item-content"},$Q={class:"category-list"},PQ={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=jn(),{modelList:r}=Fa(i),s=G([]),a=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[]});function l(f){if(f&&typeof f=="string"){let p=f.split("."),h=p[0],g=p.filter((m,_)=>_>0).join(".");return[h,g]}else if(f&&typeof f=="object"&&f.length===2)return f;return["global","question"]}const u=()=>{const f=e.properties.dataRaw||e.properties.node_params||"{}";let p={};try{p=JSON.parse(f).cate||{}}catch{p={}}p=JSON.parse(JSON.stringify(p));for(let h in p)if(h==="question_value")a.question_value=l(p.question_value);else if(h=="categorys")if(p.categorys&&p.categorys.length>0){let g=p.categorys.map(m=>({...m}));a[h]=g}else a[h]=[{category:"",next_node_key:"",key:_n(16)}];else a[h]=p[h];!a.model_config_id&&r.value.length>0&&(a.model_config_id=r.value[0].id,a.use_model=r.value[0].children[0].name),Pt(()=>{o()})},c=()=>{const f=a.model_config_id?+a.model_config_id:a.model_config_id,p=JSON.stringify({cate:{...a,question_value:a.question_value.join("."),model_config_id:f}});t({...e.node,...a,node_params:p})};return gt(()=>e.properties,(f,p)=>{const h=f.dataRaw||f.node_params||"{}",g=p.dataRaw||p.node_params||"{}";h!=g&&u()},{deep:!0}),ut(()=>{u(),o(),c()}),no(()=>{}),(f,p)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",xQ,[d("div",wQ,[d("div",CQ,[p[0]||(p[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",SQ,[d("div",kQ,[d("span",EQ,[y(cr,{ref:"questionTextRef",value:a.question_value},null,8,["value"])])])])]),d("div",DQ,[p[1]||(p[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",AQ,[d("div",OQ,[d("span",NQ,[y(Qa,{useModel:a.use_model,modelConfigId:a.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",MQ,[p[3]||(p[3]=d("div",{class:"field-item-label"},"问题分类",-1)),d("div",TQ,[d("div",$Q,[(w(!0),R(ae,null,ye(a.categorys,h=>(w(),R("div",{class:"field-value category-value",key:h.key},[d("span",null,j(h.category),1)]))),128)),p[2]||(p[2]=d("div",{class:"field-value category-value"},[d("span",null,"默认分类")],-1))])])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},RQ=Te(PQ,[["__scopeId","data-v-ee162e6d"]]);let BQ=class extends tn{constructor(e){super(e),this.renderVue(RQ,e)}},LQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getAnchorPos(){return fw(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let u=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}],c=this.getAnchorPos(),f=o-r/2;for(let p=0;p<c.length;p++)u.push({id:c[p].id,x:t+i/2,y:f+132+p*32,type:"right",nodeId:e});return u.push({id:l+"-anchor_right",x:t+i/2,y:r/2+o-28,type:"right",nodeId:e}),u}};const IQ={type:"question-node",model:LQ,view:BQ},FQ={name:"QuestionNode",components:{NodeCommon:on},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},jQ={class:"question-node"},VQ={class:"node-desc"};function HQ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",jQ,[d("div",VQ,j(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const UQ=Te(FQ,[["render",HQ],["__scopeId","data-v-8a22228d"]]);let zQ=class extends tn{constructor(e){super(e),this.renderVue(UQ,e)}},qQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;let u=[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&u.push({x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}),u}};const GQ={type:"action-node",model:qQ,view:zQ},XQ={name:"QuestionNode",components:{NodeCommon:on},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(n){return ty(n)}}},WQ={class:"qa-node"},YQ={key:0,class:"no-data"};function KQ(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",WQ,[t.properties.no_resp_jump_time?ie("",!0):(w(),R("div",YQ,"点击设置消息内容"))])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const JQ=Te(XQ,[["render",KQ],["__scopeId","data-v-c0ad0aea"]]);let ZQ=class extends tn{constructor(e){super(e),this.renderVue(JQ,e)}},QQ=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const eee={type:"qa-node",model:QQ,view:ZQ},tee={class:"ai-dialogue-node"},nee={class:"field-list"},oee={class:"field-item"},iee={class:"field-item-content"},ree={class:"field-value"},see={class:"field-item"},aee={class:"field-item-content"},lee={class:"field-value"},uee={class:"field-key"},dee={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=jn(),{modelList:a}=Fa(s),l=G(null),u=G([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),f=G([]);function p(v){if(v){let b=v.split("."),C=b[0],M=b.filter((O,k)=>k>0).join(".");return[C,M]}return["global","question"]}const h=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(v).llm||{}}catch{b={}}m();const{model_config_id:C,use_model:M,context_pair:O,temperature:k,max_token:E,prompt:S,prompt_tags:N,question_value:L,enable_thinking:$,libs_node_key:B}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=M,c.context_pair=O||0,c.temperature=k,c.max_token=E,c.prompt=S,c.enable_thinking=$,c.prompt_tags=N||[],c.libs_node_key=B,c.question_value=p(L),!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Pt(()=>{r()})},g=()=>{const v=JSON.stringify({llm:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:v})},m=()=>{let v=i().getAllParentVariable();f.value=v},_=v=>{m(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==v.node_id){let C=b.label.split("/");C[0]=v.node_name,b.label=C.join("/"),b.node_name=v.node_name}}),g(),l.value.refresh()};return gt(()=>e.properties,h,{deep:!0}),ut(()=>{h(),r(),o().eventCenter.on("custom:setNodeName",_)}),no(()=>{o().eventCenter.off("custom:setNodeName",_)}),(v,b)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",tee,[d("div",nee,[d("div",oee,[b[0]||(b[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",iee,[d("div",ree,[y(cr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),d("div",see,[b[1]||(b[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",aee,[d("div",lee,[d("span",uee,[y(Qa,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),b[2]||(b[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"输出"),d("div",{class:"field-item-content"},[d("div",{class:"field-value is-required"},[d("span",{class:"field-key"},"AI回复内容"),d("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},cee=Te(dee,[["__scopeId","data-v-8011e2e3"]]);let fee=class extends tn{constructor(e){super(e),this.renderVue(cee,e)}},pee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const hee={type:"ai-dialogue-node",model:pee,view:fee},Bm=n=>{let e=[];return n.forEach(t=>{t.children&&t.children.length>0?e.push(...Bm(t.children)):e.push(t)}),e},vee={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open","resize"],props:{type:{type:String,default:"input",validator(n){return["input","textarea"].includes(n)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(n){n!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(n){this.onOpen(n)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(n){const e=document.createElement("div");e.innerHTML=n;let t="";return Array.from(e.childNodes).forEach(o=>{let i="";this.type==="textarea"?o.nodeName==="BR"?i=`
`:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:i=o.textContent:o.classList&&o.classList.contains("j-mention-at")?i=o.dataset.value:o.nodeName==="BR"?i="":i=o.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let o={};this.selectedList.forEach(r=>{!o[r.value]&&t.indexOf(r.value)!==-1&&(o[r.value]=r)});let i=Object.values(o);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const n=this.$refs.JMention;let e=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],o=Bm(this.options),i=[...t,...o].filter(s=>s&&s.value&&s.value!=""&&s.typ!=="node");const r=new Set;i.forEach(s=>{const a=new RegExp(`(${s.value})`,"g");if(a.test(this.defaultValue)&&!r.has(s.value)){let l=s.node_name+"."+s.text;l=l.replace(/\./g,"/"),e=e.replace(a,`<span class="j-mention-at" data-id="${s.node_id}" contentEditable="false" data-value="${s.value}">${l}</span>`),r.add(s.value),this.selectOption(s,!0)}}),n.innerHTML=e,this.localValue=this.defaultValue,this.$nextTick(()=>{this.$emit("resize")})},initShowOptionList(){this.showOptions=this.options.filter(n=>this.atText?n.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(n.id+""))},getLastChar(n=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),o=t.startOffset,i=t.startContainer;let r="";if(i.nodeType===Node.TEXT_NODE)r=i.textContent.slice(0,o);else if(i.nodeType===Node.ELEMENT_NODE){const s=i.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?r+=l.textContent.slice(0,o):r+=l.textContent)}}return r.slice(-n)},getLastAtText(){const n=window.getSelection();if(n.rangeCount<=0)return;const e=n.getRangeAt(0),t=e.startOffset,o=e.startContainer;let i="";if(o.nodeType===Node.TEXT_NODE)i=o.textContent.slice(0,t);else if(o.nodeType===Node.ELEMENT_NODE){const s=o.childNodes;for(let a=0;a<s.length;a++){const l=s[a];l.nodeType===Node.TEXT_NODE&&(a===s.length-1?i+=l.textContent.slice(0,t):i+=l.textContent)}}const r=i.lastIndexOf("/");return r===-1?"":i.slice(r+1)},async getCaretPosition(){const n=window.getSelection();if(n.rangeCount<=0)return{top:0,left:0};const t=n.getRangeAt(0).getBoundingClientRect(),o=await this.getDropdownListSize();let i=t.bottom,r=t.left;const s=window.innerWidth,a=window.innerHeight;return r+o.width>s&&(r=s-o.width),i+o.height>a&&(i=t.top-o.height),{top:i,left:r,x:r,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const n=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:n,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let o=t.dataset.value;const i=this.options.find(r=>r.value==o);this.selectedList.push(i),this.selectedIdSet.add(o)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(n){return this.options.filter(t=>t.label.startsWith(n)).length>0},updateValue(){this.onChange()},insertAtCaret(n,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const r=i.getRangeAt(0),s=r.startOffset,a=r.startContainer;let l=s-t,u=a;if(l<0){let c=a.previousSibling;for(;c;){if(c.nodeType===Node.TEXT_NODE){l=c.textContent.length-t,u=c;break}c=c.previousSibling}}if(u.nodeType===Node.TEXT_NODE){u.replaceData(l,t," ");const c=document.createElement("span");c.contentEditable="false",c.classList.add("j-mention-at"),c.style=this.atTextStyle,c.textContent=`${n}`;for(const h in e)c.dataset[h]=e[h];const f=document.createRange();f.setStart(u,l),f.insertNode(c);let p=c.nextSibling;r.setStart(p,1),r.setEnd(p,1),i.removeAllRanges(),i.addRange(r)}},onSelectOption(n,e,t){let o=t[t.length-1];delete o.children,this.selectOption(o)},selectOption(n,e=!1){if(!n)return;this.showDropdown=!1,this.showAtList=!1;let t=n.node_name+"."+n.text;t=t.replace(/\./g,"/");const o={id:n.id,label:n.label,value:n.value,text:n.text,index:this.selectedList.length};this.selectedList.push(n),this.selectedIdSet.add(n.value),e||(this.insertAtCaret(t,o),this.initShowOptionList(),this.updateValue())}}};function gee(n,e,t,o,i,r){return w(),R("span",{ref:"JMention",class:Ct(["j-mention",["type-"+t.type]])},null,2)}const yn=Te(vee,[["render",gee]]),_ee={class:"ai-dialogue-node"},mee={class:"field-list"},yee={class:"field-item"},bee={class:"field-item-content"},xee={class:"field-value"},wee={class:"field-key"},Cee={class:"field-type"},See={class:"field-item"},kee={class:"field-item-content"},Eee={class:"field-text"},Dee={class:"right-arrow"},Aee={class:"field-text2"},Oee={class:"field-item"},Nee={class:"field-item-content"},Mee={class:"field-text"},Tee={class:"right-arrow"},$ee={class:"field-text2"},Pee={key:0,class:"field-item"},Ree={class:"field-item-content"},Bee={class:"field-text"},Lee={class:"right-arrow"},Iee={class:"field-text2"},Fee={key:1,class:"field-item"},jee={class:"field-item-content"},Vee={class:"field-list-item"},Hee={class:"field-item"},Uee={class:"field-item-content"},zee={class:"field-key"},qee={class:"field-type"},Gee={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=G([]),a=Je({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[]});function l(m){return m.forEach(_=>{_.cu_key=Math.random()*1e4,_.subs&&_.subs.length?l(_.subs):_.subs=[]}),m}const u=G([]),c=()=>{const m=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(m).curl||{}}catch{_={}}p(),_=JSON.parse(JSON.stringify(_));for(let v in _){if(v=="headers"||v=="params"||v=="body"){_[v]&&_[v].length>0?a[v]=_[v].map(b=>({...b,cu_key:Math.random()*1e4})):a[v]=[];continue}if(v=="output"){a.output=l(_[v]);continue}a[v]=_[v]}Pt(()=>{r()})},f=()=>{const m=JSON.stringify({curl:{...a}});t({...e.node,...a,node_params:m})},p=()=>{let m=i().getAllParentVariable();m.forEach(_=>{_.tags=_.tags||[]}),u.value=m},h=m=>{yo.includes(m.node_type)&&(p(),Pt(()=>{a.body_raw_tags&&a.body_raw_tags.length>0&&a.body_raw_tags.forEach(v=>{if(v.node_id==m.node_id){let b=v.label.split("/");b[0]=m.node_name,v.label=b.join("/"),v.node_name=m.node_name}}),["headers","params","body"].forEach(v=>{a[v].forEach(C=>{C.tags&&C.tags.length>0&&C.tags.forEach(M=>{if(M.node_id==m.node_id){let O=M.label.split("/");O[0]=m.node_name,M.label=O.join("/"),M.node_name=m.node_name}})})}),f()}))},g=()=>{};return gt(()=>e.properties,c,{deep:!0}),ut(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",h)}),no(()=>{o().eventCenter.off("custom:setNodeName",h)}),(m,_)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:g},{default:x(()=>[d("div",_ee,[d("div",mee,[d("div",yee,[_[0]||(_[0]=d("div",{class:"field-item-label"},"请求地址",-1)),d("div",bee,[d("div",xee,[d("span",wee,j(a.method),1),d("span",Cee,j(a.rawurl),1)])])]),d("div",See,[_[1]||(_[1]=d("div",{class:"field-item-label"},"HEADERS",-1)),d("div",kee,[(w(!0),R(ae,null,ye(a.headers,v=>(w(),R("div",{class:"field-list-item",key:v.cu_key},[d("div",Eee,j(v.key),1),d("div",Dee,[y(K(ta))]),d("div",Aee,[y(yn,{options:u.value,"default-value":v.value,defaultSelectedList:v.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),d("div",Oee,[_[2]||(_[2]=d("div",{class:"field-item-label"},"PARAMS",-1)),d("div",Nee,[(w(!0),R(ae,null,ye(a.params,v=>(w(),R("div",{class:"field-list-item",key:v.cu_key},[d("div",Mee,j(v.key),1),d("div",Tee,[y(K(ta))]),d("div",$ee,[y(yn,{options:u.value,"default-value":v.value,defaultSelectedList:v.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),a.type==1?(w(),R("div",Pee,[_[3]||(_[3]=d("div",{class:"field-item-label"},"BODY",-1)),d("div",Ree,[(w(!0),R(ae,null,ye(a.body,v=>(w(),R("div",{class:"field-list-item",key:v.cu_key},[d("div",Bee,j(v.key),1),d("div",Lee,[y(K(ta))]),d("div",Iee,[y(yn,{options:u.value,"default-value":v.value,defaultSelectedList:v.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):ie("",!0),a.type==2?(w(),R("div",Fee,[_[4]||(_[4]=d("div",{class:"field-item-label"},"BODY",-1)),d("div",jee,[d("div",Vee,j(a.body_raw),1)])])):ie("",!0),d("div",Hee,[_[5]||(_[5]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",Uee,[(w(!0),R(ae,null,ye(a.output,v=>(w(),R("div",{class:"field-value",key:v.cu_key},[d("span",zee,j(v.key),1),d("span",qee,j(v.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Xee=Te(Gee,[["__scopeId","data-v-75591691"]]);let Wee=class extends tn{constructor(e){super(e),this.renderVue(Xee,e)}},Yee=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+26,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+26,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Kee={type:"http-node",model:Yee,view:Wee},Jee={class:"ai-dialogue-node"},Zee={class:"field-list"},Qee={class:"field-item"},ete={class:"field-item-content"},tte={class:"field-value"},nte={class:"field-item"},ote={class:"field-item-content"},ite={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=jn(),t=Xe(()=>e.robotInfo.rrf_weight),o=n,i=He("setData"),r=He("getGraph"),s=He("getNode"),a=He("resetSize"),l=G(null),u=G([]),c=Je({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[],rrf_weight:{}}),f=G([]);function p(M){if(M){let O=M.split("."),k=O[0],E=O.filter((S,N)=>N>0).join(".");return[k,E]}return["global","question"]}const h=()=>{const M=o.properties.dataRaw||o.properties.node_params||"{}";let O={};try{O=JSON.parse(M).libs||{}}catch{O={}}b(),O=JSON.parse(JSON.stringify(O));for(let k in O)k=="library_ids"?c[k]=O[k]?O[k].split(","):[]:k=="question_value"?c.question_value=p(O.question_value):k=="rrf_weight"?c.rrf_weight=O[k]?JSON.parse(O[k]):O[k]:c[k]=O[k];O.rrf_weight||(c.rrf_weight=t.value),Pt(()=>{a()})},g=()=>{const M=JSON.stringify({libs:{...c,rerank_model_config_id:c.rerank_model_config_id?+c.rerank_model_config_id:void 0,question_value:c.question_value.join("."),library_ids:c.library_ids.join(","),rrf_weight:JSON.stringify(c.rrf_weight)}});i({...o.node,node_params:M})},m=G([]),_=Xe(()=>m.value.filter(M=>c.library_ids.includes(M.id))),v=async()=>{const M=await ja({type:""});M&&(m.value=M.data||[],Pt(()=>{a()}))},b=()=>{let M=s().getAllParentVariable();f.value=M},C=()=>{b(),g(),l.value.refresh()};return gt(()=>o.properties,h,{deep:!0}),ut(()=>{v(),h(),r().eventCenter.on("custom:setNodeName",C)}),no(()=>{r().eventCenter.off("custom:setNodeName",C)}),(M,O)=>(w(),Q(on,{properties:n.properties,title:o.properties.node_name,menus:u.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Jee,[d("div",Zee,[d("div",Qee,[O[0]||(O[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",ete,[d("div",tte,[y(cr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),O[2]||(O[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"输出字段"),d("div",{class:"field-item-content"},[d("div",{class:"field-value is-required"},[d("span",{class:"field-key"},"知识库引用"),d("span",{class:"field-type"},"string")])])],-1)),d("div",nte,[O[1]||(O[1]=d("div",{class:"field-item-label"},"知识库",-1)),d("div",ote,[(w(!0),R(ae,null,ye(_.value,k=>(w(),R("div",{class:"library-item",key:k.id},j(k.library_name),1))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rte=Te(ite,[["__scopeId","data-v-1a259921"]]);let ste=class extends tn{constructor(e){super(e),this.renderVue(rte,e)}},ate=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lte={type:"knowledge-base-node",model:ate,view:ste},ute={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function dte(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[d("div",{class:"end-node"},[d("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const cte=Te(ute,[["render",dte],["__scopeId","data-v-5d6d3499"]]);let fte=class extends tn{constructor(e){super(e),this.renderVue(cte,e)}},pte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const hte={type:"end-node",model:pte,view:fte},vte={class:"explain-node"},gte={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({content:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let r=JSON.parse(t.properties.node_params);Object.assign(o,r),Pt(()=>{e()})};return ut(()=>{i()}),(r,s)=>{const a=Bi;return w(),Q(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",vte,[y(a,{"auto-size":"",bordered:!1,class:"explain-textarea",value:o.content,"onUpdate:value":s[0]||(s[0]=l=>o.content=l),placeholder:""},null,8,["value"])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"])}}};let _te=class extends tn{constructor(e){super(e),this.renderVue(gte,e)}},mte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[]}};const yte={type:"explain-node",model:mte,view:_te},bte={class:"ai-dialogue-node"},xte={class:"field-list"},wte={class:"field-item"},Cte={class:"field-item-content"},Ste={class:"field-text"},kte={class:"right-arrow"},Ete={class:"field-text"},Dte={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=G([]),a=Je({list:[]}),l=G([]),u=()=>{const g=e.properties.dataRaw||e.properties.node_params||"{}";let m=[];try{m=JSON.parse(g).assign||[]}catch(_){}p(),m.forEach(_=>{_.tags=_.tags||[]}),a.list=m,Pt(()=>{c()})},c=()=>{let g=JSON.parse(e.properties.node_params);g.assign=[...a.list],t({...e.node,node_params:JSON.stringify(g)})};function f(g){return g?g.split(".")[1]:""}const p=()=>{let g=i().getAllParentVariable();g.forEach(m=>{m.tags=m.tags||[]}),l.value=g},h=g=>{yo.includes(g.node_type)&&(p(),Pt(()=>{a.list.forEach(m=>{m.tags&&m.tags.length>0&&m.tags.forEach(_=>{if(_.node_id==g.node_id){let v=_.label.split("/");v[0]=g.node_name,_.label=v.join("/"),_.node_name=g.node_name}})}),c()}))};return gt(()=>e.properties,u,{deep:!0}),ut(()=>{u(),r(),o().eventCenter.on("custom:setNodeName",h)}),no(()=>{o().eventCenter.off("custom:setNodeName",h)}),(g,m)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",bte,[d("div",xte,[d("div",wte,[m[0]||(m[0]=d("div",{class:"field-item-label"},"变量",-1)),d("div",Cte,[(w(!0),R(ae,null,ye(a.list,(_,v)=>(w(),R("div",{class:"field-list-item",key:v},[d("div",Ste,[y(yn,{options:l.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])]),d("div",kte,[y(K(ta))]),d("div",Ete,j(f(_.variable)),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Ate=Te(Dte,[["__scopeId","data-v-d3d3de5a"]]);let Ote=class extends tn{constructor(e){super(e),this.renderVue(Ate,e)}},Nte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Mte={type:"variable-assignment-node",model:Nte,view:Ote},Tte={class:"judge-node"},$te={class:"if-box-label"},Pte={class:"if-box-content"},Rte={class:"condition-box"},Bte={key:0,class:"condition-left-box"},Lte={class:"connection-text"},Ite={key:1,class:"condition-line"},Fte={class:"condition-body"},jte={class:"field-items"},Vte={class:"field-name"},Hte={class:"field-rule"},Ute={class:"field-value"},zte={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("resetSize"),o=He("getNode"),i=He("updateAnchorList"),r=Je({term:[]}),s=G([]),a=G([]);function l(){let v=o().getAllParentVariable();s.value=u(v)}function u(v){return v.forEach(b=>{b.typ=="node"?b.node_type==1?b.value="global":b.value=b.node_id:b.value=b.key,b.children&&b.children.length>0&&(b.children=u(b.children))}),v}let c=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],f=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function p(v){let b="";if(v.variable&&v.variable.length>0){let C=s.value.filter(M=>M.key==v.variable[0]);C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(M=>M.key==v.variable[1])),C&&C.length&&(b=C[0].typ),b=="object"&&(C[0]&&C[0].children&&(C=C[0].subs.filter(M=>M.key==v.variable[2])),C&&C.length&&(b=C[0].typ)))}return b}function h(v){if(!v.variable)return[];let b=p(v);return b==""?v.is_mult?f:c:b=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:b.includes("array")?f:c}const g=v=>{let b=h(v),C=b.findIndex(M=>M.value==v.type);return b[C].label},m=()=>{try{let v=JSON.parse(e.properties.node_params).term||[];v=v.map(b=>{let C=b.terms.map(M=>{let O="";for(let k=0;k<No.length;k++)if(M.variable.indexOf(No[k])>-1){O=No[k];break}if(O!=""){let k=M.variable.split(".");M.variable=[k[0],O]}else M.variable=M.variable.split(".");return{...M,type:M.type>0?M.type:1,key:Math.random()*1e4}});return{...b,is_or:b.is_or?1:0,terms:C,key:Math.random()*1e4}}),r.term=v,Pt(()=>{t(),_()})}catch(v){}},_=()=>{const v=e.properties.nodeSortKey;let b=[],C=56;for(let M=0;M<r.term.length;M++){let O=r.term[M];if(O){let k=0,E=C,S=8,N=2,L=24,$=O.terms.length;k=$*L+S*2+N*($-1),M>0&&M<r.term.length&&(E+=8),C=E+k,b.push({id:v+"-anchor_"+M,offsetHeight:k,offsetTop:E})}}b.length>0&&b.push({id:v+"-anchor_right",offsetHeight:24,offsetTop:C+8}),i(b)};return gt(()=>e.properties.node_params,(v,b)=>{v!=b&&m()},{deep:!0}),ut(()=>{l(),m()}),(v,b)=>(w(),Q(on,{properties:n.properties,title:n.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Tte,[(w(!0),R(ae,null,ye(r.term,(C,M)=>(w(),R("div",{class:"if-box",ref_for:!0,ref:O=>a.value[M]=O,key:M},[d("div",$te,j(M==0?"if":"else if"),1),d("div",Pte,[d("div",Rte,[C.terms.length>1?(w(),R("div",Bte,[d("span",Lte,j(C.is_or==1?"or":"and"),1)])):ie("",!0),C.terms.length>1?(w(),R("div",Ite)):ie("",!0),d("div",Fte,[d("div",jte,[(w(!0),R(ae,null,ye(C.terms,(O,k)=>(w(),R("div",{class:"field-item",key:k},[d("span",Vte,[y(cr,{value:O.variable},null,8,["value"])]),d("span",Hte,j(g(O)),1),d("span",Ute,j(O.value),1)]))),128))])])])])]))),128)),b[0]||(b[0]=d("div",{class:"else-box"},[d("div",{class:"else-box-label"},"else"),d("div",{class:"else-box-content"},[d("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},qte=Te(zte,[["__scopeId","data-v-c6053472"]]);let Gte=class extends tn{constructor(e){super(e),this.renderVue(qte,e)}},Xte=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s,anchorList:a}=this.properties;let l=[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e}];if(a)for(let u=0;u<a.length;u++){let{offsetTop:c,offsetHeight:f}=a[u],p=o-r/2;l.push({id:a[u].id,nodeId:e,x:t+i/2,y:p+c+f/2,type:"right"})}return l}};const Wte={type:"judge-node",model:Xte,view:Gte},Yte={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},Kte={class:"specify-reply-node"},Jte={class:"static-field-list"},Zte={class:"static-field-item"},Qte={class:"static-field-item-content"},ene={class:"static-field-value"};function tne(n,e,t,o,i,r){const s=Nt("AtText"),a=Nt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",Kte,[d("div",Jte,[d("div",Zte,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"消息内容",-1)),d("div",Qte,[d("div",ene,[i.formState.content.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ie("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const nne=Te(Yte,[["render",tne],["__scopeId","data-v-e094e9fc"]]);let one=class extends tn{constructor(e){super(e),this.renderVue(nne,e)}},ine=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const rne={type:"specify-reply-node",model:ine,view:one},sne={name:"ImmediatelyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(n).immediately_reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onInputResize(){this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(n){this.formState.content&&yo.includes(n.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==n.node_id){let t=e.label.split("/");t[0]=n.node_name,e.label=t.join("/"),e.node_name=n.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]},update(){let n=JSON.parse(this.properties.node_params);n.immediately_reply={...this.formState},this.setData({node_params:JSON.stringify(n)})}}},ane={class:"specify-reply-node"},lne={class:"static-field-list"},une={class:"static-field-item"},dne={class:"static-field-item-content"},cne={class:"static-field-value"};function fne(n,e,t,o,i,r){const s=Nt("AtText"),a=Nt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",ane,[d("div",lne,[d("div",une,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"消息内容",-1)),d("div",dne,[d("div",cne,[i.formState.content.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",class:"text-input",onResize:r.onInputResize},null,8,["options","defaultSelectedList","defaultValue","onResize"])):ie("",!0)])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const pne=Te(sne,[["render",fne],["__scopeId","data-v-ae3e2f90"]]);let hne=class extends tn{constructor(e){super(e),this.renderVue(pne,e)}},vne=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const gne={type:"immediately-reply-node",model:vne,view:hne},_ne={class:"ai-dialogue-node"},mne={class:"field-list"},yne={class:"field-item"},bne={class:"field-item-content"},xne={class:"field-value"},wne={class:"field-item"},Cne={class:"field-item-content"},Sne={class:"field-value"},kne={class:"field-key"},Ene={class:"field-item"},Dne={class:"field-item-content"},Ane={class:"field-key"},One={class:"field-type"},Nne={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=jn(),{modelList:a}=Fa(s),l=G(null),u=G([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),f=G([]),p=G([]);function h(O){if(O){let k=O.split("."),E=k[0],S=k.filter((N,L)=>L>0).join(".");return[E,S]}return["global","question"]}function g(O){return O.forEach(k=>{k.cu_key=Math.random()*1e4,k.subs&&k.subs.length?g(k.subs):k.subs=[]}),O}const m=()=>{const O=e.properties.dataRaw||e.properties.node_params||"{}";let k={};try{k=JSON.parse(O).params_extractor||{}}catch{k={}}k=JSON.parse(JSON.stringify(k)),v(),b();for(let E in k){if(E=="output"){c.output=g(k[E]);continue}if(E=="question_value"){c.question_value=h(k[E]);continue}c[E]=k[E]}!c.model_config_id&&a.value.length>0&&(c.model_config_id=a.value[0].id,c.use_model=a.value[0].children[0].name),Pt(()=>{r()})},_=()=>{const O=JSON.stringify({params_extractor:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}});t({...e.node,...c,node_params:O})},v=()=>{let O=i().getAllParentVariable();O.forEach(k=>{k.tags=k.tags||[]}),f.value=O};function b(){let O=i().getAllParentVariable();p.value=C(O)}function C(O){return O.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=C(k.children))}),O}const M=O=>{yo.includes(O.node_type)&&(v(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(k=>{if(k.node_id==O.node_id){let E=k.label.split("/");E[0]=O.node_name,k.label=E.join("/"),k.node_name=O.node_name}}),_(),l.value.refresh())};return gt(()=>e.properties.dataRaw,(O,k)=>{O!=k&&m()},{deep:!0}),ut(()=>{m(),r(),o().eventCenter.on("custom:setNodeName",M)}),no(()=>{o().eventCenter.off("custom:setNodeName",M)}),(O,k)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",_ne,[d("div",mne,[d("div",yne,[k[0]||(k[0]=d("div",{class:"field-item-label"},"用户问题",-1)),d("div",bne,[d("div",xne,[y(cr,{ref_key:"questionTextRef",ref:l,value:c.question_value},null,8,["value"])])])]),d("div",wne,[k[1]||(k[1]=d("div",{class:"field-item-label"},"LLM模型",-1)),d("div",Cne,[d("div",Sne,[d("span",kne,[y(Qa,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",Ene,[k[2]||(k[2]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",Dne,[(w(!0),R(ae,null,ye(c.output,E=>(w(),R("div",{class:Ct(["field-value",{"is-required":E.required}]),key:E.cu_key},[d("span",Ane,j(E.key),1),d("span",One,j(E.typ),1)],2))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Mne=Te(Nne,[["__scopeId","data-v-d6ba1358"]]);let Tne=class extends tn{constructor(e){super(e),this.renderVue(Mne,e)}},$ne=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Pne={type:"parameter-extraction-node",model:$ne,view:Tne},Rne={class:"ai-dialogue-node"},Bne={class:"static-field-list"},Lne={class:"static-field-item"},Ine={class:"static-field-item-content"},Fne={class:"static-field-value"},jne={class:"static-field-item"},Vne={class:"static-field-item-content"},Hne={class:"static-field-value"},Une={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=G(null),o=He("setData"),i=He("getGraph"),r=He("getNode"),s=He("resetSize"),a=jn(),{modelList:l}=Fa(a),u=G([]),c=Je({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),f=G([]);function p(v){if(v){let b=v.split("."),C=b[0],M=b.filter((O,k)=>k>0).join(".");return[C,M]}return["global","question"]}const h=()=>{const v=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(v).question_optimize||{}}catch{b={}}m();const{model_config_id:C,use_model:M,context_pair:O,temperature:k,max_token:E,prompt:S,prompt_tags:N,question_value:L,enable_thinking:$}=JSON.parse(JSON.stringify(b));c.model_config_id=C,c.use_model=M,c.context_pair=O||0,c.temperature=k,c.max_token=E,c.prompt=S,c.enable_thinking=$,c.prompt_tags=N||[],c.question_value=p(L),!c.model_config_id&&l.value.length>0&&(c.model_config_id=l.value[0].id,c.use_model=l.value[0].children[0].name),Pt(()=>{s()})},g=()=>{const v={...c,node_params:JSON.stringify({question_optimize:{...c,question_value:c.question_value.join("."),model_config_id:c.model_config_id?+c.model_config_id:c.model_config_id}})};o(v)},m=()=>{let v=r().getAllParentVariable();f.value=v},_=v=>{m(),c.prompt_tags&&c.prompt_tags.length>0&&c.prompt_tags.forEach(b=>{if(b.node_id==v.node_id){let C=b.label.split("/");C[0]=v.node_name,b.label=C.join("/"),b.node_name=v.node_name}}),g(),t.value.refresh()};return gt(()=>e.properties,h,{deep:!0}),ut(()=>{h(),Pt(()=>{s()}),i().eventCenter.on("custom:setNodeName",_)}),no(()=>{i().eventCenter.off("custom:setNodeName",_)}),(v,b)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:u.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Rne,[d("div",Bne,[d("div",Lne,[b[0]||(b[0]=d("div",{class:"static-field-item-label"},"用户问题",-1)),d("div",Ine,[d("div",Fne,[y(cr,{ref_key:"questionTextRef",ref:t,value:c.question_value},null,8,["value"])])])]),d("div",jne,[b[1]||(b[1]=d("div",{class:"static-field-item-label"},"LLM模型",-1)),d("div",Vne,[d("div",Hne,[y(Qa,{useModel:c.use_model,modelConfigId:c.model_config_id},null,8,["useModel","modelConfigId"])])])]),b[2]||(b[2]=d("div",{class:"static-field-item"},[d("div",{class:"static-field-item-label"},"输出"),d("div",{class:"static-field-item-content"},[d("div",{class:"static-field-value"},[d("span",{class:"static-field-key"},"问题优化结果"),d("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zne=Te(Une,[["__scopeId","data-v-46ea1dcf"]]);let qne=class extends tn{constructor(e){super(e),this.renderVue(zne,e)}},Gne=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Xne={type:"problem-optimization-node",model:Gne,view:qne},Ia="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Wne={class:"add-data-node"},Yne={class:"static-field-list"},Kne={class:"static-field-item"},Jne={class:"static-field-item-content"},Zne={class:"static-field-value"},Qne={class:"static-field-item"},eoe={class:"static-field-item-content"},toe={key:0,class:"static-field-value"},noe={class:"field-name"},ooe={class:"field-name"},ioe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=He("getGraph"),s=G(null);let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),u=G([]),c=()=>{let g=i().getAllParentVariable();u.value=g||[]},f=()=>{let g=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(g),c(),l.formData=a.form_insert,p(),Pt(()=>{o()})},p=()=>{a.form_insert=Bn(l.formData),t({...e.node,node_params:JSON.stringify(a)})};gt(()=>e.properties.dataRaw,(g,m)=>{g!==m&&f()}),ut(()=>{r().eventCenter.on("custom:setNodeName",h),f()}),Gc(()=>{r().eventCenter.off("custom:setNodeName",h)});const h=g=>{!l.formData.datas||l.formData.datas.length==0||yo.includes(g.node_type)&&(c(),l.formData.datas.forEach(m=>{m.atTags&&m.atTags.length>0&&m.atTags.forEach(_=>{if(_.node_id==g.node_id){let v=_.label.split("/");v[0]=g.node_name,_.label=v.join("/"),_.node_name=g.node_name}})}),p(),Pt(()=>{s.value.map(m=>m.refresh()),o()}))};return(g,m)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Wne,[d("div",Yne,[d("div",Kne,[m[0]||(m[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",Jne,[d("div",Zne,j(l.formData.form_name||"--"),1)])]),d("div",Qne,[m[2]||(m[2]=d("div",{class:"static-field-item-label"},"插入数据",-1)),d("div",eoe,[l.formData.datas.length==0?(w(),R("div",toe,"--")):ie("",!0),(w(!0),R(ae,null,ye(l.formData.datas,_=>(w(),R("div",{class:"static-field-value",key:_.id},[d("span",noe,[y(yn,{options:u.value,"default-value":_.value,defaultSelectedList:_.atTags,ref_for:!0,ref_key:"atInputRef",ref:s},null,8,["options","default-value","defaultSelectedList"])]),m[1]||(m[1]=d("span",{class:"field-arrow"},[d("img",{src:Ia,alt:""})],-1)),d("span",ooe,j(_.name),1)]))),128))])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},roe=Te(ioe,[["__scopeId","data-v-3262ce94"]]);let soe=class extends tn{constructor(e){super(e),this.renderVue(roe,e)}},aoe=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const loe={type:"add-data-node",model:aoe,view:soe},uoe={class:"node-box"},doe={class:"static-field-list"},coe={class:"static-field-item"},foe={class:"static-field-item-content"},poe={class:"static-field-value"},hoe={class:"static-field-item",style:{"align-items":"center"}},voe={class:"static-field-item-content"},goe={key:0,class:"static-field-value"},_oe={class:"condition-box"},moe={key:0,class:"condition-left-box"},yoe={class:"connection-text"},boe={key:1,class:"condition-line"},xoe={class:"condition-body"},woe={class:"field-items"},Coe={class:"field-name"},Soe={class:"field-rule"},koe={class:"field-value"},Eoe={class:"static-field-item"},Doe={class:"static-field-item-content"},Aoe={class:"options-list"},Ooe={class:"option-label"},Noe={class:"option-label"},Moe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=sr();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),l=G([]),u=()=>{let _=i().getAllParentVariable();l.value=_||[]},c=()=>{let _=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(_),u();let v=p(s.form_update.where||[]);s.form_update.where=v,a.formData=s.form_update,a.formData.form_id&&g(a.formData.form_id),f(),Pt(()=>{o()})},f=()=>{let _={...Bn(a.formData)};_.where=h(_.where),s.form_update=_,t({...e.node,node_params:JSON.stringify(s)})},p=_=>{let v=[];return _.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),M=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=M[0],M.shift(),C.rule=M.join("_"),v.push(C)}),v},h=_=>{let v=[];return _.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,v.push(C)}),v},g=async _=>{r.getFormFieldList({form_id:_}).then(v=>{v.forEach(b=>{b.id=b.id*1}),a.fieldList=v}).catch(()=>{})},m=(_,v)=>of(v,_);return gt(()=>e.properties.dataRaw,(_,v)=>{_!==v&&c()}),ut(()=>{c()}),(_,v)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",uoe,[d("div",doe,[d("div",coe,[v[0]||(v[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",foe,[d("div",poe,j(a.formData.form_name||"--"),1)])]),d("div",hoe,[v[2]||(v[2]=d("div",{class:"static-field-item-label"},"更新条件",-1)),d("div",voe,[a.formData.where.length==0?(w(),R("span",goe,"--")):ie("",!0),d("div",_oe,[a.formData.where.length>1?(w(),R("div",moe,[d("span",yoe,j(a.formData.typ==1?"且":"或"),1)])):ie("",!0),a.formData.where.length>1?(w(),R("div",boe)):ie("",!0),d("div",xoe,[d("div",woe,[(w(!0),R(ae,null,ye(a.formData.where,b=>(w(),R("div",{class:"field-item",key:b.id},[d("span",Coe,j(b.field_name),1),d("span",Soe,j(m(b.field_type,b.rule)),1),d("span",koe,[y(yn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),R(ae,{key:0},[v[1]||(v[1]=d("span",null,"-",-1)),y(yn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])]),d("div",Eoe,[v[4]||(v[4]=d("div",{class:"static-field-item-label"},"更新数据",-1)),d("div",Doe,[d("div",Aoe,[(w(!0),R(ae,null,ye(a.formData.datas,b=>(w(),R("div",{class:"options-item",key:b.key},[d("div",Ooe,[y(yn,{options:l.value,"default-value":b.value,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"])]),v[3]||(v[3]=d("span",{class:"field-arrow"},[d("img",{src:Ia,alt:""})],-1)),d("div",Noe,j(b.name),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Toe=Te(Moe,[["__scopeId","data-v-2e2e7e8f"]]);let $oe=class extends tn{constructor(e){super(e),this.renderVue(Toe,e)}},Poe=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Roe={type:"update-data-node",model:Poe,view:$oe},Boe={class:"node-box"},Loe={class:"static-field-list"},Ioe={class:"static-field-item"},Foe={class:"static-field-item-content"},joe={class:"static-field-value"},Voe={class:"static-field-item",style:{"align-items":"center"}},Hoe={class:"static-field-item-content"},Uoe={key:0,class:"static-field-value"},zoe={class:"condition-box"},qoe={key:0,class:"condition-left-box"},Goe={class:"connection-text"},Xoe={key:1,class:"condition-line"},Woe={class:"condition-body"},Yoe={class:"field-items"},Koe={class:"field-name"},Joe={class:"field-rule"},Zoe={class:"field-value"},Qoe={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("resetSize"),o=He("setData"),i=He("getNode"),r=sr();let s={};const a=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),l=G([]),u=()=>{let _=i().getAllParentVariable();l.value=_||[]},c=()=>{let _=e.properties.dataRaw||e.properties.node_params||"{}";s=JSON.parse(_),u();let v=h(s.form_delete.where||[]);s.form_delete.where=v,a.formData=s.form_delete,a.formData.form_id&&g(a.formData.form_id),f(),Pt(()=>{t()})},f=()=>{let _={...Bn(a.formData)};_.where=p(_.where),s.form_delete=_,o({...e.node,node_params:JSON.stringify(s)})},p=_=>{let v=[];return _.forEach(b=>{let C=JSON.parse(JSON.stringify(b));C.form_field_id=C.form_field_id*1,C.rule=b.field_type+"_"+b.rule,v.push(C)}),v},h=_=>{let v=[];return _.forEach(b=>{let C=JSON.parse(JSON.stringify(b)),M=C.rule.split("_");C.form_field_id=C.form_field_id*1,C.field_type=M[0],M.shift(),C.rule=M.join("_"),v.push(C)}),v},g=async _=>{r.getFormFieldList({form_id:_}).then(v=>{v.forEach(b=>{b.id=b.id*1}),a.fieldList=v,Pt(()=>{t()})}).catch(()=>{})},m=(_,v)=>of(v,_);return gt(()=>e.properties.dataRaw,(_,v)=>{_!==v&&c()}),ut(()=>{c()}),(_,v)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",Boe,[d("div",Loe,[d("div",Ioe,[v[0]||(v[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",Foe,[d("div",joe,j(a.formData.form_name||"--"),1)])]),d("div",Voe,[v[2]||(v[2]=d("div",{class:"static-field-item-label"},"删除条件",-1)),d("div",Hoe,[a.formData.where.length==0?(w(),R("span",Uoe,"--")):ie("",!0),d("div",zoe,[a.formData.where.length>1?(w(),R("div",qoe,[d("span",Goe,j(a.formData.typ==1?"且":"或"),1)])):ie("",!0),a.formData.where.length>1?(w(),R("div",Xoe)):ie("",!0),d("div",Woe,[d("div",Yoe,[(w(!0),R(ae,null,ye(a.formData.where,b=>(w(),R("div",{class:"field-item",key:b.id},[d("span",Koe,j(b.field_name),1),d("span",Joe,j(m(b.field_type,b.rule)),1),d("span",Zoe,[y(yn,{options:l.value,"default-value":b.rule_value1,defaultSelectedList:b.atTags},null,8,["options","default-value","defaultSelectedList"]),b.rule_value2?(w(),R(ae,{key:0},[v[1]||(v[1]=d("span",null,"-",-1)),y(yn,{options:l.value,"default-value":b.rule_value2,defaultSelectedList:b.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},eie=Te(Qoe,[["__scopeId","data-v-316570df"]]);let tie=class extends tn{constructor(e){super(e),this.renderVue(eie,e)}},nie=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const oie={type:"delete-data-node",model:nie,view:tie},iie={class:"node-box"},rie={class:"static-field-list"},sie={class:"static-field-item"},aie={class:"static-field-item-content"},lie={class:"static-field-value"},uie={class:"static-field-item",style:{"align-items":"center"}},die={class:"static-field-item-content"},cie={key:0,class:"static-field-value"},fie={class:"condition-box"},pie={key:0,class:"condition-left-box"},hie={class:"connection-text"},vie={key:1,class:"condition-line"},gie={class:"condition-body"},_ie={class:"field-items"},mie={class:"field-name"},yie={class:"field-rule"},bie={class:"field-value"},xie={class:"static-field-item"},wie={class:"static-field-item-content"},Cie={class:"options-list"},Sie={class:"option-label"},kie={class:"option-type"},Eie={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("resetSize"),i=He("getNode"),r=He("getGraph"),s=sr();let a={};const l=Je({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),u=G([]),c=()=>{let C=i().getAllParentVariable();u.value=C||[]},f=()=>{let C=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(C),c();let M=h(a.form_select.where||[]);a.form_select.where=M,l.formData=a.form_select,l.formData.form_id&&_(l.formData.form_id),p(),Pt(()=>{o()})},p=()=>{let C={...Bn(l.formData)};C.where=g(C.where),a.form_select=C,t({...e.node,node_params:JSON.stringify(a)})},h=C=>{let M=[];return C.forEach(O=>{let k=JSON.parse(JSON.stringify(O)),E=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=E[0],E.shift(),k.rule=E.join("_"),M.push(k)}),M},g=C=>{let M=[];return C.forEach(O=>{let k=JSON.parse(JSON.stringify(O));k.form_field_id=k.form_field_id*1,k.rule=O.field_type+"_"+O.rule,M.push(k)}),M},m=async()=>{const C=await s.getFormList();C&&(l.tableList=C)},_=async C=>{s.getFormFieldList({form_id:C}).then(M=>{M.forEach(O=>{O.id=O.id*1}),l.fieldList=M}).catch(()=>{})},v=(C,M)=>of(M,C),b=()=>{f()};return gt(()=>e.properties.dataRaw,(C,M)=>{C!==M&&f()}),ut(()=>{m(),f(),r().eventCenter.on("custom:setNodeName",b)}),no(()=>{r().eventCenter.off("custom:setNodeName",b)}),(C,M)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type},{default:x(()=>[d("div",iie,[d("div",rie,[d("div",sie,[M[0]||(M[0]=d("div",{class:"static-field-item-label"},"数据表",-1)),d("div",aie,[d("div",lie,j(l.formData.form_name||"--"),1)])]),d("div",uie,[M[2]||(M[2]=d("div",{class:"static-field-item-label"},"查询条件",-1)),d("div",die,[l.formData.where.length==0?(w(),R("span",cie,"--")):ie("",!0),d("div",fie,[l.formData.where.length>1?(w(),R("div",pie,[d("span",hie,j(l.formData.typ==1?"且":"或"),1)])):ie("",!0),l.formData.where.length>1?(w(),R("div",vie)):ie("",!0),d("div",gie,[d("div",_ie,[(w(!0),R(ae,null,ye(l.formData.where,O=>(w(),R("div",{class:"field-item",key:O.id},[d("span",mie,j(O.field_name),1),d("span",yie,j(v(O.field_type,O.rule)),1),d("span",bie,[y(yn,{options:u.value,"default-value":O.rule_value1,defaultSelectedList:O.atTags},null,8,["options","default-value","defaultSelectedList"]),O.rule_value2?(w(),R(ae,{key:0},[M[1]||(M[1]=d("span",null,"-",-1)),y(yn,{options:u.value,"default-value":O.rule_value2,defaultSelectedList:O.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):ie("",!0)])]))),128))])])])])]),d("div",xie,[M[3]||(M[3]=d("div",{class:"static-field-item-label"},"查询字段",-1)),d("div",wie,[d("div",Cie,[(w(!0),R(ae,null,ye(l.formData.fields,O=>(w(),R("div",{class:"options-item",key:O.key},[d("div",Sie,j(O.name),1),d("div",kie,j(O.type),1)]))),128))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"]))}},Die=Te(Eie,[["__scopeId","data-v-748b22e0"]]);let Aie=class extends tn{constructor(e){super(e),this.renderVue(Die,e)}},Oie=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Nie={type:"select-data-node",model:Oie,view:Aie},Mie={class:"ai-dialogue-node"},Tie={class:"field-list"},$ie={class:"field-item"},Pie={class:"field-item-content"},Rie={class:"field-text"},Bie={class:"right-arrow"},Lie={class:"field-text"},Iie={class:"field-item"},Fie={class:"field-item-content"},jie={class:"field-key"},Vie={class:"field-type"},Hie=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,Uie={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=G([]),a=Je({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),l=G([]);function u(m){return m.forEach(_=>{_.cu_key=Math.random()*1e4,_.subs&&_.subs.length?u(_.subs):_.subs=[]}),m}const c=()=>{const m=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(m).code_run||{}}catch{_={}}h(),_=JSON.parse(JSON.stringify(_));for(let v in _){if(v=="params"){_[v]&&_[v].length>0?a[v]=_[v].map(b=>({...b,cu_key:Math.random()*1e4})):a[v]=[];continue}if(v=="output"){a.output=u(_[v]);continue}a[v]=_[v]}a.main_func=a.main_func||Hie,a.params=a.params.map(v=>{let b="";for(let C=0;C<No.length;C++)if(v.variable.indexOf(No[C])>-1){b=No[C];break}if(b!=""){let C=v.variable.split(".");v.variable=[C[0],b]}else v.variable=v.variable.split(".");return{...v,key:Math.random()*1e4}}),Pt(()=>{r()})},f=()=>{const m=JSON.stringify({code_run:{...a,params:p()}});t({...e.node,...a,node_params:m})};function p(){let m=[];return a.params.forEach(_=>{m.push({field:_.field,variable:_.variable&&_.variable.length>0?_.variable.join("."):""})}),m}const h=()=>{let m=i().getAllParentVariable();l.value=m},g=m=>{yo.includes(m.node_type)&&(h(),Pt(()=>{f()}))};return gt(()=>e.properties,c,{deep:!0}),ut(()=>{c(),r(),o().eventCenter.on("custom:setNodeName",g)}),no(()=>{o().eventCenter.off("custom:setNodeName",g)}),(m,_)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Mie,[d("div",Tie,[d("div",$ie,[_[0]||(_[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",Pie,[(w(!0),R(ae,null,ye(a.params,v=>(w(),R("div",{class:"field-list-item",key:v.cu_key},[d("div",Rie,[y(cr,{value:v.variable},null,8,["value"])]),d("div",Bie,[y(K(ta))]),d("div",Lie,j(v.field),1)]))),128))])]),d("div",Iie,[_[1]||(_[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",Fie,[(w(!0),R(ae,null,ye(a.output,v=>(w(),R("div",{class:"field-value",key:v.cu_key},[d("span",jie,j(v.key),1),d("span",Vie,j(v.typ),1)]))),128))])]),_[2]||(_[2]=d("div",{class:"field-item"},[d("div",{class:"field-item-label"},"异常处理"),d("div",{class:"field-item-content"},[d("div",{class:"field-value"},[d("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zie=Te(Uie,[["__scopeId","data-v-cdf93be1"]]);let qie=class extends tn{constructor(e){super(e),this.renderVue(zie,e)}},Gie=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(o,i,r,s)=>{if(o.id==i.id)return!1;const a=o.graphModel.edges.map(u=>u.sourceAnchorId),l=r.id;return r.type==="right"&&!a.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(o,i,r,s)=>o.id==i.id?!1:s.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}};const Xie={type:"code-run-node",model:Gie,view:qie},Wie={name:"QuestionNode",components:{NodeCommon:on,AtText:yn},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}},valueOptions:[]}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.valueOptions=this.getNode().getAllParentVariable()||[],this.loadProvider(),this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.$nextTick(()=>{this.resetSize()})},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParams=JSON.parse(this.properties.node_params||"{}"),this.$nextTick(()=>{const t=this.$refs.atTextRef;(Array.isArray(t)?t:t?[t]:[]).forEach(i=>{i&&i.refresh&&i.refresh()}),this.resetSize()}))},deep:!0}},methods:{onUpatateNodeName(n){var o,i;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=r=>{!Array.isArray(r)||r.length===0||r.forEach(s=>{if(s&&s.node_id==n.node_id){if(s.label){let a=s.label.split("/");a[0]=n.node_name,s.label=a.join("/")}s.node_name=n.node_name}})},t=((i=(o=this.nodeParams)==null?void 0:o.mcp)==null?void 0:i.tag_map)||{};Object.keys(t).forEach(r=>{e(t[r])}),this.$nextTick(()=>{const r=this.$refs.atTextRef;(Array.isArray(r)?r:r?[r]:[]).forEach(a=>{a&&a.refresh&&a.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.resetSize()})},loadProvider(){var n;Dg({provider_id:((n=this.nodeParams)==null?void 0:n.mcp.provider_id)||""}).then(e=>{var o;this.mcpInfo=(e==null?void 0:e.data)||{};let t=Po((o=this.mcpInfo)==null?void 0:o.tools,[]);this.toolInfo=t.find(i=>{var r;return i.name==((r=this.nodeParams)==null?void 0:r.mcp.tool_name)}),this.$nextTick(()=>{this.resetSize()})})},update(n){let e=this.nodeParams;e.mcp.arguments=n.arguments,e.mcp.tag_map=n.tag_map,this.setData({node_params:JSON.stringify(e)})},getArgValue(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.arguments)==null?void 0:i[n];return e==null?"":String(e)},getArgTags(n){var t,o,i;const e=(i=(o=(t=this.nodeParams)==null?void 0:t.mcp)==null?void 0:o.tag_map)==null?void 0:i[n];return Array.isArray(e)?e:[]}},computed:{propList(){var o;const n=((o=this.toolInfo)==null?void 0:o.inputSchema)||{},e=(n==null?void 0:n.properties)||{},t=Array.isArray(n==null?void 0:n.required)?n.required:[];return Object.keys(e).map(i=>(e[i],{key:i,required:t.includes(i)}))}}},Yie={class:"_main"},Kie={class:"label"};function Jie(n,e,t,o,i,r){const s=Nt("at-text"),a=wi,l=Nt("node-common");return w(),Q(l,{properties:t.properties,title:t.properties.node_name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"94px"}},{default:x(()=>[d("div",Yie,[(w(!0),R(ae,null,ye(r.propList,u=>(w(),R("div",{key:u.key},[d("span",Kie,j(u.key)+"：",1),r.getArgValue(u.key)?(w(),Q(a,{key:0},{default:x(()=>[y(s,{options:i.valueOptions,defaultSelectedList:r.getArgTags(u.key),defaultValue:r.getArgValue(u.key),ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(a,{key:1},{default:x(()=>[...e[0]||(e[0]=[U("--",-1)])]),_:1}))]))),128))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key"])}const Zie=Te(Wie,[["render",Jie],["__scopeId","data-v-0f29b8dd"]]);let Qie=class extends tn{constructor(e){super(e),this.renderVue(Zie,e)}},ere=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const tre={type:"mcp-node",model:ere,view:Qie},nre={name:"feishu-table-render",components:{AtText:yn},props:{business:{type:String},nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{BatchActions:qd,batchActionParam:{},operatorMap:Lg(),actionState:{}}},async mounted(){qd.includes(this.business)&&await this.initParams(),this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{async initParams(){await Bo({name:"feishu_bitable",action:"default/get-schema",params:{}}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.batchActionParam=Ig(((t=e[this.business])==null?void 0:t.params)||{})})},dataFormat(){var o,i,r,s,a;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},{config_name:e,table_name:t}=((a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)||{};this.actionState={...n,config_name:e,table_name:t}}}},ore={class:"_main"},ire={key:0},rre={key:1},sre={key:2},are={key:3},lre={key:4},ure={key:0,class:"field-box"},dre={key:0},cre={key:1},fre={key:1},pre={key:5},hre={key:0,class:"field-box"},vre={class:"arrow-icon"},gre={key:0},_re={key:1},mre={key:1},yre={key:0,class:"field-box"},bre={key:1},xre={key:0,class:"field-box"},wre={key:0},Cre={key:1},Sre={key:1},kre={key:10},Ere={class:"label"},Dre={key:0,class:"field-box"},Are={key:1};function Ore(n,e,t,o,i,r){var l,u;const s=wi,a=Nt("at-text");return w(),R("div",ore,[d("div",null,[e[0]||(e[0]=d("span",{class:"label"},"配置：",-1)),y(s,null,{default:x(()=>{var c;return[U(j(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})]),["create_bitable","create_tables","table_add_members","update_advanced","roles_list"].includes(t.business)?ie("",!0):(w(),R("div",ire,[e[1]||(e[1]=d("span",{class:"label"},"数据表：",-1)),y(s,null,{default:x(()=>{var c,f,p,h,g,m,_;return[(f=(c=i.actionState)==null?void 0:c.tag_map)!=null&&f.table_id&&((h=(p=i.actionState)==null?void 0:p.tag_map)!=null&&h.table_id.length)?(w(),Q(a,{key:0,class:"batch-render-at",options:t.valueOptions,defaultSelectedList:i.actionState.tag_map.table_id,defaultValue:(g=i.actionState)==null?void 0:g.table_id},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R(ae,{key:1},[U(j(((m=i.actionState)==null?void 0:m.table_name)||((_=i.actionState)==null?void 0:_.table_id)||"--"),1)],64))]}),_:1})])),t.business=="create_bitable"?(w(),R("div",rre,[e[2]||(e[2]=d("span",{class:"label"},"多维表名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:((p=i.actionState)==null?void 0:p.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_tables"?(w(),R("div",sre,[e[3]||(e[3]=d("span",{class:"label"},"数据表名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:((p=i.actionState)==null?void 0:p.name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_views"?(w(),R("div",are,[e[4]||(e[4]=d("span",{class:"label"},"视图名称：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.view_name)||[],defaultValue:((p=i.actionState)==null?void 0:p.view_name)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):t.business=="create_record"?(w(),R("div",lre,[e[7]||(e[7]=d("span",{class:"label"},"插入数据：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",ure,[(w(!0),R(ae,null,ye(i.actionState.fields,c=>(w(),Q(s,{class:"field-tag",key:c.field_name},{default:x(()=>[d("span",null,j(c.field_name),1),e[5]||(e[5]=d("span",{class:"arrow-icon"},[d("img",{src:Ia})],-1)),c.value?(w(),R("span",dre,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",cre))]),_:2},1024))),128))])):(w(),R("div",fre,[y(s,null,{default:x(()=>[...e[6]||(e[6]=[U("--",-1)])]),_:1})]))])):t.business=="delete_record"?(w(),R("div",pre,[e[9]||(e[9]=d("span",{class:"label"},"删除ID：",-1)),i.actionState.record_id?(w(),Q(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[8]||(e[8]=[U("--",-1)])]),_:1}))])):t.business=="search_records"?(w(),R(ae,{key:6},[d("div",null,[e[11]||(e[11]=d("span",{class:"label"},"查询条件：",-1)),Array.isArray((u=(l=i.actionState)==null?void 0:l.filter)==null?void 0:u.conditions)&&i.actionState.filter.conditions.length?(w(),R("div",hre,[(w(!0),R(ae,null,ye(i.actionState.filter.conditions,c=>(w(),Q(s,{class:"field-tag",key:c.field_id},{default:x(()=>{var f;return[d("span",null,j(c.field_name),1),d("span",vre,j((f=i.operatorMap[c.operator])==null?void 0:f.label),1),c.value?(w(),R("span",gre,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",_re))]}),_:2},1024))),128))])):(w(),R("div",mre,[y(s,null,{default:x(()=>[...e[10]||(e[10]=[U("--",-1)])]),_:1})]))]),d("div",null,[e[13]||(e[13]=d("span",{class:"label"},"查询字段：",-1)),Array.isArray(i.actionState.field_names)&&i.actionState.field_names.length?(w(),R("div",yre,[(w(!0),R(ae,null,ye(i.actionState.field_names,c=>(w(),Q(s,{class:"field-tag",key:c.field},{default:x(()=>[U(j(c),1)]),_:2},1024))),128))])):(w(),R("div",bre,[y(s,null,{default:x(()=>[...e[12]||(e[12]=[U("--",-1)])]),_:1})]))])],64)):t.business=="update_record"?(w(),R(ae,{key:7},[d("div",null,[e[15]||(e[15]=d("span",{class:"label"},"更新ID：",-1)),i.actionState.record_id?(w(),Q(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:i.actionState.record_tags,defaultValue:i.actionState.record_id},null,8,["options","defaultSelectedList","defaultValue"])]),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[14]||(e[14]=[U("--",-1)])]),_:1}))]),d("div",null,[e[18]||(e[18]=d("span",{class:"label"},"更新数据：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",xre,[(w(!0),R(ae,null,ye(i.actionState.fields,c=>(w(),Q(s,{class:"field-tag",key:c.field_name},{default:x(()=>[d("span",null,j(c.field_name),1),e[16]||(e[16]=d("span",{class:"arrow-icon"},[d("img",{src:Ia})],-1)),c.value?(w(),R("span",wre,[y(a,{options:t.valueOptions,defaultSelectedList:c.atTags,defaultValue:c.value.toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",Cre))]),_:2},1024))),128))])):(w(),R("div",Sre,[y(s,null,{default:x(()=>[...e[17]||(e[17]=[U("--",-1)])]),_:1})]))])],64)):t.business=="update_advanced"?(w(),R(ae,{key:8},[d("div",null,[e[20]||(e[20]=d("span",{class:"label"},"多维表名称：",-1)),i.actionState.name?(w(),Q(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.name)||[],defaultValue:i.actionState.name},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[19]||(e[19]=[U("--",-1)])]),_:1}))]),d("div",null,[e[21]||(e[21]=d("span",{class:"label"},"高级权限：",-1)),y(s,null,{default:x(()=>[U(j(i.actionState.is_advanced==0?"不设置":i.actionState.is_advanced==1?"开启":"关闭"),1)]),_:1})])],64)):t.business=="table_add_members"?(w(),R(ae,{key:9},[d("div",null,[e[22]||(e[22]=d("span",{class:"label"},"多维表：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.app_token)||[],defaultValue:((p=i.actionState)==null?void 0:p.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})]),d("div",null,[e[24]||(e[24]=d("span",{class:"label"},"协作者角色：",-1)),i.actionState.role_id?(w(),Q(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.role_id)||[],defaultValue:i.actionState.role_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[23]||(e[23]=[U("--",-1)])]),_:1}))]),d("div",null,[e[26]||(e[26]=d("span",{class:"label"},"协作者ID：",-1)),i.actionState.member_id?(w(),Q(s,{key:0},{default:x(()=>{var c,f;return[y(a,{options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.member_id)||[],defaultValue:i.actionState.member_id},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})):(w(),Q(s,{key:1},{default:x(()=>[...e[25]||(e[25]=[U("--",-1)])]),_:1}))])],64)):t.business=="roles_list"?(w(),R("div",kre,[e[27]||(e[27]=d("span",{class:"label"},"多维表：",-1)),y(s,null,{default:x(()=>{var c,f,p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((f=(c=i.actionState)==null?void 0:c.tag_map)==null?void 0:f.app_token)||[],defaultValue:((p=i.actionState)==null?void 0:p.app_token)||"--"},null,8,["options","defaultSelectedList","defaultValue"])]}),_:1})])):i.BatchActions.includes(t.business)?(w(!0),R(ae,{key:11},ye(i.batchActionParam,(c,f)=>(w(),R("div",{key:f},[d("span",Ere,j(c.name)+"：",1),i.actionState[f]?(w(),R("div",Dre,[y(s,null,{default:x(()=>{var p;return[y(a,{class:"batch-render-at",options:t.valueOptions,defaultSelectedList:((p=i.actionState)==null?void 0:p.tag_map[f])||[],defaultValue:i.actionState[f].toString()},null,8,["options","defaultSelectedList","defaultValue"])]}),_:2},1024)])):(w(),R("div",Are,[y(s,null,{default:x(()=>[...e[28]||(e[28]=[U("--",-1)])]),_:1})]))]))),128)):ie("",!0)])}const Nre=Te(nre,[["render",Ore],["__scopeId","data-v-8f2ebef3"]]),Mre={name:"feishu-table-render",components:{AtText:yn,QuestionCircleOutlined:mt},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{operatorMap:Lg(),actionState:{}}},mounted(){this.dataFormat()},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{dataFormat(){var i,r;let n=((r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)||{},e=(n==null?void 0:n.arguments)||{},{config_name:t,table_name:o}=n||{};this.actionState={...n,...e,config_name:t,table_name:o},this.actionState},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},Tre={class:"_main"},$re={class:"label"},Pre={class:"hint"},Rre={key:0},Bre={key:1},Lre={key:0,class:"field-box"},Ire={key:0},Fre={key:1},jre={key:1};function Vre(n,e,t,o,i,r){var u,c;const s=wi,a=Nt("QuestionCircleOutlined"),l=Nt("at-text");return w(),R("div",Tre,[d("div",null,[e[0]||(e[0]=d("span",{class:"label"},"公众号：",-1)),y(s,null,{default:x(()=>{var f;return[U(j(((f=i.actionState)==null?void 0:f.app_name)||"--"),1)]}),_:1})]),d("div",null,[d("span",$re,[e[2]||(e[2]=U("接收人 ",-1)),d("span",Pre,[y(a),e[1]||(e[1]=d("span",{class:"hint-pop"},"接收人openid",-1))]),e[3]||(e[3]=U("： ",-1))]),(u=i.actionState)!=null&&u.touser?(w(),R("span",Rre,[y(l,{options:t.valueOptions,defaultSelectedList:[],defaultValue:(((c=i.actionState)==null?void 0:c.touser)||"").toString()},null,8,["options","defaultValue"])])):(w(),R("span",Bre,[y(s,null,{default:x(()=>[...e[4]||(e[4]=[U("--",-1)])]),_:1})]))]),d("div",null,[e[5]||(e[5]=d("span",{class:"label"},"消息类型：",-1)),y(s,null,{default:x(()=>{var f;return[U(j(((f=i.actionState)==null?void 0:f.msg_type_name)||"--"),1)]}),_:1})]),d("div",null,[e[8]||(e[8]=d("span",{class:"label"},"回复内容：",-1)),Array.isArray(i.actionState.fields)?(w(),R("div",Lre,[(w(!0),R(ae,null,ye(i.actionState.fields,f=>(w(),Q(s,{class:"field-tag",key:f.field_name},{default:x(()=>[d("span",null,j(r.getFieldLabel(f)),1),e[6]||(e[6]=d("span",{class:"arrow-icon"},[d("img",{src:Ia})],-1)),r.getFieldValue(f)?(w(),R("span",Ire,[y(l,{options:t.valueOptions,defaultSelectedList:r.getFieldTags(f),defaultValue:r.getFieldValue(f).toString()},null,8,["options","defaultSelectedList","defaultValue"])])):(w(),R("span",Fre))]),_:2},1024))),128))])):(w(),R("div",jre,[y(s,null,{default:x(()=>[...e[7]||(e[7]=[U("--",-1)])]),_:1})]))])])}const Hre=Te(Mre,[["render",Vre],["__scopeId","data-v-ee438a34"]]),Ure={name:"feishu-table-render",inject:["getGraph","setData"],components:{AtText:yn},props:{nodeParams:{type:Object},valueOptions:{type:Array}},data(){return{atTextRef:null,actionState:{}}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.dataFormat()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},watch:{nodeParams:{handler(n,e){this.dataFormat(),this.$emit("updateSize")},deep:!0}},methods:{onUpatateNodeName(n){var o;if(!yo.includes(n.node_type))return;const e=i=>{!Array.isArray(i)||i.length===0||i.forEach(r=>{if(r&&r.node_id==n.node_id){if(r.label){let s=r.label.split("/");s[0]=n.node_name,r.label=s.join("/")}r.node_name=n.node_name}})};(((o=this.actionState)==null?void 0:o.rendering)||[]).forEach(i=>{e(i==null?void 0:i.tags)}),this.$nextTick(()=>{const i=this.$refs.atTextRef;(Array.isArray(i)?i:i?[i]:[]).forEach(s=>{s&&s.refresh&&s.refresh()}),this.update(),this.dataFormat(),this.$emit("updateSize")})},update(){this.setData({node_params:JSON.stringify(this.nodeParams)})},dataFormat(){var o,i,r;let n=((i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)||{},e=(n==null?void 0:n.arguments)||{},t=(n==null?void 0:n.rendering)||{};if(Array.isArray(n==null?void 0:n.rendering)){const s=((r=n==null?void 0:n.arguments)==null?void 0:r.tag_map)||(n==null?void 0:n.tag_map)||{};n.rendering.forEach(a=>{if(a&&(!Array.isArray(a.tags)||a.tags.length===0)){const l=a.key,u=l&&s?s[l]:null;Array.isArray(u)&&u.length&&(a.tags=u)}})}this.actionState={...n,...e,...t}},getFieldLabel(n){var e,t;return((t=(e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])==null?void 0:t.name)||(n==null?void 0:n.name)},getFieldValue(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.value)??""}return(n==null?void 0:n.value)??""},getFieldTags(n){var e;if(n!=null&&n.media_component){const t=((e=n==null?void 0:n.properties)==null?void 0:e[n==null?void 0:n.current_properties_key])||{};return(t==null?void 0:t.atTags)??[]}return(n==null?void 0:n.atTags)??[]}}},zre={class:"_main"},qre={key:0},Gre={class:"label"};function Xre(n,e,t,o,i,r){var l,u;const s=wi,a=Nt("at-text");return w(),R("div",zre,[(l=i.actionState)!=null&&l.use_plugin_config?(w(),R("div",qre,[e[0]||(e[0]=d("span",{class:"label"},"配置：",-1)),y(s,null,{default:x(()=>{var c;return[U(j(((c=i.actionState)==null?void 0:c.config_name)||"--"),1)]}),_:1})])):ie("",!0),(w(!0),R(ae,null,ye(((u=i.actionState)==null?void 0:u.rendering)||[],(c,f)=>(w(),R("div",{key:c.key||f},[d("span",Gre,j(c.label)+"：",1),c.value?(w(),Q(s,{key:0},{default:x(()=>[y(a,{options:t.valueOptions,defaultSelectedList:c.tags,defaultValue:c.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(s,{key:1},{default:x(()=>[...e[1]||(e[1]=[U("--",-1)])]),_:1}))]))),128))])}const Wre=Te(Ure,[["render",Xre],["__scopeId","data-v-f069d729"]]),Yre={name:"QuestionNode",components:{AtText:yn,FeishuTableRender:Nre,OfficialSendMessageRender:Hre,DynamicRender:Wre,NodeCommon:on},inject:["getNode","getGraph","setData","resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{atTextRef:null,menus:[{name:"删除",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{},isMultiNode:!1,pluginData:{},valueOptions:[]}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},computed:{pluginName(){var n,e;return((e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.name)||null},business(){var n,e,t;return((t=(e=(n=this.nodeParams)==null?void 0:n.plugin)==null?void 0:e.params)==null?void 0:t.business)||null},isFeishuTbPlugin(){return this.pluginName==="feishu_bitable"},isOfficialSendMessagePlugin(){return this.pluginName==="official_send_message"}},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{onUpatateNodeName(n){var o,i,r,s,a,l;if(!yo.includes(n.node_type))return;this.valueOptions=this.getNode().getAllParentVariable()||[];const e=u=>{!Array.isArray(u)||u.length===0||u.forEach(c=>{if(c&&c.node_id==n.node_id){if(c.label){let f=c.label.split("/");f[0]=n.node_name,c.label=f.join("/")}c.node_name=n.node_name}})};this.formState&&typeof this.formState=="object"&&Object.keys(this.formState).forEach(u=>{var c;e((c=this.formState[u])==null?void 0:c.tags)});const t=[];(i=(o=this.nodeParams)==null?void 0:o.plugin)!=null&&i.tag_map&&t.push(this.nodeParams.plugin.tag_map),(l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)!=null&&l.tag_map&&t.push(this.nodeParams.plugin.params.arguments.tag_map),t.forEach(u=>{!u||typeof u!="object"||Object.keys(u).forEach(c=>{e(u[c])})}),this.$nextTick(()=>{const u=this.$refs.atTextRef;(Array.isArray(u)?u:u?[u]:[]).forEach(f=>{f&&f.refresh&&f.refresh()}),this.setData({node_params:JSON.stringify(this.nodeParams)}),this.updateSize()})},async init(){this.valueOptions=this.getNode().getAllParentVariable(),this.nodeParamsFormat(),await this.loadPluginInfo(),await this.loadPluginParams(),this.updateSize()},loadPluginInfo(){return Ag({name:this.pluginName}).then(n=>{var t;let e=(n==null?void 0:n.data)||{};this.info=e.remote,this.isMultiNode=((t=e==null?void 0:e.local)==null?void 0:t.multiNode)||!1})},loadPluginParams(){return Bo({name:this.pluginName,action:"default/get-schema",params:{}}).then(n=>{this.pluginData=(n==null?void 0:n.data)||{},this.formStateFormat(),this.update(this.pluginData)})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){if(this.isFeishuTbPlugin||this.isOfficialSendMessagePlugin)return;let n=JSON.parse(JSON.stringify(this.pluginData));const e={official_account_profile:this.officialAccountHandle,official_batch_tag:this.officialTagHandle,official_send_template_message:this.officialTemplateHandle,official_article:this.officialArticleHandle,official_draft:this.officialDraftHandle};e[this.pluginName]?e[this.pluginName](n):this.defaultHandle(n),this.updateSize()},update(n){var a,l,u;typeof n=="string"&&(n=JSON.parse(n));const e=JSON.parse(this.properties.node_params),t=this.business&&(n!=null&&n[this.business])?n[this.business]:n,o=ya(this.pluginName)||this.isMultiNode,i=o?((l=(a=e==null?void 0:e.plugin)==null?void 0:a.params)==null?void 0:l.arguments)||{}:((u=e==null?void 0:e.plugin)==null?void 0:u.params)||{},r={...i};for(const c in this.formState||{}){const f=this.formState[c]||{},p=(f==null?void 0:f.enum_component)||(f==null?void 0:f.radio_component),h=f==null?void 0:f.enum_default;p&&(r[c]==null||String(r[c]).trim()==="")&&h!=null&&h!==""&&(r[c]=h);const g=f==null?void 0:f.setting_cache_component;if(g===!0||g===1||g==="true"||g==="1"){const _=String((f==null?void 0:f.value)??"");if(_!=="")r[c]=_;else{const v=localStorage.getItem(this.getCacheKey(c));v!=null&&(r[c]=String(v))}}}e.plugin=e.plugin||{},e.plugin.params=e.plugin.params||{},e.plugin.params.use_plugin_config=(t==null?void 0:t.use_plugin_config)||!1,o?e.plugin.params.arguments={...i,...r,tag_map:i.tag_map||{}}:e.plugin.params={...e.plugin.params,...r},e.plugin.output_obj=Ci((t==null?void 0:t.output)||{});const s=JSON.stringify(e);this.properties.node_params!==s&&this.setData({...this.properties,node_params:s})},defaultHandle(n){var o,i,r,s,a,l,u,c,f,p,h,g,m;let e,t;ya(this.pluginName)||this.isMultiNode?(this.formState=((o=n==null?void 0:n[this.business])==null?void 0:o.params)||{},e=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},t=((c=(u=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)==null?void 0:c.tag_map)||{}):(e=((p=(f=this.nodeParams)==null?void 0:f.plugin)==null?void 0:p.params)||{},t=((g=(h=this.nodeParams)==null?void 0:h.plugin)==null?void 0:g.tag_map)||{},this.formState=n);for(let _ in this.formState){this.formState[_].value=String(e[_]||""),this.formState[_].tags=t[_]||[];const v=(m=this.formState[_])==null?void 0:m.setting_cache_component;if((v===!0||v===1||v==="true"||v==="1")&&!String(this.formState[_].value||"").trim()){const M=localStorage.getItem(this.getCacheKey(_));M!=null&&(this.formState[_].value=String(M))}}this.isMultiNode&&this.ensureMultiNodeRendering()},getCacheKey(n){let e="",t="";const o=typeof window<"u"?String(window.location.hash||""):"";return o.includes("?")&&(o.split("?")[1]||"").split("&").forEach(s=>{const[a,l]=s.split("=");a==="id"&&(e=decodeURIComponent(l||"")),a==="robot_key"&&(t=decodeURIComponent(l||""))}),e||(e=String(localStorage.getItem("last_local_robot_id")||"")),`${e||t||""}:${this.pluginName}:${n}`},ensureMultiNodeRendering(){var r,s,a,l,u,c,f,p,h,g,m,_,v,b,C,M;const n=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.rendering;if(Array.isArray(n)&&n.length){const O=((f=(c=(u=(l=this.nodeParams)==null?void 0:l.plugin)==null?void 0:u.params)==null?void 0:c.arguments)==null?void 0:f.tag_map)||((h=(p=this.nodeParams)==null?void 0:p.plugin)==null?void 0:h.tag_map)||{};let k=!1;const E=n.map(S=>{var B,A;const N=S==null?void 0:S.key;if((Array.isArray(S==null?void 0:S.tags)?S.tags:[]).length)return S;const $=Array.isArray(O==null?void 0:O[N])?O[N]:Array.isArray((A=(B=this.formState)==null?void 0:B[N])==null?void 0:A.tags)?this.formState[N].tags:[];return $.length?(k=!0,{...S,tags:$}):S});if(k){const S=JSON.parse(this.properties.node_params);S.plugin=S.plugin||{},S.plugin.params=S.plugin.params||{},S.plugin.params.rendering=E,(m=(g=this.nodeParams)==null?void 0:g.plugin)!=null&&m.params&&(this.nodeParams.plugin.params.rendering=E),this.setData({...this.properties,node_params:JSON.stringify(S)})}return}const e=Object.keys(this.formState||{}).filter(O=>O!=="app_secret").filter(O=>{var k,E;return!((E=(k=this.formState)==null?void 0:k[O])!=null&&E.hide_official_component)}).filter(O=>{var k,E;return!((E=(k=this.formState)==null?void 0:k[O])!=null&&E.advanced_settings)}).filter(O=>{var S,N;const k=(N=(S=this.formState)==null?void 0:S[O])==null?void 0:N.plugin_config_component;return!(k===!0||k===1||k==="true"||k==="1")}).filter(O=>{var S,N;const k=(N=(S=this.formState)==null?void 0:S[O])==null?void 0:N.setting_cache_component;return!(k===!0||k===1||k==="true"||k==="1")}).sort((O,k)=>{var E,S,N,L;return+(((S=(E=this.formState)==null?void 0:E[O])==null?void 0:S.sort_num)||0)-+(((L=(N=this.formState)==null?void 0:N[k])==null?void 0:L.sort_num)||0)}),t=((b=(v=(_=this.nodeParams)==null?void 0:_.plugin)==null?void 0:v.params)==null?void 0:b.arguments)||{},o=e.map(O=>{var L,$,B;const k=((L=this.formState)==null?void 0:L[O])||{};let E=(k==null?void 0:k.name)||O,S=String((k==null?void 0:k.value)??"");const N=Array.isArray(k==null?void 0:k.tags)?k.tags:[];if(O==="app_id"&&(E="公众号名称",S=String(t.app_name??((B=($=this.formState)==null?void 0:$.app_name)==null?void 0:B.value)??"")),k!=null&&k.enum_component||k!=null&&k.radio_component){const A=((k==null?void 0:k.enum)||[]).find(D=>String(D==null?void 0:D.value)===S)||((k==null?void 0:k.enum)||[]).find(D=>String(D==null?void 0:D.value)===(k==null?void 0:k.enum_default));A&&A.name&&(S=String(A.name))}return{label:E,value:S,tags:N,key:O}});if(!o.length)return;const i=JSON.parse(this.properties.node_params);i.plugin=i.plugin||{},i.plugin.params=i.plugin.params||{},i.plugin.params.rendering=o,(M=(C=this.nodeParams)==null?void 0:C.plugin)!=null&&M.params&&(this.nodeParams.plugin.params.rendering=o),this.setData({...this.properties,node_params:JSON.stringify(i)})},officialAccountHandle(n){var e,t,o,i,r,s,a,l,u,c,f;if((e=n==null?void 0:n[this.business])==null||delete e.params.app_id,(t=n==null?void 0:n[this.business])==null||delete t.params.app_secret,(o=n==null?void 0:n[this.business])!=null&&o.params)if(this.business==="getTagFans"){let p=((s=(r=(i=this.nodeParams)==null?void 0:i.plugin)==null?void 0:r.params)==null?void 0:s.arguments)||{},h=((c=(u=(l=(a=this.nodeParams)==null?void 0:a.plugin)==null?void 0:l.params)==null?void 0:u.arguments)==null?void 0:c.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:p.app_name,tags:[]}},p.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:p.tag_name,tags:[]}:(f=h==null?void 0:h.tagid)!=null&&f.length?this.formState.tagid={type:"string",name:"标签名称",value:p.tagid,tags:h.tagid||[]}:this.formState.tagid={type:"string",name:"标签ID",value:p.tagid,tags:[]},this.formState.next_openid={type:"string",name:"上批尾用户openid",value:p.next_openid,tags:h.next_openid||[]},this.updateSize();return}else n[this.business].params={app_name:{type:"string",name:"公众号名称"},...n[this.business].params};this.defaultHandle(n)},officialTemplateHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};switch(this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},template_name:{type:"string",name:"模板名称",value:n.template_name,tags:[]},touser:{type:"string",name:"接收者",value:n.touser,tags:e.touser||[]}},n.link_type){case 0:this.formState.link_type={type:"string",name:"模板跳转",value:"不跳转",tags:[]};break;case 1:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转链接",tags:[]},this.formState.url={type:"string",name:"跳转链接",value:n.url,tags:e.url||[]};break;case 2:this.formState.link_type={type:"string",name:"模板跳转",value:"跳转小程序",tags:[]},this.formState.miniprogram_app={type:"string",name:"小程序APPID",...n.miniprogram.appid},this.formState.miniprogram_path={type:"string",name:"小程序路径",...n.miniprogram.pagepath};break}this.updateSize()},officialTagHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},openid_list:{type:"string",name:"粉丝openid列表",value:n.openid_list,tags:[]}},n.tag_type==1?this.formState.tag_name={type:"string",name:"标签名称",value:n.tag_name,tags:[]}:this.formState.tagid={type:"string",name:"标签名称",value:n.tagid,tags:e.tagid||[]},this.updateSize()},officialArticleHandle(){var t,o,i,r,s,a,l;let n=((i=(o=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:o.params)==null?void 0:i.arguments)||{},e=((l=(a=(s=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:s.params)==null?void 0:a.arguments)==null?void 0:l.tag_map)||{};this.formState={url:{type:"string",name:"",value:n.url,tags:e.url||[]},number:{type:"string",name:"",value:n.number,tags:e.number||[]}},this.updateSize()},officialDraftHandle(){var o,i,r,s,a,l,u;let n=((r=(i=(o=this.nodeParams)==null?void 0:o.plugin)==null?void 0:i.params)==null?void 0:r.arguments)||{},e=((u=(l=(a=(s=this.nodeParams)==null?void 0:s.plugin)==null?void 0:a.params)==null?void 0:l.arguments)==null?void 0:u.tag_map)||{},t=n.article_type?n.article_type=="news"?"图文消息":"图片消息":"--";switch(this.business){case"add_draft":this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},article_type:{type:"string",name:"文章类型",value:t,tags:[]}};break;case"update_draft":case"publish_draft":case"delete_draft":case"preview_message":case"get_draft":default:this.formState={app_name:{type:"string",name:"公众号名称",value:n.app_name,tags:[]},media_id:{type:"string",name:"文章ID",value:n.media_id,tags:e.media_id||[]}},this.business==="preview_message"&&(this.formState.account={type:"string",name:"接收用户",value:n.account,tags:e.account||[]});break}this.updateSize()},updateSize(){this.$nextTick(()=>{this.resetSize()})}}},Kre={key:0,class:"ding-group-node"},Jre={key:1,class:"ding-group-node"},Zre={class:"label"};function Qre(n,e,t,o,i,r){const s=Nt("DynamicRender"),a=Nt("FeishuTableRender"),l=Nt("OfficialSendMessageRender"),u=Nt("at-text"),c=wi,f=Nt("node-common");return w(),Q(f,{properties:t.properties,title:t.properties.node_name,iconUrl:i.info.icon,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,style:{"min-width":"320px","min-height":"157px"}},{default:x(()=>[i.isMultiNode?(w(),R("div",Kre,[y(s,{nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])])):(w(),R("div",Jre,[r.isFeishuTbPlugin?(w(),Q(a,{key:0,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):ie("",!0),r.isOfficialSendMessagePlugin?(w(),Q(l,{key:1,nodeParams:i.nodeParams,business:r.business,valueOptions:i.valueOptions,onUpdateSize:r.updateSize},null,8,["nodeParams","business","valueOptions","onUpdateSize"])):(w(!0),R(ae,{key:2},ye(i.formState,(p,h)=>(w(),R("div",{key:h},[d("span",Zre,j(p.name||h)+"：",1),p.value?(w(),Q(c,{key:0},{default:x(()=>[y(u,{options:i.valueOptions,defaultSelectedList:p.tags,defaultValue:p.value,ref_for:!0,ref:"atTextRef"},null,8,["options","defaultSelectedList","defaultValue"])]),_:2},1024)):(w(),Q(c,{key:1},{default:x(()=>[...e[0]||(e[0]=[U("--",-1)])]),_:1}))]))),128))]))]),_:1},8,["properties","title","iconUrl","isSelected","isHovered","node-key"])}const ese=Te(Yre,[["render",Qre],["__scopeId","data-v-a328a157"]]);let tse=class extends tn{constructor(e){super(e),this.renderVue(ese,e)}},nse=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const ose={type:"zm-plugins-node",model:nse,view:tse},ise="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cg%20clip-path='url(%23cmdkkm1o9__clip0_12048_97931)'%20stroke='%23fff'%20stroke-width='1.16667'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M6.79163%2013.2109H5.04163V14.9609'/%3e%3cpath%20d='M14.9584%2014.9609H13.2084V13.2109'/%3e%3cpath%20d='M13.2084%206.78906H14.9584V5.03906'/%3e%3cpath%20d='M5.04163%205.03906H6.79163V6.78906'/%3e%3cpath%20d='M6.79163%205.125C5.21015%206.16842%204.16663%207.96112%204.16663%209.99757C4.16663%2010.295%204.18888%2010.5871%204.23181%2010.8726'/%3e%3cpath%20d='M10.875%2015.7708C10.5896%2015.8137%2010.2974%2015.8359%2010%2015.8359C7.96357%2015.8359%206.17086%2014.7924%205.12744%2013.2109'/%3e%3cpath%20d='M15.7682%209.125C15.8111%209.41043%2015.8334%209.70262%2015.8334%2010C15.8334%2012.0364%2014.7898%2013.8291%2013.2084%2014.8726'/%3e%3cpath%20d='M9.125%204.22925C9.41043%204.18632%209.70262%204.16406%2010%204.16406C12.0364%204.16406%2013.8291%205.20758%2014.8726%206.78906'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='cmdkkm1o9__clip0_12048_97931'%3e%3cpath%20fill='%23fff'%20transform='translate(3%203)'%20d='M0%200H14V14H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",rse={class:"preview-img-box"},sse={class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},ase={class:"custom-slick-arrow",style:{right:"10px"}},lse=["onClick","src"],use={style:{display:"none"}},dse={__name:"index",props:{currentImageList:{type:Array,default:()=>[]}},setup(n){const e=n,t=G(!1),o=G(0),i=r=>{o.value=r,t.value=!0};return(r,s)=>{const a=Fy,l=jy,u=Vy;return w(),R("div",rse,[y(a,{arrows:"",dots:!1},{prevArrow:x(()=>[d("div",sse,[y(K(Iy))])]),nextArrow:x(()=>[d("div",ase,[y(K(Bu))])]),default:x(()=>[(w(!0),R(ae,null,ye(e.currentImageList,(c,f)=>(w(),R("div",{class:"img-list-item",key:c},[d("img",{onClick:p=>i(f),src:c,alt:""},null,8,lse)]))),128))]),_:1}),d("div",use,[y(u,{preview:{visible:t.value,current:o.value,onVisibleChange:c=>t.value=c}},{default:x(()=>[(w(!0),R(ae,null,ye(e.currentImageList,c=>(w(),Q(l,{key:c,src:c},null,8,["src"]))),128))]),_:1},8,["preview"])])])}}},Lm=Te(dse,[["__scopeId","data-v-b3d114c5"]]),cse={class:"modal-title-block"},fse={key:0,class:"run-detail"},pse={class:"flex-content-box"},hse={class:"test-model-box"},vse={key:2,class:"input-list-box"},gse={class:"add-btn-box"},_se={key:0,class:"result-list-box loading-box"},mse={key:1,class:"result-list-box"},yse=["onClick"],bse={class:"status-block"},xse={class:"icon-name-box"},wse=["src"],Cse={class:"node-name"},Sse={key:0,class:"time-tag"},kse={class:"right-active-icon"},Ese={class:"save-btn-box"},Dse={class:"preview-box"},Ase={class:"preview-title"},Ose={class:"icon-name-box"},Nse=["src"],Mse={class:"node-name"},Tse={key:0,class:"time-tag"},$se={key:0,class:"preview-content-block"},Pse={class:"preview-img-box"},Rse={class:"preview-content-block"},Bse={class:"title-block"},Lse={class:"preview-code-box"},Ise={class:"preview-content-block"},Fse={class:"title-block"},jse={class:"preview-code-box"},Vse={class:"preview-content-block"},Hse={class:"title-block"},Use={class:"preview-code-box"},zse={__name:"run-test",props:{loop_node_key:{type:String,default:""}},emits:["save"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo.isLockedByOther),r=n;Xe(()=>[]);const s=G(!1),a=G(""),l=G([]),u=Xe(()=>a.value?l.value.filter(D=>D.node_key==a.value)[0]:null),c=Xe(()=>{let D=[];if(u.value&&u.value.node_type==33){let T=u.value.output;for(let F in T)F.includes("picture_url_")&&D.push(T[F])}return D}),f=G(!1),p=Je({is_draft:!0,robot_key:o.robotInfo.robot_key,question:"",openid:""}),h=async()=>{if(i.value){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}o.robotInfo.loop_save_canvas_status++,await Pt();let D=localStorage.getItem("workflow_loop_run_test_data")||"{}";D=JSON.parse(D),p.question=D.question||"",p.openid=D.openid||"",p.global=D.global||"",l.value=[],a.value="",setTimeout(()=>{v()},1e3),s.value=!0},g=G([]),m=G(!1),_=G(!1),v=()=>{dy({robot_key:p.robot_key,loop_node_key:r.loop_node_key}).then(D=>{m.value=D.data.is_need_question,_.value=D.data.is_need_openid,m.value||(p.question=""),g.value=D.data.loop_test_params.map(T=>({...T,field:{...T.field,Vals:b(T.field)}}))})};function b(D){return D.typ=="string"||D.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}const C=(D,T)=>{D.splice(T,1)},M=D=>{D.push({value:"",key:Math.random()*1e4})},O=G(null),k=G(0),E=G(0),S=()=>{O.value.validate().then(()=>{let D={...p,loop_node_key:r.loop_node_key},T=JSON.parse(JSON.stringify(g.value));T.forEach(F=>{F.field.typ.includes("array")&&(F.field.Vals=F.field.Vals.map(V=>V.value))}),D.loop_test_params=JSON.stringify(T),f.value=!0,l.value=[],localStorage.setItem("workflow_loop_run_test_data",JSON.stringify({...D})),uy({...D}).then(F=>{xt.success("测试结果生成完成");let V=F.data.node_logs||[];k.value=F.data.use_token,E.value=F.data.use_mills,N(V)}).catch(F=>{l.value=[];let V=F.data.node_logs||[];V&&V.length&&N(V)}).finally(()=>{f.value=!1})})},N=D=>{var T;l.value=D.map(F=>({...F,is_success:F.error_msg==="<nil>",node_icon:Lu(F.node_type)})),a.value=(T=l.value[0])==null?void 0:T.node_key},L=D=>{a.value=D.node_key},$=D=>{Os(JSON.stringify(u.value[D])),xt.success("复制成功")};function B(D){return D.field.key.replace(D.node_key+".","")}return e({open:()=>{h()}}),(D,T)=>{const F=wi,V=ii,P=ln,X=kn,oe=$n,H=Vn,W=Kt,Z=wn,le=mo,te=vn;return w(),R("div",null,[y(te,{open:s.value,"onUpdate:open":T[5]||(T[5]=q=>s.value=q),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",cse,[T[6]||(T[6]=U("运行测试 ",-1)),l.value.length?(w(),R("div",fse,[d("span",null,"总耗时："+j(K(tf)(E.value)),1),d("span",null,"token消耗："+j(k.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",pse,[d("div",hse,[T[13]||(T[13]=d("div",{class:"top-title"},"开始节点参数",-1)),y(Z,{model:p,ref_key:"formRef",ref:O,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[m.value?(w(),Q(X,{key:0,name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:x(()=>[y(V,{gap:4},{default:x(()=>[T[8]||(T[8]=U("question ",-1)),y(F,{style:{margin:"0"}},{default:x(()=>[...T[7]||(T[7]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(P,{placeholder:"请输入",value:p.question,"onUpdate:value":T[0]||(T[0]=q=>p.question=q)},null,8,["value"])]),_:1})):ie("",!0),_.value?(w(),Q(X,{key:1,name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:x(()=>[y(V,{gap:4},{default:x(()=>[T[10]||(T[10]=U("openid ",-1)),y(F,{style:{margin:"0"}},{default:x(()=>[...T[9]||(T[9]=[U("string",-1)])]),_:1})]),_:1})]),default:x(()=>[y(P,{placeholder:"请输入",value:p.openid,"onUpdate:value":T[1]||(T[1]=q=>p.openid=q)},null,8,["value"])]),_:1})):ie("",!0),(w(!0),R(ae,null,ye(g.value,q=>(w(),Q(X,{key:q.node_key,rules:[{required:q.field.required,message:`请输入${q.node_name}`}]},{label:x(()=>[y(V,{gap:4},{default:x(()=>[U(j(q.node_name)+" "+j(B(q)),1),y(F,{style:{margin:"0"}},{default:x(()=>[U(j(q.field.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[q.field.typ=="string"?(w(),Q(P,{key:0,placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ie("",!0),q.field.typ=="number"?(w(),Q(oe,{key:1,style:{width:"100%"},placeholder:"请输入",value:q.field.Vals,"onUpdate:value":re=>q.field.Vals=re},null,8,["value","onUpdate:value"])):ie("",!0),q.field.typ.includes("array")?(w(),R("div",vse,[(w(!0),R(ae,null,ye(q.field.Vals,(re,ce)=>(w(),R("div",{class:"input-list-item",key:ce},[y(H,null,{default:x(()=>[y(P,{placeholder:"请输入",value:re.value,"onUpdate:value":ve=>re.value=ve},null,8,["value","onUpdate:value"])]),_:2},1024),q.field.Vals.length>1?(w(),Q(K(Jt),{key:0,onClick:ve=>C(q.field.Vals,ce)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",gse,[y(W,{onClick:re=>M(q.field.Vals),block:"",type:"dashed"},{default:x(()=>[...T[11]||(T[11]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["rules"]))),128))]),_:1},8,["model"]),f.value?(w(),R("div",_se,[f.value?(w(),Q(le,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),l.value.length>0?(w(),R("div",mse,[(w(!0),R(ae,null,ye(l.value,(q,re)=>(w(),R("div",{class:Ct(["list-item-block",{active:a.value==q.node_key}]),onClick:ce=>L(q),key:re},[d("div",bse,[q.is_success?(w(),Q(K(Ua),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Ru),{key:1,style:{color:"#d81e06"}}))]),d("div",xse,[d("img",{src:q.node_icon,alt:""},null,8,wse),d("div",Cse,j(q.node_name),1)]),q.is_success?(w(),R("div",Sse,j(q.use_time)+"ms",1)):ie("",!0),d("div",kse,[y(K(Bu))])],10,yse))),128))])):ie("",!0),d("div",Ese,[y(W,{loading:f.value,onClick:S,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(K(ni)),T[12]||(T[12]=U("运行测试",-1))]),_:1},8,["loading"])])]),d("div",Dse,[u.value?(w(),R(ae,{key:0},[d("div",Ase,[T[14]||(T[14]=d("div",{class:"title-text"},"日志详情",-1)),d("div",Ose,[d("img",{src:u.value.node_icon,alt:""},null,8,Nse),d("div",Mse,j(u.value.node_name),1)]),u.value.is_success?(w(),R("div",Tse,j(u.value.use_time)+"ms",1)):ie("",!0)]),c.value.length>0?(w(),R("div",$se,[T[15]||(T[15]=d("div",{class:"title-block"},"生成图像日志",-1)),d("div",Pse,[y(Lm,{currentImageList:c.value},null,8,["currentImageList"])])])):ie("",!0),d("div",Rse,[d("div",Bse,[T[16]||(T[16]=U("输入",-1)),y(K(Oo),{onClick:T[2]||(T[2]=q=>$("input"))})]),d("div",Lse,[y(K(Mo),{data:u.value.input},null,8,["data"])])]),d("div",Ise,[d("div",Fse,[T[17]||(T[17]=U("输出",-1)),y(K(Oo),{onClick:T[3]||(T[3]=q=>$("node_output"))})]),d("div",jse,[y(K(Mo),{data:u.value.node_output},null,8,["data"])])]),d("div",Vse,[d("div",Hse,[T[18]||(T[18]=U("运行日志",-1)),y(K(Oo),{onClick:T[4]||(T[4]=q=>$("output"))})]),d("div",Use,[y(K(Mo),{data:u.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},qse=Te(zse,[["__scopeId","data-v-f3ffaa8e"]]),Gse={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),R(ae,null,[d("div",{class:Ct(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},Xse=Te(Gse,[["__scopeId","data-v-82fe400e"]]),Wse={class:"custom-group-content"},Yse={class:"top-block"},Kse={class:"title-block"},Jse={class:"title-text"},Zse={class:"btn-block"},Qse={class:"info-block"},eae={class:"info-item"},tae={class:"info-content"},nae={key:0,class:"label-text"},oae={key:1,class:"label-text"},iae={key:2,class:"label-value"},rae={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getGraph"),o=He("getNode"),i=He("addNode"),r=He("setData"),s=He("resetSize"),a=G(["custom-group","batch-group","end-node"]),l=G(!1),u=Xe(()=>o().id),c=b=>{i(b),l.value=!1},f=()=>{l.value=!0},p=G(null),h=()=>{p.value.open()},g=Je({loop_type:"array",loop_number:"",loop_arrays:[{key:"",typ:"array",value:"",cu_key:Math.random()*1e4}],intermediate_params:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}],output:[{key:"",typ:"",value:"",cu_key:Math.random()*1e4}]}),m=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let C={};try{C=JSON.parse(b).loop||{}}catch{C={}}C=JSON.parse(JSON.stringify(C)),g.loop_type=C.loop_type,g.loop_number=C.loop_number,g.loop_arrays=C.loop_arrays,g.intermediate_params=C.intermediate_params,g.output=C.output,Pt(()=>{s()})},_=()=>{const b=JSON.stringify({loop:{...g}});r({...e.node,...g,node_params:b})};gt(()=>e.properties,()=>{m()},{deep:!0});const v=()=>{let b=o();t().deleteNode(b.id)};return ut(()=>{m(),s(),_()}),(b,C)=>{const M=Qt,O=Va,k=Lr,E=Br,S=Ir;return w(),R("div",Wse,[y(Xse,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),d("div",{class:"header-box",style:In({background:n.properties.node_header_bg_color})},[d("div",Yse,[d("div",Kse,[C[2]||(C[2]=d("img",{src:ise,alt:""},null,-1)),d("div",Jse,j(e.properties.node_name),1)]),d("div",Zse,[y(O,{title:null,trigger:"click",open:l.value,"onUpdate:open":C[0]||(C[0]=N=>l.value=N),arrow:!1,placement:"right"},{content:x(()=>[y(Iu,{style:{height:"550px"},excludedNodeTypes:a.value,onAddNode:c,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[y(M,{title:"新建内部节点"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(f,["stop"])},[y(K(Fn))])]),_:1})]),_:1},8,["open"]),y(M,{title:"运行测试"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(h,["stop"])},[y(K(ni))])]),_:1}),y(S,{trigger:"click"},{overlay:x(()=>[y(E,null,{default:x(()=>[y(k,{onClick:v},{default:x(()=>[...C[4]||(C[4]=[d("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"btn-item",onClick:C[1]||(C[1]=St(()=>{},["stop"]))},[...C[3]||(C[3]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])])]),_:1})])]),d("div",Qse,[d("div",eae,[C[5]||(C[5]=d("div",{class:"info-label"},"循环类型",-1)),d("div",tae,[g.loop_type=="array"?(w(),R("div",nae,"使用数组循环")):ie("",!0),g.loop_type=="number"?(w(),R("div",oae,"指定循环次数")):ie("",!0),g.loop_type=="number"?(w(),R("div",iae,j(g.loop_number),1)):ie("",!0)])])])],4),C[6]||(C[6]=d("div",{class:"node-body"},[d("div",{class:"node-content"})],-1)),y(qse,{ref_key:"runTestRef",ref:p,loop_node_key:u.value},null,8,["loop_node_key"])])}}},sae=Te(rae,[["__scopeId","data-v-2ba4865d"]]);function Im(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=Im(f.children,f)),f})}let aae=class extends Za.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=Ze("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(Ze("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Tt(sae,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=or({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Pt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(g=>g.sourceAnchorId),i=t.map(g=>g.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:g=>{g.stopPropagation();const{graphModel:m,model:_}=this.props;l==="right"&&!r&&m.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:_})}},c,f,p)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}},lae=class extends Za.model{initNodeData(e){super.initNodeData(e),this.DEFAULT_TOP_Z_INDEX=Number.MAX_SAFE_INTEGER,this.DEFAULT_BOTTOM_Z_INDEX=1,this.topGroupZIndex=1,this.width=e.width||600,this.height=e.height||420,this.zIndex=1,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}setSelected(e){super.setSelected(e)}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(u=>u.type==="start-node");r&&(t.add(r.id),e.push(r));const s=u=>{for(let c=0;c<u.length;c++){let p=u[c].sourceNode;t.has(p.id)||(t.add(p.id),ds.includes(p.type)&&e.push(p),s(p.incoming.edges))}};s(o),i.filter(u=>u.properties.loop_parent_key==this.id).forEach(u=>{e.push(u)});let l=[];for(const u of e){if(!ds.includes(u.type))continue;let c=JSON.parse(u.properties.node_params),f={label:u.properties.node_name,value:u.id,node_id:u.id,node_type:u.properties.node_type,typ:"node",children:[],loop_parent_key:u.properties.loop_parent_key,group_node_key:this.id};if(u.type==="http-node"&&(f.children=c.curl.output),u.type==="code-run-node"&&(f.children=c.code_run.output),u.type==="parameter-extraction-node"&&(f.children=c.params_extractor.output),u.type==="start-node"&&(f.children=[...c.start.diy_global,...c.start.sys_global]),u.type==="custom-group"&&(f.children=c.loop.output),u.type==="import-library-node"&&(f.children=c.library_import.outputs),u.type==="json-node"&&(f.children=c.json_encode.output),u.type==="json-reverse-node"&&(f.children=c.json_decode.output),u.type==="select-data-node"&&(f.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),u.type==="knowledge-base-node"&&(f.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),u.type==="ai-dialogue-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),u.type==="specify-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="immediately-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="problem-optimization-node"&&(f.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),u.type==="mcp-node"&&(f.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),u.type==="image-generation-node"){let p=c.image_generation.image_num;if(p>0){let h=[];for(let g=0;g<+p;g++){let m=String.fromCharCode(97+g);h.push({key:`picture_url_${m}`,typ:"string",name:`picture_url_${m}`,label:`picture_url_${m}`})}f.children=h}}if(u.type==="zm-plugins-node"){let p=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=g=>{g.forEach(m=>{m.name=m.key||"",m.subs&&m.subs.length>0&&h(m.subs)})};h(p),f.children=p||[]}f.children.forEach(p=>{p.node_id=u.id,p.node_name=u.properties.node_name,p.node_type=u.properties.node_type}),f.children=Im(f.children,null),l.push(f)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}};const uae={type:"custom-group",view:aae,model:lae},dae={name:"groupStartNode",components:{NodeCommon:on},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{}},computed:{},watch:{properties:{handler(){},deep:!0}},mounted(){},methods:{}};function cae(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"200px"}},null,8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const fae=Te(dae,[["render",cae],["__scopeId","data-v-d1edd3b9"]]);let pae=class extends tn{constructor(e){super(e),this.renderVue(fae,e)}},hae=class extends nn{setAttributes(){this.width=200,this.height=72;const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const vae={type:"group-start-node",model:hae,view:pae},gae={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function _ae(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:r.handleMenu,style:{width:"420px",height:"94px"}},{default:x(()=>[...e[0]||(e[0]=[d("div",{class:"end-node"},[d("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const mae=Te(gae,[["render",_ae],["__scopeId","data-v-ce48c961"]]);let yae=class extends tn{constructor(e){super(e),this.renderVue(mae,e)}},bae=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e}]}};const xae={type:"terminate-node",model:bae,view:yae},wae={class:"start-node"},Cae={key:0,class:"start-node-options"},Sae={class:"options-list"},kae={class:"options-item"},Eae={key:0,class:"option-label"},Dae={key:1,class:"option-label"},Aae={key:2,class:"option-label"},Oae={key:0},Nae={key:1,class:"start-node-options"},Mae={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(s,a)=>{const l=s.node_params||"{}",u=a.node_params||"{}";l!=u&&r()},{deep:!0});let o={1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",0:"星期日"};const i=Je({type:"select_time",every_type:"day",week_number:"",month_day:"",hour_minute:"",linux_crontab:""}),r=()=>{if(!t.properties||!t.properties.node_params)return;let a=JSON.parse(t.properties.node_params).trigger.cron_config||{};Object.assign(i,a),Pt(()=>{e()})};return ut(()=>{r()}),(s,a)=>(w(),Q(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",wae,[i.type=="select_time"?(w(),R("div",Cae,[a[1]||(a[1]=d("div",{class:"options-title"},"执行时间",-1)),d("div",Sae,[d("div",kae,[i.every_type=="day"?(w(),R("div",Eae," 每天 "+j(i.hour_minute),1)):ie("",!0),i.every_type=="week"?(w(),R("div",Dae," 每周 "+j(K(o)[i.week_number])+" "+j(i.hour_minute),1)):ie("",!0),i.every_type=="month"?(w(),R("div",Aae,[a[0]||(a[0]=U(" 每月 ",-1)),i.month_day?(w(),R("span",Oae,j(i.month_day)+"号",1)):ie("",!0),U(" "+j(i.hour_minute),1)])):ie("",!0)])])])):(w(),R("div",Nae,[...a[2]||(a[2]=[d("div",{class:"options-title"},"执行时间",-1),d("div",{class:"options-list"},[d("div",{class:"options-item"},[d("div",{class:"option-label"},"Linux Crontab代码")])],-1)])]))])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Tae=Te(Mae,[["__scopeId","data-v-3d63d637"]]);let $ae=class extends tn{constructor(e){super(e),this.renderVue(Tae,e)}},Pae=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Rae={type:"timing-trigger-node",model:Pae,view:$ae},Bae={class:"start-node"},Lae={class:"start-node-options"},Iae={class:"options-list"},Fae={class:"options-item"},jae={class:"option-label"},Vae={class:"start-node-options"},Hae={class:"options-list"},Uae={class:"option-label"},zae={key:0,class:"options-item"},qae={class:"start-node-options"},Gae={class:"options-list"},Xae={class:"option-label"},Wae={class:"option-type"},Yae={key:0,class:"options-item"},Kae={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=$s(),t=He("resetSize"),o=n,i=Xe(()=>e.officialList);gt(()=>o.properties,(p,h)=>{const g=p.node_params||"{}",m=h.node_params||"{}";g!=m&&c()},{deep:!0});let r={message:"私信消息",subscribe_unsubscribe:"关注/取消关注事件",qrcode_scan:"扫描带参数二维码事件",menu_click:"自定义菜单事件"};const s=Je({msg_type:"",app_ids:[]}),a=Xe(()=>s.app_ids.map(p=>i.value.find(h=>h.app_id==p)).filter(Boolean)),l=G([]),u=Xe(()=>[...l.value]),c=()=>{if(!o.properties||!o.properties.node_params)return;let p=JSON.parse(o.properties.node_params);l.value=p.trigger.outputs||[];let h=p.trigger.trigger_official_config;s.msg_type=h.msg_type,s.app_ids=h.app_ids?h.app_ids.split(","):[],Pt(()=>{t()})},f=()=>{let p=i.value.find(h=>h.app_id=="sdwdw");a.value};return ut(()=>{c()}),(p,h)=>(w(),Q(on,{properties:n.properties,title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Bae,[d("div",Lae,[h[0]||(h[0]=d("div",{class:"options-title"},"触发事件",-1)),d("div",Iae,[d("div",Fae,[d("div",jae,j(K(r)[s.msg_type]),1)])])]),d("div",Vae,[d("div",{class:"options-title",onClick:f},"公众号"),d("div",Hae,[(w(!0),R(ae,null,ye(a.value.slice(0,1),g=>(w(),R("div",{class:"options-item",key:g.app_id},[d("div",Uae,j(g.app_name),1)]))),128)),a.value.length>1?(w(),R("div",zae,[...h[1]||(h[1]=[d("div",{class:"option-label"},"...",-1)])])):ie("",!0)])]),d("div",qae,[h[3]||(h[3]=d("div",{class:"options-title"},"输出",-1)),d("div",Gae,[(w(!0),R(ae,null,ye(u.value.slice(0,2),g=>(w(),R("div",{class:Ct(["options-item",{"is-required":g.required}]),key:g.key},[d("div",Xae,j(g.key),1),d("div",Wae,j(g.typ),1)],2))),128)),u.value.length>2?(w(),R("div",Yae,[...h[2]||(h[2]=[d("div",{class:"option-label"},"...",-1)])])):ie("",!0)])])])]),_:1},8,["properties","title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Jae=Te(Kae,[["__scopeId","data-v-06de59d3"]]);let Zae=class extends tn{constructor(e){super(e),this.renderVue(Jae,e)}},Qae=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const ele={type:"official-trigger-node",model:Qae,view:Zae},tle="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%20class='design-iconfont'%3e%3crect%20width='20'%20height='20'%20rx='6'%20fill='%2338F'/%3e%3cpath%20d='M12.4647%206.7C12.573%206.69991%2012.6803%206.72119%2012.7804%206.76263C12.8805%206.80406%2012.9714%206.86484%2013.048%206.94148C13.1246%207.01811%2013.1853%207.1091%2013.2266%207.20923C13.268%207.30936%2013.2892%207.41667%2013.289%207.525V14.675C13.289%2014.8937%2013.2022%2015.1034%2013.0476%2015.2581C12.893%2015.4128%2012.6834%2015.4998%2012.4647%2015.5H5.32363C5.21533%2015.5001%205.10807%2015.4788%205.00801%2015.4374C4.90796%2015.3959%204.81706%2015.3351%204.74055%2015.2585C4.66403%2015.1818%204.6034%2015.0908%204.56212%2014.9907C4.52084%2014.8906%204.49973%2014.7833%204.5%2014.675V7.525C4.5%207.30643%204.58673%207.0968%204.74115%206.94212C4.89557%206.78744%205.10506%206.70036%205.32363%206.7H12.4654H12.4647ZM8.8945%208.7625C8.82228%208.76241%208.75075%208.77658%208.68402%208.80419C8.61729%208.83181%208.55667%208.87233%208.50563%208.92343C8.4546%208.97453%208.41415%209.0352%208.38662%209.10197C8.35909%209.16873%208.34501%209.24028%208.34519%209.3125V10.55H7.10906C7.00013%2010.5497%206.89358%2010.5818%206.80294%2010.6423C6.71231%2010.7027%206.64168%2010.7887%206.60005%2010.8894C6.55841%2010.99%206.54765%2011.1008%206.56912%2011.2076C6.59059%2011.3144%206.64332%2011.4124%206.72063%2011.4891C6.82375%2011.5922%206.96331%2011.65%207.10906%2011.65H8.34519V12.8875C8.34537%2012.9961%208.37768%2013.1021%208.43804%2013.1924C8.4984%2013.2826%208.58412%2013.3529%208.68439%2013.3946C8.78466%2013.4362%208.895%2013.4472%209.00151%2013.4262C9.10803%2013.4052%209.20595%2013.3532%209.28294%2013.2766C9.334%2013.2255%209.37449%2013.1648%209.40209%2013.0981C9.42969%2013.0313%209.44387%2012.9597%209.44381%2012.8875V11.65H10.6799C10.7887%2011.6501%2010.8951%2011.618%2010.9856%2011.5576C11.0761%2011.4972%2011.1466%2011.4113%2011.1882%2011.3108C11.2298%2011.2103%2011.2406%2011.0996%2011.2193%2010.993C11.198%2010.8863%2011.1454%2010.7883%2011.0684%2010.7116C11.0174%2010.6604%2010.9569%2010.6198%2010.8902%2010.5921C10.8236%2010.5644%2010.7521%2010.5501%2010.6799%2010.55H9.44313V9.3125C9.44313%209.16675%209.38527%209.02696%209.28228%208.92383C9.17928%208.82071%209.03956%208.76268%208.89381%208.7625H8.8945ZM14.8139%204.5C14.9839%204.5003%2015.1477%204.56357%2015.2738%204.67758C15.3999%204.7916%2015.4792%204.94828%2015.4966%205.11737L15.5%205.1875V12.0666C15.5003%2012.1982%2015.4628%2012.327%2015.392%2012.4379C15.3213%2012.5488%2015.2202%2012.637%2015.1007%2012.6922C14.9813%2012.7473%2014.8486%2012.7671%2014.7183%2012.7491C14.588%2012.731%2014.4656%2012.676%2014.3656%2012.5905C14.2316%2012.4752%2014.1471%2012.3127%2014.1298%2012.1367L14.1264%2012.0666V6.14931C14.1263%206.08512%2014.1038%206.02296%2014.0628%205.97361C14.0217%205.92427%2013.9647%205.89084%2013.9016%205.87912L13.8521%205.87431H7.93269C7.76272%205.87433%207.5988%205.81127%207.47268%205.69734C7.34655%205.58341%207.2672%205.42672%207.25%205.25762L7.24656%205.1875C7.24649%205.01749%207.30941%204.85349%207.42318%204.72715C7.53694%204.60082%207.69348%204.52112%207.86256%204.50344L7.93338%204.5H14.8125H14.8139Z'%20fill='%23fff'/%3e%3c/svg%3e",nle={__name:"border-line",props:{isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){return(e,t)=>(w(),R(ae,null,[d("div",{class:Ct(["border-line line-left",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-right",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-top",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2),d("div",{class:Ct(["border-line line-botttom",{isSelected:n.isSelected,isHovered:n.isHovered}])},null,2)],64))}},ole=Te(nle,[["__scopeId","data-v-e7122931"]]),ile={class:"custom-group-content"},rle={class:"top-block"},sle={class:"title-block"},ale={class:"title-text"},lle={class:"btn-block"},ule={__name:"index",props:{properties:{type:Object,default:()=>({})},model:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getGraph"),o=He("getNode"),i=He("addNode");He("setData");const r=He("resetSize"),s=G(["custom-group","batch-group","end-node","terminate-node"]),a=G(!1),l=Xe(()=>o().id),u=_=>{i(_),a.value=!1},c=()=>{a.value=!0},f=G(null),p=()=>{let _=h.batch_arrays[0];_&&_.key&&_.typ&&_.value?f.value.open():xt.error("请填写执行数组")},h=Je({chan_number:10,max_run_number:500,batch_arrays:[{key:"",typ:"",value:"",_id:rs(16)}],output:[{key:"",typ:"",value:"",_id:rs(16)}]}),g=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let v={};try{v=JSON.parse(_).batch||{}}catch{v={}}h.chan_number=v.chan_number,h.batch_arrays=v.batch_arrays,h.output=v.output,Pt(()=>{r()})};gt(()=>e.properties,(_,v)=>{JSON.stringify(_)!==JSON.stringify(v)&&g()},{deep:!0});const m=()=>{let _=o();t().deleteNode(_.id)};return ut(()=>{g(),r()}),(_,v)=>{const b=Qt,C=Va,M=Lr,O=Br,k=Ir;return w(),R("div",ile,[y(ole,{isHovered:n.isHovered,isSelected:n.isSelected},null,8,["isHovered","isSelected"]),d("div",{class:"header-box",style:In({background:n.properties.node_header_bg_color})},[d("div",rle,[d("div",sle,[v[2]||(v[2]=d("img",{src:tle,alt:""},null,-1)),d("div",ale,j(e.properties.node_name),1)]),d("div",lle,[y(C,{title:null,trigger:"click",open:a.value,"onUpdate:open":v[0]||(v[0]=E=>a.value=E),placement:"right"},{content:x(()=>[y(Iu,{excludedNodeTypes:s.value,onAddNode:u,type:"loop-node"},null,8,["excludedNodeTypes"])]),default:x(()=>[y(b,{title:"新建内部节点"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(c,["stop"])},[y(K(Fn))])]),_:1})]),_:1},8,["open"]),y(b,{title:"运行测试"},{default:x(()=>[d("div",{class:"btn-item",onClick:St(p,["stop"])},[y(K(ni))])]),_:1}),y(k,{trigger:"click"},{overlay:x(()=>[y(O,null,{default:x(()=>[y(M,{onClick:m},{default:x(()=>[...v[4]||(v[4]=[d("div",{style:{color:"#fb363f"}},"删除",-1)])]),_:1})]),_:1})]),default:x(()=>[d("div",{class:"btn-item",onClick:v[1]||(v[1]=St(()=>{},["stop"]))},[...v[3]||(v[3]=[d("img",{class:"btn-icon",src:If,alt:""},null,-1)])])]),_:1})])]),v[5]||(v[5]=Wm('<div class="info-block" data-v-2e753e68><div class="info-item" data-v-2e753e68><div class="info-label" data-v-2e753e68>执行数组</div><div class="info-content" data-v-2e753e68><div class="label-text" data-v-2e753e68>input</div></div></div></div>',1))],4),v[6]||(v[6]=d("div",{class:"node-body"},[d("div",{class:"node-content"})],-1)),y(zg,{ref_key:"runTestRef",ref:f,batch_node_key:l.value},null,8,["batch_node_key"])])}}},dle=Te(ule,[["__scopeId","data-v-2e753e68"]]);function Fm(n,e){return n.map(t=>{let o=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,r=e?e.node_type:t.node_type,s=t.name||t.key,a=e?`${e.text}.${s}`:s,l=t.children||t.subs||[],u="",c="";r==1?c=`global.${a}`:e?c=`${e.original_value}.${t.key}`:c=`${o}.${t.key}`,u=`【${c}】`;let f={label:s,value:u,original_value:c,node_id:o,node_name:i,node_type:r,text:a,key:t.key,id:o,typ:t.typ,children:l||[]};return f.children&&f.children.length>0&&(f.children=Fm(f.children,f)),f})}class cle extends Za.view{constructor(e){super(e),this.div=null,this.app=null}getShape(){const e=super.getShape(),{model:t}=this.props,{width:o,height:i,x:r,y:s}=t;return this.div=Ze("div",{xmlns:"http://www.w3.org/1999/xhtml",style:"width: 100%; height: 100%;"}),e.props.children.push(Ze("foreignObject",{x:r-o/2,y:s-i/2,width:o,height:i,overflow:"unset",children:[this.div]})),this.mountVueComponentOnNextTick(this.props),e}async mountVueComponentOnNextTick(){const e=this.div.__e;if(!e){setTimeout(()=>this.mountVueComponentOnNextTick(),100);return}if(!this.app)this.r=Tt(dle,{isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered,properties:this.props.model.getProperties()}),this.app=or({render:()=>this.r,provide:()=>({getNode:()=>this.props.model,getGraph:()=>this.props.graphModel,addNode:t=>{this.props.graphModel.eventCenter.emit("custom:addGroupNode",{data:t,group_id:this.props.model.id})},resetSize:()=>{if(this.r&&this.r.el){let t=this.r.el.clientHeight,o=this.r.el.clientWidth;this.props.model.properties={...this.props.model.properties,width:o,height:t},this.props.model._width=o,this.props.model._height=t,this.props.model.refreshBranch()}},setData:t=>{t.dataRaw=t.node_params,Pt(()=>{this.props.model.properties={...this.props.model.properties,...t};let o=null;this.r&&this.r.el&&(o=this.r.el.clientHeight),this.props.model._height=o||t.height||this.props.model.properties.height,this.props.model.refreshBranch()})},setTitle:t=>{this.props.model.properties.node_name=t}})}),this.app.mount(e);else if(this.r&&this.r.component){const t=this.props.model.getProperties(),o=this.r.component.props.properties;this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,JSON.stringify(t)!==JSON.stringify(o)&&(this.r.component.props.properties=t)}}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),o=t.map(g=>g.sourceAnchorId),i=t.map(g=>g.targetAnchorId),r=!1;const{x:s,y:a,type:l}=e,u=10;l==="left"?r=i.includes(e.id):r=o.includes(e.id);const c=Ze("circle",{className:"custom-anchor-circle",cx:s,cy:a,r:u,fill:"#fff",stroke:"#2475FC","stroke-width":2}),f=Ze("g",{className:"custom-anchor-arrow",transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),p=Ze("g",{className:`custom-anchor-plus ${r?"anchor-hide":""}`,transform:`translate(${s-u-2}, ${a-u-2})`},[Ze("circle",{cx:12,cy:12,r:u,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),Ze("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),Ze("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return Ze("g",{id:e.id,className:`custom-anchor custom-anchor-${l} ${r?"anchor-selected":"anchor-not-selected"}`,onClick:g=>{g.stopPropagation();const{graphModel:m,model:_}=this.props;l==="right"&&!r&&m.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:_})}},c,f,p)}destroy(){this.app&&(this.app.unmount(),this.app=null),super.destroy()}}class fle extends Za.model{initNodeData(e){super.initNodeData(e),this.width=e.width||600,this.height=e.height||420,this.collapsible=!1,this.isRestrict=!1,this.autoResize=!1,this.radius=8,this.allowResize=!1,this.autoExpand=!1,this.transformWithContainer=!0,this.allowRotate=!0,this.stopMoveGraph=!1,this.autoToFront=!1,this.properties={...this.properties,transformWithContainer:!0}}getNodeStyle(){const e=super.getNodeStyle();return e.stroke="none",e.strokeWidth=2,e.fill="#F0F2F5",e.filter="drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2))",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}isAllowAppendIn(e){return!e.properties.disabled_add_group}setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+28,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+28,id:l+"-anchor_right",type:"right",nodeId:e}]}getAllParentVariable(){const e=[],t=new Set,o=this.incoming.edges,{nodes:i}=this.graphModel;let r=i.find(u=>u.type==="start-node");r&&(t.add(r.id),e.push(r));const s=u=>{for(let c=0;c<u.length;c++){let p=u[c].sourceNode;t.has(p.id)||(t.add(p.id),ds.includes(p.type)&&e.push(p),s(p.incoming.edges))}};s(o),i.filter(u=>u.properties.loop_parent_key==this.id).forEach(u=>{e.push(u)});let l=[];for(const u of e){if(!ds.includes(u.type))continue;let c=JSON.parse(u.properties.node_params),f={label:u.properties.node_name,value:u.id,node_id:u.id,node_type:u.properties.node_type,typ:"node",children:[],loop_parent_key:u.properties.loop_parent_key,group_node_key:this.id};if(u.type==="http-node"&&(f.children=c.curl.output),u.type==="code-run-node"&&(f.children=c.code_run.output),u.type==="parameter-extraction-node"&&(f.children=c.params_extractor.output),u.type==="start-node"&&(f.children=[...c.start.diy_global,...c.start.sys_global]),u.type==="custom-group"&&(f.children=c.loop.output),u.type==="import-library-node"&&(f.children=c.library_import.outputs),u.type==="json-node"&&(f.children=c.json_encode.output),u.type==="json-reverse-node"&&(f.children=c.json_decode.output),u.type==="select-data-node"&&(f.children=[{key:"output_list",typ:"array<object>",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),u.type==="knowledge-base-node"&&(f.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),u.type==="ai-dialogue-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),u.type==="specify-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="immediately-reply-node"&&(f.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),u.type==="problem-optimization-node"&&(f.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),u.type==="mcp-node"&&(f.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),u.type==="image-generation-node"){let p=c.image_generation.image_num;if(p>0){let h=[];for(let g=0;g<+p;g++){let m=String.fromCharCode(97+g);h.push({key:`picture_url_${m}`,typ:"string",name:`picture_url_${m}`,label:`picture_url_${m}`})}f.children=h}}if(u.type==="zm-plugins-node"){let p=c.plugin.output_obj?JSON.parse(JSON.stringify(c.plugin.output_obj)):[];const h=g=>{g.forEach(m=>{m.name=m.key||"",m.subs&&m.subs.length>0&&h(m.subs)})};h(p),f.children=p||[]}f.children.forEach(p=>{p.node_id=u.id,p.node_name=u.properties.node_name,p.node_type=u.properties.node_type}),f.children=Fm(f.children,null),l.push(f)}return l}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const ple={type:"batch-group",view:cle,model:fle},hle={class:"ai-dialogue-node"},vle={class:"field-list"},gle={class:"field-item"},_le={class:"field-item-content"},mle={class:"field-value"},yle={class:"field-key"},ble={class:"field-item"},xle={class:"field-item-content"},wle={class:"field-value"},Cle={class:"field-key"},Sle={class:"field-item"},kle={class:"options-list"},Ele={class:"option-label"},Dle={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("getNode"),o=He("resetSize"),i=G([]),r=G([]),s=Je({model_config_id:void 0,use_model:void 0,size:void 0,image_num:"1",prompt:"",prompt_tags:[],input_images:[],image_watermark:"1",image_optimize_prompt:"1"}),a=Xe(()=>{let c=["msg"];if(s.image_num>0)for(let f=0;f<+s.image_num;f++){let p=String.fromCharCode(97+f);c.push(`picture_url_${p}`)}return c}),l=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let f={};try{u(),f=JSON.parse(c).image_generation||{},s.model_config_id=f.model_config_id,s.use_model=f.use_model,s.size=f.size,s.image_num=f.image_num,s.prompt=f.prompt,s.prompt_tags=f.prompt_tags,s.input_images=f.input_images,s.image_watermark=f.image_watermark,s.image_optimize_prompt=f.image_optimize_prompt}catch{f={}}Pt(()=>{o()})};function u(){let c=t().getAllParentVariable();i.value=c||[]}return gt(()=>e.properties,(c,f)=>{const p=c.dataRaw||c.node_params||"{}",h=f.dataRaw||f.node_params||"{}";p!=h&&l()},{deep:!0}),ut(()=>{l(),o()}),no(()=>{}),(c,f)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",hle,[d("div",vle,[d("div",gle,[f[0]||(f[0]=d("div",{class:"field-item-label"},"模型",-1)),d("div",_le,[d("div",mle,[d("span",yle,[y(Qa,{useModel:s.use_model,modelConfigId:s.model_config_id},null,8,["useModel","modelConfigId"])])])])]),d("div",ble,[f[1]||(f[1]=d("div",{class:"field-item-label"},"提示词",-1)),d("div",xle,[d("div",wle,[d("span",Cle,[y(yn,{options:i.value,defaultSelectedList:s.prompt_tags,defaultValue:s.prompt,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])])])])]),d("div",Sle,[f[3]||(f[3]=d("div",{class:"field-item-label"},"输出",-1)),d("div",kle,[(w(!0),R(ae,null,ye(a.value,p=>(w(),R("div",{class:"options-item",key:p},[d("div",Ele,j(p),1),f[2]||(f[2]=d("div",{class:"option-type"},"string",-1))]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Ale=Te(Dle,[["__scopeId","data-v-59537c8a"]]);let Ole=class extends tn{constructor(e){super(e),this.renderVue(Ale,e)}},Nle=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Mle={type:"image-generation-node",model:Nle,view:Ole},Tle={class:"ai-dialogue-node"},$le={class:"field-list"},Ple={class:"field-item"},Rle={class:"field-item-content"},Ble={class:"field-list-item"},Lle={class:"field-text"},Ile={key:1},Fle={class:"field-item"},jle={class:"field-item-content"},Vle={class:"field-key"},Hle={class:"field-type"},Ule={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph"),i=He("getNode"),r=He("resetSize"),s=G([]),a=G([]),l=Je({input_variable:"",input_tags:[],output:[{key:"",typ:"string",subs:[]}]}),u=()=>{const h=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(h).json_encode||{}}catch{g={}}p(),g=JSON.parse(JSON.stringify(g)),l.input_variable=g.input_variable,l.input_tags=g.input_tags||[],l.output=g.output,Pt(()=>{r()})},c=()=>{const h=JSON.stringify({json_encode:{...l}});t({...e.node,node_params:h})},f=h=>{yo.includes(h.node_type)&&Pt(()=>{c()})},p=()=>{let h=i().getAllParentVariable();a.value=h||[]};return gt(()=>e.properties,u,{deep:!0}),ut(()=>{u(),r(),o().eventCenter.on("custom:setNodeName",f)}),no(()=>{o().eventCenter.off("custom:setNodeName",f)}),(h,g)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:s.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Tle,[d("div",$le,[d("div",Ple,[g[0]||(g[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",Rle,[d("div",Ble,[d("div",Lle,[l.input_variable.length>0?(w(),Q(yn,{key:0,options:a.value,defaultSelectedList:l.input_tags,defaultValue:l.input_variable,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",Ile,"--"))])])])]),d("div",Fle,[g[1]||(g[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",jle,[(w(!0),R(ae,null,ye(l.output,(m,_)=>(w(),R("div",{class:"field-value",key:_},[d("span",Vle,j(m.key),1),d("span",Hle,j(m.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},zle=Te(Ule,[["__scopeId","data-v-f18561b5"]]);let qle=class extends tn{constructor(e){super(e),this.renderVue(zle,e)}},Gle=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const Xle={type:"json-node",model:Gle,view:qle},Wle={class:"ai-dialogue-node"},Yle={class:"field-list"},Kle={class:"field-item"},Jle={class:"field-item-content"},Zle={class:"field-list-item"},Qle={class:"field-text"},eue={class:"field-item"},tue={class:"field-item-content"},nue={class:"field-key"},oue={class:"field-type"},iue={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=n,t=He("setData"),o=He("getGraph");He("getNode");const i=He("resetSize"),r=G([]),s=Je({input_variable:[],output:[{key:"",typ:"object",subs:[]}]}),a=()=>{const c=e.properties.dataRaw||e.properties.node_params||"{}";let f={};try{f=JSON.parse(c).json_decode||{}}catch{f={}}f=JSON.parse(JSON.stringify(f)),s.input_variable=wg(f.input_variable),s.output=f.output,Pt(()=>{i()})},l=()=>{const c=JSON.stringify({json_decode:{input_variable:s.input_variable?s.input_variable.join("."):"",...s}});t({...e.node,node_params:c})},u=c=>{yo.includes(c.node_type)&&Pt(()=>{l()})};return gt(()=>e.properties,a,{deep:!0}),ut(()=>{a(),i(),o().eventCenter.on("custom:setNodeName",u)}),no(()=>{o().eventCenter.off("custom:setNodeName",u)}),(c,f)=>(w(),Q(on,{properties:n.properties,title:e.properties.node_name,menus:r.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Wle,[d("div",Yle,[d("div",Kle,[f[0]||(f[0]=d("div",{class:"field-item-label"},"输入参数",-1)),d("div",Jle,[d("div",Zle,[d("div",Qle,[y(cr,{value:s.input_variable},null,8,["value"])])])])]),d("div",eue,[f[1]||(f[1]=d("div",{class:"field-item-label"},"输出字段",-1)),d("div",tue,[(w(!0),R(ae,null,ye(s.output,(p,h)=>(w(),R("div",{class:"field-value",key:h},[d("span",nue,j(p.key),1),d("span",oue,j(p.typ),1)]))),128))])])])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},rue=Te(iue,[["__scopeId","data-v-8655c63e"]]);let sue=class extends tn{constructor(e){super(e),this.renderVue(rue,e)}},aue=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e}]}};const lue={type:"json-reverse-node",model:aue,view:sue},uue={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{use_model:"",text:"",text_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.text_to_audio)==null?void 0:o.arguments)||{};this.formState.use_model=t.use_model||"--",this.formState.text=t.text||"",this.formState.text_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.text)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},due={class:"specify-reply-node"},cue={class:"static-field-list"},fue={class:"static-field-item"},pue={class:"static-field-item-content"},hue={class:"static-field-value"},vue={class:"static-field-item"},gue={class:"static-field-item-content"},_ue={class:"static-field-value"},mue={key:1};function yue(n,e,t,o,i,r){const s=Nt("at-text"),a=Nt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",due,[d("div",cue,[d("div",fue,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"语音模型",-1)),d("div",pue,[d("div",hue,j(i.formState.use_model),1)])]),d("div",vue,[e[1]||(e[1]=d("div",{class:"static-field-item-label"},"文本",-1)),d("div",gue,[d("div",_ue,[i.formState.text.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.text_tags,defaultValue:i.formState.text,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",mue,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const bue=Te(uue,[["render",yue],["__scopeId","data-v-5a0b558e"]]);let xue=class extends tn{constructor(e){super(e),this.renderVue(bue,e)}},wue=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Cue={type:"voice-synthesis-node",model:wue,view:xue},Sue={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:on,AtText:yn},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{file_url:"",file_url_tags:[]}}},computed:{},watch:{properties:{handler(n,e){n.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.init()},methods:{init(){var o,i;this.getValueOptions();let n=this.properties.dataRaw||this.properties.node_params||"{}",e=JSON.parse(n),t=((o=e==null?void 0:e.voice_clone)==null?void 0:o.arguments)||{};this.formState.file_url=t.file_url||"--",this.formState.file_url_tags=((i=t==null?void 0:t.tag_map)==null?void 0:i.file_url)||[],this.$nextTick(()=>{this.resetSize()})},getValueOptions(){let n=this.getNode().getAllParentVariable();this.valueOptions=n||[]}}},kue={class:"specify-reply-node"},Eue={class:"static-field-list"},Due={class:"static-field-item"},Aue={class:"static-field-item-content"},Oue={class:"static-field-value"},Nue={key:1};function Mue(n,e,t,o,i,r){const s=Nt("at-text"),a=Nt("node-common");return w(),Q(a,{properties:t.properties,title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:x(()=>[d("div",kue,[d("div",Eue,[d("div",Due,[e[0]||(e[0]=d("div",{class:"static-field-item-label"},"复刻音频",-1)),d("div",Aue,[d("div",Oue,[i.formState.file_url.length>0?(w(),Q(s,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.file_url_tags,defaultValue:i.formState.file_url,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(w(),R("span",Nue,"--"))])])])])])]),_:1},8,["properties","title","icon-name","isSelected","isHovered","node-key","node_type"])}const Tue=Te(Sue,[["render",Mue],["__scopeId","data-v-09ea7580"]]);let $ue=class extends tn{constructor(e){super(e),this.renderVue(Tue,e)}},Pue=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Rue={type:"voice-clone-node",model:Pue,view:$ue},Bue={class:"start-node"},Lue={class:"start-node-options"},Iue={class:"options-list"},Fue={class:"options-item"},jue={class:"option-label"},Vue={class:"start-node"},Hue={class:"start-node-options"},Uue={class:"options-list"},zue={class:"options-item"},que={class:"option-label"},Gue={__name:"index",props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=He("resetSize"),t=n;gt(()=>t.properties,(r,s)=>{const a=r.node_params||"{}",l=s.node_params||"{}";a!=l&&i()},{deep:!0});const o=Je({url:"",method:"GET",switch_verify:"1",switch_allow_ip:"0",allow_ips:"",params:[],form:[],x_form:[],json:[],request_content_type:"none",response_type:"now",response_now:""}),i=()=>{if(!t.properties||!t.properties.node_params)return;let s=JSON.parse(t.properties.node_params).trigger.trigger_web_hook_config;Object.assign(o,s),Pt(()=>{e()})};return ut(()=>{i()}),(r,s)=>(w(),Q(on,{title:n.properties.node_name,"icon-url":n.properties.node_icon,"icon-name":n.properties.node_icon_name,isSelected:n.isSelected,isHovered:n.isHovered,"node-key":n.properties.node_key,node_type:n.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Bue,[d("div",Lue,[s[0]||(s[0]=d("div",{class:"options-title"},"请求地址",-1)),d("div",Iue,[d("div",Fue,[d("div",jue,j(o.url),1)])])])]),d("div",Vue,[d("div",Hue,[s[1]||(s[1]=d("div",{class:"options-title"},"请求方式",-1)),d("div",Uue,[d("div",zue,[d("div",que,j(o.method),1)])])])])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key","node_type"]))}},Xue=Te(Gue,[["__scopeId","data-v-9df22500"]]);let Wue=class extends tn{constructor(e){super(e),this.renderVue(Xue,e)}},Yue=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t+i/2,y:o-r/2+25,id:l+"-anchor_right",type:"right",isHovered:s,isSelected:a,nodeId:e}]}};const Kue={type:"webhook-trigger-node",model:Yue,view:Wue},Jue={class:"ai-dialogue-node"},Zue={class:"field-list"},Que={class:"field-item"},ede={class:"field-item-content"},tde={class:"field-value"},nde={class:"field-key"},ode={class:"field-item"},ide={class:"field-item-content"},rde={class:"field-value"},sde={class:"field-key"},ade={class:"field-item"},lde={class:"field-item-content"},ude={class:"field-value"},dde={class:"field-key"},cde={key:0,class:"field-item"},fde={class:"field-item-content"},pde={class:"field-value"},hde={class:"field-key"},vde={key:1,class:"field-item"},gde={class:"field-item-content"},_de={class:"field-value"},mde={class:"field-key"},yde={key:2,class:"field-item"},bde={class:"field-item-content"},xde={class:"field-value"},wde={class:"field-key"},Cde={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(n){const e=$s(),t=Xe(()=>e.libraryLists),o=n,i=He("getNode"),r=He("resetSize"),s=G([]),a=G([]),l=Je({library_group_id:"0",library_id:[],import_type:"content",normal_url:"",normal_title:"",normal_content:"",normal_url_repeat_op:"import",qa_question:"",qa_answer:"",qa_images_variable:"",qa_similar_question_variable:"",qa_repeat_op:"import",outputs:[{key:"msg",typ:"string"}]}),u=Xe(()=>t.value.filter(g=>l.library_id.includes(g.id))),c=Xe(()=>{var g;return(g=u.value[0])==null?void 0:g.library_name}),f=Xe(()=>u.value&&u.value.length?u.value[0].type:-1),p=()=>{const g=o.properties.dataRaw||o.properties.node_params||"{}";let m={};try{h(),m=JSON.parse(g).library_import||{};for(let _ in m)_=="library_id"?l.library_id=m[_]?m[_].split(","):[]:l[_]=m[_]}catch{image_generation={}}Pt(()=>{r()})};function h(){let g=i().getAllParentVariable();s.value=g||[]}return gt(()=>o.properties,(g,m)=>{const _=g.dataRaw||g.node_params||"{}",v=m.dataRaw||m.node_params||"{}";_!=v&&p()},{deep:!0}),ut(()=>{p(),r()}),no(()=>{}),(g,m)=>(w(),Q(on,{properties:n.properties,title:o.properties.node_name,menus:a.value,"icon-name":o.properties.node_icon_name,isSelected:o.isSelected,isHovered:o.isHovered,"node-key":o.properties.node_key,node_type:o.properties.node_type,style:{width:"420px"}},{default:x(()=>[d("div",Jue,[d("div",Zue,[d("div",Que,[m[0]||(m[0]=d("div",{class:"field-item-label"},"知识库",-1)),d("div",ede,[d("div",tde,[d("span",nde,j(c.value),1)])])]),f.value==2?(w(),R(ae,{key:0},[d("div",ode,[m[1]||(m[1]=d("div",{class:"field-item-label"},"分段问题",-1)),d("div",ide,[d("div",rde,[d("span",sde,[y(yn,{options:s.value,defaultValue:l.qa_question},null,8,["options","defaultValue"])])])])]),d("div",ade,[m[2]||(m[2]=d("div",{class:"field-item-label"},"分段答案",-1)),d("div",lde,[d("div",ude,[d("span",dde,[y(yn,{options:s.value,defaultValue:l.qa_answer},null,8,["options","defaultValue"])])])])])],64)):ie("",!0),f.value!=2&&f.value>=0?(w(),R(ae,{key:1},[l.import_type=="content"?(w(),R("div",cde,[m[3]||(m[3]=d("div",{class:"field-item-label"},"文档标题",-1)),d("div",fde,[d("div",pde,[d("span",hde,[y(yn,{options:s.value,defaultValue:l.normal_title},null,8,["options","defaultValue"])])])])])):ie("",!0),l.import_type=="content"?(w(),R("div",vde,[m[4]||(m[4]=d("div",{class:"field-item-label"},"文档内容",-1)),d("div",gde,[d("div",_de,[d("span",mde,[y(yn,{options:s.value,defaultValue:l.normal_content},null,8,["options","defaultValue"])])])])])):ie("",!0),l.import_type=="url"?(w(),R("div",yde,[m[5]||(m[5]=d("div",{class:"field-item-label"},"文档URL",-1)),d("div",bde,[d("div",xde,[d("span",wde,[y(yn,{options:s.value,defaultValue:l.normal_url},null,8,["options","defaultValue"])])])])])):ie("",!0)],64)):ie("",!0)])])]),_:1},8,["properties","title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Sde=Te(Cde,[["__scopeId","data-v-08a0e459"]]);let kde=class extends tn{constructor(e){super(e),this.renderVue(Sde,e)}},Ede=class extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s)=>{if(i.id==r.id)return!1;const a=i.graphModel.edges.map(u=>u.sourceAnchorId),l=s.id;return s.type==="right"&&!a.includes(l)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r}=this,{nodeSortKey:s}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:s+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+25,id:s+"-anchor_right",type:"right",nodeId:e}]}};const Dde={type:"import-library-node",model:Ede,view:kde},Ade={name:"ZmWorkflowNode",components:{NodeCommon:on},inject:["getNode","getGraph","resetSize","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],robotAvatar:"",nodeParams:{},options:[]}},mounted(){this.init()},methods:{init(){var n,e,t;this.nodeParams=Po(this.properties.node_params),this.robotAvatar=(t=(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_info)==null?void 0:t.robot_avatar,this.loadRobotNode()},handleMenu(n){if(n.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},loadRobotNode(){var n,e;cg({robot_id:(e=(n=this.nodeParams)==null?void 0:n.workflow)==null?void 0:e.robot_id}).then(t=>{var i,r;let o=Po((i=t==null?void 0:t.data)==null?void 0:i.node_params);this.options=((r=o==null?void 0:o.start)==null?void 0:r.diy_global)||[],this.update(),this.$nextTick(()=>{this.resetSize()})})},update(){var t;let n=this.nodeParams,e=((t=n==null?void 0:n.workflow)==null?void 0:t.params)||[];if(!Array.isArray(e)||!e.length){let o=JSON.parse(JSON.stringify(this.options));for(let i of o)i.variable=String(i.variable||"");n.workflow.params=o,this.setData({node_params:JSON.stringify(n)})}}}},Ode={class:"start-node"},Nde={class:"start-node-options"},Mde={class:"options-list",style:{"max-height":"82px",overflow:"hidden"}},Tde={class:"option-label"},$de={class:"option-type"};function Pde(n,e,t,o,i,r){const s=Nt("node-common");return w(),Q(s,{properties:t.properties,title:t.properties.node_name,menus:i.menus,"icon-url":i.robotAvatar,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:r.handleMenu},{default:x(()=>[d("div",Ode,[d("div",Nde,[e[0]||(e[0]=d("div",{class:"options-title"},"输入参数",-1)),d("div",Mde,[(w(!0),R(ae,null,ye(i.options,a=>(w(),R("div",{class:Ct(["options-item",{"is-required":a.required}]),key:a.key},[d("div",Tde,j(a.key),1),d("div",$de,j(a.typ),1)],2))),128))])]),e[1]||(e[1]=d("div",{class:"start-node-options"},[d("div",{class:"options-title"},"异常处理"),d("div",{class:"options-list"},[d("div",{class:"options-item"},[d("div",{class:"option-label"},"运行代码报错时执行该分支")])])],-1))])]),_:1},8,["properties","title","menus","icon-url","isSelected","isHovered","node-key","onHandleMenu"])}const Rde=Te(Ade,[["render",Pde],["__scopeId","data-v-d1e8118b"]]);class Bde extends tn{constructor(e){super(e),this.renderVue(Rde,e)}}class Lde extends nn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(i,r,s,a)=>{if(i.id==r.id)return!1;const l=i.graphModel.edges.map(c=>c.sourceAnchorId),u=s.id;return s.type==="right"&&!l.includes(u)}},t={message:"分组里面的节点只能连接当前分组里面的节点,分组外面的节点只能连接分组外面的节点",validate:(i,r,s,a)=>i.properties.loop_parent_key?i.properties.loop_parent_key===r.properties.loop_parent_key:!r.properties.loop_parent_key};this.sourceRules=[e,t];const o={message:"只允许连接左边的锚点",validate:(i,r,s,a)=>i.id==r.id?!1:a.type==="left"};this.targetRules=[o]}getDefaultAnchor(){const{id:e,x:t,y:o,width:i,height:r,isHovered:s,isSelected:a}=this,{nodeSortKey:l}=this.properties;return[{x:t-i/2,y:o-r/2+24,id:l+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:o-r/2+24,id:l+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:o+r/2-28,id:l+"-anchor_right_exception",type:"right",nodeId:e}]}}const Ide={type:"zm-workflow-node",model:Lde,view:Bde};function Fde(n){Wt(uQ,n),Wt(bQ,n),Wt(IQ,n),Wt(GQ,n),Wt(Kee,n),Wt(eee,n),Wt(hee,n),Wt(lte,n),Wt(hte,n),Wt(xae,n),Wt(yte,n),Wt(Wte,n),Wt(Mte,n),Wt(rne,n),Wt(gne,n),Wt(Pne,n),Wt(Xne,n),Wt(loe,n),Wt(Roe,n),Wt(oie,n),Wt(Nie,n),Wt(Xie,n),Wt(tre,n),Wt(ose,n),Wt(uae,n),Wt(vae,n),Wt(Rae,n),Wt(ele,n),Wt(ple,n),Wt(Mle,n),Wt(Xle,n),Wt(lue,n),Wt(Cue,n),Wt(Rue,n),Wt(Kue,n),Wt(Dde,n),Wt(Ide,n)}const jde={class:"logic-flow-wrapper"},Qv="dont_show_delete_node_confirm",Vde={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(n,{expose:e,emit:t}){const o=t;let i=null;const r=G(null),{setStorage:s,getStorage:a}=ny(),l=G(a(Qv)||!1),u=G(null),c=G(!1),f=G(null),p=G(null),h=Tm(),g=G(""),m=G([]),_={nodes:[]},v={width:160,height:140,bottomPosition:24,rightPosition:16},b={exclusiveMode:!1},C=ke=>{i&&i.zoom(ke)};function M(){if(p.value){i=new $K({container:p.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[QJ,tZ,VZ,nZ,$m,Pm,$J,Nm,Om],pluginsOptions:{miniMap:v,selectionSelect:b,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),r.value=i,Fde(i),Wt(NZ,i),Wt(LZ,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:De})=>{g.value=De.flowId});let ke={},he=[];i.on("node:dragstart",({data:De})=>{let Me=i.graphModel.getElement(De.id);ke[Me.id]=Me.zIndex,he=[];let z=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);z?(z.properties.width=z._width,z.properties.height=z._height):Me.properties.loop_parent_key||(Me.properties.disabled_add_group=!0),De.children&&De.children.length>0?(Me.setZIndex(-9999),he=De.children||[],he.forEach(ne=>{let se=i.getNodeModelById(ne);ke[se.id]=se.zIndex,se.setZIndex(999999)})):Me.setZIndex(999999),Me.refreshBranch()}),i.on("node:drop",({data:De})=>{let Me=i.graphModel.getElement(De.id),z=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);De.properties.loop_parent_key&&!z&&i.getNodeModelById(De.properties.loop_parent_key).addChild(De.id),De.children&&De.children.length?(Me.setZIndex(-9999),De.children.forEach(ne=>{let se=i.getNodeModelById(ne);se.setZIndex(ke[se.id])})):Me.setZIndex(ke[Me.id]),Me.refreshBranch()}),i.on("node:drag",({data:De})=>{const Me=De.id,z=i.graphModel.getNodeEdges(Me),ne=i.graphModel.dynamicGroup.getGroupByNodeId(De.id);setTimeout(()=>{z.forEach(se=>{if(se.type==="custom-bezier-edge"){const{startPoint:Ee,endPoint:fe}=se,Le=fe.x-Ee.x,Ie=fe.y-Ee.y;let We=10+Math.sqrt(Le*Le+Ie*Ie)*.3;const lt=10,de=1e3;We=Math.round(We),We=Math.max(lt,Math.min(We,de)),se.setProperties({offset:We})}}),ne&&ne.refreshBranch()},0)}),i.on("node:add",()=>{}),i.on("custom:addNode",De=>{T(De)}),i.on("custom:addGroupNode",({data:De,group_id:Me})=>{F(De,Me)}),i.on("group:add-node",({childId:De})=>{i.getNodeModelById(De).properties.loop_parent_key}),i.on("element:click",De=>{m.value=[De.data]}),i.on("node:click",({data:De})=>{ce(De)}),i.on("blank:click",()=>{tt()}),i.on("selection:selected",De=>{let Me=[];De.elements.forEach(z=>{let ne=i.getDataById(z.id);(z.BaseType==="node"||z.BaseType==="edge")&&Me.push(ne)}),m.value=Me}),i.on("node:delete",({data:De})=>{let Me=JSON.parse(JSON.stringify(De));ge(Me)}),i.on("edge:delete",({data:De})=>{let Me=JSON.parse(JSON.stringify(De));_e(Me)}),i.on("custom:node:delete",De=>{Z(De)}),i.on("custom:edge:delete",De=>{le(De)}),i.on("custom:keyoard:delete",()=>{te()}),i.on("custom:paste",P),i.render(_),i.setZoomMiniSize(.01),i.setZoomMaxSize(8)}}const O=ke=>{const he=qf(),De=JSON.parse(ke.properties.node_params),{trigger_list:Me}=De.start,z=[],ne=[];let se=0;return Me.forEach(Ee=>{const fe=`trigger_${Ee.trigger_type}`,Le=Yi(fe),Ie=he[fe],Ve=Le.substring(0,8)+Le.substring(Le.length-8),et=Yi(fe),nt=Ud(Ee);nt.id=Le,nt.x=ke.x-600,nt.y=ke.y+se,nt.properties.node_key=Le,nt.properties.nodeSortKey=Ve;const We={id:et,sourceNodeId:Le,targetNodeId:ke.id,properties:{isTriggerEdge:!0}};se+=Ie.height+50,z.push(nt),ne.push(We)}),{nodes:z,edges:ne}},k=()=>{const ke=JSON.parse(JSON.stringify(i.getGraphRawData())),he=[],De=[],Me=[];return ke.edges.forEach(z=>{z.properties.isTriggerEdge||De.push(z)}),ke.nodes.forEach(z=>{z.properties.isTriggerNode?Me.push(z):he.push(z)}),ke.nodes=he,ke.edges=De,ke.triggers=Me,ke},E=ke=>{const he=qf();let De={nodes:[],edges:[]};ke.nodes.forEach(z=>{let ne=he[z.type];z.properties.node_icon_name=ne.properties.node_icon_name,z.properties.node_header_bg_color||(z.properties.node_header_bg_color=ne.properties.node_header_bg_color||"#fff"),z.properties.width||(z.properties.width=ne.width),z.properties.height||(z.properties.height=ne.height),z.type=="start-node"&&(De=O(z))}),ke.nodes.unshift(...De.nodes),i.clearData(),i.graphModel.graphDataToModel(ke),i.graphModel.translateCenter(),i.extension.miniMap.show(),De.edges.forEach(z=>{i.graphModel.addEdge(z)});const Me=i.extension.canvasHistory;Me&&Me.setInitialState(ke),S(ke.nodes)},S=ke=>{Pt(()=>{ke.forEach(he=>{if(he.loop_parent_key){const De=i.getNodeModelById(he.loop_parent_key);De&&(De.addChild(he.id),i.graphModel.dynamicGroup.sendNodeToFront(De))}})})};let N={};const L=()=>{const{nodes:ke}=i.graphModel,he=ke.find(z=>z.type==="start-node"),De=he.x-600,Me=he.y;return{x:De,y:Me}},$=(ke,he)=>{const De=he.x-he.width/2,Me=he.x+he.width/2,z=he.y-he.height/2,ne=he.y+he.height/2,se=ke.x-ke._width/2,Ee=ke.x+ke._width/2,fe=ke.y-ke._height/2,Le=ke.y+ke._height/2;let Ie=!1,Ve=ke._width,et=ke._height,nt=0,We=0;if(Me>Ee-20){const lt=Me-Ee+50;Ve+=lt,nt+=lt/2,Ie=!0}if(De<se+20){const lt=se-De+50;Ve+=lt,nt-=lt/2,Ie=!0}if(ne>Le-20){const lt=ne-Le+50;et+=lt,We+=lt/2,Ie=!0}if(z<fe+20){const lt=fe-z+50;et+=lt,We-=lt/2,Ie=!0}Ie&&(ke.properties.width=Ve,ke.properties.height=et,ke._width=Ve,ke._height=et,ke.width=Ve,ke.height=et,ke.x+=nt,ke.y+=We)},B=ke=>{const he=ke.node||ke,De=ke.anchorData,Me=ke.event;if(he.id=he.id||Yi(he.type),he.nodeSortKey=he.id.substring(0,8)+he.id.substring(he.id.length-8),De){let z=i.graphModel.dynamicGroup.getGroupByNodeId(De.nodeId);z?he.properties.loop_parent_key=z.id:he.properties.disabled_add_group=!0}if(ke.isCopy||(N[he.type]?(N[he.type]=N[he.type]+1,he.properties.node_name=he.properties.node_name+N[he.type]):N[he.type]=1),he.properties.width=he.width,he.properties.height=he.height,he.properties.nodeSortKey=he.nodeSortKey,Me){const{transformModel:z}=i.graphModel,{left:ne,top:se}=p.value.getBoundingClientRect(),[Ee,fe]=z.HtmlPointToCanvasPoint([Me.clientX-ne,Me.clientY-se]);he.x=Ee+he.width/2,he.y=fe+he.height/2}else if(!he.x&&!he.y)if(De)he.x=De.x+he.width+100,he.y=De.y+he.height/2-24;else if(ke.isTriggerNode){let z=L();he.x=z.x,he.y=z.y,he.properties.disabled_add_group=!0}else{const{transformModel:z}=i.graphModel,ne=z.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);he.x=ne[0],he.y=ne[1],he.properties.disabled_add_group=!0}return he},A=ke=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:27,node_name:"循环开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},ke.id)},100)},D=ke=>{setTimeout(()=>{F({node:{type:"group-start-node",with:200,properties:{node_type:31,node_name:"批量执行开始",node_icon_name:"start-node",node_params:JSON.stringify({})}}},ke.id)},100)},T=ke=>{const he=B(ke),De=ke.model,Me=ke.anchorData;let z=!1;if(i.graphModel.nodes.forEach(se=>{!z&&se.type=="session-trigger-node"&&(z=!0)}),z&&he.type=="session-trigger-node")return xt.error("请勿添加多个会话触发器");let ne=i.addNode(he);if(ne.type=="custom-group"&&A(ne),ne.type=="batch-group"&&D(ne),ke.isTriggerNode){const{nodes:se}=i.graphModel,Ee=se.find(Le=>Le.type==="start-node");let fe={type:"custom-bezier-edge",sourceNodeId:he.id,targetNodeId:Ee.id,properties:{isTriggerEdge:!0}};i.graphModel.addEdge(fe),i.graphModel.eventCenter.emit("custom:trigger-add",he)}if(Me){let se=ne.anchors.find(fe=>fe.type==="left");i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:De.id,targetNodeId:ne.id,sourceAnchorId:Me.id,targetAnchorId:se.id,startPoint:{x:Me.x,y:Me.y},endPoint:{x:se.x,y:se.y}});const Ee=i.graphModel.dynamicGroup.getGroupByNodeId(Me.nodeId);if(Ee&&Ee.id){const fe=i.getNodeModelById(Ee.id);fe.addChild(ne.id),$(fe,ne),i.graphModel.dynamicGroup.sendNodeToFront(fe)}}i.graphModel.clearSelectElements(),ne.setSelected(!0)},F=(ke,he)=>{const De=ke.node||ke;De.id=Yi(De.type),De.nodeSortKey=De.id.substring(0,8)+De.id.substring(De.id.length-8),De.properties.width=De.width,De.properties.height=De.height,De.properties.nodeSortKey=De.nodeSortKey,De.properties.loop_parent_key=he;const Me=i.getNodeModelById(he);De.x=Me.x,De.y=Me.y;let z=0;i.graphModel.nodes.forEach(se=>{se.zIndex>z&&(z=se.zIndex)}),z=z+99;let ne=i.addNode(De);Me.addChild(ne.id),ne.setZIndex(z),i.graphModel.clearSelectElements(),i.graphModel.dynamicGroup.sendNodeToFront(Me)},V=async()=>{const ke=i.getGraphRawData(),he=i.extension.canvasHistory;he&&he.beginTransaction(),i.extension.elk.layout(ke).then(()=>{he&&he.commitTransaction("auto-layout")}).catch(De=>{xt.error("布局失败，请检查"+De),he&&he.rollbackTransaction()})},P=({originalNodes:ke,basePoint:he,pasteBasePoint:De})=>{const Me=i.extension.canvasHistory;Me&&Me.beginTransaction();try{const z=ke.map(se=>{const Ee=se.x-he.x,fe=se.y-he.y,Le=JSON.parse(JSON.stringify(se));return Le.x=De.x+Ee,Le.y=De.y+fe,B({node:Le,isCopy:!0})}),{nodes:ne}=i.addElements({nodes:z});i.clearSelectElements(),ne.forEach(se=>{se.setSelected(!0)})}finally{Me&&Me.commitTransaction("paste")}},X=ke=>{ke.height&&(ke.properties.height=ke.height);let he=i.getNodeModelById(ke.id);he.height=ke.properties.height||ke.height||he.height,he.properties=ke.properties,ke.properties.node_type==2&&ke.properties.node_sub_type==21&&he.graphModel.getNodeEdges(ke.id).forEach(Me=>{Me.sourceNodeId==he.id&&(he.getAnchorInfo(Me.sourceAnchorId)||he.graphModel.deleteEdgeById(Me.id))}),he.refreshBranch()};function oe(ke){return i.getNodeModelById(ke.id)}function H(ke){return i.getEdgeModelById(ke.id)}function W(){const{nodes:ke}=i.getGraphData();return ke.filter(De=>De.properties.isTriggerNode)}const Z=ke=>{ke&&ke.id&&(m.value=[ke]),q()},le=ke=>{ke&&ke.id&&(m.value=[ke]),q()},te=()=>{let ke=i.getSelectElements(!0);m.value=[...ke.nodes,...ke.edges],q()},q=()=>{if(m.value.length===0)return;const ke=m.value.filter(Me=>oe(Me)?!["start-node","group-start-node"].includes(Me.type):!0);if(ke.length===0){m.value=[];return}const he=m.value.filter(Me=>Me.properties.isTriggerNode===!0);if(he.length>0&&W().length-he.length<1){xt.error("请至少保留一个触发器！");return}const De=()=>{const Me=i.extension.canvasHistory;Me&&Me.replaceLastState("replace-before-delete");let z=!1;ke.forEach(ne=>{oe(ne)?(ne.properties.isTriggerNode&&(z=!0),i.deleteNode(ne.id)):H(ne)&&i.deleteEdge(ne.id)}),z&&i.graphModel.eventCenter.emit("custom:trigger-change",null),Me&&Me.saveCurrentState("delete"),m.value=[],i.clearSelectElements()};if(l.value){De();return}if(ke.length>1||ke.length===1&&oe(ke[0])){const Me=ke.length>1?"批量删除":"删除节点",z=`确定要删除选中的 ${ke.length} 个元素吗？`;let ne=!1;vn.confirm({title:Me,content:Tt("div",{},[Tt("p",z),Tt(vg,{class:"dont-show-again-checkbox",onChange:se=>{ne=se.target.checked}},()=>"不再提示")]),onOk:()=>{ne&&(l.value=!0,s(Qv,!0)),De()},onCancel:()=>{}})}else De()},re=["group-start-node","terminate-node"],ce=ke=>{const he=JSON.parse(JSON.stringify(ke));he.properties.dataRaw=he.properties.dataRaw||he.properties.node_params,o("selectNode",he),!re.includes(ke.type)&&(f.value=he,c.value=!0)},ve=ke=>{f.value.properties=ke,X(JSON.parse(JSON.stringify(f.value)))},Ne=ke=>{f.value.properties.node_name=ke,X(JSON.parse(JSON.stringify(f.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:ke,node_id:f.value.id,node_type:f.value.type})},ge=ke=>{o("onDeleteNode",ke),f.value&&ke.id===f.value.id&&(c.value=!1,setTimeout(()=>{f.value=null},350))},_e=ke=>{o("onDeleteEdge",ke)},st=()=>{o("runTest")},tt=()=>{o("blankClick"),c.value&&(c.value=!1),m.value.length>0&&(m.value=[],i.clearSelectElements())};return ut(()=>{M()}),Gc(()=>{i&&i.destroy&&i.destroy()}),e({lfRef:r,setData:E,getData:k,updateNode:X}),(ke,he)=>(w(),R("div",jde,[d("div",{ref_key:"containerRef",ref:p,class:"logic-flow-container"},null,512),y(K(h),{"flow-id":g.value},null,8,["flow-id"]),K(i)?(w(),Q(JS,{key:0,lf:K(i),onRunTest:st,onAddNode:T,onZoomChange:C,onAutoLayout:V},null,8,["lf"])):ie("",!0),f.value?(w(),Q(rq,{key:1,ref_key:"nodeFormDrawerRef",ref:u,open:c.value,"onUpdate:open":he[0]||(he[0]=De=>c.value=De),destroyOnClose:!0,"node-id":f.value.id,node:f.value.properties,"node-type":f.value.type,lf:K(i),onUpdateNode:ve,onChangeTitle:Ne},null,8,["open","node-id","node","node-type","lf"])):ie("",!0)]))}},Hde={class:"modal-title-block"},Ude={key:0,class:"run-detail"},zde={class:"flex-content-box"},qde={class:"test-model-box"},Gde={key:2,class:"input-list-box"},Xde={class:"add-btn-box"},Wde={key:0,class:"result-list-box loading-box"},Yde={key:1,class:"result-list-box"},Kde=["onClick"],Jde={class:"status-block"},Zde={class:"icon-name-box"},Qde=["src"],ece={class:"node-name"},tce={key:0,class:"time-tag"},nce={class:"right-active-icon"},oce={class:"save-btn-box"},ice={class:"preview-box"},rce={class:"preview-title"},sce={class:"icon-name-box"},ace=["src"],lce={class:"node-name"},uce={key:0,class:"time-tag"},dce={key:0,class:"preview-content-block"},cce={class:"preview-img-box"},fce={class:"preview-content-block"},pce={class:"title-block"},hce={class:"preview-code-box"},vce={class:"preview-content-block"},gce={class:"title-block"},_ce={class:"preview-code-box"},mce={class:"preview-content-block"},yce={class:"title-block"},bce={class:"preview-code-box"},xce={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(n,{expose:e,emit:t}){const o={openid:"38fjp8344ru43",question:"你好",question_multiple:'{"type":"text", "text":"这是什么"}',conversationid:"12345"},i=n,r=Xe(()=>i.start_node_params.diy_global||[]),s=t,a=As().query,l=G(!1),u=G(""),c=G([]),f=Xe(()=>u.value?c.value.filter(V=>V.node_key==u.value)[0]:null),p=Xe(()=>{let V=[];if(f.value&&f.value.node_type==33){let P=f.value.output;for(let X in P)X.includes("picture_url_")&&V.push(P[X])}return V}),h=G(!1),g=Je({is_draft:!0,robot_key:a.robot_key,global:"",globalState:{}}),m=()=>{if(b(),i.isLockedByOther){xt.warning("当前已有其他用户在编辑中，无法运行测试");return}s("save","automatic");let V=localStorage.getItem("workflow_run_test_data")||"{}";V=JSON.parse(V),g.global=V.global||"",c.value=[],u.value="",s("getGlobal"),Pt(()=>{r.value.forEach(P=>{g.globalState[P.key]=_(P)});try{let P=V.global?JSON.parse(V.global):{};for(let X in g.globalState)P[X]&&(Array.isArray(P[X])?g.globalState[X]=P[X].map(oe=>({value:typeof oe=="object"?JSON.stringify(oe):oe,key:Math.random()*1e3})):g.globalState[X]=P[X])}catch(P){}}),l.value=!0};function _(V){return V.typ=="string"||V.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function v(){let V={};return r.value.forEach(P=>{if(P.typ=="string"){const X=(g.globalState[P.key]||"").trim();V[P.key]=X||(o[P.key]??"")}if(P.typ=="number"){const X=g.globalState[P.key];if(X!==""&&X!=null)V[P.key]=+X;else{const oe=o[P.key];V[P.key]=oe!=null&&oe!==""&&!isNaN(Number(oe))?Number(oe):""}}if(P.typ.includes("array")){let X=g.globalState[P.key].map(oe=>(oe.value=typeof oe.value=="string"?oe.value.trim():oe.value,id(oe.value)?JSON.parse(oe.value):oe.value)).filter(oe=>oe);if((!Array.isArray(X)||X.length===0)&&o[P.key]){const oe=o[P.key];id(oe)?X=[JSON.parse(oe)]:X=[oe]}V[P.key]=X}P.typ==="object"&&id(P.value)&&(V[P.key]=JSON.parse(P.value))}),JSON.stringify(V)}function b(){const P=i.lf.getGraphData().nodes.find(X=>X.type==="session-trigger-node");if(P){const oe=JSON.parse(P.properties.node_params||"{}").trigger||{};return oe.chat_config?oe.chat_config.question_multiple_switch:!1}}const C=(V,P)=>{g.globalState[V].splice(P,1)},M=V=>{g.globalState[V].push({value:"",key:Math.random()*1e4})},O=G(null),k=G(0),E=G(0),S=()=>{O.value.validate().then(()=>{let V={...g};const P=b();V.global=v(),delete V.globalState,h.value=!0,c.value=[];const X=F();Object.keys(X).length&&localStorage.setItem("workflow_run_test_data",JSON.stringify({global:JSON.stringify(X)})),cy({...V,question_multiple_switch:P}).then(oe=>{xt.success("测试结果生成完成");let H=oe.data.node_logs||[];k.value=oe.data.use_token,E.value=oe.data.use_mills,N(H)}).catch(oe=>{c.value=[];let H=oe.data.node_logs||[];H&&H.length&&N(H)}).finally(()=>{h.value=!1})})},N=V=>{var P;c.value=V.map(X=>({...X,is_success:X.error_msg==="<nil>",node_icon:Lu(X.node_type)})),u.value=(P=c.value[0])==null?void 0:P.node_key},L=V=>{u.value=V.node_key},$=V=>{Os(JSON.stringify(f.value[V])),xt.success("复制成功")},B=()=>{m()};function A(V){const P=o[V.key];return P?`${P}`:"请输入"}function D(V){try{return JSON.parse(V)}catch{return null}}function T(V,P){return JSON.stringify(V)===JSON.stringify(P)}function F(){const V={};return r.value.forEach(P=>{const X=P.key;if(P.typ==="string"){const oe=String(g.globalState[X]||"").trim();if(!oe)return;const H=o[X];if(H!=null&&oe===String(H))return;V[X]=oe;return}if(P.typ==="number"){const oe=g.globalState[X];if(oe===""||oe==null)return;const H=+oe,W=o[X];if(W!=null&&!isNaN(Number(W))&&H===Number(W))return;V[X]=H;return}if(P.typ.includes("array")){const H=(Array.isArray(g.globalState[X])?g.globalState[X]:[]).map(le=>String((le==null?void 0:le.value)||"").trim()).filter(le=>le).map(le=>{const te=D(le);return te??le});if(!H.length)return;let W=[];const Z=o[X];if(Z!=null){const le=D(String(Z));W=le!=null?[le]:[String(Z)]}if(W.length&&T(H,W))return;V[X]=H;return}}),V}return e({open:B}),(V,P)=>{const X=wi,oe=ii,H=ln,W=$n,Z=Vn,le=Kt,te=kn,q=wn,re=mo,ce=vn;return w(),R("div",null,[y(ce,{open:l.value,"onUpdate:open":P[3]||(P[3]=ve=>l.value=ve),footer:null,width:820,wrapClassName:"no-padding-modal"},{title:x(()=>[d("div",Hde,[P[4]||(P[4]=U("运行测试 ",-1)),c.value.length?(w(),R("div",Ude,[d("span",null,"总耗时："+j(K(tf)(E.value)),1),d("span",null,"token消耗："+j(k.value)+" Tokens",1)])):ie("",!0)])]),default:x(()=>[d("div",zde,[d("div",qde,[P[7]||(P[7]=d("div",{class:"top-title"},"开始节点参数",-1)),y(q,{model:g,ref_key:"formRef",ref:O,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:x(()=>[(w(!0),R(ae,null,ye(r.value,ve=>(w(),Q(te,{name:["globalState",ve.key],key:ve.key,rules:[{required:ve.required,message:`请输入${ve.key}`}]},{label:x(()=>[y(oe,{gap:4},{default:x(()=>[U(j(ve.key)+" ",1),y(X,{style:{margin:"0"}},{default:x(()=>[U(j(ve.typ),1)]),_:2},1024)]),_:2},1024)]),default:x(()=>[ve.typ=="string"?(w(),Q(H,{key:0,placeholder:A(ve),value:g.globalState[ve.key],"onUpdate:value":Ne=>g.globalState[ve.key]=Ne},null,8,["placeholder","value","onUpdate:value"])):ie("",!0),ve.typ=="number"?(w(),Q(W,{key:1,style:{width:"100%"},placeholder:A(ve),value:g.globalState[ve.key],"onUpdate:value":Ne=>g.globalState[ve.key]=Ne},null,8,["placeholder","value","onUpdate:value"])):ie("",!0),ve.typ.includes("array")?(w(),R("div",Gde,[(w(!0),R(ae,null,ye(g.globalState[ve.key],(Ne,ge)=>(w(),R("div",{class:"input-list-item",key:ge},[y(Z,null,{default:x(()=>[y(H,{placeholder:A(ve),value:Ne.value,"onUpdate:value":_e=>Ne.value=_e},null,8,["placeholder","value","onUpdate:value"])]),_:2},1024),g.globalState[ve.key].length>1?(w(),Q(K(Jt),{key:0,onClick:_e=>C(ve.key,ge)},null,8,["onClick"])):ie("",!0)]))),128)),d("div",Xde,[y(le,{onClick:Ne=>M(ve.key),block:"",type:"dashed"},{default:x(()=>[...P[5]||(P[5]=[U("添加",-1)])]),_:1},8,["onClick"])])])):ie("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),h.value?(w(),R("div",Wde,[h.value?(w(),Q(re,{key:0,tip:"测试结果生成中..."})):ie("",!0)])):ie("",!0),c.value.length>0?(w(),R("div",Yde,[(w(!0),R(ae,null,ye(c.value,(ve,Ne)=>(w(),R("div",{class:Ct(["list-item-block",{active:u.value==ve.node_key}]),onClick:ge=>L(ve),key:Ne},[d("div",Jde,[ve.is_success?(w(),Q(K(Ua),{key:0,style:{color:"#138b1b"}})):(w(),Q(K(Ru),{key:1,style:{color:"#d81e06"}}))]),d("div",Zde,[d("img",{src:ve.node_icon,alt:""},null,8,Qde),d("div",ece,j(ve.node_name),1)]),ve.is_success?(w(),R("div",tce,j(ve.use_time)+"ms",1)):ie("",!0),d("div",nce,[y(K(Bu))])],10,Kde))),128))])):ie("",!0),d("div",oce,[y(le,{loading:h.value,onClick:S,style:{"background-color":"#00ad3a"},type:"primary"},{default:x(()=>[y(K(ni)),P[6]||(P[6]=U("运行测试",-1))]),_:1},8,["loading"])])]),d("div",ice,[f.value?(w(),R(ae,{key:0},[d("div",rce,[P[8]||(P[8]=d("div",{class:"title-text"},"日志详情",-1)),d("div",sce,[d("img",{src:f.value.node_icon,alt:""},null,8,ace),d("div",lce,j(f.value.node_name),1)]),f.value.is_success?(w(),R("div",uce,j(f.value.use_time)+"ms",1)):ie("",!0)]),p.value.length>0?(w(),R("div",dce,[P[9]||(P[9]=d("div",{class:"title-block"},"生成图像日志",-1)),d("div",cce,[y(Lm,{currentImageList:p.value},null,8,["currentImageList"])])])):ie("",!0),d("div",fce,[d("div",pce,[P[10]||(P[10]=U("输入",-1)),y(K(Oo),{onClick:P[0]||(P[0]=ve=>$("input"))})]),d("div",hce,[y(K(Mo),{data:f.value.input},null,8,["data"])])]),d("div",vce,[d("div",gce,[P[11]||(P[11]=U("输出",-1)),y(K(Oo),{onClick:P[1]||(P[1]=ve=>$("node_output"))})]),d("div",_ce,[y(K(Mo),{data:f.value.node_output},null,8,["data"])])]),d("div",mce,[d("div",yce,[P[12]||(P[12]=U("运行日志",-1)),y(K(Oo),{onClick:P[2]||(P[2]=ve=>$("output"))})]),d("div",bce,[y(K(Mo),{data:f.value.output},null,8,["data"])])])],64)):ie("",!0)])])]),_:1},8,["open"])])}}},wce=Te(xce,[["__scopeId","data-v-f51ea803"]]),Cce=["data-lf"],Sce={class:"header-content"},kce={key:1,class:"robot-status-box status-0"},Ece={key:0,class:"header-right"},Dce={key:0,class:"last-save-time"},Ace={key:0,class:"auto-save-hint"},Oce={style:{display:"flex","align-items":"center",gap:"8px"}},Nce={class:"lock-config"},Mce={style:{"margin-top":"24px","text-align":"right"}},Tce={key:1,class:"lock-tip"},$ce={class:"lock-info"},Pce={__name:"page-header",props:{lf:{default:()=>null,type:Object},saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(n,{expose:e,emit:t}){const o=jn(),i=Xe(()=>o.robotInfo),r=t,s=n,a=G(null),l=dg(),u=Xe(()=>{var S;const E=(S=l.userInfo)==null?void 0:S.role_type;return E==1||E==2}),c=G(!1),f=G(10),p=G(!1),h=async()=>{p.value=!0;try{await py({draft_exptime:f.value}),xt.success("编辑锁设置已保存"),c.value=!1}catch{xt.error("保存失败，请稍后重试")}finally{p.value=!1}};ut(async()=>{var E;try{const S=await fy(),N=+((E=S==null?void 0:S.data)==null?void 0:E.draft_exptime);typeof N=="number"&&(f.value=Math.max(10,Math.min(60,Math.round(N))))}catch{}});const g=()=>{},m=()=>{r("edit")},_=(E="handle")=>{const S=cs();let N=!1;const L=[],$=B=>{N=!0;const A=(B==null?void 0:B.component)||"未命名组件",D=(B==null?void 0:B.typeDisplay)||(B==null?void 0:B.type)||"";(Array.isArray(B==null?void 0:B.errors)?B.errors:[]).forEach(F=>{L.push(`【${A}${D?" - "+D:""}】字段「${F.field_name}」：${F.message}`)})};if(S.on&&S.on("workflow:validate:error",$),S.emit&&S.emit("workflow:validate",{action:"save"}),S.off&&S.off("workflow:validate:error",$),N){vn.warning({title:"表单未完成",content:L.length?Tt("div",L.map(B=>Tt("div",B))):"请完善必填项后再保存"});return}r("save",E)},v=()=>{const E=cs();let S=!1;const N=[],L=$=>{S=!0;const B=($==null?void 0:$.component)||"未命名组件",A=($==null?void 0:$.typeDisplay)||($==null?void 0:$.type)||"";(Array.isArray($==null?void 0:$.errors)?$.errors:[]).forEach(T=>{N.push(`【${B}${A?" - "+A:""}】字段「${T.field_name}」：${T.message}`)})};if(E.on&&E.on("workflow:validate:error",L),E.emit&&E.emit("workflow:validate",{action:"release"}),E.off&&E.off("workflow:validate:error",L),S){vn.warning({title:"表单未完成",content:N.length?Tt("div",N.map($=>Tt("div",$))):"请完善必填项后再发布"});return}r("release")},b=()=>{r("getGlobal")},C=()=>{r("getVersionRecord")},M=()=>{r("edit")},O=()=>{a.value.open()};function k(E,S="YY-MM-DD HH:mm:ss"){return!E||E<=0?"--":ho(E*1e3).format(S)}return e({openRunTest:O}),(E,S)=>{const N=Kt,L=Qt,$=Nn,B=$n,A=Va;return w(),R("div",{class:"page-header","data-lf":n.lf},[d("div",Sce,[y(Tw),i.value.start_node_key!=""?(w(),R("div",{key:0,class:"robot-status-box status-1",onClick:m},[y(K(Ua),{class:"robot-status-icon"}),S[6]||(S[6]=d("div",{class:"robot-status-text"},"已发布",-1))])):(w(),R("div",kce,[y(K(Qc),{class:"robot-status-icon"}),S[7]||(S[7]=d("div",{class:"robot-status-text"},"未发布",-1))]))]),s.showRight?(w(),R("div",Ece,[n.currentVersion==""&&n.isEditing?(w(),R(ae,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(w(),R("div",Dce,[U(j(k(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+j(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),n.isEditing&&!n.isLockedByOther&&(!n.autoSaveEnabled||!n.isLeader)?(w(),R("span",Ace,"你可能已在其他页面编辑，已停止自动保存")):ie("",!0)])):ie("",!0),n.isLockedByOther?ie("",!0):(w(),R(ae,{key:1},[y(N,{class:"save-draft",onClick:S[0]||(S[0]=D=>_("handle"))},{default:x(()=>[...S[8]||(S[8]=[U("保存草稿",-1)])]),_:1}),y(N,{type:"primary",loading:s.saveLoading,class:"publish-robot",onClick:v},{default:x(()=>[...S[9]||(S[9]=[U("发布机器人",-1)])]),_:1},8,["loading"])],64))],64)):ie("",!0),!n.isEditing&&!n.currentVersion||n.isLockedByOther?(w(),Q(N,{key:1,disabled:n.isLockedByOther,type:"primary",class:"ml8",onClick:M},{icon:x(()=>[y(K(kr))]),default:x(()=>[S[10]||(S[10]=U(" 编辑 ",-1))]),_:1},8,["disabled"])):ie("",!0),y(L,{title:"历史发布详情"},{default:x(()=>[y(N,{onClick:S[1]||(S[1]=D=>C())},{default:x(()=>[y(K(Hy))]),_:1})]),_:1}),u.value?(w(),Q(A,{key:2,trigger:"click",placement:"bottomRight",open:c.value,"onUpdate:open":S[5]||(S[5]=D=>c.value=D),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:g},{title:x(()=>[d("div",Oce,[y($,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),S[11]||(S[11]=d("span",{style:{color:"#262626"}},"编辑锁设置",-1)),S[12]||(S[12]=d("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:x(()=>[d("div",Nce,[S[13]||(S[13]=d("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),y(B,{value:f.value,"onUpdate:value":S[2]||(S[2]=D=>f.value=D),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),S[14]||(S[14]=d("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),d("div",Mce,[y(N,{class:"ml8",onClick:S[3]||(S[3]=D=>c.value=!1)},{default:x(()=>[...S[15]||(S[15]=[U("取 消",-1)])]),_:1}),y(N,{type:"primary",class:"ml8",loading:p.value,onClick:h},{default:x(()=>[...S[16]||(S[16]=[U("保 存",-1)])]),_:1},8,["loading"])])]),default:x(()=>[y(N,{class:"",onClick:S[4]||(S[4]=D=>c.value=!0),style:{padding:"5px 9px"}},{default:x(()=>[y($,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):ie("",!0)])):ie("",!0),n.isLockedByOther?(w(),R("div",Tce,[S[17]||(S[17]=d("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),d("div",$ce,"（"+j("用户："+n.loginUserName||"--")+" "+j("IP："+n.lockRemoteAddr||"--")+" "+j("User Agent："+n.lockUserAgent||"--")+"）",1)])):ie("",!0),y(wce,{ref_key:"runTestRef",ref:a,lf:n.lf,start_node_params:n.start_node_params,onGetGlobal:b,onSave:_,isLockedByOther:n.isLockedByOther},null,8,["lf","start_node_params","isLockedByOther"])],8,Cce)}}},Rce=Te(Pce,[["__scopeId","data-v-1c13b7e1"]]),Bce={class:"form-box"},Lce={class:"form-item"},Ice={class:"form-content"},Fce={class:"version-input-box"},jce={class:"form-item"},Vce={class:"form-content"},eg="wf_uni_identifier",Hce={__name:"version-model",emits:["ok"],setup(n,{expose:e,emit:t}){const o=As().query,i=G(!1);let r="";const s=jn(),a=G(""),l=G(""),u=G(""),c=G(""),f=G(!1),p=t,h=b=>{v(),c.value="",r=b,i.value=!0},g=()=>{try{let b=localStorage.getItem(eg);return b||(b=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(eg,b)),b}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},m=()=>{try{const b=navigator.userAgent||"",C=navigator.platform||"";let M="Unknown";/Windows/i.test(b)?M="Windows":/Macintosh|Mac OS X/i.test(b)?M="MacOS":/Linux/i.test(b)?M="Linux":/Android/i.test(b)?M="Android":/iPhone|iPad|iPod/i.test(b)&&(M="iOS");let O="Unknown",k="";const E=b.match(/Edg\/([\d\.]+)/)||b.match(/Chrome\/([\d\.]+)/)||b.match(/Firefox\/([\d\.]+)/)||b.match(/Version\/([\d\.]+).*Safari/);return E&&(b.includes("Edg/")?O="Edge":b.includes("Chrome/")?O="Chrome":b.includes("Firefox/")?O="Firefox":b.includes("Safari")&&!b.includes("Chrome")&&(O="Safari"),k=E[1]),`platform=${C}; os=${M}; browser=${O}/${k}; ua=${b}`}catch{return"ua=unknown"}},_=()=>{f.value=!0,vy({robot_key:o.robot_key,node_list:r,version:`${a.value}.${l.value}.${u.value}`,version_desc:c.value,uni_identifier:g(),user_agent:m(),draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0}).then(async b=>{await s.getRobot(o.id),s.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+s.robotInfo.draft_save_time||0,uni_identifier:g(),user_agent:m()}),i.value=!1,b&&b.res==0&&(xt.success("发布成功"),p("ok"))}).finally(()=>{f.value=!1})},v=()=>{hy({robot_key:o.robot_key}).then(b=>{let C=b.data.version_params||[];a.value=C[0],l.value=C[1],u.value=C[2]})};return e({show:h}),(b,C)=>{const M=$n,O=Bi,k=vn;return w(),R("div",null,[y(k,{open:i.value,"onUpdate:open":C[4]||(C[4]=E=>i.value=E),title:"发布","ok-text":"立即发布",onOk:_,confirmLoading:f.value,width:600},{default:x(()=>[d("div",Bce,[d("div",Lce,[C[8]||(C[8]=d("div",{class:"form-label"},"版本号：",-1)),d("div",Ice,[d("div",Fce,[C[5]||(C[5]=U(" v ",-1)),y(M,{value:a.value,"onUpdate:value":C[0]||(C[0]=E=>a.value=E),precision:0,min:0,max:1e3},null,8,["value"]),C[6]||(C[6]=d("span",null,".",-1)),y(M,{value:l.value,"onUpdate:value":C[1]||(C[1]=E=>l.value=E),precision:0,min:0,max:1e3},null,8,["value"]),C[7]||(C[7]=d("span",null,".",-1)),y(M,{value:u.value,"onUpdate:value":C[2]||(C[2]=E=>u.value=E),precision:0,min:0,max:1e3},null,8,["value"])])])]),d("div",jce,[C[9]||(C[9]=d("div",{class:"form-label"},"版本描述：",-1)),d("div",Vce,[y(O,{value:c.value,"onUpdate:value":C[3]||(C[3]=E=>c.value=E),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},Uce=Te(Hce,[["__scopeId","data-v-6e65e672"]]),zce={class:"version-detail"},qce={class:"version-desc flex-center"},Gce={class:"version-file-box"},Xce={class:"version-text"},Wce={class:"version-text"},Yce=["onClick"],Kce={class:"version-header"},Jce={class:"version-title"},Zce={class:"time-text flex-center"},Qce={class:"version-file-box"},efe={class:"version-text"},tfe={class:"version-text"},nfe={class:"version-desc"},ofe={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(n,{expose:e,emit:t}){const o=As().query,i=G(!1),r=G(""),s=G(""),a=t,l=n,u=jn(),c=Xe(()=>u.robotInfo),f=G([]),p=()=>{i.value=!0,h(),jd({robot_key:o.robot_key}).then(v=>{const b=(v==null?void 0:v.data)||{};r.value=b.remote_addr||"",s.value=b.user_agent||""})},h=()=>{gy({robot_key:o.robot_key}).then(v=>{f.value=v.data.versions||[]})},g=v=>{vn.confirm({title:`确定要恢复到v${v.version}版吗`,icon:null,content:Tt("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){Uf({robot_key:o.robot_key,version_id:v.version_id}).then(b=>{a("setVersion",b.data),i.value=!1,b.res==0&&xt.success("设置成功")})},onCancel(){}})},m=v=>{v==""?fg({robot_key:o.robot_key,data_type:1}).then(b=>{a("preview",b.data,v),i.value=!1}):Uf({robot_key:o.robot_key,version_id:v}).then(b=>{a("preview",b.data,v),i.value=!1})};function _(v,b="YYYY-MM-DD HH:mm:ss"){return v<=0?"--":ho(v*1e3).format(b)}return e({showDrawer:p}),(v,b)=>{const C=Nn,M=Va,O=Lr,k=Br,E=Ir,S=zy;return w(),R("div",null,[y(S,{open:i.value,"onUpdate:open":b[2]||(b[2]=N=>i.value=N),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:x(()=>[d("div",zce,[c.value.draft_save_time&&c.value.draft_save_time!=0?(w(),R("div",{key:0,class:"version-list",onClick:b[0]||(b[0]=N=>m(""))},[b[3]||(b[3]=d("div",{class:"version-header"},[d("div",{class:"version-title"},"当前最新草稿")],-1)),d("div",qce,[U(" 最近保存于"+j(_(c.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),d("div",Gce,[y(M,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[d("div",Xce," IP："+j(r.value||"--"),1),d("div",Wce," User Agent："+j(s.value||"--"),1)]),default:x(()=>[y(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):ie("",!0),(w(!0),R(ae,null,ye(f.value,(N,L)=>(w(),R("div",{class:"version-list",onClick:$=>m(N.version_id),key:N.version},[d("div",Kce,[d("div",Jce,[U(" v"+j(N.version)+" ",1),d("span",Zce,[U(j(_(N.create_time))+" ",1),d("div",Qce,[y(M,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:x(()=>[d("div",efe," IP："+j(N.last_edit_ip||"--"),1),d("div",tfe," User Agent："+j(N.last_edit_user_agent||"--"),1)]),default:x(()=>[y(C,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),y(E,null,{overlay:x(()=>[y(k,null,{default:x(()=>[y(O,{disabled:l.isLockedByOther,onClick:$=>g(N)},{default:x(()=>[...b[4]||(b[4]=[U(" 恢复到此版本 ",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024)]),default:x(()=>[d("div",{class:"hover-btn-box",onClick:b[1]||(b[1]=St(()=>{},["stop"]))},[y(K(Uy))])]),_:2},1024)]),d("div",nfe,j(N.version_desc),1)],8,Yce))),128))])]),_:1},8,["open"])])}}},ife=Te(ofe,[["__scopeId","data-v-8bc6bcdb"]]),rfe={class:"workflow-page"},sfe={class:"page-body"},afe={class:"page-left"},lfe={class:"page-container"},tg="wf_uni_identifier",ufe=300*1e3,ng=60*1e3,dfe=20*1e3,og="wf_autosave_leader_",ig=120*1e3,rg="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",cfe={__name:"index",setup(n){const e=Cg(),t=As(),o=t.query,i=G(t.query.robot_key),r=()=>{try{let be=localStorage.getItem(tg);return be||(be=`${Date.now()}_${Math.random().toString(36).slice(2,10)}`,localStorage.setItem(tg,be)),be}catch{return`${Date.now()}_${Math.random().toString(36).slice(2,10)}`}},s=()=>{try{const be=navigator.userAgent||"",Be=navigator.platform||"";let Ke="Unknown";/Windows/i.test(be)?Ke="Windows":/Macintosh|Mac OS X/i.test(be)?Ke="MacOS":/Linux/i.test(be)?Ke="Linux":/Android/i.test(be)?Ke="Android":/iPhone|iPad|iPod/i.test(be)&&(Ke="iOS");let ze="Unknown",ht="";const dt=be.match(/Edg\/([\d\.]+)/)||be.match(/Chrome\/([\d\.]+)/)||be.match(/Firefox\/([\d\.]+)/)||be.match(/Version\/([\d\.]+).*Safari/);return dt&&(be.includes("Edg/")?ze="Edge":be.includes("Chrome/")?ze="Chrome":be.includes("Firefox/")?ze="Firefox":be.includes("Safari")&&!be.includes("Chrome")&&(ze="Safari"),ht=dt[1]),`platform=${Be}; os=${Ke}; browser=${ze}/${ht}; ua=${be}`}catch{return"ua=unknown"}},a=G(null),l=G(null),u=$s(),c=jn(),f=Xe(()=>{var be;return(be=l.value)==null?void 0:be.lfRef});Xe(()=>u.triggerList);const p=G(""),h=G(""),g=G(null),m=Xe(()=>c.robotInfo.loop_save_canvas_status);gt(m,be=>{be>0&&ne("automatic")});const _=pw(),v=G(!0),b=G(!1),C=G(!0);let M=null,O=null,k=Date.now(),E="";const S=G(""),N=G(""),L=G(""),$=G(!1),B=`${Date.now()}_${Math.random()}`;let A=null;const D=()=>`${og}${i.value}`,T=()=>`wf_open_tabs_${i.value}`;function F(){try{const be=parseInt(localStorage.getItem(T())||"0",10)||0;localStorage.setItem(T(),String(be+1))}catch(be){console.warn("incrementOpenTabs error",be)}}function V(){try{const be=parseInt(localStorage.getItem(T())||"0",10)||0,Be=Math.max(0,be-1);Be<=0?setTimeout(()=>{localStorage.removeItem(T()),localStorage.removeItem(D())},0):localStorage.setItem(T(),String(Be))}catch(be){console.warn("decrementOpenTabs error",be)}}function P(){try{const be=Date.now();for(let Be=0;Be<localStorage.length;Be++){const Ke=localStorage.key(Be);if(Ke&&Ke.startsWith(og)){const ze=localStorage.getItem(Ke);let ht=null;try{ht=ze?JSON.parse(ze):null}catch{ht=null}(!ht||typeof ht.ts!="number"||be-ht.ts>ng)&&localStorage.removeItem(Ke)}}}catch(be){console.warn("cleanupExpiredLeaderKeys error",be)}}function X(){try{const be=localStorage.getItem(D());return be?JSON.parse(be):null}catch{return null}}function oe(){localStorage.setItem(D(),JSON.stringify({tabId:B,ts:Date.now()}))}function H(){const be=X();return!be||Date.now()-be.ts>ng?(oe(),!0):be.tabId===B}function W(){const be=X();be&&be.tabId===B&&localStorage.removeItem(D())}function Z(be){try{const Be=localStorage.getItem(be),Ke=Be?JSON.parse(Be):null;Ke&&Ke.tabId===B&&localStorage.removeItem(be)}catch{}}function le(be){be.key===D()&&(et(),P(),$.value=H())}function te(){document.visibilityState==="visible"&&($.value=H()),P(),et()}function q(){re(),P(),$.value=H(),A=setInterval(()=>{const be=H();$.value=be,be&&localStorage.setItem(D(),JSON.stringify({tabId:B,ts:Date.now()}))},dfe),window.addEventListener("storage",le),document.addEventListener("visibilitychange",te),window.addEventListener("beforeunload",()=>{W(),V()}),window.addEventListener("pagehide",()=>{W(),V()})}function re(){A&&clearInterval(A),A=null,window.removeEventListener("storage",le),document.removeEventListener("visibilitychange",te),window.removeEventListener("beforeunload",W)}function ce(){try{const be=z();return JSON.stringify(be)}catch{return""}}function ve(){Ne(),E=ce(),k=Date.now(),O=setInterval(()=>{if(!v.value)return;const be=ce();be&&be!==E&&(E=be,k=Date.now(),ge())},2*1e3)}function Ne(){O&&clearInterval(O),O=null}function ge(){try{if(!v.value||b.value)return;(!C.value||!H())&&(oe(),C.value=!0),et()}catch{}}function _e(){st(),M=setInterval(()=>{v.value&&C.value&&Date.now()-k>=ufe&&(C.value=!1,xt.warning("已超过5分钟无改动，自动保存已暂停"),et())},30*1e3)}function st(){M&&clearInterval(M),M=null}async function tt(){try{const be=await jd({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(be==null?void 0:be.data)||{};b.value=!Be.lock_res,S.value=Be.remote_addr||"",N.value=Be.user_agent||"",L.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),et()}catch{b.value=!1,c.setIsLockedByOther(b.value)}}async function ke(){try{const be=await jd({robot_key:i.value,uni_identifier:r(),user_agent:s()}),Be=(be==null?void 0:be.data)||{};return Be.lock_res?(b.value=!1,S.value="",N.value="",L.value="",c.setIsLockedByOther(b.value),!0):(b.value=!Be.lock_res,S.value=Be.remote_addr||"",N.value=Be.user_agent||"",L.value=Be.login_user_name||"",c.setIsLockedByOther(b.value),!1)}catch{return b.value=!1,c.setIsLockedByOther(b.value),!0}}function he(be){be=be||[];let Be=[],Ke=[];be.forEach(ze=>{if(ze.node_type==0){let ht=JSON.parse(ze.node_info_json);ht.type=="custom-edge"&&(ht.pointsList=[],ht.type="custom-bezier-edge"),Ke.push(ht)}else{const ht=_[ze.node_type];ze.type=ht;let dt=JSON.parse(ze.node_info_json);ze.node_type!=0&&(dt.type=_[ze.node_type],dt.id=ze.node_key||Yi(dt.type),dt.x=dt.x||0,dt.y=dt.y||0),ze.node_type==-1&&(ze.node_params=dt.dataRaw),dt.nodeSortKey?ze.nodeSortKey=dt.nodeSortKey:ze.nodeSortKey=dt.id.substring(0,8)+dt.id.substring(dt.id.length-8),ze.dataRaw=dt.dataRaw||ze.node_params,delete ze.node_info_json,dt.loop_parent_key=ze.loop_parent_key,dt.properties=ze,dt.properties.width=dt.width,dt.properties.height=dt.height,Be.push(dt)}}),Me({nodes:Be,edges:Ke})}const De=be=>{a.value.open(be,!0)},Me=be=>{l.value.setData(be)},z=()=>{let be=l.value.getData(),Be=[],Ke={};return be.edges.forEach(ze=>{let ht={node_key:ze.id,node_name:"edge",node_type:0},dt={...ze};ht.node_info_json=dt,Be.push(ht),ze.sourceAnchorId&&(Ke[ze.sourceAnchorId]=ze.targetNodeId),ze.targetAnchorId&&(Ke[ze.targetAnchorId]=ze.sourceNodeId)}),be.nodes.forEach(ze=>{let ht={...ze.properties,node_type:+ze.properties.node_type,node_key:ze.id};ht.node_info_json={type:ze.type,x:ze.x,y:ze.y,width:ze.properties.width,height:ze.properties.height,id:ze.id,nodeSortKey:ht.nodeSortKey,dataRaw:ze.properties.node_params},ht.next_node_key=Ke[ht.nodeSortKey+"-anchor_right"]||"",ht.prev_node_key=Ke[ht.nodeSortKey+"-anchor_left"]||"";let dt=JSON.parse(ht.node_params);if(ht.node_type==1,ht.node_type==2&&dt.term&&dt.term.length>0&&dt.term.forEach((Ut,bn)=>{let En=ht.nodeSortKey+"-anchor_"+bn;Ut.next_node_key=Ke[En]||""}),ht.node_type==3&&dt.cate&&dt.cate.categorys&&dt.cate.categorys.length>0&&dt.cate.categorys.forEach((Ut,bn)=>{let En=ht.nodeSortKey+"-anchor_"+bn;Ut.next_node_key=Ke[En]||""}),ht.node_type==17){let Ut=Ke[ht.nodeSortKey+"-anchor_right_exception"];Ut&&(dt.code_run.exception=Ut)}if(ht.node_type==41){let Ut=Ke[ht.nodeSortKey+"-anchor_right_exception"];Ut&&(dt.workflow.exception=Ut)}ht.node_params=dt,delete ht.dataRaw,Be.push(ht)}),Be},ne=async be=>{if(b.value){be==="handle"&&xt.warning("当前已有其他用户在编辑中，无法保存");return}if(!v.value||!C.value&&be==="automatic")return;let Be=z();if(be==="handle"){const Ke=+c.robotInfo.draft_save_time||0,ze={robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:Ke,re_cover_save:0,uni_identifier:r(),user_agent:s()},ht=await Ie(ze,!1);ht.saved?xt.success("保存成功"):ht.behind;return}try{await pr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id);const Ke=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:Ke})}catch{}};let se=null,Ee=!1,fe=!1,Le=0;async function Ie(be,Be){var Ke,ze;try{const ht={...be,uni_identifier:r(),user_agent:s()},dt=await pr(ht);if(!(((Ke=dt==null?void 0:dt.data)==null?void 0:Ke.behind_draft)==1||(dt==null?void 0:dt.behind_draft)==1)){await c.getRobot(o.id);const bn=+c.robotInfo.draft_save_time||ho().unix();return c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:bn}),{saved:!0,behind:!1}}if(Be){const bn=Date.now();if(Ee||fe&&bn-Le<ig)return C.value=!1,et(),{saved:!1,behind:!0};Ee=!0,fe=!0,Le=bn}return await new Promise(bn=>{vn.confirm({title:"提示",icon:null,content:rg,okText:"确 定",cancelText:"取 消",async onOk(){var Hn;const En={...be,re_cover_save:1,uni_identifier:r(),user_agent:s()},qt=await pr(En);if(qt&&qt.res==0||!((Hn=qt==null?void 0:qt.data)!=null&&Hn.behind_draft)){await c.getRobot(o.id);const Mn=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Mn})}Be&&(C.value=!0,et(),Ee=!1,fe=!1,Le=Date.now()),bn({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,et(),Ee=!1,Le=Date.now()),bn({saved:!1,behind:!0})}})})}catch(ht){if(!(((ze=ht==null?void 0:ht.data)==null?void 0:ze.behind_draft)==1||(ht==null?void 0:ht.behind_draft)==1))return{saved:!1,behind:!1};if(Be){const Ut=Date.now();if(Ee||fe&&Ut-Le<ig)return C.value=!1,et(),{saved:!1,behind:!0};Ee=!0,fe=!0,Le=Ut}return await new Promise(Ut=>{vn.confirm({title:"提示",icon:null,content:rg,okText:"确 定",cancelText:"取 消",async onOk(){var qt;const bn={...be,re_cover_save:1,uni_identifier:r(),user_agent:s()},En=await pr(bn);if(En&&En.res==0||!((qt=En==null?void 0:En.data)!=null&&qt.behind_draft)){await c.getRobot(o.id);const Hn=+c.robotInfo.draft_save_time||ho().unix();c.setDrafSaveTime({draft_save_type:Be?"automatic":"handle",draft_save_time:Hn})}Be&&(C.value=!0,et(),Ee=!1,fe=!1,Le=Date.now()),Ut({saved:!0,behind:!0})},onCancel(){Be&&(C.value=!1,et(),Ee=!1,Le=Date.now()),Ut({saved:!1,behind:!0})}})})}}async function Ve(){if(b.value||!v.value||!C.value)return;const be=z(),Be=+c.robotInfo.draft_save_time||0,Ke={robot_key:i.value,data_type:1,node_list:JSON.stringify(be),draft_save_type:"automatic",draft_save_time:Be,re_cover_save:0,uni_identifier:r()};await Ie(Ke,!0)}function et(){se&&clearInterval(se),se=null,$.value=H(),v.value&&C.value&&!b.value&&H()&&(se=setInterval(()=>{Ve()},60*1e3))}Gc(()=>{se&&clearInterval(se),st(),Ne(),re(),W(),V()});const nt=G(null),We=G(!1),lt=be=>{nt.value.show(be)},de=async()=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法发布");return}let be=z(),Be=[];for(let Ke=0;Ke<be.length;Ke++){let ze=be[Ke];ze.node_type==0||ze.node_type==-1||ze.loop_parent_key||(ze.node_type==1?ze.next_node_key==""&&Be.push(ze):ze.node_type==7||ze.node_type==3?ze.prev_node_key==""&&Be.push(ze):(ze.next_node_key==""||ze.prev_node_key=="")&&Be.push(ze))}if(Be.length>0){xt.error("存在未关联的节点，请先关联");return}try{await pr({robot_key:i.value,data_type:1,node_list:JSON.stringify(be),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0}),lt(JSON.stringify(be))}catch{We.value=!1}};let pe=G(null);const xe=be=>{pe.value=be,be.properties.node_sub_type!=51&&ge()},Ce=()=>{ge()},Fe=async()=>Pw({model_type:"LLM"}).then(be=>{let Be=be.data||[],{newList:Ke}=Sg(Be);c.setModelList(Ke)}),Ue=G({diy_global:[],sys_global:[]}),qe=()=>{let Be=z().filter(Ke=>Ke.node_type==1);Be.length>0&&(Ue.value=Be[0].node_params.start)},at=G(null),bt=()=>{C.value=!1,et(),at.value.showDrawer()},Xt=be=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法恢复");return}const Be=z();pr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Be),draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}).then(()=>{c.getRobot(o.id).then(()=>{c.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+c.robotInfo.draft_save_time||0})}),p.value="",h.value=null,he(be),xt.success("已保存当前草稿并恢复版本"),v.value=!0,C.value=!0,et()})},Ft=async(be,Be)=>{if(!b.value){const Ke=z();try{await pr({robot_key:i.value,data_type:1,node_list:JSON.stringify(Ke),draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0,uni_identifier:r(),user_agent:s()}),await c.getRobot(o.id),c.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+c.robotInfo.draft_save_time||0})}catch{}}h.value=Be,clearInterval(se),he(be)},pn=()=>{g.value.openRunTest()},gn=async()=>{if(b.value){xt.warning("当前已有其他用户在编辑中，无法编辑");return}await ke()&&(v.value=!0,C.value=!0,E=ce(),k=Date.now(),ve(),et(),xt.success("已进入编辑模式"),De(1))},Rt=be=>{be=Array.isArray(be)?be:[];let Be=[],Ke=[];if(be.forEach(ze=>{ze.node_type==21&&(ze.has_loaded===""||ze.plugin_version!==ze.remote_plugin_version?Ke.push(ze):ze.has_loaded==="false"&&Be.push(ze))}),Be.length||Ke.length){let ze=[...new Set([...Be.map(Ut=>Ut.node_name),...Ke.map(Ut=>Ut.node_name)])];const ht={"font-weight":500,"margin-top":"8px","margin-bottom":"4px"},dt={color:"#8c8c8c"};vn.confirm({title:"工作流异常修复",content:Tt("div",{},[Tt("div",{style:ht},"以下插件状态异常，是否自动安装插件并开启？"),Tt("div",{style:dt},ze.join("、"))]),onOk:async()=>{const Ut=[];Be.length&&Ut.push(Cw({name:Be.map(bn=>bn.plugin_name).toString()})),Ke.length&&Ut.push(Sw({download_data:JSON.stringify(Ke.map(bn=>({url:bn.latest_version_detail_url,version_id:bn.latest_version_detail_id})))})),await Promise.all(Ut),xt.success("操作完成，即将重新加载..."),setTimeout(()=>{window.location.reload()},1200)}})}},Se=async()=>{await Fe(),await u.getTriggerList(i.value),u.getTriggerOfficialMsg(i.value),await e.getAllmodelList(),u.getAllLibraryList();const be=await fg({robot_key:i.value,data_type:1});he(be.data),Rt(be.data)};return Ui("handleAutoSaveDraft",async(be="automatic")=>{await ne(be)}),ut(async()=>{F(),await Se(),await tt(),b.value?(v.value=!1,C.value=!1,xt.warning("其他人在编辑，已切换为查看模式")):await ke()?(v.value=!0,C.value=!0):(v.value=!1,C.value=!1),q(),et();let be=D();gt(()=>t.query.robot_key,Be=>{!Be||Be===i.value||(Z(be),V(),i.value=Be,be=D(),F(),q(),et())}),_e(),ve(),t.query.show_tips&&xt.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)}),(be,Be)=>(w(),R("div",rfe,[y(Rce,{ref_key:"pageHeaderRef",ref:g,onEdit:gn,onSave:ne,onRelease:de,onGetGlobal:qe,onGetVersionRecord:bt,lf:f.value,currentVersion:h.value,start_node_params:Ue.value,saveLoading:We.value,isEditing:v.value,isLockedByOther:b.value,lockRemoteAddr:S.value,lockUserAgent:N.value,loginUserName:L.value,autoSaveEnabled:C.value,isLeader:$.value},null,8,["lf","currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),d("div",sfe,[d("div",afe,[y(Uw)]),d("div",lfe,[y(Vde,{ref_key:"workflowCanvasRef",ref:l,onSelectedNode:xe,onOnDeleteNode:Ce,onRunTest:pn},null,512)])]),y($w,{ref_key:"addRobotAlertRef",ref:a},null,512),y(Uce,{ref_key:"versionModelRef",ref:nt},null,512),y(ife,{ref_key:"publishDetailRef",ref:at,onPreview:Ft,onSetVersion:Xt,isLockedByOther:b.value},null,8,["isLockedByOther"])]))}},_he=Te(cfe,[["__scopeId","data-v-ae984660"]]);export{_he as default};
