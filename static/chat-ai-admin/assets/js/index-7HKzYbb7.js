import{Y as m,_ as i,a5 as t,k as e,ae as L,G as S,a7 as R,a3 as pt,a1 as j,a2 as a,a6 as ce,ad as Lt,f as q,c as J,r as P,e as K,n as rt,A as dt,u as g,J as Q,ab as Jt,F as N,a9 as W,w as at,l as Ft,h as xt,aj as ut,ak as ft,a4 as Qt,o as ht,b as ue,B as pe,y as Kt,ai as me,ag as ve,p as be}from"./vue-chunks-CXJTX1FC.js";import{b as D,d as _t,a8 as fe,a1 as he,a4 as ye,e as ke,F as ge,ah as It,h as xe,ag as $e}from"../../index-0TFHdij1.js";import{B as et,E as $t,I as yt,T as kt,aj as Dt,a0 as we,ao as qe,ah as Gt,M as X,a as G,F as Ot,e as Wt,u as Ht,v as Zt,$ as Yt,Z as Xt,az as Se,p as ot,aA as Ce,Y as tt,ap as mt,a1 as Ut,g as te,ar as Ie,af as Le,ag as Ue,q as jt,R as Vt,ac as Y,aB as ee,Q as wt,k as Re,ay as Ee,ae as Oe,G as Ae,aa as oe,z as je,H as At,W as Ve,U as Tt,a9 as Me,h as Et,ab as ze,x as Ne,ak as Pe}from"./ui-antd-D3ZAJ1Vq.js";import{C as De}from"./cu-upload-0KpYYFPb.js";import{u as se}from"./robot-L7DXN4U8.js";import{o as Te,p as Be,g as Je,q as Fe}from"./index-DvPlhmYy.js";import{_ as Qe}from"./index-DreDU_C2.js";import{g as ne,M as Mt,u as Ke}from"./model-select-Dks01hRk.js";import{L as Ge}from"./library-select-alert-mHYWA8-8.js";import{_ as We}from"./recommendation-AQ4_FPQ9.js";import{_ as ie}from"./cu-scroll-BZZHijaV.js";import{a as He}from"./index-lMQ5W3Uj.js";import{g as le}from"./index-D43tNYAj.js";import{_ as Ze}from"./empty-CzGZrENG.js";import{d as zt}from"./vuedraggable.umd-BsLO8JSn.js";import{_ as Ye}from"./empty-BFmzY9bl.js";import{i as Xe,e as to,f as eo}from"./index-1Uxm8pKJ.js";import{A as oo}from"./add-collaborator-SxJQINkn.js";import{R as so}from"./robot-select-alert-C8ro-EDw.js";import"./utils-yZpnICoG.js";import"./index-B551IHpY.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const no={class:"edit-box-header"},io={class:"left-box"},lo={class:"edit-box-title"},ao={key:0},ro={key:0,class:"title-tip"},_o={class:"right-box"},co={class:"extra-box"},uo={class:"actions-box"},po={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(V,{emit:u}){const h=u,l=V,p=n=>{h("edit"),h("update:isEdit",n)},s=()=>{h("save")};return(n,x)=>{const f=_t,k=et,$=$t;return i(),m("div",{class:Lt(["edit-box",{"is-edit":V.isEdit}])},[t("div",no,[t("div",io,[e(f,{class:"edit-box-icon",name:l.iconName},null,8,["name"]),t("span",lo,[S(R(l.title)+" ",1),n.$slots.icon?(i(),m("span",ao,[pt(n.$slots,"icon",{},void 0,!0)])):L("",!0)]),n.$slots.tip?(i(),m("span",ro,[pt(n.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",_o,[t("div",co,[pt(n.$slots,"extra",{},()=>[t("div",uo,[l.isEdit?(i(),j($,{key:0,gap:8},{default:a(()=>[e(k,{onClick:s,size:"small",type:"primary"},{default:a(()=>x[2]||(x[2]=[S("保存")])),_:1,__:[2]}),e(k,{onClick:x[0]||(x[0]=_=>p(!1)),size:"small"},{default:a(()=>x[3]||(x[3]=[S("取消")])),_:1,__:[3]})]),_:1})):(i(),j(k,{key:1,onClick:x[1]||(x[1]=_=>p(!0)),size:"small"},{default:a(()=>x[4]||(x[4]=[S("修改")])),_:1,__:[4]}))])],!0)])])]),t("div",{class:"edit-box-body",style:ce({...V.bodyStyle})},[pt(n.$slots,"default",{},void 0,!0)],4)],2)}}},H=D(po,[["__scopeId","data-v-1b63f826"]]),mo={class:"robot-form-box"},vo={class:"form-item"},bo={class:"form-item-body robot-name-item"},fo={class:"robot-avetar-upload"},ho=["src"],yo={class:"robot-name-box"},ko={class:"form-item"},go={class:"form-item-body"},xo={class:"robot-info-box"},$o={class:"robot-name-box"},wo=["src"],qo={class:"robot-name"},So={class:"robot-intro"},Co={__name:"basic-config",setup(V){const u=se(),h=q(!1),{robotInfo:l,updateRobotInfo:p}=J("robotInfo"),s=P({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=K(()=>u.robotList||[]),x=K(()=>u.robotGroupList||[]),f=K(()=>{let c="未分组",o=n.value.find(d=>d.id==l.id)||{};if(o.group_id>0){let d=x.value.find(b=>b.id==o.group_id);d&&(c=d.group_name)}return c}),k=()=>{p({...Q(s)}),h.value=!1},$=c=>{let o=c[0];return s.robot_avatar=o,fe(o).then(d=>{s.robot_avatar_url=d}),!1},_=()=>{s.robot_name=l.robot_name,s.robot_intro=l.robot_intro,s.robot_avatar=l.robot_avatar,s.robot_avatar_url=l.robot_avatar_url};return(c,o)=>{const d=yt,b=kt;return i(),j(H,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:h.value,"onUpdate:isEdit":o[2]||(o[2]=r=>h.value=r),onSave:k,onEdit:_},{default:a(()=>[rt(t("div",mo,[t("div",vo,[o[3]||(o[3]=t("div",{class:"form-item-label"},"机器人名称/头像",-1)),t("div",bo,[e(De,{accept:"image/*",onChange:$},{default:a(()=>[t("div",fo,[s.robot_avatar_url?(i(),m("img",{key:0,class:"robot-avetar",src:s.robot_avatar_url},null,8,ho)):L("",!0)])]),_:1}),t("div",yo,[e(d,{value:s.robot_name,"onUpdate:value":o[0]||(o[0]=r=>s.robot_name=r),placeholder:"请输入机器人名称"},null,8,["value"])])])]),t("div",ko,[o[4]||(o[4]=t("div",{class:"form-item-label"},"简介",-1)),t("div",go,[e(b,{rows:3,value:s.robot_intro,"onUpdate:value":o[1]||(o[1]=r=>s.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[dt,h.value]]),rt(t("div",xo,[t("div",$o,[t("img",{class:"robot-avatar",src:g(l).robot_avatar_url,alt:""},null,8,wo),t("span",qo,R(g(l).robot_name),1)]),t("div",So,[t("span",null,"分组："+R(f.value),1),t("span",null,"简介："+R(g(l).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[dt,!h.value]])]),_:1},8,["isEdit"])}}},Io=D(Co,[["__scopeId","data-v-0adbabe6"]]),Lo={class:"ai-create-box"},Uo={class:"input-box"},Ro={key:1},Eo={key:2},Oo={class:"quick-tags-box"},Ao={class:"ai-list-box"},jo={key:0,class:"loading-box"},Vo={key:0,class:"prompt-list-box"},Mo={class:"prompt-list"},zo={class:"prompt-header"},No={class:"prompt-title"},Po={class:"prompt-content"},Do={class:"prompt-list"},To={class:"prompt-header"},Bo={class:"prompt-title"},Jo={class:"prompt-content"},Fo={class:"prompt-list"},Qo={class:"prompt-header"},Ko={class:"prompt-title"},Go={class:"prompt-content"},Wo={class:"prompt-list"},Ho={class:"prompt-header"},Zo={class:"prompt-title"},Yo={class:"prompt-content"},Xo={class:"prompt-list"},ts={class:"prompt-header"},es={class:"prompt-title"},os={class:"prompt-content"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={class:"prompt-content"},ls={key:1,class:"empty-box"},as={__name:"ai-create-prompt",emits:["handleAiSave"],setup(V,{expose:u,emit:h}){const l=Dt.PRESENTED_IMAGE_SIMPLE,p=q(!1),s=q(!1),n=Jt().query,x=h,f=q(""),k=q(!1),$=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],_=q("在上方输入框输入要求，点击生成提示词"),c=()=>{o.value=!1,b.promptStruct=d,f.value="",_.value="在上方输入框输入要求，点击生成提示词",p.value=!0},o=q(!1),d={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},b=P({promptStruct:d}),r=I=>{f.value=I},C=()=>{if(!f.value)return G.error("请输入AI 生成提示词");if(k.value)return G.error("正在生成中...");k.value=!0,Te({id:n.id,demand:f.value}).then(I=>{b.promptStruct=JSON.parse(I.data.promptStruct),o.value=!0}).finally(()=>{k.value=!1}).catch(I=>{o.value=!1,_.value=I.msg})},U=()=>{if(!o.value)return G.error("请先生成提示词");x("handleAiSave",b.promptStruct),p.value=!1};return u({show:c}),(I,v)=>{const w=et,T=kt,E=_t,M=qe,Z=Gt,st=Dt,A=X;return i(),m("div",null,[e(A,{open:p.value,"onUpdate:open":v[1]||(v[1]=B=>p.value=B),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:a(()=>[e(w,{type:"primary",loading:s.value,onClick:U},{default:a(()=>v[2]||(v[2]=[S("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:a(()=>[t("div",Lo,[t("div",Uo,[e(T,{style:{width:"100%"},value:f.value,"onUpdate:value":v[0]||(v[0]=B=>f.value=B),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),t("div",{class:Lt(["btn-box",{"disabed-status":k.value}]),onClick:C},[k.value?(i(),j(g(we),{key:0})):L("",!0),e(E,{name:"ai-mark"}),k.value?(i(),m("span",Ro,"生成中...")):(i(),m("span",Eo,"生成"))],2)]),t("div",Oo,[v[3]||(v[3]=t("div",{class:"quick-label"},"快捷生成：",-1)),(i(),m(N,null,W($,B=>e(M,{key:B.title,onClick:ct=>r(B.title),color:"blue"},{default:a(()=>[S(R(B.title),1)]),_:2},1032,["onClick"])),64))]),t("div",Ao,[k.value?(i(),m("div",jo,[e(Z,{tip:"正在生成中..."})])):(i(),m(N,{key:1},[o.value?(i(),m("div",Vo,[t("div",Mo,[t("div",zo,[t("div",No,R(b.promptStruct.role.subject),1)]),t("div",Po,R(b.promptStruct.role.describe),1)]),t("div",Do,[t("div",To,[t("div",Bo,R(b.promptStruct.task.subject),1)]),t("div",Jo,R(b.promptStruct.task.describe),1)]),t("div",Fo,[t("div",Qo,[t("div",Ko,R(b.promptStruct.constraints.subject),1)]),t("div",Go,R(b.promptStruct.constraints.describe),1)]),t("div",Wo,[t("div",Ho,[t("div",Zo,R(b.promptStruct.output.subject),1)]),t("div",Yo,R(b.promptStruct.output.describe),1)]),t("div",Xo,[t("div",ts,[t("div",es,R(b.promptStruct.tone.subject),1)]),t("div",os,R(b.promptStruct.tone.describe),1)]),(i(!0),m(N,null,W(b.promptStruct.custom,(B,ct)=>(i(),m("div",{class:"prompt-list",key:ct+B.key?B.key:""},[t("div",ss,[t("div",ns,R(B.subject),1)]),t("div",is,R(B.describe),1)]))),128))])):(i(),m("div",ls,[e(st,{image:g(l),description:_.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},rs=D(as,[["__scopeId","data-v-1dd9dabe"]]),ds={__name:"upload-prompt",setup(V,{expose:u}){const h=q(!1),l=P({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),p=q(null),s=$=>{if($.prompt_type==0&&!$.prompt)return G.error("自定义提示为空,无法上传");p.value&&p.value.resetFields();let _={...$};l.title="",l.group_id=0,l.prompt="",l.prompt_struct={},l.prompt_type=_.prompt_type,_.prompt_type==0?l.prompt=_.prompt:l.prompt_struct=JSON.stringify(_.prompt_struct),h.value=!0},n=q([]);(()=>{he().then($=>{n.value=[{id:0,group_name:"默认分组"},...$.data]})})();const f=q(!1),k=()=>{p.value.validate().then(()=>{let $={...l};f.value=!0,ye({...$}).then(()=>{G.success("保存成功"),h.value=!1}).finally(()=>{f.value=!1})})};return u({show:s}),($,_)=>{const c=yt,o=Wt,d=Zt,b=Ht,r=Ot,C=X;return i(),m("div",null,[e(C,{open:h.value,"onUpdate:open":_[2]||(_[2]=U=>h.value=U),title:"保存到提示词库",width:580,onOk:k,confirmLoading:f.value},{default:a(()=>[e(r,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:p,model:l},{default:a(()=>[e(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:a(()=>[e(c,{value:l.title,"onUpdate:value":_[0]||(_[0]=U=>l.title=U),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),e(o,{name:"group_id",label:"分组"},{default:a(()=>[e(b,{value:l.group_id,"onUpdate:value":_[1]||(_[1]=U=>l.group_id=U),style:{width:"100%"}},{default:a(()=>[(i(!0),m(N,null,W(n.value,U=>(i(),j(d,{value:U.id},{default:a(()=>[S(R(U.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},_s={class:"prompt-box"},cs={class:"tab-header"},us={key:0,class:"opt-block"},ps={key:1,class:"opt-block"},ms={class:"tip-text"},vs={key:0,class:"prompt-list-box"},bs={class:"prompt-list"},fs={class:"prompt-header"},hs={class:"prompt-title"},ys={key:0,class:"btn-wrapper-box"},ks={class:"prompt-content"},gs={class:"prompt-list"},xs={class:"prompt-header"},$s={class:"prompt-title"},ws={key:0,class:"btn-wrapper-box"},qs={class:"prompt-content"},Ss={class:"prompt-list"},Cs={class:"prompt-header"},Is={class:"prompt-title"},Ls={key:0,class:"btn-wrapper-box"},Us={class:"prompt-content"},Rs={class:"prompt-list"},Es={class:"prompt-header"},Os={class:"prompt-title"},As={key:0,class:"btn-wrapper-box"},js={class:"prompt-content"},Vs={class:"prompt-list"},Ms={class:"prompt-header"},zs={class:"prompt-title"},Ns={key:0,class:"btn-wrapper-box"},Ps={class:"swich-item"},Ds={class:"swich-item"},Ts={class:"prompt-content"},Bs={class:"prompt-list"},Js={class:"prompt-header"},Fs={class:"prompt-title"},Qs={key:0,class:"btn-wrapper-box"},Ks={class:"prompt-content"},Gs={class:"prompt-header"},Ws={class:"prompt-title",style:{flex:"1"}},Hs={key:0,class:"btn-wrapper-box"},Zs=["onClick"],Ys={class:"prompt-content"},Xs={key:0,class:"add-theme-block"},tn={class:"show-more-block"},en={key:1,class:"diy-prompt-box"},on={key:0,class:"diy-switch-box"},sn={class:"swich-item"},nn={class:"swich-item"},it="- 请使用markdown格式回答问题。",lt="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",ln={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(V){const u=q(!1),{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),p=V;let s={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const n=q({}),x=q(!1),f=q(!1),k=q(!1),$=q(!1),_=P({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),c=q(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{c.value=!c.value,localStorage.setItem("system_prompt_words_ishide",c.value?1:0)},d=(z,y)=>z.includes(y),b=q(h.prompt_type),r=K(()=>h.prompt_type);at(()=>h,()=>{_.prompt=h.prompt,_.prompt_struct=h.prompt_struct,n.value=h.prompt_struct_default},{immediate:!0,deep:!0}),at(()=>_.prompt_struct.output.describe,z=>{x.value=d(z,it),f.value=d(z,lt)},{immediate:!0,deep:!0}),at(()=>_.prompt,z=>{k.value=d(z,it),$.value=d(z,lt)},{immediate:!0,deep:!0});const C=(z,y)=>{z?(y=="outSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+it:_.prompt_struct.output.describe+=it),y=="imgSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+lt:_.prompt_struct.output.describe+=lt)):(y=="outSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(it,"g"),"")),y=="imgSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(lt,"g"),"")),_.prompt_struct.output.describe=_.prompt_struct.output.describe.trim())},U=(z,y)=>{z?(y=="outDiySwitch"&&(_.prompt?_.prompt+=`
`+it:_.prompt+=it),y=="imgDiySwitch"&&(_.prompt?_.prompt+=`
`+lt:_.prompt+=lt)):(y=="outDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(it,"g"),"")),y=="imgDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(lt,"g"),"")),_.prompt=_.prompt.trim())},I=z=>{_.prompt_struct[z].describe=n.value[z].describe},v=()=>{let z=h.work_flow_ids.split(","),y=p.robotList.filter(bt=>z.includes(bt.id)),gt=[];gt=y.map(bt=>`- ${bt.robot_name} ${bt.robot_intro}`).join(`
`),_.prompt_struct.skill.describe=gt},w=()=>{_.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),b.value=1},T=z=>{_.prompt_struct.custom.splice(z,1)},E=()=>{l({...Q(_),prompt_type:b.value}),u.value=!1},M=z=>{b.value=1,l({prompt_type:b.value,prompt:_.prompt,prompt_struct:z}),u.value=!1},Z=()=>{u.value=!0},st=()=>{u.value=!1},A=q(null),B=()=>{A.value.show()},ct=q(null),F=()=>{ct.value.show()},vt=q(null),Rt=()=>{vt.value.show({..._,prompt_type:b.value})},ae=z=>{z.prompt_type==1?(b.value=1,_.prompt_struct=z.prompt_struct):(b.value=0,_.prompt=z.prompt),E()};return(z,y)=>{const gt=Yt,bt=Xt,Nt=ot,re=_t,qt=et,de=$t,nt=kt,St=tt,_e=yt;return i(),m("div",_s,[t("div",cs,[e(bt,{activeKey:b.value,"onUpdate:activeKey":y[0]||(y[0]=O=>b.value=O)},{default:a(()=>[(i(),j(gt,{key:1,tab:"结构化提示词"})),(i(),j(gt,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),u.value?(i(),m("div",us,[e(Nt,null,{title:a(()=>y[22]||(y[22]=[S("将当前编辑的提示词保存到提示词库中")])),default:a(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Rt},[e(g(Se)),y[23]||(y[23]=S("上传 "))])]),_:1}),e(Nt,null,{title:a(()=>y[24]||(y[24]=[S("从提示词库导入提示词")])),default:a(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:F},[e(g(Ce)),y[25]||(y[25]=S("导入 "))])]),_:1}),t("div",{class:"ai-mark-box hover-btn-box",onClick:B},[e(re,{name:"ai-mark"}),y[26]||(y[26]=S(" AI自动生成 "))]),e(de,{gap:8},{default:a(()=>[e(qt,{size:"small",type:"primary",onClick:E},{default:a(()=>y[27]||(y[27]=[S("保存")])),_:1,__:[27]}),e(qt,{size:"small",onClick:st},{default:a(()=>y[28]||(y[28]=[S("取消")])),_:1,__:[28]})]),_:1})])):(i(),m("div",ps,[t("span",ms,"当前类型："+R(r.value==1?"结构化提示词":"自定义提示词"),1),e(qt,{size:"small",onClick:Z},{default:a(()=>y[29]||(y[29]=[S("修改")])),_:1,__:[29]})]))]),b.value==1?(i(),m("div",vs,[t("div",bs,[t("div",fs,[t("div",hs,R(_.prompt_struct.role.subject),1),u.value?(i(),m("div",ys,[t("a",{onClick:y[1]||(y[1]=O=>I("role"))},"恢复默认")])):L("",!0)]),t("div",ks,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.role.describe,"onUpdate:value":y[2]||(y[2]=O=>_.prompt_struct.role.describe=O),placeholder:g(s).role},null,8,["disabled","value","placeholder"])])]),t("div",gs,[t("div",xs,[t("div",$s,R(_.prompt_struct.task.subject),1),u.value?(i(),m("div",ws,[t("a",{onClick:y[3]||(y[3]=O=>I("task"))},"恢复默认")])):L("",!0)]),t("div",qs,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.task.describe,"onUpdate:value":y[4]||(y[4]=O=>_.prompt_struct.task.describe=O),placeholder:g(s).task},null,8,["disabled","value","placeholder"])])]),c.value?(i(),m(N,{key:0},[t("div",Ss,[t("div",Cs,[t("div",Is,R(_.prompt_struct.constraints.subject),1),u.value?(i(),m("div",Ls,[t("a",{onClick:y[5]||(y[5]=O=>I("constraints"))},"恢复默认")])):L("",!0)]),t("div",Us,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.constraints.describe,"onUpdate:value":y[6]||(y[6]=O=>_.prompt_struct.constraints.describe=O),placeholder:g(s).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),t("div",Rs,[t("div",Es,[t("div",Os,R(_.prompt_struct.skill.subject),1),u.value?(i(),m("div",As,[t("a",{onClick:y[7]||(y[7]=O=>v())},"自动导入技能")])):L("",!0)]),t("div",js,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.skill.describe,"onUpdate:value":y[8]||(y[8]=O=>_.prompt_struct.skill.describe=O),placeholder:g(s).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),t("div",Vs,[t("div",Ms,[t("div",zs,R(_.prompt_struct.output.subject),1),u.value?(i(),m("div",Ns,[t("div",Ps,[y[30]||(y[30]=S(" 输出markdown： ")),e(St,{onChange:y[9]||(y[9]=O=>C(O,"outSwitch")),checked:x.value,"onUpdate:checked":y[10]||(y[10]=O=>x.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",Ds,[y[31]||(y[31]=S(" 回复图片： ")),e(St,{onChange:y[11]||(y[11]=O=>C(O,"imgSwitch")),checked:f.value,"onUpdate:checked":y[12]||(y[12]=O=>f.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("a",{onClick:y[13]||(y[13]=O=>I("output"))},"恢复默认")])):L("",!0)]),t("div",Ts,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.output.describe,"onUpdate:value":y[14]||(y[14]=O=>_.prompt_struct.output.describe=O),placeholder:g(s).output},null,8,["disabled","value","placeholder"])])]),t("div",Bs,[t("div",Js,[t("div",Fs,R(_.prompt_struct.tone.subject),1),u.value?(i(),m("div",Qs,[t("a",{onClick:y[15]||(y[15]=O=>I("tone"))},"恢复默认")])):L("",!0)]),t("div",Ks,[e(nt,{bordered:!1,disabled:!u.value,value:_.prompt_struct.tone.describe,"onUpdate:value":y[16]||(y[16]=O=>_.prompt_struct.tone.describe=O),placeholder:g(s).tone},null,8,["disabled","value","placeholder"])])]),(i(!0),m(N,null,W(_.prompt_struct.custom,(O,Pt)=>(i(),m("div",{class:"prompt-list",key:Pt+O.key?O.key:""},[t("div",Gs,[t("div",Ws,[e(_e,{bordered:!1,disabled:!u.value,style:{width:"100%"},value:O.subject,"onUpdate:value":Ct=>O.subject=Ct,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),u.value?(i(),m("div",Hs,[t("div",{class:"hover-btn-box",onClick:Ct=>T(Pt)},[e(g(mt))],8,Zs)])):L("",!0)]),t("div",Ys,[e(nt,{bordered:!1,disabled:!u.value,value:O.describe,"onUpdate:value":Ct=>O.describe=Ct,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),u.value?(i(),m("div",Xs,[e(qt,{onClick:w,block:"",icon:Ft(g(Ut))},{default:a(()=>y[32]||(y[32]=[S("添加主题")])),_:1,__:[32]},8,["icon"])])):L("",!0)],64)):L("",!0),t("div",tn,[t("div",{class:"btn-item",onClick:o},[c.value?(i(),m(N,{key:1},[y[34]||(y[34]=S("收起")),e(g(Ie))],64)):(i(),m(N,{key:0},[y[33]||(y[33]=S("展开")),e(g(te))],64))])])])):(i(),m("div",en,[u.value?(i(),m("div",on,[t("div",sn,[y[35]||(y[35]=S(" 输出markdown： ")),e(St,{size:"small",onChange:y[17]||(y[17]=O=>U(O,"outDiySwitch")),checked:k.value,"onUpdate:checked":y[18]||(y[18]=O=>k.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",nn,[y[36]||(y[36]=S(" 回复图片： ")),e(St,{size:"small",onChange:y[19]||(y[19]=O=>U(O,"imgDiySwitch")),checked:$.value,"onUpdate:checked":y[20]||(y[20]=O=>$.value=O),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):L("",!0),e(nt,{bordered:u.value,value:_.prompt,"onUpdate:value":y[21]||(y[21]=O=>_.prompt=O),disabled:!u.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),e(rs,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:A},null,512),e(Qe,{onOk:ae,ref_key:"importPromptRef",ref:ct},null,512),e(ds,{ref_key:"uploadPromptRef",ref:vt},null,512)])}}},an=D(ln,[["__scopeId","data-v-ba912067"]]),rn={class:"actions-box"},dn={class:"setting-info-block"},_n={class:"set-item w-100"},cn={class:"set-item"},un={class:"set-item"},pn={class:"set-item"},mn={class:"set-item"},vn={class:"form-box"},bn={class:"form-item"},fn={class:"form-item-body"},hn={class:"form-item",style:{display:"flex","align-items":"center"}},yn={class:"form-item"},kn={class:"form-item-label"},gn={class:"form-item-body"},xn={class:"number-box"},$n={class:"number-slider-box"},wn={class:"number-input-box"},qn={class:"form-item"},Sn={class:"form-item-label"},Cn={class:"form-item-body"},In={class:"number-box"},Ln={class:"number-slider-box"},Un={class:"number-input-box"},Rn={class:"form-item"},En={class:"form-item-label"},On={class:"form-item-body"},An={class:"number-box"},jn={class:"number-slider-box"},Vn={class:"number-input-box"},Mn={class:"form-item justify-between"},zn={class:"form-item-label"},Nn={class:"form-item justify-between"},Pn={class:"form-item-label"},Dn={__name:"model-settings",setup(V){const u=P({sm:24,md:24,lg:12,xl:24,xxl:24});q([]);const h=q(!1),{robotInfo:l,updateRobotInfo:p,getRobot:s}=J("robotInfo"),n=P({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0}),x=()=>{n.use_model&&n.use_model.toLowerCase().includes("deepseek-r1")?n.prompt_role_type="1":n.prompt_role_type="0"},f=q({}),k=(b,r)=>{f.value=r},$=K(()=>{if(!n.model_config_id)return!1;let b=n.model_config_id+"#"+n.use_model;return f.value[b]}),_=()=>{let b={...Q(n)};p(b),h.value=!1},c=()=>{s(l.id).then(b=>{n.model_config_id=b.data.model_config_id,n.use_model=b.data.use_model})},o=b=>{n.use_model=l.use_model,n.model_config_id=l.model_config_id,n.temperature=l.temperature,n.max_token=l.max_token,n.context_pair=l.context_pair,n.think_switch=Number(l.think_switch),n.prompt_role_type=l.prompt_role_type,n.enable_thinking=l.enable_thinking,h.value=b};xt(()=>{n.use_model=l.use_model,n.model_config_id=l.model_config_id,n.temperature=l.temperature,n.max_token=l.max_token,n.context_pair=l.context_pair,n.think_switch=Number(l.think_switch),n.prompt_role_type=l.prompt_role_type,n.enable_thinking=l.enable_thinking});const d=K(()=>ne(n.model_config_id,n.use_model));return(b,r)=>{const C=et,U=Ue,I=Vt,v=jt,w=ot,T=ee,E=wt,M=tt,Z=Le,st=X;return i(),j(H,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:h.value,"onUpdate:isEdit":r[13]||(r[13]=A=>h.value=A)},{extra:a(()=>[t("div",rn,[e(C,{onClick:r[0]||(r[0]=A=>o(!0)),size:"small"},{default:a(()=>r[14]||(r[14]=[S("修改")])),_:1,__:[14]})])]),default:a(()=>[t("div",dn,[t("div",_n,[r[15]||(r[15]=S(" LLM模型： ")),t("span",null,R(d.value),1)]),t("div",cn,[r[16]||(r[16]=S(" 温度： ")),t("span",null,R(n.temperature),1)]),t("div",un,[r[17]||(r[17]=S(" 最大token： ")),t("span",null,R(n.max_token),1)]),t("div",pn,[r[18]||(r[18]=S(" 上下文数量： ")),t("span",null,R(n.context_pair),1)]),t("div",mn,[r[19]||(r[19]=S(" 显示推理过程： ")),t("span",null,R(n.think_switch==1?"开":"关"),1)])]),e(st,{open:h.value,"onUpdate:open":r[12]||(r[12]=A=>h.value=A),width:672,title:"模型设置",onCancel:c,onOk:_},{default:a(()=>[t("div",vn,[e(Z,{gutter:[32,24]},{default:a(()=>[e(U,ut(ft(u)),{default:a(()=>[t("div",bn,[r[20]||(r[20]=t("div",{class:"form-item-label mb12"},[t("span",null,"LLM模型 ")],-1)),t("div",fn,[e(Mt,{modelType:"LLM",modeName:n.use_model,"onUpdate:modeName":r[1]||(r[1]=A=>n.use_model=A),modeId:n.model_config_id,"onUpdate:modeId":r[2]||(r[2]=A=>n.model_config_id=A),onChange:x,onLoaded:k},null,8,["modeName","modeId"])])])]),_:1},16),e(U,ut(ft(u)),{default:a(()=>[t("div",hn,[r[23]||(r[23]=t("div",{class:"form-item-label mb12"},[t("span",null,"提示词所属角色： ")],-1)),t("div",null,[e(v,{value:n.prompt_role_type,"onUpdate:value":r[3]||(r[3]=A=>n.prompt_role_type=A)},{default:a(()=>[e(I,{value:"0"},{default:a(()=>r[21]||(r[21]=[S("系统角色（System）")])),_:1,__:[21]}),e(I,{value:"1"},{default:a(()=>r[22]||(r[22]=[S("用户角色（User）")])),_:1,__:[22]})]),_:1},8,["value"])])])]),_:1},16),e(U,ut(ft(u)),{default:a(()=>[t("div",yn,[t("div",kn,[r[25]||(r[25]=t("span",null,"温度 ",-1)),e(w,null,{title:a(()=>r[24]||(r[24]=[S("温度越低，回答越严谨。温度越高，回答越发散。")])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),t("div",gn,[t("div",xn,[t("div",$n,[e(T,{class:"custom-slider",value:n.temperature,"onUpdate:value":r[4]||(r[4]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])]),t("div",wn,[e(E,{value:n.temperature,"onUpdate:value":r[5]||(r[5]=A=>n.temperature=A),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),e(U,ut(ft(u)),{default:a(()=>[t("div",qn,[t("div",Sn,[r[27]||(r[27]=t("span",null,"最大token ",-1)),e(w,null,{title:a(()=>r[26]||(r[26]=[S("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),t("div",Cn,[t("div",In,[t("div",Ln,[e(T,{class:"custom-slider",value:n.max_token,"onUpdate:value":r[6]||(r[6]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])]),t("div",Un,[e(E,{value:n.max_token,"onUpdate:value":r[7]||(r[7]=A=>n.max_token=A),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),e(U,ut(ft(u)),{default:a(()=>[t("div",Rn,[t("div",En,[r[29]||(r[29]=t("span",null,"上下文数量 ",-1)),e(w,null,{title:a(()=>r[28]||(r[28]=[S("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),t("div",On,[t("div",An,[t("div",jn,[e(T,{class:"custom-slider",value:n.context_pair,"onUpdate:value":r[8]||(r[8]=A=>n.context_pair=A),min:0,max:50},null,8,["value"])]),t("div",Vn,[e(E,{value:n.context_pair,"onUpdate:value":r[9]||(r[9]=A=>n.context_pair=A),min:0,max:50},null,8,["value"])])])])])]),_:1},16),$.value?(i(),j(U,ut(Qt({key:0},u)),{default:a(()=>[t("div",Mn,[t("div",zn,[r[31]||(r[31]=t("span",null,"深度思考 ",-1)),e(w,null,{title:a(()=>r[30]||(r[30]=[t("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),e(M,{checked:n.enable_thinking,"onUpdate:checked":r[10]||(r[10]=A=>n.enable_thinking=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):L("",!0),e(U,ut(ft(u)),{default:a(()=>[t("div",Nn,[t("div",Pn,[r[33]||(r[33]=t("span",null,"显示推理过程 ",-1)),e(w,null,{title:a(()=>r[32]||(r[32]=[t("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),e(M,{checked:n.think_switch,"onUpdate:checked":r[11]||(r[11]=A=>n.think_switch=A),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Tn=D(Dn,[["__scopeId","data-v-c8516423"]]),Bn={class:"recall-settings-box"},Jn={class:"form-box"},Fn={class:"form-item is-required"},Qn={class:"form-item-body"},Kn={class:"retrieval-mode-items"},Gn=["onClick"],Wn={class:"retrieval-mode-title"},Hn={class:"title-text"},Zn={key:0,style:{width:"32px"},src:We,alt:""},Yn={class:"retrieval-mode-desc"},Xn={class:"form-item"},ti={class:"form-item-label"},ei={class:"form-item-body"},oi={class:"number-box"},si={class:"number-slider-box"},ni={class:"number-input-box"},ii={key:0,class:"form-item"},li={class:"form-item-label"},ai={class:"form-item-body"},ri={class:"number-box"},di={class:"number-slider-box"},_i={class:"number-input-box"},ci={class:"form-item"},ui={class:"form-item-label"},pi={key:0,class:"form-item-body"},mi={__name:"recall-settings-alert",emits:["change"],setup(V,{expose:u,emit:h}){const l=h,p=q([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=P({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),n=q(!1),x=o=>{s.rerank_status=o.rerank_status||0,s.rerank_use_model=o.rerank_use_model||void 0,s.rerank_model_config_id=o.rerank_model_config_id>0?o.rerank_model_config_id:"",s.top_k=o.top_k,s.similarity=o.similarity,s.search_type=o.search_type,n.value=!0},f=o=>{o==0&&(s.rerank_model_config_id="",s.rerank_use_model="")},k=o=>{s.search_type=o},$=()=>s.rerank_status==1&&!s.rerank_model_config_id,_=()=>{if($())return G.error("请选择Rerank模型");n.value=!1,c()},c=()=>{l("change",Q(s))};return u({open:x}),(o,d)=>{const b=_t,r=ot,C=ee,U=wt,I=tt,v=X;return i(),j(v,{width:"746px",open:n.value,"onUpdate:open":d[7]||(d[7]=w=>n.value=w),title:"召回设置",onOk:_},{default:a(()=>[t("div",Bn,[t("div",Jn,[t("div",Fn,[d[8]||(d[8]=t("div",{class:"form-item-label"},[t("span",null,"检索模式")],-1)),t("div",Qn,[t("div",Kn,[(i(!0),m(N,null,W(p.value,w=>(i(),m("div",{class:Lt(["retrieval-mode-item",{active:s.search_type==w.value}]),key:w.value,onClick:T=>k(w.value)},[s.search_type==w.value?(i(),j(b,{key:0,class:"check-arrow",name:"check-arrow-filled"})):L("",!0),t("div",Wn,[e(b,{name:w.iconName,class:"title-icon"},null,8,["name"]),t("span",Hn,R(w.title),1),w.isRecommendation?(i(),m("img",Zn)):L("",!0)]),t("div",Yn,R(w.desc),1)],10,Gn))),128))])])]),t("div",Xn,[t("div",ti,[d[10]||(d[10]=t("span",null,"Top K ",-1)),e(r,null,{title:a(()=>d[9]||(d[9]=[S("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),t("div",ei,[t("div",oi,[t("div",si,[e(C,{class:"custom-slider",value:s.top_k,"onUpdate:value":d[0]||(d[0]=w=>s.top_k=w),min:1,max:10},null,8,["value"])]),t("div",ni,[e(U,{value:s.top_k,"onUpdate:value":d[1]||(d[1]=w=>s.top_k=w),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(i(),m("div",ii,[t("div",li,[d[12]||(d[12]=t("span",null,"相似度阈值 ",-1)),e(r,null,{title:a(()=>d[11]||(d[11]=[S("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:a(()=>[e(g(Y),{class:"question-icon"})]),_:1})]),t("div",ai,[t("div",ri,[t("div",di,[e(C,{class:"custom-slider",value:s.similarity,"onUpdate:value":d[2]||(d[2]=w=>s.similarity=w),min:0,max:1,step:.01},null,8,["value"])]),t("div",_i,[e(U,{value:s.similarity,"onUpdate:value":d[3]||(d[3]=w=>s.similarity=w),min:0,max:1,step:.01},null,8,["value"])])])])])):L("",!0),t("div",ci,[t("div",ui,[d[13]||(d[13]=t("span",null,"Rerank模型",-1)),d[14]||(d[14]=S("   ")),e(I,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":d[4]||(d[4]=w=>s.rerank_status=w),onChange:f},null,8,["checked"])]),s.rerank_status==1?(i(),m("div",pi,[e(Mt,{modelType:"RERANK",modeName:s.rerank_use_model,"onUpdate:modeName":d[5]||(d[5]=w=>s.rerank_use_model=w),modeId:s.rerank_model_config_id,"onUpdate:modeId":d[6]||(d[6]=w=>s.rerank_model_config_id=w),style:{width:"60%"}},null,8,["modeName","modeId"])])):L("",!0)])])])]),_:1},8,["open"])}}},vi=D(mi,[["__scopeId","data-v-25a96376"]]),bi={class:"list-box"},fi=["onClick"],hi={class:"avater-box"},yi=["src"],ki={class:"content-box"},gi={class:"title-block"},xi={class:"title-text"},$i={class:"desc-box"},wi={class:"right-icon"},qi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(V,{expose:u,emit:h}){const l=h,p=V,s=q(!1);at(()=>p.list,()=>{p.list.length==0&&(s.value=!1)},{});const n=()=>{s.value=!0},x=()=>{document.visibilityState==="visible"&&l("refreshList")};ht(()=>{document.addEventListener("visibilitychange",x)}),ue(()=>{document.removeEventListener("visibilitychange",x)});const f=k=>{window.open(`/#/library/details/knowledge-config?id=${k.id}`)};return u({show:n}),(k,$)=>{const _=Re,c=ie,o=X;return i(),m("div",null,[e(o,{open:s.value,"onUpdate:open":$[0]||($[0]=d=>s.value=d),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:a(()=>[e(_,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),e(c,{scrollbar:!1,style:{height:"400px"}},{default:a(()=>[t("div",bi,[(i(!0),m(N,null,W(p.list,d=>(i(),m("div",{class:"list-item",onClick:b=>f(d),key:d.id},[t("div",hi,[t("img",{src:d.avatar,alt:""},null,8,yi)]),t("div",ki,[t("div",gi,[$[1]||($[1]=t("div",{class:"tag-icon"},"Graph",-1)),t("div",xi,R(d.library_name),1)]),t("div",$i,R(d.library_intro),1)]),t("div",wi,[e(g(Ee))])],8,fi))),128))])]),_:1})]),_:1},8,["open"])])}}},Si=D(qi,[["__scopeId","data-v-0ebe0aeb"]]),Ci={class:"actions-box"},Ii={key:0,class:"library-list"},Li=["onClick"],Ui=["onClick"],Ri={class:"library-name"},Ei={class:"library-name-text"},Oi={class:"library-intro"},Ai={class:"setting-info-block"},ji={class:"set-item"},Vi={key:0},Mi={key:1},zi={key:2},Ni={key:3},Pi={class:"set-item"},Di={key:0,class:"set-item"},Ti={class:"set-item"},Bi={key:0},Ji={key:1},Fi={__name:"index",setup(V){const u=ke();K(()=>{var E;return((E=u.companyInfo)==null?void 0:E.neo4j_status)=="true"});const h=q(!1),{robotInfo:l,updateRobotInfo:p}=J("robotInfo"),s=P({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),n=q([]),x=q(null),f=q(null),k=K(()=>n.value.filter(E=>f.value?s.library_ids.includes(E.id):s.library_ids.includes(E.id)&&E.type!=3)),$=K(()=>k.value.filter(E=>E.graph_switch==0)),_=E=>{let M=s.library_ids.indexOf(E.id);s.library_ids.splice(M,1),U()},c=E=>{s.library_ids=[...E],U()},o=()=>{x.value.open([...s.library_ids])},d=q(null),b=()=>{d.value.open(Q(s))},r=q(null),C=E=>{s.rerank_status=E.rerank_status,s.rerank_use_model=E.rerank_use_model,s.rerank_model_config_id=E.rerank_model_config_id,s.top_k=E.top_k,s.similarity=E.similarity,s.search_type=E.search_type,(E.search_type==1||E.search_type==4)&&$.value.length>0&&r.value.show(),U()},U=()=>{let E={...Q(s)};E.library_ids=E.library_ids.join(","),E.op_type_relation_library=1,p({...E})},I=async()=>{const E=await ge({type:"",show_open_docs:1});E&&(n.value=E.data||[])},v=()=>{He({ability_type:"library_ability_official_account"}).then(E=>{var Z;let M=(E==null?void 0:E.data)||{};((Z=M==null?void 0:M.user_config)==null?void 0:Z.switch_status)==1&&(f.value=M)})};s.rerank_use_model=l.rerank_use_model||void 0,xt(()=>{s.library_ids=l.library_ids.split(","),s.rerank_status=l.rerank_status||0,s.rerank_use_model=l.rerank_use_model||void 0,s.rerank_model_config_id=l.rerank_model_config_id||"",s.top_k=l.top_k,s.similarity=l.similarity,s.search_type=l.search_type});const w=E=>{window.open(`#/library/details/knowledge-document?id=${E.id}`)},T=K(()=>ne(s.rerank_model_config_id,s.rerank_use_model,"RERANK"));return ht(()=>{v(),I()}),(E,M)=>{const Z=et,st=$t;return i(),j(H,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:h.value,"onUpdate:isEdit":M[0]||(M[0]=A=>h.value=A),bodyStyle:{padding:0}},{extra:a(()=>[t("div",Ci,[e(st,{gap:8},{default:a(()=>[e(Z,{size:"small",onClick:b},{default:a(()=>M[1]||(M[1]=[S("召回设置")])),_:1,__:[1]}),e(Z,{size:"small",onClick:o},{default:a(()=>M[2]||(M[2]=[S("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:a(()=>[k.value.length>0?(i(),m("div",Ii,[(i(!0),m(N,null,W(k.value,A=>(i(),m("div",{class:"library-item",key:A.id,onClick:B=>w(A)},[A.id!=g(l).default_library_id?(i(),m("span",{key:0,class:"close-btn",onClick:pe(B=>_(A),["stop"])},[e(g(mt))],8,Ui)):L("",!0),t("div",Ri,[t("div",Ei,R(A.library_name),1)]),t("div",Oi,R(A.library_intro),1)],8,Li))),128))])):L("",!0),t("div",Ai,[t("div",ji,[M[3]||(M[3]=S(" 检索模式： ")),s.search_type==1?(i(),m("span",Vi,"混合检索")):L("",!0),s.search_type==2?(i(),m("span",Mi,"向量检索")):L("",!0),s.search_type==3?(i(),m("span",zi,"全文检索")):L("",!0),s.search_type==4?(i(),m("span",Ni,"知识图谱检索")):L("",!0)]),t("div",Pi,[M[4]||(M[4]=S(" Top K： ")),t("span",null,R(s.top_k),1)]),s.search_type<=2?(i(),m("div",Di,[M[5]||(M[5]=S(" 相似度阈值： ")),t("span",null,R(s.similarity),1)])):L("",!0),t("div",Ti,[M[6]||(M[6]=S(" Rerank模型： ")),s.rerank_status==0?(i(),m("span",Bi,"关")):(i(),m("span",Ji,R(T.value),1))])]),e(Ge,{ref_key:"librarySelectAlertRef",ref:x,onChange:c,showWxType:!!f.value},null,8,["showWxType"]),e(vi,{ref_key:"recallSettingsAlertRef",ref:d,onChange:C},null,512),e(Si,{list:$.value,onRefreshList:I,ref_key:"noOpenGraphModalRef",ref:r},null,8,["list"])]),_:1},8,["isEdit"])}}},Qi=D(Fi,[["__scopeId","data-v-ea70df91"]]),Ki={class:"library-checkbox-box"},Gi={class:"list-box",ref:"scrollContainer"},Wi={class:"library-name"},Hi={class:"library-desc"},Zi={key:0,class:"empty-box"},Yi={__name:"library-select-alert",emits:["change"],setup(V,{expose:u,emit:h}){const l=h,p=P({indeterminate:!1,checkAll:!1,checkedList:[]}),s=q(!1),n=o=>{$(),p.checkedList=o,s.value=!0},x=()=>{s.value=!1,k()};q("");const f=q([]),k=()=>{l("change",[...p.checkedList])},$=async()=>{const o=await le();if(o){let d=o.data||[];f.value=d}},_=q(!1),c=()=>{window.open("/#/database/list")};return u({open:n}),(o,d)=>{const b=Ae,r=Oe,C=Gt,U=X;return i(),j(U,{width:"746px",open:s.value,"onUpdate:open":d[1]||(d[1]=I=>s.value=I),title:"关联数据表",onOk:x},{default:a(()=>[t("div",Ki,[e(C,{spinning:_.value,delay:100},{default:a(()=>[e(r,{value:p.checkedList,"onUpdate:value":d[0]||(d[0]=I=>p.checkedList=I),style:{width:"100%"}},{default:a(()=>[t("div",Gi,[(i(!0),m(N,null,W(f.value,I=>(i(),m("div",{class:"list-item-wraapper",key:I.id},[e(b,{class:"list-item",value:I.id},{default:a(()=>[t("div",Wi,R(I.name),1),t("div",Hi,R(I.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!_.value&&!f.value.length?(i(),m("div",Zi,[d[3]||(d[3]=t("img",{src:Ze,alt:""},null,-1)),t("div",null,[d[2]||(d[2]=S(" 暂无数据表, 请先去添加数据表 ")),t("a",{onClick:c}," 去添加")])])):L("",!0)])]),_:1},8,["open"])}}},Xi=D(Yi,[["__scopeId","data-v-890ab853"]]),tl={class:"actions-box"},el={key:0,class:"library-list"},ol=["onClick"],sl={class:"library-name"},nl={class:"library-intro"},il={__name:"index",setup(V){const u=q(!1),{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),p=P({form_ids:[]}),s=q([]),n=q(null),x=K(()=>s.value.filter(o=>p.form_ids.includes(o.id))),f=o=>{let d=p.form_ids.indexOf(o.id);p.form_ids.splice(d,1),_()},k=o=>{p.form_ids=[...o],_()},$=()=>{n.value.open([...p.form_ids])},_=()=>{let o={...Q(p)};o.form_ids=o.form_ids.join(","),l({...o})};return(async()=>{const o=await le();o&&(s.value=o.data||[])})(),xt(()=>{p.form_ids=h.form_ids.split(",")}),(o,d)=>{const b=ot,r=et,C=$t;return i(),j(H,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:u.value,"onUpdate:isEdit":d[0]||(d[0]=U=>u.value=U),bodyStyle:{padding:0}},{tip:a(()=>[e(b,{placement:"top"},{title:a(()=>d[1]||(d[1]=[t("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:a(()=>[e(g(Y))]),_:1})]),extra:a(()=>[t("div",tl,[e(C,{gap:8},{default:a(()=>[e(r,{size:"small",onClick:$},{default:a(()=>d[2]||(d[2]=[S("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:a(()=>[x.value.length>0?(i(),m("div",el,[(i(!0),m(N,null,W(x.value,U=>(i(),m("div",{class:"library-item",key:U.id},[t("span",{class:"close-btn",onClick:I=>f(U)},[e(g(mt))],8,ol),t("div",sl,R(U.name),1),t("div",nl,R(U.description),1)]))),128))])):L("",!0),e(Xi,{ref_key:"librarySelectAlertRef",ref:n,onChange:k},null,512)]),_:1},8,["isEdit"])}}},ll=D(il,[["__scopeId","data-v-077d8df6"]]),al={class:"form-box"},rl={class:"question-title"},dl={class:"question-options"},_l={class:"question-option"},cl={class:"drag-btn"},ul={class:"action-box"},pl={class:"robot-info-box"},ml={class:"robot-welcome-content"},vl={class:"robot-welcome-question"},bl={__name:"welcome-words",setup(V){const u=q(!1),h=q(!1),{robotInfo:l,updateRobotInfo:p,scrollBoxToBottom:s}=J("robotInfo"),n=P({welcomes:{content:"",question:[]}}),x=()=>{let c=!1;if(n.welcomes.question.length>0){for(let o=0;o<n.welcomes.question.length;o++)if(!n.welcomes.question[o].content){c=o+1;break}}return c},f=()=>{n.welcomes.question.push({content:"",id:It(8)})},k=c=>{n.welcomes.question.splice(c,1)},$=()=>{if(!n.welcomes.content)return G.error("请输入欢迎语");if(x())return G.error("引导问题内容不能为空");p({...Q(n)}),u.value=!1},_=()=>{let c={...l.welcomes},o=[];c.question.forEach(({content:d,id:b})=>{let r={id:b,content:d};r.id||(r.id=It(6)),o.push(r)}),n.welcomes.content=c.content,n.welcomes.question=o};return(c,o)=>{const d=kt,b=_t,r=yt;return i(),j(H,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:u.value,"onUpdate:isEdit":o[4]||(o[4]=C=>u.value=C),onSave:$,onEdit:_},{default:a(()=>[rt(t("div",al,[t("div",rl,[e(d,{value:n.welcomes.content,"onUpdate:value":o[0]||(o[0]=C=>n.welcomes.content=C),placeholder:"请输入欢迎语"},null,8,["value"])]),t("div",dl,[e(g(zt),{modelValue:n.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=C=>n.welcomes.question=C),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=C=>h.value=!0),onEnd:o[3]||(o[3]=C=>h.value=!1)},{item:a(({element:C,index:U})=>[t("div",_l,[t("span",cl,[e(b,{name:"drag"})]),e(r,{class:"question-option-content",value:C.content,"onUpdate:value":I=>C.content=I,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",ul,[e(g(mt),{class:"del-btn",onClick:I=>k(U)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:f},[e(g(Ut),{class:"add-btn-icon"}),o[5]||(o[5]=S("添加引导问题 "))])])],512),[[dt,u.value]]),rt(t("div",pl,[t("div",ml,R(g(l).welcomes.content),1),t("div",vl,[(i(!0),m(N,null,W(g(l).welcomes.question,(C,U)=>(i(),m("div",{class:"question-item",key:U},R(C.content),1))),128))])],512),[[dt,!u.value]])]),_:1},8,["isEdit"])}}},fl=D(bl,[["__scopeId","data-v-9b840ded"]]),hl={class:"form-box"},yl={class:"question-title"},kl={class:"question-options"},gl={class:"question-option"},xl={class:"drag-btn"},$l={class:"action-box"},wl={class:"robot-info-box"},ql={class:"robot-unknown-content"},Sl={class:"robot-unknown-question"},Cl={__name:"unknown-problem-prompt",setup(V){const u=q(!1),h=q(!1),{robotInfo:l,updateRobotInfo:p,scrollBoxToBottom:s}=J("robotInfo"),n=P({unknown_question_prompt:{content:"",question:[]}}),x=()=>{n.unknown_question_prompt.question.push({content:"",id:It(8)}),Kt(()=>{s()})},f=_=>{n.unknown_question_prompt.question.splice(_,1)},k=()=>{p({...Q(n)}),u.value=!1},$=()=>{let _={...l.unknown_question_prompt},c=[];_.question&&_.question.forEach(({content:o,id:d})=>{let b={id:d,content:o};b.id||(b.id=It(6)),c.push(b)}),_.content&&(n.unknown_question_prompt.content=_.content),c&&(n.unknown_question_prompt.question=c)};return ht(()=>{}),(_,c)=>{const o=ot,d=kt,b=_t,r=yt;return i(),j(H,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:u.value,"onUpdate:isEdit":c[4]||(c[4]=C=>u.value=C),onSave:k,onEdit:$},{tip:a(()=>[e(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:a(()=>c[5]||(c[5]=[t("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:a(()=>[e(g(Y))]),_:1})]),default:a(()=>[rt(t("div",hl,[t("div",yl,[e(d,{value:n.unknown_question_prompt.content,"onUpdate:value":c[0]||(c[0]=C=>n.unknown_question_prompt.content=C),placeholder:"请输入未知问题提示语"},null,8,["value"])]),t("div",kl,[e(g(zt),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":c[1]||(c[1]=C=>n.unknown_question_prompt.question=C),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=C=>h.value=!0),onEnd:c[3]||(c[3]=C=>h.value=!1)},{item:a(({element:C,index:U})=>[t("div",gl,[t("span",xl,[e(b,{name:"drag"})]),e(r,{class:"question-option-content",value:C.content,"onUpdate:value":I=>C.content=I,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",$l,[e(g(mt),{class:"del-btn",onClick:I=>f(U)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:x},[e(g(Ut),{class:"add-btn-icon"}),c[6]||(c[6]=S("添加引导问题 "))])])],512),[[dt,u.value]]),rt(t("div",wl,[t("div",ql,R(g(l).unknown_question_prompt.content),1),t("div",Sl,[(i(!0),m(N,null,W(g(l).unknown_question_prompt.question,(C,U)=>(i(),m("div",{class:"question-item",key:U},R(C.content),1))),128))])],512),[[dt,!u.value]])]),_:1},8,["isEdit"])}}},Il=D(Cl,[["__scopeId","data-v-aca01d0e"]]),Ll={class:"robot-info-box"},Ul={class:"modal-box",ref:"modalBoxRef"},Rl={class:"modal-item-box"},El={class:"modal-item"},Ol={class:"modal-item"},Al={__name:"problem-optimization",setup(V){const u=q(!1);q(!1);const{robotInfo:h,updateRobotInfo:l}=J("robotInfo"),p=q("0"),s=P({optimize_question_use_model:"",optimize_question_model_config_id:""});ht(()=>{p.value=h.optimize_question_model_config_id!=0?"1":"0",s.optimize_question_use_model=h.optimize_question_use_model,s.optimize_question_model_config_id=h.optimize_question_model_config_id});const n=q([]),x=c=>{n.value=c,Kt(()=>{(!s.optimize_question_use_model||!Number(s.optimize_question_model_config_id))&&f()})},f=()=>{if(n.value.length>0){let c=null,o=null;for(let d of n.value)if(d.model_define==="tongyi"){c=d;for(let b of c.children)if(b.name==="qwen-max"){o=b;break}break}c||(c=n.value[0],o=c.children[0]),c&&o&&(s.optimize_question_use_model=o.name,s.optimize_question_model_config_id=o.model_config_id)}},k=()=>{u.value=!1,l({...Q(s)})},$=c=>{c!=1&&(s.optimize_question_use_model="",s.optimize_question_model_config_id=0)},_=c=>{l({})};return(c,o)=>{const d=ot,b=tt,r=Vt,C=jt,U=kt,I=X;return i(),j(H,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:a(()=>o[7]||(o[7]=[t("span",null,null,-1)])),default:a(()=>[t("div",Ll,[o[9]||(o[9]=t("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),e(d,null,{title:a(()=>o[8]||(o[8]=[t("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:a(()=>[t("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=v=>u.value=!0)}," 对话背景设置 ")]),_:1})]),e(b,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(h).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=v=>g(h).enable_question_optimize=v),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t("div",Ul,[e(I,{getContainer:()=>c.$refs.modalBoxRef,open:u.value,"onUpdate:open":o[6]||(o[6]=v=>u.value=v),width:472,title:"用户问题建议设置",onOk:k},{default:a(()=>[t("div",Rl,[t("div",El,[o[12]||(o[12]=t("div",{class:"label"},"模型",-1)),e(C,{value:p.value,"onUpdate:value":o[2]||(o[2]=v=>p.value=v),onChange:$},{default:a(()=>[e(r,{value:"0"},{default:a(()=>o[10]||(o[10]=[S("跟随机器人")])),_:1,__:[10]}),e(r,{value:"1"},{default:a(()=>o[11]||(o[11]=[S("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),p.value=="1"?(i(),j(Mt,{key:0,modelType:"LLM",modeName:s.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=v=>s.optimize_question_use_model=v),modeId:s.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=v=>s.optimize_question_model_config_id=v),style:{width:"100%","margin-top":"8px"},onLoaded:x},null,8,["modeName","modeId"])):L("",!0)]),t("div",Ol,[o[13]||(o[13]=t("div",{class:"label"},"对话背景",-1)),e(U,{style:{height:"120px"},value:g(h).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=v=>g(h).optimize_question_dialogue_background=v),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},jl=D(Al,[["__scopeId","data-v-13ab9369"]]),Vl={class:"robot-info-box"},Ml={class:"robot-prompt"},zl={__name:"suggested-issues",setup(V){q(!1);const{robotInfo:u,updateRobotInfo:h}=J("robotInfo"),l=p=>{h({})};return(p,s)=>{const n=wt,x=tt;return i(),j(H,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:a(()=>s[2]||(s[2]=[t("span",null,null,-1)])),default:a(()=>[t("div",Vl,[t("div",Ml,[s[3]||(s[3]=S(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),e(n,{value:g(u).question_guide_num,"onUpdate:value":s[0]||(s[0]=f=>g(u).question_guide_num=f),style:{width:"80px"},precision:0,min:1,max:10,onBlur:l},null,8,["value"]),s[4]||(s[4]=S(" 条用户提问建议，最大不超过10条。 "))])]),e(x,{onChange:l,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(u).enable_question_guide,"onUpdate:checked":s[1]||(s[1]=f=>g(u).enable_question_guide=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Nl=D(zl,[["__scopeId","data-v-bec632a5"]]),Pl={__name:"sensitive-words",setup(V){q(!1);const{robotInfo:u,updateRobotInfo:h}=J("robotInfo");P({prompt:""});const l=()=>{window.open("/#/user/sensitive-words")},p=s=>{h({})};return(s,n)=>{const x=tt;return i(),j(H,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:a(()=>n[1]||(n[1]=[t("span",null,null,-1)])),default:a(()=>[t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},[n[2]||(n[2]=S(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),t("span",{onClick:l,style:{cursor:"pointer"}},"设置敏词 >")])]),e(x,{onChange:p,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:g(u).sensitive_words_switch,"onUpdate:checked":n[0]||(n[0]=f=>g(u).sensitive_words_switch=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Dl=D(Pl,[["__scopeId","data-v-f1e5ad50"]]),Tl={class:"direct-title"},Bl={class:"direct-desc"},Jl={class:"qa"},Fl={class:"prompt-form-item-label"},Ql={class:"direct-switch"},Kl={class:"similarity"},Gl={class:"number-input-box"},Wl={__name:"chat-edit-alert",emits:["save"],setup(V,{expose:u,emit:h}){const l=h,p=q(1),s=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=P(s()),x=q(!1),f=P({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),k=()=>{f.chat_type=p.value.toString(),n.forEach(c=>{c.chat_type==p.value&&(f.chat_type=="3"?(f.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch==1?"true":"false",f.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score.toString()):f.chat_type=="1"&&(f.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch==1?"true":"false",f.library_qa_direct_reply_score=c.library_qa_direct_reply_score.toString()))}),$(),Object.assign(n,s()),x.value=!1},$=()=>{l("save",Q(f))};ht(()=>{});const _=c=>{p.value=parseInt(c.chat_type),f.chat_type=c.chat_type,f.library_qa_direct_reply_score=c.library_qa_direct_reply_score,f.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch,f.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,f.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch,n.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=c.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch=="true"?1:0)}),x.value=!0};return at(()=>x.value,c=>{c===!1&&Object.assign(n,s())},{immediate:!0}),u({open:_}),(c,o)=>{const d=ot,b=tt,r=wt,C=Vt,U=jt,I=X;return i(),j(I,{width:"746px",open:x.value,"onUpdate:open":o[1]||(o[1]=v=>x.value=v),title:"聊天模式设置",onOk:k},{default:a(()=>[e(U,{class:"direct-box",value:p.value,"onUpdate:value":o[0]||(o[0]=v=>p.value=v)},{default:a(()=>[(i(!0),m(N,null,W(n,v=>(i(),j(C,{class:Lt(["direct-item",{active:p.value==v.direct_id}]),value:v.direct_id,key:v.direct_id},{default:a(()=>[t("div",Tl,R(v.direct_title),1),t("div",Bl,R(v.direct_desc),1),rt(t("div",Jl,[t("div",Fl,[o[4]||(o[4]=t("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),e(d,null,me({default:a(()=>[e(g(Y),{class:"question-icon"})]),_:2},[v.chat_type=="1"?{name:"title",fn:a(()=>[o[2]||(o[2]=S("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:v.chat_type=="3"?{name:"title",fn:a(()=>[o[3]||(o[3]=S("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),t("div",Ql,[v.chat_type=="1"?(i(),j(b,{key:0,checkedValue:1,unCheckedValue:0,checked:v.library_qa_direct_reply_switch,"onUpdate:checked":w=>v.library_qa_direct_reply_switch=w},null,8,["checked","onUpdate:checked"])):v.chat_type=="3"?(i(),j(b,{key:1,checkedValue:1,unCheckedValue:0,checked:v.mixture_qa_direct_reply_switch,"onUpdate:checked":w=>v.mixture_qa_direct_reply_switch=w},null,8,["checked","onUpdate:checked"])):L("",!0)])])],512),[[dt,v.isQaDirectReply&&p.value==v.direct_id]]),rt(t("div",Kl,[o[5]||(o[5]=t("span",null,"相似度超过",-1)),t("div",Gl,[v.chat_type=="1"?(i(),j(r,{key:0,value:v.library_qa_direct_reply_score,"onUpdate:value":w=>v.library_qa_direct_reply_score=w,disabled:!v.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):v.chat_type=="3"?(i(),j(r,{key:1,value:v.mixture_qa_direct_reply_score,"onUpdate:value":w=>v.mixture_qa_direct_reply_score=w,disabled:!v.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):L("",!0)]),o[6]||(o[6]=t("span",null,"时直接回复答案",-1))],512),[[dt,v.isQaDirectReply&&p.value==v.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Hl=D(Wl,[["__scopeId","data-v-96e9d8b8"]]),Zl={class:"actions-box"},Yl={class:"setting-info-block"},Xl={class:"set-item"},ta={key:0},ea={key:1},oa={key:2},sa={class:"set-item"},na={key:0,class:"set-item"},ia={class:"set-item"},la={key:0,class:"set-item"},aa={class:"form-box"},ra={__name:"index",setup(V){const u=q(!1),h=q(null),{robotInfo:l,updateRobotInfo:p}=J("robotInfo"),s=P({chat_type:l.chat_type,library_qa_direct_reply_score:l.library_qa_direct_reply_score,library_qa_direct_reply_switch:l.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:l.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:l.mixture_qa_direct_reply_switch}),n=k=>{s.chat_type=k.chat_type,s.library_qa_direct_reply_score=k.library_qa_direct_reply_score,s.library_qa_direct_reply_switch=k.library_qa_direct_reply_switch,s.mixture_qa_direct_reply_score=k.mixture_qa_direct_reply_score,s.mixture_qa_direct_reply_switch=k.mixture_qa_direct_reply_switch,x()},x=()=>{p({...Q(s)}),u.value=!1},f=()=>{h.value.open(Q(s)),u.value=!0};return(k,$)=>{const _=ot,c=et;return i(),j(H,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:u.value,"onUpdate:isEdit":$[1]||($[1]=o=>u.value=o),bodyStyle:{padding:0}},{tip:a(()=>[e(_,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:a(()=>$[2]||($[2]=[t("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),t("br",null,null,-1),t("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:a(()=>[e(g(Y))]),_:1})]),extra:a(()=>[t("div",Zl,[e(c,{size:"small",onClick:$[0]||($[0]=o=>f(!0))},{default:a(()=>$[3]||($[3]=[S("修改")])),_:1,__:[3]})])]),default:a(()=>[t("div",Yl,[t("div",Xl,[$[4]||($[4]=S(" 聊天模式： ")),g(l).chat_type=="1"?(i(),m("span",ta,"仅知识库")):L("",!0),g(l).chat_type=="2"?(i(),m("span",ea,"直连模式")):L("",!0),g(l).chat_type=="3"?(i(),m("span",oa,"混合模式")):L("",!0)]),g(l).chat_type=="1"?(i(),m(N,{key:0},[t("div",sa,[$[5]||($[5]=S(" 命中问答知识时直接回复答案： ")),t("span",null,R(g(l).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),g(l).library_qa_direct_reply_switch=="true"?(i(),m("div",na,[$[6]||($[6]=S(" 相似度阈值： ")),t("span",null,R(g(l).library_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0),g(l).chat_type=="3"?(i(),m(N,{key:1},[t("div",ia,[$[7]||($[7]=S(" 命中问答知识时直接回复答案： ")),t("span",null,R(g(l).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),g(l).mixture_qa_direct_reply_switch=="true"?(i(),m("div",la,[$[8]||($[8]=S(" 相似度阈值： ")),t("span",null,R(g(l).mixture_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0)]),t("div",aa,[e(Hl,{ref_key:"ChatEditAlertRef",ref:h,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},da=D(ra,[["__scopeId","data-v-ed6b923e"]]),_a={class:"switch-box"},ca={class:"switch-box-body"},ua={class:"switch-box-header"},pa={class:"left-box"},ma={class:"switch-box-title"},va={key:0,class:"title-tip"},ba={class:"right-box"},fa={class:"extra-box"},ha={class:"switch-desc"},ya={class:"switch-box-right"},ka={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(V,{emit:u}){const h=u,l=V,p=q(l.value),s=n=>{h("update:value",n),h("change",n)};return(n,x)=>{const f=_t,k=tt;return i(),m("div",_a,[t("div",ca,[t("div",ua,[t("div",pa,[e(f,{class:"switch-box-icon",name:l.iconName},null,8,["name"]),t("span",ma,R(l.title),1),n.$slots.tip?(i(),m("span",va,[pt(n.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",ba,[t("div",fa,[pt(n.$slots,"extra",{},()=>[x[1]||(x[1]=t("div",{class:"extra-box"},null,-1))],!0)])])]),t("div",ha,[pt(n.$slots,"default",{},void 0,!0)])]),t("div",ya,[e(k,{checked:p.value,"onUpdate:checked":x[0]||(x[0]=$=>p.value=$),onChange:s,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},ga=D(ka,[["__scopeId","data-v-0548f52d"]]),xa="/assets/img/phone-head-CDwwPhYa.png",$a="/assets/img/phone-body-CbEf8GZP.png",wa="/assets/img/phone-footer-ClQtNpln.png",qa={class:"common-problem-box"},Sa={class:"left-content-box"},Ca={key:0,class:"empty-box"},Ia={key:1,class:"lists-box"},La={class:"drag-btn"},Ua={class:"title"},Ra={class:"opration-box"},Ea={class:"preview-box"},Oa={class:"phone-body"},Aa={key:0,class:"question-box"},ja={__name:"common-problem",setup(V){q(!1);const{robotInfo:u,updateRobotInfo:h}=J("robotInfo"),l=K(()=>u.common_question_list?JSON.parse(u.common_question_list):[]),p=q([]);p.value=l.value,at(l,()=>{p.value=l.value});const s=Ot.useForm,n=q(!1),x=q("添加问题"),f=P({question:"",index:-1}),k=P({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:$,validate:_,validateInfos:c}=s(f,k),o=()=>{if(l.value.length>=10)return G.error("最多设置10条常用问题");n.value=!0,$(),f.question="",f.index=-1},d=(I,v)=>{n.value=!0,$(),f.question=I,f.index=v},b=I=>{let v=[];v=l.value.filter((w,T)=>I!=T),X.confirm({title:"提醒",icon:e(At),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){h({common_question_list:JSON.stringify(v)})},onCancel(){}})},r=()=>{_().then(()=>{let I=[];f.index>=0?I=l.value.map((v,w)=>w===f.index?f.question:v):I=[f.question,...l.value],h({common_question_list:JSON.stringify(I)}),n.value=!1})},C=I=>{h({})},U=I=>{h({common_question_list:JSON.stringify(p.value)})};return(I,v)=>{const w=ot,T=tt,E=je,M=et,Z=_t,st=yt,A=Wt,B=Ot,ct=X;return i(),m("div",qa,[t("div",Sa,[e(H,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:a(()=>[e(w,null,{title:a(()=>v[4]||(v[4]=[S("最多10条。开启后，常见问题会显示在每条问答后面")])),default:a(()=>[e(g(Y),{class:"quess-icon"})]),_:1})]),extra:a(()=>[e(T,{onChange:C,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:g(u).enable_common_question,"onUpdate:checked":v[0]||(v[0]=F=>g(u).enable_common_question=F),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e(E,{type:"vertical"}),e(M,{type:"primary",size:"small",onClick:o},{default:a(()=>v[5]||(v[5]=[S("添加")])),_:1,__:[5]})]),default:a(()=>[l.value.length==0?(i(),m("div",Ca,[v[7]||(v[7]=t("img",{src:Ye,alt:""},null,-1)),v[8]||(v[8]=t("div",{class:"title"},"暂无数据",-1)),v[9]||(v[9]=t("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),e(M,{onClick:o,type:"primary"},{default:a(()=>v[6]||(v[6]=[S("立即添加")])),_:1,__:[6]})])):(i(),m("div",Ia,[e(g(zt),{modelValue:p.value,"onUpdate:modelValue":v[1]||(v[1]=F=>p.value=F),handle:".drag-btn","item-key":"index",onEnd:U},{item:a(({element:F,index:vt})=>[(i(),m("div",{class:"list-item",key:vt},[t("span",La,[e(Z,{name:"drag"})]),t("div",Ua,R(F),1),t("div",Ra,[e(g(oe),{onClick:Rt=>d(F,vt)},null,8,["onClick"]),e(g(mt),{onClick:Rt=>b(vt)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),t("div",Ea,[v[12]||(v[12]=t("div",{class:"phone-head"},[t("img",{class:"head-img",src:xa,alt:""})],-1)),t("div",Oa,[v[11]||(v[11]=t("div",null,[t("img",{class:"body-img",src:$a,alt:""})],-1)),l.value.length&&g(u).enable_common_question=="true"?(i(),m("div",Aa,[v[10]||(v[10]=t("div",{class:"name"},"常见问题",-1)),(i(!0),m(N,null,W(l.value,F=>(i(),m("div",{class:"list-item",key:F},R(F),1))),128))])):L("",!0)]),v[13]||(v[13]=t("div",{class:"phone-footer"},[t("img",{class:"footer-img",src:wa,alt:""})],-1))]),e(ct,{open:n.value,"onUpdate:open":v[3]||(v[3]=F=>n.value=F),title:x.value,onOk:r,width:"476px"},{default:a(()=>[e(B,{class:"form-box",layout:"vertical"},{default:a(()=>[e(A,Qt({label:"问题名称"},g(c).question),{default:a(()=>[e(st,{maxLength:100,value:f.question,"onUpdate:value":v[2]||(v[2]=F=>f.question=F),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Va=D(ja,[["__scopeId","data-v-dce83f0d"]]),Ma={__name:"display-aitations",setup(V){const{robotInfo:u,updateRobotInfo:h}=J("robotInfo"),l=q(!1);at(()=>u.answer_source_switch,s=>{l.value=s=="true"},{immediate:!0});const p=()=>{h({answer_source_switch:l.value?"true":"false"})};return(s,n)=>(i(),j(ga,{title:"显示引文","icon-name":"jibenpeizhi",value:l.value,"onUpdate:value":n[0]||(n[0]=x=>l.value=x),onChange:p},{extra:a(()=>n[1]||(n[1]=[t("span",null,null,-1)])),default:a(()=>[n[2]||(n[2]=t("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},za={__name:"show-like",setup(V){const{robotInfo:u,updateRobotInfo:h}=J("robotInfo"),l=p=>{h({})};return(p,s)=>{const n=tt;return i(),j(H,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:a(()=>s[1]||(s[1]=[t("span",null,null,-1)])),default:a(()=>[s[2]||(s[2]=t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),e(n,{onChange:l,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:g(u).feedback_switch,"onUpdate:checked":s[0]||(s[0]=x=>g(u).feedback_switch=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Na=D(za,[["__scopeId","data-v-73894b10"]]),Pa={class:"content-box"},Da={key:0,class:"add-btn-block"},Ta={class:"list-content"},Ba={key:0,class:"user-block"},Ja={class:"name-box"},Fa={class:"name"},Qa={class:"remark-text"},Ka={key:0,class:"hover-btn-box"},Ga={key:0},Wa={key:1},Ha={key:2},Za={key:1,class:"hover-btn-box"},Ya={class:"role-menu-box"},Xa=["onClick"],tr={class:"menu-header"},er={key:0,class:"check-box"},or=["onClick"],sr={class:"menu-header"},nr={key:0,class:"check-box"},ir=["onClick"],lr={class:"menu-header"},ar={key:0,class:"check-box"},rr={class:"hover-btn-box"},dr={key:0},_r={key:1},cr={key:2},ur=["onClick"],pr={__name:"role-permission",setup(V){const u=xe(),h=K(()=>u.user_name),l=Jt().query,p=q($e(l.id)),s=q([]),n=P({object_id:l.id,object_type:1}),x=()=>{Xe({...n}).then(o=>{let d=o.data||[];s.value=d})};x();const f=q(null),k=()=>{f.value.show(s.value,[{object_id:+l.id,object_type:1,operate_rights:4}])},$=(o,d)=>{let b=d==4?"管理":d==2?"编辑":"查看";X.confirm({title:"提示?",icon:e(At),content:"确认修改该协作者权限为【"+b+"】",okText:"确认",cancelText:"取消",onOk:()=>{let r=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+d}];to({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(r)}).then(C=>{G.success("修改成功"),x()})},onCancel(){}})},_=o=>{X.confirm({title:"提示?",icon:e(At),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{eo({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(d=>{G.success("删除成功"),x()})},onCancel(){}})},c=q([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,d)=>{const b=et,r=Ve,C=Me,U=Ne,I=ie;return i(),j(I,null,{default:a(()=>[t("div",Pa,[p.value==4?(i(),m("div",Da,[e(b,{type:"primary",onClick:k,icon:Ft(g(Ut))},{default:a(()=>d[0]||(d[0]=[S("添加协助者")])),_:1,__:[0]},8,["icon"])])):L("",!0),t("div",Ta,[e(U,{columns:c.value,"data-source":s.value,pagination:!1},{bodyCell:a(({column:v,record:w})=>[v.key==="name"?(i(),m("div",Ba,[e(r,{shape:"square",src:w.avatar,size:40},{icon:a(()=>[w.avatar?L("",!0):(i(),j(g(Tt),{key:0}))]),_:2},1032,["src"]),t("div",Ja,[t("div",Fa,R(w.user_name),1),t("div",Qa,R(w.name),1)])])):L("",!0),v.key==="operate_rights"?(i(),m(N,{key:1},[p.value==2||w.user_name==h.value?(i(),m("div",Ka,[w.operate_rights==4?(i(),m("span",Ga,"管理")):L("",!0),w.operate_rights==2?(i(),m("span",Wa,"编辑")):L("",!0),w.operate_rights==1?(i(),m("span",Ha,"查看")):L("",!0)])):w.role_type==1||w.is_creator==1?(i(),m("div",Za,"管理")):(i(),j(C,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:a(()=>[t("div",Ya,[t("div",{class:"role-menu",onClick:T=>$(w,4)},[t("div",tr,[e(g(Tt)),d[1]||(d[1]=t("span",{class:"title"},"管理",-1))]),d[2]||(d[2]=t("div",{class:"desc"},"可编辑，可删除，可查看",-1)),w.operate_rights==4?(i(),m("div",er,[e(g(Et))])):L("",!0)],8,Xa),t("div",{class:"role-menu",onClick:T=>$(w,2)},[t("div",sr,[e(g(oe)),d[3]||(d[3]=t("span",{class:"title"},"编辑",-1))]),d[4]||(d[4]=t("div",{class:"desc"},"可编辑，可查看",-1)),w.operate_rights==2?(i(),m("div",nr,[e(g(Et))])):L("",!0)],8,or),t("div",{class:"role-menu",onClick:T=>$(w,1)},[t("div",lr,[e(g(ze)),d[5]||(d[5]=t("span",{class:"title"},"查看",-1))]),d[6]||(d[6]=t("div",{class:"desc"},"仅查看",-1)),w.operate_rights==1?(i(),m("div",ar,[e(g(Et))])):L("",!0)],8,ir)])]),default:a(()=>[t("div",rr,[w.operate_rights==4?(i(),m("span",dr,"管理")):L("",!0),w.operate_rights==2?(i(),m("span",_r,"编辑")):L("",!0),w.operate_rights==1?(i(),m("span",cr,"查看")):L("",!0),e(g(te))])]),_:2},1024))],64)):L("",!0),v.key==="action"?(i(),m(N,{key:2},[p.value==4&&w.user_name!=h.value?(i(),m(N,{key:0},[w.role_type!=1&&w.is_creator!=1?(i(),m("a",{key:0,onClick:T=>_(w)},"移除",8,ur)):L("",!0)],64)):L("",!0)],64)):L("",!0)]),_:1},8,["columns","data-source"])])]),e(oo,{onOk:x,ref_key:"addCollaboratorRef",ref:f},null,512)]),_:1})}}},mr=D(pr,[["__scopeId","data-v-64f2a2fa"]]),vr={class:"actions-box"},br={key:0,class:"library-list"},fr=["onClick"],hr={class:"library-name"},yr={class:"library-intro"},kr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(V){const u=q(!1),{robotInfo:h,getRobot:l}=J("robotInfo"),p=V,s=P({work_flow_ids:[]}),n=q(null),x=K(()=>p.robotList.filter(c=>s.work_flow_ids.includes(c.id))),f=c=>{let o=s.work_flow_ids.indexOf(c.id);s.work_flow_ids.splice(o,1),_()},k=c=>{s.work_flow_ids=[...c],_()},$=()=>{n.value.open([...s.work_flow_ids])},_=()=>{let c={...Q(s)};c.work_flow_ids=c.work_flow_ids.join(","),Be({id:h.id,...c}).then(o=>{G.success("保存成功"),l(h.id)})};return xt(()=>{s.work_flow_ids=h.work_flow_ids.split(",")}),(c,o)=>{const d=ot,b=et,r=$t;return i(),j(H,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:u.value,"onUpdate:isEdit":o[0]||(o[0]=C=>u.value=C),bodyStyle:{padding:0}},{tip:a(()=>[e(d,{placement:"top"},{title:a(()=>o[1]||(o[1]=[t("span",null,"支持关联工作流",-1)])),default:a(()=>[e(g(Y))]),_:1})]),extra:a(()=>[t("div",vr,[e(r,{gap:8},{default:a(()=>[e(b,{size:"small",onClick:$},{default:a(()=>o[2]||(o[2]=[S("添加技能")])),_:1,__:[2]})]),_:1})])]),default:a(()=>[x.value.length>0?(i(),m("div",br,[(i(!0),m(N,null,W(x.value,C=>(i(),m("div",{class:"library-item",key:C.id},[t("span",{class:"close-btn",onClick:U=>f(C)},[e(g(mt))],8,fr),t("div",hr,R(C.robot_name),1),t("div",yr,R(C.robot_intro),1)]))),128))])):L("",!0),e(so,{ref_key:"robotSelectAlertRef",ref:n,onChange:k},null,512)]),_:1},8,["isEdit"])}}},gr=D(kr,[["__scopeId","data-v-e0ced8ed"]]),xr={class:"robot-info-box"},$r={class:"set-block"},wr={__name:"chat-cache",setup(V){const{robotInfo:u,updateRobotInfo:h}=J("robotInfo"),l=P({valid_time:"",cache_switch:0}),p=P({unix:"h",hValue:24,mValue:1440}),s=()=>{p.unix==="h"?l.valid_time=p.hValue*3600:l.valid_time=p.mValue*60,h({cache_config:{...l}})},n=()=>{s()},x=()=>{p.unix=="h"?p.hValue=parseInt(p.mValue/60):p.mValue=parseInt(p.hValue*60)};return at(()=>u.cache_config,()=>{let f=u.cache_config||{};f=JSON.parse(JSON.stringify(f)),l.cache_switch=f.cache_switch,l.valid_time=f.valid_time,f.valid_time%3600==0?(p.unix="h",p.hValue=f.valid_time/3600):(p.unix="m",p.mValue=parseInt(f.valid_time/60)||1440)},{immediate:!0,deep:!0}),xt(()=>{}),(f,k)=>{const $=wt,_=Zt,c=Ht,o=Pe,d=tt;return i(),j(H,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:a(()=>k[4]||(k[4]=[t("span",null,null,-1)])),default:a(()=>[t("div",xr,[k[7]||(k[7]=S(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ")),t("div",$r,[e(o,{compact:""},{default:a(()=>[p.unix=="h"?(i(),j($,{key:0,onBlur:s,precision:0,value:p.hValue,"onUpdate:value":k[0]||(k[0]=b=>p.hValue=b),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(i(),j($,{key:1,onBlur:s,precision:0,value:p.mValue,"onUpdate:value":k[1]||(k[1]=b=>p.mValue=b),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),e(c,{value:p.unix,"onUpdate:value":k[2]||(k[2]=b=>p.unix=b),style:{width:"70px"},onChange:x},{default:a(()=>[e(_,{value:"h"},{default:a(()=>k[5]||(k[5]=[S("小时")])),_:1,__:[5]}),e(_,{value:"m"},{default:a(()=>k[6]||(k[6]=[S("分钟")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})])]),e(d,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:l.cache_switch,"onUpdate:checked":k[3]||(k[3]=b=>l.cache_switch=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},qr=D(wr,[["__scopeId","data-v-6e418d06"]]),Sr={key:0,class:"robot-config-page"},Cr={class:"setting-box"},Ir={class:"setting-box"},Lr={class:"setting-box"},Ur={class:"setting-box"},Rr={class:"setting-box"},Er={class:"setting-box"},Or={class:"setting-box"},Ar={class:"setting-box"},jr={class:"setting-box"},Vr={class:"setting-box"},Mr={class:"setting-box"},zr={class:"setting-box"},Nr={class:"setting-box"},Pr={class:"setting-box"},Dr={class:"setting-box"},Tr={key:1,class:"robot-config-page"},Br={key:2,class:"robot-config-page"},Bt="/robot/config/basic-config/activeKey",Jr={__name:"index",setup(V){const u=se(),h=q(null),{robotInfo:l}=ve(u),{getRobot:p}=u,s=Ke(),n=()=>{h.value.scrollTop=h.value.scrollHeight},x=q(+localStorage.getItem(Bt)||1),f=q(!1),k=P(l.value),$=b=>{let r=JSON.parse(JSON.stringify(b));b.robot_avatar&&(r.robot_avatar=new File([b.robot_avatar],b.robot_avatar.name)),!r.op_type_relation_library&&k.op_type_relation_library&&delete k.op_type_relation_library,Object.assign(k,r),o()},_=q([]),c=()=>{Je({application_type:1}).then(b=>{_.value=b.data||[]})};be("robotInfo",{robotInfo:k,updateRobotInfo:$,scrollBoxToBottom:n,getRobot:p});const o=()=>{let b;k.robot_avatar&&(b=new File([k.robot_avatar],k.robot_avatar.name));let r=JSON.parse(JSON.stringify(Q(k)));b&&(r.robot_avatar=b);let C=r.welcomes;C.question=C.question.map(I=>I.content),r.welcomes=JSON.stringify(C),r.prompt_struct=JSON.stringify(r.prompt_struct);let U=r.unknown_question_prompt;U.question=U.question.map(I=>I.content),r.unknown_question_prompt=JSON.stringify(U),r.cache_config=JSON.stringify(r.cache_config),delete r.robot_avatar_url,f.value=!0,Fe(r).then(I=>{if(I.res!=0)return G.error(I.msg);f.value=!1,G.success("保存成功"),p(k.id)}).catch(()=>{f.value=!1})},d=()=>{localStorage.setItem(Bt,x.value)};return ht(()=>{c(),s.getAllmodelList()}),(b,r)=>{const C=Yt,U=Xt;return i(),m(N,null,[e(U,{class:"tab-wrapper",onChange:d,activeKey:x.value,"onUpdate:activeKey":r[0]||(r[0]=I=>x.value=I)},{default:a(()=>[(i(),j(C,{key:1,tab:"基础配置"})),L("",!0),(i(),j(C,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),x.value==1?(i(),m("div",Sr,[t("div",{class:"scroll-box",ref_key:"scrollBox",ref:h},[t("div",Cr,[e(Io)]),t("div",Ir,[e(Qi)]),t("div",Lr,[e(Tn)]),t("div",Ur,[e(da)]),t("div",Rr,[e(qr)]),t("div",Er,[e(an,{robotList:_.value},null,8,["robotList"])]),t("div",Or,[e(gr,{robotList:_.value},null,8,["robotList"])]),t("div",Ar,[e(ll)]),t("div",jr,[e(fl)]),t("div",Vr,[e(Il)]),t("div",Mr,[e(Dl)]),t("div",zr,[e(jl)]),t("div",Nr,[e(Nl)]),t("div",Pr,[e(Ma)]),t("div",Dr,[e(Na)])],512)])):L("",!0),x.value==2?(i(),m("div",Tr,[e(Va)])):L("",!0),x.value==3?(i(),m("div",Br,[e(mr)])):L("",!0)],64)}}},md=D(Jr,[["__scopeId","data-v-f20d1861"]]);export{md as default};
