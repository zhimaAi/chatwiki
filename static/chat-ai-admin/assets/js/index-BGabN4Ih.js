import{_ as Re}from"./empty-CzGZrENG.js";import{j as e,r as f,a0 as te,w as Ne,A as ee,L as u,M as x,Q as t,F as G,a1 as X,P as j,V as l,Y as S,X as g,u as z,E as pe,U as Pe,G as me,a8 as Z,a3 as re,a4 as ie,b as Ae}from"./vue-chunks-XoCroLmQ.js";import{i as Ve,j as Le,k as Ye,l as ze,m as je,n as Be,o as Je,p as Qe,q as $e,r as He,f as Ke,s as Ge,t as We,v as Xe}from"./index-naxAOiU8.js";import{A as Ze,_ as oe,e as J,M as K,B as ve,E as fe,c as et,a as tt,cx as be,cy as ot}from"../../index-BokOG9ZU.js";import"./index-BitUTYbL.js";import{I as Oe}from"./Input-CUxLS_nc.js";import{_ as he,F as se}from"./index-fISAHuLd.js";import{Q as Ce}from"./QuestionCircleOutlined-DEWzrvxy.js";import{_ as ge}from"./index-BOYSy9Pq.js";import{_ as Me}from"./index-D_iED9iI.js";import{_ as Fe}from"./index-LNRiZDUc.js";import{_ as at}from"./index-D35cinO1.js";import"./index-BgMvvztK.js";import{R as Ie,_ as Se}from"./RadioButton-DYdQQdGT.js";import{R as nt}from"./dayjs-D-P733Yb.js";import{a as ke}from"./validate-8MtiUsxW.js";import{S as lt,_ as st}from"./index-DgLLvjt3.js";import{_ as rt}from"./index-DEpPFGdH.js";import{d as it}from"./vuedraggable.umd-BaM7Cu0d.js";import{_ as De}from"./index-BPT5gdLF.js";import{u as ut}from"./database-B7KGXp-L.js";import{a as dt}from"./dayjs-D8VPPBbu.js";import{U as ct,a as _t,b as pt}from"./index-CAuXv0Mv.js";import{I as mt}from"./InboxOutlined-DVZs2m1b.js";import{_ as ft}from"./index-D8UclsBd.js";import{_ as vt}from"./index-T4Sy1smd.js";import{T as ht,_ as gt}from"./index-CTUPCv9m.js";import{S as yt}from"./index-Bf_Ayn3y.js";import{_ as bt,M as kt}from"./index-CvsTLiPQ.js";import"./index-mOJL8w2K.js";import{D as xt}from"./dropdown-_4lkCpvo.js";import{a as wt,_ as $t}from"./index-xOgFOS5S.js";import{P as xe}from"./PlusOutlined-B3xrJfbK.js";import{D as Ot}from"./DownOutlined-I-3QmTPt.js";import{S as Ct}from"./SettingOutlined-Cj54--b1.js";import"./axios-Cm0UX6qg.js";import"./qs-D73tJGQG.js";import"./crypto-js-D323TfIu.js";import"./FormItemContext-Ch_K4tn1.js";import"./index-Co375E0k.js";import"./Search-CbUpX_hw.js";import"./SearchOutlined-BfUHdq7e.js";import"./inputProps-CWzf5mAp.js";import"./TextArea-TiJWDxF4.js";import"./index-CnyiohbP.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-D_H-hnpK.js";import"./colors-Cfqlh7qR.js";import"./responsiveObserve-Cyut9UHK.js";import"./collapseMotion-DWwsCVG2.js";import"./isMobile-D_4OiXLP.js";import"./index-CuGlvjpm.js";import"./CheckOutlined-Byfa85ke.js";import"./shallowequal-BeorLzKa.js";import"./move-ChusaJh2.js";import"./slide-BpJSAeCl.js";import"./partition-CenmkQe8.js";import"./useRefs-C13sH2-_.js";import"./Dropdown-aJrAR27s.js";import"./pick-CWDMpHLW.js";import"./RightOutlined-CViLB99g.js";import"./css-MNT4q5hR.js";import"./LeftOutlined-DN6j0fW4.js";import"./index-BJ6pqfZz.js";var Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const Ft=Mt;function we(c){for(var O=1;O<arguments.length;O++){var E=arguments[O]!=null?Object(arguments[O]):{},N=Object.keys(E);typeof Object.getOwnPropertySymbols=="function"&&(N=N.concat(Object.getOwnPropertySymbols(E).filter(function(D){return Object.getOwnPropertyDescriptor(E,D).enumerable}))),N.forEach(function(D){It(c,D,E[D])})}return c}function It(c,O,E){return O in c?Object.defineProperty(c,O,{value:E,enumerable:!0,configurable:!0,writable:!0}):c[O]=E,c}var ye=function(O,E){var N=we({},O,E.attrs);return e(Ze,we({},N,{icon:Ft}),null)};ye.displayName="MinusCircleOutlined";ye.inheritAttrs=!1;const St=ye,Dt={class:"add-data-sheet"},Ut={class:"field-name"},qt={__name:"add-data-modal",props:{column:{type:Array,default:()=>[]}},emits:"ok",setup(c,{expose:O,emit:E}){const N=f("添加数据"),T=te().query,v=E,k=c;Ne(()=>k.column,M=>{n()});const $=f([]),n=()=>{let M=[];k.column.forEach(d=>{h[d.name]="",d.rules=[],d.required=="true"&&d.rules.push({required:!0,message:`请输入${d.name}`}),d.type=="number"&&d.rules.push({type:"number",message:`${d.name}必须为数字`}),d.type=="integer"&&d.rules.push({asyncValidator:V}),d.type=="boolean"&&(h[d.name]="false"),M.push({...d}),$.value=M})},V=(M,d)=>new Promise((p,_)=>d==""||Number.isInteger(+d)?p():_("请输入整数")),L=f(!1),h=ee({form_id:T.form_id}),R=M=>{L.value=!0,C.value&&C.value.resetFields(),n(),h.id="",Object.assign(h,P(M)),h.id?N.value="修改数据":N.value="添加数据"},C=f(null),U=()=>{C.value.validate().then(M=>{Ve({...h}).then(d=>{let p=h.id?"修改成功":"添加成功";J.success(p),L.value=!1,v("ok")})})};function P(M){const d={};for(let p in M)if(M.hasOwnProperty(p)){const _=M[p];!isNaN(Number(_))&&typeof _=="string"&&_!=""?d[p]=Number(_):d[p]=_}return d}return O({show:R}),(M,d)=>{const p=ge,_=Me,A=Fe,i=at,y=Oe,I=he,s=se,o=K;return u(),x("div",Dt,[e(o,{open:L.value,"onUpdate:open":d[0]||(d[0]=a=>L.value=a),title:N.value,onOk:U,width:580,bodyStyle:{"max-height":"590px","overflow-y":"auto",width:"calc(100% + 24px)","padding-right":"32px"},class:"add-data-sheet-modal"},{default:t(()=>[e(s,{style:{"margin-top":"16px"},model:h,ref_key:"formRef",ref:C,layout:"vertical"},{default:t(()=>[(u(!0),x(G,null,X($.value,a=>(u(),j(I,{name:a.name,key:a.id,rules:a.rules},{label:t(()=>[e(_,{gap:4,style:{width:"100%"}},{default:t(()=>[l("div",Ut,S(a.name),1),e(p,null,{title:t(()=>[g(S(a.description),1)]),default:t(()=>[e(z(Ce))]),_:2},1024)]),_:2},1024)]),default:t(()=>[a.type=="boolean"?(u(),j(A,{key:0,checked:h[a.name],"onUpdate:checked":r=>h[a.name]=r,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["checked","onUpdate:checked"])):a.type=="number"||a.type=="integer"?(u(),j(i,{key:1,style:{width:"100%"},value:h[a.name],"onUpdate:value":r=>h[a.name]=r,valueModifiers:{number:!0},placeholder:"请输入内容"},null,8,["value","onUpdate:value"])):(u(),j(y,{key:2,value:h[a.name],"onUpdate:value":r=>h[a.name]=r,placeholder:"请输入内容"},null,8,["value","onUpdate:value"]))]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["open","title","bodyStyle"])])}}},Et=oe(qt,[["__scopeId","data-v-0de1a1fc"]]),Tt={__name:"export-modal",setup(c,{expose:O}){const N=te().query,D=f("导出数据"),T=f(!1),v=ee({dates:[],type:1}),k=()=>{T.value=!0,v.type=1,v.dates=[]},$=ee({dates:[{validator:async(C,U)=>v.type==2&&!U.length?Promise.reject("请选择导出日期"):Promise.resolve()}]}),n=se.useForm,{resetFields:V,validate:L,validateInfos:h}=n(v,$),R=()=>{L().then(()=>{let C={form_id:N.form_id};v.type==2&&(C.start_date=v.dates[0],C.end_date=v.dates[1]),Le(C),T.value=!1})};return O({show:k}),(C,U)=>{const P=Ie,M=Se,d=he,p=nt,_=se,A=K;return u(),x("div",null,[e(A,{open:T.value,"onUpdate:open":U[2]||(U[2]=i=>T.value=i),title:D.value,onOk:R,width:450},{default:t(()=>[e(_,{class:"mt16",layout:"vertical"},{default:t(()=>[e(d,{label:""},{default:t(()=>[e(M,{value:v.type,"onUpdate:value":U[0]||(U[0]=i=>v.type=i),name:"radioGroup"},{default:t(()=>[e(P,{value:1},{default:t(()=>[g("全部数据")]),_:1}),e(P,{value:2},{default:t(()=>[g("自定义日期")]),_:1})]),_:1},8,["value"])]),_:1}),pe(e(d,Pe({required:"",label:"选择导出日期"},z(h).dates),{default:t(()=>[e(p,{style:{width:"100%"},value:v.dates,"onUpdate:value":U[1]||(U[1]=i=>v.dates=i),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["value"])]),_:1},16),[[me,v.type==2]])]),_:1})]),_:1},8,["open","title"])])}}},Rt=oe(Tt,[["__scopeId","data-v-ca624632"]]),Nt=c=>(re("data-v-81eb5a66"),c=c(),ie(),c),Pt={class:"add-data-sheet"},At=Nt(()=>l("div",{class:"form-required-item"},"筛选条件",-1)),Vt={class:"filter-list-box"},Lt={style:{"margin-left":"48px"}},Yt={__name:"add-filter-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:E}){const N=f("添加分类"),T=te().query,v=E,k=c;f([]);const $=f(!1),n=ee({form_id:T.form_id,name:"",condition:[],type:"1",id:""}),V=()=>{let s=[{form_field_id:k.column[0].id,form_filed_type:k.column[0].type,rule:void 0,rule_value1:"",rule_value2:""}];n.condition=s},L=s=>{n.condition.splice(s,1)},h=(s,o)=>{s.rule=void 0,s.rule_value1="",s.rule_value2="",s.form_filed_type=k.column.filter(a=>a.id==s.form_field_id)[0].type},R=(s,o)=>o.form_field_id==s.id?!1:n.condition.map(r=>r.form_field_id).includes(s.id),C=()=>{let s=n.condition.map(a=>a.form_field_id),o=k.column.filter(a=>!s.includes(a.id));if(!o.length){J.error("字段已全部添加");return}n.condition.push({form_field_id:o[0].id,form_filed_type:o[0].type,rule:void 0,rule_value1:"",rule_value2:""})},U=s=>!s.rule||s.form_filed_type=="boolean"?!1:["eq","neq","contain","not_contain","gt","lt","gte","lte","eq","between"].includes(s.rule),P=s=>!s.rule||s.form_filed_type=="boolean"?!1:["between"].includes(s.rule),M=(s,o,a)=>new Promise((r,q)=>U(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?r():q("请输入数字"):r():q("请输入"):r()),d=(s,o,a)=>new Promise((r,q)=>P(a)?o?a.form_filed_type=="integer"?Number.isInteger(+o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入整数"):a.form_filed_type=="number"?ke(o)?+o<+a.rule_value1?q("右边的值需要大于左边的值"):r():q("请输入数字"):r():q("请输入"):r()),p=()=>{$.value=!0,N.value="添加分类",V(),n.name="",n.type="1",n.id=""},_=s=>{$.value=!0,N.value="编辑分类",Ye({form_id:T.form_id,id:s.id}).then(o=>{let a=o.data.conditions||"[]";a=JSON.parse(a),a=a.map(r=>({form_field_id:r.form_field_id+"",form_filed_type:k.column.filter(q=>q.id==r.form_field_id)[0].type,rule:A(r.rule),rule_value1:r.rule_value1,rule_value2:r.rule_value2})),n.condition=a,n.name=o.data.name,n.type=o.data.type,n.id=o.data.id})};function A(s){const o=["string_","integer_","number_","boolean_"];for(const a of o)if(s.startsWith(a))return s.slice(a.length);return s}const i=f(null),y=()=>{i.value.validate().then(s=>{let o=n.condition.map(m=>({form_field_id:+m.form_field_id,rule:m.form_filed_type+"_"+m.rule,rule_value1:m.rule_value1,rule_value2:m.rule_value2})),a={...n,condition:JSON.stringify(o)},r=ze,q="添加成功";n.id&&(r=je,q="编辑成功"),r(a).then(m=>{J.success(q),$.value=!1,v("ok")})}).catch(s=>{})},I=f({string:[{label:"是",value:"eq"},{label:"不是",value:"neq"},{label:"包含",value:"contain"},{label:"不包含",value:"not_contain"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],integer:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],number:[{label:"大于",value:"gt"},{label:"小于",value:"lt"},{label:"大于等于",value:"gte"},{label:"小于等于",value:"lte"},{label:"等于",value:"eq"},{label:"介于",value:"between"}],boolean:[{label:"是",value:"true"},{label:"不是",value:"false"}]});return O({show:p,edit:_}),(s,o)=>{const a=Oe,r=he,q=lt,m=st,Y=rt,Q=ve,H=Ie,le=Se,de=se,ce=K;return u(),x("div",Pt,[e(ce,{open:$.value,"onUpdate:open":o[2]||(o[2]=F=>$.value=F),title:N.value,onOk:y,width:790},{default:t(()=>[e(de,{class:"form-box",style:{"margin-top":"16px"},model:n,ref_key:"filterFormRef",ref:i,layout:"vertical"},{default:t(()=>[e(r,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称"}]},{default:t(()=>[e(a,{maxLength:64,value:n.name,"onUpdate:value":o[0]||(o[0]=F=>n.name=F),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),At,l("div",Vt,[(u(!0),x(G,null,X(n.condition,(F,B)=>(u(),j(Y,{key:B,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[l("div",null,"条件"+S(B+1)+":",1),e(r,null,{default:t(()=>[e(m,{value:F.form_field_id,"onUpdate:value":b=>F.form_field_id=b,style:{width:"150px"},placeholder:"请选择",onChange:b=>h(F,B)},{default:t(()=>[(u(!0),x(G,null,X(k.column,b=>(u(),j(q,{disabled:R(b,F),key:b.id,value:b.id},{default:t(()=>[g(S(b.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024),e(r,{name:["condition",B,"rule"],rules:{required:!0,message:"请选择规则"}},{default:t(()=>[e(m,{value:F.rule,"onUpdate:value":b=>F.rule=b,style:{width:"120px"},placeholder:"请选择规则"},{default:t(()=>[(u(!0),x(G,null,X(I.value[F.form_filed_type],b=>(u(),j(q,{key:b.value,value:b.value},{default:t(()=>[g(S(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),pe(e(r,{name:["condition",B,"rule_value1"],rules:{asyncValidator:(b,ae)=>M(b,ae,F)}},{default:t(()=>[e(a,{value:F.rule_value1,"onUpdate:value":b=>F.rule_value1=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,U(F)]]),pe(e(r,{name:["condition",B,"rule_value2"],rules:{asyncValidator:(b,ae)=>d(b,ae,F),trigger:"blur"}},{default:t(()=>[e(a,{value:F.rule_value2,"onUpdate:value":b=>F.rule_value2=b,placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"]),[[me,P(F)]]),n.condition.length>1?(u(),j(z(St),{key:0,onClick:b=>L(B)},null,8,["onClick"])):Z("",!0)]),_:2},1024))),128)),l("div",Lt,[e(Q,{onClick:C},{default:t(()=>[g("添加条件")]),_:1})])]),e(r,{label:"条件之间关系",required:""},{default:t(()=>[e(le,{value:n.type,"onUpdate:value":o[1]||(o[1]=F=>n.type=F)},{default:t(()=>[e(H,{value:"1"},{default:t(()=>[g("与（And）")]),_:1}),e(H,{value:"2"},{default:t(()=>[g("或（Or）")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ue=oe(Yt,[["__scopeId","data-v-81eb5a66"]]),ne=c=>(re("data-v-f1db0fc5"),c=c(),ie(),c),zt={class:"custom-table"},jt=ne(()=>l("div",{class:"t-head"},[l("div",{class:"td"},[l("div",{style:{width:"24px"}}),g(" 分类名称 ")]),l("div",{class:"td"},"类型"),l("div",{class:"td"},"启用分类"),l("div",{class:"td flex-none",style:{width:"120px"}},"操作")],-1)),Bt={class:"t-body"},Jt={class:"t-row"},Qt=ne(()=>l("div",{class:"t-item"},[l("div",{style:{width:"24px"}}),g(" 全部 ")],-1)),Ht=ne(()=>l("div",{class:"t-item"},"系统分类",-1)),Kt={class:"t-item"},Gt=ne(()=>l("div",{class:"t-item flex-none",style:{width:"120px"}},null,-1)),Wt={class:"t-item"},Xt={class:"drag-btn"},Zt={key:0},eo={key:1},to=ne(()=>l("div",{class:"t-item"},"自定义分类",-1)),oo={class:"t-item"},ao={class:"t-item flex-none",style:{width:"120px"}},no=["onClick"],lo=["onClick"],so={__name:"filter-manage-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok","change"],setup(c,{expose:O,emit:E}){const D=te().query,T=E,v=f("管理分类"),k=f(!1),$=c,n=()=>{$e({form_id:D.form_id}).then(p=>{R.value=p.data.map(_=>({..._}))})},V=()=>{n(),T("ok"),T("change")},L=()=>{n(),k.value=!0},h=()=>{k.value=!1},R=f(),C=()=>{let p=[];R.value.reverse().forEach((_,A)=>{p.push({id:+_.id,sort:+A+1})}),Be({form_id:D.form_id,filter_sort:JSON.stringify(p)}).then(_=>{J.success("排序成功"),n(),T("change")})},U=p=>{Je({form_id:D.form_id,id:p.id,enabled:p.enabled=="true"?"false":"true"}).then(_=>{J.success("设置成功"),n(),T("change")})},P=(p,_)=>{K.confirm({title:"删除确认",icon:e(fe),content:"确认删除该分类?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){Qe({id:p.id,form_id:D.form_id}).then(A=>{J.success("删除成功"),R.value.splice(_,1),T("change")})},onCancel(){}})},M=f(null),d=p=>{M.value.edit(p)};return O({show:L}),(p,_)=>{const A=Fe,i=et,y=ge,I=De,s=K;return u(),x("div",null,[e(s,{open:k.value,"onUpdate:open":_[1]||(_[1]=o=>k.value=o),title:v.value,onCancel:h,footer:null,width:760},{default:t(()=>[l("div",zt,[jt,l("div",Bt,[l("div",Jt,[Qt,Ht,l("div",Kt,[e(A,{checked:!0,disabled:"","checked-children":"开","un-checked-children":"关"})]),Gt]),e(z(it),{modelValue:R.value,"onUpdate:modelValue":_[0]||(_[0]=o=>R.value=o),"item-key":"id",onEnd:C,group:"table-rows",handle:".drag-btn"},{item:t(({element:o,index:a})=>[(u(),x("div",{key:o.id,class:"t-row"},[l("div",Wt,[l("span",Xt,[e(i,{name:"drag"})]),o.name.length>10?(u(),x("span",Zt,[e(y,null,{title:t(()=>[g(S(o.name),1)]),default:t(()=>[g(" "+S(o.name.slice(0,10)+"..."),1)]),_:2},1024)])):(u(),x("span",eo,S(o.name),1))]),to,l("div",oo,[e(A,{onChange:r=>U(o),checked:o.enabled,"checked-children":"开","un-checked-children":"关",checkedValue:"true",unCheckedValue:"false"},null,8,["onChange","checked"])]),l("div",ao,[l("a",{onClick:r=>d(o)},"编辑",8,no),e(I,{type:"vertical"}),l("a",{onClick:r=>P(o,a)},"删除",8,lo)])]))]),_:1},8,["modelValue"])])])]),_:1},8,["open","title"]),e(Ue,{onOk:V,column:$.column,ref_key:"addFilrerModalRef",ref:M},null,8,["column"])])}}},ro=oe(so,[["__scopeId","data-v-f1db0fc5"]]),ue=c=>(re("data-v-c09a8f6a"),c=c(),ie(),c),io=ue(()=>l("div",null," 导入时，如果d为空，则新建数据。如果id有值，则更新d对应的数据。id通过导出数据获取。单次导入上限1万条数据。 ",-1)),uo={class:"upload-box"},co={class:"ant-upload-drag-icon"},_o=ue(()=>l("p",{class:"ant-upload-text"},"点击或将文件拖拽到这里上传",-1)),po=ue(()=>l("p",{class:"ant-upload-hint"},"仅支持：json.xlsx.csv文件，请注意必填项",-1)),mo={key:0,class:"progress-box"},fo=ue(()=>l("div",{class:"tip"},"数据导入中，请勿关闭页面",-1)),vo={key:0},ho={__name:"import-data-modal",props:{column:{type:Array,default:()=>[]}},emits:["ok"],setup(c,{expose:O,emit:E}){const N=tt(),D=E,T=te().query,v=c,k=f(!1),$=f(!1),n=ee({total:0,success:0,err_data:[]}),V=f([]),L=i=>{const y=i.file.status;if(y==="done")if(i.file.response.res==0){let I=i.file.response.data.task_id;C(I)}else return V.value=[],J.error(i.file.response.msg);else y==="error"&&(V.value=[],J.error(`${i.file.name} file upload failed.`))};function h(i){}let R=null;const C=i=>{R&&clearInterval(R),k.value=!1,p.value=!0,_.value=10,n.total=0,n.success=0,n.err_data=[],R=setInterval(()=>{He({task_id:i}).then(y=>{let I=y.data;_.value=(I.processed/I.total).toFixed(),I.finish&&(D("ok"),clearInterval(R),_.value=100),I.total>0&&(n.total=I.total,n.success=I.success,n.err_data=I.err_data)}).catch(()=>{clearInterval(R)})},2e3)},U=()=>{let i;i=v.column.map(y=>y.name),i="id,"+i.join(",")+`
`,be(i,[],[],"导入数据模板.csv")},P=()=>{let i={id:""};v.column.forEach(y=>{i[y.name]=""}),ot([i],"导入数据模板.json")},M=()=>{V.value=[],k.value=!0},d=()=>{},p=f(!1),_=f(10),A=()=>{let i="id,",y=["id"];for(let o in n.err_data[0])o!="id"&&o!="err_msg"&&(i+=o+",",y.push(o));i=i+`err_msg
`,y.push("err_msg");let I=n.err_data,s="失败数据_"+dt().format("YYYY/MM/DD HH:mm")+".xlsx";be(i,I,y,s)};return O({show:M}),(i,y)=>{const I=ft,s=ct,o=K,a=_t,r=ve,q=vt;return u(),x("div",null,[e(o,{open:k.value,"onUpdate:open":y[1]||(y[1]=m=>k.value=m),title:"导入数据","confirm-loading":$.value,onOk:d,footer:null,width:746},{default:t(()=>[e(I,{"show-icon":"",class:"alert-box"},{message:t(()=>[l("div",null,[g(" 支持通过Excel或者json文件导入数据。 "),l("a",{onClick:U,class:"mr8"},"excel模板"),l("a",{onClick:P},"json模板")]),io]),_:1}),l("div",uo,[e(s,{fileList:V.value,"onUpdate:fileList":y[0]||(y[0]=m=>V.value=m),name:"form_files",multiple:!1,accept:".json,.xlsx,.csv",headers:{token:z(N).getToken},data:{form_id:z(T).form_id},action:"/manage/uploadFormFile",onChange:L,onDrop:h},{default:t(()=>[l("p",co,[e(z(mt))]),_o,po]),_:1},8,["fileList","headers","data"])])]),_:1},8,["open","confirm-loading"]),e(o,{open:p.value,"onUpdate:open":y[2]||(y[2]=m=>p.value=m),title:"导入数据",footer:null,width:746},{default:t(()=>[_.value<100?(u(),x("div",mo,[e(a,{type:"circle",percent:_.value},null,8,["percent"]),fo])):(u(),j(q,{key:1,status:"success",title:"导入完成"},{subTitle:t(()=>[g("导入成功"+S(n.success)+"，导入失败"+S(n.total-n.success)+" ",1),n.total-n.success>0?(u(),x("span",vo," 您可以下载失败数据，修改后重新导入 ")):Z("",!0)]),extra:t(()=>[n.total-n.success>0?(u(),j(r,{key:0,onClick:A,type:"primary"},{default:t(()=>[g("下载失败数据")]),_:1})):Z("",!0)]),_:1}))]),_:1},8,["open"])])}}},go=oe(ho,[["__scopeId","data-v-c09a8f6a"]]),qe=c=>(re("data-v-fe0434d1"),c=c(),ie(),c),yo={key:0,class:"loading-box"},bo={key:1,class:"empty-box"},ko=qe(()=>l("img",{src:Re,alt:""},null,-1)),xo=qe(()=>l("div",null,"暂无字段, 请先去添加字段",-1)),wo=[ko,xo],$o={key:2,class:"field-manage-page"},Oo={class:"page-title"},Co={key:0},Mo={key:1},Fo={class:"table-wrapper customize-scroll-style"},Io={key:0},So={key:1},Do={key:0},Uo={key:1},qo=["onClick"],Eo=["onClick"],To={__name:"index",setup(c){const O=ut(),E=Ae(()=>O.databaseInfo.entry_count),D=te().query,T=f([]),v=f([]),k=f(!0),$=ee({form_id:D.form_id,page:1,size:10,total:0}),n=f(!1),V=m=>{$.page=m.current,$.size=m.pageSize,h()},L=()=>{$.page=1,h()},h=()=>{n.value=!0,Ge({...$,filter_id:C.value}).then(m=>{T.value=m.data.list||[],$.total=+m.data.total||0,O.getDatabaseInfo({id:D.form_id})}).finally(()=>{n.value=!1})};Ke({form_id:D.form_id}).then(m=>{v.value=m.data,k.value=!1,h()});const R=f([]),C=f(""),U=()=>{$e({form_id:D.form_id}).then(m=>{let Y=m.data||[];if(R.value=Y.filter(Q=>Q.enabled=="true"),C.value){let Q=Y.filter(H=>H.id==C.value);(Q.length&&Q[0].enabled=="false"||!Q.length)&&(C.value="",h())}})};U();const P=()=>{U(),h()},M=()=>{$.page=1,h()},d=f(null),p=(m,Y)=>{Y==="add"&&d.value.show()},_=m=>{K.confirm({title:"删除确认",icon:e(fe),content:"删除后不可恢复，确认删除这条数据吗?",okText:"确 定",okType:"danger",cancelText:"取 消",onOk(){We({id:m.id}).then(Y=>{J.success("删除成功"),P()})},onCancel(){}})},A=()=>{K.confirm({title:"清空数据提示",icon:e(fe),content:"数据清空后将无法恢复，确认清空数据吗？",okText:"清 空",okType:"danger",cancelText:"取 消",onOk(){Xe({form_id:D.form_id}).then(m=>{J.success("清空成功"),P()})},onCancel(){}})},i=f(null),y=(m={})=>{i.value.show(JSON.parse(JSON.stringify(m)))},I=f(null),s=(m={})=>{I.value.show()},o=f(null),a=()=>{o.value.show()},r=f(null),q=()=>{r.value.show()};return(m,Y)=>{const Q=yt,H=ve,le=bt,de=kt,ce=xt,F=Me,B=gt,b=ge,ae=ht,_e=$t,Ee=De,Te=wt;return u(),x(G,null,[k.value?(u(),x("div",yo,[e(Q)])):Z("",!0),!k.value&&!v.value.length?(u(),x("div",bo,wo)):Z("",!0),!k.value&&v.value.length?(u(),x("div",$o,[l("div",Oo,[g(" 数据管理 "),e(F,{gap:16},{default:t(()=>[e(H,{type:"primary",onClick:Y[0]||(Y[0]=w=>y())},{icon:t(()=>[e(z(xe))]),default:t(()=>[g(" 添加数据 ")]),_:1}),e(H,{onClick:Y[1]||(Y[1]=w=>s())},{icon:t(()=>[e(z(pt))]),default:t(()=>[g(" 导入数据 ")]),_:1}),e(ce,null,{overlay:t(()=>[e(de,null,{default:t(()=>[e(le,{key:"1"},{default:t(()=>[l("div",{onClick:a},"导出数据")]),_:1}),e(le,{key:"2"},{default:t(()=>[l("div",{onClick:A},"清空数据")]),_:1})]),_:1})]),default:t(()=>[e(H,null,{default:t(()=>[g(" 更多操作 "),e(z(Ot))]),_:1})]),_:1})]),_:1})]),e(ae,{class:"tabs-wrapper",activeKey:C.value,"onUpdate:activeKey":Y[2]||(Y[2]=w=>C.value=w),type:"editable-card",onEdit:p,onChange:M},{addIcon:t(()=>[e(z(xe)),g(" 添加分类 ")]),rightExtra:t(()=>[l("span",{class:"setting-btn",onClick:q},[e(z(Ct)),g(" 管理分类 ")])]),default:t(()=>[e(B,{key:"",closable:!1},{tab:t(()=>[g("全部 ("+S(E.value)+")",1)]),_:1}),(u(!0),x(G,null,X(R.value,w=>(u(),j(B,{key:w.id,closable:!1},{tab:t(()=>[w.name.length>8?(u(),x("span",Co,[e(b,null,{title:t(()=>[g(S(w.name),1)]),default:t(()=>[g(" "+S(w.name.slice(0,8)+"..."),1)]),_:2},1024)])):(u(),x("span",Mo,S(w.name),1)),g(" ("+S(w.entry_count)+")",1)]),_:2},1024))),128))]),_:1},8,["activeKey"]),l("div",Fo,[e(Te,{sticky:"","data-source":T.value,loading:n.value,scroll:{x:1e3},pagination:{current:$.page,total:$.total,pageSize:$.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:V},{default:t(()=>[e(_e,{key:"id","data-index":"id",title:"id",width:60}),(u(!0),x(G,null,X(v.value,w=>(u(),j(_e,{key:w.name,"data-index":w.name,width:165},{title:t(()=>[w.name.length>12?(u(),x("span",Io,[e(b,null,{title:t(()=>[g(S(w.name),1)]),default:t(()=>[g(" "+S(w.name.slice(0,12)+"..."),1)]),_:2},1024)])):(u(),x("span",So,S(w.name),1)),e(b,null,{title:t(()=>[g(S(w.description),1)]),default:t(()=>[e(z(Ce),{style:{"margin-left":"2px"}})]),_:2},1024)]),default:t(({record:W})=>[W[w.name].length>10?(u(),x("span",Do,[e(b,null,{title:t(()=>[g(S(W[w.name]),1)]),default:t(()=>[g(" "+S(W[w.name].slice(0,9)+"..."),1)]),_:2},1024)])):(u(),x("span",Uo,S(W[w.name]||"-"),1))]),_:2},1032,["data-index"]))),128)),e(_e,{key:"action",title:"操作",width:120,fixed:"right"},{default:t(({record:w})=>[l("span",null,[l("a",{onClick:W=>y(w)},"编辑",8,qo),e(Ee,{type:"vertical"}),l("a",{onClick:W=>_(w)},"删除",8,Eo)])]),_:1})]),_:1},8,["data-source","loading","pagination"])]),e(Et,{onOk:P,column:v.value,ref_key:"addDataModalRef",ref:i},null,8,["column"]),e(Ue,{onOk:P,column:v.value,ref_key:"addFilrerModalRef",ref:d},null,8,["column"]),e(Rt,{ref_key:"exportModalRef",ref:o},null,512),e(ro,{onOk:h,onChange:U,column:v.value,ref_key:"filterManageModalRef",ref:r},null,8,["column"]),e(go,{onOk:L,column:v.value,ref_key:"importDataModalRef",ref:I},null,8,["column"])])):Z("",!0)],64)}}},Ja=oe(To,[["__scopeId","data-v-fe0434d1"]]);export{Ja as default};
