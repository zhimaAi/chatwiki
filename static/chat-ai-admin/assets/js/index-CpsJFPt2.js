import{_ as U}from"./cu-scroll-BxmqGNDQ.js";import{Q as J,K as X}from"./knowledge-document-yGj5aJrq.js";import{at as Z,b as K,e as tt,d as at,F as et,au as ot,av as st,aw as it,ax as lt}from"../../index-CuFGOJXl.js";import{u as V}from"./robot-DmLnKp5K.js";import{e as A,f as m,o as D,Y as l,_ as s,a1 as v,ae as d,F as E,ab as N,ag as rt,r as nt,h as ct,a5 as e,k as _,a2 as c,G as R,a9 as _t,B as x,u as T,a7 as b,ad as dt,J as pt,aa as ut}from"./vue-chunks-yZ4gwLzA.js";import{S as yt}from"./index-CfeGYFjs.js";import{L as bt}from"./library-select-alert-63IqLejD.js";import{a as ft}from"./index-DQDi1d6e.js";import{B as mt,p as vt,b as ht,c as gt,D as kt,M as wt,a as xt,$ as Lt,d as Y,a0 as Ct}from"./ui-antd-BKjlZQNA.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./edit-subsection-CRVRTJKf.js";import"./index-ClZszkte.js";import"./index-yXxWAoL0.js";import"./util-BwuffJOK.js";import"./model-select-Bwhjt5Cl.js";import"./index-DXUrEY-q.js";import"./index-BMSQkwth.js";import"./upload-input-DirA2cy5.js";import"./validate-8MtiUsxW.js";import"./open-grapg-modal-CdNAMzZD.js";import"./rename-modal-DLiZ89K-.js";import"./page-alert-CPrT-Mm4.js";import"./vuedraggable.umd-BwU7FuvS.js";import"./utils-smNh_pj2.js";const St={__name:"default-library",setup(M){const h=V(),p=A(()=>h.robotInfo.default_library_id),n=m(null);return D(()=>{Z({id:p.value}).then(y=>{n.value=+y.data.type||0})}),(y,g)=>(s(),l(E,null,[n.value==2?(s(),v(J,{key:0,library_id:p.value},null,8,["library_id"])):d("",!0),n.value==0?(s(),v(X,{key:1,library_id:p.value},null,8,["library_id"])):d("",!0)],64))}},zt="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1749612065457'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5081'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M0%200v1024L1024%200H0z%20m294.4%20172.8h12.8c22.4%200%2048-3.2%2060.8%200v32c-19.2-3.2-51.2%200-76.8%200l3.2-32z%20m-128%20422.4l44.8-48-19.2-16-38.4%2038.4-19.2-19.2L172.8%20512l-12.8-12.8-38.4%2038.4L28.8%20448%20128%20348.8l92.8%2092.8L179.2%20480l16%2016%2038.4-38.4%2019.2%2019.2L214.4%20512l16%2016%2038.4-44.8%2019.2%2019.2c-35.2%2041.6-73.6%2083.2-99.2%20112l-22.4-19.2z%20m60.8%2073.6c-6.4-19.2-16-44.8-25.6-64l22.4-6.4c9.6%2019.2%2022.4%2044.8%2025.6%2064l-22.4%206.4z%20m48-38.4c-9.6-12.8-28.8-28.8-44.8-41.6l9.6-12.8c16%209.6%2035.2%2025.6%2048%2038.4l-12.8%2016z%20m22.4-32c-9.6-9.6-28.8-22.4-44.8-32l9.6-16c16%209.6%2035.2%2019.2%2048%2028.8l-12.8%2019.2z%20m16-35.2c-9.6-6.4-25.6-16-41.6-19.2l9.6-19.2c16%203.2%2032%2012.8%2041.6%2019.2l-9.6%2019.2z%20m48-9.6c-9.6%200-22.4%200-32%203.2-3.2-70.4-38.4-128-73.6-169.6l-38.4%2038.4-22.4-22.4%2038.4-38.4-9.6-9.6-57.6-57.6%2019.2-19.2%2019.2%2019.2%206.4-22.4c22.4%203.2%2051.2%206.4%2067.2%2012.8l-6.4%2022.4c-16-6.4-44.8-9.6-67.2-12.8l48%2048%2048-48%2022.4%2022.4-48%2048c60.8%2041.6%20121.6%2070.4%20172.8%2064%200%209.6%200%2022.4%203.2%2032-41.6%203.2-86.4-16-134.4-44.8%2022.4%2041.6%2041.6%2083.2%2044.8%20134.4z%20m150.4-163.2c-6.4-3.2-22.4-3.2-28.8-3.2%200-9.6%200-25.6-12.8-38.4l-80-80L352%20307.2l-22.4-22.4%2064-60.8%2099.2%2099.2%209.6-44.8%2025.6%2012.8c-16%2076.8-16%2089.6-16%2099.2z%20m67.2-51.2c-9.6-3.2-25.6-3.2-35.2%200%2016-102.4-64-182.4-144-262.4l-9.6-9.6%2025.6-22.4c25.6%2025.6%2048%2051.2%2070.4%2076.8%2028.8%2022.4%20112%2086.4%20201.6%2070.4-3.2%209.6%200%2025.6%200%2035.2-54.4%209.6-108.8-12.8-150.4-35.2%2032%2044.8%2048%2096%2041.6%20147.2z'%20p-id='5082'%20fill='%232475fc'%3e%3c/path%3e%3cpath%20d='M124.8%20384l-25.6%2025.6L160%20467.2l25.6-25.6L124.8%20384z%20m25.6%2067.2c-6.4-12.8-19.2-35.2-28.8-48l16-6.4c9.6%2016%2019.2%2038.4%2022.4%2051.2l-9.6%203.2zM64%20444.8l60.8%2060.8%2022.4-25.6-60.8-60.8-22.4%2025.6z%20m57.6%2041.6c-9.6-9.6-28.8-22.4-44.8-28.8l6.4-12.8c16%206.4%2035.2%2019.2%2044.8%2028.8l-6.4%2012.8z'%20p-id='5083'%20fill='%232475fc'%3e%3c/path%3e%3c/svg%3e",At={class:"main-content-block"},Rt={class:"btn-block"},Dt={class:"list-box"},Mt=["onClick"],$t={key:0,class:"default-icon",src:zt,alt:""},It={class:"library-info"},Tt=["src"],Yt={class:"library-info-content"},Bt={class:"library-title"},Kt={class:"library-type"},Vt={key:0,class:"type-tag"},Et={key:1,class:"type-tag"},Nt={key:2,class:"type-tag"},qt={key:3,class:"type-tag"},Gt={class:"item-body"},Ot={class:"library-desc"},jt={class:"item-footer"},Ft={class:"library-size"},Wt={class:"text-item"},Qt={class:"text-item"},Ht={class:"text-item"},Pt=["onClick"],Ut=["onClick"],Jt={__name:"related-library",setup(M){const h=tt(),p=A(()=>{var t;return((t=h.companyInfo)==null?void 0:t.neo4j_status)=="true"}),n=N().query,y=V(),{getRobot:g}=y,{robotInfo:u}=rt(y),r=nt({library_ids:[],default_library_id:""}),k=m([]),f=m(null),w=m(null),L=A(()=>{let t=k.value.filter(a=>r.library_ids.includes(a.id));if(u.value.default_library_id){let a=t.find(i=>i.id==u.value.default_library_id);a&&(t=t.filter(i=>i.id!=u.value.default_library_id),t.unshift(a))}return f.value||(t=t.filter(a=>a.type!=3)),t}),C=t=>{let a=r.library_ids.indexOf(t.id);r.library_ids.splice(a,1),z()},S=t=>{wt.confirm({title:`确定将${t.library_name}设为默认知识库吗？`,icon:null,content:_("div",{style:"color:red;"},"一个机器人只能有一个默认知识库"),onOk(){r.default_library_id=t.id,z(r.default_library_id)},onCancel(){}})},q=()=>{w.value.open([...r.library_ids])},G=t=>{r.library_ids=[...t],z()},z=t=>{let a={...pt(r)};a.library_ids=a.library_ids.join(","),yt({library_ids:a.library_ids,default_library_id:t||null,id:n.id}).then(i=>{xt.success("操作成功"),g(n.id)})};ct(()=>{r.library_ids=u.value.library_ids.split(","),r.default_library_id=u.value.default_library_id||""});const O=t=>{t.type=="1"?window.open(`/#/public-library/config?library_id=${t.id}`,"_blank","noopener"):window.open(`/#/library/details?id=${t.id}`,"_blank","noopener")},j=async()=>{const t=await et({type:"",show_open_docs:1});if(t){let a=t.data||[];a.forEach(i=>{i.file_size_str=ot(i.file_size),i.avatar||(i.avatar=i.type==0?st:it)}),k.value=a}},F=async()=>{await ft({ability_type:"library_ability_official_account"}).then(t=>{var i;let a=(t==null?void 0:t.data)||{};((i=a==null?void 0:a.user_config)==null?void 0:i.switch_status)==1&&(f.value=a)})};return D(()=>{F(),j()}),(t,a)=>{const i=mt,W=vt,Q=at,$=gt,H=ht,P=kt;return s(),l("div",At,[e("div",Rt,[_(i,{type:"primary",onClick:q},{default:c(()=>[...a[2]||(a[2]=[R("关联知识库",-1)])]),_:1})]),e("div",Dt,[(s(!0),l(E,null,_t(L.value,o=>(s(),l("div",{class:"list-item-wrapper",key:o.id},[e("div",{class:"list-item",onClick:x(I=>O(o),["stop"])},[o.id==T(u).default_library_id?(s(),l("img",$t)):d("",!0),e("div",It,[e("img",{class:"library-icon",src:o.avatar,alt:""},null,8,Tt),e("div",Yt,[e("div",Bt,b(o.library_name),1),e("div",Kt,[o.type==0?(s(),l("span",Vt,"普通知识库")):d("",!0),o.type==1?(s(),l("span",Et,"对外知识库")):d("",!0),o.type==2?(s(),l("span",Nt,"问答知识库")):d("",!0),o.type==3?(s(),l("span",qt,"公众号知识库")):d("",!0),p.value?(s(),v(W,{key:4},{title:c(()=>[R(b(o.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:c(()=>[e("span",{class:dt(["type-tag graph-tag",{"gray-tag":o.graph_switch==0}])},"Graph",2)]),_:2},1024)):d("",!0)])])]),e("div",Gt,[e("div",Ot,b(o.library_intro),1)]),e("div",jt,[e("div",Ft,[e("span",Wt,"文档："+b(o.file_total),1),e("span",Qt,"大小："+b(o.file_size_str),1),e("span",Ht,"关联应用："+b(o.robot_nums||0),1)]),o.id!=T(u).default_library_id?(s(),l("div",{key:0,class:"action-box",onClick:a[1]||(a[1]=x(()=>{},["stop"]))},[_(P,null,{overlay:c(()=>[_(H,null,{default:c(()=>[o.type!=1?(s(),v($,{key:0},{default:c(()=>[e("a",{onClick:x(I=>S(o),["stop"])},"设为默认",8,Pt)]),_:2},1024)):d("",!0),_($,null,{default:c(()=>[e("a",{class:"delete-text-color",onClick:x(I=>C(o),["stop"])},"取消关联",8,Ut)]),_:2},1024)]),_:2},1024)]),default:c(()=>[e("div",{class:"action-item",onClick:a[0]||(a[0]=x(()=>{},["stop"]))},[_(Q,{class:"action-icon",name:"point-h"})])]),_:2},1024)])):d("",!0)])],8,Mt)]))),128))]),_(bt,{ref_key:"librarySelectAlertRef",ref:w,showWxType:!!f.value,onChange:G},null,8,["showWxType"])])}}},Xt=K(Jt,[["__scopeId","data-v-c640a29d"]]),Zt={class:"main-content-block"},t2={class:"tab-right-extra"},a2={key:0,class:"body-content-box",style:{"padding-right":"16px"}},e2={key:1,class:"body-content-box"},B="/robot/config/library-config/activeKey",o2={__name:"index",setup(M){const h=ut(),p=N().query,n=m(+localStorage.getItem(B)||1),y=()=>{localStorage.setItem(B,n.value)},g=m(0),u=async()=>{lt({robot_id:p.id,start_date:Y().subtract(6,"day").format("YYYY-MM-DD"),end_date:Y().format("YYYY-MM-DD")}).then(k=>{g.value=k.data.header.library_hit_rate})},r=()=>{localStorage.setItem("/robot/config/statistical_analysis/activeKey",3),h.push({path:"/robot/config/statistical_analysis",query:{id:p.id,robot_key:p.robot_key}})};return D(()=>{u()}),(k,f)=>{const w=Ct,L=Lt,C=U;return s(),l("div",Zt,[_(L,{class:"tab-wrapper",activeKey:n.value,"onUpdate:activeKey":f[0]||(f[0]=S=>n.value=S),onChange:y},{rightExtra:c(()=>[e("div",t2,[R(" 近7天客户消息知识库命中率："+b(g.value)+"% ",1),e("a",{onClick:r},"查看")])]),default:c(()=>[(s(),v(w,{key:1,tab:"默认知识库"})),(s(),v(w,{key:2,tab:"关联知识库"}))]),_:1},8,["activeKey"]),n.value==1?(s(),l("div",a2,[_(St)])):(s(),l("div",e2,[_(C,null,{default:c(()=>[_(Xt)]),_:1})]))])}}},R2=K(o2,[["__scopeId","data-v-38361085"]]);export{R2 as default};
