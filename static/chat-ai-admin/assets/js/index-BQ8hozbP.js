import{f as m,r as Q,ae as J,ad as v,ar as i,k as a,az as E,J as Ot,as as t,ac as $,F as L,ax as D,ai as kt,at as g,G as p,u as x,aw as ut,e as st,o as rt,B as qt,l as et,y as Mt,av as Pt,aA as At}from"./vue-chunks-CGLjTDrY.js";import{L as Ut}from"./list-tabs-DJ9IUgC9.js";import{a5 as B,_ as H,d as Nt,ar as Jt,a7 as at,a4 as _t,l as Rt}from"../../index-DxV-PNCd.js";import{d as Tt}from"./vuedraggable.umd-BzpNiY3c.js";import{F as ht,e as xt,I as pt,O as wt,M as z,b as R,o as vt,V as Bt,a9 as Ct,B as gt,z as mt,y as ft,x as jt,w as zt,a6 as ot,u as Et,ae as Lt,W as nt,ai as Dt,aM as $t,d as Ft,ah as Y,J as Vt,ay as Gt,as as Yt,a0 as yt,v as Qt,G as Ht,Q as Zt}from"./ui-antd-AfNpv4wx.js";import{E as Kt}from"./empty-box-C6xHnjvN.js";import{u as bt}from"./index-DwtbXc27.js";import{h as Wt}from"./other-BrZCAsTs.js";import{g as Xt}from"./index-BNO9ztvM.js";import{Z as te}from"./zm-radio-group-yyUEERzm.js";import{L as ee}from"./loading-box-BFrpPJwN.js";import{s as ae}from"./index-DCeQ7cs_.js";import{u as oe}from"./robot-CbQxxX9E.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./vue-pdf-embed-CiRf6fZ3.js";import"./empty-BFmzY9bl.js";const ne={__name:"comb-store-modal",props:{type:{type:[Number,String],default:1}},emits:["ok"],setup(r,{expose:w,emit:S}){const k=S,O=r,b=m(null),u=m(!1),c=Q({});function C(n){b.value=n||null,Object.assign(c,n||{id:0,name:"",duration:"",count:"",price:""}),u.value=!0}function f(){try{if(!c.name)throw"请输入套餐名称";if(O.type==2&&!c.duration)throw"请输入套餐时长";if(!c.count)throw"请输入套餐次数";if(!c.price)throw"请输入套餐费用";let n=Ot(c);O.type==1&&delete n.duration,u.value=!1,k("ok",JSON.parse(JSON.stringify(n)))}catch(n){R.error(n)}}return w({show:C}),(n,o)=>{const q=pt,y=xt,d=wt,l=ht,U=z;return v(),J(U,{title:b.value?"编辑套餐":"新增套餐",open:u.value,"onUpdate:open":o[4]||(o[4]=h=>u.value=h),onOk:f},{default:i(()=>[a(l,{layout:"vertical"},{default:i(()=>[a(y,{label:"套餐名",required:""},{default:i(()=>[a(q,{value:c.name,"onUpdate:value":o[0]||(o[0]=h=>c.name=h),valueModifiers:{trim:!0},placeholder:"示例：单日套餐，最多6个字",maxlength:6},null,8,["value"])]),_:1}),r.type==2?(v(),J(y,{key:0,label:"时长（天）",required:""},{default:i(()=>[a(d,{value:c.duration,"onUpdate:value":o[1]||(o[1]=h=>c.duration=h),min:0,precision:0,placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})):E("",!0),a(y,{label:"次数（次）",required:""},{default:i(()=>[a(d,{value:c.count,"onUpdate:value":o[2]||(o[2]=h=>c.count=h),min:0,precision:0,placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1}),a(y,{label:"费用（元）",required:""},{default:i(()=>[a(d,{value:c.price,"onUpdate:value":o[3]||(o[3]=h=>c.price=h),min:0,precision:2,placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["title","open"])}}},St=(r={})=>B.get({url:"/manage/robotPayment/getPaymentSetting",params:r}),se=(r={})=>B.post({url:"/manage/robotPayment/savePaymentSetting",data:r}),le=(r={})=>B.post({url:"/manage/robotPayment/copyPaymentSetting",data:r}),ie=(r={})=>B.post({url:"/manage/robotPayment/addAuthCode",data:r}),ce=(r={})=>B.post({url:"/manage/robotPayment/deleteAuthCode",data:r}),de=(r={})=>B.get({url:"/manage/robotPayment/getAuthCodeList",params:r}),ue=(r={})=>B.get({url:"/manage/robotPayment/getAuthCodeStats",params:r}),re=(r={})=>B.post({url:"/manage/robotPayment/addAuthCodeManager",data:r}),_e=(r={})=>B.get({url:"/manage/robotPayment/getAuthCodeManager",params:r}),pe=(r={})=>B.post({url:"/manage/robotPayment/deleteAuthCodeManager",data:r}),ve={class:"data-list"},ge=["onClick"],me=["src"],fe={class:"info"},ye={class:"tit"},be={class:"desc"},ke={key:1,class:"status-tag waiting"},he={__name:"copy-config-modal",props:{robotId:{type:[Number,String]}},setup(r,{expose:w}){const S=r,k=m(!1),O=m(!1),b=m(!1),u=m([]);function c(){C(),k.value=!0}function C(){O.value=!0,Xt().then(n=>{const o=(n==null?void 0:n.data)||[];u.value=o.filter(q=>q.id!=S.robotId)}).finally(()=>{O.value=!1})}function f(){let n=u.value.filter(o=>o.checked).map(o=>o.id);if(!n.length)return R.error("请选择应用");b.value=!0,le({from_robot_id:S.robotId,to_robot_id:n.toString()}).then(o=>{R.success("操作完成"),k.value=!1}).finally(()=>{b.value=!1})}return w({show:c}),(n,o)=>{const q=vt,y=Bt,d=z;return v(),J(d,{title:"复制设置到其他应用",open:k.value,"onUpdate:open":o[0]||(o[0]=l=>k.value=l),"confirm-loading":b.value,width:"669px",onOk:f},{default:i(()=>[a(q,{type:"info",class:"zm-alert-info",message:"将当前页面的收费设置以及功能开关状态，复制到选中的应用"}),t("div",ve,[(v(!0),$(L,null,D(u.value,(l,U)=>(v(),$("div",{key:U,class:kt(["data-item",{disabled:l.has_published!=1}]),onClick:h=>l.checked=!l.checked},[t("img",{class:"avatar",src:l.robot_avatar},null,8,me),t("div",fe,[t("div",null,[t("div",ye,g(l.robot_name),1),t("div",be,g(l.robot_intro),1)]),l.has_published==1?(v(),J(y,{key:0,checked:l.checked,"onUpdate:checked":h=>l.checked=h},null,8,["checked","onUpdate:checked"])):(v(),$("span",ke,[a(x(Ct)),o[1]||(o[1]=p(" 未发布",-1))]))])],10,ge))),128))])]),_:1},8,["open","confirm-loading"])}}},xe=H(he,[["__scopeId","data-v-1f0a81d1"]]),we={class:"content"},Ce={class:"left"},$e={class:"form-box"},Se={class:"form-item"},Ie={class:"form-item"},Oe={class:"form-item"},qe={class:"combo-table mt8"},Me={class:"ant-table-row"},Pe={class:"ant-table-cell"},Ae={class:"drag-btn"},Ue={class:"ant-table-cell"},Ne={class:"ant-table-cell"},Je={class:"ant-table-cell"},Re={class:"ant-table-cell"},Te=["onClick"],Be=["onClick"],je={class:"form-item"},ze={key:0,class:"qrcode-box mt8"},Ee=["src"],Le={class:"right"},De={class:"preview-box",id:"previewBox"},Fe={class:"tip"},Ve=["src"],Ge={class:"table-box"},Ye={key:0},Qe={class:"footer"},He={__name:"settings-box",props:{config:{type:Object}},emits:["update"],setup(r,{emit:w}){const S=w,k=r,O=ut(),b=m(null),u=m(null),c=m(!1),C=m(!1),f=m(""),n=Q({robot_id:O.query.id,try_count:3,package_type:"2",count_package:[],duration_package:[],contact_qrcode:"",package_poster:""}),o=m([]),q=m(-1),y=st(()=>f.value==""?!1:f.value!=JSON.stringify(n));rt(()=>{d()});function d(){U(JSON.parse(JSON.stringify(k.config)))}async function l(){c.value=!0,St({robot_id:O.query.id}).then(s=>{let e=(s==null?void 0:s.data)||{};S("update",JSON.parse(JSON.stringify(e))),e.count_package=at(e.count_package,[]),e.duration_package=at(e.duration_package,[]),U(e)}).finally(()=>{c.value=!1})}function U(s){Object.assign(n,s),f.value=JSON.stringify(n),T()}function h(s=null,e=-1){q.value=e,b.value.show(s)}function T(){o.value=n.package_type==1?n.count_package:n.duration_package}function j(s){q.value>-1?o.value[q.value]=s:o.value.push(s)}function Z(s,e){z.confirm({title:"提示",icon:et(nt),content:"确认删除该套餐?",okText:"确 定",cancelText:"取 消",onOk(){o.value.splice(e,1)}})}function F(s){try{if(!(s.type==="image/jpeg"||s.type==="image/png"))throw"只支持JPG、PNG格式的图片";if(!(s.size/1024<1024*2))throw"图片大小不能超过2M";bt({category:"library_image",file:s}).then(N=>{n.contact_qrcode=N.data.link})}catch(e){R.error(e)}return!1}function K(){z.confirm({title:"提示",icon:et(nt),content:"确认删除联系二维码?",okText:"确 定",cancelText:"取 消",onOk(){n.contact_qrcode=""}})}function W(){u.value.show()}function I(){return Wt(document.getElementById("previewBox"),{useCORS:!0}).then(async function(s){const e=await Jt(s),{data:A}=await bt({category:"library_image",file:e});return n.package_poster=A.link,A})}function X(){const s=n.package_type==1?"count_package":"duration_package";n[s]=o.value}function lt(){C.value=!0,Mt(async()=>{await I(),X();let s=JSON.parse(JSON.stringify(n));s.count_package=JSON.stringify(s.count_package),s.duration_package=JSON.stringify(s.duration_package),se(s).then(e=>{R.success("已保存"),l()}).finally(()=>{C.value=!1})})}return(s,e)=>{const A=vt,N=gt,V=mt,P=ft,tt=jt,it=zt,ct=Nt,dt=Et,M=Lt;return v(),$("div",null,[a(A,{type:"info","show-icon":"",message:"当用户无可用次数时，会返回给用户套餐购买说明，引导用户购买。本功能仅管控微信公众号、微信小程序、微信客服对外服务，其他渠道不受管控",class:"zm-alert-info"}),t("div",we,[t("div",Ce,[a(N,{onClick:W},{default:i(()=>[...e[4]||(e[4]=[p("复制设置到其他应用",-1)])]),_:1}),t("div",$e,[t("div",Se,[e[5]||(e[5]=t("div",{class:"form-item-tit"},"允许试用次数",-1)),a(P,{value:n.try_count,"onUpdate:value":e[0]||(e[0]=_=>n.try_count=_),style:{width:"320px"}},{default:i(()=>[(v(),$(L,null,D(50,_=>a(V,{key:_,value:_},{default:i(()=>[p(g(_),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),t("div",Ie,[e[8]||(e[8]=t("div",{class:"form-item-tit"},"套餐方案",-1)),a(it,{value:n.package_type,"onUpdate:value":e[1]||(e[1]=_=>n.package_type=_),onChange:T},{default:i(()=>[a(tt,{value:"1"},{default:i(()=>[...e[6]||(e[6]=[p("按次数收费",-1)])]),_:1}),a(tt,{value:"2"},{default:i(()=>[...e[7]||(e[7]=[p("按时长收费",-1)])]),_:1})]),_:1},8,["value"])]),t("div",Oe,[e[10]||(e[10]=t("div",{class:"form-item-tit"},"套餐方案",-1)),t("div",null,[a(N,{type:"primary",ghost:"",disabled:o.value.length>9,onClick:e[2]||(e[2]=_=>h())},{default:i(()=>[a(x(ot)),p(" 新增套餐 ("+g(o.value.length)+"/10) ",1)]),_:1},8,["disabled"]),t("table",qe,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",{class:"ant-table-cell",width:"120"},"套餐名"),t("th",{class:"ant-table-cell",width:"100"},"时长 (天)"),t("th",{class:"ant-table-cell",width:"120"},"总次数 (次)"),t("th",{class:"ant-table-cell",width:"100"},"费用 (元)"),t("th",{class:"ant-table-cell",width:"140"},"操作")])],-1)),a(x(Tt),{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=_=>o.value=_),onEnd:X,"item-key":"id",group:"table-rows",handle:".drag-btn",class:"ant-table-tbody",tag:"tbody"},{item:i(({element:_,index:G})=>[t("tr",Me,[t("td",Pe,[t("span",Ae,[a(ct,{name:"drag"})]),p(" "+g(_.name),1)]),t("td",Ue,g(_.duration),1),t("td",Ne,g(_.count),1),t("td",Je,g(_.price),1),t("td",Re,[t("a",{onClick:It=>h(_,G)},"编辑",8,Te),t("a",{onClick:It=>Z(_,G),class:"ml16"},"删除",8,Be)])])]),_:1},8,["modelValue"])]),o.value.length?E("",!0):(v(),J(Kt,{key:0}))])]),t("div",je,[e[12]||(e[12]=t("div",{class:"form-item-tit"},"联系二维码（推荐上传微信二维码方便用户联系）",-1)),t("div",null,[a(dt,{accept:".png,.jpg,.jpeg","show-upload-list":!1,"before-upload":F},{default:i(()=>[a(N,{type:"primary",ghost:""},{default:i(()=>[a(x(ot)),e[11]||(e[11]=p(" 上传图片 ",-1))]),_:1})]),_:1}),n.contact_qrcode?(v(),$("div",ze,[t("img",{class:"qrcode",src:n.contact_qrcode},null,8,Ee),t("a",{onClick:K},"删除")])):E("",!0)])])])]),t("div",Le,[e[15]||(e[15]=t("div",{class:"tit"},"无使用次数用户，对话时默认返回图片",-1)),t("div",De,[t("div",{class:kt(["wrap",{"no-qrcode":!n.contact_qrcode}])},[t("div",Fe,[a(x(Ct),{class:"icon"}),e[13]||(e[13]=p(" 您的使用次数已耗尽，请扫码联系客服购买 ",-1))]),n.contact_qrcode?(v(),$("img",{key:0,class:"qrcode",src:n.contact_qrcode,crossorigin:"anonymous"},null,8,Ve)):E("",!0),e[14]||(e[14]=t("div",{class:"title"},"次数套餐",-1)),t("div",Ge,[t("table",null,[(v(!0),$(L,null,D(o.value,(_,G)=>(v(),$("tr",{key:G},[t("td",null,g(_.name),1),n.package_type==2?(v(),$("td",Ye,g(_.duration)+"天",1)):E("",!0),t("td",null,g(_.count)+"次",1),t("td",null,g(_.price)+"元",1)]))),128))])])],2)])])]),t("div",Qe,[a(M,{open:y.value,content:"配置修改后需保存后生效",getPopupContainer:_=>_},{default:i(()=>[a(N,{type:"primary",style:{width:"120px"},loading:C.value,onClick:qt(lt,["stop"])},{default:i(()=>[...e[16]||(e[16]=[p("保 存",-1)])]),_:1},8,["loading"])]),_:1},8,["open","getPopupContainer"])]),a(ne,{ref_key:"packageRef",ref:b,type:n.package_type,onOk:j},null,8,["type"]),a(xe,{ref_key:"copyRef",ref:u,"robot-id":x(O).query.id},null,8,["robot-id"])])}}},Ze=H(He,[["__scopeId","data-v-2844cada"]]),Ke={class:"count-box"},We={key:1,class:"success-box"},Xe={class:"tit"},ta={class:"code-list"},ea={__name:"auth-code-modal",props:{robotId:{type:[Number,String]},packages:{type:Array}},emits:["addManager","ok"],setup(r,{expose:w,emit:S}){const k=S,O=r,b=m(!1),u=m(!1),c=m(!1),C=m([]),f=Q({package_id:void 0,count:1,remark:""}),n=st(()=>{const d=[{label:"1",value:1},{label:"5",value:5},{label:"10",value:10},{label:"50",value:50}];return d.push({label:"自定义",value:[1,5,10,50].includes(f.count)?"":f.count}),d});function o(){C.value=[],c.value=!1,b.value=!0}function q(){if(c.value){k("ok");let d=C.value.map(l=>l.content);_t(d.join(`
`)),R.success("复制成功")}b.value=!1}function y(){if(c.value)k("ok"),b.value=!1;else{if(!f.package_id)return R.error("请选择套餐");if(!f.count)return R.error("请选择数量");u.value=!0,ie({...f,robot_id:O.robotId}).then(d=>{C.value=(d==null?void 0:d.data)||[],c.value=!0}).finally(()=>{u.value=!1})}}return w({show:o}),(d,l)=>{const U=vt,h=mt,T=ft,j=xt,Z=wt,F=pt,K=ht,W=z;return v(),J(W,{title:"新增授权码",open:b.value,"onUpdate:open":l[5]||(l[5]=I=>b.value=I),"confirm-loading":u.value,"cancel-text":c.value?"复制":"取消",onOk:y,onCancel:q},{default:i(()=>[c.value?(v(),$("div",We,[t("div",Xe,[a(x(Dt),{class:"icon"}),l[7]||(l[7]=p(" 新增成功 ",-1))]),t("div",ta,[(v(!0),$(L,null,D(C.value,I=>(v(),$("div",{class:"code-item",key:I.content},g(I.content),1))),128))])])):(v(),$(L,{key:0},[a(U,{type:"info",class:"zm-alert-info"},{message:i(()=>[l[6]||(l[6]=p("设置管理员后，管理员可在公众号内回复【授权码】快速新垲，",-1)),t("a",{onClick:l[0]||(l[0]=I=>k("addManager"))},"点此新增管理员")]),_:1}),a(K,{layout:"vertical",class:"mt16"},{default:i(()=>[a(j,{label:"套餐",required:""},{default:i(()=>[a(T,{value:f.package_id,"onUpdate:value":l[1]||(l[1]=I=>f.package_id=I),placeholder:"选择套餐"},{default:i(()=>[(v(!0),$(L,null,D(r.packages,I=>(v(),J(h,{value:I.id},{default:i(()=>[p(g(I.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(j,{label:"数量",required:""},{default:i(()=>[t("div",Ke,[a(te,{value:f.count,"onUpdate:value":l[2]||(l[2]=I=>f.count=I),options:n.value},null,8,["value","options"]),a(Z,{value:f.count,"onUpdate:value":l[3]||(l[3]=I=>f.count=I),min:1,max:1e3,placeholder:"请输入"},null,8,["value"])])]),_:1}),a(j,{label:"备注"},{default:i(()=>[a(F,{value:f.remark,"onUpdate:value":l[4]||(l[4]=I=>f.remark=I),valueModifiers:{trim:!0},placeholder:"请输入",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})],64))]),_:1},8,["open","confirm-loading","cancel-text"])}}},aa=H(ea,[["__scopeId","data-v-4ffcac94"]]),oa="/assets/img/example-01-DKlscM3E.png",na="/assets/img/example-02-nLVgsFwr.png",sa={class:"main"},la={__name:"manager-modal",props:{robotId:{type:[Number,String]}},setup(r,{expose:w}){const S=r,k=m(!1),O=m(!1),b=m("");function u(){C(),k.value=!0}function c(){k.value=!1}function C(){O.value=!0,re({robot_id:S.robotId}).then(n=>{var o;b.value=(o=n==null?void 0:n.data)==null?void 0:o.code}).finally(()=>{O.value=!1})}function f(){_t(b.value),R.success("复制成功")}return w({show:u}),(n,o)=>{const q=gt,y=z;return v(),J(y,{title:"新增授权码管理员",open:k.value,"onUpdate:open":o[0]||(o[0]=d=>k.value=d),width:"669px"},{footer:i(()=>[a(q,{type:"primary",onClick:c},{default:i(()=>[...o[1]||(o[1]=[p("确 定",-1)])]),_:1})]),default:i(()=>[t("div",sa,[o[2]||(o[2]=t("span",null,"在公众号内回复",-1)),t("span",{class:"code-box",onClick:f},[p(g(b.value)+" ",1),a(x($t))]),o[3]||(o[3]=t("span",null,"对应账号自动设置为管理员，设置码3分钟内有效",-1))]),o[4]||(o[4]=t("div",{class:"example"},[t("img",{src:oa}),t("img",{src:na})],-1))]),_:1},8,["open"])}}},ia=H(la,[["__scopeId","data-v-201795a6"]]),ca={class:"content"},da={class:"overview-box"},ua={class:"overview-block"},ra={class:"overview-item"},_a={class:"tit"},pa={class:"count"},va={class:"val"},ga={class:"overview-item"},ma={class:"tit"},fa={class:"count"},ya={class:"val"},ba={class:"overview-item"},ka={class:"tit"},ha={class:"count"},xa={class:"val"},wa={class:"overview-block"},Ca={class:"overview-item"},$a={class:"tit"},Sa={class:"count"},Ia={class:"val"},Oa={class:"overview-item"},qa={class:"tit"},Ma={class:"count"},Pa={class:"val"},Aa={class:"overview-item"},Ua={class:"tit"},Na={class:"count"},Ja={class:"val"},Ra={class:"main-box"},Ta={class:"main-tit"},Ba={class:"user-list"},ja=["src"],za={class:"main-box"},Ea={class:"filter-box"},La={class:"left"},Da={class:"right"},Fa={key:0,class:"code-box"},Va={class:"zm-line2"},Ga=["onClick"],Ya={__name:"auth-code-box",props:{config:{type:Object}},setup(r){const w=r,S=ut(),k=m(null),O=m(null),b=m(!1),u=Q({today_exchange_count:"0",today_exchange_price:"",today_generate_count:"0",today_generate_price:"",total_exchange_count:"0",total_exchange_price:"",total_generate_count:"0",total_generate_price:"",yesterday_exchange_count:"0",yesterday_exchange_price:"",yesterday_generate_count:"0",yesterday_generate_price:""}),c=m([]),C=m([]),f=m([{title:"授权码",dataIndex:"content",width:200},{title:"套餐名",dataIndex:"package_name",width:100},{title:"时长 (天)",dataIndex:"package_duration",width:120},{title:"次数 (次)",dataIndex:"package_count",width:120},{title:"费用 (元)",dataIndex:"package_price",width:100},{title:"使用状态",dataIndex:"usage_status_text",width:120},{title:"兌换人",dataIndex:"exchanger_openid",width:160},{title:"兑换时间",dataIndex:"exchange_date",width:160},{title:"使用时间",dataIndex:"use_date",width:160},{title:"创建时间",dataIndex:"create_date",width:160},{title:"创建人",dataIndex:"creator_name",width:100},{title:"备注",dataIndex:"remark",width:160},{title:"操作",dataIndex:"action",fixed:"right",width:100}]),n=Q({content:"",openid:"",usage_status:void 0}),o=Q({current:1,pageSize:50,total:0}),q={1:"未使用",2:"已兑换",3:"已使用"},y=st(()=>{var e;let s=((e=w.config)==null?void 0:e.package_type)==1?w.config.count_package:w.config.duration_package;return Array.isArray(s)?s:[]});rt(()=>{d()});function d(){l(),U(),T()}function l(){ue({robot_id:S.query.id}).then(s=>{Object.assign(u,(s==null?void 0:s.data)||{})})}function U(){_e({robot_id:S.query.id}).then(s=>{c.value=(s==null?void 0:s.data)||[]})}function h(){C.value=[],o.total=0,o.current=1,T()}function T(){let s={robot_id:S.query.id,page:o.current,size:o.pageSize,...n};de(s).then(e=>{var N,V;let A=((N=e==null?void 0:e.data)==null?void 0:N.list)||[];A.forEach(P=>{P.usage_status_text=q[P==null?void 0:P.usage_status],P.exchange_date=j(P.exchange_time),P.create_date=j(P.create_time),P.use_date=j(P.use_time)}),C.value=A,o.total=Number(((V=e==null?void 0:e.data)==null?void 0:V.total)||0)})}function j(s){return s>0?Ft(s*1e3).format("YYYY-MM-DD HH:mm"):""}function Z(s){Object.assign(o,s),T()}function F(){O.value.show()}function K(){k.value.show()}function W(s){z.confirm({title:"提示",icon:et(nt),content:"确认删除该授权码?",okText:"确 定",cancelText:"取 消",onOk(){ce({id:s.id}).then(()=>{R.success("已删除"),T()})}})}function I(s){z.confirm({title:"提示",icon:et(nt),content:"确认删除该管理员?",okText:"确 定",cancelText:"取 消",onOk(){pe({id:s.id,robot_id:S.query.id}).then(()=>{R.success("已删除"),U()})}})}function X(){let s=[],e=[];f.value.forEach(A=>{A.dataIndex!=="action"&&(s.push(A.title),e.push(A.dataIndex))}),Rt(s.toString()+`
`,C.value,e,`${S.query.robot_key}授权码明细.csv`)}function lt(s){_t(s),R.success("复制成功")}return(s,e)=>{const A=Vt,N=gt,V=Yt,P=pt,tt=mt,it=ft,ct=Qt,dt=Ht;return v(),$("div",ca,[t("div",da,[t("div",ua,[t("div",ra,[t("div",_a,[e[3]||(e[3]=p("今日生成 (次) ",-1)),a(x(Y))]),t("div",pa,g(u.today_generate_count),1),t("div",va,[e[4]||(e[4]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.today_generate_price||0),1)])]),t("div",ga,[t("div",ma,[e[5]||(e[5]=p("昨日生成 (次) ",-1)),a(x(Y))]),t("div",fa,g(u.yesterday_generate_count),1),t("div",ya,[e[6]||(e[6]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.yesterday_generate_price||0),1)])]),t("div",ba,[t("div",ka,[e[7]||(e[7]=p("累计生成 (次) ",-1)),a(x(Y))]),t("div",ha,g(u.total_generate_count),1),t("div",xa,[e[8]||(e[8]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.total_generate_price||0),1)])])]),t("div",wa,[t("div",Ca,[t("div",$a,[e[9]||(e[9]=p("今日兑换 (次) ",-1)),a(x(Y))]),t("div",Sa,g(u.today_exchange_count),1),t("div",Ia,[e[10]||(e[10]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.today_exchange_price||0),1)])]),t("div",Oa,[t("div",qa,[e[11]||(e[11]=p("昨日兑换 (次) ",-1)),a(x(Y))]),t("div",Ma,g(u.yesterday_exchange_count),1),t("div",Pa,[e[12]||(e[12]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.yesterday_exchange_price||0),1)])]),t("div",Aa,[t("div",Ua,[e[13]||(e[13]=p("累计兑换 (次) ",-1)),a(x(Y))]),t("div",Na,g(u.total_exchange_count),1),t("div",Ja,[e[14]||(e[14]=t("span",{class:"label"},"价格 (元）：",-1)),p(g(u.total_exchange_price||0),1)])])])]),t("div",Ra,[t("div",Ta,[e[15]||(e[15]=p(" 授权码管理员 ",-1)),a(A,{type:"vertical"}),e[16]||(e[16]=t("span",{class:"tip-info"},"管理员使用不收费，管理员在聊天框内回复【授权码】可直接新建授权码",-1))]),t("div",null,[a(N,{type:"primary",ghost:"",onClick:F},{default:i(()=>[a(x(ot)),e[17]||(e[17]=p(" 新增管理员",-1))]),_:1}),t("div",Ba,[(v(!0),$(L,null,D(c.value,M=>(v(),J(V,{key:M.id},{default:i(()=>[t("img",{class:"avatar",src:M.manager_avatar},null,8,ja),p(" "+g(M.manager_nickname)+" ",1),a(x(Gt),{class:"close",onClick:_=>I(M)},null,8,["onClick"])]),_:2},1024))),128))])])]),t("div",za,[e[20]||(e[20]=t("div",{class:"main-tit"},"授权码明细",-1)),t("div",null,[t("div",Ea,[t("div",La,[a(P,{value:n.content,"onUpdate:value":e[0]||(e[0]=M=>n.content=M),valueModifiers:{trim:!0},onChange:h,"allow-clear":"",placeholder:"搜索授权码",style:{width:"200px"}},{suffix:i(()=>[a(x(yt))]),_:1},8,["value"]),a(P,{value:n.openid,"onUpdate:value":e[1]||(e[1]=M=>n.openid=M),valueModifiers:{trim:!0},onChange:h,"allow-clear":"",placeholder:"搜索openid",style:{width:"200px"}},{suffix:i(()=>[a(x(yt))]),_:1},8,["value"]),a(it,{value:n.usage_status,"onUpdate:value":e[2]||(e[2]=M=>n.usage_status=M),onChange:h,"allow-clear":"",placeholder:"使用状态",style:{width:"200px"}},{default:i(()=>[(v(),$(L,null,D(q,(M,_)=>a(tt,{key:_,value:_},{default:i(()=>[p(g(M),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),t("div",Da,[a(N,{onClick:X},{default:i(()=>[...e[18]||(e[18]=[p("导 出",-1)])]),_:1}),a(N,{type:"primary",onClick:K},{default:i(()=>[a(x(ot)),e[19]||(e[19]=p(" 新 增",-1))]),_:1})])]),a(dt,{scroll:{x:1200},loading:b.value,"data-source":C.value,columns:f.value,pagination:o,onChange:Z},{bodyCell:i(({column:M,record:_})=>[M.dataIndex==="content"?(v(),$("div",Fa,[t("span",null,g(_.content),1),a(x($t),{class:"icon",onClick:G=>lt(_.content)},null,8,["onClick"])])):E("",!0),M.dataIndex==="remark"?(v(),J(ct,{key:1,title:_.remark},{default:i(()=>[t("div",Va,g(_.remark),1)]),_:2},1032,["title"])):E("",!0),M.dataIndex==="action"?(v(),$("a",{key:2,onClick:G=>W(_)},"删除",8,Ga)):E("",!0)]),_:1},8,["loading","data-source","columns","pagination"])])]),a(aa,{ref_key:"codeRef",ref:k,packages:y.value,robotId:x(S).query.id,onAddManager:F,onOk:T},null,8,["packages","robotId"]),a(ia,{ref_key:"managerRef",ref:O,robotId:x(S).query.id},null,8,["robotId"])])}}},Qa=H(Ya,[["__scopeId","data-v-a0209f9a"]]),Ha={class:"_container"},Za={class:"main-tit"},Ka={class:"tab-box"},Wa={__name:"index",setup(r){const w=ut(),S=Pt(),k=oe(),O=st(()=>k.paymentSwitchStatus==="1"),b=m(!0),u=m({}),c=m(2),C=m([{title:"收费设置",value:1},{title:"授权码管理",value:2}]);rt(()=>{w.query.form_guide==1?c.value=1:c.value=Number(localStorage.getItem("zm:payment:tab:active")||1),f()});function f(){b.value=!0,St({robot_id:w.query.id}).then(y=>{let d=(y==null?void 0:y.data)||{};!d||!Object.keys(d).length&&!w.query.form_guide?S.push({path:"/robot/ability/payment-guide",query:w.query}):n(d)}).finally(()=>{b.value=!1})}function n(y){y.count_package=at(y.count_package,[]),y.duration_package=at(y.duration_package,[]),u.value=y}function o(){localStorage.setItem("zm:payment:tab:active",c.value)}function q(y){const d=y?"1":"0",l=()=>ae({robot_id:w.query.id,ability_type:"robot_payment",switch_status:d}).then(()=>{k.setPaymentSwitchStatus(d),R.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:w.query.id}}))});d==="0"?z.confirm({title:"提示",content:"关闭后，设置的收费策略将失效，确认关闭？",onOk:l}):l()}return(y,d)=>{const l=Zt,U=At("router-link");return v(),$("div",Ha,[t("div",Za,[t("div",null,[d[1]||(d[1]=p("应用收费 ",-1)),a(l,{checked:O.value,"checked-children":"开","un-checked-children":"关",onChange:q},null,8,["checked"])]),a(U,{to:{path:"/robot/ability/payment-guide",query:x(w).query}},{default:i(()=>[...d[2]||(d[2]=[t("a",{class:"link"},"查看功能介绍",-1)])]),_:1},8,["to"])]),t("div",Ka,[a(Ut,{tabs:C.value,value:c.value,"onUpdate:value":d[0]||(d[0]=h=>c.value=h),onChange:o},null,8,["tabs","value"])]),b.value?(v(),J(ee,{key:0})):c.value==1?(v(),J(Ze,{key:1,config:u.value,onUpdate:n},null,8,["config"])):(v(),J(Qa,{key:2,config:u.value},null,8,["config"]))])}}},fo=H(Wa,[["__scopeId","data-v-6a7d17d1"]]);export{fo as default};
