import{Y as p,_ as i,a5 as e,k as t,ae as E,G as C,a7 as U,a3 as ve,a1 as V,a2 as l,a6 as dt,ad as we,f as q,c as H,r as T,e as oe,n as ce,A as ue,u as $,J as Z,ab as Je,F as B,a9 as W,w as _e,l as Qe,o as ke,j as _t,h as qe,ak as me,al as ye,a4 as Ge,b as ct,B as ut,y as Ke,ai as pt,ag as mt,p as vt}from"./vue-chunks-Ci-XTWEs.js";import{b as F,d as pe,a8 as ft,a1 as bt,a4 as ht,ah as yt,ai as kt,e as gt,F as xt,aj as Ue,h as $t,ag as wt}from"../../index-CPkdGIiL.js";import{B as ie,E as ge,I as xe,Q as $e,aj as Be,$ as qt,ao as St,ah as We,M as te,a as Y,F as Oe,e as He,u as je,v as Me,Z as Ze,Y as Ye,az as Ct,p as se,aA as Lt,X as ne,ap as fe,z as Re,g as Xe,ar as It,ae as Ut,af as Rt,q as Ve,R as ze,ab as ee,aB as et,O as Se,aC as Et,k as Ot,ay as At,ad as jt,ag as Mt,a9 as tt,x as Vt,H as Ae,V as zt,U as Te,a8 as Dt,h as Ee,aa as Nt,y as Pt,ak as Bt}from"./ui-antd-Bw8cEW5z.js";import{C as Tt}from"./cu-upload-qKd75kAs.js";import{u as ot}from"./robot-DsbzMi16.js";import{o as Ft,p as Jt,g as Qt,q as Gt}from"./index-Bu5ae_-0.js";import{_ as Kt}from"./index-BgPFsOXy.js";import{h as st}from"./index-BxiNNyyE.js";import{C as Wt}from"./index-DEDImu82.js";import{L as Ht}from"./library-select-alert-Cw_HDLZ7.js";import{_ as Zt}from"./recommendation-AQ4_FPQ9.js";import{_ as nt}from"./cu-scroll-5W3_kglT.js";import{a as Yt}from"./index-CPuy80m4.js";import{g as it}from"./index-C-AkEgVY.js";import{_ as Xt}from"./empty-CzGZrENG.js";import{d as De}from"./vuedraggable.umd-DJBjom-v.js";import{M as eo}from"./model-select-CiMSoZvM.js";import{_ as to}from"./empty-BFmzY9bl.js";import{i as oo,e as so,f as no}from"./index-CgXFvif9.js";import{A as io}from"./add-collaborator-yv3VkKUH.js";import{R as lo}from"./robot-select-alert-YNY_q_SM.js";import"./utils-ChQO-_r6.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const ao={class:"edit-box-header"},ro={class:"left-box"},_o={class:"edit-box-title"},co={key:0},uo={key:0,class:"title-tip"},po={class:"right-box"},mo={class:"extra-box"},vo={class:"actions-box"},fo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(D,{emit:m}){const w=m,_=D,d=n=>{w("edit"),w("update:isEdit",n)},s=()=>{w("save")};return(n,b)=>{const h=pe,a=ie,x=ge;return i(),p("div",{class:we(["edit-box",{"is-edit":D.isEdit}])},[e("div",ao,[e("div",ro,[t(h,{class:"edit-box-icon",name:_.iconName},null,8,["name"]),e("span",_o,[C(U(_.title)+" ",1),n.$slots.icon?(i(),p("span",co,[ve(n.$slots,"icon",{},void 0,!0)])):E("",!0)]),n.$slots.tip?(i(),p("span",uo,[ve(n.$slots,"tip",{},void 0,!0)])):E("",!0)]),e("div",po,[e("div",mo,[ve(n.$slots,"extra",{},()=>[e("div",vo,[_.isEdit?(i(),V(x,{key:0,gap:8},{default:l(()=>[t(a,{onClick:s,size:"small",type:"primary"},{default:l(()=>b[2]||(b[2]=[C("保存")])),_:1,__:[2]}),t(a,{onClick:b[0]||(b[0]=r=>d(!1)),size:"small"},{default:l(()=>b[3]||(b[3]=[C("取消")])),_:1,__:[3]})]),_:1})):(i(),V(a,{key:1,onClick:b[1]||(b[1]=r=>d(!0)),size:"small"},{default:l(()=>b[4]||(b[4]=[C("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:dt({...D.bodyStyle})},[ve(n.$slots,"default",{},void 0,!0)],4)],2)}}},X=F(fo,[["__scopeId","data-v-dbe09743"]]),bo={class:"robot-form-box"},ho={class:"form-item"},yo={class:"form-item-body robot-name-item"},ko={class:"robot-avetar-upload"},go=["src"],xo={class:"robot-name-box"},$o={class:"form-item"},wo={class:"form-item-body"},qo={class:"robot-info-box"},So={class:"robot-name-box"},Co=["src"],Lo={class:"robot-name"},Io={class:"robot-intro"},Uo={__name:"basic-config",setup(D){const m=ot(),w=q(!1),{robotInfo:_,updateRobotInfo:d}=H("robotInfo"),s=T({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=oe(()=>m.robotList||[]),b=oe(()=>m.robotGroupList||[]),h=oe(()=>{let c="未分组",o=n.value.find(u=>u.id==_.id)||{};if(o.group_id>0){let u=b.value.find(y=>y.id==o.group_id);u&&(c=u.group_name)}return c}),a=()=>{d({...Z(s)}),w.value=!1},x=c=>{let o=c[0];return s.robot_avatar=o,ft(o).then(u=>{s.robot_avatar_url=u}),!1},r=()=>{s.robot_name=_.robot_name,s.robot_intro=_.robot_intro,s.robot_avatar=_.robot_avatar,s.robot_avatar_url=_.robot_avatar_url};return(c,o)=>{const u=xe,y=$e;return i(),V(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:w.value,"onUpdate:isEdit":o[2]||(o[2]=L=>w.value=L),onSave:a,onEdit:r},{default:l(()=>[ce(e("div",bo,[e("div",ho,[o[3]||(o[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",yo,[t(Tt,{accept:"image/*",onChange:x},{default:l(()=>[e("div",ko,[s.robot_avatar_url?(i(),p("img",{key:0,class:"robot-avetar",src:s.robot_avatar_url},null,8,go)):E("",!0)])]),_:1}),e("div",xo,[t(u,{value:s.robot_name,"onUpdate:value":o[0]||(o[0]=L=>s.robot_name=L),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",$o,[o[4]||(o[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",wo,[t(y,{rows:3,value:s.robot_intro,"onUpdate:value":o[1]||(o[1]=L=>s.robot_intro=L),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ue,w.value]]),ce(e("div",qo,[e("div",So,[e("img",{class:"robot-avatar",src:$(_).robot_avatar_url,alt:""},null,8,Co),e("span",Lo,U($(_).robot_name),1)]),e("div",Io,[e("span",null,"分组："+U(h.value),1),e("span",null,"简介："+U($(_).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[ue,!w.value]])]),_:1},8,["isEdit"])}}},Ro=F(Uo,[["__scopeId","data-v-7fc4a51d"]]),Eo={class:"ai-create-box"},Oo={class:"input-box"},Ao={key:1},jo={key:2},Mo={class:"quick-tags-box"},Vo={class:"ai-list-box"},zo={key:0,class:"loading-box"},Do={key:0,class:"prompt-list-box"},No={class:"prompt-list"},Po={class:"prompt-header"},Bo={class:"prompt-title"},To={class:"prompt-content"},Fo={class:"prompt-list"},Jo={class:"prompt-header"},Qo={class:"prompt-title"},Go={class:"prompt-content"},Ko={class:"prompt-list"},Wo={class:"prompt-header"},Ho={class:"prompt-title"},Zo={class:"prompt-content"},Yo={class:"prompt-list"},Xo={class:"prompt-header"},es={class:"prompt-title"},ts={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={class:"prompt-content"},ls={class:"prompt-header"},as={class:"prompt-title"},rs={class:"prompt-content"},ds={key:1,class:"empty-box"},_s={__name:"ai-create-prompt",emits:["handleAiSave"],setup(D,{expose:m,emit:w}){const _=Be.PRESENTED_IMAGE_SIMPLE,d=q(!1),s=q(!1),n=Je().query,b=w,h=q(""),a=q(!1),x=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],r=q("在上方输入框输入要求，点击生成提示词"),c=()=>{o.value=!1,y.promptStruct=u,h.value="",r.value="在上方输入框输入要求，点击生成提示词",d.value=!0},o=q(!1),u={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},y=T({promptStruct:u}),L=O=>{h.value=O},k=()=>{if(!h.value)return Y.error("请输入AI 生成提示词");if(a.value)return Y.error("正在生成中...");a.value=!0,Ft({id:n.id,demand:h.value}).then(O=>{y.promptStruct=JSON.parse(O.data.promptStruct),o.value=!0}).finally(()=>{a.value=!1}).catch(O=>{o.value=!1,r.value=O.msg})},R=()=>{if(!o.value)return Y.error("请先生成提示词");b("handleAiSave",y.promptStruct),d.value=!1};return m({show:c}),(O,f)=>{const A=ie,K=$e,S=pe,v=St,Q=We,M=Be,z=te;return i(),p("div",null,[t(z,{open:d.value,"onUpdate:open":f[1]||(f[1]=I=>d.value=I),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:l(()=>[t(A,{type:"primary",loading:s.value,onClick:R},{default:l(()=>f[2]||(f[2]=[C("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:l(()=>[e("div",Eo,[e("div",Oo,[t(K,{style:{width:"100%"},value:h.value,"onUpdate:value":f[0]||(f[0]=I=>h.value=I),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:we(["btn-box",{"disabed-status":a.value}]),onClick:k},[a.value?(i(),V($(qt),{key:0})):E("",!0),t(S,{name:"ai-mark"}),a.value?(i(),p("span",Ao,"生成中...")):(i(),p("span",jo,"生成"))],2)]),e("div",Mo,[f[3]||(f[3]=e("div",{class:"quick-label"},"快捷生成：",-1)),(i(),p(B,null,W(x,I=>t(v,{key:I.title,onClick:J=>L(I.title),color:"blue"},{default:l(()=>[C(U(I.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Vo,[a.value?(i(),p("div",zo,[t(Q,{tip:"正在生成中..."})])):(i(),p(B,{key:1},[o.value?(i(),p("div",Do,[e("div",No,[e("div",Po,[e("div",Bo,U(y.promptStruct.role.subject),1)]),e("div",To,U(y.promptStruct.role.describe),1)]),e("div",Fo,[e("div",Jo,[e("div",Qo,U(y.promptStruct.task.subject),1)]),e("div",Go,U(y.promptStruct.task.describe),1)]),e("div",Ko,[e("div",Wo,[e("div",Ho,U(y.promptStruct.constraints.subject),1)]),e("div",Zo,U(y.promptStruct.constraints.describe),1)]),e("div",Yo,[e("div",Xo,[e("div",es,U(y.promptStruct.output.subject),1)]),e("div",ts,U(y.promptStruct.output.describe),1)]),e("div",os,[e("div",ss,[e("div",ns,U(y.promptStruct.tone.subject),1)]),e("div",is,U(y.promptStruct.tone.describe),1)]),(i(!0),p(B,null,W(y.promptStruct.custom,(I,J)=>(i(),p("div",{class:"prompt-list",key:J+I.key?I.key:""},[e("div",ls,[e("div",as,U(I.subject),1)]),e("div",rs,U(I.describe),1)]))),128))])):(i(),p("div",ds,[t(M,{image:$(_),description:r.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},cs=F(_s,[["__scopeId","data-v-abe0e674"]]),us={__name:"upload-prompt",setup(D,{expose:m}){const w=q(!1),_=T({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),d=q(null),s=x=>{if(x.prompt_type==0&&!x.prompt)return Y.error("自定义提示为空,无法上传");d.value&&d.value.resetFields();let r={...x};_.title="",_.group_id=0,_.prompt="",_.prompt_struct={},_.prompt_type=r.prompt_type,r.prompt_type==0?_.prompt=r.prompt:_.prompt_struct=JSON.stringify(r.prompt_struct),w.value=!0},n=q([]);(()=>{bt().then(x=>{n.value=[{id:0,group_name:"默认分组"},...x.data]})})();const h=q(!1),a=()=>{d.value.validate().then(()=>{let x={..._};h.value=!0,ht({...x}).then(()=>{Y.success("保存成功"),w.value=!1}).finally(()=>{h.value=!1})})};return m({show:s}),(x,r)=>{const c=xe,o=He,u=Me,y=je,L=Oe,k=te;return i(),p("div",null,[t(k,{open:w.value,"onUpdate:open":r[2]||(r[2]=R=>w.value=R),title:"保存到提示词库",width:580,onOk:a,confirmLoading:h.value},{default:l(()=>[t(L,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:d,model:_},{default:l(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:l(()=>[t(c,{value:_.title,"onUpdate:value":r[0]||(r[0]=R=>_.title=R),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:l(()=>[t(y,{value:_.group_id,"onUpdate:value":r[1]||(r[1]=R=>_.group_id=R),style:{width:"100%"}},{default:l(()=>[(i(!0),p(B,null,W(n.value,R=>(i(),V(u,{value:R.id},{default:l(()=>[C(U(R.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},ps={class:"prompt-box"},ms={class:"tab-header"},vs={key:0,class:"opt-block"},fs={key:1,class:"opt-block"},bs={class:"tip-text"},hs={key:0,class:"prompt-list-box"},ys={class:"prompt-list"},ks={class:"prompt-header"},gs={class:"prompt-title"},xs={key:0,class:"btn-wrapper-box"},$s={class:"prompt-content"},ws={class:"prompt-list"},qs={class:"prompt-header"},Ss={class:"prompt-title"},Cs={key:0,class:"btn-wrapper-box"},Ls={class:"prompt-content"},Is={class:"prompt-list"},Us={class:"prompt-header"},Rs={class:"prompt-title"},Es={key:0,class:"btn-wrapper-box"},Os={class:"prompt-content"},As={class:"prompt-list"},js={class:"prompt-header"},Ms={class:"prompt-title"},Vs={key:0,class:"btn-wrapper-box"},zs={class:"prompt-content"},Ds={class:"prompt-list"},Ns={class:"prompt-header"},Ps={class:"prompt-title"},Bs={key:0,class:"btn-wrapper-box"},Ts={class:"swich-item"},Fs={class:"swich-item"},Js={class:"prompt-content"},Qs={class:"prompt-list"},Gs={class:"prompt-header"},Ks={class:"prompt-title"},Ws={key:0,class:"btn-wrapper-box"},Hs={class:"prompt-content"},Zs={class:"prompt-header"},Ys={class:"prompt-title",style:{flex:"1"}},Xs={key:0,class:"btn-wrapper-box"},en=["onClick"],tn={class:"prompt-content"},on={key:0,class:"add-theme-block"},sn={class:"show-more-block"},nn={key:1,class:"diy-prompt-box"},ln={key:0,class:"diy-switch-box"},an={class:"swich-item"},rn={class:"swich-item"},re="- 请使用markdown格式回答问题。",de="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",dn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(D){const m=q(!1),{robotInfo:w,updateRobotInfo:_}=H("robotInfo"),d=D;let s={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const n=q({}),b=q(!1),h=q(!1),a=q(!1),x=q(!1),r=T({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),c=q(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{c.value=!c.value,localStorage.setItem("system_prompt_words_ishide",c.value?1:0)},u=(P,g)=>P.includes(g),y=q(w.prompt_type);_e(()=>w,()=>{r.prompt=w.prompt,r.prompt_struct=w.prompt_struct,n.value=w.prompt_struct_default},{immediate:!0,deep:!0}),_e(()=>r.prompt_struct.output.describe,P=>{b.value=u(P,re),h.value=u(P,de)},{immediate:!0,deep:!0}),_e(()=>r.prompt,P=>{a.value=u(P,re),x.value=u(P,de)},{immediate:!0,deep:!0});const L=(P,g)=>{P?(g=="outSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+re:r.prompt_struct.output.describe+=re),g=="imgSwitch"&&(r.prompt_struct.output.describe?r.prompt_struct.output.describe+=`
`+de:r.prompt_struct.output.describe+=de)):(g=="outSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(re,"g"),"")),g=="imgSwitch"&&(r.prompt_struct.output.describe=r.prompt_struct.output.describe.replace(new RegExp(de,"g"),"")),r.prompt_struct.output.describe=r.prompt_struct.output.describe.trim())},k=(P,g)=>{P?(g=="outDiySwitch"&&(r.prompt?r.prompt+=`
`+re:r.prompt+=re),g=="imgDiySwitch"&&(r.prompt?r.prompt+=`
`+de:r.prompt+=de)):(g=="outDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(re,"g"),"")),g=="imgDiySwitch"&&(r.prompt=r.prompt.replace(new RegExp(de,"g"),"")),r.prompt=r.prompt.trim())},R=P=>{r.prompt_struct[P].describe=n.value[P].describe},O=()=>{let P=w.work_flow_ids.split(","),g=d.robotList.filter(he=>P.includes(he.id)),N=[];N=g.map(he=>`- ${he.robot_name} ${he.robot_intro}`).join(`
`),r.prompt_struct.skill.describe=N},f=()=>{r.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),y.value=1},A=P=>{r.prompt_struct.custom.splice(P,1)},K=()=>{_({...Z(r),prompt_type:y.value}),m.value=!1},S=P=>{y.value=1,_({prompt_type:y.value,prompt:r.prompt,prompt_struct:P}),m.value=!1},v=()=>{m.value=!0},Q=()=>{m.value=!1},M=q(null),z=()=>{M.value.show()},I=q(null),J=()=>{I.value.show()},G=q(null),le=()=>{G.value.show({...r,prompt_type:y.value})},be=P=>{P.prompt_type==1?(y.value=1,r.prompt_struct=P.prompt_struct):(y.value=0,r.prompt=P.prompt),K()};return(P,g)=>{const N=Ze,he=Ye,Ne=se,lt=pe,Ce=ie,at=ge,ae=$e,Le=ne,rt=xe;return i(),p("div",ps,[e("div",ms,[t(he,{activeKey:y.value,"onUpdate:activeKey":g[0]||(g[0]=j=>y.value=j)},{default:l(()=>[(i(),V(N,{key:1,tab:"结构化提示词"})),(i(),V(N,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),m.value?(i(),p("div",vs,[t(Ne,null,{title:l(()=>g[22]||(g[22]=[C("将当前编辑的提示词保存到提示词库中")])),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:le},[t($(Ct)),g[23]||(g[23]=C("上传 "))])]),_:1}),t(Ne,null,{title:l(()=>g[24]||(g[24]=[C("从提示词库导入提示词")])),default:l(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:J},[t($(Lt)),g[25]||(g[25]=C("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:z},[t(lt,{name:"ai-mark"}),g[26]||(g[26]=C(" AI自动生成 "))]),t(at,{gap:8},{default:l(()=>[t(Ce,{size:"small",type:"primary",onClick:K},{default:l(()=>g[27]||(g[27]=[C("保存")])),_:1,__:[27]}),t(Ce,{size:"small",onClick:Q},{default:l(()=>g[28]||(g[28]=[C("取消")])),_:1,__:[28]})]),_:1})])):(i(),p("div",fs,[e("span",bs,"当前类型："+U(y.value==1?"结构化提示词":"自定义提示词"),1),t(Ce,{size:"small",onClick:v},{default:l(()=>g[29]||(g[29]=[C("修改")])),_:1,__:[29]})]))]),y.value==1?(i(),p("div",hs,[e("div",ys,[e("div",ks,[e("div",gs,U(r.prompt_struct.role.subject),1),m.value?(i(),p("div",xs,[e("a",{onClick:g[1]||(g[1]=j=>R("role"))},"恢复默认")])):E("",!0)]),e("div",$s,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.role.describe,"onUpdate:value":g[2]||(g[2]=j=>r.prompt_struct.role.describe=j),placeholder:$(s).role},null,8,["disabled","value","placeholder"])])]),e("div",ws,[e("div",qs,[e("div",Ss,U(r.prompt_struct.task.subject),1),m.value?(i(),p("div",Cs,[e("a",{onClick:g[3]||(g[3]=j=>R("task"))},"恢复默认")])):E("",!0)]),e("div",Ls,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.task.describe,"onUpdate:value":g[4]||(g[4]=j=>r.prompt_struct.task.describe=j),placeholder:$(s).task},null,8,["disabled","value","placeholder"])])]),c.value?(i(),p(B,{key:0},[e("div",Is,[e("div",Us,[e("div",Rs,U(r.prompt_struct.constraints.subject),1),m.value?(i(),p("div",Es,[e("a",{onClick:g[5]||(g[5]=j=>R("constraints"))},"恢复默认")])):E("",!0)]),e("div",Os,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.constraints.describe,"onUpdate:value":g[6]||(g[6]=j=>r.prompt_struct.constraints.describe=j),placeholder:$(s).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",As,[e("div",js,[e("div",Ms,U(r.prompt_struct.skill.subject),1),m.value?(i(),p("div",Vs,[e("a",{onClick:g[7]||(g[7]=j=>O())},"自动导入技能")])):E("",!0)]),e("div",zs,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.skill.describe,"onUpdate:value":g[8]||(g[8]=j=>r.prompt_struct.skill.describe=j),placeholder:$(s).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",Ds,[e("div",Ns,[e("div",Ps,U(r.prompt_struct.output.subject),1),m.value?(i(),p("div",Bs,[e("div",Ts,[g[30]||(g[30]=C(" 输出markdown： ")),t(Le,{onChange:g[9]||(g[9]=j=>L(j,"outSwitch")),checked:b.value,"onUpdate:checked":g[10]||(g[10]=j=>b.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Fs,[g[31]||(g[31]=C(" 回复图片： ")),t(Le,{onChange:g[11]||(g[11]=j=>L(j,"imgSwitch")),checked:h.value,"onUpdate:checked":g[12]||(g[12]=j=>h.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:g[13]||(g[13]=j=>R("output"))},"恢复默认")])):E("",!0)]),e("div",Js,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.output.describe,"onUpdate:value":g[14]||(g[14]=j=>r.prompt_struct.output.describe=j),placeholder:$(s).output},null,8,["disabled","value","placeholder"])])]),e("div",Qs,[e("div",Gs,[e("div",Ks,U(r.prompt_struct.tone.subject),1),m.value?(i(),p("div",Ws,[e("a",{onClick:g[15]||(g[15]=j=>R("tone"))},"恢复默认")])):E("",!0)]),e("div",Hs,[t(ae,{bordered:!1,disabled:!m.value,value:r.prompt_struct.tone.describe,"onUpdate:value":g[16]||(g[16]=j=>r.prompt_struct.tone.describe=j),placeholder:$(s).tone},null,8,["disabled","value","placeholder"])])]),(i(!0),p(B,null,W(r.prompt_struct.custom,(j,Pe)=>(i(),p("div",{class:"prompt-list",key:Pe+j.key?j.key:""},[e("div",Zs,[e("div",Ys,[t(rt,{bordered:!1,disabled:!m.value,style:{width:"100%"},value:j.subject,"onUpdate:value":Ie=>j.subject=Ie,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),m.value?(i(),p("div",Xs,[e("div",{class:"hover-btn-box",onClick:Ie=>A(Pe)},[t($(fe))],8,en)])):E("",!0)]),e("div",tn,[t(ae,{bordered:!1,disabled:!m.value,value:j.describe,"onUpdate:value":Ie=>j.describe=Ie,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),m.value?(i(),p("div",on,[t(Ce,{onClick:f,block:"",icon:Qe($(Re))},{default:l(()=>g[32]||(g[32]=[C("添加主题")])),_:1,__:[32]},8,["icon"])])):E("",!0)],64)):E("",!0),e("div",sn,[e("div",{class:"btn-item",onClick:o},[c.value?(i(),p(B,{key:1},[g[34]||(g[34]=C("收起")),t($(It))],64)):(i(),p(B,{key:0},[g[33]||(g[33]=C("展开")),t($(Xe))],64))])])])):(i(),p("div",nn,[m.value?(i(),p("div",ln,[e("div",an,[g[35]||(g[35]=C(" 输出markdown： ")),t(Le,{size:"small",onChange:g[17]||(g[17]=j=>k(j,"outDiySwitch")),checked:a.value,"onUpdate:checked":g[18]||(g[18]=j=>a.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",rn,[g[36]||(g[36]=C(" 回复图片： ")),t(Le,{size:"small",onChange:g[19]||(g[19]=j=>k(j,"imgDiySwitch")),checked:x.value,"onUpdate:checked":g[20]||(g[20]=j=>x.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):E("",!0),t(ae,{bordered:m.value,value:r.prompt,"onUpdate:value":g[21]||(g[21]=j=>r.prompt=j),disabled:!m.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(cs,{onHandleAiSave:S,ref_key:"aiCreatePromptRef",ref:M},null,512),t(Kt,{onOk:be,ref_key:"importPromptRef",ref:I},null,512),t(us,{ref_key:"uploadPromptRef",ref:G},null,512)])}}},_n=F(dn,[["__scopeId","data-v-c1235ef1"]]),cn={class:"actions-box"},un={class:"setting-info-block"},pn={class:"set-item w-100"},mn={key:0,class:"set-item-content"},vn=["src"],fn={key:1},bn={class:"set-item"},hn={class:"set-item"},yn={class:"set-item"},kn={class:"set-item"},gn={class:"form-box"},xn={class:"form-item"},$n={class:"form-item-body"},wn={class:"form-item",style:{display:"flex","align-items":"center"}},qn={class:"form-item"},Sn={class:"form-item-label"},Cn={class:"form-item-body"},Ln={class:"number-box"},In={class:"number-slider-box"},Un={class:"number-input-box"},Rn={class:"form-item"},En={class:"form-item-label"},On={class:"form-item-body"},An={class:"number-box"},jn={class:"number-slider-box"},Mn={class:"number-input-box"},Vn={class:"form-item"},zn={class:"form-item-label"},Dn={class:"form-item-body"},Nn={class:"number-box"},Pn={class:"number-slider-box"},Bn={class:"number-input-box"},Tn={class:"form-item justify-between"},Fn={class:"form-item-label"},Jn={class:"form-item justify-between"},Qn={class:"form-item-label"},Gn={__name:"model-settings",setup(D){const m=["azure","ollama","xinference","openaiAgent","doubao"],w=["doubao"],_=["azure"],d=T({sm:24,md:24,lg:12,xl:24,xxl:24}),s=q([]),n=q(!1),{robotInfo:b,updateRobotInfo:h}=H("robotInfo"),a=T({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0}),x=q(""),r=q(""),c=q(""),o=S=>{a.use_model=m.includes(S.rawData.model_define)&&S.rawData.deployment_name?S.rawData.show_model_name||S.rawData.deployment_name:S.rawData.name,a.use_model_icon=S.icon,a.use_model_name=S.use_model_name,a.model_config_id=S.rawData.id,x.value=S.rawData.model_define,a.use_model&&a.use_model.toLowerCase().includes("deepseek-r1")?a.prompt_role_type="1":a.prompt_role_type="0"},u=q({}),y=(S,v)=>{u.value=v},L=oe(()=>{if(!a.model_config_id)return!1;let S=a.model_config_id+"#"+a.use_model;return u.value[S]}),k=q(!1),R=S=>{S.target.closest(".custom-select")||(k.value=!1)};ke(()=>{m.indexOf(x.value)>-1?a.use_model=c.value:a.use_model=b.use_model,document.addEventListener("click",R)}),_t(()=>{document.removeEventListener("click",R)});const O=()=>{c.value=a.use_model;let S={...Z(a)};_.indexOf(x.value)>-1&&(S.use_model="默认"),h(S),n.value=!1},f=S=>{m.indexOf(x.value)>-1?a.use_model=c.value:a.use_model=b.use_model,a.model_config_id=b.model_config_id,a.temperature=b.temperature,a.max_token=b.max_token,a.context_pair=b.context_pair,a.think_switch=Number(b.think_switch),a.prompt_role_type=b.prompt_role_type,a.enable_thinking=b.enable_thinking,n.value=S};qe(()=>{a.model_config_id=b.model_config_id,a.temperature=b.temperature,a.max_token=b.max_token,a.context_pair=b.context_pair,a.think_switch=Number(b.think_switch),a.prompt_role_type=b.prompt_role_type,a.enable_thinking=b.enable_thinking});function A(S,v,Q){const M=new Set(S.map(z=>z.model_define));return v.filter(z=>{let I=z[Q];M.has(I)&&S.filter(J=>{if(J.model_define==I)return J.children=kt(J.children,z.children),!1})}),S}return(()=>{st({model_type:"LLM"}).then(S=>{c.value=b.use_model;let v=S.data||[],Q=[];s.value=v.map(M=>{Q=[];for(let z=0;z<M.model_info.llm_model_list.length;z++){const I=M.model_info.llm_model_list[z];m.indexOf(M.model_info.model_define)>-1&&b.model_config_id==M.model_config.id&&(c.value=M.model_config.show_model_name||M.model_config.deployment_name,x.value=M.model_info.model_define,r.value=M.model_info.model_define),Q.push({name:I,deployment_name:M.model_config.deployment_name,show_model_name:w.includes(M.model_info.model_define)?M.model_config.show_model_name:"",id:M.model_config.id,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,use_model_name:M.model_info.model_name})}return{id:M.model_config.id,name:M.model_info.model_name,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,children:Q,deployment_name:M.model_config.deployment_name}}),s.value=A(yt(s.value,"model_define"),s.value,"model_define"),b.use_model&&b.model_config_id&&s.value.some(M=>M.children.some(z=>{const I=m.includes(z.model_define)&&z.deployment_name?z.deployment_name:z.name;if(m.includes(z.model_define)&&z.deployment_name&&z.id===b.model_config_id)return a.use_model_icon=z.icon,a.use_model_name=z.use_model_name,a.use_model=z.show_model_name||z.deployment_name,!0;if(I===b.use_model&&z.id===b.model_config_id)return a.use_model_icon=z.icon,a.use_model_name=z.use_model_name,!0}))})})(),(S,v)=>{const Q=ie,M=Rt,z=ze,I=Ve,J=se,G=et,le=Se,be=ne,P=Ut,g=te;return i(),V(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:n.value,"onUpdate:isEdit":v[12]||(v[12]=N=>n.value=N)},{extra:l(()=>[e("div",cn,[t(Q,{onClick:v[0]||(v[0]=N=>f(!0)),size:"small"},{default:l(()=>v[13]||(v[13]=[C("修改")])),_:1,__:[13]})])]),default:l(()=>[e("div",un,[e("div",pn,[v[14]||(v[14]=C(" LLM模型： ")),a.use_model_icon&&a.use_model_name?(i(),p("span",mn,[e("img",{src:a.use_model_icon,class:"model-icon"},null,8,vn),C(U(a.use_model_name)+" "+U(a.use_model),1)])):(i(),p("span",fn,U(a.use_model),1))]),e("div",bn,[v[15]||(v[15]=C(" 温度： ")),e("span",null,U(a.temperature),1)]),e("div",hn,[v[16]||(v[16]=C(" 最大token： ")),e("span",null,U(a.max_token),1)]),e("div",yn,[v[17]||(v[17]=C(" 上下文数量： ")),e("span",null,U(a.context_pair),1)]),e("div",kn,[v[18]||(v[18]=C(" 显示推理过程： ")),e("span",null,U(a.think_switch==1?"开":"关"),1)])]),t(g,{open:n.value,"onUpdate:open":v[11]||(v[11]=N=>n.value=N),width:672,title:"模型设置",onOk:O},{default:l(()=>[e("div",gn,[t(P,{gutter:[32,24]},{default:l(()=>[t(M,me(ye(d)),{default:l(()=>[e("div",xn,[v[19]||(v[19]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",$n,[t(Wt,{modelValue:a.use_model,"onUpdate:modelValue":v[1]||(v[1]=N=>a.use_model=N),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:o,onLoaded:y},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(M,me(ye(d)),{default:l(()=>[e("div",wn,[v[22]||(v[22]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[t(I,{value:a.prompt_role_type,"onUpdate:value":v[2]||(v[2]=N=>a.prompt_role_type=N)},{default:l(()=>[t(z,{value:"0"},{default:l(()=>v[20]||(v[20]=[C("系统角色（System）")])),_:1,__:[20]}),t(z,{value:"1"},{default:l(()=>v[21]||(v[21]=[C("用户角色（User）")])),_:1,__:[21]})]),_:1},8,["value"])])])]),_:1},16),t(M,me(ye(d)),{default:l(()=>[e("div",qn,[e("div",Sn,[v[24]||(v[24]=e("span",null,"温度 ",-1)),t(J,null,{title:l(()=>v[23]||(v[23]=[C("温度越低，回答越严谨。温度越高，回答越发散。")])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",Cn,[e("div",Ln,[e("div",In,[t(G,{class:"custom-slider",value:a.temperature,"onUpdate:value":v[3]||(v[3]=N=>a.temperature=N),min:0,max:2,step:.1},null,8,["value"])]),e("div",Un,[t(le,{value:a.temperature,"onUpdate:value":v[4]||(v[4]=N=>a.temperature=N),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(M,me(ye(d)),{default:l(()=>[e("div",Rn,[e("div",En,[v[26]||(v[26]=e("span",null,"最大token ",-1)),t(J,null,{title:l(()=>v[25]||(v[25]=[C("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",On,[e("div",An,[e("div",jn,[t(G,{class:"custom-slider",value:a.max_token,"onUpdate:value":v[5]||(v[5]=N=>a.max_token=N),min:0,max:100*1024},null,8,["value"])]),e("div",Mn,[t(le,{value:a.max_token,"onUpdate:value":v[6]||(v[6]=N=>a.max_token=N),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(M,me(ye(d)),{default:l(()=>[e("div",Vn,[e("div",zn,[v[28]||(v[28]=e("span",null,"上下文数量 ",-1)),t(J,null,{title:l(()=>v[27]||(v[27]=[C("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",Dn,[e("div",Nn,[e("div",Pn,[t(G,{class:"custom-slider",value:a.context_pair,"onUpdate:value":v[7]||(v[7]=N=>a.context_pair=N),min:0,max:50},null,8,["value"])]),e("div",Bn,[t(le,{value:a.context_pair,"onUpdate:value":v[8]||(v[8]=N=>a.context_pair=N),min:0,max:50},null,8,["value"])])])])])]),_:1},16),L.value?(i(),V(M,me(Ge({key:0},d)),{default:l(()=>[e("div",Tn,[e("div",Fn,[v[30]||(v[30]=e("span",null,"深度思考 ",-1)),t(J,null,{title:l(()=>v[29]||(v[29]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.enable_thinking,"onUpdate:checked":v[9]||(v[9]=N=>a.enable_thinking=N),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):E("",!0),t(M,me(ye(d)),{default:l(()=>[e("div",Jn,[e("div",Qn,[v[32]||(v[32]=e("span",null,"显示推理过程 ",-1)),t(J,null,{title:l(()=>v[31]||(v[31]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),t(be,{checked:a.think_switch,"onUpdate:checked":v[10]||(v[10]=N=>a.think_switch=N),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Kn=F(Gn,[["__scopeId","data-v-6e25e8b5"]]),Wn={class:"recall-settings-box"},Hn={class:"form-box"},Zn={class:"form-item is-required"},Yn={class:"form-item-body"},Xn={class:"retrieval-mode-items"},ei=["onClick"],ti={class:"retrieval-mode-title"},oi={class:"title-text"},si={key:0,style:{width:"32px"},src:Zt,alt:""},ni={class:"retrieval-mode-desc"},ii={class:"form-item"},li={class:"form-item-label"},ai={class:"form-item-body"},ri={class:"number-box"},di={class:"number-slider-box"},_i={class:"number-input-box"},ci={key:0,class:"form-item"},ui={class:"form-item-label"},pi={class:"form-item-body"},mi={class:"number-box"},vi={class:"number-slider-box"},fi={class:"number-input-box"},bi={class:"form-item"},hi={class:"form-item-label"},yi={key:0,class:"form-item-body"},ki=["src"],gi={__name:"recall-settings-alert",emits:["change"],setup(D,{expose:m,emit:w}){const _=w,d=q([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=T({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),n=q(!1),b=L=>{y(),s.rerank_status=L.rerank_status||0,s.rerank_use_model=L.rerank_use_model||void 0,s.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",s.top_k=L.top_k,s.similarity=L.similarity,s.search_type=L.search_type,n.value=!0},h=(L,k)=>{if(!L||!k){s.rerank_model_config_id="";return}s.rerank_model_config_id=k.rerank_model_config_id},a=L=>{L==0&&(s.rerank_model_config_id="",s.rerank_use_model="")},x=L=>{s.search_type=L},r=()=>s.rerank_status==1&&!s.rerank_model_config_id,c=()=>{if(r())return Y.error("请选择Rerank模型");n.value=!1,o()},o=()=>{_("change",Z(s))},u=q([]),y=()=>{st({model_type:"RERANK"}).then(L=>{let k=L.data||[];u.value=k.map(R=>({id:R.model_config.id,name:R.model_info.model_name,icon:R.model_info.model_icon_url,children:R.model_info.rerank_model_list}))})};return m({open:b}),(L,k)=>{const R=pe,O=se,f=et,A=Se,K=ne,S=ge,v=Me,Q=Et,M=je,z=te;return i(),V(z,{width:"746px",open:n.value,"onUpdate:open":k[6]||(k[6]=I=>n.value=I),title:"召回设置",onOk:c},{default:l(()=>[e("div",Wn,[e("div",Hn,[e("div",Zn,[k[7]||(k[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",Yn,[e("div",Xn,[(i(!0),p(B,null,W(d.value,I=>(i(),p("div",{class:we(["retrieval-mode-item",{active:s.search_type==I.value}]),key:I.value,onClick:J=>x(I.value)},[s.search_type==I.value?(i(),V(R,{key:0,class:"check-arrow",name:"check-arrow-filled"})):E("",!0),e("div",ti,[t(R,{name:I.iconName,class:"title-icon"},null,8,["name"]),e("span",oi,U(I.title),1),I.isRecommendation?(i(),p("img",si)):E("",!0)]),e("div",ni,U(I.desc),1)],10,ei))),128))])])]),e("div",ii,[e("div",li,[k[9]||(k[9]=e("span",null,"Top K ",-1)),t(O,null,{title:l(()=>k[8]||(k[8]=[C("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",ai,[e("div",ri,[e("div",di,[t(f,{class:"custom-slider",value:s.top_k,"onUpdate:value":k[0]||(k[0]=I=>s.top_k=I),min:1,max:10},null,8,["value"])]),e("div",_i,[t(A,{value:s.top_k,"onUpdate:value":k[1]||(k[1]=I=>s.top_k=I),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(i(),p("div",ci,[e("div",ui,[k[11]||(k[11]=e("span",null,"相似度阈值 ",-1)),t(O,null,{title:l(()=>k[10]||(k[10]=[C("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:l(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",pi,[e("div",mi,[e("div",vi,[t(f,{class:"custom-slider",value:s.similarity,"onUpdate:value":k[2]||(k[2]=I=>s.similarity=I),min:0,max:1,step:.01},null,8,["value"])]),e("div",fi,[t(A,{value:s.similarity,"onUpdate:value":k[3]||(k[3]=I=>s.similarity=I),min:0,max:1,step:.01},null,8,["value"])])])])])):E("",!0),e("div",bi,[e("div",hi,[k[12]||(k[12]=e("span",null,"Rerank模型",-1)),k[13]||(k[13]=C("   ")),t(K,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":k[4]||(k[4]=I=>s.rerank_status=I),onChange:a},null,8,["checked"])]),s.rerank_status==1?(i(),p("div",yi,[t(M,{allowClear:"",value:s.rerank_use_model,"onUpdate:value":k[5]||(k[5]=I=>s.rerank_use_model=I),placeholder:"请选择Rerank模型",onChange:h,style:{width:"60%"}},{default:l(()=>[(i(!0),p(B,null,W(u.value,I=>(i(),V(Q,{key:I.id},{label:l(()=>[t(S,{align:"center",gap:8},{default:l(()=>[e("img",{class:"model-icon",src:I.icon,alt:""},null,8,ki),C(U(I.name),1)]),_:2},1024)]),default:l(()=>[(i(!0),p(B,null,W(I.children,J=>(i(),V(v,{value:J,rerank_model_config_id:I.id,key:J},{default:l(()=>[e("span",null,U(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):E("",!0)])])])]),_:1},8,["open"])}}},xi=F(gi,[["__scopeId","data-v-00131927"]]),$i={class:"list-box"},wi=["onClick"],qi={class:"avater-box"},Si=["src"],Ci={class:"content-box"},Li={class:"title-block"},Ii={class:"title-text"},Ui={class:"desc-box"},Ri={class:"right-icon"},Ei={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(D,{expose:m,emit:w}){const _=w,d=D,s=q(!1);_e(()=>d.list,()=>{d.list.length==0&&(s.value=!1)},{});const n=()=>{s.value=!0},b=()=>{document.visibilityState==="visible"&&_("refreshList")};ke(()=>{document.addEventListener("visibilitychange",b)}),ct(()=>{document.removeEventListener("visibilitychange",b)});const h=a=>{window.open(`/#/library/details/knowledge-config?id=${a.id}`)};return m({show:n}),(a,x)=>{const r=Ot,c=nt,o=te;return i(),p("div",null,[t(o,{open:s.value,"onUpdate:open":x[0]||(x[0]=u=>s.value=u),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:l(()=>[t(r,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(c,{scrollbar:!1,style:{height:"400px"}},{default:l(()=>[e("div",$i,[(i(!0),p(B,null,W(d.list,u=>(i(),p("div",{class:"list-item",onClick:y=>h(u),key:u.id},[e("div",qi,[e("img",{src:u.avatar,alt:""},null,8,Si)]),e("div",Ci,[e("div",Li,[x[1]||(x[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ii,U(u.library_name),1)]),e("div",Ui,U(u.library_intro),1)]),e("div",Ri,[t($(At))])],8,wi))),128))])]),_:1})]),_:1},8,["open"])])}}},Oi=F(Ei,[["__scopeId","data-v-a87bd0fa"]]),Ai={class:"actions-box"},ji={key:0,class:"library-list"},Mi=["onClick"],Vi=["onClick"],zi={class:"library-name"},Di={class:"library-name-text"},Ni={class:"library-intro"},Pi={class:"setting-info-block"},Bi={class:"set-item"},Ti={key:0},Fi={key:1},Ji={key:2},Qi={key:3},Gi={class:"set-item"},Ki={key:0,class:"set-item"},Wi={class:"set-item"},Hi={key:0},Zi={key:1},Yi={__name:"index",setup(D){const m=gt(),w=oe(()=>{var S;return((S=m.companyInfo)==null?void 0:S.neo4j_status)=="true"}),_=q(!1),{robotInfo:d,updateRobotInfo:s}=H("robotInfo"),n=T({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),b=q([]),h=q(null),a=q(null),x=oe(()=>b.value.filter(S=>a.value?n.library_ids.includes(S.id):n.library_ids.includes(S.id)&&S.type!=3)),r=oe(()=>x.value.filter(S=>S.graph_switch==0)),c=S=>{let v=n.library_ids.indexOf(S.id);n.library_ids.splice(v,1),O()},o=S=>{n.library_ids=[...S],O()},u=()=>{h.value.open([...n.library_ids])},y=q(null),L=()=>{y.value.open(Z(n))},k=q(null),R=S=>{n.rerank_status=S.rerank_status,n.rerank_use_model=S.rerank_use_model,n.rerank_model_config_id=S.rerank_model_config_id,n.top_k=S.top_k,n.similarity=S.similarity,n.search_type=S.search_type,(S.search_type==1||S.search_type==4)&&r.value.length>0&&k.value.show(),O()},O=()=>{let S={...Z(n)};S.library_ids=S.library_ids.join(","),S.op_type_relation_library=1,s({...S})},f=async()=>{const S=await xt({type:"",show_open_docs:1});S&&(b.value=S.data||[])},A=()=>{Yt({ability_type:"library_ability_official_account"}).then(S=>{var Q;let v=(S==null?void 0:S.data)||{};((Q=v==null?void 0:v.user_config)==null?void 0:Q.switch_status)==1&&(a.value=v)})};n.rerank_use_model=d.rerank_use_model||void 0,qe(()=>{n.library_ids=d.library_ids.split(","),n.rerank_status=d.rerank_status||0,n.rerank_use_model=d.rerank_use_model||void 0,n.rerank_model_config_id=d.rerank_model_config_id||"",n.top_k=d.top_k,n.similarity=d.similarity,n.search_type=d.search_type});const K=S=>{window.open(`#/library/details/knowledge-document?id=${S.id}`)};return ke(()=>{A(),f()}),(S,v)=>{const Q=ie,M=ge,z=se;return i(),V(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:_.value,"onUpdate:isEdit":v[0]||(v[0]=I=>_.value=I),bodyStyle:{padding:0}},{extra:l(()=>[e("div",Ai,[t(M,{gap:8},{default:l(()=>[t(Q,{size:"small",onClick:L},{default:l(()=>v[1]||(v[1]=[C("召回设置")])),_:1,__:[1]}),t(Q,{size:"small",onClick:u},{default:l(()=>v[2]||(v[2]=[C("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[x.value.length>0?(i(),p("div",ji,[(i(!0),p(B,null,W(x.value,I=>(i(),p("div",{class:"library-item",key:I.id,onClick:J=>K(I)},[I.id!=$(d).default_library_id?(i(),p("span",{key:0,class:"close-btn",onClick:ut(J=>c(I),["stop"])},[t($(fe))],8,Vi)):E("",!0),e("div",zi,[w.value?(i(),V(z,{key:0},{title:l(()=>[C(U(I.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:l(()=>[e("div",{class:we(["graph-tag",{active:I.graph_switch==1}])},"Graph",2)]),_:2},1024)):E("",!0),e("div",Di,U(I.library_name),1)]),e("div",Ni,U(I.library_intro),1)],8,Mi))),128))])):E("",!0),e("div",Pi,[e("div",Bi,[v[3]||(v[3]=C(" 检索模式： ")),n.search_type==1?(i(),p("span",Ti,"混合检索")):E("",!0),n.search_type==2?(i(),p("span",Fi,"向量检索")):E("",!0),n.search_type==3?(i(),p("span",Ji,"全文检索")):E("",!0),n.search_type==4?(i(),p("span",Qi,"知识图谱检索")):E("",!0)]),e("div",Gi,[v[4]||(v[4]=C(" Top K： ")),e("span",null,U(n.top_k),1)]),n.search_type<=2?(i(),p("div",Ki,[v[5]||(v[5]=C(" 相似度阈值： ")),e("span",null,U(n.similarity),1)])):E("",!0),e("div",Wi,[v[6]||(v[6]=C(" Rerank模型： ")),n.rerank_status==0?(i(),p("span",Hi,"关")):(i(),p("span",Zi,U(n.rerank_use_model),1))])]),t(Ht,{ref_key:"librarySelectAlertRef",ref:h,onChange:o,showWxType:!!a.value},null,8,["showWxType"]),t(xi,{ref_key:"recallSettingsAlertRef",ref:y,onChange:R},null,512),t(Oi,{list:r.value,onRefreshList:f,ref_key:"noOpenGraphModalRef",ref:k},null,8,["list"])]),_:1},8,["isEdit"])}}},Xi=F(Yi,[["__scopeId","data-v-9376b990"]]),el={class:"library-checkbox-box"},tl={class:"list-box",ref:"scrollContainer"},ol={class:"library-name"},sl={class:"library-desc"},nl={key:0,class:"empty-box"},il={__name:"library-select-alert",emits:["change"],setup(D,{expose:m,emit:w}){const _=w,d=T({indeterminate:!1,checkAll:!1,checkedList:[]}),s=q(!1),n=o=>{x(),d.checkedList=o,s.value=!0},b=()=>{s.value=!1,a()};q("");const h=q([]),a=()=>{_("change",[...d.checkedList])},x=async()=>{const o=await it();if(o){let u=o.data||[];h.value=u}},r=q(!1),c=()=>{window.open("/#/database/list")};return m({open:n}),(o,u)=>{const y=Mt,L=jt,k=We,R=te;return i(),V(R,{width:"746px",open:s.value,"onUpdate:open":u[1]||(u[1]=O=>s.value=O),title:"关联数据表",onOk:b},{default:l(()=>[e("div",el,[t(k,{spinning:r.value,delay:100},{default:l(()=>[t(L,{value:d.checkedList,"onUpdate:value":u[0]||(u[0]=O=>d.checkedList=O),style:{width:"100%"}},{default:l(()=>[e("div",tl,[(i(!0),p(B,null,W(h.value,O=>(i(),p("div",{class:"list-item-wraapper",key:O.id},[t(y,{class:"list-item",value:O.id},{default:l(()=>[e("div",ol,U(O.name),1),e("div",sl,U(O.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!r.value&&!h.value.length?(i(),p("div",nl,[u[3]||(u[3]=e("img",{src:Xt,alt:""},null,-1)),e("div",null,[u[2]||(u[2]=C(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:c}," 去添加")])])):E("",!0)])]),_:1},8,["open"])}}},ll=F(il,[["__scopeId","data-v-b559dd08"]]),al={class:"actions-box"},rl={key:0,class:"library-list"},dl=["onClick"],_l={class:"library-name"},cl={class:"library-intro"},ul={__name:"index",setup(D){const m=q(!1),{robotInfo:w,updateRobotInfo:_}=H("robotInfo"),d=T({form_ids:[]}),s=q([]),n=q(null),b=oe(()=>s.value.filter(o=>d.form_ids.includes(o.id))),h=o=>{let u=d.form_ids.indexOf(o.id);d.form_ids.splice(u,1),r()},a=o=>{d.form_ids=[...o],r()},x=()=>{n.value.open([...d.form_ids])},r=()=>{let o={...Z(d)};o.form_ids=o.form_ids.join(","),_({...o})};return(async()=>{const o=await it();o&&(s.value=o.data||[])})(),qe(()=>{d.form_ids=w.form_ids.split(",")}),(o,u)=>{const y=se,L=ie,k=ge;return i(),V(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:m.value,"onUpdate:isEdit":u[0]||(u[0]=R=>m.value=R),bodyStyle:{padding:0}},{tip:l(()=>[t(y,{placement:"top"},{title:l(()=>u[1]||(u[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:l(()=>[t($(ee))]),_:1})]),extra:l(()=>[e("div",al,[t(k,{gap:8},{default:l(()=>[t(L,{size:"small",onClick:x},{default:l(()=>u[2]||(u[2]=[C("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[b.value.length>0?(i(),p("div",rl,[(i(!0),p(B,null,W(b.value,R=>(i(),p("div",{class:"library-item",key:R.id},[e("span",{class:"close-btn",onClick:O=>h(R)},[t($(fe))],8,dl),e("div",_l,U(R.name),1),e("div",cl,U(R.description),1)]))),128))])):E("",!0),t(ll,{ref_key:"librarySelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},pl=F(ul,[["__scopeId","data-v-c40914ca"]]),ml={class:"form-box"},vl={class:"question-title"},fl={class:"question-options"},bl={class:"question-option"},hl={class:"drag-btn"},yl={class:"action-box"},kl={class:"robot-info-box"},gl={class:"robot-welcome-content"},xl={class:"robot-welcome-question"},$l={__name:"welcome-words",setup(D){const m=q(!1),w=q(!1),{robotInfo:_,updateRobotInfo:d,scrollBoxToBottom:s}=H("robotInfo"),n=T({welcomes:{content:"",question:[]}}),b=()=>{let c=!1;if(n.welcomes.question.length>0){for(let o=0;o<n.welcomes.question.length;o++)if(!n.welcomes.question[o].content){c=o+1;break}}return c},h=()=>{n.welcomes.question.push({content:"",id:Ue(8)})},a=c=>{n.welcomes.question.splice(c,1)},x=()=>{if(!n.welcomes.content)return Y.error("请输入欢迎语");if(b())return Y.error("引导问题内容不能为空");d({...Z(n)}),m.value=!1},r=()=>{let c={..._.welcomes},o=[];c.question.forEach(({content:u,id:y})=>{let L={id:y,content:u};L.id||(L.id=Ue(6)),o.push(L)}),n.welcomes.content=c.content,n.welcomes.question=o};return(c,o)=>{const u=$e,y=pe,L=xe;return i(),V(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:m.value,"onUpdate:isEdit":o[4]||(o[4]=k=>m.value=k),onSave:x,onEdit:r},{default:l(()=>[ce(e("div",ml,[e("div",vl,[t(u,{value:n.welcomes.content,"onUpdate:value":o[0]||(o[0]=k=>n.welcomes.content=k),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",fl,[t($(De),{modelValue:n.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=k=>n.welcomes.question=k),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=k=>w.value=!0),onEnd:o[3]||(o[3]=k=>w.value=!1)},{item:l(({element:k,index:R})=>[e("div",bl,[e("span",hl,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:k.content,"onUpdate:value":O=>k.content=O,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",yl,[t($(fe),{class:"del-btn",onClick:O=>a(R)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:h},[t($(Re),{class:"add-btn-icon"}),o[5]||(o[5]=C("添加引导问题 "))])])],512),[[ue,m.value]]),ce(e("div",kl,[e("div",gl,U($(_).welcomes.content),1),e("div",xl,[(i(!0),p(B,null,W($(_).welcomes.question,(k,R)=>(i(),p("div",{class:"question-item",key:R},U(k.content),1))),128))])],512),[[ue,!m.value]])]),_:1},8,["isEdit"])}}},wl=F($l,[["__scopeId","data-v-ea227a87"]]),ql={class:"form-box"},Sl={class:"question-title"},Cl={class:"question-options"},Ll={class:"question-option"},Il={class:"drag-btn"},Ul={class:"action-box"},Rl={class:"robot-info-box"},El={class:"robot-unknown-content"},Ol={class:"robot-unknown-question"},Al={__name:"unknown-problem-prompt",setup(D){const m=q(!1),w=q(!1),{robotInfo:_,updateRobotInfo:d,scrollBoxToBottom:s}=H("robotInfo"),n=T({unknown_question_prompt:{content:"",question:[]}}),b=()=>{n.unknown_question_prompt.question.push({content:"",id:Ue(8)}),Ke(()=>{s()})},h=r=>{n.unknown_question_prompt.question.splice(r,1)},a=()=>{d({...Z(n)}),m.value=!1},x=()=>{let r={..._.unknown_question_prompt},c=[];r.question&&r.question.forEach(({content:o,id:u})=>{let y={id:u,content:o};y.id||(y.id=Ue(6)),c.push(y)}),r.content&&(n.unknown_question_prompt.content=r.content),c&&(n.unknown_question_prompt.question=c)};return ke(()=>{}),(r,c)=>{const o=se,u=$e,y=pe,L=xe;return i(),V(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:m.value,"onUpdate:isEdit":c[4]||(c[4]=k=>m.value=k),onSave:a,onEdit:x},{tip:l(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>c[5]||(c[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:l(()=>[t($(ee))]),_:1})]),default:l(()=>[ce(e("div",ql,[e("div",Sl,[t(u,{value:n.unknown_question_prompt.content,"onUpdate:value":c[0]||(c[0]=k=>n.unknown_question_prompt.content=k),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Cl,[t($(De),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":c[1]||(c[1]=k=>n.unknown_question_prompt.question=k),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=k=>w.value=!0),onEnd:c[3]||(c[3]=k=>w.value=!1)},{item:l(({element:k,index:R})=>[e("div",Ll,[e("span",Il,[t(y,{name:"drag"})]),t(L,{class:"question-option-content",value:k.content,"onUpdate:value":O=>k.content=O,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ul,[t($(fe),{class:"del-btn",onClick:O=>h(R)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:b},[t($(Re),{class:"add-btn-icon"}),c[6]||(c[6]=C("添加引导问题 "))])])],512),[[ue,m.value]]),ce(e("div",Rl,[e("div",El,U($(_).unknown_question_prompt.content),1),e("div",Ol,[(i(!0),p(B,null,W($(_).unknown_question_prompt.question,(k,R)=>(i(),p("div",{class:"question-item",key:R},U(k.content),1))),128))])],512),[[ue,!m.value]])]),_:1},8,["isEdit"])}}},jl=F(Al,[["__scopeId","data-v-bc797bf6"]]),Ml={class:"robot-info-box"},Vl={class:"modal-box",ref:"modalBoxRef"},zl={class:"modal-item-box"},Dl={class:"modal-item"},Nl={class:"modal-item"},Pl={__name:"problem-optimization",setup(D){const m=q(!1);q(!1);const{robotInfo:w,updateRobotInfo:_}=H("robotInfo"),d=q("0"),s=T({optimize_question_use_model:"",optimize_question_model_config_id:""});ke(()=>{d.value=w.optimize_question_model_config_id!=0?"1":"0",s.optimize_question_use_model=w.optimize_question_use_model,s.optimize_question_model_config_id=w.optimize_question_model_config_id});const n=q([]),b=c=>{n.value=c,Ke(()=>{(!s.optimize_question_use_model||!Number(s.optimize_question_model_config_id))&&h()})},h=()=>{if(n.value.length>0){let c=null,o=null;for(let u of n.value)if(u.model_define==="tongyi"){c=u;for(let y of c.children)if(y.name==="qwen-max"){o=y;break}break}c||(c=n.value[0],o=c.children[0]),c&&o&&(s.optimize_question_use_model=o.name,s.optimize_question_model_config_id=o.model_config_id)}},a=()=>{m.value=!1,_({...Z(s)})},x=c=>{c!=1&&(s.optimize_question_use_model="",s.optimize_question_model_config_id=0)},r=c=>{_({})};return(c,o)=>{const u=se,y=ne,L=ze,k=Ve,R=$e,O=te;return i(),V(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:l(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:l(()=>[e("div",Ml,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(u,null,{title:l(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:l(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=f=>m.value=!0)}," 对话背景设置 ")]),_:1})]),t(y,{onChange:r,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(w).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=f=>$(w).enable_question_optimize=f),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Vl,[t(O,{getContainer:()=>c.$refs.modalBoxRef,open:m.value,"onUpdate:open":o[6]||(o[6]=f=>m.value=f),width:472,title:"用户问题建议设置",onOk:a},{default:l(()=>[e("div",zl,[e("div",Dl,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(k,{value:d.value,"onUpdate:value":o[2]||(o[2]=f=>d.value=f),onChange:x},{default:l(()=>[t(L,{value:"0"},{default:l(()=>o[10]||(o[10]=[C("跟随机器人")])),_:1,__:[10]}),t(L,{value:"1"},{default:l(()=>o[11]||(o[11]=[C("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),d.value=="1"?(i(),V(eo,{key:0,modelType:"LLM",modeName:s.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=f=>s.optimize_question_use_model=f),modeId:s.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=f=>s.optimize_question_model_config_id=f),style:{width:"100%","margin-top":"8px"},onLoaded:b},null,8,["modeName","modeId"])):E("",!0)]),e("div",Nl,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(R,{style:{height:"120px"},value:$(w).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=f=>$(w).optimize_question_dialogue_background=f),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Bl=F(Pl,[["__scopeId","data-v-a42248ec"]]),Tl={class:"robot-info-box"},Fl={class:"robot-prompt"},Jl={__name:"suggested-issues",setup(D){q(!1);const{robotInfo:m,updateRobotInfo:w}=H("robotInfo"),_=d=>{w({})};return(d,s)=>{const n=Se,b=ne;return i(),V(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:l(()=>s[2]||(s[2]=[e("span",null,null,-1)])),default:l(()=>[e("div",Tl,[e("div",Fl,[s[3]||(s[3]=C(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(n,{value:$(m).question_guide_num,"onUpdate:value":s[0]||(s[0]=h=>$(m).question_guide_num=h),style:{width:"80px"},precision:0,min:1,max:10,onBlur:_},null,8,["value"]),s[4]||(s[4]=C(" 条用户提问建议，最大不超过10条。 "))])]),t(b,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(m).enable_question_guide,"onUpdate:checked":s[1]||(s[1]=h=>$(m).enable_question_guide=h),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ql=F(Jl,[["__scopeId","data-v-f6a291d4"]]),Gl={__name:"sensitive-words",setup(D){q(!1);const{robotInfo:m,updateRobotInfo:w}=H("robotInfo");T({prompt:""});const _=()=>{window.open("/#/user/sensitive-words")},d=s=>{w({})};return(s,n)=>{const b=ne;return i(),V(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:l(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:l(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[n[2]||(n[2]=C(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:_,style:{cursor:"pointer"}},"设置敏词 >")])]),t(b,{onChange:d,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(m).sensitive_words_switch,"onUpdate:checked":n[0]||(n[0]=h=>$(m).sensitive_words_switch=h),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Kl=F(Gl,[["__scopeId","data-v-56c388e6"]]),Wl={class:"direct-title"},Hl={class:"direct-desc"},Zl={class:"qa"},Yl={class:"prompt-form-item-label"},Xl={class:"direct-switch"},ea={class:"similarity"},ta={class:"number-input-box"},oa={__name:"chat-edit-alert",emits:["save"],setup(D,{expose:m,emit:w}){const _=w,d=q(1),s=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=T(s()),b=q(!1),h=T({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),a=()=>{h.chat_type=d.value.toString(),n.forEach(c=>{c.chat_type==d.value&&(h.chat_type=="3"?(h.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch==1?"true":"false",h.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score.toString()):h.chat_type=="1"&&(h.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch==1?"true":"false",h.library_qa_direct_reply_score=c.library_qa_direct_reply_score.toString()))}),x(),Object.assign(n,s()),b.value=!1},x=()=>{_("save",Z(h))};ke(()=>{});const r=c=>{d.value=parseInt(c.chat_type),h.chat_type=c.chat_type,h.library_qa_direct_reply_score=c.library_qa_direct_reply_score,h.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch,h.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,h.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch,n.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=c.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch=="true"?1:0)}),b.value=!0};return _e(()=>b.value,c=>{c===!1&&Object.assign(n,s())},{immediate:!0}),m({open:r}),(c,o)=>{const u=se,y=ne,L=Se,k=ze,R=Ve,O=te;return i(),V(O,{width:"746px",open:b.value,"onUpdate:open":o[1]||(o[1]=f=>b.value=f),title:"聊天模式设置",onOk:a},{default:l(()=>[t(R,{class:"direct-box",value:d.value,"onUpdate:value":o[0]||(o[0]=f=>d.value=f)},{default:l(()=>[(i(!0),p(B,null,W(n,f=>(i(),V(k,{class:we(["direct-item",{active:d.value==f.direct_id}]),value:f.direct_id,key:f.direct_id},{default:l(()=>[e("div",Wl,U(f.direct_title),1),e("div",Hl,U(f.direct_desc),1),ce(e("div",Zl,[e("div",Yl,[o[4]||(o[4]=e("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),t(u,null,pt({default:l(()=>[t($(ee),{class:"question-icon"})]),_:2},[f.chat_type=="1"?{name:"title",fn:l(()=>[o[2]||(o[2]=C("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:f.chat_type=="3"?{name:"title",fn:l(()=>[o[3]||(o[3]=C("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",Xl,[f.chat_type=="1"?(i(),V(y,{key:0,checkedValue:1,unCheckedValue:0,checked:f.library_qa_direct_reply_switch,"onUpdate:checked":A=>f.library_qa_direct_reply_switch=A},null,8,["checked","onUpdate:checked"])):f.chat_type=="3"?(i(),V(y,{key:1,checkedValue:1,unCheckedValue:0,checked:f.mixture_qa_direct_reply_switch,"onUpdate:checked":A=>f.mixture_qa_direct_reply_switch=A},null,8,["checked","onUpdate:checked"])):E("",!0)])])],512),[[ue,f.isQaDirectReply&&d.value==f.direct_id]]),ce(e("div",ea,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",ta,[f.chat_type=="1"?(i(),V(L,{key:0,value:f.library_qa_direct_reply_score,"onUpdate:value":A=>f.library_qa_direct_reply_score=A,disabled:!f.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):f.chat_type=="3"?(i(),V(L,{key:1,value:f.mixture_qa_direct_reply_score,"onUpdate:value":A=>f.mixture_qa_direct_reply_score=A,disabled:!f.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):E("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[ue,f.isQaDirectReply&&d.value==f.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},sa=F(oa,[["__scopeId","data-v-ba2922ca"]]),na={class:"actions-box"},ia={class:"setting-info-block"},la={class:"set-item"},aa={key:0},ra={key:1},da={key:2},_a={class:"set-item"},ca={key:0,class:"set-item"},ua={class:"set-item"},pa={key:0,class:"set-item"},ma={class:"form-box"},va={__name:"index",setup(D){const m=q(!1),w=q(null),{robotInfo:_,updateRobotInfo:d}=H("robotInfo"),s=T({chat_type:_.chat_type,library_qa_direct_reply_score:_.library_qa_direct_reply_score,library_qa_direct_reply_switch:_.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:_.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:_.mixture_qa_direct_reply_switch}),n=a=>{s.chat_type=a.chat_type,s.library_qa_direct_reply_score=a.library_qa_direct_reply_score,s.library_qa_direct_reply_switch=a.library_qa_direct_reply_switch,s.mixture_qa_direct_reply_score=a.mixture_qa_direct_reply_score,s.mixture_qa_direct_reply_switch=a.mixture_qa_direct_reply_switch,b()},b=()=>{d({...Z(s)}),m.value=!1},h=()=>{w.value.open(Z(s)),m.value=!0};return(a,x)=>{const r=se,c=ie;return i(),V(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:m.value,"onUpdate:isEdit":x[1]||(x[1]=o=>m.value=o),bodyStyle:{padding:0}},{tip:l(()=>[t(r,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>x[2]||(x[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:l(()=>[t($(ee))]),_:1})]),extra:l(()=>[e("div",na,[t(c,{size:"small",onClick:x[0]||(x[0]=o=>h(!0))},{default:l(()=>x[3]||(x[3]=[C("修改")])),_:1,__:[3]})])]),default:l(()=>[e("div",ia,[e("div",la,[x[4]||(x[4]=C(" 聊天模式： ")),$(_).chat_type=="1"?(i(),p("span",aa,"仅知识库")):E("",!0),$(_).chat_type=="2"?(i(),p("span",ra,"直连模式")):E("",!0),$(_).chat_type=="3"?(i(),p("span",da,"混合模式")):E("",!0)]),$(_).chat_type=="1"?(i(),p(B,{key:0},[e("div",_a,[x[5]||(x[5]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U($(_).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(_).library_qa_direct_reply_switch=="true"?(i(),p("div",ca,[x[6]||(x[6]=C(" 相似度阈值： ")),e("span",null,U($(_).library_qa_direct_reply_score),1)])):E("",!0)],64)):E("",!0),$(_).chat_type=="3"?(i(),p(B,{key:1},[e("div",ua,[x[7]||(x[7]=C(" 命中问答知识时直接回复答案： ")),e("span",null,U($(_).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(_).mixture_qa_direct_reply_switch=="true"?(i(),p("div",pa,[x[8]||(x[8]=C(" 相似度阈值： ")),e("span",null,U($(_).mixture_qa_direct_reply_score),1)])):E("",!0)],64)):E("",!0)]),e("div",ma,[t(sa,{ref_key:"ChatEditAlertRef",ref:w,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},fa=F(va,[["__scopeId","data-v-eafe1264"]]),ba={class:"switch-box"},ha={class:"switch-box-body"},ya={class:"switch-box-header"},ka={class:"left-box"},ga={class:"switch-box-title"},xa={key:0,class:"title-tip"},$a={class:"right-box"},wa={class:"extra-box"},qa={class:"switch-desc"},Sa={class:"switch-box-right"},Ca={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(D,{emit:m}){const w=m,_=D,d=q(_.value),s=n=>{w("update:value",n),w("change",n)};return(n,b)=>{const h=pe,a=ne;return i(),p("div",ba,[e("div",ha,[e("div",ya,[e("div",ka,[t(h,{class:"switch-box-icon",name:_.iconName},null,8,["name"]),e("span",ga,U(_.title),1),n.$slots.tip?(i(),p("span",xa,[ve(n.$slots,"tip",{},void 0,!0)])):E("",!0)]),e("div",$a,[e("div",wa,[ve(n.$slots,"extra",{},()=>[b[1]||(b[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",qa,[ve(n.$slots,"default",{},void 0,!0)])]),e("div",Sa,[t(a,{checked:d.value,"onUpdate:checked":b[0]||(b[0]=x=>d.value=x),onChange:s,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},La=F(Ca,[["__scopeId","data-v-8d185d5f"]]),Ia="/assets/img/phone-head-CDwwPhYa.png",Ua="/assets/img/phone-body-CbEf8GZP.png",Ra="/assets/img/phone-footer-ClQtNpln.png",Ea={class:"common-problem-box"},Oa={class:"left-content-box"},Aa={key:0,class:"empty-box"},ja={key:1,class:"lists-box"},Ma={class:"drag-btn"},Va={class:"title"},za={class:"opration-box"},Da={class:"preview-box"},Na={class:"phone-body"},Pa={key:0,class:"question-box"},Ba={__name:"common-problem",setup(D){q(!1);const{robotInfo:m,updateRobotInfo:w}=H("robotInfo"),_=oe(()=>m.common_question_list?JSON.parse(m.common_question_list):[]),d=q([]);d.value=_.value,_e(_,()=>{d.value=_.value});const s=Oe.useForm,n=q(!1),b=q("添加问题"),h=T({question:"",index:-1}),a=T({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:x,validate:r,validateInfos:c}=s(h,a),o=()=>{if(_.value.length>=10)return Y.error("最多设置10条常用问题");n.value=!0,x(),h.question="",h.index=-1},u=(O,f)=>{n.value=!0,x(),h.question=O,h.index=f},y=O=>{let f=[];f=_.value.filter((A,K)=>O!=K),te.confirm({title:"提醒",icon:t(Ae),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){w({common_question_list:JSON.stringify(f)})},onCancel(){}})},L=()=>{r().then(()=>{let O=[];h.index>=0?O=_.value.map((f,A)=>A===h.index?h.question:f):O=[h.question,..._.value],w({common_question_list:JSON.stringify(O)}),n.value=!1})},k=O=>{w({})},R=O=>{w({common_question_list:JSON.stringify(d.value)})};return(O,f)=>{const A=se,K=ne,S=Vt,v=ie,Q=pe,M=xe,z=He,I=Oe,J=te;return i(),p("div",Ea,[e("div",Oa,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:l(()=>[t(A,null,{title:l(()=>f[4]||(f[4]=[C("最多10条。开启后，常见问题会显示在每条问答后面")])),default:l(()=>[t($(ee),{class:"quess-icon"})]),_:1})]),extra:l(()=>[t(K,{onChange:k,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(m).enable_common_question,"onUpdate:checked":f[0]||(f[0]=G=>$(m).enable_common_question=G),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(S,{type:"vertical"}),t(v,{type:"primary",size:"small",onClick:o},{default:l(()=>f[5]||(f[5]=[C("添加")])),_:1,__:[5]})]),default:l(()=>[_.value.length==0?(i(),p("div",Aa,[f[7]||(f[7]=e("img",{src:to,alt:""},null,-1)),f[8]||(f[8]=e("div",{class:"title"},"暂无数据",-1)),f[9]||(f[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(v,{onClick:o,type:"primary"},{default:l(()=>f[6]||(f[6]=[C("立即添加")])),_:1,__:[6]})])):(i(),p("div",ja,[t($(De),{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=G=>d.value=G),handle:".drag-btn","item-key":"index",onEnd:R},{item:l(({element:G,index:le})=>[(i(),p("div",{class:"list-item",key:le},[e("span",Ma,[t(Q,{name:"drag"})]),e("div",Va,U(G),1),e("div",za,[t($(tt),{onClick:be=>u(G,le)},null,8,["onClick"]),t($(fe),{onClick:be=>y(le)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Da,[f[12]||(f[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ia,alt:""})],-1)),e("div",Na,[f[11]||(f[11]=e("div",null,[e("img",{class:"body-img",src:Ua,alt:""})],-1)),_.value.length&&$(m).enable_common_question=="true"?(i(),p("div",Pa,[f[10]||(f[10]=e("div",{class:"name"},"常见问题",-1)),(i(!0),p(B,null,W(_.value,G=>(i(),p("div",{class:"list-item",key:G},U(G),1))),128))])):E("",!0)]),f[13]||(f[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Ra,alt:""})],-1))]),t(J,{open:n.value,"onUpdate:open":f[3]||(f[3]=G=>n.value=G),title:b.value,onOk:L,width:"476px"},{default:l(()=>[t(I,{class:"form-box",layout:"vertical"},{default:l(()=>[t(z,Ge({label:"问题名称"},$(c).question),{default:l(()=>[t(M,{maxLength:100,value:h.question,"onUpdate:value":f[2]||(f[2]=G=>h.question=G),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ta=F(Ba,[["__scopeId","data-v-5125783f"]]),Fa={__name:"display-aitations",setup(D){const{robotInfo:m,updateRobotInfo:w}=H("robotInfo"),_=q(!1);_e(()=>m.answer_source_switch,s=>{_.value=s=="true"},{immediate:!0});const d=()=>{w({answer_source_switch:_.value?"true":"false"})};return(s,n)=>(i(),V(La,{title:"显示引文","icon-name":"jibenpeizhi",value:_.value,"onUpdate:value":n[0]||(n[0]=b=>_.value=b),onChange:d},{extra:l(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:l(()=>[n[2]||(n[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Ja={__name:"show-like",setup(D){const{robotInfo:m,updateRobotInfo:w}=H("robotInfo"),_=d=>{w({})};return(d,s)=>{const n=ne;return i(),V(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:l(()=>s[1]||(s[1]=[e("span",null,null,-1)])),default:l(()=>[s[2]||(s[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(n,{onChange:_,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(m).feedback_switch,"onUpdate:checked":s[0]||(s[0]=b=>$(m).feedback_switch=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Qa=F(Ja,[["__scopeId","data-v-4948feb9"]]),Ga={class:"content-box"},Ka={key:0,class:"add-btn-block"},Wa={class:"list-content"},Ha={key:0,class:"user-block"},Za={class:"name-box"},Ya={class:"name"},Xa={class:"remark-text"},er={key:0,class:"hover-btn-box"},tr={key:0},or={key:1},sr={key:2},nr={key:1,class:"hover-btn-box"},ir={class:"role-menu-box"},lr=["onClick"],ar={class:"menu-header"},rr={key:0,class:"check-box"},dr=["onClick"],_r={class:"menu-header"},cr={key:0,class:"check-box"},ur=["onClick"],pr={class:"menu-header"},mr={key:0,class:"check-box"},vr={class:"hover-btn-box"},fr={key:0},br={key:1},hr={key:2},yr=["onClick"],kr={__name:"role-permission",setup(D){const m=$t(),w=oe(()=>m.user_name),_=Je().query,d=q(wt(_.id)),s=q([]),n=T({object_id:_.id,object_type:1}),b=()=>{oo({...n}).then(o=>{let u=o.data||[];s.value=u})};b();const h=q(null),a=()=>{h.value.show(s.value,[{object_id:+_.id,object_type:1,operate_rights:4}])},x=(o,u)=>{let y=u==4?"管理":u==2?"编辑":"查看";te.confirm({title:"提示?",icon:t(Ae),content:"确认修改该协作者权限为【"+y+"】",okText:"确认",cancelText:"取消",onOk:()=>{let L=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+u}];so({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(L)}).then(k=>{Y.success("修改成功"),b()})},onCancel(){}})},r=o=>{te.confirm({title:"提示?",icon:t(Ae),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{no({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(u=>{Y.success("删除成功"),b()})},onCancel(){}})},c=q([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,u)=>{const y=ie,L=zt,k=Dt,R=Pt,O=nt;return i(),V(O,null,{default:l(()=>[e("div",Ga,[d.value==4?(i(),p("div",Ka,[t(y,{type:"primary",onClick:a,icon:Qe($(Re))},{default:l(()=>u[0]||(u[0]=[C("添加协助者")])),_:1,__:[0]},8,["icon"])])):E("",!0),e("div",Wa,[t(R,{columns:c.value,"data-source":s.value,pagination:!1},{bodyCell:l(({column:f,record:A})=>[f.key==="name"?(i(),p("div",Ha,[t(L,{shape:"square",src:A.avatar,size:40},{icon:l(()=>[A.avatar?E("",!0):(i(),V($(Te),{key:0}))]),_:2},1032,["src"]),e("div",Za,[e("div",Ya,U(A.user_name),1),e("div",Xa,U(A.name),1)])])):E("",!0),f.key==="operate_rights"?(i(),p(B,{key:1},[d.value==2||A.user_name==w.value?(i(),p("div",er,[A.operate_rights==4?(i(),p("span",tr,"管理")):E("",!0),A.operate_rights==2?(i(),p("span",or,"编辑")):E("",!0),A.operate_rights==1?(i(),p("span",sr,"查看")):E("",!0)])):A.role_type==1||A.is_creator==1?(i(),p("div",nr,"管理")):(i(),V(k,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[e("div",ir,[e("div",{class:"role-menu",onClick:K=>x(A,4)},[e("div",ar,[t($(Te)),u[1]||(u[1]=e("span",{class:"title"},"管理",-1))]),u[2]||(u[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),A.operate_rights==4?(i(),p("div",rr,[t($(Ee))])):E("",!0)],8,lr),e("div",{class:"role-menu",onClick:K=>x(A,2)},[e("div",_r,[t($(tt)),u[3]||(u[3]=e("span",{class:"title"},"编辑",-1))]),u[4]||(u[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),A.operate_rights==2?(i(),p("div",cr,[t($(Ee))])):E("",!0)],8,dr),e("div",{class:"role-menu",onClick:K=>x(A,1)},[e("div",pr,[t($(Nt)),u[5]||(u[5]=e("span",{class:"title"},"查看",-1))]),u[6]||(u[6]=e("div",{class:"desc"},"仅查看",-1)),A.operate_rights==1?(i(),p("div",mr,[t($(Ee))])):E("",!0)],8,ur)])]),default:l(()=>[e("div",vr,[A.operate_rights==4?(i(),p("span",fr,"管理")):E("",!0),A.operate_rights==2?(i(),p("span",br,"编辑")):E("",!0),A.operate_rights==1?(i(),p("span",hr,"查看")):E("",!0),t($(Xe))])]),_:2},1024))],64)):E("",!0),f.key==="action"?(i(),p(B,{key:2},[d.value==4&&A.user_name!=w.value?(i(),p(B,{key:0},[A.role_type!=1&&A.is_creator!=1?(i(),p("a",{key:0,onClick:K=>r(A)},"移除",8,yr)):E("",!0)],64)):E("",!0)],64)):E("",!0)]),_:1},8,["columns","data-source"])])]),t(io,{onOk:b,ref_key:"addCollaboratorRef",ref:h},null,512)]),_:1})}}},gr=F(kr,[["__scopeId","data-v-3b4cded6"]]),xr={class:"actions-box"},$r={key:0,class:"library-list"},wr=["onClick"],qr={class:"library-name"},Sr={class:"library-intro"},Cr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(D){const m=q(!1),{robotInfo:w,getRobot:_}=H("robotInfo"),d=D,s=T({work_flow_ids:[]}),n=q(null),b=oe(()=>d.robotList.filter(c=>s.work_flow_ids.includes(c.id))),h=c=>{let o=s.work_flow_ids.indexOf(c.id);s.work_flow_ids.splice(o,1),r()},a=c=>{s.work_flow_ids=[...c],r()},x=()=>{n.value.open([...s.work_flow_ids])},r=()=>{let c={...Z(s)};c.work_flow_ids=c.work_flow_ids.join(","),Jt({id:w.id,...c}).then(o=>{Y.success("保存成功"),_(w.id)})};return qe(()=>{s.work_flow_ids=w.work_flow_ids.split(",")}),(c,o)=>{const u=se,y=ie,L=ge;return i(),V(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:m.value,"onUpdate:isEdit":o[0]||(o[0]=k=>m.value=k),bodyStyle:{padding:0}},{tip:l(()=>[t(u,{placement:"top"},{title:l(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:l(()=>[t($(ee))]),_:1})]),extra:l(()=>[e("div",xr,[t(L,{gap:8},{default:l(()=>[t(y,{size:"small",onClick:x},{default:l(()=>o[2]||(o[2]=[C("添加技能")])),_:1,__:[2]})]),_:1})])]),default:l(()=>[b.value.length>0?(i(),p("div",$r,[(i(!0),p(B,null,W(b.value,k=>(i(),p("div",{class:"library-item",key:k.id},[e("span",{class:"close-btn",onClick:R=>h(k)},[t($(fe))],8,wr),e("div",qr,U(k.robot_name),1),e("div",Sr,U(k.robot_intro),1)]))),128))])):E("",!0),t(lo,{ref_key:"robotSelectAlertRef",ref:n,onChange:a},null,512)]),_:1},8,["isEdit"])}}},Lr=F(Cr,[["__scopeId","data-v-13cb67dc"]]),Ir={class:"robot-info-box"},Ur={class:"set-block"},Rr={__name:"chat-cache",setup(D){const{robotInfo:m,updateRobotInfo:w}=H("robotInfo"),_=T({valid_time:"",cache_switch:0}),d=T({unix:"h",hValue:24,mValue:1440}),s=()=>{d.unix==="h"?_.valid_time=d.hValue*3600:_.valid_time=d.mValue*60,w({cache_config:{..._}})},n=()=>{s()},b=()=>{d.unix=="h"?d.hValue=parseInt(d.mValue/60):d.mValue=parseInt(d.hValue*60)};return _e(()=>m.cache_config,()=>{let h=m.cache_config||{};h=JSON.parse(JSON.stringify(h)),m.cache_config,_.cache_switch=h.cache_switch,_.valid_time=h.valid_time,h.valid_time%3600==0?(d.unix="h",d.hValue=h.valid_time/3600):(d.unix="m",d.mValue=parseInt(h.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(h,a)=>{const x=Se,r=Me,c=je,o=Bt,u=ne;return i(),V(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:l(()=>a[4]||(a[4]=[e("span",null,null,-1)])),default:l(()=>[e("div",Ir,[a[7]||(a[7]=C(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ")),e("div",Ur,[t(o,{compact:""},{default:l(()=>[d.unix=="h"?(i(),V(x,{key:0,onBlur:s,precision:0,value:d.hValue,"onUpdate:value":a[0]||(a[0]=y=>d.hValue=y),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(i(),V(x,{key:1,onBlur:s,precision:0,value:d.mValue,"onUpdate:value":a[1]||(a[1]=y=>d.mValue=y),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),t(c,{value:d.unix,"onUpdate:value":a[2]||(a[2]=y=>d.unix=y),style:{width:"70px"},onChange:b},{default:l(()=>[t(r,{value:"h"},{default:l(()=>a[5]||(a[5]=[C("小时")])),_:1,__:[5]}),t(r,{value:"m"},{default:l(()=>a[6]||(a[6]=[C("分钟")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})])]),t(u,{onChange:n,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:_.cache_switch,"onUpdate:checked":a[3]||(a[3]=y=>_.cache_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Er=F(Rr,[["__scopeId","data-v-e6c2742e"]]),Or={key:0,class:"robot-config-page"},Ar={class:"setting-box"},jr={class:"setting-box"},Mr={class:"setting-box"},Vr={class:"setting-box"},zr={class:"setting-box"},Dr={class:"setting-box"},Nr={class:"setting-box"},Pr={class:"setting-box"},Br={class:"setting-box"},Tr={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Qr={class:"setting-box"},Gr={class:"setting-box"},Kr={class:"setting-box"},Wr={key:1,class:"robot-config-page"},Hr={key:2,class:"robot-config-page"},Fe="/robot/config/basic-config/activeKey",Zr={__name:"index",setup(D){const m=ot(),w=q(null),{robotInfo:_}=mt(m),{getRobot:d}=m,s=()=>{w.value.scrollTop=w.value.scrollHeight},n=q(+localStorage.getItem(Fe)||1),b=q(!1),h=T(_.value),a=u=>{let y=JSON.parse(JSON.stringify(u));u.robot_avatar&&(y.robot_avatar=new File([u.robot_avatar],u.robot_avatar.name)),!y.op_type_relation_library&&h.op_type_relation_library&&delete h.op_type_relation_library,Object.assign(h,y),c()},x=q([]);(()=>{Qt({application_type:1}).then(u=>{x.value=u.data||[]})})(),vt("robotInfo",{robotInfo:h,updateRobotInfo:a,scrollBoxToBottom:s,getRobot:d});const c=()=>{let u;h.robot_avatar&&(u=new File([h.robot_avatar],h.robot_avatar.name));let y=JSON.parse(JSON.stringify(Z(h)));u&&(y.robot_avatar=u);let L=y.welcomes;L.question=L.question.map(R=>R.content),y.welcomes=JSON.stringify(L),y.prompt_struct=JSON.stringify(y.prompt_struct);let k=y.unknown_question_prompt;k.question=k.question.map(R=>R.content),y.unknown_question_prompt=JSON.stringify(k),y.cache_config=JSON.stringify(y.cache_config),delete y.robot_avatar_url,b.value=!0,Gt(y).then(R=>{if(R.res!=0)return Y.error(R.msg);b.value=!1,Y.success("保存成功"),d(h.id)}).catch(()=>{b.value=!1})},o=()=>{localStorage.setItem(Fe,n.value)};return(u,y)=>{const L=Ze,k=Ye;return i(),p(B,null,[t(k,{class:"tab-wrapper",onChange:o,activeKey:n.value,"onUpdate:activeKey":y[0]||(y[0]=R=>n.value=R)},{default:l(()=>[(i(),V(L,{key:1,tab:"基础配置"})),E("",!0),(i(),V(L,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),n.value==1?(i(),p("div",Or,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:w},[e("div",Ar,[t(Ro)]),e("div",jr,[t(Xi)]),e("div",Mr,[t(Kn)]),e("div",Vr,[t(fa)]),e("div",zr,[t(Er)]),e("div",Dr,[t(_n,{robotList:x.value},null,8,["robotList"])]),e("div",Nr,[t(Lr,{robotList:x.value},null,8,["robotList"])]),e("div",Pr,[t(pl)]),e("div",Br,[t(wl)]),e("div",Tr,[t(jl)]),e("div",Fr,[t(Kl)]),e("div",Jr,[t(Bl)]),e("div",Qr,[t(Ql)]),e("div",Gr,[t(Fa)]),e("div",Kr,[t(Qa)])],512)])):E("",!0),n.value==2?(i(),p("div",Wr,[t(Ta)])):E("",!0),n.value==3?(i(),p("div",Hr,[t(gr)])):E("",!0)],64)}}},xd=F(Zr,[["__scopeId","data-v-5e897e46"]]);export{xd as default};
