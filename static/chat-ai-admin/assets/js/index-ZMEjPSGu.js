import{a5 as X,ag as ee,b9 as te,bd as se,be as oe,c as me,_ as P,b as F,d as Z}from"../../index-WMhSApoa.js";import{am as ve,e as fe,ac as i,ad as s,k as R,as as o,ah as ge,ak as ne,G as V,at as d,aB as Y,f as C,w as ae,o as le,y as E,b as ce,ae as j,u as p,az as w,F as B,ax as D,ai as G,q as re,ar as z,n as de,H as _e,J as ie,av as ye}from"./vue-chunks-CGLjTDrY.js";import{u as ue}from"./useEventBus-CB_rGuu7.js";import{g as ke}from"./index-CtAh6k0_.js";import{u as be}from"./useIM-DUfDhtCg.js";import{B as J,M as Le,S as we,P as xe}from"./pull-up.esm-DIiTC7VE.js";import{O as Te}from"./observe-dom.esm-B25JyVKH.js";import{al as Se,ay as Ce,aA as $e,z as Me,y as Re,I as Ie}from"./ui-antd-BDReVt-O.js";import{_ as Ne,V as Be}from"./voice-message-CPXesPS1.js";import{M as De}from"./multiple-message-CkTA4Qle.js";import{h as Oe}from"./index-H1WgLCGf.js";import"./neo4j-CK9lNpyi.js";import"./utils-DXEytJvC.js";import"./other-BrZCAsTs.js";import"./index-CxGFxpsV.js";const qe=(_={})=>X.get({url:"/manage/getReceiverList",params:_}),Ae=(_={})=>X.post({url:"/chat/message",data:_}),He=(_={})=>X.post({url:"/manage/setReceiverRead",data:_}),K=ve("chatMonitor",{state:()=>({im:null,selectedRobotId:"",robotList:[],selectedReceiverId:"",receiverList:[],receiverListPage:{page:0,size:10},activeChat:null,chatMessagePageSize:10,messageList:[],messageListScrollTop:0,chatMessageLoadCompleted:!1,messageListLoading:!1}),getters:{},actions:{async init(){this.selectedRobotId="",this.selectedReceiverId="",this.robotList=[],this.receiverList=[],this.messageList=[],this.receiverListPage={page:0,size:10},this.messageListScrollTop=0,this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.activeChat=null,await this.getRobotList(),await this.getReceiverList(),this.receiverList.length>0&&await this.switchChat(this.receiverList[0]),this.initIM()},closeIM(){this.im&&this.im.close()},initIM(){const _=be(),c=me();this.im=_,_.connect(c.user_id),_.on("message",e=>{!e.data||e.msg_type!=="receiver_notify"||((e.change=="create"||e.change=="update")&&this.onAddReceiver(e),e.change=="delete"&&this.onDeleteReceiver(e),(e.change=="c_message"||e.change=="ai_message")&&this.onAddMessage(e))})},onAddMessage(_){if(!this.activeChat)return;const c=ue();let e=_.data;if(this.activeChat.session_id==e.session_id){if(e.displayName=e.name||e.nickname,e.dispayTime=te(e.create_time),e.uid=ee(32),e.loading=!1,e.menu_json&&typeof e.menu_json=="string"&&(e.menu_json=JSON.parse(e.menu_json)),e.quote_file&&typeof e.quote_file=="string"&&(e.quote_file=JSON.parse(e.quote_file)),e.reply_content_list&&typeof e.reply_content_list=="string")try{e.reply_content_list=JSON.parse(e.reply_content_list)}catch{e.reply_content_list=[]}e.voice_content=se(e.content),e.content=oe(e.content),this.messageList.push(e),c.emit("onAddMessage",e)}},onAddReceiver(_){let c=_.data;c.displayName=c.name||c.nickname,c.come_from=JSON.parse(c.come_from);let e=this.receiverList.findIndex(l=>l.session_id==c.session_id);e!==-1?this.receiverList.splice(e,1,c):(this.selectedRobotId==""||this.selectedRobotId==c.robot_id)&&this.receiverList.unshift(c)},onDeleteReceiver(_){let c=_.data,e=this.receiverList.findIndex(l=>l.id==c);e!=-1&&(this.activeChat&&this.activeChat.id==c&&(this.activeChat=null),this.receiverList.splice(e,1))},async getRobotList(_){try{const c=await ke(_);return this.robotList=c.data||[],c}catch(c){throw console.error("Failed to get robot list:",c),c}},async getReceiverList(_){_!=null&&_.page?this.receiverListPage.page=_.page:this.receiverListPage.page++;const c={...this.receiverListPage,robot_id:this.selectedRobotId,..._};try{const e=await qe(c);let l=e.data.list||[];for(let t=0;t<l.length;t++)if(l[t].displayName=l[t].name||l[t].nickname,l[t].come_from)try{l[t].come_from=JSON.parse(l[t].come_from)}catch(u){console.error("Failed to parse come_from:",u)}return this.receiverListPage.page===1?this.receiverList=l:this.receiverList=this.receiverList.concat(l),e}catch(e){throw console.error("Failed to get receiver list:",e),this.receiverListPage.page>1&&this.receiverListPage.page--,e}},changeRobot(_){this.activeChat=null,this.resetReceiverList(_)},resetReceiverList(_){return this.receiverListPage.page=0,this.receiverList=[],this.getReceiverList(_)},async getChatMessage(){if(this.messageListLoading)return;this.messageListLoading=!0;let _=0,c=this.messageList.filter(l=>!l.isWelcome);c.length>0&&(_=c[0].id);let e={robot_key:this.activeChat.robot_key,openid:this.activeChat.openid,min_id:_,size:this.chatMessagePageSize,rel_user_id:this.activeChat.rel_user_id};return Ae(e).then(l=>{var k,$;this.messageListLoading=!1;let t=l.data.list||[];const u=((k=l==null?void 0:l.data)==null?void 0:k.customer)||{},v=(($=l==null?void 0:l.data)==null?void 0:$.robot)||{};t.sort((n,g)=>n.id-g.id);for(let n=0;n<t.length;n++){if(t[n].displayName=t[n].name||t[n].nickname,t[n].is_customer==1?(t[n].displayName=t[n].displayName||u.name,t[n].avatar=t[n].avatar||u.avatar):(t[n].displayName=t[n].displayName||v.robot_name,t[n].avatar=t[n].avatar||v.robot_avatar),t[n].uid=ee(32),t[n].menu_json&&typeof t[n].menu_json=="string"&&(t[n].menu_json=JSON.parse(t[n].menu_json)),t[n].quote_file&&typeof t[n].quote_file=="string"&&(t[n].quote_file=JSON.parse(t[n].quote_file)),t[n].reply_content_list&&typeof t[n].reply_content_list=="string")try{t[n].reply_content_list=JSON.parse(t[n].reply_content_list)}catch{t[n].reply_content_list=[]}t[n].dispayTime=te(t[n].create_time),t[n].voice_content=se(t[n].content),t[n].content=oe(t[n].content)}return this.messageList=[...t,...this.messageList],t.length<this.chatMessagePageSize&&(this.chatMessageLoadCompleted=!0),l}).catch(l=>{this.messageListLoading=!1})},claerUnread(){return He({id:this.selectedReceiverId})},async switchChat(_){this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.messageList=[],this.messageListScrollTop=0,this.selectedReceiverId=_.id,this.activeChat=_,this.claerUnread(),await this.getChatMessage()}}}),ze={class:"no-data"},Pe={class:"no-data-text"},je={__name:"list-empty",props:{text:{type:String,default:""},size:{type:[Number,String],default:100}},setup(_){const{t:c}=F("views.chat-monitor.components.list-empty"),e=_,l=fe(()=>e.text||c("no_data"));return(t,u)=>{const v=Z;return s(),i("div",ze,[R(v,{name:"empty",style:ge({"font-size":`${e.size}px`})},null,8,["style"]),o("div",Pe,[ne(t.$slots,"default",{},()=>[V(d(l.value),1)],!0)])])}}},he=P(je,[["__scopeId","data-v-30b2f3d9"]]),Fe={key:1,class:"chat-list"},Ue=["onClick"],Je={class:"avatar"},Ve=["src","alt"],Ee={class:"chat-info"},We={class:"nickname"},Ge={class:"last-message"},Ye={class:"webapp-source"},Ke={key:0,class:"loading-wrapper"},Qe={class:"loading-text"},Xe={key:1,class:"finished-text"},Ze={__name:"chat-list ",emits:["switchChat"],setup(_,{expose:c,emit:e}){J.use(Le),J.use(we),J.use(Te),J.use(xe);const l=e,{t}=F("views.chat-monitor.components.chat-list"),u=K(),{getReceiverList:v}=u,{receiverList:k,selectedReceiverId:$}=Y(u),n=C(null);let g=null;const b=C(!1),T=C(!1),I=()=>{g=new J(n.value,{scrollY:!0,click:!0,observeDOM:!0,mouseWheel:!0,bounce:!1,scrollbar:{fade:!0,interactive:!0},pullUpLoad:!0}),g.on("pullingUp",()=>{m()})},m=async(x={})=>{if(b.value||T.value){g.finishPullUp();return}b.value=!0;try{(await v(x)).data.list.length===0&&!x.keyword&&(T.value=!0)}catch(N){console.error(t("load_more_failed"),N)}finally{b.value=!1,g.finishPullUp()}},L=x=>{l("switchChat",x)};return ae(k,x=>{x.length>0&&E(()=>{g&&g.refresh()})}),le(()=>{E(()=>{I()})}),ce(()=>{g&&g.destroy()}),c({getData:m}),(x,N)=>{const y=Se;return s(),i("div",{class:"scroll-wrapper",ref_key:"scrollRef",ref:n},[p(k).length==0?(s(),j(he,{key:0,size:"140",text:p(t)("no_bot_sessions")},null,8,["text"])):(s(),i("div",Fe,[(s(!0),i(B,null,D(p(k),r=>(s(),i("div",{key:r.id,class:G(["chat-item",{active:r.id===p($)}]),onClick:O=>L(r)},[o("div",Je,[o("img",{src:r.avatar,alt:r.displayName},null,8,Ve),r.unread>0?(s(),i("span",{key:0,class:G(["dot",{plus:r.unread>9}])},d(r.unread),3)):w("",!0)]),o("div",Ee,[o("div",We,d(r.displayName),1),o("div",Ge,d(r.last_chat_message),1),o("div",Ye,d(p(t)("from_prefix"))+d(r.come_from.app_name),1)])],10,Ue))),128)),b.value?(s(),i("div",Ke,[R(y,{size:"small"}),o("span",Qe,d(p(t)("loading")),1)])):w("",!0),T.value?(s(),i("div",Xe,d(p(t)("no_more")),1)):w("",!0)]))],512)}}},et=P(Ze,[["__scopeId","data-v-8c733c21"]]),tt={__name:"chat-message-scroll",props:{topTriggerDistance:{type:Number,default:10},bottomTriggerDistance:{type:Number,default:40},isLoading:{type:Boolean,default:!1},scrollTop:{type:Number,default:0}},emits:["scroll-top","scroll-bottom","scroll"],setup(_,{expose:c,emit:e}){const l=_,t=e,u=C(null),v=C({scrollTop:0,scrollHeight:0,clientHeight:0,scrollDirection:"down",scrollStartDiff:l.topTriggerDistance,scrollEndDiff:l.bottomTriggerDistance}),k=C(null),$=m=>{const{scrollTop:L}=m,x=v.value.scrollTop-L;v.value.scrollDirection=x>0?"up":"down",Object.assign(v.value,{scrollTop:L,scrollHeight:m.scrollHeight,clientHeight:m.clientHeight})},n=()=>{const{scrollTop:m,scrollHeight:L,clientHeight:x,scrollStartDiff:N,scrollEndDiff:y,scrollDirection:r}=v.value;t("scroll",{...v.value}),l.isLoading||(Math.abs(m)<=N&&r==="up"&&t("scroll-top",{...v.value}),Math.abs(L-m-x)<=y&&r==="down"&&t("scroll-bottom",{...v.value}))},g=m=>{$(m.target),k.value&&(clearTimeout(k.value),k.value=null),k.value=setTimeout(()=>{n()},100)};function b(){u.value&&(u.value.scrollTop=0)}function T(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function I(){return u.value&&Object.assign(v.value,{scrollTop:u.value.scrollTop,scrollHeight:u.value.scrollHeight,clientHeight:u.value.clientHeight}),JSON.parse(JSON.stringify(v.value))}return ae(()=>l.scrollTop,m=>{u.value&&(u.value.scrollTop=m)}),c({scrollToTop:b,scrollToBottom:T,getState:I}),(m,L)=>(s(),i("div",{class:"chat-message-scroll",ref_key:"scrollContainer",ref:u,onScroll:g},[ne(m.$slots,"default",{},void 0,!0)],544))}},st=P(tt,[["__scopeId","data-v-3e3a1c2e"]]),ot={class:"chat-message-warpper"},it={class:"chat-message-content"},nt={key:0,class:"is-loaded"},at={class:"avatar"},lt=["src","alt"],ct={class:"message-content"},rt={class:"message-info"},dt={class:"nickname"},_t={class:"time"},ut={key:0,class:"reply-list"},ht={key:0,class:"reply-item reply-text"},pt=["innerHTML"],mt={key:1,class:"reply-item reply-image"},vt={class:"message-content"},ft=["src"],gt={key:2,class:"reply-item reply-url"},yt={class:"url-row"},kt=["href"],bt={key:3,class:"reply-item reply-card"},Lt={class:"card-row"},wt=["src"],xt={class:"card-title-box"},Tt={class:"card-title"},St={key:4,class:"reply-item reply-imageText"},Ct=["href"],$t=["src"],Mt={class:"imageText-text"},Rt={class:"imageText-title"},It={class:"imageText-desc"},Nt={key:5,class:"reply-item reply-smartMenu"},Bt={class:"smart-menu-box"},Dt={key:0,class:"card-title"},Ot={class:"card-text"},qt={key:0,class:"line-text"},At={key:1,class:"empty-line"},Ht=["innerHTML"],zt={key:3,href:"javascript:;",class:"link"},Pt={key:0},jt={key:1,class:"message-bubble"},Ft={key:0,class:"text-content"},Ut={key:1},Jt={key:1,class:"image-content"},Vt=["src"],Et={key:2,class:"image-content"},Wt=["src"],Gt={key:3,class:"menu-content"},Yt={class:"menus-label"},Kt={key:0,class:"menu-items"},Qt=["onClick"],Xt={key:4,class:"multiple-content"},Zt={key:5,class:"answer-reference-box"},es={class:"answer-reference-label"},ts=["onClick"],ss={key:2},os={__name:"chat-message",emits:["openLibrary"],setup(_,{expose:c,emit:e}){const{t:l}=F("views.chat-monitor.components.chat-message"),t=e,u=C(null),v=K(),{getChatMessage:k}=v,{messageList:$,messageListScrollTop:n,messageListLoading:g,chatMessageLoadCompleted:b,activeChat:T}=Y(v),I=()=>{};function m(S,f,M){let H=ie(S);f.robot_key=T.value.robot_key,f.robot_id=T.value.robot_id,H.forEach(a=>{a.message_id=M.id,a.openid=M.openid,a.robot_key=T.value.robot_key,a.robot_id=T.value.robot_id}),t("openLibrary",H,ie(f))}function L(S){const f=[];return(Array.isArray(S)?S:[]).forEach(M=>{const H=String((M==null?void 0:M.menu_type)||""),a=String((M==null?void 0:M.content)||"");if(H==="0")if(a==="")f.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(a)){const Q=/href\s*=\s*['"]\s*#\s*['"]/i.test(a)?a.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):a.replace(/href=/ig,'target="_blank" href=');f.push({kind:"html",html:Q})}else f.push({kind:"text",text:a});else H==="1"&&f.push({kind:"keyword",text:a,serial_no:(M==null?void 0:M.serial_no)||""})}),f.slice(0,20)}const x=S=>{const{scrollTop:f}=S;n.value=f},N=async()=>{if(b.value)return;let S=u.value.getState();await k(),E(()=>{let f=u.value.getState();f.scrollDirection=="up"&&(n.value=f.scrollHeight-S.scrollHeight)})},y=async()=>{},r=()=>{u.value.scrollToBottom()},O=()=>{u.value.scrollToTop()};function A(S){try{return S?Array.isArray(S)?S:typeof S=="string"?JSON.parse(S||"[]"):[]:[]}catch{return[]}}return c({scrollToTop:O,scrollToBottom:r}),(S,f)=>{const M=Z,H=re("viewer");return s(),i("div",ot,[R(st,{ref_key:"scrollViewRef",ref:u,scrollTop:p(n),"onUpdate:scrollTop":f[0]||(f[0]=a=>_e(n)?n.value=a:null),"is-loading":p(g),onScroll:x,onScrollTop:N,onScrollBottom:y},{default:z(()=>[o("div",it,[p(b)?(s(),i("div",nt,d(p(l)("no_more_messages")),1)):w("",!0),(s(!0),i(B,null,D(p($),(a,Q)=>(s(),i("div",{key:Q,class:G(["message-item",a.is_customer==0?"right":""])},[o("div",at,[o("img",{src:a.avatar,alt:a.displayName},null,8,lt)]),o("div",ct,[o("div",rt,[o("span",dt,d(a.displayName),1),f[1]||(f[1]=o("i",{class:"gap"},null,-1)),o("span",_t,d(a.dispayTime),1)]),A(a.reply_content_list).length?(s(),i("div",ut,[(s(!0),i(B,null,D(A(a.reply_content_list),(h,U)=>{var W;return s(),i(B,{key:U},[(h.reply_type||h.type)==="text"?(s(),i("div",ht,[o("div",{class:"message-content",innerHTML:h.description},null,8,pt)])):(h.reply_type||h.type)==="image"?(s(),i("div",mt,[o("div",vt,[de(o("img",{class:"msg-img",src:h.pic||h.thumb_url},null,8,ft),[[H]])])])):(h.reply_type||h.type)==="url"?(s(),i("div",gt,[o("div",yt,[o("a",{class:"url-link",href:h.url,target:"_blank"},d(h.url),9,kt)])])):(h.reply_type||h.type)==="card"?(s(),i("div",bt,[o("div",Lt,[h.thumb_url?(s(),i("img",{key:0,src:h.thumb_url,class:"card-thumb"},null,8,wt)):w("",!0),o("div",xt,[R(M,{class:"think-icon",name:"applet"}),o("span",Tt,d(h.title),1)])])])):(h.reply_type||h.type)==="imageText"?(s(),i("div",St,[o("a",{class:"imageText-row",href:h.url,target:"_blank"},[h.thumb_url?(s(),i("img",{key:0,src:h.thumb_url,class:"imageText-thumb"},null,8,$t)):w("",!0),o("div",Mt,[o("div",Rt,d(h.title),1),o("div",It,d(h.description),1)])],8,Ct)])):(h.reply_type||h.type)==="smartMenu"?(s(),i("div",Nt,[o("div",Bt,[h.smart_menu&&h.smart_menu.menu_description?(s(),i("div",Dt,d(h.smart_menu.menu_description),1)):w("",!0),o("div",Ot,[(s(!0),i(B,null,D(L(((W=h.smart_menu)==null?void 0:W.menu_content)||[]),(q,pe)=>(s(),i("div",{key:pe,class:"reply-line"},[q.kind==="text"?(s(),i("span",qt,d(q.text),1)):q.kind==="newline"?(s(),i("div",At)):q.kind==="html"?(s(),i("span",{key:2,innerHTML:q.html},null,8,Ht)):q.kind==="keyword"?(s(),i("a",zt,[q.serial_no?(s(),i("div",Pt,d(q.serial_no),1)):w("",!0),V(" "+d(q.text),1)])):w("",!0)]))),128))])])])):w("",!0)],64)}),128))])):w("",!0),a.msg_type==1&&a.content==""?w("",!0):(s(),i("div",jt,[a.msg_type==1?(s(),i("div",Ft,[a.is_customer==0?(s(),j(Ne,{key:0,style:{"text-align":"left"},content:a.content},null,8,["content"])):(s(),i("div",Ut,d(a.content),1))])):a.received_message_type=="image"&&a.media_id_to_oss_url?(s(),i("div",Jt,[o("img",{src:a.media_id_to_oss_url,alt:"image"},null,8,Vt)])):a.msg_type==3?(s(),i("div",Et,[o("img",{src:a.content,alt:"image"},null,8,Wt)])):a.msg_type==2?(s(),i("div",Gt,[o("div",Yt,d(a.menu_json.content),1),a.menu_json.question&&a.menu_json.question.length>0?(s(),i("div",Kt,[(s(!0),i(B,null,D(a.menu_json.question,(h,U)=>(s(),i("div",{key:U,class:"menu-item",onClick:W=>I(h)},d(h),9,Qt))),128))])):w("",!0)])):a.msg_type==99?(s(),i("div",Xt,[R(De,{message:a.content},null,8,["message"])])):w("",!0),a.quote_file&&a.quote_file.length?(s(),i("div",Zt,[o("div",es,d(p(l)("answer_reference")),1),o("div",null,[(s(!0),i(B,null,D(a.quote_file,(h,U)=>(s(),i("div",{class:"list-item",key:U},[R(M,{name:"attachment"}),o("span",{onClick:W=>m(a.quote_file,h,a)},d(h.file_name),9,ts)]))),128))])])):w("",!0)])),a.voice_content&&a.voice_content.length?(s(),i("div",ss,[R(Be,{voice_content:a.voice_content},null,8,["voice_content"])])):w("",!0)])],2))),128))])]),_:1},8,["scrollTop","is-loading"])])}}},is=P(os,[["__scopeId","data-v-52225838"]]),ns={class:"library-info-content"},as={class:"file-list"},ls=["onClick"],cs={class:"document-items"},rs={class:"document-item-header"},ds={class:"left-box"},_s={class:"document-title"},us={key:0,class:"document-title"},hs={class:"document-size"},ps={class:"right-box"},ms={class:"document-item-body"},vs={class:"document-similarity"},fs={key:0,class:"document-content"},gs={key:1,class:"document-content"},ys={class:"document-content"},ks={class:"fragment-img"},bs=["src"],Ls={__name:"library-info-alert",setup(_,{expose:c}){const{t:e}=F("views.chat-monitor.components.library-info-alert"),l=ye(),t=C(!1),u=C([]),v=C(null),k=()=>{u.value=[],v.value=null},$=(m,L)=>{k(),u.value=m,v.value=L.id,t.value=!0,b(L)},n=m=>{m.id!=v.value&&(v.value=m.id,b(m))},g=C([]),b=m=>{Oe({message_id:m.message_id,file_id:m.id,robot_key:m.robot_key,openid:m.openid}).then(L=>{g.value=L.data||[]})},T=()=>{l.push("/library/preview?id="+v.value)},I=()=>{t.value=!1};return c({open:$}),(m,L)=>{const x=Z,N=$e,y=re("viewer");return s(),j(N,{class:"library-info-alert",open:t.value,"onUpdate:open":L[0]||(L[0]=r=>t.value=r),title:p(e)("answer_source"),placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:z(()=>[o("span",{class:"close-btn",onClick:I},[R(p(Ce))])]),default:z(()=>[o("div",ns,[o("div",as,[(s(!0),i(B,null,D(u.value,r=>(s(),i("div",{class:G(["file-item",{active:v.value==r.id}]),key:r.id,onClick:O=>n(r)},d(r.file_name),11,ls))),128))]),o("div",cs,[(s(!0),i(B,null,D(g.value,r=>(s(),i("div",{class:"document-item",key:r.id},[o("div",rs,[o("div",ds,[o("span",_s,d(p(e)("id_prefix"))+d(r.id),1),r.title?(s(),i("span",us,d(r.title),1)):w("",!0),o("span",hs,d(p(e)("total_characters",{count:r.word_total})),1)]),o("div",ps,[o("a",{onClick:T},d(p(e)("view_source_document")),1)])]),o("div",ms,[o("div",vs,[V(d(p(e)("similarity"))+" ",1),R(x,{name:"similarity",style:{"font-size":"16px"}}),V(d(r.similarity),1)]),r.question?(s(),i("div",fs,d(p(e)("question_prefix"))+d(r.question),1)):w("",!0),r.answer?(s(),i("div",gs,d(p(e)("answer_prefix"))+d(r.answer),1)):w("",!0),o("div",ys,d(r.content),1),de((s(),i("div",ks,[(s(!0),i(B,null,D(r.images,(O,A)=>(s(),i("img",{key:A,src:O,alt:""},null,8,bs))),128))])),[[y]])])]))),128))])])]),_:1},8,["open","title"])}}},ws=P(Ls,[["__scopeId","data-v-33e46666"]]),xs={key:0,class:"chat-box-warpper"},Ts={class:"chat-box-header"},Ss={class:"nickname"},Cs={class:"chat-source"},$s={class:"chat-box-content"},Ms={key:1},Rs={__name:"chat-box",setup(_,{expose:c}){const{t:e}=F("views.chat-monitor.components.chat-box"),l=K(),{activeChat:t}=Y(l),u=C(null),v=()=>{u.value.scrollToBottom()},k=()=>{u.value.scrollToTop()},$=C(null),n=(g,b)=>{$.value.open(g,b)};return c({scrollToTop:k,scrollToBottom:v}),(g,b)=>(s(),i(B,null,[p(t)?(s(),i("div",xs,[o("div",Ts,[o("div",Ss,d(p(t).name||p(t).nickname),1),o("div",Cs,d(p(e)("from_source",{robot:p(t).come_from.robot_name,app:p(t).come_from.app_name})),1)]),o("div",$s,[R(is,{ref_key:"chatMessageRef",ref:u,onOpenLibrary:n},null,512)])])):(s(),i("div",Ms)),R(ws,{ref_key:"libraryInfoAlertRef",ref:$},null,512)],64))}},Is=P(Rs,[["__scopeId","data-v-2aa18c16"]]),Ns={class:"chat-monitor-page"},Bs={class:"page-left"},Ds={class:"app-list-box"},Os={class:"search-box"},qs={class:"chat-list-wrapper"},As={class:"page-body"},Hs={__name:"index",setup(_){const{t:c}=F("views.chat-monitor"),e=ue(),l=K(),{init:t,changeRobot:u,switchChat:v,closeIM:k}=l,{robotList:$,selectedRobotId:n,activeChat:g}=Y(l),b=C(null),T=C(null),I=C(""),m=()=>{const y={keyword:I.value,page:1};u(y)},L=async y=>{var r;await v(y),(r=T.value)==null||r.scrollToBottom()},x=()=>{E(()=>{var y;(y=T.value)==null||y.scrollToBottom()})},N=()=>{const y={keyword:I.value,page:1};b.value&&b.value.getData(y)};return le(async()=>{await t(),E(()=>{var y;(y=T.value)==null||y.scrollToBottom()}),e.on("onAddMessage",x)}),ce(()=>{e.off("onAddMessage",x),k()}),(y,r)=>{const O=Me,A=Re,S=Ie;return s(),i("div",Ns,[o("div",Bs,[o("div",Ds,[R(A,{value:p(n),"onUpdate:value":r[0]||(r[0]=f=>_e(n)?n.value=f:null),style:{width:"100%"},onChange:m},{default:z(()=>[R(O,{value:""},{default:z(()=>[V(d(p(c)("all_apps")),1)]),_:1}),(s(!0),i(B,null,D(p($),f=>(s(),j(O,{value:f.id,key:f.id},{default:z(()=>[o("span",null,d(f.robot_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),o("div",Os,[R(S,{value:I.value,"onUpdate:value":r[1]||(r[1]=f=>I.value=f),placeholder:p(c)("search_placeholder"),"enter-button":"",style:{width:"100%"},onSearch:N,allowClear:"",onPressEnter:N},null,8,["value","placeholder"])]),o("div",qs,[R(et,{ref_key:"chatListRef",ref:b,onSwitchChat:L},null,512)])]),o("div",As,[p(g)?(s(),j(Is,{key:0,ref_key:"chatBoxRef",ref:T},null,512)):(s(),j(he,{key:1,style:{background:"#F2F4F7"},size:"250"},{default:z(()=>[o("div",null,[o("p",null,d(p(c)("select_conversation_tip")),1),o("p",null,d(p(c)("feature_description")),1)])]),_:1}))])])}}},eo=P(Hs,[["__scopeId","data-v-797347de"]]);export{eo as default};
