import{_ as E,b as re,L as $e,e as K,M as W,o as _e,p as Ce,r as Le,a as Ue,q as Pe,m as ue,E as de,t as Se,v as Oe,B as ce,c as Ie,w as Me,x as Re,y as ze,z as Te}from"../../index-0jhxEUZS.js";import{r as p,L as r,M as k,F as G,a1 as X,a2 as Fe,Y as w,u as A,w as Ae,j as e,Q as a,P as D,V as o,a3 as pe,a4 as me,A as Q,U as V,X as z,a8 as se,a9 as ve,v as je}from"./vue-chunks-C0QQWOCx.js";import{g as De}from"./index-CfvL06E8.js";import{g as qe}from"./index-CPg8-A7z.js";import{g as Ne}from"./index-_EvXQDvG.js";import{v as fe}from"./validate-8MtiUsxW.js";import{F as Z,_ as le}from"./index-CRVpDJ1f.js";import{P as ne}from"./PlusOutlined-CgwfTcid.js";import{_ as Ye}from"./index-CzVWingc.js";import{d as oe}from"./role_avatar-DL0r08JY.js";import"./index-DLXS2gFD.js";import{I as he}from"./Input-C2joc_0K.js";import{S as Ee,_ as Je}from"./index-Uljgx3Xd.js";import{_ as ge}from"./Password-D0V1lqaH.js";import{C as ke,_ as ye}from"./index-BRJNqOsV.js";import{Q as ae}from"./QuestionCircleOutlined-BDfA4Qtk.js";import{_ as be}from"./Search-IP_DCQEs.js";import{_ as ie}from"./index-DnBQfJsj.js";import{_ as we,a as xe}from"./index-BtR-tzFu.js";import{_ as Be}from"./index-DMH-zawU.js";import{_ as Ve}from"./TextArea-4ibeqG6S.js";import{_ as Ke,a as Qe}from"./index-BAPWTR4z.js";import"./axios-Cm0UX6qg.js";import"./qs-CnxcMLjH.js";import"./crypto-js-C2SrYqGA.js";import"./dayjs-CsGPDCY7.js";import"./colors-mU-75_cq.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-DgCxKo0N.js";import"./responsiveObserve-Cvd8WiWW.js";import"./collapseMotion-BOXZQl9Y.js";import"./FormItemContext-BtHm9ijx.js";import"./partition-Cp0_1Ufx.js";import"./CheckOutlined-DjzOOMrf.js";import"./useRefs-DDwzsqEq.js";import"./index-CIBVllRY.js";import"./statusUtils-BN1jNO5O.js";import"./inputProps-DKMe6fry.js";import"./slide-Dj1hvy3q.js";import"./index-Di6HYDsH.js";import"./isMobile-D_4OiXLP.js";import"./DownOutlined-Fh9thfzl.js";import"./SearchOutlined-BPrf0z-8.js";import"./move-Cr4SzyVA.js";import"./RadioButton-Va9pwQOY.js";import"./index-DT3eOyMo.js";import"./index-Bt24-Dy1.js";import"./useMaxLevel-C5IWhbq4.js";import"./css-grC2A7nw.js";import"./index-BWbBOPg_.js";import"./LeftOutlined-BZKDsEmW.js";import"./RightOutlined-kK29_F6f.js";import"./index-D1sUEdFa.js";import"./dropdown-CSJoU83q.js";import"./Dropdown-C9U2MQYn.js";import"./index-E5vI2LlI.js";import"./shallowequal-Fk1l6xhN.js";import"./index-BkZ5S4nu.js";const He={class:"page-tabs"},Ge=["onClick"],Xe={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(I,{emit:g}){const{t:f}=re(),M=g,U=I,i=p([{value:1,title:f("views.user.model.teamMembers"),langKey:"views.user.model.teamMembers"},{value:0,title:f("views.user.model.rolePermissions"),langKey:"views.user.model.rolePermissions"}]),d=t=>{M("update:value",t),M("change",t)};return(t,S)=>(r(),k("div",He,[(r(!0),k(G,null,X(i.value,x=>(r(),k("div",{class:Fe(["tab-item",{active:U.value==x.value}]),onClick:_=>d(x.value),key:x.value},w(A(f)(x.langKey)),11,Ge))),128))]))}},Ze=E(Xe,[["__scopeId","data-v-924c1ece"]]),We=I=>(pe("data-v-5be3f074"),I=I(),me(),I),et={class:"avatar-uploader"},tt=["src"],at={key:1},st=We(()=>o("div",{class:"ant-upload-text"},"上传照片",-1)),ot=["src"],lt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(I,{emit:g}){function f(l){return new Promise((m,h)=>{const s=new FileReader;s.readAsDataURL(l),s.onload=()=>m(s.result),s.onerror=R=>h(R)})}const M=g,U=I,i=p([]),d=p(!1),t=p("");Ae(()=>U.value,l=>{t.value=l},{immediate:!0});const S=Z.useInjectFormItemContext(),x=()=>{let l={imageUrl:t.value,file:i.value[0].originFileObj};M("change",l),M("update:value",l.imageUrl),S.onFieldChange()},_=l=>l.type==="image/jpeg"||l.type==="image/png"?l.size/1024<1024?(i.value=[l],f(l).then(s=>{t.value=s,d.value=!1,x()}),!1):(K.error("成员头像图片大小不能超过1M"),!1):(K.error("机器人头像只支持JPG、PNG格式的图片"),!1),P=p(!1),$=p(""),y=p(""),C=()=>{P.value=!1,y.value=""},n=async l=>{!l.url&&!l.preview&&(l.preview=await f(l.originFileObj)),$.value=l.url||l.preview,P.value=!0,y.value=l.name||l.url.substring(l.url.lastIndexOf("/")+1)};return(l,m)=>{const h=Ye,s=W;return r(),k("div",et,[e(h,{"file-list":i.value,"onUpdate:fileList":m[0]||(m[0]=R=>i.value=R),"list-type":"picture-card","show-upload-list":!1,"before-upload":_,accept:".jpg,.png,.jpeg",onPreview:n},{default:a(()=>[t.value?(r(),k("img",{key:0,class:"avatar",src:t.value,alt:"avatar"},null,8,tt)):(r(),k("div",at,[d.value?(r(),D(A($e),{key:0})):(r(),D(A(ne),{key:1})),st]))]),_:1},8,["file-list"]),e(s,{open:P.value,title:y.value,footer:null,onCancel:C},{default:a(()=>[o("img",{alt:"example",style:{width:"100%"},src:$.value},null,8,ot)]),_:1},8,["open","title"])])}}},nt=E(lt,[["__scopeId","data-v-5be3f074"]]),it={class:"form-box"},rt={__name:"add-team-members",emits:["ok"],setup(I,{expose:g,emit:f}){const M=f,U=Z.useForm,i=p(!1),d=p("添加团队成员"),t=Q({user_name:"",nick_name:"",avatar:"",avatar_url:"",user_roles:"3",password:"",check_password:"",id:""}),S=h=>{t.avatar=h.file},x=p([]);_e({page:1,size:200,search:""}).then(h=>{let s=h.data.list||[];x.value=s.filter(R=>R.id!="1")});const _=Q({user_name:[{message:"请输入登录账号",required:!0},{validator:async(h,s)=>!/^[a-zA-Z0-9_.-]+$/.test(s)&&s?Promise.reject("账号只能为字母、数字、“-”、“_”,“.”的组合"):Promise.resolve()}],nick_name:[{message:"请输入昵称",required:!0}],avatar_url:[{message:"请上传头像",required:!0}],user_roles:[{message:"请选择成员角色",required:!0}],password:[{message:"请输入登录密码",required:!0},{validator:async(h,s)=>!fe(s)&&s?Promise.reject("密码必须包含字母、数字或者字符中的两种，6-32位"):Promise.resolve()}],check_password:[{message:"请输入确认密码",required:!0},{validator:async(h,s)=>s!=t.password&&s?Promise.reject("两次输入的密码不一致"):Promise.resolve()}]}),{resetFields:P,validate:$,validateInfos:y}=U(t,_),C=()=>{d.value="添加团队成员",i.value=!0,P(),t.user_name="",t.nick_name="",t.avatar="",t.avatar_url=oe,t.user_roles="3",t.password="",t.check_password="",t.id=""},n=h=>{d.value="编辑团队成员",t.user_name=h.user_name,t.nick_name=h.nick_name,t.avatar_url=h.avatar||oe,t.avatar="",t.user_roles=h.user_roles,t.password="",t.check_password="",t.id=h.id,delete _.password,delete _.check_password,i.value=!0},l=p(!1),m=()=>{$().then(()=>{let h={...ve(t)};delete h.avatar_url,l.value=!0,Ce(h).then(s=>{K.success(`${d.value}成功`),i.value=!1,M("ok")}).finally(()=>{l.value=!1})})};return g({add:C,edit:n}),(h,s)=>{const R=he,L=le,b=Ee,O=Je,T=ge,q=Z,u=W;return r(),k("div",null,[e(u,{open:i.value,"onUpdate:open":s[6]||(s[6]=v=>i.value=v),title:d.value,onOk:m,width:"476px"},{default:a(()=>[o("div",it,[e(q,{layout:"vertical"},{default:a(()=>[e(L,V({label:"登录账号"},A(y).user_name),{default:a(()=>[e(R,{disabled:t.id!="",type:"text",placeholder:"账号只能为字母、数字、“-”、“_”,“.”的组合",value:t.user_name,"onUpdate:value":s[0]||(s[0]=v=>t.user_name=v)},null,8,["disabled","value"])]),_:1},16),e(L,V({label:"成员昵称"},A(y).nick_name),{default:a(()=>[e(R,{maxlength:100,type:"text",placeholder:"请输入昵称",value:t.nick_name,"onUpdate:value":s[1]||(s[1]=v=>t.nick_name=v)},null,8,["value"])]),_:1},16),e(L,{label:"成员头像"},{default:a(()=>[e(nt,{value:t.avatar_url,"onUpdate:value":s[2]||(s[2]=v=>t.avatar_url=v),onChange:S},null,8,["value"])]),_:1}),e(L,V({label:"成员角色"},A(y).user_roles),{default:a(()=>[e(O,{value:t.user_roles,"onUpdate:value":s[3]||(s[3]=v=>t.user_roles=v),style:{width:"100%"},placeholder:"请选择成员角色"},{default:a(()=>[(r(!0),k(G,null,X(x.value,v=>(r(),D(b,{key:v.id,value:v.id},{default:a(()=>[z(w(v.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16),t.id?se("",!0):(r(),D(L,V({key:0,label:"登录密码"},A(y).password),{default:a(()=>[e(T,{value:t.password,"onUpdate:value":s[4]||(s[4]=v=>t.password=v),placeholder:"密码必须包含字母、数字或者字符中的两种，6-32位"},null,8,["value"])]),_:1},16)),t.id?se("",!0):(r(),D(L,V({key:1,label:"确认密码"},A(y).check_password),{default:a(()=>[e(T,{value:t.check_password,"onUpdate:value":s[5]||(s[5]=v=>t.check_password=v),placeholder:"请重新输入密码"},null,8,["value"])]),_:1},16))]),_:1})])]),_:1},8,["open","title"])])}}},_t=E(rt,[["__scopeId","data-v-9931da5a"]]),ut={class:"form-box"},dt={__name:"reset-password",emits:["ok"],setup(I,{expose:g,emit:f}){const M=f,U=Z.useForm,i=p(!1),d=p("重置登录密码"),t=Q({password:"",check_password:"",id:""}),S=Q({password:[{message:"请输入登录密码",required:!0},{validator:async(C,n)=>!fe(n)&&n?Promise.reject("密码必须包含字母、数字或者字符中的两种，6-32位"):Promise.resolve()}],check_password:[{message:"请输入确认密码",required:!0},{validator:async(C,n)=>n!=t.password&&n?Promise.reject("两次输入的密码不一致"):Promise.resolve()}]}),{resetFields:x,validate:_,validateInfos:P}=U(t,S),$=C=>{C.id,i.value=!0,x(),t.password="",t.check_password="",t.id=C.id},y=()=>{_().then(()=>{Le({...ve(t)}).then(C=>{K.success("修改成功"),i.value=!1,M("ok")})})};return g({open:$}),(C,n)=>{const l=ge,m=le,h=Z,s=W;return r(),k("div",null,[e(s,{open:i.value,"onUpdate:open":n[2]||(n[2]=R=>i.value=R),title:d.value,onOk:y,width:"476px"},{default:a(()=>[o("div",ut,[e(h,{layout:"vertical"},{default:a(()=>[e(m,V({label:"登录密码"},A(P).password),{default:a(()=>[e(l,{value:t.password,"onUpdate:value":n[0]||(n[0]=R=>t.password=R),placeholder:"密码必须包含字母、数字或者字符中的两种，6-32位"},null,8,["value"])]),_:1},16),e(m,V({label:"确认密码"},A(P).check_password),{default:a(()=>[e(l,{value:t.check_password,"onUpdate:value":n[1]||(n[1]=R=>t.check_password=R),placeholder:"请重新输入密码"},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open","title"])])}}},ct=E(dt,[["__scopeId","data-v-d0706fa4"]]),pt={key:0,class:"form-wrapper"},mt={class:"select"},vt={class:"tools-wrapper"},ft=["src"],ht={class:"item-name"},gt={key:1,class:"form-wrapper"},kt={class:"select"},yt={class:"tools-wrapper"},bt={class:"item-name"},wt={key:2,class:"form-wrapper"},xt={class:"select"},$t={class:"tools-wrapper"},Ct={class:"item-name"},Lt={__name:"see-model-alert",props:{robotList:{type:Array,default:null},libraryList:{type:Array,default:null},formList:{type:Array,default:null}},emits:["save"],setup(I,{expose:g,emit:f}){const M=f,U=I,i=p([]),d=p(""),t=p("");re();const S=p(!1),x=p([]),_=C=>{const n=[];return C.map(l=>{n.push(l.id)}),n},P=(C,n,l)=>{i.value=[],t.value=C,t.value==="robot"?(x.value=U.robotList,d.value="添加成员管理的机器人",n&&n==="edit"&&(d.value="编辑成员管理的机器人",l&&(i.value=_(l.managed_robot_list)))):t.value==="library"?(x.value=U.libraryList,d.value="添加成员管理的知识库",n&&n==="edit"&&(d.value="编辑成员管理的知识库",l&&(i.value=_(l.managed_library_list)))):t.value==="form"&&(x.value=U.formList,d.value="添加成员管理的数据库",n&&n==="edit"&&(d.value="编辑成员管理的数据库",l&&(i.value=_(l.managed_form_list)))),S.value=!0},$=()=>{S.value=!1,M("save",i.value)},y=()=>{};return g({open:P}),(C,n)=>{const l=ke,m=ye,h=W;return r(),D(h,{class:"add-model-alert",width:"800px",open:S.value,"onUpdate:open":n[3]||(n[3]=s=>S.value=s),title:d.value,onOk:$,onCancel:y},{default:a(()=>[t.value==="robot"?(r(),k("div",pt,[o("div",mt," 已选择("+w(i.value.length)+") ",1),e(m,{class:"list-box",value:i.value,"onUpdate:value":n[0]||(n[0]=s=>i.value=s)},{default:a(()=>[(r(!0),k(G,null,X(x.value,s=>(r(),D(l,{class:"list-item",key:s.id,value:s.id},{default:a(()=>[o("div",vt,[o("img",{class:"model-logo",src:s.robot_avatar,alt:""},null,8,ft),o("div",ht,w(s.robot_name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):t.value==="library"?(r(),k("div",gt,[o("div",kt," 已选择("+w(i.value.length)+") ",1),e(m,{class:"list-box",value:i.value,"onUpdate:value":n[1]||(n[1]=s=>i.value=s)},{default:a(()=>[(r(!0),k(G,null,X(x.value,s=>(r(),D(l,{class:"list-item",key:s.id,value:s.id},{default:a(()=>[o("div",yt,[o("div",bt,w(s.library_name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):t.value==="form"?(r(),k("div",wt,[o("div",xt," 已选择("+w(i.value.length)+") ",1),e(m,{class:"list-box",value:i.value,"onUpdate:value":n[2]||(n[2]=s=>i.value=s)},{default:a(()=>[(r(!0),k(G,null,X(x.value,s=>(r(),D(l,{class:"list-item",key:s.id,value:s.id},{default:a(()=>[o("div",$t,[o("div",Ct,w(s.name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):se("",!0)]),_:1},8,["open","title"])}}},Ut=E(Lt,[["__scopeId","data-v-7e4cb232"]]),ee=I=>(pe("data-v-b0fd85fb"),I=I(),me(),I),Pt={class:"team-members-pages"},St={class:"list-box"},Ot={class:"user-box"},It=["src"],Mt={class:"name-info"},Rt={class:"user-name"},zt={class:"nick-name"},Tt={key:0,class:"list-content"},Ft=ee(()=>o("div",null,"全部",-1)),At=[Ft],jt={key:1,class:"list-content"},Dt=["onClick"],qt={key:2,class:"list-preview list-content"},Nt={style:{display:"inline"}},Yt={class:"list-item-box"},Et={class:"list-item"},Jt=["onClick"],Bt={key:0,class:"list-content"},Vt=ee(()=>o("div",null,"全部",-1)),Kt=[Vt],Qt={key:1,class:"list-content"},Ht=["onClick"],Gt={key:2,class:"list-preview list-content"},Xt={style:{display:"inline"}},Zt={class:"list-item-box"},Wt={class:"list-item"},ea=["onClick"],ta={key:0,class:"list-content"},aa=ee(()=>o("div",null,"全部",-1)),sa=[aa],oa={key:1,class:"list-content"},la=["onClick"],na={key:2,class:"list-preview list-content"},ia={style:{display:"inline"}},ra={class:"list-item-box"},_a={class:"list-item"},ua=["onClick"],da=ee(()=>o("span",{class:"disabled"},"编辑",-1)),ca=ee(()=>o("span",{class:"disabled"},"重置密码",-1)),pa=ee(()=>o("span",{class:"disabled"},"删除",-1)),ma=["onClick"],va=["onClick"],fa=["onClick"],ha={__name:"team-members",setup(I){const g=Ue();p(g.userInfo.user_id);const f=Q({page:1,size:10,total:0,search:""}),M=p([]),U=p([]),i=p([]),d=p(""),t=p(""),S=p(null),x=u=>{f.page=u.current,f.size=u.pageSize,y()},_=()=>{f.page=1,y()},P=p([]),$=u=>{let v=[];return u.map(N=>{v.push(N.name)}),v.join(", ")},y=()=>{let u={page:f.page,size:f.size,search:f.search};Pe(u).then(v=>{let N=v.data.list;N.forEach(j=>{j.create_time=ue(j.create_time*1e3).format("YYYY-MM-DD HH:mm"),j.managed_robot_list=j.managed_robot_list?JSON.parse(j.managed_robot_list):"",j.managed_library_list=j.managed_library_list?JSON.parse(j.managed_library_list):"",j.managed_form_list=j.managed_form_list?JSON.parse(j.managed_form_list):""}),P.value=N,f.total=+v.data.total})};_();const C=p(null),n=()=>{C.value.add()},l=u=>{C.value.edit(u)},m=p(null),h=u=>{m.value.open(u)},s=u=>{W.confirm({title:"提示?",icon:e(de),content:"确认删除该用户",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{Se({id:u.id}).then(v=>{K.success("删除成功"),y()})},onCancel(){}})},R=async()=>{await De().then(u=>{M.value=u.data}).catch(()=>{})},L=async()=>{await qe({type:""}).then(u=>{U.value=u.data}).catch(()=>{})},b=async()=>{await Ne().then(u=>{i.value=u.data}).catch(()=>{})},O=async(u,v)=>{u==="robot"?(await R(),d.value=u):u==="library"?(await L(),d.value=u):u==="form"&&(await b(),d.value=u),t.value=v.id,S.value.open(d.value)},T=async(u,v)=>{u==="robot"?(await R(),d.value=u):u==="library"?(await L(),d.value=u):u==="form"&&(await b(),d.value=u),t.value=v.id,S.value.open(d.value,"edit",v)},q=u=>{let v={user_id:t.value,t:d.value,id_list:u.join(",")};Oe(v).then(N=>{K.success("操作成功"),y()}).catch(()=>{})};return(u,v)=>{const N=ce,j=be,te=ie,Y=we,J=Be,F=Ie,H=xe;return r(),k("div",Pt,[e(te,{justify:"space-between"},{default:a(()=>[e(N,{type:"primary",onClick:n},{icon:a(()=>[e(A(ne))]),default:a(()=>[z(" 添加团队成员 ")]),_:1}),e(j,{value:f.search,"onUpdate:value":v[0]||(v[0]=c=>f.search=c),placeholder:"输入成员账号或昵称搜索",style:{width:"288px"},onSearch:_},null,8,["value"])]),_:1}),o("div",St,[e(H,{"data-source":P.value,pagination:{current:f.page,total:f.total,pageSize:f.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:x},{default:a(()=>[e(Y,{title:"成员名称","data-index":"user_name",width:"190px"},{default:a(({record:c})=>[o("div",Ot,[o("img",{src:c.avatar||A(oe),alt:""},null,8,It),o("div",Mt,[o("div",Rt,w(c.user_name),1),o("div",zt,w(c.nick_name),1)])])]),_:1}),e(Y,{title:"角色","data-index":"role_name",width:"100px"},{default:a(({record:c})=>[z(w(c.role_name),1)]),_:1}),e(Y,{"data-index":"managed_robot_list",width:"200px"},{title:a(()=>[z(" 管理的机器人 "),e(J,null,{title:a(()=>[z("所有者和管理员可以创建和管理全部机器人，成员只能管理分配的机器人。")]),default:a(()=>[e(A(ae))]),_:1})]),default:a(({record:c})=>[c.role_type==1||c.role_type==2?(r(),k("div",Tt,At)):c.managed_robot_list?(r(),k("div",qt,[e(J,null,{title:a(()=>[o("div",Nt,w($(c.managed_robot_list)),1)]),default:a(()=>[o("div",Yt,[o("div",Et,w($(c.managed_robot_list)),1)])]),_:2},1024),o("div",{class:"list-highlight edit",onClick:B=>T("robot",c)},[e(F,{name:"edit"})],8,Jt)])):(r(),k("div",jt,[o("div",{class:"list-highlight",onClick:B=>O("robot",c)},"添加",8,Dt)]))]),_:1}),e(Y,{"data-index":"managed_library_list",width:"200px"},{title:a(()=>[z(" 管理的知识库 "),e(J,null,{title:a(()=>[z("所有者和管理员可以创建和管理全部知识库，成员只能管理分配的知识库。")]),default:a(()=>[e(A(ae))]),_:1})]),default:a(({record:c})=>[c.role_type==1||c.role_type==2?(r(),k("div",Bt,Kt)):c.managed_library_list?(r(),k("div",Gt,[e(J,null,{title:a(()=>[o("div",Xt,w($(c.managed_library_list)),1)]),default:a(()=>[o("div",Zt,[o("div",Wt,w($(c.managed_library_list)),1)])]),_:2},1024),o("div",{class:"list-highlight edit",onClick:B=>T("library",c)},[e(F,{name:"edit"})],8,ea)])):(r(),k("div",Qt,[o("div",{class:"list-highlight",onClick:B=>O("library",c)},"添加",8,Ht)]))]),_:1}),e(Y,{"data-index":"managed_form_list",width:"200px"},{title:a(()=>[z(" 管理的数据库 "),e(J,null,{title:a(()=>[z("所有者和管理员可以创建和管理全部数据库，成员只能管理分配的数据库。")]),default:a(()=>[e(A(ae))]),_:1})]),default:a(({record:c})=>[c.role_type==1||c.role_type==2?(r(),k("div",ta,sa)):c.managed_form_list?(r(),k("div",na,[e(J,null,{title:a(()=>[o("div",ia,w($(c.managed_form_list)),1)]),default:a(()=>[o("div",ra,[o("div",_a,w($(c.managed_form_list)),1)])]),_:2},1024),o("div",{class:"list-highlight edit",onClick:B=>T("form",c)},[e(F,{name:"edit"})],8,ua)])):(r(),k("div",oa,[o("div",{class:"list-highlight",onClick:B=>O("form",c)},"添加",8,la)]))]),_:1}),e(Y,{title:"创建时间","data-index":"create_time",width:"190px"},{default:a(({record:c})=>[z(w(c.create_time),1)]),_:1}),e(Y,{title:"操作","data-index":"action",width:"230px"},{default:a(({record:c})=>[c.role_type=="1"?(r(),D(te,{key:0,gap:16},{default:a(()=>[da,ca,pa]),_:1})):(r(),D(te,{key:1,gap:16},{default:a(()=>[o("a",{onClick:B=>l(c)},"编辑",8,ma),o("a",{onClick:B=>h(c)},"重置密码",8,va),o("a",{onClick:B=>s(c)},"删除",8,fa)]),_:2},1024))]),_:1})]),_:1},8,["data-source","pagination"])]),e(_t,{ref_key:"addTeamMembersRef",ref:C,onOk:y},null,512),e(ct,{ref_key:"resetPasswordRef",ref:m,onOk:y},null,512),e(Ut,{ref_key:"seeModelAlertRef",ref:S,robotList:M.value,libraryList:U.value,formList:i.value,onSave:q},null,8,["robotList","libraryList","formList"])])}}},ga=E(ha,[["__scopeId","data-v-b0fd85fb"]]),ka={class:"form-box"},ya={class:"title-row"},ba={class:"check-num"},wa={__name:"add-role",emits:["ok"],setup(I,{expose:g,emit:f}){const M=f,U=Z.useForm,i=p([]),d=p({}),t=p(!1),S=p("添加角色"),x=p(""),_=Q({name:"",mark:"",role_type:""}),P=Q({name:[{message:"请输入角色名称",required:!0}]}),{resetFields:$,validate:y,validateInfos:C}=U(_,P),n=async()=>{await Me().then(L=>{i.value=L.data;for(let b=0;b<L.data.length;b++){const O=L.data[b];d.value[O.uni_key]=[]}})},l=async()=>{await n(),S.value="添加角色",x.value="",t.value=!0,_.name="",_.mark="",$()},m=L=>{S.value="编辑角色",x.value=L.id,Re({id:L.id}).then(b=>{let O=b.data,T=O.role_permission||[];_.name=O.name,_.mark=O.mark,_.role_type=O.role_type,d.value=h(i.value,T),t.value=!0})},h=(L,b)=>{let O={};return L.forEach(T=>{O[T.uni_key]=[];for(let q=0;q<T.children.length;q++){const u=T.children[q];b.includes(u.uni_key)&&O[T.uni_key].push(u.uni_key)}}),O},s=L=>{let b=[];for(let O in L)L[O].map(q=>{b.push(q)});return b},R=()=>{y().then(()=>{let L=s(d.value),b={id:x.value,mark:_.mark};_.role_type==0&&(b.name=_.name,b.role_type=_.role_type,b.uni_keys=L.join(",")),ze(b).then(O=>{t.value=!1,K.success("保存成功"),M("ok")})})};return je(()=>{n()}),g({add:l,edit:m}),(L,b)=>{const O=he,T=le,q=Ve,u=ie,v=ke,N=Ke,j=Qe,te=ye,Y=Z,J=W;return r(),k("div",null,[e(J,{open:t.value,"onUpdate:open":b[2]||(b[2]=F=>t.value=F),title:S.value,onOk:R,width:"746px"},{default:a(()=>[o("div",ka,[e(Y,{layout:"vertical"},{default:a(()=>[e(T,V({label:"角色名称"},A(C).name),{default:a(()=>[e(O,{type:"text",maxlength:100,disabled:_.role_type>0,placeholder:"请输入角色名称",value:_.name,"onUpdate:value":b[0]||(b[0]=F=>_.name=F)},null,8,["disabled","value"])]),_:1},16),e(T,{label:"角色备注"},{default:a(()=>[e(q,{value:_.mark,"onUpdate:value":b[1]||(b[1]=F=>_.mark=F),placeholder:"请输入角色备注"},null,8,["value"])]),_:1}),e(T,{label:"角色权限"},{default:a(()=>[(r(!0),k(G,null,X(i.value,F=>(r(),k("div",{class:"role-check-box",key:F.uni_key},[e(u,{class:"title-boock",justify:"space-between"},{default:a(()=>[o("div",ya,w(F.name),1),o("div",ba,w(d.value[F.uni_key].length)+"/"+w(F.children.length),1)]),_:2},1024),e(te,{value:d.value[F.uni_key],"onUpdate:value":H=>d.value[F.uni_key]=H,style:{width:"100%"}},{default:a(()=>[e(j,{gutter:[0,12]},{default:a(()=>[(r(!0),k(G,null,X(F.children,H=>(r(),D(N,{span:6,key:H.uni_key},{default:a(()=>[e(v,{disabled:_.role_type>0,value:H.uni_key},{default:a(()=>[z(w(H.name),1)]),_:2},1032,["disabled","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])]))),128))]),_:1})]),_:1})])]),_:1},8,["open","title"])])}}},xa=E(wa,[["__scopeId","data-v-bb48065b"]]),$a={class:"team-members-pages"},Ca={class:"list-box"},La={__name:"role-permissions",setup(I){p("");const g=Q({page:1,size:10,total:0,search:""}),f=p([{}]),M=_=>{g.page=_.current,g.size=_.pageSize,i()},U=()=>{g.page=1,i()},i=()=>{let _={page:g.page,size:g.size,search:g.search};_e(_).then(P=>{let $=P.data.list;$.forEach(y=>{y.update_time=ue(y.update_time*1e3).format("YYYY-MM-DD HH:mm")}),f.value=$,g.total=+P.data.total})};U();const d=p(null),t=()=>{d.value.add()},S=_=>{d.value.edit(_)},x=_=>{W.confirm({title:"提示?",icon:e(de),content:"确认删除该角色",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{Te({id:_.id}).then(P=>{K.success("删除成功"),i()})},onCancel(){}})};return(_,P)=>{const $=ce,y=be,C=ie,n=we,l=xe;return r(),k("div",$a,[e(C,{justify:"space-between"},{default:a(()=>[e($,{type:"primary",onClick:t},{icon:a(()=>[e(A(ne))]),default:a(()=>[z(" 添加角色 ")]),_:1}),e(y,{value:g.search,"onUpdate:value":P[0]||(P[0]=m=>g.search=m),placeholder:"输入角色名称",style:{width:"288px"},onSearch:U},null,8,["value"])]),_:1}),o("div",Ca,[e(l,{"data-source":f.value,pagination:{current:g.page,total:g.total,pageSize:g.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:M},{default:a(()=>[e(n,{title:"角色","data-index":"name",width:"157px"},{default:a(({record:m})=>[z(w(m.name),1)]),_:1}),e(n,{title:"备注","data-index":"mark",width:"480px"},{default:a(({record:m})=>[z(w(m.mark),1)]),_:1}),e(n,{title:"最近修改时间","data-index":"update_time",width:"150px"},{default:a(({record:m})=>[z(w(m.update_time),1)]),_:1}),e(n,{title:"最近修改人","data-index":"operate_name",width:"130px"},{default:a(({record:m})=>[z(w(m.operate_name),1)]),_:1}),e(n,{title:"创建人","data-index":"create_name",width:"130px"},{default:a(({record:m})=>[z(w(m.create_name),1)]),_:1}),e(n,{title:"操作","data-index":"action",width:"178px"},{default:a(({record:m})=>[e(C,{gap:16,class:"action-box"},{default:a(()=>[e($,{type:"link",onClick:h=>S(m)},{default:a(()=>[z("编辑")]),_:2},1032,["onClick"]),e($,{type:"link",onClick:h=>x(m),disabled:m.role_type<=3&&m.role_type>0},{default:a(()=>[z("删除")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","pagination"])]),e(xa,{ref_key:"addRoleRef",ref:d,onOk:i},null,512)])}}},Ua=E(La,[["__scopeId","data-v-e2c92e52"]]),Pa={class:"user-model-page"},Sa={class:"list-wrapper"},Oa={__name:"index",setup(I){const g=p(1),f=()=>{g.value};return(M,U)=>(r(),k("div",Pa,[e(Ze,{value:g.value,"onUpdate:value":U[0]||(U[0]=i=>g.value=i),onChange:f},null,8,["value"]),o("div",Sa,[g.value==1?(r(),D(ga,{key:0})):(r(),D(Ua,{key:1}))])]))}},Ts=E(Oa,[["__scopeId","data-v-752bf84e"]]);export{Ts as default};
