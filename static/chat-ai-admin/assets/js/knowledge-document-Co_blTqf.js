import{_ as Ha}from"./cu-scroll-CpIj948h.js";import{u as Oe,aB as Wl,aC as Pa,aD as Ka,aE as Hl,aF as vt,aG as Pl,_ as Qt,aH as Kl,am as Xt,aI as Ba,aJ as Bl,aK as Yl,aL as Al,aM as Vl,d as Zt,aN as Ze,aO as jl,aP as Jl,aQ as Ql,aR as Xl,ae as Oa,c as Zl,ad as Ia,ac as Ra,aS as es,ax as ts,aT as as,aU as ls,ao as ss,aV as os,aW as ns,aX as is,aY as _s}from"../../index-DSFcP5NQ.js";import{c as de,E as ce,V as Ya,a as d,b as _,y as a,t as o,p as e,z as ft,v as s,u as t,e as q,q as m,F as A,l as be,_ as h,Y as oe,ag as ea,ah as yt,r as v,j as jt,n as Aa,h as ve,m as rs,a1 as Jt,J as us,am as ds,i as cs,D as Ua}from"./vue-chunks-BdaA73Wf.js";import{d as qe}from"./utils-CvB22N-W.js";import{_ as Ie}from"./emoji-mart-BBMRoEa3.js";import{w as ps,q as ta,a4 as fs,a9 as aa,b0 as ms,b1 as vs,aa as gs,b2 as hs,x as Va,b as B,M as ye,O as gt,m as ja,J as la,u as bt,v as kt,D as sa,aq as ys,I as Ke,a1 as Xe,W as mt,i as Ja,am as Qe,f as Qa,g as Xa,B as oa,ah as Za,b3 as bs,aQ as ks,F as ht,c as zt,r as el,s as tl,N as ws,aP as al,_ as xs,b4 as Cs,k as $s,j as qs,H as Ss,aH as za,au as Ta,av as Ls,a0 as Ds,aX as Ms,ag as Os,ad as Bt,aO as It,b5 as Yt,b6 as Is,a6 as Rs,ac as Us,V as zs}from"./ui-antd-Dl1wwwCD.js";import{E as Ts}from"./edit-subsection-BwSyKVRx.js";import{M as ll,R as Fs}from"./rename-modal-WfG-X_fj.js";import{U as sl}from"./upload-input-C5mRP3pq.js";import{t as Fa}from"./validate-8MtiUsxW.js";import{M as Ea}from"./model-select-CMPvMrAQ.js";import{O as Es}from"./open-grapg-modal-wgsaRjH8.js";import{_ as Ns}from"./page-alert-DLppgA58.js";import{_ as Gs}from"./default-cover-Bm8pZ2KF.js";const Ws={class:"subsection-box"},Hs=["onDblclick"],Ps={class:"list-item"},Ks={class:"list-label"},Bs={class:"list-content"},Ys={class:"status-error"},As=["onClick","innerHTML"],Vs={class:"similar-question-list"},js={class:"list-item list-item-answer"},Js={class:"list-label"},Qs=["innerHTML"],Xs={class:"fragment-img"},Zs=["src"],eo={class:"zm-line1"},to={class:"zm-line1"},ao={class:"right-opration"},lo=["onClick"],so=["onClick"],oo=["onClick"],no=["onClick"],io={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isLoading:{type:Boolean,default:!1},search:{type:String,default:""}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleSort","getList"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.qa-knowledge-document.components.subsection-box"),Q=l,U=E,Z=de(()=>{var F,K;return((K=(F=U.paragraphLists)==null?void 0:F[0])==null?void 0:K.meta_list)||[]}),N=ce({selectedRowKeys:[]}),R=F=>{N.selectedRowKeys=F},L=()=>{N.selectedRowKeys=[]},f=F=>{Q("openEditSubscription",F)},V=F=>{ye.confirm({title:p("title_hint"),icon:a(gt),content:p("msg_confirm_delete"),onOk(){return new Promise((K,J)=>{Pa({id:F}).then(ne=>{B.success(p("msg_delete_success")),Q("handleDelParagraph",F),K()}).catch(()=>{K()})})},onCancel(){}})},S=(F,K)=>{Wl({id:F.id,category_id:K}).then(J=>{B.success(p("msg_set_success")),Q("getList")})},x=(F,K,J)=>{let ne=J.field,D=J.order;D?D=D==="ascend"?"asc":"desc":ne="",Q("handleSort",{sort_field:ne,sort_type:D})};function P(F,K,J={}){if(!K||!F)return F;const{highlightClass:ne="highlight",caseSensitive:D=!1,wholeWord:k=!1}=J,G=D?"g":"gi";let g;return k?g=new RegExp(`\\b${C(K)}\\b`,G):g=new RegExp(C(K),G),F.replace(g,b=>`<span class="${ne}">${b}</span>`)}function C(F){return F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return y({handleOpenEditModal:f,state:N,resetSelect:L}),(F,K)=>{const J=ta,ne=aa,D=ps,k=Va,G=Ya("viewer");return _(),d("div",Ws,[a(k,{"data-source":E.paragraphLists,"row-key":"id","row-selection":{selectedRowKeys:N.selectedRowKeys,onChange:R},pagination:!1,loading:U.isLoading,scroll:{x:1200},onChange:x},{default:o(()=>[a(D,{key:"id","data-index":"id",width:1148},{title:o(()=>[h(s(t(p)("title_qa_total",{total:U.total})),1)]),default:o(({record:g})=>[e("div",{class:"qa-list-box",onDblclick:b=>f(g)},[e("div",Ps,[e("div",Ks,s(t(p)("label_question")),1),e("div",Bs,[g.status==2?(_(),q(J,{key:0,placement:"top"},{title:o(()=>[e("span",null,s(g.errmsg),1)]),default:o(()=>[e("span",null,[e("span",Ys,[a(t(fs))])])]),_:2},1024)):m("",!0),e("span",{onClick:b=>f(g),innerHTML:P(g.question,U.search),class:"question-text"},null,8,As),g.similar_questions&&g.similar_questions.length?(_(),q(ne,{key:1,placement:"topLeft",overlayInnerStyle:{"padding-right":"2px"}},{content:o(()=>[e("div",Vs,[(_(!0),d(A,null,be(g.similar_questions,(b,X)=>(_(),d("div",{class:"similar-question-list-item",key:X},s(b),1))),128))])]),title:o(()=>[e("span",null,s(t(p)("msg_similar_questions",{length:g.similar_questions.length})),1)]),default:o(()=>[e("a",null,"（"+s(g.similar_questions.length)+"）",1)]),_:2},1024)):m("",!0)])]),e("div",js,[e("div",Js,s(t(p)("label_answer")),1),e("div",{class:"list-content",innerHTML:P(g.answer,U.search)},null,8,Qs)]),ft((_(),d("div",Xs,[(_(!0),d(A,null,be(g.images,(b,X)=>(_(),d("img",{key:X,src:b,alt:""},null,8,Zs))),128))])),[[G]])],40,Hs)]),_:1}),a(D,{title:t(p)("col_total"),key:"total_hits","data-index":"total_hits",width:108,sorter:!0},null,8,["title"]),a(D,{title:t(p)("col_yesterday"),key:"yesterday_hits","data-index":"yesterday_hits",width:108,sorter:!0},null,8,["title"]),a(D,{title:t(p)("col_today"),key:"today_hits","data-index":"today_hits",width:108,sorter:!0},null,8,["title"]),(_(!0),d(A,null,be(Z.value,g=>(_(),q(D,{key:`meta_${g.key}`,"data-index":`meta_${g.key}`,width:160},{title:o(()=>{var b;return[a(J,{title:((b=g.name)==null?void 0:b.length)>8?g.name:""},{default:o(()=>[e("div",eo,s(g.name),1)]),_:2},1032,["title"])]}),default:o(({record:b})=>{var X;return[a(J,{title:((X=b[`meta_${g.key}`])==null?void 0:X.length)>8?b[`meta_${g.key}`]:""},{default:o(()=>[e("div",to,s(b[`meta_${g.key}`]),1)]),_:2},1032,["title"])]}),_:2},1032,["data-index"]))),128)),a(D,{title:t(p)("col_action"),key:"action","data-index":"action",width:120,fixed:"right"},{default:o(({record:g,index:b})=>[e("div",ao,[g.category_id>0?(_(),d("div",{key:0,class:"hover-btn-box",onClick:X=>S(g,0)},[a(t(ms),{style:{color:"#F59A23"}})],8,lo)):(_(),d("div",{key:1,class:"hover-btn-box",onClick:X=>S(g,4)},[a(t(vs))],8,so)),e("div",{class:"hover-btn-box",onClick:oe(X=>f(g),["stop"])},[a(t(gs))],8,oo),e("div",{class:"hover-btn-box",onClick:oe(X=>V(g.id),["stop"])},[a(t(hs))],8,no)])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection","loading"])])}}},_o=Ie(io,[["__scopeId","data-v-a2ca5c69"]]),ro={class:"alert-box"},uo={href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ导入模板.docx"},co={href:"https://xkf-upload-oss.xiaokefu.com.cn/static/chat-wiki/template/FAQ 导入模板.xlsx"},po={class:"upload-file-box"},fo={key:0,class:"hight-set"},mo={key:0,class:"set-box"},vo={class:"form-item"},go={class:"form-item-label required"},ho={class:"form-item-body"},yo={class:"form-item"},bo={class:"form-item-label"},ko={class:"form-item-body"},wo={class:"form-item"},xo={class:"form-item-label required"},Co={class:"form-item-body"},$o={key:1,class:"set-box"},qo={class:"form-item"},So={class:"form-item-label"},Lo={class:"form-item-body"},Do={class:"form-item"},Mo={class:"form-item-label"},Oo={class:"form-item-body"},Io={class:"form-item"},Ro={class:"form-item-label"},Uo={class:"form-item-body"},zo={__name:"qa-upload-modal",props:{library_id:{type:[Number,String],default:()=>""},groupLists:{type:Array,default:()=>[]}},emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.components.qa-upload-modal"),Q=Ka(),{qa_index_type:U}=Q;ea();const N=yt().query,R=v(!1),L=v(!1),f=v([]),V=l,S=v([]),x=E,P=de(()=>x.library_id||N.id),C=ce({question_column:void 0,answer_column:void 0,similar_column:void 0,question_lable:"label_question",answer_lable:"label_answer",similar_label:"label_similar_question",group_id:void 0}),F=v(!0),K=g=>{C.group_id=void 0,g>=0&&(C.group_id=g),R.value=!0},J=()=>{let g=new FormData;f.value.forEach(b=>{g.append("library_files",b)}),Hl(g).then(b=>{let X=[];for(let ae in b.data)X.push({lable:b.data[ae],value:ae});S.value=X})},ne=()=>{if(f.value.length==0){B.error(p("msg_select_file"));return}L.value=!0;let g=new FormData;g.append("library_id",P.value);let b=!1;if(f.value.forEach(X=>{(X.name.includes(".xlsx")||X.name.includes(".csv"))&&(b=!0),g.append("library_files",X)}),b){if(!C.question_column)return L.value=!1,B.error(p("msg_select_question_column"));if(!C.answer_column)return L.value=!1,B.error(p("msg_select_answer_column"));g.append("question_column",C.question_column),g.append("answer_column",C.answer_column),C.similar_column&&g.append("similar_column",C.similar_column)}else g.append("question_lable",p(C.question_lable)),g.append("answer_lable",p(C.answer_lable)),g.append("similar_label",p(C.similar_label));g.append("group_id",C.group_id>=0?C.group_id:0),g.append("is_qa_doc",1),g.append("qa_index_type",U),vt(g).then(X=>{V("ok"),R.value=!1,f.value=[],L.value=!1}).catch(()=>{L.value=!1})},D=()=>{f.value=[]},k=v(1),G=g=>{C.question_column=void 0,C.answer_column=void 0,C.similar_column=void 0,C.question_lable="label_question",C.answer_lable="label_answer",C.similar_label="label_similar_question",f.value=g,g&&g.length>0&&(g[0].type.includes(".document")?k.value=2:(k.value=1,J()))};return y({show:K}),(g,b)=>{const X=ja,ae=kt,Y=bt,xe=la,W=Ke,ie=ye;return _(),d("div",null,[a(ie,{width:680,open:R.value,"onUpdate:open":b[9]||(b[9]=M=>R.value=M),"confirm-loading":L.value,maskClosable:!1,title:t(p)("title_upload_document"),onOk:ne,onCancel:D},{default:o(()=>[e("div",ro,[a(X,{"show-icon":""},{message:o(()=>[e("div",null,[h(s(t(p)("msg_import_via_word_excel")),1),e("a",uo,s(t(p)("label_word_template")),1),b[10]||(b[10]=h("  ",-1)),e("a",co,s(t(p)("label_excel_template")),1),h(s(t(p)("msg_create_import_document")),1)]),e("div",null,s(t(p)("msg_specify_extraction_rules")),1),e("div",null,s(t(p)("msg_duplicate_question_override")),1)]),_:1})]),a(xe,{align:"center",style:{margin:"16px 0"}},{default:o(()=>[e("div",null,s(t(p)("label_belong_group")),1),a(Y,{value:C.group_id,"onUpdate:value":b[0]||(b[0]=M=>C.group_id=M),style:{flex:"1"},placeholder:t(p)("ph_select_group")},{default:o(()=>[(_(!0),d(A,null,be(x.groupLists.filter(M=>M.id>=0),M=>(_(),q(ae,{value:M.id},{default:o(()=>[h(s(M.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","placeholder"])]),_:1}),e("div",po,[a(sl,{type:2,value:f.value,"onUpdate:value":b[1]||(b[1]=M=>f.value=M),onChange:G},null,8,["value"])]),f.value.length>0?(_(),d("div",fo,[e("a",{onClick:b[2]||(b[2]=M=>F.value=!F.value)},[h(s(t(p)("label_advanced_settings"))+" ",1),F.value?(_(),q(t(ys),{key:1})):(_(),q(t(sa),{key:0}))]),F.value?(_(),d(A,{key:0},[k.value==1?(_(),d("div",mo,[e("div",vo,[e("div",go,s(t(p)("label_question_column")),1),e("div",ho,[a(Y,{value:C.question_column,"onUpdate:value":b[3]||(b[3]=M=>C.question_column=M),placeholder:t(p)("ph_select_column"),style:{width:"100%"}},{default:o(()=>[(_(!0),d(A,null,be(S.value,M=>(_(),q(ae,{value:M.value,key:M.value},{default:o(()=>[h(s(M.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),e("div",yo,[e("div",bo,s(t(p)("label_similar_question_column")),1),e("div",ko,[a(Y,{value:C.similar_column,"onUpdate:value":b[4]||(b[4]=M=>C.similar_column=M),placeholder:t(p)("ph_select_similar_question_column"),style:{width:"100%"}},{default:o(()=>[(_(!0),d(A,null,be(S.value,M=>(_(),q(ae,{value:M.value,key:M.value},{default:o(()=>[h(s(M.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])]),e("div",wo,[e("div",xo,s(t(p)("label_answer_column")),1),e("div",Co,[a(Y,{value:C.answer_column,"onUpdate:value":b[5]||(b[5]=M=>C.answer_column=M),placeholder:t(p)("ph_select_answer_column"),style:{width:"100%"}},{default:o(()=>[(_(!0),d(A,null,be(S.value,M=>(_(),q(ae,{value:M.value,key:M.value},{default:o(()=>[h(s(M.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])])])])):m("",!0),k.value==2?(_(),d("div",$o,[e("div",qo,[e("div",So,s(t(p)("label_question_start_marker")),1),e("div",Lo,[a(W,{placeholder:t(p)("ph_input_marker"),value:C.question_lable,"onUpdate:value":b[6]||(b[6]=M=>C.question_lable=M)},null,8,["placeholder","value"])])]),e("div",Do,[e("div",Mo,s(t(p)("label_similar_question_start_marker")),1),e("div",Oo,[a(W,{placeholder:t(p)("ph_input_marker"),value:C.similar_label,"onUpdate:value":b[7]||(b[7]=M=>C.similar_label=M)},null,8,["placeholder","value"])])]),e("div",Io,[e("div",Ro,s(t(p)("label_answer_start_marker")),1),e("div",Uo,[a(W,{placeholder:t(p)("ph_input_marker"),value:C.answer_lable,"onUpdate:value":b[8]||(b[8]=M=>C.answer_lable=M)},null,8,["placeholder","value"])])])])):m("",!0)],64)):m("",!0)])):m("",!0)]),_:1},8,["open","confirm-loading","title"])])}}},ol=Ie(zo,[["__scopeId","data-v-fdf08188"]]),To={class:"form-item"},Fo={class:"form-label"},Eo={class:"form-content"},No={__name:"add-group",props:{group_type:{type:[Number,String],default:0}},emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.qa-knowledge-document.components.add-group"),Q=yt().query,U=v(!1),Z=l,N=v(!1),R=de(()=>N.value?p("title_edit_group"):p("title_create_group")),L=E,f=ce({group_name:"",id:"",library_id:Q.id}),V=x=>{f.group_name=x.group_name||"",f.id=x.id||"",N.value=!!x.id,f.library_id=x.library_id,U.value=!0},S=()=>{if(!f.group_name)return B.error(p("msg_group_name_required"));Pl({...f,group_type:L.group_type}).then(x=>{B.success(N.value?p("msg_edit_group_success"):p("msg_create_group_success")),U.value=!1,Z("ok")})};return y({show:V}),(x,P)=>{const C=Ke,F=ye;return _(),d("div",null,[a(F,{open:U.value,"onUpdate:open":P[1]||(P[1]=K=>U.value=K),title:R.value,onOk:S},{default:o(()=>[e("div",To,[e("div",Fo,s(t(p)("label_group_name")),1),e("div",Eo,[a(C,{maxLength:15,value:f.group_name,"onUpdate:value":P[0]||(P[0]=K=>f.group_name=K),placeholder:t(p)("ph_input_group_name")},null,8,["value","placeholder"])])])]),_:1},8,["open","title"])])}}},nl=Ie(No,[["__scopeId","data-v-5c286fed"]]),Go={class:"qa-list-wrapper"},Wo={class:"group-head-box"},Ho={class:"head-title"},Po={class:"flex-between-box"},Ko={class:"search-box"},Bo={class:"classify-box"},Yo=["onClick"],Ao={class:"classify-title"},Vo={class:"right-content"},jo={key:0,class:"btn-box"},Jo={class:"hover-btn-wrap"},Qo=["onClick"],Xo=["onClick"],Zo={class:"main-content-box"},en={class:"head-content"},tn={class:"title"},an={class:"pover-group-content-box"},ln={class:"group-head-box"},sn={class:"head-title"},on={class:"flex-between-box"},nn={class:"search-box"},_n={class:"classify-box classify-scroll-box"},rn=["onClick"],un={class:"classify-title"},dn={class:"right-content"},cn={key:0,class:"btn-box"},pn={class:"hover-btn-wrap"},fn=["onClick"],mn=["onClick"],vn={class:"btn-right-box"},gn={class:"des-content-block"},hn={key:0,class:"alert-icon-box"},yn={class:"content-block"},bn={class:"pagination-box"},kn={class:"form-label"},Na="qa_document_group_box_width",Rt=200,At=256,wn={__name:"index",props:{library_id:{type:[Number,String],default:()=>""}},setup(E){const{t:y}=Oe("views.library.library-details.qa-knowledge-document.index"),l=v(null),p=v(null),U=yt().query,Z=v(""),N=v([]),R=v(-1),L=v([]),f=de(()=>N.value.find(T=>T.id==R.value)||{}),V=de(()=>N.value.filter(T=>T.group_name.includes(Z.value))),S=E,x=de(()=>S.library_id||U.id),P=v([]),C=v(localStorage.getItem("qa_document_group_hide_key")==1),F=v(0),K=v(0),J={1:"本地文档",2:"在线文档",3:"自定义文档",4:"手工新增问答",5:"导入问答"},ne={0:y("not_converted"),1:y("converted"),2:y("convert_error"),3:y("converting")},D=v({is_qa_doc:"1",library_id:x.value}),k=v({page:1,size:100}),G=ce({status:-1,category_id:-1,sort_field:"",sort_type:"",library_id:x.value,search:""}),g=T=>{G.sort_field=T.sort_field,G.sort_type=T.sort_type,b()},b=()=>{k.value.page=1,M()},X=(T,O)=>{k.value.page=T,k.value.size=O,M()},ae=()=>{C.value=!C.value,localStorage.setItem("qa_document_group_hide_key",C.value?1:2)},Y=()=>{Yl({id:x.value}).then(()=>{B.success(y("operation_complete")),M()})},xe=v(null),W=T=>{T.group_id||R.value>=0&&(T.group_id=R.value),xe.value.showModal(JSON.parse(JSON.stringify(T)))},ie=v(!1),M=()=>{ie.value=!0,Kl({...k.value,...G,group_id:R.value}).then(T=>{ie.value=!1;let O=T.data,we=O.list||[];we.forEach(fe=>{fe.status_text=ne[fe.status],fe.similar_questions&&(fe.similar_questions=JSON.parse(fe.similar_questions)),Array.isArray(fe.meta_list)&&fe.meta_list.forEach(re=>{re.type==1&&re.value>0&&(re.value=qe(re.value*1e3).format("YYYY-MM-DD HH:mm")),re.key=="source"&&(re.value=J[re.value]),fe[`meta_${re.key}`]=re.value})}),P.value=we,F.value=O.total,K.value=O.exception_total,l.value&&l.value.resetSelect()})};M();const Ee=()=>{Xt({library_id:x.value}).then(T=>{let we=(T.data||[]).reduce((fe,re)=>fe+ +re.total,0);N.value=[{group_name:y("all_groups"),id:-1,total:we},...T.data]})};Ee();const wt=v(null),Se=T=>{wt.value.show({...T,library_id:x.value})},Ue=()=>{Ee(),M()},et=T=>{R.value=T.id,b()},Ce=T=>{ye.confirm({title:`${y("confirm_delete_group")}${T.group_name}`,icon:a(gt),content:"",okText:y("confirm"),okType:"danger",cancelText:y("cancel"),onOk(){Ba({id:T.id}).then(()=>{B.success(y("delete_success")),Ee(),R.value==T.id&&(R.value=-1,b())})}})},pe=v(null),Tt=()=>{pe.value.show(R.value)},Be=v(!1),ze=ce({group_id:void 0,ids:""}),Le=()=>{if(l.value.state.selectedRowKeys.length==0)return B.error(y("select_qa_to_move"));ze.ids=l.value.state.selectedRowKeys.join(","),ze.group_id=void 0,Be.value=!0},le=()=>{if(l.value.state.selectedRowKeys.length==0)return B.error(y("select_qa_to_delete"));ye.confirm({title:y("tip"),icon:a(gt),content:y("confirm_delete_selected"),onOk(){Pa({id:l.value.state.selectedRowKeys.join(",")}).then(T=>{B.success(y("delete_success")),M()})},onCancel(){}})},Ye=()=>{if(!ze.group_id)return B.error(y("select_group_tip"));Vl({...ze}).then(()=>{Be.value=!1,B.success(y("move_success")),Ue()})},Te=v(Rt),tt=v(!1);jt(()=>{const T=parseInt(localStorage.getItem(Na));T&&T>=Rt&&T<=At&&(Te.value=T)});let Re=!1,at=0,Ae=0;const lt=T=>{C.value||(Re=!0,tt.value=!0,at=T.clientX,Ae=Te.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",st),document.addEventListener("mouseup",xt))},st=T=>{if(!Re)return;let O=Ae+(T.clientX-at);O=Math.max(Rt,Math.min(At,O)),Te.value=O},xt=()=>{Re&&(Re=!1,tt.value=!1,localStorage.setItem(Na,Te.value),document.body.style.cursor="",document.removeEventListener("mousemove",st),document.removeEventListener("mouseup",xt))},Ve=v(!1),Ft=()=>{let T="";l.value.state.selectedRowKeys.length>0&&(T=l.value.state.selectedRowKeys.join(",")),Bl({library_id:U.id,export_type:2,group_id:R.value,data_ids:T}).then(O=>{Ve.value=!0})},Et=()=>{Al.push({path:"/library/details/export-record",query:U})},ot=T=>{if(T==2){if(l.value.state.selectedRowKeys.length==0)return B.error(y("select_qa_to_modify"));L.value=l.value.state.selectedRowKeys}p.value.show(T==2)};return(T,O)=>{const we=Qt,fe=ta,re=Ke,De=Xa,nt=Qa,it=Ja,Ct=Ha,Me=aa,$=oa,Nt=bs,ke=kt,$t=bt,qt=la,Ne=ye,St=ks;return _(),d(A,null,[e("div",Go,[e("div",{class:ve(["group-content-box",[{collapsed:C.value},{"no-transition":tt.value}]]),style:Aa(C.value?{}:{width:Te.value+"px",minWidth:Rt+"px",maxWidth:At+"px"})},[e("div",Wo,[e("div",Ho,[a(fe,{title:t(y)("collapse_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:ae},[a(we,{name:"put-away"})])]),_:1},8,["title"]),e("div",Po,[e("div",null,s(t(y)("qa_group")),1),a(fe,{title:t(y)("create_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:O[0]||(O[0]=I=>Se({}))},[a(t(Xe))])]),_:1},8,["title"])])]),e("div",Ko,[a(re,{value:Z.value,"onUpdate:value":O[2]||(O[2]=I=>Z.value=I),allowClear:"",placeholder:t(y)("search_group"),style:{width:"100%"}},{suffix:o(()=>[a(t(mt),{onClick:O[1]||(O[1]=oe(()=>{},["stop"]))})]),_:1},8,["value","placeholder"])])]),e("div",Bo,[a(Ct,{style:{"padding-right":"24px"}},{default:o(()=>[(_(!0),d(A,null,be(V.value,I=>(_(),d("div",{class:ve(["classify-item",{active:I.id==R.value}]),onClick:Ge=>et(I),key:I.id},[e("div",Ao,s(I.group_name),1),e("div",Vo,[e("div",{class:ve(["num",{"num-block":I.id<=0}])},s(I.total),3),I.id>0?(_(),d("div",jo,[a(it,{placement:"bottomRight"},{overlay:o(()=>[a(nt,null,{default:o(()=>[a(De,null,{default:o(()=>[e("div",{onClick:oe(Ge=>Se(I),["stop"])},s(t(y)("rename")),9,Qo)]),_:2},1024),a(De,null,{default:o(()=>[e("div",{onClick:oe(Ge=>Ce(I),["stop"])},s(t(y)("delete")),9,Xo)]),_:2},1024)]),_:2},1024)]),default:o(()=>[e("div",Jo,[a(t(Qe))])]),_:2},1024)])):m("",!0)])],10,Yo))),128))]),_:1})]),C.value?m("",!0):(_(),d("div",{key:0,class:"resize-bar",onMousedown:lt},null,32))],6),e("div",Zo,[a(Ct,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:o(()=>[e("div",en,[e("div",tn,[C.value?(_(),q(Me,{key:0,title:null,placement:"bottom"},{content:o(()=>[e("div",an,[e("div",ln,[e("div",sn,[e("div",on,[e("div",null,s(t(y)("qa_group")),1),a(fe,{title:t(y)("create_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:O[3]||(O[3]=I=>Se({}))},[a(t(Xe))])]),_:1},8,["title"])])]),e("div",nn,[a(re,{allowClear:"",value:Z.value,"onUpdate:value":O[5]||(O[5]=I=>Z.value=I),placeholder:t(y)("search_group"),style:{width:"100%"}},{suffix:o(()=>[a(t(mt),{onClick:O[4]||(O[4]=oe(()=>{},["stop"]))})]),_:1},8,["value","placeholder"])])]),e("div",_n,[(_(!0),d(A,null,be(V.value,I=>(_(),d("div",{class:ve(["classify-item",{active:I.id==R.value}]),onClick:Ge=>et(I),key:I.id},[e("div",un,s(I.group_name),1),e("div",dn,[e("div",{class:ve(["num",{"num-block":I.id<=0}])},s(I.total),3),I.id>0?(_(),d("div",cn,[a(it,{placement:"bottomRight"},{overlay:o(()=>[a(nt,null,{default:o(()=>[a(De,null,{default:o(()=>[e("div",{onClick:oe(Ge=>Se(I),["stop"])},s(t(y)("rename")),9,fn)]),_:2},1024),a(De,null,{default:o(()=>[e("div",{onClick:oe(Ge=>Ce(I),["stop"])},s(t(y)("delete")),9,mn)]),_:2},1024)]),_:2},1024)]),default:o(()=>[e("div",pn,[a(t(Qe))])]),_:2},1024)])):m("",!0)])],10,rn))),128))])])]),default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:ae},[a(we,{name:"expand"})])]),_:1})):m("",!0),e("div",null,s(f.value.group_name),1),e("div",vn,[e("div",null,[a(re,{onChange:b,value:G.search,"onUpdate:value":O[6]||(O[6]=I=>G.search=I),placeholder:t(y)("search_qa")},{suffix:o(()=>[a(t(mt))]),_:1},8,["value","placeholder"])]),a($,{onClick:O[7]||(O[7]=I=>ot(1))},{default:o(()=>[h(s(t(y)("metadata"))+" ",1),a(t(Za))]),_:1}),a(it,null,{overlay:o(()=>[a(nt,null,{default:o(()=>[a(De,{key:"1"},{default:o(()=>[e("div",{onClick:le},s(t(y)("batch_delete")),1)]),_:1}),a(De,{key:"2"},{default:o(()=>[e("div",{onClick:Le},s(t(y)("batch_move")),1)]),_:1}),a(De,{key:"2"},{default:o(()=>[e("div",{onClick:O[8]||(O[8]=I=>ot(2))},s(t(y)("modify_metadata")),1)]),_:1})]),_:1})]),default:o(()=>[a($,null,{default:o(()=>[h(s(t(y)("batch_operation"))+" ",1),a(t(sa))]),_:1})]),_:1}),a($,{onClick:O[9]||(O[9]=I=>Tt())},{default:o(()=>[h(s(t(y)("batch_import")),1)]),_:1}),a($,{onClick:O[10]||(O[10]=I=>Ft())},{default:o(()=>[h(s(t(y)("batch_export")),1)]),_:1}),a($,{onClick:O[11]||(O[11]=I=>W({})),type:"primary",icon:a(t(Xe))},{default:o(()=>[h(s(t(y)("qa")),1)]),_:1},8,["icon"])])]),e("div",gn,[K.value>0?(_(),d("div",hn,[a(we,{name:"alert-icon"}),e("div",null,s(K.value)+s(t(y)("learn_failed")),1),e("a",{onClick:Y},s(t(y)("re_learn")),1)])):m("",!0)])]),e("div",yn,[a(_o,{ref_key:"subsectionBoxRef",ref:l,total:F.value,isLoading:ie.value,paragraphLists:P.value,search:G.search,onOpenEditSubscription:W,onHandleDelParagraph:Ue,onGetList:M,onHandleSort:g},null,8,["total","isLoading","paragraphLists","search"]),e("div",bn,[a(Nt,{current:k.value.page,"onUpdate:current":O[12]||(O[12]=I=>k.value.page=I),"page-size":k.value.size,"onUpdate:pageSize":O[13]||(O[13]=I=>k.value.size=I),total:F.value,pageSizeOptions:["100","200","500","1000"],"show-size-changer":"",onChange:X},null,8,["current","page-size","total"])])])]),_:1})])]),a(Ts,{detailsInfo:D.value,onHandleEdit:Ue,ref_key:"editSubscriptionRef",ref:xe},null,8,["detailsInfo"]),a(nl,{ref_key:"addGroupRef",ref:wt,onOk:Ue},null,512),a(ol,{groupLists:N.value,library_id:E.library_id,onOk:Ue,ref_key:"qaUploadModalRef",ref:pe},null,8,["groupLists","library_id"]),a(Ne,{open:Be.value,"onUpdate:open":O[15]||(O[15]=I=>Be.value=I),title:t(y)("batch_move_group"),onOk:Ye},{default:o(()=>[a(qt,{class:"move-group-form",align:"center",style:{margin:"24px 0"}},{default:o(()=>[e("div",kn,s(t(y)("move_to_group")),1),a($t,{value:ze.group_id,"onUpdate:value":O[14]||(O[14]=I=>ze.group_id=I),style:{flex:"1"},placeholder:t(y)("select_group")},{default:o(()=>[(_(!0),d(A,null,be(N.value.filter(I=>I.id>=0),I=>(_(),q(ke,{key:I.id,value:I.id},{default:o(()=>[h(s(I.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1})]),_:1},8,["open","title"]),a(Ne,{open:Ve.value,"onUpdate:open":O[17]||(O[17]=I=>Ve.value=I),title:null,footer:null,width:640},{default:o(()=>[a(St,{status:"success",title:t(y)("export_task_created"),"sub-title":t(y)("export_task_desc")},{extra:o(()=>[a($,{style:{"margin-right":"16px"},onClick:O[16]||(O[16]=I=>Ve.value=!1)},{default:o(()=>[h(s(t(y)("got_it")),1)]),_:1}),a($,{onClick:Et,type:"primary"},{default:o(()=>[h(s(t(y)("go_download")),1)]),_:1})]),_:1},8,["title","sub-title"])]),_:1},8,["open"]),a(ll,{ref_key:"metaRef",ref:p,"library-id":x.value,"qa-ids":L.value,onChange:Ue},null,8,["library-id","qa-ids"])],64)}}},Iu=Ie(wn,[["__scopeId","data-v-ad9c6d6c"]]),il="/assets/img/default-bg-Dmt81D3f.png",xn={class:"form-box"},Cn={class:"upload-document-type-box"},$n=["onClick"],qn={class:"right-block"},Sn={class:"title-block"},Ln={class:"title-text"},Dn={class:"desc"},Ga="title_add_custom_document",Mn={__name:"add-custom-document",props:{libraryInfo:{type:Object,default:()=>{}},group_id:{type:[Number,String],default:()=>0}},emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.components.add-custom-document"),Q=ea(),U=yt(),Z=ht.useForm,N=v(!1),R=de(()=>p(Ga)),L=E,f=ce({library_id:U.query.id,doc_type:3,file_name:"",is_qa_doc:0,qa_index_type:1}),V=v([{iconName:"file-search",iconNameActive:"file-search",title:"title_qa_index_qa",value:1,desc:"desc_qa_index_qa"},{iconName:"comment-search",iconNameActive:"comment-search",title:"title_qa_index_question",value:2,desc:"desc_qa_index_question"}]),S=D=>{f.qa_index_type=D},x=ce({file_name:[{message:"msg_input_nickname",required:!0}]}),{resetFields:P,validate:C,validateInfos:F}=Z(f,x),K=()=>{N.value=!0,P(),f.file_name="",f.is_qa_doc=0,f.qa_index_type=1,f.library_id=L.libraryInfo.id||U.query.id,L.libraryInfo.type==2&&(f.is_qa_doc=1)},J=v(!1),ne=()=>{C().then(()=>{let D={...Jt(f),group_id:L.group_id};J.value=!0,vt(D).then(k=>{B.success(p(Ga)+p("msg_operation_success")),N.value=!1,Q.push("/library/preview?id="+k.data.file_ids[0])}).finally(()=>{J.value=!1})})};return y({add:K}),(D,k)=>{const G=Ke,g=zt,b=tl,X=el,ae=Qt,Y=ht,xe=ye;return _(),d("div",null,[a(xe,{open:N.value,"onUpdate:open":k[2]||(k[2]=W=>N.value=W),title:R.value,onOk:ne,width:"472px",confirmLoading:J.value},{default:o(()=>[e("div",xn,[a(Y,{layout:"vertical"},{default:o(()=>[a(g,rs({label:t(p)("label_document_name")},t(F).file_name),{default:o(()=>[a(G,{type:"text",placeholder:t(p)("ph_input_document_name"),value:f.file_name,"onUpdate:value":k[0]||(k[0]=W=>f.file_name=W)},null,8,["placeholder","value"])]),_:1},16,["label"]),m("",!0),f.is_qa_doc==1?(_(),q(g,{key:1,label:t(p)("label_index_method"),required:""},{default:o(()=>[e("div",Cn,[(_(!0),d(A,null,be(V.value,W=>(_(),d("div",{class:ve(["type-item",{active:f.qa_index_type==W.value}]),key:W.value,onClick:ie=>S(W.value)},[e("div",qn,[e("div",Sn,[a(ae,{name:f.qa_index_type==W.value?W.iconNameActive:W.iconName},null,8,["name"]),e("div",Ln,s(t(p)(W.title)),1)]),e("div",Dn,s(t(p)(W.desc)),1)]),f.qa_index_type==W.value?(_(),q(ae,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):m("",!0)],10,$n))),128))])]),_:1},8,["label"])):m("",!0)]),_:1})])]),_:1},8,["open","title","confirmLoading"])])}}},On=Ie(Mn,[["__scopeId","data-v-5be80d2c"]]),In="/assets/img/guide-image-DSu20zRj.png",Rn={class:"container"},Un={class:"guide-content"},zn={class:"content-box"},Tn={__name:"guide-learning-tips",setup(E,{expose:y}){const l=Zt(),p=v(!1),Q=v(!1),U=v(""),Z=()=>{setTimeout(()=>{p.value=!0},500)},N=()=>{l.setGuideLearningTips(Q.value),p.value=!1},R=()=>{l.setGuideLearningTips(Q.value),p.value=!1};return y({show:Z}),(L,f)=>{const V=ws,S=oa,x=ye;return _(),d("div",Rn,[a(x,{open:p.value,"onUpdate:open":f[1]||(f[1]=P=>p.value=P),title:U.value,onOk:N,onCancel:R,width:"472px"},{footer:o(()=>[a(S,{type:"primary",onClick:N},{default:o(()=>[...f[5]||(f[5]=[h("我知道了",-1)])]),_:1})]),default:o(()=>[e("div",Un,[f[4]||(f[4]=e("img",{src:In,alt:"操作引导",class:"guide-image"},null,-1)),e("div",zn,[f[3]||(f[3]=e("div",{class:"content-info"},'单次上传多个文档，上传成功后，需要手动点击文档后面 "学习" 进行学习；如果文档学习失败，支持重新学习',-1)),a(V,{checked:Q.value,"onUpdate:checked":f[0]||(f[0]=P=>Q.value=P)},{default:o(()=>[...f[2]||(f[2]=[e("div",{class:"content-check"},"不再显示此提示",-1)])]),_:1},8,["checked"])])])]),_:1},8,["open","title"])])}}},Fn=Ie(Tn,[["__scopeId","data-v-d94a3a33"]]),En={__name:"edit-online-doc",emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.components.edit-online-doc"),Q=l,U=ce({id:"",file_name:"",doc_auto_renew_frequency:1,doc_auto_renew_minute:""}),Z=v(!1),N=v({file_name:[{message:p("msg_input_file_name"),required:!0}],doc_auto_renew_frequency:[{message:p("msg_select_update_frequency"),required:!0}]}),R=v(!1),L=x=>{x=JSON.parse(JSON.stringify(x)),U.id=x.id||"",U.file_name=x.file_name||"",U.doc_auto_renew_frequency=+x.doc_auto_renew_frequency||1,x.doc_auto_renew_minute>0&&(U.doc_auto_renew_minute=Ze(x.doc_auto_renew_minute)),Z.value=!!x.from_update_info,R.value=!0},f=v(!1),V=v(null),S=()=>{V.value.validate().then(()=>{f.value=!0,jl({...U,doc_auto_renew_minute:U.doc_auto_renew_minute?Ze(U.doc_auto_renew_minute):0}).then(()=>{R.value=!1,f.value=!1,Q("ok")})}).catch(()=>{f.value=!1})};return y({show:L}),(x,P)=>{const C=Ke,F=zt,K=kt,J=bt,ne=al,D=ht,k=ye;return _(),d("div",null,[a(k,{open:R.value,"onUpdate:open":P[3]||(P[3]=G=>R.value=G),"confirm-loading":f.value,maskClosable:!1,title:t(p)("title_add_online_data"),width:"746px",onOk:S},{default:o(()=>[a(D,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:V,model:U,rules:N.value},{default:o(()=>[a(F,{name:"file_name",label:t(p)("label_file_name")},{default:o(()=>[a(C,{value:U.file_name,"onUpdate:value":P[0]||(P[0]=G=>U.file_name=G),placeholder:t(p)("ph_input"),disabled:Z.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),a(F,{name:"doc_auto_renew_frequency",label:t(p)("label_update_frequency")},{default:o(()=>[a(J,{value:U.doc_auto_renew_frequency,"onUpdate:value":P[1]||(P[1]=G=>U.doc_auto_renew_frequency=G),style:{width:"100%"}},{default:o(()=>[a(K,{value:1},{default:o(()=>[h(s(t(p)("option_no_auto_update")),1)]),_:1}),a(K,{value:2},{default:o(()=>[h(s(t(p)("option_daily")),1)]),_:1}),a(K,{value:3},{default:o(()=>[h(s(t(p)("option_every_3_days")),1)]),_:1}),a(K,{value:4},{default:o(()=>[h(s(t(p)("option_every_7_days")),1)]),_:1}),a(K,{value:5},{default:o(()=>[h(s(t(p)("option_every_30_days")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),U.doc_auto_renew_frequency>1?(_(),q(F,{key:0,name:"doc_auto_renew_minute",label:t(p)("label_update_time")},{default:o(()=>[a(ne,{valueFormat:"HH:mm",value:U.doc_auto_renew_minute,"onUpdate:value":P[2]||(P[2]=G=>U.doc_auto_renew_minute=G),format:"HH:mm"},null,8,["value"])]),_:1},8,["label"])):m("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading","title"])])}}},_l="/assets/img/empty-document-Cc0BAS6D.svg",Nn={key:0,class:"base-data-drawer"},Gn={class:"base-cover"},Wn=["src"],Hn={class:"base-title zm-line1"},Pn={class:"base-update"},Kn={key:0},Bn={key:1},Yn={key:2},An={key:3},Vn={key:4},jn={key:5,class:"ml4"},Jn={class:"base-meta-grid"},Qn={class:"meta-item"},Xn={class:"value"},Zn={class:"label"},ei={class:"meta-item"},ti={class:"value"},ai={class:"label"},li={class:"meta-item"},si={class:"value"},oi={class:"label"},ni={class:"base-hits-grid"},ii={class:"hits-item"},_i={class:"value"},ri={class:"label"},ui={class:"hits-item"},di={class:"value"},ci={class:"label"},pi={class:"hits-item"},fi={class:"value"},mi={class:"label"},vi={__name:"base-data-drawer",props:{open:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["close","editOnline"],setup(E,{emit:y}){const{t:l}=Oe("views.library.library-details.components.base-data-drawer"),p=y,Q=E;function U(){p("close")}const Z=L=>{const f=Number((L==null?void 0:L.status)??-1);return[0,1,5,6,10].includes(f)?"loading":[3,7,8,9].includes(f)?"error":"success"},N=L=>{if(!L)return"";const f=Z(L),V=L.thumb_path||L.cover_url||L.cover||L.article_cover_url||"";return V||(f==="loading"?Gs:f==="error"?_l:"")},R=de(()=>N(Q.record));return(L,f)=>{const V=xs;return _(),q(V,{open:E.open,placement:"right",width:480,title:t(l)("title_basic_data"),onClose:U},{default:o(()=>[E.record?(_(),d("div",Nn,[e("div",Gn,[R.value?(_(),d("img",{key:0,src:R.value,alt:""},null,8,Wn)):m("",!0)]),e("div",Hn,s(E.record.file_name),1),e("div",Pn,[e("span",null,s(t(l)("label_updated_at"))+" "+s(E.record.update_time),1),f[1]||(f[1]=e("span",{class:"sep"},"|",-1)),e("span",null,[E.record.doc_auto_renew_frequency==1?(_(),d("span",Kn,s(t(l)("label_no_auto_update")),1)):m("",!0),E.record.doc_auto_renew_frequency==2?(_(),d("span",Bn,s(t(l)("label_every_day")),1)):m("",!0),E.record.doc_auto_renew_frequency==3?(_(),d("span",Yn,s(t(l)("label_every_3_days")),1)):m("",!0),E.record.doc_auto_renew_frequency==4?(_(),d("span",An,s(t(l)("label_every_7_days")),1)):m("",!0),E.record.doc_auto_renew_frequency==5?(_(),d("span",Vn,s(t(l)("label_every_30_days")),1)):m("",!0),E.record.doc_auto_renew_frequency>1&&E.record.doc_auto_renew_minute>0?(_(),d("span",jn,s(t(Ze)(E.record.doc_auto_renew_minute)),1)):m("",!0),e("a",{class:"ml12 btn-hover-block",onClick:f[0]||(f[0]=S=>p("editOnline",E.record))},s(t(l)("btn_edit")),1)])]),e("div",Jn,[e("div",Qn,[e("div",Xn,s(E.record.file_ext||"--"),1),e("div",Zn,s(t(l)("label_file_format")),1)]),f[2]||(f[2]=e("div",{class:"line-vertical"},null,-1)),e("div",ei,[e("div",ti,s(E.record.file_size_str||"--"),1),e("div",ai,s(t(l)("label_doc_size")),1)]),f[3]||(f[3]=e("div",{class:"line-vertical"},null,-1)),e("div",li,[e("div",si,s(E.record.paragraph_count??"-"),1),e("div",oi,s(t(l)("label_doc_segments")),1)])]),e("div",ni,[e("div",ii,[e("div",_i,s(E.record.total_hits??0),1),e("div",ri,s(t(l)("label_total_triggers")),1)]),f[4]||(f[4]=e("div",{class:"line-vertical"},null,-1)),e("div",ui,[e("div",di,s(E.record.today_hits??0),1),e("div",ci,s(t(l)("label_today_triggers")),1)]),f[5]||(f[5]=e("div",{class:"line-vertical"},null,-1)),e("div",pi,[e("div",fi,s(E.record.yesterday_hits??0),1),e("div",mi,s(t(l)("label_yesterday_triggers")),1)])])])):m("",!0)]),_:1},8,["open","title"])}}},gi=Ie(vi,[["__scopeId","data-v-31253e06"]]),hi={class:"form-item"},yi={class:"form-label"},bi={class:"form-content"},ki={__name:"edit-group",props:{libraryId:{type:[Number,String],default:""},sense:{type:[Number,String],default:0}},emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.qa-knowledge-document.components.edit-group"),Q=v(!1),U=l,Z=v("title_edit_group"),N=E,R=ce({group_id:"",file_id:""}),L=v([]),f=x=>{R.group_id=x.group_id||"0",R.file_id=x.id||"",S(),Q.value=!0},V=()=>{if(!R.group_id)return B.error(p("msg_select_group"));Jl({...R,library_id:N.libraryId,sense:N.sense}).then(x=>{B.success(`${p(Z.value)}${p("msg_operation_success")}`),Q.value=!1,U("ok")})},S=()=>{Xt({library_id:N.libraryId,group_type:1}).then(x=>{L.value=x.data||[]})};return y({show:f}),(x,P)=>{const C=kt,F=bt,K=ye;return _(),d("div",null,[a(K,{open:Q.value,"onUpdate:open":P[1]||(P[1]=J=>Q.value=J),title:t(p)(Z.value),onOk:V},{default:o(()=>[e("div",hi,[e("div",yi,s(t(p)("label_group_name"))+"：",1),e("div",bi,[a(F,{value:R.group_id,"onUpdate:value":P[0]||(P[0]=J=>R.group_id=J),style:{width:"100%"},placeholder:t(p)("ph_select_group")},{default:o(()=>[(_(!0),d(A,null,be(L.value,J=>(_(),q(C,{value:J.id},{default:o(()=>[h(s(J.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","placeholder"])])])]),_:1},8,["open","title"])])}}},wi=Ie(ki,[["__scopeId","data-v-0462640c"]]),xi={key:0,class:"file-list"},Ci={__name:"add-feishu-document",props:{libraryId:{type:[Number,String],default:""}},emits:["ok"],setup(E,{expose:y,emit:l}){const{t:p}=Oe("views.library.library-details.components.add-feishu-document"),Q=l,U=E,Z=Zt(),N=v(null),R={feishu_app_id:"",feishu_app_secret:"",user_access_token:"",file_type:1,feishu_document_id_list:[]},L=v(!1),f=v(!1),V=v(1),S=ce({feishu_document_id_list:[]}),x=ce({feishu_app_id:{message:p("msg_input_app_id"),required:!0},feishu_app_secret:{message:p("msg_input_app_secret"),required:!0}}),P=v([]);function C(D=null){Object.assign(S,JSON.parse(JSON.stringify(R))),D?(Object.assign(S,D),F(),V.value=2):V.value=1,L.value=!0}function F(){const{feishu_app_id:D,feishu_app_secret:k,user_access_token:G}=S;Ql({feishu_app_id:D,feishu_app_secret:k,user_access_token:G}).then(g=>{P.value=K((g==null?void 0:g.data)||[])})}function K(D=[]){return D.map(k=>{if(Array.isArray(k.children)){k.checkable=!1;const G=K(k.children);return{...k,children:G}}return k.checkable=!0,k}).filter(k=>{var G;return!!(k.type==="docx"||k.type==="folder"&&((G=k.children)!=null&&G.length))})}function J(D=[]){const k=[];function G(g){for(const b of g)b.type==="docx"&&b.token&&k.push(b.token),Array.isArray(b.children)&&G(b.children)}return G(D),k}function ne(){N.value.validate().then(()=>{if(V.value==1){B.loading(p("msg_verifying"));let D="";const k={feishu_app_id:S.feishu_app_id,feishu_app_secret:S.feishu_app_secret},G={...k,id:U.libraryId};let g={...k,token:Z.getToken??"",feishu_frontend_auth_redirect_url:Xl(`${D}/#/library/details/knowledge-document?${Oa(G)}`)};window.location.href=`${D}/manage/feishuUserAuthLogin/redirect?${Oa(g)}`}else{if(S.file_type==2){if(!S.feishu_document_id_list.length)return B.error(p("msg_select_sync_files"))}else if(S.feishu_document_id_list=J(P.value),!S.feishu_document_id_list.length)return B.error(p("msg_no_sync_files"));let D={library_id:U.libraryId,doc_type:6,...S,doc_auto_renew_minute:Ze(S.doc_auto_renew_minute),feishu_document_id_list:S.feishu_document_id_list.toString()};delete D.file_type,delete D.user_access_token,f.value=!0,vt(D).then(k=>{Q("ok"),B.success(p("msg_added_success")),L.value=!1}).finally(()=>{f.value=!1})}})}return y({show:C}),(D,k)=>{const G=ja,g=Ke,b=zt,X=ht,ae=tl,Y=el,xe=Cs,W=ye;return _(),q(W,{open:L.value,"onUpdate:open":k[4]||(k[4]=ie=>L.value=ie),"confirm-loading":f.value,maskClosable:!1,title:V.value==1?t(p)("title_import_feishu_library"):t(p)("title_select_sync_files"),width:"646px",onOk:ne},{default:o(()=>[V.value==1?(_(),d(A,{key:0},[a(G,{class:"zm-alert-info","show-icon":"",type:"info"},{message:o(()=>[h(s(t(p)("msg_feishu_guide")),1)]),_:1}),a(X,{class:"mt16",layout:"vertical",ref_key:"formRef",ref:N,model:S,rules:x},{default:o(()=>[a(b,{name:"feishu_app_id",label:t(p)("label_app_id")},{default:o(()=>[a(g,{value:S.feishu_app_id,"onUpdate:value":k[0]||(k[0]=ie=>S.feishu_app_id=ie),valueModifiers:{trim:!0},placeholder:t(p)("ph_input_app_id")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(b,{name:"feishu_app_secret",label:t(p)("label_app_secret")},{default:o(()=>[a(g,{value:S.feishu_app_secret,"onUpdate:value":k[1]||(k[1]=ie=>S.feishu_app_secret=ie),valueModifiers:{trim:!0},placeholder:t(p)("ph_input_app_secret")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])],64)):(_(),q(X,{key:1,layout:"vertical",ref_key:"formRef",ref:N,model:S,rules:x},{default:o(()=>[a(b,{label:t(p)("label_file_scope")},{default:o(()=>[a(Y,{value:S.file_type,"onUpdate:value":k[2]||(k[2]=ie=>S.file_type=ie)},{default:o(()=>[a(ae,{value:1},{default:o(()=>[h(s(t(p)("radio_all_files")),1)]),_:1}),a(ae,{value:2},{default:o(()=>[h(s(t(p)("radio_partial_files")),1)]),_:1})]),_:1},8,["value"]),S.file_type==2?(_(),d("div",xi,[a(xe,{checkedKeys:S.feishu_document_id_list,"onUpdate:checkedKeys":k[3]||(k[3]=ie=>S.feishu_document_id_list=ie),multiple:"",checkable:"","field-names":{key:"token"},"tree-data":P.value},{title:o(({name:ie,type:M})=>[M==="docx"?(_(),d(A,{key:0},[h(s(ie)+".docx",1)],64)):(_(),d(A,{key:1},[h(s(ie),1)],64))]),_:1},8,["checkedKeys","tree-data"])])):m("",!0)]),_:1},8,["label"])]),_:1},8,["model","rules"]))]),_:1},8,["open","confirm-loading","title"])}}},$i=Ie(Ci,[["__scopeId","data-v-bfb64d83"]]),qi={class:"details-library-page"},Si={class:"group-head-box"},Li={class:"head-title"},Di={class:"flex-between-box"},Mi={class:"classify-box",style:{"margin-top":"16px"}},Oi=["onClick"],Ii={key:0,class:"drag-btn"},Ri={key:1,style:{width:"20px"}},Ui={class:"classify-title"},zi={class:"right-content"},Ti={key:0,class:"btn-box"},Fi={class:"hover-btn-wrap"},Ei=["onClick"],Ni=["onClick"],Gi={class:"main-content-box"},Wi={class:"group-header-title"},Hi={class:"pover-group-content-box"},Pi={class:"group-head-box"},Ki={class:"head-title"},Bi={class:"flex-between-box"},Yi={class:"search-box"},Ai={class:"classify-box classify-scroll-box"},Vi=["onClick"],ji={class:"classify-title"},Ji={class:"right-content"},Qi={key:0,class:"btn-box"},Xi={class:"hover-btn-wrap"},Zi=["onClick"],e_=["onClick"],t_={class:"title"},a_={key:1,class:"title-text"},l_={class:"list-tools"},s_={class:"tools-items"},o_={class:"tool-item"},n_={class:"view-toggle"},i_=["aria-label"],__=["aria-label"],r_={key:0,class:"tool-item"},u_={class:"sort-left"},d_={class:"sort-text"},c_={class:"right-box"},p_={key:0,class:"status-box"},f_={class:"status-item"},m_={class:"status-label"},v_={class:"status-content"},g_={key:0,class:"status-item"},h_={class:"status-label"},y_={class:"status-content content-tip"},b_={key:1,class:"status-item"},k_={class:"status-label"},w_={class:"status-content content-tip"},x_={key:1,class:"status-select-box"},C_={class:"tool-item"},$_={class:"tool-item"},q_={class:"dropdown-btn-menu"},S_={class:"title"},L_={key:0,class:"desc"},D_={key:1,class:"desc"},M_={class:"dropdown-btn-menu"},O_={class:"title"},I_={class:"desc"},R_={class:"dropdown-btn-menu"},U_={class:"title"},z_={class:"desc"},T_={class:"dropdown-btn-menu"},F_={class:"title"},E_={class:"desc"},N_={class:"dropdown-btn-menu"},G_={class:"title"},W_={class:"desc"},H_={key:1,class:"folder-view"},P_={key:0,class:"empty-folder"},K_={class:"empty-inner"},B_=["src"],Y_={class:"empty-text"},A_={key:1,class:"folder-grid"},V_=["onClick"],j_=["src"],J_={key:1,class:"thumb-img",src:il},Q_={key:2,class:"status-badge"},X_={key:3,class:"learn-percent"},Z_={key:4,style:{"margin-left":"2px"}},er={class:"folder-meta"},tr={key:0,class:"name zm-line1"},ar=["href"],lr={class:"name name-2line"},sr={key:1,class:"name name-2line"},or={class:"desc"},nr={class:"file-ext"},ir={key:2,class:"list-content"},_r={class:"zm-line1"},rr={key:2,class:"title-box"},ur={class:"zm-line1"},dr={key:0,class:"doc-name-td"},cr=["href"],pr=["onClick"],fr={key:0},mr={key:1},vr=["onClick"],gr={key:0},hr={key:1},yr={key:2,class:"url-remark"},br=["onClick"],kr={key:0,class:"pdf-progress-box"},wr={class:"progress-title"},xr={class:"status-box"},Cr=["onClick"],$r={class:"progress-bar"},qr={class:"num-box"},Sr={key:0,class:"status-tag running"},Lr={key:2,class:"status-tag running"},Dr={key:3,class:"status-tag complete"},Mr={class:"status-tag status-error"},Or=["onClick"],Ir={class:"status-tag status-error"},Rr={key:6,class:"status-tag"},Ur={key:7,class:"status-tag"},zr={key:8,class:"status-tag running"},Tr={class:"status-tag error"},Fr={key:10,class:"status-tag cancel"},Er={key:11,class:"status-tag subning"},Nr={class:"status-tag"},Gr=["onClick"],Wr={key:1,class:"status-tag running"},Hr={key:2,class:"status-tag complete"},Pr={class:"status-tag error"},Kr=["onClick"],Br={class:"zm-line1 reason-text"},Yr={key:4,class:"status-tag running"},Ar={class:"status-tag warning"},Vr={class:"reason-text"},jr=["onClick"],Jr={key:4},Qr={key:5,class:"text-block"},Xr={class:"time-content-box"},Zr={class:"update-tooltip"},eu={class:"update-tooltip-title"},tu={class:"update-tooltip-value"},au={class:"update-icon-box"},lu={class:"update-tooltip-time"},su={class:"update-tooltip-value"},ou={class:"ml4 btn-hover-block"},nu={class:"update-trigger-text"},iu=["onClick"],_u=["onClick"],ru={class:"zm-line1"},uu={class:"upload-file-box"},du={class:"select-card-box"},cu=["onClick"],pu={class:"card-title"},fu={key:0,class:"card-switch-box"},mu={class:"card-desc"},vu={key:0,class:"card-switch"},Wa="qa_document_group_box_width",Ut=180,Vt=256,gu={__name:"knowledge-document",props:{type:{type:[Number,String],default:()=>2},library_id:{type:[Number,String],default:()=>""}},setup(E){const{setStorage:y}=ss("localStorage"),{t:l}=Oe("views.library.library-details.knowledge-document"),p=Ka(),{changeGraphSwitch:Q}=p,U=Zl(),Z=de(()=>{var n;return((n=U.companyInfo)==null?void 0:n.neo4j_status)=="true"}),N=de(()=>{var n;return((n=U.companyInfo)==null?void 0:n.ali_ocr_switch)=="1"}),R=E,L=de(()=>R.library_id||k.id),f=v(localStorage.getItem("document_group_hide_key")==1),V=v(""),S=v([]),x=v(-1),P=de(()=>S.value.find(n=>n.id==x.value)||{}),C=de(()=>S.value.filter(n=>n.group_name.includes(V.value))),F=Zt(),K={1:l("menu_local_doc"),2:l("menu_online_data"),3:l("menu_custom_doc"),4:l("source_manual_qa"),5:l("source_import_qa"),6:l("source_import_fs")},J=[{key:2,title:l("pdf_mode_ocr_title"),icon:"pdf-ocr",desc:l("pdf_mode_ocr_desc")},{key:1,title:l("pdf_mode_text_title"),icon:"pdf-text",desc:l("pdf_mode_text_desc")},{key:3,title:l("pdf_mode_img_title"),icon:"pdf-img",desc:l("pdf_mode_img_desc")},{key:4,title:l("pdf_mode_ali_title"),icon:"ali-ocr",desc:l("pdf_mode_ali_desc")}],ne=yt(),D=ea(),k=ne.query,G=v(!1),g=v(null),b=v(null),X=v(null),ae=v(!1),Y=v({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0}),xe=ce({selectedRowKeys:[]}),W=ce({use_model:"",model_config_id:""}),ie=(n,i)=>{let u=i.modelName,w=i.modelId;Ce.value.length>0?ye.confirm({title:l("confirm_switch_model_title",{model:u}),content:l("confirm_switch_model_content"),onOk(){W.use_model=u,W.model_config_id=w,M()},onCancel(){}}):(W.use_model=u,W.model_config_id=w,M())},M=(n=!0,i=null)=>{_s({...Jt(Y.value),use_model:W.use_model,model_config_id:W.model_config_id}).then(()=>{Y.value.use_model=W.use_model,Y.value.model_config_id=W.model_config_id,typeof i=="function"&&i(),n&&B.success(l("msg_save_success"))})},Ee=v([]),wt=n=>{Ee.value=n},Se=v([]),Ue=n=>{Se.value=n,et()},et=()=>{if(!Y.value.id){setTimeout(()=>{et()},100);return}if(Se.value.length>0&&!Y.value.use_model){let n=null,i=null;for(let u of Se.value)if(u.model_define==="chatwiki"){n=u;for(let w of n.children)if(w.name==="text-embedding-v2"){i=w;break}break}n||(n=Se.value[0],i=n.children[0]),n&&(W.use_model=i.name,W.model_config_id=i.model_config_id,M(!1))}},Ce=v([]),pe=v("list"),Tt=v(null);function Be(){pe.value="folder",localStorage.setItem(Ne(),"folder"),x.value=-1,Pe.value=!1,$.page=1,$.size=50,$.file_name=void 0,$.status="",$.sort_field="",$.sort_type="",le.order_field="",le.order_type="DESC",xe.selectedRowKeys=[],Le.value=!1,f.value||Lt(),$e()}function ze(){pe.value="list",localStorage.setItem(Ne(),"list"),$.size=10,x.value=-1,$.page=1,$.file_name=void 0,$.status="",$.sort_field="",$.sort_type="",le.order_field="",le.order_type="DESC",xe.selectedRowKeys=[],Le.value=!1,f.value&&Lt(),$e()}const Le=v(!1),le=ce({order_field:"",order_type:"DESC"});function Ye(n){n==="default"?(le.order_field="",le.order_type="DESC",$.sort_field="",$.sort_type=""):(le.order_field=n,le.order_type="DESC",$.sort_field=n,$.sort_type="DESC"),$.page=1,Le.value=!1,me(),He()}function Te(){le.order_field&&(le.order_type=le.order_type==="DESC"?"ASC":"DESC",$.sort_type=le.order_type,$.page=1,me())}function tt(){Le.value=!Le.value}function Re(n){const i=Number((n==null?void 0:n.status)??-1);return[0,1,5,6,10].includes(i)?"loading":[4].includes(i)?"wait":[3,7,8,9].includes(i)?"error":"success"}const at=v(0);let Ae=null;const lt={};function st(n){try{const i=at.value,u=Number((n==null?void 0:n.ocr_pdf_index)??0),w=Number((n==null?void 0:n.ocr_pdf_total)??0);if(w>0&&u>=0)return Math.max(0,Math.min(100,parseInt(u/w*100)));const H=String((n==null?void 0:n.id)||"0");lt[H]||(lt[H]=Date.now());const z=(Date.now()-lt[H])/1e3,j=20+Number(H)%6*5,ge=Math.floor(10+z*j);return Math.max(10,Math.min(95,ge))}catch{}return null}const xt=de(()=>{const n=S.value||[],i=Ce.value||[],u=R.type==3?"official_article_update_time":"update_time",w=H=>{if(!H.length)return null;const z=H.filter(j=>!!j[u]).sort((j,ge)=>String(j[u]).localeCompare(String(ge[u])));return z.length?z[z.length-1]:H[H.length-1]};return n.map(H=>{const z=H.id===-1?i:i.filter(ge=>Number(ge.group_id||0)===Number(H.id)),j=w(z);return{id:H.id,group_name:H.group_name,total:H.total,last_update:j&&j[u]||"",last_update_ts:j&&j[u]?qe(j[u]).valueOf():0,cover_status:j?Re(j):"success",cover_src:j?we(j):""}})}),Ve=de(()=>{const n=[...xt.value],{order_field:i,order_type:u}=le;return(i==="update_time"||i==="library_num")&&n.sort((w,H)=>{let z=0,j=0;return i==="update_time"?(z=w.last_update_ts||0,j=H.last_update_ts||0):i==="library_num"&&(z=Number(w.total||0),j=Number(H.total||0)),u==="ASC"?z-j:j-z}),n}),Ft=de(()=>{const n=Ce.value||[],i=R.type==3?"official_article_update_time":"update_time";return n.map(u=>{const w=u[i]?qe(u[i]).valueOf():0;return{__type:"file",id:u.id,title:u.file_name||u.doc_url||"",update_ts:w,cover_src:we(u)||"",cover_status:Re(u),status_label:fe(u),origin:u}})}),Et=de(()=>{const n=Ce.value||[],i=R.type==3?"official_article_update_time":"update_time";return n.filter(u=>Number(u.group_id||0)<=0).map(u=>{const w=u[i]?qe(u[i]).valueOf():0;return{__type:"file",id:u.id,title:u.file_name||u.doc_url||"",update_ts:w,cover_src:we(u)||"",cover_status:Re(u),status_label:fe(u),origin:u}})}),ot=de(()=>Pe.value?Ft.value:[...Ve.value.map(n=>({__type:"group",...n})),...Et.value]);function T(n){n.__type==="group"?(Pe.value=!0,Wt({id:n.id,group_name:n.group_name,total:n.total})):We(n.origin)}function O(n){if(!n)return"--";const i=qe(n),u=qe();return i.isSame(u,"day")?i.format("HH:mm:ss"):u.diff(i,"year")>=1?i.format("YYYY/MM/DD"):i.format("MM/DD")}function we(n){const i=Re(n),u=n.thumb_path||n.cover_url||n.cover||n.article_cover_url||"";return u||(i==="wait"||i==="loading"||i==="error"?il:"")}function fe(n){const i=Number((n==null?void 0:n.status)??-1);return i===0?l("status_converting"):i===1?l("status_learning"):i===2?l("status_learn_complete"):i===3?l("status_convert_failed"):i===4?l("status_wait_learn"):i===5?l("status_wait_fetch"):i===6?l("status_fetching"):i===7?l("status_fetch_failed"):i===8?l("status_convert_error"):i===9?l("status_cancel_parse"):i===10?l("status_segmenting"):""}const re=v(!1),De=v(null);function nt(n){De.value=n,re.value=!0}function it(n){if(!n)return"--";const i=qe(n);return i.isValid()?i.format("YY-MM-DD"):n}function Ct(n){const i=Number((n==null?void 0:n.doc_auto_renew_frequency)||0);if(!i)return"--";let u="";if(i===1)return l("update_freq_never");i===2&&(u=l("update_freq_daily")),i===3&&(u=l("update_freq_3days")),i===4&&(u=l("update_freq_7days")),i===5&&(u=l("update_freq_30days"));const w=Number((n==null?void 0:n.doc_auto_renew_minute)||0);if(w>0){let H=Ze(w);return typeof H=="string"&&/^0\d:\d{2}$/.test(H)&&(H=H.slice(1)),l("update_freq_format",{freq:u,time:H})}return l("update_freq_update")}const Me=ce({learned_err_count:0,learned_count:0,learned_wait_count:0}),$=ce({library_id:L.value,file_name:void 0,status:"",page:1,size:10,total:0,sort_field:"",sort_type:""}),Nt=[{id:"",name:l("status_all")},{id:"4",name:l("status_wait_learn")},{id:"8",name:l("status_partial_fail")},{id:"3",name:l("status_all_fail")},{id:"2",name:l("status_success")}],ke=v([]),$t=[{title:l("col_doc_name"),dataIndex:"file_name",key:"file_name",resizable:!0,minWidth:180,maxWidth:600,width:300},{title:l("col_size_segment"),dataIndex:"file_size_str",key:"file_size",resizable:!0,minWidth:120,maxWidth:360,width:140},{title:l("col_total"),dataIndex:"total_hits",key:"total_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:l("col_yesterday"),dataIndex:"yesterday_hits",key:"yesterday_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:l("col_today"),dataIndex:"today_hits",key:"today_hits",resizable:!0,minWidth:80,maxWidth:200,width:80,sorter:!0},{title:l("col_knowledge_graph"),dataIndex:"graph_status",key:"graph_status",resizable:!0,minWidth:120,maxWidth:400,width:200},{title:l("col_entity_count"),dataIndex:"graph_entity_count",key:"graph_entity_count",resizable:!0,minWidth:120,maxWidth:320,width:160},{title:l("col_status"),dataIndex:"status",key:"status",resizable:!0,minWidth:130,maxWidth:200,width:130},{title:l("col_update_info"),dataIndex:"update_info",key:"update_info",resizable:!0,minWidth:130,maxWidth:600,width:130},{title:l("col_action"),dataIndex:"action",key:"action",fixed:"right",width:100}],qt=()=>`qa_document_columns_widths_${L.value||0}`,Ne=()=>`qa_document_view_mode_${L.value||0}`,St=()=>{try{const n=localStorage.getItem(qt())||"{}",i=JSON.parse(n);return typeof i=="object"&&i?i:{}}catch{return{}}},I=n=>{const i=St();return n.map(u=>{const w=i[u.key];if(typeof w=="number"){let H=w;return typeof u.minWidth=="number"&&(H=Math.max(u.minWidth,H)),typeof u.maxWidth=="number"&&(H=Math.min(u.maxWidth,H)),{...u,width:H}}return u})},Ge=(n,i)=>{const u=St();u[n]=i,localStorage.setItem(qt(),JSON.stringify(u))},rl=n=>{$e()},ul=(n,i,u)=>{$.page=n.current,$.size=n.pageSize,$.sort_field="",$.sort_type="",u.order&&u.field&&($.sort_field=u.field,$.sort_type=u.order=="ascend"?"ASC":"DESC"),me()},$e=()=>{$.page=1,me(!1),He()};let na=!1;const ia=({id:n})=>{Ce.value.length==1&&(na=!0),ls({id:n}).then(()=>{na&&$.page>1&&$.page--,me(),He(),B.success(l("msg_delete_success"))})},We=(n,i={})=>{let u=ne.name;if(n.status=="4"){if(u=="libraryConfig"){window.open("/#/library/document-segmentation?document_id="+n.id+"&page="+$.page);return}if(i.open_new===!0){let w=D.resolve({path:"/library/document-segmentation",query:{document_id:n.id,page:$.page}});window.open(w.href,"_blank");return}return D.push({path:"/library/document-segmentation",query:{document_id:n.id,page:$.page}})}if(n.status=="3"&&Y.value.type!=2)return B.error(l("msg_learn_failed_cannot_preview"));if(n.status=="0")return B.error(l("msg_converting_wait"));if(n.status=="1")return B.error(l("msg_learning_cannot_preview"));if(n.status=="6")return B.error(l("msg_fetching_cannot_preview"));if(n.status=="7")return B.error(l("msg_fetch_failed_cannot_preview"));if(n.status=="10")return B.error(l("msg_segmenting_cannot_preview"));if(i.open_new===!0||u=="libraryConfig"){const w=D.resolve({name:"libraryPreview",query:{id:n.id,...i}});window.open(w.href,"_blank");return}D.push({name:"libraryPreview",query:{id:n.id,...i}})},me=(n=!1)=>{let i=Jt($);i.status==0&&(i.status=""),i.group_id=x.value,G.value=!0,es(i).then(u=>{var dt;let w=u.data.info;!W.use_model&&W.use_model!=w.use_model&&(W.use_model=w.use_model,W.model_config_id=w.model_config_id),Y.value={...w},ae.value=w.graph_switch==1,n||(w.graph_switch=="0"||!Z.value?ke.value=$t.filter(te=>!["graph_status","graph_entity_count"].includes(te.key)):ke.value=$t,R.type!=3&&(ke.value=ke.value.filter(te=>te.key!="official_article_update_time")),ke.value=I(ke.value));let H=u.data.list||[],z=u.data.count_data||{};if(!n){let te=((dt=H==null?void 0:H[0])==null?void 0:dt.meta_list)||[],he=[];te.forEach(je=>{ke.value.findIndex(ue=>ue.dataIndex==je.key)>-1||he.push({title:je.name,key:`meta_${je.key}`,dataIndex:`meta_${je.key}`,width:160})}),ke.value.splice(ke.value.length-1,0,...he)}$.total=u.data.total,Me.learned_count=z.learned_count,Me.learned_err_count=z.learned_err_count,Me.learned_wait_count=z.learned_wait_count;let j=!1;const ge=H.map(te=>(["1","6","0","5"].includes(te.status)&&(j=!0),te.file_size_str=ts(te.file_size),te.update_time=qe(te.update_time*1e3).format("YYYY-MM-DD HH:mm"),te.official_article_update_time=qe(te.official_article_update_time*1e3).format("YYYY-MM-DD HH:mm"),te.doc_last_renew_time_desc=te.doc_last_renew_time>0?qe(te.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",Array.isArray(te.meta_list)&&te.meta_list.forEach(he=>{he.type==1&&he.value>0&&(he.value=qe(he.value*1e3).format("YYYY-MM-DD HH:mm")),he.key=="source"&&(he.value=K[he.value]),te[`meta_${he.key}`]=he.value}),te));Ce.value=n?[...Ce.value,...ge]:ge,j&&dl(),!j&&clearInterval(_t.value)}).finally(()=>{G.value=!1})},_t=v(null),dl=()=>{clearInterval(_t.value),_t.value=setInterval(()=>{me()},1e3*5)},_a=v(null),cl=n=>{if(Se.value.length==0){ye.confirm({title:l("confirm_add_model_title"),content:l("confirm_add_model_content"),okText:l("btn_go_add"),onOk(){D.push({path:"/user/model"})}});return}let{key:i}=n;i==1&&vl(),i==2&&pl(),i==3&&_a.value.add(),i==4&&X.value.show()},ee=ce({open:!1,urls:"",library_id:L.value,doc_auto_renew_frequency:1,confirmLoading:!1,doc_auto_renew_minute:"",rules:{urls:[{message:l("msg_enter_web_url"),required:!0},{validator:(n,i)=>Fa(i)===!1?Promise.reject(new Error(l("msg_invalid_web_url"))):Promise.resolve()}]}}),pl=()=>{ee.open=!0,ee.confirmLoading=!1,ee.urls="",ee.doc_auto_renew_minute="02:00",ee.doc_auto_renew_frequency=1},ra=v(null),fl=()=>{ra.value.validate().then(()=>{ee.confirmLoading=!0,vt({library_id:ee.library_id,urls:JSON.stringify(Fa(ee.urls)),doc_auto_renew_frequency:ee.doc_auto_renew_frequency,doc_auto_renew_minute:Ze(ee.doc_auto_renew_minute),doc_type:2,group_id:x.value}).then(()=>{ee.open=!1,ee.confirmLoading=!1,$e()})}).catch(()=>{ee.confirmLoading=!1})},ml=()=>{ee.open=!1},_e=ce({open:!1,fileList:[],confirmLoading:!1,pdf_parse_type:1}),ua=de(()=>_e.fileList.filter(n=>n.type==="application/pdf").length>0),da=v(null),vl=()=>{if(Y.value.type==2){da.value.show();return}_e.fileList=[],_e.open=!0},gl=()=>{_e.fileList=[]},hl=n=>{_e.fileList=n},yl=()=>{if(g.value&&!F.getGuideLearningTips&&_e.fileList.length>1&&g.value.show(),_e.fileList.length==0){B.error(l("msg_select_file_first"));return}_e.confirmLoading=!0;let n=new FormData;n.append("library_id",$.library_id),n.append("group_id",x.value||0);let i=!1;_e.fileList.forEach(u=>{(u.name.includes(".xlsx")||u.name.includes(".csv"))&&(i=!0),n.append("library_files",u)}),ua.value&&n.append("pdf_parse_type",_e.pdf_parse_type),vt(n).then(u=>{me(),_e.open=!1,_e.fileList=[],_e.confirmLoading=!1,i&&u.data.file_ids.length==1&&D.push("/library/document-segmentation?document_id="+u.data.file_ids[0])}).catch(()=>{_e.confirmLoading=!1})},ca=v(null),pa=n=>{ca.value.show(n)},fa=n=>{D.push({path:"/library/document-segmentation",query:{document_id:n.id}})},ma=n=>{ns({id:n.id}).then(()=>{me()})},bl=()=>{if(ae.value){ae.value=!1;let n={graph_model_config_id:Y.value.graph_model_config_id,graph_use_model:Y.value.graph_use_model};if((!n.graph_model_config_id||!n.graph_use_model)&&Ee.value.length>0){let u=Ee.value[0].children[0];n.graph_use_model=u.name,n.graph_model_config_id=u.model_config_id}b.value.show(n)}else Y.value.graph_switch=0,M(!1,()=>{me(),Q(0)})},kl=n=>{ae.value=!0,Y.value.graph_switch=1,Y.value.graph_model_config_id=n.graph_model_config_id,Y.value.graph_use_model=n.graph_use_model,M(!1,()=>{me(),Q(1)})},wl=n=>{if(n.key==4&&!N.value)return!1;_e.pdf_parse_type=n.key},xl=()=>{window.open("#/user/aliocr")},va=v(null),Gt=(n,i=!1)=>{va.value.show({...n,from_update_info:i})},Cl=n=>{is({id:n.id}).then(i=>{B.success(l("msg_update_success")),me()})},$l=n=>{ye.confirm({title:l("confirm_cancel_parse_title"),content:l("confirm_cancel_parse_content"),okText:l("btn_confirm"),onOk(){os({id:n.id}).then(i=>{B.success(l("msg_cancel_success")),me()})}})},ql=n=>{y("graph:autoOpenFileId",n.id),D.push({path:"/library/details/knowledge-graph",query:{id:L.value}})},ga=n=>{let i=`/manage/downloadLibraryFile?id=${n.id}&token=${F.getToken}`;var u=document.createElement("a");u.href=i,u.style.display="none",u.click()},Lt=()=>{f.value=!f.value,localStorage.setItem("document_group_hide_key",f.value?1:2)},He=()=>{Xt({library_id:L.value,group_type:1,order_field:le.order_field,order_type:le.order_type}).then(n=>{let u=(n.data||[]).reduce((w,H)=>w+ +H.total,0);S.value=[{group_name:l("label_all_groups"),id:-1,total:u},...n.data]})};He();const ha=v(null),rt=n=>{ha.value.show({...n,library_id:L.value})},ya=v(null),ba=n=>{ya.value.show({...n,sense:1})},Dt=()=>{He(),me()},Pe=v(!1),Wt=n=>{x.value=n.id,$e()},Sl=()=>{Pe.value=!1,x.value=-1,$e()},Ht=v(null),Fe=v(null);function Ll(){try{Fe.value&&Fe.value.disconnect(),Fe.value=new IntersectionObserver(n=>{const i=n[0];i&&i.isIntersecting&&Dl()},{root:null,threshold:.1}),cs(()=>{Ht.value&&Fe.value.observe(Ht.value)})}catch{}}function Dl(){pe.value!=="folder"||!($.page*$.size<($.total||0))||G.value||($.page++,me(!0))}const Pt=n=>{ye.confirm({title:l("confirm_delete_group_title",{groupName:n.group_name}),icon:a(gt),content:"",okText:l("btn_confirm"),okType:"danger",cancelText:l("btn_cancel"),onOk(){Ba({id:n.id,sense:1}).then(()=>{B.success(l("msg_delete_success")),He(),x.value==n.id&&(x.value=-1,$e())})}})},ut=v(Ut),Mt=v(!1);jt(()=>{const n=parseInt(localStorage.getItem(Wa));n&&n>=Ut&&n<=Vt&&(ut.value=n);const i=localStorage.getItem(Ne());i==="folder"||i==="list"?(pe.value=i,$.size=i==="folder"?50:10):localStorage.setItem(Ne(),"list"),Ml(),Ll(),Ae=setInterval(()=>{at.value++},1500)});const Ml=()=>{const{user_access_token:n,feishu_app_id:i,feishu_app_secret:u,...w}=k;n&&i&&u&&(D.replace({query:w}),X.value.show({user_access_token:n,feishu_app_id:i,feishu_app_secret:u}))};let Ot=!1,ka=0,wa=0;const Ol=n=>{f.value||(Ot=!0,Mt.value=!0,ka=n.clientX,wa=ut.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",xa),document.addEventListener("mouseup",Ca))},xa=n=>{if(!Ot)return;let i=wa+(n.clientX-ka);i=Math.max(Ut,Math.min(Vt,i)),ut.value=i},Ca=()=>{Ot&&(Ot=!1,Mt.value=!1,localStorage.setItem(Wa,ut.value),document.body.style.cursor="",document.removeEventListener("mousemove",xa),document.removeEventListener("mouseup",Ca))},Il=n=>n.draggedContext.element.id>0&&n.relatedContext.element.id>0,Rl=async()=>{try{const n=S.value.filter(i=>i.id>0).map((i,u)=>({id:i.id,sort:S.value.length-u}));await as({library_id:L.value,sense:1,sort_group:JSON.stringify(n)}),B.success(l("msg_sort_saved"))}catch(n){console.error("排序保存失败:",n),He()}},$a=v(null),Ul=n=>{$a.value.show(n==2)};jt(()=>{k.page&&($.page=+k.page),me()});const zl=(n,i)=>{let u=n;typeof i.minWidth=="number"&&(u=Math.max(i.minWidth,u)),typeof i.maxWidth=="number"&&(u=Math.min(i.maxWidth,u)),i.width=u,ke.value=ke.value.map(w=>w.key===i.key?{...w,width:u}:w),Ge(i.key,u)};return us(()=>{_t.value&&clearInterval(_t.value),Ae&&clearInterval(Ae),Fe.value&&Fe.value.disconnect(),Fe.value&&Fe.value.disconnect()}),(n,i)=>{const u=Qt,w=ta,H=Ke,z=Xa,j=Qa,ge=Ja,dt=Ha,te=aa,he=$s,je=qs,ue=la,Je=kt,qa=bt,Tl=Ss,Sa=oa,Kt=Ls,Fl=Ms,ct=Os,El=Va,pt=zt,La=ht,Da=ye,Nl=zs,Gl=al,Ma=Ya("copy");return _(),d("div",qi,[e("div",{class:ve(["group-content-box",[{collapsed:f.value},{"no-transition":Mt.value}]]),style:Aa(f.value?{}:{width:ut.value+"px",minWidth:Ut+"px",maxWidth:Vt+"px"})},[e("div",Si,[e("div",Li,[a(w,{title:t(l)("tooltip_collapse_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:Lt},[a(u,{name:"put-away"})])]),_:1},8,["title"]),e("div",Di,[e("div",null,s(t(l)("label_knowledge_group")),1),a(w,{title:t(l)("tooltip_create_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:i[0]||(i[0]=r=>rt({}))},[a(t(Xe))])]),_:1},8,["title"])])]),m("",!0)]),e("div",Mi,[a(dt,{style:{"padding-right":"24px"}},{default:o(()=>[a(t(ds),{modelValue:S.value,"onUpdate:modelValue":i[3]||(i[3]=r=>S.value=r),"item-key":"id",disabled:Mt.value,onEnd:Rl,move:Il,handle:".drag-btn"},{item:o(({element:r})=>[e("div",{class:ve(["classify-item",{active:r.id==x.value}]),onClick:c=>Wt(r)},[r.id>0?(_(),d("span",Ii,[a(u,{name:"drag"})])):(_(),d("span",Ri)),e("div",Ui,s(r.group_name),1),e("div",zi,[e("div",{class:ve(["num",{"num-block":r.id<=0}])},s(r.total),3),r.id>0?(_(),d("div",Ti,[a(ge,{placement:"bottomRight"},{overlay:o(()=>[a(j,null,{default:o(()=>[a(z,null,{default:o(()=>[e("div",{onClick:oe(c=>rt(r),["stop"])},s(t(l)("btn_rename")),9,Ei)]),_:2},1024),a(z,null,{default:o(()=>[e("div",{onClick:oe(c=>Pt(r),["stop"])},s(t(l)("btn_delete")),9,Ni)]),_:2},1024)]),_:2},1024)]),default:o(()=>[e("div",Fi,[a(t(Qe))])]),_:2},1024)])):m("",!0)])],10,Oi)]),_:1},8,["modelValue","disabled"])]),_:1})]),f.value?m("",!0):(_(),d("div",{key:0,class:"resize-bar",onMousedown:Ol},null,32))],6),e("div",Gi,[a(dt,{scrollbar:!1},{default:o(()=>[e("div",Wi,[f.value?(_(),q(te,{key:0,title:null,placement:"bottom"},{content:o(()=>[e("div",Hi,[e("div",Pi,[e("div",Ki,[e("div",Bi,[e("div",null,s(t(l)("label_qa_group")),1),a(w,{title:t(l)("tooltip_create_group")},{default:o(()=>[e("div",{class:"hover-btn-wrap",onClick:i[4]||(i[4]=r=>rt({}))},[a(t(Xe))])]),_:1},8,["title"])])]),e("div",Yi,[a(H,{allowClear:"",value:V.value,"onUpdate:value":i[6]||(i[6]=r=>V.value=r),placeholder:t(l)("ph_search_group"),style:{width:"100%"}},{suffix:o(()=>[a(t(mt),{onClick:i[5]||(i[5]=oe(()=>{},["stop"]))})]),_:1},8,["value","placeholder"])])]),e("div",Ai,[(_(!0),d(A,null,be(C.value,r=>(_(),d("div",{class:ve(["classify-item",{active:r.id==x.value}]),onClick:c=>Wt(r),key:r.id},[e("div",ji,s(r.group_name),1),e("div",Ji,[e("div",{class:ve(["num",{"num-block":r.id<=0}])},s(r.total),3),r.id>0?(_(),d("div",Qi,[a(ge,{placement:"bottomRight"},{overlay:o(()=>[a(j,null,{default:o(()=>[a(z,null,{default:o(()=>[e("div",{onClick:oe(c=>rt(r),["stop"])},s(t(l)("btn_rename")),9,Zi)]),_:2},1024),a(z,null,{default:o(()=>[e("div",{onClick:oe(c=>Pt(r),["stop"])},s(t(l)("btn_delete")),9,e_)]),_:2},1024)]),_:2},1024)]),default:o(()=>[e("div",Xi,[a(t(Qe))])]),_:2},1024)])):m("",!0)])],10,Vi))),128))])])]),default:o(()=>[pe.value!=="folder"||pe.value==="list"?(_(),d("div",{key:0,class:"hover-btn-wrap",onClick:Lt},[a(u,{name:"expand"})])):m("",!0)]),_:1})):m("",!0),e("div",t_,[Pe.value?(_(),q(je,{key:0},{default:o(()=>[a(he,null,{default:o(()=>[e("a",{class:"breadcrumb-a",onClick:Sl},s(t(l)("label_knowledge_base_doc")),1)]),_:1}),x.value===-1?(_(),q(he,{key:0},{default:o(()=>[h(s(t(l)("label_all_groups")),1)]),_:1})):(_(),q(he,{key:1},{default:o(()=>[h(s(P.value.group_name),1)]),_:1}))]),_:1})):(_(),d("span",a_,s(t(l)("label_knowledge_base_doc")),1))])]),e("div",l_,[e("div",s_,[e("div",o_,[e("div",n_,[e("div",{class:ve(["toggle-seg",{active:pe.value==="folder"}]),onClick:Be,"aria-label":t(l)("aria_folder_view")},[a(u,{class:"toggle-icon",name:pe.value==="folder"?"folder-icon-active":"folder-icon"},null,8,["name"])],10,i_),e("div",{class:ve(["toggle-seg",{active:pe.value==="list"}]),onClick:ze,"aria-label":t(l)("aria_thumbnail_view")},[a(u,{class:"toggle-icon",name:pe.value==="list"?"thumbnail-icon-active":"thumbnail-icon"},null,8,["name"])],10,__)])]),pe.value==="folder"&&Pe.value?(_(),d("div",r_,[e("div",{class:"sort-btn",ref_key:"sortBtnRef",ref:Tt},[e("div",u_,[e("span",d_,s(le.order_field==="total_hits"?t(l)("sort_total"):le.order_field==="today_hits"?t(l)("sort_today"):le.order_field==="yesterday_hits"?t(l)("sort_yesterday"):t(l)("sort_default")),1),le.order_field?le.order_type==="DESC"?(_(),q(u,{key:"desc",class:"sort-icon active",name:"sort-down-icon",onClick:oe(Te,["stop"])})):(_(),q(u,{key:"asc",class:"sort-icon active",name:"sort-top-icon",onClick:oe(Te,["stop"])})):(_(),q(u,{key:"default",class:"sort-icon active",name:"sort-icon"}))]),a(ge,{open:Le.value,"onUpdate:open":i[11]||(i[11]=r=>Le.value=r),trigger:"click"},{overlay:o(()=>[a(j,{selectedKeys:[le.order_field||"default"]},{default:o(()=>[(_(),q(z,{key:"default",onClick:i[7]||(i[7]=r=>Ye("default"))},{default:o(()=>[h(s(t(l)("sort_default")),1)]),_:1})),(_(),q(z,{key:"total_hits",onClick:i[8]||(i[8]=r=>Ye("total_hits"))},{default:o(()=>[h(s(t(l)("sort_total")),1)]),_:1})),(_(),q(z,{key:"today_hits",onClick:i[9]||(i[9]=r=>Ye("today_hits"))},{default:o(()=>[h(s(t(l)("sort_today")),1)]),_:1})),(_(),q(z,{key:"yesterday_hits",onClick:i[10]||(i[10]=r=>Ye("yesterday_hits"))},{default:o(()=>[h(s(t(l)("sort_yesterday")),1)]),_:1}))]),_:1},8,["selectedKeys"])]),default:o(()=>[e("span",{class:ve(["sort-arrow",{active:Le.value}]),onClick:oe(tt,["prevent"])},[a(t(sa))],2)]),_:1},8,["open"])],512)])):m("",!0),ft(a(ue,{align:"center",class:"tool-item custom-select-box"},{default:o(()=>[e("span",null,s(t(l)("label_embedding_model")),1),a(Ea,{modelType:"TEXT EMBEDDING",isOffline:!1,modeName:W.use_model,modeId:W.model_config_id,style:{width:"240px"},onChange:ie,onLoaded:Ue},null,8,["modeName","modeId"])]),_:1},512),[[Ua,!1]])]),e("div",c_,[Y.value.type==0?(_(),d("div",p_,[e("div",f_,[e("div",m_,s(t(l)("status_learned")),1),e("div",v_,s(Me.learned_count),1)]),Me.learned_wait_count>0?(_(),d("div",g_,[e("div",h_,s(t(l)("status_unlearned")),1),e("div",y_,s(Me.learned_wait_count),1)])):m("",!0),Me.learned_err_count>0?(_(),d("div",b_,[e("div",k_,s(t(l)("status_learn_failed")),1),e("div",w_,s(Me.learned_err_count),1)])):m("",!0)])):m("",!0),Y.value.type==0?(_(),d("div",x_,[a(qa,{value:$.status,"onUpdate:value":i[12]||(i[12]=r=>$.status=r),style:{width:"150px"},placeholder:t(l)("ph_select"),onChange:rl},{default:o(()=>[(_(),d(A,null,be(Nt,r=>a(Je,{key:r.id,value:r.id},{default:o(()=>[h(s(r.name),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])])):m("",!0),e("div",C_,[a(H,{style:{width:"140px"},value:$.file_name,"onUpdate:value":i[13]||(i[13]=r=>$.file_name=r),placeholder:t(l)("ph_search_doc_name"),onChange:$e},{suffix:o(()=>[a(t(mt),{onClick:$e,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value","placeholder"])]),Z.value?(_(),q(ue,{key:2,align:"center",class:"tool-item custom-select-box pd-5-8"},{default:o(()=>[ft(a(Ea,{modelType:"LLM",onLoaded:wt},null,512),[[Ua,!1]]),e("span",null,s(t(l)("label_generate_knowledge_graph")),1),a(Tl,{checked:ae.value,"onUpdate:checked":i[14]||(i[14]=r=>ae.value=r),onChange:bl,"checked-children":t(l)("switch_on"),"un-checked-children":t(l)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1})):m("",!0),R.type!=3?(_(),q(Sa,{key:3,onClick:i[15]||(i[15]=r=>Ul(1))},{default:o(()=>[h(s(t(l)("btn_metadata"))+" ",1),a(t(Za))]),_:1})):m("",!0),e("div",$_,[a(ge,{trigger:["hover"],overlayClassName:"add-dropdown-btn"},{overlay:o(()=>[a(j,{onClick:cl},{default:o(()=>[(_(),q(z,{key:1},{default:o(()=>[e("div",q_,[a(ue,{class:"title-block",gap:4},{default:o(()=>[a(u,{name:"doc-icon"}),e("div",S_,s(t(l)("menu_local_doc")),1)]),_:1}),Y.value.type==2?(_(),d("div",L_,s(t(l)("menu_local_doc_desc_qa")),1)):(_(),d("div",D_,s(t(l)("menu_local_doc_desc")),1))])]),_:1})),Y.value.type!=2?(_(),q(z,{key:2},{default:o(()=>[e("div",M_,[a(ue,{class:"title-block",gap:4},{default:o(()=>[a(u,{name:"link-icon"}),e("div",O_,s(t(l)("menu_online_data")),1)]),_:1}),e("div",I_,s(t(l)("menu_online_data_desc")),1)])]),_:1})):m("",!0),(_(),q(z,{key:3},{default:o(()=>[e("div",R_,[a(ue,{class:"title-block",gap:4},{default:o(()=>[a(u,{name:"cu-doc-icon"}),e("div",U_,s(t(l)("menu_custom_doc")),1)]),_:1}),e("div",z_,s(t(l)("menu_custom_doc_desc")),1)])]),_:1})),Y.value.type==0?(_(),q(z,{key:4},{default:o(()=>[e("div",T_,[a(ue,{class:"title-block",gap:4},{default:o(()=>[a(u,{name:"feishu-doc"}),e("div",F_,s(t(l)("menu_feishu")),1)]),_:1}),e("div",E_,s(t(l)("menu_feishu_desc")),1)])]),_:1})):m("",!0),pe.value==="folder"?(_(),q(z,{key:5},{default:o(()=>[e("div",N_,[a(ue,{class:"title-block",gap:4},{default:o(()=>[a(u,{name:"group-default-icon"}),e("div",G_,s(t(l)("menu_add_group")),1)]),_:1}),e("div",W_,s(t(l)("menu_add_group_desc")),1)])]),_:1})):m("",!0)]),_:1})]),default:o(()=>[E.type!=3?(_(),q(Sa,{key:0,type:"primary"},{icon:o(()=>[a(t(Xe))]),default:o(()=>[e("span",null,s(t(l)("btn_add_content")),1)]),_:1})):m("",!0)]),_:1})])])]),Y.value.type==0&&pe.value==="list"?(_(),q(Ns,{key:0,style:{"margin-bottom":"16px"},title:t(l)("title_usage_instructions")},{default:o(()=>[e("div",null,[e("p",null,s(t(l)("msg_usage_1")),1),e("p",null,s(t(l)("msg_usage_2")),1)])]),_:1},8,["title"])):m("",!0),pe.value==="folder"?(_(),d("div",H_,[Pe.value&&ot.value.length===0?(_(),d("div",P_,[e("div",K_,[e("img",{src:t(_l),alt:"",class:"empty-img"},null,8,B_),e("div",Y_,s(t(l)("empty_no_doc")),1)])])):(_(),d("div",A_,[(_(!0),d(A,null,be(ot.value,r=>(_(),d("div",{key:`${r.__type}-${r.id}`,class:ve(["folder-card",[`card-${r.__type}`]]),onClick:c=>T(r)},[e("div",{class:ve(["folder-thumb",["status-"+(r.cover_status||"success")]])},[r.__type==="group"?(_(),q(u,{key:0,name:"group-icon",class:"folder-type-icon"})):(_(),d(A,{key:1},[r.cover_src?(_(),d("img",{key:0,src:r.cover_src,alt:"",class:"thumb-img"},null,8,j_)):(_(),d("img",J_)),r.status_label&&r.cover_status!=="success"?(_(),d("div",Q_,[r.cover_status==="error"&&r.origin.errmsg&&r.origin.errmsg!="success"?(_(),q(w,{key:0},{title:o(()=>[e("span",null,s(r.origin.errmsg),1)]),default:o(()=>[a(u,{style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"tip-icon-two"}),h(" "+s(r.status_label),1)]),_:2},1024)):m("",!0),r.cover_status==="error"&&!r.origin.errmsg?(_(),q(u,{key:1,style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"tip-icon-two"})):m("",!0),r.cover_status==="wait"?(_(),q(u,{key:2,style:{color:"rgba(0, 0, 0, 0.4)","font-size":"16px","vertical-align":"sub"},name:"time-default-icon"})):m("",!0),r.origin.errmsg=="success"&&r.cover_status==="loading"&&st(r.origin)!==null?(_(),d("span",X_,s(st(r.origin))+"%",1)):m("",!0),!r.origin.errmsg||r.origin.errmsg=="success"?(_(),d("span",Z_,s(r.status_label),1)):m("",!0)])):m("",!0)],64))],2),e("div",er,[r.__type==="group"?(_(),d("div",tr,s(r.group_name),1)):(_(),d(A,{key:1},[r.origin.doc_type==2?(_(),q(te,{key:0,title:null},{content:o(()=>[h(s(t(l)("tooltip_original_link")),1),e("a",{href:r.origin.doc_url,target:"_blank"},s(r.origin.doc_url),9,ar),ft(a(t(za),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Ma,`${r.origin.doc_url}`]])]),default:o(()=>[e("div",lr,s(r.title),1)]),_:2},1024)):(_(),d("div",sr,s(r.title),1))],64)),e("div",or,[r.__type==="group"?(_(),d(A,{key:0},[e("span",null,s(r.total||"0")+s(t(l)("label_knowledge_base_count")),1),e("span",null,s(O(r.last_update_ts)),1)],64)):(_(),d(A,{key:1},[e("span",nr,[a(u,{name:["docx","excel","html","pdf","txt","xlsx","ofd","csv","md"].some(c=>String(r.origin.file_ext||"").includes(c))?r.origin.file_ext:"file_ext",class:"file-icon"},null,8,["name"]),h(" "+s(r.origin.file_ext||"--"),1)]),e("span",null,s(O(r.update_ts)),1)],64))])]),r.__type==="group"&&r.id>0?(_(),q(ge,{key:0},{overlay:o(()=>[a(j,null,{default:o(()=>[a(z,{onClick:c=>rt({id:r.id,group_name:r.group_name})},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"edit"}),e("div",null,s(t(l)("btn_rename")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>Pt({id:r.id,group_name:r.group_name})},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"delete"}),e("div",null,s(t(l)("btn_delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),default:o(()=>[e("div",{class:"card-more",onClick:i[16]||(i[16]=oe(()=>{},["stop"]))},[a(t(Qe))])]),_:2},1024)):m("",!0),r.__type==="file"?(_(),q(ge,{key:1},{overlay:o(()=>[a(j,null,{default:o(()=>[a(z,{onClick:c=>nt(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"base-data-icon"}),e("div",null,s(t(l)("btn_base_data")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>We(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"preview-icon"}),e("div",null,s(t(l)("btn_preview")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>fa(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(t(Ta),{class:"action-icon"}),e("div",null,s(t(l)("btn_re_segment")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>pa(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"edit"}),e("div",null,s(t(l)("btn_rename")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>ba(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"group-default-icon"}),e("div",null,s(t(l)("btn_edit_group")),1)]),_:1})]),_:1},8,["onClick"]),a(z,{onClick:c=>ga(r.origin)},{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"down-file"}),e("div",null,s(t(l)("btn_download_doc")),1)]),_:1})]),_:1},8,["onClick"]),a(Kt,{title:t(l)("confirm_delete"),placement:"topRight",trigger:"click",onConfirm:c=>ia(r.origin)},{default:o(()=>[a(z,null,{default:o(()=>[a(ue,{gap:8,align:"center"},{default:o(()=>[a(u,{name:"delete"}),e("div",null,s(t(l)("btn_delete")),1)]),_:1})]),_:1})]),_:1},8,["title","onConfirm"])]),_:2},1024)]),default:o(()=>[e("div",{class:"card-more",onClick:i[17]||(i[17]=oe(()=>{},["stop"]))},[a(t(Qe))])]),_:2},1024)):m("",!0)],10,V_))),128)),e("div",{ref_key:"folderScrollSentinel",ref:Ht,class:"scroll-sentinel"},null,512)])),a(gi,{open:re.value,"onUpdate:open":i[18]||(i[18]=r=>re.value=r),record:De.value,onClose:i[19]||(i[19]=r=>re.value=!1),onEditOnline:Gt},null,8,["open","record"])])):(_(),d("div",ir,[a(El,{onResizeColumn:zl,columns:ke.value,"data-source":Ce.value,scroll:{x:1e3},"row-key":"id",pagination:{current:$.page,total:$.total,pageSize:$.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:ul},{headerCell:o(({column:r})=>{var c;return[r.key.indexOf("meta_")>-1?(_(),q(w,{key:0,title:((c=r.title)==null?void 0:c.length)>8?r.title:""},{default:o(()=>[e("div",_r,s(r.title),1)]),_:2},1032,["title"])):r.key==="file_name"?(_(),d(A,{key:1},[h(s(t(l)("col_doc_name_total",{total:$.total||0})),1)],64)):r.key==="graph_entity_count"?(_(),d("div",rr,[e("div",ur,s(t(l)("col_entity_count")),1),a(w,{title:t(l)("tooltip_entity_count")},{default:o(()=>[a(t(Us))]),_:1},8,["title"])])):m("",!0)]}),bodyCell:o(({column:r,record:c})=>[r.key==="file_name"?(_(),d("div",dr,[a(w,{title:`.${c.file_ext}`},{default:o(()=>[a(u,{name:["docx","excel","html","pdf","txt","xlsx","ofd","csv","md"].some(se=>String(c.file_ext||"").includes(se))?c.file_ext:"file_ext",class:"file-icon"},null,8,["name"])]),_:2},1032,["title"]),c.doc_type==2?(_(),q(te,{key:0,title:null},{content:o(()=>[h(s(t(l)("tooltip_original_link")),1),e("a",{href:c.doc_url,target:"_blank"},s(c.doc_url),9,cr),ft(a(t(za),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[Ma,`${c.doc_url}`]])]),default:o(()=>[e("a",{onClick:se=>We(c,{open_new:!0})},[a(w,{title:t(Ia)(["5","6","7"].includes(c.status)?c.doc_url:c.file_name,c,14,2,12),placement:"top"},{default:o(()=>[e("span",{class:"doc-name-text",ref:se=>t(Ra)(se,c)},[["5","6","7"].includes(c.status)?(_(),d("span",fr,s(c.doc_url),1)):(_(),d("span",mr,s(c.file_name),1))],512)]),_:2},1032,["title"])],8,pr)]),_:2},1024)):(_(),d("a",{key:1,onClick:se=>We(c,{open_new:!0})},[a(w,{title:t(Ia)(["5","6","7"].includes(c.status)?c.doc_url:c.file_name,c,14,2,12),placement:"top"},{default:o(()=>[e("span",{class:"doc-name-text",ref:se=>t(Ra)(se,c)},[["5","6","7"].includes(c.status)?(_(),d("span",gr,s(c.doc_url),1)):(_(),d("span",hr,s(c.file_name),1))],512)]),_:2},1032,["title"])],8,vr)),c.doc_type==2&&c.remark?(_(),d("div",yr,s(t(l)("label_remark"))+s(c.remark),1)):m("",!0)])):m("",!0),r.key==="graph_entity_count"?(_(),d("a",{key:1,onClick:se=>ql(c)},s(c.graph_entity_count),9,br)):m("",!0),r.key==="status"?(_(),d(A,{key:2},[c.file_ext=="pdf"&&c.pdf_parse_type>=2?(_(),d(A,{key:0},[c.status==0?(_(),d("div",kr,[e("div",wr,[e("span",xr,[a(t(Ds)),h(s(t(l)("status_parsing")),1)]),e("a",{onClick:se=>$l(c)},s(t(l)("btn_cancel")),9,Cr)]),e("div",$r,[a(Fl,{size:"small",class:"progress-bar-box",percent:parseInt(c.ocr_pdf_index/c.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),e("div",qr,s(c.ocr_pdf_index)+" / "+s(c.ocr_pdf_total),1)])])):m("",!0)],64)):(_(),d(A,{key:1},[c.status==0?(_(),d("span",Sr,[a(ct,{size:"small"}),h(" "+s(t(l)("status_converting")),1)])):m("",!0)],64)),c.status==1?(_(),d("span",Lr,[a(ct,{size:"small"}),h(" "+s(t(l)("status_learning")),1)])):m("",!0),c.status==2?(_(),d("span",Dr,[a(t(Bt)),h(" "+s(t(l)("status_learn_complete")),1)])):m("",!0),c.status==3?(_(),q(w,{key:4,placement:"top"},{title:o(()=>[e("span",null,s(c.errmsg),1)]),default:o(()=>[e("span",null,[e("span",Mr,[a(t(It)),h(" "+s(t(l)("status_convert_failed")),1)]),Y.value.type==2?(_(),d("a",{key:0,class:"ml8",onClick:se=>We(c)},s(t(l)("btn_learn")),9,Or)):m("",!0)])]),_:2},1024)):m("",!0),c.status==8?(_(),q(w,{key:5,placement:"top"},{title:o(()=>[e("span",null,s(c.errmsg),1)]),default:o(()=>[e("span",null,[e("span",Ir,[a(t(It)),h(" "+s(t(l)("status_convert_error")),1)])])]),_:2},1024)):m("",!0),c.status==4?(_(),d("span",Rr,[a(t(Yt)),h(" "+s(t(l)("status_wait_learn")),1)])):m("",!0),c.status==5?(_(),d("span",Ur,[a(t(Yt)),h(" "+s(t(l)("status_wait_fetch")),1)])):m("",!0),c.status==6?(_(),d("span",zr,[a(ct,{size:"small"}),h(" "+s(t(l)("status_fetching")),1)])):m("",!0),c.status==7?(_(),q(w,{key:9,placement:"top"},{title:o(()=>[e("span",null,s(c.errmsg),1)]),default:o(()=>[e("span",Tr,[a(t(It)),h(" "+s(t(l)("status_fetch_failed")),1)])]),_:2},1024)):m("",!0),c.status==9?(_(),d("span",Fr,[a(t(gt)),h(" "+s(t(l)("status_cancel_parse")),1)])):m("",!0),c.status==10?(_(),d("span",Er,[a(ct,{size:"small"}),h(" "+s(t(l)("status_segmenting")),1)])):m("",!0)],64)):m("",!0),r.key==="graph_status"?(_(),d(A,{key:3},[c.graph_status==0?(_(),d(A,{key:0},[e("span",Nr,[a(t(Yt)),h(" "+s(t(l)("status_wait_generate")),1)]),e("a",{class:"ml8",onClick:se=>ma(c)},s(t(l)("btn_generate")),9,Gr)],64)):c.graph_status==1?(_(),d("span",Wr,[a(t(Is)),h(" "+s(t(l)("status_queueing")),1)])):c.graph_status==2?(_(),d("span",Hr,[a(t(Bt)),h(" "+s(t(l)("status_generate_complete")),1)])):c.graph_status==3?(_(),d(A,{key:3},[e("span",Pr,[a(t(It)),h(" "+s(t(l)("status_generate_failed")),1)]),e("a",{class:"ml8",onClick:se=>ma(c)},s(t(l)("btn_generate")),9,Kr),c.graph_err_msg?(_(),q(w,{key:0,title:c.graph_err_msg},{default:o(()=>[e("div",Br,s(t(l)("label_reason"))+s(c.graph_err_msg),1)]),_:2},1032,["title"])):m("",!0)],64)):c.graph_status==4?(_(),d("span",Yr,[a(ct,{size:"small"}),h(" "+s(t(l)("status_generating")),1)])):c.graph_status==5?(_(),d(A,{key:5},[e("span",Ar,[a(t(Bt)),h(" "+s(t(l)("status_partial_success")),1)]),e("div",Vr,[h(s(t(l)("label_fail_count"))+s(c.graph_err_count||0)+" ",1),e("a",{class:"ml8",onClick:se=>We(c,{graph_status:3})},s(t(l)("btn_details")),9,jr)])],64)):m("",!0)],64)):m("",!0),r.key==="file_size"?(_(),d("span",Jr,s(c.doc_type==3?"-":c.file_size_str)+" / "+s(c.status==0||c.status==1?"-":c.paragraph_count),1)):m("",!0),r.key==="update_info"?(_(),d("div",Qr,[e("span",Xr,[h(s(it(c.update_time))+" ",1),a(te,{title:null,placement:"top",overlayClassName:"update-popover"},{content:o(()=>[e("div",Zr,[e("div",eu,[h(s(t(l)("label_update_frequency")),1),e("span",tu,s(Ct(c)),1),e("div",au,[a(u,{name:"edit",class:"edit-icon",onClick:oe(se=>Gt(c,!0),["stop"])},null,8,["onClick"])])]),e("div",lu,[h(s(t(l)("label_update_time")),1),e("span",su,s(c.update_time),1),a(Kt,{title:t(l)("confirm_update"),onConfirm:se=>Cl(c)},{default:o(()=>[e("a",ou,s(t(l)("btn_update")),1)]),_:1},8,["title","onConfirm"])])])]),default:o(()=>[e("span",nu,[c.doc_type==2&&c.doc_auto_renew_frequency?(_(),d(A,{key:0},[i[27]||(i[27]=e("span",{class:"ml4"},"/",-1)),a(u,{class:"update-icon",name:c.doc_auto_renew_frequency==1?"forbid-update-icon":"update-icon"},null,8,["name"])],64)):m("",!0)])]),_:2},1024)])])):m("",!0),r.key==="action"?(_(),q(ue,{key:6,gap:8},{default:o(()=>[a(w,null,{title:o(()=>[h(s(t(l)("tooltip_re_segment")),1)]),default:o(()=>[a(t(Ta),{class:"btn-hover-block",onClick:se=>fa(c)},null,8,["onClick"])]),_:2},1024),a(ge,null,{overlay:o(()=>[a(j,null,{default:o(()=>[c.doc_type==2?(_(),q(z,{key:0},{default:o(()=>[e("div",{onClick:se=>Gt(c)},s(t(l)("btn_edit")),9,iu)]),_:2},1024)):m("",!0),a(z,{disabled:c.status==6||c.status==7||c.status==0},{default:o(()=>[e("div",{onClick:se=>We(c)},s(t(l)("btn_preview")),9,_u)]),_:2},1032,["disabled"]),a(z,{onClick:se=>pa(c)},{default:o(()=>[e("div",null,s(t(l)("btn_rename")),1)]),_:1},8,["onClick"]),a(Kt,{title:t(l)("confirm_delete"),onConfirm:se=>ia(c),placement:"topRight"},{default:o(()=>[a(z,null,{default:o(()=>[e("span",null,s(t(l)("btn_delete")),1)]),_:1})]),_:1},8,["title","onConfirm"]),a(z,{onClick:se=>ba(c)},{default:o(()=>[e("div",null,s(t(l)("btn_edit_group")),1)]),_:1},8,["onClick"]),a(z,{onClick:se=>ga(c)},{default:o(()=>[e("div",null,s(t(l)("btn_download_doc")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:o(()=>[e("div",{class:"table-btn",onClick:i[20]||(i[20]=oe(()=>{},["prevent"]))},[a(t(Rs),{class:"btn-hover-block"})])]),_:2},1024)]),_:2},1024)):m("",!0),r.key.indexOf("meta_")>-1&&c[r.key]?(_(),q(w,{key:7,title:c[r.key].length>8?c[r.key]:""},{default:o(()=>[e("div",ru,s(c[r.key]),1)]),_:2},1032,["title"])):m("",!0)]),_:1},8,["columns","data-source","pagination"])]))]),_:1})]),a(Da,{open:_e.open,"onUpdate:open":i[22]||(i[22]=r=>_e.open=r),"confirm-loading":_e.confirmLoading,maskClosable:!1,title:t(l)("title_upload_doc"),onOk:yl,onCancel:gl,width:"740px"},{default:o(()=>[a(La,{class:"mt24"},{default:o(()=>[a(pt,{required:"",label:""},{default:o(()=>[e("div",uu,[a(sl,{type:Y.value.type,maxCount:20,value:_e.fileList,"onUpdate:value":i[21]||(i[21]=r=>_e.fileList=r),onChange:hl},null,8,["type","value"])])]),_:1}),ua.value?(_(),q(pt,{key:0,required:"",label:t(l)("label_pdf_parse_mode"),class:"select-card-main"},{default:o(()=>[e("div",du,[(_(),d(A,null,be(J,r=>e("div",{key:r.key,class:ve(["select-card-item",{active:_e.pdf_parse_type==r.key},{disabled:r.key==4&&!N.value}]),onClick:oe(c=>wl(r),["stop"])},[a(u,{class:"check-arrow",name:"check-arrow-filled"}),e("div",pu,[a(u,{name:r.icon,style:{"font-size":"16px"}},null,8,["name"]),h(" "+s(r.title)+" ",1),r.key==4&&!N.value?(_(),d("div",fu,s(t(l)("label_not_enabled")),1)):m("",!0)]),e("div",mu,s(r.desc),1),r.key==4&&!N.value?(_(),d("div",vu,[h(s(t(l)("msg_ali_ocr_not_enabled"))+" ",1),e("div",{class:"card-switch-btn",onClick:oe(xl,["stop"])},s(t(l)("btn_go_enable")),1)])):m("",!0)],10,cu)),64))])]),_:1},8,["label"])):m("",!0)]),_:1})]),_:1},8,["open","confirm-loading","title"]),a(ol,{onOk:me,ref_key:"qaUploadModalRef",ref:da},null,512),a(Da,{open:ee.open,"onUpdate:open":i[26]||(i[26]=r=>ee.open=r),"confirm-loading":ee.confirmLoading,maskClosable:!1,title:t(l)("title_add_online_data"),width:"746px",onOk:fl,onCancel:ml},{default:o(()=>[a(La,{class:"url-add-form",layout:"vertical",ref_key:"urlFormRef",ref:ra,model:ee,rules:ee.rules},{default:o(()=>[a(pt,{name:"urls",label:t(l)("label_web_link")},{default:o(()=>[a(Nl,{style:{height:"120px"},value:ee.urls,"onUpdate:value":i[23]||(i[23]=r=>ee.urls=r),placeholder:t(l)("ph_web_link")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(pt,{name:"doc_auto_renew_frequency",label:t(l)("label_update_frequency"),required:""},{default:o(()=>[a(qa,{value:ee.doc_auto_renew_frequency,"onUpdate:value":i[24]||(i[24]=r=>ee.doc_auto_renew_frequency=r),style:{width:"100%"}},{default:o(()=>[a(Je,{value:1},{default:o(()=>[h(s(t(l)("update_freq_never")),1)]),_:1}),a(Je,{value:2},{default:o(()=>[h(s(t(l)("update_freq_daily")),1)]),_:1}),a(Je,{value:3},{default:o(()=>[h(s(t(l)("update_freq_3days")),1)]),_:1}),a(Je,{value:4},{default:o(()=>[h(s(t(l)("update_freq_7days")),1)]),_:1}),a(Je,{value:5},{default:o(()=>[h(s(t(l)("update_freq_30days")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),ee.doc_auto_renew_frequency>1?(_(),q(pt,{key:0,name:"doc_auto_renew_minute",label:t(l)("label_update_time")},{default:o(()=>[a(Gl,{valueFormat:"HH:mm",value:ee.doc_auto_renew_minute,"onUpdate:value":i[25]||(i[25]=r=>ee.doc_auto_renew_minute=r),format:"HH:mm"},null,8,["value"])]),_:1},8,["label"])):m("",!0)]),_:1},8,["model","rules"])]),_:1},8,["open","confirm-loading","title"]),a(On,{libraryInfo:Y.value,group_id:x.value,onOk:$e,ref_key:"addCustomDocumentRef",ref:_a},null,8,["libraryInfo","group_id"]),a(Fs,{onOk:$e,ref_key:"renameModalRef",ref:ca},null,512),a(Es,{onOk:kl,ref_key:"openGrapgModalRef",ref:b},null,512),a(Fn,{ref_key:"guideLearningTipsRef",ref:g},null,512),a(En,{onOk:me,ref_key:"editOnlineDocRef",ref:va},null,512),a(nl,{group_type:"1",ref_key:"addGroupRef",ref:ha,onOk:Dt},null,512),a(wi,{libraryId:L.value,sense:1,ref_key:"editGroupRef",ref:ya,onOk:Dt},null,8,["libraryId"]),a($i,{ref_key:"feishuRef",ref:X,libraryId:L.value,onOk:Dt},null,8,["libraryId"]),a(ll,{ref_key:"metaRef",ref:$a,"library-id":L.value,onChange:Dt},null,8,["library-id"])])}}},Ru=Ie(gu,[["__scopeId","data-v-8fd7588f"]]);export{Ru as K,Iu as Q};
//# sourceMappingURL=knowledge-document-Co_blTqf.js.map
