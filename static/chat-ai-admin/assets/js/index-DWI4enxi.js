import{b as B,S as T,T as G,U as H,V as J,W as Q}from"../../index-BZRrEp3V.js";import{u as W,v as Y,I as q,ak as j,M as D,a as $,e as A,Q as E,F as N,k as K,B as X,y as Z,a3 as ee,H as oe}from"./ui-antd-BWf8LxGy.js";import{f as p,r as M,a1 as R,_ as g,a2 as u,a5 as l,k as s,Y as O,a9 as te,a7 as F,F as ae,J as z,u as ne,G as le,ae as se}from"./vue-chunks-Ci-XTWEs.js";import"./utils-ChQO-_r6.js";const ie={class:"add-domain-form"},ce={class:"form-item"},de={class:"form-input-box"},ue={__name:"add-domain-modal ",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(U,{expose:m,emit:v}){const b=U;function L(t){return t=t.replace("。",".").toLowerCase(),t=t.replace(/\/$/,""),t=t.replace(/(^\s*)|(\s*$)/g,""),t=t.replace("http://",""),t=t.replace("https://",""),t}const k=v,a=p(!1),h=p("添加自定义域名"),r=p([{label:"http",value:"http:"},{label:"https",value:"https:"}]),o=M({id:null,url:"",protocol:"http:"}),C=()=>{try{if(o.url){const t=new URL(o.url);t.protocol=="http:"||t.protocol=="https:"?o.protocol=t.protocol:o.protocol="http:",o.url=t.hostname}}catch{o.url=L(o.url)}},S=()=>{if(!o.url)return $.error("请输入配置域名");o.url=L(o.url),k("ok",{...o})};return m({open:t=>{t?(o.url=t.url,o.protocol=t.protocol,o.id=t.id,h.value="修改自定义域名"):(o.id=null,o.url="",o.protocol="http:",h.value="添加自定义域名"),a.value=!0},close:()=>{a.value=!1}}),(t,c)=>{const x=Y,_=W,e=q,n=j,y=D;return g(),R(y,{open:a.value,"onUpdate:open":c[2]||(c[2]=f=>a.value=f),title:h.value,onOk:S,confirmLoading:b.confirmLoading},{default:u(()=>[l("div",ie,[l("div",ce,[c[3]||(c[3]=l("div",{class:"form-label"},"配置域名：",-1)),l("div",de,[s(n,{compact:"",style:{width:"100%"}},{default:u(()=>[s(_,{value:o.protocol,"onUpdate:value":c[0]||(c[0]=f=>o.protocol=f),style:{width:"20%"}},{default:u(()=>[(g(!0),O(ae,null,te(r.value,f=>(g(),R(x,{value:f.value,key:f.value},{default:u(()=>[l("span",null,F(f.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s(e,{value:o.url,"onUpdate:value":c[1]||(c[1]=f=>o.url=f),style:{width:"80%"},placeholder:"请输入配置域名",onBlur:C},null,8,["value"])]),_:1})])]),c[4]||(c[4]=l("div",{class:"form-tip"}," 配置域名只需要填写域名部分,比如kf.xxx.com.您可以根据需求选择http或https协议 ",-1))])]),_:1},8,["open","title","confirmLoading"])}}},re=B(ue,[["__scopeId","data-v-bac76e5e"]]),pe={class:"upload-ssl-form"},_e={class:"domain"},fe={__name:"upload-ssl",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(U,{expose:m,emit:v}){const b=v,L=U,k=p(),a=M({id:"",domain:"",ssl_certificate:"",ssl_certificate_key:""}),h={ssl_certificate:[{required:!0,message:"请输入证书文件(.crt或.pem)"}],ssl_certificate_key:[{required:!0,message:"请输入私钥文件(.key)"}]},r=p(!1),o=d=>{a.id=d.id,a.domain=d.url,a.ssl_certificate="",a.ssl_certificate_key="",r.value=!0},C=()=>{r.value=!1},S=()=>{k.value.validate().then(()=>{b("ok",z(a))}).catch(d=>{})};return m({open:o,close:C}),(d,i)=>{const t=E,c=A,x=N,_=D;return g(),R(_,{open:r.value,"onUpdate:open":i[2]||(i[2]=e=>r.value=e),title:"上传证书",onOk:S,confirmLoading:L.confirmLoading},{default:u(()=>[l("div",pe,[l("div",_e,"域名："+F(d.domain),1),s(x,{ref_key:"formRef",ref:k,model:a,rules:h,autocomplete:"off",layout:"vertical"},{default:u(()=>[s(c,{label:"证书文件(.crt或.pem)",name:"ssl_certificate"},{default:u(()=>[s(t,{rows:5,value:a.ssl_certificate,"onUpdate:value":i[0]||(i[0]=e=>a.ssl_certificate=e)},null,8,["value"])]),_:1}),s(c,{label:"私钥文件(.key)",name:"ssl_certificate_key"},{default:u(()=>[s(t,{rows:5,value:a.ssl_certificate_key,"onUpdate:value":i[1]||(i[1]=e=>a.ssl_certificate_key=e)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},me=B(fe,[["__scopeId","data-v-e93ea490"]]),ve={class:"upload-ssl-form"},ke={__name:"upload-validation-file",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(U,{expose:m,emit:v}){const b=v,L=U,k=p(),a=M({id:"",file_name:"",file_content:""}),h={file_name:[{required:!0,message:"请输入文件名"}],file_content:[{required:!0,message:"请输入文件内容"}]},r=p(!1),o=d=>{a.id=d.id,a.file_name="",a.file_content="",r.value=!0},C=()=>{r.value=!1},S=()=>{k.value.validate().then(()=>{b("ok",z(a))}).catch(d=>{})};return m({open:o,close:C}),(d,i)=>{const t=q,c=A,x=E,_=N,e=D;return g(),R(e,{open:r.value,"onUpdate:open":i[2]||(i[2]=n=>r.value=n),title:"上传证书",onOk:S,confirmLoading:L.confirmLoading},{default:u(()=>[l("div",ve,[s(_,{ref_key:"formRef",ref:k,model:a,rules:h,autocomplete:"off",layout:"vertical"},{default:u(()=>[s(c,{label:"文件名（含文件后缀，比如 mzkAzOpb6L.txt）",name:"file_name"},{default:u(()=>[s(t,{value:a.file_name,"onUpdate:value":i[0]||(i[0]=n=>a.file_name=n)},null,8,["value"])]),_:1}),s(c,{label:"文件内容",name:"file_content"},{default:u(()=>[s(x,{rows:5,value:a.file_content,"onUpdate:value":i[1]||(i[1]=n=>a.file_content=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},he=B(ke,[["__scopeId","data-v-a24b293f"]]),ye={class:"domain-page"},ge={class:"page-container"},Le={class:"domain-tips"},xe={class:"list-action-box"},be={class:"list-box"},Ce={key:0},Se={key:1},Ue={key:2,class:"action-box"},we=["onClick"],$e=["onClick"],Oe=["onClick"],Re=["onClick"],Fe={__name:"index",setup(U){const m=p(null),v=p(!1),b=[{title:"域名",dataIndex:"url",key:"url"},{title:"证书",dataIndex:"is_upload",key:"is_upload",width:300},{title:"操作",key:"action"}],L=()=>{m.value.open()},k=e=>{let n={id:e.id,url:e.url,protocol:"http:"};try{const y=new URL(e.url);y.protocol=="http:"||y.protocol=="https:"?n.protocol=y.protocol:n.protocol="http:",n.url=y.hostname}catch{}m.value.open(n)},a=e=>{v.value=!0;let n=`${e.protocol}//${e.url}`;H({url:n,id:e.id||void 0}).then(()=>{$.success("保存成功"),v.value=!1,m.value.close(),_()}).catch(()=>{v.value=!1})},h=e=>{D.confirm({title:"删除",icon:s(oe),content:"确定要删除吗？",onOk(){G({id:e.id}).then(()=>{$.success("删除成功"),_()})},onCancel(){}})},r=p(null),o=p(!1),C=e=>{r.value.open(e)},S=e=>{o.value=!0;let n={id:e.id,ssl_certificate:e.ssl_certificate,ssl_certificate_key:e.ssl_certificate_key};J(n).then(()=>{o.value=!1,r.value.close(),$.success("上传成功"),_()}).catch(()=>{o.value=!1})},d=p(null),i=p(!1),t=e=>{d.value.open(e)},c=e=>{i.value=!0,Q({...e}).then(()=>{i.value=!1,d.value.close(),$.success("上传成功"),_()}).catch(()=>{i.value=!1})},x=p([]),_=async()=>{const e=await T();x.value=e.data||[]};return _(),(e,n)=>{const y=K,f=X,P=Z;return g(),O("div",ye,[l("div",ge,[n[2]||(n[2]=l("div",{class:"page-title"},"自定义域名设置",-1)),l("div",Le,[s(y,{type:"info","show-icon":""},{icon:u(()=>[l("div",null,[s(ne(ee),{style:{"font-size":"16px"}})])]),description:u(()=>n[0]||(n[0]=[l("div",{class:"tip-text"},[l("div",null,"将域名解析到部署服务器，可以通过自由域名访问对外文档和对外服务web APP。"),l("div",null,"1、如需使用https,请在添加域名后，上传证书文件，包括公钥和私钥(ky文件)。")],-1)])),_:1})]),l("div",xe,[l("div",null,[s(f,{type:"primary",onClick:L},{default:u(()=>n[1]||(n[1]=[le("添加自定义域名")])),_:1,__:[1]})])]),l("div",be,[s(P,{columns:b,"data-source":x.value},{bodyCell:u(({column:V,record:w})=>[V.key==="url"?(g(),O("span",Ce,F(w.url),1)):V.key==="is_upload"?(g(),O("span",Se,F(w.is_upload?"已上传":"未上传"),1)):V.key==="action"?(g(),O("span",Ue,[l("a",{class:"action-btn",onClick:I=>C(w)},"上传证书",8,we),l("a",{class:"action-btn",onClick:I=>t(w)},"上传验证文件",8,$e),l("a",{class:"action-btn",onClick:I=>k(w)},"编辑",8,Oe),l("a",{class:"action-btn",onClick:I=>h(w)},"删除",8,Re)])):se("",!0)]),_:1},8,["data-source"])])]),s(re,{ref_key:"addDomainModalRef",ref:m,confirmLoading:v.value,onOk:a},null,8,["confirmLoading"]),s(me,{ref_key:"uploadSSLRef",ref:r,"confirm-loading":o.value,onOk:S},null,8,["confirm-loading"]),s(he,{ref_key:"uploadValidationFileRef",ref:d,"confirm-loading":i.value,onOk:c},null,8,["confirm-loading"])])}}},Me=B(Fe,[["__scopeId","data-v-a35ba7d4"]]);export{Me as default};
