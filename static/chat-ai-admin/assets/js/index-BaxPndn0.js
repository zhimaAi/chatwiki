import{_ as ae,b as _e,w as Re,x as Oe,y as at,r as st,z as nt,A as Ve,d as ot,B as lt,C as it,E as dt,F as rt,G as _t,H as ct,I as ut}from"../../index-C5-B0r5-.js";import{f as h,ac as U,ad as v,F as X,ax as ue,ai as Pe,at as r,u as s,w as me,k as e,ar as t,ae as q,as as d,r as ee,af as oe,G as y,az as Y,J as je,e as ie,B as ge,y as pe,o as pt}from"./vue-chunks-CGLjTDrY.js";import{_ as mt}from"./cu-scroll-C_QJcxx1.js";import{g as Ne}from"./index-AgSL8KLK.js";import{g as Ie}from"./index-Dg6gjwQb.js";import{v as Ee}from"./validate-8MtiUsxW.js";import{F as de,a5 as vt,a6 as ye,u as ht,M as te,b as Q,e as be,I as Se,y as Ae,z as Fe,a7 as Le,f as ze,w as Be,x as Ke,a8 as ft,d as re,G as ke,E as Te,H as Je,a9 as Ye,B as we,W as ve,aa as Ue,v as qe,k as He,ab as gt,h as Qe,i as Ge,ac as yt,ad as bt,Z as kt,ae as wt,D as xt,U as Ct,j as $e,af as $t,ag as Dt,T as Me,ai as Ot,Q as St,$ as Lt,N as Bt,aj as Tt,ak as Ut,V as Mt}from"./ui-antd-B11sc9DP.js";import{d as De}from"./role_avatar-DL0r08JY.js";import{g as xe,a as Ze,b as Rt,s as Vt,d as Pt,c as jt,e as Nt,f as It,h as Et}from"./index-BW5J6MyT.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";const At={class:"page-tabs"},Ft=["onClick"],zt={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(G,{emit:i}){const{t:T}=_e(),a=i,R=G,f=h([{value:1,title:T("views.user.model.teamMembers"),langKey:"views.user.model.teamMembers"}]),p=m=>{a("update:value",m),a("change",m)};return(m,o)=>(v(),U("div",At,[(v(!0),U(X,null,ue(f.value,L=>(v(),U("div",{class:Pe(["tab-item",{active:R.value==L.value}]),onClick:I=>p(L.value),key:L.value},r(s(T)(L.langKey)),11,Ft))),128))]))}},Kt=ae(zt,[["__scopeId","data-v-d59c98da"]]),Jt={class:"avatar-uploader"},Yt=["src"],qt={key:1},Ht=["src"],Qt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(G,{emit:i}){function T(n){return new Promise((k,S)=>{const E=new FileReader;E.readAsDataURL(n),E.onload=()=>k(E.result),E.onerror=z=>S(z)})}const a=i,R=G,f=h([]),p=h(!1),m=h("");me(()=>R.value,n=>{m.value=n},{immediate:!0});const o=de.useInjectFormItemContext(),L=()=>{let n={imageUrl:m.value,file:f.value[0].originFileObj};a("change",n),a("update:value",n.imageUrl),o.onFieldChange()},I=n=>n.type==="image/jpeg"||n.type==="image/png"?n.size/1024<1024?(f.value=[n],T(n).then(E=>{m.value=E,p.value=!1,L()}),!1):(Q.error("成员头像图片大小不能超过1M"),!1):(Q.error("机器人头像只支持JPG、PNG格式的图片"),!1),O=h(!1),B=h(""),C=h(""),A=()=>{O.value=!1,C.value=""},M=async n=>{!n.url&&!n.preview&&(n.preview=await T(n.originFileObj)),B.value=n.url||n.preview,O.value=!0,C.value=n.name||n.url.substring(n.url.lastIndexOf("/")+1)};return(n,k)=>{const S=ht,E=te;return v(),U("div",Jt,[e(S,{"file-list":f.value,"onUpdate:fileList":k[0]||(k[0]=z=>f.value=z),"list-type":"picture-card","show-upload-list":!1,"before-upload":I,accept:".jpg,.png,.jpeg",onPreview:M},{default:t(()=>[m.value?(v(),U("img",{key:0,class:"avatar",src:m.value,alt:"avatar"},null,8,Yt)):(v(),U("div",qt,[p.value?(v(),q(s(vt),{key:0})):(v(),q(s(ye),{key:1})),k[1]||(k[1]=d("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list"]),e(E,{open:O.value,title:C.value,footer:null,onCancel:A},{default:t(()=>[d("img",{alt:"example",style:{width:"100%"},src:B.value},null,8,Ht)]),_:1},8,["open","title"])])}}},Gt=ae(Qt,[["__scopeId","data-v-662035a2"]]),Zt={class:"form-box"},Wt={class:"avatar-box"},Xt={class:"tip"},ea={class:"flex-item-box"},ta={class:"flex-item-box"},aa={class:"flex-item-box"},sa={class:"flex-item-box"},na={key:0,style:{"margin-top":"4px"}},oa={__name:"add-team-members",emits:["ok"],setup(G,{expose:i,emit:T}){const{t:a}=_e("views.user.manage.add-team-members"),R=T,f=de.useForm,p=h(!1),m=h(a("add_team_member")),o=ee({user_name:"",nick_name:"",avatar:"",avatar_url:"",user_roles:"3",password:"",check_password:"",department_ids:[],expire_time_type:0,expire_time:"",id:""}),L=h([]),I=()=>{xe({}).then(w=>{let D=w.data||[];L.value=Oe(D)})},O=w=>{o.avatar=w.file},B=h([]);Re({page:1,size:200,search:""}).then(w=>{let D=w.data.list||[];B.value=D.filter(H=>H.id!="1"&&H.role_type!=1)});const C=ee({user_name:[{message:a("please_input_login_account"),required:!0},{validator:async(w,D)=>!/^[a-zA-Z0-9_.-]+$/.test(D)&&D?Promise.reject(a("account_format_tip")):Promise.resolve()}],nick_name:[{message:a("input_nickname"),required:!0}],avatar_url:[{message:a("please_upload_avatar"),required:!0}],user_roles:[{message:a("please_select_member_role"),required:!0}],password:[{message:a("please_input_login_password"),required:!0},{validator:async(w,D)=>!Ee(D)&&D?Promise.reject(a("password_format_tip")):Promise.resolve()}],check_password:[{message:a("please_input_confirm_password"),required:!0},{validator:async(w,D)=>D!=o.password&&D?Promise.reject(a("passwords_not_match")):Promise.resolve()}],expire_time:[{validator:async(w,D)=>o.expire_time_type==1&&!D?Promise.reject(a("please_select_specify_date")):Promise.resolve()}],department_ids:[{message:a("please_select_department"),required:!0}]}),{resetFields:A,validate:M,validateInfos:n}=f(o,C),k=w=>{m.value=a("add_team_member"),p.value=!0,A(),o.user_name="",o.nick_name="",o.avatar="",o.avatar_url=De,o.user_roles="3",o.password="",o.check_password="",o.expire_time_type=0,o.expire_time="",o.department_ids=w?[w]:[],o.id="",I()},S=w=>{m.value=a("edit_team_member"),o.user_name=w.user_name,o.nick_name=w.nick_name,o.avatar_url=w.avatar||De,o.avatar="",o.user_roles=w.user_roles,o.password="",o.check_password="",o.id=w.id,w.expire_time>0?(o.expire_time_type=1,o.expire_time=re(w.expire_time*1e3)):(o.expire_time_type=0,o.expire_time=""),o.department_ids=w.departments.map(D=>+D.id),delete C.password,delete C.check_password,p.value=!0,I()},E=h(!1),z=()=>{M().then(()=>{let w={...je(o)};w.expire_time_type==1?w.expire_time=re(w.expire_time).unix():w.expire_time=0,w.department_ids=o.department_ids.join(","),delete w.avatar_url,E.value=!0,at(w).then(D=>{Q.success(`${m.value}${a("success")}`),p.value=!1,R("ok")}).finally(()=>{E.value=!1})})},$=w=>w&&w<re().startOf("day");return i({add:k,edit:S}),(w,D)=>{const H=Se,j=be,u=Fe,l=Ae,c=Le,_=ze,x=Ke,N=Be,F=ft,Z=de,P=te;return v(),U("div",null,[e(P,{open:p.value,"onUpdate:open":D[9]||(D[9]=g=>p.value=g),title:m.value,onOk:z,width:"746px"},{default:t(()=>[d("div",Zt,[d("div",Wt,[e(Gt,{value:o.avatar_url,"onUpdate:value":D[0]||(D[0]=g=>o.avatar_url=g),onChange:O},null,8,["value"]),d("div",Xt,r(s(a)("click_to_replace_tip")),1)]),e(Z,{layout:"vertical",autocomplete:"off"},{default:t(()=>[d("div",ea,[e(j,oe({label:s(a)("member_nickname")},s(n).nick_name),{default:t(()=>[e(H,{maxlength:100,type:"text",placeholder:s(a)("input_nickname"),value:o.nick_name,"onUpdate:value":D[1]||(D[1]=g=>o.nick_name=g)},null,8,["placeholder","value"])]),_:1},16,["label"]),e(j,oe({label:s(a)("login_account")},s(n).user_name),{default:t(()=>[e(H,{disabled:o.id!="",type:"text",placeholder:s(a)("account_format_tip"),value:o.user_name,"onUpdate:value":D[2]||(D[2]=g=>o.user_name=g)},null,8,["disabled","placeholder","value"])]),_:1},16,["label"])]),d("div",ta,[e(j,oe({label:s(a)("member_role")},s(n).user_roles),{default:t(()=>[e(l,{value:o.user_roles,"onUpdate:value":D[3]||(D[3]=g=>o.user_roles=g),style:{width:"100%"},placeholder:s(a)("select_member_role")},{default:t(()=>[(v(!0),U(X,null,ue(B.value,g=>(v(),q(u,{key:g.id,value:g.id},{default:t(()=>[y(r(g.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},16,["label"]),e(j,oe({label:s(a)("select_department")},s(n).department_ids,{name:"department_ids"}),{default:t(()=>[e(c,{value:o.department_ids,"onUpdate:value":D[4]||(D[4]=g=>o.department_ids=g),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:s(a)("please_select"),"allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":L.value,"tree-node-filter-prop":"label"},{title:t(({value:g,label:se})=>[d("div",null,r(se),1)]),_:1},8,["value","placeholder","tree-data"])]),_:1},16,["label"])]),d("div",aa,[o.id?Y("",!0):(v(),q(j,oe({key:0,label:s(a)("login_password")},s(n).password),{default:t(()=>[e(_,{value:o.password,"onUpdate:value":D[5]||(D[5]=g=>o.password=g),placeholder:s(a)("password_format_tip")},null,8,["value","placeholder"])]),_:1},16,["label"])),o.id?Y("",!0):(v(),q(j,oe({key:1,label:s(a)("confirm_password")},s(n).check_password),{default:t(()=>[e(_,{value:o.check_password,"onUpdate:value":D[6]||(D[6]=g=>o.check_password=g),placeholder:s(a)("reinput_password")},null,8,["value","placeholder"])]),_:1},16,["label"]))]),d("div",sa,[e(j,oe({label:s(a)("expire_time")},s(n).expire_time,{required:""}),{default:t(()=>[e(N,{value:o.expire_time_type,"onUpdate:value":D[7]||(D[7]=g=>o.expire_time_type=g)},{default:t(()=>[e(x,{value:0},{default:t(()=>[y(r(s(a)("permanent_valid")),1)]),_:1}),e(x,{value:1},{default:t(()=>[y(r(s(a)("specify_time")),1)]),_:1})]),_:1},8,["value"]),o.expire_time_type==1?(v(),U("div",na,[e(F,{showNow:!1,format:"YYYY-MM-DD HH:mm","disabled-date":$,value:o.expire_time,"onUpdate:value":D[8]||(D[8]=g=>o.expire_time=g),"show-time":{defaultValue:s(re)("00:00","HH:mm")}},null,8,["value","show-time"])])):Y("",!0)]),_:1},16,["label"])])]),_:1})])]),_:1},8,["open","title"])])}}},la=ae(oa,[["__scopeId","data-v-2baa1762"]]),ia={class:"form-box"},da={__name:"reset-password",emits:["ok"],setup(G,{expose:i,emit:T}){const a=T,R=de.useForm,{t:f}=_e("views.user.manage.components.reset-password"),p=h(!1),m=ie(()=>f("modal_title")),o=ee({password:"",check_password:"",id:""}),L=ee({password:[{message:f("enter_login_password"),required:!0},{validator:async(M,n)=>!Ee(n)&&n?Promise.reject(f("password_must_contain")):Promise.resolve()}],check_password:[{message:f("enter_confirm_password"),required:!0},{validator:async(M,n)=>n!=o.password&&n?Promise.reject(f("passwords_not_match")):Promise.resolve()}]}),{resetFields:I,validate:O,validateInfos:B}=R(o,L),C=M=>{M.id,p.value=!0,I(),o.password="",o.check_password="",o.id=M.id},A=()=>{O().then(()=>{st({...je(o)}).then(M=>{Q.success(f("modification_successful")),p.value=!1,a("ok")})})};return i({open:C}),(M,n)=>{const k=ze,S=be,E=de,z=te;return v(),U("div",null,[e(z,{open:p.value,"onUpdate:open":n[2]||(n[2]=$=>p.value=$),title:m.value,onOk:A,width:"476px"},{default:t(()=>[d("div",ia,[e(E,{layout:"vertical"},{default:t(()=>[e(S,oe({label:s(f)("login_password")},s(B).password),{default:t(()=>[e(k,{value:o.password,"onUpdate:value":n[0]||(n[0]=$=>o.password=$),placeholder:s(f)("password_placeholder")},null,8,["value","placeholder"])]),_:1},16,["label"]),e(S,oe({label:s(f)("confirm_password")},s(B).check_password),{default:t(()=>[e(k,{value:o.check_password,"onUpdate:value":n[1]||(n[1]=$=>o.check_password=$),placeholder:s(f)("re_enter_password")},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1})])]),_:1},8,["open","title"])])}}},ra=ae(da,[["__scopeId","data-v-31ddc628"]]),_a={key:0,class:"form-wrapper"},ca={class:"select"},ua={class:"tools-wrapper"},pa=["src"],ma={class:"item-name"},va={key:1,class:"form-wrapper"},ha={class:"main-tabs-box"},fa={class:"select"},ga={class:"tools-wrapper"},ya={class:"item-name"},ba={class:"tools-wrapper"},ka={class:"item-name"},wa={key:2,class:"form-wrapper"},xa={class:"select"},Ca={class:"tools-wrapper"},$a={class:"item-name"},Da={__name:"see-model-alert",props:{robotList:{type:Array,default:()=>[]},libraryList:{type:Array,default:()=>[]},formList:{type:Array,default:()=>[]}},emits:["save","ok"],setup(G,{expose:i,emit:T}){const{t:a}=_e("views.user.manage.components.see-model-alert"),R=T,f=G,p=h([]),m=h(""),o=h(!1),L=h([]),I=h([]),O=l=>{const c=[];return l.map(_=>{c.push(_.id)}),c},B=l=>{p.value=l},C=h(1),A=ie(()=>[{value:2,payload:{title:a("department_knowledge_base")}},{value:1,payload:{title:a("member_knowledge_base")}}]),M=h(A.value);me(A,l=>{M.value=l},{immediate:!0});let n=null;const k=h(1),S=h(1),E=h(),z=async(l,c,_)=>{p.value=[],k.value=l,S.value=1,C.value=1,n=JSON.parse(JSON.stringify(_)),E.value=n.id,_=JSON.parse(JSON.stringify(_)),M.value=A,_.managed_robot_list=_.managed_robot_list||[],_.managed_library_list=_.managed_library_list||[],_.managed_form_list=_.managed_form_list||[];let x=[];l==1?(m.value=a("add_member_robot"),x=f.robotList,x.forEach(N=>{let F=_.managed_robot_list.filter(Z=>Z.id==N.id);F.length?N.operate_rights=F[0].operate_rights:N.operate_rights="4"}),c&&c=="edit"&&(m.value=a("edit_member_robot"),p.value=O(_.managed_robot_list))):l==2?(m.value=a("add_member_knowledge"),x=f.libraryList,x.forEach(N=>{let F=_.managed_library_list.filter(Z=>Z.id==N.id);F.length?N.operate_rights=F[0].operate_rights:N.operate_rights="4"}),c&&c=="edit"&&(m.value=a("edit_member_knowledge"),p.value=O(_.managed_library_list))):l==3&&(m.value=a("add_member_database"),x=f.formList,x.forEach(N=>{let F=_.managed_form_list.filter(Z=>Z.id==N.id);F.length?N.operate_rights=F[0].operate_rights:N.operate_rights="4"}),c&&c=="edit"&&(m.value=a("edit_member_database"),p.value=O(_.managed_form_list))),L.value=x,o.value=!0},$=()=>{Ze({object_type:k.value,identity_type:S.value,identity_id:E.value,tab:S.value}).then(l=>{I.value=l.data||[]})},w=()=>{C.value==2&&$()},D=(l,c)=>{p.value=[],S.value=1,C.value=1,k.value=l,E.value=c;let _=[];l==1?(m.value=a("batch_update_member_robot"),_=f.robotList):l==2?(m.value=a("batch_update_member_knowledge"),_=f.libraryList):l==3&&(m.value=a("batch_update_member_database"),_=f.formList),_.forEach(x=>{x.operate_rights="4"}),L.value=_,o.value=!0},H=(l,c,_)=>{p.value=[],c.is_user?S.value=1:S.value=2,E.value=c.id;const x=ie(()=>[{value:2,payload:{title:S.value==1?a("department_knowledge_base"):a("superior_knowledge_base")}},{value:1,payload:{title:S.value==1?a("member_knowledge_base"):a("department_knowledge_base")}}]);M.value=x.value,me(x,F=>{M.value=F},{immediate:!0}),C.value=1,k.value=l;let N=[];l==1?(m.value=a("add_member_robot"),N=f.robotList):l==2?(m.value=a("add_member_knowledge"),N=f.libraryList):l==3&&(m.value=a("add_member_database"),N=f.formList),N.forEach(F=>{let Z=_.filter(P=>P.object_id==F.id);Z.length?F.operate_rights=Z[0].operate_rights:F.operate_rights="4"}),p.value=_.map(F=>F.object_id),L.value=N,o.value=!0},j=()=>{let l={identity_ids:E.value,identity_type:S.value,object_type:k.value},c=[];L.value.forEach(_=>{p.value.includes(_.id)&&c.push({object_id:+_.id,object_type:+k.value,operate_rights:+_.operate_rights})}),l.object_array=JSON.stringify(c),Rt(l).then(_=>{o.value=!1,Q.success(a("save_success")),R("ok")})},u=()=>{};return i({open:z,handleBatchOpen:D,handleDepartmentOpen:H}),(l,c)=>{const _=Te,x=Ke,N=Be,F=ke,Z=Je,P=te;return v(),q(P,{class:"add-model-alert",width:"800px",open:o.value,"onUpdate:open":c[1]||(c[1]=g=>o.value=g),title:m.value,onOk:j,onCancel:u},{default:t(()=>[k.value==1?(v(),U("div",_a,[d("div",ca,r(s(a)("selected_count",{count:p.value.length})),1),e(F,{"data-source":L.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:p.value,onChange:B}},{default:t(()=>[e(_,{title:s(a)("robot"),"data-index":"robot_name",width:350},{default:t(({record:g})=>[d("div",ua,[d("img",{class:"model-logo",src:g.robot_avatar,alt:""},null,8,pa),d("div",ma,r(g.robot_name),1)])]),_:1},8,["title"]),e(_,{title:s(a)("permission"),"data-index":"operate_rights",width:350},{default:t(({record:g})=>[e(N,{value:g.operate_rights,"onUpdate:value":se=>g.operate_rights=se},{default:t(()=>[e(x,{value:"4"},{default:t(()=>[y(r(s(a)("manage")),1)]),_:1}),e(x,{value:"2"},{default:t(()=>[y(r(s(a)("edit")),1)]),_:1}),e(x,{value:"1"},{default:t(()=>[y(r(s(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])])):k.value==2?(v(),U("div",va,[d("div",ha,[e(Z,{value:C.value,"onUpdate:value":c[0]||(c[0]=g=>C.value=g),options:M.value,onChange:w},{label:t(({payload:g})=>[y(r(g.title),1)]),_:1},8,["value","options"])]),C.value==1?(v(),U(X,{key:0},[d("div",fa,r(s(a)("selected_count",{count:p.value.length})),1),e(F,{"data-source":L.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:p.value,onChange:B}},{default:t(()=>[e(_,{title:s(a)("knowledge_base"),"data-index":"library_name",width:350},{default:t(({record:g})=>[d("div",ga,[d("div",ya,r(g.library_name),1)])]),_:1},8,["title"]),e(_,{title:s(a)("permission"),"data-index":"operate_rights",width:350},{default:t(({record:g})=>[e(N,{value:g.operate_rights,"onUpdate:value":se=>g.operate_rights=se},{default:t(()=>[e(x,{value:"4"},{default:t(()=>[y(r(s(a)("manage")),1)]),_:1}),e(x,{value:"2"},{default:t(()=>[y(r(s(a)("edit")),1)]),_:1}),e(x,{value:"1"},{default:t(()=>[y(r(s(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])],64)):(v(),q(F,{key:1,"data-source":I.value,pagination:!1,scroll:{y:500},"row-key":"id"},{default:t(()=>[e(_,{title:s(a)("knowledge_base"),"data-index":"name",width:350},{default:t(({record:g})=>[d("div",ba,[d("div",ka,r(g.name),1)])]),_:1},8,["title"]),e(_,{title:s(a)("permission"),"data-index":"operate_rights",width:350},{default:t(({record:g})=>[e(N,{value:g.operate_rights,"onUpdate:value":se=>g.operate_rights=se,disabled:""},{default:t(()=>[e(x,{value:"4"},{default:t(()=>[y(r(s(a)("manage")),1)]),_:1}),e(x,{value:"2"},{default:t(()=>[y(r(s(a)("edit")),1)]),_:1}),e(x,{value:"1"},{default:t(()=>[y(r(s(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source"]))])):k.value==3?(v(),U("div",wa,[d("div",xa,r(s(a)("selected_count",{count:p.value.length})),1),e(F,{"data-source":L.value,pagination:!1,scroll:{y:500},"row-key":"id","row-selection":{selectedRowKeys:p.value,onChange:B}},{default:t(()=>[e(_,{title:s(a)("database"),"data-index":"name",width:350},{default:t(({record:g})=>[d("div",Ca,[d("div",$a,r(g.name),1)])]),_:1},8,["title"]),e(_,{title:s(a)("permission"),"data-index":"operate_rights",width:350},{default:t(({record:g})=>[e(N,{value:g.operate_rights,"onUpdate:value":se=>g.operate_rights=se},{default:t(()=>[e(x,{value:"4"},{default:t(()=>[y(r(s(a)("manage")),1)]),_:1}),e(x,{value:"2"},{default:t(()=>[y(r(s(a)("edit")),1)]),_:1}),e(x,{value:"1"},{default:t(()=>[y(r(s(a)("view")),1)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1},8,["title"])]),_:1},8,["data-source","row-selection"])])):Y("",!0)]),_:1},8,["open","title"])}}},We=ae(Da,[["__scopeId","data-v-057d21da"]]),Oa={class:"form-box"},Sa={class:"form-item"},La={class:"form-content"},Ba={key:0,class:"form-item"},Ta={class:"form-content"},Ua={__name:"add-department",emits:["ok"],setup(G,{expose:i,emit:T}){const a=h(!1),R=T,f=ee({department_name:"",id:"",pid:""}),p=h(""),m=B=>{f.id="",f.pid=B.id>0?B.id||"":void 0,f.department_name="",p.value="添加部门",a.value=!0,I()},o=B=>{f.id=B.id||"",f.pid=B.pid||"",f.department_name=B.title||"",p.value="重命名",a.value=!0},L=h([]),I=()=>{xe({}).then(B=>{let C=B.data||[];L.value=Oe(C)})},O=()=>{if(!f.department_name)return Q.error("请输入部门名称");if(!f.id&&!f.pid)return Q.error("请选择所属部门");Vt({...f}).then(B=>{Q.success("修改成功"),a.value=!1,R("ok")})};return i({show:m,rename:o}),(B,C)=>{const A=Se,M=Le,n=te;return v(),U("div",null,[e(n,{open:a.value,"onUpdate:open":C[2]||(C[2]=k=>a.value=k),title:p.value,onOk:O,width:472},{default:t(()=>[d("div",Oa,[d("div",Sa,[C[3]||(C[3]=d("div",{class:"form-label"},"部门名称",-1)),d("div",La,[e(A,{maxLength:10,value:f.department_name,"onUpdate:value":C[0]||(C[0]=k=>f.department_name=k),placeholder:"请输入部门名称"},null,8,["value"])])]),f.id?Y("",!0):(v(),U("div",Ba,[C[4]||(C[4]=d("div",{class:"form-label"},"所属部门",-1)),d("div",Ta,[e(M,{value:f.pid,"onUpdate:value":C[1]||(C[1]=k=>f.pid=k),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择","allow-clear":"","tree-default-expand-all":"","tree-data":L.value,"tree-node-filter-prop":"label"},{title:t(({value:k,label:S})=>[d("div",null,r(S),1)]),_:1},8,["value","tree-data"])])]))])]),_:1},8,["open","title"])])}}},Ma=ae(Ua,[["__scopeId","data-v-0fb87f68"]]),Ra={class:"del-box"},Va={class:"icon-box"},Pa={class:"footer-btn"},ja={class:"set-box"},Na={class:"set-item"},Ia={__name:"del-department",emits:["ok"],setup(G,{expose:i,emit:T}){const a=h(!1),R=h(!1),f=T,p=ee({id:"",new_department_id:void 0});let m=[];const o=M=>{if(m=[],m=L(M),p.new_department_id=void 0,p.id=M.id,M.children.length==0){te.confirm({title:"提示",icon:e(ve),content:"确定删除该部门",onOk(){B()}});return}a.value=!0,A()};function L(M){let n=[M.id];if(M.children&&M.children.length>0)for(const k of M.children)n=n.concat(L(k));return n}const I=()=>{R.value=!0},O=()=>{p.new_department_id="",B()},B=()=>{Pt({...p}).then(M=>{R.value=!1,a.value=!1,Q.success("删除成功"),f("ok",p.id)})},C=h([]),A=()=>{jt().then(M=>{let n=M.data||[];C.value=n.filter(k=>!m.includes(+k.id))})};return i({show:o}),(M,n)=>{const k=we,S=te,E=Fe,z=Ae;return v(),U("div",null,[e(S,{open:a.value,"onUpdate:open":n[1]||(n[1]=$=>a.value=$),title:null,footer:null,width:480,closable:!1},{default:t(()=>[d("div",Ra,[d("div",Va,[e(s(Ye))]),n[7]||(n[7]=d("div",{class:"top-title"},"删除部门",-1)),n[8]||(n[8]=d("div",{class:"content"}," 确认删除部门么？直接删除后，该部门成员归属到默认部门或设置新的部门 ",-1)),d("div",Pa,[e(k,{onClick:n[0]||(n[0]=$=>a.value=!1)},{default:t(()=>[...n[4]||(n[4]=[y("关闭",-1)])]),_:1}),e(k,{danger:"",onClick:O},{default:t(()=>[...n[5]||(n[5]=[y("直接删除",-1)])]),_:1}),e(k,{type:"primary",onClick:I},{default:t(()=>[...n[6]||(n[6]=[y("删除并设置",-1)])]),_:1})])])]),_:1},8,["open"]),e(S,{open:R.value,"onUpdate:open":n[3]||(n[3]=$=>R.value=$),title:"设置部门",width:472,onOk:B},{default:t(()=>[d("div",ja,[n[10]||(n[10]=d("div",{class:"set-desc"},"删除之前请先将之前部门的成员换到其他团队",-1)),d("div",Na,[n[9]||(n[9]=d("div",{class:"set-label"},"所属部门",-1)),d("div",null,[e(z,{value:p.new_department_id,"onUpdate:value":n[2]||(n[2]=$=>p.new_department_id=$),style:{width:"100%"},placeholder:"请选择"},{default:t(()=>[(v(!0),U(X,null,ue(C.value,$=>(v(),q(E,{key:$.id,value:$.id},{default:t(()=>[y(r($.department_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])])]),_:1},8,["open"])])}}},Ea=ae(Ia,[["__scopeId","data-v-de653ece"]]),Aa={class:"department-tree-search"},Fa={class:"flex-block"},za={class:"tree-list-box"},Ka={style:{"margin-right":"4px"}},Ja={class:"action-btn toggle-btn"},Ya={class:"doc-item"},qa={key:0,class:"tree-title"},Ha={style:{color:"#f50"}},Qa={style:{color:"#f50"}},Ga={key:1,class:"tree-title"},Za={class:"use-num"},Wa={key:2,class:"doc-action-box"},Xa={__name:"department-tree",emits:["select","save","refresh"],setup(G,{expose:i,emit:T}){const a=T;let R=[];const f=[],p=(u,l)=>{let c;for(let _=0;_<l.length;_++){const x=l[_];x.children&&(x.children.some(N=>N.key===u)?c=x.key:p(u,x.children)&&(c=p(u,x.children)))}return c},m=h([]),o=h([]),L=h(""),I=h(!0),O=h([]);let B="",C={};const A=u=>{m.value=u,I.value=!1};me(L,u=>{const l=f.map(c=>c.title.indexOf(u)>-1?p(c.key,O.value):null).filter((c,_,x)=>c&&x.indexOf(c)===_);m.value=l,L.value=u,I.value=!0});const M=u=>{for(let l=0;l<u.length;l++){const c=u[l],_=c.key;f.push({key:_,title:c.title}),c.children&&M(c.children)}},n=u=>{xe({}).then(l=>{let c=l.data||[];R=[],R=nt(c),M(R),O.value=R,u&&(c.forEach(_=>{_.is_default==1&&(B=_.id,C=_)}),pe(()=>{B&&(o.value=[B],a("select",C))}))})};n(!0);let k={};const S=u=>{o.value[0]==u?pe(()=>{B&&(o.value=[B],a("select",C))}):a("refresh"),n()},E=h(),z=u=>{E.value.show(u)},$=u=>{E.value.rename(u)},w=(u,l)=>{l.node.is_user,l.node.id,l.selected||pe(()=>{o.value=[l.node.id]}),k={...l.node},a("select",k)},D=h(null),H=u=>{D.value.show(u)},j=()=>{n(),a("refresh")};return i({getLists:n}),(u,l)=>{const c=Ue,_=qe,x=Ge,N=Qe,F=He,Z=bt;return v(),U(X,null,[d("div",Aa,[d("div",Fa,[e(c,{value:L.value,"onUpdate:value":l[0]||(l[0]=P=>L.value=P),placeholder:"搜索部门",style:{flex:"1"}},null,8,["value"]),d("div",{class:"add-btn-box",onClick:l[1]||(l[1]=P=>z({}))},[e(s(ye))])]),d("div",za,[e(Z,{"expanded-keys":m.value,selectedKeys:o.value,"onUpdate:selectedKeys":l[3]||(l[3]=P=>o.value=P),"auto-expand-parent":I.value,onSelect:w,"tree-data":O.value,blockNode:"",onExpand:A},{switcherIcon:t(({switcherCls:P})=>[d("div",Ka,[d("span",Ja,[e(s(yt),{style:{"font-size":"12px"},class:Pe(P)},null,8,["class"])])])]),title:t(P=>[d("div",Ya,[P.title.indexOf(L.value)>-1&&L.value?(v(),U("span",qa,[P.title.length>3&&P.level>3?(v(),q(_,{key:0},{title:t(()=>[y(r(P.title),1)]),default:t(()=>[y(" "+r(P.title.substring(0,P.title.indexOf(L.value)))+" ",1),d("span",Ha,r(L.value),1),y(" "+r(P.title.substring(P.title.indexOf(L.value)+L.value.length)),1)]),_:2},1024)):(v(),U(X,{key:1},[y(r(P.title.substring(0,P.title.indexOf(L.value)))+" ",1),d("span",Qa,r(L.value),1),y(" "+r(P.title.substring(P.title.indexOf(L.value)+L.value.length)),1)],64))])):(v(),U("span",Ga,[P.title.length>3&&P.level>3?(v(),q(_,{key:0},{title:t(()=>[y(r(P.title),1)]),default:t(()=>[y(" "+r(P.title),1)]),_:2},1024)):(v(),U(X,{key:1},[y(r(P.title),1)],64))])),d("div",Za,r(P.children_nums),1),P.is_user?Y("",!0):(v(),U("div",Wa,[e(F,null,{overlay:t(()=>[e(N,null,{default:t(()=>[e(x,{key:"addDoc",onClick:ge(g=>z(P),["stop","prevent"])},{default:t(()=>[...l[4]||(l[4]=[d("span",{class:"menu-name"},"添加子部门",-1)])]),_:1},8,["onClick"]),e(x,{key:"importDoc",onClick:ge(g=>$(P),["stop","prevent"])},{default:t(()=>[...l[5]||(l[5]=[d("span",{class:"menu-name"},"重命名",-1)])]),_:1},8,["onClick"]),P.is_default!=1?(v(),q(x,{key:"del",onClick:ge(g=>H(P),["stop","prevent"])},{default:t(()=>[...l[6]||(l[6]=[d("span",{class:"menu-name",style:{color:"#fb363f"}},"删 除",-1)])]),_:1},8,["onClick"])):Y("",!0)]),_:2},1024)]),default:t(()=>[d("span",{class:"action-btn",onClick:l[2]||(l[2]=ge(()=>{},["stop"]))},[e(s(gt))])]),_:2},1024)]))])]),_:1},8,["expanded-keys","selectedKeys","auto-expand-parent","tree-data"])])]),e(Ma,{ref_key:"addDepartmentRef",ref:E,onOk:j},null,512),e(Ea,{ref_key:"delDepartmentRef",ref:D,onOk:S},null,512)],64)}}},es=ae(Xa,[["__scopeId","data-v-f461874a"]]),ts={class:"main-content-box"},as={style:{"margin-top":"12px"}},ss={class:"list-content"},ns={key:0,class:"user-block"},os={class:"role-menu-box"},ls=["onClick"],is={class:"menu-header"},ds={class:"title"},rs={class:"desc"},_s={key:0,class:"check-box"},cs=["onClick"],us={class:"menu-header"},ps={class:"title"},ms={class:"desc"},vs={key:0,class:"check-box"},hs=["onClick"],fs={class:"menu-header"},gs={class:"title"},ys={class:"desc"},bs={key:0,class:"check-box"},ks={class:"hover-btn-box"},ws=["onClick"],xs={__name:"knowledge-permissions",props:{treeParmas:{type:Object,default:()=>({})}},setup(G){const{t:i}=_e("views.user.manage.components.knowledge-permissions"),T=h("2"),a=h([]),R=ie(()=>i({2:"knowledge_base",1:"robot",3:"database"}[T.value]||"knowledge_base")),f=ie(()=>i({2:"add_knowledge_base_permission",1:"add_robot_permission",3:"add_database_permission"}[T.value]||"add_knowledge_base_permission")),p=ie(()=>({4:"manage",2:"edit",1:"view"}));ie(()=>({4:"manage_desc",2:"edit_desc",1:"view_desc"}));const m=G;me(()=>m.treeParmas,$=>{o()},{deep:!0});const o=()=>{Ze({object_type:T.value,identity_type:m.treeParmas.is_user?1:2,identity_id:m.treeParmas.id}).then($=>{let w=$.data||[];a.value=w})};o();const L=()=>{o()},I=($,w)=>{const D=p[w],H=i(D);te.confirm({title:i("prompt"),icon:e(ve),content:i("confirm_modify_permission",{role:H}),okText:i("confirm"),cancelText:i("cancel"),onOk:()=>{let j=[{object_id:+$.object_id,object_type:+$.object_type,operate_rights:+w}];Nt({identity_ids:$.identity_id,identity_type:2,object_array:JSON.stringify(j)}).then(u=>{Q.success(i("modify_success")),o()})},onCancel(){}})},O=$=>{te.confirm({title:i("prompt"),icon:e(ve),content:i("confirm_delete_data"),okText:i("confirm"),okType:"danger",cancelText:i("cancel"),onOk:()=>{It({identity_id:$.identity_id,identity_type:2,object_id:$.object_id,object_type:$.object_type}).then(w=>{Q.success(i("delete_success")),o()})},onCancel(){}})},B=h([]),C=h([]),A=h([]),M=async()=>{await Ne().then($=>{B.value=$.data}).catch(()=>{})},n=async()=>{await Ve({type:""}).then($=>{C.value=$.data}).catch(()=>{})},k=async()=>{await Ie().then($=>{A.value=$.data}).catch(()=>{})},S=h(null),E=async()=>{if(!m.treeParmas.id)return Q.error(i("select_department_first"));let $=T.value;$==1?await M():$==2?await n():$==3&&await k(),S.value.handleDepartmentOpen($,m.treeParmas,a.value)},z=ie(()=>[{dataIndex:"name",key:"name"},{title:i("permission"),dataIndex:"role",key:"role"},{title:i("action"),dataIndex:"action",key:"action",width:80}]);return($,w)=>{const D=kt,H=Be,j=we,u=wt,l=ke;return v(),U(X,null,[d("div",ts,[e(H,{value:T.value,"onUpdate:value":w[0]||(w[0]=c=>T.value=c),onChange:L},{default:t(()=>[e(D,{value:"2"},{default:t(()=>[y(r(s(i)("knowledge_base")),1)]),_:1}),e(D,{value:"1"},{default:t(()=>[y(r(s(i)("robot")),1)]),_:1}),e(D,{value:"3"},{default:t(()=>[y(r(s(i)("database")),1)]),_:1})]),_:1},8,["value"]),d("div",as,[e(j,{type:"primary",onClick:E},{default:t(()=>[y(r(f.value),1)]),_:1})]),d("div",ss,[e(l,{columns:z.value,"data-source":a.value,pagination:!1},{headerCell:t(({column:c})=>[c.key==="name"?(v(),U(X,{key:0},[y(r(R.value),1)],64)):Y("",!0)]),bodyCell:t(({column:c,record:_})=>[c.key==="name"?(v(),U("div",ns,r(_.name),1)):Y("",!0),c.key==="role"?(v(),q(u,{key:1,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:t(()=>[d("div",os,[d("div",{class:"role-menu",onClick:x=>I(_,4)},[d("div",is,[e(s(Ct)),d("span",ds,r(s(i)("manage")),1)]),d("div",rs,r(s(i)("manage_desc")),1),_.operate_rights==4?(v(),U("div",_s,[e(s($e))])):Y("",!0)],8,ls),d("div",{class:"role-menu",onClick:x=>I(_,2)},[d("div",us,[e(s($t)),d("span",ps,r(s(i)("edit")),1)]),d("div",ms,r(s(i)("edit_desc")),1),_.operate_rights==2?(v(),U("div",vs,[e(s($e))])):Y("",!0)],8,cs),d("div",{class:"role-menu",onClick:x=>I(_,1)},[d("div",fs,[e(s(Dt)),d("span",gs,r(s(i)("view")),1)]),d("div",ys,r(s(i)("view_desc")),1),_.operate_rights==1?(v(),U("div",bs,[e(s($e))])):Y("",!0)],8,hs)])]),default:t(()=>[d("div",ks,[y(r(s(i)(p.value[_.operate_rights]))+" ",1),e(s(xt))])]),_:2},1024)):Y("",!0),c.key==="action"?(v(),U("a",{key:2,onClick:x=>O(_)},r(s(i)("delete")),9,ws)):Y("",!0)]),_:1},8,["columns","data-source"])])]),e(We,{ref_key:"seeModelAlertRef",ref:S,robotList:B.value,libraryList:C.value,formList:A.value,onOk:o},null,8,["robotList","libraryList","formList"])],64)}}},Cs=ae(xs,[["__scopeId","data-v-cba288dc"]]),$s={__name:"batch-edit-department",emits:["ok"],setup(G,{expose:i,emit:T}){const a=h(!1),R=T,f=de.useForm,p=ee({user_ids:"",department_ids:[]}),m=ee({department_ids:[{message:"请选择部门",required:!0}]}),{resetFields:o,validate:L,validateInfos:I}=f(p,m),O=n=>{p.user_ids=n,p.department_ids=[],a.value=!0,C()},B=h([]),C=()=>{xe({}).then(n=>{let k=n.data||[];B.value=Oe(k)})},A=h(!1),M=()=>{L().then(()=>{let n={...p};n.department_ids=p.department_ids.join(","),A.value=!0,Et(n).then(k=>{Q.success("批量修改部门成功"),a.value=!1,R("ok")}).finally(()=>{A.value=!1})})};return i({show:O}),(n,k)=>{const S=Le,E=be,z=de,$=te;return v(),U("div",null,[e($,{open:a.value,"onUpdate:open":k[1]||(k[1]=w=>a.value=w),title:"批量修改部门",onOk:M,confirmLoading:A.value},{default:t(()=>[e(z,{layout:"vertical",style:{"margin-top":"24px"}},{default:t(()=>[e(E,oe({label:"选择部门"},s(I).department_ids),{default:t(()=>[e(S,{value:p.department_ids,"onUpdate:value":k[0]||(k[0]=w=>p.department_ids=w),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择","allow-clear":"",multiple:"","tree-default-expand-all":"","tree-data":B.value,"tree-node-filter-prop":"label"},{title:t(({value:w,label:D})=>[d("div",null,r(D),1)]),_:1},8,["value","tree-data"])]),_:1},16)]),_:1})]),_:1},8,["open","confirmLoading"])])}}},Ds={class:"flex-content-box"},Os={class:"left-department-box"},Ss={class:"team-members-pages"},Ls={class:"main-tabs-block"},Bs={class:"list-box"},Ts={class:"user-box"},Us=["src"],Ms={class:"name-info"},Rs={class:"user-name"},Vs={class:"nick-name"},Ps={key:0,class:"list-content"},js={key:1,class:"list-preview list-content"},Ns={style:{display:"inline"}},Is={class:"list-item-box"},Es={class:"list-item"};const As={key:0,class:"status-block green"},Fs={key:1,class:"status-block yellow"},zs={class:"disabled"},Ks={class:"disabled"},Js={class:"disabled"},Ys=["onClick"],qs=["onClick"],Hs=["onClick"],Qs={__name:"team-members",setup(G){const{t:i}=_e("views.user.manage.team-members"),T=h(1),a=ie(()=>[{value:1,payload:{title:i("team_members")}}]),R=ee({page:1,size:10,total:0,search:""}),f=h([]),p=h([]),m=h([]),o=h(null),L=b=>{R.page=b.current,R.size=b.pageSize,n()},I=ee({id:""}),O=b=>{Object.assign(I,{...b}),T.value==1&&B()},B=()=>{R.page=1,n()},C=h([]),A=b=>{let K=[];return b.map(ne=>{K.push(ne.name||ne.department_name)}),K.join(", ")},M=h(!1),n=()=>{let b={page:R.page,size:R.size,search:R.search};I.id&&I.is_default!=1&&(b.department_id=I.id),M.value=!0,lt(b).then(K=>{let ne=K.data.list;ne.forEach(J=>{J.create_time=re(J.create_time*1e3).format("YYYY-MM-DD HH:mm"),J.expire_time_desc=J.expire_time=="0"?i("permanent"):re(J.expire_time*1e3).format("YYYY-MM-DD HH:mm"),J.expire_status=0,(J.expire_time=="0"||re().unix()<J.expire_time)&&(J.expire_status=1),J.managed_robot_list=J.managed_robot_list?JSON.parse(J.managed_robot_list):[],J.managed_library_list=J.managed_library_list?JSON.parse(J.managed_library_list):[],J.managed_form_list=J.managed_form_list?JSON.parse(J.managed_form_list):[],J.departments=J.departments?JSON.parse(J.departments):[]}),C.value=ne,z.selectedRowKeys=[],R.total=+K.data.total}).finally(()=>{M.value=!1})},k=()=>{T.value==1&&B()},S=h(null),E=()=>{n(),S.value.getLists()},z=ee({selectedRowKeys:[]}),$=b=>{z.selectedRowKeys=b},w=b=>({disabled:b.role_type==1}),D=b=>{it({user_id:b.id}).then(K=>{Q.success(b.login_switch==1?i("login_disabled_success"):i("login_enabled_success")),n()})},H=h(null),j=()=>{H.value.add(I.id)},u=b=>{H.value.edit(b)},l=h(null),c=b=>{l.value.open(b)},_=b=>{te.confirm({title:i("confirm_delete_title"),icon:e(ve),content:i("confirm_delete_content"),okText:i("confirm"),okType:"danger",cancelText:i("cancel"),onOk:()=>{dt({id:b.id}).then(K=>{Q.success(i("delete_success")),n()})},onCancel(){}})},x=async()=>{await Ne().then(b=>{f.value=b.data}).catch(()=>{})},N=async()=>{await Ve({type:""}).then(b=>{p.value=b.data}).catch(()=>{})},F=async()=>{await Ie().then(b=>{m.value=b.data}).catch(()=>{})},Z=async b=>{let K=[];if(z.selectedRowKeys.forEach(ne=>{C.value.filter(he=>he.id==ne)[0].role_type==1||K.push(ne)}),z.selectedRowKeys=K,z.selectedRowKeys.length==0)return Q.error(i("please_select_members"));b==1?await x():b==2?await N():b==3&&await F(),o.value.handleBatchOpen(b,z.selectedRowKeys.join(","))},P=h(null),g=()=>{if(z.selectedRowKeys.length==0)return Q.error(i("please_select_members"));P.value.show(z.selectedRowKeys.join(","))},se=async(b,K)=>{b==1?await x():b==2?await N():b==3&&await F(),o.value.open(b,"add",K)},W=async(b,K)=>{b==1?await x():b==2?await N():b==3&&await F(),o.value.open(b,"edit",K)};return(b,K)=>{const ne=mt,J=Je,he=we,cn=Ge,un=Qe,pn=He,fe=Me,Xe=Ue,Ce=qe,ce=Te,mn=ot,et=St,tt=ke;return v(),U("div",Ds,[d("div",Os,[e(ne,{style:{"padding-right":"24px"}},{default:t(()=>[e(es,{ref_key:"departmentTreeRef",ref:S,onSelect:O,onRefresh:n},null,512)]),_:1})]),d("div",Ss,[e(ne,{style:{"padding-right":"24px"}},{default:t(()=>[d("div",Ls,[e(J,{value:T.value,"onUpdate:value":K[0]||(K[0]=V=>T.value=V),options:a.value,onChange:k},{label:t(({payload:V})=>[y(r(V.title),1)]),_:1},8,["value","options"])]),T.value==1?(v(),U(X,{key:0},[e(fe,{justify:"space-between"},{default:t(()=>[e(fe,{gap:8},{default:t(()=>[e(he,{type:"primary",onClick:j},{icon:t(()=>[e(s(ye))]),default:t(()=>[y(" "+r(s(i)("add_team_member")),1)]),_:1}),Y("",!0),e(he,{onClick:g},{default:t(()=>[y(r(s(i)("batch_modify_department")),1)]),_:1})]),_:1}),e(Xe,{value:R.search,"onUpdate:value":K[4]||(K[4]=V=>R.search=V),placeholder:s(i)("search_placeholder"),style:{width:"288px"},onSearch:B},null,8,["value","placeholder"])]),_:1}),d("div",Bs,[e(tt,{"data-source":C.value,scroll:{x:1100},loading:M.value,"row-key":"id","row-selection":{selectedRowKeys:z.selectedRowKeys,onChange:$,getCheckboxProps:w},pagination:{current:R.page,total:R.total,pageSize:R.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:L},{default:t(()=>[e(ce,{title:s(i)("member_name"),"data-index":"user_name",width:"190px"},{default:t(({record:V})=>[d("div",Ts,[d("img",{src:V.avatar||s(De),alt:""},null,8,Us),d("div",Ms,[d("div",Rs,[V.user_name&&V.user_name.length>7?(v(),q(Ce,{key:0,title:V.user_name},{default:t(()=>[y(r(V.user_name),1)]),_:2},1032,["title"])):(v(),U(X,{key:1},[y(r(V.user_name),1)],64))]),d("div",Vs,[V.nick_name&&V.nick_name.length>7?(v(),q(Ce,{key:0,title:V.nick_name},{default:t(()=>[y(r(V.nick_name),1)]),_:2},1032,["title"])):(v(),U(X,{key:1},[y(r(V.nick_name),1)],64))])])])]),_:1},8,["title"]),e(ce,{title:s(i)("role"),"data-index":"role_name",width:"100px"},{default:t(({record:V})=>[y(r(V.role_name),1)]),_:1},8,["title"]),e(ce,{"data-index":"departments",width:"200px"},{title:t(()=>[y(r(s(i)("department")),1)]),default:t(({record:V})=>[V.departments&&V.departments.length==0?(v(),U("div",Ps," -- ")):(v(),U("div",js,[e(Ce,null,{title:t(()=>[d("div",Ns,r(A(V.departments)),1)]),default:t(()=>[d("div",Is,[d("div",Es,r(A(V.departments)),1)])]),_:2},1024)]))]),_:1}),Y("",!0),Y("",!0),Y("",!0),e(ce,{title:s(i)("status"),"data-index":"expire_status",width:"120px"},{default:t(({record:V})=>[V.expire_status==1?(v(),U("div",As,[e(s(Ot)),y(r(s(i)("active")),1)])):Y("",!0),V.expire_status==0?(v(),U("div",Fs,[e(s(Ye)),y(r(s(i)("expired")),1)])):Y("",!0)]),_:1},8,["title"]),e(ce,{title:s(i)("expiry_time"),"data-index":"expire_time_desc",width:"130px"},{default:t(({record:V})=>[y(r(V.expire_time_desc),1)]),_:1},8,["title"]),e(ce,{title:s(i)("login"),"data-index":"login_switch",width:"90px",fixed:"right"},{default:t(({record:V})=>[e(et,{onChange:le=>D(V),checked:V.login_switch=="1",disabled:V.role_type=="1","checked-children":s(i)("on"),"un-checked-children":s(i)("off")},null,8,["onChange","checked","disabled","checked-children","un-checked-children"])]),_:1},8,["title"]),e(ce,{title:s(i)("actions"),"data-index":"action",width:"176px",fixed:"right"},{default:t(({record:V})=>[V.role_type=="1"?(v(),q(fe,{key:0,gap:16},{default:t(()=>[d("span",zs,r(s(i)("edit")),1),d("span",Ks,r(s(i)("reset_password")),1),d("span",Js,r(s(i)("delete")),1)]),_:1})):(v(),q(fe,{key:1,gap:16},{default:t(()=>[d("a",{onClick:le=>u(V)},r(s(i)("edit")),9,Ys),d("a",{onClick:le=>c(V)},r(s(i)("reset_password")),9,qs),d("a",{onClick:le=>_(V)},r(s(i)("delete")),9,Hs)]),_:2},1024))]),_:1},8,["title"])]),_:1},8,["data-source","loading","row-selection","pagination"])])],64)):(v(),q(Cs,{key:1,treeParmas:I},null,8,["treeParmas"]))]),_:1}),e(la,{ref_key:"addTeamMembersRef",ref:H,onOk:E},null,512),e(ra,{ref_key:"resetPasswordRef",ref:l,onOk:n},null,512),e(We,{ref_key:"seeModelAlertRef",ref:o,robotList:f.value,libraryList:p.value,formList:m.value,onOk:n},null,8,["robotList","libraryList","formList"]),e($s,{ref_key:"batchEditDepartmentRef",ref:P,onOk:E},null,512)])])}}},Gs=ae(Qs,[["__scopeId","data-v-fce7b8c4"]]),Zs={class:"form-box"},Ws={class:"title-row"},Xs={class:"check-num"},en={key:0},tn={__name:"add-role",emits:["ok"],setup(G,{expose:i,emit:T}){const{t:a}=_e("views.user.manage.components.add-role"),R=T,f=de.useForm,p=h([]),m=h({}),o=h(!1),L=h(a("add_role_title")),I=h(""),O=ee({name:"",mark:"",role_type:""}),B=ee({name:[{message:a("role_name_required"),required:!0}]}),{resetFields:C,validate:A,validateInfos:M}=f(O,B),n=async()=>{await rt().then(j=>{let u=j.data||[];u.forEach(l=>{l.uni_key=="System"&&(l.children=l.children.filter(c=>c.uni_key!="AccountManage"))}),p.value=u;for(let l=0;l<u.length;l++){const c=u[l];m.value[c.uni_key]=[]}})},k=async()=>{await n(),L.value=a("add_role_title"),I.value="",o.value=!0,O.name="",O.mark="",C()},S=j=>{L.value=a("edit_role_title"),I.value=j.id,_t({id:j.id}).then(u=>{let l=u.data,c=l.role_permission||[];O.name=l.name,O.mark=l.mark,O.role_type=l.role_type,m.value=E(p.value,c),o.value=!0})},E=(j,u)=>{let l={};return j.forEach(c=>{l[c.uni_key]=[];for(let _=0;_<c.children.length;_++){const x=c.children[_];u.includes(x.uni_key)&&l[c.uni_key].push(x.uni_key),x.children&&x.children.length>0&&x.children.forEach(N=>{u.includes(N.uni_key)&&l[c.uni_key].push(N.uni_key)})}}),l},z=j=>{let u=[];for(let l in j)j[l].map(_=>{u.push(_)});return u},$=()=>{A().then(()=>{let j=z(m.value),u={id:I.value,mark:O.mark};O.role_type==0&&(u.name=O.name,u.role_type=O.role_type,u.uni_keys=j.join(",")),ct(u).then(l=>{o.value=!1,Q.success(a("save_success")),R("ok")})})},w=(j,u)=>{j.children&&pe(()=>{if(!m.value[u].includes(j.uni_key)){let l=j.children.map(c=>c.uni_key);m.value[u]=m.value[u].filter(c=>!l.includes(c))}})},D=(j,u,l)=>{pe(()=>{m.value[l].includes(j.uni_key)&&(m.value[l].push(u.uni_key),m.value[l]=[...new Set(m.value[l])])})},H=j=>{let u=j.length;return j.forEach(l=>{l.children&&l.children.length&&(u=u+l.children.length)}),u};return pt(()=>{n()}),i({add:k,edit:S}),(j,u)=>{const l=Se,c=be,_=Lt,x=Me,N=Mt,F=Ut,Z=Tt,P=Bt,g=de,se=te;return v(),U("div",null,[e(se,{open:o.value,"onUpdate:open":u[2]||(u[2]=W=>o.value=W),title:L.value,onOk:$,width:"746px"},{default:t(()=>[d("div",Zs,[e(g,{layout:"vertical"},{default:t(()=>[e(c,oe({label:s(a)("role_name_label")},s(M).name),{default:t(()=>[e(l,{type:"text",maxlength:100,disabled:O.role_type>0,placeholder:s(a)("role_name_placeholder"),value:O.name,"onUpdate:value":u[0]||(u[0]=W=>O.name=W)},null,8,["disabled","placeholder","value"])]),_:1},16,["label"]),e(c,{label:s(a)("role_mark_label")},{default:t(()=>[e(_,{value:O.mark,"onUpdate:value":u[1]||(u[1]=W=>O.mark=W),placeholder:s(a)("role_mark_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{label:s(a)("role_permission_label")},{default:t(()=>[(v(!0),U(X,null,ue(p.value,W=>(v(),U("div",{class:"role-check-box",key:W.uni_key},[e(x,{class:"title-boock",justify:"space-between"},{default:t(()=>[d("div",Ws,r(W.name),1),d("div",Xs,r(m.value[W.uni_key].length)+"/"+r(H(W.children)),1)]),_:2},1024),e(P,{value:m.value[W.uni_key],"onUpdate:value":b=>m.value[W.uni_key]=b,style:{width:"100%"}},{default:t(()=>[e(Z,{gutter:[0,12]},{default:t(()=>[(v(!0),U(X,null,ue(W.children,b=>(v(),q(F,{span:b.children&&b.children.length?12:6,key:b.uni_key},{default:t(()=>[e(N,{onChange:K=>w(b,W.uni_key),disabled:O.role_type>0,value:b.uni_key},{default:t(()=>[y(r(b.name),1)]),_:2},1032,["onChange","disabled","value"]),b.children&&b.children.length>0?(v(),U("span",en,[u[3]||(u[3]=y("( ",-1)),(v(!0),U(X,null,ue(b.children,K=>(v(),q(N,{onChange:ne=>D(K,b,W.uni_key),key:K.uni_key,disabled:O.role_type>0,value:K.uni_key},{default:t(()=>[y(r(K.name),1)]),_:2},1032,["onChange","disabled","value"]))),128)),u[4]||(u[4]=y(" )",-1))])):Y("",!0)]),_:2},1032,["span"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])]))),128))]),_:1},8,["label"])]),_:1})])]),_:1},8,["open","title"])])}}},an=ae(tn,[["__scopeId","data-v-b6859376"]]),sn={class:"team-members-pages"},nn={class:"list-box"},on={__name:"role-permissions",setup(G){const{t:i}=_e("views.user.manage.role-permissions");h("");const T=ee({page:1,size:10,total:0,search:""}),a=h([{}]),R=O=>{T.page=O.current,T.size=O.pageSize,p()},f=()=>{T.page=1,p()},p=()=>{let O={page:T.page,size:T.size,search:T.search};Re(O).then(B=>{let C=B.data.list;C.forEach(A=>{A.update_time=re(A.update_time*1e3).format("YYYY-MM-DD HH:mm")}),a.value=C,T.total=+B.data.total})};f();const m=h(null),o=()=>{m.value.add()},L=O=>{m.value.edit(O)},I=O=>{te.confirm({title:i("confirm_title"),icon:e(ve),content:i("confirm_content"),okText:i("ok_text"),okType:"danger",cancelText:i("cancel_text"),onOk:()=>{ut({id:O.id}).then(B=>{Q.success(i("delete_success")),p()})},onCancel(){}})};return(O,B)=>{const C=we,A=Ue,M=Me,n=Te,k=ke;return v(),U("div",sn,[e(M,{justify:"space-between"},{default:t(()=>[e(C,{type:"primary",onClick:o},{icon:t(()=>[e(s(ye))]),default:t(()=>[y(" "+r(s(i)("add_role_btn")),1)]),_:1}),e(A,{value:T.search,"onUpdate:value":B[0]||(B[0]=S=>T.search=S),placeholder:s(i)("search_placeholder"),style:{width:"288px"},onSearch:f},null,8,["value","placeholder"])]),_:1}),d("div",nn,[e(k,{"data-source":a.value,pagination:{current:T.page,total:T.total,pageSize:T.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:R},{default:t(()=>[e(n,{title:s(i)("column_role"),"data-index":"name",width:"157px"},{default:t(({record:S})=>[y(r(S.name),1)]),_:1},8,["title"]),e(n,{title:s(i)("column_remark"),"data-index":"mark",width:"480px"},{default:t(({record:S})=>[y(r(S.mark),1)]),_:1},8,["title"]),e(n,{title:s(i)("column_update_time"),"data-index":"update_time",width:"150px"},{default:t(({record:S})=>[y(r(S.update_time),1)]),_:1},8,["title"]),e(n,{title:s(i)("column_operate_name"),"data-index":"operate_name",width:"130px"},{default:t(({record:S})=>[y(r(S.operate_name),1)]),_:1},8,["title"]),e(n,{title:s(i)("column_create_name"),"data-index":"create_name",width:"130px"},{default:t(({record:S})=>[y(r(S.create_name),1)]),_:1},8,["title"]),e(n,{title:s(i)("column_action"),"data-index":"action",width:"178px"},{default:t(({record:S})=>[e(M,{gap:16,class:"action-box"},{default:t(()=>[e(C,{type:"link",onClick:E=>L(S)},{default:t(()=>[y(r(s(i)("btn_edit")),1)]),_:1},8,["onClick"]),e(C,{type:"link",onClick:E=>I(S),disabled:S.role_type<=3&&S.role_type>0},{default:t(()=>[y(r(s(i)("btn_delete")),1)]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data-source","pagination"])]),e(an,{ref_key:"addRoleRef",ref:m,onOk:p},null,512)])}}},ln=ae(on,[["__scopeId","data-v-d23d589d"]]),dn={class:"user-model-page"},rn={class:"list-wrapper"},_n={__name:"index",setup(G){const i=h(1),T=()=>{};return(a,R)=>(v(),U("div",dn,[e(Kt,{value:i.value,"onUpdate:value":R[0]||(R[0]=f=>i.value=f),onChange:T},null,8,["value"]),d("div",rn,[i.value==1?(v(),q(Gs,{key:0})):(v(),q(ln,{key:1}))])]))}},Bn=ae(_n,[["__scopeId","data-v-f33d5e1f"]]);export{Bn as default};
