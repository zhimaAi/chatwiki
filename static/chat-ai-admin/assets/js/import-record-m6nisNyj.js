import{_ as nt}from"./cu-scroll-CpIj948h.js";import{ah as ot,r as h,E as z,c as lt,j as _t,J as it,a as o,y as l,t as r,a1 as ut,ag as ct,V as rt,b as n,p as _,u as s,q as i,e as S,v as a,_ as p,z as pt,F as y}from"./vue-chunks-BdaA73Wf.js";import{d as P}from"./utils-CvB22N-W.js";import{u as dt,d as mt,aD as ft,aS as gt,ax as ht,aV as yt}from"../../index-DSFcP5NQ.js";import{_ as kt}from"./emoji-mart-BBMRoEa3.js";import{M as U,m as vt,I as wt,W as bt,x as xt,a9 as Ct,aH as zt,a0 as St,aX as It,ag as Dt,ad as Ot,q as $t,aO as R,b5 as E,O as Ft,aQ as Rt,B as Lt,b as Mt}from"./ui-antd-Dl1wwwCD.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./editor-cherry-CFIsbKoN.js";import"./elkjs-BN8GIjVH.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./other-LrIFyvU9.js";const Yt={class:"details-library-page"},qt={class:"list-tools"},Bt={class:"tools-items"},Tt={class:"list-content"},Vt={key:0,class:"doc-name-td"},Ht=["href"],Pt={key:0},Ut={key:1},Et={key:1},Nt={key:0},jt={key:1},Jt=["onClick"],Qt={key:2,class:"url-remark"},Gt={key:0,class:"pdf-progress-box"},Kt={class:"progress-title"},Wt={class:"status-box"},Xt=["onClick"],At={class:"progress-bar"},Zt={class:"num-box"},te={key:0,class:"status-tag running"},ee={key:2,class:"status-tag running"},se={key:3,class:"status-tag complete"},ae={class:"status-tag status-error"},ne=["onClick"],oe={class:"status-tag status-error"},le={class:"status-tag"},_e=["onClick"],ie={key:7,class:"status-tag"},ue={key:8,class:"status-tag running"},ce={class:"status-tag error"},re={key:10,class:"status-tag cancel"},pe={key:11,class:"status-tag subning"},de={key:0},me={key:1},fe={key:0},ge={key:1},he={__name:"import-record",setup(ye){const{t:e}=dt("views.library.library-details.import-record"),N=mt(),j=ft(),{changeGraphSwitch:ke}=j,J=ot(),L=ct(),x=J.query,M=h(!1),Y=h({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});z({selectedRowKeys:[]});const C=z({use_model:"",model_config_id:""}),q=h([]),I=z({learned_err_count:0,learned_count:0,learned_wait_count:0}),m=z({library_id:x.id,file_name:void 0,status:"",page:1,size:10,total:0}),B=h([]),Q=lt(()=>[{title:e("column_file_name"),dataIndex:"file_name",key:"file_name",width:300},{title:e("column_file_format"),dataIndex:"file_ext",key:"file_ext",width:100},{title:e("column_file_size"),dataIndex:"file_size_str",key:"file_size",width:100},{title:e("column_segmentation"),dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:e("column_status"),dataIndex:"status",key:"status",width:200},{title:e("column_operation_time"),dataIndex:"update_time",key:"update_time",width:150}]),G=u=>{m.page=u.current,m.size=u.pageSize,k()},T=()=>{m.page=1,k()},V=(u,c={})=>{if(u.status=="4"||u.status=="3")return L.push({path:"/library/document-segmentation",query:{document_id:u.id,page:m.page}})},k=()=>{let u=ut(m);u.status==0&&(u.status=""),M.value=!0,gt(u).then(c=>{let f=c.data.info;!C.use_model&&C.use_model!=f.use_model&&(C.use_model=f.use_model,C.model_config_id=f.model_config_id),Y.value={...f},B.value=Q.value;let O=c.data.list||[],w=c.data.count_data||{};m.total=c.data.total,I.learned_count=w.learned_count,I.learned_err_count=w.learned_err_count,I.learned_wait_count=w.learned_wait_count;let b=!1;q.value=O.map(d=>(["1","6","0","5"].includes(d.status)&&(b=!0),d.file_size_str=ht(d.file_size),d.update_time=P(d.update_time*1e3).format("YYYY-MM-DD HH:mm"),d.doc_last_renew_time_desc=d.doc_last_renew_time>0?P(d.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",d)),b&&K(),!b&&clearInterval(v.value)}).finally(()=>{M.value=!1})},v=h(null),K=()=>{clearInterval(v.value),v.value=setInterval(()=>{k()},1e3*5)},W=u=>{U.confirm({title:e("modal_cancel_title"),content:e("modal_cancel_content"),okText:e("modal_ok"),onOk(){yt({id:u.id}).then(c=>{Mt.success(e("message_cancel_success")),k()})}})},D=h(!1),X=u=>{let c=`/manage/downloadLibraryFile?id=${u.id}&token=${N.getToken}`;var f=document.createElement("a");f.href=c,f.style.display="none",f.click()},A=()=>{L.push({path:"/library/details/export-record",query:x})};return _t(()=>{x.page&&(m.page=+x.page),k()}),it(()=>{v.value&&clearInterval(v.value)}),(u,c)=>{const f=vt,O=wt,w=Ct,b=It,d=Dt,$=$t,Z=xt,tt=nt,H=Lt,et=Rt,st=U,at=rt("copy");return n(),o("div",Yt,[l(tt,{scrollbar:!1},{default:r(()=>[l(f,{"show-icon":"",message:s(e)("alert_message")},null,8,["message"]),_("div",qt,[_("div",Bt,[l(O,{style:{width:"282px"},value:m.file_name,"onUpdate:value":c[0]||(c[0]=g=>m.file_name=g),placeholder:s(e)("search_placeholder"),onChange:T},{suffix:r(()=>[l(s(bt),{onClick:T,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value","placeholder"])])]),_("div",Tt,[l(Z,{columns:B.value,"data-source":q.value,scroll:{x:1e3},"row-key":"id",pagination:{current:m.page,total:m.total,pageSize:m.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:G},{bodyCell:r(({column:g,record:t})=>[g.key==="file_name"?(n(),o("div",Vt,[t.doc_type==2?(n(),S(w,{key:0,title:null},{content:r(()=>[p(a(s(e)("original_link"))+"：",1),_("a",{href:t.doc_url,target:"_blank"},a(t.doc_url),9,Ht),pt(l(s(zt),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[at,`${t.doc_url}`]])]),default:r(()=>[_("span",null,[["5","6","7"].includes(t.status)?(n(),o("span",Pt,a(t.doc_url),1)):(n(),o("span",Ut,a(t.file_name),1))])]),_:2},1024)):(n(),o("span",Et,[["5","6","7"].includes(t.status)?(n(),o("span",Nt,a(t.doc_url),1)):(n(),o("span",jt,a(t.file_name),1)),_("a",{style:{"margin-left":"2px"},onClick:F=>X(t)},a(s(e)("download")),9,Jt)])),t.doc_type==2&&t.remark?(n(),o("div",Qt,a(s(e)("remark"))+"："+a(t.remark),1)):i("",!0)])):i("",!0),g.key==="status"?(n(),o(y,{key:1},[t.file_ext=="pdf"&&t.pdf_parse_type>=2?(n(),o(y,{key:0},[t.status==0?(n(),o("div",Gt,[_("div",Kt,[_("span",Wt,[l(s(St)),p(a(s(e)("status_parsing")),1)]),_("a",{onClick:F=>W(t)},a(s(e)("cancel")),9,Xt)]),_("div",At,[l(b,{size:"small",class:"progress-bar-box",percent:parseInt(t.ocr_pdf_index/t.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),_("div",Zt,a(t.ocr_pdf_index)+" / "+a(t.ocr_pdf_total),1)])])):i("",!0)],64)):(n(),o(y,{key:1},[t.status==0?(n(),o("span",te,[l(d,{size:"small"}),p(" "+a(s(e)("status_converting")),1)])):i("",!0)],64)),t.status==1?(n(),o("span",ee,[l(d,{size:"small"}),p(" "+a(s(e)("status_learning")),1)])):i("",!0),t.status==2?(n(),o("span",se,[l(s(Ot)),p(" "+a(s(e)("status_learning_complete")),1)])):i("",!0),t.status==3?(n(),S($,{key:4,placement:"top"},{title:r(()=>[_("span",null,a(t.errmsg),1)]),default:r(()=>[_("span",null,[_("span",ae,[l(s(R)),p(" "+a(s(e)("status_conversion_failed")),1)]),Y.value.type==2?(n(),o("a",{key:0,class:"ml8",onClick:F=>V(t)},a(s(e)("status_learn")),9,ne)):i("",!0)])]),_:2},1024)):i("",!0),t.status==8?(n(),S($,{key:5,placement:"top"},{title:r(()=>[_("span",null,a(t.errmsg),1)]),default:r(()=>[_("span",null,[_("span",oe,[l(s(R)),p(" "+a(s(e)("status_conversion_error")),1)])])]),_:2},1024)):i("",!0),t.status==4?(n(),o(y,{key:6},[_("span",le,[l(s(E)),p(" "+a(s(e)("status_wait_learning")),1)]),_("a",{class:"ml8",onClick:F=>V(t)},a(s(e)("status_learn")),9,_e)],64)):i("",!0),t.status==5?(n(),o("span",ie,[l(s(E)),p(" "+a(s(e)("status_wait_fetch")),1)])):i("",!0),t.status==6?(n(),o("span",ue,[l(d,{size:"small"}),p(" "+a(s(e)("status_fetching")),1)])):i("",!0),t.status==7?(n(),S($,{key:9,placement:"top"},{title:r(()=>[_("span",null,a(t.errmsg),1)]),default:r(()=>[_("span",ce,[l(s(R)),p(" "+a(s(e)("status_fetch_failed")),1)])]),_:2},1024)):i("",!0),t.status==9?(n(),o("span",re,[l(s(Ft)),p(" "+a(s(e)("status_cancel_parsing")),1)])):i("",!0),t.status==10?(n(),o("span",pe,[l(d,{size:"small"}),p(" "+a(s(e)("status_segmenting")),1)])):i("",!0)],64)):i("",!0),g.key==="file_size"?(n(),o(y,{key:2},[t.doc_type==3?(n(),o("span",de,"-")):(n(),o("span",me,a(t.file_size_str),1))],64)):i("",!0),g.key==="paragraph_count"?(n(),o(y,{key:3},[t.status==0||t.status==1?(n(),o("span",fe,"-")):(n(),o("span",ge,a(t.paragraph_count),1))],64)):i("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1}),l(st,{open:D.value,"onUpdate:open":c[2]||(c[2]=g=>D.value=g),title:null,footer:null,width:640},{default:r(()=>[l(et,{status:"success",title:s(e)("modal_export_success_title"),"sub-title":s(e)("modal_export_success_subtitle")},{extra:r(()=>[l(H,{style:{"margin-right":"16px"},onClick:c[1]||(c[1]=g=>D.value=!1)},{default:r(()=>[p(a(s(e)("modal_know")),1)]),_:1}),l(H,{onClick:A,type:"primary"},{default:r(()=>[p(a(s(e)("modal_go_download")),1)]),_:1})]),_:1},8,["title","sub-title"])]),_:1},8,["open"])])}}},Le=kt(he,[["__scopeId","data-v-79b55eae"]]);export{Le as default};
//# sourceMappingURL=import-record-m6nisNyj.js.map
