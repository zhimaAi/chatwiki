import{_ as S,L as Q,e as M,M as O,J as V,K as X,d as Y,E as H,c as Z}from"../../index-P5YTNo6V.js";import{r as p,w as oo,L as u,M as C,j as r,Q as d,P as T,u as w,V as e,a3 as j,a4 as B,$ as G,A as E,U as F,k as to,b as eo,v as ao,a8 as no,F as so,a1 as ro,a7 as A,Y as N,X as J}from"./vue-chunks-DrvJJrR0.js";import{s as lo,g as io,d as co}from"./index-DBGyso7M.js";import{c as po}from"./index-BsPTYS4_.js";import{F as U,_ as uo}from"./index-BUTxM_ZP.js";import{P as _o}from"./PlusOutlined-CDlgthEJ.js";import{_ as mo}from"./index-0mvf2oPh.js";import"./index-DbkTLXZJ.js";import{I as vo}from"./Input-Dgd5v23J.js";import{_ as fo}from"./TextArea-2ujELiW_.js";import{P as bo}from"./PlusCircleOutlined-D4TDRL4C.js";import{M as go}from"./MoreOutlined-eNb2OSuZ.js";import{_ as ho,M as ko}from"./index-CH9v5L6a.js";import"./index-DpfcpfQ0.js";import{D as Co}from"./dropdown-7DbQfkaS.js";import"./dayjs-Bv4VEw_C.js";import"./axios-Cm0UX6qg.js";import"./qs-QntUJHOZ.js";import"./crypto-js-BpV8n4kc.js";import"./colors-CF1NjnDv.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./responsiveObserve-BH6_flfv.js";import"./collapseMotion-DfZt1qrJ.js";import"./index-GBuEB8v_.js";import"./QuestionCircleOutlined-Dtch7f6L.js";import"./FormItemContext-C-6BWMej.js";import"./Password-DoqQ5Cp-.js";import"./inputProps-CVwJ66mj.js";import"./CheckOutlined-C_vTn6Wi.js";import"./useRefs-Bj34oM9A.js";import"./index-DuYANmfA.js";import"./Search-DbjjEMkL.js";import"./SearchOutlined-BsZdEpth.js";import"./index-CCuYH0LT.js";import"./shallowequal-CfnxU2uU.js";import"./slide-BQHNwZxO.js";import"./Dropdown-ZPlzQgPg.js";import"./RightOutlined-DIZF9Vab.js";import"./move-DKHu4ARt.js";const wo=l=>(j("data-v-60ead55d"),l=l(),B(),l),Lo={class:"avatar-uploader"},xo=["src"],yo={key:1},$o=wo(()=>e("div",{class:"ant-upload-text"},"上传照片",-1)),Io=["src"],Po={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(l,{emit:$}){function h(o){return new Promise((f,b)=>{const t=new FileReader;t.readAsDataURL(o),t.onload=()=>f(t.result),t.onerror=a=>b(a)})}const L=$,I=l,_=p([]),m=p(!1),c=p("");oo(()=>I.value,o=>{c.value=o},{immediate:!0});const n=U.useInjectFormItemContext(),x=()=>{let o={imageUrl:c.value,file:_.value[0].originFileObj};L("change",o),L("update:value",o.imageUrl),n.onFieldChange()},P=o=>o.type==="image/jpeg"||o.type==="image/png"?o.size/1024<100?(_.value=[o],h(o).then(t=>{c.value=t,m.value=!1,x()}),!1):(M.error("机器人头像图片大小不能超过100kb"),!1):(M.error("机器人头像只支持JPG、PNG格式的图片"),!1),v=p(!1),y=p(""),s=p(""),i=()=>{v.value=!1,s.value=""},g=async o=>{!o.url&&!o.preview&&(o.preview=await h(o.originFileObj)),y.value=o.url||o.preview,v.value=!0,s.value=o.name||o.url.substring(o.url.lastIndexOf("/")+1)};return(o,f)=>{const b=mo,t=O;return u(),C("div",Lo,[r(b,{"file-list":_.value,"onUpdate:fileList":f[0]||(f[0]=a=>_.value=a),"list-type":"picture-card","show-upload-list":!1,"before-upload":P,accept:".jpg,.png,.jpeg",onPreview:g},{default:d(()=>[l.value?(u(),C("img",{key:0,class:"avatar",src:l.value,alt:"avatar"},null,8,xo)):(u(),C("div",yo,[m.value?(u(),T(w(Q),{key:0})):(u(),T(w(_o),{key:1})),$o]))]),_:1},8,["file-list"]),r(t,{open:v.value,title:s.value,footer:null,onCancel:i},{default:d(()=>[e("img",{alt:"example",style:{width:"100%"},src:y.value},null,8,Io)]),_:1},8,["open","title"])])}}},Mo=S(Po,[["__scopeId","data-v-60ead55d"]]),Oo=l=>(j("data-v-c17833ff"),l=l(),B(),l),Ro={class:"form-box"},Fo=Oo(()=>e("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Ao={__name:"add-robot-alert",setup(l,{expose:$}){const h=G(),L=U.useForm,I={span:4},_={span:20},m=p(!1),c=p(!1),n=E({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:""}),x=E({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:P,validateInfos:v,clearValidate:y}=L(n,x),s=t=>{n.robot_avatar=t.file},i=()=>{let t={robot_name:n.robot_name,robot_intro:n.robot_intro,robot_avatar:n.robot_avatar||V};c.value=!0,lo(t).then(a=>{if(c.value=!1,a.res!=0)return M.error(a.msg);M.success("机器人创建成功"),h.push("/robot/config/basic-config?id="+a.data.id)}).catch(()=>{c.value=!1})},g=async()=>{let t=await po({model_type:"LLM"});return!t||t.data.length==0?(O.confirm({title:"请先添加LLM模型服务商?",icon:to(X,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){h.push("/user/model")},onCancel(){}}),!1):!0},o=async()=>{await g()&&(n.robot_avatar="",n.robot_avatar_url=V,n.robot_name="",n.robot_intro="",m.value=!0)},f=()=>{y()},b=()=>{P().then(()=>{i()}).catch(t=>{})};return $({open:o}),(t,a)=>{const q=vo,R=uo,z=fo,K=U,W=O;return u(),T(W,{width:"746px",open:m.value,"onUpdate:open":a[3]||(a[3]=k=>m.value=k),confirmLoading:c.value,title:"新建机器人",onOk:b,onCancel:f},{default:d(()=>[e("div",Ro,[r(K,{"label-col":I,"wrapper-col":_},{default:d(()=>[r(R,F({ref:"name",label:"机器人名称"},w(v).robot_name),{default:d(()=>[r(q,{value:n.robot_name,"onUpdate:value":a[0]||(a[0]=k=>n.robot_name=k),placeholder:"请输入机器人名称"},null,8,["value"])]),_:1},16),r(R,F({label:"简介"},w(v).robot_intro),{default:d(()=>[r(z,{rows:4,value:n.robot_intro,"onUpdate:value":a[1]||(a[1]=k=>n.robot_intro=k),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),r(R,F({ref:"name",label:"机器人头像"},w(v).robot_avatar_url),{default:d(()=>[r(Mo,{value:n.robot_avatar_url,"onUpdate:value":a[2]||(a[2]=k=>n.robot_avatar_url=k),onChange:s},null,8,["value"]),Fo]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},To=S(Ao,[["__scopeId","data-v-c17833ff"]]),D=l=>(j("data-v-d2af72c8"),l=l(),B(),l),Uo={class:"robot-page"},So=D(()=>e("div",{class:"top-banner"},[e("div",null," 1.可以创建多个不同的机器人，不同机器人应用在不同场景中，不同机器人可以关联不同的知识库 "),e("div",null," 2.您可以复制链接将机器人提供给您的用户使用。在对外提供服务之前，建议您进行充分测试，并适当调整知识库 ")],-1)),jo={class:"list-box"},Bo={key:0,class:"list-item-wrapper"},Do=D(()=>e("span",{class:"add-text"},"新增机器人",-1)),Vo=["onClick"],Eo={class:"list-item"},No=["onClick"],Jo={class:"robot-info"},Go=["src"],qo={class:"robot-info-content"},zo={class:"robot-name"},Ko={class:"robot-desc"},Wo=["onClick"],Qo=D(()=>e("div",{class:"robot-action-line"},null,-1)),Xo=["onClick"],Yo={__name:"robot-list",setup(l){const $=Y();let{role_permission:h}=$;const L=eo(()=>h.includes("RobotCreate")),I=G(),_=p([]),m=()=>{io().then(s=>{_.value=s.data}).catch(()=>{})},c=p(null),n=()=>{c.value.open()},x=s=>{I.push({path:"/robot/config/basic-config",query:{id:s}})},P=s=>{let i=3,g=O.confirm({title:`删除机器人${s.robot_name}`,icon:r(H),content:"您确定要删除此机器人吗？",okText:i+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){v(s)},onCancel(){}}),o=setInterval(()=>{i==1?(g.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(o),o=void 0):(i-=1,g.update({okText:i+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},v=({id:s})=>{co({id:s}).then(()=>{M.success("删除成功"),m()})},y=s=>{window.open(`#/robot/test?robot_key=${s.robot_key}&id=${s.id}`)};return ao(()=>{m()}),(s,i)=>{const g=ho,o=ko,f=Co,b=Z;return u(),C("div",Uo,[So,e("div",jo,[L.value?(u(),C("div",Bo,[e("div",{class:"list-item add-robot",onClick:n},[r(w(bo),{class:"add-icon"}),Do])])):no("",!0),(u(!0),C(so,null,ro(_.value,t=>(u(),C("div",{class:"list-item-wrapper",key:t.id,onClick:a=>x(t.id)},[e("div",Eo,[e("span",{class:"item-action",onClick:i[1]||(i[1]=A(()=>{},["stop"]))},[r(f,null,{overlay:d(()=>[r(o,null,{default:d(()=>[r(g,null,{default:d(()=>[e("a",{class:"delete-text-color",href:"javascript:;",onClick:a=>P(t)},"删 除",8,No)]),_:2},1024)]),_:2},1024)]),default:d(()=>[e("span",{class:"menu-btn",onClick:i[0]||(i[0]=A(()=>{},["stop"]))},[r(w(go))])]),_:2},1024)]),e("div",Jo,[e("img",{class:"robot-avatar",src:t.robot_avatar,alt:""},null,8,Go),e("div",qo,[e("div",zo,N(t.robot_name),1),e("div",Ko,N(t.robot_intro),1)])]),e("div",{class:"robot-action",onClick:i[2]||(i[2]=A(()=>{},["stop"]))},[e("a",{class:"robot-action-item",href:"javascript:;",onClick:a=>x(t.id)},[r(b,{class:"action-icon",name:"jibenpeizhi"}),J(" 管理")],8,Wo),Qo,e("a",{class:"robot-action-item",onClick:a=>y(t)},[r(b,{class:"action-icon",name:"cmd"}),J(" 测试")],8,Xo)])])],8,Vo))),128))]),r(To,{ref_key:"addRobotAlertRef",ref:c},null,512)])}}},jt=S(Yo,[["__scopeId","data-v-d2af72c8"]]);export{jt as default};
