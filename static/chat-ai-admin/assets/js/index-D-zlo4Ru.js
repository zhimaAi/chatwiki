import{i as G,L as P}from"./charts-9PO4lPBa.js";import{_ as N,bg as nt,aA as rt}from"../../index-DxV-PNCd.js";import{d as C,Z as lt,w as it,X as dt,b as ct,y as J,z as X,B as Q,T as Z,ah as L,v as tt,a3 as ut,a4 as _t}from"./ui-antd-AfNpv4wx.js";import{f as w,r as z,o as R,w as W,ac as $,ad as f,as as e,k as s,ar as n,F as K,ax as U,u as I,ae as E,G as g,at as T,j as et,aw as at,av as pt,az as j}from"./vue-chunks-CGLjTDrY.js";import{u as yt}from"./chat-DoLMCmpL.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./index-CmzDLrI5.js";import"./index-BNO9ztvM.js";import"./useEventBus-CB_rGuu7.js";import"./useIM-CgIuP9SB.js";import"./index-DwtbXc27.js";const mt={class:"zm-date"},ft={class:"date-btn"},ht={class:"date-content"},st={__name:"date",props:{datekey:{type:String,default:"1"}},emits:["dateChange"],setup(M,{emit:l}){const _=M,i=w(1),r=l;let p=z([{label:"近7日",value:!0,key:2,start_date:C().subtract(6,"day"),end_date:C().subtract(0,"day")},{label:"近14日",value:!1,key:3,start_date:C().subtract(13,"day"),end_date:C().subtract(0,"day")},{label:"近30日",value:!1,key:4,start_date:C().subtract(29,"day"),end_date:C().subtract(0,"day")}]);const d=w(null),o=w(null),c=w([]),x=h=>h>=C().subtract(0,"day"),Y=()=>{let h=i.value,y=null;p.forEach(A=>{A.key==h&&(y=A)}),c.value=[y.start_date,y.end_date],d.value=y.start_date.format("YYYY-MM-DD"),o.value=y.end_date.format("YYYY-MM-DD"),F()},O=(h,y)=>{const A=C(h[0]);C(h[1]).diff(A,"days")>29?(c.value[0]=h[0],c.value[1]=A.add(29,"days"),d.value=c.value[0].format("YYYY-MM-DD"),o.value=c.value[1].format("YYYY-MM-DD"),ct.error("最多只能选择30天")):(c.value=h,d.value=y[0],o.value=y[1]),i.value=1,F()},F=()=>{r("dateChange",{start_date:d.value,end_date:o.value})};return R(()=>{i.value=parseInt(_.datekey),Y()}),W(()=>_.datekey,(h,y)=>{i.value=parseInt(_.datekey.split("-")[0]),Y()}),(h,y)=>{const A=lt,B=it,u=dt;return f(),$("div",mt,[e("div",ft,[s(B,{value:i.value,"onUpdate:value":y[0]||(y[0]=t=>i.value=t),onChange:Y},{default:n(()=>[(f(!0),$(K,null,U(I(p),t=>(f(),E(A,{class:"date-btn-button",value:t.key,key:t.key},{default:n(()=>[g(T(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",ht,[s(u,{value:c.value,"onUpdate:value":y[1]||(y[1]=t=>c.value=t),onChange:O,format:"YYYY-MM-DD",disabledDate:x,allowClear:!1},null,8,["value"])])])}}},vt={class:"container-echart"},bt=["id"],gt={__name:"echarts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}}},setup(M){const l=M;let _;const i=w(Math.floor(new Date().getTime()*Math.random())),r=()=>{const p={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"},left:"7%"},legend:{show:!1,right:"1%",textStyle:{color:"#262626",fontSize:"14px"},itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"5%",left:"10%",top:"10%",bottom:"25%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:l.xDataArray,axisLabel:{show:!0,fontSize:10,interval:0,rotate:60},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:l.yDataArray};_.setOption(p,{notMerge:!0})};return W(()=>l.xDataArray,()=>{setTimeout(()=>{r()},500)},{deep:!0}),W(()=>l.yDataArray,()=>{setTimeout(()=>{r()},500)},{deep:!0}),R(()=>{setTimeout(()=>{const p=document.getElementById(`echart${i.value}`);_=G(p),r()},500),window.addEventListener("resize",()=>{_.resize()})}),et(()=>{window.removeEventListener("resize",()=>{_.resize()})}),(p,d)=>(f(),$("div",vt,[e("div",{id:"echart"+i.value,class:"interface-echart"},null,8,bt)]))}},q=N(gt,[["__scopeId","data-v-09286acf"]]),Dt={class:"team-members-pages"},xt={class:"set-model"},At={class:"set-model-body"},kt={class:"set-date"},wt={class:"set-date-body"},St={class:"set-reset"},Ct={class:"list-box"},$t={class:"list-item"},Mt={class:"item-top"},Yt={class:"item-top-left"},zt={class:"list-item"},It={class:"item-top"},Tt={class:"item-top-left"},Lt={class:"list-item"},Et={class:"item-top"},Ft={class:"item-top-left"},Bt={class:"list-item"},Ot={class:"item-top"},Wt={class:"item-top-left"},Nt={__name:"statistical_analysis",setup(M){const l=at(),_=[1,2,3,4],i=z({res1:null,res2:null,res3:null,res4:null}),r=z({res1:null,res2:null,res3:null,res4:null}),p=w([{key:"all",id:"all",label:"全部渠道",title:"全部渠道"},{key:"yun_h5",id:"yun_h5",label:"WebAPP",title:"WebAPP"},{key:"yun_pc",id:"yun_pc",label:"嵌入网站",title:"嵌入网站"}]),d=w("2"),o=z({channel:"all",start_date:"",end_date:""}),c=u=>{o.start_date=u.start_date,o.end_date=u.end_date,Y()},x=()=>{o.channel="all",d.value="2-"+Math.random()},Y=()=>{for(let u=0;u<_.length;u++){const t=_[u];A(t)}},O=z({name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}),F=u=>{const t=[];return u.map(a=>t.push(a.date.slice(5,a.date.length))),t},h=u=>(u/1e3).toFixed(2),y=(u,t)=>{const a=JSON.parse(JSON.stringify(O)),k=[];let v="日活用户数（人）";switch(t){case"1":v="日活用户数（人）";break;case"2":v="日新增用户数（人）";break;case"3":v="总消息数（条）";break;case"4":v="token消耗数（千）";break}return u.map(S=>k.push(t=="4"?h(S.amount):S.amount)),a.name=v,a.data=k,[a]},A=u=>{let t={type:u,start_date:o.start_date,end_date:o.end_date,robot_id:l.query.id};o.channel!="all"&&(t.channel=o.channel),nt(t).then(a=>{a.data.length>0&&(i["res"+a.data[0].type]=F(a.data),r["res"+a.data[0].type]=y(a.data,a.data[0].type))})},B=u=>{o.channel=u,Y()};return R(()=>{}),(u,t)=>{const a=X,k=J,v=Q,S=Z,D=tt;return f(),$("div",Dt,[s(S,{justify:"flex-start"},{default:n(()=>[e("div",xt,[t[1]||(t[1]=e("div",{class:"label set-model-label"},"渠道：",-1)),e("div",At,[s(k,{value:o.channel,"onUpdate:value":t[0]||(t[0]=b=>o.channel=b),placeholder:"全部渠道",onChange:B,style:{width:"200px"}},{default:n(()=>[(f(!0),$(K,null,U(p.value,b=>(f(),E(a,{key:b.key,value:b.id},{default:n(()=>[e("span",null,T(b.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",kt,[t[2]||(t[2]=e("div",{class:"label set-date-label"},[e("span",null,"日期：")],-1)),e("div",wt,[s(st,{onDateChange:c,datekey:d.value},null,8,["datekey"])])]),e("div",St,[s(v,{onClick:x},{default:n(()=>[...t[3]||(t[3]=[g("重置",-1)])]),_:1})])]),_:1}),e("div",Ct,[e("div",$t,[e("div",Mt,[e("div",Yt,[t[5]||(t[5]=e("div",{class:"item-top-title"},"日活用户数",-1)),s(D,{placement:"top"},{title:n(()=>[...t[4]||(t[4]=[g("每天进行有效沟通的用户数。有效沟通的判定标准为一次及以上的问—答。",-1)])]),default:n(()=>[s(I(L))]),_:1})]),t[6]||(t[6]=e("div",{class:"item-top-right"},"单位（人）",-1))]),s(q,{xDataArray:i.res1,yDataArray:r.res1},null,8,["xDataArray","yDataArray"])]),e("div",zt,[e("div",It,[e("div",Tt,[t[8]||(t[8]=e("div",{class:"item-top-title"},"日新增用户数",-1)),s(D,{placement:"top"},{title:n(()=>[...t[7]||(t[7]=[g("每天进行有效沟通的新增用户数。有效沟通的判定标准为一次及以上的—问—答。",-1)])]),default:n(()=>[s(I(L))]),_:1})]),t[9]||(t[9]=e("div",{class:"item-top-right"},"单位（人）",-1))]),s(q,{xDataArray:i.res2,yDataArray:r.res2},null,8,["xDataArray","yDataArray"])]),e("div",Lt,[e("div",Et,[e("div",Ft,[t[11]||(t[11]=e("div",{class:"item-top-title"},"总消息数",-1)),s(D,{placement:"top"},{title:n(()=>[...t[10]||(t[10]=[g("每天用户和机器人沟通过程中产生的所有消息总数。",-1)])]),default:n(()=>[s(I(L))]),_:1})]),t[12]||(t[12]=e("div",{class:"item-top-right"},"单位（条）",-1))]),s(q,{xDataArray:i.res3,yDataArray:r.res3},null,8,["xDataArray","yDataArray"])]),e("div",Bt,[e("div",Ot,[e("div",Wt,[t[14]||(t[14]=e("div",{class:"item-top-title"},"Token消耗数",-1)),s(D,{placement:"top"},{title:n(()=>[...t[13]||(t[13]=[g("每天大模型消耗的token总数，包括使用大模型回答问题、优化问题、推荐问题的token消耗。",-1)])]),default:n(()=>[s(I(L))]),_:1})]),t[15]||(t[15]=e("div",{class:"item-top-right"},"单位（千）",-1))]),s(q,{xDataArray:i.res4,yDataArray:r.res4},null,8,["xDataArray","yDataArray"])])])])}}},Rt=N(Nt,[["__scopeId","data-v-67b0ae6e"]]),qt={class:"container-echart"},Pt=["id"],Kt={__name:"hit-line-charts",props:{xDataArray:{type:Array,default:function(){return["12-01","11-29","12-02","12-03","12-04","12-05","12-06"]}},yDataArray:{type:Array,default:function(){return[{name:"日活用户数（人）",type:"line",showSymbol:!1,symbol:"circle",symbolSize:10,itemStyle:{borderColor:"#fff",borderWidth:2,borderType:"solid",borderDashOffset:0,borderDashArray:[10,5],gap:2,borderRadius:50},color:"#2475FC",lineStyle:{width:1,color:"#2475FC"},label:{show:!0,fontSize:8,color:"#fff",fontWeight:10},smooth:!0,areaStyle:{origin:"start",color:new P(0,0,0,1,[{offset:0,color:"rgba(36,117,252, 0.3)"},{offset:1,color:"rgba(36,117,252, 0)"}])},data:[542,1222,147,5]}]}},grid:{type:Object,default:function(){return{right:"5%",left:"0%",top:"0%",bottom:"35%"}}}},setup(M){const l=M;let _;const i=w(Math.floor(new Date().getTime()*Math.random())),r=()=>{const p={tooltip:{trigger:"axis",formatter:function(d){let o=d[0].axisValue+"<br>";return d.forEach(c=>{let x=c.value;c.seriesName==="命中率"&&(x+="%"),o+=`
              <span style="display:inline-block;margin-right:5px;border-radius:10px;
              width:9px;height:9px;background-color:${c.color};"></span>
              ${c.seriesName}: ${x}<br>
            `}),o}},grid:{right:"7%",left:"4%",top:"10%",bottom:"10%"},legend:{data:["消息总数","命中消息","未命中消息","命中率"],bottom:0},xAxis:{type:"category",data:l.xDataArray},yAxis:[{type:"value",name:"数量（次）"},{type:"value",name:"百分比（%）",axisLabel:{formatter:"{value}%"}}],series:l.yDataArray.map((d,o)=>d.name==="命中率"?{...d,yAxisIndex:1}:d)};_.setOption(p,{notMerge:!0})};return W(()=>l.xDataArray,()=>{setTimeout(()=>{r()},500)},{deep:!0}),W(()=>l.yDataArray,()=>{setTimeout(()=>{r()},500)},{deep:!0}),R(()=>{setTimeout(()=>{const p=document.getElementById(`echart${i.value}`);_=G(p),r()},500),window.addEventListener("resize",()=>{_.resize()})}),et(()=>{window.removeEventListener("resize",()=>{_.resize()})}),(p,d)=>(f(),$("div",qt,[e("div",{id:"echart"+i.value,class:"interface-echart"},null,8,Pt)]))}},Ut=N(Kt,[["__scopeId","data-v-bf840eda"]]),Vt={class:"team-members-pages"},jt={class:"search-item"},Ht={class:"search-content"},Gt={class:"search-item"},Jt={class:"search-content"},Xt={class:"search-item"},Qt={class:"statics-header"},Zt={class:"statics-item"},te={class:"title"},ee={class:"num"},ae={class:"statics-item"},se={class:"title"},oe={class:"num"},ne={class:"statics-item"},re={class:"title"},le={class:"num"},ie={class:"statics-item"},de={class:"title"},ce={class:"num"},ue={__name:"hit-statics",setup(M){const l=pt(),_=yt(),{getChannelList:i}=_,r=at(),p=w([]),d=w("2"),o=z({robot_id:r.query.id,start_date:"",end_date:"",channel:""}),c=z({library_hit_rate:0,library_hit_total:0,library_miss_total:0,message_total:0}),x=z({xAxis:[],series:[]}),Y=async()=>{const t=await i({robot_id:r.query.id});p.value=[{app_type:"",app_name:"全部渠道",app_id:""},...t.data]},O=t=>{o.start_date=t.start_date,o.end_date=t.end_date,h()},F=()=>{o.channel="",d.value="2-"+Math.random()},h=()=>{y()},y=async()=>{rt({...o}).then(t=>{Object.assign(c,t.data.header);let a=t.data.chart_list||[],k=[],v=[];k=a.map(S=>C(S.date).format("MM-DD")),v=A(a),x.xAxis=k,x.series=v})},A=t=>{const a=[],k=t.map(m=>m.library_hit_rate),v=t.map(m=>m.library_hit_total),S=t.map(m=>m.library_miss_total),D=t.map(m=>m.message_total),b=(m,ot,V)=>({name:m,type:"line",showSymbol:!1,symbol:"circle",symbolSize:6,itemStyle:{color:V,borderColor:"#fff",borderWidth:2},lineStyle:{width:2,color:V},smooth:!0,data:ot});return a.push(b("消息总数",D,"#0079FE"),b("命中消息",v,"#00C292"),b("未命中消息",S,"#FF6B6B"),b("命中率",k,"#333")),a},B=(t,a)=>{o.app_type=a.data.app_type,o.app_id=a.data.app_id,h()},u=()=>{localStorage.setItem("/robot/config/unknown_issue/activeKey",1),l.push({path:"/robot/config/unknown_issue",query:{id:r.query.id,robot_key:r.query.robot_key,start_date:o.start_date,end_date:o.end_date}})};return R(()=>{Y()}),(t,a)=>{const k=X,v=J,S=Q,D=Z,b=tt;return f(),$("div",Vt,[s(D,{justify:"flex-start",gap:16},{default:n(()=>[e("div",jt,[a[1]||(a[1]=e("div",{class:"search-label"},"渠道：",-1)),e("div",Ht,[s(v,{value:o.channel,"onUpdate:value":a[0]||(a[0]=m=>o.channel=m),placeholder:"全部渠道",onChange:B,style:{width:"200px"}},{default:n(()=>[(f(!0),$(K,null,U(p.value,m=>(f(),E(k,{data:m,key:m.app_id+m.app_type,value:m.app_id+m.app_type},{default:n(()=>[e("span",null,T(m.app_name),1)]),_:2},1032,["data","value"]))),128))]),_:1},8,["value"])])]),e("div",Gt,[a[2]||(a[2]=e("div",{class:"search-label"},[e("span",null,"日期：")],-1)),e("div",Jt,[s(st,{onDateChange:O,datekey:d.value,disabledValue:"2025-01-01"},null,8,["datekey"])])]),e("div",Xt,[s(S,{onClick:F},{default:n(()=>[...a[3]||(a[3]=[g("重置",-1)])]),_:1})])]),_:1}),e("div",Qt,[e("div",Zt,[e("div",te,[s(D,{align:"center",gap:4},{default:n(()=>[a[5]||(a[5]=g("知识命中率 ",-1)),s(b,null,{title:n(()=>[...a[4]||(a[4]=[g("命中知识库消息数 / 机器人回复消息总数",-1)])]),default:n(()=>[s(I(L))]),_:1})]),_:1})]),e("div",ee,T(c.library_hit_rate)+"%",1)]),e("div",ae,[e("div",se,[s(D,{align:"center",gap:4},{default:n(()=>[a[7]||(a[7]=g("消息总数 ",-1)),s(b,null,{title:n(()=>[...a[6]||(a[6]=[g("仅统计机器人回复对应消息数量，不含人工服务期间消息",-1)])]),default:n(()=>[s(I(L))]),_:1})]),_:1})]),e("div",oe,T(c.message_total),1)]),e("div",ne,[e("div",re,[s(D,{align:"center",gap:4},{default:n(()=>[a[9]||(a[9]=g("知识库命中消息数 ",-1)),s(b,null,{title:n(()=>[...a[8]||(a[8]=[g("机器人回复时，检索到知识库文档，则认为命中消息",-1)])]),default:n(()=>[s(I(L))]),_:1})]),_:1})]),e("div",le,T(c.library_hit_total),1)]),e("div",ie,[e("div",de,[s(D,{align:"center",gap:4},{default:n(()=>[...a[10]||(a[10]=[g("知识库未命中消息数 ",-1)])]),_:1}),e("a",{onClick:u},"详情")]),e("div",ce,T(c.library_miss_total),1)])]),e("div",null,[s(Ut,{ref:"hitLineChartRef",xDataArray:x.xAxis,yDataArray:x.series},null,8,["xDataArray","yDataArray"])])])}}},_e=N(ue,[["__scopeId","data-v-e9473f8e"]]),pe={class:"user-model-page"},ye={class:"list-wrapper"},H="/robot/config/statistical_analysis/activeKey",me={__name:"index",setup(M){const l=w(+localStorage.getItem(H)||1),_=()=>{localStorage.setItem(H,l.value)};return(i,r)=>{const p=_t,d=ut;return f(),$("div",pe,[s(d,{class:"tab-wrapper",onChange:_,activeKey:l.value,"onUpdate:activeKey":r[0]||(r[0]=o=>l.value=o)},{default:n(()=>[(f(),E(p,{key:1,tab:"基础统计"})),(f(),E(p,{key:3,tab:"命中统计"}))]),_:1},8,["activeKey"]),e("div",ye,[l.value===1?(f(),E(Rt,{key:0})):j("",!0),l.value===3?(f(),E(_e,{key:1})):j("",!0)])])}}},Me=N(me,[["__scopeId","data-v-56921557"]]);export{Me as default};
