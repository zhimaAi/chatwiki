import{_ as at}from"./cu-scroll-qHaWhCWu.js";import{aw as nt,f as y,r as C,o as ot,b as lt,ac as a,k as n,ar as u,J as it,av as ut,q as _t,ad as e,as as o,u as m,az as l,ae as z,at as p,G as _,n as rt,F as g}from"./vue-chunks-CGLjTDrY.js";import{M as P,d as E,o as pt,I as dt,a0 as ct,G as mt,ae as ft,aM as yt,a5 as gt,bu as kt,al as vt,ai as ht,v as xt,aR as F,bE as H,W as bt,aT as wt,B as Ct,b as zt}from"./ui-antd-AfNpv4wx.js";import{_ as St,c as It,aD as Dt,aS as Rt,ax as $t,aU as Ft}from"../../index-DxV-PNCd.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";const Mt={class:"details-library-page"},Ot={class:"list-tools"},Lt={class:"tools-items"},Yt={class:"list-content"},Tt={key:0,class:"doc-name-td"},Bt=["href"],Ut={key:0},qt={key:1},Pt={key:1},Et={key:0},Ht={key:1},Nt=["onClick"],Vt={key:2,class:"url-remark"},Gt={key:0,class:"pdf-progress-box"},Jt={class:"progress-title"},jt={class:"status-box"},Kt=["onClick"],Qt={class:"progress-bar"},Wt={class:"num-box"},At={key:0,class:"status-tag running"},Xt={key:2,class:"status-tag running"},Zt={key:3,class:"status-tag complete"},ts={class:"status-tag status-error"},ss=["onClick"],es={class:"status-tag status-error"},as={class:"status-tag"},ns=["onClick"],os={key:7,class:"status-tag"},ls={key:8,class:"status-tag running"},is={class:"status-tag error"},us={key:10,class:"status-tag cancel"},_s={key:11,class:"status-tag subning"},rs={key:0},ps={key:1},ds={key:0},cs={key:1},ms={__name:"import-record",setup(fs){const N=It(),V=Dt(),{changeGraphSwitch:ys}=V,G=nt(),M=ut(),b=G.query,O=y(!1),L=y({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});C({selectedRowKeys:[]});const w=C({use_model:"",model_config_id:""}),Y=y([]),S=C({learned_err_count:0,learned_count:0,learned_wait_count:0}),d=C({library_id:b.id,file_name:void 0,status:"",page:1,size:10,total:0}),T=y([]),J=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"操作时间",dataIndex:"update_time",key:"update_time",width:150}],j=i=>{d.page=i.current,d.size=i.pageSize,k()},B=()=>{d.page=1,k()},U=(i,t={})=>{if(i.status=="4"||i.status=="3")return M.push({path:"/library/document-segmentation",query:{document_id:i.id,page:d.page}})},k=()=>{let i=it(d);i.status==0&&(i.status=""),O.value=!0,Rt(i).then(t=>{let c=t.data.info;!w.use_model&&w.use_model!=c.use_model&&(w.use_model=c.use_model,w.model_config_id=c.model_config_id),L.value={...c},T.value=J;let D=t.data.list||[],h=t.data.count_data||{};d.total=t.data.total,S.learned_count=h.learned_count,S.learned_err_count=h.learned_err_count,S.learned_wait_count=h.learned_wait_count;let x=!1;Y.value=D.map(r=>(["1","6","0","5"].includes(r.status)&&(x=!0),r.file_size_str=$t(r.file_size),r.update_time=E(r.update_time*1e3).format("YYYY-MM-DD HH:mm"),r.doc_last_renew_time_desc=r.doc_last_renew_time>0?E(r.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",r)),x&&K(),!x&&clearInterval(v.value)}).finally(()=>{O.value=!1})},v=y(null),K=()=>{clearInterval(v.value),v.value=setInterval(()=>{k()},1e3*5)},Q=i=>{P.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){Ft({id:i.id}).then(t=>{zt.success("取消成功"),k()})}})},I=y(!1),W=i=>{let t=`/manage/downloadLibraryFile?id=${i.id}&token=${N.getToken}`;var c=document.createElement("a");c.href=t,c.style.display="none",c.click()},A=()=>{M.push({path:"/library/details/export-record",query:b})};return ot(()=>{b.page&&(d.page=+b.page),k()}),lt(()=>{v.value&&clearInterval(v.value)}),(i,t)=>{const c=pt,D=dt,h=ft,x=kt,r=vt,R=xt,X=mt,Z=at,q=Ct,tt=wt,st=P,et=_t("copy");return e(),a("div",Mt,[n(Z,{scrollbar:!1},{default:u(()=>[n(c,{"show-icon":"",message:"通过文档导入记录，可以查看文档学习状态，学习失败的文档可以重新学习"}),o("div",Ot,[o("div",Lt,[n(D,{style:{width:"282px"},value:d.file_name,"onUpdate:value":t[0]||(t[0]=f=>d.file_name=f),placeholder:"请输入文档名称搜索",onChange:B},{suffix:u(()=>[n(m(ct),{onClick:B,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])])]),o("div",Yt,[n(X,{columns:T.value,"data-source":Y.value,scroll:{x:1e3},"row-key":"id",pagination:{current:d.page,total:d.total,pageSize:d.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:j},{bodyCell:u(({column:f,record:s})=>[f.key==="file_name"?(e(),a("div",Tt,[s.doc_type==2?(e(),z(h,{key:0,title:null},{content:u(()=>[t[3]||(t[3]=_(" 原链接：",-1)),o("a",{href:s.doc_url,target:"_blank"},p(s.doc_url),9,Bt),rt(n(m(yt),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[et,`${s.doc_url}`]])]),default:u(()=>[o("span",null,[["5","6","7"].includes(s.status)?(e(),a("span",Ut,p(s.doc_url),1)):(e(),a("span",qt,p(s.file_name),1))])]),_:2},1024)):(e(),a("span",Pt,[["5","6","7"].includes(s.status)?(e(),a("span",Et,p(s.doc_url),1)):(e(),a("span",Ht,p(s.file_name),1)),o("a",{style:{"margin-left":"2px"},onClick:$=>W(s)},"下载",8,Nt)])),s.doc_type==2&&s.remark?(e(),a("div",Vt," 备注："+p(s.remark),1)):l("",!0)])):l("",!0),f.key==="status"?(e(),a(g,{key:1},[s.file_ext=="pdf"&&s.pdf_parse_type>=2?(e(),a(g,{key:0},[s.status==0?(e(),a("div",Gt,[o("div",Jt,[o("span",jt,[n(m(gt)),t[4]||(t[4]=_("文档解析中",-1))]),o("a",{onClick:$=>Q(s)},"取消",8,Kt)]),o("div",Qt,[n(x,{size:"small",class:"progress-bar-box",percent:parseInt(s.ocr_pdf_index/s.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),o("div",Wt,p(s.ocr_pdf_index)+" / "+p(s.ocr_pdf_total),1)])])):l("",!0)],64)):(e(),a(g,{key:1},[s.status==0?(e(),a("span",At,[n(r,{size:"small"}),t[5]||(t[5]=_(" 转换中",-1))])):l("",!0)],64)),s.status==1?(e(),a("span",Xt,[n(r,{size:"small"}),t[6]||(t[6]=_(" 学习中",-1))])):l("",!0),s.status==2?(e(),a("span",Zt,[n(m(ht)),t[7]||(t[7]=_(" 学习完成",-1))])):l("",!0),s.status==3?(e(),z(R,{key:4,placement:"top"},{title:u(()=>[o("span",null,p(s.errmsg),1)]),default:u(()=>[o("span",null,[o("span",ts,[n(m(F)),t[8]||(t[8]=_(" 转换失败",-1))]),L.value.type==2?(e(),a("a",{key:0,class:"ml8",onClick:$=>U(s)},"学习",8,ss)):l("",!0)])]),_:2},1024)):l("",!0),s.status==8?(e(),z(R,{key:5,placement:"top"},{title:u(()=>[o("span",null,p(s.errmsg),1)]),default:u(()=>[o("span",null,[o("span",es,[n(m(F)),t[9]||(t[9]=_(" 转化异常",-1))])])]),_:2},1024)):l("",!0),s.status==4?(e(),a(g,{key:6},[o("span",as,[n(m(H)),t[10]||(t[10]=_(" 待学习",-1))]),o("a",{class:"ml8",onClick:$=>U(s)},"学习",8,ns)],64)):l("",!0),s.status==5?(e(),a("span",os,[n(m(H)),t[11]||(t[11]=_(" 待获取",-1))])):l("",!0),s.status==6?(e(),a("span",ls,[n(r,{size:"small"}),t[12]||(t[12]=_(" 获取中",-1))])):l("",!0),s.status==7?(e(),z(R,{key:9,placement:"top"},{title:u(()=>[o("span",null,p(s.errmsg),1)]),default:u(()=>[o("span",is,[n(m(F)),t[13]||(t[13]=_(" 获取失败",-1))])]),_:2},1024)):l("",!0),s.status==9?(e(),a("span",us,[n(m(bt)),t[14]||(t[14]=_(" 取消解析",-1))])):l("",!0),s.status==10?(e(),a("span",_s,[n(r,{size:"small"}),t[15]||(t[15]=_(" 正在分段 ",-1))])):l("",!0)],64)):l("",!0),f.key==="file_size"?(e(),a(g,{key:2},[s.doc_type==3?(e(),a("span",rs,"-")):(e(),a("span",ps,p(s.file_size_str),1))],64)):l("",!0),f.key==="paragraph_count"?(e(),a(g,{key:3},[s.status==0||s.status==1?(e(),a("span",ds,"-")):(e(),a("span",cs,p(s.paragraph_count),1))],64)):l("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1}),n(st,{open:I.value,"onUpdate:open":t[2]||(t[2]=f=>I.value=f),title:null,footer:null,width:640},{default:u(()=>[n(tt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:u(()=>[n(q,{style:{"margin-right":"16px"},onClick:t[1]||(t[1]=f=>I.value=!1)},{default:u(()=>[...t[16]||(t[16]=[_("知道了",-1)])]),_:1}),n(q,{onClick:A,type:"primary"},{default:u(()=>[...t[17]||(t[17]=[_("去下载",-1)])]),_:1})]),_:1})]),_:1},8,["open"])])}}},Ss=St(ms,[["__scopeId","data-v-8d6a720e"]]);export{Ss as default};
