import{h as re}from"./index-Bm5IPe57.js";import{c as ne,l as le,u as se,v as ue}from"./index-mwk_dyAT.js";import{d as v,w as ie,N as T,O as p,j as _,U as d,Y as D,S as h,X as y,u as L,z as V,b as N,q as pe,a6 as W,W as S,a1 as de,Z as _e,_ as ve,F as ce,k as me,a2 as fe,a3 as be}from"./vue-chunks-BRsu9_To.js";import{b as j,$ as ge,M as P,k as O,bq as ye,aC as ke,aD as we}from"../../index-M_xDbIir.js";import{F as $,_ as he}from"./index-V0sRhm34.js";import{P as xe}from"./PlusOutlined-DQ91YM1E.js";import{_ as Le}from"./index-BSroSjtu.js";import{u as Ce}from"./robot-DM4IWDeQ.js";import"./index-UA7y0weg.js";import{I as E}from"./Input-Bx6Hhp2b.js";import{S as Ae,a as Ie}from"./index-khLftDou.js";import{_ as Oe}from"./TextArea-C57yjED6.js";const Re={class:"avatar-uploader"},Ue=["src"],Fe={key:1},Me=["src"],Se={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(R,{emit:U}){function C(t){return new Promise((g,I)=>{const u=new FileReader;u.readAsDataURL(t),u.onload=()=>g(u.result),u.onerror=M=>I(M)})}const c=U,m=R,s=v([]),i=v(!1),k=v("");ie(()=>m.value,t=>{k.value=t},{immediate:!0});const F=$.useInjectFormItemContext(),a=()=>{let t={imageUrl:k.value,file:s.value[0].originFileObj};c("change",t),c("update:value",t.imageUrl),F.onFieldChange()},l=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(s.value=[t],C(t).then(u=>{k.value=u,i.value=!1,a()}),!1):(O.error("机器人头像图片大小不能超过100kb"),!1):(O.error("机器人头像只支持JPG、PNG格式的图片"),!1),f=v(!1),x=v(""),e=v(""),B=()=>{f.value=!1,e.value=""},A=async t=>{!t.url&&!t.preview&&(t.preview=await C(t.originFileObj)),x.value=t.url||t.preview,f.value=!0,e.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,g)=>{const I=Le,u=P;return p(),T("div",Re,[_(I,{"file-list":s.value,"onUpdate:fileList":g[0]||(g[0]=M=>s.value=M),"list-type":m.listType,"show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:A,style:D(m.style)},{default:d(()=>[R.value?(p(),T("img",{key:0,class:"avatar",style:D(m.style),src:R.value,alt:"avatar"},null,12,Ue)):(p(),T("div",Fe,[i.value?(p(),h(L(ge),{key:0})):(p(),h(L(xe),{key:1})),g[1]||(g[1]=y("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),_(u,{open:f.value,title:e.value,footer:null,onCancel:B},{default:d(()=>[y("img",{alt:"example",style:{width:"100%"},src:x.value},null,8,Me)]),_:1},8,["open","title"])])}}},z=j(Se,[["__scopeId","data-v-61828ec5"]]),Te={class:"form-box"},Pe={class:"robot-avatar-box"},Be={__name:"add-robot-alert",emits:["addRobot","editRobot","ok"],setup(R,{expose:U,emit:C}){const c=Ce(),m=C;let s="";const i=be(),k=fe(),F=$.useForm,a=v(!1),l=v(!1),f=v(!1),x=v([]),e=V({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0,group_id:"0"}),B=N(()=>e.application_type==0?a.value?"编辑机器人基本信息":"新建聊天机器人":a.value?"编辑工作流基本信息":"新建工作流"),A=N(()=>c.robotInfo),{getRobot:t}=c,g=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:I,validateInfos:u,clearValidate:M}=F(e,g),q=r=>{e.robot_avatar=r.file},H=()=>{let r={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||s,group_id:e.group_id||"0"};f.value=!0;let o=le,b="机器人创建成功";a.value&&(o=se,r.id=i.query.id,b="机器人编辑成功",r.robot_avatar==s&&delete r.robot_avatar),o(r,e.application_type).then(w=>{if(f.value=!1,w.res!=0)return O.error(w.msg);if(O.success(b),!a.value&&i.query.robot_key){m("addRobot"),l.value=!1;return}a.value?(t(i.query.id),m("editRobot"),l.value=!1):e.application_type==0?k.push("/robot/config/basic-config?id="+w.data.id+"&robot_key="+w.data.robot_key):(window.open("/#/robot/config/workflow?id="+w.data.id+"&robot_key="+w.data.robot_key+"&show_tips=1"),l.value=!1,m("ok"))}).catch(()=>{f.value=!1})},J=async()=>{let r=await re({model_type:"LLM"});return!r||r.data.length==0?(P.confirm({title:"请先添加LLM模型服务商?",icon:me(ye,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){k.push("/user/model")},onCancel(){}}),!1):!0},K=async(r,o)=>{r==0?s=ke:s=we,a.value=o;let b=await J();X(),b&&(e.robot_avatar="",e.robot_avatar_url=s,e.robot_name="",e.robot_intro="",e.application_type=r,l.value=!0,a.value&&A.value&&(e.robot_name=A.value.robot_name,e.robot_intro=A.value.robot_intro,e.robot_avatar_url=A.value.robot_avatar_url))},Z=r=>{e.group_id=r||"0"},X=()=>{ne().then(r=>{x.value=r.data||[]})},Y=()=>{M()},Q=()=>{I().then(()=>{H()}).catch(r=>{})};return pe(()=>{}),U({open:K,setGroupId:Z}),(r,o)=>{const b=he,w=E,ee=Ie,te=Ae,G=Oe,oe=$,ae=P;return p(),h(ae,{width:a.value?"472px":"746px",open:l.value,"onUpdate:open":o[6]||(o[6]=n=>l.value=n),confirmLoading:f.value,title:B.value,onOk:Q,onCancel:Y},{default:d(()=>[y("div",Te,[_(oe,{layout:"vertical"},{default:d(()=>[a.value?(p(),h(b,S({key:0,ref:"name",label:""},L(u).robot_avatar_url),{default:d(()=>[y("div",Pe,[_(z,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":o[0]||(o[0]=n=>e.robot_avatar_url=n),onChange:q},null,8,["value"]),o[7]||(o[7]=y("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):W("",!0),_(b,S({ref:"name",label:"应用名称"},L(u).robot_name),{default:d(()=>[_(w,{value:e.robot_name,"onUpdate:value":o[1]||(o[1]=n=>e.robot_name=n),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),_(b,S({ref:"group_id",label:"分组"},L(u).group_id),{default:d(()=>[_(te,{value:e.group_id,"onUpdate:value":o[2]||(o[2]=n=>e.group_id=n),style:{width:"100%"},placeholder:"请选择分组"},{default:d(()=>[(p(!0),T(ce,null,de(x.value,n=>(p(),h(ee,{value:n.id},{default:d(()=>[_e(ve(n.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},16),_(b,S({label:"简介"},L(u).robot_intro),{default:d(()=>[a.value?(p(),h(G,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":o[4]||(o[4]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(p(),h(G,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":o[3]||(o[3]=n=>e.robot_intro=n),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),a.value?W("",!0):(p(),h(b,S({key:1,ref:"name",label:"机器人头像"},L(u).robot_avatar_url),{default:d(()=>[_(z,{value:e.robot_avatar_url,"onUpdate:value":o[5]||(o[5]=n=>e.robot_avatar_url=n),onChange:q},null,8,["value"]),o[8]||(o[8]=y("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1,__:[8]},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},Ye=j(Be,[["__scopeId","data-v-8c8c70f2"]]),Ve={class:"form-item"},$e={class:"form-content"},je={__name:"add-group",emits:["ok"],setup(R,{expose:U,emit:C}){const c=v(!1),m=C,s=v("新建分组"),i=V({group_name:"",id:""}),k=a=>{i.group_name=a.group_name||"",i.id=a.id||"",s.value=a.id?"编辑分组":"新建分组",c.value=!0},F=()=>{if(!i.group_name)return O.error("请输入分组名称");ue({...i}).then(a=>{O.success(`${s.value}成功`),c.value=!1,m("ok")})};return U({show:k}),(a,l)=>{const f=E,x=P;return p(),T("div",null,[_(x,{open:c.value,"onUpdate:open":l[1]||(l[1]=e=>c.value=e),title:s.value,onOk:F,zIndex:2e3},{default:d(()=>[y("div",Ve,[l[2]||(l[2]=y("div",{class:"form-label"},"分组名称：",-1)),y("div",$e,[_(f,{maxLength:15,value:i.group_name,"onUpdate:value":l[0]||(l[0]=e=>i.group_name=e),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},Qe=j(je,[["__scopeId","data-v-64dac278"]]);export{Ye as A,Qe as a};
