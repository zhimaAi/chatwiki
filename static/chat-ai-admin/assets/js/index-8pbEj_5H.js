var j=Object.defineProperty;var q=(t,e,o)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var d=(t,e,o)=>(q(t,typeof e!="symbol"?e+"":e,o),o);import{bm as c}from"../../index-CyiwD4fB.js";async function M(t,e){const o=t.getReader();let n;for(;!(n=await o.read()).done;)e(n.value)}function R(t){let e,o,n,r=!1;return function(f){e===void 0?(e=f,o=0,n=-1):e=I(e,f);const a=e.length;let s=0;for(;o<a;){r&&(e[o]===10&&(s=++o),r=!1);let i=-1;for(;o<a&&i===-1;++o)switch(e[o]){case 58:n===-1&&(n=o-s);break;case 13:r=!0;case 10:i=o;break}if(i===-1)break;t(e.subarray(s,i),n),s=o,n=-1}s===a?e=void 0:s!==0&&(e=e.subarray(s),o-=s)}}function D(t,e,o){let n=C(),r=!1;const g=new TextDecoder;return function(a,s){if(a.length===0)o==null||o(n),n=C(),r=!1;else if(s>0){const i=g.decode(a.subarray(0,s)),w=s+1,l=g.decode(a.subarray(w));switch(i){case"data":n.data=r?n.data+`
`+l:l,r=!0;break;case"event":n.event=l;break;case"id":t(n.id=l);break;case"retry":const y=parseInt(l,10);isNaN(y)||e(n.retry=y);break}}}}function I(t,e){const o=new Uint8Array(t.length+e.length);return o.set(t),o.set(e,t.length),o}function C(){return{data:"",event:"",id:"",retry:void 0}}var P=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]]);return o};const v="text/event-stream",W=1e3,T="last-event-id";function _(t,e){var{signal:o,headers:n,onopen:r,onmessage:g,onclose:f,onerror:a,openWhenHidden:s,fetch:i}=e,w=P(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((l,y)=>{const p=Object.assign({},n);p.accept||(p.accept=v);let h;function L(){h.abort(),document.hidden||O()}s||document.addEventListener("visibilitychange",L);let k=W,m=0;function E(){document.removeEventListener("visibilitychange",L),window.clearTimeout(m),h.abort()}o==null||o.addEventListener("abort",()=>{E(),l()});const x=i??window.fetch,A=r??H;async function O(){var S;h=new AbortController;try{const b=await x(t,Object.assign(Object.assign({},w),{headers:p,signal:h.signal}));await A(b),await M(b.body,R(D(u=>{u?p[T]=u:delete p[T]},u=>{k=u},g))),f==null||f(),E(),l()}catch(b){if(!h.signal.aborted)try{const u=(S=a==null?void 0:a(b))!==null&&S!==void 0?S:k;window.clearTimeout(m),m=window.setTimeout(O,u)}catch(u){E(),y(u)}}}O()})}function H(t){const e=t.headers.get("content-type");if(!(e!=null&&e.startsWith(v)))throw new Error(`Expected content-type to be ${v}, Actual: ${e}`)}class N{constructor(e={url:"",data:{}}){d(this,"onOpen");d(this,"onClose");d(this,"onError");d(this,"onMessage");d(this,"opt",{url:"",data:{}});d(this,"controller",new AbortController);d(this,"abort",()=>{this.controller.abort()});this.socketMsgQueue=[],this.opt={...this.opt,...e},this.open()}open(){const e=this;let o=new FormData;for(let n in e.opt.data)o.append(n,e.opt.data[n]);_(this.opt.url,{method:"POST",headers:{"App-Type":""},signal:e.controller.signal,openWhenHidden:!0,body:o,async onopen(n){if(n.ok&&n.headers.get("content-type")===v){typeof e.onOpen=="function"&&e.onOpen();return}else throw n.status>=400&&n.status<500&&n.status!==429?new Error("连接出错"):new Error("连接出错")},onmessage(n){typeof e.onMessage=="function"&&e.onMessage(n)},onclose(){typeof e.onClose=="function"&&e.onClose(),e.controller.abort()},onerror(n){throw typeof e.onError=="function"&&e.onError(n),n}})}}const F="",$=t=>new N({url:F+"/chat/request",data:t}),B=t=>c.post({url:"/chat/welcome",data:t}),Q=t=>c.post({url:"/manage/getDialogueList",data:t}),V=t=>c.post({url:"/chat/message",data:t}),z=t=>c.get({url:"/manage/getSessionRecordList",params:t}),J=t=>c.get({url:"/manage/createSessionExport",params:t}),K=t=>c.get({url:"/manage/getExportTaskList",params:t}),X=t=>c.get({url:"/manage/getSessionChannelList",data:t}),Y=t=>c.get({url:"/manage/getAnswerSource",params:t}),Z=t=>c.post({url:"/chat/questionGuide",data:t});export{Y as a,B as b,J as c,Q as d,V as e,z as f,K as g,X as h,Z as q,$ as s};
