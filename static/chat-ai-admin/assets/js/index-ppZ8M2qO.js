import{X as he,Y as i,_ as s,k as R,a5 as o,a6 as pe,a3 as oe,G as U,a7 as h,ag as W,f as $,w as ie,o as ne,y as J,b as ae,a1 as z,u as C,ae as L,F as N,ab as D,ac as E,q as le,a2 as H,n as ce,H as re,J as K,a9 as ve}from"./vue-chunks-DCKTEHpB.js";import{u as de}from"./useEventBus-DiSgsUdT.js";import{g as me}from"./index-DLEjqKv8.js";import{a7 as Q,ag as Z,b3 as ee,b7 as te,b8 as se,c as fe,_ as P,d as X}from"../../index-C1Xsov4S.js";import{u as ge}from"./useIM-VcvUiK3v.js";import{B as F,M as ye,S as ke,P as be}from"./pull-up.esm-DIiTC7VE.js";import{O as Le}from"./observe-dom.esm-B25JyVKH.js";import{ai as xe,av as Te,ax as we,w as Se,v as Ce,I as $e}from"./ui-antd-D64OvTpt.js";import{_ as Me,V as Re}from"./voice-message-CBAiyqEJ.js";import{M as Ie}from"./multiple-message-yay6quKz.js";import{h as Ne}from"./index-CyL7qnQS.js";import"./utils-D9NMMoMR.js";import"./index-Cg5KXOzW.js";const Be=(d={})=>Q.get({url:"/manage/getReceiverList",params:d}),De=(d={})=>Q.post({url:"/chat/message",data:d}),Oe=(d={})=>Q.post({url:"/manage/setReceiverRead",data:d}),Y=he("chatMonitor",{state:()=>({im:null,selectedRobotId:"",robotList:[],selectedReceiverId:"",receiverList:[],receiverListPage:{page:0,size:10},activeChat:null,chatMessagePageSize:10,messageList:[],messageListScrollTop:0,chatMessageLoadCompleted:!1,messageListLoading:!1}),getters:{},actions:{async init(){this.selectedRobotId="",this.selectedReceiverId="",this.robotList=[],this.receiverList=[],this.messageList=[],this.receiverListPage={page:0,size:10},this.messageListScrollTop=0,this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.activeChat=null,await this.getRobotList(),await this.getReceiverList(),this.receiverList.length>0&&await this.switchChat(this.receiverList[0]),this.initIM()},closeIM(){this.im&&this.im.close()},initIM(){const d=ge(),r=fe();this.im=d,d.connect(r.user_id),d.on("message",t=>{!t.data||t.msg_type!=="receiver_notify"||((t.change=="create"||t.change=="update")&&this.onAddReceiver(t),t.change=="delete"&&this.onDeleteReceiver(t),(t.change=="c_message"||t.change=="ai_message")&&this.onAddMessage(t))})},onAddMessage(d){if(!this.activeChat)return;const r=de();let t=d.data;if(this.activeChat.session_id==t.session_id){if(t.displayName=t.name||t.nickname,t.dispayTime=ee(t.create_time),t.uid=Z(32),t.loading=!1,t.menu_json&&typeof t.menu_json=="string"&&(t.menu_json=JSON.parse(t.menu_json)),t.quote_file&&typeof t.quote_file=="string"&&(t.quote_file=JSON.parse(t.quote_file)),t.reply_content_list&&typeof t.reply_content_list=="string")try{t.reply_content_list=JSON.parse(t.reply_content_list)}catch{t.reply_content_list=[]}t.voice_content=te(t.content),t.content=se(t.content),this.messageList.push(t),r.emit("onAddMessage",t)}},onAddReceiver(d){let r=d.data;r.displayName=r.name||r.nickname,r.come_from=JSON.parse(r.come_from);let t=this.receiverList.findIndex(a=>a.session_id==r.session_id);t!==-1?this.receiverList.splice(t,1,r):(this.selectedRobotId==""||this.selectedRobotId==r.robot_id)&&this.receiverList.unshift(r)},onDeleteReceiver(d){let r=d.data,t=this.receiverList.findIndex(a=>a.id==r);t!=-1&&(this.activeChat&&this.activeChat.id==r&&(this.activeChat=null),this.receiverList.splice(t,1))},async getRobotList(d){try{const r=await me(d);return this.robotList=r.data||[],r}catch(r){throw console.error("Failed to get robot list:",r),r}},async getReceiverList(d){d!=null&&d.page?this.receiverListPage.page=d.page:this.receiverListPage.page++;const r={...this.receiverListPage,robot_id:this.selectedRobotId,...d};try{const t=await Be(r);let a=t.data.list||[];for(let e=0;e<a.length;e++)if(a[e].displayName=a[e].name||a[e].nickname,a[e].come_from)try{a[e].come_from=JSON.parse(a[e].come_from)}catch(u){console.error("Failed to parse come_from:",u)}return this.receiverListPage.page===1?this.receiverList=a:this.receiverList=this.receiverList.concat(a),t}catch(t){throw console.error("Failed to get receiver list:",t),this.receiverListPage.page>1&&this.receiverListPage.page--,t}},changeRobot(d){this.activeChat=null,this.resetReceiverList(d)},resetReceiverList(d){return this.receiverListPage.page=0,this.receiverList=[],this.getReceiverList(d)},async getChatMessage(){if(this.messageListLoading)return;this.messageListLoading=!0;let d=0,r=this.messageList.filter(a=>!a.isWelcome);r.length>0&&(d=r[0].id);let t={robot_key:this.activeChat.robot_key,openid:this.activeChat.openid,min_id:d,size:this.chatMessagePageSize,rel_user_id:this.activeChat.rel_user_id};return De(t).then(a=>{var x,g;this.messageListLoading=!1;let e=a.data.list||[];const u=((x=a==null?void 0:a.data)==null?void 0:x.customer)||{},m=((g=a==null?void 0:a.data)==null?void 0:g.robot)||{};e.sort((n,f)=>n.id-f.id);for(let n=0;n<e.length;n++){if(e[n].displayName=e[n].name||e[n].nickname,e[n].is_customer==1?(e[n].displayName=e[n].displayName||u.name,e[n].avatar=e[n].avatar||u.avatar):(e[n].displayName=e[n].displayName||m.robot_name,e[n].avatar=e[n].avatar||m.robot_avatar),e[n].uid=Z(32),e[n].menu_json&&typeof e[n].menu_json=="string"&&(e[n].menu_json=JSON.parse(e[n].menu_json)),e[n].quote_file&&typeof e[n].quote_file=="string"&&(e[n].quote_file=JSON.parse(e[n].quote_file)),e[n].reply_content_list&&typeof e[n].reply_content_list=="string")try{e[n].reply_content_list=JSON.parse(e[n].reply_content_list)}catch{e[n].reply_content_list=[]}e[n].dispayTime=ee(e[n].create_time),e[n].voice_content=te(e[n].content),e[n].content=se(e[n].content)}return this.messageList=[...e,...this.messageList],e.length<this.chatMessagePageSize&&(this.chatMessageLoadCompleted=!0),a}).catch(a=>{this.messageListLoading=!1})},claerUnread(){return Oe({id:this.selectedReceiverId})},async switchChat(d){this.chatMessageLoadCompleted=!1,this.messageListLoading=!1,this.messageList=[],this.messageListScrollTop=0,this.selectedReceiverId=d.id,this.activeChat=d,this.claerUnread(),await this.getChatMessage()}}}),Ae={class:"no-data"},qe={class:"no-data-text"},He={__name:"list-empty",props:{text:{type:String,default:"暂无数据"},size:{type:[Number,String],default:100}},setup(d){const r=d;return(t,a)=>{const e=X;return s(),i("div",Ae,[R(e,{name:"empty",style:pe({"font-size":`${r.size}px`})},null,8,["style"]),o("div",qe,[oe(t.$slots,"default",{},()=>[U(h(r.text),1)],!0)])])}}},_e=P(He,[["__scopeId","data-v-9f7736f0"]]),Pe={key:1,class:"chat-list"},ze=["onClick"],je={class:"avatar"},Fe=["src","alt"],Ue={class:"chat-info"},Je={class:"nickname"},Ve={class:"last-message"},Ee={class:"webapp-source"},We={key:0,class:"loading-wrapper"},Ye={key:1,class:"finished-text"},Ge={__name:"chat-list ",emits:["switchChat"],setup(d,{expose:r,emit:t}){F.use(ye),F.use(ke),F.use(Le),F.use(be);const a=t,e=Y(),{getReceiverList:u}=e,{receiverList:m,selectedReceiverId:x}=W(e),g=$(null);let n=null;const f=$(!1),w=$(!1),I=()=>{n=new F(g.value,{scrollY:!0,click:!0,observeDOM:!0,mouseWheel:!0,bounce:!1,scrollbar:{fade:!0,interactive:!0},pullUpLoad:!0}),n.on("pullingUp",()=>{y()})},y=async(k={})=>{if(f.value||w.value){n.finishPullUp();return}f.value=!0;try{(await u(k)).data.list.length===0&&!k.keyword&&(w.value=!0)}catch(S){console.error("加载更多数据失败:",S)}finally{f.value=!1,n.finishPullUp()}},v=k=>{a("switchChat",k)};return ie(m,k=>{k.length>0&&J(()=>{n&&n.refresh()})}),ne(()=>{J(()=>{I()})}),ae(()=>{n&&n.destroy()}),r({getData:y}),(k,S)=>{const b=xe;return s(),i("div",{class:"scroll-wrapper",ref_key:"scrollRef",ref:g},[C(m).length==0?(s(),z(_e,{key:0,size:"140",text:"暂无机器人接待中会话"})):(s(),i("div",Pe,[(s(!0),i(N,null,D(C(m),c=>(s(),i("div",{key:c.id,class:E(["chat-item",{active:c.id===C(x)}]),onClick:B=>v(c)},[o("div",je,[o("img",{src:c.avatar,alt:c.displayName},null,8,Fe),c.unread>0?(s(),i("span",{key:0,class:E(["dot",{plus:c.unread>9}])},h(c.unread),3)):L("",!0)]),o("div",Ue,[o("div",Je,h(c.displayName),1),o("div",Ve,h(c.last_chat_message),1),o("div",Ee,"来自："+h(c.come_from.app_name),1)])],10,ze))),128)),f.value?(s(),i("div",We,[R(b,{size:"small"}),S[0]||(S[0]=o("span",{class:"loading-text"},"加载中...",-1))])):L("",!0),w.value?(s(),i("div",Ye,"没有更多了")):L("",!0)]))],512)}}},Qe=P(Ge,[["__scopeId","data-v-22be0114"]]),Xe={__name:"chat-message-scroll",props:{topTriggerDistance:{type:Number,default:10},bottomTriggerDistance:{type:Number,default:40},isLoading:{type:Boolean,default:!1},scrollTop:{type:Number,default:0}},emits:["scroll-top","scroll-bottom","scroll"],setup(d,{expose:r,emit:t}){const a=d,e=t,u=$(null),m=$({scrollTop:0,scrollHeight:0,clientHeight:0,scrollDirection:"down",scrollStartDiff:a.topTriggerDistance,scrollEndDiff:a.bottomTriggerDistance}),x=$(null),g=v=>{const{scrollTop:k}=v,S=m.value.scrollTop-k;m.value.scrollDirection=S>0?"up":"down",Object.assign(m.value,{scrollTop:k,scrollHeight:v.scrollHeight,clientHeight:v.clientHeight})},n=()=>{const{scrollTop:v,scrollHeight:k,clientHeight:S,scrollStartDiff:b,scrollEndDiff:c,scrollDirection:B}=m.value;e("scroll",{...m.value}),a.isLoading||(Math.abs(v)<=b&&B==="up"&&e("scroll-top",{...m.value}),Math.abs(k-v-S)<=c&&B==="down"&&e("scroll-bottom",{...m.value}))},f=v=>{g(v.target),x.value&&(clearTimeout(x.value),x.value=null),x.value=setTimeout(()=>{n()},100)};function w(){u.value&&(u.value.scrollTop=0)}function I(){u.value&&(u.value.scrollTop=u.value.scrollHeight)}function y(){return u.value&&Object.assign(m.value,{scrollTop:u.value.scrollTop,scrollHeight:u.value.scrollHeight,clientHeight:u.value.clientHeight}),JSON.parse(JSON.stringify(m.value))}return ie(()=>a.scrollTop,v=>{u.value&&(u.value.scrollTop=v)}),r({scrollToTop:w,scrollToBottom:I,getState:y}),(v,k)=>(s(),i("div",{class:"chat-message-scroll",ref_key:"scrollContainer",ref:u,onScroll:f},[oe(v.$slots,"default",{},void 0,!0)],544))}},Ke=P(Xe,[["__scopeId","data-v-3e3a1c2e"]]),Ze={class:"chat-message-warpper"},et={class:"chat-message-content"},tt={key:0,class:"is-loaded"},st={class:"avatar"},ot=["src","alt"],it={class:"message-content"},nt={class:"message-info"},at={class:"nickname"},lt={class:"time"},ct={key:0,class:"reply-list"},rt={key:0,class:"reply-item reply-text"},dt=["innerHTML"],_t={key:1,class:"reply-item reply-image"},ut={class:"message-content"},ht=["src"],pt={key:2,class:"reply-item reply-url"},vt={class:"url-row"},mt=["href"],ft={key:3,class:"reply-item reply-card"},gt={class:"card-row"},yt=["src"],kt={class:"card-title-box"},bt={class:"card-title"},Lt={key:4,class:"reply-item reply-imageText"},xt=["href"],Tt=["src"],wt={class:"imageText-text"},St={class:"imageText-title"},Ct={class:"imageText-desc"},$t={key:5,class:"reply-item reply-smartMenu"},Mt={class:"smart-menu-box"},Rt={key:0,class:"card-title"},It={class:"card-text"},Nt={key:0,class:"line-text"},Bt={key:1,class:"empty-line"},Dt=["innerHTML"],Ot={key:3,href:"javascript:;",class:"link"},At={key:0},qt={key:1,class:"message-bubble"},Ht={key:0,class:"text-content"},Pt={key:1},zt={key:1,class:"image-content"},jt=["src"],Ft={key:2,class:"image-content"},Ut=["src"],Jt={key:3,class:"menu-content"},Vt={class:"menus-label"},Et={key:0,class:"menu-items"},Wt=["onClick"],Yt={key:4,class:"multiple-content"},Gt={key:5,class:"answer-reference-box"},Qt=["onClick"],Xt={key:2},Kt={__name:"chat-message",emits:["openLibrary"],setup(d,{expose:r,emit:t}){const a=t,e=$(null),u=Y(),{getChatMessage:m}=u,{messageList:x,messageListScrollTop:g,messageListLoading:n,chatMessageLoadCompleted:f,activeChat:w}=W(u),I=()=>{};function y(T,p,M){let q=K(T);p.robot_key=w.value.robot_key,p.robot_id=w.value.robot_id,q.forEach(l=>{l.message_id=M.id,l.openid=M.openid,l.robot_key=w.value.robot_key,l.robot_id=w.value.robot_id}),a("openLibrary",q,K(p))}function v(T){const p=[];return(Array.isArray(T)?T:[]).forEach(M=>{const q=String((M==null?void 0:M.menu_type)||""),l=String((M==null?void 0:M.content)||"");if(q==="0")if(l==="")p.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(l)){const G=/href\s*=\s*['"]\s*#\s*['"]/i.test(l)?l.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):l.replace(/href=/ig,'target="_blank" href=');p.push({kind:"html",html:G})}else p.push({kind:"text",text:l});else q==="1"&&p.push({kind:"keyword",text:l,serial_no:(M==null?void 0:M.serial_no)||""})}),p.slice(0,20)}const k=T=>{const{scrollTop:p}=T;g.value=p},S=async()=>{if(f.value)return;let T=e.value.getState();await m(),J(()=>{let p=e.value.getState();p.scrollDirection=="up"&&(g.value=p.scrollHeight-T.scrollHeight)})},b=async()=>{},c=()=>{e.value.scrollToBottom()},B=()=>{e.value.scrollToTop()};function A(T){try{return T?Array.isArray(T)?T:typeof T=="string"?JSON.parse(T||"[]"):[]:[]}catch{return[]}}return r({scrollToTop:B,scrollToBottom:c}),(T,p)=>{const M=X,q=le("viewer");return s(),i("div",Ze,[R(Ke,{ref_key:"scrollViewRef",ref:e,scrollTop:C(g),"onUpdate:scrollTop":p[0]||(p[0]=l=>re(g)?g.value=l:null),"is-loading":C(n),onScroll:k,onScrollTop:S,onScrollBottom:b},{default:H(()=>[o("div",et,[C(f)?(s(),i("div",tt,"没用更多聊天记录了")):L("",!0),(s(!0),i(N,null,D(C(x),(l,G)=>(s(),i("div",{key:G,class:E(["message-item",l.is_customer==0?"right":""])},[o("div",st,[o("img",{src:l.avatar,alt:l.displayName},null,8,ot)]),o("div",it,[o("div",nt,[o("span",at,h(l.displayName),1),p[1]||(p[1]=o("i",{class:"gap"},null,-1)),o("span",lt,h(l.dispayTime),1)]),A(l.reply_content_list).length?(s(),i("div",ct,[(s(!0),i(N,null,D(A(l.reply_content_list),(_,j)=>{var V;return s(),i(N,{key:j},[(_.reply_type||_.type)==="text"?(s(),i("div",rt,[o("div",{class:"message-content",innerHTML:_.description},null,8,dt)])):(_.reply_type||_.type)==="image"?(s(),i("div",_t,[o("div",ut,[ce(o("img",{class:"msg-img",src:_.pic||_.thumb_url},null,8,ht),[[q]])])])):(_.reply_type||_.type)==="url"?(s(),i("div",pt,[o("div",vt,[o("a",{class:"url-link",href:_.url,target:"_blank"},h(_.url),9,mt)])])):(_.reply_type||_.type)==="card"?(s(),i("div",ft,[o("div",gt,[_.thumb_url?(s(),i("img",{key:0,src:_.thumb_url,class:"card-thumb"},null,8,yt)):L("",!0),o("div",kt,[R(M,{class:"think-icon",name:"applet"}),o("span",bt,h(_.title),1)])])])):(_.reply_type||_.type)==="imageText"?(s(),i("div",Lt,[o("a",{class:"imageText-row",href:_.url,target:"_blank"},[_.thumb_url?(s(),i("img",{key:0,src:_.thumb_url,class:"imageText-thumb"},null,8,Tt)):L("",!0),o("div",wt,[o("div",St,h(_.title),1),o("div",Ct,h(_.description),1)])],8,xt)])):(_.reply_type||_.type)==="smartMenu"?(s(),i("div",$t,[o("div",Mt,[_.smart_menu&&_.smart_menu.menu_description?(s(),i("div",Rt,h(_.smart_menu.menu_description),1)):L("",!0),o("div",It,[(s(!0),i(N,null,D(v(((V=_.smart_menu)==null?void 0:V.menu_content)||[]),(O,ue)=>(s(),i("div",{key:ue,class:"reply-line"},[O.kind==="text"?(s(),i("span",Nt,h(O.text),1)):O.kind==="newline"?(s(),i("div",Bt)):O.kind==="html"?(s(),i("span",{key:2,innerHTML:O.html},null,8,Dt)):O.kind==="keyword"?(s(),i("a",Ot,[O.serial_no?(s(),i("div",At,h(O.serial_no),1)):L("",!0),U(" "+h(O.text),1)])):L("",!0)]))),128))])])])):L("",!0)],64)}),128))])):L("",!0),l.msg_type==1&&l.content==""?L("",!0):(s(),i("div",qt,[l.msg_type==1?(s(),i("div",Ht,[l.is_customer==0?(s(),z(Me,{key:0,style:{"text-align":"left"},content:l.content},null,8,["content"])):(s(),i("div",Pt,h(l.content),1))])):l.received_message_type=="image"&&l.media_id_to_oss_url?(s(),i("div",zt,[o("img",{src:l.media_id_to_oss_url,alt:"image"},null,8,jt)])):l.msg_type==3?(s(),i("div",Ft,[o("img",{src:l.content,alt:"image"},null,8,Ut)])):l.msg_type==2?(s(),i("div",Jt,[o("div",Vt,h(l.menu_json.content),1),l.menu_json.question&&l.menu_json.question.length>0?(s(),i("div",Et,[(s(!0),i(N,null,D(l.menu_json.question,(_,j)=>(s(),i("div",{key:j,class:"menu-item",onClick:V=>I(_)},h(_),9,Wt))),128))])):L("",!0)])):l.msg_type==99?(s(),i("div",Yt,[R(Ie,{message:l.content},null,8,["message"])])):L("",!0),l.quote_file&&l.quote_file.length?(s(),i("div",Gt,[p[2]||(p[2]=o("div",{class:"answer-reference-label"},"回答参考",-1)),o("div",null,[(s(!0),i(N,null,D(l.quote_file,(_,j)=>(s(),i("div",{class:"list-item",key:j},[R(M,{name:"attachment"}),o("span",{onClick:V=>y(l.quote_file,_,l)},h(_.file_name),9,Qt)]))),128))])])):L("",!0)])),l.voice_content&&l.voice_content.length?(s(),i("div",Xt,[R(Re,{voice_content:l.voice_content},null,8,["voice_content"])])):L("",!0)])],2))),128))])]),_:1},8,["scrollTop","is-loading"])])}}},Zt=P(Kt,[["__scopeId","data-v-2ba6f20b"]]),es={class:"library-info-content"},ts={class:"file-list"},ss=["onClick"],os={class:"document-items"},is={class:"document-item-header"},ns={class:"left-box"},as={class:"document-title"},ls={key:0,class:"document-title"},cs={class:"document-size"},rs={class:"document-item-body"},ds={class:"document-similarity"},_s={key:0,class:"document-content"},us={key:1,class:"document-content"},hs={class:"document-content"},ps={class:"fragment-img"},vs=["src"],ms={__name:"library-info-alert",setup(d,{expose:r}){const t=ve(),a=$(!1),e=$([]),u=$(null),m=()=>{e.value=[],u.value=null},x=(y,v)=>{m(),e.value=y,u.value=v.id,a.value=!0,f(v)},g=y=>{y.id!=u.value&&(u.value=y.id,f(y))},n=$([]),f=y=>{Ne({message_id:y.message_id,file_id:y.id,robot_key:y.robot_key,openid:y.openid}).then(v=>{n.value=v.data||[]})},w=()=>{t.push("/library/preview?id="+u.value)},I=()=>{a.value=!1};return r({open:x}),(y,v)=>{const k=X,S=we,b=le("viewer");return s(),z(S,{class:"library-info-alert",open:a.value,"onUpdate:open":v[0]||(v[0]=c=>a.value=c),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:H(()=>[o("span",{class:"close-btn",onClick:I},[R(C(Te))])]),default:H(()=>[o("div",es,[o("div",ts,[(s(!0),i(N,null,D(e.value,c=>(s(),i("div",{class:E(["file-item",{active:u.value==c.id}]),key:c.id,onClick:B=>g(c)},h(c.file_name),11,ss))),128))]),o("div",os,[(s(!0),i(N,null,D(n.value,c=>(s(),i("div",{class:"document-item",key:c.id},[o("div",is,[o("div",ns,[o("span",as,"id："+h(c.id),1),c.title?(s(),i("span",ls,h(c.title),1)):L("",!0),o("span",cs," 共"+h(c.word_total)+"个字符 ",1)]),o("div",{class:"right-box"},[o("a",{onClick:w},"查看源文档>")])]),o("div",rs,[o("div",ds,[v[1]||(v[1]=U(" 相似度： ",-1)),R(k,{name:"similarity",style:{"font-size":"16px"}}),U(h(c.similarity),1)]),c.question?(s(),i("div",_s,"Q："+h(c.question),1)):L("",!0),c.answer?(s(),i("div",us,"A："+h(c.answer),1)):L("",!0),o("div",hs,h(c.content),1),ce((s(),i("div",ps,[(s(!0),i(N,null,D(c.images,(B,A)=>(s(),i("img",{key:A,src:B,alt:""},null,8,vs))),128))])),[[b]])])]))),128))])])]),_:1},8,["open"])}}},fs=P(ms,[["__scopeId","data-v-3e30a1b1"]]),gs={key:0,class:"chat-box-warpper"},ys={class:"chat-box-header"},ks={class:"nickname"},bs={class:"chat-source"},Ls={class:"chat-box-content"},xs={key:1},Ts={__name:"chat-box",setup(d,{expose:r}){const t=Y(),{activeChat:a}=W(t),e=$(null),u=()=>{e.value.scrollToBottom()},m=()=>{e.value.scrollToTop()},x=$(null),g=(n,f)=>{x.value.open(n,f)};return r({scrollToTop:m,scrollToBottom:u}),(n,f)=>(s(),i(N,null,[C(a)?(s(),i("div",gs,[o("div",ys,[o("div",ks,h(C(a).name||C(a).nickname),1),o("div",bs," 来自："+h(C(a).come_from.robot_name)+" - "+h(C(a).come_from.app_name),1)]),o("div",Ls,[R(Zt,{ref_key:"chatMessageRef",ref:e,onOpenLibrary:g},null,512)])])):(s(),i("div",xs)),R(fs,{ref_key:"libraryInfoAlertRef",ref:x},null,512)],64))}},ws=P(Ts,[["__scopeId","data-v-1d47d849"]]),Ss={class:"chat-monitor-page"},Cs={class:"page-left"},$s={class:"app-list-box"},Ms={class:"search-box"},Rs={class:"chat-list-wrapper"},Is={class:"page-body"},Ns={__name:"index",setup(d){const r=de(),t=Y(),{init:a,changeRobot:e,switchChat:u,closeIM:m}=t,{robotList:x,selectedRobotId:g,activeChat:n}=W(t),f=$(null),w=$(null),I=$(""),y=()=>{const b={keyword:I.value,page:1};e(b)},v=async b=>{var c;await u(b),(c=w.value)==null||c.scrollToBottom()},k=()=>{J(()=>{var b;(b=w.value)==null||b.scrollToBottom()})},S=()=>{const b={keyword:I.value,page:1};f.value&&f.value.getData(b)};return ne(async()=>{await a(),J(()=>{var b;(b=w.value)==null||b.scrollToBottom()}),r.on("onAddMessage",k)}),ae(()=>{r.off("onAddMessage",k),m()}),(b,c)=>{const B=Se,A=Ce,T=$e;return s(),i("div",Ss,[o("div",Cs,[o("div",$s,[R(A,{value:C(g),"onUpdate:value":c[0]||(c[0]=p=>re(g)?g.value=p:null),style:{width:"100%"},onChange:y},{default:H(()=>[R(B,{value:""},{default:H(()=>[...c[2]||(c[2]=[U("全部应用",-1)])]),_:1}),(s(!0),i(N,null,D(C(x),p=>(s(),z(B,{value:p.id,key:p.id},{default:H(()=>[o("span",null,h(p.robot_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),o("div",Ms,[R(T,{value:I.value,"onUpdate:value":c[1]||(c[1]=p=>I.value=p),placeholder:"搜索客户昵称或openld，按enter搜索","enter-button":"",style:{width:"100%"},onSearch:S,allowClear:"",onPressEnter:S},null,8,["value"])]),o("div",Rs,[R(Qe,{ref_key:"chatListRef",ref:f,onSwitchChat:v},null,512)])]),o("div",Is,[C(n)?(s(),z(ws,{key:0,ref_key:"chatBoxRef",ref:w},null,512)):(s(),z(_e,{key:1,style:{background:"#F2F4F7"},size:"250"},{default:H(()=>[...c[3]||(c[3]=[o("div",null,[o("p",null,"请在左侧列表先选择会话"),o("p",null,"通过本功能，可以实时查看机器人接待中的会话消息，监控机器人回复效果")],-1)])]),_:1}))])])}}},Es=P(Ns,[["__scopeId","data-v-c690c066"]]);export{Es as default};
