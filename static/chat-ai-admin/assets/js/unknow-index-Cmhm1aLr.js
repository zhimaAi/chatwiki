import{_ as Ae}from"./cu-scroll-BZZHijaV.js";import{u as xe}from"./robot-L7DXN4U8.js";import{d as R,O as Fe,q as Ge,J as Ee,B as ce,M as ie,bs as je,aL as Be,a4 as Je,k as $e,p as pe,x as qe,u as Pe,v as Qe,T as Ce,Z as ve,$ as fe,Q as Ie,ax as Ve,a as V,F as le,e as Se,ac as Me,Y as He,g as Xe,b as Ze,c as We,D as et,w as tt,a9 as nt,E as st}from"./ui-antd-D3ZAJ1Vq.js";import{ab as ne,aa as De,f as u,r as E,o as ot,w as Oe,Y as v,_ as i,a5 as e,k as n,a2 as s,F,a9 as te,u as G,a1 as A,G as x,a7 as z,e as W,j as at,ae as P,n as me,A as ke,ad as lt,aj as we,ak as be,a4 as _e,q as it}from"./vue-chunks-CXJTX1FC.js";import{b as H,d as ye,F as ut,aV as rt,aX as dt,aF as _t,h as mt}from"../../index-0TFHdij1.js";import{M as ge}from"./model-select-Dks01hRk.js";import{u as ct}from"./index-CzO53uhx.js";import{Z as pt,_ as Ue,$ as vt,a0 as ft}from"./index-DvPlhmYy.js";import{U as Le}from"./index-Bg9eldTV.js";import{u as Ye}from"./util-BwuffJOK.js";import{M as yt}from"./index-BMSQkwth.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-yZpnICoG.js";import"./index-B551IHpY.js";import"./index-BAHM4xhG.js";const gt={class:"zm-date"},kt={class:"date-btn"},wt={class:"date-content"},ze={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(j,{emit:T}){const $=ne().query,q=De(),a=j,g=u(1),r=T;let c=E([{label:"今日",value:!0,key:2,start_date:R().startOf("day"),end_date:R().endOf("day")},{label:"昨日",value:!1,key:3,start_date:R().subtract(1,"day").startOf("day"),end_date:R().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:R().subtract(6,"day").startOf("day"),end_date:R().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:R().startOf("month").startOf("day"),end_date:R().endOf("day")}]);const l=u(null),I=u(null),O=u([]),S=f=>f>=R().subtract(0,"day"),M=()=>{let f=g.value,o=null;c.forEach(d=>{d.key==f&&(o=d)}),O.value=[o.start_date,o.end_date],l.value=o.start_date.startOf("day").format("YYYYMMDD"),I.value=o.end_date.endOf("day").format("YYYYMMDD"),L()},U=(f,o)=>{l.value=f[0].startOf("day").format("YYYYMMDD"),I.value=f[1].endOf("day").format("YYYYMMDD"),g.value=5,L()},L=()=>{r("dateChange",{start_time:l.value,end_time:I.value})};return ot(()=>{$.start_date&&$.end_date?(g.value=5,O.value=[R($.start_date),R($.end_date)],l.value=R($.start_date).format("YYYYMMDD"),I.value=R($.end_date).format("YYYYMMDD"),L(),setTimeout(()=>{q.push({path:q.path,query:{id:$.id,robot_key:$.robot_key}})},400)):(g.value=parseInt(a.datekey),M())}),Oe(()=>a.datekey,(f,o)=>{g.value=parseInt(a.datekey.split("-")[0]),M()}),(f,o)=>{const d=Fe,k=Ge,b=Ee;return i(),v("div",gt,[e("div",kt,[n(k,{value:g.value,"onUpdate:value":o[0]||(o[0]=D=>g.value=D),onChange:M},{default:s(()=>[(i(!0),v(F,null,te(G(c),D=>(i(),A(d,{class:"date-btn-button",value:D.key,key:D.key},{default:s(()=>[x(z(D.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",wt,[n(b,{value:O.value,"onUpdate:value":o[1]||(o[1]=D=>O.value=D),onChange:U,format:"YYYY-MM-DD",disabledDate:S,allowClear:!1},null,8,["value"])])])}}},bt={class:"ai-generate-wrapper"},ht={class:"form-box-wrapper ai-generate-wrapper-box"},xt={class:"ai-generate-wrapper-left"},$t={class:"form-box-wrapper-options"},qt={class:"form-item flex1"},Ct={class:"form-content"},It={class:"form-item generate-btn-box"},St={key:0,class:"progress-box"},Mt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(j,{expose:T,emit:$}){const q=u(10),a=u(!1),g=u(!1),r=E({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),c=j,l=$,I=u(!1),O=()=>{I.value=!0},S=()=>{a.value=!1},M=async()=>{var N;g.value=!0;try{let _={library_id:(N=c.detailsInfo)==null?void 0:N.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count};I.value=!1,a.value=!0,k()}finally{g.value=!1}},U=u(!1),L=u(!1);let f=null;const o=W(()=>q.value>=100?"success":"active"),d=W(()=>({"0%":"#108ee9","100%":"#87d068"})),k=()=>{U.value=!0,L.value=!1,q.value=0,f=setInterval(()=>{q.value<100?(q.value+=Math.floor(Math.random()*10)+1,q.value>100&&(q.value=100)):(clearInterval(f),U.value=!1,L.value=!0)},800)},b=()=>{l("handleDownload")},D=N=>{if(U.value)return N.preventDefault(),N.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return at(()=>{clearInterval(f),window.removeEventListener("beforeunload",D)}),T({showModal:O,hideModal:S}),(N,_)=>{const B=ye,p=ce,m=ie,C=je,Q=Be;return i(),v("div",null,[n(m,{open:I.value,"onUpdate:open":_[2]||(_[2]=K=>I.value=K),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:s(()=>_[4]||(_[4]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])),footer:s(()=>_[7]||(_[7]=[])),default:s(()=>[e("div",bt,[e("div",ht,[e("div",xt,[e("div",$t,[e("div",qt,[_[5]||(_[5]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",Ct,[n(ge,{modelType:"LLM",modeName:r.use_model,"onUpdate:modeName":_[0]||(_[0]=K=>r.use_model=K),modeId:r.model_config_id,"onUpdate:modeId":_[1]||(_[1]=K=>r.model_config_id=K)},null,8,["modeName","modeId"])])])]),e("div",It,[n(p,{onClick:M,loading:g.value,class:"generate-btn"},{default:s(()=>[n(B,{name:"ai-generate-white",style:{"font-size":"16px"}}),_[6]||(_[6]=x(" 开始总结 "))]),_:1,__:[6]},8,["loading"])])])])])]),_:1},8,["open"]),n(m,{open:a.value,"onUpdate:open":_[3]||(_[3]=K=>a.value=K),title:"生成数据",footer:null,width:746},{default:s(()=>[q.value<100?(i(),v("div",St,[n(C,{type:"circle",percent:q.value,status:o.value,"stroke-color":d.value},null,8,["percent","status","stroke-color"]),_[8]||(_[8]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(i(),A(Q,{key:1,status:"success",title:"生成完成"},{subTitle:s(()=>_[9]||(_[9]=[x(" 您可以去未知问题总结中下载生成的数据 ")])),extra:s(()=>[n(p,{onClick:b,type:"primary"},{default:s(()=>_[10]||(_[10]=[x("去下载")])),_:1,__:[10]})]),_:1}))]),_:1},8,["open"])])}}},Dt=H(Mt,[["__scopeId","data-v-a09ccd43"]]),Ot={class:"list-wrapper"},Ut={class:"content-wrapper"},Lt={class:"tip-icon"},Yt={class:"search-block"},zt={key:0},Nt={key:1},Tt={__name:"index",setup(j){const T=ne().query,$=u(1),q=u([]),a=E({robot_id:T.id,start_day:"",end_day:"",page:1,size:10,total:0}),g=u(null),r=M=>{a.page=M.current,a.size=M.pageSize,O()},c=()=>{a.page=1,O()},l=()=>{$.value=2,g.value&&g.value.hideModal()},I=M=>{a.start_day=M.start_time,a.end_day=M.end_time,c()},O=()=>{ct({...a}).then(M=>{let U=M.data.list;q.value=U,a.total=+M.data.total})},S=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(M,U)=>{const L=$e,f=pe,o=qe;return i(),v(F,null,[e("div",Ot,[e("div",Ut,[n(L,{"show-icon":"",class:"alert-box"},{icon:s(()=>[e("div",Lt,[n(G(Je))])]),message:s(()=>U[0]||(U[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])),_:1}),e("div",Yt,[n(ze,{datekey:"4",onDateChange:I})]),n(o,{class:"table-list",columns:S,"data-source":q.value,pagination:{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:r},{bodyCell:s(({column:d,record:k})=>[d.key==="question"?(i(),v(F,{key:0},[k.question.length>100?(i(),v("div",zt,[n(f,{overlayClassName:"search-content-tip",placement:"top"},{title:s(()=>[x(z(k.question),1)]),default:s(()=>[e("div",null,z(k.question.slice(0,100)+"..."),1)]),_:2},1024)])):(i(),v("div",Nt,z(k.question),1))],64)):P("",!0)]),_:1},8,["data-source","pagination"])])]),n(Dt,{ref_key:"aiGenerateRef",ref:g,onHandleDownload:l},null,512)],64)}}},Kt=H(Tt,[["__scopeId","data-v-9638ffbb"]]),Rt={class:"custom-modal-header"},At={key:1},Ft={key:2},Gt={class:"form-box-wrapper"},Et={class:"form-item"},jt={class:"form-content"},Bt={class:"form-item"},Jt={class:"form-content"},Pt={class:"form-item"},Qt={class:"form-content"},Vt={class:"form-item"},Ht={class:"form-label-box"},Xt={class:"form-content"},Zt={class:"form-item"},Wt={class:"form-content"},en={key:0,class:"error-tip"},tn={class:"form-item"},nn={class:"form-content"},sn={class:"upload-box-wrapper"},on={key:0},an={class:"ai-generate-wrapper"},ln={class:"form-box-wrapper ai-generate-wrapper-box"},un={class:"ai-generate-wrapper-left"},rn={class:"form-box-wrapper-options"},dn={class:"form-item flex1"},_n={class:"form-content"},mn={class:"form-item flex1"},cn={class:"form-content dual-inputs"},pn={class:"input-group"},vn={class:"form-label-input-box"},fn={class:"form-box-wrapper-content"},yn={class:"problem-box"},gn={class:"problem-content"},kn={class:"problem-box"},wn={class:"problem-content"},bn={class:"form-item generate-btn-box"},hn={class:"result-nav"},xn={key:0,class:"tip"},$n={key:1,class:"result-nav-text"},qn={key:0,class:"container"},Cn={class:"result-container"},In=["innerHTML"],Sn={class:"result-footer"},Mn={__name:"import-library-modal",emits:["ok"],setup(j,{expose:T,emit:$}){const q=u(!1),a=u(!1),g=u(!1),r=u(!1),c=u(!1),l=E({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),I=new yt({html:!0,linkify:!0,typographer:!0}),O=u(""),S=E({finish:"",content:""});Oe(()=>S.content,()=>{O.value=I.render(S.content)});const M=$,U=u("1"),L=u(!1),f=u(""),o=u(""),d=u(""),k=u(""),b=u(""),D=u([]),N=u(""),_=u("0"),B=u([]),p=()=>{ut({type:2}).then(h=>{_.value="0",B.value=h.data||[]})};p();const m=()=>{K()},C=h=>{var t;p(),a.value=!1,g.value=!1,c.value=!1,f.value="",o.value="",N.value=h.id||"",d.value=h.answer||"",D.value=h.images||[],k.value=h.question||"",b.value=h.similar_questions?h.similar_questions.join(`
`):"",_.value=h.group_id||"0",l.library_id=h.library_id||"",l.library_id||(l.library_id=(t=B.value[0])==null?void 0:t.id),K(),L.value=!0},Q=u([]),K=()=>{_t({library_id:l.library_id}).then(h=>{Q.value=h.data||[]})},ee=()=>{if(oe(),!k.value)return V.error("请输入分段问题");if(!d.value)return V.error("请输入分段答案");if(d.value.length>1e4)return;let h={title:f.value,content:o.value,question:k.value,answer:d.value,images:D.value,library_id:l.library_id};h.group_id=_.value||0;let t=b.value.trim();t?(t=t.split(`
`),h.similar_questions=JSON.stringify(t)):h.similar_questions="[]";let y=new FormData;for(let Y in h)Ye.isArray(h[Y])?h[Y].forEach(J=>{y.append(Y,J)}):y.append(Y,h[Y]);dt(y).then(Y=>{pt({id:N.value,to_library_id:l.library_id}).then(J=>{V.success("导入成功"),L.value=!1,M("ok")})})},se=()=>{if(!l.library_id)return V.error("请选择知识库");a.value=!0},X=u(""),ue=async()=>{S.content="",X.value="",r.value=!0,c.value=!0;try{let h={library_id:l.library_id,model_config_id:l.model_config_id,use_model:l.use_model,num:l.count,question:k.value,answer:d.value};const t=await rt(h);X.value=t.data.map(y=>y).join(`
`),S.content=t.data.map((y,Y)=>`<div class="dialog-message">${Y+1}. ${y}</div>`).join(""),g.value=!0}finally{r.value=!1}},re=()=>{b.value?b.value+=`
${X.value}`:b.value+=X.value,V.success("保存成功"),g.value=!1,a.value=!1,c.value=!1};function Z(h){return h.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const oe=()=>{b.value=Z(b.value)};return T({showModal:C}),(h,t)=>{const y=ce,Y=Qe,J=Pe,de=Ce,ae=ye,Ne=fe,Te=ve,Ke=Ie,Re=ie;return i(),v("div",null,[n(Re,{open:L.value,"onUpdate:open":t[12]||(t[12]=w=>L.value=w),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:a.value?c.value?"944px":"472px":"746px","ok-button-props":{style:{display:a.value?"none":"block"}}},{title:s(()=>[e("div",Rt,[a.value?(i(),A(y,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=w=>a.value=!1)},{icon:s(()=>[n(G(Ve),{style:{"font-size":"12px"}})]),_:1})):P("",!0),a.value?(i(),v("span",At,"AI生成相似问法")):(i(),v("span",Ft,"导入知识库"))])]),footer:s(()=>[a.value?P("",!0):(i(),v(F,{key:0},[n(y,{onClick:t[11]||(t[11]=w=>L.value=!1)},{default:s(()=>t[30]||(t[30]=[x("取消")])),_:1,__:[30]}),n(y,{type:"primary",onClick:ee},{default:s(()=>t[31]||(t[31]=[x("确定")])),_:1,__:[31]})],64))]),default:s(()=>[me(e("div",Gt,[e("div",Et,[t[13]||(t[13]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",jt,[n(J,{onChange:m,value:l.library_id,"onUpdate:value":t[1]||(t[1]=w=>l.library_id=w),style:{width:"100%"},placeholder:"请选择"},{default:s(()=>[(i(!0),v(F,null,te(B.value,w=>(i(),A(Y,{value:w.id,key:w.id},{default:s(()=>[x(z(w.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Bt,[t[14]||(t[14]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",Jt,[n(J,{value:_.value,"onUpdate:value":t[2]||(t[2]=w=>_.value=w),style:{width:"100%"}},{default:s(()=>[(i(!0),v(F,null,te(Q.value,w=>(i(),A(Y,{value:w.id},{default:s(()=>[x(z(w.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",Pt,[t[15]||(t[15]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",Qt,[n(de,{placeholder:"请输入分段问题",value:k.value,"onUpdate:value":t[3]||(t[3]=w=>k.value=w),style:{height:"100px"}},null,8,["value"])])]),e("div",Vt,[e("div",Ht,[t[17]||(t[17]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:se},[n(ae,{name:"ai-generate",style:{"font-size":"14px"}}),t[16]||(t[16]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",Xt,[n(de,{placeholder:"请输入相似问法",value:b.value,"onUpdate:value":t[4]||(t[4]=w=>b.value=w),style:{height:"100px"},onBlur:oe},null,8,["value"]),t[18]||(t[18]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",Zt,[t[19]||(t[19]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",Wt,[n(de,{placeholder:"请输入分段答案",value:d.value,"onUpdate:value":t[5]||(t[5]=w=>d.value=w),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),d.value.length>1e4?(i(),v("div",en,"分段答案最多支持10000个字符")):P("",!0)])]),e("div",tn,[t[21]||(t[21]=e("div",{class:"form-label"},"附件",-1)),e("div",nn,[e("div",sn,[n(Te,{activeKey:U.value,"onUpdate:activeKey":t[6]||(t[6]=w=>U.value=w),size:"small"},{default:s(()=>[n(Ne,{key:"1"},{tab:s(()=>[e("span",null,[n(ae,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[20]||(t[20]=x(" 图片 ")),D.value.length?(i(),v("span",on,"("+z(D.value.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Le,{value:D.value,"onUpdate:value":t[7]||(t[7]=w=>D.value=w)},null,8,["value"])])])])],512),[[ke,!a.value]]),me(e("div",an,[e("div",ln,[e("div",un,[e("div",rn,[e("div",dn,[t[22]||(t[22]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",_n,[n(ge,{modelType:"LLM",modeName:l.use_model,"onUpdate:modeName":t[8]||(t[8]=w=>l.use_model=w),modeId:l.model_config_id,"onUpdate:modeId":t[9]||(t[9]=w=>l.model_config_id=w)},null,8,["modeName","modeId"])])]),e("div",mn,[e("div",cn,[e("div",pn,[t[24]||(t[24]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",vn,[n(Ke,{value:l.count,"onUpdate:value":t[10]||(t[10]=w=>l.count=w),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[23]||(t[23]=x("个 "))])])])])]),e("div",fn,[e("div",yn,[t[25]||(t[25]=e("div",{class:"problem"},"问题",-1)),e("div",gn,z(k.value),1)]),e("div",kn,[t[26]||(t[26]=e("div",{class:"problem"},"答案",-1)),e("div",wn,z(d.value),1)])]),e("div",bn,[n(y,{onClick:ue,loading:r.value,class:"generate-btn"},{default:s(()=>[n(ae,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[27]||(t[27]=x(" 开始生成 "))]),_:1,__:[27]},8,["loading"])])]),e("div",{class:lt(["ai-generate-wrapper-right",{"show-result":c.value}])},[e("div",hn,[n(ae,{name:"generate-icon",style:{"font-size":"14px"}}),r.value?(i(),v("span",xn,"相似问法生成中...")):(i(),v("div",$n,"相似问法生成完毕"))]),!S.content&&r.value&&!q.value?(i(),v("div",qn,t[28]||(t[28]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)]))):P("",!0),e("div",Cn,[e("div",{class:"dialog-content",innerHTML:O.value},null,8,In)]),e("div",Sn,[n(y,{class:"result-footer-btn",type:"primary",onClick:re},{default:s(()=>t[29]||(t[29]=[x("保存相似问法")])),_:1,__:[29]})])],2)])],512),[[ke,a.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Dn=H(Mn,[["__scopeId","data-v-efbb0fd6"]]),On={class:"form-box"},Un={__name:"auto-cluster-modal",emits:["ok"],setup(j,{expose:T,emit:$}){const q=$,a=ne().query,g=u(!1),r=E({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:a.id}),c=le.useForm;u(!1);const l=f=>{r.unknown_summary_model_config_id=f.unknown_summary_model_config_id||"",r.unknown_summary_use_model=f.unknown_summary_use_model||"",r.unknown_summary_similarity=f.unknown_summary_similarity||"",r.unknown_summary_status=f.unknown_summary_status||"",g.value=!0},I=E({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:O,validateInfos:S}=c(r,I),M=f=>{f.length},U=()=>{O().then(()=>{L()}).catch(f=>{})},L=()=>{Ue({...r}).then(f=>{V.success("保存成功"),g.value=!1,q("ok")})};return T({show:l}),(f,o)=>{const d=Se,k=pe,b=Ie,D=le,N=ie;return i(),v("div",null,[n(N,{open:g.value,"onUpdate:open":o[3]||(o[3]=_=>g.value=_),title:"自动聚类设置",onOk:U},{default:s(()=>[e("div",On,[n(D,{layout:"vertical"},{default:s(()=>[n(d,we(be(G(S).unknown_summary_model_config_id)),{label:s(()=>o[4]||(o[4]=[x("请设置使用的向量模型 ")])),default:s(()=>[n(ge,{modelType:"TEXT EMBEDDING",modeName:r.unknown_summary_use_model,"onUpdate:modeName":o[0]||(o[0]=_=>r.unknown_summary_use_model=_),modeId:r.unknown_summary_model_config_id,"onUpdate:modeId":o[1]||(o[1]=_=>r.unknown_summary_model_config_id=_),onLoaded:M,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),n(d,we(be(G(S).unknown_summary_similarity)),{label:s(()=>[o[6]||(o[6]=x("相似度阈值 ")),n(k,null,{title:s(()=>o[5]||(o[5]=[x("语意相似度大于指定阈值的问题会自动聚类")])),default:s(()=>[n(G(Me),{class:"ml4"})]),_:1})]),default:s(()=>[n(b,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:r.unknown_summary_similarity,"onUpdate:value":o[2]||(o[2]=_=>r.unknown_summary_similarity=_),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},Ln=H(Un,[["__scopeId","data-v-3a707038"]]),Yn={class:"form-box"},zn={class:"upload-box-wrapper"},Nn={key:0},Tn={__name:"set-answer-modal",emits:["ok"],setup(j,{expose:T,emit:$}){const q=$,a=ne().query,g=u("1"),r=u(!1),c=E({id:a.id,question:"",unknown_list:"",answer:"",images:[]}),l=le.useForm,I=u(!1),O=o=>{Object.assign(c,JSON.parse(JSON.stringify(o))),r.value=!0},S=E({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:M,validateInfos:U}=l(c,S),L=()=>{M().then(()=>{f()}).catch(o=>{})},f=()=>{let o={...c},d=o.unknown_list.trim();d?(d=d.split(`
`),o.unknown_list=JSON.stringify(d)):o.unknown_list="[]";let k=new FormData;for(let b in o)Ye.isArray(o[b])?o[b].forEach(D=>{k.append(b,D)}):k.append(b,o[b]);I.value=!0,vt(k).then(b=>{V.success("保存成功"),r.value=!1,q("ok")}).finally(()=>{I.value=!1})};return T({show:O}),(o,d)=>{const k=Ce,b=Se,D=ye,N=fe,_=ve,B=Le,p=le,m=ie;return i(),v("div",null,[n(m,{open:r.value,"onUpdate:open":d[5]||(d[5]=C=>r.value=C),title:"设置答案",onOk:L,width:746,confirmLoading:I.value},{default:s(()=>[e("div",Yn,[n(p,{layout:"vertical"},{default:s(()=>[n(b,_e({label:"问题"},G(U).question),{default:s(()=>[n(k,{placeholder:"请输入问题",value:c.question,"onUpdate:value":d[0]||(d[0]=C=>c.question=C),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,_e({label:"相似问法(一行一个，最多可添加100个相似问法)"},G(U).unknown_list),{default:s(()=>[n(k,{placeholder:"请输入相似问法",value:c.unknown_list,"onUpdate:value":d[1]||(d[1]=C=>c.unknown_list=C),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,_e({label:"答案"},G(U).answer),{default:s(()=>[n(k,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":d[2]||(d[2]=C=>c.answer=C),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,{label:"附件"},{default:s(()=>[e("div",zn,[n(_,{activeKey:g.value,"onUpdate:activeKey":d[3]||(d[3]=C=>g.value=C),size:"small"},{default:s(()=>[n(N,{key:"1"},{tab:s(()=>[e("span",null,[n(D,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),d[6]||(d[6]=x(" 图片 ")),c.images.length?(i(),v("span",Nn,"("+z(c.images.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(B,{value:c.images,"onUpdate:value":d[4]||(d[4]=C=>c.images=C)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Kn=H(Tn,[["__scopeId","data-v-a5711fe0"]]),Rn={class:"user-model-page"},An={class:"search-block"},Fn={class:"left-block"},Gn={class:"right-block"},En={class:"list-box"},jn={class:"qa-list-box"},Bn={class:"list-item"},Jn={class:"list-content"},Pn={class:"classify-scroll-box"},Qn={key:0,class:"list-item"},Vn={class:"list-content"},Hn={class:"fragment-img"},Xn=["src"],Zn={class:"import-td-box"},Wn={key:0,class:"status-block success"},es={key:1,class:"status-block none"},ts=["href"],ns=["onClick"],ss=["onClick"],os={__name:"index",setup(j){const T=mt(),$=xe(),{getRobot:q}=$,a=W(()=>$.robotInfo),g=W(()=>a.value.unknown_summary_status==1),r=ne().query;De(),u(2);const c=E({start_day:"",end_day:""}),l=E({page:1,size:10,total:0}),I=u([]),O=u(!1),S=()=>{let p={robot_id:r.id,...c,...l};O.value=!0,ft({...p}).then(m=>{I.value=m.data.list.map(C=>({...C,images:C.images?JSON.parse(C.images):[],unknown_list:C.unknown_list?JSON.parse(C.unknown_list):[]})),l.total=+m.data.total||0}).finally(()=>{O.value=!1})};S();const M=p=>{let m=T.getToken,C=c.start_day,Q=c.end_day,K=`/manage/getUnknownIssueSummary?robot_id=${r.id}&token=${m}&start_day=${C}&end_day=${Q}&export=${p}`;window.location.href=K},U=p=>{l.page=p.current,l.size=p.pageSize,S()},L=()=>{l.page=1,S()},f=p=>{c.start_day=p.start_time,c.end_day=p.end_time,L()},o=u(null),d=p=>{o.value.showModal({id:p.id,library_id:p.to_library_id>0?p.to_library_id:"",answer:p.answer,question:p.question,similar_questions:p.unknown_list,images:p.images})},k=u(null),b=()=>{k.value.show({unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:a.value.unknown_summary_status})},D=p=>{p?k.value.show({unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:1}):Ue({id:r.id,unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:0}).then(m=>{V.success("保存成功"),q(r.id)})},N=u(null),_=p=>{N.value.show({id:p.id,question:p.question,answer:p.answer,unknown_list:p.unknown_list.join(`
`),images:p.images})},B=()=>{q(r.id)};return(p,m)=>{const C=$e,Q=pe,K=He,ee=ce,se=We,X=Ze,ue=et,re=nt,Z=tt,oe=st,h=qe,t=it("viewer");return i(),v("div",Rn,[n(C,{"show-icon":"",style:{"padding-top":"16px"}},{message:s(()=>m[2]||(m[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])),_:1}),e("div",An,[e("div",Fn,[m[5]||(m[5]=e("span",null,"自动聚类",-1)),n(Q,null,{title:s(()=>m[3]||(m[3]=[x("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题")])),default:s(()=>[n(G(Me)),m[4]||(m[4]=x("： "))]),_:1,__:[4]}),n(K,{onChange:D,checked:g.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:b},"设置")]),e("div",Gn,[n(ze,{datekey:"4",onDateChange:f}),n(ee,{type:"primary",onClick:L},{default:s(()=>m[6]||(m[6]=[x("查询")])),_:1,__:[6]}),n(ue,null,{overlay:s(()=>[n(X,null,{default:s(()=>[n(se,{onClick:m[0]||(m[0]=y=>M("docx")),key:"1"},{default:s(()=>m[7]||(m[7]=[x("下载为docx")])),_:1,__:[7]}),n(se,{onClick:m[1]||(m[1]=y=>M("xlsx")),key:"2"},{default:s(()=>m[8]||(m[8]=[x("下载为xlsx")])),_:1,__:[8]})]),_:1})]),default:s(()=>[n(ee,{type:"primary"},{default:s(()=>[m[9]||(m[9]=x(" 下载 ")),n(G(Xe))]),_:1,__:[9]})]),_:1})])]),e("div",En,[n(h,{"data-source":I.value,loading:O.value,pagination:{current:l.page,total:l.total,pageSize:l.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:U},{default:s(()=>[n(Z,{key:"question",title:"聚类问题",width:480},{default:s(({record:y})=>[e("div",jn,[e("div",Bn,[m[10]||(m[10]=e("div",{class:"list-label"},"问题",-1)),e("div",Jn,[x(z(y.question)+" ",1),y.unknown_total>0?(i(),A(re,{key:0,placement:"topLeft"},{content:s(()=>[e("div",Pn,[(i(!0),v(F,null,te(y.unknown_list,(Y,J)=>(i(),v("div",{class:"list-item",key:J},z(Y),1))),128))])]),title:s(()=>[e("span",null,"共聚类了"+z(y.unknown_total)+"个未知问题",1)]),default:s(()=>[e("a",null,"（"+z(y.unknown_total)+"） ",1)]),_:2},1024)):P("",!0)])]),y.answer?(i(),v("div",Qn,[m[11]||(m[11]=e("div",{class:"list-label"},"答案",-1)),e("div",Vn,z(y.answer),1)])):P("",!0),me((i(),v("div",Hn,[(i(!0),v(F,null,te(y.images,(Y,J)=>(i(),v("img",{key:J,src:Y,alt:""},null,8,Xn))),128))])),[[t]])])]),_:1}),n(Z,{key:"show_date",title:"触发日期",width:120},{default:s(({record:y})=>[x(z(y.show_date),1)]),_:1}),n(Z,{key:"to_library_id",title:"是否导入知识库",width:160},{default:s(({record:y})=>[e("div",Zn,[y.to_library_id>0?(i(),v("div",Wn,m[12]||(m[12]=[e("span",null,null,-1),x(" 已导入 ")]))):(i(),v("div",es,m[13]||(m[13]=[e("span",null,null,-1),x(" 未导入 ")]))),e("a",{href:`/#/library/details/knowledge-document?id=${y.to_library_id}`,target:"_blank"},z(y.to_library_name),9,ts)])]),_:1}),n(Z,{key:"action",title:"操作",width:135},{default:s(({record:y})=>[n(oe,{gap:8},{default:s(()=>[e("a",{onClick:Y=>_(y)},"设置答案",8,ns),e("a",{onClick:Y=>d(y)},"导入知识库",8,ss)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),n(Dn,{onOk:S,ref_key:"importLibraryModalRef",ref:o},null,512),n(Ln,{onOk:B,ref_key:"autoClusterModalRef",ref:k},null,512),n(Kn,{onOk:S,ref_key:"setAnswerModalRef",ref:N},null,512)])}}},as=H(os,[["__scopeId","data-v-993551f2"]]),ls={class:"user-model-page"},he="/robot/config/unknown_issue/activeKey",is={__name:"unknow-index",setup(j){const T=xe(),$=u(+localStorage.getItem(he)||1),q=W(()=>T.robotInfo),a=W(()=>q.value.unknown_summary_status==1),g=()=>{localStorage.setItem(he,$.value)};return(r,c)=>{const l=fe,I=ve,O=Ae;return i(),v(F,null,[n(I,{class:"tab-wrapper",activeKey:$.value,"onUpdate:activeKey":c[0]||(c[0]=S=>$.value=S),onChange:g},{default:s(()=>[a.value?(i(),v(F,{key:0},[(i(),A(l,{key:2,tab:"未知问题总结"})),(i(),A(l,{key:1,tab:"未知问题统计"}))],64)):(i(),v(F,{key:1},[(i(),A(l,{key:1,tab:"未知问题统计"})),(i(),A(l,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",ls,[n(O,null,{default:s(()=>[$.value==1?(i(),A(Kt,{key:0})):(i(),A(as,{key:1}))]),_:1})])],64)}}},$s=H(is,[["__scopeId","data-v-70d9105a"]]);export{$s as default};
