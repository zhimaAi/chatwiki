import{b as G,l as H,d as K,M as Q,a3 as W,k as U}from"../../index-D5kWFI_D.js";import{c as Y,e as ee}from"./index-DcKNDP5F.js";import{F as j,_ as te}from"./index-BtvIFvZE.js";import"./index-CfBC_gul.js";import{_ as ae,R as oe}from"./RadioButton-Dk1I9vb9.js";import{A as se}from"./index-sFmpGrIj.js";import{U as ne}from"./UserOutlined-CVK5NUUj.js";import{_ as le,C as ie}from"./index-wN8GK70L.js";import{b as re,d as u,z as A,N as d,O as i,j as n,U as s,X as r,a6 as v,Z as p,F,a1 as N,S as k,u as _e,_ as h}from"./vue-chunks-BRsu9_To.js";const de={class:"form-box"},ue={key:0,class:"form-tip"},pe={key:0,class:"list-box"},ce=["onClick"],ve={class:"user-block"},me={class:"name-box"},fe={class:"name"},ye={class:"remark-text"},ge={key:1,class:"checkbox-list"},ke={class:"checklist-item"},he={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(be,{expose:O,emit:S}){const b=re(()=>H().role_permission||[]),M=S,z=j.useForm,m=u(!1),l=A({identity_type:"1",operate_rights:"4"}),_=u([]),c=u([]),B=a=>{a.role_type!=1&&(_.value.includes(a.id)?_.value=_.value.filter(e=>e!=a.id):_.value.push(a.id))},V=A({}),{resetFields:xe,validate:Ce,validateInfos:Le}=z(l,V);let f=[],y=[];const q=(a,e)=>{P(),_.value=[],c.value=[],y=[],a.forEach(o=>{o.identity_type==1&&y.push(o.identity_id),o.identity_type==2&&c.value.push(o.identity_id)}),I(),l.operate_rights="4",l.identity_type="1",f=e,m.value=!0},g=u(!1),D=()=>{f=f.map(o=>({object_id:+o.object_id,object_type:+o.object_type,operate_rights:+l.operate_rights}));let a=[];if(l.identity_type==1?a=_.value:a=c.value,a.length==0){U.error("请选择成员或成员组织");return}let e={identity_type:l.identity_type,object_array:JSON.stringify(f),identity_ids:a.join(",")};g.value=!0,ee(e).then(o=>{U.success("保存成功"),m.value=!1,M("ok")}).finally(()=>{g.value=!1})},x=u([]),I=()=>{W({page:1,size:200}).then(a=>{x.value=a.data.list.filter(e=>!y.includes(e.id))})},C=u([]),P=()=>{Y().then(a=>{let e=a.data||[];C.value=e})},R=()=>{window.open("/#/user/manage")};return O({show:q}),(a,e)=>{const o=oe,L=ae,w=te,E=se,T=K,$=ie,J=le,X=j,Z=Q;return i(),d("div",null,[n(Z,{open:m.value,"onUpdate:open":e[3]||(e[3]=t=>m.value=t),title:"添加协作者",onOk:D,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:g.value},{default:s(()=>[r("div",de,[n(X,{layout:"vertical"},{default:s(()=>[n(w,{label:"协作权限",required:""},{default:s(()=>[n(L,{value:l.operate_rights,"onUpdate:value":e[0]||(e[0]=t=>l.operate_rights=t)},{default:s(()=>[n(o,{value:"4"},{default:s(()=>e[4]||(e[4]=[p("管理")])),_:1,__:[4]}),n(o,{value:"2"},{default:s(()=>e[5]||(e[5]=[p("编辑")])),_:1,__:[5]}),n(o,{value:"1"},{default:s(()=>e[6]||(e[6]=[p("查看")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),n(w,{label:"协作者",required:""},{default:s(()=>[n(L,{value:l.identity_type,"onUpdate:value":e[1]||(e[1]=t=>l.identity_type=t)},{default:s(()=>[n(o,{value:"1"},{default:s(()=>e[7]||(e[7]=[p("按成员选")])),_:1,__:[7]}),n(o,{value:"2"},{default:s(()=>e[8]||(e[8]=[p("按组织架构")])),_:1,__:[8]})]),_:1},8,["value"]),b.value&&b.value.includes("TeamManage")?(i(),d("div",ue,[e[9]||(e[9]=p(" 如果协作者没有账号，请先到团队管理中添加账号 ")),r("a",{onClick:R},"去添加")])):v("",!0)]),_:1}),l.identity_type==1?(i(),d("div",pe,[(i(!0),d(F,null,N(x.value,t=>(i(),d("div",{class:"type-item",key:t.value,onClick:we=>B(t)},[r("div",ve,[n(E,{shape:"square",src:t.avatar,size:40},{icon:s(()=>[t.avatar?v("",!0):(i(),k(_e(ne),{key:0}))]),_:2},1032,["src"]),r("div",me,[r("div",fe,h(t.user_name),1),r("div",ye,h(t.nick_name),1)])]),_.value.includes(t.id)?(i(),k(T,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],8,ce))),128))])):v("",!0),l.identity_type==2?(i(),d("div",ge,[n(J,{value:c.value,"onUpdate:value":e[2]||(e[2]=t=>c.value=t),style:{width:"100%"}},{default:s(()=>[r("div",ke,[(i(!0),d(F,null,N(C.value,t=>(i(),k($,{key:t.id,value:t.id},{default:s(()=>[r("div",null,h(t.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):v("",!0)]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Be=G(he,[["__scopeId","data-v-56afcf29"]]);export{Be as A};
