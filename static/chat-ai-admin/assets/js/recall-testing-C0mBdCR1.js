import{_ as O,bD as F,d as B,bE as H,aD as W}from"../../index-WMhSApoa.js";import{_ as J}from"./cu-scroll-D6f5DzhK.js";import{_ as K}from"./empty-DkpCLaix.js";import{aw as D,f as y,r as Q,e as I,o as A,ac as l,ad as i,as as e,az as u,k as a,ar as p,G as m,ae as q,u as b,F as R,ax as S,ai as G,at as _,av as P}from"./vue-chunks-CGLjTDrY.js";import{_ as j}from"./recommendation-AQ4_FPQ9.js";import{M as X}from"./model-select-DEPDrkCY.js";import{W as Y}from"./index-DfzSnOgM.js";import{$ as Z,B as ee,D as se,av as te,ah as M,v as oe,aF as ie,O as ne,Q as le,b as C,al as ae,bI as re}from"./ui-antd-BDReVt-O.js";import"./neo4j-CK9lNpyi.js";import"./utils-DXEytJvC.js";import"./other-BrZCAsTs.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./index-BafABkdm.js";const de={class:"recall-settings-box"},_e={class:"form-box"},ue={class:"form-item"},ce={class:"form-item-body"},me={class:"form-item"},ve={class:"form-item"},pe={class:"form-item-label"},fe={class:"form-item-body"},ye={class:"retrieval-mode-items"},ke=["onClick"],he={class:"retrieval-mode-title"},be={class:"title-text"},ge={key:0,style:{width:"32px"},src:j,alt:""},xe={class:"retrieval-mode-desc"},we={key:0,class:"form-item"},$e={class:"form-item"},qe={class:"form-item-label"},Re={class:"form-item-body"},Ne={class:"number-box"},ze={class:"number-slider-box"},Ce={class:"number-input-box"},Se={key:1,class:"form-item"},Te={class:"form-item-label"},Ue={class:"form-item-body"},Le={class:"number-box"},Me={class:"number-slider-box"},Oe={class:"number-input-box"},Be={class:"form-item"},De={class:"form-item-label"},Ie={class:"form-item-body"},Ve={__name:"recall-testing-form",emits:["save","load"],setup(V,{expose:N,emit:z}){const k=D(),v=y(!1),h=z,f=y(!0),g=y([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:k.query.id,rrf_weight:{vector:0,search:0,graph:0}}),c=I(()=>f.value?g.value.filter(d=>d.value==t.search_type):g.value),r=d=>{t.search_type=d},x=()=>{if(!t.similarity)return C.error("请输入相似度");if(!t.size)return C.error("请输入分段数");if(!t.question)return C.error("请输入测试问题");let d={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type,rrf_weight:JSON.stringify(t.rrf_weight)};t.rerank_status==1&&(d.rerank_model_config_id=t.rerank_model_config_id,d.rerank_use_model=t.rerank_use_model),v.value=!0,h("load"),H(d).then(s=>{h("save",s.data)}).catch(()=>{h("save",[])}).finally(()=>{v.value=!1})};return A(()=>{F().then(d=>{t.rrf_weight=d.data||{vector:0,search:0,graph:0}})}),N({open}),(d,s)=>{const n=Z,w=ee,$=B,T=oe,U=ie,L=ne,E=le;return i(),l("div",de,[s[18]||(s[18]=e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),e("div",_e,[e("div",ue,[e("div",ce,[a(n,{style:{height:"76px"},value:t.question,"onUpdate:value":s[0]||(s[0]=o=>t.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",me,[a(w,{loading:v.value,onClick:x,type:"primary",block:""},{default:p(()=>[...s[10]||(s[10]=[m("测试",-1)])]),_:1},8,["loading"])]),e("div",ve,[e("div",pe,[e("div",{class:"hover-label",onClick:s[1]||(s[1]=o=>f.value=!f.value)},[s[11]||(s[11]=m(" 检索模式 ",-1)),f.value?(i(),q(b(se),{key:0})):(i(),q(b(te),{key:1}))])]),e("div",fe,[e("div",ye,[(i(!0),l(R,null,S(c.value,o=>(i(),l("div",{class:G(["retrieval-mode-item",{active:t.search_type==o.value}]),key:o.value,onClick:ns=>r(o.value)},[t.search_type==o.value?(i(),q($,{key:0,class:"check-arrow",name:"check-arrow-filled"})):u("",!0),e("div",he,[a($,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",be,_(o.title),1),o.isRecommendation?(i(),l("img",ge)):u("",!0)]),e("div",xe,_(o.desc),1)],10,ke))),128))])])]),t.search_type==1?(i(),l("div",we,[a(Y,{rrf_weight:t.rrf_weight,"onUpdate:rrf_weight":s[2]||(s[2]=o=>t.rrf_weight=o)},null,8,["rrf_weight"])])):u("",!0),e("div",$e,[e("div",qe,[s[13]||(s[13]=e("span",null,"Top K ",-1)),a(T,null,{title:p(()=>[...s[12]||(s[12]=[m("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:p(()=>[a(b(M),{class:"question-icon"})]),_:1})]),e("div",Re,[e("div",Ne,[e("div",ze,[a(U,{class:"custom-slider",value:t.size,"onUpdate:value":s[3]||(s[3]=o=>t.size=o),min:1,max:500},null,8,["value"])]),e("div",Ce,[a(L,{value:t.size,"onUpdate:value":s[4]||(s[4]=o=>t.size=o),min:1,max:500},null,8,["value"])])])])]),t.search_type<=2?(i(),l("div",Se,[e("div",Te,[s[15]||(s[15]=e("span",null,"相似度阈值 ",-1)),a(T,null,{title:p(()=>[...s[14]||(s[14]=[m("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:p(()=>[a(b(M),{class:"question-icon"})]),_:1})]),e("div",Ue,[e("div",Le,[e("div",Me,[a(U,{class:"custom-slider",value:t.similarity,"onUpdate:value":s[5]||(s[5]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Oe,[a(L,{value:t.similarity,"onUpdate:value":s[6]||(s[6]=o=>t.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):u("",!0),e("div",Be,[e("div",De,[s[16]||(s[16]=e("span",null,"Rerank模型",-1)),s[17]||(s[17]=m("   ",-1)),a(E,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":s[7]||(s[7]=o=>t.rerank_status=o)},null,8,["checked"])]),e("div",Ie,[a(X,{modelType:"RERANK",modeName:t.rerank_use_model,"onUpdate:modeName":s[8]||(s[8]=o=>t.rerank_use_model=o),modeId:t.rerank_model_config_id,"onUpdate:modeId":s[9]||(s[9]=o=>t.rerank_model_config_id=o),style:{width:"320px"},placeholder:"请选择Rerank模型"},null,8,["modeName","modeId"])])])])])}}},Ee=O(Ve,[["__scopeId","data-v-25406e85"]]),Fe={class:"recall-testing-box"},He={class:"recall-from-box"},We={class:"content-list-box"},Je={key:0,class:"empty-box"},Ke={class:"top-block"},Qe={class:"title"},Ae={key:0,class:"ml4"},Ge={class:"info-block"},Pe=["onClick"],je={key:0},Xe={class:"gray-text"},Ye={key:0,class:"content-box"},Ze={key:1,class:"content-box similar-questions-box"},es={class:"similar-questions-list"},ss={key:2,class:"content-box"},ts=["innerHTML"],os={key:2,class:"loading-box"},is={__name:"recall-testing",setup(V){D(),P();const N=W(),z=y(!1),k=y(!1),v=y([]),h=I(()=>N.type),f=(c=[])=>{k.value=!1,c.forEach(r=>{r.similar_questions&&(r.similar_questions=JSON.parse(r.similar_questions))}),v.value=c||[]},g=()=>{k.value=!0},t=c=>{if(!c.file_name){window.open(`/#/library/details/categary-manage?id=${c.library_id}`);return}window.open(`/#/library/preview?id=${c.file_id}`)};return(c,r)=>{const x=J,d=B,s=ae;return i(),l("div",Fe,[e("div",He,[a(x,null,{default:p(()=>[a(Ee,{onLoad:g,onSave:f})]),_:1})]),e("div",We,[z.value||v.value.length===0?(i(),l("div",Je,[...r[0]||(r[0]=[e("img",{src:K,alt:""},null,-1),e("div",{class:"title"},"暂无结果，请重试",-1)])])):(i(),q(x,{key:1},{default:p(()=>[(i(!0),l(R,null,S(v.value,n=>(i(),l("div",{class:"list-item",key:n.id},[e("div",Ke,[e("div",Qe,[m(" id："+_(n.id)+" ",1),n.title?(i(),l("div",Ae,_(n.title),1)):u("",!0),e("span",null,"共"+_(n.word_total)+"个字符",1)])]),e("div",Ge,[r[2]||(r[2]=e("span",{class:"gray-text"},"来自：",-1)),e("div",{class:"link-text",onClick:w=>t(n)},[a(b(re)),m(" "+_(n.file_name)+" ",1),n.file_name?u("",!0):(i(),l("span",je,_(n.library_name)+"-精选",1))],8,Pe),r[3]||(r[3]=e("span",{class:"v-line"},null,-1)),e("span",Xe,[r[1]||(r[1]=m("相似度： ",-1)),a(d,{name:"similarity",style:{"font-size":"16px"}}),m(" "+_(n.similarity),1)])]),h.value==2?(i(),l(R,{key:0},[n.question?(i(),l("div",Ye,"问题："+_(n.question),1)):u("",!0),n.similar_questions&&n.similar_questions.length?(i(),l("div",Ze,[r[4]||(r[4]=e("span",null,"相似问法：",-1)),e("ul",es,[(i(!0),l(R,null,S(n.similar_questions,(w,$)=>(i(),l("li",{key:$},_(w),1))),128))])])):u("",!0),n.answer?(i(),l("div",ss,"答案："+_(n.answer),1)):u("",!0)],64)):(i(),l("div",{key:1,class:"content-box",innerHTML:n.content},null,8,ts))]))),128))]),_:1})),k.value?(i(),l("div",os,[a(s)])):u("",!0)])])}}},bs=O(is,[["__scopeId","data-v-1148cb61"]]);export{bs as default};
