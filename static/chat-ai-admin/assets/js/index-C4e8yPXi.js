import{ab as ne,e as F,l as c,f as B,o as ae,b as re,Y as L,_ as S,k as C,a2 as E,F as ce,a9 as le,a1 as ee,G as ue,a7 as fe,u as pe,af as K,d as de,a5 as oe,ae as be,ag as _e,aa as ye}from"./vue-chunks-Ci-XTWEs.js";import{u as H}from"./robot-Jq4BxR7W.js";import{b as te,d as l,ag as se}from"../../index-CuuB1UbP.js";import{g as me}from"./index-BWYmMYOg.js";import{c as ge,b as ke}from"./ui-antd-DhoCz7ZP.js";import{T as he}from"./top-header-lVvQunIr.js";import"./index-C-wOrj-7.js";import"./utils-ChQO-_r6.js";import"./add-group-BtmBFRnY.js";import"./index-8tBguPN_.js";const we={class:"left-menu-box"},ve={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(d,{emit:q}){const a=ne(),s=H(),b=d,r=a.query,w=F(()=>{const i=A.value.find(n=>n.id==="auto-reply");if(a.path.split("/")[3]==="auto-reply"&&!i)return["function-center"];const t=A.value.find(n=>n.id==="subscribe-reply");if(a.path.split("/")[3]==="subscribe-reply"&&!t)return["function-center"];const o=A.value.find(n=>n.id==="smart-menu");return a.path.split("/")[3]==="smart-menu"&&!o?["function-center"]:[a.path.split("/")[3]]}),R=[{key:"workflow",id:"workflow",icon:()=>c(l,{name:"workflow",class:"menu-icon"}),label:"工作流编排",title:"工作流编排",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>c(l,{name:"jichupeizhi",class:"menu-icon"}),label:"基础配置",title:"基础配置",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>c(l,{name:"guanlianzhishiku",class:"menu-icon"}),label:"知识库",title:"知识库",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>c(l,{name:"skii",class:"menu-icon"}),label:"工作流",title:"工作流",path:"/robot/config/skill-config",menuIn:["0"]},{key:"function-center",id:"function-center",icon:()=>c(l,{name:"function-center",class:"menu-icon"}),label:"功能中心",title:"功能中心",path:"/robot/config/function-center",menuIn:["0","1"]},{key:"external-services",id:"external-services",icon:()=>c(l,{name:"duiwaifuwu",class:"menu-icon"}),label:"对外服务",title:"对外服务",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>c(l,{name:"liaotianceshi",class:"menu-icon"}),label:"聊天测试",title:"聊天测试",path:"/robot/test",query:{robot_key:b.robotInfo.robot_key,id:b.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>c(l,{name:"qa-feedback",class:"menu-icon"}),label:"问答反馈",title:"问答反馈",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>c(l,{name:"session-record",class:"menu-icon"}),label:"会话记录",title:"会话记录",path:"/robot/config/session-record",query:{robot_key:b.robotInfo.robot_key,id:b.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>c(l,{name:"duiwaifuwu",class:"menu-icon"}),label:"API Key管理",title:"API Key管理",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"unknown_issue",id:"unknown_issue",icon:()=>c(l,{name:"unknown-issue",class:"menu-icon"}),label:"未知问题",title:"未知问题",path:"/robot/config/unknown_issue",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>c(l,{name:"statistical-analysis",class:"menu-icon"}),label:"统计分析",title:"统计分析",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>c(l,{name:"export-record",class:"menu-icon"}),label:"导出记录",title:"导出记录",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>c(l,{name:"doc-file",class:"menu-icon"}),label:"调用日志",title:"调用日志",path:"/robot/config/invoke-logs",menuIn:["1"]}],m=B(null),v=B(null),M=B(null);async function N(){var i,t,o,n,h,_,U,V,j,z,G,W,D,O,Y,J,Q,X,Z;try{const $=((i=b.robotInfo)==null?void 0:i.id)||r.id;if(!$)return;const T=await me({robot_id:$}),I=(T==null?void 0:T.data)||[],u=(I||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(u){const e=((t=u==null?void 0:u.robot_config)==null?void 0:t.switch_status)??((o=u==null?void 0:u.user_config)==null?void 0:o.switch_status)??"0",y=((n=u==null?void 0:u.robot_config)==null?void 0:n.ai_reply_status)??((h=u==null?void 0:u.user_config)==null?void 0:h.ai_reply_status)??"0";s.setKeywordReplySwitchStatus(String(e)),s.setKeywordReplyAiReplyStatus(String(y))}else s.setKeywordReplySwitchStatus("0"),s.setKeywordReplyAiReplyStatus("0");const g=(I||[]).find(e=>{var y,x;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((y=e==null?void 0:e.robot_config)==null?void 0:y.fixed_menu)==="1"&&((x=e==null?void 0:e.robot_config)==null?void 0:x.switch_status)==="1"});g?m.value={key:"auto-reply",id:"auto-reply",icon:()=>c(l,{name:"auto-reply",class:"menu-icon"}),label:(_=g==null?void 0:g.menu)==null?void 0:_.name,title:(U=g==null?void 0:g.menu)==null?void 0:U.name,path:((V=g==null?void 0:g.menu)==null?void 0:V.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:m.value=null;const f=(I||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(f){const e=((j=f==null?void 0:f.robot_config)==null?void 0:j.switch_status)??((z=f==null?void 0:f.user_config)==null?void 0:z.switch_status)??"0",y=((G=f==null?void 0:f.robot_config)==null?void 0:G.ai_reply_status)??((W=f==null?void 0:f.user_config)==null?void 0:W.ai_reply_status)??"0";s.setSubscribeReplySwitchStatus(String(e)),s.setSubscribeReplyAiReplyStatus(String(y))}else s.setSubscribeReplySwitchStatus("0"),s.setSubscribeReplyAiReplyStatus("0");!1||(v.value=null);const p=(I||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_smart_menu");if(p){const e=((D=p==null?void 0:p.robot_config)==null?void 0:D.switch_status)??((O=p==null?void 0:p.user_config)==null?void 0:O.switch_status)??"0",y=((Y=p==null?void 0:p.robot_config)==null?void 0:Y.ai_reply_status)??((J=p==null?void 0:p.user_config)==null?void 0:J.ai_reply_status)??"0";s.setSmartMenuSwitchStatus(String(e)),s.setSmartMenuAiReplyStatus(String(y))}else s.setSmartMenuSwitchStatus("0"),s.setSmartMenuAiReplyStatus("0");const k=(I||[]).find(e=>{var y,x;return(e==null?void 0:e.ability_type)==="robot_smart_menu"&&((y=e==null?void 0:e.robot_config)==null?void 0:y.fixed_menu)==="1"&&((x=e==null?void 0:e.robot_config)==null?void 0:x.switch_status)==="1"});k?M.value={key:"smart-menu",id:"smart-menu",icon:()=>c(l,{name:"smart-menu",class:"menu-icon"}),label:(Q=k==null?void 0:k.menu)==null?void 0:Q.name,title:(X=k==null?void 0:k.menu)==null?void 0:X.name,path:((Z=k==null?void 0:k.menu)==null?void 0:Z.path)||"/robot/ability/smart-menu",menuIn:["0","1"]}:M.value=null}catch($){console.warn("refreshAbilityMenu failed",$)}}function P(i){var n,h;const t=((n=b.robotInfo)==null?void 0:n.id)||r.id,o=(h=i==null?void 0:i.detail)==null?void 0:h.robotId;!o||!t||String(o)!==String(t)||N()}ae(()=>{N(),window.addEventListener("robotAbilityUpdated",P)}),re(()=>{window.removeEventListener("robotAbilityUpdated",P)});const A=F(()=>{let i=R;se(r.id)==1?i=i.filter(o=>o.id=="external-services"):i=i.filter(o=>{var n;return o.menuIn.includes((n=b.robotInfo)==null?void 0:n.application_type)});let t=[...i];if(m.value){const o=t.findIndex(n=>n.id==="function-center");o>=0?t.splice(o+1,0,m.value):t.push(m.value)}if(v.value){const o=t.findIndex(n=>n.id==="function-center");o>=0?t.splice(o+1,0,v.value):t.push(v.value)}if(M.value){const o=t.findIndex(n=>n.id==="function-center");o>=0?t.splice(o+1,0,M.value):t.push(M.value)}return t}),ie=({item:i})=>{w.value.includes(i.id)};return(i,t)=>{const o=ge,n=K("router-link"),h=ke;return S(),L("div",we,[C(h,{class:"left-menu",selectedKeys:w.value,onClick:ie},{default:E(()=>[(S(!0),L(ce,null,le(A.value,_=>(S(),ee(n,{class:"default-color",target:_.target||"_self",to:{path:_.path,query:_.query||pe(r)},key:_.key},{default:E(()=>[(S(),ee(o,{icon:_.icon,path:_.path,key:_.key},{default:E(()=>[ue(fe(_.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))),128))]),_:1},8,["selectedKeys"])])}}},Se=te(ve,[["__scopeId","data-v-b081039d"]]),Re=de({name:"robotPage",components:{leftMenu:Se,TopHeader:he},async beforeRouteEnter(d,q,a){const s=H(),{getRobot:b,robotInfo:r,getRobotLists:w,getGroupList:R}=s;await b(d.query.id),w(),R();let m=se(d.query.id);if(m==0){a("/no-permission");return}if(m==1){window.location.href=`${r.h5_domain}/#/chat/pc?robot_key=${r.robot_key}`,a("/robot/list");return}let v=["basicConfig","libraryConfig","skillConfig"];if(r.application_type==1&&v.includes(d.name)){a(`/robot/config/workflow?id=${r.id}&robot_key=${r.robot_key}`);return}if(r.application_type==0&&d.name=="robotWorkflow"){a(`/robot/config/basic-config?id=${r.id}&robot_key=${r.robot_key}`);return}a()},setup(){const d=ye(),q=H(),{robotInfo:a}=_e(q),s=F(()=>ne().name!="robotWorkflow");return{robotInfo:a,changeMenu:r=>{d.push({path:r.path,query:{robot_key:a.value.robot_key,id:a.value.id}})},isShowLeft:s}}}),Me={class:"robot-main-container"},Ie={class:"robot-page-layout"},xe={key:0,class:"layout-left"},qe={class:"layout-body"};function Ae(d,q,a,s,b,r){const w=K("TopHeader"),R=K("leftMenu"),m=K("router-view");return S(),L("div",Me,[oe("div",Ie,[d.isShowLeft?(S(),L("div",xe,[C(w),C(R,{onChangeMenu:d.changeMenu,robotInfo:d.robotInfo},null,8,["onChangeMenu","robotInfo"])])):be("",!0),oe("div",qe,[C(m)])])])}const Ue=te(Re,[["render",Ae],["__scopeId","data-v-5283f69c"]]);export{Ue as default};
