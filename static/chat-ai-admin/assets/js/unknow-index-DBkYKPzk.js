import{_ as Je}from"./cu-scroll-BmUgdtgQ.js";import{u as Me}from"./robot-DHvU2P3E.js";import{d as F,N as Pe,q as Qe,J as He,B as ge,M as me,br as Xe,aJ as Ze,a3 as We,k as Se,p as ke,y as Ie,u as et,v as tt,Q as Oe,Y as we,Z as be,O as Ue,ax as nt,a as W,F as _e,e as Le,ab as Ye,X as ot,g as at,b as st,c as lt,D as it,w as ut,a8 as rt,E as dt}from"./ui-antd-BgeWxFcI.js";import{ab as re,aa as ze,f as u,r as P,o as _t,w as Te,Y as f,_ as r,a5 as e,k as n,a2 as o,F as B,a9 as ue,u as J,a1 as G,G as x,a7 as T,e as ae,j as mt,y as Ne,ae as X,n as ye,A as $e,ad as ct,ak as De,al as Ce,a4 as fe,q as pt}from"./vue-chunks-Ci-XTWEs.js";import{b as ne,d as he,F as vt,aT as ft,aV as yt,aD as gt,h as kt}from"../../index-OnalErht.js";import{C as Ae}from"./index-BbXKX7WL.js";import{u as wt}from"./index-zg_rh8X1.js";import{W as bt,X as Ke,Y as ht,Z as xt}from"./index-DGyn5jM5.js";import{U as Re}from"./index-DIhX1V7E.js";import{u as Fe}from"./util-BwuffJOK.js";import{M as $t}from"./index-BMSQkwth.js";import{M as Dt}from"./model-select-BWi4a3Y6.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./utils-ChQO-_r6.js";import"./index-DXDs1xHg.js";import"./index-BdOGHXRM.js";const Ct={class:"zm-date"},qt={class:"date-btn"},Mt={class:"date-content"},Ve={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(H,{emit:K}){const $=re().query,C=ze(),i=H,g=u(1),l=K;let c=P([{label:"今日",value:!0,key:2,start_date:F().startOf("day"),end_date:F().endOf("day")},{label:"昨日",value:!1,key:3,start_date:F().subtract(1,"day").startOf("day"),end_date:F().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:F().subtract(6,"day").startOf("day"),end_date:F().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:F().startOf("month").startOf("day"),end_date:F().endOf("day")}]);const a=u(null),O=u(null),I=u([]),h=y=>y>=F().subtract(0,"day"),S=()=>{let y=g.value,s=null;c.forEach(m=>{m.key==y&&(s=m)}),I.value=[s.start_date,s.end_date],a.value=s.start_date.startOf("day").format("YYYYMMDD"),O.value=s.end_date.endOf("day").format("YYYYMMDD"),N()},Y=(y,s)=>{a.value=y[0].startOf("day").format("YYYYMMDD"),O.value=y[1].endOf("day").format("YYYYMMDD"),g.value=5,N()},N=()=>{l("dateChange",{start_time:a.value,end_time:O.value})};return _t(()=>{$.start_date&&$.end_date?(g.value=5,I.value=[F($.start_date),F($.end_date)],a.value=F($.start_date).format("YYYYMMDD"),O.value=F($.end_date).format("YYYYMMDD"),N(),setTimeout(()=>{C.push({path:C.path,query:{id:$.id,robot_key:$.robot_key}})},400)):(g.value=parseInt(i.datekey),S())}),Te(()=>i.datekey,(y,s)=>{g.value=parseInt(i.datekey.split("-")[0]),S()}),(y,s)=>{const m=Pe,q=Qe,w=He;return r(),f("div",Ct,[e("div",qt,[n(q,{value:g.value,"onUpdate:value":s[0]||(s[0]=M=>g.value=M),onChange:S},{default:o(()=>[(r(!0),f(B,null,ue(J(c),M=>(r(),G(m,{class:"date-btn-button",value:M.key,key:M.key},{default:o(()=>[x(T(M.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",Mt,[n(w,{value:I.value,"onUpdate:value":s[1]||(s[1]=M=>I.value=M),onChange:Y,format:"YYYY-MM-DD",disabledDate:h,allowClear:!1},null,8,["value"])])])}}},St={class:"ai-generate-wrapper"},It={class:"form-box-wrapper ai-generate-wrapper-box"},Ot={class:"ai-generate-wrapper-left"},Ut={class:"form-box-wrapper-options"},Lt={class:"form-item flex1"},Yt={class:"form-content"},zt={class:"form-item generate-btn-box"},Tt={key:0,class:"progress-box"},Nt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(H,{expose:K,emit:$}){const C=u(10),i=u(!1),g=u(!1),l=P({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),c=H,a=$,O=u(""),I=["azure","ollama","xinference","openaiAgent"],h=u(!1),S=()=>{h.value=!0},Y=()=>{i.value=!1},N=async()=>{var k;g.value=!0;try{let v={library_id:(k=c.detailsInfo)==null?void 0:k.library_id,model_config_id:l.model_config_id,use_model:l.use_model,num:l.count};h.value=!1,i.value=!0,M()}finally{g.value=!1}},y=u(!1),s=u(!1);let m=null;const q=ae(()=>C.value>=100?"success":"active"),w=ae(()=>({"0%":"#108ee9","100%":"#87d068"})),M=()=>{y.value=!0,s.value=!1,C.value=0,m=setInterval(()=>{C.value<100?(C.value+=Math.floor(Math.random()*10)+1,C.value>100&&(C.value=100)):(clearInterval(m),y.value=!1,s.value=!0)},800)},z=()=>{a("handleDownload")},L=k=>{l.use_model=I.includes(k.rawData.model_define)&&k.rawData.deployment_name?k.rawData.deployment_name:k.rawData.name,l.use_model_icon=k.icon,l.use_model_name=k.use_model_name,l.model_config_id=k.rawData.id,O.value=k.rawData.model_define},E=u([]),p=k=>{E.value=k,Ne(()=>{(!l.ai_chunk_model||!Number(l.ai_chunk_model_config_id))&&_()})},_=()=>{if(E.value.length>0){let k=null,v=null;for(let Q of E.value)if(Q.model_define==="tongyi"){k=Q;for(let j of k.children)if(j.name==="qwen-max"){v=j;break}break}k||(k=E.value[0],v=k.children[0]),k&&v&&(l.use_model=v.name,l.model_config_id=v.model_config_id,l.ai_chunk_model=v.name,l.ai_chunk_model_config_id=v.model_config_id)}},D=k=>{if(y.value)return k.preventDefault(),k.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return mt(()=>{clearInterval(m),window.removeEventListener("beforeunload",D)}),K({showModal:S,hideModal:Y}),(k,v)=>{const Q=he,j=ge,ee=me,se=Xe,Z=Ze;return r(),f("div",null,[n(ee,{open:h.value,"onUpdate:open":v[1]||(v[1]=V=>h.value=V),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:o(()=>v[3]||(v[3]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])),footer:o(()=>v[6]||(v[6]=[])),default:o(()=>[e("div",St,[e("div",It,[e("div",Ot,[e("div",Ut,[e("div",Lt,[v[4]||(v[4]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",Yt,[n(Ae,{modelValue:l.use_model,"onUpdate:modelValue":v[0]||(v[0]=V=>l.use_model=V),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":l.model_config_id,onChange:L,onLoaded:p},null,8,["modelValue","model-config-id"])])])]),e("div",zt,[n(j,{onClick:N,loading:g.value,class:"generate-btn"},{default:o(()=>[n(Q,{name:"ai-generate-white",style:{"font-size":"16px"}}),v[5]||(v[5]=x(" 开始总结 "))]),_:1,__:[5]},8,["loading"])])])])])]),_:1},8,["open"]),n(ee,{open:i.value,"onUpdate:open":v[2]||(v[2]=V=>i.value=V),title:"生成数据",footer:null,width:746},{default:o(()=>[C.value<100?(r(),f("div",Tt,[n(se,{type:"circle",percent:C.value,status:q.value,"stroke-color":w.value},null,8,["percent","status","stroke-color"]),v[7]||(v[7]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(r(),G(Z,{key:1,status:"success",title:"生成完成"},{subTitle:o(()=>v[8]||(v[8]=[x(" 您可以去未知问题总结中下载生成的数据 ")])),extra:o(()=>[n(j,{onClick:z,type:"primary"},{default:o(()=>v[9]||(v[9]=[x("去下载")])),_:1,__:[9]})]),_:1}))]),_:1},8,["open"])])}}},At=ne(Nt,[["__scopeId","data-v-8157c68d"]]),Kt={class:"list-wrapper"},Rt={class:"content-wrapper"},Ft={class:"tip-icon"},Vt={class:"search-block"},Gt={key:0},Et={key:1},jt={__name:"index",setup(H){const K=re().query,$=u(1),C=u([]),i=P({robot_id:K.id,start_day:"",end_day:"",page:1,size:10,total:0}),g=u(null),l=S=>{i.page=S.current,i.size=S.pageSize,I()},c=()=>{i.page=1,I()},a=()=>{$.value=2,g.value&&g.value.hideModal()},O=S=>{i.start_day=S.start_time,i.end_day=S.end_time,c()},I=()=>{wt({...i}).then(S=>{let Y=S.data.list;C.value=Y,i.total=+S.data.total})},h=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(S,Y)=>{const N=Se,y=ke,s=Ie;return r(),f(B,null,[e("div",Kt,[e("div",Rt,[n(N,{"show-icon":"",class:"alert-box"},{icon:o(()=>[e("div",Ft,[n(J(We))])]),message:o(()=>Y[0]||(Y[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])),_:1}),e("div",Vt,[n(Ve,{datekey:"4",onDateChange:O})]),n(s,{class:"table-list",columns:h,"data-source":C.value,pagination:{current:i.page,total:i.total,pageSize:i.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:l},{bodyCell:o(({column:m,record:q})=>[m.key==="question"?(r(),f(B,{key:0},[q.question.length>100?(r(),f("div",Gt,[n(y,{overlayClassName:"search-content-tip",placement:"top"},{title:o(()=>[x(T(q.question),1)]),default:o(()=>[e("div",null,T(q.question.slice(0,100)+"..."),1)]),_:2},1024)])):(r(),f("div",Et,T(q.question),1))],64)):X("",!0)]),_:1},8,["data-source","pagination"])])]),n(At,{ref_key:"aiGenerateRef",ref:g,onHandleDownload:a},null,512)],64)}}},Bt=ne(jt,[["__scopeId","data-v-9638ffbb"]]),Jt={class:"custom-modal-header"},Pt={key:1},Qt={key:2},Ht={class:"form-box-wrapper"},Xt={class:"form-item"},Zt={class:"form-content"},Wt={class:"form-item"},en={class:"form-content"},tn={class:"form-item"},nn={class:"form-content"},on={class:"form-item"},an={class:"form-label-box"},sn={class:"form-content"},ln={class:"form-item"},un={class:"form-content"},rn={key:0,class:"error-tip"},dn={class:"form-item"},_n={class:"form-content"},mn={class:"upload-box-wrapper"},cn={key:0},pn={class:"ai-generate-wrapper"},vn={class:"form-box-wrapper ai-generate-wrapper-box"},fn={class:"ai-generate-wrapper-left"},yn={class:"form-box-wrapper-options"},gn={class:"form-item flex1"},kn={class:"form-content"},wn={class:"form-item flex1"},bn={class:"form-content dual-inputs"},hn={class:"input-group"},xn={class:"form-label-input-box"},$n={class:"form-box-wrapper-content"},Dn={class:"problem-box"},Cn={class:"problem-content"},qn={class:"problem-box"},Mn={class:"problem-content"},Sn={class:"form-item generate-btn-box"},In={class:"result-nav"},On={key:0,class:"tip"},Un={key:1,class:"result-nav-text"},Ln={key:0,class:"container"},Yn={class:"result-container"},zn=["innerHTML"],Tn={class:"result-footer"},Nn={__name:"import-library-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=u(!1),i=u(!1),g=u(!1),l=u(!1),c=u(!1),a=P({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),O=new $t({html:!0,linkify:!0,typographer:!0}),I=u(""),h=P({finish:"",content:""});Te(()=>h.content,()=>{I.value=O.render(h.content)});const S=$,Y=u(""),N=["azure","ollama","xinference","openaiAgent"],y=u("1"),s=u(!1),m=u(""),q=u(""),w=u(""),M=u(""),z=u(""),L=u([]),E=u(""),p=u("0"),_=u([]),D=()=>{vt({type:2}).then(d=>{p.value="0",_.value=d.data||[]})};D();const k=()=>{j()},v=d=>{var t;D(),i.value=!1,g.value=!1,c.value=!1,m.value="",q.value="",E.value=d.id||"",w.value=d.answer||"",L.value=d.images||[],M.value=d.question||"",z.value=d.similar_questions?d.similar_questions.join(`
`):"",p.value=d.group_id||"0",a.library_id=d.library_id||"",a.library_id||(a.library_id=(t=_.value[0])==null?void 0:t.id),j(),s.value=!0},Q=u([]),j=()=>{gt({library_id:a.library_id}).then(d=>{Q.value=d.data||[]})},ee=()=>{if(xe(),!M.value)return W.error("请输入分段问题");if(!w.value)return W.error("请输入分段答案");if(w.value.length>1e4)return;let d={title:m.value,content:q.value,question:M.value,answer:w.value,images:L.value,library_id:a.library_id};d.group_id=p.value||0;let t=z.value.trim();t?(t=t.split(`
`),d.similar_questions=JSON.stringify(t)):d.similar_questions="[]";let A=new FormData;for(let R in d)Fe.isArray(d[R])?d[R].forEach(ie=>{A.append(R,ie)}):A.append(R,d[R]);yt(A).then(R=>{bt({id:E.value,to_library_id:a.library_id}).then(ie=>{W.success("导入成功"),s.value=!1,S("ok")})})},se=()=>{if(!a.library_id)return W.error("请选择知识库");i.value=!0},Z=u(""),V=async()=>{h.content="",Z.value="",l.value=!0,c.value=!0;try{let d={library_id:a.library_id,model_config_id:a.model_config_id,use_model:a.use_model,num:a.count,question:M.value,answer:w.value};const t=await ft(d);Z.value=t.data.map(A=>A).join(`
`),h.content=t.data.map((A,R)=>`<div class="dialog-message">${R+1}. ${A}</div>`).join(""),g.value=!0}finally{l.value=!1}},ce=()=>{z.value?z.value+=`
${Z.value}`:z.value+=Z.value,W.success("保存成功"),g.value=!1,i.value=!1,c.value=!1},pe=d=>{a.use_model=N.includes(d.rawData.model_define)&&d.rawData.deployment_name?d.rawData.deployment_name:d.rawData.name,a.use_model_icon=d.icon,a.use_model_name=d.use_model_name,a.model_config_id=d.rawData.id,Y.value=d.rawData.model_define},oe=u([]),U=d=>{oe.value=d,Ne(()=>{(!a.ai_chunk_model||!Number(a.ai_chunk_model_config_id))&&te()})},te=()=>{if(oe.value.length>0){let d=null,t=null;for(let A of oe.value)if(A.model_define==="tongyi"){d=A;for(let R of d.children)if(R.name==="qwen-max"){t=R;break}break}d||(d=oe.value[0],t=d.children[0]),d&&t&&(a.use_model=t.name,a.model_config_id=t.model_config_id,a.ai_chunk_model=t.name,a.ai_chunk_model_config_id=t.model_config_id)}};function le(d){return d.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const xe=()=>{z.value=le(z.value)};return K({showModal:v}),(d,t)=>{const A=ge,R=tt,ie=et,ve=Oe,de=he,Ge=be,Ee=we,je=Ue,Be=me;return r(),f("div",null,[n(Be,{open:s.value,"onUpdate:open":t[11]||(t[11]=b=>s.value=b),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:i.value?c.value?"944px":"472px":"746px","ok-button-props":{style:{display:i.value?"none":"block"}}},{title:o(()=>[e("div",Jt,[i.value?(r(),G(A,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=b=>i.value=!1)},{icon:o(()=>[n(J(nt),{style:{"font-size":"12px"}})]),_:1})):X("",!0),i.value?(r(),f("span",Pt,"AI生成相似问法")):(r(),f("span",Qt,"导入知识库"))])]),footer:o(()=>[i.value?X("",!0):(r(),f(B,{key:0},[n(A,{onClick:t[10]||(t[10]=b=>s.value=!1)},{default:o(()=>t[29]||(t[29]=[x("取消")])),_:1,__:[29]}),n(A,{type:"primary",onClick:ee},{default:o(()=>t[30]||(t[30]=[x("确定")])),_:1,__:[30]})],64))]),default:o(()=>[ye(e("div",Ht,[e("div",Xt,[t[12]||(t[12]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",Zt,[n(ie,{onChange:k,value:a.library_id,"onUpdate:value":t[1]||(t[1]=b=>a.library_id=b),style:{width:"100%"},placeholder:"请选择"},{default:o(()=>[(r(!0),f(B,null,ue(_.value,b=>(r(),G(R,{value:b.id,key:b.id},{default:o(()=>[x(T(b.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Wt,[t[13]||(t[13]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",en,[n(ie,{value:p.value,"onUpdate:value":t[2]||(t[2]=b=>p.value=b),style:{width:"100%"}},{default:o(()=>[(r(!0),f(B,null,ue(Q.value,b=>(r(),G(R,{value:b.id},{default:o(()=>[x(T(b.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",tn,[t[14]||(t[14]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",nn,[n(ve,{placeholder:"请输入分段问题",value:M.value,"onUpdate:value":t[3]||(t[3]=b=>M.value=b),style:{height:"100px"}},null,8,["value"])])]),e("div",on,[e("div",an,[t[16]||(t[16]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:se},[n(de,{name:"ai-generate",style:{"font-size":"14px"}}),t[15]||(t[15]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",sn,[n(ve,{placeholder:"请输入相似问法",value:z.value,"onUpdate:value":t[4]||(t[4]=b=>z.value=b),style:{height:"100px"},onBlur:xe},null,8,["value"]),t[17]||(t[17]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",ln,[t[18]||(t[18]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",un,[n(ve,{placeholder:"请输入分段答案",value:w.value,"onUpdate:value":t[5]||(t[5]=b=>w.value=b),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),w.value.length>1e4?(r(),f("div",rn,"分段答案最多支持10000个字符")):X("",!0)])]),e("div",dn,[t[20]||(t[20]=e("div",{class:"form-label"},"附件",-1)),e("div",_n,[e("div",mn,[n(Ee,{activeKey:y.value,"onUpdate:activeKey":t[6]||(t[6]=b=>y.value=b),size:"small"},{default:o(()=>[n(Ge,{key:"1"},{tab:o(()=>[e("span",null,[n(de,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[19]||(t[19]=x(" 图片 ")),L.value.length?(r(),f("span",cn,"("+T(L.value.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Re,{value:L.value,"onUpdate:value":t[7]||(t[7]=b=>L.value=b)},null,8,["value"])])])])],512),[[$e,!i.value]]),ye(e("div",pn,[e("div",vn,[e("div",fn,[e("div",yn,[e("div",gn,[t[21]||(t[21]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",kn,[n(Ae,{modelValue:a.use_model,"onUpdate:modelValue":t[8]||(t[8]=b=>a.use_model=b),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":a.model_config_id,onChange:pe,onLoaded:U},null,8,["modelValue","model-config-id"])])]),e("div",wn,[e("div",bn,[e("div",hn,[t[23]||(t[23]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",xn,[n(je,{value:a.count,"onUpdate:value":t[9]||(t[9]=b=>a.count=b),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[22]||(t[22]=x("个 "))])])])])]),e("div",$n,[e("div",Dn,[t[24]||(t[24]=e("div",{class:"problem"},"问题",-1)),e("div",Cn,T(M.value),1)]),e("div",qn,[t[25]||(t[25]=e("div",{class:"problem"},"答案",-1)),e("div",Mn,T(w.value),1)])]),e("div",Sn,[n(A,{onClick:V,loading:l.value,class:"generate-btn"},{default:o(()=>[n(de,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[26]||(t[26]=x(" 开始生成 "))]),_:1,__:[26]},8,["loading"])])]),e("div",{class:ct(["ai-generate-wrapper-right",{"show-result":c.value}])},[e("div",In,[n(de,{name:"generate-icon",style:{"font-size":"14px"}}),l.value?(r(),f("span",On,"相似问法生成中...")):(r(),f("div",Un,"相似问法生成完毕"))]),!h.content&&l.value&&!C.value?(r(),f("div",Ln,t[27]||(t[27]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)]))):X("",!0),e("div",Yn,[e("div",{class:"dialog-content",innerHTML:I.value},null,8,zn)]),e("div",Tn,[n(A,{class:"result-footer-btn",type:"primary",onClick:ce},{default:o(()=>t[28]||(t[28]=[x("保存相似问法")])),_:1,__:[28]})])],2)])],512),[[$e,i.value]])]),_:1},8,["open","width","ok-button-props"])])}}},An=ne(Nn,[["__scopeId","data-v-1b574462"]]),Kn={class:"form-box"},Rn={__name:"auto-cluster-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=$,i=re().query,g=u(!1),l=P({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:i.id}),c=_e.useForm;u(!1);const a=y=>{l.unknown_summary_model_config_id=y.unknown_summary_model_config_id||"",l.unknown_summary_use_model=y.unknown_summary_use_model||"",l.unknown_summary_similarity=y.unknown_summary_similarity||"",l.unknown_summary_status=y.unknown_summary_status||"",g.value=!0},O=P({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:I,validateInfos:h}=c(l,O),S=y=>{y.length},Y=()=>{I().then(()=>{N()}).catch(y=>{})},N=()=>{Ke({...l}).then(y=>{W.success("保存成功"),g.value=!1,C("ok")})};return K({show:a}),(y,s)=>{const m=Le,q=ke,w=Ue,M=_e,z=me;return r(),f("div",null,[n(z,{open:g.value,"onUpdate:open":s[3]||(s[3]=L=>g.value=L),title:"自动聚类设置",onOk:Y},{default:o(()=>[e("div",Kn,[n(M,{layout:"vertical"},{default:o(()=>[n(m,De(Ce(J(h).unknown_summary_model_config_id)),{label:o(()=>s[4]||(s[4]=[x("请设置使用的向量模型 ")])),default:o(()=>[n(Dt,{modelType:"TEXT EMBEDDING",modeName:l.unknown_summary_use_model,"onUpdate:modeName":s[0]||(s[0]=L=>l.unknown_summary_use_model=L),modeId:l.unknown_summary_model_config_id,"onUpdate:modeId":s[1]||(s[1]=L=>l.unknown_summary_model_config_id=L),onLoaded:S,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),n(m,De(Ce(J(h).unknown_summary_similarity)),{label:o(()=>[s[6]||(s[6]=x("相似度阈值 ")),n(q,null,{title:o(()=>s[5]||(s[5]=[x("语意相似度大于指定阈值的问题会自动聚类")])),default:o(()=>[n(J(Ye),{class:"ml4"})]),_:1})]),default:o(()=>[n(w,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:l.unknown_summary_similarity,"onUpdate:value":s[2]||(s[2]=L=>l.unknown_summary_similarity=L),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},Fn=ne(Rn,[["__scopeId","data-v-3a707038"]]),Vn={class:"form-box"},Gn={class:"upload-box-wrapper"},En={key:0},jn={__name:"set-answer-modal",emits:["ok"],setup(H,{expose:K,emit:$}){const C=$,i=re().query,g=u("1"),l=u(!1),c=P({id:i.id,question:"",unknown_list:"",answer:"",images:[]}),a=_e.useForm,O=u(!1),I=s=>{Object.assign(c,JSON.parse(JSON.stringify(s))),l.value=!0},h=P({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:S,validateInfos:Y}=a(c,h),N=()=>{S().then(()=>{y()}).catch(s=>{})},y=()=>{let s={...c},m=s.unknown_list.trim();m?(m=m.split(`
`),s.unknown_list=JSON.stringify(m)):s.unknown_list="[]";let q=new FormData;for(let w in s)Fe.isArray(s[w])?s[w].forEach(M=>{q.append(w,M)}):q.append(w,s[w]);O.value=!0,ht(q).then(w=>{W.success("保存成功"),l.value=!1,C("ok")}).finally(()=>{O.value=!1})};return K({show:I}),(s,m)=>{const q=Oe,w=Le,M=he,z=be,L=we,E=Re,p=_e,_=me;return r(),f("div",null,[n(_,{open:l.value,"onUpdate:open":m[5]||(m[5]=D=>l.value=D),title:"设置答案",onOk:N,width:746,confirmLoading:O.value},{default:o(()=>[e("div",Vn,[n(p,{layout:"vertical"},{default:o(()=>[n(w,fe({label:"问题"},J(Y).question),{default:o(()=>[n(q,{placeholder:"请输入问题",value:c.question,"onUpdate:value":m[0]||(m[0]=D=>c.question=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(w,fe({label:"相似问法(一行一个，最多可添加100个相似问法)"},J(Y).unknown_list),{default:o(()=>[n(q,{placeholder:"请输入相似问法",value:c.unknown_list,"onUpdate:value":m[1]||(m[1]=D=>c.unknown_list=D),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(w,fe({label:"答案"},J(Y).answer),{default:o(()=>[n(q,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":m[2]||(m[2]=D=>c.answer=D),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),n(w,{label:"附件"},{default:o(()=>[e("div",Gn,[n(L,{activeKey:g.value,"onUpdate:activeKey":m[3]||(m[3]=D=>g.value=D),size:"small"},{default:o(()=>[n(z,{key:"1"},{tab:o(()=>[e("span",null,[n(M,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),m[6]||(m[6]=x(" 图片 ")),c.images.length?(r(),f("span",En,"("+T(c.images.length)+")",1)):X("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(E,{value:c.images,"onUpdate:value":m[4]||(m[4]=D=>c.images=D)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Bn=ne(jn,[["__scopeId","data-v-a5711fe0"]]),Jn={class:"user-model-page"},Pn={class:"search-block"},Qn={class:"left-block"},Hn={class:"right-block"},Xn={class:"list-box"},Zn={class:"qa-list-box"},Wn={class:"list-item"},eo={class:"list-content"},to={class:"classify-scroll-box"},no={key:0,class:"list-item"},oo={class:"list-content"},ao={class:"fragment-img"},so=["src"],lo={class:"import-td-box"},io={key:0,class:"status-block success"},uo={key:1,class:"status-block none"},ro=["href"],_o=["onClick"],mo=["onClick"],co={__name:"index",setup(H){const K=kt(),$=Me(),{getRobot:C}=$,i=ae(()=>$.robotInfo),g=ae(()=>i.value.unknown_summary_status==1),l=re().query;ze(),u(2);const c=P({start_day:"",end_day:""}),a=P({page:1,size:10,total:0}),O=u([]),I=u(!1),h=()=>{let p={robot_id:l.id,...c,...a};I.value=!0,xt({...p}).then(_=>{O.value=_.data.list.map(D=>({...D,images:D.images?JSON.parse(D.images):[],unknown_list:D.unknown_list?JSON.parse(D.unknown_list):[]})),a.total=+_.data.total||0}).finally(()=>{I.value=!1})};h();const S=p=>{let _=K.getToken,D=c.start_day,k=c.end_day,v=`/manage/getUnknownIssueSummary?robot_id=${l.id}&token=${_}&start_day=${D}&end_day=${k}&export=${p}`;window.location.href=v},Y=p=>{a.page=p.current,a.size=p.pageSize,h()},N=()=>{a.page=1,h()},y=p=>{c.start_day=p.start_time,c.end_day=p.end_time,N()},s=u(null),m=p=>{s.value.showModal({id:p.id,library_id:p.to_library_id>0?p.to_library_id:"",answer:p.answer,question:p.question,similar_questions:p.unknown_list,images:p.images})},q=u(null),w=()=>{q.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:i.value.unknown_summary_status})},M=p=>{p?q.value.show({unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:1}):Ke({id:l.id,unknown_summary_model_config_id:i.value.unknown_summary_model_config_id,unknown_summary_use_model:i.value.unknown_summary_use_model,unknown_summary_similarity:i.value.unknown_summary_similarity,unknown_summary_status:0}).then(_=>{W.success("保存成功"),C(l.id)})},z=u(null),L=p=>{z.value.show({id:p.id,question:p.question,answer:p.answer,unknown_list:p.unknown_list.join(`
`),images:p.images})},E=()=>{C(l.id)};return(p,_)=>{const D=Se,k=ke,v=ot,Q=ge,j=lt,ee=st,se=it,Z=rt,V=ut,ce=dt,pe=Ie,oe=pt("viewer");return r(),f("div",Jn,[n(D,{"show-icon":"",style:{"padding-top":"16px"}},{message:o(()=>_[2]||(_[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])),_:1}),e("div",Pn,[e("div",Qn,[_[5]||(_[5]=e("span",null,"自动聚类",-1)),n(k,null,{title:o(()=>_[3]||(_[3]=[x("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题")])),default:o(()=>[n(J(Ye)),_[4]||(_[4]=x("： "))]),_:1,__:[4]}),n(v,{onChange:M,checked:g.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:w},"设置")]),e("div",Hn,[n(Ve,{datekey:"4",onDateChange:y}),n(Q,{type:"primary",onClick:N},{default:o(()=>_[6]||(_[6]=[x("查询")])),_:1,__:[6]}),n(se,null,{overlay:o(()=>[n(ee,null,{default:o(()=>[n(j,{onClick:_[0]||(_[0]=U=>S("docx")),key:"1"},{default:o(()=>_[7]||(_[7]=[x("下载为docx")])),_:1,__:[7]}),n(j,{onClick:_[1]||(_[1]=U=>S("xlsx")),key:"2"},{default:o(()=>_[8]||(_[8]=[x("下载为xlsx")])),_:1,__:[8]})]),_:1})]),default:o(()=>[n(Q,{type:"primary"},{default:o(()=>[_[9]||(_[9]=x(" 下载 ")),n(J(at))]),_:1,__:[9]})]),_:1})])]),e("div",Xn,[n(pe,{"data-source":O.value,loading:I.value,pagination:{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:Y},{default:o(()=>[n(V,{key:"question",title:"聚类问题",width:480},{default:o(({record:U})=>[e("div",Zn,[e("div",Wn,[_[10]||(_[10]=e("div",{class:"list-label"},"问题",-1)),e("div",eo,[x(T(U.question)+" ",1),U.unknown_total>0?(r(),G(Z,{key:0,placement:"topLeft"},{content:o(()=>[e("div",to,[(r(!0),f(B,null,ue(U.unknown_list,(te,le)=>(r(),f("div",{class:"list-item",key:le},T(te),1))),128))])]),title:o(()=>[e("span",null,"共聚类了"+T(U.unknown_total)+"个未知问题",1)]),default:o(()=>[e("a",null,"（"+T(U.unknown_total)+"） ",1)]),_:2},1024)):X("",!0)])]),U.answer?(r(),f("div",no,[_[11]||(_[11]=e("div",{class:"list-label"},"答案",-1)),e("div",oo,T(U.answer),1)])):X("",!0),ye((r(),f("div",ao,[(r(!0),f(B,null,ue(U.images,(te,le)=>(r(),f("img",{key:le,src:te,alt:""},null,8,so))),128))])),[[oe]])])]),_:1}),n(V,{key:"show_date",title:"触发日期",width:120},{default:o(({record:U})=>[x(T(U.show_date),1)]),_:1}),n(V,{key:"to_library_id",title:"是否导入知识库",width:160},{default:o(({record:U})=>[e("div",lo,[U.to_library_id>0?(r(),f("div",io,_[12]||(_[12]=[e("span",null,null,-1),x(" 已导入 ")]))):(r(),f("div",uo,_[13]||(_[13]=[e("span",null,null,-1),x(" 未导入 ")]))),e("a",{href:`/#/library/details/knowledge-document?id=${U.to_library_id}`,target:"_blank"},T(U.to_library_name),9,ro)])]),_:1}),n(V,{key:"action",title:"操作",width:135},{default:o(({record:U})=>[n(ce,{gap:8},{default:o(()=>[e("a",{onClick:te=>L(U)},"设置答案",8,_o),e("a",{onClick:te=>m(U)},"导入知识库",8,mo)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),n(An,{onOk:h,ref_key:"importLibraryModalRef",ref:s},null,512),n(Fn,{onOk:E,ref_key:"autoClusterModalRef",ref:q},null,512),n(Bn,{onOk:h,ref_key:"setAnswerModalRef",ref:z},null,512)])}}},po=ne(co,[["__scopeId","data-v-993551f2"]]),vo={class:"user-model-page"},qe="/robot/config/unknown_issue/activeKey",fo={__name:"unknow-index",setup(H){const K=Me(),$=u(+localStorage.getItem(qe)||1),C=ae(()=>K.robotInfo),i=ae(()=>C.value.unknown_summary_status==1),g=()=>{localStorage.setItem(qe,$.value)};return(l,c)=>{const a=be,O=we,I=Je;return r(),f(B,null,[n(O,{class:"tab-wrapper",activeKey:$.value,"onUpdate:activeKey":c[0]||(c[0]=h=>$.value=h),onChange:g},{default:o(()=>[i.value?(r(),f(B,{key:0},[(r(),G(a,{key:2,tab:"未知问题总结"})),(r(),G(a,{key:1,tab:"未知问题统计"}))],64)):(r(),f(B,{key:1},[(r(),G(a,{key:1,tab:"未知问题统计"})),(r(),G(a,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",vo,[n(I,null,{default:o(()=>[$.value==1?(r(),G(Bt,{key:0})):(r(),G(po,{key:1}))]),_:1})])],64)}}},Yo=ne(fo,[["__scopeId","data-v-70d9105a"]]);export{Yo as default};
