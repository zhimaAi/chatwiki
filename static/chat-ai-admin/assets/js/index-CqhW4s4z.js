import{_ as W,ae as gt,ad as mt,d as Z,a9 as tt}from"../../index-C1Xsov4S.js";import{a9 as et,f as g,o as K,Y as o,_ as n,a1 as P,k as u,F as R,ab as z,a5 as t,a7 as i,a2 as b,u as J,G as q,ae as E,B as F,e as st,l as nt,ac as H,r as yt,aa as kt}from"./vue-chunks-DCKTEHpB.js";import{E as at}from"./empty-box-vvdJX5k0.js";import{c as $t,b as ot,s as Q,a as lt,r as it,t as bt,u as Ct,e as X,f as xt,o as wt,h as Rt}from"./index-BsqRrb1q.js";import{L as ct}from"./loading-box-CyUSXD2F.js";import{U as dt}from"./update-modal-ThPT_f13.js";import{p as _t,E as ut,av as rt,ab as pt,B as ft,a3 as Dt,ap as vt,ax as ht,M as Y,a as V,J as Tt,Y as Ot,I as Pt}from"./ui-antd-D64OvTpt.js";import{_ as It}from"./tool-icon-IWVrYlVb.js";import{_ as Mt}from"./no-permission-DtJ3NYHG.js";import{F as Bt}from"./feishu-config-modal-BX5W4WZI.js";import{_ as St}from"./main-tab-B3vUjkqO.js";import"./utils-D9NMMoMR.js";import"./empty-BFmzY9bl.js";/* empty css                                                                     */import"./list-tabs-BOqV1hiy.js";const zt={class:"_plugin-box"},qt={key:1,class:"plugin-list"},Nt=["onClick"],Ut={class:"type-tag"},jt={class:"base-info"},Et=["src"],Ft={class:"info"},Lt={class:"head"},At={class:"name zm-line1"},Vt={class:"source"},Jt={class:"version"},Wt={class:"action-box"},Yt={class:"left"},Gt={class:"right"},Ht=["href"],Kt=["onClick"],Qt={key:1},Xt=["onClick"],Zt={__name:"remotePlugins",props:{filterData:{type:Object,default:null}},emits:["installReport"],setup(A,{expose:I,emit:M}){const k=M,f=A,y=et(),d=g(null),T=g(!0),x=g([]),$=g({});K(()=>{C()});function v(){x.value=[],C()}async function C(){T.value=!0,await B(),$t(f.filterData).then(r=>{let l=(r==null?void 0:r.data)||[];l.forEach(e=>{var _;let{local:p,has_update:N}=((_=$.value)==null?void 0:_[e.name])||{};e.local=p,e.has_update=N}),x.value=l}).finally(()=>{T.value=!1})}async function B(){await ot().then(r=>{let l=(r==null?void 0:r.data)||[];k("installReport",l.length);let e={};l.forEach(p=>{e[p.local.name]={local:p.local,has_update:p.remote.latest_version!=p.local.version}}),$.value=e})}function m(r){y.push({path:"/plugins/detail",query:{name:r.name}})}function h(r){d.value.show(r,r.latest_version_detail,r.local||null)}return I({search:v}),(r,l)=>{const e=_t,p=Z,N=ut;return n(),o("div",zt,[T.value?(n(),P(ct,{key:0})):x.value.length?(n(),o("div",qt,[(n(!0),o(R,null,z(x.value,_=>(n(),o("div",{onClick:U=>m(_),key:_.name,class:"plugin-item"},[t("div",Ut,i(_.filter_type_title),1),t("div",jt,[t("img",{class:"avatar",src:_.icon},null,8,Et),t("div",Ft,[t("div",Lt,[t("span",At,i(_.title),1)]),t("div",Vt,i(_.author),1)])]),u(e,{title:J(mt)(_.description,_,14,1,0),placement:"top"},{default:b(()=>[t("div",{class:"desc zm-line1",ref_for:!0,ref:U=>J(gt)(U,_)},i(_.description),513)]),_:2},1032,["title"]),t("div",Jt,"版本：v"+i(_.latest_version),1),t("div",Wt,[t("div",Yt,[u(p,{name:"download"}),q(" "+i(_.installed_count||0),1)]),t("div",Gt,[_.help_url?(n(),o(R,{key:0},[t("a",{onClick:l[0]||(l[0]=F(()=>{},["stop"])),class:"c595959",href:_.help_url,target:"_blank"},"使用说明",8,Ht),u(N,{type:"vertical"})],64)):E("",!0),_.local?(n(),o(R,{key:1},[_.has_update?(n(),o("a",{key:0,onClick:F(U=>h(_),["stop"])},"更新",8,Kt)):(n(),o("span",Qt,"已安装"))],64)):(n(),o("a",{key:2,onClick:F(U=>h(_),["stop"])},"安装",8,Xt))])])],8,Nt))),128))])):(n(),P(at,{key:2,title:"暂无可用插件"})),u(dt,{ref_key:"updateRef",ref:d,onOk:C},null,512)])}}},te=W(Zt,[["__scopeId","data-v-d44ea48a"]]),ee={class:"head-box"},se={class:"base-info-box"},ne=["src"],ae={class:"info-box"},oe={class:"left"},le={class:"name zm-line1"},ie={class:"right"},ce={class:"link"},de={class:"tools-box"},_e={class:"info"},ue={class:"tit zm-line1"},re={class:"btns"},pe=["onClick"],fe=["onClick"],ve={class:"body-box"},he={key:0,class:"no-auth-box"},ge={key:1,class:"action-box"},me={class:"tit"},ye={class:"desc"},ke={class:"params"},$e={class:"params-box"},be={class:"field"},Ce={class:"name"},xe={class:"type"},we={key:0,class:"required"},Re={class:"desc"},De={__name:"feishu-config-box",emits:["del","edit","auth"],setup(A,{expose:I,emit:M}){const k=g(null),f=g(!1),y=g({}),d=g({}),T=g({}),x=st(()=>Object.keys(d.value).length);function $(l){y.value=l,C(),B(),f.value=!0}function v(){f.value=!1}function C(){lt({name:y.value.name}).then(l=>{d.value=tt(l==null?void 0:l.data,{})})}function B(){it({name:y.value.name,action:"default/get-schema",params:{}}).then(l=>{let e=(l==null?void 0:l.data)||{};for(let p in e)e[p].type!="node"&&delete e[p];T.value=e})}function m(){k.value.show(d.value)}function h(l,e){for(let p in d.value)d.value[p].is_default=p==e;Q({name:y.value.name,data:JSON.stringify(d.value)}).then(p=>{C()})}function r(l,e){Y.confirm({title:"提示",content:"确认删除该配置？",onOk:()=>{delete d.value[e],Q({name:y.value.name,data:JSON.stringify(d.value)}).then(p=>{C(),V.success("已删除")})}})}return I({show:$,hide:v}),(l,e)=>{const p=vt,N=ft,_=pt,U=ht;return n(),o("div",null,[u(U,{open:f.value,"onUpdate:open":e[1]||(e[1]=D=>f.value=D),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:b(()=>[t("div",ee,[t("div",se,[t("img",{class:"avatar",src:y.value.icon},null,8,ne),t("div",ae,[t("div",oe,[t("div",le,i(y.value.title),1),t("div",null,i(y.value.author),1)]),t("div",ie,[u(J(rt),{onClick:e[0]||(e[0]=D=>f.value=!1),class:"icon"})])])]),t("div",ce,i(y.value.description),1),x.value>0?(n(),P(_,{key:0,placement:"bottom"},{content:b(()=>[t("div",de,[(n(!0),o(R,null,z(d.value,(D,L)=>(n(),o("div",{key:L,class:"tool-item"},[e[3]||(e[3]=t("img",{class:"cover",src:It},null,-1)),t("div",_e,[t("div",ue,i(D.name),1),t("div",re,[D.is_default?(n(),P(p,{key:0,color:"#f50"},{default:b(()=>[...e[2]||(e[2]=[q("默认",-1)])]),_:1})):(n(),o("a",{key:1,onClick:s=>h(D,L)},"设为默认",8,pe)),t("a",{onClick:s=>r(D,L)},"删除",8,fe)])])]))),128))])]),default:b(()=>[u(N,{type:"primary",icon:nt(J(Dt)),class:"auth-btn",onClick:m},{default:b(()=>[q(" 已授权"+i(x.value)+"个凭证 ",1)]),_:1},8,["icon"])]),_:1})):(n(),P(N,{key:1,type:"primary",class:"auth-btn",onClick:m},{default:b(()=>[...e[4]||(e[4]=[q("立即授权",-1)])]),_:1}))]),t("div",ve,[x.value?(n(),o("div",ge,[(n(!0),o(R,null,z(T.value,(D,L)=>(n(),o("div",{key:L,class:"action-item"},[t("div",me,i(D.title),1),t("div",ye,i(D.desc),1),t("div",ke,[(n(!0),o(R,null,z(Object.keys(D.params).slice(0,3),(s,a)=>(n(),P(p,{key:a,bordered:!1},{default:b(()=>[q(i(s),1)]),_:2},1024))),128)),u(_,{placement:"right"},{content:b(()=>[t("div",$e,[(n(!0),o(R,null,z(D.params,(s,a)=>(n(),o("div",{key:a,class:"param-item"},[t("div",be,[t("span",Ce,i(a),1),t("span",xe,i(s.type),1),s.required?(n(),o("span",we,"必填")):E("",!0)]),t("div",Re,i(s.desc),1)]))),128))])]),default:b(()=>[e[8]||(e[8]=t("a",null,"参数",-1))]),_:2},1024)])]))),128))])):(n(),o("div",he,[e[5]||(e[5]=t("img",{src:Mt},null,-1)),e[6]||(e[6]=t("div",{class:"tit"},"需要授权",-1)),e[7]||(e[7]=t("div",{class:"desc"},"授权后，配置将显示在这里",-1)),t("a",{class:"link",onClick:m},"立即授权")]))])]),_:1},8,["open"]),u(Bt,{ref_key:"configModalRef",ref:k,onChange:C},null,512)])}}},Te=W(De,[["__scopeId","data-v-22974c28"]]),Oe={class:"head-box"},Pe={class:"base-info-box"},Ie=["src"],Me={class:"info-box"},Be={class:"left"},Se={class:"name zm-line1"},ze={class:"right"},qe={class:"link"},Ne={class:"body-box"},Ue={class:"action-box"},je={class:"tit"},Ee={class:"desc"},Fe={class:"params"},Le={class:"params-box"},Ae={class:"field"},Ve={class:"name"},Je={class:"type"},We={key:0,class:"required"},Ye={class:"desc"},Ge={__name:"config-box",emits:["del","edit","auth"],setup(A,{expose:I,emit:M}){const k=g(!1),f=g({}),y=g({});function d($){f.value=$,x(),k.value=!0}function T(){k.value=!1}function x(){it({name:f.value.name,action:"default/get-schema",params:{}}).then($=>{let v=($==null?void 0:$.data)||{};for(let C in v)v[C].type!="node"&&delete v[C];y.value=v})}return I({show:d,hide:T}),($,v)=>{const C=vt,B=pt,m=ht;return n(),o("div",null,[u(m,{open:k.value,"onUpdate:open":v[1]||(v[1]=h=>k.value=h),placement:"right",width:"400px",headerStyle:{display:"none"},bodyStyle:{padding:0}},{default:b(()=>[t("div",Oe,[t("div",Pe,[t("img",{class:"avatar",src:f.value.icon},null,8,Ie),t("div",Me,[t("div",Be,[t("div",Se,i(f.value.title),1),t("div",null,i(f.value.author),1)]),t("div",ze,[u(J(rt),{onClick:v[0]||(v[0]=h=>k.value=!1),class:"icon"})])])]),t("div",qe,i(f.value.description),1)]),t("div",Ne,[t("div",Ue,[(n(!0),o(R,null,z(y.value,(h,r)=>(n(),o("div",{key:r,class:"action-item"},[t("div",je,i(h.title),1),t("div",Ee,i(h.desc),1),t("div",Fe,[(n(!0),o(R,null,z(Object.keys(h.params).slice(0,3),(l,e)=>(n(),P(C,{key:e,bordered:!1},{default:b(()=>[q(i(l),1)]),_:2},1024))),128)),u(B,{placement:"right"},{content:b(()=>[t("div",Le,[(n(!0),o(R,null,z(h.params,(l,e)=>(n(),o("div",{key:e,class:"param-item"},[t("div",Ae,[t("span",Ve,i(e),1),t("span",Je,i(l.type),1),l.required?(n(),o("span",We,"必填")):E("",!0)]),t("div",Ye,i(l.desc),1)]))),128))])]),default:b(()=>[v[2]||(v[2]=t("a",null,"参数",-1))]),_:2},1024)])]))),128))])])]),_:1},8,["open"])])}}},He=W(Ge,[["__scopeId","data-v-68c19b2b"]]),Ke={class:"_plugin-box"},Qe={key:1,class:"plugin-list"},Xe=["onClick"],Ze={class:"type-tag"},ts={class:"base-info"},es=["src"],ss={class:"info"},ns={class:"head"},as={class:"name zm-line1"},os={class:"source"},ls={class:"version"},is={key:0,class:"tag"},cs={class:"action-box"},ds={class:"right"},_s=["onClick"],us=["href"],rs=["onClick"],ps=["onClick"],fs={class:"text-center mt24"},vs={__name:"installPlugins",props:{filterData:{type:Object,default:null}},emits:["installReport","tabChange"],setup(A,{expose:I,emit:M}){const k=M,f=A,y=et(),d=g(null),T=g(null),x=g(null),$=g(!0),v=g([]),C=["feishu_bitable","official_account_profile","official_batch_tag","official_send_template_message","official_send_message","official_intelligent_api","official_account_batch_send","official_account_comment"];K(()=>{l()});function B(s,a){if(!s)return null;const S=document.createElement("canvas").getContext("2d");S.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';const O=S.measureText(s).width,G=(a==null?void 0:a.title_width)||120;return O>G?s:null}function m(){v.value=[],l()}const h=g([]),r=st(()=>f.filterData.filter_type==0||f.filterData.filter_type==5?[...h.value,...v.value]:v.value);function l(){bt(f.filterData).then(s=>{let a=(s==null?void 0:s.data)||[];a=a.map(w=>{var S,O;return{...w.remote,local:w.local,has_update:((S=w.remote)==null?void 0:S.latest_version)!=((O=w.local)==null?void 0:O.version),installing:!1}}),h.value=a}),$.value=!0,ot(f.filterData).then(s=>{let a=(s==null?void 0:s.data)||[];k("installReport",a.length),a=a.map(w=>{var S,O;return{...w.remote,local:w.local,has_update:((S=w.remote)==null?void 0:S.latest_version)!=((O=w.local)==null?void 0:O.version),installing:!1}}),v.value=a}).finally(()=>{$.value=!1})}async function e(s){const a=()=>s.local.has_loaded=!s.local.has_loaded;if(!s.local.has_loaded)Y.confirm({title:"确认关闭该插件？",content:"关闭后，其他应用的位置都不可使用！确认关闭？",okText:"确定",cancelText:"取消",onOk:()=>{s.local.type=="trigger"?X({id:s.trigger_config_id,switch_status:0}).then(()=>{V.success("已关闭")}).catch(a):xt({name:s.name}).then(()=>{V.success("已关闭")}).catch(a)},onCancel(){a()}});else{if(s.local.type=="trigger"){X({id:s.trigger_config_id,switch_status:1}).then(()=>{V.success("已开启")});return}if(s.name=="feishu_bitable"){let{data:w}=await lt({name:s.name});if(w=tt(w,{}),!Object.keys(w).length)return a(),Y.confirm({title:"授权飞书应用接口权限",content:nt("div",{style:{color:" red"}},"请先完成信息配置，获取接口权限"),okText:"确定",cancelText:"取消",onOk:()=>{p(s)}})}wt({name:s.name}).then(()=>{V.success("已开启")}).catch(a)}}function p(s){T.value.show(s)}function N(s){Y.confirm({title:"确认删除该插件？",content:"删除后，其他应用的位置都不可使用！确认删除？",okText:"确定",cancelText:"取消",onOk:()=>{Ct({name:s.name}).then(()=>{V.success("已删除"),l()})}})}function _(s){s.local.type!="trigger"&&y.push({path:"/plugins/detail",query:{name:s.name}})}function U(s){s.name==="feishu_bitable"?p(s):x.value.show(s)}function D(s){d.value.show(s,s.latest_version_detail,s.local)}function L(s,a){s&&a&&(a.title_width=s.offsetWidth)}return I({search:m}),(s,a)=>{const w=_t,S=Tt,O=ut,G=ft;return n(),o("div",Ke,[$.value?(n(),P(ct,{key:0})):r.value.length?(n(),o("div",Qe,[(n(!0),o(R,null,z(r.value,c=>(n(),o("div",{onClick:j=>_(c),key:c.name,class:H(["plugin-item",{"trigger-plugin-item":c.local.type=="trigger"}])},[t("div",Ze,i(c.filter_type_title),1),t("div",ts,[t("img",{class:"avatar",src:c.icon},null,8,es),t("div",ss,[t("div",ns,[t("span",as,i(c.title),1)]),t("div",os,i(c.author),1)])]),u(w,{title:B(c.description,c),placement:"top"},{default:b(()=>[t("div",{class:"desc zm-line1",ref_for:!0,ref:j=>L(j,c)},i(c.description),513)]),_:2},1032,["title"]),t("div",ls,[q("版本：v"+i(c.local.version)+" ",1),c.has_update?(n(),o("span",is,"有更新")):E("",!0)]),t("div",cs,[t("div",{class:"left",onClick:a[0]||(a[0]=F(()=>{},["stop"]))},[u(S,{checked:c.local.has_loaded,"onUpdate:checked":j=>c.local.has_loaded=j,onChange:j=>e(c)},null,8,["checked","onUpdate:checked","onChange"])]),t("div",ds,[c.local.type!="trigger"?(n(),o("span",{key:0,class:"zm-link-pointer",onClick:F(j=>N(c),["stop"])},"删除",8,_s)):E("",!0),c.help_url?(n(),o(R,{key:1},[u(O,{type:"vertical"}),t("a",{onClick:a[1]||(a[1]=F(()=>{},["stop"])),class:"c595959",href:c.help_url,target:"_blank"},"使用说明",8,us)],64)):E("",!0),C.includes(c.name)||c.local.multiNode?(n(),o(R,{key:2},[u(O,{type:"vertical"}),t("a",{onClick:F(j=>U(c),["stop"])},"配置",8,rs)],64)):E("",!0),c.has_update?(n(),o(R,{key:3},[u(O,{type:"vertical"}),t("a",{onClick:F(j=>D(c),["stop"])},"更新",8,ps)],64)):E("",!0)])])],10,Xe))),128))])):(n(),P(at,{key:2,title:"暂未安装插件"},{desc:b(()=>[t("div",null,[a[4]||(a[4]=q("更多功能可到 ",-1)),t("a",{onClick:a[2]||(a[2]=c=>k("tabChange",3))},"探索>插件广场"),a[5]||(a[5]=q(" 中去添加",-1))]),t("div",fs,[u(G,{class:"btn",type:"primary",onClick:a[3]||(a[3]=c=>k("tabChange",3))},{default:b(()=>[...a[6]||(a[6]=[q("去添加",-1)])]),_:1})])]),_:1})),u(dt,{ref_key:"updateRef",ref:d,onOk:l},null,512),u(Te,{ref_key:"feishuRef",ref:T},null,512),u(He,{ref_key:"configRef",ref:x},null,512)])}}},hs=W(vs,[["__scopeId","data-v-f92e9e0a"]]),gs={class:"_container"},ms={class:"header"},ys={class:"main-tab-box"},ks={class:"content"},$s={class:"filter-box"},bs={class:"radio-tabs"},Cs=["onClick"],xs=["src"],ws={__name:"index",setup(A){const I=kt(),M=g(null),k=g(null),f=g(localStorage.getItem("zm:explore:active")||"2"),y=g([]),d=yt({title:"",filter_type:0});K(()=>{I.query.active>1&&M.value.change(I.query.active),T()});function T(){Rt().then(m=>{y.value=(m==null?void 0:m.data)||[]})}function x(){k.value.search()}function $(m){d.filter_type=m,x()}function v(m){m>1&&(f.value=m)}function C(m){M.value.change(m)}function B(){M.value.update()}return(m,h)=>{const r=Z,l=Pt;return n(),o("div",gs,[t("div",ms,[t("div",ys,[u(St,{ref_key:"tabRef",ref:M,onChange:v},null,512)])]),t("div",ks,[t("div",$s,[t("div",bs,[t("div",{onClick:h[0]||(h[0]=e=>$(0)),class:H(["radio-tab",{active:d.filter_type==0}])},[u(r,{name:"icon-all"}),h[2]||(h[2]=t("span",null,"全部",-1))],2),(n(!0),o(R,null,z(y.value,e=>(n(),o("div",{onClick:p=>$(e.id),key:e.id,class:H(["radio-tab",{active:e.id==d.filter_type}])},[t("img",{class:"icon",src:e.id==d.filter_type?e.icon_active_path:e.icon_path},null,8,xs),t("span",null,i(e.type_title),1)],10,Cs))),128))]),u(l,{value:d.title,"onUpdate:value":h[1]||(h[1]=e=>d.title=e),valueModifiers:{trim:!0},onChange:x,style:{width:"360px"},allowClear:"",placeholder:"搜索插件"},{suffix:b(()=>[u(J(Ot))]),_:1},8,["value"])]),f.value==3?(n(),P(te,{key:0,onInstallReport:B,filterData:d,ref_key:"pluginRef",ref:k},null,8,["filterData"])):(n(),P(hs,{key:1,onTabChange:C,onInstallReport:B,filterData:d,ref_key:"pluginRef",ref:k},null,8,["filterData"]))])])}}},Fs=W(ws,[["__scopeId","data-v-afae32d1"]]);export{Fs as default};
