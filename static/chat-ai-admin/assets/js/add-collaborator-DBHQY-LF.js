import{_ as K,f as Q,d as W,B as X}from"../../index-CB2DywzJ.js";import{c as Y,e as Z}from"./index-DNhlFGD2.js";import{F as U,e as ee,w as te,x as ae,a1 as se,U as oe,N as ne,V as le,M as ie,b as j}from"./ui-antd-BHaxN-GS.js";import{e as re,f as _,r as F,ac as u,ad as i,k as n,ar as o,as as r,az as v,G as c,F as N,ax as A,ae as k,u as de,at as h}from"./vue-chunks-CGLjTDrY.js";const ue={class:"form-box"},_e={key:0,class:"form-tip"},ce={key:0,class:"list-box"},pe=["onClick"],ve={class:"user-block"},fe={class:"name-box"},me={class:"name"},ye={class:"remark-text"},ge={key:1,class:"checkbox-list"},ke={class:"checklist-item"},he={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(be,{expose:B,emit:M}){const b=re(()=>Q().role_permission||[]),O=M,S=U.useForm,f=_(!1),l=F({identity_type:"1",operate_rights:"4"}),d=_([]),p=_([]),V=a=>{a.role_type!=1&&(d.value.includes(a.id)?d.value=d.value.filter(e=>e!=a.id):d.value.push(a.id))},z=F({}),{resetFields:xe,validate:Ce,validateInfos:Le}=S(l,z);let m=[],y=[];const q=(a,e)=>{P(),d.value=[],p.value=[],y=[],a.forEach(s=>{s.identity_type==1&&y.push(s.identity_id),s.identity_type==2&&p.value.push(s.identity_id)}),I(),l.operate_rights="4",l.identity_type="1",m=e,f.value=!0},g=_(!1),D=()=>{m=m.map(s=>({object_id:+s.object_id,object_type:+s.object_type,operate_rights:+l.operate_rights}));let a=[];if(l.identity_type==1?a=d.value:a=p.value,a.length==0){j.error("请选择成员或成员组织");return}let e={identity_type:l.identity_type,object_array:JSON.stringify(m),identity_ids:a.join(",")};g.value=!0,Z(e).then(s=>{j.success("保存成功"),f.value=!1,O("ok")}).finally(()=>{g.value=!1})},x=_([]),I=()=>{X({page:1,size:200}).then(a=>{x.value=a.data.list.filter(e=>!y.includes(e.id))})},C=_([]),P=()=>{Y().then(a=>{let e=a.data||[];C.value=e})},E=()=>{window.open("/#/user/manage")};return B({show:q}),(a,e)=>{const s=ae,L=te,w=ee,R=se,T=W,$=le,G=ne,J=U,H=ie;return i(),u("div",null,[n(H,{open:f.value,"onUpdate:open":e[3]||(e[3]=t=>f.value=t),title:"添加协作者",onOk:D,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:g.value},{default:o(()=>[r("div",ue,[n(J,{layout:"vertical"},{default:o(()=>[n(w,{label:"协作权限",required:""},{default:o(()=>[n(L,{value:l.operate_rights,"onUpdate:value":e[0]||(e[0]=t=>l.operate_rights=t)},{default:o(()=>[n(s,{value:"4"},{default:o(()=>[...e[4]||(e[4]=[c("管理",-1)])]),_:1}),n(s,{value:"2"},{default:o(()=>[...e[5]||(e[5]=[c("编辑",-1)])]),_:1}),n(s,{value:"1"},{default:o(()=>[...e[6]||(e[6]=[c("查看",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),n(w,{label:"协作者",required:""},{default:o(()=>[n(L,{value:l.identity_type,"onUpdate:value":e[1]||(e[1]=t=>l.identity_type=t)},{default:o(()=>[n(s,{value:"1"},{default:o(()=>[...e[7]||(e[7]=[c("按成员选",-1)])]),_:1}),n(s,{value:"2"},{default:o(()=>[...e[8]||(e[8]=[c("按组织架构",-1)])]),_:1})]),_:1},8,["value"]),b.value&&b.value.includes("TeamManage")?(i(),u("div",_e,[e[9]||(e[9]=c(" 如果协作者没有账号，请先到团队管理中添加账号 ",-1)),r("a",{onClick:E},"去添加")])):v("",!0)]),_:1}),l.identity_type==1?(i(),u("div",ce,[(i(!0),u(N,null,A(x.value,t=>(i(),u("div",{class:"type-item",key:t.value,onClick:we=>V(t)},[r("div",ve,[n(R,{shape:"square",src:t.avatar,size:40},{icon:o(()=>[t.avatar?v("",!0):(i(),k(de(oe),{key:0}))]),_:2},1032,["src"]),r("div",fe,[r("div",me,h(t.user_name),1),r("div",ye,h(t.nick_name),1)])]),d.value.includes(t.id)?(i(),k(T,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],8,pe))),128))])):v("",!0),l.identity_type==2?(i(),u("div",ge,[n(G,{value:p.value,"onUpdate:value":e[2]||(e[2]=t=>p.value=t),style:{width:"100%"}},{default:o(()=>[r("div",ke,[(i(!0),u(N,null,A(C.value,t=>(i(),k($,{key:t.id,value:t.id},{default:o(()=>[r("div",null,h(t.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):v("",!0)]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Ae=K(he,[["__scopeId","data-v-56afcf29"]]);export{Ae as A};
