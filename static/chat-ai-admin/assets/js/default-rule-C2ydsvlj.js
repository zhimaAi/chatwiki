import{u as X,_ as Y}from"../../index-DSFcP5NQ.js";import{M as Z}from"./model-select-CMPvMrAQ.js";import{am as ee,al as te,av as le}from"./index-Cg7-0swo.js";import{_ as oe}from"./emoji-mart-BBMRoEa3.js";import{I as _e,H as se,E as re,V as ne,r as ae,B as de,M as ie,N as pe,an as ce,s as me,x as ue,b as h}from"./ui-antd-Dl1wwwCD.js";import{E as L,c as ye,r as w,j as fe,w as he,a as m,p as _,y as n,v as d,u as r,q as v,t as i,F as ve,l as ge,b as c,_ as u,e as ke}from"./vue-chunks-BdaA73Wf.js";import"./neo4j-MWxXN7EM.js";import"./editor-cherry-CFIsbKoN.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./index-MT9fcN3v.js";const we={class:"default-rule-page"},be={class:"form-row"},Se={class:"form-label"},xe={class:"form-row"},Ce={class:"form-label"},ze={class:"module-card"},Ue={class:"module-card-header"},Ne={class:"module-card-title"},Re={key:0,class:"module-card-body"},Ae={class:"field"},Ve={class:"field-label"},Ie={key:0,class:"field"},Oe={class:"field-label"},Le={class:"tag-list"},Be={key:1,class:"field"},Me={class:"field-label"},Te={key:2,class:"field"},Je={class:"field-label"},Ke={key:3,class:"field"},De={class:"field-label"},$e={class:"module-card"},Ee={class:"module-card-header"},Fe={class:"module-card-title"},je={key:0,class:"module-card-body"},qe={class:"field"},He={class:"field-label"},Pe={class:"field"},Ge={class:"field-label"},Qe={class:"field"},We={class:"field-label"},Xe={class:"module-card"},Ye={class:"module-card-header"},Ze={class:"module-card-title"},et={key:0,class:"module-card-body"},tt={class:"field"},lt={class:"field-label"},ot={class:"page-right-footer"},_t={class:"task-modal"},st={key:0},rt={__name:"default-rule",setup(nt){const{t:l}=X("views.explore.ai-comment-management.default-rule"),R=l("delete_prompt_default"),C=l("reply_check_prompt_default"),b=l("reply_prompt_default"),S=l("reply_fixed_default"),A=l("elect_prompt_default"),e=L({id:"",rule_name:l("rule_name_default"),use_model:"",model_config_id:"",delete_comment_switch:1,delete_type:[1,2],delete_keywords:[],delete_condition:2,delete_priority:1,delete_prompt:R,reply_comment_switch:1,reply_check_prompt:C,reply_type:1,reply_prompt:"",elect_comment_switch:1,elect_prompt:""}),B=ye(()=>e.reply_type===1?l("reply_content_label"):l("reply_content_rule_label")),x=w(""),M=(s,t)=>{e.use_model=t.modelName,e.model_config_id=t.modelId},T=s=>{e.delete_keywords.splice(s,1)},J=()=>{const s=(x.value||"").trim();s&&(e.delete_keywords.includes(s)||e.delete_keywords.push(s),x.value="")},z=w(!1),V=w([]),U=w(!1),y=L({page:1,size:10,total:0}),I=w([]),K=[{title:l("task_column_task_name"),dataIndex:"task_name",key:"task_name"}],D=s=>{I.value=s.map(t=>String(t))},$=()=>{U.value=!0,te({page:y.page,size:y.size}).then(s=>{const t=(s==null?void 0:s.data)||{list:[],total:0};V.value=t.list||[],y.total=+t.total||0}).finally(()=>{U.value=!1})},E=s=>{y.page=s.current,y.size=s.pageSize,$()},F=()=>{ee({page:1,size:1,is_default:1}).then(s=>{var f,p;const t=((p=(f=s==null?void 0:s.data)==null?void 0:f.list)==null?void 0:p[0])||(Array.isArray(s==null?void 0:s.data)?s.data[0]:s==null?void 0:s.data)||null;if(t){if(e.id=t.id||"",e.rule_name=t.rule_name||l("rule_name_default"),e.use_model=t.use_model||e.use_model,e.model_config_id=t.model_config_id||e.model_config_id,e.delete_comment_switch=+t.delete_comment_switch||0,e.reply_comment_switch=+t.reply_comment_switch||0,e.elect_comment_switch=+t.elect_comment_switch||0,t.delete_comment_rule){let a=t.delete_comment_rule;if(typeof a=="string")try{a=JSON.parse(a)}catch{}e.delete_type=Array.isArray(a.type)?a.type:[],e.delete_keywords=Array.isArray(a.keywords)?a.keywords:[],e.delete_condition=+a.condition||e.delete_condition,e.delete_priority=+a.priority||e.delete_priority,e.delete_prompt=a.prompt||R}if(t.reply_comment_rule){let a=t.reply_comment_rule;if(typeof a=="string")try{a=JSON.parse(a)}catch{}e.reply_check_prompt=a.check_reply_prompt||C,e.reply_type=+a.reply_type||e.reply_type,e.reply_prompt=a.reply_prompt,e.reply_prompt||(e.reply_type==1?e.reply_prompt=S:e.reply_prompt=b)}if(t.elect_comment_rule){let a=t.elect_comment_rule;if(typeof a=="string")try{a=JSON.parse(a)}catch{}e.elect_prompt=a.prompt||A}}})},j=()=>{if(!String(e.rule_name||"").trim())return h.error(l("error_enter_rule_name"));if(!e.use_model)return h.error(l("error_select_model"));if(e.delete_comment_switch==1){const t=Array.isArray(e.delete_type)?e.delete_type:[],f=t.includes(1),p=t.includes(2);if(t.length===0)return h.error(l("error_delete_at_least_one_option"));if(f&&(!e.delete_keywords||e.delete_keywords.length===0))return h.error(l("error_enter_sensitive_words"));if(p&&!String(e.delete_prompt||"").trim())return h.error(l("error_enter_ai_detect_rule"))}if(e.reply_comment_switch==1){if(!String(e.reply_check_prompt||C))return h.error(l("error_enter_auto_reply_rule"));String(e.reply_prompt)||(e.reply_type==1?e.reply_prompt=S:e.reply_prompt=b)}if(e.elect_comment_switch==1&&!String(e.elect_prompt||A))return h.error(l("error_enter_auto_elect_rule"));const s={id:e.id,is_default:1,rule_name:e.rule_name,use_model:e.use_model,model_config_id:e.model_config_id,delete_comment_switch:e.delete_comment_switch,delete_comment_rule:JSON.stringify((()=>{const t=Array.isArray(e.delete_type)?e.delete_type:[],f=t.includes(2),p={type:t,keywords:e.delete_keywords,prompt:e.delete_prompt};return f&&(p.condition=e.delete_condition,p.priority=e.delete_priority),p})()),reply_comment_switch:e.reply_comment_switch,reply_comment_rule:JSON.stringify({check_reply_prompt:e.reply_check_prompt,reply_type:e.reply_type,reply_prompt:e.reply_prompt}),elect_comment_switch:e.elect_comment_switch,elect_comment_rule:JSON.stringify({prompt:e.elect_prompt})};le(s).then(()=>{h.success(l("save_success"))})};return fe(()=>{F()}),he(()=>e.reply_type,s=>{const t=String(e.reply_prompt||"");s===1?(!t.trim()||t===b)&&(e.reply_prompt=S):(!t.trim()||t===S)&&(e.reply_prompt=b)}),(s,t)=>{const f=_e,p=Y,a=se,O=pe,q=re,H=ce,k=ne,g=me,N=ae,P=de,G=ue,Q=ie;return c(),m("div",we,[_("div",be,[_("div",Se,d(r(l)("rule_name_label")),1),n(f,{value:e.rule_name,"onUpdate:value":t[0]||(t[0]=o=>e.rule_name=o),placeholder:r(l)("rule_name_placeholder"),style:{width:"300px"},disabled:""},null,8,["value","placeholder"])]),_("div",xe,[_("div",Ce,d(r(l)("model_label")),1),n(Z,{modelType:"LLM",modeName:e.use_model,"onUpdate:modeName":t[1]||(t[1]=o=>e.use_model=o),modeId:e.model_config_id,"onUpdate:modeId":t[2]||(t[2]=o=>e.model_config_id=o),style:{width:"300px"},placeholder:r(l)("select_model_placeholder"),onChange:M},null,8,["modeName","modeId","placeholder"])]),_("div",ze,[_("div",Ue,[_("div",Ne,[n(p,{name:"comment-delete",style:{"font-size":"16px","margin-right":"8px"}}),_("span",null,d(r(l)("module_delete_title")),1)]),n(a,{checked:e.delete_comment_switch,"onUpdate:checked":t[3]||(t[3]=o=>e.delete_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.delete_comment_switch==1?(c(),m("div",Re,[_("div",Ae,[_("div",Ve,d(r(l)("delete_rule_label")),1),n(q,{value:e.delete_type,"onUpdate:value":t[4]||(t[4]=o=>e.delete_type=o)},{default:i(()=>[n(O,{value:1},{default:i(()=>[u(d(r(l)("delete_rule_sensitive_word")),1)]),_:1}),n(O,{value:2},{default:i(()=>[u(d(r(l)("delete_rule_ai_detection")),1)]),_:1})]),_:1},8,["value"])]),(e.delete_type||[]).includes(1)?(c(),m("div",Ie,[_("div",Oe,d(r(l)("delete_sensitive_word_label")),1),_("div",Le,[(c(!0),m(ve,null,ge(e.delete_keywords,(o,W)=>(c(),ke(H,{key:o,closable:"",onClose:at=>T(W)},{default:i(()=>[u(d(o),1)]),_:2},1032,["onClose"]))),128))]),n(k,{value:x.value,"onUpdate:value":t[5]||(t[5]=o=>x.value=o),placeholder:r(l)("common_input_placeholder"),onBlur:J,"auto-size":{minRows:2}},null,8,["value","placeholder"])])):v("",!0),(e.delete_type||[]).includes(2)?(c(),m("div",Be,[_("div",Me,d(r(l)("delete_ai_rule_label")),1),n(k,{value:e.delete_prompt,"onUpdate:value":t[6]||(t[6]=o=>e.delete_prompt=o),placeholder:r(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])):v("",!0),(e.delete_type||[]).includes(2)?(c(),m("div",Te,[_("div",Je,d(r(l)("condition_label")),1),n(N,{value:e.delete_condition,"onUpdate:value":t[7]||(t[7]=o=>e.delete_condition=o)},{default:i(()=>[n(g,{value:1},{default:i(()=>[u(d(r(l)("condition_all")),1)]),_:1}),n(g,{value:2},{default:i(()=>[u(d(r(l)("condition_any")),1)]),_:1})]),_:1},8,["value"])])):v("",!0),(e.delete_type||[]).includes(2)?(c(),m("div",Ke,[_("div",De,d(r(l)("priority_label")),1),n(N,{value:e.delete_priority,"onUpdate:value":t[8]||(t[8]=o=>e.delete_priority=o)},{default:i(()=>[n(g,{value:1},{default:i(()=>[u(d(r(l)("priority_sensitive_first")),1)]),_:1}),n(g,{value:2},{default:i(()=>[u(d(r(l)("priority_ai_first")),1)]),_:1})]),_:1},8,["value"])])):v("",!0)])):v("",!0)]),_("div",$e,[_("div",Ee,[_("div",Fe,[n(p,{name:"comment-reply",style:{"font-size":"16px","margin-right":"8px"}}),_("span",null,d(r(l)("module_reply_title")),1)]),n(a,{checked:e.reply_comment_switch,"onUpdate:checked":t[9]||(t[9]=o=>e.reply_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.reply_comment_switch==1?(c(),m("div",je,[_("div",qe,[_("div",He,d(r(l)("auto_reply_rule_label")),1),n(k,{value:e.reply_check_prompt,"onUpdate:value":t[10]||(t[10]=o=>e.reply_check_prompt=o),placeholder:r(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])]),_("div",Pe,[_("div",Ge,d(r(l)("reply_content_label")),1),n(N,{value:e.reply_type,"onUpdate:value":t[11]||(t[11]=o=>e.reply_type=o)},{default:i(()=>[n(g,{value:1},{default:i(()=>[u(d(r(l)("reply_type_fixed")),1)]),_:1}),n(g,{value:2},{default:i(()=>[u(d(r(l)("reply_type_ai")),1)]),_:1})]),_:1},8,["value"])]),_("div",Qe,[_("div",We,d(B.value),1),n(k,{value:e.reply_prompt,"onUpdate:value":t[12]||(t[12]=o=>e.reply_prompt=o),placeholder:r(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])])):v("",!0)]),_("div",Xe,[_("div",Ye,[_("div",Ze,[n(p,{name:"comment-selected",style:{"font-size":"16px","margin-right":"8px"}}),_("span",null,d(r(l)("module_elect_title")),1)]),n(a,{checked:e.elect_comment_switch,"onUpdate:checked":t[13]||(t[13]=o=>e.elect_comment_switch=o),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),e.elect_comment_switch==1?(c(),m("div",et,[_("div",tt,[_("div",lt,d(r(l)("auto_elect_rule_label")),1),n(k,{value:e.elect_prompt,"onUpdate:value":t[14]||(t[14]=o=>e.elect_prompt=o),placeholder:r(l)("common_input_placeholder"),"auto-size":{minRows:3}},null,8,["value","placeholder"])])])):v("",!0)]),_("div",ot,[n(P,{type:"primary",onClick:j},{default:i(()=>[u(d(r(l)("btn_save_and_apply")),1)]),_:1})]),n(Q,{open:z.value,"onUpdate:open":t[15]||(t[15]=o=>z.value=o),title:r(l)("task_modal_title"),width:720,onOk:s.confirmSelectTasks,onCancel:t[16]||(t[16]=o=>z.value=!1)},{default:i(()=>[_("div",_t,[n(G,{columns:K,"data-source":V.value,"row-key":o=>String(o.id),loading:U.value,pagination:{current:y.page,pageSize:y.size,total:y.total,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:E,"row-selection":{selectedRowKeys:I.value,onChange:D,preserveSelectedRowKeys:!0}},{headerCell:i(({column:o})=>[typeof o.title=="string"?(c(),m("span",st,d(o.title),1)):v("",!0)]),_:1},8,["data-source","row-key","loading","pagination","row-selection"])])]),_:1},8,["open","title","onOk"])])}}},bt=oe(rt,[["__scopeId","data-v-ff3770a9"]]);export{bt as default};
//# sourceMappingURL=default-rule-C2ydsvlj.js.map
