import{A as K,_ as j,e as M,B as W,c as E}from"../../index-CyiwD4fB.js";import{C as Z}from"./cu-scroll-D0ctTl0C.js";import{_ as ee}from"./empty-DkpCLaix.js";import{j as n,a0 as F,r as g,A as te,L as a,M as _,V as e,Q as u,X as f,F as S,a1 as w,a2 as se,P as b,a8 as k,Y as p,u as N,a3 as Q,a4 as D,$ as oe}from"./vue-chunks-CwaUyaYI.js";import{c as ne}from"./index-BWAwk653.js";import{m as ie}from"./index-CnXWAABj.js";import{Q as V}from"./QuestionCircleOutlined-CGJPYPeU.js";import{_ as ae}from"./TextArea-CBrdn4Xi.js";import{_ as le}from"./index-D97187b8.js";import{_ as ce}from"./index-DJKcP780.js";import{_ as re}from"./index-B1XzzhJR.js";import{_ as _e}from"./index-DP3Kq1OL.js";import{S as de,a as ue,_ as me}from"./index-BfzgEQpv.js";import{S as pe}from"./index-DPSrDAUj.js";import"./dayjs-9pTjq58W.js";import"./axios-Cm0UX6qg.js";import"./qs-DFTLuGGg.js";import"./crypto-js-Dhiry31a.js";import"./FormItemContext-P-hc85qB.js";import"./index-B-VUp88E.js";import"./index-gIgkZ2l6.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./inputProps-CBCbV3dR.js";import"./colors-DcCY69fx.js";import"./DownOutlined-D6oDy9l0.js";import"./isMobile-D_4OiXLP.js";import"./slide-kUXvfLu3.js";import"./CheckOutlined-s6Wk7FwS.js";import"./SearchOutlined-eG2BTg8a.js";import"./move-7FTT7O3Y.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const fe=ve;function A(i){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?Object(arguments[c]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable}))),d.forEach(function(m){he(i,m,l[m])})}return i}function he(i,c,l){return c in i?Object.defineProperty(i,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[c]=l,i}var T=function(c,l){var d=A({},c,l.attrs);return n(K,A({},d,{icon:fe}),null)};T.displayName="LinkOutlined";T.inheritAttrs=!1;const ke=T,x=i=>(Q("data-v-2ec58c86"),i=i(),D(),i),ge={class:"recall-settings-box"},ye=x(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),be={class:"form-box"},xe={class:"form-item"},$e={class:"form-item-body"},Le={class:"form-item"},Oe={class:"form-item is-required"},Se=x(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),we={class:"form-item-body"},Re={class:"retrieval-mode-items"},Ce=["onClick"],ze={class:"retrieval-mode-title"},qe={class:"title-text"},Me={class:"retrieval-mode-desc"},Ne={class:"form-item"},Te={class:"form-item-label"},Be=x(()=>e("span",null,"Top K ",-1)),Ie={class:"form-item-body"},Pe={class:"number-box"},Ue={class:"number-slider-box"},Ve={class:"number-input-box"},Ae={class:"form-item"},je={class:"form-item-label"},Ee=x(()=>e("span",null,"相似度阈值 ",-1)),Fe={class:"form-item-body"},Qe={class:"number-box"},De={class:"number-slider-box"},He={class:"number-input-box"},Ge={class:"form-item"},Xe={class:"form-item-label"},Ye=x(()=>e("span",null,"Rerank模型",-1)),Je={class:"form-item-body"},Ke=["src"],We={__name:"recall-testing-form",emits:["save","load"],setup(i,{expose:c,emit:l}){const d=F(),m=g(!1),y=l,C=g([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=te({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:d.query.id}),B=(v,o)=>{t.rerank_model_config_id=o.rerank_model_config_id},$=v=>{t.search_type=v},z=()=>{if(!t.similarity)return M.error("请输入相似度");if(!t.size)return M.error("请输入分段数");if(!t.question)return M.error("请输入测试问题");let v={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(v.rerank_model_config_id=t.rerank_model_config_id),m.value=!0,y("load"),ie(v).then(o=>{y("save",o.data)}).catch(()=>{y("save",[])}).finally(()=>{m.value=!1})},L=g([]);return(()=>{ne({model_type:"RERANK"}).then(v=>{let o=v.data||[];L.value=o.map(h=>({id:h.model_config.id,name:h.model_info.model_name,icon:h.model_info.model_icon_url,children:h.model_info.rerank_model_list}))})})(),c({open}),(v,o)=>{const h=ae,H=W,q=E,I=le,P=ce,U=re,G=_e,X=de,Y=ue,J=me;return a(),_("div",ge,[ye,e("div",be,[e("div",xe,[e("div",$e,[n(h,{style:{height:"76px"},value:t.question,"onUpdate:value":o[0]||(o[0]=s=>t.question=s),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Le,[n(H,{loading:m.value,onClick:z,type:"primary",block:""},{default:u(()=>[f("测试")]),_:1},8,["loading"])]),e("div",Oe,[Se,e("div",we,[e("div",Re,[(a(!0),_(S,null,w(C.value,s=>(a(),_("div",{class:se(["retrieval-mode-item",{active:t.search_type==s.value}]),key:s.value,onClick:O=>$(s.value)},[t.search_type==s.value?(a(),b(q,{key:0,class:"check-arrow",name:"check-arrow-filled"})):k("",!0),e("div",ze,[n(q,{name:s.iconName,class:"title-icon"},null,8,["name"]),e("span",qe,p(s.title),1),s.isRecommendation?(a(),b(q,{key:0,class:"recommendation-icon",name:"recommendation"})):k("",!0)]),e("div",Me,p(s.desc),1)],10,Ce))),128))])])]),e("div",Ne,[e("div",Te,[Be,n(I,null,{title:u(()=>[f("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[n(N(V),{class:"question-icon"})]),_:1})]),e("div",Ie,[e("div",Pe,[e("div",Ue,[n(P,{class:"custom-slider",value:t.size,"onUpdate:value":o[1]||(o[1]=s=>t.size=s),min:1,max:10},null,8,["value"])]),e("div",Ve,[n(U,{value:t.size,"onUpdate:value":o[2]||(o[2]=s=>t.size=s),min:1,max:10},null,8,["value"])])])])]),e("div",Ae,[e("div",je,[Ee,n(I,null,{title:u(()=>[f("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:u(()=>[n(N(V),{class:"question-icon"})]),_:1})]),e("div",Fe,[e("div",Qe,[e("div",De,[n(P,{class:"custom-slider",value:t.similarity,"onUpdate:value":o[3]||(o[3]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])]),e("div",He,[n(U,{value:t.similarity,"onUpdate:value":o[4]||(o[4]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",Ge,[e("div",Xe,[Ye,f("   "),n(G,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":o[5]||(o[5]=s=>t.rerank_status=s)},null,8,["checked"])]),e("div",Je,[n(J,{value:t.rerank_use_model,"onUpdate:value":o[6]||(o[6]=s=>t.rerank_use_model=s),placeholder:"请选择Rerank模型",onChange:B,style:{width:"320px"}},{default:u(()=>[(a(!0),_(S,null,w(L.value,s=>(a(),b(Y,{key:s.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:s.icon,alt:""},null,8,Ke)])]),default:u(()=>[(a(!0),_(S,null,w(s.children,O=>(a(),b(X,{value:O,rerank_model_config_id:s.id,key:O},{default:u(()=>[e("span",null,p(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},Ze=j(We,[["__scopeId","data-v-2ec58c86"]]),R=i=>(Q("data-v-a430d6d6"),i=i(),D(),i),et={class:"recall-testing-box"},tt={class:"recall-from-box"},st={class:"content-list-box"},ot={key:0,class:"empty-box"},nt=R(()=>e("img",{src:ee,alt:""},null,-1)),it=R(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),at=[nt,it],lt={class:"top-block"},ct={class:"title"},rt={key:0,class:"ml4"},_t={class:"info-block"},dt=R(()=>e("span",{class:"gray-text"},"来自：",-1)),ut=["onClick"],mt=R(()=>e("span",{class:"v-line"},null,-1)),pt={class:"gray-text"},vt={key:0,class:"content-box"},ft={key:1,class:"content-box"},ht=["innerHTML"],kt={key:2,class:"loading-box"},gt={__name:"recall-testing",setup(i){F(),oe();const c=g(!1),l=g(!1),d=g([]),m=t=>{l.value=!1,d.value=t||[]},y=()=>{l.value=!0},C=t=>{window.open(`/#/library/preview?id=${t.file_id}`)};return(t,B)=>{const $=Z,z=E,L=pe;return a(),_("div",et,[e("div",tt,[n($,null,{default:u(()=>[n(Ze,{onLoad:y,onSave:m})]),_:1})]),e("div",st,[c.value||d.value.length===0?(a(),_("div",ot,at)):(a(),b($,{key:1},{default:u(()=>[(a(!0),_(S,null,w(d.value,r=>(a(),_("div",{class:"list-item",key:r.id},[e("div",lt,[e("div",ct,[f(" id："+p(r.id)+" ",1),r.title?(a(),_("div",rt,p(r.title),1)):k("",!0),e("span",null,"共"+p(r.word_total)+"个字符",1)])]),e("div",_t,[dt,e("div",{class:"link-text",onClick:v=>C(r)},[n(N(ke)),f(" "+p(r.file_name),1)],8,ut),mt,e("span",pt,[f("相似度： "),n(z,{name:"similarity",style:{"font-size":"16px"}}),f(" "+p(r.similarity),1)])]),r.question?(a(),_("div",vt,"Q："+p(r.question),1)):k("",!0),r.answer?(a(),_("div",ft,"A："+p(r.answer),1)):k("",!0),e("div",{class:"content-box",innerHTML:r.content},null,8,ht)]))),128))]),_:1})),l.value?(a(),_("div",kt,[n(L)])):k("",!0)])])}}},Jt=j(gt,[["__scopeId","data-v-a430d6d6"]]);export{Jt as default};
