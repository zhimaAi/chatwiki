import{e as J,ab as dt,aa as ht,f as A,r as kt,Y as c,_ as i,a5 as l,k as s,a2 as u,G as $,u as K,ae as v,a1 as Y,F as U,a9 as F,n as Q,a7 as R,A as W}from"./vue-chunks-Ci-XTWEs.js";import{k as qt,u as Dt,l as Kt,s as G,m as Lt,n as Pt,o as Vt,p as Mt,q as Ot}from"./index-CPuy80m4.js";import{b as yt,an as wt,ao as mt,ap as Bt}from"../../index-CPkdGIiL.js";import{u as gt}from"./robot-DsbzMi16.js";import{X as ft,k as vt,z as bt,B as St,u as Rt,a4 as Ut,ab as ct,p as Ct,ao as Yt,a8 as Nt,E as $t,y as xt,a as x,M as X,Z as At,Y as It,O as jt,d as Ft}from"./ui-antd-Bw8cEW5z.js";import"./utils-ChQO-_r6.js";import"./index-Bu5ae_-0.js";const Qt={class:"user-model-page"},Wt={class:"switch-block"},Jt={class:"search-block"},Gt={class:"left-block"},Xt={class:"search-item"},Zt={class:"search-item"},Ht={class:"right-block"},te={class:"list-box"},ee={key:0,class:"tags-wra flex"},ae={class:"popover-cont flex"},ne={key:0,class:"more-tag"},se={key:1,class:"tags-wra flex"},oe={class:"popover-cont flex"},ie={key:0,class:"more-tag"},le={key:2,style:{color:"#595959"}},_e=["onClick"],ue=["onClick"],re=["onClick"],ce={__name:"keywords-reply",setup(pt){const C=gt(),L=J(()=>C.keywordReplySwitchStatus==="1"),k=J(()=>C.keywordReplyAiReplyStatus==="1"),y=dt().query,b=ht(),O=A([{title:"规则名",dataIndex:"name",key:"name",width:120},{title:"模糊匹配",dataIndex:"half_keyword",key:"half_keyword",width:220},{title:"精准匹配",dataIndex:"full_keyword",key:"full_keyword",width:220},{title:"回复内容",dataIndex:"reply_content",key:"reply_content",width:120},{title:"启用状态",dataIndex:"switch_status",key:"switch_status",width:120},{title:"操作",dataIndex:"action",key:"action",width:120}]),g=kt({page:1,size:10,total:0}),Z=wt,f=A([]),B=A(!1),T=A(""),z=A(""),I=()=>{z.value,T.value;const _={robot_id:y.id,keyword:z.value||"",reply_type:T.value||"",page:g.page,size:g.size};B.value=!0,qt({..._}).then(a=>{const p=(a==null?void 0:a.data)||{list:[],total:0,page:g.page,size:g.size};f.value=(p.list||[]).map(r=>({...r,full_keyword:Array.isArray(r.full_keyword)?r.full_keyword:[],half_keyword:Array.isArray(r.half_keyword)?r.half_keyword:[],reply_content:Array.isArray(r.reply_content)?r.reply_content:[],switch_status:String(r.switch_status??"0")})),g.total=+p.total||0}).finally(()=>{B.value=!1})};I();const E=_=>{g.page=_.current,g.size=_.pageSize,I()},N=()=>{g.page=1,I()},H=_=>{T.value=_,N()},tt=()=>{b.push({path:"/robot/ability/auto-reply/add-rule",query:{id:y.id,robot_key:y.robot_key}})},et=_=>{b.push({path:"/robot/ability/auto-reply/add-rule",query:{id:y.id,robot_key:y.robot_key,rule_id:_.id}})},j=_=>{b.push({path:"/robot/ability/auto-reply/add-rule",query:{id:y.id,robot_key:y.robot_key,copy_id:_.id}})},at=_=>{const a=_?"1":"0";if(a==="0"){X.confirm({title:"提示",content:"关闭后，触发了关键词以及收到消息回复都不会再回复指定的内容",onOk:()=>{G({robot_id:y.id,ability_type:"robot_auto_reply",switch_status:a}).then(p=>{p&&p.res==0&&(C.setKeywordReplySwitchStatus(a),x.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:y.id}})))})}});return}G({robot_id:y.id,ability_type:"robot_auto_reply",switch_status:a}).then(p=>{p&&p.res==0&&(C.setKeywordReplySwitchStatus(a),x.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:y.id}})))})},nt=(_,a)=>{const p=a;Dt({id:_.id,robot_id:y.id,switch_status:p}).then(r=>{r&&r.res==0&&(_.switch_status=p,x.success("操作成功"))})},st=_=>{const a=_?"1":"0";Lt({robot_id:y.id,ability_type:"robot_auto_reply",ai_reply_status:a}).then(p=>{p&&p.res==0&&(C.setKeywordReplyAiReplyStatus(a),x.success("操作成功"))})},ot=_=>{X.confirm({title:"确认删除吗？",okText:"确认",onOk:()=>{Kt({id:_.id,robot_id:y.id}).then(a=>{a&&a.res==0&&(x.success("删除成功"),I())})}})};function it(_){return mt[_]||""}function lt(_){if(!Array.isArray(_))return"";const a=_.map(r=>it(r==null?void 0:r.type)).filter(r=>!!r);return[...new Set(a)].join("/")}return(_,a)=>{const p=ft,r=vt,_t=St,P=Rt,ut=Ut,rt=Ct,V=Yt,t=Nt,e=$t,o=xt;return i(),c("div",Qt,[l("div",Wt,[a[2]||(a[2]=l("span",{class:"switch-title"},"自动回复",-1)),s(p,{onChange:at,checked:L.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),a[3]||(a[3]=l("span",{class:"switch-desc"},"开启后，按照关键词回复和收到消息回复规则，回复指定的内容，优先级关键词回复>收到消息回复",-1))]),s(r,{"show-icon":""},{message:u(()=>a[4]||(a[4]=[l("p",null,"关键词回复内容支持设置图文链接，文字，图片，链接，小程序卡片",-1)])),_:1}),l("div",Jt,[l("div",Gt,[s(_t,{type:"primary",onClick:tt},{icon:u(()=>[s(K(bt))]),default:u(()=>[a[5]||(a[5]=$(" 新增规则 "))]),_:1,__:[5]}),l("div",Xt,[s(P,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=n=>T.value=n),placeholder:"回复类型",allowClear:"",options:K(Z),style:{width:"240px"},onChange:H},null,8,["modelValue","options"])]),l("div",Zt,[s(ut,{value:z.value,"onUpdate:value":a[1]||(a[1]=n=>z.value=n),placeholder:"关键词/规则名称搜索",allowClear:"",style:{width:"240px"},onSearch:N},null,8,["value"])])]),l("div",Ht,[a[8]||(a[8]=l("span",null,"触发后继续回复",-1)),s(rt,null,{title:u(()=>a[6]||(a[6]=[$("开关开启后，关键词回复后，继续触发收到消息自动回复，最后触发机器人回复")])),default:u(()=>[s(K(ct)),a[7]||(a[7]=$("： "))]),_:1,__:[7]}),s(p,{onChange:st,checked:k.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])]),l("div",te,[s(o,{columns:O.value,"data-source":f.value,loading:B.value,pagination:{current:g.page,total:g.total,pageSize:g.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:E},{bodyCell:u(({column:n,record:d})=>[n.key==="half_keyword"?(i(),c("div",ee,[(i(!0),c(U,null,F(d.half_keyword,(h,w)=>Q((i(),c("div",{class:"tag",key:w},[s(V,null,{default:u(()=>[$(R(h),1)]),_:2},1024)])),[[W,w<3]])),128)),s(t,null,{content:u(()=>[l("div",ae,[(i(!0),c(U,null,F(d.half_keyword,(h,w)=>Q((i(),c("div",{class:"tag",key:w},[s(V,null,{default:u(()=>[$(R(h),1)]),_:2},1024)])),[[W,w>=3]])),128))])]),default:u(()=>[d.half_keyword.length>3?(i(),c("div",ne,"+"+R(d.half_keyword.length-3),1)):v("",!0)]),_:2},1024)])):v("",!0),n.key==="full_keyword"?(i(),c("div",se,[(i(!0),c(U,null,F(d.full_keyword,(h,w)=>Q((i(),c("div",{class:"tag",key:w},[s(V,null,{default:u(()=>[$(R(h),1)]),_:2},1024)])),[[W,w<3]])),128)),s(t,null,{content:u(()=>[l("div",oe,[(i(!0),c(U,null,F(d.full_keyword,(h,w)=>Q((i(),c("div",{class:"tag",key:w},[s(V,null,{default:u(()=>[$(R(h),1)]),_:2},1024)])),[[W,w>=3]])),128))])]),default:u(()=>[d.full_keyword.length>3?(i(),c("div",ie,"+"+R(d.full_keyword.length-3),1)):v("",!0)]),_:2},1024)])):v("",!0),n.key==="reply_content"?(i(),c("span",le,R(lt(d.reply_content)||"--"),1)):v("",!0),n.key==="switch_status"?(i(),Y(p,{key:3,checked:d.switch_status,checkedValue:"1","un-checkedValue":"0","checked-children":"开","un-checked-children":"关",onChange:h=>nt(d,h)},null,8,["checked","onChange"])):v("",!0),n.key==="action"?(i(),Y(e,{key:4,gap:8},{default:u(()=>[l("a",{onClick:h=>et(d)},"编辑",8,_e),l("a",{onClick:h=>ot(d)},"删除",8,ue),l("a",{onClick:h=>j(d)},"复制",8,re)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},de=yt(ce,[["__scopeId","data-v-49724474"]]),ye={class:"user-model-page"},pe={class:"switch-block"},he={class:"search-block"},ke={class:"left-block"},we={class:"search-item"},me={class:"list-box"},ge={key:0},fe={key:1},ve={key:2},be={key:0,style:{color:"#595959"}},Se={key:1,style:{color:"#595959"}},Re={key:3,style:{color:"#595959"}},Ce={key:4,style:{color:"#595959","white-space":"pre-wrap"}},$e=["onClick"],xe=["onClick"],Ae=["onClick"],Ie={__name:"received-reply",setup(pt){const C=gt(),L=J(()=>C.keywordReplySwitchStatus==="1"),k=dt().query,y=ht(),b=A(k.rule_type||"receive_reply_message_type"),O=[{title:"消息类型",dataIndex:"message_type",key:"message_type",width:120},{title:"回复内容",dataIndex:"reply_content",key:"reply_content",width:120},{title:"回复方式",dataIndex:"reply_num",key:"reply_num",width:120},{title:"创建时间",dataIndex:"create_time",key:"create_time",width:120},{title:"启用状态",dataIndex:"switch_status",key:"switch_status",width:120},{title:"操作",dataIndex:"action",key:"action",width:120}],g=[{title:"时间段",dataIndex:"duration",key:"duration",width:220},{title:"回复内容",dataIndex:"reply_content",key:"reply_content",width:120},{title:"回复方式",dataIndex:"reply_num",key:"reply_num",width:120},{title:"优先级",dataIndex:"priority_num",key:"priority_num",width:120},{title:"创建时间",dataIndex:"create_time",key:"create_time",width:120},{title:"启用状态",dataIndex:"switch_status",key:"switch_status",width:120},{title:"操作",dataIndex:"action",key:"action",width:120}],Z=J(()=>b.value==="receive_reply_duration"?g:O),f=kt({page:1,size:10,total:0}),B=wt,T=A([]),z=A(!1),I=A(""),E=()=>{const t={robot_id:k.id,rule_type:b.value,reply_type:I.value||"",page:f.page,size:f.size};z.value=!0,Pt({...t}).then(e=>{const o=(e==null?void 0:e.data)||{list:[],total:0,page:f.page,size:f.size};T.value=(o.list||[]).map(n=>({...n,reply_content:Array.isArray(n.reply_content)?n.reply_content:[],switch_status:String(n.switch_status??"0"),duration_type:n.duration_type||"",start_duration:n.start_duration||"",end_duration:n.end_duration||"",priority_num:n.priority_num??"",message_type:String(n.message_type??""),specify_message_type:Array.isArray(n.specify_message_type)?n.specify_message_type:[]})),f.total=+o.total||0}).finally(()=>{z.value=!1})};E();const N=t=>{f.page=t.current,f.size=t.pageSize,E()},H=()=>{f.page=1,E()},tt=t=>{I.value=t,H()},et=()=>{f.page=1,E()};async function j(t){const e=Number(t.priority_num);if(!Number.isInteger(e)||e<0){x.error("请输入有效的优先级");return}try{await Vt({id:t.id,robot_id:k.id,priority_num:e}),x.success("优先级已更新"),E()}catch{}}const at=()=>{y.push({path:"/robot/ability/auto-reply/add-reply",query:{id:k.id,robot_key:k.robot_key,rule_type:b.value}})},nt=t=>{y.push({path:"/robot/ability/auto-reply/add-reply",query:{id:k.id,robot_key:k.robot_key,rule_id:t.id}})},st=t=>{y.push({path:"/robot/ability/auto-reply/add-reply",query:{id:k.id,robot_key:k.robot_key,copy_id:t.id}})},ot=t=>{const e=t?"1":"0";if(e==="0"){X.confirm({title:"提示",content:"关闭后，触发了关键词以及收到消息回复都不会再回复指定的内容",onOk:()=>{G({robot_id:k.id,ability_type:"robot_auto_reply",switch_status:e}).then(o=>{o&&o.res==0&&(C.setKeywordReplySwitchStatus(e),x.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:k.id}})))})}});return}G({robot_id:k.id,ability_type:"robot_auto_reply",switch_status:e}).then(o=>{o&&o.res==0&&(C.setKeywordReplySwitchStatus(e),x.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:k.id}})))})},it=(t,e)=>{const o=e;Mt({id:t.id,robot_id:k.id,switch_status:o}).then(n=>{n&&n.res==0&&(t.switch_status=o,x.success("操作成功"))})},lt=t=>{X.confirm({title:"确认删除吗？",okText:"确认",onOk:()=>{Ot({id:t.id,robot_id:k.id}).then(e=>{e&&e.res==0&&(x.success("删除成功"),E())})}})};function _(t){return mt[t]||""}function a(t){if(!Array.isArray(t))return"";const e=t.map(n=>_(n==null?void 0:n.type)).filter(n=>!!n);return[...new Set(e)].join("/")}function p(t){const e={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},o=String(t||"");return e[o]||o}function r(t){const e=String(t||"");return e?/^\d{4}-\d{2}-\d{2}/.test(e)?e.slice(0,10):e:""}function _t(t,e="YYYY-MM-DD"){return t?Ft(t*1e3).format(e):""}function P(t){const e=String(t||"");return e?/^\d{2}:\d{2}/.test(e)?e.slice(0,5):e:""}function ut(t){const e=(t==null?void 0:t.duration_type)||"",o=(t==null?void 0:t.week_duration)||"",n=(t==null?void 0:t.start_duration)||"",d=(t==null?void 0:t.end_duration)||"";if(e==="week"){const h=Array.isArray(o)?o.map(q=>String(q)):o?[String(o)]:[],w=h.length?h.map(q=>p(q)).join("、"):"",M=`${P(n)} 至 ${P(d)}`;return w?`每星期${w}：${M}`:`每星期：${M}`}if(e==="day")return`每天：${r(n)} 至 ${r(d)}`;if(e==="time_range"){const h=(t==null?void 0:t.start_day)||"",w=(t==null?void 0:t.end_day)||"",M=`${r(h)} ${P(n)}`.trim(),q=`${r(w)} ${P(d)}`.trim();return`自定义时间：
${M} 至 ${q}`}return`${e||""}：${n||""} 至 ${d||""}`}function rt(t){return Bt[String(t)]||String(t)}function V(t){if(String((t==null?void 0:t.message_type)??"")==="0")return"全部消息";const o=Array.isArray(t==null?void 0:t.specify_message_type)?t.specify_message_type:[];return o.length?o.map(rt).join("/"):"--"}return(t,e)=>{const o=ft,n=vt,d=At,h=It,w=St,M=Rt,q=Ct,Tt=jt,zt=$t,Et=xt;return i(),c("div",ye,[l("div",pe,[e[2]||(e[2]=l("span",{class:"switch-title"},"自动回复",-1)),s(o,{onChange:ot,checked:L.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e[3]||(e[3]=l("span",{class:"switch-desc"},"开启后，按照关键词回复和收到消息回复规则，回复指定的内容，优先级关键词回复>收到消息回复",-1))]),s(n,{"show-icon":""},{message:u(()=>e[4]||(e[4]=[l("p",null,"发送指定消息类型的内容自动回复对应的消息内容，相同的消息类型只会有一条生效的规则，优先级按时间设置>默认回复",-1),l("p",null,"数字越小，则优先级越高。优先级仅在时间相互冲突时有效，比如一个每天1-9点与一个每天3-10点，当8点钟触发时，则只会触发其中优先级最高的一个，满足时间段后，在时间间隔内不会再触发其他的规则",-1)])),_:1}),s(h,{activeKey:b.value,"onUpdate:activeKey":e[0]||(e[0]=m=>b.value=m),onChange:et,style:{"margin-top":"8px"}},{default:u(()=>[s(d,{key:"receive_reply_message_type",tab:"默认回复"}),s(d,{key:"receive_reply_duration",tab:"按时段设置"})]),_:1},8,["activeKey"]),l("div",he,[l("div",ke,[s(w,{type:"primary",onClick:at},{icon:u(()=>[s(K(bt))]),default:u(()=>[$(" "+R(b.value==="receive_reply_message_type"?"新增回复":"增加时段回复"),1)]),_:1}),l("div",we,[s(M,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=m=>I.value=m),placeholder:"回复内容",allowClear:"",options:K(B),style:{width:"240px"},onChange:tt},null,8,["modelValue","options"])])])]),l("div",me,[s(Et,{columns:Z.value,"data-source":T.value,loading:z.value,pagination:{current:f.page,total:f.total,pageSize:f.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:N},{headerCell:u(({column:m})=>[m.key==="priority_num"?(i(),c("span",ge,[e[5]||(e[5]=$(" 优先级 ")),s(q,{title:"优先级设置的数值不能重复，数值越小，优先级越高"},{default:u(()=>[s(K(ct))]),_:1})])):m.key==="switch_status"?(i(),c("span",fe,[e[6]||(e[6]=$(" 启用状态 ")),s(q,{title:b.value==="receive_reply_message_type"?"开启开关后，触发消息类型回复指定的内容":"开启后，按照设置的时间段回复指定的内容"},{default:u(()=>[s(K(ct))]),_:1},8,["title"])])):(i(),c("span",ve,R(m.title),1))]),bodyCell:u(({column:m,record:S})=>[m.key==="message_type"?(i(),c("span",be,R(V(S)),1)):v("",!0),m.key==="reply_content"?(i(),c("span",Se,R(a(S.reply_content)||"--"),1)):v("",!0),m.key==="reply_num"?(i(),c(U,{key:2},[$(R(S.reply_num==0?"全部回复":"随机回复一条"),1)],64)):v("",!0),m.key==="create_time"?(i(),c("span",Re,R(_t(S.create_time)||"--"),1)):v("",!0),m.key==="duration"?(i(),c("span",Ce,R(ut(S)),1)):v("",!0),m.key==="priority_num"?(i(),Y(Tt,{key:5,value:S.priority_num,"onUpdate:value":D=>S.priority_num=D,min:1,max:100,precision:0,style:{width:"96px"},onBlur:D=>j(S),onPressEnter:D=>j(S)},null,8,["value","onUpdate:value","onBlur","onPressEnter"])):v("",!0),m.key==="switch_status"?(i(),Y(o,{key:6,checked:S.switch_status,checkedValue:"1","un-checkedValue":"0","checked-children":"开","un-checked-children":"关",onChange:D=>it(S,D)},null,8,["checked","onChange"])):v("",!0),m.key==="action"?(i(),Y(zt,{key:7,gap:8},{default:u(()=>[l("a",{onClick:D=>nt(S)},"编辑",8,$e),l("a",{onClick:D=>lt(S)},"删除",8,xe),l("a",{onClick:D=>st(S)},"复制",8,Ae)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Te=yt(Ie,[["__scopeId","data-v-b2c17bd5"]]),ze={class:"auto-reply-home"},Ee={__name:"index",setup(pt){const C=dt(),L=A(C.query.active_key||"keywords");return(k,y)=>{const b=At,O=It;return i(),c("div",ze,[s(O,{activeKey:L.value,"onUpdate:activeKey":y[0]||(y[0]=g=>L.value=g)},{default:u(()=>[s(b,{key:"keywords",tab:"关键词回复"},{default:u(()=>[s(de)]),_:1}),s(b,{key:"received",tab:"收到消息回复"},{default:u(()=>[s(Te)]),_:1})]),_:1},8,["activeKey"])])}}},Oe=yt(Ee,[["__scopeId","data-v-a63ffd6c"]]);export{Oe as default};
