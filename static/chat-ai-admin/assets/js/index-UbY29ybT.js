import{e as G,aa as J,f as A,o as Z,Y as i,_ as r,a5 as a,k as l,a2 as c,G as m,u as k,F as M,ab as C,a7 as p,ae as D,B as K,a9 as Q}from"./vue-chunks-DCKTEHpB.js";import{b as W,d as X,s as L}from"./index-CTy81fs2.js";import{u as tt}from"./robot-4RO1uura.js";import{J as et,k as st,a3 as nt,B as ot,Z as at,ao as it,e as rt,f as lt,h as ut,d as dt,M as E,a as v}from"./ui-antd-D64OvTpt.js";import{_ as T,o as _t}from"../../index-C1Xsov4S.js";import{L as ct}from"./list-empty-DN3TC7vS.js";import"./index-DLEjqKv8.js";import"./utils-D9NMMoMR.js";const pt={class:"user-model-page"},ht={class:"switch-block"},mt={class:"search-block"},yt={class:"left-block"},ft={class:"list-box"},kt={key:0,class:"list-empty"},vt={key:1,class:"list-grid"},bt={class:"card-header"},xt={class:"card-content"},gt={class:"card-title"},wt={class:"card-text"},St={key:0,class:"line-text"},At={key:1,class:"empty-line"},Mt=["innerHTML"],Ct={key:3,href:"javascript:;",class:"link"},Dt={key:0},Lt={class:"card-footer"},Et={class:"footer-left"},Tt={class:"menu-name"},Rt={class:"update-time"},Yt={__name:"smart-menu",setup(R){const h=tt(),b=G(()=>h.smartMenuSwitchStatus==="1"),d=J().query,x=Q(),g=A(!1),y=A([]),Y=_t,w=()=>{const s={robot_id:d.id};g.value=!0,W({...s}).then(e=>{const t=(e==null?void 0:e.data)||{list:[]};y.value=(t.list||[]).map(n=>({id:Number(n.id||0),menu_title:n.menu_title||"",update_time:Number(n.update_time||n.create_time||0),avatar_url:n.avatar_url||"",switch_status:String(n.switch_status??"0"),priority_num:Number(n.priority_num||0),reply_num:Number(n.reply_num||0),reply_content:Array.isArray(n.reply_content)?n.reply_content:[],menu_content:Array.isArray(n.menu_content)?n.menu_content:[],menu_description:n.menu_description||""}))}).catch(()=>{}).finally(()=>{g.value=!1})};function N(s){const e=[];return(Array.isArray(s)?s:[]).forEach(t=>{const n=(t==null?void 0:t.type)||(t==null?void 0:t.reply_type);if(n==="text")t!=null&&t.description&&e.push({text:t.description});else if(n==="imageText"){const o=(t==null?void 0:t.title)||(t==null?void 0:t.description)||"图文链接";e.push({text:o,url:t==null?void 0:t.url})}else if(n==="url"){const o=(t==null?void 0:t.title)||"链接";e.push({text:o,url:t==null?void 0:t.url})}else if(n==="image")e.push({text:"图片"});else if(n==="card"){const o=(t==null?void 0:t.title)||"小程序卡片";e.push({text:o})}}),e.slice(0,8)}function B(s){const e=[];return(Array.isArray(s)?s:[]).forEach(t=>{const n=String((t==null?void 0:t.menu_type)||""),o=String((t==null?void 0:t.content)||"");if(n==="0")if(o==="")e.push({kind:"newline"});else if(/<a[\s\S]*?<\/a>/.test(o)){const f=/href\s*=\s*['"]\s*#\s*['"]/i.test(o)?o.replace(/href\s*=\s*['"]\s*#\s*['"]/ig,'href="javascript:;"'):o.replace(/href=/ig,'target="_blank" href=');e.push({kind:"html",html:f})}else e.push({kind:"text",text:o});else n==="1"&&e.push({kind:"keyword",text:o,serial_no:(t==null?void 0:t.serial_no)||""})}),e.slice(0,20)}function F(s){return Array.isArray(s==null?void 0:s.menu_content)&&s.menu_content.length?B(s.menu_content):N((s==null?void 0:s.reply_content)||[])}function O(s){var n,o;const e=(o=(n=s.target)==null?void 0:n.closest)==null?void 0:o.call(n,"a");if(!e)return;const t=String(e.getAttribute("href")||"");(t==="#"||t==="javascript:;")&&(s.preventDefault(),s.stopPropagation())}const q=()=>{x.push({path:"/robot/ability/smart-menu/add-rule",query:{id:d.id,robot_key:d.robot_key}})},V=s=>{x.push({path:"/robot/ability/smart-menu/add-rule",query:{id:d.id,robot_key:d.robot_key,rule_id:s.id}})},j=s=>{E.confirm({title:"确认删除吗？",okText:"确认",onOk:()=>{X({id:s.id,robot_id:d.id}).then(e=>{e&&e.res==0&&(v.success("删除成功"),w())})}})},I=s=>{const e=s?"1":"0";if(!s){E.confirm({title:"确认关闭智能菜单吗？",okText:"确认",cancelText:"取消",onOk(){L({robot_id:d.id,ability_type:"robot_smart_menu",switch_status:e}).then(t=>{t&&t.res==0&&(h.setSmartMenuSwitchStatus(e),v.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:d.id}})))})}});return}L({robot_id:d.id,ability_type:"robot_smart_menu",switch_status:e}).then(t=>{t&&t.res==0&&(h.setSmartMenuSwitchStatus(e),v.success("操作成功"),window.dispatchEvent(new CustomEvent("robotAbilityUpdated",{detail:{robotId:d.id}})))})};function $(s,e="YYYY-MM-DD"){return s?dt(s*1e3).format(e):""}return Z(async()=>{w()}),(s,e)=>{const t=et,n=st,o=ot,f=at,S=lt,z=rt,P=ut;return r(),i("div",pt,[a("div",ht,[e[2]||(e[2]=a("span",{class:"switch-title"},"智能菜单",-1)),l(t,{onChange:I,checked:b.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e[3]||(e[3]=a("span",{class:"switch-desc"}," 开启后，该智能菜单可以被关键词回复等功能调用 ",-1))]),l(n,null,{message:c(()=>[...e[4]||(e[4]=[a("p",null,"智能菜单是一种便捷的问题组合，客户可以点击菜单选项，直接触发对应的自动回复。",-1),a("p",null,"使用方法：第一步先添加智能菜单，第二步在各种自动回复内调用智能菜单，比如在关键词回复内引用这个菜单，那么在客户发送消息时，就会回复对应的菜单",-1)])]),_:1}),a("div",mt,[a("div",yt,[l(o,{type:"primary",onClick:q},{icon:c(()=>[l(k(nt))]),default:c(()=>[e[5]||(e[5]=m(" 新增智能菜单 ",-1))]),_:1})])]),a("div",ft,[y.value.length===0?(r(),i("div",kt,[l(ct,{size:"200"})])):(r(),i("div",vt,[(r(!0),i(M,null,C(y.value,_=>(r(),i("div",{class:"list-card",key:_.id},[a("div",bt,[l(f,{src:_.avatar_url||k(Y),size:40,shape:"square",class:"sm-avatar"},null,8,["src"]),a("div",xt,[a("div",gt,p(_.menu_description),1),a("div",wt,[(r(!0),i(M,null,C(F(_),(u,U)=>(r(),i("div",{key:U,class:"reply-line",onClick:e[0]||(e[0]=H=>O(H))},[u.kind==="text"?(r(),i("span",St,p(u.text),1)):u.kind==="newline"?(r(),i("div",At)):u.kind==="html"?(r(),i("span",{key:2,innerHTML:u.html},null,8,Mt)):u.kind==="keyword"?(r(),i("a",Ct,[u.serial_no?(r(),i("div",Dt,p(u.serial_no),1)):D("",!0),m(" "+p(u.text),1)])):D("",!0)]))),128))])])]),a("div",Lt,[a("div",Et,[a("div",Tt,p(_.menu_title),1),a("div",Rt,"更新于"+p($(_.update_time,"YYYY-MM-DD")),1)]),l(P,{placement:"bottomRight"},{overlay:c(()=>[l(z,null,{default:c(()=>[l(S,{key:"edit",onClick:u=>V(_)},{default:c(()=>[...e[6]||(e[6]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(S,{key:"del",onClick:u=>j(_),style:{color:"#FF4D4F"}},{default:c(()=>[...e[7]||(e[7]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:c(()=>[a("a",{class:"more-btn",onClick:e[1]||(e[1]=K(()=>{},["prevent"]))},[l(k(it))])]),_:2},1024)])]))),128))]))])])}}},Nt=T(Yt,[["__scopeId","data-v-39b1b6a7"]]),Bt={class:"auto-reply-home"},Ft={__name:"index",setup(R){return(h,b)=>(r(),i("div",Bt,[l(Nt)]))}},Ut=T(Ft,[["__scopeId","data-v-1eed1299"]]);export{Ut as default};
