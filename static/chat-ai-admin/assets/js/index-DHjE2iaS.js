import{aw as be,e as H,l,f as F,o as Se,b as ve,ac as C,ad as k,k as L,ar as M,F as P,ax as de,ae as I,aA as N,u as j,G,at as W,B as Re,ai as Me,d as Ae,as as ye,az as qe,aB as xe,av as Ce}from"./vue-chunks-CGLjTDrY.js";import{u as D}from"./robot-j5RxAo6l.js";import{_ as me,d as u,ae as ge}from"../../index-WMhSApoa.js";import{g as Ke}from"./index-CHNVlDjk.js";import{i as $e,aC as Ie,h as Le}from"./ui-antd-BDReVt-O.js";import{T as Te}from"./top-header-B-4ba51v.js";import"./index-CtAh6k0_.js";import"./neo4j-CK9lNpyi.js";import"./utils-DXEytJvC.js";import"./other-BrZCAsTs.js";import"./add-group-CORu2AJo.js";import"./index-BafABkdm.js";const Be={class:"left-menu-box"},ze={__name:"left-menu",props:{robotInfo:{type:Object,default:()=>{}}},emits:["changeMenu"],setup(b,{emit:T}){const i=be(),s=D(),g=b,r=i.query,q=H(()=>{const o=U.value.find(n=>n.id==="function-center"),a=(o==null?void 0:o.children)||[],c=a.find(n=>n.id==="auto-reply");if(i.path.split("/")[3]==="auto-reply"&&!c)return["function-center"];const t=a.find(n=>n.id==="subscribe-reply");if(i.path.split("/")[3]==="subscribe-reply"&&!t)return["function-center"];const m=a.find(n=>n.id==="smart-menu");if(i.path.split("/")[3]==="smart-menu"&&!m)return["function-center"];const x=a.find(n=>n.id==="payment");return i.path.split("/")[3]==="payment"&&!x?["function-center"]:[i.path.split("/")[3]]}),K=[{key:"workflow",id:"workflow",icon:()=>l(u,{name:"workflow",class:"menu-icon"}),label:"工作流编排",title:"工作流编排",path:"/robot/config/workflow",menuIn:["1"]},{key:"basic-config",id:"basic-config",icon:()=>l(u,{name:"jichupeizhi",class:"menu-icon"}),label:"基础配置",title:"基础配置",path:"/robot/config/basic-config",menuIn:["0"]},{key:"library-config",id:"library-config",icon:()=>l(u,{name:"guanlianzhishiku",class:"menu-icon"}),label:"知识库",title:"知识库",path:"/robot/config/library-config",menuIn:["0"]},{key:"skill-config",id:"skill-config",icon:()=>l(u,{name:"skii",class:"menu-icon"}),label:"工作流",title:"工作流",path:"/robot/config/skill-config",menuIn:["0"]},{key:"function-center",id:"function-center",icon:()=>l(u,{name:"function-center",class:"menu-icon"}),label:"功能中心",title:"功能中心",path:"/robot/config/function-center",menuIn:["0","1"]},{key:"external-services",id:"external-services",icon:()=>l(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"对外服务",title:"对外服务",path:"/robot/config/external-services",menuIn:["0","1"]},{key:"test",id:"test",icon:()=>l(u,{name:"liaotianceshi",class:"menu-icon"}),label:"聊天测试",title:"聊天测试",path:"/robot/test",query:{robot_key:g.robotInfo.robot_key,id:g.robotInfo.id},target:"_blank",menuIn:["0","1"]},{key:"qa-feedbacks",id:"qa-feedbacks",icon:()=>l(u,{name:"qa-feedback",class:"menu-icon"}),label:"问答反馈",title:"问答反馈",path:"/robot/config/qa-feedbacks",menuIn:["0","1"]},{key:"session-record",id:"session-record",icon:()=>l(u,{name:"session-record",class:"menu-icon"}),label:"会话记录",title:"会话记录",path:"/robot/config/session-record",query:{robot_key:g.robotInfo.robot_key,id:g.robotInfo.id},menuIn:["0","1"]},{key:"api-key-manage",id:"api-key-manage",icon:()=>l(u,{name:"duiwaifuwu",class:"menu-icon"}),label:"API Key管理",title:"API Key管理",path:"/robot/config/api-key-manage",menuIn:["0","1"]},{key:"unknown_issue",id:"unknown_issue",icon:()=>l(u,{name:"unknown-issue",class:"menu-icon"}),label:"未知问题",title:"未知问题",path:"/robot/config/unknown_issue",menuIn:["0","1"]},{key:"statistical_analysis",id:"statistical_analysis",icon:()=>l(u,{name:"statistical-analysis",class:"menu-icon"}),label:"统计分析",title:"统计分析",path:"/robot/config/statistical_analysis",menuIn:["0","1"]},{key:"export-record",id:"export-record",icon:()=>l(u,{name:"export-record",class:"menu-icon"}),label:"导出记录",title:"导出记录",path:"/robot/config/export-record",menuIn:["0","1"]},{key:"invoke-logs",id:"invoke-logs",icon:()=>l(u,{name:"doc-file",class:"menu-icon"}),label:"调用日志",title:"调用日志",path:"/robot/config/invoke-logs",menuIn:["1"]}],R=F(null),$=F(null),B=F(null),z=F(null);async function O(){var o,a,c,t,m,x,n,h,Q,X,Y,Z,ee,ne,oe,te,se,ae,ie,re,ce,le,ue,pe,fe,_e;try{const E=((o=g.robotInfo)==null?void 0:o.id)||r.id;if(!E)return;const V=await Ke({robot_id:E}),A=(V==null?void 0:V.data)||[],f=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_auto_reply");if(f){const e=((a=f==null?void 0:f.robot_config)==null?void 0:a.switch_status)??((c=f==null?void 0:f.user_config)==null?void 0:c.switch_status)??"0",p=((t=f==null?void 0:f.robot_config)==null?void 0:t.ai_reply_status)??((m=f==null?void 0:f.user_config)==null?void 0:m.ai_reply_status)??"0";s.setKeywordReplySwitchStatus(String(e)),s.setKeywordReplyAiReplyStatus(String(p))}else s.setKeywordReplySwitchStatus("0"),s.setKeywordReplyAiReplyStatus("0");const w=(A||[]).find(e=>{var p;return(e==null?void 0:e.ability_type)==="robot_auto_reply"&&((p=e==null?void 0:e.robot_config)==null?void 0:p.fixed_menu)==="1"});w?R.value={key:"auto-reply",id:"auto-reply",icon:()=>l(u,{name:"auto-reply",class:"menu-icon"}),label:(x=w==null?void 0:w.menu)==null?void 0:x.name,title:(n=w==null?void 0:w.menu)==null?void 0:n.name,path:((h=w==null?void 0:w.menu)==null?void 0:h.path)||"/robot/ability/auto-reply",menuIn:["0","1"]}:R.value=null;const _=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_subscribe_reply");if(_){const e=((Q=_==null?void 0:_.robot_config)==null?void 0:Q.switch_status)??((X=_==null?void 0:_.user_config)==null?void 0:X.switch_status)??"0",p=((Y=_==null?void 0:_.robot_config)==null?void 0:Y.ai_reply_status)??((Z=_==null?void 0:_.user_config)==null?void 0:Z.ai_reply_status)??"0";s.setSubscribeReplySwitchStatus(String(e)),s.setSubscribeReplyAiReplyStatus(String(p))}else s.setSubscribeReplySwitchStatus("0"),s.setSubscribeReplyAiReplyStatus("0");!1||($.value=null);const d=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_smart_menu");if(d){const e=((ee=d==null?void 0:d.robot_config)==null?void 0:ee.switch_status)??((ne=d==null?void 0:d.user_config)==null?void 0:ne.switch_status)??"0",p=((oe=d==null?void 0:d.robot_config)==null?void 0:oe.ai_reply_status)??((te=d==null?void 0:d.user_config)==null?void 0:te.ai_reply_status)??"0";s.setSmartMenuSwitchStatus(String(e)),s.setSmartMenuAiReplyStatus(String(p))}else s.setSmartMenuSwitchStatus("0"),s.setSmartMenuAiReplyStatus("0");const S=(A||[]).find(e=>{var p;return(e==null?void 0:e.ability_type)==="robot_smart_menu"&&((p=e==null?void 0:e.robot_config)==null?void 0:p.fixed_menu)==="1"});S?B.value={key:"smart-menu",id:"smart-menu",icon:()=>l(u,{name:"smart-menu",class:"menu-icon"}),label:(se=S==null?void 0:S.menu)==null?void 0:se.name,title:(ae=S==null?void 0:S.menu)==null?void 0:ae.name,path:((ie=S==null?void 0:S.menu)==null?void 0:ie.path)||"/robot/ability/smart-menu",menuIn:["0","1"]}:B.value=null;const y=(A||[]).find(e=>(e==null?void 0:e.ability_type)==="robot_payment");if(y){const e=((re=y==null?void 0:y.robot_config)==null?void 0:re.switch_status)??((ce=y==null?void 0:y.user_config)==null?void 0:ce.switch_status)??"0",p=((le=y==null?void 0:y.robot_config)==null?void 0:le.ai_reply_status)??((ue=y==null?void 0:y.user_config)==null?void 0:ue.ai_reply_status)??"0";s.setPaymentSwitchStatus(String(e)),s.setPaymentAiReplyStatus(String(p))}else s.setPaymentSwitchStatus("0"),s.setPaymentAiReplyStatus("0");const v=(A||[]).find(e=>{var p;return(e==null?void 0:e.ability_type)==="robot_payment"&&((p=e==null?void 0:e.robot_config)==null?void 0:p.fixed_menu)==="1"});v?z.value={key:"payment",id:"payment",icon:()=>l(u,{name:"payment",class:"menu-icon"}),label:(pe=v==null?void 0:v.menu)==null?void 0:pe.name,title:(fe=v==null?void 0:v.menu)==null?void 0:fe.name,path:((_e=v==null?void 0:v.menu)==null?void 0:_e.path)||"/robot/ability/payment",menuIn:["0","1"]}:z.value=null}catch(E){console.warn("refreshAbilityMenu failed",E)}}function J(o){var t,m;const a=((t=g.robotInfo)==null?void 0:t.id)||r.id,c=(m=o==null?void 0:o.detail)==null?void 0:m.robotId;!c||!a||String(c)!==String(a)||O()}Se(()=>{O(),window.addEventListener("robotAbilityUpdated",J)}),ve(()=>{window.removeEventListener("robotAbilityUpdated",J)});const U=H(()=>{let o=K;ge(r.id)==1?o=o.filter(t=>t.id=="external-services"):o=o.filter(t=>{var m;return t.menuIn.includes((m=g.robotInfo)==null?void 0:m.application_type)});const a=[...o],c=a.findIndex(t=>t.id==="function-center");if(c>=0){const t=[];R.value&&t.push(R.value),$.value&&t.push($.value),B.value&&t.push(B.value),z.value&&t.push(z.value),a[c]={...a[c],children:t}}return a}),he=H(()=>{const o=U.value.find(c=>c.id==="function-center");return o&&Array.isArray(o.children)&&o.children.length>0?["function-center"]:[]}),ke=o=>i.path.split("/")[3]===o.id,we=({item:o})=>{q.value.includes(o.id)};return(o,a)=>{const c=N("router-link"),t=$e,m=Ie,x=Le;return k(),C("div",Be,[L(x,{class:"left-menu",mode:"inline",selectedKeys:q.value,openKeys:he.value,onClick:we},{default:M(()=>[(k(!0),C(P,null,de(U.value,n=>(k(),C(P,{key:n.key},[n.children&&n.children.length?(k(),I(m,{key:n.key,icon:n.icon,class:Me({"submenu-selected":ke(n)})},{title:M(()=>[L(c,{class:"default-color",to:{path:n.path,query:n.query||j(r)},target:n.target||"_self",onClick:a[0]||(a[0]=Re(()=>{},["stop"]))},{default:M(()=>[G(W(n.label),1)]),_:2},1032,["to","target"])]),default:M(()=>[(k(!0),C(P,null,de(n.children,h=>(k(),I(c,{class:"default-color",key:h.key,to:{path:h.path,query:h.query||j(r)},target:h.target||"_self"},{default:M(()=>[(k(),I(t,{icon:h.icon,path:h.path,key:h.key},{default:M(()=>[G(W(h.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["to","target"]))),128))]),_:2},1032,["icon","class"])):(k(),I(c,{key:1,class:"default-color",target:n.target||"_self",to:{path:n.path,query:n.query||j(r)}},{default:M(()=>[(k(),I(t,{icon:n.icon,path:n.path,key:n.key},{default:M(()=>[G(W(n.label),1)]),_:2},1032,["icon","path"]))]),_:2},1032,["target","to"]))],64))),128))]),_:1},8,["selectedKeys","openKeys"])])}}},Ee=me(ze,[["__scopeId","data-v-313b1081"]]),Fe=Ae({name:"robotPage",components:{leftMenu:Ee,TopHeader:Te},async beforeRouteEnter(b,T,i){const s=D(),{getRobot:g,robotInfo:r,getRobotLists:q,getGroupList:K}=s;await g(b.query.id),q(),K();let R=ge(b.query.id);if(R==0){i("/no-permission");return}if(R==1){window.location.href=`${r.h5_domain}/#/chat/pc?robot_key=${r.robot_key}`,i("/robot/list");return}let $=["basicConfig","libraryConfig","skillConfig"];if(r.application_type==1&&$.includes(b.name)){i(`/robot/config/workflow?id=${r.id}&robot_key=${r.robot_key}`);return}if(r.application_type==0&&b.name=="robotWorkflow"){i(`/robot/config/basic-config?id=${r.id}&robot_key=${r.robot_key}`);return}i()},setup(){const b=Ce(),T=D(),{robotInfo:i}=xe(T),s=H(()=>be().name!="robotWorkflow");return{robotInfo:i,changeMenu:r=>{b.push({path:r.path,query:{robot_key:i.value.robot_key,id:i.value.id}})},isShowLeft:s}}}),He={class:"robot-main-container"},Ne={class:"robot-page-layout"},Ue={key:0,class:"layout-left"},Ve={class:"layout-body"};function Pe(b,T,i,s,g,r){const q=N("TopHeader"),K=N("leftMenu"),R=N("router-view");return k(),C("div",He,[ye("div",Ne,[b.isShowLeft?(k(),C("div",Ue,[L(q),L(K,{onChangeMenu:b.changeMenu,robotInfo:b.robotInfo},null,8,["onChangeMenu","robotInfo"])])):qe("",!0),ye("div",Ve,[L(R)])])])}const tn=me(Fe,[["render",Pe],["__scopeId","data-v-f64f13e3"]]);export{tn as default};
