import{A as J,_ as j,d as N,B as K,c as E}from"../../index-BRxqhTX0.js";import{C as X}from"./cu-scroll-DdXilhPY.js";import{k as n,a1 as F,e as k,B as ee,M as a,N as _,W as e,S as u,Y as f,F as S,a2 as w,a3 as te,Q as y,a9 as g,Z as p,u as M,a4 as Q,a5 as H,a0 as se}from"./vue-chunks-Chs-lyDX.js";import{b as oe}from"./index-DwMlK7BC.js";import{m as ne}from"./index-ClsKim4H.js";/* empty css                                                                       */import{Q as P}from"./QuestionCircleOutlined-D20_EtSI.js";import{_ as ie}from"./TextArea-DXf3OI0w.js";import{_ as ae}from"./index-BKmN8VmO.js";import{_ as le}from"./index-Clk1-ljB.js";import{_ as ce}from"./index-DkeJF6UD.js";import{_ as re}from"./index-Ck-3gHdx.js";import{S as _e,a as de,_ as ue}from"./index-DvlsFstf.js";import{S as me}from"./index-Bm-CdVnz.js";import"./dayjs-CkLU8sYs.js";import"./axios-Cm0UX6qg.js";import"./qs-DjYKlG5V.js";import"./crypto-js-BUUKnz8c.js";import"./FormItemContext-VrUvw7Ec.js";import"./inputProps-C625v0VH.js";import"./index-DYUnQ0Fx.js";import"./DownOutlined-bMEBWO_G.js";import"./slide-Dp7-2q38.js";import"./CheckOutlined-CvMo00tT.js";import"./move-DuzEngAP.js";var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const ve=pe;function A(i){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?Object(arguments[c]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable}))),d.forEach(function(m){fe(i,m,l[m])})}return i}function fe(i,c,l){return c in i?Object.defineProperty(i,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[c]=l,i}var T=function(c,l){var d=A({},c,l.attrs);return n(J,A({},d,{icon:ve}),null)};T.displayName="LinkOutlined";T.inheritAttrs=!1;const he=T,ge="/assets/img/empty-CUVHUa4t.png",x=i=>(Q("data-v-6825ab0d"),i=i(),H(),i),ke={class:"recall-settings-box"},be=x(()=>e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),ye={class:"form-box"},xe={class:"form-item"},$e={class:"form-item-body"},Le={class:"form-item"},Oe={class:"form-item is-required"},Se=x(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),we={class:"form-item-body"},Ce={class:"retrieval-mode-items"},Re=["onClick"],ze={class:"retrieval-mode-title"},qe={class:"title-text"},Ne={class:"retrieval-mode-desc"},Me={class:"form-item"},Te={class:"form-item-label"},Ue=x(()=>e("span",null,"Top K ",-1)),Be={class:"form-item-body"},Ie={class:"number-box"},Ve={class:"number-slider-box"},Pe={class:"number-input-box"},Ae={class:"form-item"},je={class:"form-item-label"},Ee=x(()=>e("span",null,"相似度阈值 ",-1)),Fe={class:"form-item-body"},Qe={class:"number-box"},He={class:"number-slider-box"},De={class:"number-input-box"},Ge={class:"form-item"},We={class:"form-item-label"},Ye=x(()=>e("span",null,"Rerank模型",-1)),Ze={class:"form-item-body"},Je=["src"],Ke={__name:"recall-testing-form",emits:["save","load"],setup(i,{expose:c,emit:l}){const d=F(),m=k(!1),b=l,R=k([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),t=ee({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.5,size:5,id:d.query.id}),U=(v,o)=>{t.rerank_model_config_id=o.rerank_model_config_id},$=v=>{t.search_type=v},z=()=>{if(!t.similarity)return N.error("请输入相似度");if(!t.size)return N.error("请输入分段数");if(!t.question)return N.error("请输入测试问题");let v={id:t.id,question:t.question,size:t.size,similarity:t.similarity,search_type:t.search_type};t.rerank_status==1&&(v.rerank_model_config_id=t.rerank_model_config_id),m.value=!0,b("load"),ne(v).then(o=>{b("save",o.data)}).catch(()=>{b("save",[])}).finally(()=>{m.value=!1})},L=k([]);return(()=>{oe({model_type:"RERANK"}).then(v=>{let o=v.data||[];L.value=o.map(h=>({id:h.model_config.id,name:h.model_info.model_name,icon:h.model_info.model_icon_url,children:h.model_info.rerank_model_list}))})})(),c({open}),(v,o)=>{const h=ie,D=K,q=E,B=ae,I=le,V=ce,G=re,W=_e,Y=de,Z=ue;return a(),_("div",ke,[be,e("div",ye,[e("div",xe,[e("div",$e,[n(h,{style:{height:"76px"},value:t.question,"onUpdate:value":o[0]||(o[0]=s=>t.question=s),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",Le,[n(D,{loading:m.value,onClick:z,type:"primary",block:""},{default:u(()=>[f("测试")]),_:1},8,["loading"])]),e("div",Oe,[Se,e("div",we,[e("div",Ce,[(a(!0),_(S,null,w(R.value,s=>(a(),_("div",{class:te(["retrieval-mode-item",{active:t.search_type==s.value}]),key:s.value,onClick:O=>$(s.value)},[t.search_type==s.value?(a(),y(q,{key:0,class:"check-arrow",name:"check-arrow-filled"})):g("",!0),e("div",ze,[n(q,{name:s.iconName,class:"title-icon"},null,8,["name"]),e("span",qe,p(s.title),1),s.isRecommendation?(a(),y(q,{key:0,class:"recommendation-icon",name:"recommendation"})):g("",!0)]),e("div",Ne,p(s.desc),1)],10,Re))),128))])])]),e("div",Me,[e("div",Te,[Ue,n(B,null,{title:u(()=>[f("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:u(()=>[n(M(P),{class:"question-icon"})]),_:1})]),e("div",Be,[e("div",Ie,[e("div",Ve,[n(I,{class:"custom-slider",value:t.size,"onUpdate:value":o[1]||(o[1]=s=>t.size=s),min:1,max:10},null,8,["value"])]),e("div",Pe,[n(V,{value:t.size,"onUpdate:value":o[2]||(o[2]=s=>t.size=s),min:1,max:10},null,8,["value"])])])])]),e("div",Ae,[e("div",je,[Ee,n(B,null,{title:u(()=>[f("召回时，只会召回相似度大于阈值的文本分段。")]),default:u(()=>[n(M(P),{class:"question-icon"})]),_:1})]),e("div",Fe,[e("div",Qe,[e("div",He,[n(I,{class:"custom-slider",value:t.similarity,"onUpdate:value":o[3]||(o[3]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])]),e("div",De,[n(V,{value:t.similarity,"onUpdate:value":o[4]||(o[4]=s=>t.similarity=s),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",Ge,[e("div",We,[Ye,f("   "),n(G,{checkedValue:1,unCheckedValue:0,checked:t.rerank_status,"onUpdate:checked":o[5]||(o[5]=s=>t.rerank_status=s)},null,8,["checked"])]),e("div",Ze,[n(Z,{value:t.rerank_use_model,"onUpdate:value":o[6]||(o[6]=s=>t.rerank_use_model=s),placeholder:"请选择Rerank模型",onChange:U,style:{width:"320px"}},{default:u(()=>[(a(!0),_(S,null,w(L.value,s=>(a(),y(Y,{key:s.id},{label:u(()=>[e("span",null,[e("img",{class:"model-icon",src:s.icon,alt:""},null,8,Je)])]),default:u(()=>[(a(!0),_(S,null,w(s.children,O=>(a(),y(W,{value:O,rerank_model_config_id:s.id,key:O},{default:u(()=>[e("span",null,p(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},Xe=j(Ke,[["__scopeId","data-v-6825ab0d"]]),C=i=>(Q("data-v-a430d6d6"),i=i(),H(),i),et={class:"recall-testing-box"},tt={class:"recall-from-box"},st={class:"content-list-box"},ot={key:0,class:"empty-box"},nt=C(()=>e("img",{src:ge,alt:""},null,-1)),it=C(()=>e("div",{class:"title"},"暂无结果，请重试",-1)),at=[nt,it],lt={class:"top-block"},ct={class:"title"},rt={key:0,class:"ml4"},_t={class:"info-block"},dt=C(()=>e("span",{class:"gray-text"},"来自：",-1)),ut=["onClick"],mt=C(()=>e("span",{class:"v-line"},null,-1)),pt={class:"gray-text"},vt={key:0,class:"content-box"},ft={key:1,class:"content-box"},ht=["innerHTML"],gt={key:2,class:"loading-box"},kt={__name:"recall-testing",setup(i){F(),se();const c=k(!1),l=k(!1),d=k([]),m=t=>{l.value=!1,d.value=t||[]},b=()=>{l.value=!0},R=t=>{window.open(`/#/library/preview?id=${t.file_id}`)};return(t,U)=>{const $=X,z=E,L=me;return a(),_("div",et,[e("div",tt,[n($,null,{default:u(()=>[n(Xe,{onLoad:b,onSave:m})]),_:1})]),e("div",st,[c.value||d.value.length===0?(a(),_("div",ot,at)):(a(),y($,{key:1},{default:u(()=>[(a(!0),_(S,null,w(d.value,r=>(a(),_("div",{class:"list-item",key:r.id},[e("div",lt,[e("div",ct,[f(" id："+p(r.id)+" ",1),r.title?(a(),_("div",rt,p(r.title),1)):g("",!0),e("span",null,"共"+p(r.word_total)+"个字符",1)])]),e("div",_t,[dt,e("div",{class:"link-text",onClick:v=>R(r)},[n(M(he)),f(" "+p(r.file_name),1)],8,ut),mt,e("span",pt,[f("相似度： "),n(z,{name:"similarity",style:{"font-size":"16px"}}),f(" "+p(r.similarity),1)])]),r.question?(a(),_("div",vt,"Q："+p(r.question),1)):g("",!0),r.answer?(a(),_("div",ft,"A："+p(r.answer),1)):g("",!0),e("div",{class:"content-box",innerHTML:r.content},null,8,ht)]))),128))]),_:1})),l.value?(a(),_("div",gt,[n(L)])):g("",!0)])])}}},Ht=j(kt,[["__scopeId","data-v-a430d6d6"]]);export{Ht as default};
