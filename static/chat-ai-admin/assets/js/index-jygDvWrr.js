import{ac as p,ad as r,as as t,k as e,az as L,G as I,at as U,ak as mt,ae as j,ar as l,ah as ce,ai as Ut,f as q,c as J,r as P,e as H,n as dt,A as _t,u as k,J as G,aw as Jt,F as z,ax as Z,w as rt,l as Ft,h as $t,aE as it,aF as pt,af as Qt,o as ht,b as ue,B as pe,y as Kt,aC as me,aB as ve,p as be}from"./vue-chunks-CGLjTDrY.js";import{_ as D,d as ct,a3 as fe,X as he,$ as ye,a as ke,A as ge,ae as It,c as $e,ad as xe}from"../../index-C5-B0r5-.js";import{B as tt,T as xt,I as yt,$ as kt,an as Dt,a5 as we,as as qe,al as Gt,M as Y,b as K,F as At,e as Wt,y as Ht,z as Zt,a4 as Xt,a3 as Yt,aD as Se,v as ot,aE as Ce,Q as et,at as vt,a6 as Rt,D as te,av as Ie,aj as Le,ak as Ue,w as jt,x as Nt,ah as W,aF as ee,O as wt,o as Re,R as Ee,N as Oe,V as Ae,af as oe,J as je,W as Lt,a1 as Ne,U as Tt,ae as Ve,j as Ot,ag as Me,G as ze,ao as Pe}from"./ui-antd-B11sc9DP.js";import{C as De}from"./cu-upload-DwfTmMze.js";import{u as se}from"./robot-jPE-s270.js";import{p as Te,q as Be,t as Je,g as Fe,u as Qe}from"./index-AgSL8KLK.js";import{_ as Ke,a as Ge}from"./index-DgHaYNQX.js";import{g as ne,M as Vt,u as We}from"./model-select-DkFuDwQt.js";import{L as He}from"./library-select-alert-3pyFSF45.js";import{_ as Ze}from"./recommendation-AQ4_FPQ9.js";import{W as Xe}from"./index-CpUVYSJF.js";import{_ as ie}from"./cu-scroll-C_QJcxx1.js";import{a as Ye}from"./index-BB_LiM3a.js";import{g as le}from"./index-Dg6gjwQb.js";import{_ as to}from"./empty-CzGZrENG.js";import{d as Mt}from"./vuedraggable.umd-u2TvJqwU.js";import{_ as eo}from"./empty-BFmzY9bl.js";import{i as oo,e as so,f as no}from"./index-BW5J6MyT.js";import{A as io}from"./add-collaborator-DSlDvBZd.js";import{R as lo}from"./robot-select-alert-BOxUlfRR.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./index-Btdd0zUd.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./vue-pdf-embed-DYPuxmVf.js";const ao={class:"edit-box-header"},ro={class:"left-box"},_o={class:"edit-box-title"},co={key:0},uo={key:0,class:"title-tip"},po={class:"right-box"},mo={class:"extra-box"},vo={class:"actions-box"},bo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(N,{emit:c}){const f=c,a=N,m=n=>{f("edit"),f("update:isEdit",n)},o=()=>{f("save")};return(n,g)=>{const y=ct,x=tt,b=xt;return r(),p("div",{class:Ut(["edit-box",{"is-edit":N.isEdit}])},[t("div",ao,[t("div",ro,[e(y,{class:"edit-box-icon",name:a.iconName},null,8,["name"]),t("span",_o,[I(U(a.title)+" ",1),n.$slots.icon?(r(),p("span",co,[mt(n.$slots,"icon",{},void 0,!0)])):L("",!0)]),n.$slots.tip?(r(),p("span",uo,[mt(n.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",po,[t("div",mo,[mt(n.$slots,"extra",{},()=>[t("div",vo,[a.isEdit?(r(),j(b,{key:0,gap:8},{default:l(()=>[e(x,{onClick:o,size:"small",type:"primary"},{default:l(()=>[...g[2]||(g[2]=[I("保存",-1)])]),_:1}),e(x,{onClick:g[0]||(g[0]=_=>m(!1)),size:"small"},{default:l(()=>[...g[3]||(g[3]=[I("取消",-1)])]),_:1})]),_:1})):(r(),j(x,{key:1,onClick:g[1]||(g[1]=_=>m(!0)),size:"small"},{default:l(()=>[...g[4]||(g[4]=[I("修改",-1)])]),_:1}))])],!0)])])]),t("div",{class:"edit-box-body",style:ce({...N.bodyStyle})},[mt(n.$slots,"default",{},void 0,!0)],4)],2)}}},X=D(bo,[["__scopeId","data-v-dbe09743"]]),fo={class:"robot-form-box"},ho={class:"form-item"},yo={class:"form-item-body robot-name-item"},ko={class:"robot-avetar-upload"},go=["src"],$o={class:"robot-name-box"},xo={class:"form-item"},wo={class:"form-item-body"},qo={class:"robot-info-box"},So={class:"robot-name-box"},Co=["src"],Io={class:"robot-name"},Lo={class:"robot-intro"},Uo={__name:"basic-config",setup(N){const c=se(),f=q(!1),{robotInfo:a,updateRobotInfo:m}=J("robotInfo"),o=P({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=H(()=>c.robotList||[]),g=H(()=>c.robotGroupList||[]),y=H(()=>{let u="未分组",s=n.value.find(d=>d.id==a.id)||{};if(s.group_id>0){let d=g.value.find($=>$.id==s.group_id);d&&(u=d.group_name)}return u}),x=()=>{m({...G(o)}),f.value=!1},b=u=>{let s=u[0];return o.robot_avatar=s,fe(s).then(d=>{o.robot_avatar_url=d}),!1},_=()=>{o.robot_name=a.robot_name,o.robot_intro=a.robot_intro,o.robot_avatar=a.robot_avatar,o.robot_avatar_url=a.robot_avatar_url};return(u,s)=>{const d=yt,$=kt;return r(),j(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:f.value,"onUpdate:isEdit":s[2]||(s[2]=w=>f.value=w),onSave:x,onEdit:_},{default:l(()=>[dt(t("div",fo,[t("div",ho,[s[3]||(s[3]=t("div",{class:"form-item-label"},"机器人名称/头像",-1)),t("div",yo,[e(De,{accept:"image/*",onChange:b},{default:l(()=>[t("div",ko,[o.robot_avatar_url?(r(),p("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,go)):L("",!0)])]),_:1}),t("div",$o,[e(d,{value:o.robot_name,"onUpdate:value":s[0]||(s[0]=w=>o.robot_name=w),placeholder:"请输入机器人名称"},null,8,["value"])])])]),t("div",xo,[s[4]||(s[4]=t("div",{class:"form-item-label"},"简介",-1)),t("div",wo,[e($,{rows:3,value:o.robot_intro,"onUpdate:value":s[1]||(s[1]=w=>o.robot_intro=w),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[_t,f.value]]),dt(t("div",qo,[t("div",So,[t("img",{class:"robot-avatar",src:k(a).robot_avatar_url,alt:""},null,8,Co),t("span",Io,U(k(a).robot_name),1)]),t("div",Lo,[t("span",null,"分组："+U(y.value),1),t("span",null,"简介："+U(k(a).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)])],512),[[_t,!f.value]])]),_:1},8,["isEdit"])}}},Ro=D(Uo,[["__scopeId","data-v-7fc4a51d"]]),Eo={class:"ai-create-box"},Oo={class:"input-box"},Ao={key:1},jo={key:2},No={class:"quick-tags-box"},Vo={class:"ai-list-box"},Mo={key:0,class:"loading-box"},zo={key:0,class:"prompt-list-box"},Po={class:"prompt-list"},Do={class:"prompt-header"},To={class:"prompt-title"},Bo={class:"prompt-content"},Jo={class:"prompt-list"},Fo={class:"prompt-header"},Qo={class:"prompt-title"},Ko={class:"prompt-content"},Go={class:"prompt-list"},Wo={class:"prompt-header"},Ho={class:"prompt-title"},Zo={class:"prompt-content"},Xo={class:"prompt-list"},Yo={class:"prompt-header"},ts={class:"prompt-title"},es={class:"prompt-content"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={class:"prompt-content"},ls={class:"prompt-header"},as={class:"prompt-title"},rs={class:"prompt-content"},ds={key:1,class:"empty-box"},_s={__name:"ai-create-prompt",emits:["handleAiSave"],setup(N,{expose:c,emit:f}){const a=Dt.PRESENTED_IMAGE_SIMPLE,m=q(!1),o=q(!1),n=Jt().query,g=f,y=q(""),x=q(!1),b=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],_=q("在上方输入框输入要求，点击生成提示词"),u=()=>{s.value=!1,$.promptStruct=d,y.value="",_.value="在上方输入框输入要求，点击生成提示词",m.value=!0},s=q(!1),d={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},$=P({promptStruct:d}),w=C=>{y.value=C},i=()=>{if(!y.value)return K.error("请输入AI 生成提示词");if(x.value)return K.error("正在生成中...");x.value=!0,Te({id:n.id,demand:y.value}).then(C=>{$.promptStruct=JSON.parse(C.data.promptStruct),s.value=!0}).finally(()=>{x.value=!1}).catch(C=>{s.value=!1,_.value=C.msg})},R=()=>{if(!s.value)return K.error("请先生成提示词");g("handleAiSave",$.promptStruct),m.value=!1};return c({show:u}),(C,v)=>{const S=tt,T=kt,E=ct,V=qe,F=Gt,st=Dt,B=Y;return r(),p("div",null,[e(B,{open:m.value,"onUpdate:open":v[1]||(v[1]=O=>m.value=O),title:"AI 生成提示词",wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:746},{footer:l(()=>[e(S,{type:"primary",loading:o.value,onClick:R},{default:l(()=>[...v[2]||(v[2]=[I("使用该提示",-1)])]),_:1},8,["loading"])]),default:l(()=>[t("div",Eo,[t("div",Oo,[e(T,{style:{width:"100%"},value:y.value,"onUpdate:value":v[0]||(v[0]=O=>y.value=O),size:"large","auto-size":"",placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),t("div",{class:Ut(["btn-box",{"disabed-status":x.value}]),onClick:i},[x.value?(r(),j(k(we),{key:0})):L("",!0),e(E,{name:"ai-mark"}),x.value?(r(),p("span",Ao,"生成中...")):(r(),p("span",jo,"生成"))],2)]),t("div",No,[v[3]||(v[3]=t("div",{class:"quick-label"},"快捷生成：",-1)),(r(),p(z,null,Z(b,O=>e(V,{key:O.title,onClick:ut=>w(O.title),color:"blue"},{default:l(()=>[I(U(O.title),1)]),_:2},1032,["onClick"])),64))]),t("div",Vo,[x.value?(r(),p("div",Mo,[e(F,{tip:"正在生成中..."})])):(r(),p(z,{key:1},[s.value?(r(),p("div",zo,[t("div",Po,[t("div",Do,[t("div",To,U($.promptStruct.role.subject),1)]),t("div",Bo,U($.promptStruct.role.describe),1)]),t("div",Jo,[t("div",Fo,[t("div",Qo,U($.promptStruct.task.subject),1)]),t("div",Ko,U($.promptStruct.task.describe),1)]),t("div",Go,[t("div",Wo,[t("div",Ho,U($.promptStruct.constraints.subject),1)]),t("div",Zo,U($.promptStruct.constraints.describe),1)]),t("div",Xo,[t("div",Yo,[t("div",ts,U($.promptStruct.output.subject),1)]),t("div",es,U($.promptStruct.output.describe),1)]),t("div",os,[t("div",ss,[t("div",ns,U($.promptStruct.tone.subject),1)]),t("div",is,U($.promptStruct.tone.describe),1)]),(r(!0),p(z,null,Z($.promptStruct.custom,(O,ut)=>(r(),p("div",{class:"prompt-list",key:ut+O.key?O.key:""},[t("div",ls,[t("div",as,U(O.subject),1)]),t("div",rs,U(O.describe),1)]))),128))])):(r(),p("div",ds,[e(st,{image:k(a),description:_.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open"])])}}},cs=D(_s,[["__scopeId","data-v-abe0e674"]]),us={__name:"upload-prompt",setup(N,{expose:c}){const f=q(!1),a=P({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),m=q(null),o=b=>{if(b.prompt_type==0&&!b.prompt)return K.error("自定义提示为空,无法上传");m.value&&m.value.resetFields();let _={...b};a.title="",a.group_id=0,a.prompt="",a.prompt_struct={},a.prompt_type=_.prompt_type,_.prompt_type==0?a.prompt=_.prompt:a.prompt_struct=JSON.stringify(_.prompt_struct),f.value=!0},n=q([]);(()=>{he().then(b=>{n.value=[{id:0,group_name:"默认分组"},...b.data]})})();const y=q(!1),x=()=>{m.value.validate().then(()=>{let b={...a};y.value=!0,ye({...b}).then(()=>{K.success("保存成功"),f.value=!1}).finally(()=>{y.value=!1})})};return c({show:o}),(b,_)=>{const u=yt,s=Wt,d=Zt,$=Ht,w=At,i=Y;return r(),p("div",null,[e(i,{open:f.value,"onUpdate:open":_[2]||(_[2]=R=>f.value=R),title:"保存到提示词库",width:580,onOk:x,confirmLoading:y.value},{default:l(()=>[e(w,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:m,model:a},{default:l(()=>[e(s,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:l(()=>[e(u,{value:a.title,"onUpdate:value":_[0]||(_[0]=R=>a.title=R),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),e(s,{name:"group_id",label:"分组"},{default:l(()=>[e($,{value:a.group_id,"onUpdate:value":_[1]||(_[1]=R=>a.group_id=R),style:{width:"100%"}},{default:l(()=>[(r(!0),p(z,null,Z(n.value,R=>(r(),j(d,{value:R.id},{default:l(()=>[I(U(R.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},ps={class:"prompt-box"},ms={class:"tab-header"},vs={key:0,class:"opt-block"},bs={key:1,class:"opt-block"},fs={class:"tip-text"},hs={key:0,class:"prompt-list-box"},ys={class:"prompt-list"},ks={class:"prompt-header"},gs={class:"prompt-title"},$s={key:0,class:"btn-wrapper-box"},xs={class:"prompt-content"},ws={class:"prompt-list"},qs={class:"prompt-header"},Ss={class:"prompt-title"},Cs={key:0,class:"btn-wrapper-box"},Is={class:"prompt-content"},Ls={class:"prompt-list"},Us={class:"prompt-header"},Rs={class:"prompt-title"},Es={key:0,class:"btn-wrapper-box"},Os={class:"prompt-content"},As={class:"prompt-list"},js={class:"prompt-header"},Ns={class:"prompt-title"},Vs={key:0,class:"btn-wrapper-box"},Ms={class:"prompt-content"},zs={class:"prompt-list"},Ps={class:"prompt-header"},Ds={class:"prompt-title"},Ts={key:0,class:"btn-wrapper-box"},Bs={class:"swich-item"},Js={class:"swich-item"},Fs={class:"prompt-content"},Qs={class:"prompt-list"},Ks={class:"prompt-header"},Gs={class:"prompt-title"},Ws={key:0,class:"btn-wrapper-box"},Hs={class:"prompt-content"},Zs={class:"prompt-header"},Xs={class:"prompt-title",style:{flex:"1"}},Ys={key:0,class:"btn-wrapper-box"},tn=["onClick"],en={class:"prompt-content"},on={key:0,class:"add-theme-block"},sn={class:"show-more-block"},nn={key:1,class:"diy-prompt-box"},ln={key:0,class:"diy-switch-box"},an={class:"swich-item"},rn={class:"swich-item"},lt="- 请使用markdown格式回答问题。",at="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",dn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(N){const c=q(!1),{robotInfo:f,updateRobotInfo:a}=J("robotInfo"),m=N;let o={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const n=q({}),g=q(!1),y=q(!1),x=q(!1),b=q(!1),_=P({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),u=q(localStorage.getItem("system_prompt_words_ishide")=="1"),s=()=>{u.value=!u.value,localStorage.setItem("system_prompt_words_ishide",u.value?1:0)},d=(M,h)=>M.includes(h),$=q(f.prompt_type),w=H(()=>f.prompt_type);rt(()=>f,()=>{_.prompt=f.prompt,_.prompt_struct=f.prompt_struct,n.value=f.prompt_struct_default},{immediate:!0,deep:!0}),rt(()=>_.prompt_struct.output.describe,M=>{g.value=d(M,lt),y.value=d(M,at)},{immediate:!0,deep:!0}),rt(()=>_.prompt,M=>{x.value=d(M,lt),b.value=d(M,at)},{immediate:!0,deep:!0});const i=(M,h)=>{M?(h=="outSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+lt:_.prompt_struct.output.describe+=lt),h=="imgSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+at:_.prompt_struct.output.describe+=at)):(h=="outSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(lt,"g"),"")),h=="imgSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(at,"g"),"")),_.prompt_struct.output.describe=_.prompt_struct.output.describe.trim())},R=(M,h)=>{M?(h=="outDiySwitch"&&(_.prompt?_.prompt+=`
`+lt:_.prompt+=lt),h=="imgDiySwitch"&&(_.prompt?_.prompt+=`
`+at:_.prompt+=at)):(h=="outDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(lt,"g"),"")),h=="imgDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(at,"g"),"")),_.prompt=_.prompt.trim())},C=M=>{_.prompt_struct[M].describe=n.value[M].describe},v=()=>{let M=f.work_flow_ids.split(","),h=m.robotList.filter(ft=>M.includes(ft.id)),gt=[];gt=h.map(ft=>`- ${ft.robot_name} ${ft.robot_intro}`).join(`
`),_.prompt_struct.skill.describe=gt},S=()=>{_.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),$.value=1},T=M=>{_.prompt_struct.custom.splice(M,1)},E=()=>{a({...G(_),prompt_type:$.value}),c.value=!1},V=M=>{$.value=1,a({prompt_type:$.value,prompt:_.prompt,prompt_struct:M}),c.value=!1},F=()=>{c.value=!0},st=()=>{c.value=!1},B=q(null),O=()=>{B.value.show()},ut=q(null),Q=()=>{ut.value.show()},bt=q(null),Et=()=>{bt.value.show({..._,prompt_type:$.value})},ae=M=>{M.prompt_type==1?($.value=1,_.prompt_struct=M.prompt_struct):($.value=0,_.prompt=M.prompt),E()};return(M,h)=>{const gt=Xt,ft=Yt,zt=ot,re=ct,qt=tt,de=xt,nt=kt,St=et,_e=yt;return r(),p("div",ps,[t("div",ms,[e(ft,{activeKey:$.value,"onUpdate:activeKey":h[0]||(h[0]=A=>$.value=A)},{default:l(()=>[(r(),j(gt,{key:1,tab:"结构化提示词"})),(r(),j(gt,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),c.value?(r(),p("div",vs,[e(zt,null,{title:l(()=>[...h[22]||(h[22]=[I("将当前编辑的提示词保存到提示词库中",-1)])]),default:l(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Et},[e(k(Se)),h[23]||(h[23]=I("上传 ",-1))])]),_:1}),e(zt,null,{title:l(()=>[...h[24]||(h[24]=[I("从提示词库导入提示词",-1)])]),default:l(()=>[t("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:Q},[e(k(Ce)),h[25]||(h[25]=I("导入 ",-1))])]),_:1}),t("div",{class:"ai-mark-box hover-btn-box",onClick:O},[e(re,{name:"ai-mark"}),h[26]||(h[26]=I(" AI自动生成 ",-1))]),e(de,{gap:8},{default:l(()=>[e(qt,{size:"small",type:"primary",onClick:E},{default:l(()=>[...h[27]||(h[27]=[I("保存",-1)])]),_:1}),e(qt,{size:"small",onClick:st},{default:l(()=>[...h[28]||(h[28]=[I("取消",-1)])]),_:1})]),_:1})])):(r(),p("div",bs,[t("span",fs,"当前类型："+U(w.value==1?"结构化提示词":"自定义提示词"),1),e(qt,{size:"small",onClick:F},{default:l(()=>[...h[29]||(h[29]=[I("修改",-1)])]),_:1})]))]),$.value==1?(r(),p("div",hs,[t("div",ys,[t("div",ks,[t("div",gs,U(_.prompt_struct.role.subject),1),c.value?(r(),p("div",$s,[t("a",{onClick:h[1]||(h[1]=A=>C("role"))},"恢复默认")])):L("",!0)]),t("div",xs,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.role.describe,"onUpdate:value":h[2]||(h[2]=A=>_.prompt_struct.role.describe=A),placeholder:k(o).role},null,8,["disabled","value","placeholder"])])]),t("div",ws,[t("div",qs,[t("div",Ss,U(_.prompt_struct.task.subject),1),c.value?(r(),p("div",Cs,[t("a",{onClick:h[3]||(h[3]=A=>C("task"))},"恢复默认")])):L("",!0)]),t("div",Is,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.task.describe,"onUpdate:value":h[4]||(h[4]=A=>_.prompt_struct.task.describe=A),placeholder:k(o).task},null,8,["disabled","value","placeholder"])])]),u.value?(r(),p(z,{key:0},[t("div",Ls,[t("div",Us,[t("div",Rs,U(_.prompt_struct.constraints.subject),1),c.value?(r(),p("div",Es,[t("a",{onClick:h[5]||(h[5]=A=>C("constraints"))},"恢复默认")])):L("",!0)]),t("div",Os,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.constraints.describe,"onUpdate:value":h[6]||(h[6]=A=>_.prompt_struct.constraints.describe=A),placeholder:k(o).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),t("div",As,[t("div",js,[t("div",Ns,U(_.prompt_struct.skill.subject),1),c.value?(r(),p("div",Vs,[t("a",{onClick:h[7]||(h[7]=A=>v())},"自动导入技能")])):L("",!0)]),t("div",Ms,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.skill.describe,"onUpdate:value":h[8]||(h[8]=A=>_.prompt_struct.skill.describe=A),placeholder:k(o).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),t("div",zs,[t("div",Ps,[t("div",Ds,U(_.prompt_struct.output.subject),1),c.value?(r(),p("div",Ts,[t("div",Bs,[h[30]||(h[30]=I(" 输出markdown： ",-1)),e(St,{onChange:h[9]||(h[9]=A=>i(A,"outSwitch")),checked:g.value,"onUpdate:checked":h[10]||(h[10]=A=>g.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",Js,[h[31]||(h[31]=I(" 回复图片： ",-1)),e(St,{onChange:h[11]||(h[11]=A=>i(A,"imgSwitch")),checked:y.value,"onUpdate:checked":h[12]||(h[12]=A=>y.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("a",{onClick:h[13]||(h[13]=A=>C("output"))},"恢复默认")])):L("",!0)]),t("div",Fs,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.output.describe,"onUpdate:value":h[14]||(h[14]=A=>_.prompt_struct.output.describe=A),placeholder:k(o).output},null,8,["disabled","value","placeholder"])])]),t("div",Qs,[t("div",Ks,[t("div",Gs,U(_.prompt_struct.tone.subject),1),c.value?(r(),p("div",Ws,[t("a",{onClick:h[15]||(h[15]=A=>C("tone"))},"恢复默认")])):L("",!0)]),t("div",Hs,[e(nt,{bordered:!1,disabled:!c.value,value:_.prompt_struct.tone.describe,"onUpdate:value":h[16]||(h[16]=A=>_.prompt_struct.tone.describe=A),placeholder:k(o).tone},null,8,["disabled","value","placeholder"])])]),(r(!0),p(z,null,Z(_.prompt_struct.custom,(A,Pt)=>(r(),p("div",{class:"prompt-list",key:Pt+A.key?A.key:""},[t("div",Zs,[t("div",Xs,[e(_e,{bordered:!1,disabled:!c.value,style:{width:"100%"},value:A.subject,"onUpdate:value":Ct=>A.subject=Ct,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),c.value?(r(),p("div",Ys,[t("div",{class:"hover-btn-box",onClick:Ct=>T(Pt)},[e(k(vt))],8,tn)])):L("",!0)]),t("div",en,[e(nt,{bordered:!1,disabled:!c.value,value:A.describe,"onUpdate:value":Ct=>A.describe=Ct,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),c.value?(r(),p("div",on,[e(qt,{onClick:S,block:"",icon:Ft(k(Rt))},{default:l(()=>[...h[32]||(h[32]=[I("添加主题",-1)])]),_:1},8,["icon"])])):L("",!0)],64)):L("",!0),t("div",sn,[t("div",{class:"btn-item",onClick:s},[u.value?(r(),p(z,{key:1},[h[34]||(h[34]=I("收起",-1)),e(k(Ie))],64)):(r(),p(z,{key:0},[h[33]||(h[33]=I("展开",-1)),e(k(te))],64))])])])):(r(),p("div",nn,[c.value?(r(),p("div",ln,[t("div",an,[h[35]||(h[35]=I(" 输出markdown： ",-1)),e(St,{size:"small",onChange:h[17]||(h[17]=A=>R(A,"outDiySwitch")),checked:x.value,"onUpdate:checked":h[18]||(h[18]=A=>x.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),t("div",rn,[h[36]||(h[36]=I(" 回复图片： ",-1)),e(St,{size:"small",onChange:h[19]||(h[19]=A=>R(A,"imgDiySwitch")),checked:b.value,"onUpdate:checked":h[20]||(h[20]=A=>b.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):L("",!0),e(nt,{bordered:c.value,value:_.prompt,"onUpdate:value":h[21]||(h[21]=A=>_.prompt=A),disabled:!c.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),e(cs,{onHandleAiSave:V,ref_key:"aiCreatePromptRef",ref:B},null,512),e(Ke,{onOk:ae,ref_key:"importPromptRef",ref:ut},null,512),e(us,{ref_key:"uploadPromptRef",ref:bt},null,512)])}}},_n=D(dn,[["__scopeId","data-v-934fdf72"]]),cn={class:"actions-box"},un={class:"setting-info-block"},pn={class:"set-item w-100"},mn={class:"set-item"},vn={class:"set-item"},bn={class:"set-item"},fn={class:"set-item"},hn={class:"form-box"},yn={class:"form-item"},kn={class:"form-item-body"},gn={class:"form-item",style:{display:"flex","align-items":"center"}},$n={class:"form-item"},xn={class:"form-item-label"},wn={class:"form-item-body"},qn={class:"number-box"},Sn={class:"number-slider-box"},Cn={class:"number-input-box"},In={class:"form-item"},Ln={class:"form-item-label"},Un={class:"form-item-body"},Rn={class:"number-box"},En={class:"number-slider-box"},On={class:"number-input-box"},An={class:"form-item"},jn={class:"form-item-label"},Nn={class:"form-item-body"},Vn={class:"number-box"},Mn={class:"number-slider-box"},zn={class:"number-input-box"},Pn={class:"form-item justify-between"},Dn={class:"form-item-label"},Tn={class:"form-item justify-between"},Bn={class:"form-item-label"},Jn={class:"form-item justify-between"},Fn={class:"form-item-label"},Qn={__name:"model-settings",setup(N){const c=P({sm:24,md:24,lg:12,xl:24,xxl:24});q([]);const f=q(!1),{robotInfo:a,updateRobotInfo:m,getRobot:o}=J("robotInfo"),n=P({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0,question_multiple_switch:1}),g=q(!1),y=(w,i)=>{const R=i.attrs;n.question_multiple_switch=Number(R.input_image)||0,R&&R.input_image==1?g.value=!1:g.value=!0,n.use_model&&n.use_model.toLowerCase().includes("deepseek-r1")?n.prompt_role_type="1":n.prompt_role_type="0"},x=q({}),b=(w,i)=>{x.value=i},_=H(()=>{if(!n.model_config_id)return!1;let w=n.model_config_id+"#"+n.use_model;return x.value[w]}),u=()=>{let w={...G(n)};m(w),f.value=!1},s=()=>{o(a.id).then(w=>{n.model_config_id=w.data.model_config_id,n.use_model=w.data.use_model})},d=w=>{n.use_model=a.use_model,n.model_config_id=a.model_config_id,n.temperature=a.temperature,n.max_token=a.max_token,n.context_pair=a.context_pair,n.think_switch=Number(a.think_switch),n.prompt_role_type=a.prompt_role_type,n.enable_thinking=a.enable_thinking,n.question_multiple_switch=Number(a.question_multiple_switch)||0,f.value=w};$t(()=>{n.use_model=a.use_model,n.model_config_id=a.model_config_id,n.temperature=a.temperature,n.max_token=a.max_token,n.context_pair=a.context_pair,n.think_switch=Number(a.think_switch),n.prompt_role_type=a.prompt_role_type,n.enable_thinking=a.enable_thinking,n.question_multiple_switch=Number(a.question_multiple_switch)||0});const $=H(()=>ne(n.model_config_id,n.use_model));return(w,i)=>{const R=tt,C=Ue,v=Nt,S=jt,T=ot,E=ee,V=wt,F=et,st=Le,B=Y;return r(),j(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:f.value,"onUpdate:isEdit":i[14]||(i[14]=O=>f.value=O)},{extra:l(()=>[t("div",cn,[e(R,{onClick:i[0]||(i[0]=O=>d(!0)),size:"small"},{default:l(()=>[...i[15]||(i[15]=[I("修改",-1)])]),_:1})])]),default:l(()=>[t("div",un,[t("div",pn,[i[16]||(i[16]=I(" LLM模型： ",-1)),t("span",null,U($.value),1)]),t("div",mn,[i[17]||(i[17]=I(" 温度： ",-1)),t("span",null,U(n.temperature),1)]),t("div",vn,[i[18]||(i[18]=I(" 最大token： ",-1)),t("span",null,U(n.max_token),1)]),t("div",bn,[i[19]||(i[19]=I(" 上下文数量： ",-1)),t("span",null,U(n.context_pair),1)]),t("div",fn,[i[20]||(i[20]=I(" 显示推理过程： ",-1)),t("span",null,U(n.think_switch==1?"开":"关"),1)])]),e(B,{open:f.value,"onUpdate:open":i[13]||(i[13]=O=>f.value=O),width:672,title:"模型设置",onCancel:s,onOk:u},{default:l(()=>[t("div",hn,[e(st,{gutter:[32,24]},{default:l(()=>[e(C,it(pt(c)),{default:l(()=>[t("div",yn,[i[21]||(i[21]=t("div",{class:"form-item-label mb12"},[t("span",null,"LLM模型 ")],-1)),t("div",kn,[e(Vt,{modelType:"LLM",modeName:n.use_model,"onUpdate:modeName":i[1]||(i[1]=O=>n.use_model=O),modeId:n.model_config_id,"onUpdate:modeId":i[2]||(i[2]=O=>n.model_config_id=O),onChange:y,onLoaded:b},null,8,["modeName","modeId"])])])]),_:1},16),e(C,it(pt(c)),{default:l(()=>[t("div",gn,[i[24]||(i[24]=t("div",{class:"form-item-label mb12"},[t("span",null,"提示词所属角色： ")],-1)),t("div",null,[e(S,{value:n.prompt_role_type,"onUpdate:value":i[3]||(i[3]=O=>n.prompt_role_type=O)},{default:l(()=>[e(v,{value:"0"},{default:l(()=>[...i[22]||(i[22]=[I("系统角色（System）",-1)])]),_:1}),e(v,{value:"1"},{default:l(()=>[...i[23]||(i[23]=[I("用户角色（User）",-1)])]),_:1})]),_:1},8,["value"])])])]),_:1},16),e(C,it(pt(c)),{default:l(()=>[t("div",$n,[t("div",xn,[i[26]||(i[26]=t("span",null,"温度 ",-1)),e(T,null,{title:l(()=>[...i[25]||(i[25]=[I("温度越低，回答越严谨。温度越高，回答越发散。",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),t("div",wn,[t("div",qn,[t("div",Sn,[e(E,{class:"custom-slider",value:n.temperature,"onUpdate:value":i[4]||(i[4]=O=>n.temperature=O),min:0,max:2,step:.1},null,8,["value"])]),t("div",Cn,[e(V,{value:n.temperature,"onUpdate:value":i[5]||(i[5]=O=>n.temperature=O),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),e(C,it(pt(c)),{default:l(()=>[t("div",In,[t("div",Ln,[i[28]||(i[28]=t("span",null,"最大token ",-1)),e(T,null,{title:l(()=>[...i[27]||(i[27]=[I("问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),t("div",Un,[t("div",Rn,[t("div",En,[e(E,{class:"custom-slider",value:n.max_token,"onUpdate:value":i[6]||(i[6]=O=>n.max_token=O),min:0,max:100*1024},null,8,["value"])]),t("div",On,[e(V,{value:n.max_token,"onUpdate:value":i[7]||(i[7]=O=>n.max_token=O),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),e(C,it(pt(c)),{default:l(()=>[t("div",An,[t("div",jn,[i[30]||(i[30]=t("span",null,"上下文数量 ",-1)),e(T,null,{title:l(()=>[...i[29]||(i[29]=[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),t("div",Nn,[t("div",Vn,[t("div",Mn,[e(E,{class:"custom-slider",value:n.context_pair,"onUpdate:value":i[8]||(i[8]=O=>n.context_pair=O),min:0,max:50},null,8,["value"])]),t("div",zn,[e(V,{value:n.context_pair,"onUpdate:value":i[9]||(i[9]=O=>n.context_pair=O),min:0,max:50},null,8,["value"])])])])])]),_:1},16),e(C,it(pt(c)),{default:l(()=>[t("div",Pn,[t("div",Dn,[i[32]||(i[32]=t("span",null,"多模态输入 ",-1)),e(T,null,{title:l(()=>[...i[31]||(i[31]=[t("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),e(Ge,{title:"当前选择的模型不支持多模态输入",disabled:!g.value},{default:l(()=>[e(F,{checked:n.question_multiple_switch,"onUpdate:checked":i[10]||(i[10]=O=>n.question_multiple_switch=O),checkedValue:1,unCheckedValue:0,disabled:g.value},null,8,["checked","disabled"])]),_:1},8,["disabled"])])]),_:1},16),_.value?(r(),j(C,it(Qt({key:0},c)),{default:l(()=>[t("div",Tn,[t("div",Bn,[i[34]||(i[34]=t("span",null,"深度思考 ",-1)),e(T,null,{title:l(()=>[...i[33]||(i[33]=[t("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),e(F,{checked:n.enable_thinking,"onUpdate:checked":i[11]||(i[11]=O=>n.enable_thinking=O),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):L("",!0),e(C,it(pt(c)),{default:l(()=>[t("div",Jn,[t("div",Fn,[i[36]||(i[36]=t("span",null,"显示推理过程 ",-1)),e(T,null,{title:l(()=>[...i[35]||(i[35]=[t("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),e(F,{checked:n.think_switch,"onUpdate:checked":i[12]||(i[12]=O=>n.think_switch=O),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Kn=D(Qn,[["__scopeId","data-v-3c2bed36"]]),Gn={class:"recall-settings-box"},Wn={class:"form-box"},Hn={class:"form-item is-required"},Zn={class:"form-item-body"},Xn={class:"retrieval-mode-items"},Yn=["onClick"],ti={class:"retrieval-mode-title"},ei={class:"title-text"},oi={key:0,style:{width:"32px"},src:Ze,alt:""},si={class:"retrieval-mode-desc"},ni={key:0,class:"form-item"},ii={class:"form-item"},li={class:"form-item-label"},ai={class:"form-item-body"},ri={class:"number-box"},di={class:"number-slider-box"},_i={class:"number-input-box"},ci={key:1,class:"form-item"},ui={class:"form-item-label"},pi={class:"form-item-body"},mi={class:"number-box"},vi={class:"number-slider-box"},bi={class:"number-input-box"},fi={class:"form-item"},hi={class:"form-item-label"},yi={key:0,class:"form-item-body"},ki={__name:"recall-settings-alert",emits:["change"],setup(N,{expose:c,emit:f}){const a=f,m=q([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=P({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,rrf_weight:{}}),n=q(!1),g=s=>{o.rerank_status=s.rerank_status||0,o.rerank_use_model=s.rerank_use_model||void 0,o.rerank_model_config_id=s.rerank_model_config_id>0?s.rerank_model_config_id:"",o.top_k=s.top_k,o.similarity=s.similarity,o.search_type=s.search_type,o.rrf_weight=s.rrf_weight,n.value=!0},y=s=>{s==0&&(o.rerank_model_config_id="",o.rerank_use_model="")},x=s=>{o.search_type=s},b=()=>o.rerank_status==1&&!o.rerank_model_config_id,_=()=>{if(b())return K.error("请选择Rerank模型");n.value=!1,u()},u=()=>{a("change",G(o))};return c({open:g}),(s,d)=>{const $=ct,w=ot,i=ee,R=wt,C=et,v=Y;return r(),j(v,{width:"746px",open:n.value,"onUpdate:open":d[8]||(d[8]=S=>n.value=S),title:"召回设置",onOk:_},{default:l(()=>[t("div",Gn,[t("div",Wn,[t("div",Hn,[d[9]||(d[9]=t("div",{class:"form-item-label"},[t("span",null,"检索模式")],-1)),t("div",Zn,[t("div",Xn,[(r(!0),p(z,null,Z(m.value,S=>(r(),p("div",{class:Ut(["retrieval-mode-item",{active:o.search_type==S.value}]),key:S.value,onClick:T=>x(S.value)},[o.search_type==S.value?(r(),j($,{key:0,class:"check-arrow",name:"check-arrow-filled"})):L("",!0),t("div",ti,[e($,{name:S.iconName,class:"title-icon"},null,8,["name"]),t("span",ei,U(S.title),1),S.isRecommendation?(r(),p("img",oi)):L("",!0)]),t("div",si,U(S.desc),1)],10,Yn))),128))])])]),o.search_type==1?(r(),p("div",ni,[e(Xe,{rrf_weight:o.rrf_weight,"onUpdate:rrf_weight":d[0]||(d[0]=S=>o.rrf_weight=S)},null,8,["rrf_weight"])])):L("",!0),t("div",ii,[t("div",li,[d[11]||(d[11]=t("span",null,"Top K ",-1)),e(w,null,{title:l(()=>[...d[10]||(d[10]=[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),t("div",ai,[t("div",ri,[t("div",di,[e(i,{class:"custom-slider",value:o.top_k,"onUpdate:value":d[1]||(d[1]=S=>o.top_k=S),min:1,max:500},null,8,["value"])]),t("div",_i,[e(R,{value:o.top_k,"onUpdate:value":d[2]||(d[2]=S=>o.top_k=S),min:1,max:500},null,8,["value"])])])])]),o.search_type<=2?(r(),p("div",ci,[t("div",ui,[d[13]||(d[13]=t("span",null,"相似度阈值 ",-1)),e(w,null,{title:l(()=>[...d[12]||(d[12]=[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9",-1)])]),default:l(()=>[e(k(W),{class:"question-icon"})]),_:1})]),t("div",pi,[t("div",mi,[t("div",vi,[e(i,{class:"custom-slider",value:o.similarity,"onUpdate:value":d[3]||(d[3]=S=>o.similarity=S),min:0,max:1,step:.01},null,8,["value"])]),t("div",bi,[e(R,{value:o.similarity,"onUpdate:value":d[4]||(d[4]=S=>o.similarity=S),min:0,max:1,step:.01},null,8,["value"])])])])])):L("",!0),t("div",fi,[t("div",hi,[d[14]||(d[14]=t("span",null,"Rerank模型",-1)),d[15]||(d[15]=I("   ",-1)),e(C,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":d[5]||(d[5]=S=>o.rerank_status=S),onChange:y},null,8,["checked"])]),o.rerank_status==1?(r(),p("div",yi,[e(Vt,{modelType:"RERANK",modeName:o.rerank_use_model,"onUpdate:modeName":d[6]||(d[6]=S=>o.rerank_use_model=S),modeId:o.rerank_model_config_id,"onUpdate:modeId":d[7]||(d[7]=S=>o.rerank_model_config_id=S),style:{width:"60%"}},null,8,["modeName","modeId"])])):L("",!0)])])])]),_:1},8,["open"])}}},gi=D(ki,[["__scopeId","data-v-c0e02df3"]]),$i={class:"list-box"},xi=["onClick"],wi={class:"avater-box"},qi=["src"],Si={class:"content-box"},Ci={class:"title-block"},Ii={class:"title-text"},Li={class:"desc-box"},Ui={class:"right-icon"},Ri={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(N,{expose:c,emit:f}){const a=f,m=N,o=q(!1);rt(()=>m.list,()=>{m.list.length==0&&(o.value=!1)},{});const n=()=>{o.value=!0},g=()=>{document.visibilityState==="visible"&&a("refreshList")};ht(()=>{document.addEventListener("visibilitychange",g)}),ue(()=>{document.removeEventListener("visibilitychange",g)});const y=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return c({show:n}),(x,b)=>{const _=Re,u=ie,s=Y;return r(),p("div",null,[e(s,{open:o.value,"onUpdate:open":b[0]||(b[0]=d=>o.value=d),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:l(()=>[e(_,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),e(u,{scrollbar:!1,style:{height:"400px"}},{default:l(()=>[t("div",$i,[(r(!0),p(z,null,Z(m.list,d=>(r(),p("div",{class:"list-item",onClick:$=>y(d),key:d.id},[t("div",wi,[t("img",{src:d.avatar,alt:""},null,8,qi)]),t("div",Si,[t("div",Ci,[b[1]||(b[1]=t("div",{class:"tag-icon"},"Graph",-1)),t("div",Ii,U(d.library_name),1)]),t("div",Li,U(d.library_intro),1)]),t("div",Ui,[e(k(Ee))])],8,xi))),128))])]),_:1})]),_:1},8,["open"])])}}},Ei=D(Ri,[["__scopeId","data-v-a87bd0fa"]]),Oi={class:"actions-box"},Ai={key:0,class:"library-list"},ji=["onClick"],Ni={class:"library-avatar"},Vi=["src"],Mi={class:"info-content-box"},zi={class:"library-title-block"},Pi={class:"title-text"},Di={class:"desc-info-block"},Ti=["onClick"],Bi={class:"setting-info-block"},Ji={class:"set-item"},Fi={key:0},Qi={key:1},Ki={key:2},Gi={key:3},Wi={class:"set-item"},Hi={key:0,class:"set-item"},Zi={class:"set-item"},Xi={key:0},Yi={key:1},tl={__name:"index",setup(N){const c=ke();H(()=>{var E;return((E=c.companyInfo)==null?void 0:E.neo4j_status)=="true"});const f=q(!1),{robotInfo:a,updateRobotInfo:m}=J("robotInfo"),o=P({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1,rrf_weight:{}}),n=q([]),g=q(null),y=q(null),x=H(()=>n.value.filter(E=>y.value?o.library_ids.includes(E.id):o.library_ids.includes(E.id)&&E.type!=3)),b=H(()=>x.value.filter(E=>E.graph_switch==0)),_=E=>{let V=o.library_ids.indexOf(E.id);o.library_ids.splice(V,1),R()},u=E=>{o.library_ids=[...E],R()},s=()=>{g.value.open([...o.library_ids])},d=q(null),$=()=>{d.value.open(G(o))},w=q(null),i=E=>{o.rerank_status=E.rerank_status,o.rerank_use_model=E.rerank_use_model,o.rerank_model_config_id=E.rerank_model_config_id,o.top_k=E.top_k,o.similarity=E.similarity,o.search_type=E.search_type,o.rrf_weight=E.rrf_weight,(E.search_type==1||E.search_type==4)&&b.value.length>0&&w.value.show(),R()},R=()=>{let E={...G(o)};E.library_ids=E.library_ids.join(","),E.op_type_relation_library=1,E.rrf_weight=JSON.stringify(E.rrf_weight),m({...E})},C=async()=>{const E=await ge({type:"",show_open_docs:1});E&&(n.value=E.data||[])},v=()=>{Ye({ability_type:"library_ability_official_account"}).then(E=>{var F;let V=(E==null?void 0:E.data)||{};((F=V==null?void 0:V.user_config)==null?void 0:F.switch_status)==1&&(y.value=V)})};o.rerank_use_model=a.rerank_use_model||void 0,$t(()=>{o.library_ids=a.library_ids.split(","),o.rerank_status=a.rerank_status||0,o.rerank_use_model=a.rerank_use_model||void 0,o.rerank_model_config_id=a.rerank_model_config_id||"",o.top_k=a.top_k,o.similarity=a.similarity,o.search_type=a.search_type,o.rrf_weight=a.rrf_weight!=""?JSON.parse(a.rrf_weight):{vector:0,search:0,graph:0}});const S=E=>{window.open(`#/library/details/knowledge-document?id=${E.id}`)},T=H(()=>ne(o.rerank_model_config_id,o.rerank_use_model,"RERANK"));return ht(()=>{v(),C()}),(E,V)=>{const F=tt,st=xt;return r(),j(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:f.value,"onUpdate:isEdit":V[0]||(V[0]=B=>f.value=B),bodyStyle:{padding:0}},{extra:l(()=>[t("div",Oi,[e(st,{gap:8},{default:l(()=>[e(F,{size:"small",onClick:$},{default:l(()=>[...V[1]||(V[1]=[I("召回设置",-1)])]),_:1}),e(F,{size:"small",onClick:s},{default:l(()=>[...V[2]||(V[2]=[I("关联知识库",-1)])]),_:1})]),_:1})])]),default:l(()=>[x.value.length>0?(r(),p("div",Ai,[(r(!0),p(z,null,Z(x.value,B=>(r(),p("div",{class:"library-item",key:B.id,onClick:O=>S(B)},[t("div",Ni,[t("img",{src:B.avatar,alt:""},null,8,Vi)]),t("div",Mi,[t("div",zi,[t("div",Pi,U(B.library_name),1)]),t("div",Di,U(B.library_intro),1)]),B.id!=k(a).default_library_id?(r(),p("div",{key:0,class:"close-btn",onClick:pe(O=>_(B),["stop"])},[e(k(vt))],8,Ti)):L("",!0)],8,ji))),128))])):L("",!0),t("div",Bi,[t("div",Ji,[V[3]||(V[3]=I(" 检索模式： ",-1)),o.search_type==1?(r(),p("span",Fi,"混合检索")):L("",!0),o.search_type==2?(r(),p("span",Qi,"向量检索")):L("",!0),o.search_type==3?(r(),p("span",Ki,"全文检索")):L("",!0),o.search_type==4?(r(),p("span",Gi,"知识图谱检索")):L("",!0)]),t("div",Wi,[V[4]||(V[4]=I(" Top K： ",-1)),t("span",null,U(o.top_k),1)]),o.search_type<=2?(r(),p("div",Hi,[V[5]||(V[5]=I(" 相似度阈值： ",-1)),t("span",null,U(o.similarity),1)])):L("",!0),t("div",Zi,[V[6]||(V[6]=I(" Rerank模型： ",-1)),o.rerank_status==0?(r(),p("span",Xi,"关")):(r(),p("span",Yi,U(T.value),1))])]),e(He,{ref_key:"librarySelectAlertRef",ref:g,onChange:u,showWxType:!!y.value},null,8,["showWxType"]),e(gi,{ref_key:"recallSettingsAlertRef",ref:d,onChange:i},null,512),e(Ei,{list:b.value,onRefreshList:C,ref_key:"noOpenGraphModalRef",ref:w},null,8,["list"])]),_:1},8,["isEdit"])}}},el=D(tl,[["__scopeId","data-v-bc93b7a8"]]),ol={class:"library-checkbox-box"},sl={class:"list-box",ref:"scrollContainer"},nl={class:"library-name"},il={class:"library-desc"},ll={key:0,class:"empty-box"},al={__name:"library-select-alert",emits:["change"],setup(N,{expose:c,emit:f}){const a=f,m=P({indeterminate:!1,checkAll:!1,checkedList:[]}),o=q(!1),n=s=>{b(),m.checkedList=s,o.value=!0},g=()=>{o.value=!1,x()};q("");const y=q([]),x=()=>{a("change",[...m.checkedList])},b=async()=>{const s=await le();if(s){let d=s.data||[];y.value=d}},_=q(!1),u=()=>{window.open("/#/database/list")};return c({open:n}),(s,d)=>{const $=Ae,w=Oe,i=Gt,R=Y;return r(),j(R,{width:"746px",open:o.value,"onUpdate:open":d[1]||(d[1]=C=>o.value=C),title:"关联数据表",onOk:g},{default:l(()=>[t("div",ol,[e(i,{spinning:_.value,delay:100},{default:l(()=>[e(w,{value:m.checkedList,"onUpdate:value":d[0]||(d[0]=C=>m.checkedList=C),style:{width:"100%"}},{default:l(()=>[t("div",sl,[(r(!0),p(z,null,Z(y.value,C=>(r(),p("div",{class:"list-item-wraapper",key:C.id},[e($,{class:"list-item",value:C.id},{default:l(()=>[t("div",nl,U(C.name),1),t("div",il,U(C.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!_.value&&!y.value.length?(r(),p("div",ll,[d[3]||(d[3]=t("img",{src:to,alt:""},null,-1)),t("div",null,[d[2]||(d[2]=I(" 暂无数据表, 请先去添加数据表 ",-1)),t("a",{onClick:u}," 去添加")])])):L("",!0)])]),_:1},8,["open"])}}},rl=D(al,[["__scopeId","data-v-b559dd08"]]),dl={class:"actions-box"},_l={key:0,class:"library-list"},cl=["onClick"],ul={class:"library-name"},pl={class:"library-intro"},ml={__name:"index",setup(N){const c=q(!1),{robotInfo:f,updateRobotInfo:a}=J("robotInfo"),m=P({form_ids:[]}),o=q([]),n=q(null),g=H(()=>o.value.filter(s=>m.form_ids.includes(s.id))),y=s=>{let d=m.form_ids.indexOf(s.id);m.form_ids.splice(d,1),_()},x=s=>{m.form_ids=[...s],_()},b=()=>{n.value.open([...m.form_ids])},_=()=>{let s={...G(m)};s.form_ids=s.form_ids.join(","),a({...s})};return(async()=>{const s=await le();s&&(o.value=s.data||[])})(),$t(()=>{m.form_ids=f.form_ids.split(",")}),(s,d)=>{const $=ot,w=tt,i=xt;return r(),j(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":d[0]||(d[0]=R=>c.value=R),bodyStyle:{padding:0}},{tip:l(()=>[e($,{placement:"top"},{title:l(()=>[...d[1]||(d[1]=[t("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])]),default:l(()=>[e(k(W))]),_:1})]),extra:l(()=>[t("div",dl,[e(i,{gap:8},{default:l(()=>[e(w,{size:"small",onClick:b},{default:l(()=>[...d[2]||(d[2]=[I("关联数据表",-1)])]),_:1})]),_:1})])]),default:l(()=>[g.value.length>0?(r(),p("div",_l,[(r(!0),p(z,null,Z(g.value,R=>(r(),p("div",{class:"library-item",key:R.id},[t("span",{class:"close-btn",onClick:C=>y(R)},[e(k(vt))],8,cl),t("div",ul,U(R.name),1),t("div",pl,U(R.description),1)]))),128))])):L("",!0),e(rl,{ref_key:"librarySelectAlertRef",ref:n,onChange:x},null,512)]),_:1},8,["isEdit"])}}},vl=D(ml,[["__scopeId","data-v-c40914ca"]]),bl={class:"form-box"},fl={class:"question-title"},hl={class:"question-options"},yl={class:"question-option"},kl={class:"drag-btn"},gl={class:"action-box"},$l={class:"robot-info-box"},xl={class:"robot-welcome-content"},wl={class:"robot-welcome-question"},ql={__name:"welcome-words",setup(N){const c=q(!1),f=q(!1),{robotInfo:a,updateRobotInfo:m,scrollBoxToBottom:o}=J("robotInfo"),n=P({welcomes:{content:"",question:[]}}),g=()=>{let u=!1;if(n.welcomes.question.length>0){for(let s=0;s<n.welcomes.question.length;s++)if(!n.welcomes.question[s].content){u=s+1;break}}return u},y=()=>{n.welcomes.question.push({content:"",id:It(8)})},x=u=>{n.welcomes.question.splice(u,1)},b=()=>{if(!n.welcomes.content)return K.error("请输入欢迎语");if(g())return K.error("引导问题内容不能为空");m({...G(n)}),c.value=!1},_=()=>{let u={...a.welcomes},s=[];u.question.forEach(({content:d,id:$})=>{let w={id:$,content:d};w.id||(w.id=It(6)),s.push(w)}),n.welcomes.content=u.content,n.welcomes.question=s};return(u,s)=>{const d=kt,$=ct,w=yt;return r(),j(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":s[4]||(s[4]=i=>c.value=i),onSave:b,onEdit:_},{default:l(()=>[dt(t("div",bl,[t("div",fl,[e(d,{value:n.welcomes.content,"onUpdate:value":s[0]||(s[0]=i=>n.welcomes.content=i),placeholder:"请输入欢迎语"},null,8,["value"])]),t("div",hl,[e(k(Mt),{modelValue:n.welcomes.question,"onUpdate:modelValue":s[1]||(s[1]=i=>n.welcomes.question=i),"item-key":"id",handle:".drag-btn",onStart:s[2]||(s[2]=i=>f.value=!0),onEnd:s[3]||(s[3]=i=>f.value=!1)},{item:l(({element:i,index:R})=>[t("div",yl,[t("span",kl,[e($,{name:"drag"})]),e(w,{class:"question-option-content",value:i.content,"onUpdate:value":C=>i.content=C,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",gl,[e(k(vt),{class:"del-btn",onClick:C=>x(R)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:y},[e(k(Rt),{class:"add-btn-icon"}),s[5]||(s[5]=I("添加引导问题 ",-1))])])],512),[[_t,c.value]]),dt(t("div",$l,[t("div",xl,U(k(a).welcomes.content),1),t("div",wl,[(r(!0),p(z,null,Z(k(a).welcomes.question,(i,R)=>(r(),p("div",{class:"question-item",key:R},U(i.content),1))),128))])],512),[[_t,!c.value]])]),_:1},8,["isEdit"])}}},Sl=D(ql,[["__scopeId","data-v-ea227a87"]]),Cl={class:"form-box"},Il={class:"question-title"},Ll={class:"question-options"},Ul={class:"question-option"},Rl={class:"drag-btn"},El={class:"action-box"},Ol={class:"robot-info-box"},Al={class:"robot-unknown-content"},jl={class:"robot-unknown-question"},Nl={__name:"unknown-problem-prompt",setup(N){const c=q(!1),f=q(!1),{robotInfo:a,updateRobotInfo:m,scrollBoxToBottom:o}=J("robotInfo"),n=P({unknown_question_prompt:{content:"",question:[]}}),g=()=>{n.unknown_question_prompt.question.push({content:"",id:It(8)}),Kt(()=>{o()})},y=_=>{n.unknown_question_prompt.question.splice(_,1)},x=()=>{m({...G(n)}),c.value=!1},b=()=>{let _={...a.unknown_question_prompt},u=[];_.question&&_.question.forEach(({content:s,id:d})=>{let $={id:d,content:s};$.id||($.id=It(6)),u.push($)}),_.content&&(n.unknown_question_prompt.content=_.content),u&&(n.unknown_question_prompt.question=u)};return ht(()=>{}),(_,u)=>{const s=ot,d=kt,$=ct,w=yt;return r(),j(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":u[4]||(u[4]=i=>c.value=i),onSave:x,onEdit:b},{tip:l(()=>[e(s,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...u[5]||(u[5]=[t("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])]),default:l(()=>[e(k(W))]),_:1})]),default:l(()=>[dt(t("div",Cl,[t("div",Il,[e(d,{value:n.unknown_question_prompt.content,"onUpdate:value":u[0]||(u[0]=i=>n.unknown_question_prompt.content=i),placeholder:"请输入未知问题提示语"},null,8,["value"])]),t("div",Ll,[e(k(Mt),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":u[1]||(u[1]=i=>n.unknown_question_prompt.question=i),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=i=>f.value=!0),onEnd:u[3]||(u[3]=i=>f.value=!1)},{item:l(({element:i,index:R})=>[t("div",Ul,[t("span",Rl,[e($,{name:"drag"})]),e(w,{class:"question-option-content",value:i.content,"onUpdate:value":C=>i.content=C,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),t("div",El,[e(k(vt),{class:"del-btn",onClick:C=>y(R)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),t("div",{class:"add-btn",onClick:g},[e(k(Rt),{class:"add-btn-icon"}),u[6]||(u[6]=I("添加引导问题 ",-1))])])],512),[[_t,c.value]]),dt(t("div",Ol,[t("div",Al,U(k(a).unknown_question_prompt.content),1),t("div",jl,[(r(!0),p(z,null,Z(k(a).unknown_question_prompt.question,(i,R)=>(r(),p("div",{class:"question-item",key:R},U(i.content),1))),128))])],512),[[_t,!c.value]])]),_:1},8,["isEdit"])}}},Vl=D(Nl,[["__scopeId","data-v-bc797bf6"]]),Ml={class:"robot-info-box"},zl={class:"modal-box",ref:"modalBoxRef"},Pl={class:"modal-item-box"},Dl={class:"modal-item"},Tl={class:"modal-item"},Bl={__name:"problem-optimization",setup(N){const c=q(!1);q(!1);const{robotInfo:f,updateRobotInfo:a}=J("robotInfo"),m=q("0"),o=P({optimize_question_use_model:"",optimize_question_model_config_id:""});ht(()=>{m.value=f.optimize_question_model_config_id!=0?"1":"0",o.optimize_question_use_model=f.optimize_question_use_model,o.optimize_question_model_config_id=f.optimize_question_model_config_id});const n=q([]),g=u=>{n.value=u,Kt(()=>{(!o.optimize_question_use_model||!Number(o.optimize_question_model_config_id))&&y()})},y=()=>{if(n.value.length>0){let u=null,s=null;for(let d of n.value)if(d.model_define==="tongyi"){u=d;for(let $ of u.children)if($.name==="qwen-max"){s=$;break}break}u||(u=n.value[0],s=u.children[0]),u&&s&&(o.optimize_question_use_model=s.name,o.optimize_question_model_config_id=s.model_config_id)}},x=()=>{c.value=!1,a({...G(o)})},b=u=>{u!=1&&(o.optimize_question_use_model="",o.optimize_question_model_config_id=0)},_=u=>{a({})};return(u,s)=>{const d=ot,$=et,w=Nt,i=jt,R=kt,C=Y;return r(),j(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:l(()=>[...s[7]||(s[7]=[t("span",null,null,-1)])]),default:l(()=>[t("div",Ml,[s[9]||(s[9]=t("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),e(d,null,{title:l(()=>[...s[8]||(s[8]=[t("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])]),default:l(()=>[t("div",{class:"dialog-bg-set",onClick:s[0]||(s[0]=v=>c.value=!0)}," 对话背景设置 ")]),_:1})]),e($,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(f).enable_question_optimize,"onUpdate:checked":s[1]||(s[1]=v=>k(f).enable_question_optimize=v),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t("div",zl,[e(C,{getContainer:()=>u.$refs.modalBoxRef,open:c.value,"onUpdate:open":s[6]||(s[6]=v=>c.value=v),width:472,title:"用户问题建议设置",onOk:x},{default:l(()=>[t("div",Pl,[t("div",Dl,[s[12]||(s[12]=t("div",{class:"label"},"模型",-1)),e(i,{value:m.value,"onUpdate:value":s[2]||(s[2]=v=>m.value=v),onChange:b},{default:l(()=>[e(w,{value:"0"},{default:l(()=>[...s[10]||(s[10]=[I("跟随机器人",-1)])]),_:1}),e(w,{value:"1"},{default:l(()=>[...s[11]||(s[11]=[I("指定模型",-1)])]),_:1})]),_:1},8,["value"]),m.value=="1"?(r(),j(Vt,{key:0,modelType:"LLM",modeName:o.optimize_question_use_model,"onUpdate:modeName":s[3]||(s[3]=v=>o.optimize_question_use_model=v),modeId:o.optimize_question_model_config_id,"onUpdate:modeId":s[4]||(s[4]=v=>o.optimize_question_model_config_id=v),style:{width:"100%","margin-top":"8px"},onLoaded:g},null,8,["modeName","modeId"])):L("",!0)]),t("div",Tl,[s[13]||(s[13]=t("div",{class:"label"},"对话背景",-1)),e(R,{style:{height:"120px"},value:k(f).optimize_question_dialogue_background,"onUpdate:value":s[5]||(s[5]=v=>k(f).optimize_question_dialogue_background=v),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Jl=D(Bl,[["__scopeId","data-v-a42248ec"]]),Fl={class:"robot-info-box"},Ql={class:"robot-prompt"},Kl={__name:"suggested-issues",setup(N){q(!1);const{robotInfo:c,updateRobotInfo:f}=J("robotInfo"),a=m=>{f({})};return(m,o)=>{const n=wt,g=et;return r(),j(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:l(()=>[...o[2]||(o[2]=[t("span",null,null,-1)])]),default:l(()=>[t("div",Fl,[t("div",Ql,[o[3]||(o[3]=I(" 开启后，机器人回答问题后，自动根据对话内容提供 ",-1)),e(n,{value:k(c).question_guide_num,"onUpdate:value":o[0]||(o[0]=y=>k(c).question_guide_num=y),style:{width:"80px"},precision:0,min:1,max:10,onBlur:a},null,8,["value"]),o[4]||(o[4]=I(" 条用户提问建议，最大不超过10条。 ",-1))])]),e(g,{onChange:a,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(c).enable_question_guide,"onUpdate:checked":o[1]||(o[1]=y=>k(c).enable_question_guide=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Gl=D(Kl,[["__scopeId","data-v-f6a291d4"]]),Wl={__name:"sensitive-words",setup(N){q(!1);const{robotInfo:c,updateRobotInfo:f}=J("robotInfo");P({prompt:""});const a=()=>{window.open("/#/user/sensitive-words")},m=o=>{f({})};return(o,n)=>{const g=et;return r(),j(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:l(()=>[...n[1]||(n[1]=[t("span",null,null,-1)])]),default:l(()=>[t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},[n[2]||(n[2]=I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，",-1)),t("span",{onClick:a,style:{cursor:"pointer"}},"设置敏词 >")])]),e(g,{onChange:m,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(c).sensitive_words_switch,"onUpdate:checked":n[0]||(n[0]=y=>k(c).sensitive_words_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Hl=D(Wl,[["__scopeId","data-v-56c388e6"]]),Zl={class:"direct-title"},Xl={class:"direct-desc"},Yl={class:"qa"},ta={class:"prompt-form-item-label"},ea={class:"direct-switch"},oa={class:"similarity"},sa={class:"number-input-box"},na={__name:"chat-edit-alert",emits:["save"],setup(N,{expose:c,emit:f}){const a=f,m=q(1),o=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=P(o()),g=q(!1),y=P({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{y.chat_type=m.value.toString(),n.forEach(u=>{u.chat_type==m.value&&(y.chat_type=="3"?(y.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch==1?"true":"false",y.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score.toString()):y.chat_type=="1"&&(y.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch==1?"true":"false",y.library_qa_direct_reply_score=u.library_qa_direct_reply_score.toString()))}),b(),Object.assign(n,o()),g.value=!1},b=()=>{a("save",G(y))};ht(()=>{});const _=u=>{m.value=parseInt(u.chat_type),y.chat_type=u.chat_type,y.library_qa_direct_reply_score=u.library_qa_direct_reply_score,y.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch,y.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,y.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch,n.forEach(s=>{s.chat_type=="3"?(s.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,s.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch=="true"?1:0):s.chat_type=="1"&&(s.library_qa_direct_reply_score=u.library_qa_direct_reply_score,s.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch=="true"?1:0)}),g.value=!0};return rt(()=>g.value,u=>{u===!1&&Object.assign(n,o())},{immediate:!0}),c({open:_}),(u,s)=>{const d=ot,$=et,w=wt,i=Nt,R=jt,C=Y;return r(),j(C,{width:"746px",open:g.value,"onUpdate:open":s[1]||(s[1]=v=>g.value=v),title:"聊天模式设置",onOk:x},{default:l(()=>[e(R,{class:"direct-box",value:m.value,"onUpdate:value":s[0]||(s[0]=v=>m.value=v)},{default:l(()=>[(r(!0),p(z,null,Z(n,v=>(r(),j(i,{class:Ut(["direct-item",{active:m.value==v.direct_id}]),value:v.direct_id,key:v.direct_id},{default:l(()=>[t("div",Zl,U(v.direct_title),1),t("div",Xl,U(v.direct_desc),1),dt(t("div",Yl,[t("div",ta,[s[4]||(s[4]=t("span",{class:"qa-title"},"命中问答知识时直接回复答案",-1)),e(d,null,me({default:l(()=>[e(k(W),{class:"question-icon"})]),_:2},[v.chat_type=="1"?{name:"title",fn:l(()=>[s[2]||(s[2]=I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"0"}:v.chat_type=="3"?{name:"title",fn:l(()=>[s[3]||(s[3]=I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过指定阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。",-1))]),key:"1"}:void 0]),1024),t("div",ea,[v.chat_type=="1"?(r(),j($,{key:0,checkedValue:1,unCheckedValue:0,checked:v.library_qa_direct_reply_switch,"onUpdate:checked":S=>v.library_qa_direct_reply_switch=S},null,8,["checked","onUpdate:checked"])):v.chat_type=="3"?(r(),j($,{key:1,checkedValue:1,unCheckedValue:0,checked:v.mixture_qa_direct_reply_switch,"onUpdate:checked":S=>v.mixture_qa_direct_reply_switch=S},null,8,["checked","onUpdate:checked"])):L("",!0)])])],512),[[_t,v.isQaDirectReply&&m.value==v.direct_id]]),dt(t("div",oa,[s[5]||(s[5]=t("span",null,"相似度超过",-1)),t("div",sa,[v.chat_type=="1"?(r(),j(w,{key:0,value:v.library_qa_direct_reply_score,"onUpdate:value":S=>v.library_qa_direct_reply_score=S,disabled:!v.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):v.chat_type=="3"?(r(),j(w,{key:1,value:v.mixture_qa_direct_reply_score,"onUpdate:value":S=>v.mixture_qa_direct_reply_score=S,disabled:!v.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):L("",!0)]),s[6]||(s[6]=t("span",null,"时直接回复答案",-1))],512),[[_t,v.isQaDirectReply&&m.value==v.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ia=D(na,[["__scopeId","data-v-ba2922ca"]]),la={class:"actions-box"},aa={class:"setting-info-block"},ra={class:"set-item"},da={key:0},_a={key:1},ca={key:2},ua={class:"set-item"},pa={key:0,class:"set-item"},ma={class:"set-item"},va={key:0,class:"set-item"},ba={class:"form-box"},fa={__name:"index",setup(N){const c=q(!1),f=q(null),{robotInfo:a,updateRobotInfo:m}=J("robotInfo"),o=P({chat_type:a.chat_type,library_qa_direct_reply_score:a.library_qa_direct_reply_score,library_qa_direct_reply_switch:a.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:a.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:a.mixture_qa_direct_reply_switch}),n=x=>{o.chat_type=x.chat_type,o.library_qa_direct_reply_score=x.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,o.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,g()},g=()=>{m({...G(o)}),c.value=!1},y=()=>{f.value.open(G(o)),c.value=!0};return(x,b)=>{const _=ot,u=tt;return r(),j(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":b[1]||(b[1]=s=>c.value=s),bodyStyle:{padding:0}},{tip:l(()=>[e(_,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:l(()=>[...b[2]||(b[2]=[t("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),t("br",null,null,-1),t("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])]),default:l(()=>[e(k(W))]),_:1})]),extra:l(()=>[t("div",la,[e(u,{size:"small",onClick:b[0]||(b[0]=s=>y(!0))},{default:l(()=>[...b[3]||(b[3]=[I("修改",-1)])]),_:1})])]),default:l(()=>[t("div",aa,[t("div",ra,[b[4]||(b[4]=I(" 聊天模式： ",-1)),k(a).chat_type=="1"?(r(),p("span",da,"仅知识库")):L("",!0),k(a).chat_type=="2"?(r(),p("span",_a,"直连模式")):L("",!0),k(a).chat_type=="3"?(r(),p("span",ca,"混合模式")):L("",!0)]),k(a).chat_type=="1"?(r(),p(z,{key:0},[t("div",ua,[b[5]||(b[5]=I(" 命中问答知识时直接回复答案： ",-1)),t("span",null,U(k(a).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(a).library_qa_direct_reply_switch=="true"?(r(),p("div",pa,[b[6]||(b[6]=I(" 相似度阈值： ",-1)),t("span",null,U(k(a).library_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0),k(a).chat_type=="3"?(r(),p(z,{key:1},[t("div",ma,[b[7]||(b[7]=I(" 命中问答知识时直接回复答案： ",-1)),t("span",null,U(k(a).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(a).mixture_qa_direct_reply_switch=="true"?(r(),p("div",va,[b[8]||(b[8]=I(" 相似度阈值： ",-1)),t("span",null,U(k(a).mixture_qa_direct_reply_score),1)])):L("",!0)],64)):L("",!0)]),t("div",ba,[e(ia,{ref_key:"ChatEditAlertRef",ref:f,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},ha=D(fa,[["__scopeId","data-v-eafe1264"]]),ya={class:"switch-box"},ka={class:"switch-box-body"},ga={class:"switch-box-header"},$a={class:"left-box"},xa={class:"switch-box-title"},wa={key:0,class:"title-tip"},qa={class:"right-box"},Sa={class:"extra-box"},Ca={class:"switch-desc"},Ia={class:"switch-box-right"},La={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(N,{emit:c}){const f=c,a=N,m=q(a.value),o=n=>{f("update:value",n),f("change",n)};return(n,g)=>{const y=ct,x=et;return r(),p("div",ya,[t("div",ka,[t("div",ga,[t("div",$a,[e(y,{class:"switch-box-icon",name:a.iconName},null,8,["name"]),t("span",xa,U(a.title),1),n.$slots.tip?(r(),p("span",wa,[mt(n.$slots,"tip",{},void 0,!0)])):L("",!0)]),t("div",qa,[t("div",Sa,[mt(n.$slots,"extra",{},()=>[g[1]||(g[1]=t("div",{class:"extra-box"},null,-1))],!0)])])]),t("div",Ca,[mt(n.$slots,"default",{},void 0,!0)])]),t("div",Ia,[e(x,{checked:m.value,"onUpdate:checked":g[0]||(g[0]=b=>m.value=b),onChange:o,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ua=D(La,[["__scopeId","data-v-8d185d5f"]]),Ra="/assets/img/phone-head-CDwwPhYa.png",Ea="/assets/img/phone-body-CbEf8GZP.png",Oa="/assets/img/phone-footer-ClQtNpln.png",Aa={class:"common-problem-box"},ja={class:"left-content-box"},Na={key:0,class:"empty-box"},Va={key:1,class:"lists-box"},Ma={class:"drag-btn"},za={class:"title"},Pa={class:"opration-box"},Da={class:"preview-box"},Ta={class:"phone-body"},Ba={key:0,class:"question-box"},Ja={__name:"common-problem",setup(N){q(!1);const{robotInfo:c,updateRobotInfo:f}=J("robotInfo"),a=H(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),m=q([]);m.value=a.value,rt(a,()=>{m.value=a.value});const o=At.useForm,n=q(!1),g=q("添加问题"),y=P({question:"",index:-1}),x=P({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:b,validate:_,validateInfos:u}=o(y,x),s=()=>{if(a.value.length>=10)return K.error("最多设置10条常用问题");n.value=!0,b(),y.question="",y.index=-1},d=(C,v)=>{n.value=!0,b(),y.question=C,y.index=v},$=C=>{let v=[];v=a.value.filter((S,T)=>C!=T),Y.confirm({title:"提醒",icon:e(Lt),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){f({common_question_list:JSON.stringify(v)})},onCancel(){}})},w=()=>{_().then(()=>{let C=[];y.index>=0?C=a.value.map((v,S)=>S===y.index?y.question:v):C=[y.question,...a.value],f({common_question_list:JSON.stringify(C)}),n.value=!1})},i=C=>{f({})},R=C=>{f({common_question_list:JSON.stringify(m.value)})};return(C,v)=>{const S=ot,T=et,E=je,V=tt,F=ct,st=yt,B=Wt,O=At,ut=Y;return r(),p("div",Aa,[t("div",ja,[e(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:l(()=>[e(S,null,{title:l(()=>[...v[4]||(v[4]=[I("最多10条。开启后，常见问题会显示在每条问答后面",-1)])]),default:l(()=>[e(k(W),{class:"quess-icon"})]),_:1})]),extra:l(()=>[e(T,{onChange:i,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(c).enable_common_question,"onUpdate:checked":v[0]||(v[0]=Q=>k(c).enable_common_question=Q),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e(E,{type:"vertical"}),e(V,{type:"primary",size:"small",onClick:s},{default:l(()=>[...v[5]||(v[5]=[I("添加",-1)])]),_:1})]),default:l(()=>[a.value.length==0?(r(),p("div",Na,[v[7]||(v[7]=t("img",{src:eo,alt:""},null,-1)),v[8]||(v[8]=t("div",{class:"title"},"暂无数据",-1)),v[9]||(v[9]=t("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),e(V,{onClick:s,type:"primary"},{default:l(()=>[...v[6]||(v[6]=[I("立即添加",-1)])]),_:1})])):(r(),p("div",Va,[e(k(Mt),{modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=Q=>m.value=Q),handle:".drag-btn","item-key":"index",onEnd:R},{item:l(({element:Q,index:bt})=>[(r(),p("div",{class:"list-item",key:bt},[t("span",Ma,[e(F,{name:"drag"})]),t("div",za,U(Q),1),t("div",Pa,[e(k(oe),{onClick:Et=>d(Q,bt)},null,8,["onClick"]),e(k(vt),{onClick:Et=>$(bt)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),t("div",Da,[v[12]||(v[12]=t("div",{class:"phone-head"},[t("img",{class:"head-img",src:Ra,alt:""})],-1)),t("div",Ta,[v[11]||(v[11]=t("div",null,[t("img",{class:"body-img",src:Ea,alt:""})],-1)),a.value.length&&k(c).enable_common_question=="true"?(r(),p("div",Ba,[v[10]||(v[10]=t("div",{class:"name"},"常见问题",-1)),(r(!0),p(z,null,Z(a.value,Q=>(r(),p("div",{class:"list-item",key:Q},U(Q),1))),128))])):L("",!0)]),v[13]||(v[13]=t("div",{class:"phone-footer"},[t("img",{class:"footer-img",src:Oa,alt:""})],-1))]),e(ut,{open:n.value,"onUpdate:open":v[3]||(v[3]=Q=>n.value=Q),title:g.value,onOk:w,width:"476px"},{default:l(()=>[e(O,{class:"form-box",layout:"vertical"},{default:l(()=>[e(B,Qt({label:"问题名称"},k(u).question),{default:l(()=>[e(st,{maxLength:100,value:y.question,"onUpdate:value":v[2]||(v[2]=Q=>y.question=Q),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Fa=D(Ja,[["__scopeId","data-v-5125783f"]]),Qa={__name:"display-aitations",setup(N){const{robotInfo:c,updateRobotInfo:f}=J("robotInfo"),a=q(!1);rt(()=>c.answer_source_switch,o=>{a.value=o=="true"},{immediate:!0});const m=()=>{f({answer_source_switch:a.value?"true":"false"})};return(o,n)=>(r(),j(Ua,{title:"显示引文","icon-name":"jibenpeizhi",value:a.value,"onUpdate:value":n[0]||(n[0]=g=>a.value=g),onChange:m},{extra:l(()=>[...n[1]||(n[1]=[t("span",null,null,-1)])]),default:l(()=>[n[2]||(n[2]=t("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1},8,["value"]))}},Ka={__name:"show-like",setup(N){const{robotInfo:c,updateRobotInfo:f}=J("robotInfo"),a=m=>{f({})};return(m,o)=>{const n=et;return r(),j(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:l(()=>[...o[1]||(o[1]=[t("span",null,null,-1)])]),default:l(()=>[o[2]||(o[2]=t("div",{class:"robot-info-box"},[t("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),e(n,{onChange:a,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(c).feedback_switch,"onUpdate:checked":o[0]||(o[0]=g=>k(c).feedback_switch=g),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ga=D(Ka,[["__scopeId","data-v-4948feb9"]]),Wa={class:"content-box"},Ha={key:0,class:"add-btn-block"},Za={class:"list-content"},Xa={key:0,class:"user-block"},Ya={class:"name-box"},tr={class:"name"},er={class:"remark-text"},or={key:0,class:"hover-btn-box"},sr={key:0},nr={key:1},ir={key:2},lr={key:1,class:"hover-btn-box"},ar={class:"role-menu-box"},rr=["onClick"],dr={class:"menu-header"},_r={key:0,class:"check-box"},cr=["onClick"],ur={class:"menu-header"},pr={key:0,class:"check-box"},mr=["onClick"],vr={class:"menu-header"},br={key:0,class:"check-box"},fr={class:"hover-btn-box"},hr={key:0},yr={key:1},kr={key:2},gr=["onClick"],$r={__name:"role-permission",setup(N){const c=$e(),f=H(()=>c.user_name),a=Jt().query,m=q(xe(a.id)),o=q([]),n=P({object_id:a.id,object_type:1}),g=()=>{oo({...n}).then(s=>{let d=s.data||[];o.value=d})};g();const y=q(null),x=()=>{y.value.show(o.value,[{object_id:+a.id,object_type:1,operate_rights:4}])},b=(s,d)=>{let $=d==4?"管理":d==2?"编辑":"查看";Y.confirm({title:"提示?",icon:e(Lt),content:"确认修改该协作者权限为【"+$+"】",okText:"确认",cancelText:"取消",onOk:()=>{let w=[{object_id:+s.object_id,object_type:+s.object_type,operate_rights:+d}];so({identity_ids:s.identity_id,identity_type:s.identity_type,object_array:JSON.stringify(w)}).then(i=>{K.success("修改成功"),g()})},onCancel(){}})},_=s=>{Y.confirm({title:"提示?",icon:e(Lt),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{no({identity_id:s.identity_id,identity_type:s.identity_type,object_id:s.object_id,object_type:s.object_type}).then(d=>{K.success("删除成功"),g()})},onCancel(){}})},u=q([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(s,d)=>{const $=tt,w=Ne,i=Ve,R=ze,C=ie;return r(),j(C,null,{default:l(()=>[t("div",Wa,[m.value==4?(r(),p("div",Ha,[e($,{type:"primary",onClick:x,icon:Ft(k(Rt))},{default:l(()=>[...d[0]||(d[0]=[I("添加协助者",-1)])]),_:1},8,["icon"])])):L("",!0),t("div",Za,[e(R,{columns:u.value,"data-source":o.value,pagination:!1},{bodyCell:l(({column:v,record:S})=>[v.key==="name"?(r(),p("div",Xa,[e(w,{shape:"square",src:S.avatar,size:40},{icon:l(()=>[S.avatar?L("",!0):(r(),j(k(Tt),{key:0}))]),_:2},1032,["src"]),t("div",Ya,[t("div",tr,U(S.user_name),1),t("div",er,U(S.name),1)])])):L("",!0),v.key==="operate_rights"?(r(),p(z,{key:1},[m.value==2||S.user_name==f.value?(r(),p("div",or,[S.operate_rights==4?(r(),p("span",sr,"管理")):L("",!0),S.operate_rights==2?(r(),p("span",nr,"编辑")):L("",!0),S.operate_rights==1?(r(),p("span",ir,"查看")):L("",!0)])):S.role_type==1||S.is_creator==1?(r(),p("div",lr,"管理")):(r(),j(i,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:l(()=>[t("div",ar,[t("div",{class:"role-menu",onClick:T=>b(S,4)},[t("div",dr,[e(k(Tt)),d[1]||(d[1]=t("span",{class:"title"},"管理",-1))]),d[2]||(d[2]=t("div",{class:"desc"},"可编辑，可删除，可查看",-1)),S.operate_rights==4?(r(),p("div",_r,[e(k(Ot))])):L("",!0)],8,rr),t("div",{class:"role-menu",onClick:T=>b(S,2)},[t("div",ur,[e(k(oe)),d[3]||(d[3]=t("span",{class:"title"},"编辑",-1))]),d[4]||(d[4]=t("div",{class:"desc"},"可编辑，可查看",-1)),S.operate_rights==2?(r(),p("div",pr,[e(k(Ot))])):L("",!0)],8,cr),t("div",{class:"role-menu",onClick:T=>b(S,1)},[t("div",vr,[e(k(Me)),d[5]||(d[5]=t("span",{class:"title"},"查看",-1))]),d[6]||(d[6]=t("div",{class:"desc"},"仅查看",-1)),S.operate_rights==1?(r(),p("div",br,[e(k(Ot))])):L("",!0)],8,mr)])]),default:l(()=>[t("div",fr,[S.operate_rights==4?(r(),p("span",hr,"管理")):L("",!0),S.operate_rights==2?(r(),p("span",yr,"编辑")):L("",!0),S.operate_rights==1?(r(),p("span",kr,"查看")):L("",!0),e(k(te))])]),_:2},1024))],64)):L("",!0),v.key==="action"?(r(),p(z,{key:2},[m.value==4&&S.user_name!=f.value?(r(),p(z,{key:0},[S.role_type!=1&&S.is_creator!=1?(r(),p("a",{key:0,onClick:T=>_(S)},"移除",8,gr)):L("",!0)],64)):L("",!0)],64)):L("",!0)]),_:1},8,["columns","data-source"])])]),e(io,{onOk:g,ref_key:"addCollaboratorRef",ref:y},null,512)]),_:1})}}},xr=D($r,[["__scopeId","data-v-3b4cded6"]]),wr={class:"actions-box"},qr={key:0,class:"library-list"},Sr=["onClick"],Cr={class:"library-name"},Ir={class:"library-intro"},Lr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(N){const c=q(!1),{robotInfo:f,getRobot:a}=J("robotInfo"),m=N,o=P({work_flow_ids:[]}),n=q(null),g=H(()=>m.robotList.filter(u=>o.work_flow_ids.includes(u.id))),y=u=>{let s=o.work_flow_ids.indexOf(u.id);o.work_flow_ids.splice(s,1),_()},x=u=>{o.work_flow_ids=[...u],_()},b=()=>{n.value.open([...o.work_flow_ids])},_=()=>{let u={...G(o)};u.work_flow_ids=u.work_flow_ids.join(","),Be({id:f.id,...u}).then(s=>{K.success("保存成功"),a(f.id)})};return $t(()=>{o.work_flow_ids=f.work_flow_ids.split(",")}),(u,s)=>{const d=ot,$=tt,w=xt;return r(),j(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:c.value,"onUpdate:isEdit":s[0]||(s[0]=i=>c.value=i),bodyStyle:{padding:0}},{tip:l(()=>[e(d,{placement:"top"},{title:l(()=>[...s[1]||(s[1]=[t("span",null,"支持关联工作流",-1)])]),default:l(()=>[e(k(W))]),_:1})]),extra:l(()=>[t("div",wr,[e(w,{gap:8},{default:l(()=>[e($,{size:"small",onClick:b},{default:l(()=>[...s[2]||(s[2]=[I("添加技能",-1)])]),_:1})]),_:1})])]),default:l(()=>[g.value.length>0?(r(),p("div",qr,[(r(!0),p(z,null,Z(g.value,i=>(r(),p("div",{class:"library-item",key:i.id},[t("span",{class:"close-btn",onClick:R=>y(i)},[e(k(vt))],8,Sr),t("div",Cr,U(i.robot_name),1),t("div",Ir,U(i.robot_intro),1)]))),128))])):L("",!0),e(lo,{ref_key:"robotSelectAlertRef",ref:n,onChange:x},null,512)]),_:1},8,["isEdit"])}}},Ur=D(Lr,[["__scopeId","data-v-13cb67dc"]]),Rr={class:"robot-info-box"},Er={class:"set-block"},Or={class:"switch-item"},Ar={__name:"chat-cache",setup(N){const{robotInfo:c,updateRobotInfo:f}=J("robotInfo"),a=P({valid_time:"",cache_switch:0}),m=P({unix:"h",hValue:24,mValue:1440}),o=()=>{m.unix==="h"?a.valid_time=m.hValue*3600:a.valid_time=m.mValue*60,f({cache_config:{...a}})},n=()=>{o()},g=()=>{m.unix=="h"?m.hValue=parseInt(m.mValue/60):m.mValue=parseInt(m.hValue*60)},y=()=>{Y.confirm({title:"确定清空缓存?",icon:e(Lt),content:"确定操作清空缓存吗？",onOk(){Je({id:c.id,robot_key:c.robot_key}).then(x=>{K.success("清空成功")})}})};return rt(()=>c.cache_config,()=>{let x=c.cache_config||{};x=JSON.parse(JSON.stringify(x)),a.cache_switch=x.cache_switch,a.valid_time=x.valid_time,x.valid_time%3600==0?(m.unix="h",m.hValue=x.valid_time/3600):(m.unix="m",m.mValue=parseInt(x.valid_time/60)||1440)},{immediate:!0,deep:!0}),$t(()=>{}),(x,b)=>{const _=wt,u=Zt,s=Ht,d=Pe,$=tt,w=et;return r(),j(X,{class:"setting-box",title:"聊天缓存","icon-name":"chat-cache"},{extra:l(()=>[...b[4]||(b[4]=[t("span",null,null,-1)])]),default:l(()=>[t("div",Rr,[b[7]||(b[7]=I(" 开启后，会缓存用户的问题和大模型的答案，如果之后有用户提出相同的问题，会直接回复缓存的答案。缓存有效期为 ",-1)),t("div",Er,[e(d,{compact:""},{default:l(()=>[m.unix=="h"?(r(),j(_,{key:0,onBlur:o,precision:0,value:m.hValue,"onUpdate:value":b[0]||(b[0]=i=>m.hValue=i),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(r(),j(_,{key:1,onBlur:o,precision:0,value:m.mValue,"onUpdate:value":b[1]||(b[1]=i=>m.mValue=i),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),e(s,{value:m.unix,"onUpdate:value":b[2]||(b[2]=i=>m.unix=i),style:{width:"70px"},onChange:g},{default:l(()=>[e(u,{value:"h"},{default:l(()=>[...b[5]||(b[5]=[I("小时",-1)])]),_:1}),e(u,{value:"m"},{default:l(()=>[...b[6]||(b[6]=[I("分钟",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])]),t("div",Or,[e($,{onClick:y,size:"small"},{default:l(()=>[...b[8]||(b[8]=[I("清空缓存",-1)])]),_:1}),e(w,{onChange:n,checkedValue:1,unCheckedValue:0,checked:a.cache_switch,"onUpdate:checked":b[3]||(b[3]=i=>a.cache_switch=i),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])]),_:1})}}},jr=D(Ar,[["__scopeId","data-v-18ea6c2b"]]),Nr={key:0,class:"robot-config-page"},Vr={class:"setting-box"},Mr={class:"setting-box"},zr={class:"setting-box"},Pr={class:"setting-box"},Dr={class:"setting-box"},Tr={class:"setting-box"},Br={class:"setting-box"},Jr={class:"setting-box"},Fr={class:"setting-box"},Qr={class:"setting-box"},Kr={class:"setting-box"},Gr={class:"setting-box"},Wr={class:"setting-box"},Hr={class:"setting-box"},Zr={class:"setting-box"},Xr={key:1,class:"robot-config-page"},Yr={key:2,class:"robot-config-page"},Bt="/robot/config/basic-config/activeKey",td={__name:"index",setup(N){const c=se(),f=q(null),{robotInfo:a}=ve(c),{getRobot:m}=c,o=We(),n=()=>{f.value.scrollTop=f.value.scrollHeight},g=q(+localStorage.getItem(Bt)||1),y=q(!1),x=P(a.value),b=$=>{let w=JSON.parse(JSON.stringify($));$.robot_avatar&&(w.robot_avatar=new File([$.robot_avatar],$.robot_avatar.name)),!w.op_type_relation_library&&x.op_type_relation_library&&delete x.op_type_relation_library,Object.assign(x,w),s()},_=q([]),u=()=>{Fe({application_type:1}).then($=>{_.value=$.data||[]})};be("robotInfo",{robotInfo:x,updateRobotInfo:b,scrollBoxToBottom:n,getRobot:m});const s=()=>{let $;x.robot_avatar&&($=new File([x.robot_avatar],x.robot_avatar.name));let w=JSON.parse(JSON.stringify(G(x)));$&&(w.robot_avatar=$);let i=w.welcomes;i.question=i.question.map(C=>C.content),w.welcomes=JSON.stringify(i),w.prompt_struct=JSON.stringify(w.prompt_struct);let R=w.unknown_question_prompt;R.question=R.question.map(C=>C.content),w.unknown_question_prompt=JSON.stringify(R),w.cache_config=JSON.stringify(w.cache_config),delete w.robot_avatar_url,y.value=!0,Qe(w).then(C=>{if(C.res!=0)return K.error(C.msg);y.value=!1,K.success("保存成功"),m(x.id)}).catch(()=>{y.value=!1})},d=()=>{localStorage.setItem(Bt,g.value)};return ht(()=>{u(),o.getAllmodelList()}),($,w)=>{const i=Xt,R=Yt;return r(),p(z,null,[e(R,{class:"tab-wrapper",onChange:d,activeKey:g.value,"onUpdate:activeKey":w[0]||(w[0]=C=>g.value=C)},{default:l(()=>[(r(),j(i,{key:1,tab:"基础配置"})),L("",!0),(r(),j(i,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),g.value==1?(r(),p("div",Nr,[t("div",{class:"scroll-box",ref_key:"scrollBox",ref:f},[t("div",Vr,[e(Ro)]),t("div",Mr,[e(el)]),t("div",zr,[e(Kn)]),t("div",Pr,[e(ha)]),t("div",Dr,[e(jr)]),t("div",Tr,[e(_n,{robotList:_.value},null,8,["robotList"])]),t("div",Br,[e(Ur,{robotList:_.value},null,8,["robotList"])]),t("div",Jr,[e(vl)]),t("div",Fr,[e(Sl)]),t("div",Qr,[e(Vl)]),t("div",Kr,[e(Hl)]),t("div",Gr,[e(Jl)]),t("div",Wr,[e(Gl)]),t("div",Hr,[e(Qa)]),t("div",Zr,[e(Ga)])],512)])):L("",!0),g.value==2?(r(),p("div",Xr,[e(Fa)])):L("",!0),g.value==3?(r(),p("div",Yr,[e(xr)])):L("",!0)],64)}}},Id=D(td,[["__scopeId","data-v-8a1f782c"]]);export{Id as default};
