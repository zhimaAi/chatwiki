import{b as q,d as Y,k as D,bx as F,ds as M,M as R,bO as G,d$ as H,l as W,B as X,a1 as Z,bw as K,E as Q,bU as ee}from"../../index-CzPebXix.js";import{N as w,F as te,a1 as oe,O as g,X as o,_ as x,a0 as L,j as n,U as l,d as C,b as S,z as B,q as ae,S as ne,W as N,u as O,a2 as se,a6 as re,Z as ie}from"./vue-chunks-BRsu9_To.js";import{M as le,_ as de}from"./index-DlQVT6K6.js";import"./index-BSz5XTfh.js";import{D as _e}from"./dropdown-DTOAy9tU.js";import{t as ce}from"./validate-8MtiUsxW.js";import{A as pe}from"./avatar-input-57yunkxv.js";import{F as I,_ as me}from"./index-BgVvqN-n.js";import"./index-BFhVTGQQ.js";import{I as ue}from"./Input-DFtZp9vk.js";import{_ as fe}from"./TextArea-DrgXbuSS.js";import{_ as ye}from"./page-alert-hUfedjgw.js";import{P as ve}from"./PlusOutlined-BlmIiILr.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./shallowequal-C0xnIuy8.js";import"./Trigger-Bvakuge0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-CsbPJG8I.js";import"./index-Bhf8G0AA.js";import"./index-BwqnaIPU.js";import"./colors-DfoziJR7.js";import"./RightOutlined-DH_YROnp.js";import"./move-CkiYyFmr.js";import"./index-7Ecr060x.js";import"./Password-fnCqxsm2.js";import"./inputProps-jdR54afw.js";import"./DownloadOutlined-CeWsYko2.js";import"./index-hvcgcTJ4.js";import"./CheckOutlined-Mk6nTpyE.js";import"./useRefs-CRRjy_qY.js";import"./useMergedState-C0iIHNGF.js";import"./FormItemContext-B2RmG14m.js";import"./isPlainObject-OEy0Jz8l.js";import"./Col-CFxRRwN8.js";import"./responsiveObserve-DqAe0rZk.js";import"./QuestionCircleOutlined-DTfTQPH4.js";import"./index-Bxqtz4sn.js";import"./Search-Cf7bcOZJ.js";import"./SearchOutlined-a_gTycfl.js";const be={class:"list-box"},ge=["onClick"],he={class:"library-info"},ke=["src"],xe={class:"library-info-content"},we={class:"library-title"},Le={class:"item-body"},Ce={class:"library-desc"},$e={class:"item-footer"},Ae={class:"library-size"},De={class:"text-item"},Oe={class:"text-item"},qe=["onClick"],Be=["onClick"],Ne={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup($,{emit:h}){const y=h,m=$,_=d=>{y("edit",d)},c=d=>{y("delete",d)};return(d,p)=>{const u=Y,v=de,e=le,i=_e;return g(),w("div",be,[(g(!0),w(te,null,oe(m.list,t=>(g(),w("div",{class:"list-item-wrapper",key:t.id},[o("div",{class:"list-item",onClick:L(s=>_(t),["stop"])},[o("div",he,[o("img",{class:"library-icon",src:t.avatar,alt:""},null,8,ke),o("div",xe,[o("div",we,x(t.library_name),1)])]),o("div",Le,[o("div",Ce,x(t.library_intro),1)]),o("div",$e,[o("div",Ae,[o("span",De,"文档："+x(t.file_total),1),o("span",Oe,"大小："+x(t.file_size_str),1)]),o("div",{class:"action-box",onClick:p[1]||(p[1]=L(()=>{},["stop"]))},[n(i,null,{overlay:l(()=>[n(e,null,{default:l(()=>[n(v,null,{default:l(()=>[o("a",{href:"javascript:;",onClick:L(s=>_(t),["stop"])},"管 理",8,qe)]),_:2},1024),n(v,null,{default:l(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:s=>c(t)},"删 除",8,Be)]),_:2},1024)]),_:2},1024)]),default:l(()=>[o("div",{class:"action-item",onClick:p[0]||(p[0]=L(()=>{},["stop"]))},[n(u,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,ge)]))),128))])}}},Ie=q(Ne,[["__scopeId","data-v-8e17564f"]]),Fe={class:"form-box"},Me={__name:"add-library-model",setup($,{expose:h}){D.config({duration:2});const y=se(),m=C(!1),_=S(()=>1);let c="",d="";const p=I.useForm,u=C(!1),v=_.value==0?F:M,e=B({type:_.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:v,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:_.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),i=B({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:t,validateInfos:s}=p(e,i),k=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},E=()=>{m.value=!1},T=()=>{t().then(()=>{P()}).catch(a=>{})},P=()=>{let a=new FormData,r=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",r.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(ce(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),u.value=!0,G(a).then(b=>{D.success("创建成功"),d=b.data.id,c=b.data.library_key,z(b.data.id)}).catch(()=>{u.value=!1})},U=async()=>await H({library_key:c,doc_id:"",doc_type:"4",pid:0,title:"无标题文档",content:"# 无标题文档",sort:0}),z=()=>{U().then(a=>{let r=a.data.doc_id;y.replace({path:"/public-library/editor",query:{library_id:d,library_key:c,doc_id:r}})})};return h({show:()=>{m.value=!0}}),ae(()=>{}),(a,r)=>{const b=ue,A=me,V=fe,j=I,J=R;return g(),ne(J,{open:m.value,"onUpdate:open":r[3]||(r[3]=f=>m.value=f),title:"添加知识库",onOk:T,confirmLoading:u.value,onCancel:E,width:"640px"},{default:l(()=>[o("div",Fe,[n(j,{"label-col":{span:5}},{default:l(()=>[n(A,N({ref:"name",label:"知识库名称"},O(s).library_name),{default:l(()=>[n(b,{value:e.library_name,"onUpdate:value":r[0]||(r[0]=f=>e.library_name=f),type:"text",placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),n(A,{label:"知识库简介"},{default:l(()=>[n(V,{maxlength:1e3,value:e.library_intro,"onUpdate:value":r[1]||(r[1]=f=>e.library_intro=f),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(A,N({ref:"name",label:"知识库封面"},O(s).avatar),{default:l(()=>[n(pe,{value:e.avatar,"onUpdate:value":r[2]||(r[2]=f=>e.avatar=f),onChange:k},null,8,["value"]),r[4]||(r[4]=o("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[4]},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Re=q(Me,[["__scopeId","data-v-74974e9d"]]),Se={"bg-color":"#f5f9ff",class:"library-page"},Ee={class:"library-page-body"},Te={class:"list-toolbar"},Pe={class:"toolbar-box"},Ue={class:"list-total"},ze={key:0,class:"toolbar-box"},Ve={__name:"index",setup($){let{role_permission:h,role_type:y}=W();const m=S(()=>y==1||h.includes("CreateOpenLibDoc")),_=C(null),c=C([]),d=()=>{Z({type:1}).then(i=>{let t=i.data||[];t.forEach(s=>{s.file_size_str=K(s.file_size),s.avatar||(s.avatar=s.type==0?F:M)}),c.value=t})};d();const p=()=>{_.value.show()},u=i=>{window.open(`/#/public-library/home?library_id=${i.id}&library_key=${i.library_key}`,"_blank","noopener")},v=i=>{let t=3,s=R.confirm({title:`删除${i.library_name}`,icon:n(Q),content:"您确定要删除此知识库吗？",okText:t+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){e(i)},onCancel(){}}),k=setInterval(()=>{t==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(k),k=void 0):(t-=1,s.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:i})=>{ee({id:i}).then(()=>{D.success("删除成功"),d()})};return(i,t)=>{const s=X;return g(),w("div",Se,[t[3]||(t[3]=o("div",{class:"page-title"},"对外文档",-1)),n(ye,{style:{"margin-bottom":"16px"},title:"使用说明"},{default:l(()=>t[1]||(t[1]=[o("div",null,[o("p",null," 1、对外文档作为在线文档创作管理工具，创作的文档既可作为知识库关联到机器人使用，也可分享给好友查看。 "),o("p",null,"2、支持设置每篇文档的title、description、keyword，提高SEO搜索权重。")],-1)])),_:1,__:[1]}),o("div",Ee,[o("div",Te,[o("div",Pe,[o("h3",Ue,"全部 ("+x(c.value.length)+")",1)]),m.value?(g(),w("div",ze,[n(s,{type:"primary",onClick:t[0]||(t[0]=k=>p())},{icon:l(()=>[n(O(ve))]),default:l(()=>[t[2]||(t[2]=ie(" 新建对外文档 "))]),_:1,__:[2]})])):re("",!0)]),o("div",null,[n(Ie,{list:c.value,onAdd:p,onEdit:u,onDelete:v},null,8,["list"])])]),n(Re,{ref_key:"addLibraryModelRef",ref:_},null,512)])}}},Ft=q(Ve,[["__scopeId","data-v-04d1c792"]]);export{Ft as default};
