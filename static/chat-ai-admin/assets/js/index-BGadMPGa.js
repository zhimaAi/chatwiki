import{a as b,b as u,p as e,y as n,q as R,_ as C,v as a,C as fe,e as A,t as c,u as t,n as je,h as ce,r as L,O as Y,E as K,c as X,z as ue,D as pe,a1 as ee,ah as Me,F as T,l as W,x as gt,T as yt,w as re,G as Ze,Q as qe,an as de,ao as be,m as et,j as ge,J as kt,Y as wt,am as Ve,i as tt,ak as xt,aj as $t,P as Ct}from"./vue-chunks-BdaA73Wf.js";import{u as j,_ as ae,a4 as St,Y as qt,a0 as Lt,ah as Ut,c as Et,A as Rt,ab as Ie,d as It,ag as Ot}from"../../index-DSFcP5NQ.js";import{_ as z}from"./emoji-mart-BBMRoEa3.js";import{B as se,J as ke,I as me,V as we,ai as He,a0 as Vt,an as Pt,ag as ot,M as te,b as Q,F as Oe,c as ze,u as Pe,v as Ne,$ as st,Z as nt,az as Nt,q as le,aA as Dt,H as ne,ao as ye,a1 as De,D as it,aq as At,ae as Tt,af as jt,r as Be,s as Je,ac as H,aB as lt,G as xe,m as Mt,R as zt,E as Bt,N as at,aa as rt,z as Jt,O as Se,X as Kt,U as Xe,a9 as Ft,h as Te,ab as Wt,x as Qt,aj as Gt,aC as Ht,f as Xt,g as Yt,i as Zt}from"./ui-antd-Dl1wwwCD.js";import{C as eo}from"./cu-upload-Y6kcDw7r.js";import{u as Ae}from"./robot-CIzNpArp.js";import{u as to,v as oo,w as so,x as no,y as io,g as lo,z as ao}from"./index-Cg7-0swo.js";import{_ as ro,a as co,M as _o}from"./meta-filter-box-CVXR7ud2.js";import{g as ct,M as Ke,u as uo}from"./model-select-CMPvMrAQ.js";import{L as po}from"./library-select-alert-BCR3m1P9.js";import{_ as mo}from"./recommendation-AQ4_FPQ9.js";import{W as ho}from"./index-Bm4uv5SC.js";import{_ as _t}from"./cu-scroll-CpIj948h.js";import{a as vo}from"./index-C67uUbSa.js";import{g as dt}from"./index-p9HhDhmV.js";import{_ as bo}from"./empty-CzGZrENG.js";import{_ as fo}from"./empty-BFmzY9bl.js";import{i as go,e as yo,f as ko}from"./index-o_l8g-wS.js";import{A as wo}from"./add-collaborator-Ww1-CyL9.js";import{R as xo}from"./robot-select-alert-C-TcP7vJ.js";import"./editor-cherry-CFIsbKoN.js";import"./neo4j-MWxXN7EM.js";import"./lodash-Bm5sK6rN.js";import"./elkjs-BN8GIjVH.js";import"./utils-CvB22N-W.js";import"./other-LrIFyvU9.js";import"./index-MT9fcN3v.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";const $o={class:"edit-box-header"},Co={class:"left-box"},So={class:"edit-box-title"},qo={key:0},Lo={key:0,class:"title-tip"},Uo={class:"right-box"},Eo={class:"extra-box"},Ro={class:"actions-box"},Io={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(v,{emit:o}){const d=o,l=v,{t:r}=j("views.robot.robot-config.basic-config.components.edit-box"),_=s=>{d("edit"),d("update:isEdit",s)},i=()=>{d("save")};return(s,f)=>{const w=ae,x=se,$=ke;return u(),b("div",{class:ce(["edit-box",{"is-edit":v.isEdit}])},[e("div",$o,[e("div",Co,[n(w,{class:"edit-box-icon",name:l.iconName},null,8,["name"]),e("span",So,[C(a(l.title)+" ",1),s.$slots.icon?(u(),b("span",qo,[fe(s.$slots,"icon",{},void 0,!0)])):R("",!0)]),s.$slots.tip?(u(),b("span",Lo,[fe(s.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",Uo,[e("div",Eo,[fe(s.$slots,"extra",{},()=>[e("div",Ro,[l.isEdit?(u(),A($,{key:0,gap:8},{default:c(()=>[n(x,{onClick:i,size:"small",type:"primary"},{default:c(()=>[C(a(t(r)("btn_save")),1)]),_:1}),n(x,{onClick:f[0]||(f[0]=I=>_(!1)),size:"small"},{default:c(()=>[C(a(t(r)("btn_cancel")),1)]),_:1})]),_:1})):(u(),A(x,{key:1,onClick:f[1]||(f[1]=I=>_(!0)),size:"small"},{default:c(()=>[C(a(t(r)("btn_edit")),1)]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:je({...v.bodyStyle})},[fe(s.$slots,"default",{},void 0,!0)],4)],2)}}},Z=z(Io,[["__scopeId","data-v-951e0bb6"]]),Oo={class:"robot-form-box"},Vo={class:"form-item"},Po={class:"form-item-label"},No={class:"form-item-body robot-name-item"},Do={class:"robot-avetar-upload"},Ao=["src"],To={class:"robot-name-box"},jo={class:"form-item"},Mo={class:"form-item-label"},zo={class:"form-item-body"},Bo={class:"robot-info-box"},Jo={class:"robot-name-box"},Ko=["src"],Fo={class:"robot-name"},Wo={class:"robot-intro"},Qo={__name:"basic-config",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.basic-config"),d=Ae(),l=L(!1),{robotInfo:r,updateRobotInfo:_}=Y("robotInfo"),i=K({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),s=X(()=>d.robotList||[]),f=X(()=>d.robotGroupList||[]),w=X(()=>{let y=o("msg_ungrouped"),h=s.value.find(q=>q.id==r.id)||{};if(h.group_id>0){let q=f.value.find(S=>S.id==h.group_id);q&&(y=q.group_name)}return y}),x=()=>{_({...ee(i)}),l.value=!1},$=y=>{let h=y[0];return i.robot_avatar=h,St(h).then(q=>{i.robot_avatar_url=q}),!1},I=()=>{i.robot_name=r.robot_name,i.robot_intro=r.robot_intro,i.robot_avatar=r.robot_avatar,i.robot_avatar_url=r.robot_avatar_url};return(y,h)=>{const q=me,S=we;return u(),A(Z,{class:"basic-config",title:t(o)("title_basic_config"),"icon-name":"jibenpeizhi",isEdit:l.value,"onUpdate:isEdit":h[2]||(h[2]=m=>l.value=m),onSave:x,onEdit:I},{default:c(()=>[ue(e("div",Oo,[e("div",Vo,[e("div",Po,a(t(o)("label_robot_name_avatar")),1),e("div",No,[n(eo,{accept:"image/*",onChange:$},{default:c(()=>[e("div",Do,[i.robot_avatar_url?(u(),b("img",{key:0,class:"robot-avetar",src:i.robot_avatar_url},null,8,Ao)):R("",!0)])]),_:1}),e("div",To,[n(q,{value:i.robot_name,"onUpdate:value":h[0]||(h[0]=m=>i.robot_name=m),placeholder:t(o)("ph_input_robot_name")},null,8,["value","placeholder"])])])]),e("div",jo,[e("div",Mo,a(t(o)("label_intro")),1),e("div",zo,[n(S,{rows:3,value:i.robot_intro,"onUpdate:value":h[1]||(h[1]=m=>i.robot_intro=m),placeholder:t(o)("ph_input_robot_intro"),"allow-clear":""},null,8,["value","placeholder"])])])],512),[[pe,l.value]]),ue(e("div",Bo,[e("div",Jo,[e("img",{class:"robot-avatar",src:t(r).robot_avatar_url,alt:""},null,8,Ko),e("span",Fo,a(t(r).robot_name),1)]),e("div",Wo,[e("span",null,a(t(o)("label_group"))+a(w.value),1),e("span",null,a(t(o)("label_intro_colon"))+a(t(r).robot_intro||t(o)("msg_no_intro")),1)])],512),[[pe,!l.value]])]),_:1},8,["title","isEdit"])}}},Go=z(Qo,[["__scopeId","data-v-75cd355b"]]),Ho={class:"ai-create-box"},Xo={class:"input-box"},Yo={key:1},Zo={key:2},es={class:"quick-tags-box"},ts={class:"quick-label"},os={class:"ai-list-box"},ss={key:0,class:"loading-box"},ns={key:0,class:"prompt-list-box"},is={class:"prompt-list"},ls={class:"prompt-header"},as={class:"prompt-title"},rs={class:"prompt-content"},cs={class:"prompt-list"},_s={class:"prompt-header"},ds={class:"prompt-title"},us={class:"prompt-content"},ps={class:"prompt-list"},ms={class:"prompt-header"},hs={class:"prompt-title"},vs={class:"prompt-content"},bs={class:"prompt-list"},fs={class:"prompt-header"},gs={class:"prompt-title"},ys={class:"prompt-content"},ks={class:"prompt-list"},ws={class:"prompt-header"},xs={class:"prompt-title"},$s={class:"prompt-content"},Cs={class:"prompt-header"},Ss={class:"prompt-title"},qs={class:"prompt-content"},Ls={key:1,class:"empty-box"},Us={__name:"ai-create-prompt",emits:["handleAiSave"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.ai-create-prompt"),r=He.PRESENTED_IMAGE_SIMPLE,_=L(!1),i=L(!1),s=Me().query,f=d,w=L(""),x=L(!1),$=[{title:l("quick_ecommerce_after_sales")},{title:l("quick_english_education_pre_sales")}],I=L(l("msg_input_requirement")),y=()=>{h.value=!1,S.promptStruct=q,w.value="",I.value=l("msg_input_requirement"),_.value=!0},h=L(!1),q={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},S=K({promptStruct:q}),m=E=>{w.value=E},p=()=>{if(!w.value)return Q.error(l("msg_empty_input"));if(x.value)return Q.error(l("msg_generating_in_progress"));x.value=!0,to({id:s.id,demand:w.value}).then(E=>{S.promptStruct=JSON.parse(E.data.promptStruct),h.value=!0}).finally(()=>{x.value=!1}).catch(E=>{h.value=!1,I.value=E.msg})},k=()=>{if(!h.value)return Q.error(l("msg_prompt_not_generated"));f("handleAiSave",S.promptStruct),_.value=!1};return o({show:y}),(E,g)=>{const N=se,J=we,P=ae,M=Pt,F=ot,oe=He,O=te;return u(),b("div",null,[n(O,{open:_.value,"onUpdate:open":g[1]||(g[1]=U=>_.value=U),title:t(l)("title_ai_generate_prompt"),wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","overflow-y":"auto"},width:856},{footer:c(()=>[n(N,{type:"primary",loading:i.value,onClick:k},{default:c(()=>[C(a(t(l)("btn_use_prompt")),1)]),_:1},8,["loading"])]),default:c(()=>[e("div",Ho,[e("div",Xo,[n(J,{style:{width:"100%"},value:w.value,"onUpdate:value":g[0]||(g[0]=U=>w.value=U),size:"large","auto-size":"",placeholder:t(l)("ph_input_prompt")},null,8,["value","placeholder"]),e("div",{class:ce(["btn-box",{"disabed-status":x.value}]),onClick:p},[x.value?(u(),A(t(Vt),{key:0})):R("",!0),n(P,{name:"ai-mark"}),x.value?(u(),b("span",Yo,a(t(l)("txt_generating")),1)):(u(),b("span",Zo,a(t(l)("btn_generate")),1))],2)]),e("div",es,[e("div",ts,a(t(l)("label_quick_generate")),1),(u(),b(T,null,W($,U=>n(M,{key:U.title,onClick:ie=>m(U.title),color:"blue"},{default:c(()=>[C(a(U.title),1)]),_:2},1032,["onClick"])),64))]),e("div",os,[x.value?(u(),b("div",ss,[n(F,{tip:t(l)("tip_generating")},null,8,["tip"])])):(u(),b(T,{key:1},[h.value?(u(),b("div",ns,[e("div",is,[e("div",ls,[e("div",as,a(S.promptStruct.role.subject),1)]),e("div",rs,a(S.promptStruct.role.describe),1)]),e("div",cs,[e("div",_s,[e("div",ds,a(S.promptStruct.task.subject),1)]),e("div",us,a(S.promptStruct.task.describe),1)]),e("div",ps,[e("div",ms,[e("div",hs,a(S.promptStruct.constraints.subject),1)]),e("div",vs,a(S.promptStruct.constraints.describe),1)]),e("div",bs,[e("div",fs,[e("div",gs,a(S.promptStruct.output.subject),1)]),e("div",ys,a(S.promptStruct.output.describe),1)]),e("div",ks,[e("div",ws,[e("div",xs,a(S.promptStruct.tone.subject),1)]),e("div",$s,a(S.promptStruct.tone.describe),1)]),(u(!0),b(T,null,W(S.promptStruct.custom,(U,ie)=>(u(),b("div",{class:"prompt-list",key:ie+U.key?U.key:""},[e("div",Cs,[e("div",Ss,a(U.subject),1)]),e("div",qs,a(U.describe),1)]))),128))])):(u(),b("div",Ls,[n(oe,{image:t(r),description:I.value},null,8,["image","description"])]))],64))])])]),_:1},8,["open","title"])])}}},Es=z(Us,[["__scopeId","data-v-d678856e"]]),Rs={__name:"upload-prompt",setup(v,{expose:o}){const{t:d}=j("components.import-prompt.upload-prompt"),l=L(!1),r=K({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),_=L(null),i=$=>{if($.prompt_type==0&&!$.prompt)return Q.error(d("msg_custom_prompt_empty"));_.value&&_.value.resetFields();let I={...$};r.title="",r.group_id=0,r.prompt="",r.prompt_struct={},r.prompt_type=I.prompt_type,I.prompt_type==0?r.prompt=I.prompt:r.prompt_struct=JSON.stringify(I.prompt_struct),l.value=!0},s=L([]);(()=>{qt().then($=>{s.value=[{id:0,group_name:d("group_default")},...$.data]})})();const w=L(!1),x=()=>{_.value.validate().then(()=>{let $={...r};w.value=!0,Lt({...$}).then(()=>{Q.success(d("msg_save_success")),l.value=!1}).finally(()=>{w.value=!1})})};return o({show:i}),($,I)=>{const y=me,h=ze,q=Ne,S=Pe,m=Oe,p=te;return u(),b("div",null,[n(p,{open:l.value,"onUpdate:open":I[2]||(I[2]=k=>l.value=k),title:t(d)("title_save_to_library"),width:580,onOk:x,confirmLoading:w.value},{default:c(()=>[n(m,{style:{"margin-top":"24px"},"label-col":{span:5},"wrapper-col":{span:18},ref_key:"formRef",ref:_,model:r},{default:c(()=>[n(h,{name:"title",label:t(d)("label_prompt_title"),rules:[{required:!0,message:t(d)("msg_input_prompt_title")}]},{default:c(()=>[n(y,{value:r.title,"onUpdate:value":I[0]||(I[0]=k=>r.title=k),placeholder:t(d)("ph_input_prompt_title"),maxLength:10},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),n(h,{name:"group_id",label:t(d)("label_group")},{default:c(()=>[n(S,{value:r.group_id,"onUpdate:value":I[1]||(I[1]=k=>r.group_id=k),style:{width:"100%"}},{default:c(()=>[(u(!0),b(T,null,W(s.value,k=>(u(),A(q,{value:k.id},{default:c(()=>[C(a(k.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Is={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right",isClickRight:!1}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(v){v&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(v){const o=[],d=[],l=(r,_)=>{if(!r||r.length===0)return!1;for(let i=0;i<r.length;i++){const s=r[i],f=s[this.valueKey];if(f===v)return o[_]=s,d[_]=f,!0;if(s[this.childrenKey]&&s[this.childrenKey].length>0){if(o[_]=s,d[_]=f,l(s[this.childrenKey],_+1))return!0;o[_]=null,d[_]=null}}return!1};l(this.options,0),this.selectedPath=o.filter(r=>r),this.selectedValuePath=d.filter(r=>r!=null),this.updateActivePath()},findPathByValues(v){if(!v||v.length===0)return;const o=[];let d=this.options;for(let l=0;l<v.length;l++){const r=v[l],_=d.find(i=>i[this.valueKey]===r);if(_)o.push(_),d=_[this.childrenKey]||[];else break}this.selectedPath=o,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let v=0;v<this.selectedPath.length;v++){const o=this.selectedPath[v];o[this.childrenKey]&&o[this.childrenKey].length>0&&this.activePath.push({title:o[this.labelKey],options:o[this.childrenKey],level:v+1})}},handleRightClick(){this.isClickRight=!0},handleSelect(v,o,d){this.hasChildren(v)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,o),this.selectedPath.push(v),this.selectedValuePath=this.selectedValuePath.slice(0,o),this.selectedValuePath.push(v[this.valueKey]),this.activePath=this.activePath.slice(0,o+1),this.hasChildren(v)&&this.activePath.push({title:v[this.labelKey],options:v[this.childrenKey],level:o+1}),this.$emit("select",v,this.selectedPath,o),this.selectedPath,(this.checkAnyLevel&&!this.isClickRight&&o>0||!this.hasChildren(v))&&(this.$emit("change",v[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:v[this.valueKey])),this.isClickRight=!1},isActive(v,o){return!this.selectedPath||this.selectedPath.length<=o?!1:v[this.valueKey]===this.selectedPath[o][this.valueKey]},hasChildren(v){return v[this.childrenKey]&&v[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const v=this.$el;if(!v)return;const o=v.getBoundingClientRect(),d=window.innerWidth,l=180;o.right+l>d&&o.left>l?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",l)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",l))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},Os={class:"cascade-panel"},Vs={class:"cascade-panel-body"},Ps=["onClick"],Ns={class:"item-content"},Ds={class:"item-label"},As={key:0,class:"cascade-panel-empty"};function Ts(v,o,d,l,r,_){return u(),b("div",Os,[e("div",{class:ce(["cascade-panel-container",[`expand-direction-${r.expandDirection}`]])},[(u(!0),b(T,null,W(r.activePath,(i,s)=>(u(),b("div",{class:"cascade-panel-list",key:s},[e("div",Vs,[(u(!0),b(T,null,W(i.options,f=>(u(),b("div",{class:ce(["cascade-panel-item",{active:_.isActive(f,s)}]),key:f.value,onClick:w=>_.handleSelect(f,s,w)},[e("div",Ns,[e("span",Ds,a(f.label),1),_.hasChildren(f)?(u(),b("span",{key:0,class:"item-icon",onClick:o[0]||(o[0]=(...w)=>_.handleRightClick&&_.handleRightClick(...w))},[...o[1]||(o[1]=[e("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[e("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)])])):R("",!0)])],10,Ps))),128)),i.options&&i.options.length===0?(u(),b("div",As," 暂无数据 ")):R("",!0)])]))),128))],2)])}const js=z(Is,[["render",Ts],["__scopeId","data-v-23a4c8e2"]]),ut=v=>{let o=[];return v.forEach(d=>{d.children&&d.children.length>0?o.push(...ut(d.children)):o.push(d)}),o},Ms={name:"JMention",components:{CascadePanel:js},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(v){return["input","textarea"].includes(v)}},placeholder:{type:String,default:"ph_input"},defaultValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""},checkAnyLevel:{type:Boolean,default:!1}},setup(){const{t:v}=j("views.robot.robot-config.basic-config.components.at-input.index");return{t:v}},data(){return{timer:null,showDropdown:!1,positionStyle:"",selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(v){v.trim()!=this.localValue.trim()&&this.refresh()},showDropdown(v){this.onOpen(v)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(v){v.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(v){v.target.closest(".dropdown-list")&&v.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1},onFocus(){this.$emit("focus")},onOpen(v){this.$emit("open",v)},getText(v){const o=document.createElement("div");o.innerHTML=v;let d="";return Array.from(o.childNodes).forEach(l=>{let r="";this.type==="textarea"?l.nodeName==="BR"?r=`
`:l.classList&&l.classList.contains("j-mention-at")?r=l.dataset.value:r=l.textContent:l.classList&&l.classList.contains("j-mention-at")?r=l.dataset.value:l.nodeName==="BR"?r="":r=l.textContent.replace(/\n/g,""),(r==="&nbsp;"||r===" ")&&(r=""),d+=r}),d},onChange(){const v=this.$refs.JMention;if(!v)return;let o=v.innerHTML,d=this.getText(o);this.localValue=d;let l={};this.selectedList.forEach(_=>{!l[_.value]&&d.indexOf(_.value)!==-1&&(l[_.value]=_)});let r=Object.values(l);this.$emit("change",d.trim(),r)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const v=this.$refs.JMention;let o=this.defaultValue.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=this.defaultSelectedList||[],l=ut(this.options),r=[...d,...l].filter(i=>i&&i.value&&i.value!=""&&i.typ!=="node");const _=new Set;r.forEach(i=>{const s=new RegExp(`(${i.value})`,"g");s.test(this.defaultValue)&&!_.has(i.value)&&(o=o.replace(s,`<span class="j-mention-at" data-id="${i.id}" contentEditable="false" data-value="${i.value}">${i.label}</span>`),_.add(i.value),this.selectOption(i,!0))}),v.innerHTML=o,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(v=>this.atText?v.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(v.id+""))},getLastChar(v=1){const o=window.getSelection();if(o.rangeCount<=0)return;const d=o.getRangeAt(0),l=d.startOffset,r=d.startContainer;let _="";if(r.nodeType===Node.TEXT_NODE)_=r.textContent.slice(0,l);else if(r.nodeType===Node.ELEMENT_NODE){const i=r.childNodes;for(let s=0;s<i.length;s++){const f=i[s];f.nodeType===Node.TEXT_NODE&&(s===i.length-1?_+=f.textContent.slice(0,l):_+=f.textContent)}}return _.slice(-v)},getLastAtText(){const v=window.getSelection();if(v.rangeCount<=0)return;const o=v.getRangeAt(0),d=o.startOffset,l=o.startContainer;let r="";if(l.nodeType===Node.TEXT_NODE)r=l.textContent.slice(0,d);else if(l.nodeType===Node.ELEMENT_NODE){const i=l.childNodes;for(let s=0;s<i.length;s++){const f=i[s];f.nodeType===Node.TEXT_NODE&&(s===i.length-1?r+=f.textContent.slice(0,d):r+=f.textContent)}}const _=r.lastIndexOf("/");return _===-1?"":r.slice(_+1)},async getCaretPosition(){const v=window.getSelection();if(v.rangeCount<=0)return{top:0,left:0};const d=v.getRangeAt(0).getBoundingClientRect(),l=await this.getDropdownListSize(),r=window.innerWidth,_=window.innerHeight;let i=d.bottom,s=d.left;return i+l.height>_&&(i=d.top-l.height),s+l.width>r&&(s=d.right-l.width),i<0&&(i=0),s<0&&(s=0),{top:i,left:s}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const v=this.$refs.dropdownList.offsetWidth,o=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:v,height:o}},updateSelectedList(){const o=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const d of o){let l=d.dataset.value;const r=this.options.find(_=>_.value==l);this.selectedList.push(r),this.selectedIdSet.add(l)}this.$emit("update:selectedList",this.selectedList),!(o.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(v){return this.options.filter(d=>d.label.startsWith(v)).length>0},updateValue(){this.onChange()},clickJMention(){this.showDropdown&&(this.showDropdown=!1)},debouncedUpdate(v){this.handleDropdownLogic(v),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.updateValue()},350)},handleBlur(){this.timer&&clearTimeout(this.timer),this.updateValue()},async handleDropdownLogic(v){const o=this.getLastChar();if(v.inputType==="deleteContentBackward"&&!this.atText)o!="/"&&(this.showDropdown=!1);else if(o==="/")this.showDropdown=!0,this.atText="";else{const r=this.getLastAtText();this.atText=r;const _=this.checkStartWith(r);r&&(this.showDropdown=_)}if(!this.showDropdown)return;const{top:d,left:l}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${l}px; top:${d}px;`},insertAtCaret(v,o){let d=this.atText.length+1;this.getLastChar(d)!=="/"+this.atText&&(d=0);const r=window.getSelection();if(r.rangeCount<=0)return;const _=r.getRangeAt(0),i=_.startOffset,s=_.startContainer;let f=i-d,w=s;if(f<0){let x=s.previousSibling;for(;x;){if(x.nodeType===Node.TEXT_NODE){f=x.textContent.length-d,w=x;break}x=x.previousSibling}}if(w.nodeType===Node.TEXT_NODE){w.replaceData(f,d,"");const x=document.createElement("span");x.contentEditable="false",x.classList.add("j-mention-at"),x.style=this.atTextStyle,x.textContent=`${v}`;for(const I in o)x.dataset[I]=o[I];const $=document.createRange();$.setStart(w,f),$.insertNode(x),_.setStartAfter(x),_.setEndAfter(x),r.removeAllRanges(),r.addRange(_)}},onSelectOption(v,o,d){let l=d[d.length-1];delete l.children,this.selectOption(l)},selectOption(v,o=!1){if(!v)return;this.showDropdown=!1;let d=v.label;const l={id:v.id,label:v.label,value:v.value,text:v.text,index:this.selectedList.length};this.selectedList.push(v),this.selectedIdSet.add(v.value),o||(this.insertAtCaret(d,l),this.initShowOptionList(),this.updateValue())},handleDirectionChange(v,o){const d=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),l=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!d||!l)return;const r=parseFloat(d[1]),_=parseFloat(l[1]);let i;v==="left"?i=r-o:i=r+o,this.positionStyle=`left:${i}px; top:${_}px;`}}},zs={style:{width:"100%",position:"relative"}},Bs={class:"mention-input-warpper mention-promt-input",ref:"JMentionContainer"},Js=["placeholder"],Ks={key:0,class:"placeholder"};function Fs(v,o,d,l,r,_){const i=gt("CascadePanel");return u(),b("div",zs,[o[4]||(o[4]=e("div",null,null,-1)),(u(),A(yt,{to:"body"},[r.showDropdown?(u(),b("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:je(r.positionStyle)},[n(i,{options:r.showOptions,checkAnyLevel:d.checkAnyLevel,onChange:_.onSelectOption,onDirectionChange:_.handleDirectionChange},null,8,["options","checkAnyLevel","onChange","onDirectionChange"])],4)):R("",!0)])),e("div",Bs,[e("div",{ref:"JMention",style:je([d.inputStyle]),class:ce(["j-mention",[{"show-placeholder":r.localValue.length==0},"type-"+d.type]]),contenteditable:"plaintext-only",placeholder:l.t(d.placeholder),onFocus:o[0]||(o[0]=(...s)=>_.onFocus&&_.onFocus(...s)),onInput:o[1]||(o[1]=(...s)=>_.debouncedUpdate&&_.debouncedUpdate(...s)),onClick:o[2]||(o[2]=(...s)=>_.clickJMention&&_.clickJMention(...s)),onBlur:o[3]||(o[3]=(...s)=>_.handleBlur&&_.handleBlur(...s))},null,46,Js),r.localValue.length==0?(u(),b("span",Ks,a(l.t(d.placeholder)),1)):R("",!0)],512)])}const Ws=z(Ms,[["render",Fs],["__scopeId","data-v-329676b6"]]),Qs={class:"prompt-box"},Gs={class:"tab-header"},Hs={key:0,class:"opt-block"},Xs={key:1,class:"opt-block"},Ys={class:"tip-text"},Zs={key:0,class:"prompt-list-box"},en={class:"prompt-list"},tn={class:"prompt-header"},on={class:"prompt-title"},sn={key:0,class:"btn-wrapper-box"},nn={class:"prompt-content"},ln={class:"prompt-list"},an={class:"prompt-header"},rn={class:"prompt-title"},cn={key:0,class:"btn-wrapper-box"},_n={class:"prompt-content"},dn={class:"prompt-list"},un={class:"prompt-header"},pn={class:"prompt-title"},mn={key:0,class:"btn-wrapper-box"},hn={class:"prompt-content"},vn={class:"prompt-list"},bn={class:"prompt-header"},fn={class:"prompt-title"},gn={key:0,class:"btn-wrapper-box"},yn={class:"prompt-content"},kn={class:"prompt-list"},wn={class:"prompt-header"},xn={class:"prompt-title"},$n={key:0,class:"btn-wrapper-box"},Cn={class:"swich-item"},Sn={class:"swich-item"},qn={class:"prompt-content"},Ln={class:"prompt-list"},Un={class:"prompt-header"},En={class:"prompt-title"},Rn={key:0,class:"btn-wrapper-box"},In={class:"prompt-content"},On={class:"prompt-header"},Vn={class:"prompt-title",style:{flex:"1"}},Pn={key:0,class:"btn-wrapper-box"},Nn=["onClick"],Dn={class:"prompt-content"},An={key:0,class:"add-theme-block"},Tn={class:"show-more-block"},jn={style:{color:"#8c8c8c"}},Mn={class:"diy-switch-box"},zn={class:"swich-item"},Bn={class:"swich-item"},Jn={class:"field-list-item"},Kn={class:"field-label"},Fn={class:"field-type"},Wn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.system-prompt-words"),d=Ae(),l=L(!1),{robotInfo:r,updateRobotInfo:_}=Y("robotInfo"),i=v,s=o("prompt_default_reply_markdown"),f=o("prompt_default_answer_image"),w=L({}),x=L(!1),$=L(!1),I=L(!1),y=L(!1),h=L(null),q=X(()=>d.chatVariables.map(V=>{let he=V.variable_key+"（"+V.variable_name+"）",_e=`【chat_variable:${V.variable_key}】`;return{...V,label:he,value:_e}}));re(()=>q,()=>{setTimeout(()=>{h.value&&h.value.refresh()},500)},{deep:!0});const S=(B,V)=>{m.prompt=B},m=K({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),p=L(localStorage.getItem("system_prompt_words_ishide")=="1"),k=()=>{p.value=!p.value,localStorage.setItem("system_prompt_words_ishide",p.value?1:0)},E=(B,V)=>B.includes(V),g=L(r.prompt_type),N=X(()=>r.prompt_type);re(()=>r,()=>{m.prompt=r.prompt,m.prompt_struct=r.prompt_struct,w.value=r.prompt_struct_default},{immediate:!0,deep:!0}),re(()=>m.prompt_struct.output.describe,B=>{x.value=E(B,s),$.value=E(B,f)},{immediate:!0,deep:!0}),re(()=>m.prompt,B=>{I.value=E(B,s),y.value=E(B,f)},{immediate:!0,deep:!0});const J=(B,V)=>{B?(V=="outSwitch"&&(m.prompt_struct.output.describe?m.prompt_struct.output.describe+=`
`+s:m.prompt_struct.output.describe+=s),V=="imgSwitch"&&(m.prompt_struct.output.describe?m.prompt_struct.output.describe+=`
`+f:m.prompt_struct.output.describe+=f)):(V=="outSwitch"&&(m.prompt_struct.output.describe=m.prompt_struct.output.describe.replace(new RegExp(s,"g"),"")),V=="imgSwitch"&&(m.prompt_struct.output.describe=m.prompt_struct.output.describe.replace(new RegExp(f,"g"),"")),m.prompt_struct.output.describe=m.prompt_struct.output.describe.trim())},P=(B,V)=>{B?(V=="outDiySwitch"&&(m.prompt?m.prompt+=`
`+s:m.prompt+=s),V=="imgDiySwitch"&&(m.prompt?m.prompt+=`
`+f:m.prompt+=f)):(V=="outDiySwitch"&&(m.prompt=m.prompt.replace(new RegExp(s,"g"),"")),V=="imgDiySwitch"&&(m.prompt=m.prompt.replace(new RegExp(f,"g"),"")),m.prompt=m.prompt.trim())},M=B=>{m.prompt_struct[B].describe=w.value[B].describe},F=()=>{let B=r.work_flow_ids.split(","),V=i.robotList.filter(_e=>B.includes(_e.id)),he=[];he=V.map(_e=>`- ${_e.robot_name} ${_e.robot_intro}`).join(`
`),m.prompt_struct.skill.describe=he},oe=()=>{m.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),g.value=1},O=B=>{m.prompt_struct.custom.splice(B,1)},U=()=>{_({...ee(m),prompt_type:g.value}),l.value=!1},ie=B=>{g.value=1,_({prompt_type:g.value,prompt:m.prompt,prompt_struct:B}),l.value=!1},G=()=>{g.value==0&&h.value&&h.value.refresh(),l.value=!0},$e=()=>{l.value=!1},Le=L(null),pt=()=>{Le.value.show()},Fe=L(null),mt=()=>{Fe.value.show()},We=L(null),ht=()=>{We.value.show({...m,prompt_type:g.value})},vt=B=>{B.prompt_type==1?(g.value=1,m.prompt_struct=B.prompt_struct):(g.value=0,m.prompt=B.prompt),U()};return(B,V)=>{const he=st,_e=nt,Qe=le,bt=ae,Ue=se,Ge=ke,ve=we,Ee=ne,ft=me;return u(),b("div",Qs,[e("div",Gs,[n(_e,{style:{width:"400px"},activeKey:g.value,"onUpdate:activeKey":V[0]||(V[0]=D=>g.value=D)},{default:c(()=>[(u(),A(he,{key:1,tab:t(o)("tab_structured")},null,8,["tab"])),(u(),A(he,{key:0,tab:t(o)("tab_custom")},null,8,["tab"]))]),_:1},8,["activeKey"]),l.value?(u(),b("div",Hs,[n(Qe,null,{title:c(()=>[C(a(t(o)("tooltip_upload")),1)]),default:c(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:ht},[n(t(Nt)),C(a(t(o)("btn_upload")),1)])]),_:1}),n(Qe,null,{title:c(()=>[C(a(t(o)("tooltip_import")),1)]),default:c(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:mt},[n(t(Dt)),C(a(t(o)("btn_import")),1)])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:pt},[n(bt,{name:"ai-mark"}),C(" "+a(t(o)("btn_ai_generate")),1)]),n(Ge,{gap:8},{default:c(()=>[n(Ue,{size:"small",type:"primary",onClick:U},{default:c(()=>[C(a(t(o)("btn_save")),1)]),_:1}),n(Ue,{size:"small",onClick:$e},{default:c(()=>[C(a(t(o)("btn_cancel")),1)]),_:1})]),_:1})])):(u(),b("div",Xs,[e("span",Ys,a(t(o)("msg_current_type"))+a(N.value==1?t(o)("msg_structured_prompt"):t(o)("msg_custom_prompt")),1),n(Ue,{size:"small",onClick:G},{default:c(()=>[C(a(t(o)("btn_edit")),1)]),_:1})]))]),g.value==1?(u(),b("div",Zs,[e("div",en,[e("div",tn,[e("div",on,a(m.prompt_struct.role.subject),1),l.value?(u(),b("div",sn,[e("a",{onClick:V[1]||(V[1]=D=>M("role"))},a(t(o)("btn_reset_default")),1)])):R("",!0)]),e("div",nn,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.role.describe,"onUpdate:value":V[2]||(V[2]=D=>m.prompt_struct.role.describe=D),placeholder:t(o)("ph_role")},null,8,["disabled","value","placeholder"])])]),e("div",ln,[e("div",an,[e("div",rn,a(m.prompt_struct.task.subject),1),l.value?(u(),b("div",cn,[e("a",{onClick:V[3]||(V[3]=D=>M("task"))},a(t(o)("btn_reset_default")),1)])):R("",!0)]),e("div",_n,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.task.describe,"onUpdate:value":V[4]||(V[4]=D=>m.prompt_struct.task.describe=D),placeholder:t(o)("ph_task")},null,8,["disabled","value","placeholder"])])]),p.value?(u(),b(T,{key:0},[e("div",dn,[e("div",un,[e("div",pn,a(m.prompt_struct.constraints.subject),1),l.value?(u(),b("div",mn,[e("a",{onClick:V[5]||(V[5]=D=>M("constraints"))},a(t(o)("btn_reset_default")),1)])):R("",!0)]),e("div",hn,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.constraints.describe,"onUpdate:value":V[6]||(V[6]=D=>m.prompt_struct.constraints.describe=D),placeholder:t(o)("ph_constraints"),style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",vn,[e("div",bn,[e("div",fn,a(m.prompt_struct.skill.subject),1),l.value?(u(),b("div",gn,[e("a",{onClick:V[7]||(V[7]=D=>F())},a(t(o)("btn_import_skill")),1)])):R("",!0)]),e("div",yn,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.skill.describe,"onUpdate:value":V[8]||(V[8]=D=>m.prompt_struct.skill.describe=D),placeholder:t(o)("ph_skill"),style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",kn,[e("div",wn,[e("div",xn,a(m.prompt_struct.output.subject),1),l.value?(u(),b("div",$n,[e("div",Cn,[C(a(t(o)("label_output_markdown"))+" ",1),n(Ee,{onChange:V[9]||(V[9]=D=>J(D,"outSwitch")),checked:x.value,"onUpdate:checked":V[10]||(V[10]=D=>x.value=D),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),e("div",Sn,[C(a(t(o)("label_reply_image"))+" ",1),n(Ee,{onChange:V[11]||(V[11]=D=>J(D,"imgSwitch")),checked:$.value,"onUpdate:checked":V[12]||(V[12]=D=>$.value=D),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),e("a",{onClick:V[13]||(V[13]=D=>M("output"))},a(t(o)("btn_reset_default")),1)])):R("",!0)]),e("div",qn,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.output.describe,"onUpdate:value":V[14]||(V[14]=D=>m.prompt_struct.output.describe=D),placeholder:t(o)("ph_output")},null,8,["disabled","value","placeholder"])])]),e("div",Ln,[e("div",Un,[e("div",En,a(m.prompt_struct.tone.subject),1),l.value?(u(),b("div",Rn,[e("a",{onClick:V[15]||(V[15]=D=>M("tone"))},a(t(o)("btn_reset_default")),1)])):R("",!0)]),e("div",In,[n(ve,{bordered:!1,disabled:!l.value,value:m.prompt_struct.tone.describe,"onUpdate:value":V[16]||(V[16]=D=>m.prompt_struct.tone.describe=D),placeholder:t(o)("ph_tone")},null,8,["disabled","value","placeholder"])])]),(u(!0),b(T,null,W(m.prompt_struct.custom,(D,Ce)=>(u(),b("div",{class:"prompt-list",key:Ce+D.key?D.key:""},[e("div",On,[e("div",Vn,[n(ft,{bordered:!1,disabled:!l.value,style:{width:"100%"},value:D.subject,"onUpdate:value":Re=>D.subject=Re,placeholder:t(o)("ph_input_subject")},null,8,["disabled","value","onUpdate:value","placeholder"])]),l.value?(u(),b("div",Pn,[e("div",{class:"hover-btn-box",onClick:Re=>O(Ce)},[n(t(ye))],8,Nn)])):R("",!0)]),e("div",Dn,[n(ve,{bordered:!1,disabled:!l.value,value:D.describe,"onUpdate:value":Re=>D.describe=Re,placeholder:t(o)("ph_input")},null,8,["disabled","value","onUpdate:value","placeholder"])])]))),128)),l.value?(u(),b("div",An,[n(Ue,{onClick:oe,block:"",icon:Ze(t(De))},{default:c(()=>[C(a(t(o)("btn_add_theme")),1)]),_:1},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",Tn,[e("div",{class:"btn-item",onClick:k},[p.value?(u(),b(T,{key:1},[C(a(t(o)("btn_collapse")),1),n(t(At))],64)):(u(),b(T,{key:0},[C(a(t(o)("btn_expand")),1),n(t(it))],64))])])])):(u(),b("div",{key:1,class:ce(["diy-prompt-box",{"is-disabled":!l.value}])},[l.value?(u(),A(Ge,{key:0,align:"center",justify:"space-between",style:{margin:"8px 0"}},{default:c(()=>[e("div",jn,a(t(o)("msg_var_insert_tip")),1),e("div",Mn,[e("div",zn,[C(a(t(o)("label_output_markdown"))+" ",1),n(Ee,{onChange:V[17]||(V[17]=D=>P(D,"outDiySwitch")),checked:I.value,"onUpdate:checked":V[18]||(V[18]=D=>I.value=D),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),e("div",Bn,[C(a(t(o)("label_reply_image"))+" ",1),n(Ee,{onChange:V[19]||(V[19]=D=>P(D,"imgDiySwitch")),checked:y.value,"onUpdate:checked":V[20]||(V[20]=D=>y.value=D),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])])])]),_:1})):R("",!0),n(Ws,{type:"textarea",inputStyle:"height: 126px",defaultValue:m.prompt,options:q.value,disabled:!0,checkAnyLevel:!0,ref_key:"atinputRef",ref:h,onChange:V[21]||(V[21]=(D,Ce)=>S(D))},{option:c(({label:D,payload:Ce})=>[e("div",Jn,[e("div",Kn,a(D),1),e("div",Fn,a(Ce.typ),1)])]),_:1},8,["defaultValue","options"])],2)),n(Es,{onHandleAiSave:ie,ref_key:"aiCreatePromptRef",ref:Le},null,512),n(ro,{onOk:vt,ref_key:"importPromptRef",ref:Fe},null,512),n(Rs,{ref_key:"uploadPromptRef",ref:We},null,512)])}}},Qn=z(Wn,[["__scopeId","data-v-85458233"]]),Gn={class:"actions-box"},Hn={class:"setting-info-block"},Xn={class:"set-item w-100"},Yn={class:"set-item"},Zn={class:"set-item"},ei={class:"set-item"},ti={class:"set-item"},oi={class:"form-box"},si={class:"form-item"},ni={class:"form-item-label mb12"},ii={class:"form-item-body"},li={class:"form-item",style:{display:"flex","align-items":"center"}},ai={class:"form-item-label mb12"},ri={class:"form-item"},ci={class:"form-item-label"},_i={class:"form-item-body"},di={class:"number-box"},ui={class:"number-slider-box"},pi={class:"number-input-box"},mi={class:"form-item"},hi={class:"form-item-label"},vi={class:"form-item-body"},bi={class:"number-box"},fi={class:"number-slider-box"},gi={class:"number-input-box"},yi={class:"form-item"},ki={class:"form-item-label"},wi={class:"form-item-body"},xi={class:"number-box"},$i={class:"number-slider-box"},Ci={class:"number-input-box"},Si={class:"form-item justify-between"},qi={class:"form-item-label"},Li={class:"form-item justify-between"},Ui={class:"form-item-label"},Ei={class:"form-item justify-between"},Ri={class:"form-item-label"},Ii={__name:"model-settings",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.model-settings"),d=K({sm:24,md:24,lg:12,xl:24,xxl:24});L([]);const l=L(!1),{robotInfo:r,updateRobotInfo:_,getRobot:i}=Y("robotInfo"),s=K({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0,question_multiple_switch:1}),f=L(!1),w=(m,p)=>{const k=p.attrs;s.question_multiple_switch=Number(k.input_image)||0,k&&k.input_image==1?f.value=!1:f.value=!0,s.use_model&&s.use_model.toLowerCase().includes("deepseek-r1")?s.prompt_role_type="1":s.prompt_role_type="0"},x=L({}),$=(m,p)=>{x.value=p},I=X(()=>{if(!s.model_config_id)return!1;let m=s.model_config_id+"#"+s.use_model;return x.value[m]}),y=()=>{let m={...ee(s)};_(m),l.value=!1},h=()=>{i(r.id).then(m=>{s.model_config_id=m.data.model_config_id,s.use_model=m.data.use_model})},q=m=>{s.use_model=r.use_model,s.model_config_id=r.model_config_id,s.temperature=r.temperature,s.max_token=r.max_token,s.context_pair=r.context_pair,s.think_switch=Number(r.think_switch),s.prompt_role_type=r.prompt_role_type,s.enable_thinking=r.enable_thinking,s.question_multiple_switch=Number(r.question_multiple_switch)||0,l.value=m};qe(()=>{s.use_model=r.use_model,s.model_config_id=r.model_config_id,s.temperature=r.temperature,s.max_token=r.max_token,s.context_pair=r.context_pair,s.think_switch=Number(r.think_switch),s.prompt_role_type=r.prompt_role_type,s.enable_thinking=r.enable_thinking,s.question_multiple_switch=Number(r.question_multiple_switch)||0});const S=X(()=>ct(s.model_config_id,s.use_model));return(m,p)=>{const k=se,E=jt,g=Je,N=Be,J=le,P=lt,M=xe,F=ne,oe=Tt,O=te;return u(),A(Z,{class:"setting-box",title:t(o)("title_model_settings"),"icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":p[14]||(p[14]=U=>l.value=U)},{extra:c(()=>[e("div",Gn,[n(k,{onClick:p[0]||(p[0]=U=>q(!0)),size:"small"},{default:c(()=>[C(a(t(o)("btn_modify")),1)]),_:1})])]),default:c(()=>[e("div",Hn,[e("div",Xn,[C(a(t(o)("label_llm_model"))+"： ",1),e("span",null,a(S.value),1)]),e("div",Yn,[C(a(t(o)("label_temperature"))+"： ",1),e("span",null,a(s.temperature),1)]),e("div",Zn,[C(a(t(o)("label_max_token"))+"： ",1),e("span",null,a(s.max_token),1)]),e("div",ei,[C(a(t(o)("label_context_pair"))+"： ",1),e("span",null,a(s.context_pair),1)]),e("div",ti,[C(a(t(o)("label_show_reasoning_process"))+"： ",1),e("span",null,a(s.think_switch==1?t(o)("state_on"):t(o)("state_off")),1)])]),n(O,{open:l.value,"onUpdate:open":p[13]||(p[13]=U=>l.value=U),width:672,title:t(o)("title_model_settings"),onCancel:h,onOk:y},{default:c(()=>[e("div",oi,[n(oe,{gutter:[32,24]},{default:c(()=>[n(E,de(be(d)),{default:c(()=>[e("div",si,[e("div",ni,[e("span",null,a(t(o)("label_llm_model"))+" ",1)]),e("div",ii,[n(Ke,{modelType:"LLM",modeName:s.use_model,"onUpdate:modeName":p[1]||(p[1]=U=>s.use_model=U),modeId:s.model_config_id,"onUpdate:modeId":p[2]||(p[2]=U=>s.model_config_id=U),onChange:w,onLoaded:$},null,8,["modeName","modeId"])])])]),_:1},16),n(E,de(be(d)),{default:c(()=>[e("div",li,[e("div",ai,[e("span",null,a(t(o)("label_prompt_role"))+"： ",1)]),e("div",null,[n(N,{value:s.prompt_role_type,"onUpdate:value":p[3]||(p[3]=U=>s.prompt_role_type=U)},{default:c(()=>[n(g,{value:"0"},{default:c(()=>[C(a(t(o)("option_system_role")),1)]),_:1}),n(g,{value:"1"},{default:c(()=>[C(a(t(o)("option_user_role")),1)]),_:1})]),_:1},8,["value"])])])]),_:1},16),n(E,de(be(d)),{default:c(()=>[e("div",ri,[e("div",ci,[e("span",null,a(t(o)("label_temperature"))+" ",1),n(J,null,{title:c(()=>[C(a(t(o)("tooltip_temperature")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),e("div",_i,[e("div",di,[e("div",ui,[n(P,{class:"custom-slider",value:s.temperature,"onUpdate:value":p[4]||(p[4]=U=>s.temperature=U),min:0,max:2,step:.1},null,8,["value"])]),e("div",pi,[n(M,{value:s.temperature,"onUpdate:value":p[5]||(p[5]=U=>s.temperature=U),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),n(E,de(be(d)),{default:c(()=>[e("div",mi,[e("div",hi,[e("span",null,a(t(o)("label_max_token"))+" ",1),n(J,null,{title:c(()=>[C(a(t(o)("tooltip_max_token")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),e("div",vi,[e("div",bi,[e("div",fi,[n(P,{class:"custom-slider",value:s.max_token,"onUpdate:value":p[6]||(p[6]=U=>s.max_token=U),min:0,max:100*1024},null,8,["value"])]),e("div",gi,[n(M,{value:s.max_token,"onUpdate:value":p[7]||(p[7]=U=>s.max_token=U),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),n(E,de(be(d)),{default:c(()=>[e("div",yi,[e("div",ki,[e("span",null,a(t(o)("label_context_pair"))+" ",1),n(J,null,{title:c(()=>[C(a(t(o)("tooltip_context_pair")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),e("div",wi,[e("div",xi,[e("div",$i,[n(P,{class:"custom-slider",value:s.context_pair,"onUpdate:value":p[8]||(p[8]=U=>s.context_pair=U),min:0,max:50},null,8,["value"])]),e("div",Ci,[n(M,{value:s.context_pair,"onUpdate:value":p[9]||(p[9]=U=>s.context_pair=U),min:0,max:50},null,8,["value"])])])])])]),_:1},16),n(E,de(be(d)),{default:c(()=>[e("div",Si,[e("div",qi,[e("span",null,a(t(o)("label_multimodal_input"))+" ",1),n(J,null,{title:c(()=>[e("span",null,a(t(o)("tooltip_multimodal_input")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),n(co,{title:t(o)("msg_model_not_support_multimodal"),disabled:!f.value},{default:c(()=>[n(F,{checked:s.question_multiple_switch,"onUpdate:checked":p[10]||(p[10]=U=>s.question_multiple_switch=U),checkedValue:1,unCheckedValue:0,disabled:f.value},null,8,["checked","disabled"])]),_:1},8,["title","disabled"])])]),_:1},16),I.value?(u(),A(E,de(et({key:0},d)),{default:c(()=>[e("div",Li,[e("div",Ui,[e("span",null,a(t(o)("label_deep_thinking"))+" ",1),n(J,null,{title:c(()=>[e("span",null,a(t(o)("tooltip_deep_thinking")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),n(F,{checked:s.enable_thinking,"onUpdate:checked":p[11]||(p[11]=U=>s.enable_thinking=U),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):R("",!0),n(E,de(be(d)),{default:c(()=>[e("div",Ei,[e("div",Ri,[e("span",null,a(t(o)("label_show_reasoning_process"))+" ",1),n(J,null,{title:c(()=>[e("span",null,a(t(o)("tooltip_show_reasoning_process")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),n(F,{checked:s.think_switch,"onUpdate:checked":p[12]||(p[12]=U=>s.think_switch=U),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open","title"])]),_:1},8,["title","isEdit"])}}},Oi=z(Ii,[["__scopeId","data-v-b3592e1e"]]),Vi={class:"recall-settings-box"},Pi={class:"form-box"},Ni={class:"form-item is-required"},Di={class:"form-item-label"},Ai={class:"form-item-body"},Ti={class:"retrieval-mode-items"},ji=["onClick"],Mi={class:"retrieval-mode-title"},zi={class:"title-text"},Bi={key:0,style:{width:"32px"},src:mo,alt:""},Ji={class:"retrieval-mode-desc"},Ki={key:0,class:"form-item"},Fi={class:"form-item"},Wi={class:"form-item-label"},Qi={class:"form-item-body"},Gi={class:"number-box"},Hi={class:"number-slider-box"},Xi={class:"number-input-box"},Yi={key:1,class:"form-item"},Zi={class:"form-item-label"},el={class:"form-item-body"},tl={class:"number-box"},ol={class:"number-slider-box"},sl={class:"number-input-box"},nl={class:"form-item"},il={class:"form-item-label"},ll={class:"setting-title"},al={style:{"font-size":"13px"}},rl={class:"form-item-body"},cl={class:"segment-controls"},_l={class:"segment-input"},dl={class:"segment-input"},ul={class:"segment-text"},pl={class:"form-item"},ml={class:"form-item-label"},hl={key:0,class:"form-item-body"},vl={class:"form-item"},bl={class:"form-item-label"},fl={key:0,class:"form-item-body"},gl={__name:"recall-settings-alert",emits:["change"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.associated-knowledge-base.recall-settings-alert"),r=d,_=L([{iconName:"mix-icon",title:"title_mixed_retrieval",value:1,isRecommendation:!0,desc:"desc_mixed_retrieval"},{iconName:"vector-icon",title:"title_vector_retrieval",value:2,desc:"desc_vector_retrieval"},{iconName:"graph-icon",title:"title_graph_retrieval",value:4,desc:"desc_graph_retrieval"},{iconName:"search-check-icon",title:"title_full_text_retrieval",value:3,desc:"desc_full_text_retrieval"}]),i=K({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),s=L(null),f=L(!1),w=L({}),x=L([]),$=(p,k=null)=>{w.value=k,I(),i.rerank_status=p.rerank_status||0,i.rerank_use_model=p.rerank_use_model||void 0,i.rerank_model_config_id=p.rerank_model_config_id>0?p.rerank_model_config_id:"",i.top_k=p.top_k,i.similarity=p.similarity,i.search_type=p.search_type,i.meta_search_switch=Number(p.meta_search_switch),i.meta_search_type=Number(p.meta_search_type),i.meta_search_condition_list=p.meta_search_condition_list,i.rrf_weight=p.rrf_weight,i.recall_neighbor_switch=p.recall_neighbor_switch,i.recall_neighbor_before_num=p.recall_neighbor_before_num,i.recall_neighbor_after_num=p.recall_neighbor_after_num,f.value=!0},I=()=>{Ut({id:w.value.id}).then(p=>{x.value=(p==null?void 0:p.data)||[]})},y=p=>{p==0&&(i.rerank_model_config_id="",i.rerank_use_model="")},h=p=>{i.search_type=p},q=()=>i.rerank_status==1&&!i.rerank_model_config_id,S=()=>{if(q())return Q.error(l("msg_please_select_rerank_model"));i.meta_search_switch==1&&!s.value.verify()||(f.value=!1,m())},m=()=>{r("change",ee(i))};return o({open:$}),(p,k)=>{const E=ae,g=le,N=lt,J=xe,P=ne,M=Ne,F=Pe,oe=te;return u(),A(oe,{width:"786px",open:f.value,"onUpdate:open":k[14]||(k[14]=O=>f.value=O),title:t(l)("title_recall_settings"),onOk:S},{default:c(()=>[e("div",Vi,[e("div",Pi,[e("div",Ni,[e("div",Di,[e("span",null,a(t(l)("label_retrieval_mode")),1)]),e("div",Ai,[e("div",Ti,[(u(!0),b(T,null,W(_.value,O=>(u(),b("div",{class:ce(["retrieval-mode-item",{active:i.search_type==O.value}]),key:O.value,onClick:U=>h(O.value)},[i.search_type==O.value?(u(),A(E,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",Mi,[n(E,{name:O.iconName,class:"title-icon"},null,8,["name"]),e("span",zi,a(t(l)(O.title)),1),O.isRecommendation?(u(),b("img",Bi)):R("",!0)]),e("div",Ji,a(t(l)(O.desc)),1)],10,ji))),128))])])]),i.search_type==1?(u(),b("div",Ki,[n(ho,{rrf_weight:i.rrf_weight,"onUpdate:rrf_weight":k[0]||(k[0]=O=>i.rrf_weight=O)},null,8,["rrf_weight"])])):R("",!0),e("div",Fi,[e("div",Wi,[e("span",null,a(t(l)("label_top_k"))+" ",1),n(g,null,{title:c(()=>[C(a(t(l)("tooltip_top_k")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),e("div",Qi,[e("div",Gi,[e("div",Hi,[n(N,{class:"custom-slider",value:i.top_k,"onUpdate:value":k[1]||(k[1]=O=>i.top_k=O),min:1,max:500},null,8,["value"])]),e("div",Xi,[n(J,{value:i.top_k,"onUpdate:value":k[2]||(k[2]=O=>i.top_k=O),min:1,max:500},null,8,["value"])])])])]),i.search_type<=2?(u(),b("div",Yi,[e("div",Zi,[e("span",null,a(t(l)("label_similarity_threshold"))+" ",1),n(g,null,{title:c(()=>[C(a(t(l)("tooltip_similarity_threshold")),1)]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1})]),e("div",el,[e("div",tl,[e("div",ol,[n(N,{class:"custom-slider",value:i.similarity,"onUpdate:value":k[3]||(k[3]=O=>i.similarity=O),min:0,max:1,step:.01},null,8,["value"])]),e("div",sl,[n(J,{value:i.similarity,"onUpdate:value":k[4]||(k[4]=O=>i.similarity=O),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",nl,[e("div",il,[e("span",ll,a(t(l)("label_recall_neighbor_segments"))+" ",1),n(g,{overlayStyle:{maxWidth:"350px"}},{title:c(()=>[e("div",al,[e("p",null,a(t(l)("tooltip_recall_neighbor_desc_1")),1),e("p",null,a(t(l)("tooltip_recall_neighbor_desc_2")),1),e("p",null,a(t(l)("tooltip_recall_neighbor_desc_3")),1)])]),default:c(()=>[n(t(H),{class:"question-icon"})]),_:1}),k[15]||(k[15]=C("   ",-1)),n(P,{checked:i.recall_neighbor_switch,"onUpdate:checked":k[5]||(k[5]=O=>i.recall_neighbor_switch=O)},null,8,["checked"])]),e("div",rl,[e("div",cl,[e("div",_l,[e("span",null,a(t(l)("label_concat_before")),1),k[16]||(k[16]=C("  ",-1)),n(F,{value:i.recall_neighbor_before_num,"onUpdate:value":k[6]||(k[6]=O=>i.recall_neighbor_before_num=O),style:{width:"80px"}},{default:c(()=>[(u(),b(T,null,W(6,O=>n(M,{value:O-1,key:O},{default:c(()=>[C(a(O-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),e("div",dl,[e("span",null,a(t(l)("label_after")),1),k[17]||(k[17]=C("  ",-1)),n(F,{value:i.recall_neighbor_after_num,"onUpdate:value":k[7]||(k[7]=O=>i.recall_neighbor_after_num=O),style:{width:"80px"}},{default:c(()=>[(u(),b(T,null,W(6,O=>n(M,{value:O-1,key:O},{default:c(()=>[C(a(O-1),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),e("div",ul,a(t(l)("label_segments_content")),1)])])]),e("div",pl,[e("div",ml,[e("span",null,a(t(l)("label_rerank_model")),1),k[18]||(k[18]=C("   ",-1)),n(P,{checkedValue:1,unCheckedValue:0,checked:i.rerank_status,"onUpdate:checked":k[8]||(k[8]=O=>i.rerank_status=O),onChange:y},null,8,["checked"])]),i.rerank_status==1?(u(),b("div",hl,[n(Ke,{modelType:"RERANK",modeName:i.rerank_use_model,"onUpdate:modeName":k[9]||(k[9]=O=>i.rerank_use_model=O),modeId:i.rerank_model_config_id,"onUpdate:modeId":k[10]||(k[10]=O=>i.rerank_model_config_id=O),style:{width:"60%"}},null,8,["modeName","modeId"])])):R("",!0)]),e("div",vl,[e("div",bl,[n(g,{title:t(l)("tooltip_metadata_filter")},{default:c(()=>[e("span",null,[C(a(t(l)("label_metadata_filter"))+" ",1),n(t(H))])]),_:1},8,["title"]),k[19]||(k[19]=C("   ",-1)),n(P,{checkedValue:1,unCheckedValue:0,checked:i.meta_search_switch,"onUpdate:checked":k[11]||(k[11]=O=>i.meta_search_switch=O)},null,8,["checked"])]),i.meta_search_switch==1?(u(),b("div",fl,[n(_o,{rule:i.meta_search_condition_list,"onUpdate:rule":k[12]||(k[12]=O=>i.meta_search_condition_list=O),type:i.meta_search_type,"onUpdate:type":k[13]||(k[13]=O=>i.meta_search_type=O),ref_key:"metaFilterRef",ref:s,class:"meta-box","meta-data":x.value},null,8,["rule","type","meta-data"])])):R("",!0)])])])]),_:1},8,["open","title"])}}},yl=z(gl,[["__scopeId","data-v-25810ed0"]]),kl={class:"list-box"},wl=["onClick"],xl={class:"avater-box"},$l=["src"],Cl={class:"content-box"},Sl={class:"title-block"},ql={class:"title-text"},Ll={class:"desc-box"},Ul={class:"right-icon"},El={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.associated-knowledge-base.no-open-graph-modal"),r=d,_=v,i=L(!1);re(()=>_.list,()=>{_.list.length==0&&(i.value=!1)},{});const s=()=>{i.value=!0},f=()=>{document.visibilityState==="visible"&&r("refreshList")};ge(()=>{document.addEventListener("visibilitychange",f)}),kt(()=>{document.removeEventListener("visibilitychange",f)});const w=x=>{window.open(`/#/library/details/knowledge-config?id=${x.id}`)};return o({show:s}),(x,$)=>{const I=Mt,y=_t,h=te;return u(),b("div",null,[n(h,{open:i.value,"onUpdate:open":$[0]||($[0]=q=>i.value=q),title:t(l)("title_partial_kb_no_graph"),footer:null,width:746},{default:c(()=>[n(I,{style:{"margin-top":"16px"},message:t(l)("msg_graph_not_enabled_warning")},null,8,["message"]),n(y,{scrollbar:!1,style:{height:"400px"}},{default:c(()=>[e("div",kl,[(u(!0),b(T,null,W(_.list,q=>(u(),b("div",{class:"list-item",onClick:S=>w(q),key:q.id},[e("div",xl,[e("img",{src:q.avatar,alt:""},null,8,$l)]),e("div",Cl,[e("div",Sl,[$[1]||($[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",ql,a(q.library_name),1)]),e("div",Ll,a(q.library_intro),1)]),e("div",Ul,[n(t(zt))])],8,wl))),128))])]),_:1})]),_:1},8,["open","title"])])}}},Rl=z(El,[["__scopeId","data-v-7431298b"]]),Il={class:"actions-box"},Ol={key:0,class:"library-list"},Vl=["onClick"],Pl={class:"library-avatar"},Nl=["src"],Dl={class:"info-content-box"},Al={class:"library-title-block"},Tl={class:"title-text"},jl={class:"desc-info-block"},Ml=["onClick"],zl={class:"setting-info-block"},Bl={class:"set-item"},Jl={key:0},Kl={key:1},Fl={key:2},Wl={key:3},Ql={class:"set-item"},Gl={key:0,class:"set-item"},Hl={class:"set-item"},Xl={key:0},Yl={key:1},Zl={__name:"index",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.associated-knowledge-base.index"),d=Et();X(()=>{var P;return((P=d.companyInfo)==null?void 0:P.neo4j_status)=="true"});const l=L(!1),{robotInfo:r,updateRobotInfo:_}=Y("robotInfo"),i=K({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1,meta_search_switch:0,meta_search_type:1,meta_search_condition_list:"",rrf_weight:{},recall_neighbor_switch:!1,recall_neighbor_before_num:1,recall_neighbor_after_num:1}),s=L([]),f=L(null),w=L(null),x=X(()=>s.value.filter(P=>w.value?i.library_ids.includes(P.id):i.library_ids.includes(P.id)&&P.type!=3)),$=X(()=>x.value.filter(P=>P.graph_switch==0)),I=P=>{let M=i.library_ids.indexOf(P.id);i.library_ids.splice(M,1),k()},y=P=>{i.library_ids=[...P],k()},h=()=>{f.value.open([...i.library_ids])},q=L(null),S=()=>{q.value.open(ee(i),r)},m=L(null),p=P=>{i.rerank_status=P.rerank_status,i.rerank_use_model=P.rerank_use_model,i.rerank_model_config_id=P.rerank_model_config_id,i.top_k=P.top_k,i.similarity=P.similarity,i.search_type=P.search_type,i.meta_search_switch=P.meta_search_switch,i.meta_search_type=P.meta_search_type,i.meta_search_condition_list=P.meta_search_condition_list,i.rrf_weight=P.rrf_weight,i.recall_neighbor_switch=P.recall_neighbor_switch,i.recall_neighbor_before_num=P.recall_neighbor_before_num,i.recall_neighbor_after_num=P.recall_neighbor_after_num,(P.search_type==1||P.search_type==4)&&$.value.length>0&&m.value.show(),k()},k=()=>{let P={...ee(i)};P.library_ids=P.library_ids.join(","),P.op_type_relation_library=1,P.rrf_weight=JSON.stringify(P.rrf_weight),_({...P})},E=async()=>{const P=await Rt({type:"",show_open_docs:1});P&&(s.value=P.data||[])},g=()=>{vo({ability_type:"library_ability_official_account"}).then(P=>{var F;let M=(P==null?void 0:P.data)||{};((F=M==null?void 0:M.user_config)==null?void 0:F.switch_status)==1&&(w.value=M)})};i.rerank_use_model=r.rerank_use_model||void 0,qe(()=>{i.library_ids=r.library_ids.split(","),i.rerank_status=r.rerank_status||0,i.rerank_use_model=r.rerank_use_model||void 0,i.rerank_model_config_id=r.rerank_model_config_id||"",i.top_k=r.top_k,i.similarity=r.similarity,i.search_type=r.search_type,i.meta_search_switch=r.meta_search_switch,i.meta_search_type=r.meta_search_type,i.meta_search_condition_list=r.meta_search_condition_list,i.rrf_weight=r.rrf_weight!=""?JSON.parse(r.rrf_weight):{vector:0,search:0,graph:0},i.recall_neighbor_switch=r.recall_neighbor_switch,i.recall_neighbor_before_num=r.recall_neighbor_before_num,i.recall_neighbor_after_num=r.recall_neighbor_after_num});const N=P=>{window.open(`#/library/details/knowledge-document?id=${P.id}`)},J=X(()=>ct(i.rerank_model_config_id,i.rerank_use_model,"RERANK"));return ge(()=>{g(),E()}),(P,M)=>{const F=se,oe=ke;return u(),A(Z,{class:"setting-box",title:t(o)("title_associated_knowledge_base"),"icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":M[0]||(M[0]=O=>l.value=O),bodyStyle:{padding:0}},{extra:c(()=>[e("div",Il,[n(oe,{gap:8},{default:c(()=>[n(F,{size:"small",onClick:S},{default:c(()=>[C(a(t(o)("btn_recall_settings")),1)]),_:1}),n(F,{size:"small",onClick:h},{default:c(()=>[C(a(t(o)("btn_associate_knowledge_base")),1)]),_:1})]),_:1})])]),default:c(()=>[x.value.length>0?(u(),b("div",Ol,[(u(!0),b(T,null,W(x.value,O=>(u(),b("div",{class:"library-item",key:O.id,onClick:U=>N(O)},[e("div",Pl,[e("img",{src:O.avatar,alt:""},null,8,Nl)]),e("div",Dl,[e("div",Al,[e("div",Tl,a(O.library_name),1)]),e("div",jl,a(O.library_intro),1)]),O.id!=t(r).default_library_id?(u(),b("div",{key:0,class:"close-btn",onClick:wt(U=>I(O),["stop"])},[n(t(ye))],8,Ml)):R("",!0)],8,Vl))),128))])):R("",!0),e("div",zl,[e("div",Bl,[C(a(t(o)("label_search_mode"))+" ",1),i.search_type==1?(u(),b("span",Jl,a(t(o)("label_hybrid_search")),1)):R("",!0),i.search_type==2?(u(),b("span",Kl,a(t(o)("label_vector_search")),1)):R("",!0),i.search_type==3?(u(),b("span",Fl,a(t(o)("label_fulltext_search")),1)):R("",!0),i.search_type==4?(u(),b("span",Wl,a(t(o)("label_graph_search")),1)):R("",!0)]),e("div",Ql,[C(a(t(o)("label_top_k"))+" ",1),e("span",null,a(i.top_k),1)]),i.search_type<=2?(u(),b("div",Gl,[C(a(t(o)("label_similarity_threshold"))+" ",1),e("span",null,a(i.similarity),1)])):R("",!0),e("div",Hl,[C(a(t(o)("label_rerank_model"))+" ",1),i.rerank_status==0?(u(),b("span",Xl,a(t(o)("label_off")),1)):(u(),b("span",Yl,a(J.value),1))])]),n(po,{ref_key:"librarySelectAlertRef",ref:f,onChange:y,showWxType:!!w.value},null,8,["showWxType"]),n(yl,{ref_key:"recallSettingsAlertRef",ref:q,onChange:p},null,512),n(Rl,{list:$.value,onRefreshList:E,ref_key:"noOpenGraphModalRef",ref:m},null,8,["list"])]),_:1},8,["title","isEdit"])}}},ea=z(Zl,[["__scopeId","data-v-9df38f57"]]),ta={class:"library-checkbox-box"},oa={class:"list-box",ref:"scrollContainer"},sa={class:"library-name"},na={class:"library-desc"},ia={key:0,class:"empty-box"},la={__name:"library-select-alert",emits:["change"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.data-base.library-select-alert"),r=d,_=K({indeterminate:!1,checkAll:!1,checkedList:[]}),i=L(!1),s=h=>{$(),_.checkedList=h,i.value=!0},f=()=>{i.value=!1,x()};L("");const w=L([]),x=()=>{r("change",[..._.checkedList])},$=async()=>{const h=await dt();if(h){let q=h.data||[];w.value=q}},I=L(!1),y=()=>{window.open("/#/database/list")};return o({open:s}),(h,q)=>{const S=at,m=Bt,p=ot,k=te;return u(),A(k,{width:"746px",open:i.value,"onUpdate:open":q[1]||(q[1]=E=>i.value=E),title:t(l)("title_link_data_table"),onOk:f},{default:c(()=>[e("div",ta,[n(p,{spinning:I.value,delay:100},{default:c(()=>[n(m,{value:_.checkedList,"onUpdate:value":q[0]||(q[0]=E=>_.checkedList=E),style:{width:"100%"}},{default:c(()=>[e("div",oa,[(u(!0),b(T,null,W(w.value,E=>(u(),b("div",{class:"list-item-wraapper",key:E.id},[n(S,{class:"list-item",value:E.id},{default:c(()=>[e("div",sa,a(E.name),1),e("div",na,a(E.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!I.value&&!w.value.length?(u(),b("div",ia,[q[2]||(q[2]=e("img",{src:bo,alt:""},null,-1)),e("div",null,[C(a(t(l)("msg_no_data_table_add_first"))+" ",1),e("a",{onClick:y},a(t(l)("btn_go_add")),1)])])):R("",!0)])]),_:1},8,["open","title"])}}},aa=z(la,[["__scopeId","data-v-a4eef9eb"]]),ra={class:"actions-box"},ca={key:0,class:"library-list"},_a=["onClick"],da={class:"library-name"},ua={class:"library-intro"},pa={__name:"index",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.data-base.index"),d=L(!1),{robotInfo:l,updateRobotInfo:r}=Y("robotInfo"),_=K({form_ids:[]}),i=L([]),s=L(null),f=X(()=>i.value.filter(h=>_.form_ids.includes(h.id))),w=h=>{let q=_.form_ids.indexOf(h.id);_.form_ids.splice(q,1),I()},x=h=>{_.form_ids=[...h],I()},$=()=>{s.value.open([..._.form_ids])},I=()=>{let h={...ee(_)};h.form_ids=h.form_ids.join(","),r({...h})};return(async()=>{const h=await dt();h&&(i.value=h.data||[])})(),qe(()=>{_.form_ids=l.form_ids.split(",")}),(h,q)=>{const S=le,m=se,p=ke;return u(),A(Z,{class:"setting-box",title:t(o)("title_database"),"icon-name":"guanlianzhishiku",isEdit:d.value,"onUpdate:isEdit":q[0]||(q[0]=k=>d.value=k),bodyStyle:{padding:0}},{tip:c(()=>[n(S,{placement:"top"},{title:c(()=>[e("span",null,a(t(o)("tip_database_description")),1)]),default:c(()=>[n(t(H))]),_:1})]),extra:c(()=>[e("div",ra,[n(p,{gap:8},{default:c(()=>[n(m,{size:"small",onClick:$},{default:c(()=>[C(a(t(o)("btn_link_data_table")),1)]),_:1})]),_:1})])]),default:c(()=>[f.value.length>0?(u(),b("div",ca,[(u(!0),b(T,null,W(f.value,k=>(u(),b("div",{class:"library-item",key:k.id},[e("span",{class:"close-btn",onClick:E=>w(k)},[n(t(ye))],8,_a),e("div",da,a(k.name),1),e("div",ua,a(k.description),1)]))),128))])):R("",!0),n(aa,{ref_key:"librarySelectAlertRef",ref:s,onChange:x},null,512)]),_:1},8,["title","isEdit"])}}},ma=z(pa,[["__scopeId","data-v-106ddf73"]]),ha={class:"form-box"},va={class:"question-title"},ba={class:"question-options"},fa={class:"question-option"},ga={class:"drag-btn"},ya={class:"action-box"},ka={class:"robot-info-box"},wa={class:"robot-welcome-content"},xa={class:"robot-welcome-question"},$a={__name:"welcome-words",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.welcome-words"),d=L(!1),l=L(!1),{robotInfo:r,updateRobotInfo:_,scrollBoxToBottom:i}=Y("robotInfo"),s=K({welcomes:{content:"",question:[]}}),f=()=>{let y=!1;if(s.welcomes.question.length>0){for(let h=0;h<s.welcomes.question.length;h++)if(!s.welcomes.question[h].content){y=h+1;break}}return y},w=()=>{s.welcomes.question.push({content:"",id:Ie(8)})},x=y=>{s.welcomes.question.splice(y,1)},$=()=>{if(!s.welcomes.content)return Q.error(o("msg_welcome_required"));if(f())return Q.error(o("msg_question_required"));_({...ee(s)}),d.value=!1},I=()=>{let y={...r.welcomes},h=[];y.question.forEach(({content:q,id:S})=>{let m={id:S,content:q};m.id||(m.id=Ie(6)),h.push(m)}),s.welcomes.content=y.content,s.welcomes.question=h};return(y,h)=>{const q=we,S=ae,m=me;return u(),A(Z,{class:"setting-box",title:t(o)("title_welcome"),"icon-name":"huanyingyu",isEdit:d.value,"onUpdate:isEdit":h[4]||(h[4]=p=>d.value=p),onSave:$,onEdit:I},{default:c(()=>[ue(e("div",ha,[e("div",va,[n(q,{value:s.welcomes.content,"onUpdate:value":h[0]||(h[0]=p=>s.welcomes.content=p),placeholder:t(o)("ph_input_welcome")},null,8,["value","placeholder"])]),e("div",ba,[n(t(Ve),{modelValue:s.welcomes.question,"onUpdate:modelValue":h[1]||(h[1]=p=>s.welcomes.question=p),"item-key":"id",handle:".drag-btn",onStart:h[2]||(h[2]=p=>l.value=!0),onEnd:h[3]||(h[3]=p=>l.value=!1)},{item:c(({element:p,index:k})=>[e("div",fa,[e("span",ga,[n(S,{name:"drag"})]),n(m,{class:"question-option-content",value:p.content,"onUpdate:value":E=>p.content=E,placeholder:t(o)("ph_input_question")},null,8,["value","onUpdate:value","placeholder"]),e("div",ya,[n(t(ye),{class:"del-btn",onClick:E=>x(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:w},[n(t(De),{class:"add-btn-icon"}),C(a(t(o)("btn_add_guide_question")),1)])])],512),[[pe,d.value]]),ue(e("div",ka,[e("div",wa,a(t(r).welcomes.content),1),e("div",xa,[(u(!0),b(T,null,W(t(r).welcomes.question,(p,k)=>(u(),b("div",{class:"question-item",key:k},a(p.content),1))),128))])],512),[[pe,!d.value]])]),_:1},8,["title","isEdit"])}}},Ca=z($a,[["__scopeId","data-v-c9feca8b"]]),Sa={class:"form-box"},qa={class:"question-title"},La={class:"question-options"},Ua={class:"question-option"},Ea={class:"drag-btn"},Ra={class:"action-box"},Ia={class:"robot-info-box"},Oa={class:"robot-unknown-content"},Va={class:"robot-unknown-question"},Pa={__name:"unknown-problem-prompt",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.unknown-problem-prompt"),d=L(!1),l=L(!1),{robotInfo:r,updateRobotInfo:_,scrollBoxToBottom:i}=Y("robotInfo"),s=K({unknown_question_prompt:{content:"",question:[]}}),f=()=>{s.unknown_question_prompt.question.push({content:"",id:Ie(8)}),tt(()=>{i()})},w=I=>{s.unknown_question_prompt.question.splice(I,1)},x=()=>{_({...ee(s)}),d.value=!1},$=()=>{let I={...r.unknown_question_prompt},y=[];I.question&&I.question.forEach(({content:h,id:q})=>{let S={id:q,content:h};S.id||(S.id=Ie(6)),y.push(S)}),I.content&&(s.unknown_question_prompt.content=I.content),y&&(s.unknown_question_prompt.question=y)};return ge(()=>{}),(I,y)=>{const h=le,q=we,S=ae,m=me;return u(),A(Z,{class:"setting-box",title:t(o)("title_unknown_problem_prompt"),"icon-name":"unknown-prompt",isEdit:d.value,"onUpdate:isEdit":y[4]||(y[4]=p=>d.value=p),onSave:x,onEdit:$},{tip:c(()=>[n(h,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:c(()=>[e("span",null,a(t(o)("tip_knowledge_mode")),1)]),default:c(()=>[n(t(H))]),_:1})]),default:c(()=>[ue(e("div",Sa,[e("div",qa,[n(q,{value:s.unknown_question_prompt.content,"onUpdate:value":y[0]||(y[0]=p=>s.unknown_question_prompt.content=p),placeholder:t(o)("ph_input_unknown_prompt")},null,8,["value","placeholder"])]),e("div",La,[n(t(Ve),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":y[1]||(y[1]=p=>s.unknown_question_prompt.question=p),"item-key":"id",handle:".drag-btn",onStart:y[2]||(y[2]=p=>l.value=!0),onEnd:y[3]||(y[3]=p=>l.value=!1)},{item:c(({element:p,index:k})=>[e("div",Ua,[e("span",Ea,[n(S,{name:"drag"})]),n(m,{class:"question-option-content",value:p.content,"onUpdate:value":E=>p.content=E,placeholder:t(o)("ph_input_question")},null,8,["value","onUpdate:value","placeholder"]),e("div",Ra,[n(t(ye),{class:"del-btn",onClick:E=>w(k)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:f},[n(t(De),{class:"add-btn-icon"}),C(a(t(o)("btn_add_guide_question")),1)])])],512),[[pe,d.value]]),ue(e("div",Ia,[e("div",Oa,a(t(r).unknown_question_prompt.content),1),e("div",Va,[(u(!0),b(T,null,W(t(r).unknown_question_prompt.question,(p,k)=>(u(),b("div",{class:"question-item",key:k},a(p.content),1))),128))])],512),[[pe,!d.value]])]),_:1},8,["title","isEdit"])}}},Na=z(Pa,[["__scopeId","data-v-8ffb52cb"]]),Da={class:"robot-info-box"},Aa={class:"robot-prompt"},Ta={class:"modal-box",ref:"modalBoxRef"},ja={class:"modal-item-box"},Ma={class:"modal-item"},za={class:"label"},Ba={class:"modal-item"},Ja={class:"label"},Ka={__name:"problem-optimization",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.problem-optimization"),d=L(!1);L(!1);const{robotInfo:l,updateRobotInfo:r}=Y("robotInfo"),_=L("0"),i=K({optimize_question_use_model:"",optimize_question_model_config_id:""});ge(()=>{_.value=l.optimize_question_model_config_id!=0?"1":"0",i.optimize_question_use_model=l.optimize_question_use_model,i.optimize_question_model_config_id=l.optimize_question_model_config_id});const s=L([]),f=y=>{s.value=y,tt(()=>{(!i.optimize_question_use_model||!Number(i.optimize_question_model_config_id))&&w()})},w=()=>{if(s.value.length>0){let y=null,h=null;for(let q of s.value)if(q.model_define==="tongyi"){y=q;for(let S of y.children)if(S.name==="qwen-max"){h=S;break}break}y||(y=s.value[0],h=y.children[0]),y&&h&&(i.optimize_question_use_model=h.name,i.optimize_question_model_config_id=h.model_config_id)}},x=()=>{d.value=!1,r({...ee(i)})},$=y=>{y!=1&&(i.optimize_question_use_model="",i.optimize_question_model_config_id=0)},I=y=>{r({})};return(y,h)=>{const q=le,S=ne,m=Je,p=Be,k=we,E=te;return u(),A(Z,{class:"setting-box",title:t(o)("title_problem_optimization"),"icon-name":"problem-optimization"},{extra:c(()=>[...h[7]||(h[7]=[e("span",null,null,-1)])]),default:c(()=>[e("div",Da,[e("div",Aa,a(t(o)("desc_enable_question_optimize")),1),n(q,null,{title:c(()=>[e("span",null,a(t(o)("tip_dialogue_background_help")),1)]),default:c(()=>[e("div",{class:"dialog-bg-set",onClick:h[0]||(h[0]=g=>d.value=!0)},a(t(o)("btn_dialogue_background_setting")),1)]),_:1})]),n(S,{onChange:I,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:t(l).enable_question_optimize,"onUpdate:checked":h[1]||(h[1]=g=>t(l).enable_question_optimize=g),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),e("div",Ta,[n(E,{getContainer:()=>y.$refs.modalBoxRef,open:d.value,"onUpdate:open":h[6]||(h[6]=g=>d.value=g),width:472,title:t(o)("title_user_question_suggestion_setting"),onOk:x},{default:c(()=>[e("div",ja,[e("div",Ma,[e("div",za,a(t(o)("label_model")),1),n(p,{value:_.value,"onUpdate:value":h[2]||(h[2]=g=>_.value=g),onChange:$},{default:c(()=>[n(m,{value:"0"},{default:c(()=>[C(a(t(o)("radio_follow_robot")),1)]),_:1}),n(m,{value:"1"},{default:c(()=>[C(a(t(o)("radio_specify_model")),1)]),_:1})]),_:1},8,["value"]),_.value=="1"?(u(),A(Ke,{key:0,modelType:"LLM",modeName:i.optimize_question_use_model,"onUpdate:modeName":h[3]||(h[3]=g=>i.optimize_question_use_model=g),modeId:i.optimize_question_model_config_id,"onUpdate:modeId":h[4]||(h[4]=g=>i.optimize_question_model_config_id=g),style:{width:"100%","margin-top":"8px"},onLoaded:f},null,8,["modeName","modeId"])):R("",!0)]),e("div",Ba,[e("div",Ja,a(t(o)("label_dialogue_background")),1),n(k,{style:{height:"120px"},value:t(l).optimize_question_dialogue_background,"onUpdate:value":h[5]||(h[5]=g=>t(l).optimize_question_dialogue_background=g),placeholder:t(o)("ph_dialogue_background")},null,8,["value","placeholder"])])])]),_:1},8,["getContainer","open","title"])],512)]),_:1},8,["title"])}}},Fa=z(Ka,[["__scopeId","data-v-c380c233"]]),Wa={class:"robot-info-box"},Qa={class:"robot-prompt"},Ga={__name:"suggested-issues",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.suggested-issues");L(!1);const{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=_=>{l({})};return(_,i)=>{const s=xe,f=ne;return u(),A(Z,{class:"setting-box",title:t(o)("title_suggested_questions"),"icon-name":"suggested-issues"},{extra:c(()=>[...i[2]||(i[2]=[e("span",null,null,-1)])]),default:c(()=>[e("div",Wa,[e("div",Qa,[C(a(t(o)("msg_guide_description",{num:t(d).question_guide_num}))+" ",1),n(s,{value:t(d).question_guide_num,"onUpdate:value":i[0]||(i[0]=w=>t(d).question_guide_num=w),style:{width:"80px"},precision:0,min:1,max:10,onBlur:r},null,8,["value"])])]),n(f,{onChange:r,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:t(d).enable_question_guide,"onUpdate:checked":i[1]||(i[1]=w=>t(d).enable_question_guide=w),"checked-children":t(o)("btn_on"),"un-checked-children":t(o)("btn_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["title"])}}},Ha=z(Ga,[["__scopeId","data-v-582f5121"]]),Xa={class:"robot-info-box"},Ya={class:"robot-prompt"},Za={__name:"sensitive-words",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.sensitive-words");L(!1);const{robotInfo:d,updateRobotInfo:l}=Y("robotInfo");K({prompt:""});const r=()=>{window.open("/#/user/sensitive-words")},_=i=>{l({})};return(i,s)=>{const f=ne;return u(),A(Z,{class:"setting-box",title:t(o)("title_sensitive_words"),"icon-name":"sensitive-icon"},{extra:c(()=>[...s[1]||(s[1]=[e("span",null,null,-1)])]),default:c(()=>[e("div",Xa,[e("div",Ya,[C(a(t(o)("msg_sensitive_words_desc")),1),e("span",{onClick:r,style:{cursor:"pointer"}},a(t(o)("btn_manage_sensitive_words")),1)])]),n(f,{onChange:_,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:t(d).sensitive_words_switch,"onUpdate:checked":s[0]||(s[0]=w=>t(d).sensitive_words_switch=w),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["title"])}}},er=z(Za,[["__scopeId","data-v-cc8fca65"]]),tr={class:"direct-title"},or={class:"direct-desc"},sr={class:"qa"},nr={class:"prompt-form-item-label"},ir={class:"qa-title"},lr={class:"direct-switch"},ar={class:"similarity"},rr={class:"number-input-box"},cr={__name:"chat-edit-alert",emits:["save"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.chat-mode.chat-edit-alert"),r=d,_=L(1),i=()=>[{direct_id:1,direct_title:l("title_library_mode"),direct_desc:l("desc_library_mode"),chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:l("title_mixture_mode"),direct_desc:l("desc_mixture_mode"),chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:l("title_direct_mode"),direct_desc:l("desc_direct_mode"),chat_type:"2",isQaDirectReply:!1}],s=K(i()),f=L(!1),w=K({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),x=()=>{w.chat_type=_.value.toString(),s.forEach(y=>{y.chat_type==_.value&&(w.chat_type=="3"?(w.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch==1?"true":"false",w.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score.toString()):w.chat_type=="1"&&(w.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch==1?"true":"false",w.library_qa_direct_reply_score=y.library_qa_direct_reply_score.toString()))}),$(),Object.assign(s,i()),f.value=!1},$=()=>{r("save",ee(w))};ge(()=>{});const I=y=>{_.value=parseInt(y.chat_type),w.chat_type=y.chat_type,w.library_qa_direct_reply_score=y.library_qa_direct_reply_score,w.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch,w.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score,w.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch,s.forEach(h=>{h.chat_type=="3"?(h.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score,h.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch=="true"?1:0):h.chat_type=="1"&&(h.library_qa_direct_reply_score=y.library_qa_direct_reply_score,h.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch=="true"?1:0)}),f.value=!0};return re(()=>f.value,y=>{y===!1&&Object.assign(s,i())},{immediate:!0}),o({open:I}),(y,h)=>{const q=le,S=ne,m=xe,p=Je,k=Be,E=te;return u(),A(E,{width:"746px",open:f.value,"onUpdate:open":h[1]||(h[1]=g=>f.value=g),title:t(l)("title_chat_mode_settings"),onOk:x},{default:c(()=>[n(k,{class:"direct-box",value:_.value,"onUpdate:value":h[0]||(h[0]=g=>_.value=g)},{default:c(()=>[(u(!0),b(T,null,W(s,g=>(u(),A(p,{class:ce(["direct-item",{active:_.value==g.direct_id}]),value:g.direct_id,key:g.direct_id},{default:c(()=>[e("div",tr,a(g.direct_title),1),e("div",or,a(g.direct_desc),1),ue(e("div",sr,[e("div",nr,[e("span",ir,a(t(l)("label_reply_directly_when_qa_matched")),1),n(q,null,xt({default:c(()=>[n(t(H),{class:"question-icon"})]),_:2},[g.chat_type=="1"?{name:"title",fn:c(()=>[C(a(t(l)("tooltip_library_mode_qa_direct_reply")),1)]),key:"0"}:g.chat_type=="3"?{name:"title",fn:c(()=>[C(a(t(l)("tooltip_mixture_mode_qa_direct_reply")),1)]),key:"1"}:void 0]),1024),e("div",lr,[g.chat_type=="1"?(u(),A(S,{key:0,checkedValue:1,unCheckedValue:0,checked:g.library_qa_direct_reply_switch,"onUpdate:checked":N=>g.library_qa_direct_reply_switch=N},null,8,["checked","onUpdate:checked"])):g.chat_type=="3"?(u(),A(S,{key:1,checkedValue:1,unCheckedValue:0,checked:g.mixture_qa_direct_reply_switch,"onUpdate:checked":N=>g.mixture_qa_direct_reply_switch=N},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[pe,g.isQaDirectReply&&_.value==g.direct_id]]),ue(e("div",ar,[e("span",null,a(t(l)("label_similarity_exceeds")),1),e("div",rr,[g.chat_type=="1"?(u(),A(m,{key:0,value:g.library_qa_direct_reply_score,"onUpdate:value":N=>g.library_qa_direct_reply_score=N,disabled:!g.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):g.chat_type=="3"?(u(),A(m,{key:1,value:g.mixture_qa_direct_reply_score,"onUpdate:value":N=>g.mixture_qa_direct_reply_score=N,disabled:!g.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),e("span",null,a(t(l)("label_reply_directly_when_exceeds")),1)],512),[[pe,g.isQaDirectReply&&_.value==g.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open","title"])}}},_r=z(cr,[["__scopeId","data-v-cc09ecb3"]]),dr={class:"actions-box"},ur={class:"setting-info-block"},pr={class:"set-item"},mr={key:0},hr={key:1},vr={key:2},br={class:"set-item"},fr={key:0,class:"set-item"},gr={class:"set-item"},yr={key:0,class:"set-item"},kr={class:"form-box"},wr={__name:"index",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.chat-mode.index"),d=L(!1),l=L(null),{robotInfo:r,updateRobotInfo:_}=Y("robotInfo"),i=K({chat_type:r.chat_type,library_qa_direct_reply_score:r.library_qa_direct_reply_score,library_qa_direct_reply_switch:r.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:r.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:r.mixture_qa_direct_reply_switch}),s=x=>{i.chat_type=x.chat_type,i.library_qa_direct_reply_score=x.library_qa_direct_reply_score,i.library_qa_direct_reply_switch=x.library_qa_direct_reply_switch,i.mixture_qa_direct_reply_score=x.mixture_qa_direct_reply_score,i.mixture_qa_direct_reply_switch=x.mixture_qa_direct_reply_switch,f()},f=()=>{_({...ee(i)}),d.value=!1},w=()=>{l.value.open(ee(i)),d.value=!0};return(x,$)=>{const I=le,y=se;return u(),A(Z,{class:"setting-box",title:t(o)("title_chat_mode"),"icon-name":"chat-mode",isEdit:d.value,"onUpdate:isEdit":$[1]||($[1]=h=>d.value=h),bodyStyle:{padding:0}},{tip:c(()=>[n(I,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:c(()=>[e("span",null,a(t(o)("tip_knowledge_base_only")),1),$[2]||($[2]=e("br",null,null,-1)),e("span",null,a(t(o)("tip_direct_mode")),1)]),default:c(()=>[n(t(H))]),_:1})]),extra:c(()=>[e("div",dr,[n(y,{size:"small",onClick:$[0]||($[0]=h=>w(!0))},{default:c(()=>[C(a(t(o)("btn_edit")),1)]),_:1})])]),default:c(()=>[e("div",ur,[e("div",pr,[C(a(t(o)("label_chat_mode"))+" ",1),t(r).chat_type=="1"?(u(),b("span",mr,a(t(o)("chat_mode_knowledge_base_only")),1)):R("",!0),t(r).chat_type=="2"?(u(),b("span",hr,a(t(o)("chat_mode_direct")),1)):R("",!0),t(r).chat_type=="3"?(u(),b("span",vr,a(t(o)("chat_mode_mixed")),1)):R("",!0)]),t(r).chat_type=="1"?(u(),b(T,{key:0},[e("div",br,[C(a(t(o)("label_direct_reply_qa"))+" ",1),e("span",null,a(t(r).library_qa_direct_reply_switch=="true"?t(o)("status_on"):t(o)("status_off")),1)]),t(r).library_qa_direct_reply_switch=="true"?(u(),b("div",fr,[C(a(t(o)("label_similarity_threshold"))+" ",1),e("span",null,a(t(r).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),t(r).chat_type=="3"?(u(),b(T,{key:1},[e("div",gr,[C(a(t(o)("label_direct_reply_qa"))+" ",1),e("span",null,a(t(r).mixture_qa_direct_reply_switch=="true"?t(o)("status_on"):t(o)("status_off")),1)]),t(r).mixture_qa_direct_reply_switch=="true"?(u(),b("div",yr,[C(a(t(o)("label_similarity_threshold"))+" ",1),e("span",null,a(t(r).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",kr,[n(_r,{ref_key:"ChatEditAlertRef",ref:l,onSave:s},null,512)])]),_:1},8,["title","isEdit"])}}},xr=z(wr,[["__scopeId","data-v-854c202f"]]),$r={class:"switch-box"},Cr={class:"switch-box-body"},Sr={class:"switch-box-header"},qr={class:"left-box"},Lr={class:"switch-box-title"},Ur={key:0,class:"title-tip"},Er={class:"right-box"},Rr={class:"extra-box"},Ir={class:"switch-desc"},Or={class:"switch-box-right"},Vr={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(v,{emit:o}){const{t:d}=j("views.robot.robot-config.basic-config.components.switch-box"),l=o,r=v,_=L(r.value),i=s=>{l("update:value",s),l("change",s)};return(s,f)=>{const w=ae,x=ne;return u(),b("div",$r,[e("div",Cr,[e("div",Sr,[e("div",qr,[n(w,{class:"switch-box-icon",name:r.iconName},null,8,["name"]),e("span",Lr,a(r.title),1),s.$slots.tip?(u(),b("span",Ur,[fe(s.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",Er,[e("div",Rr,[fe(s.$slots,"extra",{},()=>[f[1]||(f[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",Ir,[fe(s.$slots,"default",{},void 0,!0)])]),e("div",Or,[n(x,{checked:_.value,"onUpdate:checked":f[0]||(f[0]=$=>_.value=$),onChange:i,"checked-children":t(d)("btn_switch_on"),"un-checked-children":t(d)("btn_switch_off")},null,8,["checked","checked-children","un-checked-children"])])])}}},Pr=z(Vr,[["__scopeId","data-v-5263a90c"]]),Nr="/assets/img/phone-head-CDwwPhYa.png",Dr="/assets/img/phone-body-CbEf8GZP.png",Ar="/assets/img/phone-footer-ClQtNpln.png",Tr={class:"common-problem-box"},jr={class:"left-content-box"},Mr={key:0,class:"empty-box"},zr={class:"title"},Br={class:"desc"},Jr={key:1,class:"lists-box"},Kr={class:"drag-btn"},Fr={class:"title"},Wr={class:"opration-box"},Qr={class:"preview-box"},Gr={class:"phone-body"},Hr={key:0,class:"question-box"},Xr={class:"name"},Yr={__name:"common-problem",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.common-problem");L(!1);const{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=X(()=>d.common_question_list?JSON.parse(d.common_question_list):[]),_=L([]);_.value=r.value,re(r,()=>{_.value=r.value});const i=Oe.useForm,s=L(!1),f=L("modal_title_add"),w=K({question:"",index:-1}),x=K({question:[{message:o("msg_input_question_name"),required:!0}]}),{resetFields:$,validate:I,validateInfos:y}=i(w,x),h=()=>{if(r.value.length>=10)return Q.error(o("msg_max_10_questions"));s.value=!0,$(),w.question="",w.index=-1,f.value="modal_title_add"},q=(E,g)=>{s.value=!0,$(),w.question=E,w.index=g,f.value="modal_title_edit"},S=E=>{let g=[];g=r.value.filter((N,J)=>E!=J),te.confirm({title:o("modal_title_remind"),icon:n(Se),content:o("modal_content_confirm_delete"),okText:o("btn_confirm"),okType:"danger",cancelText:o("btn_cancel"),onOk(){l({common_question_list:JSON.stringify(g)})},onCancel(){}})},m=()=>{I().then(()=>{let E=[];w.index>=0?E=r.value.map((g,N)=>N===w.index?w.question:g):E=[w.question,...r.value],l({common_question_list:JSON.stringify(E)}),s.value=!1})},p=E=>{l({})},k=E=>{l({common_question_list:JSON.stringify(_.value)})};return(E,g)=>{const N=le,J=ne,P=Jt,M=se,F=ae,oe=me,O=ze,U=Oe,ie=te;return u(),b("div",Tr,[e("div",jr,[n(Z,{class:"setting-box",title:t(o)("title_common_problem_settings"),"icon-name":"common-quession"},{icon:c(()=>[n(N,null,{title:c(()=>[C(a(t(o)("tooltip_max_10_items")),1)]),default:c(()=>[n(t(H),{class:"quess-icon"})]),_:1})]),extra:c(()=>[n(J,{onChange:p,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:t(d).enable_common_question,"onUpdate:checked":g[0]||(g[0]=G=>t(d).enable_common_question=G),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"]),n(P,{type:"vertical"}),n(M,{type:"primary",size:"small",onClick:h},{default:c(()=>[C(a(t(o)("btn_add")),1)]),_:1})]),default:c(()=>[r.value.length==0?(u(),b("div",Mr,[g[4]||(g[4]=e("img",{src:fo,alt:""},null,-1)),e("div",zr,a(t(o)("empty_no_data")),1),e("div",Br,a(t(o)("empty_desc")),1),n(M,{onClick:h,type:"primary"},{default:c(()=>[C(a(t(o)("btn_add_now")),1)]),_:1})])):(u(),b("div",Jr,[n(t(Ve),{modelValue:_.value,"onUpdate:modelValue":g[1]||(g[1]=G=>_.value=G),handle:".drag-btn","item-key":"index",onEnd:k},{item:c(({element:G,index:$e})=>[(u(),b("div",{class:"list-item",key:$e},[e("span",Kr,[n(F,{name:"drag"})]),e("div",Fr,a(G),1),e("div",Wr,[n(t(rt),{onClick:Le=>q(G,$e)},null,8,["onClick"]),n(t(ye),{onClick:Le=>S($e)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1},8,["title"])]),e("div",Qr,[g[6]||(g[6]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Nr,alt:""})],-1)),e("div",Gr,[g[5]||(g[5]=e("div",null,[e("img",{class:"body-img",src:Dr,alt:""})],-1)),r.value.length&&t(d).enable_common_question=="true"?(u(),b("div",Hr,[e("div",Xr,a(t(o)("label_common_problem")),1),(u(!0),b(T,null,W(r.value,G=>(u(),b("div",{class:"list-item",key:G},a(G),1))),128))])):R("",!0)]),g[7]||(g[7]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Ar,alt:""})],-1))]),n(ie,{open:s.value,"onUpdate:open":g[3]||(g[3]=G=>s.value=G),title:t(o)(f.value),onOk:m,width:"476px"},{default:c(()=>[n(U,{class:"form-box",layout:"vertical"},{default:c(()=>[n(O,et({label:t(o)("label_question_name")},t(y).question),{default:c(()=>[n(oe,{maxLength:100,value:w.question,"onUpdate:value":g[2]||(g[2]=G=>w.question=G),placeholder:t(o)("ph_input_question")},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1})]),_:1},8,["open","title"])])}}},Zr=z(Yr,[["__scopeId","data-v-1adca37c"]]),ec={__name:"display-aitations",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.display-aitations"),{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=L(!1);re(()=>d.answer_source_switch,i=>{r.value=i=="true"},{immediate:!0});const _=()=>{l({answer_source_switch:r.value?"true":"false"})};return(i,s)=>(u(),A(Pr,{title:t(o)("title_show_citations"),"icon-name":"jibenpeizhi",value:r.value,"onUpdate:value":s[0]||(s[0]=f=>r.value=f),onChange:_},{extra:c(()=>[...s[1]||(s[1]=[e("span",null,null,-1)])]),default:c(()=>[e("div",null,a(t(o)("desc_show_citations")),1)]),_:1},8,["title","value"]))}},tc={class:"robot-info-box"},oc={class:"robot-prompt"},sc={__name:"show-like",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.show-like"),{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=_=>{l({})};return(_,i)=>{const s=ne;return u(),A(Z,{class:"setting-box",title:t(o)("title_show_like_dislike"),"icon-name":"like-icon"},{extra:c(()=>[...i[1]||(i[1]=[e("span",null,null,-1)])]),default:c(()=>[e("div",tc,[e("div",oc,a(t(o)("msg_show_like_dislike_desc")),1)]),n(s,{onChange:r,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:t(d).feedback_switch,"onUpdate:checked":i[0]||(i[0]=f=>t(d).feedback_switch=f),"checked-children":t(o)("btn_on"),"un-checked-children":t(o)("btn_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["title"])}}},nc=z(sc,[["__scopeId","data-v-83fb1e5f"]]),ic={class:"content-box"},lc={key:0,class:"add-btn-block"},ac={class:"list-content"},rc={key:0,class:"user-block"},cc={class:"name-box"},_c={class:"name"},dc={class:"remark-text"},uc={key:0,class:"hover-btn-box"},pc={key:0},mc={key:1},hc={key:2},vc={key:1,class:"hover-btn-box"},bc={class:"role-menu-box"},fc=["onClick"],gc={class:"menu-header"},yc={class:"title"},kc={class:"desc"},wc={key:0,class:"check-box"},xc=["onClick"],$c={class:"menu-header"},Cc={class:"title"},Sc={class:"desc"},qc={key:0,class:"check-box"},Lc=["onClick"],Uc={class:"menu-header"},Ec={class:"title"},Rc={class:"desc"},Ic={key:0,class:"check-box"},Oc={class:"hover-btn-box"},Vc={key:0},Pc={key:1},Nc={key:2},Dc=["onClick"],Ac={__name:"role-permission",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.role-permission"),d=It(),l=X(()=>d.user_name),r=Me().query,_=L(Ot(r.id)),i=L([]),s=K({object_id:r.id,object_type:1}),f=()=>{go({...s}).then(h=>{let q=h.data||[];i.value=q})};f();const w=L(null),x=()=>{w.value.show(i.value,[{object_id:+r.id,object_type:1,operate_rights:4}])},$=(h,q)=>{let S=q==4?o("permission_manage"):q==2?o("permission_edit"):o("permission_view");te.confirm({title:o("title_tip"),icon:n(Se),content:o("msg_confirm_change_permission",{permission:S}),okText:o("btn_confirm"),cancelText:o("btn_cancel"),onOk:()=>{let m=[{object_id:+h.object_id,object_type:+h.object_type,operate_rights:+q}];yo({identity_ids:h.identity_id,identity_type:h.identity_type,object_array:JSON.stringify(m)}).then(p=>{Q.success(o("msg_modify_success")),f()})},onCancel(){}})},I=h=>{te.confirm({title:o("title_tip"),icon:n(Se),content:o("msg_confirm_delete"),okText:o("btn_confirm"),okType:"danger",cancelText:o("btn_cancel"),onOk:()=>{ko({identity_id:h.identity_id,identity_type:h.identity_type,object_id:h.object_id,object_type:h.object_type}).then(q=>{Q.success(o("msg_delete_success")),f()})},onCancel(){}})},y=L([{title:o("label_name"),dataIndex:"name",key:"name"},{title:o("label_permission"),dataIndex:"operate_rights",key:"operate_rights"},{title:o("label_action"),dataIndex:"action",key:"action",width:80}]);return(h,q)=>{const S=se,m=Kt,p=Ft,k=Qt,E=_t;return u(),A(E,null,{default:c(()=>[e("div",ic,[_.value==4?(u(),b("div",lc,[n(S,{type:"primary",onClick:x,icon:Ze(t(De))},{default:c(()=>[C(a(t(o)("btn_add_collaborator")),1)]),_:1},8,["icon"])])):R("",!0),e("div",ac,[n(k,{columns:y.value,"data-source":i.value,pagination:!1},{bodyCell:c(({column:g,record:N})=>[g.key==="name"?(u(),b("div",rc,[n(m,{shape:"square",src:N.avatar,size:40},{icon:c(()=>[N.avatar?R("",!0):(u(),A(t(Xe),{key:0}))]),_:2},1032,["src"]),e("div",cc,[e("div",_c,a(N.user_name),1),e("div",dc,a(N.name),1)])])):R("",!0),g.key==="operate_rights"?(u(),b(T,{key:1},[_.value==2||N.user_name==l.value?(u(),b("div",uc,[N.operate_rights==4?(u(),b("span",pc,a(t(o)("permission_manage")),1)):R("",!0),N.operate_rights==2?(u(),b("span",mc,a(t(o)("permission_edit")),1)):R("",!0),N.operate_rights==1?(u(),b("span",hc,a(t(o)("permission_view")),1)):R("",!0)])):N.role_type==1||N.is_creator==1?(u(),b("div",vc,a(t(o)("permission_manage")),1)):(u(),A(p,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:c(()=>[e("div",bc,[e("div",{class:"role-menu",onClick:J=>$(N,4)},[e("div",gc,[n(t(Xe)),e("span",yc,a(t(o)("permission_manage")),1)]),e("div",kc,a(t(o)("permission_manage_desc")),1),N.operate_rights==4?(u(),b("div",wc,[n(t(Te))])):R("",!0)],8,fc),e("div",{class:"role-menu",onClick:J=>$(N,2)},[e("div",$c,[n(t(rt)),e("span",Cc,a(t(o)("permission_edit")),1)]),e("div",Sc,a(t(o)("permission_edit_desc")),1),N.operate_rights==2?(u(),b("div",qc,[n(t(Te))])):R("",!0)],8,xc),e("div",{class:"role-menu",onClick:J=>$(N,1)},[e("div",Uc,[n(t(Wt)),e("span",Ec,a(t(o)("permission_view")),1)]),e("div",Rc,a(t(o)("permission_view_desc")),1),N.operate_rights==1?(u(),b("div",Ic,[n(t(Te))])):R("",!0)],8,Lc)])]),default:c(()=>[e("div",Oc,[N.operate_rights==4?(u(),b("span",Vc,a(t(o)("permission_manage")),1)):R("",!0),N.operate_rights==2?(u(),b("span",Pc,a(t(o)("permission_edit")),1)):R("",!0),N.operate_rights==1?(u(),b("span",Nc,a(t(o)("permission_view")),1)):R("",!0),n(t(it))])]),_:2},1024))],64)):R("",!0),g.key==="action"?(u(),b(T,{key:2},[_.value==4&&N.user_name!=l.value?(u(),b(T,{key:0},[N.role_type!=1&&N.is_creator!=1?(u(),b("a",{key:0,onClick:J=>I(N)},a(t(o)("btn_remove")),9,Dc)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),n(wo,{onOk:f,ref_key:"addCollaboratorRef",ref:w},null,512)]),_:1})}}},Tc=z(Ac,[["__scopeId","data-v-85d10a8a"]]),jc={class:"actions-box"},Mc={key:0,class:"library-list"},zc=["onClick"],Bc={class:"library-name"},Jc={class:"library-intro"},Kc={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.skill.index"),d=L(!1),{robotInfo:l,getRobot:r}=Y("robotInfo"),_=v,i=K({work_flow_ids:[]}),s=L(null),f=X(()=>_.robotList.filter(y=>i.work_flow_ids.includes(y.id))),w=y=>{let h=i.work_flow_ids.indexOf(y.id);i.work_flow_ids.splice(h,1),I()},x=y=>{i.work_flow_ids=[...y],I()},$=()=>{s.value.open([...i.work_flow_ids])},I=()=>{let y={...ee(i)};y.work_flow_ids=y.work_flow_ids.join(","),oo({id:l.id,...y}).then(h=>{Q.success(o("msg_save_success")),r(l.id)})};return qe(()=>{i.work_flow_ids=l.work_flow_ids.split(",")}),(y,h)=>{const q=le,S=se,m=ke;return u(),A(Z,{class:"setting-box",title:t(o)("title_skill"),"icon-name":"skii",isEdit:d.value,"onUpdate:isEdit":h[0]||(h[0]=p=>d.value=p),bodyStyle:{padding:0}},{tip:c(()=>[n(q,{placement:"top"},{title:c(()=>[e("span",null,a(t(o)("tip_support_workflow")),1)]),default:c(()=>[n(t(H))]),_:1})]),extra:c(()=>[e("div",jc,[n(m,{gap:8},{default:c(()=>[n(S,{size:"small",onClick:$},{default:c(()=>[C(a(t(o)("btn_add_skill")),1)]),_:1})]),_:1})])]),default:c(()=>[f.value.length>0?(u(),b("div",Mc,[(u(!0),b(T,null,W(f.value,p=>(u(),b("div",{class:"library-item",key:p.id},[e("span",{class:"close-btn",onClick:k=>w(p)},[n(t(ye))],8,zc),e("div",Bc,a(p.robot_name),1),e("div",Jc,a(p.robot_intro),1)]))),128))])):R("",!0),n(xo,{ref_key:"robotSelectAlertRef",ref:s,onChange:x},null,512)]),_:1},8,["title","isEdit"])}}},Fc=z(Kc,[["__scopeId","data-v-41ee8339"]]),Wc={class:"robot-info-box"},Qc={class:"set-block"},Gc={class:"switch-item"},Hc={__name:"chat-cache",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.chat-cache"),{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=K({valid_time:"",cache_switch:0}),_=K({unix:"h",hValue:24,mValue:1440}),i=()=>{_.unix==="h"?r.valid_time=_.hValue*3600:r.valid_time=_.mValue*60,l({cache_config:{...r}})},s=()=>{i()},f=()=>{_.unix=="h"?_.hValue=parseInt(_.mValue/60):_.mValue=parseInt(_.hValue*60)},w=()=>{te.confirm({title:o("msg_confirm_clear_cache"),icon:n(Se),content:o("msg_confirm_clear_cache_content"),onOk(){so({id:d.id,robot_key:d.robot_key}).then(x=>{Q.success(o("msg_clear_success"))})}})};return re(()=>d.cache_config,()=>{let x=d.cache_config||{};x=JSON.parse(JSON.stringify(x)),r.cache_switch=x.cache_switch,r.valid_time=x.valid_time,x.valid_time%3600==0?(_.unix="h",_.hValue=x.valid_time/3600):(_.unix="m",_.mValue=parseInt(x.valid_time/60)||1440)},{immediate:!0,deep:!0}),qe(()=>{}),(x,$)=>{const I=xe,y=Ne,h=Pe,q=Gt,S=se,m=ne;return u(),A(Z,{class:"setting-box",title:t(o)("title_chat_cache"),"icon-name":"chat-cache"},{extra:c(()=>[...$[4]||($[4]=[e("span",null,null,-1)])]),default:c(()=>[e("div",Wc,[C(a(t(o)("msg_cache_description"))+" ",1),e("div",Qc,[n(q,{compact:""},{default:c(()=>[_.unix=="h"?(u(),A(I,{key:0,onBlur:i,precision:0,value:_.hValue,"onUpdate:value":$[0]||($[0]=p=>_.hValue=p),min:1,max:72,style:{width:"70px"}},null,8,["value"])):(u(),A(I,{key:1,onBlur:i,precision:0,value:_.mValue,"onUpdate:value":$[1]||($[1]=p=>_.mValue=p),min:1,max:4320,style:{width:"70px"}},null,8,["value"])),n(h,{value:_.unix,"onUpdate:value":$[2]||($[2]=p=>_.unix=p),style:{width:"70px"},onChange:f},{default:c(()=>[n(y,{value:"h"},{default:c(()=>[C(a(t(o)("unit_hour")),1)]),_:1}),n(y,{value:"m"},{default:c(()=>[C(a(t(o)("unit_minute")),1)]),_:1})]),_:1},8,["value"])]),_:1})])]),e("div",Gc,[n(S,{onClick:w,size:"small"},{default:c(()=>[C(a(t(o)("btn_clean_cache")),1)]),_:1}),n(m,{onChange:s,checkedValue:1,unCheckedValue:0,checked:r.cache_switch,"onUpdate:checked":$[3]||($[3]=p=>r.cache_switch=p),"checked-children":t(o)("switch_on"),"un-checked-children":t(o)("switch_off")},null,8,["checked","checked-children","un-checked-children"])])]),_:1},8,["title"])}}},Xc=z(Hc,[["__scopeId","data-v-384852fc"]]),Yc={key:0},Zc={key:1},e_=["placeholder"],t_=["placeholder"],o_={class:"drag-btn"},s_={__name:"add-variable-modal",emits:["ok"],setup(v,{expose:o,emit:d}){const{t:l}=j("views.robot.robot-config.basic-config.components.variable-setting.add-variable-modal"),r=Me().query,_=L(!1),i=d,s=K({robot_key:r.robot_key,id:"",variable_type:"input_string",variable_key:"",variable_name:"",max_input_length:10,default_value:"",must_input:!1,options:[{label:""}]}),f=X(()=>s.options.filter(S=>S.label)),w=(S={})=>{s.id=S.id||"",s.variable_type=S.variable_type||"input_string",s.variable_key=S.variable_key||"",s.variable_name=S.variable_name||"",s.max_input_length=S.max_input_length||10,s.default_value=S.default_value||"",s.must_input=S.must_input=="1",s.options=S.options||[{label:""}],_.value=!0},x=(S,m)=>m?/^[a-zA-Z_]+$/.test(m)?Promise.resolve():Promise.reject(l("msg_key_invalid")):Promise.reject(l("msg_input_key_required")),$=L(),I=()=>{$.value.validate().then(()=>{let S=[];if(s.variable_type=="select_one"&&(S=s.options.filter(p=>p.label!=""),S.length==0))return Q.error(l("msg_fill_options"));let m=s.max_input_length;(s.variable_type=="select_one"||s.variable_type=="checkbox_switch")&&(m=1),no({...s,max_input_length:m,must_input:s.must_input?1:0,options:JSON.stringify(S)}).then(p=>{Q.success(s.id?l("msg_update_success"):l("msg_create_success")),_.value=!1,i("ok")})})},y=()=>{s.options.push({label:""})},h=S=>{s.options.length>1&&s.options.splice(S,1)},q=()=>{s.options=[{label:""}],s.variable_type=="checkbox_switch"?s.default_value="2":s.default_value=void 0};return o({show:w}),(S,m)=>{const p=Ne,k=Pe,E=ze,g=me,N=xe,J=at,P=se,M=ae,F=Ht,oe=Oe,O=te;return u(),b("div",null,[n(O,{open:_.value,"onUpdate:open":m[10]||(m[10]=U=>_.value=U),title:t(l)("title_field_detail"),onOk:I,width:648,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"70vh","overflow-y":"auto","padding-right":"12px"}},{default:c(()=>[n(oe,{model:s,ref_key:"formRef",ref:$,layout:"vertical","label-col":{span:4},"wrapper-col":{span:24}},{default:c(()=>[n(E,{label:t(l)("label_field_type"),name:"variable_type"},{default:c(()=>[n(k,{onChange:q,value:s.variable_type,"onUpdate:value":m[0]||(m[0]=U=>s.variable_type=U),placeholder:t(l)("ph_select_field_type")},{default:c(()=>[n(p,{value:"input_string"},{default:c(()=>[C(a(t(l)("option_text")),1)]),_:1}),n(p,{value:"input_number"},{default:c(()=>[C(a(t(l)("option_number")),1)]),_:1}),n(p,{value:"select_one"},{default:c(()=>[C(a(t(l)("option_select_one")),1)]),_:1}),n(p,{value:"checkbox_switch"},{default:c(()=>[C(a(t(l)("option_checkbox_switch")),1)]),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(E,{label:t(l)("label_field_key"),name:"variable_key",rules:[{required:!0,validator:(U,ie)=>x(U,ie)}]},{default:c(()=>[n(g,{value:s.variable_key,"onUpdate:value":m[1]||(m[1]=U=>s.variable_key=U),maxLength:10,placeholder:t(l)("ph_input_field_key")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),n(E,{label:t(l)("label_field_name"),name:"variable_name",rules:[{required:!0}]},{default:c(()=>[n(g,{value:s.variable_name,"onUpdate:value":m[2]||(m[2]=U=>s.variable_name=U),maxLength:10,placeholder:t(l)("ph_input_field_name")},null,8,["value","placeholder"])]),_:1},8,["label"]),["input_string","input_number"].includes(s.variable_type)?(u(),A(E,{key:0,label:t(l)("label_max_length"),name:"max_input_length"},{default:c(()=>[n(N,{value:s.max_input_length,"onUpdate:value":m[3]||(m[3]=U=>s.max_input_length=U),placeholder:t(l)("ph_input"),precision:0,min:1,max:50},null,8,["value","placeholder"])]),_:1},8,["label"])):R("",!0),n(E,{label:t(l)("label_default_value"),name:"default_value"},{default:c(()=>[s.variable_type=="input_string"?(u(),b("div",Yc,[n(g,{value:s.default_value,"onUpdate:value":m[4]||(m[4]=U=>s.default_value=U),placeholder:t(l)("ph_input_default_value")},null,8,["value","placeholder"])])):R("",!0),s.variable_type=="input_number"?(u(),b("div",Zc,[n(N,{maxLength:50,style:{width:"100%"},stringMode:"",value:s.default_value,"onUpdate:value":m[5]||(m[5]=U=>s.default_value=U),placeholder:t(l)("ph_input_default_value")},null,8,["value","placeholder"])])):R("",!0),s.variable_type=="select_one"?(u(),b("div",{key:2,placeholder:t(l)("ph_select_default_value")},[n(k,{value:s.default_value,"onUpdate:value":m[6]||(m[6]=U=>s.default_value=U),style:{width:"100%"}},{default:c(()=>[(u(!0),b(T,null,W(f.value,U=>(u(),A(p,{value:U.label},{default:c(()=>[C(a(U.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])],8,e_)):R("",!0),s.variable_type=="checkbox_switch"?(u(),b("div",{key:3,placeholder:t(l)("ph_select_default_value")},[n(k,{value:s.default_value,"onUpdate:value":m[7]||(m[7]=U=>s.default_value=U),style:{width:"100%"}},{default:c(()=>[n(p,{value:"1"},{default:c(()=>[C(a(t(l)("option_selected")),1)]),_:1}),n(p,{value:"2"},{default:c(()=>[C(a(t(l)("option_not_selected")),1)]),_:1})]),_:1},8,["value"])],8,t_)):R("",!0)]),_:1},8,["label"]),s.variable_type!="checkbox_switch"?(u(),A(E,{key:1,label:null,name:"must_input"},{default:c(()=>[n(J,{checked:s.must_input,"onUpdate:checked":m[8]||(m[8]=U=>s.must_input=U)},{default:c(()=>[C(a(t(l)("label_required")),1)]),_:1},8,["checked"])]),_:1})):R("",!0),s.variable_type==="select_one"?(u(),A(E,{key:2,label:t(l)("label_options"),name:"options"},{default:c(()=>[n(P,{type:"dashed",onClick:y},{default:c(()=>[C(a(t(l)("btn_add_option")),1)]),_:1}),n(F,null,{default:c(()=>[n(t(Ve),{modelValue:s.options,"onUpdate:modelValue":m[9]||(m[9]=U=>s.options=U),"item-key":"index",group:"table-rows",handle:".drag-btn"},{item:c(({element:U,index:ie})=>[(u(),b("div",{key:ie,class:"option-item"},[e("span",o_,[n(M,{name:"drag"})]),n(g,{value:U.label,"onUpdate:value":G=>U.label=G,maxLength:50,placeholder:t(l)("ph_input_option_label")},null,8,["value","onUpdate:value","placeholder"]),n(P,{type:"link",danger:"",onClick:G=>h(ie)},{default:c(()=>[C(a(t(l)("btn_delete")),1)]),_:1},8,["onClick"])]))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"])):R("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},n_=z(s_,[["__scopeId","data-v-62e8e51a"]]),i_={class:"actions-box"},l_={class:"form-box"},a_={class:"variable-list-box"},r_={class:"variable-info-block"},c_={class:"type-tags"},__={class:"btn-box"},d_=["onClick"],u_=["onClick"],p_={__name:"index",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.variable-setting.index"),d=Ae();let l={input_string:"string",input_number:"number",select_one:"string",checkbox_switch:"boolean"};const r=X(()=>d.chatVariables),_=L(null),i=()=>{if(r.value.length>=10)return Q.error(o("msg_max_variables"));_.value.show()},s=x=>{_.value.show(JSON.parse(JSON.stringify(x)))},f=()=>{d.fetchChatVariables()},w=x=>{te.confirm({title:o("msg_delete_confirm"),icon:n(Se),content:o("msg_delete_content",{name:x.variable_name}),okType:"danger",onOk(){io({robot_key:x.robot_key,id:x.id}).then($=>{Q.success(o("msg_delete_success")),f()})}})};return ge(()=>{}),(x,$)=>{const I=le,y=se,h=ke,q=ae,S=Yt,m=Xt,p=Zt;return u(),A(Z,{class:"setting-box",title:t(o)("title"),"icon-name":"variable-icon"},{tip:c(()=>[n(I,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:c(()=>[e("span",null,a(t(o)("tip")),1)]),default:c(()=>[n(t(H))]),_:1})]),extra:c(()=>[e("div",i_,[n(h,{gap:8},{default:c(()=>[n(y,{size:"small",onClick:i},{default:c(()=>[C(a(t(o)("btn_add_variable")),1)]),_:1})]),_:1})])]),default:c(()=>[e("div",l_,[e("div",a_,[(u(!0),b(T,null,W(r.value,k=>(u(),b("div",{class:"variable-item",key:k.id},[e("div",r_,[e("span",{class:ce({"is-required":k.must_input==1})},a(k.variable_key),3),e("span",null,"（"+a(k.variable_name)+"）",1),e("span",c_,a(t(l)[k.variable_type]),1)]),n(p,null,{overlay:c(()=>[n(m,null,{default:c(()=>[n(S,null,{default:c(()=>[e("a",{onClick:E=>s(k)},a(t(o)("btn_edit")),9,d_)]),_:2},1024),n(S,null,{default:c(()=>[e("a",{onClick:E=>w(k)},a(t(o)("btn_delete")),9,u_)]),_:2},1024)]),_:2},1024)]),default:c(()=>[e("div",__,[n(q,{name:"more-cycle"})])]),_:2},1024)]))),128))])]),n(n_,{ref_key:"addVariableModalRef",ref:_,onOk:f},null,512)]),_:1},8,["title"])}}},m_=z(p_,[["__scopeId","data-v-07c7365f"]]),h_={class:"robot-info-box"},v_={class:"robot-prompt"},b_={__name:"answer-prompt",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.components.answer-prompt");L(!1);const{robotInfo:d,updateRobotInfo:l}=Y("robotInfo"),r=i=>{l({})},_=()=>{d.tips_before_answer_content,d.tips_before_answer_content==""&&(d.tips_before_answer_content=o("msg_thinking_please_wait")),r()};return(i,s)=>{const f=me,w=ne;return u(),A(Z,{class:"setting-box",title:t(o)("title_answer_generation_prompt"),"icon-name":"suggested-issues"},{extra:c(()=>[...s[2]||(s[2]=[e("span",null,null,-1)])]),default:c(()=>[e("div",h_,[e("div",v_,[C(a(t(o)("msg_answer_generation_description"))+" ",1),n(f,{value:t(d).tips_before_answer_content,"onUpdate:value":s[0]||(s[0]=x=>t(d).tips_before_answer_content=x),style:{width:"280px"},maxLength:10,placeholder:t(o)("ph_input"),onBlur:_},null,8,["value","placeholder"])])]),n(w,{onChange:r,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:t(d).tips_before_answer_switch,"onUpdate:checked":s[1]||(s[1]=x=>t(d).tips_before_answer_switch=x),"checked-children":t(o)("btn_on"),"un-checked-children":t(o)("btn_off")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["title"])}}},f_=z(b_,[["__scopeId","data-v-98f151c1"]]),g_={key:0,class:"robot-config-page"},y_={class:"setting-box"},k_={class:"setting-box"},w_={class:"setting-box"},x_={class:"setting-box"},$_={class:"setting-box"},C_={class:"setting-box"},S_={class:"setting-box"},q_={class:"setting-box"},L_={class:"setting-box"},U_={class:"setting-box"},E_={class:"setting-box"},R_={class:"setting-box"},I_={class:"setting-box"},O_={class:"setting-box"},V_={class:"setting-box"},P_={class:"setting-box"},N_={class:"setting-box"},D_={key:1,class:"robot-config-page"},A_={key:2,class:"robot-config-page"},Ye="/robot/config/basic-config/activeKey",T_={__name:"index",setup(v){const{t:o}=j("views.robot.robot-config.basic-config.index"),d=Ae(),l=L(null),{robotInfo:r}=$t(d),{getRobot:_,fetchChatVariables:i}=d,s=uo(),f=()=>{l.value.scrollTop=l.value.scrollHeight},w=L(+localStorage.getItem(Ye)||1),x=L(!1),$=K(r.value),I=m=>{let p=JSON.parse(JSON.stringify(m));m.robot_avatar&&(p.robot_avatar=new File([m.robot_avatar],m.robot_avatar.name)),!p.op_type_relation_library&&$.op_type_relation_library&&delete $.op_type_relation_library,Object.assign($,p),q()},y=L([]),h=()=>{lo({application_type:1}).then(m=>{y.value=m.data||[]})};Ct("robotInfo",{robotInfo:$,updateRobotInfo:I,scrollBoxToBottom:f,getRobot:_});const q=()=>{let m;$.robot_avatar&&(m=new File([$.robot_avatar],$.robot_avatar.name));let p=JSON.parse(JSON.stringify(ee($)));m&&(p.robot_avatar=m);let k=p.welcomes;k.question=k.question.map(g=>g.content),p.welcomes=JSON.stringify(k),p.prompt_struct=JSON.stringify(p.prompt_struct);let E=p.unknown_question_prompt;E.question=E.question.map(g=>g.content),p.unknown_question_prompt=JSON.stringify(E),p.cache_config=JSON.stringify(p.cache_config),delete p.robot_avatar_url,x.value=!0,ao(p).then(g=>{if(g.res!=0)return Q.error(g.msg);x.value=!1,Q.success(o("msg_save_success")),_($.id)}).catch(()=>{x.value=!1})},S=()=>{localStorage.setItem(Ye,w.value)};return ge(()=>{h(),s.getAllmodelList(),i()}),(m,p)=>{const k=st,E=nt;return u(),b(T,null,[n(E,{class:"tab-wrapper",onChange:S,activeKey:w.value,"onUpdate:activeKey":p[0]||(p[0]=g=>w.value=g)},{default:c(()=>[(u(),A(k,{key:1,tab:t(o)("tab_basic_config")},null,8,["tab"])),R("",!0),(u(),A(k,{key:2,tab:t(o)("tab_common_questions")},null,8,["tab"]))]),_:1},8,["activeKey"]),w.value==1?(u(),b("div",g_,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:l},[e("div",y_,[n(Go)]),e("div",k_,[n(ea)]),e("div",w_,[n(Oi)]),e("div",x_,[n(xr)]),e("div",$_,[n(Xc)]),e("div",C_,[n(Qn,{robotList:y.value},null,8,["robotList"])]),e("div",S_,[n(Fc,{robotList:y.value},null,8,["robotList"])]),e("div",q_,[n(ma)]),e("div",L_,[n(Ca)]),e("div",U_,[n(m_)]),e("div",E_,[n(Na)]),e("div",R_,[n(er)]),e("div",I_,[n(Fa)]),e("div",O_,[n(Ha)]),e("div",V_,[n(ec)]),e("div",P_,[n(f_)]),e("div",N_,[n(nc)])],512)])):R("",!0),w.value==2?(u(),b("div",D_,[n(Zr)])):R("",!0),w.value==3?(u(),b("div",A_,[n(Tc)])):R("",!0)],64)}}},hd=z(T_,[["__scopeId","data-v-a7f109bb"]]);export{hd as default};
//# sourceMappingURL=index-BGadMPGa.js.map
