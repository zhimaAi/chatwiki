import{_ as at}from"./cu-scroll-RG6yxhtf.js";import{a3 as ot,d as y,z as C,q as nt,D as it,N as a,j as o,U as r,G as lt,a2 as rt,ag as _t,O as e,X as n,u as c,a6 as i,S as z,_ as p,Z as _,H as ut,F as g}from"./vue-chunks-BRsu9_To.js";import{b as pt,h as mt,d7 as dt,M as H,dj as ct,bA as ft,n as N,$ as yt,a6 as gt,bq as $,E as kt,B as ht,dk as vt,k as xt}from"../../index-M_xDbIir.js";import"./index-UA7y0weg.js";import{I as bt}from"./Input-Bx6Hhp2b.js";import{S as wt}from"./SearchOutlined-KUcJKUZw.js";import{C as Ct}from"./CopyOutlined-B27aORPl.js";import{S as zt}from"./index-D_6sH2t0.js";import{C as P}from"./ClockCircleFilled-2GdWXrdd.js";import{R as St}from"./index-CYQ0SJ7O.js";import{_ as It}from"./index-BF4PinvW.js";import{a as Dt}from"./index-Bg1_T7h9.js";import{_ as Ot}from"./index-RSdO8Qbf.js";import{_ as Rt}from"./index-CsySi7_q.js";import{_ as $t}from"./index-B0RyY99D.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-DRzYyKbC.js";import"./index-Btmz2D3B.js";import"./Search-w33R1D1l.js";import"./isPlainObject-A-SljaBF.js";import"./inputProps-DsSGhBt6.js";import"./TextArea-C57yjED6.js";import"./index-CMIXnI2Z.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-5njtOUlo.js";import"./index-D8nD-csV.js";import"./List-DKTpjnke.js";import"./collapseMotion-Brd6xpAT.js";import"./CaretDownFilled-BzxZQg7Y.js";import"./index-SuSZ4kHz.js";import"./responsiveObserve-CRSSr9-w.js";import"./LeftOutlined-DbHJ8blF.js";import"./RightOutlined-og3IpneX.js";import"./index-khLftDou.js";import"./Trigger-CkoSoTBd.js";import"./slide-DzpBPoRp.js";import"./useMergedState-C0iIHNGF.js";import"./DownOutlined-CI2wWtcJ.js";import"./CheckOutlined-DVulUWsT.js";import"./move-DD64vPeJ.js";import"./index-Bn-th77D.js";import"./Checkbox-pA5GUfu7.js";import"./index-D7wU2qJF.js";import"./dropdown-DCrM-GKY.js";import"./Dropdown-Dh4cjnmT.js";import"./colors-C56HAaAp.js";import"./index-B3CPYV6x.js";import"./shallowequal-C0xnIuy8.js";import"./index-Dob-Z8xa.js";import"./RadioButton-Bb2kU0Fd.js";import"./CaretDownOutlined-C4FFiOW0.js";import"./useRefs-CRRjy_qY.js";const Ft={class:"details-library-page"},Lt={class:"list-tools"},Mt={class:"tools-items"},Yt={class:"list-content"},qt={key:0,class:"doc-name-td"},Bt=["href"],Tt={key:0},Ut={key:1},Ht={key:1},Nt={key:0},Pt={key:1},Et=["onClick"],Vt={key:2,class:"url-remark"},jt={key:0,class:"pdf-progress-box"},Gt={class:"progress-title"},At={class:"status-box"},Jt=["onClick"],Kt={class:"progress-bar"},Qt={class:"num-box"},Xt={key:0,class:"status-tag running"},Zt={key:2,class:"status-tag running"},Wt={key:3,class:"status-tag complete"},ts={class:"status-tag status-error"},ss=["onClick"],es={class:"status-tag status-error"},as={class:"status-tag"},os=["onClick"],ns={key:7,class:"status-tag"},is={key:8,class:"status-tag running"},ls={class:"status-tag error"},rs={key:10,class:"status-tag cancel"},_s={key:11,class:"status-tag subning"},us={key:0},ps={key:1},ms={key:0},ds={key:1},cs={__name:"import-record",setup(fs){const E=mt(),V=dt(),{changeGraphSwitch:ys}=V,j=ot(),F=rt(),b=j.query,L=y(!1),M=y({library_intro:"",library_name:"",use_model:"",is_offline:null,type:0});C({selectedRowKeys:[]});const w=C({use_model:"",model_config_id:""}),Y=y([]),S=C({learned_err_count:0,learned_count:0,learned_wait_count:0}),m=C({library_id:b.id,file_name:void 0,status:"",page:1,size:10,total:0}),q=y([]),G=[{title:"文档名称",dataIndex:"file_name",key:"file_name",width:300},{title:"文档格式",dataIndex:"file_ext",key:"file_ext",width:100},{title:"文档大小",dataIndex:"file_size_str",key:"file_size",width:100},{title:"分段",dataIndex:"paragraph_count",key:"paragraph_count",width:120},{title:"文档状态",dataIndex:"status",key:"status",width:200},{title:"操作时间",dataIndex:"update_time",key:"update_time",width:150}],A=l=>{m.page=l.current,m.size=l.pageSize,k()},B=()=>{m.page=1,k()},T=(l,t={})=>{if(l.status=="4"||l.status=="3")return F.push({path:"/library/document-segmentation",query:{document_id:l.id,page:m.page}})},k=()=>{let l=lt(m);l.status==0&&(l.status=""),L.value=!0,ct(l).then(t=>{let d=t.data.info;!w.use_model&&w.use_model!=d.use_model&&(w.use_model=d.use_model,w.model_config_id=d.model_config_id),M.value={...d},q.value=G;let D=t.data.list||[],v=t.data.count_data||{};m.total=t.data.total,S.learned_count=v.learned_count,S.learned_err_count=v.learned_err_count,S.learned_wait_count=v.learned_wait_count;let x=!1;Y.value=D.map(u=>(["1","6","0","5"].includes(u.status)&&(x=!0),u.file_size_str=ft(u.file_size),u.update_time=N(u.update_time*1e3).format("YYYY-MM-DD HH:mm"),u.doc_last_renew_time_desc=u.doc_last_renew_time>0?N(u.doc_last_renew_time*1e3).format("YYYY-MM-DD HH:mm"):"--",u)),x&&J(),!x&&clearInterval(h.value)}).finally(()=>{L.value=!1})},h=y(null),J=()=>{clearInterval(h.value),h.value=setInterval(()=>{k()},1e3*5)},K=l=>{H.confirm({title:"取消确认？",content:"确认取消该文档解析",okText:"确定",onOk(){vt({id:l.id}).then(t=>{xt.success("取消成功"),k()})}})},I=y(!1),Q=l=>{let t=`/manage/downloadLibraryFile?id=${l.id}&token=${E.getToken}`;var d=document.createElement("a");d.href=t,d.style.display="none",d.click()},X=()=>{F.push({path:"/library/details/export-record",query:b})};return nt(()=>{b.page&&(m.page=+b.page),k()}),it(()=>{h.value&&clearInterval(h.value)}),(l,t)=>{const d=It,D=bt,v=Ot,x=Rt,u=zt,O=$t,Z=Dt,W=at,U=ht,tt=St,st=H,et=_t("copy");return e(),a("div",Ft,[o(W,{scrollbar:!1},{default:r(()=>[o(d,{"show-icon":"",message:"通过文档导入记录，可以查看文档学习状态，学习失败的文档可以重新学习"}),n("div",Lt,[n("div",Mt,[o(D,{style:{width:"282px"},value:m.file_name,"onUpdate:value":t[0]||(t[0]=f=>m.file_name=f),placeholder:"请输入文档名称搜索",onChange:B},{suffix:r(()=>[o(c(wt),{onClick:B,style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])])]),n("div",Yt,[o(Z,{columns:q.value,"data-source":Y.value,scroll:{x:1e3},"row-key":"id",pagination:{current:m.page,total:m.total,pageSize:m.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:A},{bodyCell:r(({column:f,record:s})=>[f.key==="file_name"?(e(),a("div",qt,[s.doc_type==2?(e(),z(v,{key:0,title:null},{content:r(()=>[t[3]||(t[3]=_(" 原链接：")),n("a",{href:s.doc_url,target:"_blank"},p(s.doc_url),9,Bt),ut(o(c(Ct),{style:{"margin-left":"4px",cursor:"pointer"}},null,512),[[et,`${s.doc_url}`]])]),default:r(()=>[n("span",null,[["5","6","7"].includes(s.status)?(e(),a("span",Tt,p(s.doc_url),1)):(e(),a("span",Ut,p(s.file_name),1))])]),_:2},1024)):(e(),a("span",Ht,[["5","6","7"].includes(s.status)?(e(),a("span",Nt,p(s.doc_url),1)):(e(),a("span",Pt,p(s.file_name),1)),n("a",{style:{"margin-left":"2px"},onClick:R=>Q(s)},"下载",8,Et)])),s.doc_type==2&&s.remark?(e(),a("div",Vt," 备注："+p(s.remark),1)):i("",!0)])):i("",!0),f.key==="status"?(e(),a(g,{key:1},[s.file_ext=="pdf"&&s.pdf_parse_type>=2?(e(),a(g,{key:0},[s.status==0?(e(),a("div",jt,[n("div",Gt,[n("span",At,[o(c(yt)),t[4]||(t[4]=_("文档解析中"))]),n("a",{onClick:R=>K(s)},"取消",8,Jt)]),n("div",Kt,[o(x,{size:"small",class:"progress-bar-box",percent:parseInt(s.ocr_pdf_index/s.ocr_pdf_total*100),"show-info":!1},null,8,["percent"]),n("div",Qt,p(s.ocr_pdf_index)+" / "+p(s.ocr_pdf_total),1)])])):i("",!0)],64)):(e(),a(g,{key:1},[s.status==0?(e(),a("span",Xt,[o(u,{size:"small"}),t[5]||(t[5]=_(" 转换中"))])):i("",!0)],64)),s.status==1?(e(),a("span",Zt,[o(u,{size:"small"}),t[6]||(t[6]=_(" 学习中"))])):i("",!0),s.status==2?(e(),a("span",Wt,[o(c(gt)),t[7]||(t[7]=_(" 学习完成"))])):i("",!0),s.status==3?(e(),z(O,{key:4,placement:"top"},{title:r(()=>[n("span",null,p(s.errmsg),1)]),default:r(()=>[n("span",null,[n("span",ts,[o(c($)),t[8]||(t[8]=_(" 转换失败"))]),M.value.type==2?(e(),a("a",{key:0,class:"ml8",onClick:R=>T(s)},"学习",8,ss)):i("",!0)])]),_:2},1024)):i("",!0),s.status==8?(e(),z(O,{key:5,placement:"top"},{title:r(()=>[n("span",null,p(s.errmsg),1)]),default:r(()=>[n("span",null,[n("span",es,[o(c($)),t[9]||(t[9]=_(" 转化异常"))])])]),_:2},1024)):i("",!0),s.status==4?(e(),a(g,{key:6},[n("span",as,[o(c(P)),t[10]||(t[10]=_(" 待学习"))]),n("a",{class:"ml8",onClick:R=>T(s)},"学习",8,os)],64)):i("",!0),s.status==5?(e(),a("span",ns,[o(c(P)),t[11]||(t[11]=_(" 待获取"))])):i("",!0),s.status==6?(e(),a("span",is,[o(u,{size:"small"}),t[12]||(t[12]=_(" 获取中"))])):i("",!0),s.status==7?(e(),z(O,{key:9,placement:"top"},{title:r(()=>[n("span",null,p(s.errmsg),1)]),default:r(()=>[n("span",ls,[o(c($)),t[13]||(t[13]=_(" 获取失败"))])]),_:2},1024)):i("",!0),s.status==9?(e(),a("span",rs,[o(c(kt)),t[14]||(t[14]=_(" 取消解析"))])):i("",!0),s.status==10?(e(),a("span",_s,[o(u,{size:"small"}),t[15]||(t[15]=_(" 正在分段 "))])):i("",!0)],64)):i("",!0),f.key==="file_size"?(e(),a(g,{key:2},[s.doc_type==3?(e(),a("span",us,"-")):(e(),a("span",ps,p(s.file_size_str),1))],64)):i("",!0),f.key==="paragraph_count"?(e(),a(g,{key:3},[s.status==0||s.status==1?(e(),a("span",ms,"-")):(e(),a("span",ds,p(s.paragraph_count),1))],64)):i("",!0)]),_:1},8,["columns","data-source","pagination"])])]),_:1}),o(st,{open:I.value,"onUpdate:open":t[2]||(t[2]=f=>I.value=f),title:null,footer:null,width:640},{default:r(()=>[o(tt,{status:"success",title:"导出任务创建成功","sub-title":"系统会在后台导出。导出数据量越大，耗时越久。您可以稍后点击导出记录查看并下载导出的文件。"},{extra:r(()=>[o(U,{style:{"margin-right":"16px"},onClick:t[1]||(t[1]=f=>I.value=!1)},{default:r(()=>t[16]||(t[16]=[_("知道了")])),_:1,__:[16]}),o(U,{onClick:X,type:"primary"},{default:r(()=>t[17]||(t[17]=[_("去下载")])),_:1,__:[17]})]),_:1})]),_:1},8,["open"])])}}},ve=pt(cs,[["__scopeId","data-v-8d6a720e"]]);export{ve as default};
