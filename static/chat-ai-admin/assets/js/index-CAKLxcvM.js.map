{"version":3,"file":"index-CAKLxcvM.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/session-record/components/date.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/session-record/components/user.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/session-record/components/message-list.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/session-record/session-record.vue","../../../../front-end/chat-ai-admin-vue/src/views/robot/robot-config/session-record/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"zm-date\">\r\n    <div class=\"date-btn\">\r\n      <a-radio-group v-model:value=\"create_time_type\" @change=\"handleTagChange\">\r\n        <a-radio-button\r\n          class=\"date-btn-button\"\r\n          v-for=\"item in tagDateArr\"\r\n          :value=\"item.key\"\r\n          :key=\"item.key\"\r\n        >\r\n          {{ item.label }}\r\n        </a-radio-button>\r\n      </a-radio-group>\r\n    </div>\r\n    <div class=\"date-content\">\r\n      <a-range-picker\r\n        v-model:value=\"range\"\r\n        @change=\"handleDateChange\"\r\n        format=\"YYYY-MM-DD\"\r\n        :disabledDate=\"disabledDate\"\r\n        :allowClear=\"false\"\r\n      ></a-range-picker>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport dayjs from 'dayjs'\r\nimport { ref, onMounted, reactive, watch } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { message } from 'ant-design-vue'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.session-record.components.date')\r\n\r\nconst props = defineProps({\r\n  datekey: {\r\n    type: String,\r\n    default: '1'\r\n  }\r\n})\r\n\r\nconst create_time_type = ref(1)\r\n\r\nconst emit = defineEmits(['dateChange'])\r\n\r\nlet tagDateArr = reactive([\r\n  {\r\n    label: t('label_today'),\r\n    value: true,\r\n    key: 2,\r\n    start_time: dayjs().startOf('day'),\r\n    end_time: dayjs().endOf('day')\r\n  },\r\n  {\r\n    label: t('label_yesterday'),\r\n    value: false,\r\n    key: 3,\r\n    start_time: dayjs().subtract(1, 'day').startOf('day'),\r\n    end_time: dayjs().startOf('day').subtract(1, 'millisecond')\r\n  },\r\n  {\r\n    label: t('label_last_7_days'),\r\n    value: false,\r\n    key: 4,\r\n    start_time: dayjs().subtract(6, 'day').startOf('day'),\r\n    end_time: dayjs().endOf('day').subtract(1, 'millisecond')\r\n  }\r\n])\r\n\r\nconst start_time = ref(null)\r\nconst end_time = ref(null)\r\nconst range = ref([])\r\n\r\n// 创建一个禁用今天之后日期的函数\r\nconst disabledDate = (current) => {\r\n  // 如果当前日期大于或等于今天，则禁用\r\n  return current >= dayjs().subtract(0, 'day')\r\n}\r\n\r\nconst handleTagChange = () => {\r\n  let key = create_time_type.value\r\n\r\n  let dateItem = null\r\n  tagDateArr.forEach((item) => {\r\n    if (item.key == key) {\r\n      dateItem = item\r\n    }\r\n  })\r\n\r\n  if (dateItem) {\r\n    range.value = [dateItem.start_time, dateItem.end_time]\r\n    start_time.value = dateItem.start_time.unix()\r\n    end_time.value = dateItem.end_time.unix()\r\n    // format('YYYY-MM-DD HH:mm:ss')\r\n  }\r\n\r\n  search()\r\n}\r\n\r\nconst handleDateChange = (dates) => {\r\n  const startDate = dayjs(dates[0]).startOf('day')\r\n  const endDate = dayjs(dates[1]).endOf('day')\r\n  if (endDate.diff(startDate, 'days') > 29) {\r\n      range.value[0] = dates[0].startOf('day')\r\n      range.value[1] = startDate.add(29, 'days').endOf('day')\r\n      start_time.value = range.value[0].unix()\r\n      end_time.value = range.value[1].unix()\r\n      message.error(t('msg_max_30_days'))\r\n    } else {\r\n    const start = dayjs(dates[0]).startOf('day').unix()\r\n    const end = dayjs(dates[1]).endOf('day').unix()\r\n    range.value = dates\r\n    start_time.value = start\r\n    end_time.value = end\r\n  }\r\n  create_time_type.value = 1\r\n  search()\r\n}\r\n\r\nconst search = () => {\r\n  emit('dateChange', { start_time: start_time.value, end_time: end_time.value })\r\n}\r\n\r\nonMounted(() => {\r\n  create_time_type.value = parseInt(props.datekey)\r\n  handleTagChange()\r\n})\r\n\r\nwatch(\r\n  () => props.datekey,\r\n  (newval, oldVla) => {\r\n    create_time_type.value = parseInt(props.datekey.split('-')[0])\r\n    handleTagChange()\r\n  }\r\n)\r\n</script>\r\n<style lang=\"less\">\r\n.zm-date {\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  .date-btn {\r\n    margin-right: 8px;\r\n\r\n    .date-btn-button {\r\n      padding-left: 16px;\r\n      padding-right: 16px;\r\n    }\r\n  }\r\n\r\n  .date-content {\r\n    width: 260px;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"user-content\" ref=\"scrollUserBoxRef\" @scroll=\"onScroll\">\r\n    <div class=\"empty-box\" v-if=\"userLists.length === 0\">\r\n      <img src=\"@/assets/img/library/detail/empty.png\" alt=\"\" />\r\n      <div class=\"title\">{{ t('msg_no_results') }}</div>\r\n    </div>\r\n    <div\r\n      v-else\r\n      class=\"user-item\"\r\n      :class=\"{ active: item.openid == currentItem.openid }\"\r\n      @click=\"search(item)\"\r\n      v-for=\"item in userLists\"\r\n      :key=\"item.session_id\"\r\n    >\r\n      <div class=\"user-item-left\">\r\n        <img class=\"user-img\" :src=\"item.avatar\" alt=\"\" />\r\n      </div>\r\n      <div class=\"user-item-right\">\r\n        <div class=\"user-name-box\">\r\n          <div class=\"user-name\">{{ item.name }}</div>\r\n          <div v-ftime=\"'MM-DD HH:mm'\" class=\"user-timer\">{{ item.last_chat_time }}</div>\r\n        </div>\r\n        <div class=\"user-info\">{{ item.last_chat_message }}</div>\r\n        <div class=\"user-source-box\">\r\n          <div class=\"user-source-title\">{{ t('label_from') }}</div>\r\n          <div class=\"user-source-content\">{{ formatSource(item) }}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { onMounted, ref, watch } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.session-record.components.user')\r\n\r\nconst scrollUserBoxRef = ref(null)\r\nconst props = defineProps({\r\n  userList: {\r\n    type: Array,\r\n    default: null\r\n  },\r\n  channelItem: {\r\n    type: Array,\r\n    default: null\r\n  },\r\n})\r\n\r\nconst emit = defineEmits(['userClick', 'userScroll', 'userScrollStart', 'userScrollEnd'])\r\n\r\nconst userLists = ref([])\r\nconst channelItems = ref([])\r\nconst currentItem = ref({})\r\n\r\nconst search = (item) => {\r\n  currentItem.value = item\r\n  emit('userClick', item)\r\n}\r\n\r\nconst scrollOption = {\r\n  scrollTop: 0,\r\n  scrollHeight: 0,\r\n  clientHeight: 0,\r\n  scrollStartDiff: 60,\r\n  scrollEndDiff: 60,\r\n  scrollDirection: '' // 滚动方向\r\n}\r\n\r\nlet scrollEventTimer = null // 滚动条防抖\r\nlet onScrollEventLock = false // 时间触发锁\r\n// 监听滚动条滚动\r\nfunction onScroll(e) {\r\n  if (onScrollEventLock) {\r\n    return\r\n  }\r\n\r\n  if (scrollEventTimer) {\r\n    clearTimeout(scrollEventTimer)\r\n    scrollEventTimer = null\r\n  }\r\n\r\n  scrollEventTimer = setTimeout(() => {\r\n    if (scrollOption.scrollTop - e.target.scrollTop > 0) {\r\n      scrollOption.scrollDirection = 'up'\r\n    }\r\n\r\n    if (scrollOption.scrollTop - e.target.scrollTop < 0) {\r\n      scrollOption.scrollDirection = 'down'\r\n    }\r\n\r\n    scrollOption.scrollTop = e.target.scrollTop\r\n    scrollOption.scrollHeight = e.target.scrollHeight\r\n    scrollOption.clientHeight = e.target.clientHeight\r\n\r\n    emit('userScroll', { ...scrollOption })\r\n    // 触顶\r\n    let isAtTop = Math.abs(scrollOption.scrollTop) <= scrollOption.scrollStartDiff + 100\r\n\r\n    if (isAtTop && scrollOption.scrollDirection === 'up') {\r\n      onScrollStart()\r\n    }\r\n    // 触底\r\n    let isAtBottom =\r\n      Math.abs(scrollOption.scrollHeight - scrollOption.scrollTop - scrollOption.clientHeight) <=\r\n      scrollOption.scrollEndDiff\r\n\r\n    if (isAtBottom && scrollOption.scrollDirection === 'down') {\r\n      onScrollEnd()\r\n    }\r\n  }, 50)\r\n}\r\n\r\nfunction onScrollStart() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.userList.length == 0) {\r\n    return\r\n  }\r\n  emit('userScrollStart', {\r\n    msg: props.userList[0]\r\n  })\r\n}\r\n\r\nfunction onScrollEnd() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.userList.length == 0) {\r\n    return\r\n  }\r\n  emit('userScrollEnd', {\r\n    msg: props.userList[props.userList.length - 1]\r\n  })\r\n}\r\n\r\nwatch(\r\n    () => props.userList,\r\n    (val) => {\r\n      userLists.value = val\r\n      if (userLists.value.length > 0 && userLists.value.length <= 20) {\r\n        search(userLists.value[0])\r\n        currentItem.value = userLists.value[0]\r\n      }\r\n    },\r\n    {\r\n      immediate: true\r\n    }\r\n)\r\n\r\nwatch(\r\n    () => props.channelItem,\r\n    (val) => {\r\n      channelItems.value = val\r\n    },\r\n    {\r\n      immediate: true\r\n    }\r\n)\r\n\r\nconst formatSource = (item) => {\r\n  for (let i = 0; i < channelItems.value.length; i++) {\r\n    if (item.app_type == channelItems.value[i].app_type\r\n        && (item.app_id || '') == channelItems.value[i].app_id) {\r\n      return channelItems.value[i].app_name\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  userLists.value = props.userList\r\n  channelItems.value = props.channelItem\r\n})\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.user-content {\r\n  width: 320px;\r\n  height: 100%;\r\n  overflow-x: hidden;\r\n  overflow-y: auto;\r\n  background-color: white;\r\n\r\n  .user-item {\r\n    width: 100%;\r\n    display: flex;\r\n    padding: 12px 16px;\r\n    align-items: center;\r\n    justify-content: flex-start;\r\n    border-radius: 6px;\r\n    background: white;\r\n    cursor: pointer;\r\n\r\n    .user-item-left {\r\n      margin-right: 8px;\r\n\r\n      .user-img {\r\n        width: 48px;\r\n        height: 48px;\r\n        border-radius: 32px;\r\n        border: 1px solid var(--6, #0000000f);\r\n      }\r\n    }\r\n\r\n    .user-item-right {\r\n      width: 100%;\r\n      height: 100%;\r\n\r\n      .user-name-box {\r\n        width: 100%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n\r\n        .user-name {\r\n          display: -webkit-box;\r\n          -webkit-box-orient: vertical;\r\n          -webkit-line-clamp: 1;\r\n          flex: 1 0 0;\r\n          overflow: hidden;\r\n          color: #262626;\r\n          text-overflow: ellipsis;\r\n          font-family: 'PingFang SC';\r\n          font-size: 14px;\r\n          font-style: normal;\r\n          font-weight: 400;\r\n          line-height: 22px;\r\n        }\r\n\r\n        .user-timer {\r\n          color: #8c8c8c;\r\n          text-align: right;\r\n          font-family: 'PingFang SC';\r\n          font-size: 14px;\r\n          font-style: normal;\r\n          font-weight: 400;\r\n          line-height: 22px;\r\n        }\r\n      }\r\n\r\n      .user-info {\r\n        display: -webkit-box;\r\n        -webkit-box-orient: vertical;\r\n        -webkit-line-clamp: 1;\r\n        align-self: stretch;\r\n        overflow: hidden;\r\n        color: #595959;\r\n        text-overflow: ellipsis;\r\n        font-family: 'PingFang SC';\r\n        font-size: 14px;\r\n        font-style: normal;\r\n        font-weight: 400;\r\n        line-height: 22px;\r\n      }\r\n\r\n      .user-source-box {\r\n        width: 100%;\r\n        display: -webkit-box;\r\n        -webkit-box-orient: vertical;\r\n        -webkit-line-clamp: 1;\r\n        overflow: hidden;\r\n        color: #8c8c8c;\r\n        text-overflow: ellipsis;\r\n        font-family: 'PingFang SC';\r\n        font-size: 12px;\r\n        font-style: normal;\r\n        font-weight: 400;\r\n        line-height: 20px;\r\n\r\n        .user-source-title {\r\n          display: inline;\r\n        }\r\n\r\n        .user-source-content {\r\n          display: inline;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .user-item:hover {\r\n    background-color: #F2F4F7;\r\n  }\r\n\r\n  .active {\r\n    background-color: #e6efff;\r\n  }\r\n\r\n  .active:hover {\r\n    background-color: #e6efff;\r\n  }\r\n}\r\n\r\n.empty-box {\r\n  text-align: center;\r\n  height: 100%;\r\n  padding-top: 148px;\r\n  img {\r\n    width: 200px;\r\n    height: 200px;\r\n  }\r\n  .title {\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n    color: #262626;\r\n  }\r\n}\r\n\r\n/* 滚动条样式 */\r\n.user-content::-webkit-scrollbar {\r\n  width: 4px; /*  设置纵轴（y轴）轴滚动条 */\r\n  height: 4px; /*  设置横轴（x轴）轴滚动条 */\r\n}\r\n/* 滚动条滑块（里面小方块） */\r\n.user-content::-webkit-scrollbar-thumb {\r\n  border-radius: 0px;\r\n  background: transparent;\r\n}\r\n/* 滚动条轨道 */\r\n.user-content::-webkit-scrollbar-track {\r\n  border-radius: 0;\r\n  background: transparent;\r\n}\r\n\r\n/* hover时显色 */\r\n.user-content:hover::-webkit-scrollbar-thumb {\r\n  background: rgba(0, 0, 0, 0.2);\r\n}\r\n.user-content:hover::-webkit-scrollbar-track {\r\n  background: rgba(0, 0, 0, 0.1);\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.message-list-wrapper {\r\n  min-width: 350px;\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  height: calc(100vh - 298px);\r\n  overflow-y: auto;\r\n  padding: 12px 24px 24px;\r\n}\r\n\r\n.msg-img {\r\n  width: auto;\r\n  height: auto;\r\n  max-width: 100%;\r\n  max-height: 100%;\r\n}\r\n\r\n.message-list {\r\n  .message-item {\r\n    display: flex;\r\n    margin-top: 24px;\r\n\r\n    .user-avatar,\r\n    .robot-avatar {\r\n      display: block;\r\n      width: 32px;\r\n      height: 32px;\r\n      border-radius: 50%;\r\n    }\r\n\r\n    .itme-left {\r\n      margin-right: 8px;\r\n    }\r\n\r\n    .itme-right {\r\n      flex: 1;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n  .message-info{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: flex-end;\r\n    line-height: 20px;\r\n    font-size: 12px;\r\n    color: #7a8699;\r\n    gap: 8px;\r\n    margin-bottom: 4px;\r\n  }\r\n\r\n  .user-message {\r\n\r\n    .user-avatar-box {\r\n      margin-left: 8px;\r\n    }\r\n\r\n    .item-body {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .message-content {\r\n      float: right;\r\n      display: flex;\r\n      border-radius: 16px 4px 16px 16px;\r\n      margin-right: 0;\r\n      background-color: #2475fc;\r\n      color: #fff;\r\n      padding: 12px;\r\n      max-width: 100%;\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      white-space: pre-wrap;\r\n      width: auto;\r\n    }\r\n  }\r\n\r\n  .robot-message {\r\n    .message-info{\r\n      justify-content: left;\r\n    }\r\n    .item-body {\r\n      position: relative;\r\n      display: inline-block;\r\n      padding: 12px;\r\n      margin-right: 50px;\r\n      border-radius: 4px 16px 16px;\r\n      background-color: #fff;\r\n      white-space: pre-wrap;\r\n      word-break: break-all;\r\n      max-width: 100%;\r\n      width: auto;\r\n      overflow: hidden;\r\n    }\r\n\r\n    .message-content {\r\n      line-height: 22px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #3a4559;\r\n      white-space: pre-wrap;\r\n    }\r\n  }\r\n\r\n  .message-action-wrap {\r\n    .message-action {\r\n      display: flex;\r\n      padding-top: 12px;\r\n      margin-top: 12px;\r\n      border-top: 1px solid #edeff2;\r\n\r\n      .action-btn {\r\n        position: relative;\r\n        padding: 0 8px;\r\n        line-height: 22px;\r\n        font-size: 14px;\r\n        font-weight: 400;\r\n        color: #7a8699;\r\n        cursor: pointer;\r\n        &::before {\r\n          display: block;\r\n          position: absolute;\r\n          content: ' ';\r\n          right: 0;\r\n          top: 5px;\r\n          width: 1px;\r\n          height: 12px;\r\n          background-color: rgba(5, 5, 5, 0.06);\r\n        }\r\n        &:last-child::before {\r\n          display: none;\r\n        }\r\n      }\r\n    }\r\n\r\n    .file-items {\r\n      .file-item {\r\n        line-height: 22px;\r\n        margin-top: 8px;\r\n        font-size: 14px;\r\n        font-size: 14px;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .file-name {\r\n        color: #164799;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.loading-box {\r\n  position: absolute;\r\n  left: 50%;\r\n  top: 40%;\r\n}\r\n\r\n.empty-box {\r\n  text-align: center;\r\n  height: 100%;\r\n  padding-top: 148px;\r\n  img {\r\n    width: 200px;\r\n    height: 200px;\r\n  }\r\n  .title {\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n    color: #262626;\r\n  }\r\n}\r\n\r\n/* 滚动条样式 */\r\n.message-list-wrapper::-webkit-scrollbar {\r\n  width: 4px; /*  设置纵轴（y轴）轴滚动条 */\r\n  height: 4px; /*  设置横轴（x轴）轴滚动条 */\r\n}\r\n/* 滚动条滑块（里面小方块） */\r\n.message-list-wrapper::-webkit-scrollbar-thumb {\r\n  border-radius: 0px;\r\n  background: transparent;\r\n}\r\n/* 滚动条轨道 */\r\n.message-list-wrapper::-webkit-scrollbar-track {\r\n  border-radius: 0;\r\n  background: transparent;\r\n}\r\n\r\n/* hover时显色 */\r\n.message-list-wrapper:hover::-webkit-scrollbar-thumb {\r\n  background: rgba(0, 0, 0, 0.2);\r\n}\r\n.message-list-wrapper:hover::-webkit-scrollbar-track {\r\n  background: rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.message-top-box {\r\n  display: flex;\r\n  padding: 12px 0;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background: #F0F2F5;\r\n  z-index: 2;\r\n  border-radius: 6px;\r\n\r\n  .message-top-title {\r\n    color: #242933;\r\n    font-family: \"PingFang SC\";\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 20px;\r\n  }\r\n\r\n  .message-top-source {\r\n    margin-left: 4px;\r\n    color: #7a8699;\r\n    font-family: \"PingFang SC\";\r\n    font-size: 12px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: 20px;\r\n  }\r\n}\r\n\r\n.reply-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.reply-url .url-link {\r\n  color: #2475fc;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 20px;\r\n  text-decoration: none;\r\n}\r\n\r\n.reply-url .url-row {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n.reply-card .card-row {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n.reply-card .card-title-box {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n}\r\n\r\n.reply-card .card-thumb {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n}\r\n\r\n.reply-card .card-title {\r\n  color: #595959;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 22px;\r\n}\r\n\r\n.reply-imageText .imageText-row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n.reply-imageText .imageText-thumb {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 6px;\r\n  object-fit: cover;\r\n}\r\n\r\n.reply-imageText .imageText-text {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.reply-imageText .imageText-title {\r\n  color: #595959;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 22px;\r\n}\r\n\r\n.reply-imageText .imageText-desc {\r\n  color: #8c8c8c;\r\n  font-size: 12px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 16px;\r\n}\r\n\r\n.reply-item {\r\n  border-radius: 4px 16px 16px 16px;\r\n  padding: 16px 12px;\r\n  background: #fff;\r\n}\r\n\r\n.reply-item .message-content {\r\n  padding: 0;\r\n  color: #1a1a1a;\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 20px;\r\n}\r\n\r\n.reply-image .msg-img {\r\n  max-width: 500px;\r\n}\r\n\r\n.reply-smartMenu {\r\n  color: #1a1a1a;\r\n  .smart-menu-box {\r\n    .card-title {\r\n      white-space: pre-wrap;\r\n      align-self: stretch;\r\n      font-size: 14px;\r\n      font-style: normal;\r\n      font-weight: 400;\r\n      line-height: 20px;\r\n      margin-bottom: 14px;\r\n    }\r\n    .card-text {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n      .reply-line {\r\n        line-height: 22px;\r\n        .line-text {\r\n          color: #3a4559;\r\n        }\r\n        .empty-line {\r\n          height: 22px;\r\n        }\r\n        .link {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 4px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n<div class=\"message-box\">\r\n  <div class=\"message-top-box\">\r\n    <div class=\"message-top-title\">{{ props.robotInfo.robot_name }}</div>\r\n    <div v-if=\"sessionSource\" class=\"message-top-source\">({{ formatSource(sessionSource) }})</div>\r\n  </div>\r\n  <div class=\"message-list-wrapper\" ref=\"scrollBoxRef\" @scroll=\"onScroll\">\r\n    <div class=\"message-list\">\r\n      <div class=\"empty-box\" v-if=\"props.isEmpty || !props.messages\">\r\n        <img src=\"@/assets/img/library/detail/empty.png\" alt=\"\" />\r\n        <div class=\"title\">{{ t('msg_empty_result') }}</div>\r\n      </div>\r\n      <template v-else v-for=\"item in props.messages\" :key=\"item.uid\">\r\n        <!-- 用户的消息 -->\r\n        <div class=\"message-item user-message\" :id=\"'msg-' + item.uid\" v-if=\"item.is_customer == 1\">\r\n          <div class=\"itme-right\">\r\n            <div class=\"message-info\">\r\n              <span>{{ formatDisplayChatTime(item.create_time) }}</span>\r\n              <span>{{ item.name }}</span>\r\n            </div>\r\n            <div class=\"item-body\">\r\n              <!-- 收到消息类型处理，目前只处理了image 后续有其他的在这里添加 -->\r\n              <template v-if=\"item.received_message_type == 'image' && item.media_id_to_oss_url\">\r\n                <div class=\"message-content\">\r\n                  <img v-viewer class=\"msg-img\" :src=\"item.media_id_to_oss_url\" alt=\"\" />\r\n                </div>\r\n              </template>\r\n              <div v-else class=\"message-content\">{{ item.content }}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"user-avatar-box\">\r\n            <img class=\"user-avatar\" :src=\"item.avatar\" />\r\n          </div>\r\n        </div>\r\n        <!-- 机器人的消息 -->\r\n        <div class=\"message-item robot-message\" :id=\"'msg-' + item.uid\" v-else>\r\n          <div class=\"itme-left\">\r\n            <a-spin size=\"small\" :spinning=\"item.loading\">\r\n              <img class=\"robot-avatar\" :src=\"item.robot_avatar\" />\r\n            </a-spin>\r\n          </div>\r\n\r\n          <div class=\"itme-right\">\r\n            <div class=\"message-info\">\r\n              <span>{{ formatDisplayChatTime(item.create_time) }}</span>\r\n              <span>{{ item.name }}</span>\r\n            </div>\r\n            <template v-if=\"parseReplyList(item.reply_content_list).length\">\r\n              <div class=\"reply-list\">\r\n                <template v-for=\"(rc, idx) in parseReplyList(item.reply_content_list)\" :key=\"idx\">\r\n                  <div v-if=\"(rc.reply_type || rc.type) === 'text'\" class=\"reply-item reply-text\">\r\n                    <div class=\"message-content\" v-html=\"rc.description\"></div>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'image'\" class=\"reply-item reply-image\">\r\n                    <div class=\"message-content\">\r\n                      <img v-viewer class=\"msg-img\" :src=\"rc.pic || rc.thumb_url\" />\r\n                    </div>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'url'\" class=\"reply-item reply-url\">\r\n                    <div class=\"url-row\">\r\n                      <a class=\"url-link\" :href=\"rc.url\" target=\"_blank\">{{ rc.url }}</a>\r\n                    </div>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'card'\" class=\"reply-item reply-card\">\r\n                    <div class=\"card-row\">\r\n                      <img v-if=\"rc.thumb_url\" :src=\"rc.thumb_url\" class=\"card-thumb\" />\r\n                      <div class=\"card-title-box\">\r\n                        <svg-icon class=\"think-icon\" name=\"applet\"></svg-icon>\r\n                        <span class=\"card-title\">{{ rc.title }}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'imageText'\" class=\"reply-item reply-imageText\">\r\n                    <a class=\"imageText-row\" :href=\"rc.url\" target=\"_blank\">\r\n                      <img v-if=\"rc.thumb_url\" :src=\"rc.thumb_url\" class=\"imageText-thumb\" />\r\n                      <div class=\"imageText-text\">\r\n                        <div class=\"imageText-title\">{{ rc.title }}</div>\r\n                        <div class=\"imageText-desc\">{{ rc.description }}</div>\r\n                      </div>\r\n                    </a>\r\n                  </div>\r\n                  <div v-else-if=\"(rc.reply_type || rc.type) === 'smartMenu'\" class=\"reply-item reply-smartMenu\">\r\n                    <div class=\"smart-menu-box\">\r\n                      <div class=\"card-title\" v-if=\"rc.smart_menu && rc.smart_menu.menu_description\">{{ rc.smart_menu.menu_description }}</div>\r\n                      <div class=\"card-text\">\r\n                        <template v-for=\"(line, li) in buildMenuLines(rc.smart_menu?.menu_content || [])\" :key=\"li\">\r\n                          <div class=\"reply-line\">\r\n                            <span class=\"line-text\" v-if=\"line.kind === 'text'\">{{ line.text }}</span>\r\n                            <div v-else-if=\"line.kind === 'newline'\" class=\"empty-line\"></div>\r\n                            <span v-else-if=\"line.kind === 'html'\" v-html=\"line.html\"></span>\r\n                            <a v-else-if=\"line.kind === 'keyword'\" href=\"javascript:;\" class=\"link\">\r\n                              <div v-if=\"line.serial_no\">{{ line.serial_no }}</div>\r\n                              {{ line.text }}\r\n                            </a>\r\n                          </div>\r\n                        </template>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n              </div>\r\n            </template>\r\n            <div class=\"item-body\" v-if=\"!(item.msg_type == 1 && item.content == '')\">\r\n              <template v-if=\"item.msg_type == 1\">\r\n                <div class=\"message-content\" v-viewer>\r\n                  <cherry-markdown :content=\"item.content\"></cherry-markdown>\r\n                </div>\r\n              </template>\r\n\r\n              <template v-if=\"item.msg_type == 2\">\r\n                <div class=\"message-content\" v-html=\"item.menu_json.content\"></div>\r\n              </template>\r\n\r\n              <template v-if=\"item.msg_type == 3\">\r\n                <div class=\"message-content\">\r\n                  <img v-viewer class=\"msg-img\" :src=\"item.content\" alt=\"\" />\r\n                </div>\r\n              </template>\r\n            </div>\r\n            <!-- 语音消息 -->\r\n            <div v-if=\"item.voice_content && item.voice_content.length\">\r\n              <VoiceMessage :voice_content=\"item.voice_content\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </template>\r\n      <div v-if=\"loading\" class=\"loading-box\"><a-spin /></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, nextTick } from 'vue'\r\nimport { formatDisplayChatTime } from '@/utils/index'\r\nimport CherryMarkdown from '@/components/cherry-markdown/index.vue'\r\nimport VoiceMessage from '@/views/robot/robot-test/components/voice-message.vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.session-record.components.message-list')\r\n\r\nconst emit = defineEmits(['scroll', 'scrollStart', 'scrollEnd'])\r\n\r\nconst props = defineProps({\r\n  messages: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  robotInfo: {\r\n    type: Object,\r\n    default: () => {}\r\n  },\r\n  isEmpty: {\r\n    type: Boolean,\r\n    default: () => false\r\n  },\r\n  sessionSource: {\r\n    type: String,\r\n    default: () => null\r\n  },\r\n  channelItem: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n\r\nconst loading = ref(false)\r\nconst scrollBoxRef = ref(null)\r\nconst scrollOption = {\r\n  scrollTop: 0,\r\n  scrollHeight: 0,\r\n  clientHeight: 0,\r\n  scrollStartDiff: 60,\r\n  scrollEndDiff: 60,\r\n  scrollDirection: '' // 滚动方向\r\n}\r\n\r\nlet scrollEventTimer = null // 滚动条防抖\r\nlet onScrollEventLock = false // 时间触发锁\r\n\r\nconst formatSource = (val) => {\r\n  let newVal\r\n  for (let i = 0; i < props.channelItem.length; i++) {\r\n    const item = props.channelItem[i];\r\n    if (item.app_type === val) {\r\n      newVal = item.app_name\r\n    }\r\n  }\r\n  return newVal\r\n}\r\n\r\n// 监听滚动条滚动\r\nfunction onScroll(e) {\r\n  if (onScrollEventLock) {\r\n    return\r\n  }\r\n\r\n  if (scrollEventTimer) {\r\n    clearTimeout(scrollEventTimer)\r\n    scrollEventTimer = null\r\n  }\r\n\r\n  scrollEventTimer = setTimeout(() => {\r\n    if (scrollOption.scrollTop - e.target.scrollTop > 0) {\r\n      scrollOption.scrollDirection = 'up'\r\n    }\r\n\r\n    if (scrollOption.scrollTop - e.target.scrollTop < 0) {\r\n      scrollOption.scrollDirection = 'down'\r\n    }\r\n\r\n    scrollOption.scrollTop = e.target.scrollTop\r\n    scrollOption.scrollHeight = e.target.scrollHeight\r\n    scrollOption.clientHeight = e.target.clientHeight\r\n\r\n    emit('scroll', { ...scrollOption })\r\n    // 触顶\r\n    let isAtTop = Math.abs(scrollOption.scrollTop) <= scrollOption.scrollStartDiff\r\n\r\n    if (isAtTop && scrollOption.scrollDirection === 'up') {\r\n      onScrollStart()\r\n    }\r\n    // 触底\r\n    let isAtBottom =\r\n      Math.abs(scrollOption.scrollHeight - scrollOption.scrollTop - scrollOption.clientHeight) <=\r\n      scrollOption.scrollEndDiff\r\n\r\n    if (isAtBottom && scrollOption.scrollDirection === 'down') {\r\n      onScrollEnd()\r\n    }\r\n  }, 100)\r\n}\r\n\r\nfunction onScrollStart() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.messages.length == 0) {\r\n    return\r\n  }\r\n  emit('scrollStart', {\r\n    msg: props.messages[0]\r\n  })\r\n}\r\n\r\nfunction onScrollEnd() {\r\n  // 如果消息列表为空可能是断线重连等逻辑手动清空了消息列表造成的抖动，此时不触发事件\r\n  if (props.messages.length == 0) {\r\n    return\r\n  }\r\n  emit('scrollEnd', {\r\n    msg: props.messages[props.messages.length - 1]\r\n  })\r\n}\r\n\r\nconst scrollToBottom = () => {\r\n  if (!scrollBoxRef.value) {\r\n    return\r\n  }\r\n  nextTick(() => {\r\n    // 手动控制滚动到底部不触发触底事件\r\n    onScrollEventLock = true\r\n\r\n    scrollBoxRef.value.scrollTop = scrollBoxRef.value.scrollHeight + 1\r\n    setTimeout(() => {\r\n      scrollOption.scrollTop = scrollBoxRef.value.scrollTop\r\n      onScrollEventLock = false\r\n    }, 50)\r\n  })\r\n}\r\n\r\nfunction scrollToMessage(id, direction) {\r\n  nextTick(() => {\r\n    // 手动控制滚动到底部不触发触底事件\r\n    onScrollEventLock = true\r\n\r\n    if (!direction) {\r\n      direction = 'top'\r\n    }\r\n\r\n    let scroller = scrollBoxRef.value\r\n    let element = document.querySelector('#msg-' + id)\r\n\r\n    if (element) {\r\n      // 没数据时时没有element的\r\n      if (direction == 'top') {\r\n        scroller.scrollTop = element.offsetTop\r\n      } else {\r\n        scroller.scrollTop = element.offsetTop - scroller.clientHeight + element.clientHeight\r\n      }\r\n    }\r\n\r\n    setTimeout(() => {\r\n      scrollOption.scrollTop = scrollBoxRef.value.scrollTop\r\n      onScrollEventLock = false\r\n    }, 50)\r\n  })\r\n}\r\n\r\n// 重置滚动条状态\r\nfunction resetScroll() {\r\n  scrollOption.scrollTop = 0\r\n  scrollOption.scrollDirection = ''\r\n}\r\n\r\nfunction parseReplyList(val) {\r\n  try {\r\n    if (!val) return []\r\n    if (Array.isArray(val)) return val\r\n    if (typeof val === 'string') return JSON.parse(val || '[]')\r\n    return []\r\n  } catch (_e) {\r\n    return []\r\n  }\r\n}\r\n\r\nfunction buildMenuLines(menu_content) {\r\n  const out = []\r\n  ;(Array.isArray(menu_content) ? menu_content : []).forEach((mc) => {\r\n    const t = String(mc?.menu_type || '')\r\n    const txt = String(mc?.content || '')\r\n    if (t === '0') {\r\n      if (txt === '') { out.push({ kind: 'newline' }) }\r\n      else if (/<a[\\s\\S]*?<\\/a>/.test(txt)) {\r\n        const sanitized = /href\\s*=\\s*['\"]\\s*#\\s*['\"]/i.test(txt)\r\n          ? txt.replace(/href\\s*=\\s*['\"]\\s*#\\s*['\"]/ig, 'href=\"javascript:;\"')\r\n          : txt.replace(/href=/ig, 'target=\"_blank\" href=')\r\n        out.push({ kind: 'html', html: sanitized })\r\n      } else { out.push({ kind: 'text', text: txt }) }\r\n    } else if (t === '1') { out.push({ kind: 'keyword', text: txt, serial_no: mc?.serial_no || '' }) }\r\n  })\r\n  return out.slice(0, 20)\r\n}\r\n\r\ndefineExpose({\r\n  scrollToBottom,\r\n  scrollToMessage,\r\n  resetScroll\r\n})\r\n</script>\r\n","<template>\r\n  <div class=\"team-members-pages\">\r\n    <a-flex justify=\"flex-start\" class=\"screen-box\">\r\n      <div class=\"set-model\">\r\n        <div class=\"label set-model-label\">{{ t('label_channel') }}</div>\r\n        <div class=\"set-model-body\">\r\n          <a-select\r\n            v-model:value=\"requestParams.app_type\"\r\n            :placeholder=\"t('ph_all_channels')\"\r\n            @change=\"handleChangeModel\"\r\n            :style=\"{ width: '200px' }\"\r\n          >\r\n            <a-select-option\r\n              v-for=\"item in channelItem\"\r\n              :key=\"item.app_type\"\r\n              :value=\"item.app_type\"\r\n            >\r\n              <span>{{ item.app_name }}</span>\r\n            </a-select-option>\r\n          </a-select>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"set-date\">\r\n        <div class=\"label set-date-label\">\r\n          <span>{{ t('label_date') }}</span>\r\n        </div>\r\n        <div class=\"set-date-body\">\r\n          <DateSelect @dateChange=\"onDateChange\" :datekey=\"datekey\"></DateSelect>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"set-name\">\r\n        <a-input-search\r\n          v-model:value=\"requestParams.name\"\r\n          :placeholder=\"t('ph_search_user_name')\"\r\n          style=\"width: 200px\"\r\n          @search=\"onSearch\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"set-reset\">\r\n        <a-button @click=\"onReset\">{{ t('btn_reset') }}</a-button>\r\n        <a-button @click=\"onExport\" :loading=\"btnLoading\">{{ t('btn_export') }}</a-button>\r\n      </div>\r\n    </a-flex>\r\n    <div class=\"list-box\">\r\n      <div class=\"user-box\">\r\n        <User\r\n          :channelItem=\"channelItem\"\r\n          :userList=\"userList\"\r\n          @userScrollStart=\"onUserScrollStart\"\r\n          @userScrollEnd=\"onUserScrollEnd\"\r\n          @userClick=\"onuserClick\"\r\n        ></User>\r\n      </div>\r\n      <div class=\"records-box\">\r\n        <MessageList\r\n          ref=\"messageListRef\"\r\n          :isEmpty=\"isEmpty\"\r\n          :messages=\"messageList\"\r\n          :robotInfo=\"robotInfo\"\r\n          :channelItem=\"channelItem\"\r\n          :sessionSource=\"sessionSource\"\r\n          @scrollStart=\"onScrollStart\"\r\n          @scrollEnd=\"onScrollEnd\"\r\n        />\r\n      </div>\r\n    </div>\r\n    <a-modal v-model:open=\"open\" :title=\"null\" :footer=\"null\" :width=\"640\">\r\n      <a-result\r\n        status=\"success\"\r\n        :title=\"t('title_export_success')\"\r\n        :sub-title=\"t('msg_export_success')\"\r\n      >\r\n        <template #extra>\r\n          <a-button style=\"margin-right: 16px;\" @click=\"open = false\">{{ t('btn_know') }}</a-button>\r\n          <a-button @click=\"toDownloadPage\" type=\"primary\">{{ t('btn_go_download') }}</a-button>\r\n        </template>\r\n      </a-result>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, reactive, onMounted, watch, onUnmounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport DateSelect from './components/date.vue'\r\nimport { storeToRefs } from 'pinia'\r\nimport User from './components/user.vue'\r\nimport MessageList from './components/message-list.vue'\r\nimport { useRobotStore } from '@/stores/modules/robot'\r\nimport { useChatStore } from '@/stores/modules/chat'\r\nimport { createSessionExport } from '@/api/chat'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.session-record.session-record')\r\n\r\nconst isEmpty = ref(false)\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst query = route.query\r\nconst robotStore = useRobotStore()\r\nconst { robotInfo } = robotStore\r\nconst chatStore = useChatStore()\r\nconst { messageList } = storeToRefs(chatStore)\r\n\r\n// 是否允许自动滚动到底部\r\nlet isAllowedScrollToBottom = true\r\nconst { createMsg, onGetChatMessage, getRecordList, getChannelList } = chatStore\r\nconst messageListRef = ref(null)\r\n// master环境只有2个 yun_master环境有5个\r\nconst channelItem = ref([])\r\nconst userList = ref([])\r\nconst sessionSource = ref('')\r\nconst datekey = ref('1')\r\n\r\nconst requestParams = reactive({\r\n  robot_id: query.id, // 机器人ID\r\n  app_type: 'all', // 应用类型:从来源接口获取\r\n  app_id: 'all', // 应用类型:从来源接口获取\r\n  start_time: '', // 开始时间-时间戳\r\n  end_time: '', // 结束时间-时间戳\r\n  name: '', // 客户名称检索\r\n  page: 1, // 页码\r\n  size: 20 // 每页数\r\n})\r\n\r\nconst has_more = ref(false)\r\n\r\nconst onDateChange = (date) => {\r\n  requestParams.start_time = date.start_time\r\n  requestParams.end_time = date.end_time\r\n  onSearch()\r\n}\r\n\r\nconst onReset = () => {\r\n  // 重置\r\n  requestParams.app_type = 'all'\r\n  requestParams.name = ''\r\n  requestParams.page = 1\r\n\r\n  // 初始化子组件\r\n  datekey.value = '1' + '-' + Math.random()\r\n}\r\n\r\n\r\nconst open = ref(false)\r\nconst btnLoading = ref(false)\r\nconst onExport = async () => {\r\n  let params = getPostParmas()\r\n  btnLoading.value = true;\r\n  let res = await createSessionExport(params)\r\n  open.value = true;\r\n  btnLoading.value = false;\r\n}\r\n\r\nconst toDownloadPage = () => {\r\n  router.push({\r\n    path: '/robot/config/export-record',\r\n    query,\r\n  })\r\n}\r\n\r\nconst onSearch = () => {\r\n  requestParams.page = 1\r\n  getRecordLists()\r\n}\r\n\r\nconst handleChangeModel = (val) => {\r\n  requestParams.app_type = val\r\n  onSearch()\r\n}\r\n\r\n// 监听滚动到底部\r\nconst onScrollEnd = () => {\r\n  // console.log('滚动到底部')\r\n}\r\n\r\n// 点击用户\r\nconst onuserClick = (item) => {\r\n  sessionSource.value = item.app_type\r\n  openNewChat(item)\r\n}\r\n\r\n// 用户列表滚动到顶部\r\nconst onUserScrollStart = async () => {}\r\n\r\n// 用户列表滚动到底部\r\nconst onUserScrollEnd = () => {\r\n  if (!has_more.value) {\r\n    return\r\n  }\r\n\r\n  requestParams.page++\r\n  getRecordLists()\r\n}\r\n\r\n// 滚动到顶部\r\nconst onScrollStart = async () => {\r\n  isAllowedScrollToBottom = false\r\n\r\n  let msgId = messageList.value[0].uid\r\n\r\n  let res = await onGetChatMessage()\r\n\r\n  if (res) {\r\n    scrollToMessageById(msgId)\r\n  }\r\n}\r\n\r\nconst messageListScrollToBottom = () => {\r\n  if (messageListRef.value && isAllowedScrollToBottom) {\r\n    messageListRef.value.scrollToBottom()\r\n  }\r\n}\r\n\r\nconst scrollToMessageById = (id) => {\r\n  if (messageListRef.value) {\r\n    messageListRef.value.scrollToMessage(id)\r\n  }\r\n}\r\n\r\nconst resetScroll = () => {\r\n  if (messageListRef.value) {\r\n    messageListRef.value.resetScroll()\r\n  }\r\n}\r\n\r\n// 监听 messageList 改变\r\nconst onMessageListChange = () => {\r\n  if (!isAllowedScrollToBottom) {\r\n    return\r\n  }\r\n}\r\n\r\nlet scrollEventTimer = null // 滚动条防抖\r\nconst openNewChat = async (item) => {\r\n  isAllowedScrollToBottom = true\r\n\r\n  let query = route.query || {}\r\n\r\n  let data = {\r\n    robot_key: query.robot_key,\r\n    avatar: item.avatar,\r\n    name: item.name,\r\n    nickname: item.name,\r\n    is_background: 1,\r\n    openid: item.openid,\r\n    rel_user_id: item.rel_user_id,\r\n    // dialogue_id: item.dialogue_id\r\n  }\r\n\r\n  resetScroll()\r\n\r\n  await createMsg(data)\r\n  \r\n  if (scrollEventTimer) {\r\n    clearTimeout(scrollEventTimer)\r\n    scrollEventTimer = null\r\n  }\r\n  // 异步处理避免重复调用\r\n  scrollEventTimer = setTimeout(async () => {\r\n    // 获取对话记录\r\n    let res = await onGetChatMessage()\r\n    if (res) {\r\n      messageListScrollToBottom()\r\n    }\r\n  }, 100)\r\n}\r\n\r\nconst getChannelLists = async () => {\r\n  let params = {\r\n    robot_id: requestParams.robot_id, // 机器人ID\r\n  }\r\n  const res = await getChannelList(params)\r\n  channelItem.value = [...[{ app_type: 'all', app_name: t('ph_all_channels') }], ...res.data]\r\n}\r\n\r\nconst getPostParmas = () => {\r\n  let params = {\r\n    robot_id: requestParams.robot_id, // 机器人ID\r\n    // app_id: requestParams.app_id, // 应用类型:从来源接口获取\r\n    start_time: requestParams.start_time, // 开始时间-时间戳\r\n    end_time: requestParams.end_time, // 结束时间-时间戳\r\n    name: requestParams.name, // 客户名称检索\r\n    page: requestParams.page, // 页码\r\n    size: requestParams.size // 每页数\r\n  }\r\n  if (requestParams.app_type !== 'all') {\r\n    params.app_type = requestParams.app_type // 应用类型:从来源接口获取\r\n  }\r\n  if (requestParams.app_id !== 'all') {\r\n    params.app_id = requestParams.app_id // 应用类型:从来源接口获取\r\n  }\r\n  return params\r\n}\r\n\r\nconst getRecordLists = async () => {\r\n  let params = getPostParmas()\r\n  let res = await getRecordList(params)\r\n\r\n  let list = res.data.list || []\r\n  if (requestParams.page == 1) {\r\n    userList.value = []\r\n  }\r\n  userList.value = [...userList.value, ...list]\r\n  isEmpty.value = userList.value.length == 0\r\n  has_more.value = res.data.has_more\r\n}\r\n\r\nwatch(\r\n  () => messageList.value,\r\n  () => {\r\n    onMessageListChange()\r\n  }\r\n)\r\nonMounted(async () => {\r\n  // 获取来源列表\r\n  getChannelLists()\r\n  // 获取会话记录列表\r\n  // await getRobot(query.id)\r\n})\r\n\r\nonUnmounted(() => {})\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.team-members-pages {\r\n  background: #fff;\r\n  padding: 0 24px 24px;\r\n  height: 100%;\r\n\r\n  .screen-box {\r\n    gap: 12px;\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .list-box {\r\n    margin-top: 16px;\r\n    display: flex;\r\n    flex-wrap: nowrap;\r\n    gap: 24px;\r\n    width: 100%;\r\n    height: calc(100% - 25px);\r\n\r\n    .user-box {\r\n      height: 100%;\r\n    }\r\n\r\n    .records-box {\r\n      flex: 1;\r\n      flex-shrink: 0;\r\n      border-radius: 6px;\r\n      background: #f0f2f5;\r\n    }\r\n  }\r\n}\r\n\r\n.label {\r\n  color: #262626;\r\n  font-family: 'PingFang SC';\r\n  font-size: 14px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n}\r\n\r\n.set-model {\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  .set-model-body {\r\n    .set-model-select {\r\n      display: flex;\r\n      padding: 4px 12px;\r\n      align-items: flex-start;\r\n      align-self: stretch;\r\n      border-radius: 2px;\r\n      border: 1px solid var(--06, #d9d9d9);\r\n      background: var(--Neutral-1, #fff);\r\n    }\r\n  }\r\n}\r\n\r\n.set-date {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.set-reset{\r\n  display: flex;\r\n  gap: 12px;\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.user-model-page {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-bottom: 1px solid #fff;\r\n  border-right: 1px solid #fff;\r\n  background-color: #f2f4f7;\r\n\r\n  .page-title {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 24px;\r\n    padding: 24px 24px 16px;\r\n    background-color: #fff;\r\n    color: #000000;\r\n    font-family: 'PingFang SC';\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: 24px;\r\n  }\r\n\r\n  .list-wrapper {\r\n    background: #fff;\r\n    height: calc(100% - 64px);\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"user-model-page\">\r\n    <div class=\"page-title\">{{ t('title_session_record') }}</div>\r\n    <div class=\"list-wrapper\">\r\n      <SessionRecord></SessionRecord>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport SessionRecord from './session-record.vue'\r\n\r\nconst { t } = useI18n('views.robot.robot-config.session-record.index')\r\n</script>\r\n"],"names":["t","useI18n","props","__props","create_time_type","ref","emit","__emit","tagDateArr","reactive","dayjs","start_time","end_time","range","disabledDate","current","handleTagChange","key","dateItem","item","search","handleDateChange","dates","startDate","message","start","end","onMounted","watch","newval","oldVla","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_a_radio_group","$event","_Fragment","_renderList","_unref","_createBlock","_component_a_radio_button","_createTextVNode","_toDisplayString","_hoisted_3","_component_a_range_picker","scrollUserBoxRef","userLists","channelItems","currentItem","scrollOption","scrollEventTimer","onScroll","e","onScrollStart","onScrollEnd","val","formatSource","i","_imports_0","_normalizeClass","_hoisted_4","_hoisted_6","_hoisted_7","_hoisted_8","_withDirectives","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","loading","scrollBoxRef","onScrollEventLock","newVal","scrollToBottom","nextTick","scrollToMessage","id","direction","scroller","element","resetScroll","parseReplyList","buildMenuLines","menu_content","out","mc","txt","sanitized","__expose","_hoisted_5","formatDisplayChatTime","_hoisted_14","_hoisted_15","_hoisted_18","_component_a_spin","_hoisted_20","_hoisted_21","_hoisted_22","rc","idx","_hoisted_23","_hoisted_25","_hoisted_26","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_34","_component_svg_icon","_hoisted_35","_hoisted_36","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_a","line","li","_hoisted_46","_hoisted_47","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","CherryMarkdown","_hoisted_54","_hoisted_56","VoiceMessage","_hoisted_57","isEmpty","router","useRouter","route","useRoute","query","robotStore","useRobotStore","robotInfo","chatStore","useChatStore","messageList","storeToRefs","isAllowedScrollToBottom","createMsg","onGetChatMessage","getRecordList","getChannelList","messageListRef","channelItem","userList","sessionSource","datekey","requestParams","has_more","onDateChange","date","onSearch","onReset","open","btnLoading","onExport","params","getPostParmas","createSessionExport","toDownloadPage","getRecordLists","handleChangeModel","onuserClick","openNewChat","onUserScrollStart","onUserScrollEnd","msgId","scrollToMessageById","messageListScrollToBottom","data","getChannelLists","res","list","onUnmounted","_component_a_flex","_component_a_select","_cache","_component_a_select_option","DateSelect","_component_a_input_search","_component_a_button","User","MessageList","_component_a_modal","_component_a_result","SessionRecord"],"mappings":"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"}