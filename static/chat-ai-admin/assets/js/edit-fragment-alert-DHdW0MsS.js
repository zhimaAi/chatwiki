import{_ as qe}from"./empty-CzGZrENG.js";import{b as ee,aC as $e,d as de,bv as Ie,bf as Pe,bw as te}from"../../index-CuFGOJXl.js";import{Y as u,_ as a,a5 as t,f as b,r as W,e as _e,w as se,k as o,a2 as l,ad as A,G as i,ae as f,F as U,a9 as J,a1 as D,a7 as h,n as ae,u as E,A as me,J as ce,y as Ce,q as ze,a4 as oe}from"./vue-chunks-yZ4gwLzA.js";import{M as ie}from"./model-select-Bwhjt5Cl.js";import{M as Ue}from"./index-BMSQkwth.js";import{k as Se,G as pe,B as ve,M as fe,a as ke,F as re,v as Ne,u as je,I as ge,J as Fe,p as ye,ad as Z,H as Le,W as he,R as Oe,q as Te,a1 as Ae,O as De,z as Ee,e as Me,$ as Re,a0 as Be}from"./ui-antd-BKjlZQNA.js";import{U as Ge}from"./index-ClZszkte.js";const Qe={},Ve={class:"empty-box"};function He(H,j){return a(),u("div",Ve,[...j[0]||(j[0]=[t("img",{src:qe,alt:""},null,-1),t("div",{class:"title"},"暂无分段",-1),t("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)])])}const an=ee(Qe,[["render",He],["__scopeId","data-v-ba7325cb"]]),Je={class:"ai-generate-wrapper"},Ke={class:"ai-generate-wrapper-left"},We={class:"form-box-wrapper-options"},Xe={class:"form-item flex1"},Ye={class:"form-content"},Ze={class:"form-item flex1"},et={class:"form-content dual-inputs"},tt={class:"input-group"},st={class:"form-label-input-box"},nt={class:"form-item generate-btn-box"},ot={class:"result-nav"},lt={key:0,class:"tip"},at={key:1,class:"result-nav-text"},it={key:0,class:"container"},rt={class:"result-container"},dt=["innerHTML"],ut={class:"result-footer"},mt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(H,{expose:j,emit:Q}){const p=$e(),q=b(!1),c=b(!1),s=b(!1),r=b(!1),k=W({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),K=new Ue({html:!0,linkify:!0,typographer:!0}),M=b(""),$=W({content:""}),C=_e(()=>p.initDocumentFragmentList);se(()=>$.content,()=>{M.value=K.render($.content)});const F=Q;b("");const L=b(!1),O=()=>{c.value=!1,r.value=!1,L.value=!0},_=()=>{ke.success("操作成功"),c.value=!1,r.value=!1,L.value=!1,F("handleEdit",T.value)},T=b("");function g(z,d){let x="",w=0;for(const S of z){if(w>=d)break;const v=S.content.trim()||"",R=d-w;if(v.length<=R)x+=v,w+=v.length;else{x+=v.slice(0,R),w=d;break}}return x}const P=async()=>{$.content="",T.value="",s.value=!0,r.value=!0;try{const z=await g(C.value,k.count);let d={ai_prompt_model_config_id:k.model_config_id,ai_prompt_model:k.use_model,ai_prompt_question:z};const x=await Ie(d);T.value=x.data,$.content=`<div class="dialog-message">${x.data}</div>`,c.value=!0}finally{s.value=!1}};return j({showModal:O}),(z,d)=>{const x=Se,w=pe,S=de,v=ve,R=fe;return a(),u("div",null,[o(R,{open:L.value,"onUpdate:open":d[3]||(d[3]=B=>L.value=B),onOk:_,maskClosable:!1,width:r.value?"944px":"472px","ok-button-props":{style:{display:"none"}}},{title:l(()=>[...d[4]||(d[4]=[t("div",{class:"custom-modal-header"},[t("span",null,"AI生成提示词")],-1)])]),footer:l(()=>[...d[11]||(d[11]=[])]),default:l(()=>[t("div",Je,[t("div",{class:A(["form-box-wrapper ai-generate-wrapper-box",{"show-generate":r.value}])},[t("div",Ke,[o(x,{class:"alert-box",message:"根据导入的文档的内容生成AI分段的提示词，支持设置导入文档的字数。",type:"info"}),t("div",We,[t("div",Xe,[d[5]||(d[5]=t("div",{class:"form-label required"},"选择模型：",-1)),t("div",Ye,[o(ie,{modelType:"LLM",modeName:k.use_model,"onUpdate:modeName":d[0]||(d[0]=B=>k.use_model=B),modeId:k.model_config_id,"onUpdate:modeId":d[1]||(d[1]=B=>k.model_config_id=B)},null,8,["modeName","modeId"])])]),t("div",Ze,[t("div",et,[t("div",tt,[d[7]||(d[7]=t("div",{class:"form-label required"},"根据文档内容前：",-1)),t("div",st,[o(w,{value:k.count,"onUpdate:value":d[2]||(d[2]=B=>k.count=B),min:1,max:1e4,style:{width:"137px"}},null,8,["value"]),d[6]||(d[6]=i("个字，自动生成提示词 ",-1))])])])])]),t("div",nt,[o(v,{onClick:P,loading:s.value,class:"generate-btn"},{default:l(()=>[o(S,{name:"ai-generate-white",style:{"font-size":"16px"}}),d[8]||(d[8]=i(" 开始生成 ",-1))]),_:1},8,["loading"])])]),t("div",{class:A(["ai-generate-wrapper-right",{"show-result":r.value}])},[t("div",ot,[o(S,{name:"generate-icon",style:{"font-size":"14px"}}),s.value?(a(),u("span",lt,"提示词生成中...")):(a(),u("div",at,"提示词生成完毕"))]),!$.content&&s.value&&!q.value?(a(),u("div",it,[...d[9]||(d[9]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)])])):f("",!0),t("div",rt,[t("div",{class:"dialog-content",innerHTML:M.value},null,8,dt)]),t("div",ut,[o(v,{class:"result-footer-btn",disabled:T.value=="",type:"primary",onClick:_},{default:l(()=>[...d[10]||(d[10]=[i("使用该提示词",-1)])]),_:1},8,["disabled"])])],2)],2)])]),_:1},8,["open","width"])])}}},_t=ee(mt,[["__scopeId","data-v-580b566b"]]),ct={class:"segmentation-setting"},pt={class:"setting-items"},vt={class:"setting-item intelligent-setting active"},ft={class:"setting-item-body"},kt={key:0,class:"custom-setting-form excel-qa-form"},gt={class:"form-item"},yt={class:"form-item-box"},ht={class:"form-item-body"},bt={class:"form-item-box"},xt={class:"form-item-body"},wt={class:"form-item-box"},qt={class:"form-item-body"},$t={class:"indexing-methods-box"},It={class:"list-title-block"},Pt={class:"list-title-block"},Ct={class:"btn-box-block"},zt={key:1,class:"custom-setting-form excel-qa-form"},Ut={class:"form-item"},St={class:"form-item-box"},Nt={class:"form-item-body"},jt={class:"form-item-box"},Ft={class:"form-item-body"},Lt={class:"form-item-box"},Ot={class:"form-item-body"},Tt={class:"indexing-methods-box"},At={class:"list-title-block"},Dt={class:"list-title-block"},Et={class:"btn-box-block"},Mt={key:0,class:"custom-setting-form subsection-form"},Rt={class:"form-item"},Bt={key:0,class:"form-item-title"},Gt={class:"form-item-body"},Qt={class:"select-card-box"},Vt={class:"card-title"},Ht={class:"card-title"},Jt={class:"card-title"},Kt={class:"card-title"},Wt={class:"form-item",style:{"margin-bottom":"18px"}},Xt={class:"form-item-body"},Yt={class:"form-item"},Zt={class:"form-item-body"},es={class:"form-item"},ts={class:"form-item-body"},ss={class:"form-item"},ns={class:"form-item-body"},os={class:"form-item",style:{"margin-bottom":"16px"}},ls={class:"form-item-body"},as={class:"form-item",style:{"margin-bottom":"16px"}},is={class:"form-item-label"},rs={class:"form-item-body"},ds={class:"form-item"},us={class:"form-item-body"},ms={class:"form-item"},_s={class:"form-item-body"},cs={class:"form-item",style:{"margin-bottom":"16px"}},ps={class:"form-item-body"},vs={class:"form-item",style:{"margin-bottom":"16px"}},fs={class:"form-item-body"},ks={class:"form-item",style:{"margin-bottom":"16px"}},gs={class:"form-item-label"},ys={class:"form-item-body form-item-inptu-numbner-box"},hs={class:"form-item"},bs={class:"form-item-body"},xs={key:0,class:"form-item"},ws={class:"form-item-body"},qs={key:1,class:"form-item"},$s={class:"form-item-body"},Is={class:"form-item"},Ps={class:"form-item-body"},Cs={class:"form-item"},zs={class:"form-item-body"},Us={class:"btn-box-block"},Ss={class:"btn-box-block"},le="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Ns={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(H,{expose:j,emit:Q}){const p=re.useForm,q=Q,c=H;_e(()=>c.libFileInfo.doc_type=="1"&&(c.libFileInfo.file_ext=="docx"||c.libFileInfo.file_ext=="html")),se(c,m=>{let e=m.libFileInfo;s.separators_no=te(e.separators_no,[12,11]),s.chunk_size=+e.chunk_size||512,s.not_merged_text=e.not_merged_text=="true",s.ai_chunk_size=+e.ai_chunk_size||5e3,s.chunk_overlap=+e.chunk_overlap||50,s.question_lable=e.question_lable,s.similar_label=e.similar_label,s.answer_lable=e.answer_lable,s.question_column=e.question_column||void 0,s.answer_column=e.answer_column||void 0,s.similar_column=e.similar_column||void 0,s.qa_index_type=+e.qa_index_type,s.enable_extract_image=e.enable_extract_image=="true",s.chunk_type=+e.chunk_type,s.semantic_chunk_size=+e.semantic_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_threshold||90,s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.ai_chunk_prumpt=e.ai_chunk_prumpt||le,s.ai_chunk_model=e.ai_chunk_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:"",s.ai_chunk_model_config_id=e.ai_chunk_model_config_id>0?e.ai_chunk_model_config_id:"",s.father_chunk_paragraph_type=+e.father_chunk_paragraph_type||2,s.father_chunk_separators_no=te(e.father_chunk_separators_no,[12,11]),s.father_chunk_chunk_size=+e.father_chunk_chunk_size||1024,s.son_chunk_separators_no=te(e.son_chunk_separators_no,[8,10]),s.son_chunk_chunk_size=+e.son_chunk_chunk_size||512,setTimeout(()=>{s.semantic_chunk_use_model=e.semantic_chunk_use_model||"",s.semantic_chunk_model_config_id=e.semantic_chunk_model_config_id>0?e.semantic_chunk_model_config_id:""},200),e.chunk_type==0&&(s.separators_no=te(e.normal_chunk_default_separators_no,[12,11]),s.chunk_size=+e.normal_chunk_default_chunk_size||512,s.not_merged_text=e.normal_chunk_default_not_merged_text=="true",s.chunk_overlap=+e.normal_chunk_default_chunk_overlap||50,s.chunk_type=+e.default_chunk_type,s.semantic_chunk_size=+e.semantic_chunk_default_chunk_size||512,s.semantic_chunk_overlap=+e.semantic_chunk_default_chunk_overlap||50,s.semantic_chunk_threshold=+e.semantic_chunk_default_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=e.default_use_model,s.semantic_chunk_model_config_id=e.default_model_config_id>0?e.default_model_config_id:""},100)),s.is_qa_doc=c.library_type==2?1:0});const s=W({separators_no:[],not_merged_text:!1,chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:le,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512});let r={};setTimeout(()=>{r=JSON.parse(JSON.stringify(s))},500);const k=b([]),K=b(null),M=m=>{k.value=m,Ce(()=>{(!s.ai_chunk_model||!Number(s.ai_chunk_model_config_id))&&$()})},$=()=>{if(k.value.length>0){let m=null,e=null;for(let N of k.value)if(N.model_define==="tongyi"){m=N;for(let I of m.children)if(I.name==="qwen-max"){e=I;break}break}m||(m=k.value[0],e=m.children[0]),m&&e&&(s.ai_chunk_model=e.name,s.ai_chunk_model_config_id=e.model_config_id)}},C=()=>{Object.assign(s,r)},F=()=>{q("save")},L=W({question_lable:[{message:"请输入问题开始标识符",validator:async(m,e)=>s.is_qa_doc==1&&c.mode==0?e?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(m,e)=>s.is_qa_doc==0&&s.chunk_type==2?e?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(m,e)=>s.is_qa_doc==0&&s.chunk_type==3?e?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(m,e)=>s.is_qa_doc==1&&c.mode==0?e?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(m,e)=>c.mode!=1&&s.is_qa_doc==0&&e.length==0&&s.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(m,e)=>{if(c.mode!=1&&s.chunk_type==1)if(e){if(e>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(s.chunk_type==3&&!e)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(m,e)=>s.chunk_type==3&&!e?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(m,e)=>!s.ai_chunk_prumpt&&!e?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(m,e)=>c.mode!=1&&s.chunk_type==1&&e>parseInt(s.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(m,e)=>c.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(m,e)=>c.mode==1&&s.is_qa_doc==1?e?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:O,validate:_,validateInfos:T}=p(s,L),g=b(!1),P=b(!1),z=()=>{g.value=!0,s.chunk_type!=3&&(P.value=!0),d()},d=(m=!0)=>{let e=ce(s);_().then(()=>{q("change",{...e}),q("validate","")}).catch(N=>{const{errorFields:I}=N;if(I.length>0){m&&I[0].name,ke.error(I[0].errors[0]),q("validate",I[0].errors[0]),g.value=!1,P.value=!1;return}q("validate",""),q("change",{...e})})};let x=null;const w=()=>{x&&(clearTimeout(x),x=null),x=setTimeout(()=>{d()},500)},S=b([]);(()=>{Pe().then(m=>{S.value=m.data||[]})})();const R=m=>{m!=s.qa_index_type&&(s.qa_index_type=m,d())},B=m=>{s.ai_chunk_prumpt=m};return se(()=>s.chunk_type,m=>{q("changeChunkType",m)}),se(()=>g.value,m=>{}),j({formState:s,reLoading:g,saveLoading:P,reChange:z}),(m,e)=>{const N=Ne,I=je,y=de,X=ve,ne=ge,V=pe,G=Fe,Y=ye,be=Le,xe=he,ue=Oe,we=Te;return a(),u("div",ct,[t("div",pt,[t("div",vt,[t("div",ft,[f("",!0),s.is_qa_doc==1?(a(),u(U,{key:1},[e[54]||(e[54]=t("div",{class:"sub-setting-item-name"},"文件切分",-1)),c.mode==1?(a(),u("div",kt,[t("div",gt,[t("div",yt,[e[34]||(e[34]=t("div",{class:"form-item-label"},"问题所在列：",-1)),t("div",ht,[o(I,{value:s.question_column,"onUpdate:value":e[2]||(e[2]=n=>s.question_column=n),onChange:w,placeholder:"请选择列名",style:{width:"100%"}},{default:l(()=>[(a(!0),u(U,null,J(c.excellQaLists,n=>(a(),D(N,{value:n.value,key:n.value},{default:l(()=>[i(h(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",bt,[e[35]||(e[35]=t("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),t("div",xt,[o(I,{allowClear:"",value:s.similar_column,"onUpdate:value":e[3]||(e[3]=n=>s.similar_column=n),onChange:w,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:l(()=>[(a(!0),u(U,null,J(c.excellQaLists,n=>(a(),D(N,{value:n.value,key:n.value},{default:l(()=>[i(h(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",wt,[e[36]||(e[36]=t("div",{class:"form-item-label"},"答案所在列：",-1)),t("div",qt,[o(I,{value:s.answer_column,"onUpdate:value":e[4]||(e[4]=n=>s.answer_column=n),onChange:w,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:l(()=>[(a(!0),u(U,null,J(c.excellQaLists,n=>(a(),D(N,{value:n.value,key:n.value},{default:l(()=>[i(h(n.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),e[43]||(e[43]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",$t,[t("div",{class:A(["list-item",{active:s.qa_index_type==1}]),onClick:e[5]||(e[5]=n=>R(1))},[o(y,{class:"check-icon",name:"check-arrow-filled"}),t("div",It,[o(y,{name:"file-search"}),e[37]||(e[37]=i(" 问题与答案一起生成索引 ",-1))]),e[38]||(e[38]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:A(["list-item",{active:s.qa_index_type==2}]),onClick:e[6]||(e[6]=n=>R(2))},[o(y,{class:"check-icon",name:"check-arrow-filled"}),t("div",Pt,[o(y,{name:"comment-search"}),e[39]||(e[39]=i(" 仅对问题生成索引 ",-1))]),e[40]||(e[40]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[42]||(e[42]=t("div",{class:"btn-box-block"},null,-1)),t("div",Ct,[o(X,{type:"primary",block:"",onClick:F},{default:l(()=>[...e[41]||(e[41]=[i("保存",-1)])]),_:1})])])])):(a(),u("div",zt,[t("div",Ut,[t("div",St,[e[44]||(e[44]=t("div",{class:"form-item-label"},"问题开始标识符：",-1)),t("div",Nt,[o(ne,{placeholder:"请输入标识符",value:s.question_lable,"onUpdate:value":e[7]||(e[7]=n=>s.question_lable=n),onChange:w},null,8,["value"])])]),t("div",jt,[e[45]||(e[45]=t("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),t("div",Ft,[o(ne,{placeholder:"请输入标识符",value:s.similar_label,"onUpdate:value":e[8]||(e[8]=n=>s.similar_label=n),onChange:w},null,8,["value"])])]),t("div",Lt,[e[46]||(e[46]=t("div",{class:"form-item-label"},"答案开始标识符：",-1)),t("div",Ot,[o(ne,{placeholder:"请输入标识符",value:s.answer_lable,"onUpdate:value":e[9]||(e[9]=n=>s.answer_lable=n),onChange:w},null,8,["value"])])])]),e[53]||(e[53]=t("div",{class:"sub-setting-item-name"},"索引方式",-1)),t("div",Tt,[t("div",{class:A(["list-item",{active:s.qa_index_type==1}]),onClick:e[10]||(e[10]=n=>R(1))},[o(y,{class:"check-icon",name:"check-arrow-filled"}),t("div",At,[o(y,{name:"file-search"}),e[47]||(e[47]=i(" 问题与答案一起生成索引 ",-1))]),e[48]||(e[48]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),t("div",{class:A(["list-item",{active:s.qa_index_type==2}]),onClick:e[11]||(e[11]=n=>R(2))},[o(y,{class:"check-icon",name:"check-arrow-filled"}),t("div",Dt,[o(y,{name:"comment-search"}),e[49]||(e[49]=i(" 仅对问题生成索引 ",-1))]),e[50]||(e[50]=t("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2),e[52]||(e[52]=t("div",{class:"btn-box-block"},null,-1)),t("div",Et,[o(X,{type:"primary",block:"",onClick:F},{default:l(()=>[...e[51]||(e[51]=[i("保存",-1)])]),_:1})])])]))],64)):(a(),u(U,{key:2},[c.mode!=1?(a(),u("div",Mt,[t("div",Rt,[H.status==="paragraphsSegmented"?(a(),u("div",Bt,"分段及清洗规则")):f("",!0),e[64]||(e[64]=t("div",{class:"form-item-label"},"分段方式：",-1)),t("div",Gt,[e[63]||(e[63]=t("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),t("div",Qt,[t("div",{class:A(["select-card-item",{active:s.chunk_type==1}]),onClick:e[12]||(e[12]=n=>s.chunk_type=1)},[o(y,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Vt,[o(y,{name:"ordinary-segmentation",class:"title-icon"}),e[55]||(e[55]=i(" 普通分段 ",-1))]),e[56]||(e[56]=t("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),t("div",{class:A(["select-card-item",{active:s.chunk_type==2}]),onClick:e[13]||(e[13]=n=>s.chunk_type=2)},[o(y,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Ht,[o(y,{name:"semantic-segmentation",class:"title-icon"}),e[57]||(e[57]=i(" 语义分段 ",-1))]),e[58]||(e[58]=t("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),c.library_type==0?(a(),u("div",{key:0,class:A(["select-card-item",{active:s.chunk_type==4}]),onClick:e[14]||(e[14]=n=>s.chunk_type=4)},[o(y,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Jt,[o(y,{name:"semantic-segmentation",class:"title-icon"}),e[59]||(e[59]=i(" 父子分段 ",-1))]),e[60]||(e[60]=t("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2)):f("",!0),t("div",{class:A(["select-card-item",{active:s.chunk_type==3}]),onClick:e[15]||(e[15]=n=>s.chunk_type=3)},[o(y,{class:"check-arrow",name:"check-arrow-filled"}),t("div",Kt,[o(y,{name:"semantic-segmentation",class:"title-icon"}),e[61]||(e[61]=i(" AI分段 ",-1))]),e[62]||(e[62]=t("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])])]),s.chunk_type==1?(a(),u(U,{key:0},[t("div",Wt,[e[65]||(e[65]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",Xt,[o(I,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.separators_no,"onUpdate:value":e[16]||(e[16]=n=>s.separators_no=n)},{default:l(()=>[(a(!0),u(U,null,J(S.value,n=>(a(),D(N,{value:n.no,key:n.no},{default:l(()=>[i(h(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),o(G,{gap:16},{default:l(()=>[t("div",Yt,[e[67]||(e[67]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",Zt,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.chunk_size,"onUpdate:value":e[17]||(e[17]=n=>s.chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[66]||(e[66]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])]),t("div",es,[e[69]||(e[69]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",ts,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.chunk_overlap,"onUpdate:value":e[18]||(e[18]=n=>s.chunk_overlap=n),placeholder:"分段重叠长度",min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[68]||(e[68]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])])]),_:1}),t("div",ss,[t("div",ns,[o(G,{align:"center"},{default:l(()=>[t("div",null,[e[70]||(e[70]=i("自动合并较小分段 ",-1)),o(Y,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:l(()=>[o(E(Z))]),_:1}),e[71]||(e[71]=i(" ：",-1))]),o(be,{checkedValue:!1,unCheckedValue:!0,checked:s.not_merged_text,"onUpdate:checked":e[19]||(e[19]=n=>s.not_merged_text=n),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})])])],64)):f("",!0),ae(t("div",null,[t("div",os,[e[72]||(e[72]=t("div",{class:"form-item-label"},"嵌入模型：",-1)),t("div",ls,[o(ie,{modelType:"TEXT EMBEDDING",modeName:s.semantic_chunk_use_model,"onUpdate:modeName":e[20]||(e[20]=n=>s.semantic_chunk_use_model=n),modeId:s.semantic_chunk_model_config_id,"onUpdate:modeId":e[21]||(e[21]=n=>s.semantic_chunk_model_config_id=n),style:{width:"100%"},onLoaded:M},null,8,["modeName","modeId"])])]),t("div",as,[t("div",is,[e[74]||(e[74]=i(" 分段阈值 ",-1)),o(Y,null,{title:l(()=>[...e[73]||(e[73]=[i("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。",-1)])]),default:l(()=>[o(E(Z),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[75]||(e[75]=i("： ",-1))]),t("div",rs,[o(V,{style:{width:"100%"},value:s.semantic_chunk_threshold,"onUpdate:value":e[22]||(e[22]=n=>s.semantic_chunk_threshold=n),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),o(G,{gap:16},{default:l(()=>[t("div",ds,[e[77]||(e[77]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",us,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.semantic_chunk_size,"onUpdate:value":e[23]||(e[23]=n=>s.semantic_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[76]||(e[76]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])]),t("div",ms,[e[79]||(e[79]=t("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),t("div",_s,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.semantic_chunk_overlap,"onUpdate:value":e[24]||(e[24]=n=>s.semantic_chunk_overlap=n),placeholder:"分段重叠长度",min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[78]||(e[78]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])])]),_:1})],512),[[me,s.chunk_type==2]]),ae(t("div",null,[t("div",cs,[e[80]||(e[80]=t("div",{class:"form-item-label"},"AI大模型：",-1)),t("div",ps,[o(ie,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:s.ai_chunk_model,"onUpdate:modeName":e[25]||(e[25]=n=>s.ai_chunk_model=n),modeId:s.ai_chunk_model_config_id,"onUpdate:modeId":e[26]||(e[26]=n=>s.ai_chunk_model_config_id=n),style:{width:"100%"},onLoaded:M},null,8,["modeName","modeId"])])]),t("div",vs,[e[81]||(e[81]=t("div",{class:"form-item-label-box"},[t("div",{class:"form-item-label"},"提示词设置：")],-1)),t("div",fs,[o(xe,{maxLength:500,style:{height:"80px"},value:s.ai_chunk_prumpt,"onUpdate:value":e[27]||(e[27]=n=>s.ai_chunk_prumpt=n),placeholder:le},null,8,["value"])])]),t("div",ks,[t("div",gs,[e[83]||(e[83]=i(" 单次最大字符数 ",-1)),o(Y,null,{title:l(()=>[...e[82]||(e[82]=[i("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。",-1)])]),default:l(()=>[o(E(Z),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),e[84]||(e[84]=i("： ",-1))]),t("div",ys,[o(V,{class:"form-item-inptu-numbner",value:s.ai_chunk_size,"onUpdate:value":e[28]||(e[28]=n=>s.ai_chunk_size=n),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[85]||(e[85]=i(" 字符 ",-1))])])],512),[[me,s.chunk_type==3]]),s.chunk_type==4&&c.library_type==0?(a(),u(U,{key:1},[e[95]||(e[95]=t("div",{class:"main-title-block"},"父块（用作上下文）",-1)),t("div",hs,[e[88]||(e[88]=t("div",{class:"form-item-label"},"分段类型：",-1)),t("div",bs,[o(we,{value:s.father_chunk_paragraph_type,"onUpdate:value":e[29]||(e[29]=n=>s.father_chunk_paragraph_type=n)},{default:l(()=>[o(ue,{value:1},{default:l(()=>[e[86]||(e[86]=i("全文 ",-1)),o(Y,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:l(()=>[o(E(Z))]),_:1})]),_:1}),o(ue,{value:2},{default:l(()=>[e[87]||(e[87]=i("段落 ",-1)),o(Y,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:l(()=>[o(E(Z))]),_:1})]),_:1})]),_:1},8,["value"])])]),s.father_chunk_paragraph_type==2?(a(),u("div",xs,[e[89]||(e[89]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",ws,[o(I,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.father_chunk_separators_no,"onUpdate:value":e[30]||(e[30]=n=>s.father_chunk_separators_no=n)},{default:l(()=>[(a(!0),u(U,null,J(S.value,n=>(a(),D(N,{value:n.no,key:n.no},{default:l(()=>[i(h(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])):f("",!0),s.father_chunk_paragraph_type==2?(a(),u("div",qs,[e[91]||(e[91]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",$s,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.father_chunk_chunk_size,"onUpdate:value":e[31]||(e[31]=n=>s.father_chunk_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[90]||(e[90]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])])):f("",!0),e[96]||(e[96]=t("div",{class:"main-title-block"},"子块（用于检索）",-1)),t("div",Is,[e[92]||(e[92]=t("div",{class:"form-item-label"},"分段标识符：",-1)),t("div",Ps,[o(I,{placeholder:"请选择",style:{width:"100%"},mode:"tags",value:s.son_chunk_separators_no,"onUpdate:value":e[32]||(e[32]=n=>s.son_chunk_separators_no=n)},{default:l(()=>[(a(!0),u(U,null,J(S.value,n=>(a(),D(N,{value:n.no,key:n.no},{default:l(()=>[i(h(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),t("div",Cs,[e[94]||(e[94]=t("div",{class:"form-item-label"},"分段最大长度：",-1)),t("div",zs,[o(G,{align:"center",gap:8},{default:l(()=>[o(V,{style:{flex:"1"},value:s.son_chunk_chunk_size,"onUpdate:value":e[33]||(e[33]=n=>s.son_chunk_chunk_size=n),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:n=>parseInt(n),parser:n=>parseInt(n)},null,8,["value","formatter","parser"]),e[93]||(e[93]=t("span",{class:"unit-text"},"字符",-1))]),_:1})])])],64)):f("",!0),t("div",Us,[o(X,{onClick:C,style:{flex:"1"}},{default:l(()=>[...e[97]||(e[97]=[i("重置",-1)])]),_:1}),o(X,{onClick:z,loading:g.value,style:{flex:"1"},type:"primary",ghost:""},{default:l(()=>[...e[98]||(e[98]=[i("生成分段预览",-1)])]),_:1},8,["loading"])]),t("div",Ss,[c.hideSave?f("",!0):(a(),D(X,{key:0,type:"primary",block:"",disabled:P.value,onClick:F},{default:l(()=>[...e[99]||(e[99]=[i("保存",-1)])]),_:1},8,["disabled"]))])])):f("",!0)],64))])])]),o(_t,{ref_key:"aiGenerateRef",ref:K,onHandleEdit:B},null,512)])}}},rn=ee(Ns,[["__scopeId","data-v-87f08d7b"]]),js={class:"document-fragment"},Fs={class:"fragment-header"},Ls={class:"fragment-info"},Os={class:"fragment-number"},Ts={key:0},As={key:0,class:"fragment-title"},Ds={class:"fragment-content-lenght"},Es={key:1,class:"fragment-content-status"},Ms={class:"cfb363f"},Rs={class:"fragment-action"},Bs={class:"fragment-content"},Gs={key:0,class:"fragment-content"},Qs={key:1,class:"fragment-content"},Vs={key:2,class:"fragment-content"},Hs={class:"fragment-img"},Js=["src"],Ks={__name:"document-fragment",props:{number:{type:[Number,String]},father_chunk_paragraph_number:{type:[Number,String]},chunk_type:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}}},emits:["edit","delete"],setup(H,{emit:j}){const Q=j,p=H,q=()=>{Q("edit")},c=()=>{Q("delete")};return(s,r)=>{var $,C,F;const k=ye,K=Ee,M=ze("viewer");return a(),u("div",js,[t("div",Fs,[t("div",Ls,[t("span",Os,[r[0]||(r[0]=i("#",-1)),p.chunk_type==4?(a(),u("span",Ts,h(p.father_chunk_paragraph_number)+"-",1)):f("",!0),i(h(p.number),1)]),p.title?(a(),u("span",As,h(p.title),1)):f("",!0),t("span",Ds,"共"+h(p.total)+"个字符",1),p.status==="paragraphsSegmented"?(a(),u("span",Es,[i(h((($=p.currentData)==null?void 0:$.status_text)||"-"),1),((C=p.currentData)==null?void 0:C.status)==3?(a(),D(E(Ae),{key:0})):f("",!0),((F=p.currentData)==null?void 0:F.status)==2&&p.currentData.errmsg?(a(),D(k,{key:1,title:p.currentData.errmsg},{default:l(()=>[t("strong",Ms,[r[1]||(r[1]=i("原因",-1)),o(E(De),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):f("",!0)])):f("",!0)]),t("div",Rs,[t("a",{onClick:q},"编辑"),o(K,{type:"vertical"}),t("a",{onClick:c},"删除")])]),t("div",Bs,h(p.content),1),p.question?(a(),u("div",Gs,"Q："+h(p.question),1)):f("",!0),p.similar_question_list&&p.similar_question_list.join("")?(a(),u("div",Qs," 相似问法："+h(p.similar_question_list.join("/")),1)):f("",!0),p.answer?(a(),u("div",Vs,"A："+h(p.answer),1)):f("",!0),ae((a(),u("div",Hs,[(a(!0),u(U,null,J(p.images,(L,O)=>(a(),u("img",{key:O,src:L,alt:""},null,8,Js))),128))])),[[M]])])}}},dn=ee(Ks,[["__scopeId","data-v-2d2ad73f"]]),Ws={class:"upload-box-wrapper"},Xs={key:0},Ys={__name:"edit-fragment-alert",emits:["ok"],setup(H,{expose:j,emit:Q}){const p=Q,q=b("1"),c=re.useForm,s=b(!1),r=W({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),k=W({content:[{message:"请输入分段内容",validator:async(O,_)=>C.value||_?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(O,_)=>C.value?_?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(O,_)=>C.value?_?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:K,validate:M,validateInfos:$}=c(r,k),C=b(!1),F=({title:O,content:_,question:T,answer:g,images:P,similar_question_list:z})=>{r.title=O,r.content=_,r.question=T,r.answer=g,r.images=P||[],r.similar_question_list=z?z.join(`
`):"",C.value=T!="",s.value=!0},L=()=>{M().then(()=>{s.value=!1,p("ok",ce(r))})};return j({open:F}),(O,_)=>{const T=ge,g=Me,P=he,z=de,d=Be,x=Re,w=re,S=fe;return a(),u("div",null,[o(S,{open:s.value,"onUpdate:open":_[7]||(_[7]=v=>s.value=v),title:"编辑分段",onOk:L,width:"746px"},{default:l(()=>[o(w,{layout:"vertical"},{default:l(()=>[o(g,{label:"分段标题："},{default:l(()=>[o(T,{type:"text",placeholder:"请输入分段标题",value:r.title,"onUpdate:value":_[0]||(_[0]=v=>r.title=v)},null,8,["value"])]),_:1}),C.value?(a(),u(U,{key:0},[o(g,oe({label:"分段问题："},E($).question),{default:l(()=>[o(P,{placeholder:"请输入分段问题",value:r.question,"onUpdate:value":_[1]||(_[1]=v=>r.question=v),style:{height:"100px"}},null,8,["value"])]),_:1},16),o(g,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:l(()=>[o(P,{placeholder:"请输入相似问法",value:r.similar_question_list,"onUpdate:value":_[2]||(_[2]=v=>r.similar_question_list=v),style:{height:"100px"}},null,8,["value"])]),_:1}),o(g,oe({label:"分段答案："},E($).answer),{default:l(()=>[o(P,{placeholder:"请输入分段答案",value:r.answer,"onUpdate:value":_[3]||(_[3]=v=>r.answer=v),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(a(),D(g,oe({key:1,label:"分段内容："},E($).content),{default:l(()=>[o(P,{placeholder:"请输入分段内容",value:r.content,"onUpdate:value":_[4]||(_[4]=v=>r.content=v),style:{height:"150px"}},null,8,["value"])]),_:1},16)),o(g,{label:"附件"},{default:l(()=>[t("div",Ws,[o(x,{activeKey:q.value,"onUpdate:activeKey":_[5]||(_[5]=v=>q.value=v),size:"small"},{default:l(()=>[o(d,{key:"1"},{tab:l(()=>[t("span",null,[o(z,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),_[8]||(_[8]=i(" 图片 ",-1)),r.images.length?(a(),u("span",Xs,"("+h(r.images.length)+")",1)):f("",!0)])]),_:1})]),_:1},8,["activeKey"]),o(Ge,{value:r.images,"onUpdate:value":_[6]||(_[6]=v=>r.images=v)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},un=ee(Ys,[["__scopeId","data-v-50ea1591"]]);export{dn as D,un as E,rn as S,an as a};
