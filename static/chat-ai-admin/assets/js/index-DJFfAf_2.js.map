{"version":3,"file":"index-DJFfAf_2.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/public-library/components/side-menus.vue","../../../../front-end/chat-ai-admin-vue/src/views/public-library/components/upload-doc.vue","../../../../front-end/chat-ai-admin-vue/src/views/public-library/components/icon-template.vue","../../../../front-end/chat-ai-admin-vue/src/views/public-library/components/side-directory.vue","../../../../front-end/chat-ai-admin-vue/src/views/public-library/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.side-meuns {\r\n  .side-meun-item {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 9px 16px;\r\n    line-height: 22px;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n\r\n    .meun-item-body{\r\n      flex: 1;\r\n    }\r\n\r\n    .menu-icon {\r\n      font-size: 14px;\r\n      color: #a1a7b2;\r\n    }\r\n\r\n    .menu-name {\r\n      padding-left: 8px;\r\n      font-size: 14px;\r\n      color: rgb(89, 89, 89);\r\n    }\r\n\r\n    &.active {\r\n      background: #e5efff;\r\n\r\n      .menu-icon {\r\n        color: rgb(36, 117, 252);\r\n      }\r\n\r\n      .menu-name {\r\n        color: rgb(36, 117, 252);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"side-meuns\">\r\n    <template v-for=\"item in props.menus\" :key=\"item.key\">\r\n      <div\r\n        class=\"side-meun-item\"\r\n        :class=\"{ active: item.key === props.active }\"\r\n        @click=\"handdleMenu(item)\"\r\n        v-if=\"checkPermission(item.permissions)\"\r\n      >\r\n        <div class=\"meun-item-body\">\r\n          <svg-icon class=\"menu-icon\" :name=\"item.icon\"></svg-icon>\r\n          <span class=\"menu-name\">{{ item.name }}</span>\r\n        </div>\r\n\r\n        <div class=\"actions-box\">\r\n          \r\n        </div>\r\n      </div>\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { usePublicLibraryStore } from '@/stores/modules/public-library'\r\n\r\nconst emit = defineEmits(['menuClick'])\r\nconst libraryStore = usePublicLibraryStore()\r\n\r\nconst props = defineProps({\r\n  menus: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  active: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst { checkPermission } = libraryStore\r\n\r\nconst handdleMenu = (item) => {\r\n  emit('menuClick', item)\r\n}\r\n\r\n</script>\r\n","<style lang=\"less\" scoped></style>\r\n\r\n<template>\r\n  <input\r\n    type=\"file\"\r\n    style=\"opacity: 0; position: fixed; bottom: -9999px; left: -9999px\"\r\n    ref=\"fileInput\"\r\n    @change=\"handleFileUpload\"\r\n    accept=\".md\"\r\n  />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\n\r\nconst emit = defineEmits(['file-loaded'])\r\nconst fileInput = ref(null)\r\nlet params = {}\r\n\r\n// 暴露给父组件的触发方法\r\nconst triggerUpload = (data) => {\r\n  params = data || {}\r\n  fileInput.value.click() // 模拟点击隐藏的 input\r\n}\r\n\r\n// 文件上传处理\r\nconst handleFileUpload = (e) => {\r\n  const file = e.target.files[0]\r\n  if (!file) return\r\n\r\n  // 校验文件类型\r\n  if (!file.name.endsWith('.md')) {\r\n    alert('请选择.md文件')\r\n    return\r\n  }\r\n\r\n  const reader = new FileReader()\r\n  reader.onload = (e) => {\r\n    emit('file-loaded', {\r\n      content: e.target.result,\r\n      title: file.name,\r\n      file: file,\r\n      ...params\r\n    })\r\n  }\r\n\r\n  reader.readAsText(file)\r\n\r\n  // 清空选择以便重复上传相同文件\r\n  e.target.value = null\r\n}\r\n\r\ndefineExpose({ triggerUpload })\r\n</script>\r\n","<template>\r\n  <a-modal\r\n    v-model:open=\"visible\"\r\n    :title=\"t('title')\"\r\n    :width=\"760\"\r\n    @cancel=\"handleCancel\"\r\n    @ok=\"handleConfirm\"\r\n    :confirm-loading=\"saveLoading\"\r\n  >\r\n    <div class=\"icon-template-content\">\r\n      <!-- 模板选项 -->\r\n      <div class=\"template-options\">\r\n        <a-row :gutter=\"16\">\r\n          <!-- 模板1 -->\r\n          <a-col :span=\"8\" v-for=\"item in templateList\" :key=\"item.id\">\r\n            <div\r\n              class=\"template-card\"\r\n              :class=\"{ active: selectedTemplate == item.id }\"\r\n              \r\n            >\r\n              <div class=\"template-preview\" @click=\"selectTemplate(item.id)\">\r\n                <div class=\"folder-item\" :class=\"['level-' + demo.level]\" v-for=\"demo in item.preview\" :key=\"demo.level\">\r\n                  <span class=\"folder-icon\">{{ demo.icon }}</span>\r\n                  <span>{{ demo.text }}</span>\r\n                </div>\r\n              </div>\r\n              <div class=\"template-footer\">\r\n                <a-radio :checked=\"selectedTemplate == item.id\" @click=\"selectTemplate(item.id)\">\r\n                  <span class=\"template-name\">{{ item.name }}</span>\r\n                </a-radio>\r\n              </div>\r\n            </div>\r\n          </a-col>\r\n        </a-row>\r\n      </div>\r\n    </div>\r\n  </a-modal>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, computed, toRaw } from 'vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport {usePublicLibraryStore} from '@/stores/modules/public-library';\r\nimport { getIconTemplateList } from '../../../config/open-doc/icon-template';\r\n\r\nconst { t } = useI18n('views.public-library.components.icon-template')\r\n\r\nconst emit = defineEmits(['update:open', 'ok', 'cancel'])\r\nconst publicLibraryStore = usePublicLibraryStore()\r\nconst { saveEditLibrary } = publicLibraryStore;\r\n\r\nconst libraryInfo = computed(() => {\r\n  return publicLibraryStore.libraryInfo\r\n})\r\n\r\nconst visible = ref(false)\r\nconst saveLoading = ref(false)\r\nconst templateList = ref([])\r\n\r\nconst selectedTemplate = ref('1')\r\nconst open = () => {\r\n  selectedTemplate.value = libraryInfo.value.icon_template_config_id\r\n  visible.value = true;\r\n}\r\n// 选择模板\r\nconst selectTemplate = (templateId) => {\r\n  selectedTemplate.value = templateId\r\n}\r\n\r\n// 取消\r\nconst handleCancel = () => {\r\n  visible.value = false\r\n  emit('cancel')\r\n}\r\n\r\n// 确定\r\nconst handleConfirm = () => {\r\n  let data = toRaw(libraryInfo.value)\r\n\r\n  data.icon_template_config_id = selectedTemplate.value;\r\n\r\n  saveLoading.value = true;\r\n  saveEditLibrary(data).then(() => {\r\n    visible.value = false;\r\n  }).finally(() => {\r\n    saveLoading.value = false;\r\n\r\n    emit('ok', selectedTemplate.value)\r\n  })\r\n}\r\n\r\ndefineExpose({\r\n  open\r\n})\r\n\r\nonMounted(() => {\r\n  templateList.value = getIconTemplateList();\r\n})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.icon-template-content {\r\n  padding: 20px 0;\r\n}\r\n.template-card {\r\n  display: flex;\r\n  flex-direction: column;\r\n  \r\n\r\n  .template-preview {\r\n    position: relative;\r\n    flex: 1;\r\n    padding: 4px 16px;\r\n    border: 1px solid #D9D9D9;\r\n    border-radius: 8px;\r\n    cursor: pointer;\r\n    transition: all 0.3s ease;\r\n\r\n    &:hover {\r\n      border-color: #1890ff;\r\n    }\r\n  }\r\n\r\n  &.active {\r\n    .template-preview{\r\n      border-color: #1890ff;\r\n      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);\r\n    }\r\n\r\n    /* 编辑角标样式 */\r\n    .template-preview::after {\r\n      content: '';\r\n      position: absolute;\r\n      bottom: -2px;\r\n      right: -2px;\r\n      width: 32px;\r\n      height: 32px;\r\n      background: url('../../../assets/svg/check-arrow-filled.svg') 0 0 no-repeat;\r\n    }\r\n  }\r\n\r\n  .folder-item {\r\n    display: flex;\r\n    align-items: center;\r\n    line-height: 22px;\r\n    padding: 5px 0;\r\n    margin-bottom: 4px;\r\n    font-size: 14px;\r\n\r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n\r\n  .folder-item.level-0 {\r\n    margin-left: 0;\r\n  }\r\n\r\n  .folder-item.level-1 {\r\n    margin-left: 16px;\r\n  }\r\n\r\n  .folder-item.level-2 {\r\n    margin-left: 32px;\r\n  }\r\n\r\n  .folder-item.level-3 {\r\n    margin-left: 48px;\r\n  }\r\n\r\n  .folder-icon {\r\n    margin-right: 4px;\r\n    font-size: 16px;\r\n  }\r\n\r\n  .folder-icon.blue {\r\n    color: #1890ff;\r\n  }\r\n\r\n  .folder-icon.yellow {\r\n    color: #faad14;\r\n  }\r\n\r\n  .folder-icon.red {\r\n    color: #ff4d4f;\r\n  }\r\n\r\n  .folder-icon.gray {\r\n    color: #8c8c8c;\r\n  }\r\n\r\n  .template-footer {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-top: 16px;\r\n    border-top: 1px solid #f0f0f0;\r\n  }\r\n\r\n  .template-name {\r\n    font-size: 14px;\r\n    color: #666;\r\n  }\r\n\r\n  .modal-footer {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    gap: 8px;\r\n  }\r\n}\r\n</style>\r\n","<style lang=\"less\" scoped>\r\n.side-directory {\r\n  display: flex;\r\n  flex-flow: column nowrap;\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: hidden;\r\n\r\n  .directory-header {\r\n    display: flex;\r\n    align-items: center;\r\n    flex-wrap: nowrap;\r\n    width: 100%;\r\n    overflow: hidden;\r\n    height: 40px;\r\n    padding: 0 8px 0 16px;\r\n\r\n    .label-text {\r\n      flex: 1;\r\n      white-space: nowrap;\r\n      padding-left: 8px;\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      overflow: hidden;\r\n      color: #595959;\r\n    }\r\n\r\n    .action-box {\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      .action-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        width: 24px;\r\n        height: 24px;\r\n        margin-left: 4px;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n\r\n        &:hover {\r\n          background-color: #e4e6eb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.directory-body {\r\n  flex: 1;\r\n  width: 100%;\r\n  overflow: hidden;\r\n  overflow-y: auto;\r\n\r\n  /* 自定义滚动条样式 */\r\n  &::-webkit-scrollbar {\r\n    width: 6px;\r\n  }\r\n\r\n  &::-webkit-scrollbar-track {\r\n    background: transparent;\r\n    border-radius: 3px;\r\n  }\r\n\r\n  &::-webkit-scrollbar-thumb {\r\n    background: #d9d9d9;\r\n    border-radius: 3px;\r\n    transition: background 0.2s;\r\n\r\n    &:hover {\r\n      background: #bfbfbf;\r\n    }\r\n  }\r\n\r\n  &::-webkit-scrollbar-thumb:active {\r\n    background: #999999;\r\n  }\r\n}\r\n\r\n.directory-content {\r\n  width: 100%;\r\n  margin-top: 7px;\r\n  padding: 0 8px;\r\n\r\n  .toggle-btn {\r\n    opacity: 1;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .action-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 24px;\r\n    height: 24px;\r\n    line-height: 24px;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    font-size: 16px;\r\n    color: #595959;\r\n\r\n    &:hover {\r\n      background-color: #e4e6eb;\r\n    }\r\n  }\r\n\r\n  ::v-deep(.ant-tree-treenode) {\r\n    align-items: center;\r\n    padding: 0 8px 0 8px;\r\n    margin-bottom: 4px;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n\r\n    &:hover {\r\n      background: #f2f4f7;\r\n    }\r\n\r\n    &.ant-tree-treenode-selected {\r\n      background: #e6efff;\r\n    }\r\n\r\n    .ant-tree-node-content-wrapper {\r\n      position: relative;\r\n      padding: 0;\r\n      min-height: 32px;\r\n      height: 32px;\r\n      flex: 1 !important;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      &:hover {\r\n        background: none;\r\n      }\r\n\r\n      .ant-tree-title {\r\n        display: block;\r\n        position: relative;\r\n        height: 100%;\r\n        width: 100%;\r\n        overflow: hidden;\r\n      }\r\n    }\r\n\r\n    .ant-tree-switcher {\r\n      width: 24px;\r\n      height: 24px;\r\n      line-height: 24px;\r\n      margin-right: 0;\r\n      align-self: unset;\r\n    }\r\n\r\n    .ant-tree-node-selected {\r\n      background: none;\r\n\r\n      .doc-item {\r\n\r\n        .doc-title,\r\n        .doc-icon {\r\n          color: #2475fc;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .doc-item {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    display: flex;\r\n    align-items: center;\r\n    width: 100%;\r\n    overflow: hidden;\r\n    box-sizing: border-box;\r\n\r\n    .doc-icon {\r\n      margin-right: 4px;\r\n      font-size: 16px;\r\n      color: #595959;\r\n    }\r\n\r\n    .doc-title {\r\n      flex: 1;\r\n      height: 32px;\r\n      line-height: 32px;\r\n      padding-right: 4px;\r\n      font-size: 14px;\r\n      color: #595959;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n\r\n      .title-text {\r\n        padding-left: 4px;\r\n      }\r\n    }\r\n\r\n    .doc-action-box {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      opacity: 0;\r\n      display: flex;\r\n      align-items: center;\r\n      height: 32px;\r\n      transition: all 0.2s;\r\n\r\n      .menu-name {\r\n        color: #595959;\r\n      }\r\n    }\r\n\r\n    .action-btn {\r\n      opacity: 1;\r\n    }\r\n\r\n    &:hover.no-edit {\r\n      padding-right: 48px;\r\n\r\n      .doc-action-box {\r\n        opacity: 1 !important;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"side-directory\">\r\n    <div class=\"directory-header\">\r\n      <svg-icon name=\"doc-directory\" style=\"font-size: 16px; color: #595959\"></svg-icon>\r\n      <div class=\"label-text\">{{ t('document_directory') }}</div>\r\n      <div class=\"action-box\">\r\n        <a-dropdown>\r\n          <template #overlay>\r\n            <a-menu>\r\n              <a-menu-item key=\"addDir\" @click=\"addDoc(null, 0)\">{{ t('add_document') }}</a-menu-item>\r\n              <a-menu-item key=\"importDoc\" @click=\"importDoc()\">{{ t('import_document') }}</a-menu-item>\r\n              <a-menu-item key=\"addDoc\" @click=\"addDoc(null, 1)\">{{ t('add_folder') }}</a-menu-item>\r\n            </a-menu>\r\n          </template>\r\n          <span class=\"action-btn\">\r\n            <PlusOutlined style=\"color: #595959\" />\r\n          </span>\r\n        </a-dropdown>\r\n\r\n        <a-tooltip>\r\n          <template #title>{{ t('collapse_all') }}</template>\r\n          <span class=\"action-btn\" @click=\"toggleExpandAll(false)\">\r\n            <svg-icon name=\"menu-expand\" style=\"font-size: 16px; color: #595959\"></svg-icon>\r\n          </span>\r\n        </a-tooltip>\r\n\r\n        <a-tooltip>\r\n          <template #title>{{ t('icon_template_settings') }}</template>\r\n          <span class=\"action-btn\" @click=\"openIconTemplate\">\r\n            <svg-icon name=\"system-setting\" style=\"font-size: 16px; color: #595959\"></svg-icon>\r\n          </span>\r\n        </a-tooltip>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"directory-body\">\r\n      <div class=\"directory-content\">\r\n        <a-tree class=\"directory-tree\" block-node v-model:expandedKeys=\"expandedKeys\" :draggable=\"draggable\" :selected-keys=\"selectedKeys\"\r\n          :loadedKeys=\"loadedKeys\" :tree-data=\"props.list\" :load-data=\"loadData\"\r\n          :field-names=\"{ key: 'id', title: 'title', children: 'children' }\" :allowDrop=\"allowDrop\"\r\n          @dragenter=\"onDragEnter\" @drop=\"onDrop\" @select=\"onSelect\">\r\n          <template #switcherIcon=\"{ switcherCls }\">\r\n            <div style=\"margin-right: 4px\">\r\n              <span class=\"action-btn toggle-btn\">\r\n                <CaretDownOutlined style=\"font-size: 12px\" :class=\"switcherCls\" />\r\n              </span>\r\n            </div>\r\n          </template>\r\n          <template #title=\"treeNode\">\r\n            <div class=\"doc-item\" :data-level=\"treeNode.level\"\r\n              :class=\"[{ 'is-leaf': treeNode.dataRef.isLeaf }, treeNode.dataRef.isEdit ? 'is-edit' : 'no-edit']\">\r\n              <span class=\"doc-icon\" v-if=\"treeNode.data.doc_icon\">{{ treeNode.data.doc_icon }}</span>\r\n              <span class=\"doc-icon\" v-else>{{ treeNode.data.is_dir == 1 ?\r\n                iconTemplateConfig.levels[treeNode.level].folder_icon :\r\n                iconTemplateConfig.levels[treeNode.level].doc_icon }}</span>\r\n\r\n              <div class=\"doc-title\">\r\n                <span class=\"doc-title-text\" v-if=\"!treeNode.dataRef.isEdit\">{{ treeNode.dataRef.title }}</span>\r\n                <a-input :class=\"[`rename-input-${treeNode.dataRef.id}`]\" name=\"rename\"\r\n                  :defaultValue=\"treeNode.dataRef.title\" :placeholder=\"t('please_enter_title')\" @blur=\"saveName(treeNode)\"\r\n                  @pressEnter=\"saveName(treeNode)\" v-else />\r\n              </div>\r\n\r\n              <div class=\"doc-action-box\" v-if=\"!treeNode.dataRef.isEdit\">\r\n                <!-- action1 -->\r\n                <a-dropdown v-if=\"treeNode.dataRef.is_dir == 1\">\r\n                  <template #overlay>\r\n                    <a-menu>\r\n                      <a-menu-item key=\"addDir\" @click.stop.prevent=\"addDoc(treeNode, 0)\">\r\n                        <span class=\"menu-name\">{{ t('add_document') }}</span>\r\n                      </a-menu-item>\r\n                      <a-menu-item key=\"importDoc\" @click.stop.prevent=\"importDoc(treeNode)\">\r\n                        <span class=\"menu-name\">{{ t('import_document') }}</span>\r\n                      </a-menu-item>\r\n                      <a-menu-item key=\"addDoc\" @click.stop.prevent=\"addDoc(treeNode, 1)\">\r\n                        <span class=\"menu-name\">{{ t('add_folder') }}</span>\r\n                      </a-menu-item>\r\n                    </a-menu>\r\n                  </template>\r\n                  <span class=\"action-btn\" @click.stop=\"\">\r\n                    <PlusOutlined />\r\n                  </span>\r\n                </a-dropdown>\r\n                <!-- action2 -->\r\n                <a-dropdown>\r\n                  <template #overlay>\r\n                    <a-menu>\r\n                      <template v-if=\"treeNode.dataRef.is_dir == 1\">\r\n                        <a-menu-item key=\"rename\" @click.stop.prevent=\"handleRenameDoc(treeNode)\">\r\n                          <span class=\"menu-name\">{{ t('rename') }}</span>\r\n                        </a-menu-item>\r\n                        <a-menu-item key=\"deleteDoc\" @click.stop.prevent=\"handleDeleteDoc(treeNode)\">\r\n                          <span class=\"menu-name\">{{ t('delete') }}</span>\r\n                        </a-menu-item>\r\n                      </template>\r\n                      <template v-else>\r\n                        <a-menu-item key=\"copyLink\" @click.stop.prevent=\"handleCopyLink(treeNode)\">\r\n                          {{ t('copy_link') }}<span class=\"menu-name\"></span>\r\n                        </a-menu-item>\r\n                        <a-menu-item key=\"copyDoc\" @click.stop.prevent=\"handleCopyDoc(treeNode)\">\r\n                          <span class=\"menu-name\">{{ t('copy_document') }}</span>\r\n                        </a-menu-item>\r\n                        <a-menu-item key=\"exportDoc\" @click.stop.prevent=\"handleExportDoc(treeNode)\">\r\n                          <span class=\"menu-name\">{{ t('export_document') }}</span>\r\n                        </a-menu-item>\r\n                        <a-menu-item key=\"deleteDoc\" @click.stop.prevent=\"handleDeleteDoc(treeNode)\">\r\n                          <span class=\"menu-name\">{{ t('delete_document') }}</span>\r\n                        </a-menu-item>\r\n                      </template>\r\n                    </a-menu>\r\n                  </template>\r\n                  <span class=\"action-btn\" @click.stop=\"\">\r\n                    <MoreOutlined />\r\n                  </span>\r\n                </a-dropdown>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </a-tree>\r\n      </div>\r\n    </div>\r\n\r\n    <UploadDoc ref=\"uploadDocRef\" @file-loaded=\"handleFileLoaded\" />\r\n    <IconTemplate ref=\"iconTemplateRef\" @select=\"selectTemplate\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, nextTick } from 'vue'\r\nimport { PlusOutlined, CaretDownOutlined, MoreOutlined } from '@ant-design/icons-vue'\r\nimport UploadDoc from './upload-doc.vue'\r\nimport IconTemplate from './icon-template.vue'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\n\r\nconst { t } = useI18n('views.public-library.components.side-directory')\r\n\r\nconst emit = defineEmits([\r\n  'addDoc',\r\n  'importDoc',\r\n  'copyLink',\r\n  'copyDoc',\r\n  'deleteDoc',\r\n  'exportDoc',\r\n  'dragenter',\r\n  'drop',\r\n  'select',\r\n  'renameDoc',\r\n  'saveName',\r\n])\r\n\r\nconst props = defineProps({\r\n  list: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  loadData: {\r\n    type: Function,\r\n    default: () => { }\r\n  },\r\n  selectedKeys: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  iconTemplateConfig: {\r\n    type: Object,\r\n    default: () => ({})\r\n  },\r\n  draggable: {\r\n    type: Boolean,\r\n    default: true\r\n  }\r\n})\r\n\r\nconst debounce = (fn, delay) => {\r\n  let timer = null\r\n  return function (...args) {\r\n    if (timer) {\r\n      clearTimeout(timer)\r\n    }\r\n    timer = setTimeout(() => {\r\n      fn.apply(this, args)\r\n    }, delay)\r\n  }\r\n}\r\n\r\nconst expandedKeys = ref([])\r\nconst loadedKeys = ref([])\r\n\r\nconst addLoadedKey = (key) => {\r\n  if (!loadedKeys.value.includes(key)) {\r\n    loadedKeys.value.push(key)\r\n  }\r\n}\r\n\r\nconst toggleExpand = (key, type) => {\r\n  const index = expandedKeys.value.indexOf(key)\r\n\r\n  if (typeof type === 'boolean') {\r\n    if (index > -1 && type === false) {\r\n      expandedKeys.value.splice(index, 1)\r\n    } else {\r\n      expandedKeys.value.push(key)\r\n    }\r\n  } else {\r\n    if (index > -1) {\r\n      expandedKeys.value.splice(index, 1)\r\n    } else {\r\n      expandedKeys.value.push(key)\r\n    }\r\n  }\r\n}\r\n\r\nconst toggleExpandAll = (type) => {\r\n  if (type === true) {\r\n    props.list.forEach((item) => {\r\n      if (!item.isLeaf && !expandedKeys.value.includes(item.key)) {\r\n        expandedKeys.value.push(item.key)\r\n      }\r\n    })\r\n  } else {\r\n    expandedKeys.value = []\r\n  }\r\n}\r\n\r\nconst uploadDocRef = ref(null)\r\n\r\nconst addDoc = (node, isDir) => {\r\n  emit('addDoc', node, isDir)\r\n}\r\n\r\nlet currentNode = null\r\n\r\nconst importDoc = (node) => {\r\n  currentNode = node\r\n  uploadDocRef.value.triggerUpload()\r\n}\r\n\r\nconst iconTemplateRef = ref(null)\r\nconst openIconTemplate = () => {\r\n  iconTemplateRef.value.open()\r\n}\r\n\r\nconst selectTemplate = (templateId) => {\r\n  emit('selectTemplate', templateId)\r\n}\r\n\r\nconst handleFileLoaded = (doc) => {\r\n  emit('importDoc', currentNode, doc)\r\n}\r\n\r\nconst handleCopyLink = (node) => {\r\n  emit('copyLink', node)\r\n}\r\n\r\nconst handleCopyDoc = (node) => {\r\n  emit('copyDoc', node)\r\n}\r\n\r\nconst handleExportDoc = (node) => {\r\n  emit('exportDoc', node)\r\n}\r\n\r\nconst handleRenameDoc = (node) => {\r\n  emit('renameDoc', node)\r\n\r\n  nextTick(() => {\r\n    let el = document.querySelector('.rename-input-' + node.data.id);\r\n\r\n    if (el) {\r\n      el.focus()\r\n      el.select()\r\n    }\r\n  })\r\n}\r\n\r\nconst saveName = debounce((node) => {\r\n  let el = document.querySelector('.rename-input-' + node.data.id);\r\n  if (!el) return\r\n  let value = el.value.trim()\r\n\r\n  emit('saveName', node, value)\r\n}, 200)\r\n\r\nconst handleDeleteDoc = (node) => {\r\n  emit('deleteDoc', node)\r\n}\r\n\r\nconst allowDrop = ({ dropNode, dragNode, dropPosition }) => {\r\n  // console.log({ dropNode, dragNode, dropPosition })\r\n  if((dropNode.is_dir == 0 && dragNode.is_dir == 0) && dropPosition == 0){\r\n    return false;\r\n  } else if((dropNode.is_dir == 0 && dragNode.is_dir == 1)  && dropPosition == 0){\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nconst onDragEnter = (info) => {\r\n  emit('dragenter', info)\r\n}\r\n\r\nconst onDrop = (info) => {\r\n  emit('drop', info)\r\n}\r\n\r\nconst onSelect = (selectedKeys, e) => {\r\n  emit('select', e.node.dataRef)\r\n}\r\n\r\ndefineExpose({\r\n  toggleExpand,\r\n  addLoadedKey\r\n})\r\n</script>\r\n","<style lang=\"less\" scoped>\r\n.public-library-layout {\r\n  position: relative;\r\n  display: flex;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  border-radius: 2px;\r\n  background-color: #fff;\r\n  .layout-left-wrapper{\r\n    position: relative;\r\n    height: 100%;\r\n\r\n    .sidebar-toggle-btn {\r\n      position: absolute;\r\n      top: 16px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      height: 32px;\r\n      width: 16px;\r\n      z-index: 100;\r\n      border-radius: 0 8px 8px 0;\r\n      background: #EDEFF2;\r\n      cursor: pointer;\r\n      transition: background 0.2s;\r\n\r\n      .toggle-icon {\r\n        font-size: 16px;\r\n        color: #7A8699;\r\n        transform: rotate(180deg);\r\n      }\r\n\r\n      &:hover {\r\n        background: #A1A7B3;\r\n\r\n        .toggle-icon{\r\n          color: #333; \r\n        }\r\n      }\r\n\r\n      &.is-open{\r\n        .toggle-icon{\r\n          transform: rotate(0);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .layout-left {\r\n    height: 100%;\r\n    overflow: hidden;\r\n\r\n    .layout-left-content{\r\n      display: flex;\r\n      flex-flow: column nowrap;\r\n      height: 100%;\r\n      padding: 12px 8px;\r\n      border-right: 1px solid #D9D9D9;\r\n    }\r\n  }\r\n\r\n  .layout-body {\r\n    flex: 1;\r\n    height: 100%;\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n  }\r\n\r\n  .side-directory-wrapper {\r\n    flex: 1;\r\n    margin-top: 12px;\r\n    overflow: hidden;\r\n    border-top: 1px solid #f0f0f0;\r\n  }\r\n}\r\n.no-doc {\r\n  width: 100;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.drag-line{\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 5px;\r\n  margin-left: -2px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 10;\r\n\r\n  &:hover, &.dragging {\r\n     &::after{\r\n      width: 2px;\r\n      background: #1890ff;\r\n     }\r\n  }\r\n  &::after{\r\n    display: block;\r\n    content: '';\r\n    width: 1px;\r\n    height: 100%;\r\n    background: none;\r\n    cursor: col-resize;\r\n    transition: background-color 0.2s;\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"public-library-layout\">\r\n    <div \r\n      v-show=\"!isSidebarCollapsed\"\r\n      class=\"drag-line\" \r\n      :class=\"{ 'dragging': isDragging }\" \r\n      :style=\"{ left: `${leftWidth}px` }\" \r\n      @mousedown=\"handleMouseDown\"\r\n    ></div>\r\n    <div class=\"layout-left-wrapper\">\r\n      <span class=\"sidebar-toggle-btn\" :class=\"{'is-open': !isSidebarCollapsed}\" :style=\"{left: `${isSidebarCollapsed ? collapsedWidth : leftWidth}px`}\" @click=\"toggleSidebar\">\r\n        <svg-icon name=\"arrow-left\" class=\"toggle-icon\"></svg-icon>\r\n      </span>\r\n      <div class=\"layout-left\" :style=\"{ width: `${isSidebarCollapsed ? collapsedWidth : leftWidth}px` }\">\r\n        <div class=\"layout-left-content\">\r\n          <SideMenus :menus=\"menus\" :active=\"activeMenuKey\" @menu-click=\"handleMeunClick\" @handleAction=\"handleMeunAction\"  v-if=\"!isSidebarCollapsed\" />\r\n\r\n          <div class=\"side-directory-wrapper\" v-if=\"!isSidebarCollapsed\">\r\n            <SideDirectory\r\n              ref=\"docTreeRef\"\r\n              :list=\"docList\"\r\n              :load-data=\"loadDocList\"\r\n              :draggable=\"docListDraggable\"\r\n              :selectedKeys=\"selectedKeys\"\r\n              :iconTemplateConfig=\"iconTemplateConfig\"\r\n              @importDoc=\"onImportDoc\"\r\n              @addDoc=\"onAddDoc\"\r\n              @renameDoc=\"onRenameDoc\"\r\n              @saveName=\"onSaveName\"\r\n              @deleteDoc=\"onDeleteDoc\"\r\n              @copyDoc=\"onCopyDoc\"\r\n              @copyLink=\"onShareDoc\"\r\n              @exportDoc=\"onExportDoc\"\r\n              @dragenter=\"onDragEnter\"\r\n              @drop=\"onDrop\"\r\n              @select=\"onSelectDoc\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"layout-body\">\r\n      <router-view @changeDoc=\"onChangeDoc\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { OPEN_BOC_BASE_URL } from '@/constants/index'\r\nimport { saveAs } from 'file-saver'\r\nimport { ref, computed, watch, onMounted, createVNode, nextTick, provide } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { message, Modal } from 'ant-design-vue'\r\nimport { usePublicLibraryStore } from '@/stores/modules/public-library'\r\nimport { useCopyShareUrl } from '@/hooks/web/useCopyShareUrl'\r\nimport { useStorage } from '@/hooks/web/useStorage'\r\nimport { useI18n } from '@/hooks/web/useI18n'\r\nimport { ExclamationCircleOutlined } from '@ant-design/icons-vue'\r\nimport {\r\n  saveDraftLibDoc,\r\n  getDocList,\r\n  deleteLibDoc,\r\n  getLibDocInfo,\r\n  updateDocSort,\r\n  saveLibDoc,\r\n} from '@/api/public-library'\r\nimport SideMenus from './components/side-menus.vue'\r\nimport SideDirectory from './components/side-directory.vue'\r\n\r\nconst { t } = useI18n('views.public-library.index')\r\n\r\nconst exportMd = (content, filename) => {\r\n  const blob = new Blob([content], {\r\n    type: 'text/markdown;charset=utf-8'\r\n  })\r\n  saveAs(blob, filename)\r\n}\r\n\r\n// 树形数据查找方法\r\nconst findDocInTree = (tree, targetId) => {\r\n  {\r\n    for (let i = 0; i < tree.length; i++) {\r\n      {\r\n        const node = tree[i]\r\n        if (node.id == targetId) return node\r\n        if (node.children) {\r\n          {\r\n            const found = findDocInTree(node.children, targetId)\r\n            if (found) return found\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null\r\n  }\r\n}\r\n\r\n// 查找父级节点\r\nconst findParentDocInTree = (data, targetId, parent = null) => {\r\n  for (let i = 0; i < data.length; i++) {\r\n    const item = data[i]\r\n    if (item.id == targetId) {\r\n      return parent\r\n    }\r\n    if (item.children) {\r\n      const found = findParentDocInTree(item.children, targetId, item)\r\n      if (found) return found\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nfunction createDocName(baseName = t('untitled_document'), fileList = []) {\r\n  // 提取所有已存在的文件名（兼容带扩展名的情况）\r\n  const existingNames = new Set(fileList.map((file) => file.title))\r\n\r\n  let counter = 1\r\n  let fileName = `${baseName}(${counter})`\r\n\r\n  // 动态递增检测（支持无扩展名场景）\r\n  while (existingNames.has(fileName)) {\r\n    counter++\r\n    fileName = `${baseName}(${counter})`\r\n  }\r\n\r\n  return fileName\r\n}\r\nconst libraryStore = usePublicLibraryStore()\r\nconst router = useRouter()\r\nconst route = useRoute()\r\n\r\nconst libraryId = computed(() => libraryStore.library_id)\r\nconst libraryKey = computed(() => libraryStore.library_key)\r\nconst iconTemplateConfig = computed(() => libraryStore.iconTemplateConfig)\r\n\r\nconst docId = computed(() => route.query.doc_id)\r\nconst docTreeRef = ref(null)\r\nconst docList = ref([])\r\nconst docListDraggable = ref(true)\r\nconst selectedKeys = ref([])\r\nconst currentDoc = ref(null)\r\nconst activeMenuKey = computed(() => route.meta.subActiveMenu || '')\r\n\r\n// 拖拽相关状态\r\nconst { setStorage, getStorage } = useStorage('localStorage')\r\nconst SIDEBAR_WIDTH_KEY = 'public-library-sidebar-width'\r\nconst SIDEBAR_COLLAPSED_KEY = 'public-library-sidebar-collapsed'\r\nconst leftWidth = ref(getStorage(SIDEBAR_WIDTH_KEY) || 256)\r\nconst isSidebarCollapsed = ref(getStorage(SIDEBAR_COLLAPSED_KEY) || false)\r\nconst collapsedWidth = 0 // 收起时的宽度\r\n\r\nconst startX = ref(0)\r\nconst startWidth = ref(0)\r\nconst isDragging = ref(false)\r\n\r\n// 将isDragging发送给子组件\r\nprovide('isDragging', isDragging)\r\n\r\nconst menus = [\r\n  // {\r\n  //   name: '知识库配置',\r\n  //   key: 'config',\r\n  //   icon: 'jichupeizhi',\r\n  //   path: '/public-library/config',\r\n  //   permissions: ['4']\r\n  // },\r\n  {\r\n    name: t('home'),\r\n    key: 'home',\r\n    icon: 'ai',\r\n    path: '/public-library/home',\r\n    permissions: ['*']\r\n  }\r\n]\r\n\r\nconst handleMeunClick = (menu) => {\r\n  router.push({\r\n    path: menu.path,\r\n    query: {\r\n      library_id: libraryId.value,\r\n      library_key: libraryKey.value\r\n    }\r\n  })\r\n}\r\n\r\nconst handleMeunAction = (key, item) => {\r\n  if(key === 'homePreviewStyle'){\r\n    changeHomePreviewStyle(item)\r\n  }\r\n}\r\n\r\nconst changeHomePreviewStyle = (item) => {\r\n  libraryStore.changeHomePreviewStyle()\r\n\r\n  if(route.path !== '/public-library/home'){\r\n    handleMeunClick(item)\r\n  }\r\n}\r\n\r\nconst getMyDocList = (doc) => {\r\n  let data = {\r\n    library_key: libraryKey.value,\r\n    pid: doc ? doc.id : 0\r\n  }\r\n\r\n  return getDocList(data).then((res) => {\r\n    let list = res.data || []\r\n    list.forEach((item) => {\r\n      item.id = item.id * 1\r\n      item.pid = item.pid * 1\r\n      item.key = item.id\r\n      item.level = doc ? doc.level + 1 : 0\r\n      item.sort = item.sort * 1\r\n      item.children_num = item.children_num * 1\r\n      item.children = []\r\n      item.hasLoaded = false\r\n      item.isLeaf = item.children_num == 0\r\n    })\r\n\r\n    if (!doc) {\r\n      docList.value = list\r\n    } else {\r\n      doc.hasLoaded = true\r\n      doc.children = list\r\n\r\n      docList.value = [...docList.value]\r\n    }\r\n  })\r\n}\r\n\r\nconst loadDocList = (treeNode) => {\r\n  return new Promise((resolve) => {\r\n    if (treeNode.dataRef.hasLoaded) {\r\n      resolve()\r\n      return\r\n    }\r\n\r\n    getMyDocList(treeNode.dataRef).then(() => {\r\n      resolve()\r\n    })\r\n  })\r\n}\r\n\r\nconst clearSelectedKeys = () => {\r\n  selectedKeys.value = []\r\n}\r\n\r\nconst { copyShareUrl } = useCopyShareUrl()\r\n\r\nconst onShareDoc = async (treeNode) => {\r\n  const docUrl = OPEN_BOC_BASE_URL + '/doc/' + treeNode.doc_key\r\n\r\n  await copyShareUrl(docUrl)\r\n}\r\n\r\nconst onImportDoc = (treeNode, docFile) => {\r\n  let isDir = 0;\r\n  let title = docFile.title;\r\n  // let level = treeNode ? treeNode.level + 1 : 0;\r\n  let pid = treeNode ? treeNode.dataRef.id : 0;\r\n  // let iconConfig = iconTemplateConfig.value.levels[level];\r\n  // let doc_icon = isDir == 1 ? iconConfig.folder_icon : iconConfig.doc_icon;\r\n\r\n  if (title.endsWith('.md')) {\r\n    title = title.replace(/\\.md$/i, '')\r\n  }\r\n\r\n  let data = {\r\n    library_key: libraryKey.value,\r\n    doc_id: '',\r\n    doc_type: '4',\r\n    doc_icon: '',\r\n    pid: pid,\r\n    title: title,\r\n    content: docFile.content,\r\n    sort: 0,\r\n    is_dir: isDir,\r\n  }\r\n\r\n  saveDraftLibDoc(data).then((res) => {\r\n    message.success(t('import_success'))\r\n    data.id = res.data.doc_id\r\n    data.sort = res.data.sort\r\n\r\n    let node = treeNode ? treeNode.dataRef : null\r\n\r\n    addDocSuccess(node, data)\r\n  })\r\n}\r\n\r\nconst onAddDoc = (treeNode, isDir) => {\r\n  let docName = isDir == 1 ? t('new_folder') :  t('untitled_document');\r\n  // let level = treeNode ? treeNode.level + 1 : 0;\r\n  let pid = treeNode ? treeNode.dataRef.id : 0;\r\n  // let iconConfig = iconTemplateConfig.value.levels[level];\r\n  // let doc_icon = isDir == 1 ? iconConfig.folder_icon : iconConfig.doc_icon;\r\n\r\n  if(isDir == 0){\r\n    if (treeNode) {\r\n      docName = createDocName(t('untitled_document'), treeNode.dataRef.children)\r\n    } else {\r\n      docName = createDocName(t('untitled_document'), docList.value)\r\n    }\r\n  }\r\n\r\n  let data = {\r\n    library_key: libraryKey.value,\r\n    doc_id: '',\r\n    doc_type: '4',\r\n    doc_icon: '',\r\n    pid: pid,\r\n    title: docName,\r\n    content: `# ${t('untitled_document')}`,\r\n    sort: 0,\r\n    is_dir: isDir,\r\n  }\r\n\r\n  let api = isDir == 1 ? saveLibDoc : saveDraftLibDoc\r\n\r\n  api(data).then((res) => {\r\n    message.success(t('add_success'))\r\n    data.id = res.data.doc_id\r\n    data.sort = res.data.sort\r\n\r\n    let node = treeNode ? treeNode.dataRef : null\r\n\r\n    addDocSuccess(node, data)\r\n  })\r\n}\r\n\r\nconst onCopyDoc = (treeNode) => {\r\n  getLibDocInfo({\r\n    library_key: libraryKey.value,\r\n    doc_id: treeNode.dataRef.id,\r\n  }).then((res) => {\r\n    let data = {\r\n      library_key: libraryKey.value,\r\n      doc_id: '',\r\n      doc_type: '4',\r\n      pid: res.data.pid * 1,\r\n      title: res.data.title + '(副本)',\r\n      content: res.data.content,\r\n      doc_icon: res.data.doc_icon || '',\r\n      sort: 0,\r\n      is_dir: 0,\r\n    }\r\n\r\n    saveDraftLibDoc(data).then((res) => {\r\n      message.success(t('copy_success'))\r\n      data.id = res.data.doc_id\r\n      data.sort = res.data.sort\r\n\r\n      let parentNode = findDocInTree(docList.value, data.pid)\r\n\r\n      addDocSuccess(parentNode, data)\r\n    })\r\n  })\r\n}\r\n\r\nconst addDocSuccess = (parentNode, data) => {\r\n  data.children_num = 0\r\n  data.children = []\r\n  data.hasLoaded = false\r\n  data.key = data.id\r\n  data.isLeaf = true\r\n  // data.sort = 0\r\n  data.level = 0\r\n\r\n  if (parentNode) {\r\n    data.level = parentNode.level + 1\r\n    parentNode.children_num++\r\n    parentNode.isLeaf = false\r\n\r\n    if (!parentNode.hasLoaded) {\r\n      parentNode.hasLoaded = false\r\n      nextTick(() => {\r\n        docTreeRef.value.toggleExpand(parentNode.id, true)\r\n      })\r\n    } else {\r\n      parentNode.children.unshift(data)\r\n      nextTick(() => {\r\n        docTreeRef.value.toggleExpand(parentNode.id, true)\r\n      })\r\n    }\r\n  } else {\r\n    data.level = 0\r\n    docList.value.unshift(data)\r\n  }\r\n\r\n  onSelectDoc(data)\r\n}\r\n\r\nconst onRenameDoc = (treeNode) => {\r\n  let doc = findDocInTree(docList.value, treeNode.dataRef.id);\r\n  docListDraggable.value = false;\r\n\r\n  doc.isEdit = true;\r\n}\r\n\r\nconst onSaveName = (treeNode, value) => {\r\n  let doc = findDocInTree(docList.value, treeNode.dataRef.id);\r\n\r\n  doc.title = value;\r\n  doc.isEdit = false;\r\n\r\n  setTimeout(() => {\r\n    docListDraggable.value = true;\r\n  }, 100)\r\n\r\n  let data = {\r\n    library_key: libraryKey.value,\r\n    doc_id: doc.id,\r\n    doc_type: '4',\r\n    pid: doc.pid,\r\n    title: value,\r\n    content: doc.content,\r\n    is_dir: doc.is_dir,\r\n  }\r\n\r\n  let api = doc.is_dir == 1 ? saveLibDoc : saveDraftLibDoc\r\n\r\n  api(data).then(() => {\r\n    message.success(t('modify_success'))\r\n  })\r\n }\r\n\r\nconst onDeleteDoc = (treeNode) => {\r\n  Modal.confirm({\r\n    title: t('delete_document'),\r\n    icon: createVNode(ExclamationCircleOutlined),\r\n    content: t('confirm_delete_document', { title: treeNode.dataRef.title }),\r\n    onOk() {\r\n      submitDeleteDoc(treeNode)\r\n    },\r\n    onCancel() {}\r\n  })\r\n}\r\n\r\nconst submitDeleteDoc = (treeNode) => {\r\n  let handelNodeId = treeNode.dataRef.id;\r\n  let handleNodePid = treeNode.dataRef.pid;\r\n\r\n  deleteLibDoc({\r\n    library_key: libraryKey.value,\r\n    doc_id: treeNode.dataRef.id\r\n  }).then(() => {\r\n    message.success(t('delete_success'))\r\n    let parentDoc = findDocInTree(docList.value, handleNodePid)\r\n\r\n    if (parentDoc) {\r\n      let index = parentDoc.children.findIndex((item) => item.id == handelNodeId)\r\n      parentDoc.children_num--\r\n      parentDoc.isLeaf = parentDoc.children_num == 0\r\n      parentDoc.children.splice(index, 1)\r\n\r\n      if (activeMenuKey.value != 'doc' || currentDoc.value.id != handelNodeId) {\r\n        return\r\n      }\r\n\r\n      let currentDocList = parentDoc.children.filter(item => item.is_dir != 1);\r\n\r\n      if (currentDocList.length > 0) {\r\n        onSelectDoc(currentDocList[0]);\r\n      } else {\r\n        let currentDocList = docList.value.filter(item => item.is_dir != 1);\r\n\r\n        if (currentDocList.length > 0) {\r\n          onSelectDoc(currentDocList[0]);\r\n        } else {\r\n          currentDoc.value = null;\r\n\r\n          router.replace({\r\n            path: '/public-library/home',\r\n            query: {\r\n              library_id: libraryId.value,\r\n              library_key: libraryKey.value\r\n            }\r\n          })\r\n        }\r\n      }\r\n    } else {\r\n      let index = docList.value.findIndex((item) => item.id == handelNodeId)\r\n\r\n      docList.value.splice(index, 1)\r\n\r\n       if (activeMenuKey.value != 'doc' || currentDoc.value.id != handelNodeId) {\r\n        return\r\n      }\r\n\r\n      let currentDocList = docList.value.filter(item => item.is_dir != 1);\r\n\r\n      if (currentDocList.length > 0) {\r\n        onSelectDoc(currentDocList[0])\r\n      } else {\r\n        currentDoc.value = null\r\n        router.replace({\r\n          path: '/public-library/home',\r\n          query: {\r\n            library_id: libraryId.value,\r\n            library_key: libraryKey.value\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst onExportDoc = (treeNode) => {\r\n  getLibDocInfo({\r\n    library_key: libraryKey.value,\r\n    doc_id: treeNode.dataRef.id\r\n  }).then((res) => {\r\n    let { content, title } = res.data\r\n\r\n    if (!title.endsWith('.md')) {\r\n      title += '.md'\r\n    }\r\n\r\n    exportMd(content, title)\r\n  })\r\n}\r\n\r\nconst onSelectDoc = (data) => {\r\n  if(data.is_dir == 1){\r\n    docTreeRef.value.toggleExpand(data.id)\r\n    return\r\n  }\r\n  \r\n  currentDoc.value = data\r\n  selectedKeys.value = [data.id]\r\n  if (route.path == '/public-library/editor') {\r\n    router.replace({\r\n      path: '/public-library/editor',\r\n      query: {\r\n        library_id: libraryId.value,\r\n        library_key: libraryKey.value,\r\n        doc_id: data.id\r\n      }\r\n    })\r\n  } else {\r\n    router.push({\r\n      path: '/public-library/editor',\r\n      query: {\r\n        library_id: libraryId.value,\r\n        library_key: libraryKey.value,\r\n        doc_id: data.id\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nconst onDragEnter = () => {\r\n  // console.log('onDragEnter', info.node)\r\n  // expandedKeys 需要展开时\r\n  // expandedKeys.value = info.expandedKeys;\r\n}\r\n\r\nconst onDrop = (info) => {\r\n  // console.log(info)\r\n  const data = [...docList.value]\r\n  const dropNode = info.node\r\n  const dragNode = info.dragNode\r\n  const dropKey = dropNode.key\r\n  const dragKey = dragNode.key\r\n  const dropPos = dropNode.pos.split('-')\r\n  const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1])\r\n \r\n   const loop = (data, key, level = 0, callback) => {\r\n     for (let i = 0; i < data.length; i++) {\r\n       if (data[i].key === key) {\r\n         callback(data[i], i, level, data)\r\n         return\r\n       }\r\n \r\n       if (data[i].children) {\r\n         loop(data[i].children, key, level + 1, callback)\r\n       }\r\n     }\r\n   }\r\n\r\n  // Find dragObject\r\n  let dragObj\r\n\r\n  loop(data, dragKey, 0, (item, index, level, arr) => {\r\n    dragObj = { ...item }\r\n    arr.splice(index, 1)\r\n  })\r\n\r\n  // 父级的children_num先减1\r\n  if (dragNode.parent && dragNode.parent.node.children_num > 0) {\r\n    dragNode.parent.node.children_num--\r\n    dragNode.parent.node.isLeaf = dragNode.parent.node.children_num == 0\r\n  }\r\n\r\n  // 判断是不是放置在组上\r\n  if (!info.dropToGap) {\r\n    // Drop on the content\r\n    loop(data, dropKey, 0, (item, index, level) => {\r\n      item.children = item.children || []\r\n      item.children_num++\r\n      item.isLeaf = false\r\n      dragObj.level = level + 1\r\n\r\n      // where to insert 示例添加到头部，可以是随意位置\r\n      item.children.unshift(dragObj)\r\n    })\r\n  } else {\r\n    let ar = []\r\n    let i = 0\r\n\r\n    loop(data, dropKey, 0, (_item, index, level, arr) => {\r\n      ar = arr\r\n      i = index\r\n      dragObj.level = level\r\n    })\r\n\r\n    if (dropPosition === -1) {\r\n      ar.splice(i, 0, dragObj)\r\n    } else {\r\n      ar.splice(i + 1, 0, dragObj)\r\n    }\r\n  }\r\n\r\n  docList.value = data\r\n\r\n  handleDocSort(dragNode, dropNode)\r\n}\r\n\r\nconst handleDocSort = (dragNode, dropNode) => {\r\n  let parentDoc = findParentDocInTree(docList.value, dragNode.dataRef.id)\r\n\r\n  dragNode.dataRef.pid = parentDoc ? parentDoc.id : 0\r\n\r\n  let data = {\r\n    library_key: libraryKey.value,\r\n    doc_id: dragNode.dataRef.id,\r\n    pid: dragNode.dataRef.pid,\r\n    level: parentDoc ? parentDoc.level + 1 : 0,\r\n    sort: 0\r\n  }\r\n\r\n  let list = parentDoc ? parentDoc.children : docList.value\r\n  let dragNodeIndex = -1;\r\n\r\n  if (list.length > 1) {\r\n    dragNodeIndex = list.findIndex((item) => item.id == dragNode.dataRef.id)\r\n    // 第一个 top=1，取index+1的sort\r\n    if (dragNodeIndex === 0) {\r\n      data.top = 1\r\n      data.sort = list[dragNodeIndex + 1].sort\r\n    } else {\r\n      //其它情况 top 不传，取index-1的sort\r\n      data.sort = list[dragNodeIndex - 1].sort\r\n    }\r\n  }\r\n\r\n  updateDocSort(data).then((res) => {\r\n    dragNode.dataRef.sort = res.data.sort\r\n    dragNode.dataRef.level = data.level\r\n \r\n     if (dropNode.pid == data.pid) {\r\n       return\r\n     }\r\n    // 如果拖到到组内则展开组\r\n    if (dropNode.dataRef.children.length >= dropNode.dataRef.children_num) {\r\n      dropNode.dataRef.hasLoaded = true\r\n      docTreeRef.value.addLoadedKey(dropNode.id)\r\n      docTreeRef.value.toggleExpand(dropNode.id, true)\r\n    } else {\r\n      getMyDocList(dropNode.dataRef).then(() => {\r\n        // 还原dragNode\r\n        list[dragNodeIndex] = dragNode.dataRef\r\n\r\n        nextTick(() => {\r\n          dropNode.dataRef.hasLoaded = true\r\n          docTreeRef.value.toggleExpand(dropNode.id, true)\r\n        })\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nconst onChangeDoc = (data) => {\r\n  let doc = findDocInTree(docList.value, data.id)\r\n\r\n  doc.title = data.title;\r\n  doc.is_draft = data.is_draft;\r\n  doc.doc_icon = data.doc_icon;\r\n\r\n  currentDoc.value = doc;\r\n}\r\n\r\n// 拖拽功能实现\r\nconst handleMouseDown = (e) => {\r\n  isDragging.value = true\r\n  startX.value = e.clientX\r\n  startWidth.value = leftWidth.value\r\n  \r\n  document.addEventListener('mousemove', handleMouseMove)\r\n  document.addEventListener('mouseup', handleMouseUp)\r\n  document.body.style.cursor = 'col-resize'\r\n  document.body.style.userSelect = 'none'\r\n}\r\n\r\nconst maxWidth = ref(800)\r\nconst minWidth = ref(220)\r\n\r\nconst handleMouseMove = (e) => {\r\n  if (!isDragging.value) return\r\n  \r\n  const deltaX = e.clientX - startX.value\r\n  const newWidth = startWidth.value + deltaX\r\n  \r\n  // 限制最小和最大宽度\r\n  if (newWidth >= minWidth.value && newWidth <= maxWidth.value) {\r\n\r\n    leftWidth.value = newWidth\r\n  }\r\n}\r\n\r\nconst handleMouseUp = () => {\r\n  isDragging.value = false\r\n  document.removeEventListener('mousemove', handleMouseMove)\r\n  document.removeEventListener('mouseup', handleMouseUp)\r\n  document.body.style.cursor = ''\r\n  document.body.style.userSelect = ''\r\n  \r\n  // 保存拖拽后的宽度到本地存储\r\n  setStorage(SIDEBAR_WIDTH_KEY, leftWidth.value)\r\n}\r\n\r\n// 侧边栏展开收起功能\r\nconst toggleSidebar = () => {\r\n  isSidebarCollapsed.value = !isSidebarCollapsed.value\r\n  // 保存收起状态到本地存储\r\n  setStorage(SIDEBAR_COLLAPSED_KEY, isSidebarCollapsed.value)\r\n}\r\n\r\nwatch(\r\n  () => route.path,\r\n  (newPath) => {\r\n    if (newPath !== '/public-library/editor') {\r\n      clearSelectedKeys()\r\n      currentDoc.value = null\r\n    }\r\n  }\r\n)\r\n\r\nwatch(() => docList.value, (newVal) => { \r\n  libraryStore.setDocTreeState(JSON.parse(JSON.stringify(newVal)));\r\n}, {\r\n  deep: true\r\n})\r\n\r\nwatch(docId, (newVal) => {\r\n  if (newVal) {\r\n    selectedKeys.value = [Number(docId.value)]\r\n  }\r\n})\r\n\r\nwatch(libraryId, () => {\r\n  clearSelectedKeys();\r\n  currentDoc.value = null;\r\n  getMyDocList();\r\n})\r\n\r\nonMounted(() => {\r\n  getMyDocList()\r\n\r\n  if (docId.value) {\r\n    selectedKeys.value = [Number(docId.value)]\r\n  }\r\n})\r\n</script>\r\n"],"names":["emit","__emit","libraryStore","usePublicLibraryStore","props","__props","checkPermission","handdleMenu","item","_openBlock","_createElementBlock","_hoisted_1","_Fragment","_renderList","_unref","_normalizeClass","$event","_createElementVNode","_hoisted_3","_createVNode","_component_svg_icon","_hoisted_4","_toDisplayString","fileInput","ref","params","triggerUpload","data","handleFileUpload","e","file","reader","__expose","t","useI18n","publicLibraryStore","saveEditLibrary","libraryInfo","computed","visible","saveLoading","templateList","selectedTemplate","open","selectTemplate","templateId","handleCancel","handleConfirm","toRaw","onMounted","getIconTemplateList","_createBlock","_component_a_modal","_hoisted_2","_component_a_row","_component_a_col","demo","_hoisted_5","_component_a_radio","_hoisted_6","debounce","fn","delay","timer","args","expandedKeys","loadedKeys","addLoadedKey","key","toggleExpand","type","index","toggleExpandAll","uploadDocRef","addDoc","node","isDir","currentNode","importDoc","iconTemplateRef","openIconTemplate","handleFileLoaded","doc","handleCopyLink","handleCopyDoc","handleExportDoc","handleRenameDoc","nextTick","el","saveName","value","handleDeleteDoc","allowDrop","dropNode","dragNode","dropPosition","onDragEnter","info","onDrop","onSelect","selectedKeys","_component_a_dropdown","_component_a_menu","_component_a_menu_item","PlusOutlined","_component_a_tooltip","_hoisted_7","_component_a_tree","_withCtx","switcherCls","_hoisted_8","_hoisted_9","CaretDownOutlined","treeNode","_hoisted_11","_hoisted_12","_hoisted_13","_component_a_input","_hoisted_14","_hoisted_15","_withModifiers","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","MoreOutlined","UploadDoc","IconTemplate","SIDEBAR_WIDTH_KEY","SIDEBAR_COLLAPSED_KEY","collapsedWidth","exportMd","content","filename","blob","saveAs","findDocInTree","tree","targetId","i","found","findParentDocInTree","parent","createDocName","baseName","fileList","existingNames","counter","fileName","router","useRouter","route","useRoute","libraryId","libraryKey","iconTemplateConfig","docId","docTreeRef","docList","docListDraggable","currentDoc","activeMenuKey","setStorage","getStorage","useStorage","leftWidth","isSidebarCollapsed","startX","startWidth","isDragging","provide","menus","handleMeunClick","menu","handleMeunAction","changeHomePreviewStyle","getMyDocList","getDocList","res","list","loadDocList","resolve","clearSelectedKeys","copyShareUrl","useCopyShareUrl","onShareDoc","docUrl","OPEN_BOC_BASE_URL","onImportDoc","docFile","title","pid","saveDraftLibDoc","message","addDocSuccess","onAddDoc","docName","saveLibDoc","onCopyDoc","getLibDocInfo","parentNode","onSelectDoc","onRenameDoc","onSaveName","onDeleteDoc","Modal","createVNode","ExclamationCircleOutlined","submitDeleteDoc","handelNodeId","handleNodePid","deleteLibDoc","parentDoc","currentDocList","onExportDoc","dropKey","dragKey","dropPos","loop","level","callback","dragObj","arr","ar","_item","handleDocSort","dragNodeIndex","updateDocSort","onChangeDoc","handleMouseDown","handleMouseMove","handleMouseUp","maxWidth","minWidth","deltaX","newWidth","toggleSidebar","watch","newPath","newVal","_normalizeStyle","SideMenus","SideDirectory","_component_router_view"],"mappings":"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"}