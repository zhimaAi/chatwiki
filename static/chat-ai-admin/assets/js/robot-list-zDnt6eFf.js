import{b as q,M as E,k as w,h as Co,l as yo,B as xo,ay as $o,az as To,aA as wo,ac as Ro,d as Lo,E as V,aB as Oo}from"../../index-CzPebXix.js";import{_ as Ao}from"./cu-scroll-ufyFyI_5.js";import{d as u,S as B,O as p,U as n,X as o,j as s,Z as X,u as x,z as Go,N as $,F as z,a1 as H,_ as S,b as j,q as Io,a6 as M,a5 as K,a0 as m}from"./vue-chunks-BRsu9_To.js";import{r as So,c as so,e as Uo,g as Eo,f as Bo,h as Po,i as Do}from"./index-jmRHMddk.js";import{A as No,a as Mo}from"./add-group-Csdf_vpc.js";import{I as Wo}from"./InboxOutlined-BcJOXEMG.js";import{U as Fo,_ as Vo}from"./index-7Ecr060x.js";import{_ as jo}from"./index-CBmR-lHY.js";import{_ as Ko}from"./page-alert-hUfedjgw.js";import{L as zo}from"./list-tabs-CItid5-z.js";import{S as Ho,a as qo}from"./index-6HDf6TPN.js";import"./index-BSz5XTfh.js";import{D as Xo}from"./dropdown-DTOAy9tU.js";import{P as eo}from"./PlusOutlined-BlmIiILr.js";import{M as Zo,_ as Jo,E as Qo}from"./index-DlQVT6K6.js";import"./index-BFhVTGQQ.js";import{I as Yo}from"./Input-DFtZp9vk.js";import{S as ot}from"./SearchOutlined-a_gTycfl.js";import{L as tt}from"./LeftOutlined-BKUTcRtP.js";import{R as et}from"./RightOutlined-DH_YROnp.js";import{_ as st}from"./index-BwqnaIPU.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-BfxXXGE8.js";import"./index-BgVvqN-n.js";import"./Trigger-Bvakuge0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-OEy0Jz8l.js";import"./Col-CFxRRwN8.js";import"./responsiveObserve-DqAe0rZk.js";import"./collapseMotion-Brd6xpAT.js";import"./QuestionCircleOutlined-DTfTQPH4.js";import"./FormItemContext-B2RmG14m.js";import"./robot-CF9aQwVH.js";import"./TextArea-DrgXbuSS.js";import"./index-Bxqtz4sn.js";import"./index-Bhf8G0AA.js";import"./inputProps-jdR54afw.js";import"./Password-fnCqxsm2.js";import"./DownloadOutlined-CeWsYko2.js";import"./index-hvcgcTJ4.js";import"./CheckOutlined-Mk6nTpyE.js";import"./useRefs-CRRjy_qY.js";import"./useMergedState-C0iIHNGF.js";import"./slide-CsbPJG8I.js";import"./List-D7uk7Chm.js";import"./DownOutlined-DXKkgIsm.js";import"./move-CkiYyFmr.js";import"./colors-DfoziJR7.js";import"./shallowequal-C0xnIuy8.js";import"./Search-Cf7bcOZJ.js";const nt={class:"form-box"},lt={class:"tip-box"},at={class:"ant-upload-drag-icon"},it={__name:"import-csl-alert",emits:["ok"],setup(P,{expose:L,emit:T}){const v=T,f=u(!1),b=u(!1),a=u([]),_=()=>{f.value=!0},A=()=>{f.value=!1,a.value=[]},G=()=>{if(a.value.length===0){w.error("请上传csl文件");return}b.value=!0,So({file:a.value[0].originFileObj}).then(r=>{b.value=!1,f.value=!1,w.success("导入成功"),a.value=[],v("ok",r.data)}).catch(()=>{b.value=!1})},k=r=>r.name.endsWith(".csl")?!1:(w.error("只能上传csl格式的文件"),Vo.LIST_IGNORE),C=r=>{const{status:c}=r.file;c!=="uploading"&&(r.file,r.fileList)};return L({open:_}),(r,c)=>{const g=jo,O=Fo,h=E;return p(),B(h,{width:"600px",open:f.value,"onUpdate:open":c[1]||(c[1]=I=>f.value=I),confirmLoading:b.value,title:"导入csl文件创建机器人",onOk:G,onCancel:A},{default:n(()=>[o("div",nt,[o("div",lt,[s(g,{type:"info"},{description:n(()=>c[2]||(c[2]=[X(" 您可以将您编排好的机器人导出为csl文件,共享给他人使用。也可以从他人处获取导出的csl文件,通过导入形式创建机器人。 ")])),_:1})]),s(O,{fileList:a.value,"onUpdate:fileList":c[0]||(c[0]=I=>a.value=I),name:"file",multiple:!1,maxCount:1,accept:".csl","before-upload":k,onChange:C},{default:n(()=>[o("p",at,[s(x(Wo),{class:"upload-icon"})]),c[3]||(c[3]=o("p",{class:"upload-text"},"点击或将文件拖拽到这里上传",-1)),c[4]||(c[4]=o("p",{class:"upload-hint"},"仅支持从chatwiki导出生成的csl文件",-1))]),_:1,__:[3,4]},8,["fileList"])])]),_:1},8,["open","confirmLoading"])}}},rt=q(it,[["__scopeId","data-v-5b3f5182"]]),ct={class:"form-item"},dt={class:"form-content"},ut={__name:"edit-group",emits:["ok"],setup(P,{expose:L,emit:T}){const v=u(!1),f=T,b=u("修改分组"),a=Go({group_id:"",robot_id:""}),_=u([]),A=C=>{a.group_id=C.group_id||"0",a.robot_id=C.id||"",k(),v.value=!0},G=()=>{if(!a.group_id)return w.error("请选择分组");Uo({...a}).then(C=>{w.success(`${b.value}成功`),v.value=!1,f("ok")})},k=()=>{so().then(C=>{_.value=C.data||[]})};return L({show:A}),(C,r)=>{const c=qo,g=Ho,O=E;return p(),$("div",null,[s(O,{open:v.value,"onUpdate:open":r[1]||(r[1]=h=>v.value=h),title:b.value,onOk:G},{default:n(()=>[o("div",ct,[r[2]||(r[2]=o("div",{class:"form-label"},"分组名称：",-1)),o("div",dt,[s(g,{value:a.group_id,"onUpdate:value":r[0]||(r[0]=h=>a.group_id=h),style:{width:"100%"},placeholder:"请选择分组"},{default:n(()=>[(p(!0),$(z,null,H(_.value,h=>(p(),B(c,{value:h.id},{default:n(()=>[X(S(h.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},pt=q(ut,[["__scopeId","data-v-5ebd311c"]]),_t=()=>{const P=Co();return{openUrlWithToken:T=>{const v=P.getToken;if(!v){console.warn("Token is missing");return}if(!T){console.warn("URL is missing");return}const f=T.includes("?")?"&":"?",b=`${T}${f}token=${v}`;window.open(b,"_blank")}}},mt={class:"robot-page"},vt={class:"list-toolbar"},ft={class:"toolbar-box"},bt={class:"toolbar-box"},kt={class:"create-action"},gt=["src"],ht={class:"create-action"},Ct=["src"],yt={class:"create-action"},xt=["src"],$t={class:"list-group-box"},Tt={key:0,class:"group-head-box"},wt={class:"head-title"},Rt={class:"search-box"},Lt={class:"classify-box"},Ot=["onClick"],At={class:"classify-title"},Gt={class:"right-content"},It={key:0,class:"btn-box"},St={class:"hover-btn-wrap"},Ut=["onClick"],Et=["onClick"],Bt={class:"robot-scroll-box"},Pt={class:"list-box"},Dt={key:0,class:"empty-box"},Nt=["onClick"],Mt={class:"list-item"},Wt={class:"robot-info"},Ft=["src"],Vt={class:"robot-info-content"},jt={class:"robot-name"},Kt={class:"robot-type-tag"},zt={class:"robot-desc"},Ht=["onClick"],qt=["onClick"],Xt=["onClick"],Zt=["onClick"],Jt=["onClick"],Qt=["onClick"],Yt={__name:"robot-list",setup(P){const L=u([{title:"全部 (0)",value:"2"},{title:"聊天机器人 (0)",value:"0"},{title:"工作流 (0)",value:"1"}]),T=yo();let{role_permission:v,role_type:f}=T;const b=j(()=>f==1||v.includes("RobotCreate")),a=u("2"),_=u(""),A=u([]);let G="robot-list-hide-group-key";const k=u(localStorage.getItem(G)==1),C=()=>{k.value=!k.value,localStorage.setItem(G,k.value?1:0)},r=j(()=>{let e=A.value;return _.value!=""&&(e=e.filter(t=>t.group_id==_.value)),a.value==2?e:e.filter(t=>t.application_type==a.value)}),c=()=>{g(),D()},g=()=>{Eo().then(e=>{let t=0,d=0,i=0;e.data.forEach(R=>{R.application_type==0?d++:i++,t++}),L.value=[{title:"全部 ("+t+")",value:"2"},{title:"聊天机器人 ("+d+")",value:"0"},{title:"工作流 ("+i+")",value:"1"}],A.value=e.data}).catch(()=>{})},O=u(null),h=u(null),I=e=>{O.value.open(e),O.value.setGroupId(_.value)},no=()=>{h.value.open()},lo=e=>{g(),Z(e)},Z=({id:e,robot_key:t,application_type:d})=>{localStorage.setItem("last_local_robot_id",e),d==0?window.open(`/#/robot/config/basic-config?id=${e}&robot_key=${t}`,"_blank","noopener"):window.open(`/#/robot/config/workflow?id=${e}&robot_key=${t}`,"_blank","noopener")},ao=e=>{if(Oo(e.id)!=4)return w.error("您没有删除机器人的权限");let d=3,i=E.confirm({title:`删除机器人${e.robot_name}`,icon:s(V),content:"您确定要删除此机器人吗？",okText:d+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){io(e)},onCancel(){}}),R=setInterval(()=>{d==1?(i.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(R),R=void 0):(d-=1,i.update({okText:d+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},io=({id:e})=>{Po({id:e}).then(()=>{w.success("删除成功"),g()})},ro=e=>{let t=3,d=E.confirm({title:`复制机器人${e.robot_name}`,icon:s(V),content:"您确定要复制此机器人吗？",okText:t+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){co(e)},onCancel(){}}),i=setInterval(()=>{t==1?(d.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(i),i=void 0):(t-=1,d.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},co=({id:e})=>{Do({id:e}).then(()=>{w.success("复制成功"),g()})},uo=e=>{const{openUrlWithToken:t}=_t();t(`/manage/robotExport?id=${e.id}`)},po=e=>{window.open(`#/robot/test?robot_key=${e.robot_key}&id=${e.id}`)},_o=e=>{window.open(`#/robot/config/session-record?robot_key=${e.robot_key}&id=${e.id}`)},mo=e=>{window.open(`#/robot/config/statistical_analysis?robot_key=${e.robot_key}&id=${e.id}`)},W=u(""),J=u([]),vo=j(()=>J.value.filter(e=>e.group_name.includes(W.value))),D=()=>{so({application_type:a.value==2?null:a.value}).then(e=>{let t=e.data||[],d=0;t.forEach(i=>{d+=+i.total}),J.value=[{group_name:"全部",total:d,id:""},...t]})},fo=e=>{_.value=e.id,g()},Q=u(null),Y=e=>{Q.value.show({...e})},oo=u(null),bo=e=>{oo.value.show({...e})},ko=e=>{E.confirm({title:`确认删除分组${e.group_name}`,icon:s(V),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){Bo({id:e.id}).then(()=>{w.success("删除成功"),D(),_.value==e.id&&(_.value="",g())})}})};return Io(()=>{g(),D()}),(e,t)=>{const d=xo,i=Jo,R=Zo,F=Xo,U=st,go=Yo,to=Ao,ho=Ro,N=Lo;return p(),$("div",mt,[t[16]||(t[16]=o("h3",{class:"page-title"},"应用",-1)),s(Ko,{class:"mb-16",title:"使用说明"},{default:n(()=>t[9]||(t[9]=[o("div",null,[o("p",null," 1、应用包括两种类型：聊天机器人、工作流。聊天机器人适合新手用户，关联知识库后只需简单配置，即可创建一个基于私有知识库的问答机器人。工作流适合高级用户，利用系统预制节点自定义任务流程，适合解决复杂任务。 "),o("p",null,"2、发现模块也提供了丰富模版，可以根据需要选择适合模版快速创建应用。")],-1)])),_:1,__:[9]}),o("div",vt,[o("div",ft,[s(zo,{tabs:L.value,onChange:D,value:a.value,"onUpdate:value":t[0]||(t[0]=l=>a.value=l)},null,8,["tabs","value"])]),o("div",bt,[b.value?(p(),B(F,{key:0},{overlay:n(()=>[s(R,null,{default:n(()=>[s(i,{onClick:t[2]||(t[2]=m(l=>I(0),["prevent"]))},{default:n(()=>[o("span",kt,[o("img",{class:"icon",src:x($o),alt:""},null,8,gt),t[11]||(t[11]=o("span",null,"聊天机器人",-1))])]),_:1}),s(i,{onClick:t[3]||(t[3]=m(l=>I(1),["prevent"]))},{default:n(()=>[o("span",ht,[o("img",{class:"icon",src:x(To),alt:""},null,8,Ct),t[12]||(t[12]=o("span",null,"工作流",-1))])]),_:1}),s(i,{onClick:no},{default:n(()=>[o("span",yt,[o("img",{class:"icon",src:x(wo),alt:""},null,8,xt),t[13]||(t[13]=o("span",null,"导入csl创建",-1))])]),_:1})]),_:1})]),default:n(()=>[s(d,{type:"primary",onClick:t[1]||(t[1]=m(()=>{},["prevent"]))},{icon:n(()=>[s(x(eo))]),default:n(()=>[t[10]||(t[10]=X(" 创建应用 "))]),_:1,__:[10]})]),_:1})):M("",!0)])]),o("div",$t,[o("div",{class:K(["group-list-box",{"hide-group":k.value}])},[s(to,{style:{"padding-right":"16px"}},{default:n(()=>[k.value?M("",!0):(p(),$("div",Tt,[o("div",wt,[t[14]||(t[14]=o("div",null,"机器人分组",-1)),s(U,{title:"新建分组"},{default:n(()=>[o("div",{class:"hover-btn-wrap",onClick:t[4]||(t[4]=l=>Y({}))},[s(x(eo))])]),_:1})]),o("div",Rt,[s(go,{value:W.value,"onUpdate:value":t[6]||(t[6]=l=>W.value=l),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[s(x(ot),{onClick:t[5]||(t[5]=m(()=>{},["stop"]))})]),_:1},8,["value"])])])),o("div",Lt,[(p(!0),$(z,null,H(vo.value,l=>(p(),$("div",{class:K(["classify-item",{active:l.id==_.value}]),onClick:y=>fo(l),key:l.id},[o("div",At,S(l.group_name),1),o("div",Gt,[o("div",{class:K(["num",{"num-block":l.id<=0}])},S(l.total),3),l.id>0?(p(),$("div",It,[s(F,{placement:"bottomRight"},{overlay:n(()=>[s(R,null,{default:n(()=>[s(i,null,{default:n(()=>[o("div",{onClick:m(y=>Y(l),["stop"])},"重命名",8,Ut)]),_:2},1024),s(i,null,{default:n(()=>[o("div",{onClick:m(y=>ko(l),["stop"])},"删 除",8,Et)]),_:2},1024)]),_:2},1024)]),default:n(()=>[o("div",St,[s(x(Qo))])]),_:2},1024)])):M("",!0)])],10,Ot))),128))])]),_:1}),s(U,{placement:"right",title:k.value?"展开分组":"收起分组"},{default:n(()=>[o("div",{class:"hide-group-box",onClick:C},[k.value?(p(),B(x(et),{key:1})):(p(),B(x(tt),{key:0}))])]),_:1},8,["title"])],2),o("div",Bt,[s(to,{style:{"padding-right":"16px"}},{default:n(()=>[o("div",Pt,[r.value.length==0?(p(),$("div",Dt,[s(ho)])):M("",!0),(p(!0),$(z,null,H(r.value,l=>(p(),$("div",{class:"list-item-wrapper",key:l.id,onClick:y=>Z(l)},[o("div",Mt,[o("div",Wt,[o("img",{class:"robot-avatar",src:l.robot_avatar,alt:""},null,8,Ft),o("div",Vt,[o("div",jt,S(l.robot_name),1),o("div",Kt,S(l.application_type==0?"聊天机器人":"工作流"),1)])]),o("div",zt,S(l.robot_intro),1),o("div",{class:"robot-action",onClick:t[8]||(t[8]=m(()=>{},["stop"]))},[s(U,{title:"聊天测试"},{default:n(()=>[o("div",{class:"robot-action-item",onClick:m(y=>po(l),["stop"])},[s(N,{class:"action-icon",name:"chat"})],8,Ht)]),_:2},1024),s(U,{title:"会话记录"},{default:n(()=>[o("div",{class:"robot-action-item",onClick:m(y=>_o(l),["stop"])},[s(N,{class:"action-icon",name:"session"})],8,qt)]),_:2},1024),s(U,{title:"统计分析"},{default:n(()=>[o("div",{class:"robot-action-item",onClick:m(y=>mo(l),["stop"])},[s(N,{class:"action-icon",name:"analysis"})],8,Xt)]),_:2},1024),s(F,null,{overlay:n(()=>[s(R,null,{default:n(()=>[s(i,null,{default:n(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:y=>ao(l)},"删 除",8,Zt)]),_:2},1024),s(i,null,{default:n(()=>[o("div",{onClick:m(y=>bo(l),["stop"])},"修改分组",8,Jt)]),_:2},1024),s(i,null,{default:n(()=>[o("a",{class:"copy-text-color",href:"javascript:;",onClick:y=>ro(l)},"复 制",8,Qt)]),_:2},1024),s(i,{onClick:y=>uo(l)},{default:n(()=>t[15]||(t[15]=[o("span",null,"导出为csl",-1)])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o("div",{class:"robot-action-item",onClick:t[7]||(t[7]=m(()=>{},["stop"]))},[s(N,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,Nt))),128))])]),_:1})])]),s(No,{ref_key:"addRobotAlertRef",ref:O},null,512),s(Mo,{ref_key:"addGroupRef",ref:Q,onOk:c},null,512),s(pt,{ref_key:"editGroupRef",ref:oo,onOk:c},null,512),s(rt,{ref_key:"importCslAlertRef",ref:h,onOk:lo},null,512)])}}},ts=q(Yt,[["__scopeId","data-v-a74db187"]]);export{ts as default};
