import{_ as et}from"./cu-scroll-BmJNJRCz.js";import{_ as tt,bd as ot,be as st,d as at}from"../../index-C1Xsov4S.js";import{f as i,w as J,e as Z,r as N,o as nt,b as lt,y as ee,Y as d,a5 as s,k as a,a6 as it,ac as D,ae as L,a2 as n,_ as l,u as C,B as z,F as U,ab as W,a7 as g,a1 as we,G as te}from"./vue-chunks-DCKTEHpB.js";import{_ as dt}from"./empty-BFmzY9bl.js";import{a as ct,_ as ut}from"./create-send-modal-Dc8Nl6dW.js";import{af as rt,ad as Ce,ag as pt,ah as vt,ai as _t,aj as ft}from"./index-DLEjqKv8.js";import{p as gt,I as mt,M as Se,a3 as Oe,Y as Me,h as ht,ao as ze,e as yt,f as kt,ab as bt,B as xt,aw as wt,O as Ct,ai as St,by as Ot,N as Mt,v as zt,w as It,aC as Gt,a as m,Q as Dt}from"./ui-antd-D64OvTpt.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./utils-D9NMMoMR.js";const Lt={class:"official-draft-wrapper"},Ut={class:"qa-list-wrapper"},Rt={class:"group-head-box"},Bt={class:"head-title"},Et={class:"flex-between-box"},$t={class:"search-box"},Ht={class:"classify-box"},Tt=["onClick"],Nt={class:"classify-title"},Wt={class:"right-content"},Kt={key:0,class:"btn-box"},jt={class:"hover-btn-wrap"},Pt=["onClick"],Vt=["onClick"],Xt={class:"head-content"},Yt={class:"toolbar"},Ft={key:0,class:"title"},qt={class:"pover-group-content-box"},Qt={class:"group-head-box"},At={class:"head-title"},Jt={class:"flex-between-box"},Zt={class:"search-box"},eo={class:"classify-box classify-scroll-box"},to=["onClick"],oo={class:"classify-title"},so={class:"right-content"},ao={key:0,class:"btn-box"},no={class:"hover-btn-wrap"},lo=["onClick"],io=["onClick"],co={class:"header-row"},uo={class:"content-block"},ro={key:0,class:"loading-box"},po={key:0,class:"empty-box"},vo={key:1,class:"draft-list"},_o=["src"],fo={key:1,class:"thumb",src:ut},go={class:"info"},mo={class:"title"},ho={class:"meta"},yo={class:"digest"},ko={class:"extra"},bo={class:"pagination-box"},xo={class:"sync-modal"},wo={class:"sync-select-box"},Ie="official_draft_group_box_width",Ge="official_draft_group_hide_key",K=180,oe=256,Co={__name:"draft-box",props:{appId:{type:String,default:""},accessKey:{type:String,default:""}},setup(j){const h=j,se=i(null),ae=i(null),P=i(0),R=i(!1);J(()=>h.appId,()=>{u.value.page=1,h.appId&&ge()});const S=i([]),I=i(""),O=i(-1),ne=Z(()=>S.value.filter(o=>(o.group_name||"").includes(I.value))),V=async()=>{let e=(await rt()).data||[];S.value=e.map(c=>({...c,total:0})),await X(),r()},X=async()=>{const o=h.appId,e=S.value.map(async c=>{var w;const p=await Ce({page:1,size:1,app_id:o,group_id:c.id}),x=((w=p==null?void 0:p.data)==null?void 0:w.total)||0;c.total=x});await Promise.all(e)},B=(o={})=>{y.id=o.id||0,y.group_name=o.group_name||"",E.value=!0},E=i(!1),y=N({id:0,group_name:""}),De=async()=>{if(!y.group_name)return m.error("请输入分组名称");await vt({id:y.id,group_name:y.group_name}),E.value=!1,m.success("操作成功"),await V()},le=o=>{Se.confirm({title:`确认删除分组：${o.group_name}`,icon:a(Dt),content:"",okText:"确认",cancelText:"取消",onOk:async()=>{await pt({id:o.id}),await V(),m.success("操作成功"),O.value==o.id&&(O.value=-1,await M())}})},ie=o=>{O.value=o.id,Be()},k=i([]),Y=i(!1),de=i(0),u=i({page:1,size:20}),Le=N({title:""}),ce=()=>Object.keys(v).filter(o=>v[o]),v=N({}),Ue=Z(()=>ce().length),ue=Z({get(){return k.value.length>0&&k.value.every(o=>!!v[o.id])},set(o){k.value.forEach(e=>{v[e.id]=o})}}),Re=()=>{Object.keys(v).forEach(o=>delete v[o])};J(k,()=>{ee(r)},{deep:!0}),J(S,()=>{ee(r)},{deep:!0});const M=async()=>{Y.value=!0;const o=await Ce({page:u.value.page,size:u.value.size,title:Le.title,app_id:h.appId,group_id:O.value}),e=(o==null?void 0:o.data)||{};k.value=e.list||[],de.value=e.total||0,Y.value=!1,Re(),r()},Be=()=>{u.value.page=1,M()},Ee=(o,e)=>{u.value.page=o,u.value.size=e,M()},$e=()=>{const o=ce();if(o.length===0)return m.error("请选择你要移动的草稿");b.ids=o.join(","),b.group_id=void 0,$.value=!0},He=()=>{$e()},F=i(null),Te=o=>{F.value&&F.value.show({draft:o})},$=i(!1),b=N({group_id:void 0,ids:""}),Ne=async()=>{if(!b.group_id)return m.error("请选择分组");await _t({draft_id:b.ids,group_id:b.group_id,app_id:h.appId}),$.value=!1,m.success("移动成功"),await M(),await X()},G=i(K),_=i(localStorage.getItem(Ge)==1),q=i(!1);nt(()=>{ot();const o=parseInt(localStorage.getItem(Ie));o&&o>=K&&o<=oe&&(G.value=o),h.appId&&ge(),window.addEventListener("resize",r)}),lt(()=>{window.removeEventListener("resize",r),st()});const re=()=>{_.value=!_.value,localStorage.setItem(Ge,_.value?1:2),r()};let H=!1,pe=0,ve=0;const We=o=>{_.value||(H=!0,q.value=!0,pe=o.clientX,ve=G.value,document.body.style.cursor="col-resize",document.addEventListener("mousemove",_e),document.addEventListener("mouseup",fe))},_e=o=>{if(!H)return;let e=ve+(o.clientX-pe);e=Math.max(K,Math.min(oe,e)),G.value=e},fe=()=>{H&&(H=!1,q.value=!1,localStorage.setItem(Ie,G.value),document.body.style.cursor="",document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",fe),r())},ge=async()=>{await V(),await M(),r()},r=()=>{ee(()=>{const o=se.value,e=ae.value;if(!o||!e)return;const c=o.style.height;o.style.height="auto";const p=o.scrollHeight||o.offsetHeight||0;o.style.height=c;const x=e.scrollHeight||e.offsetHeight||0;P.value=Math.max(p,x)})},me=o=>{const e=S.value.find(c=>c.id==o);return e?e.group_name:o==0?"未分组":""},Ke=()=>{m.success("创建群发任务成功")},T=i(!1),Q=i(0),je={0:"前100条",1:"前200条",2:"前1000条",3:"全部"},Pe=[100,200,1e3,0],Ve=()=>{T.value=!0},Xe=async()=>{const o=Pe[Q.value]||0;R.value=!0,await ft({access_key:h.accessKey,limit:o}),R.value=!1,m.success("已提交同步任务，稍后刷新查看"),T.value=!1,setTimeout(()=>{M(),X()},800),setTimeout(()=>{r()},1e3)};return(o,e)=>{const c=at,p=gt,x=mt,w=kt,he=yt,ye=ht,ke=et,Ye=bt,be=xt,xe=Ct,Fe=St,qe=Ot,A=Se,Qe=It,Ae=zt,Je=Mt,Ze=Gt;return l(),d("div",Lt,[s("div",Ut,[s("div",{class:D(["group-content-box",[{collapsed:_.value},{"no-transition":q.value}]]),ref_key:"groupContentRef",ref:se,style:it(_.value?{}:{width:G.value+"px",minWidth:K+"px",maxWidth:oe+"px",height:P.value?P.value+"px":void 0})},[s("div",Rt,[s("div",Bt,[a(p,{title:"收起分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(c,{name:"put-away"})])]),_:1}),s("div",Et,[e[15]||(e[15]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[0]||(e[0]=t=>B({}))},[a(C(Oe))])]),_:1})])]),s("div",$t,[a(x,{value:I.value,"onUpdate:value":e[2]||(e[2]=t=>I.value=t),allowClear:"",placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(Me),{onClick:e[1]||(e[1]=z(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",Ht,[a(ke,{style:{"padding-right":"24px"}},{default:n(()=>[(l(!0),d(U,null,W(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==O.value}]),onClick:f=>ie(t),key:t.id},[s("div",Nt,g(t.group_name),1),s("div",Wt,[s("div",{class:D(["num",{"num-block":t.id<=0}])},g(t.total),3),t.id>0?(l(),d("div",Kt,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:z(f=>B(t),["stop"])},"重命名",8,Pt)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:z(f=>le(t),["stop"])},"删 除",8,Vt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",jt,[a(C(ze))])]),_:2},1024)])):L("",!0)])],10,Tt))),128))]),_:1})]),_.value?L("",!0):(l(),d("div",{key:0,class:"resize-bar",onMousedown:We},null,32))],6),s("div",{class:"main-content-box",ref_key:"mainContentRef",ref:ae},[a(ke,{scrollbar:{minSize:80,fade:!1,interactive:!0,scrollbarTrackClickable:!0}},{default:n(()=>[s("div",Xt,[s("div",Yt,[_.value?(l(),d("div",Ft,[a(Ye,{title:null,placement:"bottom"},{content:n(()=>[s("div",qt,[s("div",Qt,[s("div",At,[s("div",Jt,[e[16]||(e[16]=s("div",null,"草稿箱分组",-1)),a(p,{title:"新建分组"},{default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:e[3]||(e[3]=t=>B({}))},[a(C(Oe))])]),_:1})])]),s("div",Zt,[a(x,{allowClear:"",value:I.value,"onUpdate:value":e[5]||(e[5]=t=>I.value=t),placeholder:"搜索分组",style:{width:"100%"}},{suffix:n(()=>[a(C(Me),{onClick:e[4]||(e[4]=z(()=>{},["stop"]))})]),_:1},8,["value"])])]),s("div",eo,[(l(!0),d(U,null,W(ne.value,t=>(l(),d("div",{class:D(["classify-item",{active:t.id==O.value}]),onClick:f=>ie(t),key:t.id},[s("div",oo,g(t.group_name),1),s("div",so,[s("div",{class:D(["num",{"num-block":t.id<=0}])},g(t.total),3),t.id>0?(l(),d("div",ao,[a(ye,{placement:"bottomRight"},{overlay:n(()=>[a(he,null,{default:n(()=>[a(w,null,{default:n(()=>[s("div",{onClick:z(f=>B(t),["stop"])},"重命名",8,lo)]),_:2},1024),a(w,null,{default:n(()=>[s("div",{onClick:z(f=>le(t),["stop"])},"删 除",8,io)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",no,[a(C(ze))])]),_:2},1024)])):L("",!0)])],10,to))),128))])])]),default:n(()=>[s("div",{class:"hover-btn-wrap",onClick:re},[a(c,{name:"expand"})])]),_:1})])):L("",!0),a(be,{type:"primary",onClick:Ve,loading:R.value},{default:n(()=>[R.value?L("",!0):(l(),we(C(wt),{key:0})),e[17]||(e[17]=te("同步草稿 ",-1))]),_:1},8,["loading"]),a(be,{disabled:Ue.value===0,onClick:He},{default:n(()=>[...e[18]||(e[18]=[te("批量分组",-1)])]),_:1},8,["disabled"])]),s("div",co,[a(xe,{checked:ue.value,"onUpdate:checked":e[6]||(e[6]=t=>ue.value=t)},null,8,["checked"]),e[19]||(e[19]=s("span",{class:"header-text"},"内容",-1))])]),s("div",uo,[Y.value?(l(),d("div",ro,[a(Fe)])):(l(),d(U,{key:1},[k.value.length===0?(l(),d("div",po,[...e[20]||(e[20]=[s("img",{src:dt},null,-1),s("div",{class:"title"},"暂无草稿",-1)])])):(l(),d("div",vo,[(l(!0),d(U,null,W(k.value,t=>(l(),d("div",{class:"draft-item",key:t.id},[a(xe,{checked:v[t.id],"onUpdate:checked":f=>v[t.id]=f},null,8,["checked","onUpdate:checked"]),t.thumb_url?(l(),d("img",{key:0,class:"thumb",src:t.thumb_url},null,8,_o)):(l(),d("img",fo)),s("div",go,[s("div",mo,g(t.title),1),s("div",ho,"所属分组："+g(me(t.group_id)),1),s("div",yo,g(t.digest),1)]),s("div",ko,[a(c,{name:"group-send",class:"icon",onClick:f=>Te(t),style:{"font-size":"32px",cursor:"pointer",color:"transparent"}},null,8,["onClick"])])]))),128))])),s("div",bo,[a(qe,{current:u.value.page,"onUpdate:current":e[7]||(e[7]=t=>u.value.page=t),"page-size":u.value.size,"onUpdate:pageSize":e[8]||(e[8]=t=>u.value.size=t),total:de.value,pageSizeOptions:["10","20","50","100"],"show-size-changer":"",onChange:Ee},null,8,["current","page-size","total"])])],64))])]),_:1})],512)]),a(A,{open:E.value,"onUpdate:open":e[10]||(e[10]=t=>E.value=t),title:"添加分组",onOk:De},{default:n(()=>[e[21]||(e[21]=s("div",{style:{margin:"32px 0 4px"}},"分组名称：",-1)),a(x,{value:y.group_name,"onUpdate:value":e[9]||(e[9]=t=>y.group_name=t),placeholder:"请输入分组名称",style:{"margin-bottom":"20px"}},null,8,["value"])]),_:1},8,["open"]),a(A,{open:$.value,"onUpdate:open":e[12]||(e[12]=t=>$.value=t),title:"批量移动分组",onOk:Ne},{default:n(()=>[a(Je,{align:"center",style:{margin:"24px 0"}},{default:n(()=>[e[22]||(e[22]=s("div",null,"移动到分组：",-1)),a(Ae,{value:b.group_id,"onUpdate:value":e[11]||(e[11]=t=>b.group_id=t),style:{flex:"1"},placeholder:"请选择分组"},{default:n(()=>[(l(!0),d(U,null,W(S.value.filter(t=>t.id>0),t=>(l(),we(Qe,{key:t.id,value:t.id},{default:n(()=>[te(g(t.group_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["open"]),a(ct,{ref_key:"createSendModalRef",ref:F,"app-id":j.appId,"access-key":j.accessKey,"get-group-name":me,onCreated:Ke},null,8,["app-id","access-key"]),a(A,{open:T.value,"onUpdate:open":e[14]||(e[14]=t=>T.value=t),title:"同步草稿箱",width:478,onOk:Xe},{default:n(()=>[s("div",xo,[e[23]||(e[23]=s("div",{class:"sync-desc-box"}," 由于微信限制了草稿箱每日同步接口次数，为防止同步草箱时出现接口超限的情况，您可以根据个人业务选择草稿箱的同步条数 ",-1)),e[24]||(e[24]=s("div",{class:"sync-select-title"},"选择同步条数",-1)),s("div",wo,[a(Ze,{min:0,max:3,step:null,value:Q.value,"onUpdate:value":e[13]||(e[13]=t=>Q.value=t),marks:je,tooltipOpen:!1},null,8,["value"])])])]),_:1},8,["open"])])}}},Bo=tt(Co,[["__scopeId","data-v-c6e5985e"]]);export{Bo as default};
