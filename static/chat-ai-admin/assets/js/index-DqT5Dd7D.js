import{N as L,O as g,F as H,a1 as Y,X as a,_ as x,a0 as w,j as n,U as l,d as C,b as E,z as B,q as K,S as W,W as N,u as D,a2 as F,a6 as X,Z}from"./vue-chunks-BRsu9_To.js";import{b as q,d as Q,k as O,bE as M,bK as R,M as S,bG as ee,dJ as te,l as ae,B as oe,a0 as ne,bH as se,E as re,bJ as ie}from"../../index-DGlN_gTP.js";import{M as le,_ as de}from"./index-D35sYO_B.js";import"./index-Jd-vOpFR.js";import{D as _e}from"./dropdown-0QsfqJqV.js";import{t as ce}from"./validate-8MtiUsxW.js";import{A as pe}from"./avatar-input-BXGNXsqY.js";import{F as I,_ as me}from"./index-vDDFetvc.js";import"./index-JAP4Oum8.js";import{I as ue}from"./Input-BpI49rDY.js";import{_ as fe}from"./TextArea-BNOG6RQ7.js";import{_ as ye}from"./page-alert-Bz3nV4Vs.js";import{P as ve}from"./PlusOutlined-D8SGrPLQ.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./shallowequal-C0xnIuy8.js";import"./Trigger-oBKhEx1B.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-Ccxw2gRU.js";import"./index-k9nX7Zez.js";import"./index-BQDPftJ3.js";import"./colors-DKWwHq2l.js";import"./RightOutlined-TchQhXHc.js";import"./move-BSoEcIoa.js";import"./index-3U3efXj8.js";import"./Password-B9FCv-aw.js";import"./inputProps-Bu_dzA3C.js";import"./DownloadOutlined-3aTO680L.js";import"./CheckOutlined-B_Hs0-OP.js";import"./FormItemContext-DAoPsdM7.js";import"./isPlainObject-51jSOJKV.js";import"./responsiveObserve-BLoLQTqt.js";import"./QuestionCircleOutlined-Bvo9_S3-.js";import"./index-C0cXlrXm.js";import"./Search-CH76L-gx.js";import"./SearchOutlined-DSY7YbKD.js";const be={class:"list-box"},ge=["onClick"],he={class:"library-info"},ke=["src"],xe={class:"library-info-content"},Le={class:"library-title"},we={class:"item-body"},Ce={class:"library-desc"},$e={class:"item-footer"},Ae={class:"library-size"},De={class:"text-item"},Oe={class:"text-item"},qe=["onClick"],Be=["onClick"],Ne={__name:"index",props:{list:{type:Array,default:()=>[]},showCreate:{type:Boolean,default:!0}},emits:["add","edit","delete"],setup($,{emit:h}){const y=h,m=$,_=d=>{y("edit",d)},c=d=>{y("delete",d)};return(d,p)=>{const u=Q,v=de,e=le,i=_e;return g(),L("div",be,[(g(!0),L(H,null,Y(m.list,t=>(g(),L("div",{class:"list-item-wrapper",key:t.id},[a("div",{class:"list-item",onClick:w(s=>_(t),["stop"])},[a("div",he,[a("img",{class:"library-icon",src:t.avatar,alt:""},null,8,ke),a("div",xe,[a("div",Le,x(t.library_name),1)])]),a("div",we,[a("div",Ce,x(t.library_intro),1)]),a("div",$e,[a("div",Ae,[a("span",De,"文档："+x(t.file_total),1),a("span",Oe,"大小："+x(t.file_size_str),1)]),a("div",{class:"action-box",onClick:p[1]||(p[1]=w(()=>{},["stop"]))},[n(i,null,{overlay:l(()=>[n(e,null,{default:l(()=>[n(v,null,{default:l(()=>[a("a",{href:"javascript:;",onClick:w(s=>_(t),["stop"])},"管 理",8,qe)]),_:2},1024),n(v,null,{default:l(()=>[a("a",{class:"delete-text-color",href:"javascript:;",onClick:s=>c(t)},"删 除",8,Be)]),_:2},1024)]),_:2},1024)]),default:l(()=>[a("div",{class:"action-item",onClick:p[0]||(p[0]=w(()=>{},["stop"]))},[n(u,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,ge)]))),128))])}}},Ie=q(Ne,[["__scopeId","data-v-8d366fcc"]]),Ee={class:"form-box"},Fe={__name:"add-library-model",setup($,{expose:h}){O.config({duration:2});const y=F(),m=C(!1),_=E(()=>1);let c="",d="";const p=I.useForm,u=C(!1),v=_.value==0?M:R,e=B({type:_.value,access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:v,avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:_.value==2?1:0,qa_index_type:1,doc_auto_renew_frequency:1}),i=B({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:t,validateInfos:s}=p(e,i),k=o=>{e.avatar=o.imageUrl,e.avatar_file=o.file},T=()=>{m.value=!1},P=()=>{t().then(()=>{U()}).catch(o=>{})},U=()=>{let o=new FormData,r=JSON.parse(JSON.stringify(e));o.append("type",e.type),o.append("access_rights",e.access_rights),o.append("library_name",e.library_name),o.append("library_intro",e.library_intro),o.append("use_model",r.use_model),o.append("model_config_id",e.model_config_id),o.append("avatar",e.avatar_file?e.avatar_file:""),o.append("is_offline",e.is_offline),o.append("urls",JSON.stringify(ce(e.urls))),o.append("doc_type",e.doc_type),o.append("file_name",e.file_name),o.append("is_qa_doc",e.is_qa_doc),o.append("qa_index_type",e.qa_index_type),o.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),u.value=!0,ee(o).then(b=>{O.success("创建成功"),d=b.data.id,c=b.data.library_key,V(b.data.id)}).catch(()=>{u.value=!1})},z=async()=>await te({library_key:c,doc_id:"",doc_type:"4",pid:0,title:"无标题文档",content:"# 无标题文档",sort:0}),V=()=>{z().then(o=>{let r=o.data.doc_id;y.replace({path:"/public-library/editor",query:{library_id:d,library_key:c,doc_id:r}})})};return h({show:()=>{m.value=!0}}),K(()=>{}),(o,r)=>{const b=ue,A=me,J=fe,j=I,G=S;return g(),W(G,{open:m.value,"onUpdate:open":r[3]||(r[3]=f=>m.value=f),title:"添加知识库",onOk:P,confirmLoading:u.value,onCancel:T,width:"640px"},{default:l(()=>[a("div",Ee,[n(j,{"label-col":{span:5}},{default:l(()=>[n(A,N({ref:"name",label:"知识库名称"},D(s).library_name),{default:l(()=>[n(b,{value:e.library_name,"onUpdate:value":r[0]||(r[0]=f=>e.library_name=f),type:"text",placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),n(A,{label:"知识库简介"},{default:l(()=>[n(J,{maxlength:1e3,value:e.library_intro,"onUpdate:value":r[1]||(r[1]=f=>e.library_intro=f),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),n(A,N({ref:"name",label:"知识库封面"},D(s).avatar),{default:l(()=>[n(pe,{value:e.avatar,"onUpdate:value":r[2]||(r[2]=f=>e.avatar=f),onChange:k},null,8,["value"]),r[4]||(r[4]=a("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1,__:[4]},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Me=q(Fe,[["__scopeId","data-v-17846dfc"]]),Re={"bg-color":"#f5f9ff",class:"library-page"},Se={class:"library-page-body"},Te={class:"list-toolbar"},Pe={class:"toolbar-box"},Ue={class:"list-total"},ze={key:0,class:"toolbar-box"},Ve={__name:"index",setup($){let{role_permission:h,role_type:y}=ae();const m=E(()=>y==1||h.includes("CreateOpenLibDoc"));F();const _=C(null),c=C([]),d=()=>{ne({type:1}).then(i=>{let t=i.data||[];t.forEach(s=>{s.file_size_str=se(s.file_size),s.avatar||(s.avatar=s.type==0?M:R)}),c.value=t})};d();const p=()=>{_.value.show()},u=i=>{window.open(`/#/public-library/home?library_id=${i.id}&library_key=${i.library_key}`,"_blank","noopener")},v=i=>{let t=3,s=S.confirm({title:`删除${i.library_name}`,icon:n(re),content:"您确定要删除此知识库吗？",okText:t+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){e(i)},onCancel(){}}),k=setInterval(()=>{t==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(k),k=void 0):(t-=1,s.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:i})=>{ie({id:i}).then(()=>{O.success("删除成功"),d()})};return(i,t)=>{const s=oe;return g(),L("div",Re,[t[3]||(t[3]=a("div",{class:"page-title"},"对外文档",-1)),n(ye,{style:{"margin-bottom":"16px"},title:"使用说明"},{default:l(()=>t[1]||(t[1]=[a("div",null,[a("p",null," 1、对外文档作为在线文档创作管理工具，创作的文档既可作为知识库关联到机器人使用，也可分享给好友查看。 "),a("p",null,"2、支持设置每篇文档的title、description、keyword，提高SEO搜索权重。")],-1)])),_:1,__:[1]}),a("div",Se,[a("div",Te,[a("div",Pe,[a("h3",Ue,"全部 ("+x(c.value.length)+")",1)]),m.value?(g(),L("div",ze,[n(s,{type:"primary",onClick:t[0]||(t[0]=k=>p())},{icon:l(()=>[n(D(ve))]),default:l(()=>[t[2]||(t[2]=Z(" 新建对外文档 "))]),_:1,__:[2]})])):X("",!0)]),a("div",null,[n(Ie,{list:c.value,onAdd:p,onEdit:u,onDelete:v},null,8,["list"])])]),n(Me,{ref_key:"addLibraryModelRef",ref:_},null,512)])}}},qt=q(Ve,[["__scopeId","data-v-c653e54c"]]);export{qt as default};
