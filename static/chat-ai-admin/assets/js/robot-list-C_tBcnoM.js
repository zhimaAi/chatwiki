import{_ as D,L as X,e as A,M as O,I as N,c as W,J as Y,d as tt,E as ot}from"../../index-BokOG9ZU.js";import{r as u,w as et,L as _,M as y,j as n,Q as d,P as I,u as w,V as o,a3 as E,a4 as K,$ as Q,A as q,a2 as J,a8 as j,U,k as at,b as z,v as st,F as nt,a1 as rt,a7 as B,Y as S,X as G}from"./vue-chunks-XoCroLmQ.js";import{s as it,g as lt,d as ct}from"./index-_RnYw74I.js";import{c as pt}from"./index-DsZKODME.js";import{F as Z,_ as dt}from"./index-fISAHuLd.js";import{P as _t}from"./PlusOutlined-B3xrJfbK.js";import{_ as ut}from"./index-CAuXv0Mv.js";import"./index-BitUTYbL.js";import{I as mt}from"./Input-CUxLS_nc.js";import{_ as vt}from"./TextArea-TiJWDxF4.js";import{T as ft,_ as bt}from"./index-CTUPCv9m.js";import{P as gt}from"./PlusCircleOutlined-CnpFxBqO.js";import{M as Ct}from"./MoreOutlined-VR11ODEV.js";import{_ as ht,M as kt}from"./index-CvsTLiPQ.js";import"./index-mOJL8w2K.js";import{D as yt}from"./dropdown-_4lkCpvo.js";import"./dayjs-D8VPPBbu.js";import"./axios-Cm0UX6qg.js";import"./qs-D73tJGQG.js";import"./crypto-js-D323TfIu.js";import"./colors-Cfqlh7qR.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./responsiveObserve-Cyut9UHK.js";import"./collapseMotion-DWwsCVG2.js";import"./index-BOYSy9Pq.js";import"./QuestionCircleOutlined-DEWzrvxy.js";import"./FormItemContext-Ch_K4tn1.js";import"./partition-CenmkQe8.js";import"./Password-D_H-hnpK.js";import"./inputProps-CWzf5mAp.js";import"./CheckOutlined-Byfa85ke.js";import"./useRefs-C13sH2-_.js";import"./index-Co375E0k.js";import"./Search-CbUpX_hw.js";import"./SearchOutlined-BfUHdq7e.js";import"./index-CnyiohbP.js";import"./Dropdown-aJrAR27s.js";import"./pick-CWDMpHLW.js";import"./isMobile-D_4OiXLP.js";import"./slide-BpJSAeCl.js";import"./shallowequal-BeorLzKa.js";import"./RightOutlined-CViLB99g.js";import"./move-ChusaJh2.js";const wt="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2040%2040'%20class='design-iconfont'%3e%3cpath%20d='M31.6194%2022.1391H15.7352C13.316%2022.1391%2011.3545%2020.1776%2011.3545%2017.7584V9.9027C11.3545%207.48352%2013.316%205.52197%2015.7352%205.52197H31.6194C34.0386%205.52197%2036.0001%207.48352%2036.0001%209.9027V17.7584C36.0001%2020.1776%2034.0386%2022.1391%2031.6194%2022.1391Z'%20fill='%232475FC'/%3e%3cpath%20d='M27.6433%2029.4327H19.9034L13.3845%2034.178C12.4009%2034.8939%2010.9673%2034.2483%2010.9521%2033.0843L10.9084%2029.4327H9.1918C6.32448%2029.4327%204.00024%2027.2604%204.00024%2024.583V14.8075C4.00024%2012.1282%206.32448%209.95776%209.1918%209.95776H27.6452C30.5125%209.95776%2032.8367%2012.1301%2032.8367%2014.8075V24.5811C32.8367%2027.2604%2030.5125%2029.4327%2027.6433%2029.4327Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M25.5317%2018.6604H10.9482C10.1792%2018.6604%209.55444%2018.0375%209.55444%2017.2666C9.55444%2016.4956%2010.1773%2015.8728%2010.9482%2015.8728H25.5317C26.3007%2015.8728%2026.9254%2016.4956%2026.9254%2017.2666C26.9254%2018.0375%2026.3007%2018.6604%2025.5317%2018.6604ZM17.3%2024.3475H10.9482C10.1792%2024.3475%209.55444%2023.7247%209.55444%2022.9537C9.55444%2022.1828%2010.1773%2021.56%2010.9482%2021.56H17.3C18.069%2021.56%2018.6938%2022.1828%2018.6938%2022.9537C18.6938%2023.7247%2018.069%2024.3475%2017.3%2024.3475Z'%20fill='%23fff'/%3e%3c/svg%3e",xt="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2040%2040'%20class='design-iconfont'%3e%3cpath%20d='M30.125%207.625C31.9152%207.625%2033.6321%208.33616%2034.898%209.60203C36.1638%2010.8679%2036.875%2012.5848%2036.875%2014.375C36.875%2016.1652%2036.1638%2017.8821%2034.898%2019.148C33.6321%2020.4138%2031.9152%2021.125%2030.125%2021.125H26.75V18.875H30.125C31.2603%2018.8754%2032.3538%2018.4466%2033.1862%2017.6746C34.0187%2016.9027%2034.5286%2015.8446%2034.6138%2014.7125L34.625%2014.375C34.625%2013.1815%2034.1509%2012.0369%2033.307%2011.193C32.4631%2010.3491%2031.3185%209.875%2030.125%209.875H26.75V7.625H30.125ZM11%2017.75C9.20979%2017.75%207.4929%2018.4612%206.22703%2019.727C4.96116%2020.9929%204.25%2022.7098%204.25%2024.5C4.25%2026.2902%204.96116%2028.0071%206.22703%2029.273C7.4929%2030.5388%209.20979%2031.25%2011%2031.25H14.375V29H11C9.8647%2029.0004%208.77122%2028.5716%207.93877%2027.7996C7.10631%2027.0277%206.5964%2025.9696%206.51125%2024.8375L6.5%2024.5C6.5%2023.3065%206.97411%2022.1619%207.81802%2021.318C8.66193%2020.4741%209.80653%2020%2011%2020H14.375V17.75H11Z'%20fill='%232475FC'/%3e%3cpath%20d='M13.25%204.25H26.75C28.25%204.25%2029%205%2029%206.5V11C29%2012.5%2028.25%2013.25%2026.75%2013.25H13.25C11.75%2013.25%2011%2012.5%2011%2011V6.5C11%205%2011.75%204.25%2013.25%204.25Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M13.25%2015.5H26.75C28.25%2015.5%2029%2016.25%2029%2017.75V22.25C29%2023.75%2028.25%2024.5%2026.75%2024.5H13.25C11.75%2024.5%2011%2023.75%2011%2022.25V17.75C11%2016.25%2011.75%2015.5%2013.25%2015.5Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M13.25%2026.75H26.75C28.25%2026.75%2029%2027.5%2029%2029V33.5C29%2035%2028.25%2035.75%2026.75%2035.75H13.25C11.75%2035.75%2011%2035%2011%2033.5V29C11%2027.5%2011.75%2026.75%2013.25%2026.75Z'%20fill='%232475FC'/%3e%3c/svg%3e",Lt=i=>(E("data-v-60ead55d"),i=i(),K(),i),Mt={class:"avatar-uploader"},$t=["src"],Ft={key:1},Ht=Lt(()=>o("div",{class:"ant-upload-text"},"上传照片",-1)),Vt=["src"],It={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(i,{emit:$}){function f(t){return new Promise((s,a)=>{const c=new FileReader;c.readAsDataURL(t),c.onload=()=>s(c.result),c.onerror=m=>a(m)})}const x=$,b=i,l=u([]),e=u(!1),h=u("");et(()=>b.value,t=>{h.value=t},{immediate:!0});const L=Z.useInjectFormItemContext(),g=()=>{let t={imageUrl:h.value,file:l.value[0].originFileObj};x("change",t),x("update:value",t.imageUrl),L.onFieldChange()},F=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(l.value=[t],f(t).then(c=>{h.value=c,e.value=!1,g()}),!1):(A.error("机器人头像图片大小不能超过100kb"),!1):(A.error("机器人头像只支持JPG、PNG格式的图片"),!1),C=u(!1),M=u(""),k=u(""),H=()=>{C.value=!1,k.value=""},r=async t=>{!t.url&&!t.preview&&(t.preview=await f(t.originFileObj)),M.value=t.url||t.preview,C.value=!0,k.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,s)=>{const a=ut,c=O;return _(),y("div",Mt,[n(a,{"file-list":l.value,"onUpdate:fileList":s[0]||(s[0]=m=>l.value=m),"list-type":"picture-card","show-upload-list":!1,"before-upload":F,accept:".jpg,.png,.jpeg",onPreview:r},{default:d(()=>[i.value?(_(),y("img",{key:0,class:"avatar",src:i.value,alt:"avatar"},null,8,$t)):(_(),y("div",Ft,[e.value?(_(),I(w(X),{key:0})):(_(),I(w(_t),{key:1})),Ht]))]),_:1},8,["file-list"]),n(c,{open:C.value,title:k.value,footer:null,onCancel:H},{default:d(()=>[o("img",{alt:"example",style:{width:"100%"},src:M.value},null,8,Vt)]),_:1},8,["open","title"])])}}},At=D(It,[["__scopeId","data-v-60ead55d"]]),P=i=>(E("data-v-b0940312"),i=i(),K(),i),Pt={class:"form-box"},Rt={class:"robot-type-box"},Ot=P(()=>o("div",{class:"avatar-box"},[o("img",{src:wt,alt:""}),o("div",{class:"robot-item-title"},"聊天机器人")],-1)),Tt=P(()=>o("div",{class:"desc"},"简易的基于LLM和知识库的聊天应用，配置简单，适合新人上手",-1)),Ut=P(()=>o("div",{class:"avatar-box"},[o("img",{src:xt,alt:""}),o("div",{class:"robot-item-title"},"工作流")],-1)),Bt=P(()=>o("div",{class:"desc"},"可编排的任务工作流，将任务拆解成多个步骤逐步执行",-1)),St=P(()=>o("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),jt={__name:"add-robot-alert",setup(i,{expose:$}){const f=Q(),x=Z.useForm,b=u(!1),l=u(!1),e=q({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),h=q({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:L,validateInfos:g,clearValidate:F}=x(e,h),C=s=>{e.robot_avatar=s.file},M=()=>{let s={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||N};l.value=!0,it(s,e.application_type).then(a=>{if(l.value=!1,a.res!=0)return A.error(a.msg);A.success("机器人创建成功"),e.application_type==0?f.push("/robot/config/basic-config?id="+a.data.id+"&robot_key="+a.data.robot_key):f.push("/robot/config/workflow?id="+a.data.id+"&robot_key="+a.data.robot_key)}).catch(()=>{l.value=!1})},k=async()=>{let s=await pt({model_type:"LLM"});return!s||s.data.length==0?(O.confirm({title:"请先添加LLM模型服务商?",icon:at(Y,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){f.push("/user/model")},onCancel(){}}),!1):!0},H=async()=>{await k()&&(e.robot_avatar="",e.robot_avatar_url=N,e.robot_name="",e.robot_intro="",b.value=!0)},r=()=>{F()},t=()=>{L().then(()=>{M()}).catch(s=>{})};return $({open:H}),(s,a)=>{const c=W,m=dt,T=mt,R=vt,p=Z,V=O;return _(),I(V,{width:"746px",open:b.value,"onUpdate:open":a[5]||(a[5]=v=>b.value=v),confirmLoading:l.value,title:"新建机器人",onOk:t,onCancel:r},{default:d(()=>[o("div",Pt,[n(p,{layout:"vertical"},{default:d(()=>[n(m,{label:"应用类型",required:""},{default:d(()=>[o("div",Rt,[o("div",{class:J(["robot-item",{active:e.application_type==0}]),onClick:a[0]||(a[0]=v=>e.application_type=0)},[e.application_type==0?(_(),I(c,{key:0,class:"check-arrow",name:"check-arrow-filled"})):j("",!0),Ot,Tt],2),o("div",{class:J(["robot-item",{active:e.application_type==1}]),onClick:a[1]||(a[1]=v=>e.application_type=1)},[e.application_type==1?(_(),I(c,{key:0,class:"check-arrow",name:"check-arrow-filled"})):j("",!0),Ut,Bt],2)])]),_:1}),n(m,U({ref:"name",label:"应用名称"},w(g).robot_name),{default:d(()=>[n(T,{value:e.robot_name,"onUpdate:value":a[2]||(a[2]=v=>e.robot_name=v),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16),n(m,U({label:"简介"},w(g).robot_intro),{default:d(()=>[n(R,{rows:3,value:e.robot_intro,"onUpdate:value":a[3]||(a[3]=v=>e.robot_intro=v),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),n(m,U({ref:"name",label:"机器人头像"},w(g).robot_avatar_url),{default:d(()=>[n(At,{value:e.robot_avatar_url,"onUpdate:value":a[4]||(a[4]=v=>e.robot_avatar_url=v),onChange:C},null,8,["value"]),St]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Zt=D(jt,[["__scopeId","data-v-b0940312"]]),Dt=i=>(E("data-v-e3f02239"),i=i(),K(),i),Et={class:"robot-page"},Kt={class:"list-box"},Nt={key:0,class:"list-item-wrapper"},qt=Dt(()=>o("span",{class:"add-text"},"新增应用",-1)),Jt=["onClick"],zt={class:"list-item"},Gt=["onClick"],Wt={class:"robot-info"},Qt=["src"],Xt={class:"robot-info-content"},Yt={class:"robot-name"},to={class:"robot-desc"},oo={class:"robot-type-tag"},eo=["onClick"],ao=["onClick"],so={__name:"robot-list",setup(i){const $=tt();let{role_permission:f}=$;const x=z(()=>f.includes("RobotCreate")),b=Q(),l=u("2"),e=u([]),h=z(()=>l.value==2?e.value:e.value.filter(r=>r.application_type==l.value)),L=()=>{lt().then(r=>{e.value=r.data}).catch(()=>{})},g=u(null),F=()=>{g.value.open()},C=({id:r,robot_key:t,application_type:s})=>{s==0?b.push({path:"/robot/config/basic-config",query:{id:r,robot_key:t}}):b.push({path:"/robot/config/workflow",query:{id:r,robot_key:t}})},M=r=>{let t=3,s=O.confirm({title:`删除机器人${r.robot_name}`,icon:n(ot),content:"您确定要删除此机器人吗？",okText:t+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){k(r)},onCancel(){}}),a=setInterval(()=>{t==1?(s.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(a),a=void 0):(t-=1,s.update({okText:t+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},k=({id:r})=>{ct({id:r}).then(()=>{A.success("删除成功"),L()})},H=r=>{window.open(`#/robot/test?robot_key=${r.robot_key}&id=${r.id}`)};return st(()=>{L()}),(r,t)=>{const s=bt,a=ft,c=ht,m=kt,T=yt,R=W;return _(),y("div",Et,[n(a,{activeKey:l.value,"onUpdate:activeKey":t[0]||(t[0]=p=>l.value=p)},{default:d(()=>[n(s,{key:"2",tab:"全部"}),n(s,{key:"0",tab:"聊天机器人"}),n(s,{key:"1",tab:"工作流"})]),_:1},8,["activeKey"]),o("div",Kt,[x.value?(_(),y("div",Nt,[o("div",{class:"list-item add-robot",onClick:F},[n(w(gt),{class:"add-icon"}),qt])])):j("",!0),(_(!0),y(nt,null,rt(h.value,p=>(_(),y("div",{class:"list-item-wrapper",key:p.id,onClick:V=>C(p)},[o("div",zt,[o("span",{class:"item-action",onClick:t[2]||(t[2]=B(()=>{},["stop"]))},[n(T,null,{overlay:d(()=>[n(m,null,{default:d(()=>[n(c,null,{default:d(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:V=>M(p)},"删 除",8,Gt)]),_:2},1024)]),_:2},1024)]),default:d(()=>[o("span",{class:"menu-btn",onClick:t[1]||(t[1]=B(()=>{},["stop"]))},[n(w(Ct))])]),_:2},1024)]),o("div",Wt,[o("img",{class:"robot-avatar",src:p.robot_avatar,alt:""},null,8,Qt),o("div",Xt,[o("div",Yt,S(p.robot_name),1)])]),o("div",to,S(p.robot_intro),1),o("div",oo,S(p.application_type==0?"聊天机器人":"工作流"),1),o("div",{class:"robot-action",onClick:t[3]||(t[3]=B(()=>{},["stop"]))},[o("div",{class:"robot-action-item",onClick:V=>C(p)},[n(R,{class:"action-icon",name:"jibenpeizhi"}),G(" 管理")],8,eo),o("div",{class:"robot-action-item",onClick:V=>H(p)},[n(R,{class:"action-icon",name:"cmd"}),G(" 测试")],8,ao)])])],8,Jt))),128))]),n(Zt,{ref_key:"addRobotAlertRef",ref:g},null,512)])}}},Go=D(so,[["__scopeId","data-v-e3f02239"]]);export{Go as default};
