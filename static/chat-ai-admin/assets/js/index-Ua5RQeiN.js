import{am as ue,r as X,f as C,d as fe,e as me,o as ie,ac as f,ad as u,F as Z,ae as Y,az as P,k as l,ar as y,G as O,at as i,u as o,l as ge,as as e,n as ye,A as ke,ax as se,ai as pe,ah as be,ak as xe,w as le,aI as we,aB as de,b as $e}from"./vue-chunks-CGLjTDrY.js";import{ag as Se,bS as Le,bc as Ce,bT as Ae,f as Ne,b as ae,d as re,bU as Ue,_ as D,bE as Ie,bh as te,A as qe,ax as Me,ay as Te,az as Be}from"../../index-DxV-PNCd.js";import{W as Re}from"./index-igCyWfr0.js";import{u as Oe}from"./useEventBus-CB_rGuu7.js";import{M as _e}from"./model-select-CjmsccZQ.js";import{am as ze,B as Fe,aA as Ee,T as Ve,v as he,ah as W,Q as je,w as Ke,x as Pe,$ as Je,aF as He,O as We,M as Qe,b as ne,I as Ge,V as Ye,N as Xe,bn as Ze}from"./ui-antd-AfNpv4wx.js";import{M as De}from"./editor-code-BLYX-bNv.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./index-w0T-47HX.js";const et=ue("searchStore",{state:()=>({indeterminate:!1,checkAll:!1,checkedList:[],activeKey:"all"}),getters:{getIndeterminate(){return this.indeterminate},getCheckAll(){return this.checkAll},getCheckedList(){return this.checkedList},getActiveKey(){return this.activeKey}},actions:{setIndeterminate(k){this.indeterminate=k},setCheckAll(k){this.checkAll=k},setCheckedList(k){this.checkedList=k},setActiveKey(k){this.activeKey=k}},persist:{enabled:!0,strategies:[{key:"searchStore",storage:localStorage,paths:["indeterminate","checkAll","checkedList","activeKey"]}]}}),ve=ue("search-lirary",()=>{const k=Oe(),d=X({reasoning_content:"",show_reasoning:!1,content:"",quote_file:[],id:"",finish:!1,debug:[],error:[],recall_time:0,request_time:0,loading:!1});let h=null;const s=C(0),z=C(""),S=X({context_pair:"",create_time:"",id:"",max_token:"",model_config_id:"",rerank_model_config_id:"",rerank_status:"",rerank_use_model:"",search_type:"",similarity:"",size:"",temperature:"",update_time:"",use_model:"",user_id:"",summary_switch:0}),A=(L,_)=>{if(L=="reasoning_content"){let r=d.reasoning_content||"";d.reasoning_content=r+_,d.show_reasoning=!0}if(L=="sending"){let r=d.content||"";d.content=r+_}if(L=="quote_file"&&(d.quote_file=_.length>0?_:[]),L=="ai_message"){if(_.menu_json&&_.msg_type==2){let r=JSON.parse(_.menu_json);d.question=r.question}d.id=_.id,d.content=_.content,_.quote_file&&typeof _.quote_file=="string"&&(d.quote_file=JSON.parse(_.quote_file))}L=="finish"&&(d.finish=!0),L=="debug"&&(d.debug=_.length>0?_:[]),L=="error"&&(d.error=_.length>0?_:[]),L=="recall_time"&&(d.recall_time=_||0),L=="request_time"&&(d.request_time=_||0),k.emit("updateAiMessage",d)},U=()=>{d.loading=!1};return{searchFormState:S,dialogue_id:s,openid:z,messageObj:d,getLibrarySearchFn:async()=>{h&&(h.abort(),h=null);const L=await Ae();try{let _=L.data;Object.assign(S,{..._})}catch(_){Promise.reject(_)}return L},searchMessage:(L,_,r)=>{Se(32),d.content="",d.finish=!1;let I={model_config_id:r.model_config_id,use_model:r.use_model,temperature:r.temperature,max_token:r.max_token,size:r.size,similarity:r.similarity,search_type:r.search_type,question:L,id:_.join(","),recall_type:1,summary_switch:r.summary_switch};r.rerank_status&&(I.rerank_status=r.rerank_status),r.rerank_use_model&&(I.rerank_use_model=r.rerank_use_model),r.prompt&&(I.prompt=r.prompt),r.rerank_status==1&&(I.rerank_model_config_id=r.rerank_model_config_id),h=Le(I),h.onMessage=g=>{if(g.event!=="sending"&&Ce(g),g.event=="dialogue_id"&&(s.value=g.data),g.event=="reasoning_content"&&A("reasoning_content",g.data),g.event=="sending"&&A("sending",g.data),g.event=="ai_message"){let T=JSON.parse(g.data);A("ai_message",T)}if(g.event=="quote_file"){let T=JSON.parse(g.data);A("quote_file",T)}if(g.event=="finish"&&A("finish",g.data),g.event=="debug"){let T=JSON.parse(g.data);A("debug",T)}if(g.event=="error"){let T=g.data;A("error",T)}if(g.event=="recall_time"){let T=g.data;A("recall_time",T)}},h.onClose=()=>{U(),h=null}}}}),tt={class:"prompt-form"},st={class:"prompt-form-label"},at={class:"form-item"},ot={class:"form-item-label"},nt={class:"prompt-form-item"},lt={class:"prompt-form-item-label"},it={class:"prompt-form-item"},rt={class:"prompt-form-item-label"},ct={class:"prompt-form-item-content"},dt={key:0,class:"prompt-form-item-tip"},_t={class:"prompt-form-item"},ut={class:"prompt-form-item-label"},mt={class:"form-item-body"},pt={class:"number-box"},ht={class:"number-slider-box"},vt={class:"number-input-box"},ft={class:"prompt-form-item"},gt={class:"prompt-form-item-label"},yt={class:"form-item-body"},kt={class:"number-box"},bt={class:"number-slider-box"},xt={class:"number-input-box"},wt={class:"recall-settings-box"},$t={class:"form-box prompt-form"},St={class:"prompt-form-label"},Lt={class:"form-item is-required"},Ct={class:"form-item-label"},At={class:"form-item-body"},Nt={class:"retrieval-mode-items"},Ut=["onClick"],It={class:"retrieval-mode-title"},qt={class:"title-text"},Mt={class:"retrieval-mode-desc"},Tt={key:0,class:"form-item"},Bt={class:"form-item"},Rt={class:"form-item-label"},Ot={class:"form-item-body"},zt={class:"number-box"},Ft={class:"number-slider-box"},Et={class:"number-input-box"},Vt={key:1,class:"form-item"},jt={class:"form-item-label"},Kt={class:"form-item-body"},Pt={class:"number-box"},Jt={class:"number-slider-box"},Ht={class:"number-input-box"},Wt={class:"form-item"},Qt={class:"form-item-label"},Gt={key:0,class:"form-item-body"},Yt=fe({__name:"search-drawer",setup(k){let{role_permission:d,role_type:h}=Ne();const{t:s}=ae("views.library-search.components.search-drawer"),z=me(()=>h==1||d.includes("SearchSets")),S=ve(),{getLibrarySearchFn:A}=S,U=C([{iconName:"mix-icon",title:s("hybrid_retrieval"),value:1,isRecommendation:!0,desc:s("hybrid_retrieval_desc")},{iconName:"vector-icon",title:s("vector_retrieval"),value:2,desc:s("vector_retrieval_desc")},{iconName:"graph-icon",title:s("graph_retrieval"),value:4,desc:s("graph_retrieval_desc")},{iconName:"search-check-icon",title:s("full_text_retrieval"),value:3,desc:s("full_text_retrieval_desc")}]),N=C(!1),a=X({use_model:"",model_config_id:"",prompt_type:"0",prompt:"",temperature:.5,max_token:2e3,context_pair:0,search_type:1,top_k:5,size:0,similarity:.4,rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,summary_switch:0,rrf_weight:{}}),L=()=>{b()},_=C([]),r=w=>{if(_.value=w,(!a.model_config_id||!a.use_model)&&_.value.length>0){let t=_.value[0];if(t){let B=t.children[0];a.use_model=B.name,a.model_config_id=B.model_config_id}}},I=w=>{a.search_type=w,b()},g=w=>{let t={...w};t.max_token=parseFloat(t.max_token),t.temperature=parseFloat(t.temperature),t.context_pair=parseFloat(t.context_pair),t.search_type=parseFloat(t.search_type),t.rerank_status=parseFloat(t.rerank_status),t.similarity=parseFloat(t.similarity),t.top_k=parseFloat(t.size),t.summary_switch=+t.summary_switch,t.rerank_use_model===""&&(t.rerank_use_model=void 0),t.rrf_weight=t.rrf_weight?JSON.parse(t.rrf_weight):t.rrf_weight,Object.keys(t).forEach(B=>{a[B]=t[B]})},m=((w,t)=>{let B;return function(...$){const M=()=>{clearTimeout(B),w(...$)};clearTimeout(B),B=setTimeout(M,t)}})(()=>{b()},500),b=()=>{let w={...a};if(!w.prompt&&a.prompt_type=="1")return ne.error(s("enter_custom_prompt"));w.rrf_weight=JSON.stringify(a.rrf_weight),(a.search_type==3||a.search_type==4)&&delete w.similarity,a.prompt_type=="0"&&delete w.prompt,w.size=w.top_k,Ue(w).then(t=>{ne.success(s("save_success"))})},E=C(!1),c=C(""),x=()=>{a.prompt_type=="1"?(c.value=a.prompt,E.value=!0):b()},F=()=>{if(c.value)a.prompt=c.value,E.value=!1,b();else return ne.error(s("enter_prompt"))},K=()=>{a.prompt_type="0",E.value=!1},Q=w=>{},q=async()=>{let w=await A();g(w.data),N.value=!0};return ie(()=>{}),(w,t)=>{const B=Fe,p=he,$=je,M=Ve,R=Pe,J=Ke,v=Je,j=He,H=We,G=re,ce=Qe,ee=Ee;return u(),f(Z,null,[z.value?(u(),Y(B,{key:0,onClick:q,icon:ge(o(ze))},{default:y(()=>[O(i(o(s)("search_settings")),1)]),_:1},8,["icon"])):P("",!0),l(ee,{open:N.value,"onUpdate:open":t[19]||(t[19]=n=>N.value=n),class:"custom-class","root-class-name":"root-class-name",title:o(s)("search_settings"),width:"472",placement:"right",onAfterOpenChange:Q},{default:y(()=>[e("div",tt,[e("div",st,i(o(s)("model_settings")),1),e("div",at,[e("div",ot,[l(M,{align:"center"},{default:y(()=>[e("span",null,i(o(s)("ai_intelligent_summary")),1),l(p,null,{title:y(()=>[O(i(o(s)("ai_summary_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1}),l($,{style:{"margin-left":"24px"},onChange:b,checked:a.summary_switch,"onUpdate:checked":t[0]||(t[0]=n=>a.summary_switch=n),checkedValue:1,unCheckedValue:0,checkedChildren:o(s)("on"),unCheckedChildren:o(s)("off")},null,8,["checked","checkedChildren","unCheckedChildren"])]),_:1})])]),ye(e("div",null,[e("div",nt,[e("div",lt,[t[20]||(t[20]=e("span",{style:{color:"red"}},"* ",-1)),e("span",null,i(o(s)("model_selection")),1)]),l(_e,{modelType:"LLM",modeName:a.use_model,"onUpdate:modeName":t[1]||(t[1]=n=>a.use_model=n),modeId:a.model_config_id,"onUpdate:modeId":t[2]||(t[2]=n=>a.model_config_id=n),style:{width:"100%"},onLoaded:r,onChange:L},null,8,["modeName","modeId"])]),e("div",it,[e("div",rt,[t[21]||(t[21]=e("span",{style:{color:"red"}},"* ",-1)),e("span",null,i(o(s)("prompt")),1)]),l(J,{value:a.prompt_type,"onUpdate:value":t[3]||(t[3]=n=>a.prompt_type=n),onChange:x},{default:y(()=>[l(R,{value:"0"},{default:y(()=>[O(i(o(s)("default_prompt")),1)]),_:1}),l(R,{value:"1"},{default:y(()=>[O(i(o(s)("custom_prompt")),1)]),_:1})]),_:1},8,["value"]),e("div",ct,[a.prompt_type=="0"?(u(),f("div",dt,i(o(s)("default_prompt_tip")),1)):(u(),Y(v,{key:1,onBlur:b,maxLength:500,style:{height:"80px"},value:a.prompt,"onUpdate:value":t[4]||(t[4]=n=>a.prompt=n),placeholder:o(s)("custom_prompt_placeholder")},null,8,["value","placeholder"]))])]),e("div",_t,[e("div",ut,[e("span",null,i(o(s)("temperature")),1),l(p,null,{title:y(()=>[O(i(o(s)("temperature_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1})]),e("div",mt,[e("div",pt,[e("div",ht,[l(j,{onBlur:b,class:"custom-slider",value:a.temperature,"onUpdate:value":t[5]||(t[5]=n=>a.temperature=n),min:0,max:2,step:.1},null,8,["value"])]),e("div",vt,[l(H,{onBlur:b,value:a.temperature,"onUpdate:value":t[6]||(t[6]=n=>a.temperature=n),min:0,max:2,step:.1},null,8,["value"])])])])]),e("div",ft,[e("div",gt,[e("span",null,i(o(s)("max_token")),1),l(p,null,{title:y(()=>[e("div",null,i(o(s)("max_token_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1})]),e("div",yt,[e("div",kt,[e("div",bt,[l(j,{onBlur:b,class:"custom-slider",value:a.max_token,"onUpdate:value":t[7]||(t[7]=n=>a.max_token=n),min:0,max:100*1024},null,8,["value"])]),e("div",xt,[l(H,{onBlur:b,value:a.max_token,"onUpdate:value":t[8]||(t[8]=n=>a.max_token=n),min:0,max:100*1024},null,8,["value"])])])])])],512),[[ke,a.summary_switch==1]])]),e("div",wt,[e("div",$t,[e("div",St,i(o(s)("recall_settings")),1),e("div",Lt,[e("div",Ct,[e("span",null,i(o(s)("retrieval_mode")),1)]),e("div",At,[e("div",Nt,[(u(!0),f(Z,null,se(U.value,n=>(u(),f("div",{class:pe(["retrieval-mode-item",{active:a.search_type==n.value}]),key:n.value,onClick:oe=>I(n.value)},[a.search_type==n.value?(u(),Y(G,{key:0,class:"check-arrow",name:"check-arrow-filled"})):P("",!0),e("div",It,[l(G,{name:n.iconName,class:"title-icon"},null,8,["name"]),e("span",qt,i(n.title),1),n.isRecommendation?(u(),Y(G,{key:0,class:"recommendation-icon",name:"recommendation"})):P("",!0)]),e("div",Mt,i(n.desc),1)],10,Ut))),128))])])]),a.search_type==1?(u(),f("div",Tt,[l(Re,{onSave:o(m),rrf_weight:a.rrf_weight,"onUpdate:rrf_weight":t[9]||(t[9]=n=>a.rrf_weight=n)},null,8,["onSave","rrf_weight"])])):P("",!0),e("div",Bt,[e("div",Rt,[e("span",null,i(o(s)("top_k"))+" ",1),l(p,null,{title:y(()=>[O(i(o(s)("top_k_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1})]),e("div",Ot,[e("div",zt,[e("div",Ft,[l(j,{onBlur:b,class:"custom-slider",value:a.top_k,"onUpdate:value":t[10]||(t[10]=n=>a.top_k=n),min:1,max:500},null,8,["value"])]),e("div",Et,[l(H,{onBlur:b,value:a.top_k,"onUpdate:value":t[11]||(t[11]=n=>a.top_k=n),min:1,max:500},null,8,["value"])])])])]),a.search_type!=3&&a.search_type!=4?(u(),f("div",Vt,[e("div",jt,[e("span",null,i(o(s)("similarity_threshold"))+" ",1),l(p,null,{title:y(()=>[O(i(o(s)("similarity_threshold_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1})]),e("div",Kt,[e("div",Pt,[e("div",Jt,[l(j,{onBlur:b,class:"custom-slider",value:a.similarity,"onUpdate:value":t[12]||(t[12]=n=>a.similarity=n),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ht,[l(H,{onBlur:b,value:a.similarity,"onUpdate:value":t[13]||(t[13]=n=>a.similarity=n),min:0,max:1,step:.01},null,8,["value"])])])])])):P("",!0),e("div",Wt,[e("div",Qt,[e("span",null,i(o(s)("rerank_model"))+" ",1),l(p,null,{title:y(()=>[O(i(o(s)("rerank_model_tooltip")),1)]),default:y(()=>[l(o(W),{class:"question-icon"})]),_:1}),l($,{onChange:b,style:{float:"right"},checkedValue:1,unCheckedValue:0,checked:a.rerank_status,"onUpdate:checked":t[14]||(t[14]=n=>a.rerank_status=n),checkedChildren:o(s)("on"),unCheckedChildren:o(s)("off")},null,8,["checked","checkedChildren","unCheckedChildren"])]),a.rerank_status==1?(u(),f("div",Gt,[l(_e,{modelType:"RERANK",modeName:a.rerank_use_model,"onUpdate:modeName":t[15]||(t[15]=n=>a.rerank_use_model=n),modeId:a.rerank_model_config_id,"onUpdate:modeId":t[16]||(t[16]=n=>a.rerank_model_config_id=n),style:{width:"100%"},placeholder:o(s)("select_rerank_model"),onChange:b},null,8,["modeName","modeId","placeholder"])])):P("",!0)])])]),l(ce,{open:E.value,"onUpdate:open":t[18]||(t[18]=n=>E.value=n),onCancel:K,title:o(s)("custom_prompt_modal_title"),onOk:F},{default:y(()=>[l(v,{value:c.value,"onUpdate:value":t[17]||(t[17]=n=>c.value=n),placeholder:o(s)("please_input"),style:{"min-height":"300px"},"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["open","title"])]),_:1},8,["open","title"])],64)}}}),Xt=D(Yt,[["__scopeId","data-v-1b09bb91"]]),Zt={class:"no-data"},Dt={class:"no-data-text"},es={__name:"list-empty",props:{text:String,size:{type:[Number,String],default:100}},setup(k){const{t:d}=ae("views.library-search.components.list-empty"),h=k,s=me(()=>h.text||d("no_data"));return(z,S)=>{const A=re;return u(),f("div",Zt,[l(A,{name:"empty-document",style:be({"font-size":`${h.size}px`,color:"white"})},null,8,["style"]),e("div",Dt,[xe(z.$slots,"default",{},()=>[O(i(s.value),1)],!0)])])}}},ts=D(es,[["__scopeId","data-v-85b24ff7"]]),ss={class:"search-box-warpper"},as={class:"search-box-content"},os={class:"search-set-box"},ns={key:0,class:"search-content"},ls={class:"search-label"},is={class:"search-tip"},rs={class:"search-input-box"},cs={key:1,class:"search-content search-main"},ds={class:"search-input-box"},_s={style:{color:"#262626","font-size":"16px","font-weight":"600","line-height":"24px"}},us={key:1,class:"search-content-box"},ms={class:"search-tip-box"},ps={key:0,class:"tip"},hs={key:1,class:"tip complete"},vs={key:0,class:"container"},fs={key:1,class:"intelligent-answer"},gs=["innerHTML"],ys={key:1},ks={class:"section-box"},bs={class:"tips"},xs={class:"tips-text"},ws={key:0,class:"section-label"},$s={class:"section-item-nav"},Ss={class:"section-item-nav-left"},Ls=["onClick"],Cs={key:0},As={class:"section-item-nav-right"},Ns=["innerHTML"],Us={__name:"search-box",props:{librarySearchData:{type:Object,default:null},messageObj:{type:Object,default:null},library_ids:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1}},emits:["search","defaultParmas"],setup(k,{expose:d,emit:h}){const{t:s}=ae("views.library-search.components.search-box"),z=h,S=k,A=new De({html:!0,linkify:!0,typographer:!0}),U=C(""),N=C(""),a=C(!1),L=C(!1),_=C({});le(()=>S.messageObj.content,()=>{U.value=A.render(S.messageObj.content)}),le(()=>S.messageObj.error,c=>{c&&te(c)});const r=async()=>{if(!S.library_ids.length)return te(s("select_library_error"));if(!N.value)return te(s("input_message_error"));z("search",N.value),a.value=!0};function I(c){return c.match(/^-?\d+(?:\.\d{0,2})?/)[0]}const g=(c,x)=>{if(!c||!x.trim())return c;const F=x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),K=new RegExp(`(${F})`,"gi");return c.replace(K,'<span class="highlight">$1</span>')},T=c=>{if(!c.file_name){window.open(`#/library/details/categary-manage?id=${c.library_id}`);return}window.open(`#/library/preview?id=${c.file_id}`)},V=C(S.librarySearchData),m=X({rerank_status:"",rerank_use_model:"",prompt:"",model_config_id:"",use_model:"",temperature:.5,max_token:2e3,similarity:.4,search_type:1,summary_switch:0}),b=C({}),E=c=>{V.value=c;let x={model_config_id:c.model_config_id||m.model_config_id,use_model:c.use_model||m.use_model,temperature:c.temperature||m.temperature,max_token:c.max_token||m.max_token,size:200,similarity:c.similarity||m.similarity,search_type:c.search_type||m.search_type,summary_switch:c.summary_switch||m.summary_switch,question:N.value,id:S.library_ids.join(","),recall_type:1,rrf_weight:c.rrf_weight};c.rerank_status&&(x.rerank_status=c.rerank_status),c.rerank_use_model&&(x.rerank_use_model=c.rerank_use_model),c.prompt&&(x.prompt=c.prompt),c.rerank_status==1&&(x.rerank_model_config_id=c.rerank_model_config_id),L.value=!0,b.value=Object.assign(x),z("defaultParmas",b.value),Ie(x).then(F=>{_.value=F.data}).catch(()=>{}).finally(()=>{L.value=!1})};return ie(async()=>{}),d({handleRecallTest:E}),(c,x)=>{const F=re,K=Ge,Q=he;return u(),f("div",ss,[e("div",as,[e("div",os,[l(Xt)]),a.value?(u(),f("div",cs,[e("div",ds,[l(K,{class:"search-input",onPressEnter:r,value:N.value,"onUpdate:value":x[1]||(x[1]=q=>N.value=q),"allow-clear":"",placeholder:o(s)("input_placeholder")},{suffix:y(()=>[e("div",{class:"search-icon-box",onClick:r},[l(F,{class:"search-icon",name:"search-right"})])]),_:1},8,["value","placeholder"])]),!U.value&&k.messageObj.finish&&!_.value.length?(u(),Y(ts,{key:0,style:{"margin-top":"100px"},size:"250"},{default:y(()=>[e("div",null,[e("p",_s,i(o(s)("no_content")),1)])]),_:1})):(u(),f("div",us,[e("div",ms,[l(F,{class:"nav-icon",name:"search-tip"}),k.messageObj.finish?(u(),f("span",hs,i(o(s)("answer_completed")),1)):(u(),f("span",ps,i(o(s)("answer_generating")),1))]),!k.messageObj.content&&!k.messageObj.finish&&!k.isError?(u(),f("div",vs,[...x[2]||(x[2]=[we('<div class="rect-container rect1" data-v-2be72e78><div class="rect" data-v-2be72e78></div></div><div class="rect-container rect2" data-v-2be72e78><div class="rect" data-v-2be72e78></div></div><div class="rect-container rect3" data-v-2be72e78><div class="rect" data-v-2be72e78></div></div>',3)])])):(u(),f("div",fs,[U.value?(u(),f("div",{key:0,innerHTML:U.value},null,8,gs)):(u(),f("div",ys,i(o(s)("no_content")),1))])),e("div",ks,[e("div",bs,[e("div",xs,i(o(s)("generated_by_model")),1),x[3]||(x[3]=e("div",{class:"tips-line"},null,-1))]),_.value.length?(u(),f("div",ws,[O(i(o(s)("related_segments"))+" ",1),e("div",null,"("+i(_.value.length)+")",1)])):P("",!0),(u(!0),f(Z,null,se(_.value,q=>(u(),f("div",{class:"section-item",key:q.id},[e("div",$s,[e("div",Ss,[l(F,{class:"section-item-icon",name:"document"}),e("div",{class:"section-item-label",onClick:w=>T(q)},[O(i(q.file_name),1),q.file_name?P("",!0):(u(),f("span",Cs,i(q.library_name)+"-"+i(o(s)("selected")),1))],8,Ls)]),e("div",As,i(o(s)("similarity"))+i(I(q.similarity)),1)]),l(Q,{overlayClassName:"search-content-tip",placement:"top"},{title:y(()=>[O(i(q.content),1)]),default:y(()=>[e("div",{class:"section-item-content",innerHTML:g(q.content,N.value)},null,8,Ns)]),_:2},1024)]))),128))])]))])):(u(),f("div",ns,[e("div",ls,i(o(s)("knowledge_search")),1),e("div",is,i(o(s)("search_tip")),1),e("div",rs,[l(K,{class:"search-input",onPressEnter:r,value:N.value,"onUpdate:value":x[0]||(x[0]=q=>N.value=q),"allow-clear":"",placeholder:o(s)("input_placeholder")},{suffix:y(()=>[e("div",{class:"search-icon-box",onClick:r},[l(F,{class:"search-icon",name:"search-right"})])]),_:1},8,["value","placeholder"])])]))])])}}},Is=D(Us,[["__scopeId","data-v-2be72e78"]]),qs={class:"cu-tabs"},Ms=["onClick"],Ts={__name:"contain-tabs",props:{value:{type:[Number,String],required:!0},tabs:{type:Array,required:!0,default:()=>[]}},emits:["update:value","change"],setup(k,{emit:d}){const h=d,s=k,z=S=>{h("update:value",S),h("change",S)};return(S,A)=>(u(),f("div",qs,[(u(!0),f(Z,null,se(k.tabs,U=>(u(),f("div",{class:pe(["tab-item",{active:s.value===U.value}]),onClick:N=>z(U.value),key:U.value},i(U.title),11,Ms))),128))]))}},Bs=D(Ts,[["__scopeId","data-v-9397dcbb"]]),Rs={class:"chat-monitor-page"},Os={class:"page-left"},zs={class:"toolbar-box"},Fs={class:"library-checkbox-box"},Es={class:"app-list-box"},Vs={class:"list-box",ref:"scrollContainer"},js={class:"list-item"},Ks={class:"list-item-box"},Ps={class:"library-icon"},Js=["onClick"],Hs={class:"page-body"},Ws={__name:"index",setup(k){const{t:d}=ae("views.library-search.index"),h=et();let{getIndeterminate:s,getCheckAll:z,getCheckedList:S,getActiveKey:A}=de(h);const U=ve(),{getLibrarySearchFn:N,searchMessage:a}=U,{messageObj:L}=de(U),_=C(null),r=C(null),I=C("all"),g=C([{title:d("all"),value:"all"},{title:d("normal"),value:"0"},{title:d("qa"),value:"2"}]),T=C({}),V=C([]),m=X({indeterminate:!1,checkAll:!1,checkedList:[]}),b=p=>{T.value=p},E=C(!1),c=async p=>{var M;E.value=!1;let $=await N();if(r.value=$.data,r.value.id||(r.value=Object.assign(T.value)),r.value,!r.value.model_config_id||!r.value.use_model)return E.value=!0,te(d("configure_before_use"));(M=_.value)==null||M.handleRecallTest(r.value),a(p,m.checkedList,r.value)},x=p=>{Object.assign(m,{checkedList:p.target.checked?V.value.map($=>$.id):[],indeterminate:!!m.checkedList.length&&m.checkedList.length<V.value.length}),h.setCheckedList(m.checkedList),h.setIndeterminate(m.indeterminate)},F=p=>{h.setCheckedList(p)},K=p=>{window.open(`#/library/details/knowledge-document?id=${p}`)};le(()=>m.checkedList,p=>{m.indeterminate=!!p.length&&p.length<V.value.length,m.checkAll=p.length>=V.value.length,h.setIndeterminate(m.indeterminate),h.setCheckAll(m.checkAll)});const Q=()=>{g.value=[{title:d("all"),value:"all"},{title:d("normal"),value:"0"},{title:d("qa"),value:"2"}]},q=(p,$)=>{if($.length===0)return!1;const M=new Set(p);return $.every(R=>M.has(R))},w=(p,$)=>!$.some(M=>p.includes(M)),t=async()=>{let p=I.value==="all"?"":I.value;await qe({type:p}).then($=>{var J;let M=$.data||[];M.forEach(v=>{v.file_size_str=Me(v.file_size),v.avatar||(v.avatar=v.type==0?Te:Be)}),V.value=M;const R=V.value.map(v=>v.id);if((J=S.value)!=null&&J.length&&(R!=null&&R.length)){const v=S.value,j=R,H=q(v,j),G=w(v,j),ee=v.length>=j.length&&H,oe={checkAll:ee,indeterminate:!ee&&!G};h.$patch(oe),Object.assign(m,oe)}else{const v={checkAll:!1,indeterminate:!1};h.$patch(v),Object.assign(m,v)}m.checkedList=S.value,m.indeterminate=s.value,!z.value&&S.value.length==0&&!s.value&&A.value=="all"&&(h.setCheckAll(!0),m.checkedList=R,h.setCheckedList(R)),I.value==="all"&&Q()})},B=p=>{h.setActiveKey(p),t()};return ie(async()=>{A.value&&(I.value=A.value),await t();let p=await N();r.value=p.data}),$e(()=>{}),(p,$)=>{const M=Ye,R=Ze,J=Xe;return u(),f("div",Rs,[e("div",Os,[e("div",zs,[l(Bs,{tabs:g.value,value:I.value,"onUpdate:value":$[0]||($[0]=v=>I.value=v),onChange:B},null,8,["tabs","value"])]),e("div",Fs,[e("div",Es,[l(M,{checked:m.checkAll,"onUpdate:checked":$[1]||($[1]=v=>m.checkAll=v),indeterminate:m.indeterminate,onChange:x},{default:y(()=>[O(i(o(d)("select_all")),1)]),_:1},8,["checked","indeterminate"])]),l(J,{value:m.checkedList,"onUpdate:value":$[2]||($[2]=v=>m.checkedList=v),onChange:F},{default:y(()=>[e("div",Vs,[(u(!0),f(Z,null,se(V.value,v=>(u(),f("div",{class:"list-item-wraapper",key:v.id},[e("div",js,[l(M,{value:v.id},null,8,["value"]),e("div",Ks,[e("div",Ps,[l(R,{preview:!1,width:32,src:v.avatar},null,8,["src"])]),e("div",{class:"library-name",onClick:j=>K(v.id)},i(v.library_name),9,Js)])])]))),128))],512)]),_:1},8,["value"])])]),e("div",Hs,[l(Is,{ref_key:"searchBoxRef",ref:_,onDefaultParmas:b,onSearch:c,isError:E.value,messageObj:o(L),librarySearchData:r.value,library_ids:m.checkedList},null,8,["isError","messageObj","librarySearchData","library_ids"])])])}}},na=D(Ws,[["__scopeId","data-v-b56db630"]]);export{na as default};
