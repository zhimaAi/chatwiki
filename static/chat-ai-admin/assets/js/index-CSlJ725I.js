import{b as U,p as W,n as z,B as H,t as G,q,v as X,w as Z,M as tt}from"../../index-M_xDbIir.js";import{g as et}from"./index-mwk_dyAT.js";import{i as at}from"./index-BfDgZ-27.js";import{w as ot,d as D,q as I,x as nt,o as st,N as R,O as w,X as l,z as A,j as o,u as F,Z as k,U as n,_ as g,F as j,a1 as V,S as T,W as N,a6 as B}from"./vue-chunks-BRsu9_To.js";import{R as K}from"./dayjs-DGNhaBdA.js";import{_ as lt}from"./index-CVff9qN-.js";import{_ as E,a as P}from"./index-Bg1_T7h9.js";import{f as it}from"./index-Bm5IPe57.js";import{a as rt,_ as _t}from"./RadioButton-Bb2kU0Fd.js";import"./index-Dob-Z8xa.js";import{S as dt,a as pt}from"./index-khLftDou.js";import{_ as ct}from"./index-CSIZCO5e.js";import{F as Q,_ as ut}from"./index-V0sRhm34.js";import{_ as mt}from"./index-tezmKtYb.js";import{_ as vt}from"./TextArea-C57yjED6.js";import"./index-UA7y0weg.js";import{_ as ht}from"./Search-w33R1D1l.js";import{T as ft,_ as kt}from"./index-WJK8Aswe.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./index-Cs0K2ZaB.js";import"./index-D48_VNbE.js";import"./colors-C56HAaAp.js";import"./ClockCircleOutlined-DkyJWIQA.js";import"./useMergedState-C0iIHNGF.js";import"./Trigger-CkoSoTBd.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./shallowequal-C0xnIuy8.js";import"./FormItemContext-DRzYyKbC.js";import"./index-Btmz2D3B.js";import"./move-DD64vPeJ.js";import"./slide-DzpBPoRp.js";import"./index-CMIXnI2Z.js";import"./index-D8nD-csV.js";import"./List-DKTpjnke.js";import"./collapseMotion-Brd6xpAT.js";import"./CaretDownFilled-BzxZQg7Y.js";import"./index-SuSZ4kHz.js";import"./responsiveObserve-CRSSr9-w.js";import"./RightOutlined-og3IpneX.js";import"./LeftOutlined-DbHJ8blF.js";import"./index-D_6sH2t0.js";import"./index-B0RyY99D.js";import"./DownOutlined-CI2wWtcJ.js";import"./index-Bn-th77D.js";import"./Checkbox-pA5GUfu7.js";import"./index-D7wU2qJF.js";import"./dropdown-DCrM-GKY.js";import"./Dropdown-Dh4cjnmT.js";import"./index-B3CPYV6x.js";import"./CaretDownOutlined-C4FFiOW0.js";import"./SearchOutlined-KUcJKUZw.js";import"./Input-Bx6Hhp2b.js";import"./inputProps-DsSGhBt6.js";import"./CheckOutlined-DVulUWsT.js";import"./isPlainObject-A-SljaBF.js";import"./Col-CFWsj1wI.js";import"./hasIn-DEwqUvIo.js";import"./QuestionCircleOutlined-B5SgdGK5.js";import"./UpOutlined-DzDRcb4z.js";import"./Password-5njtOUlo.js";import"./useRefs-CRRjy_qY.js";import"./pick-BW-qU63h.js";import"./PlusOutlined-DQ91YM1E.js";const gt={class:"container-echart"},bt={__name:"line-chart",props:{options:{type:Object,default:()=>({xAxis:[],series:[]})}},setup(L){const i=L;let u;const e=()=>{const b={title:{textStyle:{color:"#262626",textAlign:"center",fontFamily:"PingFang SC",fontSize:"14px",fontStyle:"normal",fontWeight:"600"}},legend:{show:!0,bottom:"0%",textStyle:{color:"#262626",fontSize:"14px"},data:["输入","输出","合计"],itemHeight:6,itemWidth:6,type:"scroll",orient:"horizontal",align:"auto",icon:"circle"},grid:{right:"1.5%",left:"4%",top:"5%",bottom:"20%"},tooltip:{trigger:"axis"},xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#D9D9D9"}},boundaryGap:!1,nameLocation:"end",data:i.options.xAxis,axisLabel:{show:!0,fontSize:10,interval:"auto",rotate:0,lineHeight:26},axisLine:{show:!1}},yAxis:{type:"value",nameLocation:"end",min:0},series:[{name:"输入",type:"line",showSymbol:!1,data:i.options.series.map(m=>m.prompt_token),smooth:!0,color:"#2475fc"},{name:"输出",type:"line",showSymbol:!1,data:i.options.series.map(m=>m.completion_token),smooth:!0,color:"#646161"},{name:"合计",type:"line",showSymbol:!1,data:i.options.series.map(m=>m.total_token),smooth:!0,color:"#4B7900"}]};u.setOption(b,{notMerge:!0})};ot(()=>i.options,()=>{setTimeout(()=>{e()},200)},{deep:!0});const d=()=>{u.resize()},s=D(null);return I(()=>{nt(()=>{u=at(s.value),e()}),window.addEventListener("resize",d)}),st(()=>{window.removeEventListener("resize",d)}),(b,m)=>(w(),R("div",gt,[l("div",{ref_key:"chartRef",ref:s,class:"interface-echart"},null,512)]))}},yt=U(bt,[["__scopeId","data-v-c44a801e"]]),xt={class:"statics-content"},wt={class:"search-box"},Dt={class:"list-box"},Yt={class:"main-title"},zt={style:{"margin-left":"auto"}},St={__name:"statics-by-app",setup(L){const i=W(),u=D([z().subtract(7,"day"),z()]),e=D([]),d=A({start_date:u.value[0].format("YYYY-MM-DD"),end_date:u.value[1].format("YYYY-MM-DD"),token_app_type:"",robot_id:""}),s=A({page:1,size:100,total:0}),b=D([]),m=D([]),f=()=>{s.page=1,a(),y()},M=_=>{s.page=_.current,s.size=_.pageSize,y()};let S={chatwiki_robot:"机器人",workflow:"工作流",other:"其他"};const y=()=>{q({...d,page:s.page,size:s.size}).then(_=>{let r=_.data.list||[];b.value=r.map(h=>({...h,token_app_type_desc:S[h.token_app_type],completion_token_desc:p(h.completion_token),prompt_token_desc:p(h.prompt_token),total_token_desc:p(h.total_token)})),s.total=+_.data.total})},$=()=>{q({...d,page:s.page,size:1e4}).then(_=>{let r=_.data.list||[];r=r.map(c=>({...c,robot_name:c.robot_name||"",token_app_type_desc:S[c.token_app_type],completion_token_desc:p(c.completion_token),prompt_token_desc:p(c.prompt_token),total_token_desc:p(c.total_token)})),X(`类型,应用名称,合计消耗(k),输入(k),输出(k),日期
`,r,["token_app_type_desc","robot_name","total_token_desc","prompt_token_desc","completion_token_desc","date"],"明细数据-"+z().format("YYYY-MM-DD HH:mm:ss"))})},t=A({xAxis:[],series:[]}),a=()=>{G({...d}).then(_=>{let r=_.data.list,h=[],v=[];r.forEach(c=>{h.push(z(c.date).format("YY/MM/DD")),v.push({completion_token:p(c.completion_token),prompt_token:p(c.prompt_token),total_token:p(c.total_token)})}),Object.assign(t,{xAxis:h,series:v})})};function p(_){return _<=0?0:(_/1e3).toFixed(2)}const x=()=>{d.start_date="",d.end_date="",u.value&&u.value.length>0&&(d.start_date=u.value[0].format("YYYY-MM-DD"),d.end_date=u.value[1].format("YYYY-MM-DD")),f()},C=()=>{if(d.token_app_type="",d.robot_id="",!e.value){f();return}d.token_app_type=e.value[0],e.value.length>=2&&(d.robot_id=e.value[1]),f()};return I(()=>{et().then(_=>{let r=_.data||[],h=r.filter(c=>c.application_type==0),v=r.filter(c=>c.application_type==1);m.value=[{label:"机器人",value:"chatwiki_robot",children:h.map(c=>({label:c.robot_name,value:c.id}))},{label:"工作流",value:"workflow",children:v.map(c=>({label:c.robot_name,value:c.id}))},{label:"其他",value:"other"}]}),f()}),(_,r)=>{const h=K,v=lt,c=H,O=E,J=P;return w(),R("div",xt,[l("div",wt,[o(h,{value:u.value,"onUpdate:value":r[0]||(r[0]=Y=>u.value=Y),allowClear:!1,onChange:x,style:{width:"256px"},presets:F(i)},null,8,["value","presets"]),o(v,{style:{width:"256px"},changeOnSelect:"",onChange:C,value:e.value,"onUpdate:value":r[1]||(r[1]=Y=>e.value=Y),options:m.value,placeholder:"全部应用"},null,8,["value","options"])]),l("div",Dt,[r[4]||(r[4]=l("div",{class:"main-title"},"使用趋势（单位：千）",-1)),o(yt,{options:t},null,8,["options"]),l("div",Yt,[r[3]||(r[3]=k(" 明细数据（单位：千） ")),l("div",zt,[o(c,{onClick:$},{default:n(()=>r[2]||(r[2]=[k("导出")])),_:1,__:[2]})])]),o(J,{style:{"margin-top":"16px"},"data-source":b.value,pagination:{current:s.page,total:s.total,pageSize:s.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:M},{default:n(()=>[o(O,{title:"类型","data-index":"token_app_type_desc",width:100},{default:n(({record:Y})=>[k(g(Y.token_app_type_desc),1)]),_:1}),o(O,{title:"应用名称","data-index":"robot_name",width:140}),o(O,{title:"合计消耗(k)","data-index":"total_token_desc",width:140},{default:n(({record:Y})=>[k(g(Y.total_token_desc),1)]),_:1}),o(O,{title:"输入(k)","data-index":"prompt_token_desc",width:140},{default:n(({record:Y})=>[k(g(Y.prompt_token_desc),1)]),_:1}),o(O,{title:"输出(k)","data-index":"completion_token_desc",width:140},{default:n(({record:Y})=>[k(g(Y.completion_token_desc),1)]),_:1}),o(O,{title:"日期","data-index":"date",width:140},{default:n(({record:Y})=>[k(g(Y.date),1)]),_:1})]),_:1},8,["data-source","pagination"])])])}}},Ct=U(St,[["__scopeId","data-v-0940a0dc"]]),Mt={class:"zm-date"},$t={class:"date-btn"},Tt={class:"date-content"},Lt={__name:"date",props:{dateType:{type:Number,default:1},rangeData:{type:Array,default:null}},emits:["dateChange"],setup(L,{emit:i}){const u=L,e=D(1),d=i;let s=A([{label:"今日",value:!1,key:2,start_date:z(),end_date:z()},{label:"昨日",value:!1,key:3,start_date:z().subtract(1,"day"),end_date:z().subtract(1,"day")},{label:"近七日",value:!0,key:4,start_date:z().subtract(6,"day"),end_date:z().subtract(0,"day")}]);const b=D(null),m=D(null),f=D([]),M=t=>t>=z().subtract(0,"day"),S=()=>{let t=e.value,a=null;s.forEach(p=>{p.key==t&&(a=p)}),f.value=[a.start_date,a.end_date],b.value=a.start_date.format("YYYY-MM-DD"),m.value=a.end_date.format("YYYY-MM-DD"),$()},y=(t,a)=>{e.value=1,f.value=t,b.value=a[0],m.value=a[1],$()},$=()=>{d("dateChange",{start_date:b.value,end_date:m.value})};return I(()=>{e.value=u.dateType,f.value=u.rangeData}),(t,a)=>{const p=rt,x=_t,C=K;return w(),R("div",Mt,[l("div",$t,[o(x,{value:e.value,"onUpdate:value":a[0]||(a[0]=_=>e.value=_),onChange:S},{default:n(()=>[(w(!0),R(j,null,V(F(s),_=>(w(),T(p,{class:"date-btn-button",value:_.key,key:_.key},{default:n(()=>[k(g(_.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),l("div",Tt,[o(C,{value:f.value,"onUpdate:value":a[1]||(a[1]=_=>f.value=_),onChange:y,format:"YYYY-MM-DD",disabledDate:M},null,8,["value"])])])}}},At={class:"team-members-pages"},Rt={class:"total"},Ot={class:"total-num"},Ut={class:"set-model"},Ft={class:"set-model-body"},It={class:"set-date"},Bt={class:"set-date-body"},Et={class:"set-reset"},Pt={class:"list-box"},qt={class:"user-box"},Nt={class:"name-info"},Qt={class:"user-name"},Ht={__name:"use-token",setup(L){const i=D(Date.now()),u=D(["全部模型"]),e=A({page:1,size:10,total:0,use_model:"全部模型",start_date:"",end_date:""}),d=t=>{e.start_date=t.start_date,e.end_date=t.end_date,m()},s=()=>{e.use_model="全部模型",e.start_date="",e.end_date="",i.value=Date.now(),m()},b=t=>{e.page=t.current,e.size=t.pageSize,S()},m=()=>{e.page=1,S()},f=D([]),M=(t,a)=>{const p=(t.split(".")[1]?t.split(".")[1]:t.split(".")[0]).length,x=(a.split(".")[1]?a.split(".")[1]:a.split(".")[0]).length,C=Math.pow(10,Math.max(p,x));return(t*C+a*C)/C/1e3},S=()=>{let t={page:e.page,size:e.size,start_date:e.start_date,end_date:e.end_date};e.use_model!="全部模型"&&(t.model=e.use_model),Z(t).then(a=>{let p=a.data.list;p.forEach(x=>{x.create_time=x.create_time>0?z(x.create_time*1e3).format("YYYY-MM-DD HH:mm"):"--",x.amount=M(x.prompt_token,x.completion_token)}),f.value=p,e.total=+a.data.total})},y=t=>{e.use_model=t,m()},$=()=>{it({}).then(t=>{u.value=["全部模型",...t.data]})};return I(()=>{$(),m()}),(t,a)=>{const p=pt,x=dt,C=H,_=ct,r=E,h=P;return w(),R("div",At,[o(_,{justify:"flex-end"},{default:n(()=>[l("div",Rt,[a[1]||(a[1]=l("div",{class:"label total-label"},"共计：",-1)),l("div",Ot,g(e.total)+"条",1)]),l("div",Ut,[a[2]||(a[2]=l("div",{class:"label set-model-label"},"选择模型：",-1)),l("div",Ft,[o(x,{value:e.use_model,"onUpdate:value":a[0]||(a[0]=v=>e.use_model=v),placeholder:"全部模型",onChange:y,style:{width:"200px"}},{default:n(()=>[(w(!0),R(j,null,V(u.value,v=>(w(),T(p,{key:v,value:v},{default:n(()=>[l("span",null,g(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),l("div",It,[a[3]||(a[3]=l("div",{class:"label set-date-label"},[l("span",null,"统计日期：")],-1)),l("div",Bt,[(w(),T(Lt,{onDateChange:d,key:i.value}))])]),l("div",Et,[o(C,{onClick:s},{default:n(()=>a[4]||(a[4]=[k("重置")])),_:1,__:[4]})])]),_:1}),l("div",Pt,[o(h,{"data-source":f.value,pagination:e.total>e.size?{current:e.page,total:e.total,pageSize:e.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}:!1,onChange:b},{default:n(()=>[o(r,{title:"模型名称","data-index":"model",width:"300px"},{default:n(({record:v})=>[l("div",qt,[l("div",Nt,[l("div",Qt,g(v.corp)+"（"+g(v.model)+"）",1)])])]),_:1}),o(r,{title:"类型","data-index":"IP",width:"190px"},{default:n(({record:v})=>[k(g(v.type),1)]),_:1}),o(r,{title:"Token消耗(k)","data-index":"amount",width:"190px"},{default:n(({record:v})=>[k(g(v.amount),1)]),_:1}),o(r,{title:"日期","data-index":"date",width:"190px"},{default:n(({record:v})=>[k(g(v.date),1)]),_:1})]),_:1},8,["data-source","pagination"])])])}}},jt=U(Ht,[["__scopeId","data-v-be2fc97c"]]),Vt={__name:"token-quota-modal",emits:["ok"],setup(L,{expose:i,emit:u}){const e=D(!1),d=D("token限额"),s=A({token:"",description:""}),b=(t={})=>{e.value=!0,M(),s.name=t.name||"",s.description=t.description||"",s.id=t.id||""},m=A({token:[{required:!0,message:"请输入token限额"}],description:[{required:!0,message:"请输入数据表描述"}]}),f=Q.useForm,{resetFields:M,validate:S,validateInfos:y}=f(s,m),$=()=>{S().then(t=>{})};return i({show:b}),(t,a)=>{const p=mt,x=ut,C=vt,_=Q,r=tt;return w(),T(r,{open:e.value,"onUpdate:open":a[2]||(a[2]=h=>e.value=h),title:d.value,onOk:$,width:540},{default:n(()=>[o(_,{layout:"vertical",style:{"margin-top":"16px"}},{default:n(()=>[o(x,N({label:"token限额"},F(y).token),{default:n(()=>[o(p,{value:s.token,"onUpdate:value":a[0]||(a[0]=h=>s.token=h),style:{width:"60%"},min:0,placeholder:"请输入"},{addonAfter:n(()=>a[3]||(a[3]=[k(" k ")])),_:1},8,["value"]),a[4]||(a[4]=l("div",{class:"form-tip"},"剩余额度：xxx",-1))]),_:1,__:[4]},16),o(x,N({label:"备注"},F(y).description),{default:n(()=>[o(C,{maxLength:500,style:{height:"80px"},value:s.description,"onUpdate:value":a[1]||(a[1]=h=>s.description=h),placeholder:"请输入"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])}}},Kt=U(Vt,[["__scopeId","data-v-35c720e2"]]),Jt={class:"content-box"},Wt={class:"list-box"},Gt={__name:"quota-token",setup(L){const i=A({name:"",page:1,size:10}),u=D(0),e=()=>{i.page=1},d=f=>{i.page=f.current,i.size=f.pageSize},s=()=>{},b=D(null),m=()=>{b.value.show()};return(f,M)=>{const S=ht,y=E,$=P;return w(),R("div",Jt,[l("div",{class:"search-block",onClick:m},[o(S,{value:i.name,"onUpdate:value":M[0]||(M[0]=t=>i.name=t),placeholder:"搜索名称",style:{width:"220px"},onSearch:e},null,8,["value"])]),l("div",Wt,[o($,{"data-source":f.tableData,pagination:{current:i.page,total:u.value,pageSize:i.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:d},{default:n(()=>[o(y,{title:"类型","data-index":"IP",width:100},{default:n(({record:t})=>[k(g(t.type),1)]),_:1}),o(y,{title:"应用名称","data-index":"model",width:100}),o(y,{title:"今日消耗(k)","data-index":"amount1",width:140},{default:n(({record:t})=>[k(g(t.amount),1)]),_:1}),o(y,{title:"Token消耗(k)","data-index":"amount",width:140},{default:n(({record:t})=>[k(g(t.amount),1)]),_:1}),o(y,{title:"已消耗(k)","data-index":"amount2",width:140},{default:n(({record:t})=>[k(g(t.amount),1)]),_:1}),o(y,{title:"剩余(k)","data-index":"amount3",width:140},{default:n(({record:t})=>[k(g(t.amount),1)]),_:1}),o(y,{title:"备注","data-index":"date",width:200},{default:n(({record:t})=>[k(g(t.date),1)]),_:1}),o(y,{title:"操作","data-index":"action",width:120},{default:n(({record:t})=>[k(g(t.amount),1)]),_:1})]),_:1},8,["data-source","pagination"])]),o(Kt,{ref_key:"tokenQuotaModalRef",ref:b,onOk:s},null,512)])}}},Xt=U(Gt,[["__scopeId","data-v-dbb43069"]]),Zt={class:"user-model-page"},te={class:"tabs-box"},ee={class:"list-wrapper"},ae={__name:"index",setup(L){const i=D(1);return(u,e)=>{const d=kt,s=ft;return w(),R("div",Zt,[l("div",te,[o(s,{activeKey:i.value,"onUpdate:activeKey":e[0]||(e[0]=b=>i.value=b)},{default:n(()=>[(w(),T(d,{key:1,tab:"按应用统计"})),(w(),T(d,{key:2,tab:"按模型统计"}))]),_:1},8,["activeKey"])]),l("div",ee,[i.value==1?(w(),T(Ct,{key:0})):B("",!0),i.value==2?(w(),T(jt,{key:1})):B("",!0),i.value==3?(w(),T(Xt,{key:2})):B("",!0)])])}}},va=U(ae,[["__scopeId","data-v-50c3e656"]]);export{va as default};
