import{u as he,_ as be,aZ as ye,a_ as xe,a$ as we,b0 as ke,am as qe}from"../../index-DSFcP5NQ.js";import{r,E as W,w as Se,ah as Ie,a as c,b as d,y as u,t as _,z as X,D as Y,p as e,q as f,v as n,u as l,e as G,n as Le,F as P,l as Ce,_ as w,h as Ue}from"./vue-chunks-BdaA73Wf.js";import{U as Me}from"./index-XVLbk3qE.js";import{I as Ee,y as Ne,b0 as ze,b1 as Be,u as Fe,v as Oe,V as $e,Z as De,$ as Ge,G as Te,B as je,e as Ae,M as Ve,b as k,b7 as Ke}from"./ui-antd-Dl1wwwCD.js";import{M as Pe}from"./model-select-CMPvMrAQ.js";import{M as Qe}from"./editor-code-DlsHKXTn.js";import{_ as Re}from"./emoji-mart-BBMRoEa3.js";const He={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},Ze={class:"custom-modal-header"},Je={key:1},We={key:2},Xe={class:"form-box-wrapper"},Ye={key:0,class:"form-item"},et={class:"form-label"},tt={class:"form-content"},st={key:1,class:"form-item"},at={class:"form-label"},ot={class:"form-content"},lt={class:"star-item-box"},nt={key:2},it={class:"form-item"},rt={class:"form-label required"},ut={class:"form-content"},dt={class:"form-item"},ct={class:"form-label required"},_t={class:"form-content"},vt={class:"form-item"},pt={class:"form-label required"},mt={class:"form-content"},ft={key:0,class:"error-tip"},gt={key:3,class:"form-item"},ht={class:"form-label required"},bt={class:"form-content"},yt={key:0,class:"error-tip"},xt={class:"form-item"},wt={class:"form-content"},kt={class:"upload-box-wrapper"},qt={key:0},St={key:4,class:"form-item"},It={class:"form-label-box"},Lt={class:"form-label"},Ct={class:"ai-generate-text"},Ut={class:"form-content"},Mt={class:"form-content-tip"},Et={class:"ai-generate-wrapper"},Nt={class:"form-box-wrapper ai-generate-wrapper-box"},zt={class:"ai-generate-wrapper-left"},Bt={class:"form-box-wrapper-options"},Ft={class:"form-item flex1"},Ot={class:"form-label required"},$t={class:"form-content"},Dt={class:"form-item flex1"},Gt={class:"form-content dual-inputs"},Tt={class:"input-group"},jt={class:"form-label required"},At={class:"form-label-input-box"},Vt={class:"form-box-wrapper-content"},Kt={class:"problem-box"},Pt={class:"problem"},Qt={class:"problem-content"},Rt={class:"problem-box"},Ht={class:"problem"},Zt={class:"problem-content"},Jt={class:"form-item generate-btn-box"},Wt={class:"result-nav"},Xt={key:0,class:"tip"},Yt={key:1,class:"result-nav-text"},es={key:0,class:"container"},ts={class:"result-container"},ss=["innerHTML"],as={class:"result-footer"},os={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(ee,{expose:te,emit:se}){const{t:s}=he("views.library.library-preview.components.edit-subsection"),ae=r(!1),p=r(!1),T=r(!1),I=r(!1),L=r(!1),g=W({use_model:"",is_offline:"",model_config_id:"",count:5}),oe=new Qe({html:!0,linkify:!0,typographer:!0}),Q=r(""),C=W({finish:"",content:""});Se(()=>C.content,()=>{Q.value=oe.render(C.content)});const U=Ie(),le=U.query,M=U.name,N=ee,j=se;r("");const R=r("1"),q=r(!1),z=r(""),y=r(""),h=r(""),x=r(""),b=r(""),S=r([]),E=r(0),B=r(""),F=r("0"),v=r(!1),ne=o=>{p.value=!1,T.value=!1,L.value=!1,z.value=o.title||"",y.value=o.content||"",B.value=o.id||"",h.value=o.answer||"",S.value=o.images||[],x.value=o.question||"",b.value=o.similar_questions?o.similar_questions.join(`
`):"",v.value=N.detailsInfo.is_qa_doc=="1",E.value=o.category_id||0,F.value=o.group_id||"0",V(),v&&ie(),q.value=!0},H=r([]),ie=()=>{qe({library_id:N.detailsInfo.library_id}).then(o=>{H.value=o.data||[]})},A=r([]),V=()=>{ke({file_id:le.id}).then(o=>{let t=o.data||[];t=t.map(i=>({value:i.id,payload:{...i,color:He[i.type]}})),M=="categaryManages"?A.value=[...t]:A.value=[{value:0,payload:{id:0,name:s("label_unmarked")}},...t],j("handleStatrList",o.data||[])})},Z=()=>{if(J(),!y.value&&!v.value)return k.error(s("msg_input_section_content"));if(!x.value&&v.value)return k.error(s("msg_input_section_question"));if(!h.value&&v.value)return k.error(s("msg_input_section_answer"));if(v.value&&h.value.length>1e4||!v.value&&y.value.length>1e4)return;if(M=="categaryManages"&&E.value<=0)return k.error(s("msg_select_category"));let o={title:z.value,content:y.value,question:x.value,answer:h.value,images:S.value,category_id:E.value};v.value&&(o.group_id=F.value||0);let t=b.value.trim();t?(t=t.split(`
`),o.similar_questions=JSON.stringify(t)):o.similar_questions="[]",B.value?o.id=B.value:o.file_id=U.query.id;let i=new FormData;for(let m in o)Ke.isArray(o[m])?o[m].forEach(K=>{i.append(m,K)}):i.append(m,o[m]);M=="knowledgeDocument"&&(i.delete("file_id"),i.append("library_id",U.query.id)),M=="libraryConfig"&&(i.delete("file_id"),i.append("library_id",N.detailsInfo.library_id)),M=="categaryManages"?(i.delete("file_id"),i.append("library_id",U.query.id),xe(i).then(m=>{k.success(o.id?s("msg_edit_success"):s("msg_add_success")),q.value=!1,j("handleEdit",{...o}),V()})):we(i).then(m=>{k.success(o.id?s("msg_edit_success"):s("msg_add_success")),q.value=!1,j("handleEdit",{...o}),V()})},re=()=>{p.value=!0},O=r(""),ue=async()=>{C.content="",O.value="",I.value=!0,L.value=!0;try{let o={library_id:N.detailsInfo.library_id,model_config_id:g.model_config_id,use_model:g.use_model,num:g.count,question:x.value,answer:h.value};const t=await ye(o);O.value=t.data.map(i=>i).join(`
`),C.content=t.data.map((i,m)=>`<div class="dialog-message">${m+1}. ${i}</div>`).join(""),T.value=!0}finally{I.value=!1}},de=()=>{b.value?b.value+=`
${O.value}`:b.value+=O.value,k.success(s("msg_save_success")),T.value=!1,p.value=!1,L.value=!1};function ce(o){return o.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const J=()=>{b.value=ce(b.value)};return te({showModal:ne}),(o,t)=>{const i=je,m=Ee,K=Ne,_e=Oe,ve=Fe,$=$e,D=be,pe=Ge,me=De,fe=Te,ge=Ve;return d(),c("div",null,[u(ge,{open:q.value,"onUpdate:open":t[14]||(t[14]=a=>q.value=a),onOk:Z,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:p.value?L.value?"944px":"472px":"746px","ok-button-props":{style:{display:p.value?"none":"block"}}},{title:_(()=>[e("div",Ze,[p.value?(d(),G(i,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=a=>p.value=!1)},{icon:_(()=>[u(l(Ae),{style:{"font-size":"12px"}})]),_:1})):f("",!0),p.value?(d(),c("span",Je,n(l(s)("title_ai_generate")),1)):(d(),c("span",We,n(B.value?l(s)("title_edit_subsection"):l(s)("title_add_subsection")),1))])]),footer:_(()=>[p.value?f("",!0):(d(),c(P,{key:0},[u(i,{onClick:t[13]||(t[13]=a=>q.value=!1)},{default:_(()=>[w(n(l(s)("btn_cancel")),1)]),_:1}),u(i,{type:"primary",onClick:Z},{default:_(()=>[w(n(l(s)("btn_confirm")),1)]),_:1})],64))]),default:_(()=>[X(e("div",Xe,[v.value?f("",!0):(d(),c("div",Ye,[e("div",et,n(l(s)("label_section_title")),1),e("div",tt,[u(m,{maxLength:25,value:z.value,"onUpdate:value":t[1]||(t[1]=a=>z.value=a),placeholder:l(s)("ph_input_section_title")},null,8,["value","placeholder"])])])),v.value?f("",!0):(d(),c("div",st,[e("div",at,n(l(s)("label_section_category")),1),e("div",ot,[u(K,{value:E.value,"onUpdate:value":t[2]||(t[2]=a=>E.value=a),options:A.value},{label:_(({payload:a})=>[e("div",lt,[a.id>0?(d(),G(l(ze),{key:0,style:Le({color:a.color})},null,8,["style"])):(d(),G(l(Be),{key:1})),e("div",null,n(a.name||"-"),1),a.data_count>0?(d(),c("span",nt,"("+n(a.data_count)+")",1)):f("",!0)])]),_:1},8,["value","options"])])])),v.value?(d(),c(P,{key:2},[e("div",it,[e("div",rt,n(l(s)("label_group")),1),e("div",ut,[u(ve,{value:F.value,"onUpdate:value":t[3]||(t[3]=a=>F.value=a),style:{width:"100%"}},{default:_(()=>[(d(!0),c(P,null,Ce(H.value,a=>(d(),G(_e,{value:a.id},{default:_(()=>[w(n(a.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",dt,[e("div",ct,n(l(s)("label_section_question")),1),e("div",_t,[u($,{placeholder:l(s)("ph_input_section_question"),value:x.value,"onUpdate:value":t[4]||(t[4]=a=>x.value=a),style:{height:"100px"}},null,8,["placeholder","value"])])]),e("div",vt,[e("div",pt,n(l(s)("label_section_answer")),1),e("div",mt,[u($,{placeholder:l(s)("ph_input_section_answer"),value:h.value,"onUpdate:value":t[5]||(t[5]=a=>h.value=a),style:{height:"100px"}},null,8,["placeholder","value"]),h.value.length>1e4?(d(),c("div",ft,n(l(s)("msg_answer_max_length")),1)):f("",!0)])])],64)):(d(),c("div",gt,[e("div",ht,n(l(s)("label_section_content")),1),e("div",bt,[u($,{style:{height:"150px"},value:y.value,"onUpdate:value":t[6]||(t[6]=a=>y.value=a),placeholder:l(s)("ph_input_section_content")},null,8,["value","placeholder"]),y.value.length>1e4?(d(),c("div",yt,n(l(s)("msg_content_max_length")),1)):f("",!0)])])),e("div",xt,[e("div",wt,[e("div",kt,[u(me,{activeKey:R.value,"onUpdate:activeKey":t[7]||(t[7]=a=>R.value=a),size:"small"},{default:_(()=>[u(pe,{key:"1"},{tab:_(()=>[e("span",null,[u(D,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),w(" "+n(l(s)("tab_answer_images"))+" ",1),S.value.length?(d(),c("span",qt,"("+n(S.value.length)+")",1)):f("",!0)])]),_:1})]),_:1},8,["activeKey"]),u(Me,{value:S.value,"onUpdate:value":t[8]||(t[8]=a=>S.value=a)},null,8,["value"])])])]),v.value?(d(),c("div",St,[e("div",It,[e("div",Lt,n(l(s)("label_similar_questions")),1),e("div",{class:"ai-generate",onClick:re},[u(D,{name:"ai-generate",style:{"font-size":"14px"}}),e("div",Ct,n(l(s)("btn_ai_auto_generate")),1)])]),e("div",Ut,[u($,{placeholder:l(s)("ph_input_similar_questions"),value:b.value,"onUpdate:value":t[9]||(t[9]=a=>b.value=a),style:{height:"100px"},onBlur:J},null,8,["placeholder","value"]),e("div",Mt,n(l(s)("tip_similar_questions_format")),1)])])):f("",!0)],512),[[Y,!p.value]]),X(e("div",Et,[e("div",Nt,[e("div",zt,[e("div",Bt,[e("div",Ft,[e("div",Ot,n(l(s)("label_similar_question_model")),1),e("div",$t,[u(Pe,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":t[10]||(t[10]=a=>g.use_model=a),modeId:g.model_config_id,"onUpdate:modeId":t[11]||(t[11]=a=>g.model_config_id=a)},null,8,["modeName","modeId"])])]),e("div",Dt,[e("div",Gt,[e("div",Tt,[e("div",jt,n(l(s)("label_question_count")),1),e("div",At,[u(fe,{value:g.count,"onUpdate:value":t[12]||(t[12]=a=>g.count=a),min:1,max:20,style:{width:"100%"}},null,8,["value"]),w(n(l(s)("label_question")),1)])])])])]),e("div",Vt,[e("div",Kt,[e("div",Pt,n(l(s)("label_question")),1),e("div",Qt,n(x.value),1)]),e("div",Rt,[e("div",Ht,n(l(s)("label_answer")),1),e("div",Zt,n(h.value),1)])]),e("div",Jt,[u(i,{onClick:ue,loading:I.value,class:"generate-btn"},{default:_(()=>[u(D,{name:"ai-generate-white",style:{"font-size":"16px"}}),w(" "+n(l(s)("btn_start_generate")),1)]),_:1},8,["loading"])])]),e("div",{class:Ue(["ai-generate-wrapper-right",{"show-result":L.value}])},[e("div",Wt,[u(D,{name:"generate-icon",style:{"font-size":"14px"}}),I.value?(d(),c("span",Xt,n(l(s)("tip_generating")),1)):(d(),c("div",Yt,n(l(s)("tip_generate_completed")),1))]),!C.content&&I.value&&!ae.value?(d(),c("div",es,[...t[15]||(t[15]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)])])):f("",!0),e("div",ts,[e("div",{class:"dialog-content",innerHTML:Q.value},null,8,ss)]),e("div",as,[u(i,{class:"result-footer-btn",type:"primary",onClick:de},{default:_(()=>[w(n(l(s)("btn_save_similar")),1)]),_:1})])],2)])],512),[[Y,p.value]])]),_:1},8,["open","width","ok-button-props"])])}}},_s=Re(os,[["__scopeId","data-v-dadd62b6"]]);export{_s as E,He as c};
//# sourceMappingURL=edit-subsection-BwSyKVRx.js.map
