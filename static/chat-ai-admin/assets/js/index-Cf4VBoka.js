import{_ as G}from"./empty-BFmzY9bl.js";import{d as H}from"./vuedraggable.umd-DJBjom-v.js";import{c as L,e as Q,r as Y,f as K,h as X}from"./index-Bu5ae_-0.js";import{b as T,a8 as Z,e as ee,a9 as te}from"../../index-CPkdGIiL.js";import{ac as ae,a3 as se,E as oe,an as ne,b as le,c as ie,D as pe,I as q,k as re,e as ce,F as de,B as D,M as N,a as B,z as ue,ah as _e,H as me}from"./ui-antd-Bw8cEW5z.js";import{Y as b,_ as r,a5 as e,ae as S,k as o,a7 as x,F as ve,a1 as w,G as $,u as E,a2 as l,f as C,r as R,e as fe,J as ge,o as he}from"./vue-chunks-Ci-XTWEs.js";import{u as ye}from"./index-CvIjQ1XU.js";import{C as ke}from"./cu-upload-qKd75kAs.js";import"./utils-ChQO-_r6.js";const be={class:"wechat-app-item"},xe={class:"item-body"},we=["src"],Ce={class:"app-info"},$e={class:"app-name"},Ie={class:"app-desc"},Ae={class:"ext-info-list"},Se={class:"ext-content"},Be={class:"ext-info-list"},Ee={key:0,class:"status-block status-success"},Oe={class:"status-block status-warning"},Me={class:"btn-wrapper-box"},Pe={__name:"wechat-app-item",props:{item:{type:Object,default:()=>({})},app_type:{type:String,default:""}},emits:["edit","delete","refresh"],setup(v,{emit:k}){const c=k,g=["mini_program","official_account"],i=v;function d(){c("edit",{...i.item})}function _(){c("delete",{...i.item})}function f(){c("refresh",{...i.item})}return(h,a)=>{const p=oe,s=ie,y=le,u=pe;return r(),b("div",be,[e("div",xe,[e("img",{class:"app-avatar",src:v.item.app_avatar,alt:""},null,8,we),e("div",Ce,[e("div",$e,x(v.item.app_name),1),e("div",Ie,"Appid："+x(v.item.app_id),1)])]),g.includes(i.app_type)?(r(),b(ve,{key:0},[e("div",Ae,[e("div",Se,x(v.item.wechat_reply_type),1)]),e("div",Be,[v.item.account_is_verify=="true"?(r(),b("div",Ee,[o(E(ae)),a[0]||(a[0]=$(" 已认证 "))])):(r(),w(p,{key:1,gap:8},{default:l(()=>[e("div",Oe,[o(E(se)),a[1]||(a[1]=$(" 未认证 "))]),e("a",{onClick:f},"刷新状态")]),_:1}))])],64)):S("",!0),o(u,null,{overlay:l(()=>[o(y,null,{default:l(()=>[o(s,{onClick:d},{default:l(()=>a[2]||(a[2]=[e("a",null,"编 辑",-1)])),_:1,__:[2]}),o(s,{onClick:_},{default:l(()=>a[3]||(a[3]=[e("a",{style:{color:"#fb363f"}},"删 除",-1)])),_:1,__:[3]})]),_:1})]),default:l(()=>[e("div",Me,[o(E(ne),{class:"zm-pointer"})])]),_:1})])}}},Te=T(Pe,[["__scopeId","data-v-7518ad4f"]]),Ue="/assets/img/preview_01-Buh2wvv6.png",Ve="/assets/img/config_preview_01-BMDVQPd_.png",Fe={class:"page-title-input"},Re={class:"upload-logo"},qe=["src"],De={__name:"page-title-input",props:{avatar:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"请输入标题"},autoUpload:{type:Boolean,default:!0}},emits:["update:value","update:avatar","changeAvatar"],setup(v,{emit:k}){const c=k,g=v,i=_=>{c("update:value",_.srcElement.value)},d=_=>{let f={file:_[0],category:"icon"};g.autoUpload&&ye(f).then(h=>{c("update:avatar",h.data.link)}),Z(_[0]).then(h=>{c("changeAvatar",{file:_[0],url:h})})};return(_,f)=>{const h=q;return r(),b("div",Fe,[e("div",Re,[o(ke,{onChange:d},{default:l(()=>[e("img",{class:"avatar",src:g.avatar},null,8,qe)]),_:1})]),o(h,{size:"large",value:g.value,placeholder:v.placeholder,onInput:i},null,8,["value","placeholder"])])}}},Ne=T(De,[["__scopeId","data-v-e5be4d80"]]),We={key:0,class:"add-wechat-app-alert"},je={class:"alert-body"},ze={class:"form-box"},Je={class:"my-ip"},Ge={class:"ip-text"},He={key:1,class:"add-wechat-app-alert"},Le={class:"config-preview-box"},Qe={class:"config-items"},Ye={class:"config-item"},Ke={class:"config-value"},Xe={class:"config-item"},Ze={class:"config-value"},et={class:"config-item"},tt={class:"config-value"},at="/upload/default/official_account_avatar.png",st={__name:"store-modal",emits:["ok"],setup(v,{expose:k,emit:c}){const g=c,i=C(!1),d=C(1),_=C(!1),f=C(),h={id:void 0,app_name:"",app_id:"",app_secret:"",app_avatar:"",app_avatar_url:at,app_type:"official_account",wechat_ip:""},a=R({}),p={app_name:[{required:!0,message:"请输入您的公众号名称",trigger:"change"},{trigger:"change",validator:()=>a.app_avatar_url?Promise.resolve():Promise.reject("请上传公众号头像")}],app_id:[{required:!0,message:"请输入您的AppId",trigger:"change"}],app_secret:[{required:!0,message:"请输入您的AppSecret",trigger:"change"}]},s=fe(()=>{let n=a.id?"编辑微信公众号":"添加微信公众号",t=d.value==1?"-填写公众号开发信息":"-服务器配置";return n+t}),y=({file:n,url:t})=>{a.app_avatar=n,a.app_avatar_url=t},u=R({push_aeskey:"",push_token:"",push_url:""}),I=()=>{let n={...ge(a)};delete n.app_avatar_url,L(n).then(t=>{Object.assign(u,t.data),d.value=2,B.success("保存成功"),g("ok")})},U=()=>{f.value.validate().then(()=>{I()}).catch(n=>{})},W=()=>{i.value=!1},V=()=>{f.value.clearValidate(),f.value.resetFields(),i.value=!1},O=n=>{te(n),B.success("复制成功")},j=()=>{O(a.wechat_ip)};return k({open:async(n=null)=>{n?(n.app_avatar_url=n.app_avatar,n.app_avatar=""):(n=JSON.parse(JSON.stringify(h)),n.id="");const t=ee(),{companyInfo:A,getCompanyInfo:M}=t;A||await M(),n.wechat_ip=A.wechat_ip,d.value=1,Object.assign(a,n),i.value=!0}}),(n,t)=>{const A=D,M=re,P=ce,F=q,z=de,J=N;return r(),w(J,{width:"1168px",open:i.value,"onUpdate:open":t[7]||(t[7]=m=>i.value=m),title:s.value,onCancel:V},{footer:l(()=>[d.value===1?(r(),w(A,{key:"back",onClick:V},{default:l(()=>t[8]||(t[8]=[$("取 消")])),_:1,__:[8]})):S("",!0),d.value===1?(r(),w(A,{key:"submit",type:"primary",loading:_.value,onClick:U},{default:l(()=>t[9]||(t[9]=[$("保存并进入下一步 ")])),_:1,__:[9]},8,["loading"])):S("",!0),d.value===2?(r(),w(A,{key:"submit",type:"primary",loading:_.value,onClick:W},{default:l(()=>t[10]||(t[10]=[$("已完成配置")])),_:1,__:[10]},8,["loading"])):S("",!0)]),default:l(()=>[d.value===1?(r(),b("div",We,[o(M,{class:"tip-alert",message:"进入微信公众号后台（https://developers.weixin.qq.com/console/product），左上角“我的业务和服务”选择”服务号“后在【基础信息中】获取开发者信息。",type:"info","show-icon":""}),e("div",je,[e("div",ze,[o(z,{ref_key:"formRef",ref:f,layout:"vertical",model:a,rules:p},{default:l(()=>[o(P,{label:"公众号头像/名称",name:"app_name"},{default:l(()=>[o(Ne,{autoUpload:!1,avatar:a.app_avatar_url,"onUpdate:avatar":t[0]||(t[0]=m=>a.app_avatar_url=m),value:a.app_name,"onUpdate:value":t[1]||(t[1]=m=>a.app_name=m),valueModifiers:{trim:!0},placeholder:"请输入您的公众号名称",onChangeAvatar:y},null,8,["avatar","value"])]),_:1}),o(P,{label:"AppId",name:"app_id"},{default:l(()=>[o(F,{value:a.app_id,"onUpdate:value":t[2]||(t[2]=m=>a.app_id=m),valueModifiers:{trim:!0},disabled:a.id>0,placeholder:"请输入您的AppId"},null,8,["value","disabled"])]),_:1}),o(P,{label:"AppSecret",name:"app_secret"},{default:l(()=>[o(F,{value:a.app_secret,"onUpdate:value":t[3]||(t[3]=m=>a.app_secret=m),valueModifiers:{trim:!0},placeholder:"请输入您的AppSecret"},null,8,["value"])]),_:1}),o(P,{label:"将以下IP添加到公众号IP白名单中",required:""},{default:l(()=>[e("div",Je,[e("span",Ge,x(a.wechat_ip),1),e("a",{class:"copy-btn",onClick:j},"复 制")])]),_:1})]),_:1},8,["model"])]),t[11]||(t[11]=e("div",{class:"preview-box"},[e("img",{class:"preview-img",src:Ue})],-1))])])):S("",!0),d.value===2?(r(),b("div",He,[o(M,{class:"tip-alert",message:"进入微信公众号后台（https://developers.weixin.qq.com/console/product），在【基础信息-域名与消息推送配置-消息推送】中配置并启用服务器配置。请按照下图配置",type:"info","show-icon":""}),e("div",Le,[e("div",Qe,[e("div",Ye,[e("span",Ke,x(u.push_url),1),e("span",{class:"copy-btn",onClick:t[4]||(t[4]=m=>O(u.push_url))},"复制")]),e("div",Xe,[e("span",Ze,x(u.push_token),1),e("span",{class:"copy-btn",onClick:t[5]||(t[5]=m=>O(u.push_token))},"复制")]),e("div",et,[e("span",tt,x(u.push_aeskey),1),e("span",{class:"copy-btn",onClick:t[6]||(t[6]=m=>O(u.push_aeskey))},"复制")])]),t[12]||(t[12]=e("img",{class:"config-preview-img",src:Ve},null,-1))])])):S("",!0)]),_:1},8,["open","title"])}}},ot=T(st,[["__scopeId","data-v-956b2e4a"]]),nt={class:"_container"},lt={class:"page-title"},it={key:0,class:"loading-box"},pt={key:2,class:"empty-box"},rt={__name:"index",setup(v){const k=C(),c=C([]),g=C(!0);he(()=>{i()});const i=()=>{Q({app_type:"official_account",app_name:""}).then(p=>{c.value=p.data}).finally(()=>{g.value=!1})},d=()=>{k.value.open()},_=p=>{let s=3;const y=N.confirm({title:`确定移除${p.app_name}吗?`,icon:o(me),content:"移除后，机器人已关联绑定或其他已配置该公众号的功能都会失效",okText:s+" 确 定",okType:"danger",cancelText:"取消",okButtonProps:{disabled:!0},onOk(){K({id:p.id}).then(()=>{i(),B.success("删除成功")})},onCancel(){}});let u=setInterval(()=>{s==1?(y.update({okText:"确定",okButtonProps:{disabled:!1}}),clearInterval(u),u=void 0):(s-=1,y.update({okText:s+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},f=p=>{k.value.open({...p})},h=p=>{Y({id:p.id}).then(()=>{B.success("刷新成功"),i()})},a=()=>{let p=[];c.value.forEach((s,y)=>{p.push(s.id)}),X({id_list:p.toString()}).then(s=>{B.success("排序成功")})};return(p,s)=>{const y=D,u=_e;return r(),b("div",nt,[e("div",lt,[s[2]||(s[2]=e("span",null,"公众号管理",-1)),o(y,{onClick:d,icon:o(E(ue)),type:"primary"},{default:l(()=>s[1]||(s[1]=[$("绑定公众号")])),_:1,__:[1]},8,["icon"])]),g.value?(r(),b("div",it,[o(u)])):c.value.length?(r(),w(E(H),{key:1,class:"wechat-app-list",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=I=>c.value=I),"item-key":"id",onEnd:a,handle:".drag-item"},{item:l(({element:I,index:U})=>[(r(),w(Te,{class:"drag-item",key:I.id,item:I,app_type:"official_account",onEdit:f,onDelete:_,onRefresh:h},null,8,["item"]))]),_:1},8,["modelValue"])):(r(),b("div",pt,[s[4]||(s[4]=e("img",{src:G},null,-1)),s[5]||(s[5]=e("div",{class:"title"},"暂未绑定公众号",-1)),o(y,{onClick:d,class:"btn",type:"primary"},{default:l(()=>s[3]||(s[3]=[$("立即绑定")])),_:1,__:[3]})])),o(ot,{ref_key:"storeRef",ref:k,onOk:i},null,512)])}}},kt=T(rt,[["__scopeId","data-v-36da73ed"]]);export{kt as default};
