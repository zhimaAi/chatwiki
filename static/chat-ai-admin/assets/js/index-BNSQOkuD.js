import{w as G}from"./index-CmzDLrI5.js";import{_ as U,a4 as J,j as K}from"../../index-DxV-PNCd.js";import{aw as P,f as k,e as j,r as T,ae as I,ad as p,ar as d,as as t,k as s,ac as g,az as x,G as f,F,ax as H,ai as E,u as _,at as D,o as Q}from"./vue-chunks-CGLjTDrY.js";import{e as X,I as B,T as A,as as W,F as Z,ai as ee,aR as te,aS as oe,aM as S,M as se,b as ae,d as z,X as ne,G as le,a0 as O}from"./ui-antd-AfNpv4wx.js";import{P as N}from"./styles-B3AMWjFt.js";import{dP as ie}from"./util-20cxas0q.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";import"./thirdMcp-BGS_aCGX.js";import"./index-IIUHUqQG.js";const de={class:"flex-content-box"},ue={class:"test-model-box"},re={key:0,class:"result-list-box"},_e=["onClick"],ce={class:"status-block"},pe={class:"icon-name-box"},ve=["src"],me={class:"node-name"},ge={key:0,class:"time-tag"},fe={class:"right-active-icon"},ke={class:"preview-box"},ye={class:"preview-title"},he={class:"icon-name-box"},xe=["src"],be={class:"node-name"},we={key:0,class:"time-tag"},Ce={class:"preview-content-block"},qe={class:"title-block"},De={class:"preview-code-box"},Ye={class:"preview-content-block"},Me={class:"title-block"},$e={class:"preview-code-box"},Ie={class:"preview-content-block"},Se={class:"title-block"},ze={class:"preview-code-box"},Ne={__name:"logs-detail",emits:["save","getGlobal"],setup(L,{expose:Y,emit:R}){const b=P().query,u=k(!1),v=k(""),o=k([]),c=j(()=>v.value?o.value.filter(i=>i.node_key==v.value)[0]:null),r=T({robot_key:b.robot_key,question:"",openid:""}),M=i=>{r.question=i.question||"",r.openid=i.openid||"",o.value=[],v.value="",w(i.node_logs),u.value=!0},w=i=>{var e;o.value=i.map(a=>({...a,is_success:a.error_msg==="<nil>",node_icon:ie(a.node_type)})),v.value=(e=o.value[0])==null?void 0:e.node_key},C=i=>{v.value=i.node_key},y=i=>{J(JSON.stringify(c.value[i])),ae.success("复制成功")};return Y({show:M}),(i,e)=>{const a=W,l=A,h=B,q=X,m=Z,$=se;return p(),I($,{open:u.value,"onUpdate:open":e[5]||(e[5]=n=>u.value=n),title:"日志详情",footer:null,width:880,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:d(()=>[t("div",de,[t("div",ue,[e[10]||(e[10]=t("div",{class:"top-title"},"开始节点参数",-1)),s(m,{model:r,ref:"formRef",layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:d(()=>[s(q,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:d(()=>[s(l,{gap:4},{default:d(()=>[e[7]||(e[7]=f("question ",-1)),s(a,{style:{margin:"0"}},{default:d(()=>[...e[6]||(e[6]=[f("string",-1)])]),_:1})]),_:1})]),default:d(()=>[s(h,{readonly:"",placeholder:"请输入",value:r.question,"onUpdate:value":e[0]||(e[0]=n=>r.question=n)},null,8,["value"])]),_:1}),s(q,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:d(()=>[s(l,{gap:4},{default:d(()=>[e[9]||(e[9]=f("openid ",-1)),s(a,{style:{margin:"0"}},{default:d(()=>[...e[8]||(e[8]=[f("string",-1)])]),_:1})]),_:1})]),default:d(()=>[s(h,{readonly:"",placeholder:"请输入",value:r.openid,"onUpdate:value":e[1]||(e[1]=n=>r.openid=n)},null,8,["value"])]),_:1})]),_:1},8,["model"]),o.value.length>0?(p(),g("div",re,[(p(!0),g(F,null,H(o.value,(n,V)=>(p(),g("div",{class:E(["list-item-block",{active:v.value==n.node_key}]),onClick:Le=>C(n),key:V},[t("div",ce,[n.is_success?(p(),I(_(ee),{key:0,style:{color:"#138b1b"}})):(p(),I(_(te),{key:1,style:{color:"#d81e06"}}))]),t("div",pe,[t("img",{src:n.node_icon,alt:""},null,8,ve),t("div",me,D(n.node_name),1)]),n.is_success?(p(),g("div",ge,D(n.use_time)+"ms",1)):x("",!0),t("div",fe,[s(_(oe))])],10,_e))),128))])):x("",!0)]),t("div",ke,[c.value?(p(),g(F,{key:0},[t("div",ye,[e[11]||(e[11]=t("div",{class:"title-text"},"日志详情",-1)),t("div",he,[t("img",{src:c.value.node_icon,alt:""},null,8,xe),t("div",be,D(c.value.node_name),1)]),c.value.is_success?(p(),g("div",we,D(c.value.use_time)+"ms",1)):x("",!0)]),t("div",Ce,[t("div",qe,[e[12]||(e[12]=f("输入",-1)),s(_(S),{onClick:e[2]||(e[2]=n=>y("input"))})]),t("div",De,[s(_(N),{data:c.value.input},null,8,["data"])])]),t("div",Ye,[t("div",Me,[e[13]||(e[13]=f("输出",-1)),s(_(S),{onClick:e[3]||(e[3]=n=>y("node_output"))})]),t("div",$e,[s(_(N),{data:c.value.node_output},null,8,["data"])])]),t("div",Ie,[t("div",Se,[e[14]||(e[14]=f("运行日志",-1)),s(_(S),{onClick:e[4]||(e[4]=n=>y("output"))})]),t("div",ze,[s(_(N),{data:c.value.output},null,8,["data"])])])],64)):x("",!0)])])]),_:1},8,["open"])}}},Re=U(Ne,[["__scopeId","data-v-62fcb816"]]),Fe={class:"user-model-page"},Oe={class:"list-wrapper"},Ue={class:"content-wrapper"},Pe={class:"search-block"},Te=["onClick"],Be={__name:"index",setup(L){const Y=P().query,R=K(),b=k([]),u=k([z().subtract(6,"day"),z()]),v=k(!1),o=T({robot_id:Y.id,page:1,size:20,total:0,openid:"",question:"",start_date:u.value[0].format("YYYY-MM-DD"),end_date:u.value[1].format("YYYY-MM-DD")}),c=e=>{o.page=e.current,o.size=e.pageSize,w()},r=()=>{o.page=1,w()},M=e=>{o.start_date="",o.end_date="",u.value&&u.value.length>0&&(o.start_date=u.value[0].format("YYYY-MM-DD"),o.end_date=u.value[1].format("YYYY-MM-DD")),r()},w=()=>{v.value=!0,G({...o}).then(e=>{let a=e.data.list||[];b.value=a.map(l=>(l.duration_mills_desc=`${l.duration_mills}ms`,l.total_token_desc=`${(l.total_token/1e3).toFixed(3)}`,l.create_time_desc=z(l.create_time*1e3).format("YYYY-MM-DD HH:mm:ss"),l.node_logs=l.node_logs?JSON.parse(l.node_logs):[],l)),o.total=+e.data.total||0}).finally(()=>{v.value=!1})},C=k(null),y=e=>{C.value.show({...e})},i=[{title:"openid",dataIndex:"openid",key:"openid",width:150},{title:"question",dataIndex:"question",key:"question",width:250},{title:"工作流版本",key:"version",dataIndex:"version",width:130},{title:"耗时",key:"duration_mills_desc",dataIndex:"duration_mills_desc",width:130},{title:"token消耗（K）",key:"total_token_desc",dataIndex:"total_token_desc",width:130},{title:"调用时间",key:"create_time_desc",dataIndex:"create_time_desc",width:150},{title:"操作",key:"action",width:100}];return Q(()=>{r()}),(e,a)=>{const l=ne,h=B,q=le;return p(),g("div",Fe,[a[3]||(a[3]=t("div",{class:"page-title"},"调用日志",-1)),t("div",Oe,[t("div",Ue,[t("div",Pe,[s(l,{value:u.value,"onUpdate:value":a[0]||(a[0]=m=>u.value=m),allowClear:!1,onChange:M,style:{width:"256px"},presets:_(R)},null,8,["value","presets"]),s(h,{style:{width:"256px"},value:o.openid,"onUpdate:value":a[1]||(a[1]=m=>o.openid=m),onChange:r,placeholder:"请输入openid"},{suffix:d(()=>[s(_(O))]),_:1},8,["value"]),s(h,{style:{width:"256px"},value:o.question,"onUpdate:value":a[2]||(a[2]=m=>o.question=m),onChange:r,placeholder:"请输入问题"},{suffix:d(()=>[s(_(O))]),_:1},8,["value"])]),s(q,{class:"table-list",columns:i,"data-source":b.value,loading:v.value,sticky:"",pagination:{current:o.page,total:o.total,pageSize:o.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:c},{bodyCell:d(({column:m,record:$})=>[m.key==="action"?(p(),g("a",{key:0,onClick:n=>y($)},"查看明细",8,Te)):x("",!0)]),_:1},8,["data-source","loading","pagination"])]),s(Re,{ref_key:"logsDetailRef",ref:C},null,512)])])}}},Ze=U(Be,[["__scopeId","data-v-cd68dc6f"]]);export{Ze as default};
