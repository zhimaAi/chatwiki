import{I as K,b as q,$ as ee,M as H,k as $,bS as ae,bC as D,bT as te,B as ne,ag as oe,a5 as le,ev as re}from"../../index-M_xDbIir.js";import{j as n,d as l,w as se,N as b,O as c,U as i,S as M,X as k,u as w,z as T,q as _e,H as ie,W as N,Z as O,F,I as ue,a6 as de,a1 as pe,_ as B,x as ce}from"./vue-chunks-BRsu9_To.js";import{F as j,_ as me}from"./index-V0sRhm34.js";import{P as fe}from"./PlusOutlined-DQ91YM1E.js";import{_ as ve}from"./index-BSroSjtu.js";import{t as he}from"./validate-8MtiUsxW.js";import{M as ge}from"./model-select-Cwu3Of2q.js";import"./index-UA7y0weg.js";import{I as ke}from"./Input-Bx6Hhp2b.js";import{S as ye}from"./SettingOutlined-fVP8x92y.js";import{D as be}from"./DownOutlined-CI2wWtcJ.js";import{U as we}from"./UpOutlined-DzDRcb4z.js";import{Q as xe}from"./QuestionCircleOutlined-B5SgdGK5.js";import{_ as Oe}from"./TextArea-C57yjED6.js";import{_ as Ie}from"./index-B0RyY99D.js";import{S as Ue}from"./SyncOutlined-Ddoh8W5Z.js";import"./index-Dob-Z8xa.js";import{_ as Le,a as Se,R as Ce}from"./RadioButton-Bb2kU0Fd.js";import{_ as $e}from"./index-Csj0hcBP.js";import{_ as ze}from"./Search-w33R1D1l.js";var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function V(p){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?Object(arguments[r]):{},g=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(s).filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable}))),g.forEach(function(_){Pe(p,_,s[_])})}return p}function Pe(p,r,s){return r in p?Object.defineProperty(p,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):p[r]=s,p}var J=function(r,s){var g=V({},r,s.attrs);return n(K,V({},g,{icon:Ae}),null)};J.displayName="UploadOutlined";J.inheritAttrs=!1;const Fe={class:"avatar-uploader"},Ne=["src"],Me={key:1},Te=["src"],je={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(p,{emit:r}){function s(a){return new Promise((t,f)=>{const u=new FileReader;u.readAsDataURL(a),u.onload=()=>t(u.result),u.onerror=L=>f(L)})}const g=r,_=p,m=l([]),e=l(!1),y=l("");se(()=>_.value,a=>{y.value=a},{immediate:!0});const S=j.useInjectFormItemContext(),I=()=>{let a={imageUrl:y.value,file:m.value[0].originFileObj};g("change",a),g("update:value",a.imageUrl),S.onFieldChange()},z=a=>a.type==="image/jpeg"||a.type==="image/png"?a.size/1024<100?(m.value=[a],s(a).then(u=>{y.value=u,e.value=!1,I()}),!1):($.error("知识库封面图片大小不能超过100kb"),!1):($.error("知识库封面只支持JPG、PNG格式的图片"),!1),x=l(!1),C=l(""),U=l(""),A=()=>{x.value=!1,U.value=""},P=async a=>{!a.url&&!a.preview&&(a.preview=await s(a.originFileObj)),C.value=a.url||a.preview,x.value=!0,U.value=a.name||a.url.substring(a.url.lastIndexOf("/")+1)};return(a,t)=>{const f=ve,u=H;return c(),b("div",Fe,[n(f,{class:"upload-upload","file-list":m.value,"onUpdate:fileList":t[0]||(t[0]=L=>m.value=L),"list-type":"picture-card","show-upload-list":!1,"before-upload":z,accept:".jpg,.png,.jpeg",onPreview:P},{default:i(()=>[p.value?(c(),b("img",{key:0,class:"avatar",src:p.value,alt:"avatar"},null,8,Ne)):(c(),b("div",Me,[e.value?(c(),M(w(ee),{key:0})):(c(),M(w(fe),{key:1})),t[1]||(t[1]=k("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list"]),n(u,{open:x.value,title:U.value,footer:null,onCancel:A},{default:i(()=>[k("img",{alt:"example",style:{width:"100%"},src:C.value},null,8,Te)]),_:1},8,["open","title"])])}}},qe=q(je,[["__scopeId","data-v-531f3ba4"]]),De={class:"form-box"},Be={class:"hight-set-text"},Ve={class:"title-block"},R="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Re={__name:"add-qa-library",emits:"ok",setup(p,{expose:r,emit:s}){const g=s,_=l(!0),m=j.useForm,e=T({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_not_merged_text:0,normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:R}),y=T({library_name:[{required:!0,message:"请输入库名称",trigger:"change"}]}),{validate:S,validateInfos:I}=m(e,y),z=a=>{e.avatar=a.imageUrl,e.avatar_file=a.file},x=l([]);ae().then(a=>{x.value=a.data.map(t=>({label:t.name,value:t.no}))});const C=a=>{a.length&&(e.use_model=a[0].children[0].name,e.model_config_id=a[0].model_config_id)},U=()=>{S().then(()=>{A()}).catch(a=>{})},A=()=>{let a=new FormData,t=JSON.parse(JSON.stringify(e));a.append("type",e.type),a.append("access_rights",e.access_rights),a.append("library_name",e.library_name),a.append("library_intro",e.library_intro),a.append("use_model",t.use_model),a.append("model_config_id",e.model_config_id),a.append("avatar",e.avatar_file?e.avatar_file:""),a.append("is_offline",e.is_offline),a.append("urls",JSON.stringify(he(e.urls))),a.append("doc_type",e.doc_type),a.append("file_name",e.file_name),a.append("is_qa_doc",e.is_qa_doc),a.append("qa_index_type",e.qa_index_type),a.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),a.append("chunk_type",e.chunk_type),a.append("normal_chunk_default_separators_no",e.normal_chunk_default_separators_no.join(",")),a.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),a.append("normal_chunk_default_not_merged_text",e.normal_chunk_default_not_merged_text),a.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),a.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),a.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),a.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),a.append("graph_switch",e.graph_switch?1:0),a.append("graph_model_config_id",e.graph_model_config_id),a.append("graph_use_model",e.graph_use_model),a.append("ai_chunk_size",e.ai_chunk_size),a.append("ai_chunk_model",e.ai_chunk_model),a.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),a.append("ai_chunk_prumpt",e.ai_chunk_prumpt),te(a).then(f=>{$.success("创建成功"),g("ok",f.data.id)})};return r({show:()=>{e.type=2,e.avatar=D,e.avatar_file=D,e.library_name="",e.library_intro="",e.chunk_type=1,e.normal_chunk_default_separators_no=[12,11],e.normal_chunk_default_not_merged_text=0,e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=R},handleOk:U}),_e(()=>{}),(a,t)=>{const f=me,u=ke,L=Oe,v=Ie,o=j;return c(),b("div",De,[n(o,{layout:"vertical"},{default:i(()=>[n(f,N({ref:"name",label:!1},w(I).avatar),{default:i(()=>[n(qe,{value:e.avatar,"onUpdate:value":t[0]||(t[0]=d=>e.avatar=d),onChange:z},null,8,["value"]),t[6]||(t[6]=k("div",{class:"form-item-tip"},"点击替换，建议尺寸为100*100px，大小不超过100kb",-1))]),_:1,__:[6]},16),n(f,N({ref:"name",label:"知识库名称"},w(I).library_name),{default:i(()=>[n(u,{value:e.library_name,"onUpdate:value":t[1]||(t[1]=d=>e.library_name=d),placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},16),n(f,N({label:"知识库简介"},w(I).library_intro),{default:i(()=>[n(L,{maxlength:1e3,value:e.library_intro,"onUpdate:value":t[2]||(t[2]=d=>e.library_intro=d),placeholder:"请输入知识库简介，比如 ZHIMA CHATAI 基于大预言模型提供ZHIMA CHATAI 产品帮助"},null,8,["value"])]),_:1},16),k("div",Be,[k("div",Ve,[n(w(ye)),t[7]||(t[7]=O("高级设置"))]),k("div",{class:"right-btn-box",onClick:t[3]||(t[3]=d=>_.value=!_.value)},[_.value?(c(),b(F,{key:0},[t[8]||(t[8]=O(" 展开 ")),n(w(be))],64)):(c(),b(F,{key:1},[t[9]||(t[9]=O(" 收起 ")),n(w(we))],64))])]),ie(n(f,null,{label:i(()=>[t[11]||(t[11]=O("文档解析向量模型 ")),n(v,null,{title:i(()=>t[10]||(t[10]=[O("向量模型可以将分段数据转化为向量形式，存储到向量数据库中，便于后续根据用户问题查询匹配。")])),default:i(()=>[n(w(xe),{class:"ml4"})]),_:1})]),default:i(()=>[n(ge,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":t[4]||(t[4]=d=>e.use_model=d),modeId:e.model_config_id,"onUpdate:modeId":t[5]||(t[5]=d=>e.model_config_id=d),onLoaded:C,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[ue,!_.value]])]),_:1})])}}},He=q(Re,[["__scopeId","data-v-8312b97b"]]),Je={class:"modal-box"},Qe={class:"filter-block"},Ee={key:0,class:"empty-block"},Ge={class:"list-box"},Ze=["onClick"],Xe={class:"info-block"},We={class:"title"},Ye={class:"desc"},Ke={__name:"import-knowledge-modal",emits:["ok"],setup(p,{expose:r,emit:s}){const g=s;T({});const _=l(!1),m=l(1),e=l(""),y=l(""),S=l(""),I=l(""),z=v=>{S.value=v.id,I.value=v.ids||"",m.value=1,e.value="",y.value="",_.value=!0,t()},x=l(!1),C=()=>{m.value==1?A():u.value.handleOk()},U=v=>{x.value=!0,re({library_id:v,file_id:S.value,ids:I.value}).then(o=>{$.success("导入成功"),_.value=!1,g("ok")}).finally(()=>{x.value=!1})},A=()=>{if(!y.value)return $.error("请选择导入的知识库");U(y.value)},P=v=>{U(v)},a=l([]),t=v=>{le({library_name:e.value,show_open_docs:1}).then(o=>{a.value=o.data.filter(d=>d.type==2),v&&$.success("刷新成功")})},f=v=>{y.value=v.id},u=l(null),L=()=>{m.value==2&&ce(()=>{u.value&&u.value.show()})};return r({show:z}),(v,o)=>{const d=Se,Q=Le,E=$e,G=ze,Z=ne,X=oe,W=Ce,Y=H;return c(),b("div",null,[n(Y,{open:_.value,"onUpdate:open":o[4]||(o[4]=h=>_.value=h),"confirm-loading":x.value,title:"导入问答知识库",width:"746px",wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onOk:C},{default:i(()=>[k("div",Je,[n(Q,{value:m.value,"onUpdate:value":o[0]||(o[0]=h=>m.value=h),onChange:L},{default:i(()=>[n(d,{value:1},{default:i(()=>o[5]||(o[5]=[O("导入到已有知识库")])),_:1,__:[5]}),n(d,{value:2},{default:i(()=>o[6]||(o[6]=[O("创建问答知识库并导入")])),_:1,__:[6]})]),_:1},8,["value"]),m.value==1?(c(),b(F,{key:0},[n(E,{style:{"font-size":"14px",color:"#8c8c8c","font-weight":"400"},orientation:"left","orientation-margin":"0px"},{default:i(()=>o[7]||(o[7]=[O(" 请选择要导入的知识库 ")])),_:1,__:[7]}),k("div",Qe,[n(G,{value:e.value,"onUpdate:value":o[1]||(o[1]=h=>e.value=h),placeholder:"请输入知识库名称搜索",style:{width:"240px"},onSearch:o[2]||(o[2]=h=>t())},null,8,["value"]),n(Z,{onClick:o[3]||(o[3]=h=>t(!0)),icon:n(w(Ue))},{default:i(()=>o[8]||(o[8]=[O("刷新")])),_:1,__:[8]},8,["icon"])]),a.value.length==0?(c(),b("div",Ee,[n(X)])):de("",!0),k("div",Ge,[(c(!0),b(F,null,pe(a.value,h=>(c(),b("div",{class:"list-item",onClick:ea=>f(h),key:h.id},[n(W,{checked:y.value==h.id},null,8,["checked"]),k("div",Xe,[k("div",We,B(h.library_name),1),k("div",Ye,B(h.library_intro),1)])],8,Ze))),128))])],64)):(c(),M(He,{key:1,ref_key:"addQaLibraryRef",ref:u,onOk:P},null,512))])]),_:1},8,["open","confirm-loading"])])}}},ba=q(Ke,[["__scopeId","data-v-32808078"]]);export{ba as I,J as U};
