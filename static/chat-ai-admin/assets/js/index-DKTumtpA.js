var qE=Object.defineProperty;var XE=(r,e,t)=>e in r?qE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var bo=(r,e,t)=>XE(r,typeof e!="symbol"?e+"":e,t);import{t as GE,u as YE,v as KE,w as JE,x as ZE,y as bp,z as f1,A as oy,B as QE,C as Go}from"./index-DxRFb1rg.js";import{u as Yr}from"./robot-qyZOqvMH.js";import{b as xt,d as jr,F as xv,ac as h1,ak as Ul,al as eC,am as tC,a9 as nC,h as rC,ah as iC,ai as oC}from"../../index-BLRnoXQj.js";import{e as tn,ab as Vl,f as Se,o as Kt,Y as ue,_ as G,ae as tt,a5 as E,k as H,a2 as q,G as $e,a7 as Ne,F as st,a9 as mt,ad as gn,a1 as Ue,aa as aC,n as Mo,am as sC,B as dn,A as fa,u as ze,j as Mi,a3 as Za,c as Mt,af as On,a6 as Oi,E as p1,r as Jt,w as Qt,y as xn,X as lC,J as Gi,l as bn,K as ha,d as gs,s as uC,g as dC,a4 as cC,ah as v1,aj as uc,p as Yo,an as fC,m as hC,a8 as ms,ag as ql,b as g1}from"./vue-chunks-Ci-XTWEs.js";import{p as Ai,a4 as pC,g as ys,ay as Pu,a8 as wv,z as $n,B as Fn,aD as m1,aE as vC,I as kr,b as Sv,c as Ev,D as Cv,au as gC,ab as Kn,M as Sr,F as Ti,e as Yi,u as Hr,v as $r,X as pa,Q as dc,ar as cc,aF as va,aB as Xl,O as Di,K as _s,E as bs,aA as mC,aG as kv,y as y1,q as _1,R as b1,T as yC,av as _C,ah as Ov,ad as bC,ag as x1,a as Hn,aC as xC,ap as gr,ai as wC,aH as xs,a9 as Nv,aI as w1,a7 as SC,aJ as EC,aK as on,aL as Ht,aM as Qa,aN as Gl,aO as Sf,aP as Va,aQ as un,aR as To,aS as so,aT as la,aU as es,aV as wr,s as CC,aW as kC,aX as xp,aY as wp,aZ as OC,a_ as S1,a$ as NC,b0 as MC,b1 as ay,b2 as AC,b3 as Sp,b4 as E1,b5 as TC,b6 as C1,b7 as DC,b8 as fl,ao as Mv,ac as k1,b9 as LC,ba as PC,bb as RC,a3 as IC,bc as BC,d as qa,an as jC,aw as HC}from"./ui-antd-BKz8sshA.js";import{u as $C}from"./global-DqP7WgZx.js";import{_ as sy}from"./empty-BFmzY9bl.js";import{g as FC,a as zC,b as WC,c as UC,_ as VC,d as qC,e as XC,f as GC,h as YC,i as KC,j as JC,k as ZC,l as QC,m as ek,n as tk,o as nk,p as rk,q as ik,r as ok,s as ak,t as sk,u as lk,v as uk,w as dk,x as ck,y as fk,z as hk,A as pk,B as vk,C as gk,D as mk,E as yk,F as _k,G as bk,H as xk,I as wk,J as Sk,K as Ek,L as Ck,M as kk,N as Ok,O as Nk,P as Mk,Q as Ak,R as Tk,S as Dk,T as Lk,U as Pk,V as Rk,W as Ik,X as Bk,Y as jk,Z as Hk,$ as $k,a0 as Fk,a1 as zk,a2 as Wk,a3 as Uk,a4 as Vk,a5 as qk,a6 as Xk,a7 as Gk,a8 as Yk,a9 as Kk,aa as Jk,ab as Zk,ac as Qk,ad as eO,ae as tO,af as nO,ag as rO,ah as iO,ai as oO,aj as aO,ak as sO,al as lO,am as uO,an as dO,ao as cO,ap as fO,aq as hO,ar as pO,as as vO,at as gO,au as mO,av as yO,aw as _O,ax as bO,ay as xO,az as wO,aA as SO,aB as EO,aC as CO,aD as kO,aE as OO,aF as NO,aG as MO,aH as AO,aI as TO,aJ as DO,aK as LO,aL as PO,aM as RO,aN as IO,aO as BO,aP as jO,aQ as HO,aR as $O,aS as FO,aT as zO,aU as WO,aV as UO,aW as VO,aX as qO,aY as XO,aZ as GO,a_ as YO,a$ as KO,b0 as JO,b1 as ZO,b2 as QO,b3 as e2,b4 as t2,b5 as n2,b6 as r2,b7 as i2,b8 as o2,b9 as a2,ba as s2,bb as l2,bc as u2,bd as d2,be as c2,bf as f2,bg as h2,bh as p2,bi as v2,bj as g2,bk as m2,bl as y2,bm as _2,bn as b2,bo as x2,bp as w2,bq as S2,br as E2,bs as C2,bt as k2,bu as O2,bv as N2,bw as M2,bx as A2,by as T2,bz as D2,bA as L2,bB as P2,bC as R2,bD as I2,bE as B2,bF as j2,bG as H2,bH as $2,bI as F2,bJ as z2,bK as W2,bL as U2,bM as V2,bN as q2,bO as X2,bP as G2,bQ as Y2,bR as K2,bS as J2,bT as Z2,bU as Q2,bV as eN,bW as tN,bX as nN,bY as rN,bZ as iN,b_ as oN,b$ as aN,c0 as sN,c1 as lN,c2 as uN,c3 as dN,c4 as cN,c5 as fN,c6 as hN,c7 as pN,c8 as vN,c9 as gN,ca as mN,cb as yN,cc as _N,cd as bN,ce as xN,cf as wN,cg as SN,ch as EN,ci as CN,cj as kN,ck as ON,cl as NN,cm as MN,cn as AN,co as TN,cp as DN,cq as LN,cr as PN,cs as RN,ct as IN,cu as BN,cv as jN,cw as HN,cx as $N,cy as FN,cz as zN,cA as WN,cB as UN,cC as VN,cD as ws,cE as O1,cF as qN,cG as XN,cH as GN,cI as YN}from"./styles-DfaMakAP.js";import{M as fc}from"./model-select-KZ3YhMAM.js";import{_ as N1}from"./index-Cn5OUZ21.js";import{_ as Av}from"./empty-CzGZrENG.js";import{a as KN,g as JN}from"./index-C4cSzA-H.js";import{h as M1}from"./index-DyZ-tGAB.js";import{d as ZN}from"./vuedraggable.umd-DJBjom-v.js";import{g as A1}from"./thirdMcp-oOvjWmUE.js";import{r as T1,g as D1}from"./index-3pYQ3PA3.js";import{c as L1}from"./utils-ChQO-_r6.js";import{r as QN,a as eM,b as P1,c as Yl,d as R1,e as Tv,f as Dv,g as hc,h as Kl,i as tM,j as Lv,k as nM,l as I1,m as B1,n as rM,o as j1,p as iM,q as Pv,s as oM,t as aM,u as sM,v as lM,w as uM,x as dM,y as cM,z as fM,A as hM,B as pM,C as vM,D as gM,E as H1,F as mM,G as yM,H as _M,I as $1,J as F1,K as bM,L as z1,M as xM,N as wM,O as SM,P as EM,Q as CM,R as kM,S as OM,T as NM,U as MM,V as AM,W as TM,X as DM,Y as LM,Z as PM,_ as RM,$ as IM}from"./index-Ds5Umk46.js";import{T as BM}from"./top-header-D_X_iFB4.js";import{a as jM}from"./add-group-B7FKjxkw.js";import"./cu-scroll-C6Q1olgl.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";const HM={key:0,class:"sidebar-handle-wrapper"},$M={class:"sidebar-container"},FM={class:"sidebar-menus"},zM=["onClick"],WM={class:"menu-name"},UM={__name:"page-sidebar",props:{showSidebarBtn:{default:!0,type:Boolean}},setup(r){const e=$C(),t=aC(),n=Vl(),i=tn(()=>n.path.split("/")[3]),o=Se(!0),a=Se(!0);function l(){o.value=!o.value,a.value=!1,e.setHideLayoutTopAndBottom(o.value)}const u=[{label:"工作流编排",value:"workflow",path:"/robot/config/workflow",iconName:"workflow"},{label:"对外服务",value:"external-services",path:"/robot/config/external-services",iconName:"duiwaifuwu"},{label:"聊天测试",value:"test",path:"/robot/test",iconName:"liaotianceshi",isNewWindowOpen:!0},{label:"问答反馈",value:"qa-feedbacks",path:"/robot/config/qa-feedbacks",iconName:"qa-feedback"},{label:"会话记录",value:"session-record",path:"/robot/config/session-record",iconName:"session-record"},{label:"API Key管理",value:"api-key-manage",path:"/robot/config/api-key-manage",iconName:"duiwaifuwu"},{label:"未知问题",value:"unknown_issue",path:"/robot/config/unknown_issue",iconName:"unknown-issue"},{label:"统计分析",value:"statistical_analysis",path:"/robot/config/statistical_analysis",iconName:"statistical-analysis"},{label:"导出记录",value:"export-record",path:"/robot/config/export-record",iconName:"export-record"},{label:"调用日志",value:"invoke-logs",path:"/robot/config/invoke-logs",iconName:"doc-file"}],d=f=>{if(f.isNewWindowOpen){window.open(`/#${f.path}?robot_key=${n.query.robot_key}&id=${n.query.id}`);return}t.push({path:f.path,query:n.query})};return Kt(()=>{setTimeout(()=>{a.value=!1},3e3)}),(f,h)=>{const g=Ai,y=jr;return G(),ue("div",{class:gn(["sidebar-wrapper",{"is-hide":o.value}])},[r.showSidebarBtn?(G(),ue("div",HM,[H(g,{mouseEnterDelay:0,mouseLeaveDelay:0,placement:"right",open:a.value,"onUpdate:open":h[0]||(h[0]=w=>a.value=w),arrow:!1},{title:q(()=>[$e(Ne(o.value?"展开":"收起"),1)]),default:q(()=>[E("span",{class:"sidebar-handle",onClick:l},h[1]||(h[1]=[E("span",{class:"handle-line handle-line01"},null,-1),E("span",{class:"handle-line handle-line02"},null,-1)]))]),_:1},8,["open"])])):tt("",!0),E("div",$M,[E("div",FM,[(G(),ue(st,null,mt(u,w=>E("div",{class:gn(["sidebar-menu",{active:i.value==w.value}]),key:w.value,onClick:x=>d(w)},[o.value?(G(),Ue(g,{key:0,placement:"bottom"},{title:q(()=>[E("span",null,Ne(w.label),1)]),default:q(()=>[H(y,{name:w.iconName,class:"menu-icon",size:"16"},null,8,["name"])]),_:2},1024)):(G(),Ue(y,{key:1,name:w.iconName,class:"menu-icon",size:"16"},null,8,["name"])),E("span",WM,Ne(w.label),1)],10,zM)),64))])])],2)}}},VM=xt(UM,[["__scopeId","data-v-36a951c8"]]),qM={name:"NodeCommon",props:{modelValue:{type:Number,default:100}},data(){return{isShowMenu:!1,currentValue:`${this.modelValue}%`,previousValue:this.modelValue,debounceTimer:null,menus:[{label:"10%",value:10},{label:"50%",value:50},{label:"80%",value:80},{label:"100%",value:100},{label:"150%",value:150},{label:"200%",value:200},{label:"400%",value:400}]}},watch:{modelValue(r){r!==parseInt(this.currentValue.replace(/[^\d]/g,""),10)&&(this.currentValue=`${r}%`,this.previousValue=r)}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("update:modelValue",r.value),this.$emit("zoom-change",r.value),this.isShowMenu=!1},showMenu(){this.isShowMenu=!this.isShowMenu},handleFitView(){this.isShowMenu=!1,this.$emit("fitView")},handleInput(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const r=this.currentValue.replace("%","").trim(),e=parseInt(r.replace(/[^\d]/g,""),10);if(!r){this.currentValue=`${this.previousValue}%`;return}if(isNaN(e)){this.currentValue=`${this.previousValue}%`;return}let t=e;t>800&&(t=800),t<1&&(t=1),this.currentValue=`${t}%`,this.previousValue=t,this.$emit("update:modelValue",t),this.$emit("zoom-change",t)},300)},handleBlur(){clearTimeout(this.debounceTimer);const r=parseInt(this.currentValue.replace(/[^\d]/g,""),10);!isNaN(r)&&r>=1&&r<=800?(this.$emit("update:modelValue",r),this.$emit("zoom-change",r),this.currentValue=`${r}%`,this.previousValue=r):this.currentValue=`${this.previousValue}%`},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".zoom-select-options").contains(r.target)&&r.target!==this.$el.querySelector(".zoom-select-label")&&(this.isShowMenu=!1)}}},XM={class:"zoom-select"},GM={class:"zoom-select-options"},YM=["onClick"];function KM(r,e,t,n,i,o){return G(),ue("div",XM,[E("div",{class:"zoom-select-label",onClick:e[4]||(e[4]=dn(()=>{},["stop"]))},[Mo(E("input",{class:"zoom-select-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>i.currentValue=a),onInput:e[1]||(e[1]=(...a)=>o.handleInput&&o.handleInput(...a)),onFocus:e[2]||(e[2]=(...a)=>o.showMenu&&o.showMenu(...a)),onBlur:e[3]||(e[3]=(...a)=>o.handleBlur&&o.handleBlur(...a))},null,544),[[sC,i.currentValue]])]),Mo(E("div",GM,[(G(!0),ue(st,null,mt(i.menus,a=>(G(),ue("div",{class:"zoom-select-option",key:a.value,onClick:l=>o.handleMenu(a)},Ne(a.label),9,YM))),128)),e[6]||(e[6]=E("div",{class:"option-line"},null,-1)),E("div",{class:"zoom-select-option",onClick:e[5]||(e[5]=a=>o.handleFitView())},"全览")],512),[[fa,i.isShowMenu]])])}const JM=xt(qM,[["render",KM],["__scopeId","data-v-be70cfde"]]),ZM={class:"node-list-popup"},QM={class:"tabs-box"},eA={class:"node-list-popup-content"},tA={key:0,class:"node-list"},nA={class:"node-type"},rA={class:"node-flex-box"},iA=["onMousedown"],oA=["src","alt"],aA={class:"node-name"},sA={key:1,class:"node-box"},lA={class:"search-box"},uA={key:0,class:"node-list"},dA={class:"node-info-pop"},cA={class:"info"},fA=["src"],hA={class:"name"},pA={class:"extra"},vA=["onClick"],gA=["src"],mA={class:"info"},yA={class:"name"},_A={class:"total"},bA={class:"mcp-tools"},xA={class:"params-box"},wA={class:"param-item"},SA={class:"field"},EA={class:"name"},CA={class:"desc"},kA={class:"field"},OA={class:"name"},NA={class:"type"},MA={key:0,class:"required"},AA={class:"desc"},TA=["onMousedown"],DA={key:1,class:"empty-box"},LA={key:2,class:"node-box"},PA={class:"node-list"},RA=["onClick"],IA={class:"node-info"},BA=["src"],jA={class:"info"},HA={class:"name"},$A={class:"more-link",href:"/#/plugins/index?active=2",target:"_blank"},FA={key:1,class:"empty-box"},zA={href:"/#/plugins/index?active=2",target:"_blank"},WA={__name:"node-list-popup",props:{type:{type:String,default:""}},emits:["addNode","mouseMove"],setup(r,{emit:e}){const t=e,i=FC(r.type),o=Se([]),a=Se([]),l=Se(1),u=Se("");Kt(()=>{zC().then(x=>{a.value=x}),WC().then(x=>{o.value=x})});const d=tn(()=>u.value?a.value.filter(x=>(x.description+x.name).indexOf(u.value)>-1):a.value),f=(x,b)=>{x.preventDefault();let _=!1;const S=x.clientX,k=x.clientY,O=JSON.parse(JSON.stringify(b)),M=document.createElement("div");M.classList.add("node-item-ghost"),M.innerHTML=x.currentTarget.innerHTML,document.body.appendChild(M);const R=$=>{M.style.left=`${$.clientX+5}px`,M.style.top=`${$.clientY+5}px`};R(x);const T=$=>{!_&&(Math.abs($.clientX-S)>5||Math.abs($.clientY-k)>5)&&(_=!0),R($),t("mouseMove")},I=$=>{document.body.removeChild(M),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",I),_?t("addNode",{node:O,event:$}):h(O)};window.addEventListener("mousemove",T),window.addEventListener("mouseup",I,{once:!0})},h=x=>{x=JSON.parse(JSON.stringify(x)),t("addNode",{node:x})},g=(x,b,_)=>{let S=UC(b,_);f(x,S)};function y(x){l.value=x}function w(){window.open("/#/robot/list?active=3&mcp=2","_blank")}return(x,b)=>{const _=jr,S=pC,k=wv;return G(),ue("div",ZM,[E("div",QM,[E("div",{class:gn(["tab-item",{active:l.value==1}]),onClick:b[0]||(b[0]=O=>y(1))},[H(_,{name:"base-node-type"}),b[4]||(b[4]=$e(" 基础功能 "))],2),E("div",{class:gn(["tab-item",{active:l.value==3}]),onClick:b[1]||(b[1]=O=>y(3))},[H(_,{name:"plugin-node-type"}),b[5]||(b[5]=$e(" 插件 "))],2),E("div",{class:gn(["tab-item",{active:l.value==2}]),onClick:b[2]||(b[2]=O=>y(2))},[H(_,{name:"mcp-node-type"}),b[6]||(b[6]=$e(" MCP "))],2)]),E("div",eA,[l.value==1?(G(!0),ue(st,{key:0},mt(ze(i),O=>(G(),ue(st,{key:O.key},[O.hidden?tt("",!0):(G(),ue("div",tA,[E("div",nA,Ne(O.name),1),E("div",rA,[(G(!0),ue(st,null,mt(O.nodes,M=>(G(),ue(st,{key:M.type},[M.hidden?tt("",!0):(G(),ue("div",{key:0,class:"node-item",onMousedown:R=>f(R,M)},[E("img",{src:M.properties.node_icon,alt:M.properties.node_name},null,8,oA),E("div",aA,Ne(M.properties.node_name),1)],40,iA))],64))),128))])]))],64))),128)):l.value==2?(G(),ue("div",sA,[E("div",lA,[H(S,{value:u.value,"onUpdate:value":b[3]||(b[3]=O=>u.value=O),valueModifiers:{trim:!0},allowClear:"",placeholder:"请输入名称查询"},null,8,["value"])]),d.value.length?(G(),ue("div",uA,[(G(!0),ue(st,null,mt(d.value,(O,M)=>(G(),ue("div",{key:M,class:"node-item"},[H(k,{placement:"right"},{content:q(()=>[E("div",dA,[E("div",cA,[E("img",{class:"avatar",src:O.avatar},null,8,fA),E("div",hA,Ne(O.name),1)]),E("div",null,Ne(O.url),1),E("div",pA,"可用工具："+Ne(O.tools.length),1)])]),default:q(()=>[E("div",{class:"node-info",onClick:R=>O.expand=!O.expand},[E("img",{class:"avatar",src:O.avatar},null,8,gA),E("div",mA,[E("span",yA,Ne(O.name),1),E("span",_A,[$e(Ne(O.tools.length)+" ",1),O.expand?(G(),Ue(ze(ys),{key:0})):(G(),Ue(ze(Pu),{key:1}))])])],8,vA)]),_:2},1024),Mo(E("div",bA,[(G(!0),ue(st,null,mt(O.tools,(R,T)=>(G(),Ue(k,{key:T,placement:"right"},{content:q(()=>[E("div",xA,[E("div",wA,[E("div",SA,[E("span",EA,Ne(R.name),1)]),E("div",CA,Ne(R.description),1)]),(G(!0),ue(st,null,mt(R.inputSchema.properties,(I,$)=>(G(),ue("div",{key:$,class:"param-item"},[E("div",kA,[E("span",OA,Ne($),1),E("span",NA,Ne(I.type),1),R.inputSchema.required&&R.inputSchema.required.includes($)?(G(),ue("span",MA,"必填")):tt("",!0)]),E("div",AA,Ne(I.description),1)]))),128))])]),default:q(()=>[E("div",{class:"node-tool-item",onMousedown:I=>g(I,O,R)},Ne(R.name),41,TA)]),_:2},1024))),128))],512),[[fa,O.expand]])]))),128))])):(G(),ue("div",DA,[b[8]||(b[8]=E("img",{style:{height:"200px"},src:sy},null,-1)),b[9]||(b[9]=E("div",null,"暂无可用MCP插件",-1)),E("a",{onClick:w},[b[7]||(b[7]=$e("去添加")),H(ze(Pu))])]))])):l.value==3?(G(),ue("div",LA,[o.value.length?(G(),ue(st,{key:0},[E("div",PA,[(G(!0),ue(st,null,mt(o.value,O=>(G(),ue("div",{onClick:M=>h(O),key:O.type,class:"node-item"},[E("div",IA,[E("img",{class:"avatar",src:O.properties.node_icon},null,8,BA),E("div",jA,[E("span",HA,Ne(O.properties.node_name),1)])])],8,RA))),128))]),E("a",$A,[b[10]||(b[10]=$e("更多插件 ")),H(ze(Pu))])],64)):(G(),ue("div",FA,[b[12]||(b[12]=E("img",{style:{height:"200px"},src:sy},null,-1)),b[13]||(b[13]=E("div",null,"暂无可用插件",-1)),E("a",zA,[b[11]||(b[11]=$e("去添加")),H(ze(Pu))])]))])):tt("",!0)])])}}},W1=xt(WA,[["__scopeId","data-v-4c091e84"]]),UA={class:"custom-control-warpper"},VA={class:"custom-control-body"},qA={class:"custom-control"},XA={class:"control-item zoom-control"},GA={class:"control-item"},YA={class:"control-item"},KA={class:"control-item"},JA={__name:"index",props:{lf:{type:Object,default:()=>({}),required:!0}},emits:["runTest","addNode","zoomChange","autoLayout"],setup(r,{emit:e}){const t=e,n=r,{eventCenter:i}=n.lf.graphModel,o=Se(100),a=()=>{n.lf.fitView()},l=()=>{let k=o.value/100;n.lf.zoom(k),t("zoomChange",k)},u=k=>{o.value=k,l()},d=()=>{let k=o.value-10;k<1&&(k=1),o.value=k,l()},f=()=>{let k=o.value+10;k>800&&(k=800),o.value=k,l()},h=Se(!1),g=Se(null),y=k=>{let O=Math.floor(k.transform.SCALE_X*100);o.value=O},w=()=>{t("runTest")},x=()=>{t("autoLayout")},b=k=>{h.value&&(g.value.contains(k.target)||(h.value=!1))},_=()=>{h.value&&(h.value=!1)},S=k=>{t("addNode",k),h.value=!1};return Kt(()=>{document.addEventListener("click",b),i.on("graph:transform",y)}),Mi(()=>{document.removeEventListener("click",b),i.off("graph:transform",y)}),(k,O)=>{const M=jr,R=Fn;return G(),ue("div",UA,[E("div",VA,[E("div",qA,[E("div",XA,[E("div",{class:"action-btn zoom-btn",onClick:d},[H(M,{name:"minus",size:"16"})]),H(JM,{modelValue:o.value,"onUpdate:modelValue":O[0]||(O[0]=T=>o.value=T),onZoomChange:u,onFitView:a},null,8,["modelValue"]),E("div",{class:"action-btn zoom-btn",onClick:f},[H(M,{name:"plus",size:"16"})])]),O[5]||(O[5]=E("i",{class:"control-line"},null,-1)),E("div",GA,[H(R,{type:"primary",onClick:O[1]||(O[1]=dn(T=>h.value=!0,["stop"]))},{icon:q(()=>[H(ze($n))]),default:q(()=>[O[2]||(O[2]=E("span",null,"新建节点",-1))]),_:1,__:[2]})]),E("div",YA,[H(R,{onClick:w,style:{"background-color":"#00ad3a"},type:"primary"},{default:q(()=>[H(ze(m1)),O[3]||(O[3]=E("span",null,"运行测试",-1))]),_:1,__:[3]})]),E("div",KA,[H(R,{onClick:x,type:"default"},{default:q(()=>[H(ze(vC)),O[4]||(O[4]=E("span",null,"整理画布",-1))]),_:1,__:[4]})])]),Mo(E("div",{class:"node-list-fix",ref_key:"nodeListRef",ref:g},[H(W1,{onAddNode:S,type:"float-btn",onMouseMove:_})],512),[[fa,h.value]])])])}}},ZA=xt(JA,[["__scopeId","data-v-942362f7"]]),QA={},eT={class:"node-form-layout"},tT={class:"layout-header"},nT={class:"layout-body"};function rT(r,e){return G(),ue("div",eT,[E("div",tT,[Za(r.$slots,"header",{},void 0,!0)]),E("div",nT,[Za(r.$slots,"default",{},void 0,!0)])])}const sr=xt(QA,[["render",rT],["__scopeId","data-v-1df44d93"]]),iT={class:"node-form-header"},oT={class:"node-title"},aT={class:"title-left"},sT=["src"],lT={class:"title-conttent"},uT={class:"title-right"},dT={class:"node-desc"},cT={__name:"node-form-header",props:{iconName:{type:String,default:""},title:{type:String,default:""},desc:{type:String,default:""},hideMenus:{type:Boolean,default:!1}},setup(r){const e=Mt("changeTitle"),t=Mt("deleteNode"),n=Mt("close"),i=r;let o=null;const a=g=>new URL(Object.assign({"../../../../assets/svg/ai-dialogue-node.svg":VN,"../../../../assets/svg/ai-generate-white.svg":UN,"../../../../assets/svg/ai-generate.svg":WN,"../../../../assets/svg/ai-mark.svg":zN,"../../../../assets/svg/ai.svg":FN,"../../../../assets/svg/alert-icon.svg":$N,"../../../../assets/svg/ali-ocr.svg":HN,"../../../../assets/svg/analysis.svg":jN,"../../../../assets/svg/anthrop.svg":BN,"../../../../assets/svg/applet.svg":IN,"../../../../assets/svg/arrow-down.svg":RN,"../../../../assets/svg/arrow-left.svg":PN,"../../../../assets/svg/arrow-right.svg":LN,"../../../../assets/svg/attachment.svg":DN,"../../../../assets/svg/auth.svg":TN,"../../../../assets/svg/auto-reply.svg":AN,"../../../../assets/svg/azure.svg":MN,"../../../../assets/svg/baichuan.svg":NN,"../../../../assets/svg/base-node-type.svg":ON,"../../../../assets/svg/book.svg":kN,"../../../../assets/svg/chat-cache.svg":CN,"../../../../assets/svg/chat-mode.svg":EN,"../../../../assets/svg/chat-robot-icon.svg":SN,"../../../../assets/svg/chat.svg":wN,"../../../../assets/svg/check-arrow-filled.svg":xN,"../../../../assets/svg/circularNeedle.svg":bN,"../../../../assets/svg/client.svg":_N,"../../../../assets/svg/close-circle.svg":yN,"../../../../assets/svg/cmd.svg":mN,"../../../../assets/svg/code-run-node.svg":gN,"../../../../assets/svg/cohere.svg":vN,"../../../../assets/svg/collaborator.svg":pN,"../../../../assets/svg/collapse-close.svg":hN,"../../../../assets/svg/collapse-open.svg":fN,"../../../../assets/svg/colour-edit.svg":cN,"../../../../assets/svg/comment-search.svg":dN,"../../../../assets/svg/common-quession.svg":uN,"../../../../assets/svg/cu-doc-active.svg":lN,"../../../../assets/svg/cu-doc-icon.svg":sN,"../../../../assets/svg/data-node.svg":aN,"../../../../assets/svg/data-security.svg":oN,"../../../../assets/svg/database-menu-icon.svg":iN,"../../../../assets/svg/deepseek.svg":rN,"../../../../assets/svg/delete.svg":nN,"../../../../assets/svg/ding-group-node.svg":tN,"../../../../assets/svg/direct-connection.svg":eN,"../../../../assets/svg/dislike-active.svg":Q2,"../../../../assets/svg/dislike.svg":Z2,"../../../../assets/svg/doc-active-menu-icon.svg":J2,"../../../../assets/svg/doc-directory.svg":K2,"../../../../assets/svg/doc-draft.svg":Y2,"../../../../assets/svg/doc-file.svg":G2,"../../../../assets/svg/doc-file2.svg":X2,"../../../../assets/svg/doc-icon-active.svg":q2,"../../../../assets/svg/doc-icon.svg":V2,"../../../../assets/svg/doc-menu-icon.svg":U2,"../../../../assets/svg/document.svg":W2,"../../../../assets/svg/download.svg":z2,"../../../../assets/svg/drag.svg":F2,"../../../../assets/svg/duiwaifuwu.svg":$2,"../../../../assets/svg/economic-active.svg":H2,"../../../../assets/svg/economic.svg":j2,"../../../../assets/svg/edit-02.svg":B2,"../../../../assets/svg/edit.svg":I2,"../../../../assets/svg/empty-document.svg":R2,"../../../../assets/svg/empty.svg":P2,"../../../../assets/svg/end-node.svg":L2,"../../../../assets/svg/enterprise-active.svg":D2,"../../../../assets/svg/enterprise.svg":T2,"../../../../assets/svg/enterprise2.svg":A2,"../../../../assets/svg/expand.svg":M2,"../../../../assets/svg/explain-node.svg":N2,"../../../../assets/svg/export-record.svg":O2,"../../../../assets/svg/eye-open.svg":k2,"../../../../assets/svg/field-menu-icon.svg":C2,"../../../../assets/svg/file-icon.svg":E2,"../../../../assets/svg/file-search.svg":S2,"../../../../assets/svg/finance.svg":w2,"../../../../assets/svg/function-center.svg":x2,"../../../../assets/svg/gemini.svg":b2,"../../../../assets/svg/generate-icon.svg":_2,"../../../../assets/svg/gou.svg":y2,"../../../../assets/svg/government.svg":m2,"../../../../assets/svg/graph-icon.svg":g2,"../../../../assets/svg/guanlianzhishiku.svg":v2,"../../../../assets/svg/high-active.svg":p2,"../../../../assets/svg/high.svg":h2,"../../../../assets/svg/http-node.svg":f2,"../../../../assets/svg/huanyingyu.svg":c2,"../../../../assets/svg/huoshanyinqin.svg":d2,"../../../../assets/svg/img-icon.svg":u2,"../../../../assets/svg/input.svg":l2,"../../../../assets/svg/jibenpeizhi.svg":s2,"../../../../assets/svg/jichupeizhi.svg":a2,"../../../../assets/svg/jina.svg":o2,"../../../../assets/svg/judge-node.svg":i2,"../../../../assets/svg/knowledge-base-node.svg":r2,"../../../../assets/svg/knowledge-config-active-icon.svg":n2,"../../../../assets/svg/knowledge-config-icon.svg":t2,"../../../../assets/svg/law.svg":e2,"../../../../assets/svg/liaotianceshi.svg":QO,"../../../../assets/svg/like-active.svg":ZO,"../../../../assets/svg/like-icon.svg":JO,"../../../../assets/svg/like.svg":KO,"../../../../assets/svg/lingyiwanwu.svg":YO,"../../../../assets/svg/link-icon-active.svg":GO,"../../../../assets/svg/link-icon.svg":XO,"../../../../assets/svg/link-left.svg":qO,"../../../../assets/svg/lock-icon.svg":VO,"../../../../assets/svg/login-success.svg":UO,"../../../../assets/svg/logout.svg":WO,"../../../../assets/svg/manufacture.svg":zO,"../../../../assets/svg/mcp-node-type.svg":FO,"../../../../assets/svg/mcp-node.svg":$O,"../../../../assets/svg/medical-treatment.svg":HO,"../../../../assets/svg/menu-expand.svg":jO,"../../../../assets/svg/message.svg":BO,"../../../../assets/svg/minus.svg":IO,"../../../../assets/svg/mix-icon.svg":RO,"../../../../assets/svg/more-compatible.svg":PO,"../../../../assets/svg/moxingshezhi.svg":LO,"../../../../assets/svg/multimode-box.svg":DO,"../../../../assets/svg/nav-chat.svg":TO,"../../../../assets/svg/nav-doc.svg":AO,"../../../../assets/svg/nav-explore.svg":MO,"../../../../assets/svg/nav-find.svg":NO,"../../../../assets/svg/nav-library.svg":OO,"../../../../assets/svg/nav-robot.svg":kO,"../../../../assets/svg/nav-search.svg":CO,"../../../../assets/svg/network.svg":EO,"../../../../assets/svg/open-ai.svg":SO,"../../../../assets/svg/ordinary-segmentation.svg":wO,"../../../../assets/svg/out-the-box.svg":xO,"../../../../assets/svg/output.svg":bO,"../../../../assets/svg/parameter-extraction-node.svg":_O,"../../../../assets/svg/pc.svg":yO,"../../../../assets/svg/pdf-img.svg":mO,"../../../../assets/svg/pdf-ocr.svg":gO,"../../../../assets/svg/pdf-text.svg":vO,"../../../../assets/svg/phone.svg":pO,"../../../../assets/svg/plugin-node-type.svg":hO,"../../../../assets/svg/plus.svg":fO,"../../../../assets/svg/point-h.svg":cO,"../../../../assets/svg/problem-optimization-node.svg":dO,"../../../../assets/svg/problem-optimization.svg":uO,"../../../../assets/svg/prompt-icon.svg":lO,"../../../../assets/svg/put-away.svg":sO,"../../../../assets/svg/qa-feedback.svg":aO,"../../../../assets/svg/question-node.svg":oO,"../../../../assets/svg/quick-Instruction.svg":iO,"../../../../assets/svg/quote-file.svg":rO,"../../../../assets/svg/quotes.svg":nO,"../../../../assets/svg/recommendation.svg":tO,"../../../../assets/svg/reply-content.svg":eO,"../../../../assets/svg/reply-settings.svg":Qk,"../../../../assets/svg/retail.svg":Zk,"../../../../assets/svg/reward-points.svg":Jk,"../../../../assets/svg/right-fork-icon.svg":Kk,"../../../../assets/svg/robot_auto_reply.svg":Yk,"../../../../assets/svg/robot_subscribe_reply.svg":Gk,"../../../../assets/svg/save-draft.svg":Xk,"../../../../assets/svg/sdk.svg":qk,"../../../../assets/svg/search-check-icon.svg":Vk,"../../../../assets/svg/search-right.svg":Uk,"../../../../assets/svg/search-tip.svg":Wk,"../../../../assets/svg/search.svg":zk,"../../../../assets/svg/segmentation-down.svg":Fk,"../../../../assets/svg/segmentation-icon.svg":$k,"../../../../assets/svg/segmentation-up.svg":Hk,"../../../../assets/svg/segmentation.svg":jk,"../../../../assets/svg/select-disabled.svg":Bk,"../../../../assets/svg/semantic-segmentation.svg":Ik,"../../../../assets/svg/sensitive-icon.svg":Rk,"../../../../assets/svg/seo-gray.svg":Pk,"../../../../assets/svg/seo-highlight.svg":Lk,"../../../../assets/svg/seo-light.svg":Dk,"../../../../assets/svg/session-record.svg":Tk,"../../../../assets/svg/session.svg":Ak,"../../../../assets/svg/set-keywords.svg":Mk,"../../../../assets/svg/setting.svg":Nk,"../../../../assets/svg/share.svg":Ok,"../../../../assets/svg/similarity.svg":kk,"../../../../assets/svg/skii.svg":Ck,"../../../../assets/svg/source-energy.svg":Ek,"../../../../assets/svg/specify-reply-node.svg":Sk,"../../../../assets/svg/start-node.svg":wk,"../../../../assets/svg/statistical-analysis.svg":xk,"../../../../assets/svg/success.svg":bk,"../../../../assets/svg/suggested-issues.svg":_k,"../../../../assets/svg/support.svg":yk,"../../../../assets/svg/switch-mobile.svg":mk,"../../../../assets/svg/system-setting.svg":gk,"../../../../assets/svg/team-manage-active.svg":vk,"../../../../assets/svg/team-manage.svg":pk,"../../../../assets/svg/team-manage2.svg":hk,"../../../../assets/svg/tengxunhunyuan.svg":fk,"../../../../assets/svg/test-active-menu-icon.svg":ck,"../../../../assets/svg/test-menu-icon.svg":dk,"../../../../assets/svg/think.svg":uk,"../../../../assets/svg/tongyiqianwen.svg":lk,"../../../../assets/svg/unit.svg":sk,"../../../../assets/svg/unknown-issue.svg":ak,"../../../../assets/svg/unknown-prompt.svg":ok,"../../../../assets/svg/use-token-active.svg":ik,"../../../../assets/svg/use-token.svg":rk,"../../../../assets/svg/user-icon.svg":nk,"../../../../assets/svg/variable-assignment-node.svg":tk,"../../../../assets/svg/vector-icon.svg":ek,"../../../../assets/svg/wenxinyiyan.svg":QC,"../../../../assets/svg/workflow-robot-icon.svg":ZC,"../../../../assets/svg/workflow.svg":JC,"../../../../assets/svg/wx-app-icon.svg":KC,"../../../../assets/svg/xitongtishici.svg":YC,"../../../../assets/svg/xunfeixinghuo.svg":GC,"../../../../assets/svg/yuezhianmian.svg":XC,"../../../../assets/svg/zhipuai.svg":qC,"../../../../assets/svg/zm-plugins-node.svg":VC})[`../../../../assets/svg/${g}.svg`],import.meta.url).href,l=tn(()=>a(i.iconName)),u=Se(i.title),d=()=>{o&&clearTimeout(o),o=setTimeout(()=>{e(u.value)},250)},f=()=>{t()},h=()=>{n()};return(g,y)=>{const w=kr,x=jr,b=Ev,_=Sv,S=Cv;return G(),ue("div",iT,[E("div",oT,[E("div",aT,[Za(g.$slots,"node-icon",{},()=>[l.value?(G(),ue("img",{key:0,class:"node-icon",src:l.value},null,8,sT)):tt("",!0)],!0)]),E("div",lT,[H(w,{class:"node-name-input",value:u.value,"onUpdate:value":y[0]||(y[0]=k=>u.value=k),placeholder:"请输入节点名称",onChange:dn(d,["stop"])},null,8,["value"])]),E("div",uT,[r.hideMenus?tt("",!0):(G(),Ue(S,{key:0},{overlay:q(()=>[H(_,{style:{width:"100px"}},{default:q(()=>[H(b,{onClick:y[2]||(y[2]=k=>f())},{default:q(()=>y[3]||(y[3]=[E("a",{href:"javascript:;"},"删除",-1)])),_:1,__:[3]})]),_:1})]),default:q(()=>[E("div",{class:"action-btn delete-btn",onClick:y[1]||(y[1]=dn(()=>{},["prevent"]))},[H(x,{name:"point-h",class:"btn-icon"})])]),_:1})),E("div",{class:"action-btn close-btn",onClick:h},[H(ze(gC),{class:"btn-icon",style:{"font-size":"12px"}})])])]),E("div",dT,[Za(g.$slots,"desc",{},()=>[$e(Ne(i.desc),1)],!0)])])}}},lr=xt(cT,[["__scopeId","data-v-50b4425e"]]),Rv="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%207.99609L11%207.99609'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M5.6665%2012L1.6665%208L5.6665%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",fT="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cg%20clip-path='url(%23u9u3epnhq__clip0_8437_35332)'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23262626'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%203.66536L8.00033%201.33203L10.3337%203.66536L8.00033%205.9987L5.66699%203.66536Z'%20stroke='%23262626'/%3e%3cpath%20d='M10%208.33333L12.3333%206L14.6667%208.33333L12.3333%2010.6667L10%208.33333Z'%20stroke='%23262626'/%3e%3cpath%20d='M5.66699%2012.3333L8.00033%2010L10.3337%2012.3333L8.00033%2014.6667L5.66699%2012.3333Z'%20stroke='%23000'/%3e%3cpath%20d='M1.3335%207.9974L3.66683%205.66406L6.00016%207.9974L3.66683%2010.3307L1.3335%207.9974Z'%20stroke='%23000'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='u9u3epnhq__clip0_8437_35332'%3e%3cpath%20fill='%23fff'%20d='M0%200H16V16H0z'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",hT=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"array<string>",value:"array<string>"}],pT={emits:["close","update-node"],components:{NodeFormLayout:sr,NodeFormHeader:lr,QuestionCircleOutlined:Kn,PlusOutlined:$n},props:{nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},data(){return{sys_global:[],diy_global:[],show:!1,typOptions:[...hT],formState:{key:"",value:"",typ:"string",required:!1,desc:""},editIndex:-1,formRules:{key:[{required:!0,message:"请输入变量名",trigger:"blur"},{pattern:/[a-zA-Z_][a-zA-Z0-9_\-.]*/,message:"英文字母和下划线组成",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符",trigger:"blur"}],typ:[{required:!0,message:"请选择变量类型",trigger:"change"}],required:[{required:!0,message:"请选择是否必填",trigger:"change"}],desc:[{min:1,max:50,message:"长度在1到50个字符",trigger:"blur"}]}}},mounted(){let r=JSON.parse(this.node.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global},methods:{update(){let r=JSON.parse(this.node.node_params);r.start.diy_global=[...this.diy_global];let e={...this.node,node_params:JSON.stringify(r)};this.$emit("update-node",e)},handleAdd(){this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.editIndex=-1,this.show=!0},handleEdit(r,e){this.formState={...r},this.editIndex=e,this.show=!0},handleDel(r){this.diy_global.splice(r,1),this.update()},async handleOk(){try{await this.$refs.formRef.validate(),this.editIndex>-1?(this.diy_global.splice(this.editIndex,1,{...this.formState}),this.editIndex=-1):this.diy_global.push({...this.formState}),this.show=!1,this.formState={key:"",value:"",typ:"string",required:!1,desc:""},this.update()}catch{}}}},vT={class:"start-node-form"},gT={class:"node-form-content"},mT={class:"start-node"},yT={class:"start-node-options"},_T={class:"options-item-body"},bT={class:"option-label"},xT={class:"option-type"},wT={class:"start-node-options"},ST={class:"options-title"},ET={class:"options-item-body"},CT={class:"option-label"},kT={class:"option-type"},OT={class:"item-actions-box"},NT={class:"action-items-box"};function MT(r,e,t,n,i,o){const a=On("NodeFormHeader"),l=On("QuestionCircleOutlined"),u=Ai,d=jr,f=On("PlusOutlined"),h=Fn,g=kr,y=Yi,w=$r,x=Hr,b=pa,_=dc,S=Ti,k=Sr,O=On("NodeFormLayout");return G(),Ue(O,null,{header:q(()=>[H(a,{title:t.node.node_name,iconName:t.node.node_icon_name,hideMenus:!0},{desc:q(()=>e[5]||(e[5]=[E("span",null,"流程开始节点，点击可以设置全局变量、触发方式等",-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",vT,[E("div",gT,[E("div",mT,[E("div",yT,[e[6]||(e[6]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Rv,alt:"",class:"title-icon"}),$e("输出")])],-1)),(G(!0),ue(st,null,mt(i.sys_global,M=>(G(),ue("div",{class:gn(["options-item",{"is-required":M.required}]),key:M.key},[E("div",_T,[E("div",bT,Ne(M.key),1),E("div",xT,Ne(M.typ),1)])],2))),128))]),E("div",wT,[E("div",ST,[e[8]||(e[8]=E("div",null,[E("img",{src:fT,alt:"",class:"title-icon"}),E("span",null,"自定义全局变量")],-1)),E("div",null,[H(u,{placement:"topRight",overlayStyle:{maxWidth:"600px"}},{title:q(()=>e[7]||(e[7]=[E("div",null,[$e(" 定义工作流的全局变量。通过全局变量可以临时缓存数据。全局变量可以通过以下方式赋值："),E("br"),$e(" 1、通过webapp访问时，可以在连接中拼接参数给全局变量赋值"),E("br"),$e(" 2、通过api访问时，可以再API中传递参数值"),E("br"),$e(" 3、可以通过变量赋值节点，给全局变量赋值 ")],-1)])),default:q(()=>[H(l,{style:{color:"#595959","font-size":"16px"}})]),_:1})])]),(G(!0),ue(st,null,mt(i.diy_global,(M,R)=>(G(),ue("div",{class:gn(["options-item diy-options-item",{"is-required":M.required}]),key:M.key},[E("div",ET,[E("div",CT,Ne(M.key),1),E("div",kT,Ne(M.typ),1)]),E("div",OT,[H(d,{class:"action-btn",name:"edit-02",onClick:T=>o.handleEdit(M,R)},null,8,["onClick"]),H(d,{class:"action-btn",name:"close-circle",onClick:T=>o.handleDel(R)},null,8,["onClick"])])],2))),128)),E("div",NT,[H(h,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:o.handleAdd},{icon:q(()=>[H(f)]),default:q(()=>[e[9]||(e[9]=$e(" 添加全局变量 "))]),_:1,__:[9]},8,["onClick"])])]),H(k,{open:i.show,"onUpdate:open":e[4]||(e[4]=M=>i.show=M),title:"新增变量",okText:"保 存",cancelText:"取 消",onOk:o.handleOk},{default:q(()=>[H(S,{ref:"formRef",model:i.formState,rules:i.formRules,"label-align":"right","label-col":{span:4},"wrapper-col":{span:19}},{default:q(()=>[H(y,{label:"变量名",name:"key"},{default:q(()=>[H(g,{value:i.formState.key,"onUpdate:value":e[0]||(e[0]=M=>i.formState.key=M),placeholder:"请输入变量名"},null,8,["value"])]),_:1}),H(y,{label:"类型",name:"typ"},{default:q(()=>[H(x,{value:i.formState.typ,"onUpdate:value":e[1]||(e[1]=M=>i.formState.typ=M)},{default:q(()=>[(G(!0),ue(st,null,mt(i.typOptions,M=>(G(),Ue(w,{value:M.value,key:M.value},{default:q(()=>[E("span",null,Ne(M.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),H(y,{label:"必填",name:"required"},{default:q(()=>[H(b,{checked:i.formState.required,"onUpdate:checked":e[2]||(e[2]=M=>i.formState.required=M)},null,8,["checked"])]),_:1}),H(y,{label:"描述",name:"desc"},{default:q(()=>[H(_,{value:i.formState.desc,"onUpdate:value":e[3]||(e[3]=M=>i.formState.desc=M),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk"])])])])]),_:1})}const AT=xt(pT,[["render",MT],["__scopeId","data-v-47555c0d"]]),TT={name:"CascadePanel",props:{options:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},checkAnyLevel:{type:Boolean,default:!1},childrenKey:{type:String,default:"children"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},data(){return{activePath:[],selectedValuePath:[],selectedPath:[],expandDirection:"right"}},watch:{options:{handler(){this.initPanel()},immediate:!0},value:{handler(r){r&&this.initSelectedPath()},immediate:!0}},methods:{initPanel(){if(!this.options||this.options.length===0){this.activePath=[];return}this.activePath=[{title:"",options:this.options,level:0}],this.value&&this.initSelectedPath()},initSelectedPath(){Array.isArray(this.value)?(this.selectedValuePath=[...this.value],this.findPathByValues(this.selectedValuePath)):this.findPathByValue(this.value)},findPathByValue(r){const e=[],t=[],n=(i,o)=>{if(!i||i.length===0)return!1;for(let a=0;a<i.length;a++){const l=i[a],u=l[this.valueKey];if(u===r)return e[o]=l,t[o]=u,!0;if(l[this.childrenKey]&&l[this.childrenKey].length>0){if(e[o]=l,t[o]=u,n(l[this.childrenKey],o+1))return!0;e[o]=null,t[o]=null}}return!1};n(this.options,0),this.selectedPath=e.filter(i=>i),this.selectedValuePath=t.filter(i=>i!=null),this.updateActivePath()},findPathByValues(r){if(!r||r.length===0)return;const e=[];let t=this.options;for(let n=0;n<r.length;n++){const i=r[n],o=t.find(a=>a[this.valueKey]===i);if(o)e.push(o),t=o[this.childrenKey]||[];else break}this.selectedPath=e,this.updateActivePath()},updateActivePath(){if(!this.selectedPath||this.selectedPath.length===0){this.activePath=[{title:"",options:this.options,level:0}];return}this.activePath=[],this.activePath.push({title:"",options:this.options,level:0});for(let r=0;r<this.selectedPath.length;r++){const e=this.selectedPath[r];e[this.childrenKey]&&e[this.childrenKey].length>0&&this.activePath.push({title:e[this.labelKey],options:e[this.childrenKey],level:r+1})}},handleSelect(r,e){this.hasChildren(r)&&this.checkDirection(),this.selectedPath=this.selectedPath.slice(0,e),this.selectedPath.push(r),this.selectedValuePath=this.selectedValuePath.slice(0,e),this.selectedValuePath.push(r[this.valueKey]),this.activePath=this.activePath.slice(0,e+1),this.hasChildren(r)&&this.activePath.push({title:r[this.labelKey],options:r[this.childrenKey],level:e+1}),this.$emit("select",r,this.selectedPath,e),(this.checkAnyLevel||!this.hasChildren(r))&&(this.$emit("change",r[this.valueKey],this.selectedValuePath,this.selectedPath),this.$emit("input",this.checkAnyLevel?this.selectedValuePath:r[this.valueKey]))},isActive(r,e){return!this.selectedPath||this.selectedPath.length<=e?!1:r[this.valueKey]===this.selectedPath[e][this.valueKey]},hasChildren(r){return r[this.childrenKey]&&r[this.childrenKey].length>0},checkDirection(){this.$nextTick(()=>{const r=this.$el;if(!r)return;const e=r.getBoundingClientRect(),t=window.innerWidth,n=180;e.right+n>t&&e.left>n?this.expandDirection!=="left"&&(this.expandDirection="left",this.$emit("direction-change","left",n)):this.expandDirection!=="right"&&(this.expandDirection="right",this.$emit("direction-change","right",n))})},reset(){this.selectedPath=[],this.selectedValuePath=[],this.expandDirection="right",this.initPanel()}}},DT={class:"cascade-panel"},LT={class:"cascade-panel-body"},PT=["onClick"],RT={class:"item-content"},IT={class:"item-label"},BT={key:0,class:"item-icon"},jT={key:0,class:"cascade-panel-empty"};function HT(r,e,t,n,i,o){return G(),ue("div",DT,[E("div",{class:gn(["cascade-panel-container",[`expand-direction-${i.expandDirection}`]])},[(G(!0),ue(st,null,mt(i.activePath,(a,l)=>(G(),ue("div",{class:"cascade-panel-list",key:l},[E("div",LT,[(G(!0),ue(st,null,mt(a.options,u=>(G(),ue("div",{class:gn(["cascade-panel-item",{active:o.isActive(u,l)}]),key:u.value,onClick:d=>o.handleSelect(u,l)},[E("div",RT,[E("span",IT,Ne(u.label),1),o.hasChildren(u)?(G(),ue("span",BT,e[0]||(e[0]=[E("svg",{viewBox:"0 0 1024 1024",width:"12",height:"12"},[E("path",{d:"M765.7 486.8L314.9 134.7c-5.3-4.1-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-37.6 0-50.4z",fill:"currentColor"})],-1)]))):tt("",!0)])],10,PT))),128)),a.options&&a.options.length===0?(G(),ue("div",jT," 暂无数据 ")):tt("",!0)])]))),128))],2)])}const $T=xt(TT,[["render",HT],["__scopeId","data-v-ae341962"]]),U1=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...U1(t.children)):e.push(t)}),e},FT={name:"JMention",components:{CascadePanel:$T},inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),document.addEventListener("dragstart",this.handleDragstart),document.addEventListener("click",this.handleClick),document.addEventListener("scroll",this.onScroll),this.initData()},beforeUnmount(){document.removeEventListener("dragstart",this.handleDragstart),document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.onScroll)},methods:{handleClick(r){r.target.closest(".dropdown-list")||this.hideDropdownMenus()},handleDragstart(r){r.target.closest(".dropdown-list")&&r.preventDefault()},onScroll(){this.hideDropdownMenus()},hideDropdownMenus(){this.showDropdown=!1,this.showAtList=!1},onFocus(){this.$emit("focus")},onOpen(r){this.$emit("open",r)},getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=U1(this.options),i=[...t,...n].filter(a=>a&&a.value&&a.value!=""&&a.typ!=="node");const o=new Set;i.forEach(a=>{const l=new RegExp(`(${a.value})`,"g");if(l.test(this.defaultValue)&&!o.has(a.value)){let u=a.node_name+"."+a.text;u=u.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${a.node_id}" contentEditable="false" data-value="${a.value}">${u}</span> `),o.add(a.value),this.selectOption(a,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const a=i.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?o+=u.textContent.slice(0,n):o+=u.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const a=n.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?i+=u.textContent.slice(0,t):i+=u.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize(),i=window.innerWidth,o=window.innerHeight;let a=t.bottom,l=t.left;return a+n.height>o&&(a=t.top-n.height),l+n.width>i&&(l=t.right-n.width),a<0&&(a=0),l<0&&(l=0),{top:a,left:l}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{top:t,left:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle=`left:${n}px; top:${t}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),a=o.startOffset,l=o.startContainer;let u=a-t,d=l;if(u<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){u=f.textContent.length-t,d=f;break}f=f.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(u,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const h=document.createElement("span");h.contentEditable=!0,h.innerHTML+="&nbsp;",h.classList.add("at-space");for(const w in e)f.dataset[w]=e[w];const g=document.createRange();g.setStart(d,u),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),h.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())},handleDirectionChange(r,e){const t=this.positionStyle.match(/left:\s*(-?\d+\.?\d*)px/),n=this.positionStyle.match(/top:\s*(-?\d+\.?\d*)px/);if(!t||!n)return;const i=parseFloat(t[1]),o=parseFloat(n[1]);let a;r==="left"?a=i-e:a=i+e,this.positionStyle=`left:${a}px; top:${o}px;`}}},zT={style:{width:"100%",position:"relative"}},WT={class:"mention-input-warpper",ref:"JMentionContainer"},UT=["placeholder"],VT={key:0,class:"placeholder"};function qT(r,e,t,n,i,o){const a=On("CascadePanel");return G(),ue("div",zT,[e[5]||(e[5]=E("div",null,null,-1)),(G(),Ue(p1,{to:"body"},[i.showDropdown?(G(),ue("div",{key:0,class:"dropdown-list",ref:"dropdownList",style:Oi(i.positionStyle)},[H(a,{options:i.showOptions,onChange:o.onSelectOption,onDirectionChange:o.handleDirectionChange},null,8,["options","onChange","onDirectionChange"])],4)):tt("",!0)])),E("div",WT,[E("div",{ref:"JMention",style:Oi([t.inputStyle]),class:gn(["j-mention",[{"show-placeholder":i.localValue.length==0},"type-"+t.type]]),contenteditable:"plaintext-only",placeholder:t.placeholder,onWheel:e[0]||(e[0]=dn(()=>{},["stop"])),onFocus:e[1]||(e[1]=(...l)=>o.onFocus&&o.onFocus(...l)),onInput:e[2]||(e[2]=(...l)=>o.divInput&&o.divInput(...l)),onKeydown:e[3]||(e[3]=(...l)=>o.dropDownKeydown&&o.dropDownKeydown(...l)),onClick:e[4]||(e[4]=(...l)=>o.clickJMention&&o.clickJMention(...l))},null,46,UT),i.localValue.length==0?(G(),ue("span",VT,Ne(t.placeholder),1)):tt("",!0)],512)])}const or=xt(FT,[["render",qT],["__scopeId","data-v-73bd3767"]]),XT={class:"problem-optimization-form"},GT={class:"gray-block"},YT={class:"flex-block-item"},KT={class:"number-box"},JT={class:"number-slider-box"},ZT={class:"number-input-box"},QT={class:"number-box"},eD={class:"number-slider-box"},tD={class:"number-input-box"},nD={class:"number-box"},rD={class:"number-box"},iD={class:"number-slider-box"},oD={class:"number-input-box"},aD={class:"field-list-item"},sD={class:"field-label"},lD={class:"field-type"},uD={class:"diy-form-item"},dD={class:"form-content"},cD={__name:"problem-optimization-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Yr(),o=Se(null),a=tn(()=>i.modelList),l=Se([]),u=Se([]),d=Se(!1),f=()=>{d.value=!d.value},h=(V,J)=>{_.prompt=V,_.prompt_tags=J};function g(){const V=n.lf.getNodeModelById(n.nodeId);if(V){let J=V.getAllParentVariable();u.value=y(J)}}function y(V){return V.forEach(J=>{J.typ=="node"?J.node_type==1?J.value="global":J.value=J.node_id:J.value=J.key,J.children&&J.children.length>0&&(J.children=y(J.children))}),V}const w=()=>{const V=n.lf.getNodeModelById(n.nodeId);if(V){let J=V.getAllParentVariable();l.value=J}};function x(V){if(V){let J=V.split("."),D=J[0],U=J.filter((j,fe)=>fe>0).join(".");return[D,U]}return["global","question"]}const b=Se(),_=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1}),S=()=>{const V=n.node.dataRaw||n.node.node_params||"{}",J=JSON.stringify({question_optimize:JSON.parse(V).question_optimize||{}}),D=JSON.stringify({question_optimize:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});J!=D&&t("update-node",{...n.node,..._,node_params:D})},k=()=>{try{let V=n.node.dataRaw||n.node.node_params||"{}",J=JSON.parse(V).question_optimize||{};J=JSON.parse(JSON.stringify(J));let{model_config_id:D,use_model:U,context_pair:j,temperature:fe,max_token:Ee,prompt:_e,prompt_tags:rt,question_value:Me,enable_thinking:ve}=J;w(),g(),_.model_config_id=D,_.use_model=U,_.context_pair=j||0,_.temperature=fe,_.max_token=Ee,_.prompt=_e,_.enable_thinking=ve,_.prompt_tags=rt||[],_.question_value=x(Me),!_.model_config_id&&a.value.length>0&&(_.model_config_id=a.value[0].id,_.use_model=a.value[0].children[0].name)}catch(V){}};Qt(()=>_,()=>{S()},{deep:!0});const O=Se(null),M=V=>{_.prompt="",V.prompt_type==1?_.prompt=V.markdown:_.prompt=V.prompt,xn(()=>{o.value.initData()})},R=V=>{V||g()},T=Se({}),I=(V,J)=>{T.value=J},$=tn(()=>{if(!_.model_config_id)return!1;let V=_.model_config_id+"#"+_.use_model;return T.value[V]}),ne=()=>{t("close")};return Kt(()=>{k()}),(V,J)=>{const D=Fn,U=Yi,j=Ai,fe=Xl,Ee=va,_e=Di,rt=pa,Me=_s,ve=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型优化用户问题，补全潜在信息缺口，提升知识召回率",onClose:ne},null,8,["title","iconName"])]),default:q(()=>[E("div",XT,[E("div",{class:"node-form-content",onMousedown:J[11]||(J[11]=dn(()=>{},["stop"]))},[H(ve,{ref_key:"formRef",ref:b,layout:"vertical",model:_},{default:q(()=>[E("div",GT,[J[24]||(J[24]=E("div",{class:"gray-block-title"},"输入",-1)),H(U,{label:"LLM模型",name:"use_model"},{default:q(()=>[E("div",YT,[H(fc,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":J[0]||(J[0]=Ve=>_.use_model=Ve),modeId:_.model_config_id,"onUpdate:modeId":J[1]||(J[1]=Ve=>_.model_config_id=Ve),onLoaded:I,style:{width:"348px"}},null,8,["modeName","modeId"]),H(D,{onClick:f},{default:q(()=>[J[12]||(J[12]=$e("高级设置 ")),d.value?(G(),Ue(ze(ys),{key:0})):(G(),Ue(ze(cc),{key:1}))]),_:1,__:[12]})])]),_:1}),d.value?(G(),Ue(U,{key:0,name:"temperature"},{label:q(()=>[J[14]||(J[14]=E("span",null,"温度 ",-1)),H(j,null,{title:q(()=>J[13]||(J[13]=[$e("温度越低，回答越严谨。温度越高，回答越发散。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",KT,[E("div",JT,[H(Ee,null,{default:q(()=>[H(fe,{class:"custom-slider",value:_.temperature,"onUpdate:value":J[2]||(J[2]=Ve=>_.temperature=Ve),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",ZT,[H(_e,{value:_.temperature,"onUpdate:value":J[3]||(J[3]=Ve=>_.temperature=Ve),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):tt("",!0),d.value?(G(),Ue(U,{key:1,name:"max_token"},{label:q(()=>[J[16]||(J[16]=E("span",null,"最大token ",-1)),H(j,null,{title:q(()=>J[15]||(J[15]=[$e("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",QT,[E("div",eD,[H(Ee,null,{default:q(()=>[H(fe,{class:"custom-slider",value:_.max_token,"onUpdate:value":J[4]||(J[4]=Ve=>_.max_token=Ve),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",tD,[H(_e,{value:_.max_token,"onUpdate:value":J[5]||(J[5]=Ve=>_.max_token=Ve),min:0,max:100*1024},null,8,["value"])])])]),_:1})):tt("",!0),d.value&&$.value?(G(),Ue(U,{key:2,name:"enable_thinking"},{label:q(()=>[J[18]||(J[18]=E("span",null,"深度思考 ",-1)),H(j,null,{title:q(()=>J[17]||(J[17]=[$e("开启时，调用大模型时会指定走深度思考模式")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",nD,[H(rt,{checked:_.enable_thinking,"onUpdate:checked":J[6]||(J[6]=Ve=>_.enable_thinking=Ve)},null,8,["checked"])])]),_:1})):tt("",!0),H(U,{name:"context_pair"},{label:q(()=>[J[20]||(J[20]=E("span",null,"上下文数量 ",-1)),H(j,null,{title:q(()=>J[19]||(J[19]=[$e("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",rD,[E("div",iD,[H(Ee,null,{default:q(()=>[H(fe,{class:"custom-slider",value:_.context_pair,"onUpdate:value":J[7]||(J[7]=Ve=>_.context_pair=Ve),min:0,max:50},null,8,["value"])]),_:1})]),E("div",oD,[H(_e,{value:_.context_pair,"onUpdate:value":J[8]||(J[8]=Ve=>_.context_pair=Ve),min:0,max:50},null,8,["value"])])])]),_:1}),H(U,{name:"prompt",class:"width-100"},{label:q(()=>J[21]||(J[21]=[E("div",{class:"space-between-box"},[E("div",null,"对话背景")],-1)])),default:q(()=>[H(or,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:o,onOpen:w,onChange:J[9]||(J[9]=(Ve,Be)=>h(Ve,Be)),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},{option:q(({label:Ve,payload:Be})=>[E("div",aD,[E("div",sD,Ne(Ve),1),E("div",lD,Ne(Be.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),J[22]||(J[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",uD,[J[23]||(J[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",dD,[H(Me,{value:_.question_value,"onUpdate:value":J[10]||(J[10]=Ve=>_.question_value=Ve),onDropdownVisibleChange:R,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:Ve})=>Ve.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),J[25]||(J[25]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"问题优化结果"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[25]},8,["model"]),H(N1,{onOk:M,ref_key:"importPromptRef",ref:O},null,512)],32)])]),_:1})}}},fD=xt(cD,[["__scopeId","data-v-2f37db05"]]),hD={class:"input-box"},pD={__name:"full-at-input",props:{options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},defaultValue:{type:String,default:""},placeholder:{type:String,default:"请输入消息内容，键入“/”可以插入变量"},type:{type:String,default:"textarea"}},emits:["open","change","ok"],setup(r,{expose:e,emit:t}){const n=Se(!1),i=t;Qt(()=>n.value,h=>{h||i("ok")});const o=r,a=Se(null),l=()=>{n.value=!0,xn(()=>{a.value.refresh()})},u=h=>{i("open",h)},d=(h,g)=>{i("change",h,g)},f=()=>{n.value=!1};return e({show:l}),(h,g)=>{const y=Fn,w=Sr;return G(),ue("div",null,[H(w,{open:n.value,"onUpdate:open":g[1]||(g[1]=x=>n.value=x),title:"字段详情",width:746},{footer:q(()=>[H(y,{type:"primary",onClick:f},{default:q(()=>g[2]||(g[2]=[$e("确定")])),_:1,__:[2]})]),default:q(()=>[E("div",hD,[H(or,{inputStyle:"height: 550px;",options:o.options,defaultSelectedList:o.defaultSelectedList,defaultValue:o.defaultValue,placeholder:o.placeholder,type:o.type,ref_key:"atInputRef",ref:a,onOpen:u,onChange:g[0]||(g[0]=(x,b)=>d(x,b))},null,8,["options","defaultSelectedList","defaultValue","placeholder","type"])])]),_:1},8,["open"])])}}},V1=xt(pD,[["__scopeId","data-v-1f67dd47"]]),vD={class:"problem-optimization-form"},gD={class:"gray-block"},mD={class:"flex-block-item"},yD={class:"number-box"},_D={class:"number-slider-box"},bD={class:"number-input-box"},xD={class:"number-box"},wD={class:"number-slider-box"},SD={class:"number-input-box"},ED={class:"number-box"},CD={class:"number-box"},kD={class:"number-slider-box"},OD={class:"number-input-box"},ND={class:"space-between-box"},MD={class:"field-list-item"},AD={class:"field-label"},TD={class:"field-type"},DD={class:"diy-form-item"},LD={class:"form-content"},PD={class:"diy-form-item mt12"},RD={class:"form-content"},ID={__name:"ai-dialogue-node-from",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Mt("getNode"),o=Yr(),a=Se(null),l=tn(()=>o.modelList),u=Se([]),d=Se([]),f=Se(!1),h=Se(),g=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:"",enable_thinking:!1,libs_node_key:void 0}),y=()=>{f.value=!f.value},w=(Ee,_e)=>{g.prompt=Ee,g.prompt_tags=_e};function x(){let Ee=i().getAllParentVariable();d.value=_(Ee)}const b=tn(()=>d.value.filter(_e=>_e.node_type==5));function _(Ee){return Ee.forEach(_e=>{_e.typ=="node"?_e.node_type==1?_e.value="global":_e.value=_e.node_id:_e.value=_e.key,_e.children&&_e.children.length>0&&(_e.children=_(_e.children))}),Ee}const S=()=>{let Ee=i().getAllParentVariable();u.value=Ee};function k(Ee){if(Ee){let _e=Ee.split("."),rt=_e[0],Me=_e.filter((ve,Ve)=>Ve>0).join(".");return[rt,Me]}return["global","question"]}const O=Se(null),M=()=>{O.value.show()},R=Ee=>{g.prompt="",Ee.prompt_type==1?g.prompt=Ee.markdown:g.prompt=Ee.prompt,xn(()=>{a.value.initData()})},T=Se(null),I=()=>{T.value.show()},$=()=>{a.value.refresh()},ne=()=>{const Ee=JSON.stringify({llm:{...g,question_value:g.question_value.join("."),model_config_id:g.model_config_id?+g.model_config_id:g.model_config_id}});t("update-node",{...n.node,...g,node_params:Ee})},V=()=>{try{let Ee=n.node.dataRaw||n.node.node_params||"{}",_e=JSON.parse(Ee).llm||{};_e=JSON.parse(JSON.stringify(_e));let{model_config_id:rt,use_model:Me,context_pair:ve,temperature:Ve,max_token:Be,prompt:de,prompt_tags:le,question_value:W,enable_thinking:Y,libs_node_key:se}=_e;S(),x(),g.model_config_id=rt,g.use_model=Me,g.context_pair=ve||0,g.temperature=Ve,g.max_token=Be,g.prompt=de,g.enable_thinking=Y,g.prompt_tags=le||[],g.libs_node_key=se,g.question_value=k(W),!g.model_config_id&&l.value.length>0&&(g.model_config_id=l.value[0].id,g.use_model=l.value[0].children[0].name)}catch(Ee){}};Qt(()=>g,()=>{ne()},{deep:!0});const J=Ee=>{Ee||x()},D=Se({}),U=(Ee,_e)=>{D.value=_e},j=tn(()=>{if(!g.model_config_id)return!1;let Ee=g.model_config_id+"#"+g.use_model;return D.value[Ee]}),fe=()=>{t("close")};return Kt(()=>{V()}),(Ee,_e)=>{const rt=Fn,Me=Yi,ve=Ai,Ve=Xl,Be=va,de=Di,le=pa,W=bs,Y=_s,se=$r,ge=Hr,Pe=Ti,Le=N1;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"调用大模型，生成回复。",onClose:fe},null,8,["title","iconName"])]),default:q(()=>[E("div",vD,[E("div",{class:"node-form-content",onMousedown:_e[12]||(_e[12]=dn(()=>{},["stop"]))},[H(Pe,{ref_key:"formRef",ref:h,layout:"vertical",model:g},{default:q(()=>[E("div",gD,[_e[28]||(_e[28]=E("div",{class:"gray-block-title"},"输入",-1)),H(Me,{label:"LLM模型",name:"use_model"},{default:q(()=>[E("div",mD,[H(fc,{modelType:"LLM",modeName:g.use_model,"onUpdate:modeName":_e[0]||(_e[0]=He=>g.use_model=He),modeId:g.model_config_id,"onUpdate:modeId":_e[1]||(_e[1]=He=>g.model_config_id=He),onLoaded:U,style:{width:"348px"}},null,8,["modeName","modeId"]),H(rt,{onClick:y},{default:q(()=>[_e[14]||(_e[14]=$e("高级设置 ")),f.value?(G(),Ue(ze(ys),{key:0})):(G(),Ue(ze(cc),{key:1}))]),_:1,__:[14]})])]),_:1}),f.value?(G(),Ue(Me,{key:0,name:"temperature"},{label:q(()=>[_e[16]||(_e[16]=E("span",null,"温度 ",-1)),H(ve,null,{title:q(()=>_e[15]||(_e[15]=[$e("温度越低，回答越严谨。温度越高，回答越发散。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",yD,[E("div",_D,[H(Be,null,{default:q(()=>[H(Ve,{class:"custom-slider",value:g.temperature,"onUpdate:value":_e[2]||(_e[2]=He=>g.temperature=He),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",bD,[H(de,{value:g.temperature,"onUpdate:value":_e[3]||(_e[3]=He=>g.temperature=He),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):tt("",!0),f.value?(G(),Ue(Me,{key:1,name:"max_token"},{label:q(()=>[_e[18]||(_e[18]=E("span",null,"最大token ",-1)),H(ve,null,{title:q(()=>_e[17]||(_e[17]=[$e("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",xD,[E("div",wD,[H(Be,null,{default:q(()=>[H(Ve,{class:"custom-slider",value:g.max_token,"onUpdate:value":_e[4]||(_e[4]=He=>g.max_token=He),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",SD,[H(de,{value:g.max_token,"onUpdate:value":_e[5]||(_e[5]=He=>g.max_token=He),min:0,max:100*1024},null,8,["value"])])])]),_:1})):tt("",!0),f.value&&j.value?(G(),Ue(Me,{key:2,name:"enable_thinking"},{label:q(()=>[_e[20]||(_e[20]=E("span",null,"深度思考 ",-1)),H(ve,null,{title:q(()=>_e[19]||(_e[19]=[$e("开启时，调用大模型时会指定走深度思考模式")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",ED,[H(le,{checked:g.enable_thinking,"onUpdate:checked":_e[6]||(_e[6]=He=>g.enable_thinking=He)},null,8,["checked"])])]),_:1})):tt("",!0),H(Me,{name:"context_pair"},{label:q(()=>[_e[22]||(_e[22]=E("span",null,"上下文数量 ",-1)),H(ve,null,{title:q(()=>_e[21]||(_e[21]=[$e("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",CD,[E("div",kD,[H(Be,null,{default:q(()=>[H(Ve,{class:"custom-slider",value:g.context_pair,"onUpdate:value":_e[7]||(_e[7]=He=>g.context_pair=He),min:0,max:50},null,8,["value"])]),_:1})]),E("div",OD,[H(de,{value:g.context_pair,"onUpdate:value":_e[8]||(_e[8]=He=>g.context_pair=He),min:0,max:50},null,8,["value"])])])]),_:1}),H(Me,{name:"prompt",class:"width-100"},{label:q(()=>[E("div",ND,[_e[24]||(_e[24]=E("div",null,"提示词",-1)),H(W,{gap:8},{default:q(()=>[E("div",{class:"btn-hover-wrap",onClick:M},[H(ze(mC)),_e[23]||(_e[23]=$e("从提示词库导入 "))]),E("div",{class:"btn-hover-wrap",onClick:I},[H(ze(kv))])]),_:1})])]),default:q(()=>[H(or,{type:"textarea",inputStyle:"height: 100px;",options:u.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,ref_key:"atInputRef",ref:a,onOpen:S,onChange:_e[9]||(_e[9]=(He,ft)=>w(He,ft)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:q(({label:He,payload:ft})=>[E("div",MD,[E("div",AD,Ne(He),1),E("div",TD,Ne(ft.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),_e[25]||(_e[25]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[25]}),E("div",DD,[_e[26]||(_e[26]=E("div",{class:"form-label"},"用户问题",-1)),E("div",LD,[H(Y,{value:g.question_value,"onUpdate:value":_e[10]||(_e[10]=He=>g.question_value=He),onDropdownVisibleChange:J,style:{width:"220px"},options:d.value,allowClear:!1,displayRender:({labels:He})=>He.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])]),E("div",PD,[_e[27]||(_e[27]=E("div",{class:"form-label"},"知识库引用",-1)),E("div",RD,[H(ge,{placeholder:"请选择",allowClear:"",onDropdownVisibleChange:J,value:g.libs_node_key,"onUpdate:value":_e[11]||(_e[11]=He=>g.libs_node_key=He),style:{width:"220px"}},{default:q(()=>[(G(!0),ue(st,null,mt(b.value,He=>(G(),Ue(se,{value:He.node_id,key:He.node_id},{default:q(()=>[$e(Ne(He.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),_e[29]||(_e[29]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"AI回复内容"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[29]},8,["model"])],32),H(Le,{onOk:R,ref_key:"importPromptRef",ref:O},null,512),H(V1,{options:u.value,defaultSelectedList:g.prompt_tags,defaultValue:g.prompt,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:S,onChange:_e[13]||(_e[13]=(He,ft)=>w(He,ft)),onOk:$,ref_key:"fullAtInputRef",ref:T},null,8,["options","defaultSelectedList","defaultValue"])])]),_:1})}}},BD=xt(ID,[["__scopeId","data-v-4d324acd"]]),Ss="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M1.7002%208L11%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%202C11%202%2014.3333%203.33333%2014.3333%208C14.3333%2012.6667%2011%2014%209%2014'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M10.9666%208L1.66672%208'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7%2012L11%208L7%204'%20stroke='%23262626'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Do=lC("dataTable",{state:()=>({formList:[],formFieldListMap:{},formListLoading:!1,formFieldListLoadingMap:{},formListQueue:[],formFieldListQueueMap:{}}),getters:{},actions:{async getFormList(){if(this.formList.length>0)return[...this.formList];if(this.formListLoading)return new Promise(r=>{this.formListQueue.push(r)});this.formListLoading=!0;try{const r=await JN();this.formList=r.data||[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}catch(r){this.formList=[];const e=[...this.formList];return this.formListQueue.forEach(t=>t(e)),this.formListQueue=[],e}finally{this.formListLoading=!1}},async getFormFieldList({form_id:r}){if(this.formFieldListMap[r]&&this.formFieldListMap[r].length>0)return[...this.formFieldListMap[r]];if(this.formFieldListLoadingMap[r])return new Promise(e=>{this.formFieldListQueueMap[r]||(this.formFieldListQueueMap[r]=[]),this.formFieldListQueueMap[r].push(e)});this.formFieldListLoadingMap[r]=!0;try{const e=await KN({form_id:r});this.formFieldListMap[r]=e.data||[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}catch(e){this.formFieldListMap[r]=[];const t=[...this.formFieldListMap[r]];return this.formFieldListQueueMap[r]&&(this.formFieldListQueueMap[r].forEach(n=>n(t)),this.formFieldListQueueMap[r]=[]),t}finally{this.formFieldListLoadingMap[r]=!1}},async refreshFormList(){return this.formList=[],this.formListLoading=!1,this.formListQueue=[],await this.getFormList()},async refreshFormFieldList({form_id:r}){return this.formFieldListMap[r]=[],this.formFieldListLoadingMap[r]=!1,this.formFieldListQueueMap[r]=[],await this.getFormFieldList({form_id:r})}}}),jD={class:"field-select-box"},HD={key:0,class:"field-list-box"},$D={key:1,class:"empty-box"},FD={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Do(),o=Jt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),a=Se([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),l=Se([]),u=(w,x)=>{o.selectedRowKeys=w,o.selectedRows=x},d=({formId:w,selectedRowKeys:x,selectedRows:b})=>{o.formId=w,o.selectedRowKeys=x,o.selectedRows=b,y(),o.show=!0},f=()=>{window.open("/#/database/details/field-manage?form_id="+o.formId)},h=()=>{n("ok",o.selectedRowKeys,o.selectedRows),o.show=!1},g=Se(!1),y=()=>{g.value=!0,i.getFormFieldList({form_id:o.formId}).then(w=>{g.value=!1,w.forEach(x=>{x.value="",x.id=x.id*1}),l.value=w}).catch(()=>{g.value=!1})};return e({open:d}),(w,x)=>{const b=y1,_=Sr;return G(),Ue(_,{width:"746px",open:o.show,"onUpdate:open":x[0]||(x[0]=S=>o.show=S),title:"关联数据表",onOk:h,"ok-text":"确定","cancel-text":"取消"},{default:q(()=>[E("div",jD,[l.value.length?(G(),ue("div",HD,[H(b,{rowKey:"name","row-selection":{selectedRowKeys:o.selectedRowKeys,onChange:u},dataSource:l.value,columns:a.value,loading:g.value,pagination:!1},null,8,["row-selection","dataSource","columns","loading"])])):tt("",!0),l.value.length?tt("",!0):(G(),ue("div",$D,[x[2]||(x[2]=E("img",{src:Av,alt:""},null,-1)),E("div",null,[x[1]||(x[1]=$e(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},zD=xt(FD,[["__scopeId","data-v-0e3939aa"]]),WD={class:"field-list"},UD={class:"field-list-row"},VD={key:0,class:"field-list-col field-list-col-head field-value-head"},qD={key:1,class:"field-list-col field-list-col-head field-del-head"},XD={key:0,class:"field-list-row"},GD={class:"field-list-col field-value-col"},YD={class:"field-list-col field-name-col"},KD={class:"field-list-col field-type-col"},JD={key:0,class:"field-list-col field-value-col"},ZD={key:1,class:"field-list-col field-del-col"},QD=["onClick"],eL={key:0,class:"add-btn-box"},tL={__name:"index",props:{showAdd:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},showEmptyFieldRow:{type:Boolean,default:!1},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=Mt("getNode"),o=Jt({list:n.list});Qt(()=>n.list,x=>{o.list=x});const a=Se([]),l=()=>{let x=i().getAllParentVariable();a.value=x||[]},u=()=>{l()},d=(x,b,_,S)=>{o.list[S].value=x,o.list[S].atTags=b,g()},f=(x,b)=>{o.list=[...b],g()},h=x=>{o.list.splice(x,1),g()},g=()=>{t("change",[...o.list])},y=Se(),w=()=>{y.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(x=>x.name)})};return Kt(()=>{l()}),(x,b)=>{const _=kr,S=Ai,k=jr,O=Fn;return G(),ue("div",null,[E("div",WD,[E("div",UD,[b[0]||(b[0]=E("div",{class:"field-list-col field-list-col-head field-name-head"},"字段名",-1)),b[1]||(b[1]=E("div",{class:"field-list-col field-list-col-head field-type-head"},"类型",-1)),r.showInput?(G(),ue("div",VD,"字段值")):tt("",!0),n.showDelete?(G(),ue("div",qD)):tt("",!0)]),r.showEmptyFieldRow?(G(),ue("div",XD,[b[2]||(b[2]=E("div",{class:"field-list-col field-name-col"},"--",-1)),b[3]||(b[3]=E("div",{class:"field-list-col field-type-col"},"--",-1)),E("div",GD,[H(S,{title:"请先选择数据库"},{default:q(()=>[H(_,{disabled:!0,placeholder:"请输入参数值，键入/插入变量"})]),_:1})])])):tt("",!0),(G(!0),ue(st,null,mt(o.list,(M,R)=>(G(),ue("div",{class:"field-list-row",key:M.name},[E("div",YD,Ne(M.name),1),E("div",KD,Ne(M.type),1),r.showInput?(G(),ue("div",JD,[H(or,{options:a.value,defaultValue:M.value,defaultSelectedList:M.atTags,onOpen:u,onChange:(T,I)=>d(T,I,M,R),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])):tt("",!0),n.showDelete?(G(),ue("div",ZD,[E("span",{class:"del-btn",onClick:T=>h(R)},[H(k,{class:"del-icon",name:"close-circle"})],8,QD)])):tt("",!0)]))),128))]),n.showAdd?(G(),ue("div",eL,[H(O,{class:"add-btn",type:"dashed",block:"",onClick:w},{default:q(()=>[H(ze($n)),b[4]||(b[4]=$e(" 添加更新字段"))]),_:1,__:[4]})])):tt("",!0),H(zD,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:y,onOk:f},null,8,["formId"])])}}},Iv=xt(tL,[["__scopeId","data-v-7a244ed7"]]),nL={class:"library-checkbox-box"},rL={class:"list-box",ref:"scrollContainer"},iL={class:"library-name"},oL={class:"library-desc"},aL={key:1,class:"empty-box"},sL={__name:"table-select-alert",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]}},emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=r,o=Se(),a=Se(!1),l=h=>{o.value=h,a.value=!0},u=()=>{a.value=!1,d()},d=()=>{let h=i.options.filter(g=>g.id===o.value);n("ok",o.value,JSON.parse(JSON.stringify(h[0])))},f=()=>{window.open("/#/database/list")};return e({open:l}),(h,g)=>{const y=b1,w=_1,x=Sr;return G(),Ue(x,{width:"746px",open:a.value,"onUpdate:open":g[1]||(g[1]=b=>a.value=b),title:"关联数据表","ok-text":"确定","cancel-text":"取消",onOk:u},{default:q(()=>[E("div",nL,[r.options.length?(G(),Ue(w,{key:0,value:o.value,"onUpdate:value":g[0]||(g[0]=b=>o.value=b),style:{width:"100%"}},{default:q(()=>[E("div",rL,[(G(!0),ue(st,null,mt(i.options,b=>(G(),ue("div",{class:"list-item-wraapper",key:b.id},[H(y,{class:"list-item",value:b.id},{default:q(()=>[E("div",iL,Ne(b.name),1),E("div",oL,Ne(b.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])):tt("",!0),r.options.length?tt("",!0):(G(),ue("div",aL,[g[3]||(g[3]=E("img",{src:Av,alt:""},null,-1)),E("div",null,[g[2]||(g[2]=$e(" 暂无数据表, 请先去添加数据表 ")),E("a",{onClick:f}," 去添加")])]))])]),_:1},8,["open"])}}},lL=xt(sL,[["__scopeId","data-v-ee44bfef"]]),uL={class:""},dL={key:0,class:"data-table-info"},cL={class:"data-table-name"},fL={class:"data-table-desc"},hL={__name:"index",props:{value:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},description:{type:String,default:""},title:{type:String,default:""}},emits:["update:value","change"],setup(r,{emit:e}){const t=e,n=r,i=Se(null),o=tn(()=>{let d=n.options.filter(f=>f.id===n.value);return d.length?d[0]:null}),a=()=>{i.value.open()},l=(d,f)=>{t("update:value",d),t("change",d,f)},u=()=>{t("update:value",""),t("change","")};return(d,f)=>{const h=jr,g=Fn;return G(),ue("div",uL,[n.value?(G(),ue("div",dL,[E("div",cL,Ne(o.value?o.value.name:n.title),1),E("div",fL,Ne(o.value?o.value.description:n.description),1),H(h,{class:"del-btn",name:"close-circle",onClick:u})])):(G(),Ue(g,{key:1,class:"select-data-btn",type:"primary",ghost:"",onClick:a},{default:q(()=>[H(ze($n)),f[0]||(f[0]=$e(" 选择数据表"))]),_:1,__:[0]})),H(lL,{ref_key:"tableSelectAlertRef",ref:i,onOk:l,options:r.options},null,8,["options"])])}}},pc=xt(hL,[["__scopeId","data-v-550ecdef"]]),pL={class:"add-data-form"},vL={class:"node-box-content"},gL={class:"setting-box"},mL={class:"setting-box"},yL={__name:"add-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Do();let o={};const a=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=(y,w)=>{w?(a.formData.form_name=w.name,a.formData.form_description=w.description,g(w.id)):(a.formData.form_name="",a.formData.form_description="",a.formData.datas=[]),f()},u=y=>{a.formData.datas=y,f()},d=()=>{let y=n.node.dataRaw||n.node.node_params||"{}";o=JSON.parse(y),a.formData=o.form_insert,f()},f=()=>{o.form_insert=Gi(a.formData),t("update-node",{...n.node,node_params:JSON.stringify(o)})},h=async()=>{const y=await i.getFormList();a.tableList=y},g=async y=>{i.getFormFieldList({form_id:y}).then(w=>{w.forEach(x=>{x.id=x.id*1}),a.formData.datas=w,f()}).catch(()=>{})};return Kt(()=>{h(),d()}),(y,w)=>(G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:q(()=>w[1]||(w[1]=[E("span",null,[$e("在指定数据表中插入数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",pL,[E("div",vL,[w[2]||(w[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ss,alt:""}),E("span",{class:"text"},"输入")],-1)),w[3]||(w[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",gL,[H(pc,{options:a.tableList,title:a.formData.form_name,description:a.formData.form_description,value:a.formData.form_id,"onUpdate:value":w[0]||(w[0]=x=>a.formData.form_id=x),onChange:l},null,8,["options","title","description","value"])]),w[4]||(w[4]=E("div",{class:"setting-label"},[E("span",null,"插入数据"),E("span",{class:"tip"},"（不填写字段值则为空）")],-1)),E("div",mL,[H(Iv,{"form-id":a.formData.form_id,showEmptyFieldRow:a.formData.form_id=="",list:a.formData.datas,showAdd:!1,showDelete:!1,onChange:u},null,8,["form-id","showEmptyFieldRow","list"])])])])]),_:1}))}},_L=xt(yL,[["__scopeId","data-v-b11302f4"]]),bL={class:"library-checkbox-box"},xL={class:"list-tools"},wL={class:"list-box",ref:"scrollContainer"},SL={class:"library-name"},EL={class:"library-desc"},CL={__name:"library-select-alert",emits:["change","close"],setup(r,{expose:e,emit:t}){const n=t,i=Jt({indeterminate:!1,checkAll:!1,checkedList:[]}),o=Se(!1),a=_=>{g(),i.checkedList=_,o.value=!0},l=()=>{o.value=!1,h()},u=Se(""),d=()=>{g()},f=Se([]),h=()=>{n("change",[...i.checkedList])},g=async()=>{const _=await xv({library_name:u.value,type:""});if(_){let S=_.data||[];f.value=S}},y=Se(!1),w=async()=>{y.value=!0,await g(),y.value=!1,Hn.success("刷新完成")},x=()=>{window.open("/#/library/add")},b=()=>{n("close")};return e({open:a}),(_,S)=>{const k=kr,O=Fn,M=x1,R=bC,T=Ov,I=Sr;return G(),Ue(I,{width:"746px",open:o.value,"onUpdate:open":S[2]||(S[2]=$=>o.value=$),title:"关联知识库",onCancel:b,onOk:l,okText:"确定",cancelText:"取消"},{default:q(()=>[E("div",bL,[E("div",xL,[E("div",null,[H(k,{style:{width:"282px"},value:u.value,"onUpdate:value":S[0]||(S[0]=$=>u.value=$),placeholder:"请输入知识库名称搜索",onChange:d},{suffix:q(()=>[H(ze(yC),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),E("div",null,[H(O,{style:{"margin-right":"8px"},onClick:w},{default:q(()=>[H(ze(_C)),S[3]||(S[3]=$e(" 刷新 "))]),_:1,__:[3]}),H(O,{type:"primary",ghost:"",onClick:x},{default:q(()=>S[4]||(S[4]=[$e("新建知识库")])),_:1,__:[4]})])]),H(T,{spinning:y.value,delay:100},{default:q(()=>[H(R,{value:i.checkedList,"onUpdate:value":S[1]||(S[1]=$=>i.checkedList=$),style:{width:"100%"}},{default:q(()=>[E("div",wL,[(G(!0),ue(st,null,mt(f.value,$=>(G(),ue("div",{class:"list-item-wraapper",key:$.id},[H(M,{class:"list-item",value:$.id},{default:q(()=>[E("div",SL,Ne($.library_name),1),E("div",EL,Ne($.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},kL=xt(CL,[["__scopeId","data-v-3ab71d50"]]),OL={class:"recall-settings-box"},NL={class:"form-box"},ML={class:"form-item is-required"},AL={class:"form-item-body"},TL={class:"retrieval-mode-items"},DL=["onClick"],LL={class:"retrieval-mode-title"},PL={class:"title-text"},RL={class:"retrieval-mode-desc"},IL={class:"form-item"},BL={class:"form-item-label"},jL={class:"form-item-body"},HL={class:"number-box"},$L={class:"number-slider-box"},FL={class:"number-input-box"},zL={class:"form-item"},WL={class:"form-item-label"},UL={class:"form-item-body"},VL={class:"number-box"},qL={class:"number-slider-box"},XL={class:"number-input-box"},GL={class:"form-item"},YL={class:"form-item-label"},KL={class:"form-item-body"},JL=["src"],ZL={__name:"recall-settings-alert",emits:["change"],setup(r,{expose:e,emit:t}){const n=t,i=Se([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),o=Jt({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),a=Se(!1),l=x=>{w(),o.rerank_status=x.rerank_status||0,o.rerank_use_model=x.rerank_use_model||void 0,o.rerank_model_config_id=x.rerank_model_config_id||"",o.top_k=x.top_k,o.similarity=x.similarity,o.search_type=x.search_type,a.value=!0},u=(x,b)=>{o.rerank_model_config_id=b.rerank_model_config_id},d=x=>{o.search_type=x},f=()=>o.rerank_status==1&&!o.rerank_model_config_id,h=()=>{if(f())return Hn.error("请选择Rerank模型");a.value=!1,g()},g=()=>{n("change",Gi(o))},y=Se([]),w=()=>{M1({model_type:"RERANK"}).then(x=>{let b=x.data||[];y.value=b.map(_=>({id:_.model_config.id,name:_.model_info.model_name,icon:_.model_info.model_icon_url,children:_.model_info.rerank_model_list}))})};return e({open:l}),(x,b)=>{const _=jr,S=Ai,k=Xl,O=Di,M=pa,R=bs,T=$r,I=xC,$=Hr,ne=Sr;return G(),Ue(ne,{width:"472px",open:a.value,"onUpdate:open":b[6]||(b[6]=V=>a.value=V),title:"召回设置",onOk:h,okText:"确定",cancelText:"取消"},{default:q(()=>[E("div",OL,[E("div",NL,[E("div",ML,[b[7]||(b[7]=E("div",{class:"form-item-label"},[E("span",null,"检索模式")],-1)),E("div",AL,[E("div",TL,[(G(!0),ue(st,null,mt(i.value,V=>(G(),ue("div",{class:gn(["retrieval-mode-item",{active:o.search_type==V.value}]),key:V.value,onClick:J=>d(V.value)},[o.search_type==V.value?(G(),Ue(_,{key:0,class:"check-arrow",name:"check-arrow-filled"})):tt("",!0),E("div",LL,[H(_,{name:V.iconName,class:"title-icon"},null,8,["name"]),E("span",PL,Ne(V.title),1),V.isRecommendation?(G(),Ue(_,{key:0,class:"recommendation-icon",name:"recommendation"})):tt("",!0)]),E("div",RL,Ne(V.desc),1)],10,DL))),128))])])]),E("div",IL,[E("div",BL,[b[9]||(b[9]=E("span",null,"Top K ",-1)),H(S,null,{title:q(()=>b[8]||(b[8]=[$e("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),E("div",jL,[E("div",HL,[E("div",$L,[H(k,{class:"custom-slider",value:o.top_k,"onUpdate:value":b[0]||(b[0]=V=>o.top_k=V),min:1,max:10},null,8,["value"])]),E("div",FL,[H(O,{value:o.top_k,"onUpdate:value":b[1]||(b[1]=V=>o.top_k=V),min:1,max:10},null,8,["value"])])])])]),E("div",zL,[E("div",WL,[b[11]||(b[11]=E("span",null,"相似度阈值 ",-1)),H(S,null,{title:q(()=>b[10]||(b[10]=[$e("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),E("div",UL,[E("div",VL,[E("div",qL,[H(k,{class:"custom-slider",value:o.similarity,"onUpdate:value":b[2]||(b[2]=V=>o.similarity=V),min:0,max:1,step:.01},null,8,["value"])]),E("div",XL,[H(O,{value:o.similarity,"onUpdate:value":b[3]||(b[3]=V=>o.similarity=V),min:0,max:1,step:.01},null,8,["value"])])])])]),E("div",GL,[E("div",YL,[b[12]||(b[12]=E("span",null,"Rerank模型",-1)),b[13]||(b[13]=$e("   ")),H(M,{checkedValue:1,unCheckedValue:0,checked:o.rerank_status,"onUpdate:checked":b[4]||(b[4]=V=>o.rerank_status=V)},null,8,["checked"])]),E("div",KL,[H($,{value:o.rerank_use_model,"onUpdate:value":b[5]||(b[5]=V=>o.rerank_use_model=V),placeholder:"请选择Rerank模型",onChange:u,style:{width:"320px"}},{default:q(()=>[(G(!0),ue(st,null,mt(y.value,V=>(G(),Ue(I,{key:V.id},{label:q(()=>[H(R,{align:"center",gap:8},{default:q(()=>[E("img",{class:"model-icon",src:V.icon,alt:""},null,8,JL),$e(Ne(V.name),1)]),_:2},1024)]),default:q(()=>[(G(!0),ue(st,null,mt(V.children,J=>(G(),Ue(T,{value:J,rerank_model_config_id:V.id,key:J},{default:q(()=>[E("span",null,Ne(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},QL=xt(ZL,[["__scopeId","data-v-ebd2f855"]]),eP={class:"problem-optimization-form"},tP={class:"node-form-content"},nP={class:"gray-block"},rP={class:"avatar-box"},iP=["src"],oP={class:"content-box"},aP={class:"list-name"},sP={class:"list-intro"},lP=["onClick"],uP={class:"btn-block"},dP={class:"diy-form-item"},cP={class:"form-content"},fP={class:"form-content"},hP={__name:"knowledge-base-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Se([]);function o(){const I=n.lf.getNodeModelById(n.nodeId);if(I){let $=I.getAllParentVariable();i.value=a($)}}function a(I){return I.forEach($=>{$.typ=="node"?$.node_type==1?$.value="global":$.value=$.node_id:$.value=$.key,$.children&&$.children.length>0&&($.children=a($.children))}),I}function l(I){if(I){let $=I.split("."),ne=$[0],V=$.filter((J,D)=>D>0).join(".");return[ne,V]}return["global","question"]}const u=Se(),d=Jt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:""}),f=()=>{const I=JSON.stringify({libs:{...d,rerank_model_config_id:d.rerank_model_config_id?+d.rerank_model_config_id:void 0,question_value:d.question_value.join("."),library_ids:d.library_ids.join(",")}});t("update-node",{...n.node,...d,node_params:I})},h=()=>{try{let I=n.node.dataRaw||n.node.node_params||"{}",$=JSON.parse(I).libs||{};o(),$=JSON.parse(JSON.stringify($));for(let ne in $)ne=="library_ids"?d[ne]=$[ne]?$[ne].split(","):[]:ne=="question_value"?d.question_value=l($.question_value):d[ne]=$[ne]}catch(I){}},g=Se([]),y=Se(null),w=tn(()=>g.value.filter(I=>d.library_ids.includes(I.id))),x=I=>{let $=d.library_ids.indexOf(I.id);d.library_ids.splice($,1)},b=I=>{M(),d.library_ids=[...I]},_=()=>{y.value.open([...d.library_ids])},S=Se(null),k=()=>{S.value.open(Gi(d))},O=I=>{d.rerank_status=I.rerank_status,d.rerank_use_model=I.rerank_use_model,d.rerank_model_config_id=I.rerank_model_config_id,d.top_k=I.top_k,d.similarity=I.similarity,d.search_type=I.search_type},M=async()=>{const I=await xv({type:""});I&&(g.value=I.data||[])};Qt(()=>d,()=>{f()},{deep:!0});const R=I=>{I||o()},T=()=>{t("close")};return Kt(()=>{h(),M()}),(I,$)=>{const ne=Fn,V=Yi,J=_s,D=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"从指定知识库中检索相关的分段，点击召回设置可以规定检索数据的条数和相似度阈值",onClose:T},null,8,["title","iconName"])]),default:q(()=>[E("div",eP,[E("div",tP,[H(D,{ref_key:"formRef",ref:u,layout:"vertical",model:d},{default:q(()=>[E("div",nP,[$[4]||($[4]=E("div",{class:"gray-block-title"},"输入",-1)),H(V,{label:"关联知识库"},{default:q(()=>[(G(!0),ue(st,null,mt(w.value,U=>(G(),ue("div",{class:"konwledge-list-item",key:U.id},[E("div",rP,[E("img",{src:U.avatar,alt:""},null,8,iP)]),E("div",oP,[E("div",aP,Ne(U.library_name),1),E("div",sP,Ne(U.library_intro),1)]),E("div",{class:"btn-hover-wrap",onClick:j=>x(U)},[H(ze(gr))],8,lP)]))),128)),E("div",uP,[E("div",null,[H(ne,{onClick:_,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>$[1]||($[1]=[$e("添加知识库")])),_:1,__:[1]},8,["icon"])]),E("div",null,[H(ne,{onClick:k,icon:bn(ze(wC)),block:"",type:"dashed"},{default:q(()=>$[2]||($[2]=[$e("召回设置")])),_:1,__:[2]},8,["icon"])])])]),_:1}),E("div",dP,[$[3]||($[3]=E("div",{class:"form-label"},"用户问题",-1)),E("div",cP,[E("div",fP,[H(J,{value:d.question_value,"onUpdate:value":$[0]||($[0]=U=>d.question_value=U),onDropdownVisibleChange:R,style:{width:"220px"},options:i.value,allowClear:!1,displayRender:({labels:U})=>U.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])])]),$[5]||($[5]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"输出"),E("div",{class:"options-item"},[E("div",{class:"option-label"},"知识库引用"),E("div",{class:"option-type"},"string")])],-1))]),_:1,__:[5]},8,["model"]),H(kL,{ref_key:"librarySelectAlertRef",ref:y,onClose:M,onChange:b},null,512),H(QL,{ref_key:"recallSettingsAlertRef",ref:S,onChange:O},null,512)])])]),_:1})}}},pP=xt(hP,[["__scopeId","data-v-d4ff0972"]]),ts="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%20class='design-iconfont'%3e%3cpath%20d='M10%200V16M10%2032V16M10%2016H23'%20stroke='%23BFBFBF'%20stroke-linejoin='round'/%3e%3c/svg%3e",vP={class:"sub-field-item"},gP=["onClick"],mP=["onClick"],yP={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px"),i=(u,d)=>{d[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(u,d)=>{d.splice(u,1)},a=u=>{u.subs=[]},l=u=>u.typ=="object"&&e.level<=2;return(u,d)=>{const f=kr,h=$r,g=Hr,y=On("SubsKey",!0);return G(!0),ue(st,null,mt(e.data,(w,x)=>(G(),ue("div",{class:gn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:w.cu_key},[E("div",vP,[d[0]||(d[0]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(f,{class:"mr12",style:Oi({width:n.value}),value:w.key,"onUpdate:value":b=>w.key=b,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(g,{class:"mr12",onChange:b=>a(w),value:w.typ,"onUpdate:value":b=>w.typ=b,placeholder:"请选择",style:Oi({width:n.value})},{default:q(()=>[(G(!0),ue(st,null,mt(t.value,b=>(G(),Ue(h,{value:b.value},{default:q(()=>[$e(Ne(b.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(w)?(G(),ue("div",{key:0,class:"btn-hover-wrap mr12",onClick:b=>i(x,e.data)},[H(ze(xs))],8,gP)):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:b=>o(x,e.data)},[H(ze(gr))],8,mP)]),w.subs&&w.subs.length>0?(G(),Ue(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:w.subs},null,8,["level","typOptions","data"])):tt("",!0)],2))),128)}}},_P=xt(yP,[["__scopeId","data-v-9125a152"]]);var ly={exports:{}},ad={exports:{}},bP=ad.exports,uy;function Lo(){return uy||(uy=1,function(r,e){(function(t,n){r.exports=n()})(bP,function(){var t=navigator.userAgent,n=navigator.platform,i=/gecko\/\d/i.test(t),o=/MSIE \d/.test(t),a=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),l=/Edge\/(\d+)/.exec(t),u=o||a||l,d=u&&(o?document.documentMode||6:+(l||a)[1]),f=!l&&/WebKit\//.test(t),h=f&&/Qt\/\d+\.\d+/.test(t),g=!l&&/Chrome\/(\d+)/.exec(t),y=g&&+g[1],w=/Opera\//.test(t),x=/Apple Computer/.test(navigator.vendor),b=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),_=/PhantomJS/.test(t),S=x&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),k=/Android/.test(t),O=S||k||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),M=S||/Mac/.test(n),R=/\bCrOS\b/.test(t),T=/win/i.test(n),I=w&&t.match(/Version\/(\d*\.\d*)/);I&&(I=Number(I[1])),I&&I>=15&&(w=!1,f=!0);var $=M&&(h||w&&(I==null||I<12.11)),ne=i||u&&d>=9;function V(s){return new RegExp("(^|\\s)"+s+"(?:$|\\s)\\s*")}var J=function(s,c){var v=s.className,p=V(c).exec(v);if(p){var m=v.slice(p.index+p[0].length);s.className=v.slice(0,p.index)+(m?p[1]+m:"")}};function D(s){for(var c=s.childNodes.length;c>0;--c)s.removeChild(s.firstChild);return s}function U(s,c){return D(s).appendChild(c)}function j(s,c,v,p){var m=document.createElement(s);if(v&&(m.className=v),p&&(m.style.cssText=p),typeof c=="string")m.appendChild(document.createTextNode(c));else if(c)for(var C=0;C<c.length;++C)m.appendChild(c[C]);return m}function fe(s,c,v,p){var m=j(s,c,v,p);return m.setAttribute("role","presentation"),m}var Ee;document.createRange?Ee=function(s,c,v,p){var m=document.createRange();return m.setEnd(p||s,v),m.setStart(s,c),m}:Ee=function(s,c,v){var p=document.body.createTextRange();try{p.moveToElementText(s.parentNode)}catch{return p}return p.collapse(!0),p.moveEnd("character",v),p.moveStart("character",c),p};function _e(s,c){if(c.nodeType==3&&(c=c.parentNode),s.contains)return s.contains(c);do if(c.nodeType==11&&(c=c.host),c==s)return!0;while(c=c.parentNode)}function rt(s){var c=s.ownerDocument||s,v;try{v=s.activeElement}catch{v=c.body||null}for(;v&&v.shadowRoot&&v.shadowRoot.activeElement;)v=v.shadowRoot.activeElement;return v}function Me(s,c){var v=s.className;V(c).test(v)||(s.className+=(v?" ":"")+c)}function ve(s,c){for(var v=s.split(" "),p=0;p<v.length;p++)v[p]&&!V(v[p]).test(c)&&(c+=" "+v[p]);return c}var Ve=function(s){s.select()};S?Ve=function(s){s.selectionStart=0,s.selectionEnd=s.value.length}:u&&(Ve=function(s){try{s.select()}catch{}});function Be(s){return s.display.wrapper.ownerDocument}function de(s){return le(s.display.wrapper)}function le(s){return s.getRootNode?s.getRootNode():s.ownerDocument}function W(s){return Be(s).defaultView}function Y(s){var c=Array.prototype.slice.call(arguments,1);return function(){return s.apply(null,c)}}function se(s,c,v){c||(c={});for(var p in s)s.hasOwnProperty(p)&&(v!==!1||!c.hasOwnProperty(p))&&(c[p]=s[p]);return c}function ge(s,c,v,p,m){c==null&&(c=s.search(/[^\s\u00a0]/),c==-1&&(c=s.length));for(var C=p||0,N=m||0;;){var P=s.indexOf("	",C);if(P<0||P>=c)return N+(c-C);N+=P-C,N+=v-N%v,C=P+1}}var Pe=function(){this.id=null,this.f=null,this.time=0,this.handler=Y(this.onTimeout,this)};Pe.prototype.onTimeout=function(s){s.id=0,s.time<=+new Date?s.f():setTimeout(s.handler,s.time-+new Date)},Pe.prototype.set=function(s,c){this.f=c;var v=+new Date+s;(!this.id||v<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,s),this.time=v)};function Le(s,c){for(var v=0;v<s.length;++v)if(s[v]==c)return v;return-1}var He=50,ft={toString:function(){return"CodeMirror.Pass"}},Ke={scroll:!1},Nt={origin:"*mouse"},yt={origin:"+move"};function Wt(s,c,v){for(var p=0,m=0;;){var C=s.indexOf("	",p);C==-1&&(C=s.length);var N=C-p;if(C==s.length||m+N>=c)return p+Math.min(N,c-m);if(m+=C-p,m+=v-m%v,p=C+1,m>=c)return p}}var Ft=[""];function te(s){for(;Ft.length<=s;)Ft.push(A(Ft)+" ");return Ft[s]}function A(s){return s[s.length-1]}function F(s,c){for(var v=[],p=0;p<s.length;p++)v[p]=c(s[p],p);return v}function ee(s,c,v){for(var p=0,m=v(c);p<s.length&&v(s[p])<=m;)p++;s.splice(p,0,c)}function K(){}function oe(s,c){var v;return Object.create?v=Object.create(s):(K.prototype=s,v=new K),c&&se(c,v),v}var ie=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ce(s){return/\w/.test(s)||s>""&&(s.toUpperCase()!=s.toLowerCase()||ie.test(s))}function Ce(s,c){return c?c.source.indexOf("\\w")>-1&&ce(s)?!0:c.test(s):ce(s)}function ke(s){for(var c in s)if(s.hasOwnProperty(c)&&s[c])return!1;return!0}var je=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Ze(s){return s.charCodeAt(0)>=768&&je.test(s)}function ct(s,c,v){for(;(v<0?c>0:c<s.length)&&Ze(s.charAt(c));)c+=v;return c}function pt(s,c,v){for(var p=c>v?-1:1;;){if(c==v)return c;var m=(c+v)/2,C=p<0?Math.ceil(m):Math.floor(m);if(C==c)return s(C)?c:v;s(C)?v=C:c=C+p}}function Rt(s,c,v,p){if(!s)return p(c,v,"ltr",0);for(var m=!1,C=0;C<s.length;++C){var N=s[C];(N.from<v&&N.to>c||c==v&&N.to==c)&&(p(Math.max(N.from,c),Math.min(N.to,v),N.level==1?"rtl":"ltr",C),m=!0)}m||p(c,v,"ltr")}var Je=null;function dt(s,c,v){var p;Je=null;for(var m=0;m<s.length;++m){var C=s[m];if(C.from<c&&C.to>c)return m;C.to==c&&(C.from!=C.to&&v=="before"?p=m:Je=m),C.from==c&&(C.from!=C.to&&v!="before"?p=m:Je=m)}return p??Je}var It=function(){var s="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",c="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function v(z){return z<=247?s.charAt(z):1424<=z&&z<=1524?"R":1536<=z&&z<=1785?c.charAt(z-1536):1774<=z&&z<=2220?"r":8192<=z&&z<=8203?"w":z==8204?"b":"L"}var p=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,m=/[stwN]/,C=/[LRr]/,N=/[Lb1n]/,P=/[1n]/;function B(z,re,ae){this.level=z,this.from=re,this.to=ae}return function(z,re){var ae=re=="ltr"?"L":"R";if(z.length==0||re=="ltr"&&!p.test(z))return!1;for(var ye=z.length,pe=[],Ie=0;Ie<ye;++Ie)pe.push(v(z.charCodeAt(Ie)));for(var We=0,et=ae;We<ye;++We){var lt=pe[We];lt=="m"?pe[We]=et:et=lt}for(var ht=0,ut=ae;ht<ye;++ht){var _t=pe[ht];_t=="1"&&ut=="r"?pe[ht]="n":C.test(_t)&&(ut=_t,_t=="r"&&(pe[ht]="R"))}for(var Tt=1,At=pe[0];Tt<ye-1;++Tt){var Ut=pe[Tt];Ut=="+"&&At=="1"&&pe[Tt+1]=="1"?pe[Tt]="1":Ut==","&&At==pe[Tt+1]&&(At=="1"||At=="n")&&(pe[Tt]=At),At=Ut}for(var hn=0;hn<ye;++hn){var Xn=pe[hn];if(Xn==",")pe[hn]="N";else if(Xn=="%"){var wn=void 0;for(wn=hn+1;wn<ye&&pe[wn]=="%";++wn);for(var Rr=hn&&pe[hn-1]=="!"||wn<ye&&pe[wn]=="1"?"1":"N",_r=hn;_r<wn;++_r)pe[_r]=Rr;hn=wn-1}}for(var Tn=0,br=ae;Tn<ye;++Tn){var Jn=pe[Tn];br=="L"&&Jn=="1"?pe[Tn]="L":C.test(Jn)&&(br=Jn)}for(var Bn=0;Bn<ye;++Bn)if(m.test(pe[Bn])){var Dn=void 0;for(Dn=Bn+1;Dn<ye&&m.test(pe[Dn]);++Dn);for(var Cn=(Bn?pe[Bn-1]:ae)=="L",xr=(Dn<ye?pe[Dn]:ae)=="L",Ra=Cn==xr?Cn?"L":"R":ae,_o=Bn;_o<Dn;++_o)pe[_o]=Ra;Bn=Dn-1}for(var tr=[],Bi,Gn=0;Gn<ye;)if(N.test(pe[Gn])){var xf=Gn;for(++Gn;Gn<ye&&N.test(pe[Gn]);++Gn);tr.push(new B(0,xf,Gn))}else{var no=Gn,qo=tr.length,Xo=re=="rtl"?1:0;for(++Gn;Gn<ye&&pe[Gn]!="L";++Gn);for(var fr=no;fr<Gn;)if(P.test(pe[fr])){no<fr&&(tr.splice(qo,0,new B(1,no,fr)),qo+=Xo);var Ia=fr;for(++fr;fr<Gn&&P.test(pe[fr]);++fr);tr.splice(qo,0,new B(2,Ia,fr)),qo+=Xo,no=fr}else++fr;no<Gn&&tr.splice(qo,0,new B(1,no,Gn))}return re=="ltr"&&(tr[0].level==1&&(Bi=z.match(/^\s+/))&&(tr[0].from=Bi[0].length,tr.unshift(new B(0,0,Bi[0].length))),A(tr).level==1&&(Bi=z.match(/\s+$/))&&(A(tr).to-=Bi[0].length,tr.push(new B(0,ye-Bi[0].length,ye)))),re=="rtl"?tr.reverse():tr}}();function at(s,c){var v=s.order;return v==null&&(v=s.order=It(s.text,c)),v}var Fe=[],Re=function(s,c,v){if(s.addEventListener)s.addEventListener(c,v,!1);else if(s.attachEvent)s.attachEvent("on"+c,v);else{var p=s._handlers||(s._handlers={});p[c]=(p[c]||Fe).concat(v)}};function vt(s,c){return s._handlers&&s._handlers[c]||Fe}function Ye(s,c,v){if(s.removeEventListener)s.removeEventListener(c,v,!1);else if(s.detachEvent)s.detachEvent("on"+c,v);else{var p=s._handlers,m=p&&p[c];if(m){var C=Le(m,v);C>-1&&(p[c]=m.slice(0,C).concat(m.slice(C+1)))}}}function Qe(s,c){var v=vt(s,c);if(v.length)for(var p=Array.prototype.slice.call(arguments,2),m=0;m<v.length;++m)v[m].apply(null,p)}function nt(s,c,v){return typeof c=="string"&&(c={type:c,preventDefault:function(){this.defaultPrevented=!0}}),Qe(s,v||c.type,s,c),qt(c)||c.codemirrorIgnore}function St(s){var c=s._handlers&&s._handlers.cursorActivity;if(c)for(var v=s.curOp.cursorActivityHandlers||(s.curOp.cursorActivityHandlers=[]),p=0;p<c.length;++p)Le(v,c[p])==-1&&v.push(c[p])}function xe(s,c){return vt(s,c).length>0}function qe(s){s.prototype.on=function(c,v){Re(this,c,v)},s.prototype.off=function(c,v){Ye(this,c,v)}}function gt(s){s.preventDefault?s.preventDefault():s.returnValue=!1}function Et(s){s.stopPropagation?s.stopPropagation():s.cancelBubble=!0}function qt(s){return s.defaultPrevented!=null?s.defaultPrevented:s.returnValue==!1}function Gt(s){gt(s),Et(s)}function Qn(s){return s.target||s.srcElement}function mn(s){var c=s.which;return c==null&&(s.button&1?c=1:s.button&2?c=3:s.button&4&&(c=2)),M&&s.ctrlKey&&c==1&&(c=3),c}var zn=function(){if(u&&d<9)return!1;var s=j("div");return"draggable"in s||"dragDrop"in s}(),Kr;function Jr(s){if(Kr==null){var c=j("span","​");U(s,j("span",[c,document.createTextNode("x")])),s.firstChild.offsetHeight!=0&&(Kr=c.offsetWidth<=1&&c.offsetHeight>2&&!(u&&d<8))}var v=Kr?j("span","​"):j("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return v.setAttribute("cm-text",""),v}var Zt;function Mr(s){if(Zt!=null)return Zt;var c=U(s,document.createTextNode("AخA")),v=Ee(c,0,1).getBoundingClientRect(),p=Ee(c,1,2).getBoundingClientRect();return D(s),!v||v.left==v.right?!1:Zt=p.right-v.right<3}var Nn=`

b`.split(/\n/).length!=3?function(s){for(var c=0,v=[],p=s.length;c<=p;){var m=s.indexOf(`
`,c);m==-1&&(m=s.length);var C=s.slice(c,s.charAt(m-1)=="\r"?m-1:m),N=C.indexOf("\r");N!=-1?(v.push(C.slice(0,N)),c+=N+1):(v.push(C),c=m+1)}return v}:function(s){return s.split(/\r\n?|\n/)},Ar=window.getSelection?function(s){try{return s.selectionStart!=s.selectionEnd}catch{return!1}}:function(s){var c;try{c=s.ownerDocument.selection.createRange()}catch{}return!c||c.parentElement()!=s?!1:c.compareEndPoints("StartToEnd",c)!=0},ui=function(){var s=j("div");return"oncopy"in s?!0:(s.setAttribute("oncopy","return;"),typeof s.oncopy=="function")}(),Dt=null;function Pi(s){if(Dt!=null)return Dt;var c=U(s,j("span","x")),v=c.getBoundingClientRect(),p=Ee(c,0,1).getBoundingClientRect();return Dt=Math.abs(v.left-p.left)>1}var Wr={},Wn={};function ur(s,c){arguments.length>2&&(c.dependencies=Array.prototype.slice.call(arguments,2)),Wr[s]=c}function dr(s,c){Wn[s]=c}function Tr(s){if(typeof s=="string"&&Wn.hasOwnProperty(s))s=Wn[s];else if(s&&typeof s.name=="string"&&Wn.hasOwnProperty(s.name)){var c=Wn[s.name];typeof c=="string"&&(c={name:c}),s=oe(c,s),s.name=c.name}else{if(typeof s=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(s))return Tr("application/xml");if(typeof s=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(s))return Tr("application/json")}return typeof s=="string"?{name:s}:s||{name:"null"}}function Zr(s,c){c=Tr(c);var v=Wr[c.name];if(!v)return Zr(s,"text/plain");var p=v(s,c);if(Dr.hasOwnProperty(c.name)){var m=Dr[c.name];for(var C in m)m.hasOwnProperty(C)&&(p.hasOwnProperty(C)&&(p["_"+C]=p[C]),p[C]=m[C])}if(p.name=c.name,c.helperType&&(p.helperType=c.helperType),c.modeProps)for(var N in c.modeProps)p[N]=c.modeProps[N];return p}var Dr={};function Ur(s,c){var v=Dr.hasOwnProperty(s)?Dr[s]:Dr[s]={};se(c,v)}function Z(s,c){if(c===!0)return c;if(s.copyState)return s.copyState(c);var v={};for(var p in c){var m=c[p];m instanceof Array&&(m=m.concat([])),v[p]=m}return v}function be(s,c){for(var v;s.innerMode&&(v=s.innerMode(c),!(!v||v.mode==s));)c=v.state,s=v.mode;return v||{mode:s,state:c}}function Xe(s,c,v){return s.startState?s.startState(c,v):!0}var ot=function(s,c,v){this.pos=this.start=0,this.string=s,this.tabSize=c||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=v};ot.prototype.eol=function(){return this.pos>=this.string.length},ot.prototype.sol=function(){return this.pos==this.lineStart},ot.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ot.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ot.prototype.eat=function(s){var c=this.string.charAt(this.pos),v;if(typeof s=="string"?v=c==s:v=c&&(s.test?s.test(c):s(c)),v)return++this.pos,c},ot.prototype.eatWhile=function(s){for(var c=this.pos;this.eat(s););return this.pos>c},ot.prototype.eatSpace=function(){for(var s=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>s},ot.prototype.skipToEnd=function(){this.pos=this.string.length},ot.prototype.skipTo=function(s){var c=this.string.indexOf(s,this.pos);if(c>-1)return this.pos=c,!0},ot.prototype.backUp=function(s){this.pos-=s},ot.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ge(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ge(this.string,this.lineStart,this.tabSize):0)},ot.prototype.indentation=function(){return ge(this.string,null,this.tabSize)-(this.lineStart?ge(this.string,this.lineStart,this.tabSize):0)},ot.prototype.match=function(s,c,v){if(typeof s=="string"){var p=function(N){return v?N.toLowerCase():N},m=this.string.substr(this.pos,s.length);if(p(m)==p(s))return c!==!1&&(this.pos+=s.length),!0}else{var C=this.string.slice(this.pos).match(s);return C&&C.index>0?null:(C&&c!==!1&&(this.pos+=C[0].length),C)}},ot.prototype.current=function(){return this.string.slice(this.start,this.pos)},ot.prototype.hideFirstChars=function(s,c){this.lineStart+=s;try{return c()}finally{this.lineStart-=s}},ot.prototype.lookAhead=function(s){var c=this.lineOracle;return c&&c.lookAhead(s)},ot.prototype.baseToken=function(){var s=this.lineOracle;return s&&s.baseToken(this.pos)};function Ge(s,c){if(c-=s.first,c<0||c>=s.size)throw new Error("There is no line "+(c+s.first)+" in the document.");for(var v=s;!v.lines;)for(var p=0;;++p){var m=v.children[p],C=m.chunkSize();if(c<C){v=m;break}c-=C}return v.lines[c]}function zt(s,c,v){var p=[],m=c.line;return s.iter(c.line,v.line+1,function(C){var N=C.text;m==v.line&&(N=N.slice(0,v.ch)),m==c.line&&(N=N.slice(c.ch)),p.push(N),++m}),p}function pn(s,c,v){var p=[];return s.iter(c,v,function(m){p.push(m.text)}),p}function Q(s,c){var v=c-s.height;if(v)for(var p=s;p;p=p.parent)p.height+=v}function L(s){if(s.parent==null)return null;for(var c=s.parent,v=Le(c.lines,s),p=c.parent;p;c=p,p=p.parent)for(var m=0;p.children[m]!=c;++m)v+=p.children[m].chunkSize();return v+c.first}function X(s,c){var v=s.first;e:do{for(var p=0;p<s.children.length;++p){var m=s.children[p],C=m.height;if(c<C){s=m;continue e}c-=C,v+=m.chunkSize()}return v}while(!s.lines);for(var N=0;N<s.lines.length;++N){var P=s.lines[N],B=P.height;if(c<B)break;c-=B}return v+N}function he(s,c){return c>=s.first&&c<s.first+s.size}function Oe(s,c){return String(s.lineNumberFormatter(c+s.firstLineNumber))}function me(s,c,v){if(v===void 0&&(v=null),!(this instanceof me))return new me(s,c,v);this.line=s,this.ch=c,this.sticky=v}function we(s,c){return s.line-c.line||s.ch-c.ch}function it(s,c){return s.sticky==c.sticky&&we(s,c)==0}function bt(s){return me(s.line,s.ch)}function Pt(s,c){return we(s,c)<0?c:s}function Mn(s,c){return we(s,c)<0?s:c}function Ts(s,c){return Math.max(s.first,Math.min(c,s.first+s.size-1))}function Bt(s,c){if(c.line<s.first)return me(s.first,0);var v=s.first+s.size-1;return c.line>v?me(v,Ge(s,v).text.length):Lr(c,Ge(s,c.line).text.length)}function Lr(s,c){var v=s.ch;return v==null||v>c?me(s.line,c):v<0?me(s.line,0):s}function ma(s,c){for(var v=[],p=0;p<c.length;p++)v[p]=Bt(s,c[p]);return v}var lo=function(s,c){this.state=s,this.lookAhead=c},yn=function(s,c,v,p){this.state=c,this.doc=s,this.line=v,this.maxLookAhead=p||0,this.baseTokens=null,this.baseTokenPos=1};yn.prototype.lookAhead=function(s){var c=this.doc.getLine(this.line+s);return c!=null&&s>this.maxLookAhead&&(this.maxLookAhead=s),c},yn.prototype.baseToken=function(s){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=s;)this.baseTokenPos+=2;var c=this.baseTokens[this.baseTokenPos+1];return{type:c&&c.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-s}},yn.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},yn.fromSaved=function(s,c,v){return c instanceof lo?new yn(s,Z(s.mode,c.state),v,c.lookAhead):new yn(s,Z(s.mode,c),v)},yn.prototype.save=function(s){var c=s!==!1?Z(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new lo(c,this.maxLookAhead):c};function Vr(s,c,v,p){var m=[s.state.modeGen],C={};pg(s,c.text,s.doc.mode,v,function(z,re){return m.push(z,re)},C,p);for(var N=v.state,P=function(z){v.baseTokens=m;var re=s.state.overlays[z],ae=1,ye=0;v.state=!0,pg(s,c.text,re.mode,v,function(pe,Ie){for(var We=ae;ye<pe;){var et=m[ae];et>pe&&m.splice(ae,1,pe,m[ae+1],et),ae+=2,ye=Math.min(pe,et)}if(Ie)if(re.opaque)m.splice(We,ae-We,pe,"overlay "+Ie),ae=We+2;else for(;We<ae;We+=2){var lt=m[We+1];m[We+1]=(lt?lt+" ":"")+"overlay "+Ie}},C),v.state=N,v.baseTokens=null,v.baseTokenPos=1},B=0;B<s.state.overlays.length;++B)P(B);return{styles:m,classes:C.bgClass||C.textClass?C:null}}function iu(s,c,v){if(!c.styles||c.styles[0]!=s.state.modeGen){var p=uo(s,L(c)),m=c.text.length>s.options.maxHighlightLength&&Z(s.doc.mode,p.state),C=Vr(s,c,p);m&&(p.state=m),c.stateAfter=p.save(!m),c.styles=C.styles,C.classes?c.styleClasses=C.classes:c.styleClasses&&(c.styleClasses=null),v===s.doc.highlightFrontier&&(s.doc.modeFrontier=Math.max(s.doc.modeFrontier,++s.doc.highlightFrontier))}return c.styles}function uo(s,c,v){var p=s.doc,m=s.display;if(!p.mode.startState)return new yn(p,!0,c);var C=Gw(s,c,v),N=C>p.first&&Ge(p,C-1).stateAfter,P=N?yn.fromSaved(p,N,C):new yn(p,Xe(p.mode),C);return p.iter(C,c,function(B){Mc(s,B.text,P);var z=P.line;B.stateAfter=z==c-1||z%5==0||z>=m.viewFrom&&z<m.viewTo?P.save():null,P.nextLine()}),v&&(p.modeFrontier=P.line),P}function Mc(s,c,v,p){var m=s.doc.mode,C=new ot(c,s.options.tabSize,v);for(C.start=C.pos=p||0,c==""&&dg(m,v.state);!C.eol();)Ac(m,C,v.state),C.start=C.pos}function dg(s,c){if(s.blankLine)return s.blankLine(c);if(s.innerMode){var v=be(s,c);if(v.mode.blankLine)return v.mode.blankLine(v.state)}}function Ac(s,c,v,p){for(var m=0;m<10;m++){p&&(p[0]=be(s,v).mode);var C=s.token(c,v);if(c.pos>c.start)return C}throw new Error("Mode "+s.name+" failed to advance stream.")}var cg=function(s,c,v){this.start=s.start,this.end=s.pos,this.string=s.current(),this.type=c||null,this.state=v};function fg(s,c,v,p){var m=s.doc,C=m.mode,N;c=Bt(m,c);var P=Ge(m,c.line),B=uo(s,c.line,v),z=new ot(P.text,s.options.tabSize,B),re;for(p&&(re=[]);(p||z.pos<c.ch)&&!z.eol();)z.start=z.pos,N=Ac(C,z,B.state),p&&re.push(new cg(z,N,Z(m.mode,B.state)));return p?re:new cg(z,N,B.state)}function hg(s,c){if(s)for(;;){var v=s.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!v)break;s=s.slice(0,v.index)+s.slice(v.index+v[0].length);var p=v[1]?"bgClass":"textClass";c[p]==null?c[p]=v[2]:new RegExp("(?:^|\\s)"+v[2]+"(?:$|\\s)").test(c[p])||(c[p]+=" "+v[2])}return s}function pg(s,c,v,p,m,C,N){var P=v.flattenSpans;P==null&&(P=s.options.flattenSpans);var B=0,z=null,re=new ot(c,s.options.tabSize,p),ae,ye=s.options.addModeClass&&[null];for(c==""&&hg(dg(v,p.state),C);!re.eol();){if(re.pos>s.options.maxHighlightLength?(P=!1,N&&Mc(s,c,p,re.pos),re.pos=c.length,ae=null):ae=hg(Ac(v,re,p.state,ye),C),ye){var pe=ye[0].name;pe&&(ae="m-"+(ae?pe+" "+ae:pe))}if(!P||z!=ae){for(;B<re.start;)B=Math.min(re.start,B+5e3),m(B,z);z=ae}re.start=re.pos}for(;B<re.pos;){var Ie=Math.min(re.pos,B+5e3);m(Ie,z),B=Ie}}function Gw(s,c,v){for(var p,m,C=s.doc,N=v?-1:c-(s.doc.mode.innerMode?1e3:100),P=c;P>N;--P){if(P<=C.first)return C.first;var B=Ge(C,P-1),z=B.stateAfter;if(z&&(!v||P+(z instanceof lo?z.lookAhead:0)<=C.modeFrontier))return P;var re=ge(B.text,null,s.options.tabSize);(m==null||p>re)&&(m=P-1,p=re)}return m}function Yw(s,c){if(s.modeFrontier=Math.min(s.modeFrontier,c),!(s.highlightFrontier<c-10)){for(var v=s.first,p=c-1;p>v;p--){var m=Ge(s,p).stateAfter;if(m&&(!(m instanceof lo)||p+m.lookAhead<c)){v=p+1;break}}s.highlightFrontier=Math.min(s.highlightFrontier,v)}}var vg=!1,Ji=!1;function Kw(){vg=!0}function Jw(){Ji=!0}function ou(s,c,v){this.marker=s,this.from=c,this.to=v}function Ds(s,c){if(s)for(var v=0;v<s.length;++v){var p=s[v];if(p.marker==c)return p}}function Zw(s,c){for(var v,p=0;p<s.length;++p)s[p]!=c&&(v||(v=[])).push(s[p]);return v}function Qw(s,c,v){var p=v&&window.WeakSet&&(v.markedSpans||(v.markedSpans=new WeakSet));p&&s.markedSpans&&p.has(s.markedSpans)?s.markedSpans.push(c):(s.markedSpans=s.markedSpans?s.markedSpans.concat([c]):[c],p&&p.add(s.markedSpans)),c.marker.attachLine(s)}function eS(s,c,v){var p;if(s)for(var m=0;m<s.length;++m){var C=s[m],N=C.marker,P=C.from==null||(N.inclusiveLeft?C.from<=c:C.from<c);if(P||C.from==c&&N.type=="bookmark"&&(!v||!C.marker.insertLeft)){var B=C.to==null||(N.inclusiveRight?C.to>=c:C.to>c);(p||(p=[])).push(new ou(N,C.from,B?null:C.to))}}return p}function tS(s,c,v){var p;if(s)for(var m=0;m<s.length;++m){var C=s[m],N=C.marker,P=C.to==null||(N.inclusiveRight?C.to>=c:C.to>c);if(P||C.from==c&&N.type=="bookmark"&&(!v||C.marker.insertLeft)){var B=C.from==null||(N.inclusiveLeft?C.from<=c:C.from<c);(p||(p=[])).push(new ou(N,B?null:C.from-c,C.to==null?null:C.to-c))}}return p}function Tc(s,c){if(c.full)return null;var v=he(s,c.from.line)&&Ge(s,c.from.line).markedSpans,p=he(s,c.to.line)&&Ge(s,c.to.line).markedSpans;if(!v&&!p)return null;var m=c.from.ch,C=c.to.ch,N=we(c.from,c.to)==0,P=eS(v,m,N),B=tS(p,C,N),z=c.text.length==1,re=A(c.text).length+(z?m:0);if(P)for(var ae=0;ae<P.length;++ae){var ye=P[ae];if(ye.to==null){var pe=Ds(B,ye.marker);pe?z&&(ye.to=pe.to==null?null:pe.to+re):ye.to=m}}if(B)for(var Ie=0;Ie<B.length;++Ie){var We=B[Ie];if(We.to!=null&&(We.to+=re),We.from==null){var et=Ds(P,We.marker);et||(We.from=re,z&&(P||(P=[])).push(We))}else We.from+=re,z&&(P||(P=[])).push(We)}P&&(P=gg(P)),B&&B!=P&&(B=gg(B));var lt=[P];if(!z){var ht=c.text.length-2,ut;if(ht>0&&P)for(var _t=0;_t<P.length;++_t)P[_t].to==null&&(ut||(ut=[])).push(new ou(P[_t].marker,null,null));for(var Tt=0;Tt<ht;++Tt)lt.push(ut);lt.push(B)}return lt}function gg(s){for(var c=0;c<s.length;++c){var v=s[c];v.from!=null&&v.from==v.to&&v.marker.clearWhenEmpty!==!1&&s.splice(c--,1)}return s.length?s:null}function nS(s,c,v){var p=null;if(s.iter(c.line,v.line+1,function(pe){if(pe.markedSpans)for(var Ie=0;Ie<pe.markedSpans.length;++Ie){var We=pe.markedSpans[Ie].marker;We.readOnly&&(!p||Le(p,We)==-1)&&(p||(p=[])).push(We)}}),!p)return null;for(var m=[{from:c,to:v}],C=0;C<p.length;++C)for(var N=p[C],P=N.find(0),B=0;B<m.length;++B){var z=m[B];if(!(we(z.to,P.from)<0||we(z.from,P.to)>0)){var re=[B,1],ae=we(z.from,P.from),ye=we(z.to,P.to);(ae<0||!N.inclusiveLeft&&!ae)&&re.push({from:z.from,to:P.from}),(ye>0||!N.inclusiveRight&&!ye)&&re.push({from:P.to,to:z.to}),m.splice.apply(m,re),B+=re.length-3}}return m}function mg(s){var c=s.markedSpans;if(c){for(var v=0;v<c.length;++v)c[v].marker.detachLine(s);s.markedSpans=null}}function yg(s,c){if(c){for(var v=0;v<c.length;++v)c[v].marker.attachLine(s);s.markedSpans=c}}function au(s){return s.inclusiveLeft?-1:0}function su(s){return s.inclusiveRight?1:0}function Dc(s,c){var v=s.lines.length-c.lines.length;if(v!=0)return v;var p=s.find(),m=c.find(),C=we(p.from,m.from)||au(s)-au(c);if(C)return-C;var N=we(p.to,m.to)||su(s)-su(c);return N||c.id-s.id}function _g(s,c){var v=Ji&&s.markedSpans,p;if(v)for(var m=void 0,C=0;C<v.length;++C)m=v[C],m.marker.collapsed&&(c?m.from:m.to)==null&&(!p||Dc(p,m.marker)<0)&&(p=m.marker);return p}function bg(s){return _g(s,!0)}function lu(s){return _g(s,!1)}function rS(s,c){var v=Ji&&s.markedSpans,p;if(v)for(var m=0;m<v.length;++m){var C=v[m];C.marker.collapsed&&(C.from==null||C.from<c)&&(C.to==null||C.to>c)&&(!p||Dc(p,C.marker)<0)&&(p=C.marker)}return p}function xg(s,c,v,p,m){var C=Ge(s,c),N=Ji&&C.markedSpans;if(N)for(var P=0;P<N.length;++P){var B=N[P];if(B.marker.collapsed){var z=B.marker.find(0),re=we(z.from,v)||au(B.marker)-au(m),ae=we(z.to,p)||su(B.marker)-su(m);if(!(re>=0&&ae<=0||re<=0&&ae>=0)&&(re<=0&&(B.marker.inclusiveRight&&m.inclusiveLeft?we(z.to,v)>=0:we(z.to,v)>0)||re>=0&&(B.marker.inclusiveRight&&m.inclusiveLeft?we(z.from,p)<=0:we(z.from,p)<0)))return!0}}}function di(s){for(var c;c=bg(s);)s=c.find(-1,!0).line;return s}function iS(s){for(var c;c=lu(s);)s=c.find(1,!0).line;return s}function oS(s){for(var c,v;c=lu(s);)s=c.find(1,!0).line,(v||(v=[])).push(s);return v}function Lc(s,c){var v=Ge(s,c),p=di(v);return v==p?c:L(p)}function wg(s,c){if(c>s.lastLine())return c;var v=Ge(s,c),p;if(!co(s,v))return c;for(;p=lu(v);)v=p.find(1,!0).line;return L(v)+1}function co(s,c){var v=Ji&&c.markedSpans;if(v){for(var p=void 0,m=0;m<v.length;++m)if(p=v[m],!!p.marker.collapsed){if(p.from==null)return!0;if(!p.marker.widgetNode&&p.from==0&&p.marker.inclusiveLeft&&Pc(s,c,p))return!0}}}function Pc(s,c,v){if(v.to==null){var p=v.marker.find(1,!0);return Pc(s,p.line,Ds(p.line.markedSpans,v.marker))}if(v.marker.inclusiveRight&&v.to==c.text.length)return!0;for(var m=void 0,C=0;C<c.markedSpans.length;++C)if(m=c.markedSpans[C],m.marker.collapsed&&!m.marker.widgetNode&&m.from==v.to&&(m.to==null||m.to!=v.from)&&(m.marker.inclusiveLeft||v.marker.inclusiveRight)&&Pc(s,c,m))return!0}function Zi(s){s=di(s);for(var c=0,v=s.parent,p=0;p<v.lines.length;++p){var m=v.lines[p];if(m==s)break;c+=m.height}for(var C=v.parent;C;v=C,C=v.parent)for(var N=0;N<C.children.length;++N){var P=C.children[N];if(P==v)break;c+=P.height}return c}function uu(s){if(s.height==0)return 0;for(var c=s.text.length,v,p=s;v=bg(p);){var m=v.find(0,!0);p=m.from.line,c+=m.from.ch-m.to.ch}for(p=s;v=lu(p);){var C=v.find(0,!0);c-=p.text.length-C.from.ch,p=C.to.line,c+=p.text.length-C.to.ch}return c}function Rc(s){var c=s.display,v=s.doc;c.maxLine=Ge(v,v.first),c.maxLineLength=uu(c.maxLine),c.maxLineChanged=!0,v.iter(function(p){var m=uu(p);m>c.maxLineLength&&(c.maxLineLength=m,c.maxLine=p)})}var ya=function(s,c,v){this.text=s,yg(this,c),this.height=v?v(this):1};ya.prototype.lineNo=function(){return L(this)},qe(ya);function aS(s,c,v,p){s.text=c,s.stateAfter&&(s.stateAfter=null),s.styles&&(s.styles=null),s.order!=null&&(s.order=null),mg(s),yg(s,v);var m=p?p(s):1;m!=s.height&&Q(s,m)}function sS(s){s.parent=null,mg(s)}var lS={},uS={};function Sg(s,c){if(!s||/^\s*$/.test(s))return null;var v=c.addModeClass?uS:lS;return v[s]||(v[s]=s.replace(/\S+/g,"cm-$&"))}function Eg(s,c){var v=fe("span",null,null,f?"padding-right: .1px":null),p={pre:fe("pre",[v],"CodeMirror-line"),content:v,col:0,pos:0,cm:s,trailingSpace:!1,splitSpaces:s.getOption("lineWrapping")};c.measure={};for(var m=0;m<=(c.rest?c.rest.length:0);m++){var C=m?c.rest[m-1]:c.line,N=void 0;p.pos=0,p.addToken=cS,Mr(s.display.measure)&&(N=at(C,s.doc.direction))&&(p.addToken=hS(p.addToken,N)),p.map=[];var P=c!=s.display.externalMeasured&&L(C);pS(C,p,iu(s,C,P)),C.styleClasses&&(C.styleClasses.bgClass&&(p.bgClass=ve(C.styleClasses.bgClass,p.bgClass||"")),C.styleClasses.textClass&&(p.textClass=ve(C.styleClasses.textClass,p.textClass||""))),p.map.length==0&&p.map.push(0,0,p.content.appendChild(Jr(s.display.measure))),m==0?(c.measure.map=p.map,c.measure.cache={}):((c.measure.maps||(c.measure.maps=[])).push(p.map),(c.measure.caches||(c.measure.caches=[])).push({}))}if(f){var B=p.content.lastChild;(/\bcm-tab\b/.test(B.className)||B.querySelector&&B.querySelector(".cm-tab"))&&(p.content.className="cm-tab-wrap-hack")}return Qe(s,"renderLine",s,c.line,p.pre),p.pre.className&&(p.textClass=ve(p.pre.className,p.textClass||"")),p}function dS(s){var c=j("span","•","cm-invalidchar");return c.title="\\u"+s.charCodeAt(0).toString(16),c.setAttribute("aria-label",c.title),c}function cS(s,c,v,p,m,C,N){if(c){var P=s.splitSpaces?fS(c,s.trailingSpace):c,B=s.cm.state.specialChars,z=!1,re;if(!B.test(c))s.col+=c.length,re=document.createTextNode(P),s.map.push(s.pos,s.pos+c.length,re),u&&d<9&&(z=!0),s.pos+=c.length;else{re=document.createDocumentFragment();for(var ae=0;;){B.lastIndex=ae;var ye=B.exec(c),pe=ye?ye.index-ae:c.length-ae;if(pe){var Ie=document.createTextNode(P.slice(ae,ae+pe));u&&d<9?re.appendChild(j("span",[Ie])):re.appendChild(Ie),s.map.push(s.pos,s.pos+pe,Ie),s.col+=pe,s.pos+=pe}if(!ye)break;ae+=pe+1;var We=void 0;if(ye[0]=="	"){var et=s.cm.options.tabSize,lt=et-s.col%et;We=re.appendChild(j("span",te(lt),"cm-tab")),We.setAttribute("role","presentation"),We.setAttribute("cm-text","	"),s.col+=lt}else ye[0]=="\r"||ye[0]==`
`?(We=re.appendChild(j("span",ye[0]=="\r"?"␍":"␤","cm-invalidchar")),We.setAttribute("cm-text",ye[0]),s.col+=1):(We=s.cm.options.specialCharPlaceholder(ye[0]),We.setAttribute("cm-text",ye[0]),u&&d<9?re.appendChild(j("span",[We])):re.appendChild(We),s.col+=1);s.map.push(s.pos,s.pos+1,We),s.pos++}}if(s.trailingSpace=P.charCodeAt(c.length-1)==32,v||p||m||z||C||N){var ht=v||"";p&&(ht+=p),m&&(ht+=m);var ut=j("span",[re],ht,C);if(N)for(var _t in N)N.hasOwnProperty(_t)&&_t!="style"&&_t!="class"&&ut.setAttribute(_t,N[_t]);return s.content.appendChild(ut)}s.content.appendChild(re)}}function fS(s,c){if(s.length>1&&!/  /.test(s))return s;for(var v=c,p="",m=0;m<s.length;m++){var C=s.charAt(m);C==" "&&v&&(m==s.length-1||s.charCodeAt(m+1)==32)&&(C=" "),p+=C,v=C==" "}return p}function hS(s,c){return function(v,p,m,C,N,P,B){m=m?m+" cm-force-border":"cm-force-border";for(var z=v.pos,re=z+p.length;;){for(var ae=void 0,ye=0;ye<c.length&&(ae=c[ye],!(ae.to>z&&ae.from<=z));ye++);if(ae.to>=re)return s(v,p,m,C,N,P,B);s(v,p.slice(0,ae.to-z),m,C,null,P,B),C=null,p=p.slice(ae.to-z),z=ae.to}}}function Cg(s,c,v,p){var m=!p&&v.widgetNode;m&&s.map.push(s.pos,s.pos+c,m),!p&&s.cm.display.input.needsContentAttribute&&(m||(m=s.content.appendChild(document.createElement("span"))),m.setAttribute("cm-marker",v.id)),m&&(s.cm.display.input.setUneditable(m),s.content.appendChild(m)),s.pos+=c,s.trailingSpace=!1}function pS(s,c,v){var p=s.markedSpans,m=s.text,C=0;if(!p){for(var N=1;N<v.length;N+=2)c.addToken(c,m.slice(C,C=v[N]),Sg(v[N+1],c.cm.options));return}for(var P=m.length,B=0,z=1,re="",ae,ye,pe=0,Ie,We,et,lt,ht;;){if(pe==B){Ie=We=et=ye="",ht=null,lt=null,pe=1/0;for(var ut=[],_t=void 0,Tt=0;Tt<p.length;++Tt){var At=p[Tt],Ut=At.marker;if(Ut.type=="bookmark"&&At.from==B&&Ut.widgetNode)ut.push(Ut);else if(At.from<=B&&(At.to==null||At.to>B||Ut.collapsed&&At.to==B&&At.from==B)){if(At.to!=null&&At.to!=B&&pe>At.to&&(pe=At.to,We=""),Ut.className&&(Ie+=" "+Ut.className),Ut.css&&(ye=(ye?ye+";":"")+Ut.css),Ut.startStyle&&At.from==B&&(et+=" "+Ut.startStyle),Ut.endStyle&&At.to==pe&&(_t||(_t=[])).push(Ut.endStyle,At.to),Ut.title&&((ht||(ht={})).title=Ut.title),Ut.attributes)for(var hn in Ut.attributes)(ht||(ht={}))[hn]=Ut.attributes[hn];Ut.collapsed&&(!lt||Dc(lt.marker,Ut)<0)&&(lt=At)}else At.from>B&&pe>At.from&&(pe=At.from)}if(_t)for(var Xn=0;Xn<_t.length;Xn+=2)_t[Xn+1]==pe&&(We+=" "+_t[Xn]);if(!lt||lt.from==B)for(var wn=0;wn<ut.length;++wn)Cg(c,0,ut[wn]);if(lt&&(lt.from||0)==B){if(Cg(c,(lt.to==null?P+1:lt.to)-B,lt.marker,lt.from==null),lt.to==null)return;lt.to==B&&(lt=!1)}}if(B>=P)break;for(var Rr=Math.min(P,pe);;){if(re){var _r=B+re.length;if(!lt){var Tn=_r>Rr?re.slice(0,Rr-B):re;c.addToken(c,Tn,ae?ae+Ie:Ie,et,B+Tn.length==pe?We:"",ye,ht)}if(_r>=Rr){re=re.slice(Rr-B),B=Rr;break}B=_r,et=""}re=m.slice(C,C=v[z++]),ae=Sg(v[z++],c.cm.options)}}}function kg(s,c,v){this.line=c,this.rest=oS(c),this.size=this.rest?L(A(this.rest))-v+1:1,this.node=this.text=null,this.hidden=co(s,c)}function du(s,c,v){for(var p=[],m,C=c;C<v;C=m){var N=new kg(s.doc,Ge(s.doc,C),C);m=C+N.size,p.push(N)}return p}var _a=null;function vS(s){_a?_a.ops.push(s):s.ownsGroup=_a={ops:[s],delayedCallbacks:[]}}function gS(s){var c=s.delayedCallbacks,v=0;do{for(;v<c.length;v++)c[v].call(null);for(var p=0;p<s.ops.length;p++){var m=s.ops[p];if(m.cursorActivityHandlers)for(;m.cursorActivityCalled<m.cursorActivityHandlers.length;)m.cursorActivityHandlers[m.cursorActivityCalled++].call(null,m.cm)}}while(v<c.length)}function mS(s,c){var v=s.ownsGroup;if(v)try{gS(v)}finally{_a=null,c(v)}}var Ls=null;function Un(s,c){var v=vt(s,c);if(v.length){var p=Array.prototype.slice.call(arguments,2),m;_a?m=_a.delayedCallbacks:Ls?m=Ls:(m=Ls=[],setTimeout(yS,0));for(var C=function(P){m.push(function(){return v[P].apply(null,p)})},N=0;N<v.length;++N)C(N)}}function yS(){var s=Ls;Ls=null;for(var c=0;c<s.length;++c)s[c]()}function Og(s,c,v,p){for(var m=0;m<c.changes.length;m++){var C=c.changes[m];C=="text"?bS(s,c):C=="gutter"?Mg(s,c,v,p):C=="class"?Ic(s,c):C=="widget"&&xS(s,c,p)}c.changes=null}function Ps(s){return s.node==s.text&&(s.node=j("div",null,null,"position: relative"),s.text.parentNode&&s.text.parentNode.replaceChild(s.node,s.text),s.node.appendChild(s.text),u&&d<8&&(s.node.style.zIndex=2)),s.node}function _S(s,c){var v=c.bgClass?c.bgClass+" "+(c.line.bgClass||""):c.line.bgClass;if(v&&(v+=" CodeMirror-linebackground"),c.background)v?c.background.className=v:(c.background.parentNode.removeChild(c.background),c.background=null);else if(v){var p=Ps(c);c.background=p.insertBefore(j("div",null,v),p.firstChild),s.display.input.setUneditable(c.background)}}function Ng(s,c){var v=s.display.externalMeasured;return v&&v.line==c.line?(s.display.externalMeasured=null,c.measure=v.measure,v.built):Eg(s,c)}function bS(s,c){var v=c.text.className,p=Ng(s,c);c.text==c.node&&(c.node=p.pre),c.text.parentNode.replaceChild(p.pre,c.text),c.text=p.pre,p.bgClass!=c.bgClass||p.textClass!=c.textClass?(c.bgClass=p.bgClass,c.textClass=p.textClass,Ic(s,c)):v&&(c.text.className=v)}function Ic(s,c){_S(s,c),c.line.wrapClass?Ps(c).className=c.line.wrapClass:c.node!=c.text&&(c.node.className="");var v=c.textClass?c.textClass+" "+(c.line.textClass||""):c.line.textClass;c.text.className=v||""}function Mg(s,c,v,p){if(c.gutter&&(c.node.removeChild(c.gutter),c.gutter=null),c.gutterBackground&&(c.node.removeChild(c.gutterBackground),c.gutterBackground=null),c.line.gutterClass){var m=Ps(c);c.gutterBackground=j("div",null,"CodeMirror-gutter-background "+c.line.gutterClass,"left: "+(s.options.fixedGutter?p.fixedPos:-p.gutterTotalWidth)+"px; width: "+p.gutterTotalWidth+"px"),s.display.input.setUneditable(c.gutterBackground),m.insertBefore(c.gutterBackground,c.text)}var C=c.line.gutterMarkers;if(s.options.lineNumbers||C){var N=Ps(c),P=c.gutter=j("div",null,"CodeMirror-gutter-wrapper","left: "+(s.options.fixedGutter?p.fixedPos:-p.gutterTotalWidth)+"px");if(P.setAttribute("aria-hidden","true"),s.display.input.setUneditable(P),N.insertBefore(P,c.text),c.line.gutterClass&&(P.className+=" "+c.line.gutterClass),s.options.lineNumbers&&(!C||!C["CodeMirror-linenumbers"])&&(c.lineNumber=P.appendChild(j("div",Oe(s.options,v),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+p.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+s.display.lineNumInnerWidth+"px"))),C)for(var B=0;B<s.display.gutterSpecs.length;++B){var z=s.display.gutterSpecs[B].className,re=C.hasOwnProperty(z)&&C[z];re&&P.appendChild(j("div",[re],"CodeMirror-gutter-elt","left: "+p.gutterLeft[z]+"px; width: "+p.gutterWidth[z]+"px"))}}}function xS(s,c,v){c.alignable&&(c.alignable=null);for(var p=V("CodeMirror-linewidget"),m=c.node.firstChild,C=void 0;m;m=C)C=m.nextSibling,p.test(m.className)&&c.node.removeChild(m);Ag(s,c,v)}function wS(s,c,v,p){var m=Ng(s,c);return c.text=c.node=m.pre,m.bgClass&&(c.bgClass=m.bgClass),m.textClass&&(c.textClass=m.textClass),Ic(s,c),Mg(s,c,v,p),Ag(s,c,p),c.node}function Ag(s,c,v){if(Tg(s,c.line,c,v,!0),c.rest)for(var p=0;p<c.rest.length;p++)Tg(s,c.rest[p],c,v,!1)}function Tg(s,c,v,p,m){if(c.widgets)for(var C=Ps(v),N=0,P=c.widgets;N<P.length;++N){var B=P[N],z=j("div",[B.node],"CodeMirror-linewidget"+(B.className?" "+B.className:""));B.handleMouseEvents||z.setAttribute("cm-ignore-events","true"),SS(B,z,v,p),s.display.input.setUneditable(z),m&&B.above?C.insertBefore(z,v.gutter||v.text):C.appendChild(z),Un(B,"redraw")}}function SS(s,c,v,p){if(s.noHScroll){(v.alignable||(v.alignable=[])).push(c);var m=p.wrapperWidth;c.style.left=p.fixedPos+"px",s.coverGutter||(m-=p.gutterTotalWidth,c.style.paddingLeft=p.gutterTotalWidth+"px"),c.style.width=m+"px"}s.coverGutter&&(c.style.zIndex=5,c.style.position="relative",s.noHScroll||(c.style.marginLeft=-p.gutterTotalWidth+"px"))}function Rs(s){if(s.height!=null)return s.height;var c=s.doc.cm;if(!c)return 0;if(!_e(document.body,s.node)){var v="position: relative;";s.coverGutter&&(v+="margin-left: -"+c.display.gutters.offsetWidth+"px;"),s.noHScroll&&(v+="width: "+c.display.wrapper.clientWidth+"px;"),U(c.display.measure,j("div",[s.node],null,v))}return s.height=s.node.parentNode.offsetHeight}function Qi(s,c){for(var v=Qn(c);v!=s.wrapper;v=v.parentNode)if(!v||v.nodeType==1&&v.getAttribute("cm-ignore-events")=="true"||v.parentNode==s.sizer&&v!=s.mover)return!0}function cu(s){return s.lineSpace.offsetTop}function Bc(s){return s.mover.offsetHeight-s.lineSpace.offsetHeight}function Dg(s){if(s.cachedPaddingH)return s.cachedPaddingH;var c=U(s.measure,j("pre","x","CodeMirror-line-like")),v=window.getComputedStyle?window.getComputedStyle(c):c.currentStyle,p={left:parseInt(v.paddingLeft),right:parseInt(v.paddingRight)};return!isNaN(p.left)&&!isNaN(p.right)&&(s.cachedPaddingH=p),p}function Ri(s){return He-s.display.nativeBarWidth}function jo(s){return s.display.scroller.clientWidth-Ri(s)-s.display.barWidth}function jc(s){return s.display.scroller.clientHeight-Ri(s)-s.display.barHeight}function ES(s,c,v){var p=s.options.lineWrapping,m=p&&jo(s);if(!c.measure.heights||p&&c.measure.width!=m){var C=c.measure.heights=[];if(p){c.measure.width=m;for(var N=c.text.firstChild.getClientRects(),P=0;P<N.length-1;P++){var B=N[P],z=N[P+1];Math.abs(B.bottom-z.bottom)>2&&C.push((B.bottom+z.top)/2-v.top)}}C.push(v.bottom-v.top)}}function Lg(s,c,v){if(s.line==c)return{map:s.measure.map,cache:s.measure.cache};if(s.rest){for(var p=0;p<s.rest.length;p++)if(s.rest[p]==c)return{map:s.measure.maps[p],cache:s.measure.caches[p]};for(var m=0;m<s.rest.length;m++)if(L(s.rest[m])>v)return{map:s.measure.maps[m],cache:s.measure.caches[m],before:!0}}}function CS(s,c){c=di(c);var v=L(c),p=s.display.externalMeasured=new kg(s.doc,c,v);p.lineN=v;var m=p.built=Eg(s,p);return p.text=m.pre,U(s.display.lineMeasure,m.pre),p}function Pg(s,c,v,p){return Ii(s,ba(s,c),v,p)}function Hc(s,c){if(c>=s.display.viewFrom&&c<s.display.viewTo)return s.display.view[Fo(s,c)];var v=s.display.externalMeasured;if(v&&c>=v.lineN&&c<v.lineN+v.size)return v}function ba(s,c){var v=L(c),p=Hc(s,v);p&&!p.text?p=null:p&&p.changes&&(Og(s,p,v,Uc(s)),s.curOp.forceUpdate=!0),p||(p=CS(s,c));var m=Lg(p,c,v);return{line:c,view:p,rect:null,map:m.map,cache:m.cache,before:m.before,hasHeights:!1}}function Ii(s,c,v,p,m){c.before&&(v=-1);var C=v+(p||""),N;return c.cache.hasOwnProperty(C)?N=c.cache[C]:(c.rect||(c.rect=c.view.text.getBoundingClientRect()),c.hasHeights||(ES(s,c.view,c.rect),c.hasHeights=!0),N=OS(s,c,v,p),N.bogus||(c.cache[C]=N)),{left:N.left,right:N.right,top:m?N.rtop:N.top,bottom:m?N.rbottom:N.bottom}}var Rg={left:0,right:0,top:0,bottom:0};function Ig(s,c,v){for(var p,m,C,N,P,B,z=0;z<s.length;z+=3)if(P=s[z],B=s[z+1],c<P?(m=0,C=1,N="left"):c<B?(m=c-P,C=m+1):(z==s.length-3||c==B&&s[z+3]>c)&&(C=B-P,m=C-1,c>=B&&(N="right")),m!=null){if(p=s[z+2],P==B&&v==(p.insertLeft?"left":"right")&&(N=v),v=="left"&&m==0)for(;z&&s[z-2]==s[z-3]&&s[z-1].insertLeft;)p=s[(z-=3)+2],N="left";if(v=="right"&&m==B-P)for(;z<s.length-3&&s[z+3]==s[z+4]&&!s[z+5].insertLeft;)p=s[(z+=3)+2],N="right";break}return{node:p,start:m,end:C,collapse:N,coverStart:P,coverEnd:B}}function kS(s,c){var v=Rg;if(c=="left")for(var p=0;p<s.length&&(v=s[p]).left==v.right;p++);else for(var m=s.length-1;m>=0&&(v=s[m]).left==v.right;m--);return v}function OS(s,c,v,p){var m=Ig(c.map,v,p),C=m.node,N=m.start,P=m.end,B=m.collapse,z;if(C.nodeType==3){for(var re=0;re<4;re++){for(;N&&Ze(c.line.text.charAt(m.coverStart+N));)--N;for(;m.coverStart+P<m.coverEnd&&Ze(c.line.text.charAt(m.coverStart+P));)++P;if(u&&d<9&&N==0&&P==m.coverEnd-m.coverStart?z=C.parentNode.getBoundingClientRect():z=kS(Ee(C,N,P).getClientRects(),p),z.left||z.right||N==0)break;P=N,N=N-1,B="right"}u&&d<11&&(z=NS(s.display.measure,z))}else{N>0&&(B=p="right");var ae;s.options.lineWrapping&&(ae=C.getClientRects()).length>1?z=ae[p=="right"?ae.length-1:0]:z=C.getBoundingClientRect()}if(u&&d<9&&!N&&(!z||!z.left&&!z.right)){var ye=C.parentNode.getClientRects()[0];ye?z={left:ye.left,right:ye.left+wa(s.display),top:ye.top,bottom:ye.bottom}:z=Rg}for(var pe=z.top-c.rect.top,Ie=z.bottom-c.rect.top,We=(pe+Ie)/2,et=c.view.measure.heights,lt=0;lt<et.length-1&&!(We<et[lt]);lt++);var ht=lt?et[lt-1]:0,ut=et[lt],_t={left:(B=="right"?z.right:z.left)-c.rect.left,right:(B=="left"?z.left:z.right)-c.rect.left,top:ht,bottom:ut};return!z.left&&!z.right&&(_t.bogus=!0),s.options.singleCursorHeightPerLine||(_t.rtop=pe,_t.rbottom=Ie),_t}function NS(s,c){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!Pi(s))return c;var v=screen.logicalXDPI/screen.deviceXDPI,p=screen.logicalYDPI/screen.deviceYDPI;return{left:c.left*v,right:c.right*v,top:c.top*p,bottom:c.bottom*p}}function Bg(s){if(s.measure&&(s.measure.cache={},s.measure.heights=null,s.rest))for(var c=0;c<s.rest.length;c++)s.measure.caches[c]={}}function jg(s){s.display.externalMeasure=null,D(s.display.lineMeasure);for(var c=0;c<s.display.view.length;c++)Bg(s.display.view[c])}function Is(s){jg(s),s.display.cachedCharWidth=s.display.cachedTextHeight=s.display.cachedPaddingH=null,s.options.lineWrapping||(s.display.maxLineChanged=!0),s.display.lineNumChars=null}function Hg(s){return g&&k?-(s.body.getBoundingClientRect().left-parseInt(getComputedStyle(s.body).marginLeft)):s.defaultView.pageXOffset||(s.documentElement||s.body).scrollLeft}function $g(s){return g&&k?-(s.body.getBoundingClientRect().top-parseInt(getComputedStyle(s.body).marginTop)):s.defaultView.pageYOffset||(s.documentElement||s.body).scrollTop}function $c(s){var c=di(s),v=c.widgets,p=0;if(v)for(var m=0;m<v.length;++m)v[m].above&&(p+=Rs(v[m]));return p}function fu(s,c,v,p,m){if(!m){var C=$c(c);v.top+=C,v.bottom+=C}if(p=="line")return v;p||(p="local");var N=Zi(c);if(p=="local"?N+=cu(s.display):N-=s.display.viewOffset,p=="page"||p=="window"){var P=s.display.lineSpace.getBoundingClientRect();N+=P.top+(p=="window"?0:$g(Be(s)));var B=P.left+(p=="window"?0:Hg(Be(s)));v.left+=B,v.right+=B}return v.top+=N,v.bottom+=N,v}function Fg(s,c,v){if(v=="div")return c;var p=c.left,m=c.top;if(v=="page")p-=Hg(Be(s)),m-=$g(Be(s));else if(v=="local"||!v){var C=s.display.sizer.getBoundingClientRect();p+=C.left,m+=C.top}var N=s.display.lineSpace.getBoundingClientRect();return{left:p-N.left,top:m-N.top}}function hu(s,c,v,p,m){return p||(p=Ge(s.doc,c.line)),fu(s,p,Pg(s,p,c.ch,m),v)}function ci(s,c,v,p,m,C){p=p||Ge(s.doc,c.line),m||(m=ba(s,p));function N(Ie,We){var et=Ii(s,m,Ie,We?"right":"left",C);return We?et.left=et.right:et.right=et.left,fu(s,p,et,v)}var P=at(p,s.doc.direction),B=c.ch,z=c.sticky;if(B>=p.text.length?(B=p.text.length,z="before"):B<=0&&(B=0,z="after"),!P)return N(z=="before"?B-1:B,z=="before");function re(Ie,We,et){var lt=P[We],ht=lt.level==1;return N(et?Ie-1:Ie,ht!=et)}var ae=dt(P,B,z),ye=Je,pe=re(B,ae,z=="before");return ye!=null&&(pe.other=re(B,ye,z!="before")),pe}function zg(s,c){var v=0;c=Bt(s.doc,c),s.options.lineWrapping||(v=wa(s.display)*c.ch);var p=Ge(s.doc,c.line),m=Zi(p)+cu(s.display);return{left:v,right:v,top:m,bottom:m+p.height}}function Fc(s,c,v,p,m){var C=me(s,c,v);return C.xRel=m,p&&(C.outside=p),C}function zc(s,c,v){var p=s.doc;if(v+=s.display.viewOffset,v<0)return Fc(p.first,0,null,-1,-1);var m=X(p,v),C=p.first+p.size-1;if(m>C)return Fc(p.first+p.size-1,Ge(p,C).text.length,null,1,1);c<0&&(c=0);for(var N=Ge(p,m);;){var P=MS(s,N,m,c,v),B=rS(N,P.ch+(P.xRel>0||P.outside>0?1:0));if(!B)return P;var z=B.find(1);if(z.line==m)return z;N=Ge(p,m=z.line)}}function Wg(s,c,v,p){p-=$c(c);var m=c.text.length,C=pt(function(N){return Ii(s,v,N-1).bottom<=p},m,0);return m=pt(function(N){return Ii(s,v,N).top>p},C,m),{begin:C,end:m}}function Ug(s,c,v,p){v||(v=ba(s,c));var m=fu(s,c,Ii(s,v,p),"line").top;return Wg(s,c,v,m)}function Wc(s,c,v,p){return s.bottom<=v?!1:s.top>v?!0:(p?s.left:s.right)>c}function MS(s,c,v,p,m){m-=Zi(c);var C=ba(s,c),N=$c(c),P=0,B=c.text.length,z=!0,re=at(c,s.doc.direction);if(re){var ae=(s.options.lineWrapping?TS:AS)(s,c,v,C,re,p,m);z=ae.level!=1,P=z?ae.from:ae.to-1,B=z?ae.to:ae.from-1}var ye=null,pe=null,Ie=pt(function(Tt){var At=Ii(s,C,Tt);return At.top+=N,At.bottom+=N,Wc(At,p,m,!1)?(At.top<=m&&At.left<=p&&(ye=Tt,pe=At),!0):!1},P,B),We,et,lt=!1;if(pe){var ht=p-pe.left<pe.right-p,ut=ht==z;Ie=ye+(ut?0:1),et=ut?"after":"before",We=ht?pe.left:pe.right}else{!z&&(Ie==B||Ie==P)&&Ie++,et=Ie==0?"after":Ie==c.text.length?"before":Ii(s,C,Ie-(z?1:0)).bottom+N<=m==z?"after":"before";var _t=ci(s,me(v,Ie,et),"line",c,C);We=_t.left,lt=m<_t.top?-1:m>=_t.bottom?1:0}return Ie=ct(c.text,Ie,1),Fc(v,Ie,et,lt,p-We)}function AS(s,c,v,p,m,C,N){var P=pt(function(ae){var ye=m[ae],pe=ye.level!=1;return Wc(ci(s,me(v,pe?ye.to:ye.from,pe?"before":"after"),"line",c,p),C,N,!0)},0,m.length-1),B=m[P];if(P>0){var z=B.level!=1,re=ci(s,me(v,z?B.from:B.to,z?"after":"before"),"line",c,p);Wc(re,C,N,!0)&&re.top>N&&(B=m[P-1])}return B}function TS(s,c,v,p,m,C,N){var P=Wg(s,c,p,N),B=P.begin,z=P.end;/\s/.test(c.text.charAt(z-1))&&z--;for(var re=null,ae=null,ye=0;ye<m.length;ye++){var pe=m[ye];if(!(pe.from>=z||pe.to<=B)){var Ie=pe.level!=1,We=Ii(s,p,Ie?Math.min(z,pe.to)-1:Math.max(B,pe.from)).right,et=We<C?C-We+1e9:We-C;(!re||ae>et)&&(re=pe,ae=et)}}return re||(re=m[m.length-1]),re.from<B&&(re={from:B,to:re.to,level:re.level}),re.to>z&&(re={from:re.from,to:z,level:re.level}),re}var Ho;function xa(s){if(s.cachedTextHeight!=null)return s.cachedTextHeight;if(Ho==null){Ho=j("pre",null,"CodeMirror-line-like");for(var c=0;c<49;++c)Ho.appendChild(document.createTextNode("x")),Ho.appendChild(j("br"));Ho.appendChild(document.createTextNode("x"))}U(s.measure,Ho);var v=Ho.offsetHeight/50;return v>3&&(s.cachedTextHeight=v),D(s.measure),v||1}function wa(s){if(s.cachedCharWidth!=null)return s.cachedCharWidth;var c=j("span","xxxxxxxxxx"),v=j("pre",[c],"CodeMirror-line-like");U(s.measure,v);var p=c.getBoundingClientRect(),m=(p.right-p.left)/10;return m>2&&(s.cachedCharWidth=m),m||10}function Uc(s){for(var c=s.display,v={},p={},m=c.gutters.clientLeft,C=c.gutters.firstChild,N=0;C;C=C.nextSibling,++N){var P=s.display.gutterSpecs[N].className;v[P]=C.offsetLeft+C.clientLeft+m,p[P]=C.clientWidth}return{fixedPos:Vc(c),gutterTotalWidth:c.gutters.offsetWidth,gutterLeft:v,gutterWidth:p,wrapperWidth:c.wrapper.clientWidth}}function Vc(s){return s.scroller.getBoundingClientRect().left-s.sizer.getBoundingClientRect().left}function Vg(s){var c=xa(s.display),v=s.options.lineWrapping,p=v&&Math.max(5,s.display.scroller.clientWidth/wa(s.display)-3);return function(m){if(co(s.doc,m))return 0;var C=0;if(m.widgets)for(var N=0;N<m.widgets.length;N++)m.widgets[N].height&&(C+=m.widgets[N].height);return v?C+(Math.ceil(m.text.length/p)||1)*c:C+c}}function qc(s){var c=s.doc,v=Vg(s);c.iter(function(p){var m=v(p);m!=p.height&&Q(p,m)})}function $o(s,c,v,p){var m=s.display;if(!v&&Qn(c).getAttribute("cm-not-content")=="true")return null;var C,N,P=m.lineSpace.getBoundingClientRect();try{C=c.clientX-P.left,N=c.clientY-P.top}catch{return null}var B=zc(s,C,N),z;if(p&&B.xRel>0&&(z=Ge(s.doc,B.line).text).length==B.ch){var re=ge(z,z.length,s.options.tabSize)-z.length;B=me(B.line,Math.max(0,Math.round((C-Dg(s.display).left)/wa(s.display))-re))}return B}function Fo(s,c){if(c>=s.display.viewTo||(c-=s.display.viewFrom,c<0))return null;for(var v=s.display.view,p=0;p<v.length;p++)if(c-=v[p].size,c<0)return p}function mr(s,c,v,p){c==null&&(c=s.doc.first),v==null&&(v=s.doc.first+s.doc.size),p||(p=0);var m=s.display;if(p&&v<m.viewTo&&(m.updateLineNumbers==null||m.updateLineNumbers>c)&&(m.updateLineNumbers=c),s.curOp.viewChanged=!0,c>=m.viewTo)Ji&&Lc(s.doc,c)<m.viewTo&&ho(s);else if(v<=m.viewFrom)Ji&&wg(s.doc,v+p)>m.viewFrom?ho(s):(m.viewFrom+=p,m.viewTo+=p);else if(c<=m.viewFrom&&v>=m.viewTo)ho(s);else if(c<=m.viewFrom){var C=pu(s,v,v+p,1);C?(m.view=m.view.slice(C.index),m.viewFrom=C.lineN,m.viewTo+=p):ho(s)}else if(v>=m.viewTo){var N=pu(s,c,c,-1);N?(m.view=m.view.slice(0,N.index),m.viewTo=N.lineN):ho(s)}else{var P=pu(s,c,c,-1),B=pu(s,v,v+p,1);P&&B?(m.view=m.view.slice(0,P.index).concat(du(s,P.lineN,B.lineN)).concat(m.view.slice(B.index)),m.viewTo+=p):ho(s)}var z=m.externalMeasured;z&&(v<z.lineN?z.lineN+=p:c<z.lineN+z.size&&(m.externalMeasured=null))}function fo(s,c,v){s.curOp.viewChanged=!0;var p=s.display,m=s.display.externalMeasured;if(m&&c>=m.lineN&&c<m.lineN+m.size&&(p.externalMeasured=null),!(c<p.viewFrom||c>=p.viewTo)){var C=p.view[Fo(s,c)];if(C.node!=null){var N=C.changes||(C.changes=[]);Le(N,v)==-1&&N.push(v)}}}function ho(s){s.display.viewFrom=s.display.viewTo=s.doc.first,s.display.view=[],s.display.viewOffset=0}function pu(s,c,v,p){var m=Fo(s,c),C,N=s.display.view;if(!Ji||v==s.doc.first+s.doc.size)return{index:m,lineN:v};for(var P=s.display.viewFrom,B=0;B<m;B++)P+=N[B].size;if(P!=c){if(p>0){if(m==N.length-1)return null;C=P+N[m].size-c,m++}else C=P-c;c+=C,v+=C}for(;Lc(s.doc,v)!=v;){if(m==(p<0?0:N.length-1))return null;v+=p*N[m-(p<0?1:0)].size,m+=p}return{index:m,lineN:v}}function DS(s,c,v){var p=s.display,m=p.view;m.length==0||c>=p.viewTo||v<=p.viewFrom?(p.view=du(s,c,v),p.viewFrom=c):(p.viewFrom>c?p.view=du(s,c,p.viewFrom).concat(p.view):p.viewFrom<c&&(p.view=p.view.slice(Fo(s,c))),p.viewFrom=c,p.viewTo<v?p.view=p.view.concat(du(s,p.viewTo,v)):p.viewTo>v&&(p.view=p.view.slice(0,Fo(s,v)))),p.viewTo=v}function qg(s){for(var c=s.display.view,v=0,p=0;p<c.length;p++){var m=c[p];!m.hidden&&(!m.node||m.changes)&&++v}return v}function Bs(s){s.display.input.showSelection(s.display.input.prepareSelection())}function Xg(s,c){c===void 0&&(c=!0);var v=s.doc,p={},m=p.cursors=document.createDocumentFragment(),C=p.selection=document.createDocumentFragment(),N=s.options.$customCursor;N&&(c=!0);for(var P=0;P<v.sel.ranges.length;P++)if(!(!c&&P==v.sel.primIndex)){var B=v.sel.ranges[P];if(!(B.from().line>=s.display.viewTo||B.to().line<s.display.viewFrom)){var z=B.empty();if(N){var re=N(s,B);re&&Xc(s,re,m)}else(z||s.options.showCursorWhenSelecting)&&Xc(s,B.head,m);z||LS(s,B,C)}}return p}function Xc(s,c,v){var p=ci(s,c,"div",null,null,!s.options.singleCursorHeightPerLine),m=v.appendChild(j("div"," ","CodeMirror-cursor"));if(m.style.left=p.left+"px",m.style.top=p.top+"px",m.style.height=Math.max(0,p.bottom-p.top)*s.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(s.getWrapperElement().className)){var C=hu(s,c,"div",null,null),N=C.right-C.left;m.style.width=(N>0?N:s.defaultCharWidth())+"px"}if(p.other){var P=v.appendChild(j("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));P.style.display="",P.style.left=p.other.left+"px",P.style.top=p.other.top+"px",P.style.height=(p.other.bottom-p.other.top)*.85+"px"}}function vu(s,c){return s.top-c.top||s.left-c.left}function LS(s,c,v){var p=s.display,m=s.doc,C=document.createDocumentFragment(),N=Dg(s.display),P=N.left,B=Math.max(p.sizerWidth,jo(s)-p.sizer.offsetLeft)-N.right,z=m.direction=="ltr";function re(ut,_t,Tt,At){_t<0&&(_t=0),_t=Math.round(_t),At=Math.round(At),C.appendChild(j("div",null,"CodeMirror-selected","position: absolute; left: "+ut+`px;
                             top: `+_t+"px; width: "+(Tt??B-ut)+`px;
                             height: `+(At-_t)+"px"))}function ae(ut,_t,Tt){var At=Ge(m,ut),Ut=At.text.length,hn,Xn;function wn(Tn,br){return hu(s,me(ut,Tn),"div",At,br)}function Rr(Tn,br,Jn){var Bn=Ug(s,At,null,Tn),Dn=br=="ltr"==(Jn=="after")?"left":"right",Cn=Jn=="after"?Bn.begin:Bn.end-(/\s/.test(At.text.charAt(Bn.end-1))?2:1);return wn(Cn,Dn)[Dn]}var _r=at(At,m.direction);return Rt(_r,_t||0,Tt??Ut,function(Tn,br,Jn,Bn){var Dn=Jn=="ltr",Cn=wn(Tn,Dn?"left":"right"),xr=wn(br-1,Dn?"right":"left"),Ra=_t==null&&Tn==0,_o=Tt==null&&br==Ut,tr=Bn==0,Bi=!_r||Bn==_r.length-1;if(xr.top-Cn.top<=3){var Gn=(z?Ra:_o)&&tr,xf=(z?_o:Ra)&&Bi,no=Gn?P:(Dn?Cn:xr).left,qo=xf?B:(Dn?xr:Cn).right;re(no,Cn.top,qo-no,Cn.bottom)}else{var Xo,fr,Ia,wf;Dn?(Xo=z&&Ra&&tr?P:Cn.left,fr=z?B:Rr(Tn,Jn,"before"),Ia=z?P:Rr(br,Jn,"after"),wf=z&&_o&&Bi?B:xr.right):(Xo=z?Rr(Tn,Jn,"before"):P,fr=!z&&Ra&&tr?B:Cn.right,Ia=!z&&_o&&Bi?P:xr.left,wf=z?Rr(br,Jn,"after"):B),re(Xo,Cn.top,fr-Xo,Cn.bottom),Cn.bottom<xr.top&&re(P,Cn.bottom,null,xr.top),re(Ia,xr.top,wf-Ia,xr.bottom)}(!hn||vu(Cn,hn)<0)&&(hn=Cn),vu(xr,hn)<0&&(hn=xr),(!Xn||vu(Cn,Xn)<0)&&(Xn=Cn),vu(xr,Xn)<0&&(Xn=xr)}),{start:hn,end:Xn}}var ye=c.from(),pe=c.to();if(ye.line==pe.line)ae(ye.line,ye.ch,pe.ch);else{var Ie=Ge(m,ye.line),We=Ge(m,pe.line),et=di(Ie)==di(We),lt=ae(ye.line,ye.ch,et?Ie.text.length+1:null).end,ht=ae(pe.line,et?0:null,pe.ch).start;et&&(lt.top<ht.top-2?(re(lt.right,lt.top,null,lt.bottom),re(P,ht.top,ht.left,ht.bottom)):re(lt.right,lt.top,ht.left-lt.right,lt.bottom)),lt.bottom<ht.top&&re(P,lt.bottom,null,ht.top)}v.appendChild(C)}function Gc(s){if(s.state.focused){var c=s.display;clearInterval(c.blinker);var v=!0;c.cursorDiv.style.visibility="",s.options.cursorBlinkRate>0?c.blinker=setInterval(function(){s.hasFocus()||Sa(s),c.cursorDiv.style.visibility=(v=!v)?"":"hidden"},s.options.cursorBlinkRate):s.options.cursorBlinkRate<0&&(c.cursorDiv.style.visibility="hidden")}}function Gg(s){s.hasFocus()||(s.display.input.focus(),s.state.focused||Kc(s))}function Yc(s){s.state.delayingBlurEvent=!0,setTimeout(function(){s.state.delayingBlurEvent&&(s.state.delayingBlurEvent=!1,s.state.focused&&Sa(s))},100)}function Kc(s,c){s.state.delayingBlurEvent&&!s.state.draggingText&&(s.state.delayingBlurEvent=!1),s.options.readOnly!="nocursor"&&(s.state.focused||(Qe(s,"focus",s,c),s.state.focused=!0,Me(s.display.wrapper,"CodeMirror-focused"),!s.curOp&&s.display.selForContextMenu!=s.doc.sel&&(s.display.input.reset(),f&&setTimeout(function(){return s.display.input.reset(!0)},20)),s.display.input.receivedFocus()),Gc(s))}function Sa(s,c){s.state.delayingBlurEvent||(s.state.focused&&(Qe(s,"blur",s,c),s.state.focused=!1,J(s.display.wrapper,"CodeMirror-focused")),clearInterval(s.display.blinker),setTimeout(function(){s.state.focused||(s.display.shift=!1)},150))}function gu(s){for(var c=s.display,v=c.lineDiv.offsetTop,p=Math.max(0,c.scroller.getBoundingClientRect().top),m=c.lineDiv.getBoundingClientRect().top,C=0,N=0;N<c.view.length;N++){var P=c.view[N],B=s.options.lineWrapping,z=void 0,re=0;if(!P.hidden){if(m+=P.line.height,u&&d<8){var ae=P.node.offsetTop+P.node.offsetHeight;z=ae-v,v=ae}else{var ye=P.node.getBoundingClientRect();z=ye.bottom-ye.top,!B&&P.text.firstChild&&(re=P.text.firstChild.getBoundingClientRect().right-ye.left-1)}var pe=P.line.height-z;if((pe>.005||pe<-.005)&&(m<p&&(C-=pe),Q(P.line,z),Yg(P.line),P.rest))for(var Ie=0;Ie<P.rest.length;Ie++)Yg(P.rest[Ie]);if(re>s.display.sizerWidth){var We=Math.ceil(re/wa(s.display));We>s.display.maxLineLength&&(s.display.maxLineLength=We,s.display.maxLine=P.line,s.display.maxLineChanged=!0)}}}Math.abs(C)>2&&(c.scroller.scrollTop+=C)}function Yg(s){if(s.widgets)for(var c=0;c<s.widgets.length;++c){var v=s.widgets[c],p=v.node.parentNode;p&&(v.height=p.offsetHeight)}}function mu(s,c,v){var p=v&&v.top!=null?Math.max(0,v.top):s.scroller.scrollTop;p=Math.floor(p-cu(s));var m=v&&v.bottom!=null?v.bottom:p+s.wrapper.clientHeight,C=X(c,p),N=X(c,m);if(v&&v.ensure){var P=v.ensure.from.line,B=v.ensure.to.line;P<C?(C=P,N=X(c,Zi(Ge(c,P))+s.wrapper.clientHeight)):Math.min(B,c.lastLine())>=N&&(C=X(c,Zi(Ge(c,B))-s.wrapper.clientHeight),N=B)}return{from:C,to:Math.max(N,C+1)}}function PS(s,c){if(!nt(s,"scrollCursorIntoView")){var v=s.display,p=v.sizer.getBoundingClientRect(),m=null,C=v.wrapper.ownerDocument;if(c.top+p.top<0?m=!0:c.bottom+p.top>(C.defaultView.innerHeight||C.documentElement.clientHeight)&&(m=!1),m!=null&&!_){var N=j("div","​",null,`position: absolute;
                         top: `+(c.top-v.viewOffset-cu(s.display))+`px;
                         height: `+(c.bottom-c.top+Ri(s)+v.barHeight)+`px;
                         left: `+c.left+"px; width: "+Math.max(2,c.right-c.left)+"px;");s.display.lineSpace.appendChild(N),N.scrollIntoView(m),s.display.lineSpace.removeChild(N)}}}function RS(s,c,v,p){p==null&&(p=0);var m;!s.options.lineWrapping&&c==v&&(v=c.sticky=="before"?me(c.line,c.ch+1,"before"):c,c=c.ch?me(c.line,c.sticky=="before"?c.ch-1:c.ch,"after"):c);for(var C=0;C<5;C++){var N=!1,P=ci(s,c),B=!v||v==c?P:ci(s,v);m={left:Math.min(P.left,B.left),top:Math.min(P.top,B.top)-p,right:Math.max(P.left,B.left),bottom:Math.max(P.bottom,B.bottom)+p};var z=Jc(s,m),re=s.doc.scrollTop,ae=s.doc.scrollLeft;if(z.scrollTop!=null&&(Hs(s,z.scrollTop),Math.abs(s.doc.scrollTop-re)>1&&(N=!0)),z.scrollLeft!=null&&(zo(s,z.scrollLeft),Math.abs(s.doc.scrollLeft-ae)>1&&(N=!0)),!N)break}return m}function IS(s,c){var v=Jc(s,c);v.scrollTop!=null&&Hs(s,v.scrollTop),v.scrollLeft!=null&&zo(s,v.scrollLeft)}function Jc(s,c){var v=s.display,p=xa(s.display);c.top<0&&(c.top=0);var m=s.curOp&&s.curOp.scrollTop!=null?s.curOp.scrollTop:v.scroller.scrollTop,C=jc(s),N={};c.bottom-c.top>C&&(c.bottom=c.top+C);var P=s.doc.height+Bc(v),B=c.top<p,z=c.bottom>P-p;if(c.top<m)N.scrollTop=B?0:c.top;else if(c.bottom>m+C){var re=Math.min(c.top,(z?P:c.bottom)-C);re!=m&&(N.scrollTop=re)}var ae=s.options.fixedGutter?0:v.gutters.offsetWidth,ye=s.curOp&&s.curOp.scrollLeft!=null?s.curOp.scrollLeft:v.scroller.scrollLeft-ae,pe=jo(s)-v.gutters.offsetWidth,Ie=c.right-c.left>pe;return Ie&&(c.right=c.left+pe),c.left<10?N.scrollLeft=0:c.left<ye?N.scrollLeft=Math.max(0,c.left+ae-(Ie?0:10)):c.right>pe+ye-3&&(N.scrollLeft=c.right+(Ie?0:10)-pe),N}function Zc(s,c){c!=null&&(yu(s),s.curOp.scrollTop=(s.curOp.scrollTop==null?s.doc.scrollTop:s.curOp.scrollTop)+c)}function Ea(s){yu(s);var c=s.getCursor();s.curOp.scrollToPos={from:c,to:c,margin:s.options.cursorScrollMargin}}function js(s,c,v){(c!=null||v!=null)&&yu(s),c!=null&&(s.curOp.scrollLeft=c),v!=null&&(s.curOp.scrollTop=v)}function BS(s,c){yu(s),s.curOp.scrollToPos=c}function yu(s){var c=s.curOp.scrollToPos;if(c){s.curOp.scrollToPos=null;var v=zg(s,c.from),p=zg(s,c.to);Kg(s,v,p,c.margin)}}function Kg(s,c,v,p){var m=Jc(s,{left:Math.min(c.left,v.left),top:Math.min(c.top,v.top)-p,right:Math.max(c.right,v.right),bottom:Math.max(c.bottom,v.bottom)+p});js(s,m.scrollLeft,m.scrollTop)}function Hs(s,c){Math.abs(s.doc.scrollTop-c)<2||(i||ef(s,{top:c}),Jg(s,c,!0),i&&ef(s),zs(s,100))}function Jg(s,c,v){c=Math.max(0,Math.min(s.display.scroller.scrollHeight-s.display.scroller.clientHeight,c)),!(s.display.scroller.scrollTop==c&&!v)&&(s.doc.scrollTop=c,s.display.scrollbars.setScrollTop(c),s.display.scroller.scrollTop!=c&&(s.display.scroller.scrollTop=c))}function zo(s,c,v,p){c=Math.max(0,Math.min(c,s.display.scroller.scrollWidth-s.display.scroller.clientWidth)),!((v?c==s.doc.scrollLeft:Math.abs(s.doc.scrollLeft-c)<2)&&!p)&&(s.doc.scrollLeft=c,nm(s),s.display.scroller.scrollLeft!=c&&(s.display.scroller.scrollLeft=c),s.display.scrollbars.setScrollLeft(c))}function $s(s){var c=s.display,v=c.gutters.offsetWidth,p=Math.round(s.doc.height+Bc(s.display));return{clientHeight:c.scroller.clientHeight,viewHeight:c.wrapper.clientHeight,scrollWidth:c.scroller.scrollWidth,clientWidth:c.scroller.clientWidth,viewWidth:c.wrapper.clientWidth,barLeft:s.options.fixedGutter?v:0,docHeight:p,scrollHeight:p+Ri(s)+c.barHeight,nativeBarWidth:c.nativeBarWidth,gutterWidth:v}}var Wo=function(s,c,v){this.cm=v;var p=this.vert=j("div",[j("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),m=this.horiz=j("div",[j("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");p.tabIndex=m.tabIndex=-1,s(p),s(m),Re(p,"scroll",function(){p.clientHeight&&c(p.scrollTop,"vertical")}),Re(m,"scroll",function(){m.clientWidth&&c(m.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,u&&d<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Wo.prototype.update=function(s){var c=s.scrollWidth>s.clientWidth+1,v=s.scrollHeight>s.clientHeight+1,p=s.nativeBarWidth;if(v){this.vert.style.display="block",this.vert.style.bottom=c?p+"px":"0";var m=s.viewHeight-(c?p:0);this.vert.firstChild.style.height=Math.max(0,s.scrollHeight-s.clientHeight+m)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(c){this.horiz.style.display="block",this.horiz.style.right=v?p+"px":"0",this.horiz.style.left=s.barLeft+"px";var C=s.viewWidth-s.barLeft-(v?p:0);this.horiz.firstChild.style.width=Math.max(0,s.scrollWidth-s.clientWidth+C)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&s.clientHeight>0&&(p==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:v?p:0,bottom:c?p:0}},Wo.prototype.setScrollLeft=function(s){this.horiz.scrollLeft!=s&&(this.horiz.scrollLeft=s),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Wo.prototype.setScrollTop=function(s){this.vert.scrollTop!=s&&(this.vert.scrollTop=s),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Wo.prototype.zeroWidthHack=function(){var s=M&&!b?"12px":"18px";this.horiz.style.height=this.vert.style.width=s,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new Pe,this.disableVert=new Pe},Wo.prototype.enableZeroWidthBar=function(s,c,v){s.style.visibility="";function p(){var m=s.getBoundingClientRect(),C=v=="vert"?document.elementFromPoint(m.right-1,(m.top+m.bottom)/2):document.elementFromPoint((m.right+m.left)/2,m.bottom-1);C!=s?s.style.visibility="hidden":c.set(1e3,p)}c.set(1e3,p)},Wo.prototype.clear=function(){var s=this.horiz.parentNode;s.removeChild(this.horiz),s.removeChild(this.vert)};var Fs=function(){};Fs.prototype.update=function(){return{bottom:0,right:0}},Fs.prototype.setScrollLeft=function(){},Fs.prototype.setScrollTop=function(){},Fs.prototype.clear=function(){};function Ca(s,c){c||(c=$s(s));var v=s.display.barWidth,p=s.display.barHeight;Zg(s,c);for(var m=0;m<4&&v!=s.display.barWidth||p!=s.display.barHeight;m++)v!=s.display.barWidth&&s.options.lineWrapping&&gu(s),Zg(s,$s(s)),v=s.display.barWidth,p=s.display.barHeight}function Zg(s,c){var v=s.display,p=v.scrollbars.update(c);v.sizer.style.paddingRight=(v.barWidth=p.right)+"px",v.sizer.style.paddingBottom=(v.barHeight=p.bottom)+"px",v.heightForcer.style.borderBottom=p.bottom+"px solid transparent",p.right&&p.bottom?(v.scrollbarFiller.style.display="block",v.scrollbarFiller.style.height=p.bottom+"px",v.scrollbarFiller.style.width=p.right+"px"):v.scrollbarFiller.style.display="",p.bottom&&s.options.coverGutterNextToScrollbar&&s.options.fixedGutter?(v.gutterFiller.style.display="block",v.gutterFiller.style.height=p.bottom+"px",v.gutterFiller.style.width=c.gutterWidth+"px"):v.gutterFiller.style.display=""}var Qg={native:Wo,null:Fs};function em(s){s.display.scrollbars&&(s.display.scrollbars.clear(),s.display.scrollbars.addClass&&J(s.display.wrapper,s.display.scrollbars.addClass)),s.display.scrollbars=new Qg[s.options.scrollbarStyle](function(c){s.display.wrapper.insertBefore(c,s.display.scrollbarFiller),Re(c,"mousedown",function(){s.state.focused&&setTimeout(function(){return s.display.input.focus()},0)}),c.setAttribute("cm-not-content","true")},function(c,v){v=="horizontal"?zo(s,c):Hs(s,c)},s),s.display.scrollbars.addClass&&Me(s.display.wrapper,s.display.scrollbars.addClass)}var jS=0;function Uo(s){s.curOp={cm:s,viewChanged:!1,startHeight:s.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++jS,markArrays:null},vS(s.curOp)}function Vo(s){var c=s.curOp;c&&mS(c,function(v){for(var p=0;p<v.ops.length;p++)v.ops[p].cm.curOp=null;HS(v)})}function HS(s){for(var c=s.ops,v=0;v<c.length;v++)$S(c[v]);for(var p=0;p<c.length;p++)FS(c[p]);for(var m=0;m<c.length;m++)zS(c[m]);for(var C=0;C<c.length;C++)WS(c[C]);for(var N=0;N<c.length;N++)US(c[N])}function $S(s){var c=s.cm,v=c.display;qS(c),s.updateMaxLine&&Rc(c),s.mustUpdate=s.viewChanged||s.forceUpdate||s.scrollTop!=null||s.scrollToPos&&(s.scrollToPos.from.line<v.viewFrom||s.scrollToPos.to.line>=v.viewTo)||v.maxLineChanged&&c.options.lineWrapping,s.update=s.mustUpdate&&new _u(c,s.mustUpdate&&{top:s.scrollTop,ensure:s.scrollToPos},s.forceUpdate)}function FS(s){s.updatedDisplay=s.mustUpdate&&Qc(s.cm,s.update)}function zS(s){var c=s.cm,v=c.display;s.updatedDisplay&&gu(c),s.barMeasure=$s(c),v.maxLineChanged&&!c.options.lineWrapping&&(s.adjustWidthTo=Pg(c,v.maxLine,v.maxLine.text.length).left+3,c.display.sizerWidth=s.adjustWidthTo,s.barMeasure.scrollWidth=Math.max(v.scroller.clientWidth,v.sizer.offsetLeft+s.adjustWidthTo+Ri(c)+c.display.barWidth),s.maxScrollLeft=Math.max(0,v.sizer.offsetLeft+s.adjustWidthTo-jo(c))),(s.updatedDisplay||s.selectionChanged)&&(s.preparedSelection=v.input.prepareSelection())}function WS(s){var c=s.cm;s.adjustWidthTo!=null&&(c.display.sizer.style.minWidth=s.adjustWidthTo+"px",s.maxScrollLeft<c.doc.scrollLeft&&zo(c,Math.min(c.display.scroller.scrollLeft,s.maxScrollLeft),!0),c.display.maxLineChanged=!1);var v=s.focus&&s.focus==rt(de(c));s.preparedSelection&&c.display.input.showSelection(s.preparedSelection,v),(s.updatedDisplay||s.startHeight!=c.doc.height)&&Ca(c,s.barMeasure),s.updatedDisplay&&nf(c,s.barMeasure),s.selectionChanged&&Gc(c),c.state.focused&&s.updateInput&&c.display.input.reset(s.typing),v&&Gg(s.cm)}function US(s){var c=s.cm,v=c.display,p=c.doc;if(s.updatedDisplay&&tm(c,s.update),v.wheelStartX!=null&&(s.scrollTop!=null||s.scrollLeft!=null||s.scrollToPos)&&(v.wheelStartX=v.wheelStartY=null),s.scrollTop!=null&&Jg(c,s.scrollTop,s.forceScroll),s.scrollLeft!=null&&zo(c,s.scrollLeft,!0,!0),s.scrollToPos){var m=RS(c,Bt(p,s.scrollToPos.from),Bt(p,s.scrollToPos.to),s.scrollToPos.margin);PS(c,m)}var C=s.maybeHiddenMarkers,N=s.maybeUnhiddenMarkers;if(C)for(var P=0;P<C.length;++P)C[P].lines.length||Qe(C[P],"hide");if(N)for(var B=0;B<N.length;++B)N[B].lines.length&&Qe(N[B],"unhide");v.wrapper.offsetHeight&&(p.scrollTop=c.display.scroller.scrollTop),s.changeObjs&&Qe(c,"changes",c,s.changeObjs),s.update&&s.update.finish()}function Pr(s,c){if(s.curOp)return c();Uo(s);try{return c()}finally{Vo(s)}}function Vn(s,c){return function(){if(s.curOp)return c.apply(s,arguments);Uo(s);try{return c.apply(s,arguments)}finally{Vo(s)}}}function cr(s){return function(){if(this.curOp)return s.apply(this,arguments);Uo(this);try{return s.apply(this,arguments)}finally{Vo(this)}}}function qn(s){return function(){var c=this.cm;if(!c||c.curOp)return s.apply(this,arguments);Uo(c);try{return s.apply(this,arguments)}finally{Vo(c)}}}function zs(s,c){s.doc.highlightFrontier<s.display.viewTo&&s.state.highlight.set(c,Y(VS,s))}function VS(s){var c=s.doc;if(!(c.highlightFrontier>=s.display.viewTo)){var v=+new Date+s.options.workTime,p=uo(s,c.highlightFrontier),m=[];c.iter(p.line,Math.min(c.first+c.size,s.display.viewTo+500),function(C){if(p.line>=s.display.viewFrom){var N=C.styles,P=C.text.length>s.options.maxHighlightLength?Z(c.mode,p.state):null,B=Vr(s,C,p,!0);P&&(p.state=P),C.styles=B.styles;var z=C.styleClasses,re=B.classes;re?C.styleClasses=re:z&&(C.styleClasses=null);for(var ae=!N||N.length!=C.styles.length||z!=re&&(!z||!re||z.bgClass!=re.bgClass||z.textClass!=re.textClass),ye=0;!ae&&ye<N.length;++ye)ae=N[ye]!=C.styles[ye];ae&&m.push(p.line),C.stateAfter=p.save(),p.nextLine()}else C.text.length<=s.options.maxHighlightLength&&Mc(s,C.text,p),C.stateAfter=p.line%5==0?p.save():null,p.nextLine();if(+new Date>v)return zs(s,s.options.workDelay),!0}),c.highlightFrontier=p.line,c.modeFrontier=Math.max(c.modeFrontier,p.line),m.length&&Pr(s,function(){for(var C=0;C<m.length;C++)fo(s,m[C],"text")})}}var _u=function(s,c,v){var p=s.display;this.viewport=c,this.visible=mu(p,s.doc,c),this.editorIsHidden=!p.wrapper.offsetWidth,this.wrapperHeight=p.wrapper.clientHeight,this.wrapperWidth=p.wrapper.clientWidth,this.oldDisplayWidth=jo(s),this.force=v,this.dims=Uc(s),this.events=[]};_u.prototype.signal=function(s,c){xe(s,c)&&this.events.push(arguments)},_u.prototype.finish=function(){for(var s=0;s<this.events.length;s++)Qe.apply(null,this.events[s])};function qS(s){var c=s.display;!c.scrollbarsClipped&&c.scroller.offsetWidth&&(c.nativeBarWidth=c.scroller.offsetWidth-c.scroller.clientWidth,c.heightForcer.style.height=Ri(s)+"px",c.sizer.style.marginBottom=-c.nativeBarWidth+"px",c.sizer.style.borderRightWidth=Ri(s)+"px",c.scrollbarsClipped=!0)}function XS(s){if(s.hasFocus())return null;var c=rt(de(s));if(!c||!_e(s.display.lineDiv,c))return null;var v={activeElt:c};if(window.getSelection){var p=W(s).getSelection();p.anchorNode&&p.extend&&_e(s.display.lineDiv,p.anchorNode)&&(v.anchorNode=p.anchorNode,v.anchorOffset=p.anchorOffset,v.focusNode=p.focusNode,v.focusOffset=p.focusOffset)}return v}function GS(s){if(!(!s||!s.activeElt||s.activeElt==rt(le(s.activeElt)))&&(s.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(s.activeElt.nodeName)&&s.anchorNode&&_e(document.body,s.anchorNode)&&_e(document.body,s.focusNode))){var c=s.activeElt.ownerDocument,v=c.defaultView.getSelection(),p=c.createRange();p.setEnd(s.anchorNode,s.anchorOffset),p.collapse(!1),v.removeAllRanges(),v.addRange(p),v.extend(s.focusNode,s.focusOffset)}}function Qc(s,c){var v=s.display,p=s.doc;if(c.editorIsHidden)return ho(s),!1;if(!c.force&&c.visible.from>=v.viewFrom&&c.visible.to<=v.viewTo&&(v.updateLineNumbers==null||v.updateLineNumbers>=v.viewTo)&&v.renderedView==v.view&&qg(s)==0)return!1;rm(s)&&(ho(s),c.dims=Uc(s));var m=p.first+p.size,C=Math.max(c.visible.from-s.options.viewportMargin,p.first),N=Math.min(m,c.visible.to+s.options.viewportMargin);v.viewFrom<C&&C-v.viewFrom<20&&(C=Math.max(p.first,v.viewFrom)),v.viewTo>N&&v.viewTo-N<20&&(N=Math.min(m,v.viewTo)),Ji&&(C=Lc(s.doc,C),N=wg(s.doc,N));var P=C!=v.viewFrom||N!=v.viewTo||v.lastWrapHeight!=c.wrapperHeight||v.lastWrapWidth!=c.wrapperWidth;DS(s,C,N),v.viewOffset=Zi(Ge(s.doc,v.viewFrom)),s.display.mover.style.top=v.viewOffset+"px";var B=qg(s);if(!P&&B==0&&!c.force&&v.renderedView==v.view&&(v.updateLineNumbers==null||v.updateLineNumbers>=v.viewTo))return!1;var z=XS(s);return B>4&&(v.lineDiv.style.display="none"),YS(s,v.updateLineNumbers,c.dims),B>4&&(v.lineDiv.style.display=""),v.renderedView=v.view,GS(z),D(v.cursorDiv),D(v.selectionDiv),v.gutters.style.height=v.sizer.style.minHeight=0,P&&(v.lastWrapHeight=c.wrapperHeight,v.lastWrapWidth=c.wrapperWidth,zs(s,400)),v.updateLineNumbers=null,!0}function tm(s,c){for(var v=c.viewport,p=!0;;p=!1){if(!p||!s.options.lineWrapping||c.oldDisplayWidth==jo(s)){if(v&&v.top!=null&&(v={top:Math.min(s.doc.height+Bc(s.display)-jc(s),v.top)}),c.visible=mu(s.display,s.doc,v),c.visible.from>=s.display.viewFrom&&c.visible.to<=s.display.viewTo)break}else p&&(c.visible=mu(s.display,s.doc,v));if(!Qc(s,c))break;gu(s);var m=$s(s);Bs(s),Ca(s,m),nf(s,m),c.force=!1}c.signal(s,"update",s),(s.display.viewFrom!=s.display.reportedViewFrom||s.display.viewTo!=s.display.reportedViewTo)&&(c.signal(s,"viewportChange",s,s.display.viewFrom,s.display.viewTo),s.display.reportedViewFrom=s.display.viewFrom,s.display.reportedViewTo=s.display.viewTo)}function ef(s,c){var v=new _u(s,c);if(Qc(s,v)){gu(s),tm(s,v);var p=$s(s);Bs(s),Ca(s,p),nf(s,p),v.finish()}}function YS(s,c,v){var p=s.display,m=s.options.lineNumbers,C=p.lineDiv,N=C.firstChild;function P(Ie){var We=Ie.nextSibling;return f&&M&&s.display.currentWheelTarget==Ie?Ie.style.display="none":Ie.parentNode.removeChild(Ie),We}for(var B=p.view,z=p.viewFrom,re=0;re<B.length;re++){var ae=B[re];if(!ae.hidden)if(!ae.node||ae.node.parentNode!=C){var ye=wS(s,ae,z,v);C.insertBefore(ye,N)}else{for(;N!=ae.node;)N=P(N);var pe=m&&c!=null&&c<=z&&ae.lineNumber;ae.changes&&(Le(ae.changes,"gutter")>-1&&(pe=!1),Og(s,ae,z,v)),pe&&(D(ae.lineNumber),ae.lineNumber.appendChild(document.createTextNode(Oe(s.options,z)))),N=ae.node.nextSibling}z+=ae.size}for(;N;)N=P(N)}function tf(s){var c=s.gutters.offsetWidth;s.sizer.style.marginLeft=c+"px",Un(s,"gutterChanged",s)}function nf(s,c){s.display.sizer.style.minHeight=c.docHeight+"px",s.display.heightForcer.style.top=c.docHeight+"px",s.display.gutters.style.height=c.docHeight+s.display.barHeight+Ri(s)+"px"}function nm(s){var c=s.display,v=c.view;if(!(!c.alignWidgets&&(!c.gutters.firstChild||!s.options.fixedGutter))){for(var p=Vc(c)-c.scroller.scrollLeft+s.doc.scrollLeft,m=c.gutters.offsetWidth,C=p+"px",N=0;N<v.length;N++)if(!v[N].hidden){s.options.fixedGutter&&(v[N].gutter&&(v[N].gutter.style.left=C),v[N].gutterBackground&&(v[N].gutterBackground.style.left=C));var P=v[N].alignable;if(P)for(var B=0;B<P.length;B++)P[B].style.left=C}s.options.fixedGutter&&(c.gutters.style.left=p+m+"px")}}function rm(s){if(!s.options.lineNumbers)return!1;var c=s.doc,v=Oe(s.options,c.first+c.size-1),p=s.display;if(v.length!=p.lineNumChars){var m=p.measure.appendChild(j("div",[j("div",v)],"CodeMirror-linenumber CodeMirror-gutter-elt")),C=m.firstChild.offsetWidth,N=m.offsetWidth-C;return p.lineGutter.style.width="",p.lineNumInnerWidth=Math.max(C,p.lineGutter.offsetWidth-N)+1,p.lineNumWidth=p.lineNumInnerWidth+N,p.lineNumChars=p.lineNumInnerWidth?v.length:-1,p.lineGutter.style.width=p.lineNumWidth+"px",tf(s.display),!0}return!1}function rf(s,c){for(var v=[],p=!1,m=0;m<s.length;m++){var C=s[m],N=null;if(typeof C!="string"&&(N=C.style,C=C.className),C=="CodeMirror-linenumbers")if(c)p=!0;else continue;v.push({className:C,style:N})}return c&&!p&&v.push({className:"CodeMirror-linenumbers",style:null}),v}function im(s){var c=s.gutters,v=s.gutterSpecs;D(c),s.lineGutter=null;for(var p=0;p<v.length;++p){var m=v[p],C=m.className,N=m.style,P=c.appendChild(j("div",null,"CodeMirror-gutter "+C));N&&(P.style.cssText=N),C=="CodeMirror-linenumbers"&&(s.lineGutter=P,P.style.width=(s.lineNumWidth||1)+"px")}c.style.display=v.length?"":"none",tf(s)}function Ws(s){im(s.display),mr(s),nm(s)}function KS(s,c,v,p){var m=this;this.input=v,m.scrollbarFiller=j("div",null,"CodeMirror-scrollbar-filler"),m.scrollbarFiller.setAttribute("cm-not-content","true"),m.gutterFiller=j("div",null,"CodeMirror-gutter-filler"),m.gutterFiller.setAttribute("cm-not-content","true"),m.lineDiv=fe("div",null,"CodeMirror-code"),m.selectionDiv=j("div",null,null,"position: relative; z-index: 1"),m.cursorDiv=j("div",null,"CodeMirror-cursors"),m.measure=j("div",null,"CodeMirror-measure"),m.lineMeasure=j("div",null,"CodeMirror-measure"),m.lineSpace=fe("div",[m.measure,m.lineMeasure,m.selectionDiv,m.cursorDiv,m.lineDiv],null,"position: relative; outline: none");var C=fe("div",[m.lineSpace],"CodeMirror-lines");m.mover=j("div",[C],null,"position: relative"),m.sizer=j("div",[m.mover],"CodeMirror-sizer"),m.sizerWidth=null,m.heightForcer=j("div",null,null,"position: absolute; height: "+He+"px; width: 1px;"),m.gutters=j("div",null,"CodeMirror-gutters"),m.lineGutter=null,m.scroller=j("div",[m.sizer,m.heightForcer,m.gutters],"CodeMirror-scroll"),m.scroller.setAttribute("tabIndex","-1"),m.wrapper=j("div",[m.scrollbarFiller,m.gutterFiller,m.scroller],"CodeMirror"),g&&y>=105&&(m.wrapper.style.clipPath="inset(0px)"),m.wrapper.setAttribute("translate","no"),u&&d<8&&(m.gutters.style.zIndex=-1,m.scroller.style.paddingRight=0),!f&&!(i&&O)&&(m.scroller.draggable=!0),s&&(s.appendChild?s.appendChild(m.wrapper):s(m.wrapper)),m.viewFrom=m.viewTo=c.first,m.reportedViewFrom=m.reportedViewTo=c.first,m.view=[],m.renderedView=null,m.externalMeasured=null,m.viewOffset=0,m.lastWrapHeight=m.lastWrapWidth=0,m.updateLineNumbers=null,m.nativeBarWidth=m.barHeight=m.barWidth=0,m.scrollbarsClipped=!1,m.lineNumWidth=m.lineNumInnerWidth=m.lineNumChars=null,m.alignWidgets=!1,m.cachedCharWidth=m.cachedTextHeight=m.cachedPaddingH=null,m.maxLine=null,m.maxLineLength=0,m.maxLineChanged=!1,m.wheelDX=m.wheelDY=m.wheelStartX=m.wheelStartY=null,m.shift=!1,m.selForContextMenu=null,m.activeTouch=null,m.gutterSpecs=rf(p.gutters,p.lineNumbers),im(m),v.init(m)}var bu=0,eo=null;u?eo=-.53:i?eo=15:g?eo=-.7:x&&(eo=-1/3);function om(s){var c=s.wheelDeltaX,v=s.wheelDeltaY;return c==null&&s.detail&&s.axis==s.HORIZONTAL_AXIS&&(c=s.detail),v==null&&s.detail&&s.axis==s.VERTICAL_AXIS?v=s.detail:v==null&&(v=s.wheelDelta),{x:c,y:v}}function JS(s){var c=om(s);return c.x*=eo,c.y*=eo,c}function am(s,c){g&&y==102&&(s.display.chromeScrollHack==null?s.display.sizer.style.pointerEvents="none":clearTimeout(s.display.chromeScrollHack),s.display.chromeScrollHack=setTimeout(function(){s.display.chromeScrollHack=null,s.display.sizer.style.pointerEvents=""},100));var v=om(c),p=v.x,m=v.y,C=eo;c.deltaMode===0&&(p=c.deltaX,m=c.deltaY,C=1);var N=s.display,P=N.scroller,B=P.scrollWidth>P.clientWidth,z=P.scrollHeight>P.clientHeight;if(p&&B||m&&z){if(m&&M&&f){e:for(var re=c.target,ae=N.view;re!=P;re=re.parentNode)for(var ye=0;ye<ae.length;ye++)if(ae[ye].node==re){s.display.currentWheelTarget=re;break e}}if(p&&!i&&!w&&C!=null){m&&z&&Hs(s,Math.max(0,P.scrollTop+m*C)),zo(s,Math.max(0,P.scrollLeft+p*C)),(!m||m&&z)&&gt(c),N.wheelStartX=null;return}if(m&&C!=null){var pe=m*C,Ie=s.doc.scrollTop,We=Ie+N.wrapper.clientHeight;pe<0?Ie=Math.max(0,Ie+pe-50):We=Math.min(s.doc.height,We+pe+50),ef(s,{top:Ie,bottom:We})}bu<20&&c.deltaMode!==0&&(N.wheelStartX==null?(N.wheelStartX=P.scrollLeft,N.wheelStartY=P.scrollTop,N.wheelDX=p,N.wheelDY=m,setTimeout(function(){if(N.wheelStartX!=null){var et=P.scrollLeft-N.wheelStartX,lt=P.scrollTop-N.wheelStartY,ht=lt&&N.wheelDY&&lt/N.wheelDY||et&&N.wheelDX&&et/N.wheelDX;N.wheelStartX=N.wheelStartY=null,ht&&(eo=(eo*bu+ht)/(bu+1),++bu)}},200)):(N.wheelDX+=p,N.wheelDY+=m))}}var qr=function(s,c){this.ranges=s,this.primIndex=c};qr.prototype.primary=function(){return this.ranges[this.primIndex]},qr.prototype.equals=function(s){if(s==this)return!0;if(s.primIndex!=this.primIndex||s.ranges.length!=this.ranges.length)return!1;for(var c=0;c<this.ranges.length;c++){var v=this.ranges[c],p=s.ranges[c];if(!it(v.anchor,p.anchor)||!it(v.head,p.head))return!1}return!0},qr.prototype.deepCopy=function(){for(var s=[],c=0;c<this.ranges.length;c++)s[c]=new sn(bt(this.ranges[c].anchor),bt(this.ranges[c].head));return new qr(s,this.primIndex)},qr.prototype.somethingSelected=function(){for(var s=0;s<this.ranges.length;s++)if(!this.ranges[s].empty())return!0;return!1},qr.prototype.contains=function(s,c){c||(c=s);for(var v=0;v<this.ranges.length;v++){var p=this.ranges[v];if(we(c,p.from())>=0&&we(s,p.to())<=0)return v}return-1};var sn=function(s,c){this.anchor=s,this.head=c};sn.prototype.from=function(){return Mn(this.anchor,this.head)},sn.prototype.to=function(){return Pt(this.anchor,this.head)},sn.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function fi(s,c,v){var p=s&&s.options.selectionsMayTouch,m=c[v];c.sort(function(ye,pe){return we(ye.from(),pe.from())}),v=Le(c,m);for(var C=1;C<c.length;C++){var N=c[C],P=c[C-1],B=we(P.to(),N.from());if(p&&!N.empty()?B>0:B>=0){var z=Mn(P.from(),N.from()),re=Pt(P.to(),N.to()),ae=P.empty()?N.from()==N.head:P.from()==P.head;C<=v&&--v,c.splice(--C,2,new sn(ae?re:z,ae?z:re))}}return new qr(c,v)}function po(s,c){return new qr([new sn(s,c||s)],0)}function vo(s){return s.text?me(s.from.line+s.text.length-1,A(s.text).length+(s.text.length==1?s.from.ch:0)):s.to}function sm(s,c){if(we(s,c.from)<0)return s;if(we(s,c.to)<=0)return vo(c);var v=s.line+c.text.length-(c.to.line-c.from.line)-1,p=s.ch;return s.line==c.to.line&&(p+=vo(c).ch-c.to.ch),me(v,p)}function of(s,c){for(var v=[],p=0;p<s.sel.ranges.length;p++){var m=s.sel.ranges[p];v.push(new sn(sm(m.anchor,c),sm(m.head,c)))}return fi(s.cm,v,s.sel.primIndex)}function lm(s,c,v){return s.line==c.line?me(v.line,s.ch-c.ch+v.ch):me(v.line+(s.line-c.line),s.ch)}function ZS(s,c,v){for(var p=[],m=me(s.first,0),C=m,N=0;N<c.length;N++){var P=c[N],B=lm(P.from,m,C),z=lm(vo(P),m,C);if(m=P.to,C=z,v=="around"){var re=s.sel.ranges[N],ae=we(re.head,re.anchor)<0;p[N]=new sn(ae?z:B,ae?B:z)}else p[N]=new sn(B,B)}return new qr(p,s.sel.primIndex)}function af(s){s.doc.mode=Zr(s.options,s.doc.modeOption),Us(s)}function Us(s){s.doc.iter(function(c){c.stateAfter&&(c.stateAfter=null),c.styles&&(c.styles=null)}),s.doc.modeFrontier=s.doc.highlightFrontier=s.doc.first,zs(s,100),s.state.modeGen++,s.curOp&&mr(s)}function um(s,c){return c.from.ch==0&&c.to.ch==0&&A(c.text)==""&&(!s.cm||s.cm.options.wholeLineUpdateBefore)}function sf(s,c,v,p){function m(ht){return v?v[ht]:null}function C(ht,ut,_t){aS(ht,ut,_t,p),Un(ht,"change",ht,c)}function N(ht,ut){for(var _t=[],Tt=ht;Tt<ut;++Tt)_t.push(new ya(z[Tt],m(Tt),p));return _t}var P=c.from,B=c.to,z=c.text,re=Ge(s,P.line),ae=Ge(s,B.line),ye=A(z),pe=m(z.length-1),Ie=B.line-P.line;if(c.full)s.insert(0,N(0,z.length)),s.remove(z.length,s.size-z.length);else if(um(s,c)){var We=N(0,z.length-1);C(ae,ae.text,pe),Ie&&s.remove(P.line,Ie),We.length&&s.insert(P.line,We)}else if(re==ae)if(z.length==1)C(re,re.text.slice(0,P.ch)+ye+re.text.slice(B.ch),pe);else{var et=N(1,z.length-1);et.push(new ya(ye+re.text.slice(B.ch),pe,p)),C(re,re.text.slice(0,P.ch)+z[0],m(0)),s.insert(P.line+1,et)}else if(z.length==1)C(re,re.text.slice(0,P.ch)+z[0]+ae.text.slice(B.ch),m(0)),s.remove(P.line+1,Ie);else{C(re,re.text.slice(0,P.ch)+z[0],m(0)),C(ae,ye+ae.text.slice(B.ch),pe);var lt=N(1,z.length-1);Ie>1&&s.remove(P.line+1,Ie-1),s.insert(P.line+1,lt)}Un(s,"change",s,c)}function go(s,c,v){function p(m,C,N){if(m.linked)for(var P=0;P<m.linked.length;++P){var B=m.linked[P];if(B.doc!=C){var z=N&&B.sharedHist;v&&!z||(c(B.doc,z),p(B.doc,m,z))}}}p(s,null,!0)}function dm(s,c){if(c.cm)throw new Error("This document is already in use.");s.doc=c,c.cm=s,qc(s),af(s),cm(s),s.options.direction=c.direction,s.options.lineWrapping||Rc(s),s.options.mode=c.modeOption,mr(s)}function cm(s){(s.doc.direction=="rtl"?Me:J)(s.display.lineDiv,"CodeMirror-rtl")}function QS(s){Pr(s,function(){cm(s),mr(s)})}function xu(s){this.done=[],this.undone=[],this.undoDepth=s?s.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=s?s.maxGeneration:1}function lf(s,c){var v={from:bt(c.from),to:vo(c),text:zt(s,c.from,c.to)};return pm(s,v,c.from.line,c.to.line+1),go(s,function(p){return pm(p,v,c.from.line,c.to.line+1)},!0),v}function fm(s){for(;s.length;){var c=A(s);if(c.ranges)s.pop();else break}}function eE(s,c){if(c)return fm(s.done),A(s.done);if(s.done.length&&!A(s.done).ranges)return A(s.done);if(s.done.length>1&&!s.done[s.done.length-2].ranges)return s.done.pop(),A(s.done)}function hm(s,c,v,p){var m=s.history;m.undone.length=0;var C=+new Date,N,P;if((m.lastOp==p||m.lastOrigin==c.origin&&c.origin&&(c.origin.charAt(0)=="+"&&m.lastModTime>C-(s.cm?s.cm.options.historyEventDelay:500)||c.origin.charAt(0)=="*"))&&(N=eE(m,m.lastOp==p)))P=A(N.changes),we(c.from,c.to)==0&&we(c.from,P.to)==0?P.to=vo(c):N.changes.push(lf(s,c));else{var B=A(m.done);for((!B||!B.ranges)&&wu(s.sel,m.done),N={changes:[lf(s,c)],generation:m.generation},m.done.push(N);m.done.length>m.undoDepth;)m.done.shift(),m.done[0].ranges||m.done.shift()}m.done.push(v),m.generation=++m.maxGeneration,m.lastModTime=m.lastSelTime=C,m.lastOp=m.lastSelOp=p,m.lastOrigin=m.lastSelOrigin=c.origin,P||Qe(s,"historyAdded")}function tE(s,c,v,p){var m=c.charAt(0);return m=="*"||m=="+"&&v.ranges.length==p.ranges.length&&v.somethingSelected()==p.somethingSelected()&&new Date-s.history.lastSelTime<=(s.cm?s.cm.options.historyEventDelay:500)}function nE(s,c,v,p){var m=s.history,C=p&&p.origin;v==m.lastSelOp||C&&m.lastSelOrigin==C&&(m.lastModTime==m.lastSelTime&&m.lastOrigin==C||tE(s,C,A(m.done),c))?m.done[m.done.length-1]=c:wu(c,m.done),m.lastSelTime=+new Date,m.lastSelOrigin=C,m.lastSelOp=v,p&&p.clearRedo!==!1&&fm(m.undone)}function wu(s,c){var v=A(c);v&&v.ranges&&v.equals(s)||c.push(s)}function pm(s,c,v,p){var m=c["spans_"+s.id],C=0;s.iter(Math.max(s.first,v),Math.min(s.first+s.size,p),function(N){N.markedSpans&&((m||(m=c["spans_"+s.id]={}))[C]=N.markedSpans),++C})}function rE(s){if(!s)return null;for(var c,v=0;v<s.length;++v)s[v].marker.explicitlyCleared?c||(c=s.slice(0,v)):c&&c.push(s[v]);return c?c.length?c:null:s}function iE(s,c){var v=c["spans_"+s.id];if(!v)return null;for(var p=[],m=0;m<c.text.length;++m)p.push(rE(v[m]));return p}function vm(s,c){var v=iE(s,c),p=Tc(s,c);if(!v)return p;if(!p)return v;for(var m=0;m<v.length;++m){var C=v[m],N=p[m];if(C&&N)e:for(var P=0;P<N.length;++P){for(var B=N[P],z=0;z<C.length;++z)if(C[z].marker==B.marker)continue e;C.push(B)}else N&&(v[m]=N)}return v}function ka(s,c,v){for(var p=[],m=0;m<s.length;++m){var C=s[m];if(C.ranges){p.push(v?qr.prototype.deepCopy.call(C):C);continue}var N=C.changes,P=[];p.push({changes:P});for(var B=0;B<N.length;++B){var z=N[B],re=void 0;if(P.push({from:z.from,to:z.to,text:z.text}),c)for(var ae in z)(re=ae.match(/^spans_(\d+)$/))&&Le(c,Number(re[1]))>-1&&(A(P)[ae]=z[ae],delete z[ae])}}return p}function uf(s,c,v,p){if(p){var m=s.anchor;if(v){var C=we(c,m)<0;C!=we(v,m)<0?(m=c,c=v):C!=we(c,v)<0&&(c=v)}return new sn(m,c)}else return new sn(v||c,c)}function Su(s,c,v,p,m){m==null&&(m=s.cm&&(s.cm.display.shift||s.extend)),er(s,new qr([uf(s.sel.primary(),c,v,m)],0),p)}function gm(s,c,v){for(var p=[],m=s.cm&&(s.cm.display.shift||s.extend),C=0;C<s.sel.ranges.length;C++)p[C]=uf(s.sel.ranges[C],c[C],null,m);var N=fi(s.cm,p,s.sel.primIndex);er(s,N,v)}function df(s,c,v,p){var m=s.sel.ranges.slice(0);m[c]=v,er(s,fi(s.cm,m,s.sel.primIndex),p)}function mm(s,c,v,p){er(s,po(c,v),p)}function oE(s,c,v){var p={ranges:c.ranges,update:function(m){this.ranges=[];for(var C=0;C<m.length;C++)this.ranges[C]=new sn(Bt(s,m[C].anchor),Bt(s,m[C].head))},origin:v&&v.origin};return Qe(s,"beforeSelectionChange",s,p),s.cm&&Qe(s.cm,"beforeSelectionChange",s.cm,p),p.ranges!=c.ranges?fi(s.cm,p.ranges,p.ranges.length-1):c}function ym(s,c,v){var p=s.history.done,m=A(p);m&&m.ranges?(p[p.length-1]=c,Eu(s,c,v)):er(s,c,v)}function er(s,c,v){Eu(s,c,v),nE(s,s.sel,s.cm?s.cm.curOp.id:NaN,v)}function Eu(s,c,v){(xe(s,"beforeSelectionChange")||s.cm&&xe(s.cm,"beforeSelectionChange"))&&(c=oE(s,c,v));var p=v&&v.bias||(we(c.primary().head,s.sel.primary().head)<0?-1:1);_m(s,xm(s,c,p,!0)),!(v&&v.scroll===!1)&&s.cm&&s.cm.getOption("readOnly")!="nocursor"&&Ea(s.cm)}function _m(s,c){c.equals(s.sel)||(s.sel=c,s.cm&&(s.cm.curOp.updateInput=1,s.cm.curOp.selectionChanged=!0,St(s.cm)),Un(s,"cursorActivity",s))}function bm(s){_m(s,xm(s,s.sel,null,!1))}function xm(s,c,v,p){for(var m,C=0;C<c.ranges.length;C++){var N=c.ranges[C],P=c.ranges.length==s.sel.ranges.length&&s.sel.ranges[C],B=Cu(s,N.anchor,P&&P.anchor,v,p),z=N.head==N.anchor?B:Cu(s,N.head,P&&P.head,v,p);(m||B!=N.anchor||z!=N.head)&&(m||(m=c.ranges.slice(0,C)),m[C]=new sn(B,z))}return m?fi(s.cm,m,c.primIndex):c}function Oa(s,c,v,p,m){var C=Ge(s,c.line);if(C.markedSpans)for(var N=0;N<C.markedSpans.length;++N){var P=C.markedSpans[N],B=P.marker,z="selectLeft"in B?!B.selectLeft:B.inclusiveLeft,re="selectRight"in B?!B.selectRight:B.inclusiveRight;if((P.from==null||(z?P.from<=c.ch:P.from<c.ch))&&(P.to==null||(re?P.to>=c.ch:P.to>c.ch))){if(m&&(Qe(B,"beforeCursorEnter"),B.explicitlyCleared))if(C.markedSpans){--N;continue}else break;if(!B.atomic)continue;if(v){var ae=B.find(p<0?1:-1),ye=void 0;if((p<0?re:z)&&(ae=wm(s,ae,-p,ae&&ae.line==c.line?C:null)),ae&&ae.line==c.line&&(ye=we(ae,v))&&(p<0?ye<0:ye>0))return Oa(s,ae,c,p,m)}var pe=B.find(p<0?-1:1);return(p<0?z:re)&&(pe=wm(s,pe,p,pe.line==c.line?C:null)),pe?Oa(s,pe,c,p,m):null}}return c}function Cu(s,c,v,p,m){var C=p||1,N=Oa(s,c,v,C,m)||!m&&Oa(s,c,v,C,!0)||Oa(s,c,v,-C,m)||!m&&Oa(s,c,v,-C,!0);return N||(s.cantEdit=!0,me(s.first,0))}function wm(s,c,v,p){return v<0&&c.ch==0?c.line>s.first?Bt(s,me(c.line-1)):null:v>0&&c.ch==(p||Ge(s,c.line)).text.length?c.line<s.first+s.size-1?me(c.line+1,0):null:new me(c.line,c.ch+v)}function Sm(s){s.setSelection(me(s.firstLine(),0),me(s.lastLine()),Ke)}function Em(s,c,v){var p={canceled:!1,from:c.from,to:c.to,text:c.text,origin:c.origin,cancel:function(){return p.canceled=!0}};return v&&(p.update=function(m,C,N,P){m&&(p.from=Bt(s,m)),C&&(p.to=Bt(s,C)),N&&(p.text=N),P!==void 0&&(p.origin=P)}),Qe(s,"beforeChange",s,p),s.cm&&Qe(s.cm,"beforeChange",s.cm,p),p.canceled?(s.cm&&(s.cm.curOp.updateInput=2),null):{from:p.from,to:p.to,text:p.text,origin:p.origin}}function Na(s,c,v){if(s.cm){if(!s.cm.curOp)return Vn(s.cm,Na)(s,c,v);if(s.cm.state.suppressEdits)return}if(!((xe(s,"beforeChange")||s.cm&&xe(s.cm,"beforeChange"))&&(c=Em(s,c,!0),!c))){var p=vg&&!v&&nS(s,c.from,c.to);if(p)for(var m=p.length-1;m>=0;--m)Cm(s,{from:p[m].from,to:p[m].to,text:m?[""]:c.text,origin:c.origin});else Cm(s,c)}}function Cm(s,c){if(!(c.text.length==1&&c.text[0]==""&&we(c.from,c.to)==0)){var v=of(s,c);hm(s,c,v,s.cm?s.cm.curOp.id:NaN),Vs(s,c,v,Tc(s,c));var p=[];go(s,function(m,C){!C&&Le(p,m.history)==-1&&(Mm(m.history,c),p.push(m.history)),Vs(m,c,null,Tc(m,c))})}}function ku(s,c,v){var p=s.cm&&s.cm.state.suppressEdits;if(!(p&&!v)){for(var m=s.history,C,N=s.sel,P=c=="undo"?m.done:m.undone,B=c=="undo"?m.undone:m.done,z=0;z<P.length&&(C=P[z],!(v?C.ranges&&!C.equals(s.sel):!C.ranges));z++);if(z!=P.length){for(m.lastOrigin=m.lastSelOrigin=null;;)if(C=P.pop(),C.ranges){if(wu(C,B),v&&!C.equals(s.sel)){er(s,C,{clearRedo:!1});return}N=C}else if(p){P.push(C);return}else break;var re=[];wu(N,B),B.push({changes:re,generation:m.generation}),m.generation=C.generation||++m.maxGeneration;for(var ae=xe(s,"beforeChange")||s.cm&&xe(s.cm,"beforeChange"),ye=function(We){var et=C.changes[We];if(et.origin=c,ae&&!Em(s,et,!1))return P.length=0,{};re.push(lf(s,et));var lt=We?of(s,et):A(P);Vs(s,et,lt,vm(s,et)),!We&&s.cm&&s.cm.scrollIntoView({from:et.from,to:vo(et)});var ht=[];go(s,function(ut,_t){!_t&&Le(ht,ut.history)==-1&&(Mm(ut.history,et),ht.push(ut.history)),Vs(ut,et,null,vm(ut,et))})},pe=C.changes.length-1;pe>=0;--pe){var Ie=ye(pe);if(Ie)return Ie.v}}}}function km(s,c){if(c!=0&&(s.first+=c,s.sel=new qr(F(s.sel.ranges,function(m){return new sn(me(m.anchor.line+c,m.anchor.ch),me(m.head.line+c,m.head.ch))}),s.sel.primIndex),s.cm)){mr(s.cm,s.first,s.first-c,c);for(var v=s.cm.display,p=v.viewFrom;p<v.viewTo;p++)fo(s.cm,p,"gutter")}}function Vs(s,c,v,p){if(s.cm&&!s.cm.curOp)return Vn(s.cm,Vs)(s,c,v,p);if(c.to.line<s.first){km(s,c.text.length-1-(c.to.line-c.from.line));return}if(!(c.from.line>s.lastLine())){if(c.from.line<s.first){var m=c.text.length-1-(s.first-c.from.line);km(s,m),c={from:me(s.first,0),to:me(c.to.line+m,c.to.ch),text:[A(c.text)],origin:c.origin}}var C=s.lastLine();c.to.line>C&&(c={from:c.from,to:me(C,Ge(s,C).text.length),text:[c.text[0]],origin:c.origin}),c.removed=zt(s,c.from,c.to),v||(v=of(s,c)),s.cm?aE(s.cm,c,p):sf(s,c,p),Eu(s,v,Ke),s.cantEdit&&Cu(s,me(s.firstLine(),0))&&(s.cantEdit=!1)}}function aE(s,c,v){var p=s.doc,m=s.display,C=c.from,N=c.to,P=!1,B=C.line;s.options.lineWrapping||(B=L(di(Ge(p,C.line))),p.iter(B,N.line+1,function(pe){if(pe==m.maxLine)return P=!0,!0})),p.sel.contains(c.from,c.to)>-1&&St(s),sf(p,c,v,Vg(s)),s.options.lineWrapping||(p.iter(B,C.line+c.text.length,function(pe){var Ie=uu(pe);Ie>m.maxLineLength&&(m.maxLine=pe,m.maxLineLength=Ie,m.maxLineChanged=!0,P=!1)}),P&&(s.curOp.updateMaxLine=!0)),Yw(p,C.line),zs(s,400);var z=c.text.length-(N.line-C.line)-1;c.full?mr(s):C.line==N.line&&c.text.length==1&&!um(s.doc,c)?fo(s,C.line,"text"):mr(s,C.line,N.line+1,z);var re=xe(s,"changes"),ae=xe(s,"change");if(ae||re){var ye={from:C,to:N,text:c.text,removed:c.removed,origin:c.origin};ae&&Un(s,"change",s,ye),re&&(s.curOp.changeObjs||(s.curOp.changeObjs=[])).push(ye)}s.display.selForContextMenu=null}function Ma(s,c,v,p,m){var C;p||(p=v),we(p,v)<0&&(C=[p,v],v=C[0],p=C[1]),typeof c=="string"&&(c=s.splitLines(c)),Na(s,{from:v,to:p,text:c,origin:m})}function Om(s,c,v,p){v<s.line?s.line+=p:c<s.line&&(s.line=c,s.ch=0)}function Nm(s,c,v,p){for(var m=0;m<s.length;++m){var C=s[m],N=!0;if(C.ranges){C.copied||(C=s[m]=C.deepCopy(),C.copied=!0);for(var P=0;P<C.ranges.length;P++)Om(C.ranges[P].anchor,c,v,p),Om(C.ranges[P].head,c,v,p);continue}for(var B=0;B<C.changes.length;++B){var z=C.changes[B];if(v<z.from.line)z.from=me(z.from.line+p,z.from.ch),z.to=me(z.to.line+p,z.to.ch);else if(c<=z.to.line){N=!1;break}}N||(s.splice(0,m+1),m=0)}}function Mm(s,c){var v=c.from.line,p=c.to.line,m=c.text.length-(p-v)-1;Nm(s.done,v,p,m),Nm(s.undone,v,p,m)}function qs(s,c,v,p){var m=c,C=c;return typeof c=="number"?C=Ge(s,Ts(s,c)):m=L(c),m==null?null:(p(C,m)&&s.cm&&fo(s.cm,m,v),C)}function Xs(s){this.lines=s,this.parent=null;for(var c=0,v=0;v<s.length;++v)s[v].parent=this,c+=s[v].height;this.height=c}Xs.prototype={chunkSize:function(){return this.lines.length},removeInner:function(s,c){for(var v=s,p=s+c;v<p;++v){var m=this.lines[v];this.height-=m.height,sS(m),Un(m,"delete")}this.lines.splice(s,c)},collapse:function(s){s.push.apply(s,this.lines)},insertInner:function(s,c,v){this.height+=v,this.lines=this.lines.slice(0,s).concat(c).concat(this.lines.slice(s));for(var p=0;p<c.length;++p)c[p].parent=this},iterN:function(s,c,v){for(var p=s+c;s<p;++s)if(v(this.lines[s]))return!0}};function Gs(s){this.children=s;for(var c=0,v=0,p=0;p<s.length;++p){var m=s[p];c+=m.chunkSize(),v+=m.height,m.parent=this}this.size=c,this.height=v,this.parent=null}Gs.prototype={chunkSize:function(){return this.size},removeInner:function(s,c){this.size-=c;for(var v=0;v<this.children.length;++v){var p=this.children[v],m=p.chunkSize();if(s<m){var C=Math.min(c,m-s),N=p.height;if(p.removeInner(s,C),this.height-=N-p.height,m==C&&(this.children.splice(v--,1),p.parent=null),(c-=C)==0)break;s=0}else s-=m}if(this.size-c<25&&(this.children.length>1||!(this.children[0]instanceof Xs))){var P=[];this.collapse(P),this.children=[new Xs(P)],this.children[0].parent=this}},collapse:function(s){for(var c=0;c<this.children.length;++c)this.children[c].collapse(s)},insertInner:function(s,c,v){this.size+=c.length,this.height+=v;for(var p=0;p<this.children.length;++p){var m=this.children[p],C=m.chunkSize();if(s<=C){if(m.insertInner(s,c,v),m.lines&&m.lines.length>50){for(var N=m.lines.length%25+25,P=N;P<m.lines.length;){var B=new Xs(m.lines.slice(P,P+=25));m.height-=B.height,this.children.splice(++p,0,B),B.parent=this}m.lines=m.lines.slice(0,N),this.maybeSpill()}break}s-=C}},maybeSpill:function(){if(!(this.children.length<=10)){var s=this;do{var c=s.children.splice(s.children.length-5,5),v=new Gs(c);if(s.parent){s.size-=v.size,s.height-=v.height;var m=Le(s.parent.children,s);s.parent.children.splice(m+1,0,v)}else{var p=new Gs(s.children);p.parent=s,s.children=[p,v],s=p}v.parent=s.parent}while(s.children.length>10);s.parent.maybeSpill()}},iterN:function(s,c,v){for(var p=0;p<this.children.length;++p){var m=this.children[p],C=m.chunkSize();if(s<C){var N=Math.min(c,C-s);if(m.iterN(s,N,v))return!0;if((c-=N)==0)break;s=0}else s-=C}}};var Ys=function(s,c,v){if(v)for(var p in v)v.hasOwnProperty(p)&&(this[p]=v[p]);this.doc=s,this.node=c};Ys.prototype.clear=function(){var s=this.doc.cm,c=this.line.widgets,v=this.line,p=L(v);if(!(p==null||!c)){for(var m=0;m<c.length;++m)c[m]==this&&c.splice(m--,1);c.length||(v.widgets=null);var C=Rs(this);Q(v,Math.max(0,v.height-C)),s&&(Pr(s,function(){Am(s,v,-C),fo(s,p,"widget")}),Un(s,"lineWidgetCleared",s,this,p))}},Ys.prototype.changed=function(){var s=this,c=this.height,v=this.doc.cm,p=this.line;this.height=null;var m=Rs(this)-c;m&&(co(this.doc,p)||Q(p,p.height+m),v&&Pr(v,function(){v.curOp.forceUpdate=!0,Am(v,p,m),Un(v,"lineWidgetChanged",v,s,L(p))}))},qe(Ys);function Am(s,c,v){Zi(c)<(s.curOp&&s.curOp.scrollTop||s.doc.scrollTop)&&Zc(s,v)}function sE(s,c,v,p){var m=new Ys(s,v,p),C=s.cm;return C&&m.noHScroll&&(C.display.alignWidgets=!0),qs(s,c,"widget",function(N){var P=N.widgets||(N.widgets=[]);if(m.insertAt==null?P.push(m):P.splice(Math.min(P.length,Math.max(0,m.insertAt)),0,m),m.line=N,C&&!co(s,N)){var B=Zi(N)<s.scrollTop;Q(N,N.height+Rs(m)),B&&Zc(C,m.height),C.curOp.forceUpdate=!0}return!0}),C&&Un(C,"lineWidgetAdded",C,m,typeof c=="number"?c:L(c)),m}var Tm=0,mo=function(s,c){this.lines=[],this.type=c,this.doc=s,this.id=++Tm};mo.prototype.clear=function(){if(!this.explicitlyCleared){var s=this.doc.cm,c=s&&!s.curOp;if(c&&Uo(s),xe(this,"clear")){var v=this.find();v&&Un(this,"clear",v.from,v.to)}for(var p=null,m=null,C=0;C<this.lines.length;++C){var N=this.lines[C],P=Ds(N.markedSpans,this);s&&!this.collapsed?fo(s,L(N),"text"):s&&(P.to!=null&&(m=L(N)),P.from!=null&&(p=L(N))),N.markedSpans=Zw(N.markedSpans,P),P.from==null&&this.collapsed&&!co(this.doc,N)&&s&&Q(N,xa(s.display))}if(s&&this.collapsed&&!s.options.lineWrapping)for(var B=0;B<this.lines.length;++B){var z=di(this.lines[B]),re=uu(z);re>s.display.maxLineLength&&(s.display.maxLine=z,s.display.maxLineLength=re,s.display.maxLineChanged=!0)}p!=null&&s&&this.collapsed&&mr(s,p,m+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,s&&bm(s.doc)),s&&Un(s,"markerCleared",s,this,p,m),c&&Vo(s),this.parent&&this.parent.clear()}},mo.prototype.find=function(s,c){s==null&&this.type=="bookmark"&&(s=1);for(var v,p,m=0;m<this.lines.length;++m){var C=this.lines[m],N=Ds(C.markedSpans,this);if(N.from!=null&&(v=me(c?C:L(C),N.from),s==-1))return v;if(N.to!=null&&(p=me(c?C:L(C),N.to),s==1))return p}return v&&{from:v,to:p}},mo.prototype.changed=function(){var s=this,c=this.find(-1,!0),v=this,p=this.doc.cm;!c||!p||Pr(p,function(){var m=c.line,C=L(c.line),N=Hc(p,C);if(N&&(Bg(N),p.curOp.selectionChanged=p.curOp.forceUpdate=!0),p.curOp.updateMaxLine=!0,!co(v.doc,m)&&v.height!=null){var P=v.height;v.height=null;var B=Rs(v)-P;B&&Q(m,m.height+B)}Un(p,"markerChanged",p,s)})},mo.prototype.attachLine=function(s){if(!this.lines.length&&this.doc.cm){var c=this.doc.cm.curOp;(!c.maybeHiddenMarkers||Le(c.maybeHiddenMarkers,this)==-1)&&(c.maybeUnhiddenMarkers||(c.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(s)},mo.prototype.detachLine=function(s){if(this.lines.splice(Le(this.lines,s),1),!this.lines.length&&this.doc.cm){var c=this.doc.cm.curOp;(c.maybeHiddenMarkers||(c.maybeHiddenMarkers=[])).push(this)}},qe(mo);function Aa(s,c,v,p,m){if(p&&p.shared)return lE(s,c,v,p,m);if(s.cm&&!s.cm.curOp)return Vn(s.cm,Aa)(s,c,v,p,m);var C=new mo(s,m),N=we(c,v);if(p&&se(p,C,!1),N>0||N==0&&C.clearWhenEmpty!==!1)return C;if(C.replacedWith&&(C.collapsed=!0,C.widgetNode=fe("span",[C.replacedWith],"CodeMirror-widget"),p.handleMouseEvents||C.widgetNode.setAttribute("cm-ignore-events","true"),p.insertLeft&&(C.widgetNode.insertLeft=!0)),C.collapsed){if(xg(s,c.line,c,v,C)||c.line!=v.line&&xg(s,v.line,c,v,C))throw new Error("Inserting collapsed marker partially overlapping an existing one");Jw()}C.addToHistory&&hm(s,{from:c,to:v,origin:"markText"},s.sel,NaN);var P=c.line,B=s.cm,z;if(s.iter(P,v.line+1,function(ae){B&&C.collapsed&&!B.options.lineWrapping&&di(ae)==B.display.maxLine&&(z=!0),C.collapsed&&P!=c.line&&Q(ae,0),Qw(ae,new ou(C,P==c.line?c.ch:null,P==v.line?v.ch:null),s.cm&&s.cm.curOp),++P}),C.collapsed&&s.iter(c.line,v.line+1,function(ae){co(s,ae)&&Q(ae,0)}),C.clearOnEnter&&Re(C,"beforeCursorEnter",function(){return C.clear()}),C.readOnly&&(Kw(),(s.history.done.length||s.history.undone.length)&&s.clearHistory()),C.collapsed&&(C.id=++Tm,C.atomic=!0),B){if(z&&(B.curOp.updateMaxLine=!0),C.collapsed)mr(B,c.line,v.line+1);else if(C.className||C.startStyle||C.endStyle||C.css||C.attributes||C.title)for(var re=c.line;re<=v.line;re++)fo(B,re,"text");C.atomic&&bm(B.doc),Un(B,"markerAdded",B,C)}return C}var Ks=function(s,c){this.markers=s,this.primary=c;for(var v=0;v<s.length;++v)s[v].parent=this};Ks.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var s=0;s<this.markers.length;++s)this.markers[s].clear();Un(this,"clear")}},Ks.prototype.find=function(s,c){return this.primary.find(s,c)},qe(Ks);function lE(s,c,v,p,m){p=se(p),p.shared=!1;var C=[Aa(s,c,v,p,m)],N=C[0],P=p.widgetNode;return go(s,function(B){P&&(p.widgetNode=P.cloneNode(!0)),C.push(Aa(B,Bt(B,c),Bt(B,v),p,m));for(var z=0;z<B.linked.length;++z)if(B.linked[z].isParent)return;N=A(C)}),new Ks(C,N)}function Dm(s){return s.findMarks(me(s.first,0),s.clipPos(me(s.lastLine())),function(c){return c.parent})}function uE(s,c){for(var v=0;v<c.length;v++){var p=c[v],m=p.find(),C=s.clipPos(m.from),N=s.clipPos(m.to);if(we(C,N)){var P=Aa(s,C,N,p.primary,p.primary.type);p.markers.push(P),P.parent=p}}}function dE(s){for(var c=function(p){var m=s[p],C=[m.primary.doc];go(m.primary.doc,function(B){return C.push(B)});for(var N=0;N<m.markers.length;N++){var P=m.markers[N];Le(C,P.doc)==-1&&(P.parent=null,m.markers.splice(N--,1))}},v=0;v<s.length;v++)c(v)}var cE=0,yr=function(s,c,v,p,m){if(!(this instanceof yr))return new yr(s,c,v,p,m);v==null&&(v=0),Gs.call(this,[new Xs([new ya("",null)])]),this.first=v,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=v;var C=me(v,0);this.sel=po(C),this.history=new xu(null),this.id=++cE,this.modeOption=c,this.lineSep=p,this.direction=m=="rtl"?"rtl":"ltr",this.extend=!1,typeof s=="string"&&(s=this.splitLines(s)),sf(this,{from:C,to:C,text:s}),er(this,po(C),Ke)};yr.prototype=oe(Gs.prototype,{constructor:yr,iter:function(s,c,v){v?this.iterN(s-this.first,c-s,v):this.iterN(this.first,this.first+this.size,s)},insert:function(s,c){for(var v=0,p=0;p<c.length;++p)v+=c[p].height;this.insertInner(s-this.first,c,v)},remove:function(s,c){this.removeInner(s-this.first,c)},getValue:function(s){var c=pn(this,this.first,this.first+this.size);return s===!1?c:c.join(s||this.lineSeparator())},setValue:qn(function(s){var c=me(this.first,0),v=this.first+this.size-1;Na(this,{from:c,to:me(v,Ge(this,v).text.length),text:this.splitLines(s),origin:"setValue",full:!0},!0),this.cm&&js(this.cm,0,0),er(this,po(c),Ke)}),replaceRange:function(s,c,v,p){c=Bt(this,c),v=v?Bt(this,v):c,Ma(this,s,c,v,p)},getRange:function(s,c,v){var p=zt(this,Bt(this,s),Bt(this,c));return v===!1?p:v===""?p.join(""):p.join(v||this.lineSeparator())},getLine:function(s){var c=this.getLineHandle(s);return c&&c.text},getLineHandle:function(s){if(he(this,s))return Ge(this,s)},getLineNumber:function(s){return L(s)},getLineHandleVisualStart:function(s){return typeof s=="number"&&(s=Ge(this,s)),di(s)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(s){return Bt(this,s)},getCursor:function(s){var c=this.sel.primary(),v;return s==null||s=="head"?v=c.head:s=="anchor"?v=c.anchor:s=="end"||s=="to"||s===!1?v=c.to():v=c.from(),v},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:qn(function(s,c,v){mm(this,Bt(this,typeof s=="number"?me(s,c||0):s),null,v)}),setSelection:qn(function(s,c,v){mm(this,Bt(this,s),Bt(this,c||s),v)}),extendSelection:qn(function(s,c,v){Su(this,Bt(this,s),c&&Bt(this,c),v)}),extendSelections:qn(function(s,c){gm(this,ma(this,s),c)}),extendSelectionsBy:qn(function(s,c){var v=F(this.sel.ranges,s);gm(this,ma(this,v),c)}),setSelections:qn(function(s,c,v){if(s.length){for(var p=[],m=0;m<s.length;m++)p[m]=new sn(Bt(this,s[m].anchor),Bt(this,s[m].head||s[m].anchor));c==null&&(c=Math.min(s.length-1,this.sel.primIndex)),er(this,fi(this.cm,p,c),v)}}),addSelection:qn(function(s,c,v){var p=this.sel.ranges.slice(0);p.push(new sn(Bt(this,s),Bt(this,c||s))),er(this,fi(this.cm,p,p.length-1),v)}),getSelection:function(s){for(var c=this.sel.ranges,v,p=0;p<c.length;p++){var m=zt(this,c[p].from(),c[p].to());v=v?v.concat(m):m}return s===!1?v:v.join(s||this.lineSeparator())},getSelections:function(s){for(var c=[],v=this.sel.ranges,p=0;p<v.length;p++){var m=zt(this,v[p].from(),v[p].to());s!==!1&&(m=m.join(s||this.lineSeparator())),c[p]=m}return c},replaceSelection:function(s,c,v){for(var p=[],m=0;m<this.sel.ranges.length;m++)p[m]=s;this.replaceSelections(p,c,v||"+input")},replaceSelections:qn(function(s,c,v){for(var p=[],m=this.sel,C=0;C<m.ranges.length;C++){var N=m.ranges[C];p[C]={from:N.from(),to:N.to(),text:this.splitLines(s[C]),origin:v}}for(var P=c&&c!="end"&&ZS(this,p,c),B=p.length-1;B>=0;B--)Na(this,p[B]);P?ym(this,P):this.cm&&Ea(this.cm)}),undo:qn(function(){ku(this,"undo")}),redo:qn(function(){ku(this,"redo")}),undoSelection:qn(function(){ku(this,"undo",!0)}),redoSelection:qn(function(){ku(this,"redo",!0)}),setExtending:function(s){this.extend=s},getExtending:function(){return this.extend},historySize:function(){for(var s=this.history,c=0,v=0,p=0;p<s.done.length;p++)s.done[p].ranges||++c;for(var m=0;m<s.undone.length;m++)s.undone[m].ranges||++v;return{undo:c,redo:v}},clearHistory:function(){var s=this;this.history=new xu(this.history),go(this,function(c){return c.history=s.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(s){return s&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(s){return this.history.generation==(s||this.cleanGeneration)},getHistory:function(){return{done:ka(this.history.done),undone:ka(this.history.undone)}},setHistory:function(s){var c=this.history=new xu(this.history);c.done=ka(s.done.slice(0),null,!0),c.undone=ka(s.undone.slice(0),null,!0)},setGutterMarker:qn(function(s,c,v){return qs(this,s,"gutter",function(p){var m=p.gutterMarkers||(p.gutterMarkers={});return m[c]=v,!v&&ke(m)&&(p.gutterMarkers=null),!0})}),clearGutter:qn(function(s){var c=this;this.iter(function(v){v.gutterMarkers&&v.gutterMarkers[s]&&qs(c,v,"gutter",function(){return v.gutterMarkers[s]=null,ke(v.gutterMarkers)&&(v.gutterMarkers=null),!0})})}),lineInfo:function(s){var c;if(typeof s=="number"){if(!he(this,s)||(c=s,s=Ge(this,s),!s))return null}else if(c=L(s),c==null)return null;return{line:c,handle:s,text:s.text,gutterMarkers:s.gutterMarkers,textClass:s.textClass,bgClass:s.bgClass,wrapClass:s.wrapClass,widgets:s.widgets}},addLineClass:qn(function(s,c,v){return qs(this,s,c=="gutter"?"gutter":"class",function(p){var m=c=="text"?"textClass":c=="background"?"bgClass":c=="gutter"?"gutterClass":"wrapClass";if(!p[m])p[m]=v;else{if(V(v).test(p[m]))return!1;p[m]+=" "+v}return!0})}),removeLineClass:qn(function(s,c,v){return qs(this,s,c=="gutter"?"gutter":"class",function(p){var m=c=="text"?"textClass":c=="background"?"bgClass":c=="gutter"?"gutterClass":"wrapClass",C=p[m];if(C)if(v==null)p[m]=null;else{var N=C.match(V(v));if(!N)return!1;var P=N.index+N[0].length;p[m]=C.slice(0,N.index)+(!N.index||P==C.length?"":" ")+C.slice(P)||null}else return!1;return!0})}),addLineWidget:qn(function(s,c,v){return sE(this,s,c,v)}),removeLineWidget:function(s){s.clear()},markText:function(s,c,v){return Aa(this,Bt(this,s),Bt(this,c),v,v&&v.type||"range")},setBookmark:function(s,c){var v={replacedWith:c&&(c.nodeType==null?c.widget:c),insertLeft:c&&c.insertLeft,clearWhenEmpty:!1,shared:c&&c.shared,handleMouseEvents:c&&c.handleMouseEvents};return s=Bt(this,s),Aa(this,s,s,v,"bookmark")},findMarksAt:function(s){s=Bt(this,s);var c=[],v=Ge(this,s.line).markedSpans;if(v)for(var p=0;p<v.length;++p){var m=v[p];(m.from==null||m.from<=s.ch)&&(m.to==null||m.to>=s.ch)&&c.push(m.marker.parent||m.marker)}return c},findMarks:function(s,c,v){s=Bt(this,s),c=Bt(this,c);var p=[],m=s.line;return this.iter(s.line,c.line+1,function(C){var N=C.markedSpans;if(N)for(var P=0;P<N.length;P++){var B=N[P];!(B.to!=null&&m==s.line&&s.ch>=B.to||B.from==null&&m!=s.line||B.from!=null&&m==c.line&&B.from>=c.ch)&&(!v||v(B.marker))&&p.push(B.marker.parent||B.marker)}++m}),p},getAllMarks:function(){var s=[];return this.iter(function(c){var v=c.markedSpans;if(v)for(var p=0;p<v.length;++p)v[p].from!=null&&s.push(v[p].marker)}),s},posFromIndex:function(s){var c,v=this.first,p=this.lineSeparator().length;return this.iter(function(m){var C=m.text.length+p;if(C>s)return c=s,!0;s-=C,++v}),Bt(this,me(v,c))},indexFromPos:function(s){s=Bt(this,s);var c=s.ch;if(s.line<this.first||s.ch<0)return 0;var v=this.lineSeparator().length;return this.iter(this.first,s.line,function(p){c+=p.text.length+v}),c},copy:function(s){var c=new yr(pn(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return c.scrollTop=this.scrollTop,c.scrollLeft=this.scrollLeft,c.sel=this.sel,c.extend=!1,s&&(c.history.undoDepth=this.history.undoDepth,c.setHistory(this.getHistory())),c},linkedDoc:function(s){s||(s={});var c=this.first,v=this.first+this.size;s.from!=null&&s.from>c&&(c=s.from),s.to!=null&&s.to<v&&(v=s.to);var p=new yr(pn(this,c,v),s.mode||this.modeOption,c,this.lineSep,this.direction);return s.sharedHist&&(p.history=this.history),(this.linked||(this.linked=[])).push({doc:p,sharedHist:s.sharedHist}),p.linked=[{doc:this,isParent:!0,sharedHist:s.sharedHist}],uE(p,Dm(this)),p},unlinkDoc:function(s){if(s instanceof _n&&(s=s.doc),this.linked)for(var c=0;c<this.linked.length;++c){var v=this.linked[c];if(v.doc==s){this.linked.splice(c,1),s.unlinkDoc(this),dE(Dm(this));break}}if(s.history==this.history){var p=[s.id];go(s,function(m){return p.push(m.id)},!0),s.history=new xu(null),s.history.done=ka(this.history.done,p),s.history.undone=ka(this.history.undone,p)}},iterLinkedDocs:function(s){go(this,s)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(s){return this.lineSep?s.split(this.lineSep):Nn(s)},lineSeparator:function(){return this.lineSep||`
`},setDirection:qn(function(s){s!="rtl"&&(s="ltr"),s!=this.direction&&(this.direction=s,this.iter(function(c){return c.order=null}),this.cm&&QS(this.cm))})}),yr.prototype.eachLine=yr.prototype.iter;var Lm=0;function fE(s){var c=this;if(Pm(c),!(nt(c,s)||Qi(c.display,s))){gt(s),u&&(Lm=+new Date);var v=$o(c,s,!0),p=s.dataTransfer.files;if(!(!v||c.isReadOnly()))if(p&&p.length&&window.FileReader&&window.File)for(var m=p.length,C=Array(m),N=0,P=function(){++N==m&&Vn(c,function(){v=Bt(c.doc,v);var pe={from:v,to:v,text:c.doc.splitLines(C.filter(function(Ie){return Ie!=null}).join(c.doc.lineSeparator())),origin:"paste"};Na(c.doc,pe),ym(c.doc,po(Bt(c.doc,v),Bt(c.doc,vo(pe))))})()},B=function(pe,Ie){if(c.options.allowDropFileTypes&&Le(c.options.allowDropFileTypes,pe.type)==-1){P();return}var We=new FileReader;We.onerror=function(){return P()},We.onload=function(){var et=We.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(et)){P();return}C[Ie]=et,P()},We.readAsText(pe)},z=0;z<p.length;z++)B(p[z],z);else{if(c.state.draggingText&&c.doc.sel.contains(v)>-1){c.state.draggingText(s),setTimeout(function(){return c.display.input.focus()},20);return}try{var re=s.dataTransfer.getData("Text");if(re){var ae;if(c.state.draggingText&&!c.state.draggingText.copy&&(ae=c.listSelections()),Eu(c.doc,po(v,v)),ae)for(var ye=0;ye<ae.length;++ye)Ma(c.doc,"",ae[ye].anchor,ae[ye].head,"drag");c.replaceSelection(re,"around","paste"),c.display.input.focus()}}catch{}}}}function hE(s,c){if(u&&(!s.state.draggingText||+new Date-Lm<100)){Gt(c);return}if(!(nt(s,c)||Qi(s.display,c))&&(c.dataTransfer.setData("Text",s.getSelection()),c.dataTransfer.effectAllowed="copyMove",c.dataTransfer.setDragImage&&!x)){var v=j("img",null,null,"position: fixed; left: 0; top: 0;");v.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",w&&(v.width=v.height=1,s.display.wrapper.appendChild(v),v._top=v.offsetTop),c.dataTransfer.setDragImage(v,0,0),w&&v.parentNode.removeChild(v)}}function pE(s,c){var v=$o(s,c);if(v){var p=document.createDocumentFragment();Xc(s,v,p),s.display.dragCursor||(s.display.dragCursor=j("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),s.display.lineSpace.insertBefore(s.display.dragCursor,s.display.cursorDiv)),U(s.display.dragCursor,p)}}function Pm(s){s.display.dragCursor&&(s.display.lineSpace.removeChild(s.display.dragCursor),s.display.dragCursor=null)}function Rm(s){if(document.getElementsByClassName){for(var c=document.getElementsByClassName("CodeMirror"),v=[],p=0;p<c.length;p++){var m=c[p].CodeMirror;m&&v.push(m)}v.length&&v[0].operation(function(){for(var C=0;C<v.length;C++)s(v[C])})}}var Im=!1;function vE(){Im||(gE(),Im=!0)}function gE(){var s;Re(window,"resize",function(){s==null&&(s=setTimeout(function(){s=null,Rm(mE)},100))}),Re(window,"blur",function(){return Rm(Sa)})}function mE(s){var c=s.display;c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.scrollbarsClipped=!1,s.setSize()}for(var yo={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Js=0;Js<10;Js++)yo[Js+48]=yo[Js+96]=String(Js);for(var Ou=65;Ou<=90;Ou++)yo[Ou]=String.fromCharCode(Ou);for(var Zs=1;Zs<=12;Zs++)yo[Zs+111]=yo[Zs+63235]="F"+Zs;var to={};to.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},to.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},to.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},to.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},to.default=M?to.macDefault:to.pcDefault;function yE(s){var c=s.split(/-(?!$)/);s=c[c.length-1];for(var v,p,m,C,N=0;N<c.length-1;N++){var P=c[N];if(/^(cmd|meta|m)$/i.test(P))C=!0;else if(/^a(lt)?$/i.test(P))v=!0;else if(/^(c|ctrl|control)$/i.test(P))p=!0;else if(/^s(hift)?$/i.test(P))m=!0;else throw new Error("Unrecognized modifier name: "+P)}return v&&(s="Alt-"+s),p&&(s="Ctrl-"+s),C&&(s="Cmd-"+s),m&&(s="Shift-"+s),s}function _E(s){var c={};for(var v in s)if(s.hasOwnProperty(v)){var p=s[v];if(/^(name|fallthrough|(de|at)tach)$/.test(v))continue;if(p=="..."){delete s[v];continue}for(var m=F(v.split(" "),yE),C=0;C<m.length;C++){var N=void 0,P=void 0;C==m.length-1?(P=m.join(" "),N=p):(P=m.slice(0,C+1).join(" "),N="...");var B=c[P];if(!B)c[P]=N;else if(B!=N)throw new Error("Inconsistent bindings for "+P)}delete s[v]}for(var z in c)s[z]=c[z];return s}function Ta(s,c,v,p){c=Nu(c);var m=c.call?c.call(s,p):c[s];if(m===!1)return"nothing";if(m==="...")return"multi";if(m!=null&&v(m))return"handled";if(c.fallthrough){if(Object.prototype.toString.call(c.fallthrough)!="[object Array]")return Ta(s,c.fallthrough,v,p);for(var C=0;C<c.fallthrough.length;C++){var N=Ta(s,c.fallthrough[C],v,p);if(N)return N}}}function Bm(s){var c=typeof s=="string"?s:yo[s.keyCode];return c=="Ctrl"||c=="Alt"||c=="Shift"||c=="Mod"}function jm(s,c,v){var p=s;return c.altKey&&p!="Alt"&&(s="Alt-"+s),($?c.metaKey:c.ctrlKey)&&p!="Ctrl"&&(s="Ctrl-"+s),($?c.ctrlKey:c.metaKey)&&p!="Mod"&&(s="Cmd-"+s),!v&&c.shiftKey&&p!="Shift"&&(s="Shift-"+s),s}function Hm(s,c){if(w&&s.keyCode==34&&s.char)return!1;var v=yo[s.keyCode];return v==null||s.altGraphKey?!1:(s.keyCode==3&&s.code&&(v=s.code),jm(v,s,c))}function Nu(s){return typeof s=="string"?to[s]:s}function Da(s,c){for(var v=s.doc.sel.ranges,p=[],m=0;m<v.length;m++){for(var C=c(v[m]);p.length&&we(C.from,A(p).to)<=0;){var N=p.pop();if(we(N.from,C.from)<0){C.from=N.from;break}}p.push(C)}Pr(s,function(){for(var P=p.length-1;P>=0;P--)Ma(s.doc,"",p[P].from,p[P].to,"+delete");Ea(s)})}function cf(s,c,v){var p=ct(s.text,c+v,v);return p<0||p>s.text.length?null:p}function ff(s,c,v){var p=cf(s,c.ch,v);return p==null?null:new me(c.line,p,v<0?"after":"before")}function hf(s,c,v,p,m){if(s){c.doc.direction=="rtl"&&(m=-m);var C=at(v,c.doc.direction);if(C){var N=m<0?A(C):C[0],P=m<0==(N.level==1),B=P?"after":"before",z;if(N.level>0||c.doc.direction=="rtl"){var re=ba(c,v);z=m<0?v.text.length-1:0;var ae=Ii(c,re,z).top;z=pt(function(ye){return Ii(c,re,ye).top==ae},m<0==(N.level==1)?N.from:N.to-1,z),B=="before"&&(z=cf(v,z,1))}else z=m<0?N.to:N.from;return new me(p,z,B)}}return new me(p,m<0?v.text.length:0,m<0?"before":"after")}function bE(s,c,v,p){var m=at(c,s.doc.direction);if(!m)return ff(c,v,p);v.ch>=c.text.length?(v.ch=c.text.length,v.sticky="before"):v.ch<=0&&(v.ch=0,v.sticky="after");var C=dt(m,v.ch,v.sticky),N=m[C];if(s.doc.direction=="ltr"&&N.level%2==0&&(p>0?N.to>v.ch:N.from<v.ch))return ff(c,v,p);var P=function(lt,ht){return cf(c,lt instanceof me?lt.ch:lt,ht)},B,z=function(lt){return s.options.lineWrapping?(B=B||ba(s,c),Ug(s,c,B,lt)):{begin:0,end:c.text.length}},re=z(v.sticky=="before"?P(v,-1):v.ch);if(s.doc.direction=="rtl"||N.level==1){var ae=N.level==1==p<0,ye=P(v,ae?1:-1);if(ye!=null&&(ae?ye<=N.to&&ye<=re.end:ye>=N.from&&ye>=re.begin)){var pe=ae?"before":"after";return new me(v.line,ye,pe)}}var Ie=function(lt,ht,ut){for(var _t=function(hn,Xn){return Xn?new me(v.line,P(hn,1),"before"):new me(v.line,hn,"after")};lt>=0&&lt<m.length;lt+=ht){var Tt=m[lt],At=ht>0==(Tt.level!=1),Ut=At?ut.begin:P(ut.end,-1);if(Tt.from<=Ut&&Ut<Tt.to||(Ut=At?Tt.from:P(Tt.to,-1),ut.begin<=Ut&&Ut<ut.end))return _t(Ut,At)}},We=Ie(C+p,p,re);if(We)return We;var et=p>0?re.end:P(re.begin,-1);return et!=null&&!(p>0&&et==c.text.length)&&(We=Ie(p>0?0:m.length-1,p,z(et)),We)?We:null}var Qs={selectAll:Sm,singleSelection:function(s){return s.setSelection(s.getCursor("anchor"),s.getCursor("head"),Ke)},killLine:function(s){return Da(s,function(c){if(c.empty()){var v=Ge(s.doc,c.head.line).text.length;return c.head.ch==v&&c.head.line<s.lastLine()?{from:c.head,to:me(c.head.line+1,0)}:{from:c.head,to:me(c.head.line,v)}}else return{from:c.from(),to:c.to()}})},deleteLine:function(s){return Da(s,function(c){return{from:me(c.from().line,0),to:Bt(s.doc,me(c.to().line+1,0))}})},delLineLeft:function(s){return Da(s,function(c){return{from:me(c.from().line,0),to:c.from()}})},delWrappedLineLeft:function(s){return Da(s,function(c){var v=s.charCoords(c.head,"div").top+5,p=s.coordsChar({left:0,top:v},"div");return{from:p,to:c.from()}})},delWrappedLineRight:function(s){return Da(s,function(c){var v=s.charCoords(c.head,"div").top+5,p=s.coordsChar({left:s.display.lineDiv.offsetWidth+100,top:v},"div");return{from:c.from(),to:p}})},undo:function(s){return s.undo()},redo:function(s){return s.redo()},undoSelection:function(s){return s.undoSelection()},redoSelection:function(s){return s.redoSelection()},goDocStart:function(s){return s.extendSelection(me(s.firstLine(),0))},goDocEnd:function(s){return s.extendSelection(me(s.lastLine()))},goLineStart:function(s){return s.extendSelectionsBy(function(c){return $m(s,c.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(s){return s.extendSelectionsBy(function(c){return Fm(s,c.head)},{origin:"+move",bias:1})},goLineEnd:function(s){return s.extendSelectionsBy(function(c){return xE(s,c.head.line)},{origin:"+move",bias:-1})},goLineRight:function(s){return s.extendSelectionsBy(function(c){var v=s.cursorCoords(c.head,"div").top+5;return s.coordsChar({left:s.display.lineDiv.offsetWidth+100,top:v},"div")},yt)},goLineLeft:function(s){return s.extendSelectionsBy(function(c){var v=s.cursorCoords(c.head,"div").top+5;return s.coordsChar({left:0,top:v},"div")},yt)},goLineLeftSmart:function(s){return s.extendSelectionsBy(function(c){var v=s.cursorCoords(c.head,"div").top+5,p=s.coordsChar({left:0,top:v},"div");return p.ch<s.getLine(p.line).search(/\S/)?Fm(s,c.head):p},yt)},goLineUp:function(s){return s.moveV(-1,"line")},goLineDown:function(s){return s.moveV(1,"line")},goPageUp:function(s){return s.moveV(-1,"page")},goPageDown:function(s){return s.moveV(1,"page")},goCharLeft:function(s){return s.moveH(-1,"char")},goCharRight:function(s){return s.moveH(1,"char")},goColumnLeft:function(s){return s.moveH(-1,"column")},goColumnRight:function(s){return s.moveH(1,"column")},goWordLeft:function(s){return s.moveH(-1,"word")},goGroupRight:function(s){return s.moveH(1,"group")},goGroupLeft:function(s){return s.moveH(-1,"group")},goWordRight:function(s){return s.moveH(1,"word")},delCharBefore:function(s){return s.deleteH(-1,"codepoint")},delCharAfter:function(s){return s.deleteH(1,"char")},delWordBefore:function(s){return s.deleteH(-1,"word")},delWordAfter:function(s){return s.deleteH(1,"word")},delGroupBefore:function(s){return s.deleteH(-1,"group")},delGroupAfter:function(s){return s.deleteH(1,"group")},indentAuto:function(s){return s.indentSelection("smart")},indentMore:function(s){return s.indentSelection("add")},indentLess:function(s){return s.indentSelection("subtract")},insertTab:function(s){return s.replaceSelection("	")},insertSoftTab:function(s){for(var c=[],v=s.listSelections(),p=s.options.tabSize,m=0;m<v.length;m++){var C=v[m].from(),N=ge(s.getLine(C.line),C.ch,p);c.push(te(p-N%p))}s.replaceSelections(c)},defaultTab:function(s){s.somethingSelected()?s.indentSelection("add"):s.execCommand("insertTab")},transposeChars:function(s){return Pr(s,function(){for(var c=s.listSelections(),v=[],p=0;p<c.length;p++)if(c[p].empty()){var m=c[p].head,C=Ge(s.doc,m.line).text;if(C){if(m.ch==C.length&&(m=new me(m.line,m.ch-1)),m.ch>0)m=new me(m.line,m.ch+1),s.replaceRange(C.charAt(m.ch-1)+C.charAt(m.ch-2),me(m.line,m.ch-2),m,"+transpose");else if(m.line>s.doc.first){var N=Ge(s.doc,m.line-1).text;N&&(m=new me(m.line,1),s.replaceRange(C.charAt(0)+s.doc.lineSeparator()+N.charAt(N.length-1),me(m.line-1,N.length-1),m,"+transpose"))}}v.push(new sn(m,m))}s.setSelections(v)})},newlineAndIndent:function(s){return Pr(s,function(){for(var c=s.listSelections(),v=c.length-1;v>=0;v--)s.replaceRange(s.doc.lineSeparator(),c[v].anchor,c[v].head,"+input");c=s.listSelections();for(var p=0;p<c.length;p++)s.indentLine(c[p].from().line,null,!0);Ea(s)})},openLine:function(s){return s.replaceSelection(`
`,"start")},toggleOverwrite:function(s){return s.toggleOverwrite()}};function $m(s,c){var v=Ge(s.doc,c),p=di(v);return p!=v&&(c=L(p)),hf(!0,s,p,c,1)}function xE(s,c){var v=Ge(s.doc,c),p=iS(v);return p!=v&&(c=L(p)),hf(!0,s,v,c,-1)}function Fm(s,c){var v=$m(s,c.line),p=Ge(s.doc,v.line),m=at(p,s.doc.direction);if(!m||m[0].level==0){var C=Math.max(v.ch,p.text.search(/\S/)),N=c.line==v.line&&c.ch<=C&&c.ch;return me(v.line,N?0:C,v.sticky)}return v}function Mu(s,c,v){if(typeof c=="string"&&(c=Qs[c],!c))return!1;s.display.input.ensurePolled();var p=s.display.shift,m=!1;try{s.isReadOnly()&&(s.state.suppressEdits=!0),v&&(s.display.shift=!1),m=c(s)!=ft}finally{s.display.shift=p,s.state.suppressEdits=!1}return m}function wE(s,c,v){for(var p=0;p<s.state.keyMaps.length;p++){var m=Ta(c,s.state.keyMaps[p],v,s);if(m)return m}return s.options.extraKeys&&Ta(c,s.options.extraKeys,v,s)||Ta(c,s.options.keyMap,v,s)}var SE=new Pe;function el(s,c,v,p){var m=s.state.keySeq;if(m){if(Bm(c))return"handled";if(/\'$/.test(c)?s.state.keySeq=null:SE.set(50,function(){s.state.keySeq==m&&(s.state.keySeq=null,s.display.input.reset())}),zm(s,m+" "+c,v,p))return!0}return zm(s,c,v,p)}function zm(s,c,v,p){var m=wE(s,c,p);return m=="multi"&&(s.state.keySeq=c),m=="handled"&&Un(s,"keyHandled",s,c,v),(m=="handled"||m=="multi")&&(gt(v),Gc(s)),!!m}function Wm(s,c){var v=Hm(c,!0);return v?c.shiftKey&&!s.state.keySeq?el(s,"Shift-"+v,c,function(p){return Mu(s,p,!0)})||el(s,v,c,function(p){if(typeof p=="string"?/^go[A-Z]/.test(p):p.motion)return Mu(s,p)}):el(s,v,c,function(p){return Mu(s,p)}):!1}function EE(s,c,v){return el(s,"'"+v+"'",c,function(p){return Mu(s,p,!0)})}var pf=null;function Um(s){var c=this;if(!(s.target&&s.target!=c.display.input.getField())&&(c.curOp.focus=rt(de(c)),!nt(c,s))){u&&d<11&&s.keyCode==27&&(s.returnValue=!1);var v=s.keyCode;c.display.shift=v==16||s.shiftKey;var p=Wm(c,s);w&&(pf=p?v:null,!p&&v==88&&!ui&&(M?s.metaKey:s.ctrlKey)&&c.replaceSelection("",null,"cut")),i&&!M&&!p&&v==46&&s.shiftKey&&!s.ctrlKey&&document.execCommand&&document.execCommand("cut"),v==18&&!/\bCodeMirror-crosshair\b/.test(c.display.lineDiv.className)&&CE(c)}}function CE(s){var c=s.display.lineDiv;Me(c,"CodeMirror-crosshair");function v(p){(p.keyCode==18||!p.altKey)&&(J(c,"CodeMirror-crosshair"),Ye(document,"keyup",v),Ye(document,"mouseover",v))}Re(document,"keyup",v),Re(document,"mouseover",v)}function Vm(s){s.keyCode==16&&(this.doc.sel.shift=!1),nt(this,s)}function qm(s){var c=this;if(!(s.target&&s.target!=c.display.input.getField())&&!(Qi(c.display,s)||nt(c,s)||s.ctrlKey&&!s.altKey||M&&s.metaKey)){var v=s.keyCode,p=s.charCode;if(w&&v==pf){pf=null,gt(s);return}if(!(w&&(!s.which||s.which<10)&&Wm(c,s))){var m=String.fromCharCode(p??v);m!="\b"&&(EE(c,s,m)||c.display.input.onKeyPress(s))}}}var kE=400,vf=function(s,c,v){this.time=s,this.pos=c,this.button=v};vf.prototype.compare=function(s,c,v){return this.time+kE>s&&we(c,this.pos)==0&&v==this.button};var tl,nl;function OE(s,c){var v=+new Date;return nl&&nl.compare(v,s,c)?(tl=nl=null,"triple"):tl&&tl.compare(v,s,c)?(nl=new vf(v,s,c),tl=null,"double"):(tl=new vf(v,s,c),nl=null,"single")}function Xm(s){var c=this,v=c.display;if(!(nt(c,s)||v.activeTouch&&v.input.supportsTouch())){if(v.input.ensurePolled(),v.shift=s.shiftKey,Qi(v,s)){f||(v.scroller.draggable=!1,setTimeout(function(){return v.scroller.draggable=!0},100));return}if(!gf(c,s)){var p=$o(c,s),m=mn(s),C=p?OE(p,m):"single";W(c).focus(),m==1&&c.state.selectingText&&c.state.selectingText(s),!(p&&NE(c,m,p,C,s))&&(m==1?p?AE(c,p,C,s):Qn(s)==v.scroller&&gt(s):m==2?(p&&Su(c.doc,p),setTimeout(function(){return v.input.focus()},20)):m==3&&(ne?c.display.input.onContextMenu(s):Yc(c)))}}}function NE(s,c,v,p,m){var C="Click";return p=="double"?C="Double"+C:p=="triple"&&(C="Triple"+C),C=(c==1?"Left":c==2?"Middle":"Right")+C,el(s,jm(C,m),m,function(N){if(typeof N=="string"&&(N=Qs[N]),!N)return!1;var P=!1;try{s.isReadOnly()&&(s.state.suppressEdits=!0),P=N(s,v)!=ft}finally{s.state.suppressEdits=!1}return P})}function ME(s,c,v){var p=s.getOption("configureMouse"),m=p?p(s,c,v):{};if(m.unit==null){var C=R?v.shiftKey&&v.metaKey:v.altKey;m.unit=C?"rectangle":c=="single"?"char":c=="double"?"word":"line"}return(m.extend==null||s.doc.extend)&&(m.extend=s.doc.extend||v.shiftKey),m.addNew==null&&(m.addNew=M?v.metaKey:v.ctrlKey),m.moveOnDrag==null&&(m.moveOnDrag=!(M?v.altKey:v.ctrlKey)),m}function AE(s,c,v,p){u?setTimeout(Y(Gg,s),0):s.curOp.focus=rt(de(s));var m=ME(s,v,p),C=s.doc.sel,N;s.options.dragDrop&&zn&&!s.isReadOnly()&&v=="single"&&(N=C.contains(c))>-1&&(we((N=C.ranges[N]).from(),c)<0||c.xRel>0)&&(we(N.to(),c)>0||c.xRel<0)?TE(s,p,c,m):DE(s,p,c,m)}function TE(s,c,v,p){var m=s.display,C=!1,N=Vn(s,function(z){f&&(m.scroller.draggable=!1),s.state.draggingText=!1,s.state.delayingBlurEvent&&(s.hasFocus()?s.state.delayingBlurEvent=!1:Yc(s)),Ye(m.wrapper.ownerDocument,"mouseup",N),Ye(m.wrapper.ownerDocument,"mousemove",P),Ye(m.scroller,"dragstart",B),Ye(m.scroller,"drop",N),C||(gt(z),p.addNew||Su(s.doc,v,null,null,p.extend),f&&!x||u&&d==9?setTimeout(function(){m.wrapper.ownerDocument.body.focus({preventScroll:!0}),m.input.focus()},20):m.input.focus())}),P=function(z){C=C||Math.abs(c.clientX-z.clientX)+Math.abs(c.clientY-z.clientY)>=10},B=function(){return C=!0};f&&(m.scroller.draggable=!0),s.state.draggingText=N,N.copy=!p.moveOnDrag,Re(m.wrapper.ownerDocument,"mouseup",N),Re(m.wrapper.ownerDocument,"mousemove",P),Re(m.scroller,"dragstart",B),Re(m.scroller,"drop",N),s.state.delayingBlurEvent=!0,setTimeout(function(){return m.input.focus()},20),m.scroller.dragDrop&&m.scroller.dragDrop()}function Gm(s,c,v){if(v=="char")return new sn(c,c);if(v=="word")return s.findWordAt(c);if(v=="line")return new sn(me(c.line,0),Bt(s.doc,me(c.line+1,0)));var p=v(s,c);return new sn(p.from,p.to)}function DE(s,c,v,p){u&&Yc(s);var m=s.display,C=s.doc;gt(c);var N,P,B=C.sel,z=B.ranges;if(p.addNew&&!p.extend?(P=C.sel.contains(v),P>-1?N=z[P]:N=new sn(v,v)):(N=C.sel.primary(),P=C.sel.primIndex),p.unit=="rectangle")p.addNew||(N=new sn(v,v)),v=$o(s,c,!0,!0),P=-1;else{var re=Gm(s,v,p.unit);p.extend?N=uf(N,re.anchor,re.head,p.extend):N=re}p.addNew?P==-1?(P=z.length,er(C,fi(s,z.concat([N]),P),{scroll:!1,origin:"*mouse"})):z.length>1&&z[P].empty()&&p.unit=="char"&&!p.extend?(er(C,fi(s,z.slice(0,P).concat(z.slice(P+1)),0),{scroll:!1,origin:"*mouse"}),B=C.sel):df(C,P,N,Nt):(P=0,er(C,new qr([N],0),Nt),B=C.sel);var ae=v;function ye(ut){if(we(ae,ut)!=0)if(ae=ut,p.unit=="rectangle"){for(var _t=[],Tt=s.options.tabSize,At=ge(Ge(C,v.line).text,v.ch,Tt),Ut=ge(Ge(C,ut.line).text,ut.ch,Tt),hn=Math.min(At,Ut),Xn=Math.max(At,Ut),wn=Math.min(v.line,ut.line),Rr=Math.min(s.lastLine(),Math.max(v.line,ut.line));wn<=Rr;wn++){var _r=Ge(C,wn).text,Tn=Wt(_r,hn,Tt);hn==Xn?_t.push(new sn(me(wn,Tn),me(wn,Tn))):_r.length>Tn&&_t.push(new sn(me(wn,Tn),me(wn,Wt(_r,Xn,Tt))))}_t.length||_t.push(new sn(v,v)),er(C,fi(s,B.ranges.slice(0,P).concat(_t),P),{origin:"*mouse",scroll:!1}),s.scrollIntoView(ut)}else{var br=N,Jn=Gm(s,ut,p.unit),Bn=br.anchor,Dn;we(Jn.anchor,Bn)>0?(Dn=Jn.head,Bn=Mn(br.from(),Jn.anchor)):(Dn=Jn.anchor,Bn=Pt(br.to(),Jn.head));var Cn=B.ranges.slice(0);Cn[P]=LE(s,new sn(Bt(C,Bn),Dn)),er(C,fi(s,Cn,P),Nt)}}var pe=m.wrapper.getBoundingClientRect(),Ie=0;function We(ut){var _t=++Ie,Tt=$o(s,ut,!0,p.unit=="rectangle");if(Tt)if(we(Tt,ae)!=0){s.curOp.focus=rt(de(s)),ye(Tt);var At=mu(m,C);(Tt.line>=At.to||Tt.line<At.from)&&setTimeout(Vn(s,function(){Ie==_t&&We(ut)}),150)}else{var Ut=ut.clientY<pe.top?-20:ut.clientY>pe.bottom?20:0;Ut&&setTimeout(Vn(s,function(){Ie==_t&&(m.scroller.scrollTop+=Ut,We(ut))}),50)}}function et(ut){s.state.selectingText=!1,Ie=1/0,ut&&(gt(ut),m.input.focus()),Ye(m.wrapper.ownerDocument,"mousemove",lt),Ye(m.wrapper.ownerDocument,"mouseup",ht),C.history.lastSelOrigin=null}var lt=Vn(s,function(ut){ut.buttons===0||!mn(ut)?et(ut):We(ut)}),ht=Vn(s,et);s.state.selectingText=ht,Re(m.wrapper.ownerDocument,"mousemove",lt),Re(m.wrapper.ownerDocument,"mouseup",ht)}function LE(s,c){var v=c.anchor,p=c.head,m=Ge(s.doc,v.line);if(we(v,p)==0&&v.sticky==p.sticky)return c;var C=at(m);if(!C)return c;var N=dt(C,v.ch,v.sticky),P=C[N];if(P.from!=v.ch&&P.to!=v.ch)return c;var B=N+(P.from==v.ch==(P.level!=1)?0:1);if(B==0||B==C.length)return c;var z;if(p.line!=v.line)z=(p.line-v.line)*(s.doc.direction=="ltr"?1:-1)>0;else{var re=dt(C,p.ch,p.sticky),ae=re-N||(p.ch-v.ch)*(P.level==1?-1:1);re==B-1||re==B?z=ae<0:z=ae>0}var ye=C[B+(z?-1:0)],pe=z==(ye.level==1),Ie=pe?ye.from:ye.to,We=pe?"after":"before";return v.ch==Ie&&v.sticky==We?c:new sn(new me(v.line,Ie,We),p)}function Ym(s,c,v,p){var m,C;if(c.touches)m=c.touches[0].clientX,C=c.touches[0].clientY;else try{m=c.clientX,C=c.clientY}catch{return!1}if(m>=Math.floor(s.display.gutters.getBoundingClientRect().right))return!1;p&&gt(c);var N=s.display,P=N.lineDiv.getBoundingClientRect();if(C>P.bottom||!xe(s,v))return qt(c);C-=P.top-N.viewOffset;for(var B=0;B<s.display.gutterSpecs.length;++B){var z=N.gutters.childNodes[B];if(z&&z.getBoundingClientRect().right>=m){var re=X(s.doc,C),ae=s.display.gutterSpecs[B];return Qe(s,v,s,re,ae.className,c),qt(c)}}}function gf(s,c){return Ym(s,c,"gutterClick",!0)}function Km(s,c){Qi(s.display,c)||PE(s,c)||nt(s,c,"contextmenu")||ne||s.display.input.onContextMenu(c)}function PE(s,c){return xe(s,"gutterContextMenu")?Ym(s,c,"gutterContextMenu",!1):!1}function Jm(s){s.display.wrapper.className=s.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+s.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Is(s)}var La={toString:function(){return"CodeMirror.Init"}},Zm={},Au={};function RE(s){var c=s.optionHandlers;function v(p,m,C,N){s.defaults[p]=m,C&&(c[p]=N?function(P,B,z){z!=La&&C(P,B,z)}:C)}s.defineOption=v,s.Init=La,v("value","",function(p,m){return p.setValue(m)},!0),v("mode",null,function(p,m){p.doc.modeOption=m,af(p)},!0),v("indentUnit",2,af,!0),v("indentWithTabs",!1),v("smartIndent",!0),v("tabSize",4,function(p){Us(p),Is(p),mr(p)},!0),v("lineSeparator",null,function(p,m){if(p.doc.lineSep=m,!!m){var C=[],N=p.doc.first;p.doc.iter(function(B){for(var z=0;;){var re=B.text.indexOf(m,z);if(re==-1)break;z=re+m.length,C.push(me(N,re))}N++});for(var P=C.length-1;P>=0;P--)Ma(p.doc,m,C[P],me(C[P].line,C[P].ch+m.length))}}),v("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(p,m,C){p.state.specialChars=new RegExp(m.source+(m.test("	")?"":"|	"),"g"),C!=La&&p.refresh()}),v("specialCharPlaceholder",dS,function(p){return p.refresh()},!0),v("electricChars",!0),v("inputStyle",O?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),v("spellcheck",!1,function(p,m){return p.getInputField().spellcheck=m},!0),v("autocorrect",!1,function(p,m){return p.getInputField().autocorrect=m},!0),v("autocapitalize",!1,function(p,m){return p.getInputField().autocapitalize=m},!0),v("rtlMoveVisually",!T),v("wholeLineUpdateBefore",!0),v("theme","default",function(p){Jm(p),Ws(p)},!0),v("keyMap","default",function(p,m,C){var N=Nu(m),P=C!=La&&Nu(C);P&&P.detach&&P.detach(p,N),N.attach&&N.attach(p,P||null)}),v("extraKeys",null),v("configureMouse",null),v("lineWrapping",!1,BE,!0),v("gutters",[],function(p,m){p.display.gutterSpecs=rf(m,p.options.lineNumbers),Ws(p)},!0),v("fixedGutter",!0,function(p,m){p.display.gutters.style.left=m?Vc(p.display)+"px":"0",p.refresh()},!0),v("coverGutterNextToScrollbar",!1,function(p){return Ca(p)},!0),v("scrollbarStyle","native",function(p){em(p),Ca(p),p.display.scrollbars.setScrollTop(p.doc.scrollTop),p.display.scrollbars.setScrollLeft(p.doc.scrollLeft)},!0),v("lineNumbers",!1,function(p,m){p.display.gutterSpecs=rf(p.options.gutters,m),Ws(p)},!0),v("firstLineNumber",1,Ws,!0),v("lineNumberFormatter",function(p){return p},Ws,!0),v("showCursorWhenSelecting",!1,Bs,!0),v("resetSelectionOnContextMenu",!0),v("lineWiseCopyCut",!0),v("pasteLinesPerSelection",!0),v("selectionsMayTouch",!1),v("readOnly",!1,function(p,m){m=="nocursor"&&(Sa(p),p.display.input.blur()),p.display.input.readOnlyChanged(m)}),v("screenReaderLabel",null,function(p,m){m=m===""?null:m,p.display.input.screenReaderLabelChanged(m)}),v("disableInput",!1,function(p,m){m||p.display.input.reset()},!0),v("dragDrop",!0,IE),v("allowDropFileTypes",null),v("cursorBlinkRate",530),v("cursorScrollMargin",0),v("cursorHeight",1,Bs,!0),v("singleCursorHeightPerLine",!0,Bs,!0),v("workTime",100),v("workDelay",100),v("flattenSpans",!0,Us,!0),v("addModeClass",!1,Us,!0),v("pollInterval",100),v("undoDepth",200,function(p,m){return p.doc.history.undoDepth=m}),v("historyEventDelay",1250),v("viewportMargin",10,function(p){return p.refresh()},!0),v("maxHighlightLength",1e4,Us,!0),v("moveInputWithCursor",!0,function(p,m){m||p.display.input.resetPosition()}),v("tabindex",null,function(p,m){return p.display.input.getField().tabIndex=m||""}),v("autofocus",null),v("direction","ltr",function(p,m){return p.doc.setDirection(m)},!0),v("phrases",null)}function IE(s,c,v){var p=v&&v!=La;if(!c!=!p){var m=s.display.dragFunctions,C=c?Re:Ye;C(s.display.scroller,"dragstart",m.start),C(s.display.scroller,"dragenter",m.enter),C(s.display.scroller,"dragover",m.over),C(s.display.scroller,"dragleave",m.leave),C(s.display.scroller,"drop",m.drop)}}function BE(s){s.options.lineWrapping?(Me(s.display.wrapper,"CodeMirror-wrap"),s.display.sizer.style.minWidth="",s.display.sizerWidth=null):(J(s.display.wrapper,"CodeMirror-wrap"),Rc(s)),qc(s),mr(s),Is(s),setTimeout(function(){return Ca(s)},100)}function _n(s,c){var v=this;if(!(this instanceof _n))return new _n(s,c);this.options=c=c?se(c):{},se(Zm,c,!1);var p=c.value;typeof p=="string"?p=new yr(p,c.mode,null,c.lineSeparator,c.direction):c.mode&&(p.modeOption=c.mode),this.doc=p;var m=new _n.inputStyles[c.inputStyle](this),C=this.display=new KS(s,p,m,c);C.wrapper.CodeMirror=this,Jm(this),c.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),em(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Pe,keySeq:null,specialChars:null},c.autofocus&&!O&&C.input.focus(),u&&d<11&&setTimeout(function(){return v.display.input.reset(!0)},20),jE(this),vE(),Uo(this),this.curOp.forceUpdate=!0,dm(this,p),c.autofocus&&!O||this.hasFocus()?setTimeout(function(){v.hasFocus()&&!v.state.focused&&Kc(v)},20):Sa(this);for(var N in Au)Au.hasOwnProperty(N)&&Au[N](this,c[N],La);rm(this),c.finishInit&&c.finishInit(this);for(var P=0;P<mf.length;++P)mf[P](this);Vo(this),f&&c.lineWrapping&&getComputedStyle(C.lineDiv).textRendering=="optimizelegibility"&&(C.lineDiv.style.textRendering="auto")}_n.defaults=Zm,_n.optionHandlers=Au;function jE(s){var c=s.display;Re(c.scroller,"mousedown",Vn(s,Xm)),u&&d<11?Re(c.scroller,"dblclick",Vn(s,function(B){if(!nt(s,B)){var z=$o(s,B);if(!(!z||gf(s,B)||Qi(s.display,B))){gt(B);var re=s.findWordAt(z);Su(s.doc,re.anchor,re.head)}}})):Re(c.scroller,"dblclick",function(B){return nt(s,B)||gt(B)}),Re(c.scroller,"contextmenu",function(B){return Km(s,B)}),Re(c.input.getField(),"contextmenu",function(B){c.scroller.contains(B.target)||Km(s,B)});var v,p={end:0};function m(){c.activeTouch&&(v=setTimeout(function(){return c.activeTouch=null},1e3),p=c.activeTouch,p.end=+new Date)}function C(B){if(B.touches.length!=1)return!1;var z=B.touches[0];return z.radiusX<=1&&z.radiusY<=1}function N(B,z){if(z.left==null)return!0;var re=z.left-B.left,ae=z.top-B.top;return re*re+ae*ae>20*20}Re(c.scroller,"touchstart",function(B){if(!nt(s,B)&&!C(B)&&!gf(s,B)){c.input.ensurePolled(),clearTimeout(v);var z=+new Date;c.activeTouch={start:z,moved:!1,prev:z-p.end<=300?p:null},B.touches.length==1&&(c.activeTouch.left=B.touches[0].pageX,c.activeTouch.top=B.touches[0].pageY)}}),Re(c.scroller,"touchmove",function(){c.activeTouch&&(c.activeTouch.moved=!0)}),Re(c.scroller,"touchend",function(B){var z=c.activeTouch;if(z&&!Qi(c,B)&&z.left!=null&&!z.moved&&new Date-z.start<300){var re=s.coordsChar(c.activeTouch,"page"),ae;!z.prev||N(z,z.prev)?ae=new sn(re,re):!z.prev.prev||N(z,z.prev.prev)?ae=s.findWordAt(re):ae=new sn(me(re.line,0),Bt(s.doc,me(re.line+1,0))),s.setSelection(ae.anchor,ae.head),s.focus(),gt(B)}m()}),Re(c.scroller,"touchcancel",m),Re(c.scroller,"scroll",function(){c.scroller.clientHeight&&(Hs(s,c.scroller.scrollTop),zo(s,c.scroller.scrollLeft,!0),Qe(s,"scroll",s))}),Re(c.scroller,"mousewheel",function(B){return am(s,B)}),Re(c.scroller,"DOMMouseScroll",function(B){return am(s,B)}),Re(c.wrapper,"scroll",function(){return c.wrapper.scrollTop=c.wrapper.scrollLeft=0}),c.dragFunctions={enter:function(B){nt(s,B)||Gt(B)},over:function(B){nt(s,B)||(pE(s,B),Gt(B))},start:function(B){return hE(s,B)},drop:Vn(s,fE),leave:function(B){nt(s,B)||Pm(s)}};var P=c.input.getField();Re(P,"keyup",function(B){return Vm.call(s,B)}),Re(P,"keydown",Vn(s,Um)),Re(P,"keypress",Vn(s,qm)),Re(P,"focus",function(B){return Kc(s,B)}),Re(P,"blur",function(B){return Sa(s,B)})}var mf=[];_n.defineInitHook=function(s){return mf.push(s)};function rl(s,c,v,p){var m=s.doc,C;v==null&&(v="add"),v=="smart"&&(m.mode.indent?C=uo(s,c).state:v="prev");var N=s.options.tabSize,P=Ge(m,c),B=ge(P.text,null,N);P.stateAfter&&(P.stateAfter=null);var z=P.text.match(/^\s*/)[0],re;if(!p&&!/\S/.test(P.text))re=0,v="not";else if(v=="smart"&&(re=m.mode.indent(C,P.text.slice(z.length),P.text),re==ft||re>150)){if(!p)return;v="prev"}v=="prev"?c>m.first?re=ge(Ge(m,c-1).text,null,N):re=0:v=="add"?re=B+s.options.indentUnit:v=="subtract"?re=B-s.options.indentUnit:typeof v=="number"&&(re=B+v),re=Math.max(0,re);var ae="",ye=0;if(s.options.indentWithTabs)for(var pe=Math.floor(re/N);pe;--pe)ye+=N,ae+="	";if(ye<re&&(ae+=te(re-ye)),ae!=z)return Ma(m,ae,me(c,0),me(c,z.length),"+input"),P.stateAfter=null,!0;for(var Ie=0;Ie<m.sel.ranges.length;Ie++){var We=m.sel.ranges[Ie];if(We.head.line==c&&We.head.ch<z.length){var et=me(c,z.length);df(m,Ie,new sn(et,et));break}}}var hi=null;function Tu(s){hi=s}function yf(s,c,v,p,m){var C=s.doc;s.display.shift=!1,p||(p=C.sel);var N=+new Date-200,P=m=="paste"||s.state.pasteIncoming>N,B=Nn(c),z=null;if(P&&p.ranges.length>1)if(hi&&hi.text.join(`
`)==c){if(p.ranges.length%hi.text.length==0){z=[];for(var re=0;re<hi.text.length;re++)z.push(C.splitLines(hi.text[re]))}}else B.length==p.ranges.length&&s.options.pasteLinesPerSelection&&(z=F(B,function(lt){return[lt]}));for(var ae=s.curOp.updateInput,ye=p.ranges.length-1;ye>=0;ye--){var pe=p.ranges[ye],Ie=pe.from(),We=pe.to();pe.empty()&&(v&&v>0?Ie=me(Ie.line,Ie.ch-v):s.state.overwrite&&!P?We=me(We.line,Math.min(Ge(C,We.line).text.length,We.ch+A(B).length)):P&&hi&&hi.lineWise&&hi.text.join(`
`)==B.join(`
`)&&(Ie=We=me(Ie.line,0)));var et={from:Ie,to:We,text:z?z[ye%z.length]:B,origin:m||(P?"paste":s.state.cutIncoming>N?"cut":"+input")};Na(s.doc,et),Un(s,"inputRead",s,et)}c&&!P&&ey(s,c),Ea(s),s.curOp.updateInput<2&&(s.curOp.updateInput=ae),s.curOp.typing=!0,s.state.pasteIncoming=s.state.cutIncoming=-1}function Qm(s,c){var v=s.clipboardData&&s.clipboardData.getData("Text");if(v)return s.preventDefault(),!c.isReadOnly()&&!c.options.disableInput&&c.hasFocus()&&Pr(c,function(){return yf(c,v,0,null,"paste")}),!0}function ey(s,c){if(!(!s.options.electricChars||!s.options.smartIndent))for(var v=s.doc.sel,p=v.ranges.length-1;p>=0;p--){var m=v.ranges[p];if(!(m.head.ch>100||p&&v.ranges[p-1].head.line==m.head.line)){var C=s.getModeAt(m.head),N=!1;if(C.electricChars){for(var P=0;P<C.electricChars.length;P++)if(c.indexOf(C.electricChars.charAt(P))>-1){N=rl(s,m.head.line,"smart");break}}else C.electricInput&&C.electricInput.test(Ge(s.doc,m.head.line).text.slice(0,m.head.ch))&&(N=rl(s,m.head.line,"smart"));N&&Un(s,"electricInput",s,m.head.line)}}}function ty(s){for(var c=[],v=[],p=0;p<s.doc.sel.ranges.length;p++){var m=s.doc.sel.ranges[p].head.line,C={anchor:me(m,0),head:me(m+1,0)};v.push(C),c.push(s.getRange(C.anchor,C.head))}return{text:c,ranges:v}}function _f(s,c,v,p){s.setAttribute("autocorrect",v?"on":"off"),s.setAttribute("autocapitalize",p?"on":"off"),s.setAttribute("spellcheck",!!c)}function ny(){var s=j("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),c=j("div",[s],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return f?s.style.width="1000px":s.setAttribute("wrap","off"),S&&(s.style.border="1px solid black"),c}function HE(s){var c=s.optionHandlers,v=s.helpers={};s.prototype={constructor:s,focus:function(){W(this).focus(),this.display.input.focus()},setOption:function(p,m){var C=this.options,N=C[p];C[p]==m&&p!="mode"||(C[p]=m,c.hasOwnProperty(p)&&Vn(this,c[p])(this,m,N),Qe(this,"optionChange",this,p))},getOption:function(p){return this.options[p]},getDoc:function(){return this.doc},addKeyMap:function(p,m){this.state.keyMaps[m?"push":"unshift"](Nu(p))},removeKeyMap:function(p){for(var m=this.state.keyMaps,C=0;C<m.length;++C)if(m[C]==p||m[C].name==p)return m.splice(C,1),!0},addOverlay:cr(function(p,m){var C=p.token?p:s.getMode(this.options,p);if(C.startState)throw new Error("Overlays may not be stateful.");ee(this.state.overlays,{mode:C,modeSpec:p,opaque:m&&m.opaque,priority:m&&m.priority||0},function(N){return N.priority}),this.state.modeGen++,mr(this)}),removeOverlay:cr(function(p){for(var m=this.state.overlays,C=0;C<m.length;++C){var N=m[C].modeSpec;if(N==p||typeof p=="string"&&N.name==p){m.splice(C,1),this.state.modeGen++,mr(this);return}}}),indentLine:cr(function(p,m,C){typeof m!="string"&&typeof m!="number"&&(m==null?m=this.options.smartIndent?"smart":"prev":m=m?"add":"subtract"),he(this.doc,p)&&rl(this,p,m,C)}),indentSelection:cr(function(p){for(var m=this.doc.sel.ranges,C=-1,N=0;N<m.length;N++){var P=m[N];if(P.empty())P.head.line>C&&(rl(this,P.head.line,p,!0),C=P.head.line,N==this.doc.sel.primIndex&&Ea(this));else{var B=P.from(),z=P.to(),re=Math.max(C,B.line);C=Math.min(this.lastLine(),z.line-(z.ch?0:1))+1;for(var ae=re;ae<C;++ae)rl(this,ae,p);var ye=this.doc.sel.ranges;B.ch==0&&m.length==ye.length&&ye[N].from().ch>0&&df(this.doc,N,new sn(B,ye[N].to()),Ke)}}}),getTokenAt:function(p,m){return fg(this,p,m)},getLineTokens:function(p,m){return fg(this,me(p),m,!0)},getTokenTypeAt:function(p){p=Bt(this.doc,p);var m=iu(this,Ge(this.doc,p.line)),C=0,N=(m.length-1)/2,P=p.ch,B;if(P==0)B=m[2];else for(;;){var z=C+N>>1;if((z?m[z*2-1]:0)>=P)N=z;else if(m[z*2+1]<P)C=z+1;else{B=m[z*2+2];break}}var re=B?B.indexOf("overlay "):-1;return re<0?B:re==0?null:B.slice(0,re-1)},getModeAt:function(p){var m=this.doc.mode;return m.innerMode?s.innerMode(m,this.getTokenAt(p).state).mode:m},getHelper:function(p,m){return this.getHelpers(p,m)[0]},getHelpers:function(p,m){var C=[];if(!v.hasOwnProperty(m))return C;var N=v[m],P=this.getModeAt(p);if(typeof P[m]=="string")N[P[m]]&&C.push(N[P[m]]);else if(P[m])for(var B=0;B<P[m].length;B++){var z=N[P[m][B]];z&&C.push(z)}else P.helperType&&N[P.helperType]?C.push(N[P.helperType]):N[P.name]&&C.push(N[P.name]);for(var re=0;re<N._global.length;re++){var ae=N._global[re];ae.pred(P,this)&&Le(C,ae.val)==-1&&C.push(ae.val)}return C},getStateAfter:function(p,m){var C=this.doc;return p=Ts(C,p??C.first+C.size-1),uo(this,p+1,m).state},cursorCoords:function(p,m){var C,N=this.doc.sel.primary();return p==null?C=N.head:typeof p=="object"?C=Bt(this.doc,p):C=p?N.from():N.to(),ci(this,C,m||"page")},charCoords:function(p,m){return hu(this,Bt(this.doc,p),m||"page")},coordsChar:function(p,m){return p=Fg(this,p,m||"page"),zc(this,p.left,p.top)},lineAtHeight:function(p,m){return p=Fg(this,{top:p,left:0},m||"page").top,X(this.doc,p+this.display.viewOffset)},heightAtLine:function(p,m,C){var N=!1,P;if(typeof p=="number"){var B=this.doc.first+this.doc.size-1;p<this.doc.first?p=this.doc.first:p>B&&(p=B,N=!0),P=Ge(this.doc,p)}else P=p;return fu(this,P,{top:0,left:0},m||"page",C||N).top+(N?this.doc.height-Zi(P):0)},defaultTextHeight:function(){return xa(this.display)},defaultCharWidth:function(){return wa(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(p,m,C,N,P){var B=this.display;p=ci(this,Bt(this.doc,p));var z=p.bottom,re=p.left;if(m.style.position="absolute",m.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(m),B.sizer.appendChild(m),N=="over")z=p.top;else if(N=="above"||N=="near"){var ae=Math.max(B.wrapper.clientHeight,this.doc.height),ye=Math.max(B.sizer.clientWidth,B.lineSpace.clientWidth);(N=="above"||p.bottom+m.offsetHeight>ae)&&p.top>m.offsetHeight?z=p.top-m.offsetHeight:p.bottom+m.offsetHeight<=ae&&(z=p.bottom),re+m.offsetWidth>ye&&(re=ye-m.offsetWidth)}m.style.top=z+"px",m.style.left=m.style.right="",P=="right"?(re=B.sizer.clientWidth-m.offsetWidth,m.style.right="0px"):(P=="left"?re=0:P=="middle"&&(re=(B.sizer.clientWidth-m.offsetWidth)/2),m.style.left=re+"px"),C&&IS(this,{left:re,top:z,right:re+m.offsetWidth,bottom:z+m.offsetHeight})},triggerOnKeyDown:cr(Um),triggerOnKeyPress:cr(qm),triggerOnKeyUp:Vm,triggerOnMouseDown:cr(Xm),execCommand:function(p){if(Qs.hasOwnProperty(p))return Qs[p].call(null,this)},triggerElectric:cr(function(p){ey(this,p)}),findPosH:function(p,m,C,N){var P=1;m<0&&(P=-1,m=-m);for(var B=Bt(this.doc,p),z=0;z<m&&(B=bf(this.doc,B,P,C,N),!B.hitSide);++z);return B},moveH:cr(function(p,m){var C=this;this.extendSelectionsBy(function(N){return C.display.shift||C.doc.extend||N.empty()?bf(C.doc,N.head,p,m,C.options.rtlMoveVisually):p<0?N.from():N.to()},yt)}),deleteH:cr(function(p,m){var C=this.doc.sel,N=this.doc;C.somethingSelected()?N.replaceSelection("",null,"+delete"):Da(this,function(P){var B=bf(N,P.head,p,m,!1);return p<0?{from:B,to:P.head}:{from:P.head,to:B}})}),findPosV:function(p,m,C,N){var P=1,B=N;m<0&&(P=-1,m=-m);for(var z=Bt(this.doc,p),re=0;re<m;++re){var ae=ci(this,z,"div");if(B==null?B=ae.left:ae.left=B,z=ry(this,ae,P,C),z.hitSide)break}return z},moveV:cr(function(p,m){var C=this,N=this.doc,P=[],B=!this.display.shift&&!N.extend&&N.sel.somethingSelected();if(N.extendSelectionsBy(function(re){if(B)return p<0?re.from():re.to();var ae=ci(C,re.head,"div");re.goalColumn!=null&&(ae.left=re.goalColumn),P.push(ae.left);var ye=ry(C,ae,p,m);return m=="page"&&re==N.sel.primary()&&Zc(C,hu(C,ye,"div").top-ae.top),ye},yt),P.length)for(var z=0;z<N.sel.ranges.length;z++)N.sel.ranges[z].goalColumn=P[z]}),findWordAt:function(p){var m=this.doc,C=Ge(m,p.line).text,N=p.ch,P=p.ch;if(C){var B=this.getHelper(p,"wordChars");(p.sticky=="before"||P==C.length)&&N?--N:++P;for(var z=C.charAt(N),re=Ce(z,B)?function(ae){return Ce(ae,B)}:/\s/.test(z)?function(ae){return/\s/.test(ae)}:function(ae){return!/\s/.test(ae)&&!Ce(ae)};N>0&&re(C.charAt(N-1));)--N;for(;P<C.length&&re(C.charAt(P));)++P}return new sn(me(p.line,N),me(p.line,P))},toggleOverwrite:function(p){p!=null&&p==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Me(this.display.cursorDiv,"CodeMirror-overwrite"):J(this.display.cursorDiv,"CodeMirror-overwrite"),Qe(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==rt(de(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:cr(function(p,m){js(this,p,m)}),getScrollInfo:function(){var p=this.display.scroller;return{left:p.scrollLeft,top:p.scrollTop,height:p.scrollHeight-Ri(this)-this.display.barHeight,width:p.scrollWidth-Ri(this)-this.display.barWidth,clientHeight:jc(this),clientWidth:jo(this)}},scrollIntoView:cr(function(p,m){p==null?(p={from:this.doc.sel.primary().head,to:null},m==null&&(m=this.options.cursorScrollMargin)):typeof p=="number"?p={from:me(p,0),to:null}:p.from==null&&(p={from:p,to:null}),p.to||(p.to=p.from),p.margin=m||0,p.from.line!=null?BS(this,p):Kg(this,p.from,p.to,p.margin)}),setSize:cr(function(p,m){var C=this,N=function(B){return typeof B=="number"||/^\d+$/.test(String(B))?B+"px":B};p!=null&&(this.display.wrapper.style.width=N(p)),m!=null&&(this.display.wrapper.style.height=N(m)),this.options.lineWrapping&&jg(this);var P=this.display.viewFrom;this.doc.iter(P,this.display.viewTo,function(B){if(B.widgets){for(var z=0;z<B.widgets.length;z++)if(B.widgets[z].noHScroll){fo(C,P,"widget");break}}++P}),this.curOp.forceUpdate=!0,Qe(this,"refresh",this)}),operation:function(p){return Pr(this,p)},startOperation:function(){return Uo(this)},endOperation:function(){return Vo(this)},refresh:cr(function(){var p=this.display.cachedTextHeight;mr(this),this.curOp.forceUpdate=!0,Is(this),js(this,this.doc.scrollLeft,this.doc.scrollTop),tf(this.display),(p==null||Math.abs(p-xa(this.display))>.5||this.options.lineWrapping)&&qc(this),Qe(this,"refresh",this)}),swapDoc:cr(function(p){var m=this.doc;return m.cm=null,this.state.selectingText&&this.state.selectingText(),dm(this,p),Is(this),this.display.input.reset(),js(this,p.scrollLeft,p.scrollTop),this.curOp.forceScroll=!0,Un(this,"swapDoc",this,m),m}),phrase:function(p){var m=this.options.phrases;return m&&Object.prototype.hasOwnProperty.call(m,p)?m[p]:p},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},qe(s),s.registerHelper=function(p,m,C){v.hasOwnProperty(p)||(v[p]=s[p]={_global:[]}),v[p][m]=C},s.registerGlobalHelper=function(p,m,C,N){s.registerHelper(p,m,N),v[p]._global.push({pred:C,val:N})}}function bf(s,c,v,p,m){var C=c,N=v,P=Ge(s,c.line),B=m&&s.direction=="rtl"?-v:v;function z(){var ht=c.line+B;return ht<s.first||ht>=s.first+s.size?!1:(c=new me(ht,c.ch,c.sticky),P=Ge(s,ht))}function re(ht){var ut;if(p=="codepoint"){var _t=P.text.charCodeAt(c.ch+(v>0?0:-1));if(isNaN(_t))ut=null;else{var Tt=v>0?_t>=55296&&_t<56320:_t>=56320&&_t<57343;ut=new me(c.line,Math.max(0,Math.min(P.text.length,c.ch+v*(Tt?2:1))),-v)}}else m?ut=bE(s.cm,P,c,v):ut=ff(P,c,v);if(ut==null)if(!ht&&z())c=hf(m,s.cm,P,c.line,B);else return!1;else c=ut;return!0}if(p=="char"||p=="codepoint")re();else if(p=="column")re(!0);else if(p=="word"||p=="group")for(var ae=null,ye=p=="group",pe=s.cm&&s.cm.getHelper(c,"wordChars"),Ie=!0;!(v<0&&!re(!Ie));Ie=!1){var We=P.text.charAt(c.ch)||`
`,et=Ce(We,pe)?"w":ye&&We==`
`?"n":!ye||/\s/.test(We)?null:"p";if(ye&&!Ie&&!et&&(et="s"),ae&&ae!=et){v<0&&(v=1,re(),c.sticky="after");break}if(et&&(ae=et),v>0&&!re(!Ie))break}var lt=Cu(s,c,C,N,!0);return it(C,lt)&&(lt.hitSide=!0),lt}function ry(s,c,v,p){var m=s.doc,C=c.left,N;if(p=="page"){var P=Math.min(s.display.wrapper.clientHeight,W(s).innerHeight||m(s).documentElement.clientHeight),B=Math.max(P-.5*xa(s.display),3);N=(v>0?c.bottom:c.top)+v*B}else p=="line"&&(N=v>0?c.bottom+3:c.top-3);for(var z;z=zc(s,C,N),!!z.outside;){if(v<0?N<=0:N>=m.height){z.hitSide=!0;break}N+=v*5}return z}var cn=function(s){this.cm=s,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pe,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};cn.prototype.init=function(s){var c=this,v=this,p=v.cm,m=v.div=s.lineDiv;m.contentEditable=!0,_f(m,p.options.spellcheck,p.options.autocorrect,p.options.autocapitalize);function C(P){for(var B=P.target;B;B=B.parentNode){if(B==m)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(B.className))break}return!1}Re(m,"paste",function(P){!C(P)||nt(p,P)||Qm(P,p)||d<=11&&setTimeout(Vn(p,function(){return c.updateFromDOM()}),20)}),Re(m,"compositionstart",function(P){c.composing={data:P.data,done:!1}}),Re(m,"compositionupdate",function(P){c.composing||(c.composing={data:P.data,done:!1})}),Re(m,"compositionend",function(P){c.composing&&(P.data!=c.composing.data&&c.readFromDOMSoon(),c.composing.done=!0)}),Re(m,"touchstart",function(){return v.forceCompositionEnd()}),Re(m,"input",function(){c.composing||c.readFromDOMSoon()});function N(P){if(!(!C(P)||nt(p,P))){if(p.somethingSelected())Tu({lineWise:!1,text:p.getSelections()}),P.type=="cut"&&p.replaceSelection("",null,"cut");else if(p.options.lineWiseCopyCut){var B=ty(p);Tu({lineWise:!0,text:B.text}),P.type=="cut"&&p.operation(function(){p.setSelections(B.ranges,0,Ke),p.replaceSelection("",null,"cut")})}else return;if(P.clipboardData){P.clipboardData.clearData();var z=hi.text.join(`
`);if(P.clipboardData.setData("Text",z),P.clipboardData.getData("Text")==z){P.preventDefault();return}}var re=ny(),ae=re.firstChild;_f(ae),p.display.lineSpace.insertBefore(re,p.display.lineSpace.firstChild),ae.value=hi.text.join(`
`);var ye=rt(le(m));Ve(ae),setTimeout(function(){p.display.lineSpace.removeChild(re),ye.focus(),ye==m&&v.showPrimarySelection()},50)}}Re(m,"copy",N),Re(m,"cut",N)},cn.prototype.screenReaderLabelChanged=function(s){s?this.div.setAttribute("aria-label",s):this.div.removeAttribute("aria-label")},cn.prototype.prepareSelection=function(){var s=Xg(this.cm,!1);return s.focus=rt(le(this.div))==this.div,s},cn.prototype.showSelection=function(s,c){!s||!this.cm.display.view.length||((s.focus||c)&&this.showPrimarySelection(),this.showMultipleSelections(s))},cn.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},cn.prototype.showPrimarySelection=function(){var s=this.getSelection(),c=this.cm,v=c.doc.sel.primary(),p=v.from(),m=v.to();if(c.display.viewTo==c.display.viewFrom||p.line>=c.display.viewTo||m.line<c.display.viewFrom){s.removeAllRanges();return}var C=Du(c,s.anchorNode,s.anchorOffset),N=Du(c,s.focusNode,s.focusOffset);if(!(C&&!C.bad&&N&&!N.bad&&we(Mn(C,N),p)==0&&we(Pt(C,N),m)==0)){var P=c.display.view,B=p.line>=c.display.viewFrom&&iy(c,p)||{node:P[0].measure.map[2],offset:0},z=m.line<c.display.viewTo&&iy(c,m);if(!z){var re=P[P.length-1].measure,ae=re.maps?re.maps[re.maps.length-1]:re.map;z={node:ae[ae.length-1],offset:ae[ae.length-2]-ae[ae.length-3]}}if(!B||!z){s.removeAllRanges();return}var ye=s.rangeCount&&s.getRangeAt(0),pe;try{pe=Ee(B.node,B.offset,z.offset,z.node)}catch{}pe&&(!i&&c.state.focused?(s.collapse(B.node,B.offset),pe.collapsed||(s.removeAllRanges(),s.addRange(pe))):(s.removeAllRanges(),s.addRange(pe)),ye&&s.anchorNode==null?s.addRange(ye):i&&this.startGracePeriod()),this.rememberSelection()}},cn.prototype.startGracePeriod=function(){var s=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){s.gracePeriod=!1,s.selectionChanged()&&s.cm.operation(function(){return s.cm.curOp.selectionChanged=!0})},20)},cn.prototype.showMultipleSelections=function(s){U(this.cm.display.cursorDiv,s.cursors),U(this.cm.display.selectionDiv,s.selection)},cn.prototype.rememberSelection=function(){var s=this.getSelection();this.lastAnchorNode=s.anchorNode,this.lastAnchorOffset=s.anchorOffset,this.lastFocusNode=s.focusNode,this.lastFocusOffset=s.focusOffset},cn.prototype.selectionInEditor=function(){var s=this.getSelection();if(!s.rangeCount)return!1;var c=s.getRangeAt(0).commonAncestorContainer;return _e(this.div,c)},cn.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||rt(le(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},cn.prototype.blur=function(){this.div.blur()},cn.prototype.getField=function(){return this.div},cn.prototype.supportsTouch=function(){return!0},cn.prototype.receivedFocus=function(){var s=this,c=this;this.selectionInEditor()?setTimeout(function(){return s.pollSelection()},20):Pr(this.cm,function(){return c.cm.curOp.selectionChanged=!0});function v(){c.cm.state.focused&&(c.pollSelection(),c.polling.set(c.cm.options.pollInterval,v))}this.polling.set(this.cm.options.pollInterval,v)},cn.prototype.selectionChanged=function(){var s=this.getSelection();return s.anchorNode!=this.lastAnchorNode||s.anchorOffset!=this.lastAnchorOffset||s.focusNode!=this.lastFocusNode||s.focusOffset!=this.lastFocusOffset},cn.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var s=this.getSelection(),c=this.cm;if(k&&g&&this.cm.display.gutterSpecs.length&&$E(s.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var v=Du(c,s.anchorNode,s.anchorOffset),p=Du(c,s.focusNode,s.focusOffset);v&&p&&Pr(c,function(){er(c.doc,po(v,p),Ke),(v.bad||p.bad)&&(c.curOp.selectionChanged=!0)})}}},cn.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var s=this.cm,c=s.display,v=s.doc.sel.primary(),p=v.from(),m=v.to();if(p.ch==0&&p.line>s.firstLine()&&(p=me(p.line-1,Ge(s.doc,p.line-1).length)),m.ch==Ge(s.doc,m.line).text.length&&m.line<s.lastLine()&&(m=me(m.line+1,0)),p.line<c.viewFrom||m.line>c.viewTo-1)return!1;var C,N,P;p.line==c.viewFrom||(C=Fo(s,p.line))==0?(N=L(c.view[0].line),P=c.view[0].node):(N=L(c.view[C].line),P=c.view[C-1].node.nextSibling);var B=Fo(s,m.line),z,re;if(B==c.view.length-1?(z=c.viewTo-1,re=c.lineDiv.lastChild):(z=L(c.view[B+1].line)-1,re=c.view[B+1].node.previousSibling),!P)return!1;for(var ae=s.doc.splitLines(FE(s,P,re,N,z)),ye=zt(s.doc,me(N,0),me(z,Ge(s.doc,z).text.length));ae.length>1&&ye.length>1;)if(A(ae)==A(ye))ae.pop(),ye.pop(),z--;else if(ae[0]==ye[0])ae.shift(),ye.shift(),N++;else break;for(var pe=0,Ie=0,We=ae[0],et=ye[0],lt=Math.min(We.length,et.length);pe<lt&&We.charCodeAt(pe)==et.charCodeAt(pe);)++pe;for(var ht=A(ae),ut=A(ye),_t=Math.min(ht.length-(ae.length==1?pe:0),ut.length-(ye.length==1?pe:0));Ie<_t&&ht.charCodeAt(ht.length-Ie-1)==ut.charCodeAt(ut.length-Ie-1);)++Ie;if(ae.length==1&&ye.length==1&&N==p.line)for(;pe&&pe>p.ch&&ht.charCodeAt(ht.length-Ie-1)==ut.charCodeAt(ut.length-Ie-1);)pe--,Ie++;ae[ae.length-1]=ht.slice(0,ht.length-Ie).replace(/^\u200b+/,""),ae[0]=ae[0].slice(pe).replace(/\u200b+$/,"");var Tt=me(N,pe),At=me(z,ye.length?A(ye).length-Ie:0);if(ae.length>1||ae[0]||we(Tt,At))return Ma(s.doc,ae,Tt,At,"+input"),!0},cn.prototype.ensurePolled=function(){this.forceCompositionEnd()},cn.prototype.reset=function(){this.forceCompositionEnd()},cn.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},cn.prototype.readFromDOMSoon=function(){var s=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(s.readDOMTimeout=null,s.composing)if(s.composing.done)s.composing=null;else return;s.updateFromDOM()},80))},cn.prototype.updateFromDOM=function(){var s=this;(this.cm.isReadOnly()||!this.pollContent())&&Pr(this.cm,function(){return mr(s.cm)})},cn.prototype.setUneditable=function(s){s.contentEditable="false"},cn.prototype.onKeyPress=function(s){s.charCode==0||this.composing||(s.preventDefault(),this.cm.isReadOnly()||Vn(this.cm,yf)(this.cm,String.fromCharCode(s.charCode==null?s.keyCode:s.charCode),0))},cn.prototype.readOnlyChanged=function(s){this.div.contentEditable=String(s!="nocursor")},cn.prototype.onContextMenu=function(){},cn.prototype.resetPosition=function(){},cn.prototype.needsContentAttribute=!0;function iy(s,c){var v=Hc(s,c.line);if(!v||v.hidden)return null;var p=Ge(s.doc,c.line),m=Lg(v,p,c.line),C=at(p,s.doc.direction),N="left";if(C){var P=dt(C,c.ch);N=P%2?"right":"left"}var B=Ig(m.map,c.ch,N);return B.offset=B.collapse=="right"?B.end:B.start,B}function $E(s){for(var c=s;c;c=c.parentNode)if(/CodeMirror-gutter-wrapper/.test(c.className))return!0;return!1}function Pa(s,c){return c&&(s.bad=!0),s}function FE(s,c,v,p,m){var C="",N=!1,P=s.doc.lineSeparator(),B=!1;function z(pe){return function(Ie){return Ie.id==pe}}function re(){N&&(C+=P,B&&(C+=P),N=B=!1)}function ae(pe){pe&&(re(),C+=pe)}function ye(pe){if(pe.nodeType==1){var Ie=pe.getAttribute("cm-text");if(Ie){ae(Ie);return}var We=pe.getAttribute("cm-marker"),et;if(We){var lt=s.findMarks(me(p,0),me(m+1,0),z(+We));lt.length&&(et=lt[0].find(0))&&ae(zt(s.doc,et.from,et.to).join(P));return}if(pe.getAttribute("contenteditable")=="false")return;var ht=/^(pre|div|p|li|table|br)$/i.test(pe.nodeName);if(!/^br$/i.test(pe.nodeName)&&pe.textContent.length==0)return;ht&&re();for(var ut=0;ut<pe.childNodes.length;ut++)ye(pe.childNodes[ut]);/^(pre|p)$/i.test(pe.nodeName)&&(B=!0),ht&&(N=!0)}else pe.nodeType==3&&ae(pe.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;ye(c),c!=v;)c=c.nextSibling,B=!1;return C}function Du(s,c,v){var p;if(c==s.display.lineDiv){if(p=s.display.lineDiv.childNodes[v],!p)return Pa(s.clipPos(me(s.display.viewTo-1)),!0);c=null,v=0}else for(p=c;;p=p.parentNode){if(!p||p==s.display.lineDiv)return null;if(p.parentNode&&p.parentNode==s.display.lineDiv)break}for(var m=0;m<s.display.view.length;m++){var C=s.display.view[m];if(C.node==p)return zE(C,c,v)}}function zE(s,c,v){var p=s.text.firstChild,m=!1;if(!c||!_e(p,c))return Pa(me(L(s.line),0),!0);if(c==p&&(m=!0,c=p.childNodes[v],v=0,!c)){var C=s.rest?A(s.rest):s.line;return Pa(me(L(C),C.text.length),m)}var N=c.nodeType==3?c:null,P=c;for(!N&&c.childNodes.length==1&&c.firstChild.nodeType==3&&(N=c.firstChild,v&&(v=N.nodeValue.length));P.parentNode!=p;)P=P.parentNode;var B=s.measure,z=B.maps;function re(et,lt,ht){for(var ut=-1;ut<(z?z.length:0);ut++)for(var _t=ut<0?B.map:z[ut],Tt=0;Tt<_t.length;Tt+=3){var At=_t[Tt+2];if(At==et||At==lt){var Ut=L(ut<0?s.line:s.rest[ut]),hn=_t[Tt]+ht;return(ht<0||At!=et)&&(hn=_t[Tt+(ht?1:0)]),me(Ut,hn)}}}var ae=re(N,P,v);if(ae)return Pa(ae,m);for(var ye=P.nextSibling,pe=N?N.nodeValue.length-v:0;ye;ye=ye.nextSibling){if(ae=re(ye,ye.firstChild,0),ae)return Pa(me(ae.line,ae.ch-pe),m);pe+=ye.textContent.length}for(var Ie=P.previousSibling,We=v;Ie;Ie=Ie.previousSibling){if(ae=re(Ie,Ie.firstChild,-1),ae)return Pa(me(ae.line,ae.ch+We),m);We+=Ie.textContent.length}}var An=function(s){this.cm=s,this.prevInput="",this.pollingFast=!1,this.polling=new Pe,this.hasSelection=!1,this.composing=null,this.resetting=!1};An.prototype.init=function(s){var c=this,v=this,p=this.cm;this.createField(s);var m=this.textarea;s.wrapper.insertBefore(this.wrapper,s.wrapper.firstChild),S&&(m.style.width="0px"),Re(m,"input",function(){u&&d>=9&&c.hasSelection&&(c.hasSelection=null),v.poll()}),Re(m,"paste",function(N){nt(p,N)||Qm(N,p)||(p.state.pasteIncoming=+new Date,v.fastPoll())});function C(N){if(!nt(p,N)){if(p.somethingSelected())Tu({lineWise:!1,text:p.getSelections()});else if(p.options.lineWiseCopyCut){var P=ty(p);Tu({lineWise:!0,text:P.text}),N.type=="cut"?p.setSelections(P.ranges,null,Ke):(v.prevInput="",m.value=P.text.join(`
`),Ve(m))}else return;N.type=="cut"&&(p.state.cutIncoming=+new Date)}}Re(m,"cut",C),Re(m,"copy",C),Re(s.scroller,"paste",function(N){if(!(Qi(s,N)||nt(p,N))){if(!m.dispatchEvent){p.state.pasteIncoming=+new Date,v.focus();return}var P=new Event("paste");P.clipboardData=N.clipboardData,m.dispatchEvent(P)}}),Re(s.lineSpace,"selectstart",function(N){Qi(s,N)||gt(N)}),Re(m,"compositionstart",function(){var N=p.getCursor("from");v.composing&&v.composing.range.clear(),v.composing={start:N,range:p.markText(N,p.getCursor("to"),{className:"CodeMirror-composing"})}}),Re(m,"compositionend",function(){v.composing&&(v.poll(),v.composing.range.clear(),v.composing=null)})},An.prototype.createField=function(s){this.wrapper=ny(),this.textarea=this.wrapper.firstChild;var c=this.cm.options;_f(this.textarea,c.spellcheck,c.autocorrect,c.autocapitalize)},An.prototype.screenReaderLabelChanged=function(s){s?this.textarea.setAttribute("aria-label",s):this.textarea.removeAttribute("aria-label")},An.prototype.prepareSelection=function(){var s=this.cm,c=s.display,v=s.doc,p=Xg(s);if(s.options.moveInputWithCursor){var m=ci(s,v.sel.primary().head,"div"),C=c.wrapper.getBoundingClientRect(),N=c.lineDiv.getBoundingClientRect();p.teTop=Math.max(0,Math.min(c.wrapper.clientHeight-10,m.top+N.top-C.top)),p.teLeft=Math.max(0,Math.min(c.wrapper.clientWidth-10,m.left+N.left-C.left))}return p},An.prototype.showSelection=function(s){var c=this.cm,v=c.display;U(v.cursorDiv,s.cursors),U(v.selectionDiv,s.selection),s.teTop!=null&&(this.wrapper.style.top=s.teTop+"px",this.wrapper.style.left=s.teLeft+"px")},An.prototype.reset=function(s){if(!(this.contextMenuPending||this.composing&&s)){var c=this.cm;if(this.resetting=!0,c.somethingSelected()){this.prevInput="";var v=c.getSelection();this.textarea.value=v,c.state.focused&&Ve(this.textarea),u&&d>=9&&(this.hasSelection=v)}else s||(this.prevInput=this.textarea.value="",u&&d>=9&&(this.hasSelection=null));this.resetting=!1}},An.prototype.getField=function(){return this.textarea},An.prototype.supportsTouch=function(){return!1},An.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!O||rt(le(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},An.prototype.blur=function(){this.textarea.blur()},An.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},An.prototype.receivedFocus=function(){this.slowPoll()},An.prototype.slowPoll=function(){var s=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){s.poll(),s.cm.state.focused&&s.slowPoll()})},An.prototype.fastPoll=function(){var s=!1,c=this;c.pollingFast=!0;function v(){var p=c.poll();!p&&!s?(s=!0,c.polling.set(60,v)):(c.pollingFast=!1,c.slowPoll())}c.polling.set(20,v)},An.prototype.poll=function(){var s=this,c=this.cm,v=this.textarea,p=this.prevInput;if(this.contextMenuPending||this.resetting||!c.state.focused||Ar(v)&&!p&&!this.composing||c.isReadOnly()||c.options.disableInput||c.state.keySeq)return!1;var m=v.value;if(m==p&&!c.somethingSelected())return!1;if(u&&d>=9&&this.hasSelection===m||M&&/[\uf700-\uf7ff]/.test(m))return c.display.input.reset(),!1;if(c.doc.sel==c.display.selForContextMenu){var C=m.charCodeAt(0);if(C==8203&&!p&&(p="​"),C==8666)return this.reset(),this.cm.execCommand("undo")}for(var N=0,P=Math.min(p.length,m.length);N<P&&p.charCodeAt(N)==m.charCodeAt(N);)++N;return Pr(c,function(){yf(c,m.slice(N),p.length-N,null,s.composing?"*compose":null),m.length>1e3||m.indexOf(`
`)>-1?v.value=s.prevInput="":s.prevInput=m,s.composing&&(s.composing.range.clear(),s.composing.range=c.markText(s.composing.start,c.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},An.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},An.prototype.onKeyPress=function(){u&&d>=9&&(this.hasSelection=null),this.fastPoll()},An.prototype.onContextMenu=function(s){var c=this,v=c.cm,p=v.display,m=c.textarea;c.contextMenuPending&&c.contextMenuPending();var C=$o(v,s),N=p.scroller.scrollTop;if(!C||w)return;var P=v.options.resetSelectionOnContextMenu;P&&v.doc.sel.contains(C)==-1&&Vn(v,er)(v.doc,po(C),Ke);var B=m.style.cssText,z=c.wrapper.style.cssText,re=c.wrapper.offsetParent.getBoundingClientRect();c.wrapper.style.cssText="position: static",m.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(s.clientY-re.top-5)+"px; left: "+(s.clientX-re.left-5)+`px;
      z-index: 1000; background: `+(u?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var ae;f&&(ae=m.ownerDocument.defaultView.scrollY),p.input.focus(),f&&m.ownerDocument.defaultView.scrollTo(null,ae),p.input.reset(),v.somethingSelected()||(m.value=c.prevInput=" "),c.contextMenuPending=pe,p.selForContextMenu=v.doc.sel,clearTimeout(p.detectingSelectAll);function ye(){if(m.selectionStart!=null){var We=v.somethingSelected(),et="​"+(We?m.value:"");m.value="⇚",m.value=et,c.prevInput=We?"":"​",m.selectionStart=1,m.selectionEnd=et.length,p.selForContextMenu=v.doc.sel}}function pe(){if(c.contextMenuPending==pe&&(c.contextMenuPending=!1,c.wrapper.style.cssText=z,m.style.cssText=B,u&&d<9&&p.scrollbars.setScrollTop(p.scroller.scrollTop=N),m.selectionStart!=null)){(!u||u&&d<9)&&ye();var We=0,et=function(){p.selForContextMenu==v.doc.sel&&m.selectionStart==0&&m.selectionEnd>0&&c.prevInput=="​"?Vn(v,Sm)(v):We++<10?p.detectingSelectAll=setTimeout(et,500):(p.selForContextMenu=null,p.input.reset())};p.detectingSelectAll=setTimeout(et,200)}}if(u&&d>=9&&ye(),ne){Gt(s);var Ie=function(){Ye(window,"mouseup",Ie),setTimeout(pe,20)};Re(window,"mouseup",Ie)}else setTimeout(pe,50)},An.prototype.readOnlyChanged=function(s){s||this.reset(),this.textarea.disabled=s=="nocursor",this.textarea.readOnly=!!s},An.prototype.setUneditable=function(){},An.prototype.needsContentAttribute=!1;function WE(s,c){if(c=c?se(c):{},c.value=s.value,!c.tabindex&&s.tabIndex&&(c.tabindex=s.tabIndex),!c.placeholder&&s.placeholder&&(c.placeholder=s.placeholder),c.autofocus==null){var v=rt(le(s));c.autofocus=v==s||s.getAttribute("autofocus")!=null&&v==document.body}function p(){s.value=P.getValue()}var m;if(s.form&&(Re(s.form,"submit",p),!c.leaveSubmitMethodAlone)){var C=s.form;m=C.submit;try{var N=C.submit=function(){p(),C.submit=m,C.submit(),C.submit=N}}catch{}}c.finishInit=function(B){B.save=p,B.getTextArea=function(){return s},B.toTextArea=function(){B.toTextArea=isNaN,p(),s.parentNode.removeChild(B.getWrapperElement()),s.style.display="",s.form&&(Ye(s.form,"submit",p),!c.leaveSubmitMethodAlone&&typeof s.form.submit=="function"&&(s.form.submit=m))}},s.style.display="none";var P=_n(function(B){return s.parentNode.insertBefore(B,s.nextSibling)},c);return P}function UE(s){s.off=Ye,s.on=Re,s.wheelEventPixels=JS,s.Doc=yr,s.splitLines=Nn,s.countColumn=ge,s.findColumn=Wt,s.isWordChar=ce,s.Pass=ft,s.signal=Qe,s.Line=ya,s.changeEnd=vo,s.scrollbarModel=Qg,s.Pos=me,s.cmpPos=we,s.modes=Wr,s.mimeModes=Wn,s.resolveMode=Tr,s.getMode=Zr,s.modeExtensions=Dr,s.extendMode=Ur,s.copyState=Z,s.startState=Xe,s.innerMode=be,s.commands=Qs,s.keyMap=to,s.keyName=Hm,s.isModifierKey=Bm,s.lookupKey=Ta,s.normalizeKeyMap=_E,s.StringStream=ot,s.SharedTextMarker=Ks,s.TextMarker=mo,s.LineWidget=Ys,s.e_preventDefault=gt,s.e_stopPropagation=Et,s.e_stop=Gt,s.addClass=Me,s.contains=_e,s.rmClass=J,s.keyNames=yo}RE(_n),HE(_n);var VE="iter insert remove copy getEditor constructor".split(" ");for(var Lu in yr.prototype)yr.prototype.hasOwnProperty(Lu)&&Le(VE,Lu)<0&&(_n.prototype[Lu]=function(s){return function(){return s.apply(this.doc,arguments)}}(yr.prototype[Lu]));return qe(yr),_n.inputStyles={textarea:An,contenteditable:cn},_n.defineMode=function(s){!_n.defaults.mode&&s!="null"&&(_n.defaults.mode=s),ur.apply(this,arguments)},_n.defineMIME=dr,_n.defineMode("null",function(){return{token:function(s){return s.skipToEnd()}}}),_n.defineMIME("text/plain","null"),_n.defineExtension=function(s,c){_n.prototype[s]=c},_n.defineDocExtension=function(s,c){yr.prototype[s]=c},_n.fromTextArea=WE,UE(_n),_n.version="5.65.19",_n})}(ad)),ad.exports}var dy;function xP(){return dy||(dy=1,function(r,e){(function(t){t(Lo())})(function(t){t.defineMode("javascript",function(n,i){var o=n.indentUnit,a=i.statementIndent,l=i.jsonld,u=i.json||l,d=i.trackScope!==!1,f=i.typescript,h=i.wordCharacters||/[\w$\xa1-\uffff]/,g=function(){function L(bt){return{type:bt,style:"keyword"}}var X=L("keyword a"),he=L("keyword b"),Oe=L("keyword c"),me=L("keyword d"),we=L("operator"),it={type:"atom",style:"atom"};return{if:L("if"),while:X,with:X,else:he,do:he,try:he,finally:he,return:me,break:me,continue:me,new:L("new"),delete:Oe,void:Oe,throw:Oe,debugger:L("debugger"),var:L("var"),const:L("var"),let:L("var"),function:L("function"),catch:L("catch"),for:L("for"),switch:L("switch"),case:L("case"),default:L("default"),in:we,typeof:we,instanceof:we,true:it,false:it,null:it,undefined:it,NaN:it,Infinity:it,this:L("this"),class:L("class"),super:L("atom"),yield:Oe,export:L("export"),import:L("import"),extends:Oe,await:Oe}}(),y=/[+\-*&%=<>!?|~^@]/,w=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function x(L){for(var X=!1,he,Oe=!1;(he=L.next())!=null;){if(!X){if(he=="/"&&!Oe)return;he=="["?Oe=!0:Oe&&he=="]"&&(Oe=!1)}X=!X&&he=="\\"}}var b,_;function S(L,X,he){return b=L,_=he,X}function k(L,X){var he=L.next();if(he=='"'||he=="'")return X.tokenize=O(he),X.tokenize(L,X);if(he=="."&&L.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return S("number","number");if(he=="."&&L.match(".."))return S("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(he))return S(he);if(he=="="&&L.eat(">"))return S("=>","operator");if(he=="0"&&L.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return S("number","number");if(/\d/.test(he))return L.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),S("number","number");if(he=="/")return L.eat("*")?(X.tokenize=M,M(L,X)):L.eat("/")?(L.skipToEnd(),S("comment","comment")):Q(L,X,1)?(x(L),L.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),S("regexp","string-2")):(L.eat("="),S("operator","operator",L.current()));if(he=="`")return X.tokenize=R,R(L,X);if(he=="#"&&L.peek()=="!")return L.skipToEnd(),S("meta","meta");if(he=="#"&&L.eatWhile(h))return S("variable","property");if(he=="<"&&L.match("!--")||he=="-"&&L.match("->")&&!/\S/.test(L.string.slice(0,L.start)))return L.skipToEnd(),S("comment","comment");if(y.test(he))return(he!=">"||!X.lexical||X.lexical.type!=">")&&(L.eat("=")?(he=="!"||he=="=")&&L.eat("="):/[<>*+\-|&?]/.test(he)&&(L.eat(he),he==">"&&L.eat(he))),he=="?"&&L.eat(".")?S("."):S("operator","operator",L.current());if(h.test(he)){L.eatWhile(h);var Oe=L.current();if(X.lastType!="."){if(g.propertyIsEnumerable(Oe)){var me=g[Oe];return S(me.type,me.style,Oe)}if(Oe=="async"&&L.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return S("async","keyword",Oe)}return S("variable","variable",Oe)}}function O(L){return function(X,he){var Oe=!1,me;if(l&&X.peek()=="@"&&X.match(w))return he.tokenize=k,S("jsonld-keyword","meta");for(;(me=X.next())!=null&&!(me==L&&!Oe);)Oe=!Oe&&me=="\\";return Oe||(he.tokenize=k),S("string","string")}}function M(L,X){for(var he=!1,Oe;Oe=L.next();){if(Oe=="/"&&he){X.tokenize=k;break}he=Oe=="*"}return S("comment","comment")}function R(L,X){for(var he=!1,Oe;(Oe=L.next())!=null;){if(!he&&(Oe=="`"||Oe=="$"&&L.eat("{"))){X.tokenize=k;break}he=!he&&Oe=="\\"}return S("quasi","string-2",L.current())}var T="([{}])";function I(L,X){X.fatArrowAt&&(X.fatArrowAt=null);var he=L.string.indexOf("=>",L.start);if(!(he<0)){if(f){var Oe=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(L.string.slice(L.start,he));Oe&&(he=Oe.index)}for(var me=0,we=!1,it=he-1;it>=0;--it){var bt=L.string.charAt(it),Pt=T.indexOf(bt);if(Pt>=0&&Pt<3){if(!me){++it;break}if(--me==0){bt=="("&&(we=!0);break}}else if(Pt>=3&&Pt<6)++me;else if(h.test(bt))we=!0;else if(/["'\/`]/.test(bt))for(;;--it){if(it==0)return;var Mn=L.string.charAt(it-1);if(Mn==bt&&L.string.charAt(it-2)!="\\"){it--;break}}else if(we&&!me){++it;break}}we&&!me&&(X.fatArrowAt=it)}}var $={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function ne(L,X,he,Oe,me,we){this.indented=L,this.column=X,this.type=he,this.prev=me,this.info=we,Oe!=null&&(this.align=Oe)}function V(L,X){if(!d)return!1;for(var he=L.localVars;he;he=he.next)if(he.name==X)return!0;for(var Oe=L.context;Oe;Oe=Oe.prev)for(var he=Oe.vars;he;he=he.next)if(he.name==X)return!0}function J(L,X,he,Oe,me){var we=L.cc;for(D.state=L,D.stream=me,D.marked=null,D.cc=we,D.style=X,L.lexical.hasOwnProperty("align")||(L.lexical.align=!0);;){var it=we.length?we.pop():u?Le:ge;if(it(he,Oe)){for(;we.length&&we[we.length-1].lex;)we.pop()();return D.marked?D.marked:he=="variable"&&V(L,Oe)?"variable-2":X}}}var D={state:null,marked:null,cc:null};function U(){for(var L=arguments.length-1;L>=0;L--)D.cc.push(arguments[L])}function j(){return U.apply(null,arguments),!0}function fe(L,X){for(var he=X;he;he=he.next)if(he.name==L)return!0;return!1}function Ee(L){var X=D.state;if(D.marked="def",!!d){if(X.context){if(X.lexical.info=="var"&&X.context&&X.context.block){var he=_e(L,X.context);if(he!=null){X.context=he;return}}else if(!fe(L,X.localVars)){X.localVars=new ve(L,X.localVars);return}}i.globalVars&&!fe(L,X.globalVars)&&(X.globalVars=new ve(L,X.globalVars))}}function _e(L,X){if(X)if(X.block){var he=_e(L,X.prev);return he?he==X.prev?X:new Me(he,X.vars,!0):null}else return fe(L,X.vars)?X:new Me(X.prev,new ve(L,X.vars),!1);else return null}function rt(L){return L=="public"||L=="private"||L=="protected"||L=="abstract"||L=="readonly"}function Me(L,X,he){this.prev=L,this.vars=X,this.block=he}function ve(L,X){this.name=L,this.next=X}var Ve=new ve("this",new ve("arguments",null));function Be(){D.state.context=new Me(D.state.context,D.state.localVars,!1),D.state.localVars=Ve}function de(){D.state.context=new Me(D.state.context,D.state.localVars,!0),D.state.localVars=null}Be.lex=de.lex=!0;function le(){D.state.localVars=D.state.context.vars,D.state.context=D.state.context.prev}le.lex=!0;function W(L,X){var he=function(){var Oe=D.state,me=Oe.indented;if(Oe.lexical.type=="stat")me=Oe.lexical.indented;else for(var we=Oe.lexical;we&&we.type==")"&&we.align;we=we.prev)me=we.indented;Oe.lexical=new ne(me,D.stream.column(),L,null,Oe.lexical,X)};return he.lex=!0,he}function Y(){var L=D.state;L.lexical.prev&&(L.lexical.type==")"&&(L.indented=L.lexical.indented),L.lexical=L.lexical.prev)}Y.lex=!0;function se(L){function X(he){return he==L?j():L==";"||he=="}"||he==")"||he=="]"?U():j(X)}return X}function ge(L,X){return L=="var"?j(W("vardef",X),Et,se(";"),Y):L=="keyword a"?j(W("form"),ft,ge,Y):L=="keyword b"?j(W("form"),ge,Y):L=="keyword d"?D.stream.match(/^\s*$/,!1)?j():j(W("stat"),Nt,se(";"),Y):L=="debugger"?j(se(";")):L=="{"?j(W("}"),de,pt,Y,le):L==";"?j():L=="if"?(D.state.lexical.info=="else"&&D.state.cc[D.state.cc.length-1]==Y&&D.state.cc.pop()(),j(W("form"),ft,ge,Y,Kr)):L=="function"?j(Nn):L=="for"?j(W("form"),de,Jr,ge,le,Y):L=="class"||f&&X=="interface"?(D.marked="keyword",j(W("form",L=="class"?L:X),Wr,Y)):L=="variable"?f&&X=="declare"?(D.marked="keyword",j(ge)):f&&(X=="module"||X=="enum"||X=="type")&&D.stream.match(/^\s*\w/,!1)?(D.marked="keyword",X=="enum"?j(Ge):X=="type"?j(ui,se("operator"),at,se(";")):j(W("form"),qt,se("{"),W("}"),pt,Y,Y)):f&&X=="namespace"?(D.marked="keyword",j(W("form"),Le,ge,Y)):f&&X=="abstract"?(D.marked="keyword",j(ge)):j(W("stat"),ie):L=="switch"?j(W("form"),ft,se("{"),W("}","switch"),de,pt,Y,Y,le):L=="case"?j(Le,se(":")):L=="default"?j(se(":")):L=="catch"?j(W("form"),Be,Pe,ge,Y,le):L=="export"?j(W("stat"),Tr,Y):L=="import"?j(W("stat"),Dr,Y):L=="async"?j(ge):X=="@"?j(Le,ge):U(W("stat"),Le,se(";"),Y)}function Pe(L){if(L=="(")return j(Dt,se(")"))}function Le(L,X){return Ke(L,X,!1)}function He(L,X){return Ke(L,X,!0)}function ft(L){return L!="("?U():j(W(")"),Nt,se(")"),Y)}function Ke(L,X,he){if(D.state.fatArrowAt==D.stream.start){var Oe=he?F:A;if(L=="(")return j(Be,W(")"),Ze(Dt,")"),Y,se("=>"),Oe,le);if(L=="variable")return U(Be,qt,se("=>"),Oe,le)}var me=he?Wt:yt;return $.hasOwnProperty(L)?j(me):L=="function"?j(Nn,me):L=="class"||f&&X=="interface"?(D.marked="keyword",j(W("form"),Pi,Y)):L=="keyword c"||L=="async"?j(he?He:Le):L=="("?j(W(")"),Nt,se(")"),Y,me):L=="operator"||L=="spread"?j(he?He:Le):L=="["?j(W("]"),ot,Y,me):L=="{"?ct(Ce,"}",null,me):L=="quasi"?U(Ft,me):L=="new"?j(ee(he)):j()}function Nt(L){return L.match(/[;\}\)\],]/)?U():U(Le)}function yt(L,X){return L==","?j(Nt):Wt(L,X,!1)}function Wt(L,X,he){var Oe=he==!1?yt:Wt,me=he==!1?Le:He;if(L=="=>")return j(Be,he?F:A,le);if(L=="operator")return/\+\+|--/.test(X)||f&&X=="!"?j(Oe):f&&X=="<"&&D.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?j(W(">"),Ze(at,">"),Y,Oe):X=="?"?j(Le,se(":"),me):j(me);if(L=="quasi")return U(Ft,Oe);if(L!=";"){if(L=="(")return ct(He,")","call",Oe);if(L==".")return j(ce,Oe);if(L=="[")return j(W("]"),Nt,se("]"),Y,Oe);if(f&&X=="as")return D.marked="keyword",j(at,Oe);if(L=="regexp")return D.state.lastType=D.marked="operator",D.stream.backUp(D.stream.pos-D.stream.start-1),j(me)}}function Ft(L,X){return L!="quasi"?U():X.slice(X.length-2)!="${"?j(Ft):j(Nt,te)}function te(L){if(L=="}")return D.marked="string-2",D.state.tokenize=R,j(Ft)}function A(L){return I(D.stream,D.state),U(L=="{"?ge:Le)}function F(L){return I(D.stream,D.state),U(L=="{"?ge:He)}function ee(L){return function(X){return X=="."?j(L?oe:K):X=="variable"&&f?j(xe,L?Wt:yt):U(L?He:Le)}}function K(L,X){if(X=="target")return D.marked="keyword",j(yt)}function oe(L,X){if(X=="target")return D.marked="keyword",j(Wt)}function ie(L){return L==":"?j(Y,ge):U(yt,se(";"),Y)}function ce(L){if(L=="variable")return D.marked="property",j()}function Ce(L,X){if(L=="async")return D.marked="property",j(Ce);if(L=="variable"||D.style=="keyword"){if(D.marked="property",X=="get"||X=="set")return j(ke);var he;return f&&D.state.fatArrowAt==D.stream.start&&(he=D.stream.match(/^\s*:\s*/,!1))&&(D.state.fatArrowAt=D.stream.pos+he[0].length),j(je)}else{if(L=="number"||L=="string")return D.marked=l?"property":D.style+" property",j(je);if(L=="jsonld-keyword")return j(je);if(f&&rt(X))return D.marked="keyword",j(Ce);if(L=="[")return j(Le,Rt,se("]"),je);if(L=="spread")return j(He,je);if(X=="*")return D.marked="keyword",j(Ce);if(L==":")return U(je)}}function ke(L){return L!="variable"?U(je):(D.marked="property",j(Nn))}function je(L){if(L==":")return j(He);if(L=="(")return U(Nn)}function Ze(L,X,he){function Oe(me,we){if(he?he.indexOf(me)>-1:me==","){var it=D.state.lexical;return it.info=="call"&&(it.pos=(it.pos||0)+1),j(function(bt,Pt){return bt==X||Pt==X?U():U(L)},Oe)}return me==X||we==X?j():he&&he.indexOf(";")>-1?U(L):j(se(X))}return function(me,we){return me==X||we==X?j():U(L,Oe)}}function ct(L,X,he){for(var Oe=3;Oe<arguments.length;Oe++)D.cc.push(arguments[Oe]);return j(W(X,he),Ze(L,X),Y)}function pt(L){return L=="}"?j():U(ge,pt)}function Rt(L,X){if(f){if(L==":")return j(at);if(X=="?")return j(Rt)}}function Je(L,X){if(f&&(L==":"||X=="in"))return j(at)}function dt(L){if(f&&L==":")return D.stream.match(/^\s*\w+\s+is\b/,!1)?j(Le,It,at):j(at)}function It(L,X){if(X=="is")return D.marked="keyword",j()}function at(L,X){if(X=="keyof"||X=="typeof"||X=="infer"||X=="readonly")return D.marked="keyword",j(X=="typeof"?He:at);if(L=="variable"||X=="void")return D.marked="type",j(St);if(X=="|"||X=="&")return j(at);if(L=="string"||L=="number"||L=="atom")return j(St);if(L=="[")return j(W("]"),Ze(at,"]",","),Y,St);if(L=="{")return j(W("}"),Re,Y,St);if(L=="(")return j(Ze(nt,")"),Fe,St);if(L=="<")return j(Ze(at,">"),at);if(L=="quasi")return U(Ye,St)}function Fe(L){if(L=="=>")return j(at)}function Re(L){return L.match(/[\}\)\]]/)?j():L==","||L==";"?j(Re):U(vt,Re)}function vt(L,X){if(L=="variable"||D.style=="keyword")return D.marked="property",j(vt);if(X=="?"||L=="number"||L=="string")return j(vt);if(L==":")return j(at);if(L=="[")return j(se("variable"),Je,se("]"),vt);if(L=="(")return U(Ar,vt);if(!L.match(/[;\}\)\],]/))return j()}function Ye(L,X){return L!="quasi"?U():X.slice(X.length-2)!="${"?j(Ye):j(at,Qe)}function Qe(L){if(L=="}")return D.marked="string-2",D.state.tokenize=R,j(Ye)}function nt(L,X){return L=="variable"&&D.stream.match(/^\s*[?:]/,!1)||X=="?"?j(nt):L==":"?j(at):L=="spread"?j(nt):U(at)}function St(L,X){if(X=="<")return j(W(">"),Ze(at,">"),Y,St);if(X=="|"||L=="."||X=="&")return j(at);if(L=="[")return j(at,se("]"),St);if(X=="extends"||X=="implements")return D.marked="keyword",j(at);if(X=="?")return j(at,se(":"),at)}function xe(L,X){if(X=="<")return j(W(">"),Ze(at,">"),Y,St)}function qe(){return U(at,gt)}function gt(L,X){if(X=="=")return j(at)}function Et(L,X){return X=="enum"?(D.marked="keyword",j(Ge)):U(qt,Rt,mn,zn)}function qt(L,X){if(f&&rt(X))return D.marked="keyword",j(qt);if(L=="variable")return Ee(X),j();if(L=="spread")return j(qt);if(L=="[")return ct(Qn,"]");if(L=="{")return ct(Gt,"}")}function Gt(L,X){return L=="variable"&&!D.stream.match(/^\s*:/,!1)?(Ee(X),j(mn)):(L=="variable"&&(D.marked="property"),L=="spread"?j(qt):L=="}"?U():L=="["?j(Le,se("]"),se(":"),Gt):j(se(":"),qt,mn))}function Qn(){return U(qt,mn)}function mn(L,X){if(X=="=")return j(He)}function zn(L){if(L==",")return j(Et)}function Kr(L,X){if(L=="keyword b"&&X=="else")return j(W("form","else"),ge,Y)}function Jr(L,X){if(X=="await")return j(Jr);if(L=="(")return j(W(")"),Zt,Y)}function Zt(L){return L=="var"?j(Et,Mr):L=="variable"?j(Mr):U(Mr)}function Mr(L,X){return L==")"?j():L==";"?j(Mr):X=="in"||X=="of"?(D.marked="keyword",j(Le,Mr)):U(Le,Mr)}function Nn(L,X){if(X=="*")return D.marked="keyword",j(Nn);if(L=="variable")return Ee(X),j(Nn);if(L=="(")return j(Be,W(")"),Ze(Dt,")"),Y,dt,ge,le);if(f&&X=="<")return j(W(">"),Ze(qe,">"),Y,Nn)}function Ar(L,X){if(X=="*")return D.marked="keyword",j(Ar);if(L=="variable")return Ee(X),j(Ar);if(L=="(")return j(Be,W(")"),Ze(Dt,")"),Y,dt,le);if(f&&X=="<")return j(W(">"),Ze(qe,">"),Y,Ar)}function ui(L,X){if(L=="keyword"||L=="variable")return D.marked="type",j(ui);if(X=="<")return j(W(">"),Ze(qe,">"),Y)}function Dt(L,X){return X=="@"&&j(Le,Dt),L=="spread"?j(Dt):f&&rt(X)?(D.marked="keyword",j(Dt)):f&&L=="this"?j(Rt,mn):U(qt,Rt,mn)}function Pi(L,X){return L=="variable"?Wr(L,X):Wn(L,X)}function Wr(L,X){if(L=="variable")return Ee(X),j(Wn)}function Wn(L,X){if(X=="<")return j(W(">"),Ze(qe,">"),Y,Wn);if(X=="extends"||X=="implements"||f&&L==",")return X=="implements"&&(D.marked="keyword"),j(f?at:Le,Wn);if(L=="{")return j(W("}"),ur,Y)}function ur(L,X){if(L=="async"||L=="variable"&&(X=="static"||X=="get"||X=="set"||f&&rt(X))&&D.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return D.marked="keyword",j(ur);if(L=="variable"||D.style=="keyword")return D.marked="property",j(dr,ur);if(L=="number"||L=="string")return j(dr,ur);if(L=="[")return j(Le,Rt,se("]"),dr,ur);if(X=="*")return D.marked="keyword",j(ur);if(f&&L=="(")return U(Ar,ur);if(L==";"||L==",")return j(ur);if(L=="}")return j();if(X=="@")return j(Le,ur)}function dr(L,X){if(X=="!"||X=="?")return j(dr);if(L==":")return j(at,mn);if(X=="=")return j(He);var he=D.state.lexical.prev,Oe=he&&he.info=="interface";return U(Oe?Ar:Nn)}function Tr(L,X){return X=="*"?(D.marked="keyword",j(Xe,se(";"))):X=="default"?(D.marked="keyword",j(Le,se(";"))):L=="{"?j(Ze(Zr,"}"),Xe,se(";")):U(ge)}function Zr(L,X){if(X=="as")return D.marked="keyword",j(se("variable"));if(L=="variable")return U(He,Zr)}function Dr(L){return L=="string"?j():L=="("?U(Le):L=="."?U(yt):U(Ur,Z,Xe)}function Ur(L,X){return L=="{"?ct(Ur,"}"):(L=="variable"&&Ee(X),X=="*"&&(D.marked="keyword"),j(be))}function Z(L){if(L==",")return j(Ur,Z)}function be(L,X){if(X=="as")return D.marked="keyword",j(Ur)}function Xe(L,X){if(X=="from")return D.marked="keyword",j(Le)}function ot(L){return L=="]"?j():U(Ze(He,"]"))}function Ge(){return U(W("form"),qt,se("{"),W("}"),Ze(zt,"}"),Y,Y)}function zt(){return U(qt,mn)}function pn(L,X){return L.lastType=="operator"||L.lastType==","||y.test(X.charAt(0))||/[,.]/.test(X.charAt(0))}function Q(L,X,he){return X.tokenize==k&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(X.lastType)||X.lastType=="quasi"&&/\{\s*$/.test(L.string.slice(0,L.pos-(he||0)))}return{startState:function(L){var X={tokenize:k,lastType:"sof",cc:[],lexical:new ne((L||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new Me(null,null,!1),indented:L||0};return i.globalVars&&typeof i.globalVars=="object"&&(X.globalVars=i.globalVars),X},token:function(L,X){if(L.sol()&&(X.lexical.hasOwnProperty("align")||(X.lexical.align=!1),X.indented=L.indentation(),I(L,X)),X.tokenize!=M&&L.eatSpace())return null;var he=X.tokenize(L,X);return b=="comment"?he:(X.lastType=b=="operator"&&(_=="++"||_=="--")?"incdec":b,J(X,he,b,_,L))},indent:function(L,X){if(L.tokenize==M||L.tokenize==R)return t.Pass;if(L.tokenize!=k)return 0;var he=X&&X.charAt(0),Oe=L.lexical,me;if(!/^\s*else\b/.test(X))for(var we=L.cc.length-1;we>=0;--we){var it=L.cc[we];if(it==Y)Oe=Oe.prev;else if(it!=Kr&&it!=le)break}for(;(Oe.type=="stat"||Oe.type=="form")&&(he=="}"||(me=L.cc[L.cc.length-1])&&(me==yt||me==Wt)&&!/^[,\.=+\-*:?[\(]/.test(X));)Oe=Oe.prev;a&&Oe.type==")"&&Oe.prev.type=="stat"&&(Oe=Oe.prev);var bt=Oe.type,Pt=he==bt;return bt=="vardef"?Oe.indented+(L.lastType=="operator"||L.lastType==","?Oe.info.length+1:0):bt=="form"&&he=="{"?Oe.indented:bt=="form"?Oe.indented+o:bt=="stat"?Oe.indented+(pn(L,X)?a||o:0):Oe.info=="switch"&&!Pt&&i.doubleIndentSwitch!=!1?Oe.indented+(/^(?:case|default)\b/.test(X)?o:2*o):Oe.align?Oe.column+(Pt?0:1):Oe.indented+(Pt?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:u?null:"/*",blockCommentEnd:u?null:"*/",blockCommentContinue:u?null:" * ",lineComment:u?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:u?"json":"javascript",jsonldMode:l,jsonMode:u,expressionAllowed:Q,skipExpression:function(L){J(L,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),ly.exports}xP();var cy={exports:{}},fy;function q1(){return fy||(fy=1,function(r,e){(function(t){t(Lo())})(function(t){function n(l,u,d,f){if(d&&d.call){var h=d;d=null}else var h=a(l,d,"rangeFinder");typeof u=="number"&&(u=t.Pos(u,0));var g=a(l,d,"minFoldSize");function y(_){var S=h(l,u);if(!S||S.to.line-S.from.line<g)return null;if(f==="fold")return S;for(var k=l.findMarksAt(S.from),O=0;O<k.length;++O)if(k[O].__isFold){if(!_)return null;S.cleared=!0,k[O].clear()}return S}var w=y(!0);if(a(l,d,"scanUp"))for(;!w&&u.line>l.firstLine();)u=t.Pos(u.line-1,0),w=y(!1);if(!(!w||w.cleared||f==="unfold")){var x=i(l,d,w);t.on(x,"mousedown",function(_){b.clear(),t.e_preventDefault(_)});var b=l.markText(w.from,w.to,{replacedWith:x,clearOnEnter:a(l,d,"clearOnEnter"),__isFold:!0});b.on("clear",function(_,S){t.signal(l,"unfold",l,_,S)}),t.signal(l,"fold",l,w.from,w.to)}}function i(l,u,d){var f=a(l,u,"widget");if(typeof f=="function"&&(f=f(d.from,d.to)),typeof f=="string"){var h=document.createTextNode(f);f=document.createElement("span"),f.appendChild(h),f.className="CodeMirror-foldmarker"}else f&&(f=f.cloneNode(!0));return f}t.newFoldFunction=function(l,u){return function(d,f){n(d,f,{rangeFinder:l,widget:u})}},t.defineExtension("foldCode",function(l,u,d){n(this,l,u,d)}),t.defineExtension("isFolded",function(l){for(var u=this.findMarksAt(l),d=0;d<u.length;++d)if(u[d].__isFold)return!0}),t.commands.toggleFold=function(l){l.foldCode(l.getCursor())},t.commands.fold=function(l){l.foldCode(l.getCursor(),null,"fold")},t.commands.unfold=function(l){l.foldCode(l.getCursor(),{scanUp:!1},"unfold")},t.commands.foldAll=function(l){l.operation(function(){for(var u=l.firstLine(),d=l.lastLine();u<=d;u++)l.foldCode(t.Pos(u,0),{scanUp:!1},"fold")})},t.commands.unfoldAll=function(l){l.operation(function(){for(var u=l.firstLine(),d=l.lastLine();u<=d;u++)l.foldCode(t.Pos(u,0),{scanUp:!1},"unfold")})},t.registerHelper("fold","combine",function(){var l=Array.prototype.slice.call(arguments,0);return function(u,d){for(var f=0;f<l.length;++f){var h=l[f](u,d);if(h)return h}}}),t.registerHelper("fold","auto",function(l,u){for(var d=l.getHelpers(u,"fold"),f=0;f<d.length;f++){var h=d[f](l,u);if(h)return h}});var o={rangeFinder:t.fold.auto,widget:"↔",minFoldSize:0,scanUp:!1,clearOnEnter:!0};t.defineOption("foldOptions",null);function a(l,u,d){if(u&&u[d]!==void 0)return u[d];var f=l.options.foldOptions;return f&&f[d]!==void 0?f[d]:o[d]}t.defineExtension("foldOption",function(l,u){return a(this,l,u)})})}()),cy.exports}q1();var hy={exports:{}},py;function wP(){return py||(py=1,function(r,e){(function(t){t(Lo(),q1())})(function(t){t.defineOption("foldGutter",!1,function(b,_,S){S&&S!=t.Init&&(b.clearGutter(b.state.foldGutter.options.gutter),b.state.foldGutter=null,b.off("gutterClick",h),b.off("changes",y),b.off("viewportChange",w),b.off("fold",x),b.off("unfold",x),b.off("swapDoc",y),b.off("optionChange",g)),_&&(b.state.foldGutter=new i(o(_)),f(b),b.on("gutterClick",h),b.on("changes",y),b.on("viewportChange",w),b.on("fold",x),b.on("unfold",x),b.on("swapDoc",y),b.on("optionChange",g))});var n=t.Pos;function i(b){this.options=b,this.from=this.to=0}function o(b){return b===!0&&(b={}),b.gutter==null&&(b.gutter="CodeMirror-foldgutter"),b.indicatorOpen==null&&(b.indicatorOpen="CodeMirror-foldgutter-open"),b.indicatorFolded==null&&(b.indicatorFolded="CodeMirror-foldgutter-folded"),b}function a(b,_){for(var S=b.findMarks(n(_,0),n(_+1,0)),k=0;k<S.length;++k)if(S[k].__isFold){var O=S[k].find(-1);if(O&&O.line===_)return S[k]}}function l(b){if(typeof b=="string"){var _=document.createElement("div");return _.className=b+" CodeMirror-guttermarker-subtle",_}else return b.cloneNode(!0)}function u(b,_,S){var k=b.state.foldGutter.options,O=_-1,M=b.foldOption(k,"minFoldSize"),R=b.foldOption(k,"rangeFinder"),T=typeof k.indicatorFolded=="string"&&d(k.indicatorFolded),I=typeof k.indicatorOpen=="string"&&d(k.indicatorOpen);b.eachLine(_,S,function($){++O;var ne=null,V=$.gutterMarkers;if(V&&(V=V[k.gutter]),a(b,O)){if(T&&V&&T.test(V.className))return;ne=l(k.indicatorFolded)}else{var J=n(O,0),D=R&&R(b,J);if(D&&D.to.line-D.from.line>=M){if(I&&V&&I.test(V.className))return;ne=l(k.indicatorOpen)}}!ne&&!V||b.setGutterMarker($,k.gutter,ne)})}function d(b){return new RegExp("(^|\\s)"+b+"(?:$|\\s)\\s*")}function f(b){var _=b.getViewport(),S=b.state.foldGutter;S&&(b.operation(function(){u(b,_.from,_.to)}),S.from=_.from,S.to=_.to)}function h(b,_,S){var k=b.state.foldGutter;if(k){var O=k.options;if(S==O.gutter){var M=a(b,_);M?M.clear():b.foldCode(n(_,0),O)}}}function g(b,_){_=="mode"&&y(b)}function y(b){var _=b.state.foldGutter;if(_){var S=_.options;_.from=_.to=0,clearTimeout(_.changeUpdate),_.changeUpdate=setTimeout(function(){f(b)},S.foldOnChangeTimeSpan||600)}}function w(b){var _=b.state.foldGutter;if(_){var S=_.options;clearTimeout(_.changeUpdate),_.changeUpdate=setTimeout(function(){var k=b.getViewport();_.from==_.to||k.from-_.to>20||_.from-k.to>20?f(b):b.operation(function(){k.from<_.from&&(u(b,k.from,_.from),_.from=k.from),k.to>_.to&&(u(b,_.to,k.to),_.to=k.to)})},S.updateViewportTimeSpan||400)}}function x(b,_){var S=b.state.foldGutter;if(S){var k=_.line;k>=S.from&&k<S.to&&u(b,k,k+1)}}})}()),hy.exports}wP();var vy={exports:{}},gy;function SP(){return gy||(gy=1,function(r,e){(function(t){t(Lo())})(function(t){function n(i){return function(o,a){var l=a.line,u=o.getLine(l);function d(x){for(var b,_=a.ch,S=0;;){var k=_<=0?-1:u.lastIndexOf(x[0],_-1);if(k==-1){if(S==1)break;S=1,_=u.length;continue}if(S==1&&k<a.ch)break;if(b=o.getTokenTypeAt(t.Pos(l,k+1)),!/^(comment|string)/.test(b))return{ch:k+1,tokenType:b,pair:x};_=k-1}}function f(x){var b=1,_=o.lastLine(),S,k=x.ch,O;e:for(var M=l;M<=_;++M)for(var R=o.getLine(M),T=M==l?k:0;;){var I=R.indexOf(x.pair[0],T),$=R.indexOf(x.pair[1],T);if(I<0&&(I=R.length),$<0&&($=R.length),T=Math.min(I,$),T==R.length)break;if(o.getTokenTypeAt(t.Pos(M,T+1))==x.tokenType){if(T==I)++b;else if(!--b){S=M,O=T;break e}}++T}return S==null||l==S?null:{from:t.Pos(l,k),to:t.Pos(S,O)}}for(var h=[],g=0;g<i.length;g++){var y=d(i[g]);y&&h.push(y)}h.sort(function(x,b){return x.ch-b.ch});for(var g=0;g<h.length;g++){var w=f(h[g]);if(w)return w}return null}}t.registerHelper("fold","brace",n([["{","}"],["[","]"]])),t.registerHelper("fold","brace-paren",n([["{","}"],["[","]"],["(",")"]])),t.registerHelper("fold","import",function(i,o){function a(g){if(g<i.firstLine()||g>i.lastLine())return null;var y=i.getTokenAt(t.Pos(g,1));if(/\S/.test(y.string)||(y=i.getTokenAt(t.Pos(g,y.end+1))),y.type!="keyword"||y.string!="import")return null;for(var w=g,x=Math.min(i.lastLine(),g+10);w<=x;++w){var b=i.getLine(w),_=b.indexOf(";");if(_!=-1)return{startCh:y.end,end:t.Pos(w,_)}}}var l=o.line,u=a(l),d;if(!u||a(l-1)||(d=a(l-2))&&d.end.line==l-1)return null;for(var f=u.end;;){var h=a(f.line+1);if(h==null)break;f=h.end}return{from:i.clipPos(t.Pos(l,u.startCh+1)),to:f}}),t.registerHelper("fold","include",function(i,o){function a(h){if(h<i.firstLine()||h>i.lastLine())return null;var g=i.getTokenAt(t.Pos(h,1));if(/\S/.test(g.string)||(g=i.getTokenAt(t.Pos(h,g.end+1))),g.type=="meta"&&g.string.slice(0,8)=="#include")return g.start+8}var l=o.line,u=a(l);if(u==null||a(l-1)!=null)return null;for(var d=l;;){var f=a(d+1);if(f==null)break;++d}return{from:t.Pos(l,u+1),to:i.clipPos(t.Pos(d))}})})}()),vy.exports}SP();var my={exports:{}},yy;function EP(){return yy||(yy=1,function(r,e){(function(t){t(Lo())})(function(t){var n="CodeMirror-activeline",i="CodeMirror-activeline-background",o="CodeMirror-activeline-gutter";t.defineOption("styleActiveLine",!1,function(f,h,g){var y=g==t.Init?!1:g;h!=y&&(y&&(f.off("beforeSelectionChange",d),a(f),delete f.state.activeLines),h&&(f.state.activeLines=[],u(f,f.listSelections()),f.on("beforeSelectionChange",d)))});function a(f){for(var h=0;h<f.state.activeLines.length;h++)f.removeLineClass(f.state.activeLines[h],"wrap",n),f.removeLineClass(f.state.activeLines[h],"background",i),f.removeLineClass(f.state.activeLines[h],"gutter",o)}function l(f,h){if(f.length!=h.length)return!1;for(var g=0;g<f.length;g++)if(f[g]!=h[g])return!1;return!0}function u(f,h){for(var g=[],y=0;y<h.length;y++){var w=h[y],x=f.getOption("styleActiveLine");if(!(typeof x=="object"&&x.nonEmpty?w.anchor.line!=w.head.line:!w.empty())){var b=f.getLineHandleVisualStart(w.head.line);g[g.length-1]!=b&&g.push(b)}}l(f.state.activeLines,g)||f.operation(function(){a(f);for(var _=0;_<g.length;_++)f.addLineClass(g[_],"wrap",n),f.addLineClass(g[_],"background",i),f.addLineClass(g[_],"gutter",o);f.state.activeLines=g})}function d(f,h){u(f,h.ranges)}})}()),my.exports}EP();var CP=Lo();const X1=ha(CP);var _y={exports:{}},by;function kP(){return by||(by=1,function(r,e){(function(t){t(Lo())})(function(t){var n=t.Pos,i="http://www.w3.org/2000/svg";function o(A,F){this.mv=A,this.type=F,this.classes=F=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}o.prototype={constructor:o,init:function(A,F,ee){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=t(A,se({value:F,readOnly:!this.mv.options.allowEditingOriginals},se(ee))),this.mv.options.connect=="align"&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new ft(this.edit)),this.orig.state.trackAlignable=new ft(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.lockButton.setAttribute("aria-label",this.lockButton.title),this.orig.state.diffViews=[this];var K=ee.chunkClassLocation||"background";Object.prototype.toString.call(K)!="[object Array]"&&(K=[K]),this.classes.classLocation=K,this.diff=fe(U(F),U(ee.value),this.mv.options.ignoreWhitespace),this.chunks=Ee(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=ee.showDifferences!==!1},registerEvents:function(A){this.forceUpdate=u(this),g(this,!0,!1),d(this,A)},setShowDifferences:function(A){A=A!==!1,A!=this.showDifferences&&(this.showDifferences=A,this.forceUpdate("full"))}};function a(A){A.diffOutOfDate&&(A.diff=fe(A.orig.getValue(),A.edit.getValue(),A.mv.options.ignoreWhitespace),A.chunks=Ee(A.diff),A.diffOutOfDate=!1,t.signal(A.edit,"updateDiff",A.diff))}var l=!1;function u(A){var F={from:0,to:0,marked:[]},ee={from:0,to:0,marked:[]},K,oe=!1;function ie(Ze){l=!0,oe=!1,Ze=="full"&&(A.svg&&W(A.svg),A.copyButtons&&W(A.copyButtons),w(A.edit,F.marked,A.classes),w(A.orig,ee.marked,A.classes),F.from=F.to=ee.from=ee.to=0),a(A),A.showDifferences&&(x(A.edit,A.diff,F,DIFF_INSERT,A.classes),x(A.orig,A.diff,ee,DIFF_DELETE,A.classes)),A.mv.options.connect=="align"&&T(A),S(A),A.needsScrollSync!=null&&f(A,A.needsScrollSync),l=!1}function ce(Ze){l||(A.dealigned=!0,Ce(Ze))}function Ce(Ze){l||oe||(clearTimeout(K),Ze===!0&&(oe=!0),K=setTimeout(ie,Ze===!0?20:250))}function ke(Ze,ct){A.diffOutOfDate||(A.diffOutOfDate=!0,F.from=F.to=ee.from=ee.to=0),ce(ct.text.length-1!=ct.to.line-ct.from.line)}function je(){A.diffOutOfDate=!0,A.dealigned=!0,ie("full")}return A.edit.on("change",ke),A.orig.on("change",ke),A.edit.on("swapDoc",je),A.orig.on("swapDoc",je),A.mv.options.connect=="align"&&(t.on(A.edit.state.trackAlignable,"realign",ce),t.on(A.orig.state.trackAlignable,"realign",ce)),A.edit.on("viewportChange",function(){Ce(!1)}),A.orig.on("viewportChange",function(){Ce(!1)}),ie(),ie}function d(A,F){A.edit.on("scroll",function(){f(A,!0)&&S(A)}),A.orig.on("scroll",function(){f(A,!1)&&S(A),F&&f(F,!0)&&S(F)})}function f(A,F){if(A.diffOutOfDate)return A.lockScroll&&A.needsScrollSync==null&&(A.needsScrollSync=F),!1;if(A.needsScrollSync=null,!A.lockScroll)return!0;var ee,K,oe=+new Date;if(F?(ee=A.edit,K=A.orig):(ee=A.orig,K=A.edit),ee.state.scrollSetBy==A&&(ee.state.scrollSetAt||0)+250>oe)return!1;var ie=ee.getScrollInfo();if(A.mv.options.connect=="align")Rt=ie.top;else{var ce=.5*ie.clientHeight,Ce=ie.top+ce,ke=ee.lineAtHeight(Ce,"local"),je=Me(A.chunks,ke,F),Ze=h(ee,F?je.edit:je.orig),ct=h(K,F?je.orig:je.edit),pt=(Ce-Ze.top)/(Ze.bot-Ze.top),Rt=ct.top-ce+pt*(ct.bot-ct.top),Je,dt;if(Rt>ie.top&&(dt=ie.top/ce)<1)Rt=Rt*dt+ie.top*(1-dt);else if((Je=ie.height-ie.clientHeight-ie.top)<ce){var It=K.getScrollInfo(),at=It.height-It.clientHeight-Rt;at>Je&&(dt=Je/ce)<1&&(Rt=Rt*dt+(It.height-It.clientHeight-Je)*(1-dt))}}return K.scrollTo(ie.left,Rt),K.state.scrollSetAt=oe,K.state.scrollSetBy=A,!0}function h(A,F){var ee=F.after;return ee==null&&(ee=A.lastLine()+1),{top:A.heightAtLine(F.before||0,"local"),bot:A.heightAtLine(ee,"local")}}function g(A,F,ee){A.lockScroll=F,F&&ee!=!1&&f(A,DIFF_INSERT)&&S(A),(F?t.addClass:t.rmClass)(A.lockButton,"CodeMirror-merge-scrolllock-enabled")}function y(A,F,ee){for(var K=ee.classLocation,oe=0;oe<K.length;oe++)A.removeLineClass(F,K[oe],ee.chunk),A.removeLineClass(F,K[oe],ee.start),A.removeLineClass(F,K[oe],ee.end)}function w(A,F,ee){for(var K=0;K<F.length;++K){var oe=F[K];oe instanceof t.TextMarker?oe.clear():oe.parent&&y(A,oe,ee)}F.length=0}function x(A,F,ee,K,oe){var ie=A.getViewport();A.operation(function(){ee.from==ee.to||ie.from-ee.to>20||ee.from-ie.to>20?(w(A,ee.marked,oe),_(A,F,K,ee.marked,ie.from,ie.to,oe),ee.from=ie.from,ee.to=ie.to):(ie.from<ee.from&&(_(A,F,K,ee.marked,ie.from,ee.from,oe),ee.from=ie.from),ie.to>ee.to&&(_(A,F,K,ee.marked,ee.to,ie.to,oe),ee.to=ie.to))})}function b(A,F,ee,K,oe,ie){for(var ce=ee.classLocation,Ce=A.getLineHandle(F),ke=0;ke<ce.length;ke++)K&&A.addLineClass(Ce,ce[ke],ee.chunk),oe&&A.addLineClass(Ce,ce[ke],ee.start),ie&&A.addLineClass(Ce,ce[ke],ee.end);return Ce}function _(A,F,ee,K,oe,ie,ce){var Ce=n(0,0),ke=n(oe,0),je=A.clipPos(n(ie-1)),Ze=ee==DIFF_DELETE?ce.del:ce.insert;function ct(nt,St){for(var xe=Math.max(oe,nt),qe=Math.min(ie,St),gt=xe;gt<qe;++gt)K.push(b(A,gt,ce,!0,gt==nt,gt==St-1));nt==St&&xe==St&&qe==St&&(xe?K.push(b(A,xe-1,ce,!1,!1,!0)):K.push(b(A,xe,ce,!1,!0,!1)))}for(var pt=0,Rt=!1,Je=0;Je<F.length;++Je){var dt=F[Je],It=dt[0],at=dt[1];if(It==DIFF_EQUAL){var Fe=Ce.line+(rt(F,Je)?0:1);ge(Ce,at);var Re=Ce.line+(_e(F,Je)?1:0);Re>Fe&&(Rt&&(ct(pt,Fe),Rt=!1),pt=Re)}else if(Rt=!0,It==ee){var vt=ge(Ce,at,!0),Ye=Nt(ke,Ce),Qe=Ke(je,vt);yt(Ye,Qe)||K.push(A.markText(Ye,Qe,{className:Ze})),Ce=vt}}Rt&&ct(pt,Ce.line+1)}function S(A){if(A.showDifferences){if(A.svg){W(A.svg);var F=A.gap.offsetWidth;Y(A.svg,"width",F,"height",A.gap.offsetHeight)}A.copyButtons&&W(A.copyButtons);for(var ee=A.edit.getViewport(),K=A.orig.getViewport(),oe=A.mv.wrap.getBoundingClientRect().top,ie=oe-A.edit.getScrollerElement().getBoundingClientRect().top+A.edit.getScrollInfo().top,ce=oe-A.orig.getScrollerElement().getBoundingClientRect().top+A.orig.getScrollInfo().top,Ce=0;Ce<A.chunks.length;Ce++){var ke=A.chunks[Ce];ke.editFrom<=ee.to&&ke.editTo>=ee.from&&ke.origFrom<=K.to&&ke.origTo>=K.from&&ne(A,ke,ce,ie,F)}}}function k(A,F){for(var ee=0,K=0,oe=0;oe<F.length;oe++){var ie=F[oe];if(ie.editTo>A&&ie.editFrom<=A)return null;if(ie.editFrom>A)break;ee=ie.editTo,K=ie.origTo}return K+(A-ee)}function O(A,F,ee){for(var K=A.state.trackAlignable,oe=A.firstLine(),ie=0,ce=[],Ce=0;;Ce++){for(var ke=F[Ce],je=ke?ee?ke.origFrom:ke.editFrom:1e9;ie<K.alignable.length;ie+=2){var Ze=K.alignable[ie]+1;if(!(Ze<=oe))if(Ze<=je)ce.push(Ze);else break}if(!ke)break;ce.push(oe=ee?ke.origTo:ke.editTo)}return ce}function M(A,F,ee,K){var oe=0,ie=0,ce=0,Ce=0;e:for(;;oe++){var ke=A[oe],je=F[ie];if(!ke&&je==null)break;for(var Ze=ke?ke[0]:1e9,ct=je??1e9;ce<ee.length;){var pt=ee[ce];if(pt.origFrom<=ct&&pt.origTo>ct){ie++,oe--;continue e}if(pt.editTo>Ze){if(pt.editFrom<=Ze)continue e;break}Ce+=pt.origTo-pt.origFrom-(pt.editTo-pt.editFrom),ce++}if(Ze==ct-Ce)ke[K]=ct,ie++;else if(Ze<ct-Ce)ke[K]=Ze+Ce;else{var Rt=[ct-Ce,null,null];Rt[K]=ct,A.splice(oe,0,Rt),ie++}}}function R(A,F){var ee=O(A.edit,A.chunks,!1),K=[];if(F)for(var oe=0,ie=0;oe<F.chunks.length;oe++){for(var ce=F.chunks[oe].editTo;ie<ee.length&&ee[ie]<ce;)ie++;(ie==ee.length||ee[ie]!=ce)&&ee.splice(ie++,0,ce)}for(var oe=0;oe<ee.length;oe++)K.push([ee[oe],null,null]);return M(K,O(A.orig,A.chunks,!0),A.chunks,1),F&&M(K,O(F.orig,F.chunks,!0),F.chunks,2),K}function T(A,F){if(!(!A.dealigned&&!F)){if(!A.orig.curOp)return A.orig.operation(function(){T(A,F)});A.dealigned=!1;var ee=A.mv.left==A?A.mv.right:A.mv.left;ee&&(a(ee),ee.dealigned=!1);for(var K=R(A,ee),oe=A.mv.aligners,ie=0;ie<oe.length;ie++)oe[ie].clear();oe.length=0;var ce=[A.edit,A.orig],Ce=[],ke=[];ee&&ce.push(ee.orig);for(var ie=0;ie<ce.length;ie++)Ce.push(ce[ie].getScrollInfo().top),ke.push(-ce[ie].getScrollerElement().getBoundingClientRect().top);(ke[0]!=ke[1]||ce.length==3&&ke[1]!=ke[2])&&I(ce,ke,[0,0,0],oe);for(var je=0;je<K.length;je++)I(ce,ke,K[je],oe);for(var ie=0;ie<ce.length;ie++)ce[ie].scrollTo(null,Ce[ie])}}function I(A,F,ee,K){for(var oe=-1e8,ie=[],ce=0;ce<A.length;ce++)if(ee[ce]!=null){var Ce=A[ce].heightAtLine(ee[ce],"local")-F[ce];ie[ce]=Ce,oe=Math.max(oe,Ce)}for(var ce=0;ce<A.length;ce++)if(ee[ce]!=null){var ke=oe-ie[ce];ke>1&&K.push($(A[ce],ee[ce],ke))}}function $(A,F,ee){var K=!0;F>A.lastLine()&&(F--,K=!1);var oe=document.createElement("div");return oe.className="CodeMirror-merge-spacer",oe.style.height=ee+"px",oe.style.minWidth="1px",A.addLineWidget(F,oe,{height:ee,above:K,mergeSpacer:!0,handleMouseEvents:!0})}function ne(A,F,ee,K,oe){var ie=A.type=="left",ce=A.orig.heightAtLine(F.origFrom,"local",!0)-ee;if(A.svg){var Ce=ce,ke=A.edit.heightAtLine(F.editFrom,"local",!0)-K;if(ie){var je=Ce;Ce=ke,ke=je}var Ze=A.orig.heightAtLine(F.origTo,"local",!0)-ee,ct=A.edit.heightAtLine(F.editTo,"local",!0)-K;if(ie){var je=Ze;Ze=ct,ct=je}var pt=" C "+oe/2+" "+ke+" "+oe/2+" "+Ce+" "+(oe+2)+" "+Ce,Rt=" C "+oe/2+" "+Ze+" "+oe/2+" "+ct+" -1 "+ct;Y(A.svg.appendChild(document.createElementNS(i,"path")),"d","M -1 "+ke+pt+" L "+(oe+2)+" "+Ze+Rt+" z","class",A.classes.connect)}if(A.copyButtons){var Je=A.copyButtons.appendChild(le("div",A.type=="left"?"⇝":"⇜","CodeMirror-merge-copy")),dt=A.mv.options.allowEditingOriginals;if(Je.title=A.edit.phrase(dt?"Push to left":"Revert chunk"),Je.chunk=F,Je.style.top=(F.origTo>F.origFrom?ce:A.edit.heightAtLine(F.editFrom,"local")-K)+"px",Je.setAttribute("role","button"),Je.setAttribute("tabindex","0"),Je.setAttribute("aria-label",Je.title),dt){var It=A.edit.heightAtLine(F.editFrom,"local")-K,at=A.copyButtons.appendChild(le("div",A.type=="right"?"⇝":"⇜","CodeMirror-merge-copy-reverse"));at.title="Push to right",at.chunk={editFrom:F.origFrom,editTo:F.origTo,origFrom:F.editFrom,origTo:F.editTo},at.style.top=It+"px",A.type=="right"?at.style.left="2px":at.style.right="2px",at.setAttribute("role","button"),at.setAttribute("tabindex","0"),at.setAttribute("aria-label",at.title)}}}function V(A,F,ee,K){if(!A.diffOutOfDate){var oe=K.origTo>ee.lastLine()?n(K.origFrom-1):n(K.origFrom,0),ie=n(K.origTo,0),ce=K.editTo>F.lastLine()?n(K.editFrom-1):n(K.editFrom,0),Ce=n(K.editTo,0),ke=A.mv.options.revertChunk;ke?ke(A.mv,ee,oe,ie,F,ce,Ce):F.replaceRange(ee.getRange(oe,ie),ce,Ce)}}var J=t.MergeView=function(A,F){if(!(this instanceof J))return new J(A,F);this.options=F;var ee=F.origLeft,K=F.origRight==null?F.orig:F.origRight,oe=ee!=null,ie=K!=null,ce=1+(oe?1:0)+(ie?1:0),Ce=[],ke=this.left=null,je=this.right=null,Ze=this;if(oe){ke=this.left=new o(this,"left");var ct=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");Ce.push(ct),Ce.push(D(ke))}var pt=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");if(Ce.push(pt),ie){je=this.right=new o(this,"right"),Ce.push(D(je));var Rt=le("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");Ce.push(Rt)}(ie?Rt:pt).className+=" CodeMirror-merge-pane-rightmost",Ce.push(le("div",null,null,"height: 0; clear: both;"));var Je=this.wrap=A.appendChild(le("div",Ce,"CodeMirror-merge CodeMirror-merge-"+ce+"pane"));this.edit=t(pt,se(F)),ke&&ke.init(ct,ee,F),je&&je.init(Rt,K,F),F.collapseIdentical&&this.editor().operation(function(){de(Ze,F.collapseIdentical)}),F.connect=="align"&&(this.aligners=[],T(this.left||this.right,!0)),ke&&ke.registerEvents(je),je&&je.registerEvents(ke);var dt=function(){ke&&S(ke),je&&S(je)};t.on(window,"resize",dt);var It=setInterval(function(){for(var at=Je.parentNode;at&&at!=document.body;at=at.parentNode);at||(clearInterval(It),t.off(window,"resize",dt))},5e3)};function D(A){var F=A.lockButton=le("div",null,"CodeMirror-merge-scrolllock");F.setAttribute("role","button"),F.setAttribute("tabindex","0");var ee=le("div",[F],"CodeMirror-merge-scrolllock-wrap");t.on(F,"click",function(){g(A,!A.lockScroll)}),t.on(F,"keyup",function(ce){(ce.key==="Enter"||ce.code==="Space")&&g(A,!A.lockScroll)});var K=[ee];if(A.mv.options.revertButtons!==!1){A.copyButtons=le("div",null,"CodeMirror-merge-copybuttons-"+A.type);var oe=function(ce){var Ce=ce.target||ce.srcElement;if(Ce.chunk){if(Ce.className=="CodeMirror-merge-copy-reverse"){V(A,A.orig,A.edit,Ce.chunk);return}V(A,A.edit,A.orig,Ce.chunk)}};t.on(A.copyButtons,"click",oe),t.on(A.copyButtons,"keyup",function(ce){(ce.key==="Enter"||ce.code==="Space")&&oe(ce)}),K.unshift(A.copyButtons)}if(A.mv.options.connect!="align"){var ie=document.createElementNS&&document.createElementNS(i,"svg");ie&&!ie.createSVGRect&&(ie=null),A.svg=ie,ie&&K.push(ie)}return A.gap=le("div",K,"CodeMirror-merge-gap")}J.prototype={constructor:J,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(A){this.right&&this.right.setShowDifferences(A),this.left&&this.left.setShowDifferences(A)},rightChunks:function(){if(this.right)return a(this.right),this.right.chunks},leftChunks:function(){if(this.left)return a(this.left),this.left.chunks}};function U(A){return typeof A=="string"?A:A.getValue()}var j;function fe(A,F,ee){j||(j=new diff_match_patch);for(var K=j.diff_main(A,F),oe=0;oe<K.length;++oe){var ie=K[oe];(ee?!/[^ \t]/.test(ie[1]):!ie[1])?K.splice(oe--,1):oe&&K[oe-1][0]==ie[0]&&(K.splice(oe--,1),K[oe][1]+=ie[1])}return K}function Ee(A){var F=[];if(!A.length)return F;for(var ee=0,K=0,oe=n(0,0),ie=n(0,0),ce=0;ce<A.length;++ce){var Ce=A[ce],ke=Ce[0];if(ke==DIFF_EQUAL){var je=!rt(A,ce)||oe.line<ee||ie.line<K?1:0,Ze=oe.line+je,ct=ie.line+je;ge(oe,Ce[1],null,ie);var pt=_e(A,ce)?1:0,Rt=oe.line+pt,Je=ie.line+pt;Rt>Ze&&(ce&&F.push({origFrom:K,origTo:ct,editFrom:ee,editTo:Ze}),ee=Rt,K=Je)}else ge(ke==DIFF_INSERT?oe:ie,Ce[1])}return(ee<=oe.line||K<=ie.line)&&F.push({origFrom:K,origTo:ie.line+1,editFrom:ee,editTo:oe.line+1}),F}function _e(A,F){if(F==A.length-1)return!0;var ee=A[F+1][1];return ee.length==1&&F<A.length-2||ee.charCodeAt(0)!=10?!1:F==A.length-2?!0:(ee=A[F+2][1],(ee.length>1||F==A.length-3)&&ee.charCodeAt(0)==10)}function rt(A,F){if(F==0)return!0;var ee=A[F-1][1];return ee.charCodeAt(ee.length-1)!=10?!1:F==1?!0:(ee=A[F-2][1],ee.charCodeAt(ee.length-1)==10)}function Me(A,F,ee){for(var K,oe,ie,ce,Ce=0;Ce<A.length;Ce++){var ke=A[Ce],je=ee?ke.editFrom:ke.origFrom,Ze=ee?ke.editTo:ke.origTo;oe==null&&(je>F?(oe=ke.editFrom,ce=ke.origFrom):Ze>F&&(oe=ke.editTo,ce=ke.origTo)),Ze<=F?(K=ke.editTo,ie=ke.origTo):je<=F&&(K=ke.editFrom,ie=ke.origFrom)}return{edit:{before:K,after:oe},orig:{before:ie,after:ce}}}function ve(A,F,ee){A.addLineClass(F,"wrap","CodeMirror-merge-collapsed-line");var K=document.createElement("span");K.className="CodeMirror-merge-collapsed-widget",K.title=A.phrase("Identical text collapsed. Click to expand.");var oe=A.markText(n(F,0),n(ee-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:K,clearOnEnter:!0});function ie(){oe.clear(),A.removeLineClass(F,"wrap","CodeMirror-merge-collapsed-line")}return oe.explicitlyCleared&&ie(),t.on(K,"click",ie),oe.on("clear",ie),t.on(K,"click",ie),{mark:oe,clear:ie}}function Ve(A,F){var ee=[];function K(){for(var Ce=0;Ce<ee.length;Ce++)ee[Ce].clear()}for(var oe=0;oe<F.length;oe++){var ie=F[oe],ce=ve(ie.cm,ie.line,ie.line+A);ee.push(ce),ce.mark.on("clear",K)}return ee[0].mark}function Be(A,F,ee,K){for(var oe=0;oe<A.chunks.length;oe++)for(var ie=A.chunks[oe],ce=ie.editFrom-F;ce<ie.editTo+F;ce++){var Ce=ce+ee;Ce>=0&&Ce<K.length&&(K[Ce]=!1)}}function de(A,F){typeof F!="number"&&(F=2);for(var ee=[],K=A.editor(),oe=K.firstLine(),ie=oe,ce=K.lastLine();ie<=ce;ie++)ee.push(!0);A.left&&Be(A.left,F,oe,ee),A.right&&Be(A.right,F,oe,ee);for(var Ce=0;Ce<ee.length;Ce++)if(ee[Ce]){for(var ke=Ce+oe,je=1;Ce<ee.length-1&&ee[Ce+1];Ce++,je++);if(je>F){var Ze=[{line:ke,cm:K}];A.left&&Ze.push({line:k(ke,A.left.chunks),cm:A.left.orig}),A.right&&Ze.push({line:k(ke,A.right.chunks),cm:A.right.orig});var ct=Ve(je,Ze);A.options.onCollapse&&A.options.onCollapse(A,ke,je,ct)}}}function le(A,F,ee,K){var oe=document.createElement(A);if(ee&&(oe.className=ee),K&&(oe.style.cssText=K),typeof F=="string")oe.appendChild(document.createTextNode(F));else if(F)for(var ie=0;ie<F.length;++ie)oe.appendChild(F[ie]);return oe}function W(A){for(var F=A.childNodes.length;F>0;--F)A.removeChild(A.firstChild)}function Y(A){for(var F=1;F<arguments.length;F+=2)A.setAttribute(arguments[F],arguments[F+1])}function se(A,F){F||(F={});for(var ee in A)A.hasOwnProperty(ee)&&(F[ee]=A[ee]);return F}function ge(A,F,ee,K){for(var oe=ee?n(A.line,A.ch):A,ie=0;;){var ce=F.indexOf(`
`,ie);if(ce==-1)break;++oe.line,K&&++K.line,ie=ce+1}return oe.ch=(ie?0:oe.ch)+(F.length-ie),K&&(K.ch=(ie?0:K.ch)+(F.length-ie)),oe}var Pe=1,Le=2,He=4;function ft(A){this.cm=A,this.alignable=[],this.height=A.doc.height;var F=this;A.on("markerAdded",function(ee,K){if(K.collapsed){var oe=K.find(1);oe!=null&&F.set(oe.line,He)}}),A.on("markerCleared",function(ee,K,oe,ie){ie!=null&&K.collapsed&&F.check(ie,He,F.hasMarker)}),A.on("markerChanged",this.signal.bind(this)),A.on("lineWidgetAdded",function(ee,K,oe){K.mergeSpacer||(K.above?F.set(oe-1,Le):F.set(oe,Pe))}),A.on("lineWidgetCleared",function(ee,K,oe){K.mergeSpacer||(K.above?F.check(oe-1,Le,F.hasWidgetBelow):F.check(oe,Pe,F.hasWidget))}),A.on("lineWidgetChanged",this.signal.bind(this)),A.on("change",function(ee,K){var oe=K.from.line,ie=K.to.line-K.from.line,ce=K.text.length-1,Ce=oe+ce;(ie||ce)&&F.map(oe,ie,ce),F.check(Ce,He,F.hasMarker),(ie||ce)&&F.check(K.from.line,He,F.hasMarker)}),A.on("viewportChange",function(){F.cm.doc.height!=F.height&&F.signal()})}ft.prototype={signal:function(){t.signal(this,"realign"),this.height=this.cm.doc.height},set:function(A,F){for(var ee=-1;ee<this.alignable.length;ee+=2){var K=this.alignable[ee]-A;if(K==0){if((this.alignable[ee+1]&F)==F)return;this.alignable[ee+1]|=F,this.signal();return}if(K>0)break}this.signal(),this.alignable.splice(ee,0,A,F)},find:function(A){for(var F=0;F<this.alignable.length;F+=2)if(this.alignable[F]==A)return F;return-1},check:function(A,F,ee){var K=this.find(A);if(!(K==-1||!(this.alignable[K+1]&F))&&!ee.call(this,A)){this.signal();var oe=this.alignable[K+1]&~F;oe?this.alignable[K+1]=oe:this.alignable.splice(K,2)}},hasMarker:function(A){var F=this.cm.getLineHandle(A);if(F.markedSpans){for(var ee=0;ee<F.markedSpans.length;ee++)if(F.markedSpans[ee].marker.collapsed&&F.markedSpans[ee].to!=null)return!0}return!1},hasWidget:function(A){var F=this.cm.getLineHandle(A);if(F.widgets){for(var ee=0;ee<F.widgets.length;ee++)if(!F.widgets[ee].above&&!F.widgets[ee].mergeSpacer)return!0}return!1},hasWidgetBelow:function(A){if(A==this.cm.lastLine())return!1;var F=this.cm.getLineHandle(A+1);if(F.widgets){for(var ee=0;ee<F.widgets.length;ee++)if(F.widgets[ee].above&&!F.widgets[ee].mergeSpacer)return!0}return!1},map:function(A,F,ee){for(var K=ee-F,oe=A+F,ie=-1,ce=-1,Ce=0;Ce<this.alignable.length;Ce+=2){var ke=this.alignable[Ce];ke==A&&this.alignable[Ce+1]&Le&&(ie=Ce),ke==oe&&this.alignable[Ce+1]&Le&&(ce=Ce),!(ke<=A)&&(ke<oe?this.alignable.splice(Ce--,2):this.alignable[Ce]+=K)}if(ie>-1){var je=this.alignable[ie+1];je==Le?this.alignable.splice(ie,2):this.alignable[ie+1]=je&~Le}ce>-1&&ee&&this.set(A+ee,Le)}};function Ke(A,F){return(A.line-F.line||A.ch-F.ch)<0?A:F}function Nt(A,F){return(A.line-F.line||A.ch-F.ch)>0?A:F}function yt(A,F){return A.line==F.line&&A.ch==F.ch}function Wt(A,F,ee){for(var K=A.length-1;K>=0;K--){var oe=A[K],ie=(ee?oe.origTo:oe.editTo)-1;if(ie<F)return ie}}function Ft(A,F,ee){for(var K=0;K<A.length;K++){var oe=A[K],ie=ee?oe.origFrom:oe.editFrom;if(ie>F)return ie}}function te(A,F){var ee=null,K=A.state.diffViews,oe=A.getCursor().line;if(K)for(var ie=0;ie<K.length;ie++){var ce=K[ie],Ce=A==ce.orig;a(ce);var ke=F<0?Wt(ce.chunks,oe,Ce):Ft(ce.chunks,oe,Ce);ke!=null&&(ee==null||(F<0?ke>ee:ke<ee))&&(ee=ke)}if(ee!=null)A.setCursor(ee,0);else return t.Pass}t.commands.goNextDiff=function(A){return te(A,1)},t.commands.goPrevDiff=function(A){return te(A,-1)}})}()),_y.exports}kP();var Ef={exports:{}},xy;function OP(){return xy||(xy=1,function(r){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,i=0;e.Diff=function(o,a){return[o,a]},e.prototype.diff_main=function(o,a,l,u){typeof u>"u"&&(this.Diff_Timeout<=0?u=Number.MAX_VALUE:u=new Date().getTime()+this.Diff_Timeout*1e3);var d=u;if(o==null||a==null)throw new Error("Null input. (diff_main)");if(o==a)return o?[new e.Diff(i,o)]:[];typeof l>"u"&&(l=!0);var f=l,h=this.diff_commonPrefix(o,a),g=o.substring(0,h);o=o.substring(h),a=a.substring(h),h=this.diff_commonSuffix(o,a);var y=o.substring(o.length-h);o=o.substring(0,o.length-h),a=a.substring(0,a.length-h);var w=this.diff_compute_(o,a,f,d);return g&&w.unshift(new e.Diff(i,g)),y&&w.push(new e.Diff(i,y)),this.diff_cleanupMerge(w),w},e.prototype.diff_compute_=function(o,a,l,u){var d;if(!o)return[new e.Diff(n,a)];if(!a)return[new e.Diff(t,o)];var f=o.length>a.length?o:a,h=o.length>a.length?a:o,g=f.indexOf(h);if(g!=-1)return d=[new e.Diff(n,f.substring(0,g)),new e.Diff(i,h),new e.Diff(n,f.substring(g+h.length))],o.length>a.length&&(d[0][0]=d[2][0]=t),d;if(h.length==1)return[new e.Diff(t,o),new e.Diff(n,a)];var y=this.diff_halfMatch_(o,a);if(y){var w=y[0],x=y[1],b=y[2],_=y[3],S=y[4],k=this.diff_main(w,b,l,u),O=this.diff_main(x,_,l,u);return k.concat([new e.Diff(i,S)],O)}return l&&o.length>100&&a.length>100?this.diff_lineMode_(o,a,u):this.diff_bisect_(o,a,u)},e.prototype.diff_lineMode_=function(o,a,l){var u=this.diff_linesToChars_(o,a);o=u.chars1,a=u.chars2;var d=u.lineArray,f=this.diff_main(o,a,!1,l);this.diff_charsToLines_(f,d),this.diff_cleanupSemantic(f),f.push(new e.Diff(i,""));for(var h=0,g=0,y=0,w="",x="";h<f.length;){switch(f[h][0]){case n:y++,x+=f[h][1];break;case t:g++,w+=f[h][1];break;case i:if(g>=1&&y>=1){f.splice(h-g-y,g+y),h=h-g-y;for(var b=this.diff_main(w,x,!1,l),_=b.length-1;_>=0;_--)f.splice(h,0,b[_]);h=h+b.length}y=0,g=0,w="",x="";break}h++}return f.pop(),f},e.prototype.diff_bisect_=function(o,a,l){for(var u=o.length,d=a.length,f=Math.ceil((u+d)/2),h=f,g=2*f,y=new Array(g),w=new Array(g),x=0;x<g;x++)y[x]=-1,w[x]=-1;y[h+1]=0,w[h+1]=0;for(var b=u-d,_=b%2!=0,S=0,k=0,O=0,M=0,R=0;R<f&&!(new Date().getTime()>l);R++){for(var T=-R+S;T<=R-k;T+=2){var I=h+T,$;T==-R||T!=R&&y[I-1]<y[I+1]?$=y[I+1]:$=y[I-1]+1;for(var ne=$-T;$<u&&ne<d&&o.charAt($)==a.charAt(ne);)$++,ne++;if(y[I]=$,$>u)k+=2;else if(ne>d)S+=2;else if(_){var V=h+b-T;if(V>=0&&V<g&&w[V]!=-1){var J=u-w[V];if($>=J)return this.diff_bisectSplit_(o,a,$,ne,l)}}}for(var D=-R+O;D<=R-M;D+=2){var V=h+D,J;D==-R||D!=R&&w[V-1]<w[V+1]?J=w[V+1]:J=w[V-1]+1;for(var U=J-D;J<u&&U<d&&o.charAt(u-J-1)==a.charAt(d-U-1);)J++,U++;if(w[V]=J,J>u)M+=2;else if(U>d)O+=2;else if(!_){var I=h+b-D;if(I>=0&&I<g&&y[I]!=-1){var $=y[I],ne=h+$-I;if(J=u-J,$>=J)return this.diff_bisectSplit_(o,a,$,ne,l)}}}}return[new e.Diff(t,o),new e.Diff(n,a)]},e.prototype.diff_bisectSplit_=function(o,a,l,u,d){var f=o.substring(0,l),h=a.substring(0,u),g=o.substring(l),y=a.substring(u),w=this.diff_main(f,h,!1,d),x=this.diff_main(g,y,!1,d);return w.concat(x)},e.prototype.diff_linesToChars_=function(o,a){var l=[],u={};l[0]="";function d(y){for(var w="",x=0,b=-1,_=l.length;b<y.length-1;){b=y.indexOf(`
`,x),b==-1&&(b=y.length-1);var S=y.substring(x,b+1);(u.hasOwnProperty?u.hasOwnProperty(S):u[S]!==void 0)?w+=String.fromCharCode(u[S]):(_==f&&(S=y.substring(x),b=y.length),w+=String.fromCharCode(_),u[S]=_,l[_++]=S),x=b+1}return w}var f=4e4,h=d(o);f=65535;var g=d(a);return{chars1:h,chars2:g,lineArray:l}},e.prototype.diff_charsToLines_=function(o,a){for(var l=0;l<o.length;l++){for(var u=o[l][1],d=[],f=0;f<u.length;f++)d[f]=a[u.charCodeAt(f)];o[l][1]=d.join("")}},e.prototype.diff_commonPrefix=function(o,a){if(!o||!a||o.charAt(0)!=a.charAt(0))return 0;for(var l=0,u=Math.min(o.length,a.length),d=u,f=0;l<d;)o.substring(f,d)==a.substring(f,d)?(l=d,f=l):u=d,d=Math.floor((u-l)/2+l);return d},e.prototype.diff_commonSuffix=function(o,a){if(!o||!a||o.charAt(o.length-1)!=a.charAt(a.length-1))return 0;for(var l=0,u=Math.min(o.length,a.length),d=u,f=0;l<d;)o.substring(o.length-d,o.length-f)==a.substring(a.length-d,a.length-f)?(l=d,f=l):u=d,d=Math.floor((u-l)/2+l);return d},e.prototype.diff_commonOverlap_=function(o,a){var l=o.length,u=a.length;if(l==0||u==0)return 0;l>u?o=o.substring(l-u):l<u&&(a=a.substring(0,l));var d=Math.min(l,u);if(o==a)return d;for(var f=0,h=1;;){var g=o.substring(d-h),y=a.indexOf(g);if(y==-1)return f;h+=y,(y==0||o.substring(d-h)==a.substring(0,h))&&(f=h,h++)}},e.prototype.diff_halfMatch_=function(o,a){if(this.Diff_Timeout<=0)return null;var l=o.length>a.length?o:a,u=o.length>a.length?a:o;if(l.length<4||u.length*2<l.length)return null;var d=this;function f(k,O,M){for(var R=k.substring(M,M+Math.floor(k.length/4)),T=-1,I="",$,ne,V,J;(T=O.indexOf(R,T+1))!=-1;){var D=d.diff_commonPrefix(k.substring(M),O.substring(T)),U=d.diff_commonSuffix(k.substring(0,M),O.substring(0,T));I.length<U+D&&(I=O.substring(T-U,T)+O.substring(T,T+D),$=k.substring(0,M-U),ne=k.substring(M+D),V=O.substring(0,T-U),J=O.substring(T+D))}return I.length*2>=k.length?[$,ne,V,J,I]:null}var h=f(l,u,Math.ceil(l.length/4)),g=f(l,u,Math.ceil(l.length/2)),y;if(!h&&!g)return null;g?h?y=h[4].length>g[4].length?h:g:y=g:y=h;var w,x,b,_;o.length>a.length?(w=y[0],x=y[1],b=y[2],_=y[3]):(b=y[0],_=y[1],w=y[2],x=y[3]);var S=y[4];return[w,x,b,_,S]},e.prototype.diff_cleanupSemantic=function(o){for(var a=!1,l=[],u=0,d=null,f=0,h=0,g=0,y=0,w=0;f<o.length;)o[f][0]==i?(l[u++]=f,h=y,g=w,y=0,w=0,d=o[f][1]):(o[f][0]==n?y+=o[f][1].length:w+=o[f][1].length,d&&d.length<=Math.max(h,g)&&d.length<=Math.max(y,w)&&(o.splice(l[u-1],0,new e.Diff(t,d)),o[l[u-1]+1][0]=n,u--,u--,f=u>0?l[u-1]:-1,h=0,g=0,y=0,w=0,d=null,a=!0)),f++;for(a&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),f=1;f<o.length;){if(o[f-1][0]==t&&o[f][0]==n){var x=o[f-1][1],b=o[f][1],_=this.diff_commonOverlap_(x,b),S=this.diff_commonOverlap_(b,x);_>=S?(_>=x.length/2||_>=b.length/2)&&(o.splice(f,0,new e.Diff(i,b.substring(0,_))),o[f-1][1]=x.substring(0,x.length-_),o[f+1][1]=b.substring(_),f++):(S>=x.length/2||S>=b.length/2)&&(o.splice(f,0,new e.Diff(i,x.substring(0,S))),o[f-1][0]=n,o[f-1][1]=b.substring(0,b.length-S),o[f+1][0]=t,o[f+1][1]=x.substring(S),f++),f++}f++}},e.prototype.diff_cleanupSemanticLossless=function(o){function a(S,k){if(!S||!k)return 6;var O=S.charAt(S.length-1),M=k.charAt(0),R=O.match(e.nonAlphaNumericRegex_),T=M.match(e.nonAlphaNumericRegex_),I=R&&O.match(e.whitespaceRegex_),$=T&&M.match(e.whitespaceRegex_),ne=I&&O.match(e.linebreakRegex_),V=$&&M.match(e.linebreakRegex_),J=ne&&S.match(e.blanklineEndRegex_),D=V&&k.match(e.blanklineStartRegex_);return J||D?5:ne||V?4:R&&!I&&$?3:I||$?2:R||T?1:0}for(var l=1;l<o.length-1;){if(o[l-1][0]==i&&o[l+1][0]==i){var u=o[l-1][1],d=o[l][1],f=o[l+1][1],h=this.diff_commonSuffix(u,d);if(h){var g=d.substring(d.length-h);u=u.substring(0,u.length-h),d=g+d.substring(0,d.length-h),f=g+f}for(var y=u,w=d,x=f,b=a(u,d)+a(d,f);d.charAt(0)===f.charAt(0);){u+=d.charAt(0),d=d.substring(1)+f.charAt(0),f=f.substring(1);var _=a(u,d)+a(d,f);_>=b&&(b=_,y=u,w=d,x=f)}o[l-1][1]!=y&&(y?o[l-1][1]=y:(o.splice(l-1,1),l--),o[l][1]=w,x?o[l+1][1]=x:(o.splice(l+1,1),l--))}l++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(o){for(var a=!1,l=[],u=0,d=null,f=0,h=!1,g=!1,y=!1,w=!1;f<o.length;)o[f][0]==i?(o[f][1].length<this.Diff_EditCost&&(y||w)?(l[u++]=f,h=y,g=w,d=o[f][1]):(u=0,d=null),y=w=!1):(o[f][0]==t?w=!0:y=!0,d&&(h&&g&&y&&w||d.length<this.Diff_EditCost/2&&h+g+y+w==3)&&(o.splice(l[u-1],0,new e.Diff(t,d)),o[l[u-1]+1][0]=n,u--,d=null,h&&g?(y=w=!0,u=0):(u--,f=u>0?l[u-1]:-1,y=w=!1),a=!0)),f++;a&&this.diff_cleanupMerge(o)},e.prototype.diff_cleanupMerge=function(o){o.push(new e.Diff(i,""));for(var a=0,l=0,u=0,d="",f="",h;a<o.length;)switch(o[a][0]){case n:u++,f+=o[a][1],a++;break;case t:l++,d+=o[a][1],a++;break;case i:l+u>1?(l!==0&&u!==0&&(h=this.diff_commonPrefix(f,d),h!==0&&(a-l-u>0&&o[a-l-u-1][0]==i?o[a-l-u-1][1]+=f.substring(0,h):(o.splice(0,0,new e.Diff(i,f.substring(0,h))),a++),f=f.substring(h),d=d.substring(h)),h=this.diff_commonSuffix(f,d),h!==0&&(o[a][1]=f.substring(f.length-h)+o[a][1],f=f.substring(0,f.length-h),d=d.substring(0,d.length-h))),a-=l+u,o.splice(a,l+u),d.length&&(o.splice(a,0,new e.Diff(t,d)),a++),f.length&&(o.splice(a,0,new e.Diff(n,f)),a++),a++):a!==0&&o[a-1][0]==i?(o[a-1][1]+=o[a][1],o.splice(a,1)):a++,u=0,l=0,d="",f="";break}o[o.length-1][1]===""&&o.pop();var g=!1;for(a=1;a<o.length-1;)o[a-1][0]==i&&o[a+1][0]==i&&(o[a][1].substring(o[a][1].length-o[a-1][1].length)==o[a-1][1]?(o[a][1]=o[a-1][1]+o[a][1].substring(0,o[a][1].length-o[a-1][1].length),o[a+1][1]=o[a-1][1]+o[a+1][1],o.splice(a-1,1),g=!0):o[a][1].substring(0,o[a+1][1].length)==o[a+1][1]&&(o[a-1][1]+=o[a+1][1],o[a][1]=o[a][1].substring(o[a+1][1].length)+o[a+1][1],o.splice(a+1,1),g=!0)),a++;g&&this.diff_cleanupMerge(o)},e.prototype.diff_xIndex=function(o,a){var l=0,u=0,d=0,f=0,h;for(h=0;h<o.length&&(o[h][0]!==n&&(l+=o[h][1].length),o[h][0]!==t&&(u+=o[h][1].length),!(l>a));h++)d=l,f=u;return o.length!=h&&o[h][0]===t?f:f+(a-d)},e.prototype.diff_prettyHtml=function(o){for(var a=[],l=/&/g,u=/</g,d=/>/g,f=/\n/g,h=0;h<o.length;h++){var g=o[h][0],y=o[h][1],w=y.replace(l,"&amp;").replace(u,"&lt;").replace(d,"&gt;").replace(f,"&para;<br>");switch(g){case n:a[h]='<ins style="background:#e6ffe6;">'+w+"</ins>";break;case t:a[h]='<del style="background:#ffe6e6;">'+w+"</del>";break;case i:a[h]="<span>"+w+"</span>";break}}return a.join("")},e.prototype.diff_text1=function(o){for(var a=[],l=0;l<o.length;l++)o[l][0]!==n&&(a[l]=o[l][1]);return a.join("")},e.prototype.diff_text2=function(o){for(var a=[],l=0;l<o.length;l++)o[l][0]!==t&&(a[l]=o[l][1]);return a.join("")},e.prototype.diff_levenshtein=function(o){for(var a=0,l=0,u=0,d=0;d<o.length;d++){var f=o[d][0],h=o[d][1];switch(f){case n:l+=h.length;break;case t:u+=h.length;break;case i:a+=Math.max(l,u),l=0,u=0;break}}return a+=Math.max(l,u),a},e.prototype.diff_toDelta=function(o){for(var a=[],l=0;l<o.length;l++)switch(o[l][0]){case n:a[l]="+"+encodeURI(o[l][1]);break;case t:a[l]="-"+o[l][1].length;break;case i:a[l]="="+o[l][1].length;break}return a.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(o,a){for(var l=[],u=0,d=0,f=a.split(/\t/g),h=0;h<f.length;h++){var g=f[h].substring(1);switch(f[h].charAt(0)){case"+":try{l[u++]=new e.Diff(n,decodeURI(g))}catch{throw new Error("Illegal escape in diff_fromDelta: "+g)}break;case"-":case"=":var y=parseInt(g,10);if(isNaN(y)||y<0)throw new Error("Invalid number in diff_fromDelta: "+g);var w=o.substring(d,d+=y);f[h].charAt(0)=="="?l[u++]=new e.Diff(i,w):l[u++]=new e.Diff(t,w);break;default:if(f[h])throw new Error("Invalid diff operation in diff_fromDelta: "+f[h])}}if(d!=o.length)throw new Error("Delta length ("+d+") does not equal source text length ("+o.length+").");return l},e.prototype.match_main=function(o,a,l){if(o==null||a==null||l==null)throw new Error("Null input. (match_main)");return l=Math.max(0,Math.min(l,o.length)),o==a?0:o.length?o.substring(l,l+a.length)==a?l:this.match_bitap_(o,a,l):-1},e.prototype.match_bitap_=function(o,a,l){if(a.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var u=this.match_alphabet_(a),d=this;function f($,ne){var V=$/a.length,J=Math.abs(l-ne);return d.Match_Distance?V+J/d.Match_Distance:J?1:V}var h=this.Match_Threshold,g=o.indexOf(a,l);g!=-1&&(h=Math.min(f(0,g),h),g=o.lastIndexOf(a,l+a.length),g!=-1&&(h=Math.min(f(0,g),h)));var y=1<<a.length-1;g=-1;for(var w,x,b=a.length+o.length,_,S=0;S<a.length;S++){for(w=0,x=b;w<x;)f(S,l+x)<=h?w=x:b=x,x=Math.floor((b-w)/2+w);b=x;var k=Math.max(1,l-x+1),O=Math.min(l+x,o.length)+a.length,M=Array(O+2);M[O+1]=(1<<S)-1;for(var R=O;R>=k;R--){var T=u[o.charAt(R-1)];if(S===0?M[R]=(M[R+1]<<1|1)&T:M[R]=(M[R+1]<<1|1)&T|((_[R+1]|_[R])<<1|1)|_[R+1],M[R]&y){var I=f(S,R-1);if(I<=h)if(h=I,g=R-1,g>l)k=Math.max(1,2*l-g);else break}}if(f(S+1,l)>h)break;_=M}return g},e.prototype.match_alphabet_=function(o){for(var a={},l=0;l<o.length;l++)a[o.charAt(l)]=0;for(var l=0;l<o.length;l++)a[o.charAt(l)]|=1<<o.length-l-1;return a},e.prototype.patch_addContext_=function(o,a){if(a.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var l=a.substring(o.start2,o.start2+o.length1),u=0;a.indexOf(l)!=a.lastIndexOf(l)&&l.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)u+=this.Patch_Margin,l=a.substring(o.start2-u,o.start2+o.length1+u);u+=this.Patch_Margin;var d=a.substring(o.start2-u,o.start2);d&&o.diffs.unshift(new e.Diff(i,d));var f=a.substring(o.start2+o.length1,o.start2+o.length1+u);f&&o.diffs.push(new e.Diff(i,f)),o.start1-=d.length,o.start2-=d.length,o.length1+=d.length+f.length,o.length2+=d.length+f.length}},e.prototype.patch_make=function(o,a,l){var u,d;if(typeof o=="string"&&typeof a=="string"&&typeof l>"u")u=o,d=this.diff_main(u,a,!0),d.length>2&&(this.diff_cleanupSemantic(d),this.diff_cleanupEfficiency(d));else if(o&&typeof o=="object"&&typeof a>"u"&&typeof l>"u")d=o,u=this.diff_text1(d);else if(typeof o=="string"&&a&&typeof a=="object"&&typeof l>"u")u=o,d=a;else if(typeof o=="string"&&typeof a=="string"&&l&&typeof l=="object")u=o,d=l;else throw new Error("Unknown call format to patch_make.");if(d.length===0)return[];for(var f=[],h=new e.patch_obj,g=0,y=0,w=0,x=u,b=u,_=0;_<d.length;_++){var S=d[_][0],k=d[_][1];switch(!g&&S!==i&&(h.start1=y,h.start2=w),S){case n:h.diffs[g++]=d[_],h.length2+=k.length,b=b.substring(0,w)+k+b.substring(w);break;case t:h.length1+=k.length,h.diffs[g++]=d[_],b=b.substring(0,w)+b.substring(w+k.length);break;case i:k.length<=2*this.Patch_Margin&&g&&d.length!=_+1?(h.diffs[g++]=d[_],h.length1+=k.length,h.length2+=k.length):k.length>=2*this.Patch_Margin&&g&&(this.patch_addContext_(h,x),f.push(h),h=new e.patch_obj,g=0,x=b,y=w);break}S!==n&&(y+=k.length),S!==t&&(w+=k.length)}return g&&(this.patch_addContext_(h,x),f.push(h)),f},e.prototype.patch_deepCopy=function(o){for(var a=[],l=0;l<o.length;l++){var u=o[l],d=new e.patch_obj;d.diffs=[];for(var f=0;f<u.diffs.length;f++)d.diffs[f]=new e.Diff(u.diffs[f][0],u.diffs[f][1]);d.start1=u.start1,d.start2=u.start2,d.length1=u.length1,d.length2=u.length2,a[l]=d}return a},e.prototype.patch_apply=function(o,a){if(o.length==0)return[a,[]];o=this.patch_deepCopy(o);var l=this.patch_addPadding(o);a=l+a+l,this.patch_splitMax(o);for(var u=0,d=[],f=0;f<o.length;f++){var h=o[f].start2+u,g=this.diff_text1(o[f].diffs),y,w=-1;if(g.length>this.Match_MaxBits?(y=this.match_main(a,g.substring(0,this.Match_MaxBits),h),y!=-1&&(w=this.match_main(a,g.substring(g.length-this.Match_MaxBits),h+g.length-this.Match_MaxBits),(w==-1||y>=w)&&(y=-1))):y=this.match_main(a,g,h),y==-1)d[f]=!1,u-=o[f].length2-o[f].length1;else{d[f]=!0,u=y-h;var x;if(w==-1?x=a.substring(y,y+g.length):x=a.substring(y,w+this.Match_MaxBits),g==x)a=a.substring(0,y)+this.diff_text2(o[f].diffs)+a.substring(y+g.length);else{var b=this.diff_main(g,x,!1);if(g.length>this.Match_MaxBits&&this.diff_levenshtein(b)/g.length>this.Patch_DeleteThreshold)d[f]=!1;else{this.diff_cleanupSemanticLossless(b);for(var _=0,S,k=0;k<o[f].diffs.length;k++){var O=o[f].diffs[k];O[0]!==i&&(S=this.diff_xIndex(b,_)),O[0]===n?a=a.substring(0,y+S)+O[1]+a.substring(y+S):O[0]===t&&(a=a.substring(0,y+S)+a.substring(y+this.diff_xIndex(b,_+O[1].length))),O[0]!==t&&(_+=O[1].length)}}}}}return a=a.substring(l.length,a.length-l.length),[a,d]},e.prototype.patch_addPadding=function(o){for(var a=this.Patch_Margin,l="",u=1;u<=a;u++)l+=String.fromCharCode(u);for(var u=0;u<o.length;u++)o[u].start1+=a,o[u].start2+=a;var d=o[0],f=d.diffs;if(f.length==0||f[0][0]!=i)f.unshift(new e.Diff(i,l)),d.start1-=a,d.start2-=a,d.length1+=a,d.length2+=a;else if(a>f[0][1].length){var h=a-f[0][1].length;f[0][1]=l.substring(f[0][1].length)+f[0][1],d.start1-=h,d.start2-=h,d.length1+=h,d.length2+=h}if(d=o[o.length-1],f=d.diffs,f.length==0||f[f.length-1][0]!=i)f.push(new e.Diff(i,l)),d.length1+=a,d.length2+=a;else if(a>f[f.length-1][1].length){var h=a-f[f.length-1][1].length;f[f.length-1][1]+=l.substring(0,h),d.length1+=h,d.length2+=h}return l},e.prototype.patch_splitMax=function(o){for(var a=this.Match_MaxBits,l=0;l<o.length;l++)if(!(o[l].length1<=a)){var u=o[l];o.splice(l--,1);for(var d=u.start1,f=u.start2,h="";u.diffs.length!==0;){var g=new e.patch_obj,y=!0;for(g.start1=d-h.length,g.start2=f-h.length,h!==""&&(g.length1=g.length2=h.length,g.diffs.push(new e.Diff(i,h)));u.diffs.length!==0&&g.length1<a-this.Patch_Margin;){var w=u.diffs[0][0],x=u.diffs[0][1];w===n?(g.length2+=x.length,f+=x.length,g.diffs.push(u.diffs.shift()),y=!1):w===t&&g.diffs.length==1&&g.diffs[0][0]==i&&x.length>2*a?(g.length1+=x.length,d+=x.length,y=!1,g.diffs.push(new e.Diff(w,x)),u.diffs.shift()):(x=x.substring(0,a-g.length1-this.Patch_Margin),g.length1+=x.length,d+=x.length,w===i?(g.length2+=x.length,f+=x.length):y=!1,g.diffs.push(new e.Diff(w,x)),x==u.diffs[0][1]?u.diffs.shift():u.diffs[0][1]=u.diffs[0][1].substring(x.length))}h=this.diff_text2(g.diffs),h=h.substring(h.length-this.Patch_Margin);var b=this.diff_text1(u.diffs).substring(0,this.Patch_Margin);b!==""&&(g.length1+=b.length,g.length2+=b.length,g.diffs.length!==0&&g.diffs[g.diffs.length-1][0]===i?g.diffs[g.diffs.length-1][1]+=b:g.diffs.push(new e.Diff(i,b))),y||o.splice(++l,0,g)}}},e.prototype.patch_toText=function(o){for(var a=[],l=0;l<o.length;l++)a[l]=o[l];return a.join("")},e.prototype.patch_fromText=function(o){var a=[];if(!o)return a;for(var l=o.split(`
`),u=0,d=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;u<l.length;){var f=l[u].match(d);if(!f)throw new Error("Invalid patch string: "+l[u]);var h=new e.patch_obj;for(a.push(h),h.start1=parseInt(f[1],10),f[2]===""?(h.start1--,h.length1=1):f[2]=="0"?h.length1=0:(h.start1--,h.length1=parseInt(f[2],10)),h.start2=parseInt(f[3],10),f[4]===""?(h.start2--,h.length2=1):f[4]=="0"?h.length2=0:(h.start2--,h.length2=parseInt(f[4],10)),u++;u<l.length;){var g=l[u].charAt(0);try{var y=decodeURI(l[u].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+y)}if(g=="-")h.diffs.push(new e.Diff(t,y));else if(g=="+")h.diffs.push(new e.Diff(n,y));else if(g==" ")h.diffs.push(new e.Diff(i,y));else{if(g=="@")break;if(g!=="")throw new Error('Invalid patch mode "'+g+'" in: '+y)}u++}}return a},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var o,a;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?a=this.start2+",0":this.length2==1?a=this.start2+1:a=this.start2+1+","+this.length2;for(var l=["@@ -"+o+" +"+a+` @@
`],u,d=0;d<this.diffs.length;d++){switch(this.diffs[d][0]){case n:u="+";break;case t:u="-";break;case i:u=" ";break}l[d+1]=u+encodeURI(this.diffs[d][1])+`
`}return l.join("").replace(/%20/g," ")},r.exports=e,r.exports.diff_match_patch=e,r.exports.DIFF_DELETE=t,r.exports.DIFF_INSERT=n,r.exports.DIFF_EQUAL=i}(Ef)),Ef.exports}var NP=OP();const MP=ha(NP);var wy={exports:{}},Sy;function AP(){return Sy||(Sy=1,function(r,e){(function(t){t(Lo())})(function(t){t.defineSimpleMode=function(g,y){t.defineMode(g,function(w){return t.simpleMode(w,y)})},t.simpleMode=function(g,y){n(y,"start");var w={},x=y.meta||{},b=!1;for(var _ in y)if(_!=x&&y.hasOwnProperty(_))for(var S=w[_]=[],k=y[_],O=0;O<k.length;O++){var M=k[O];S.push(new a(M,y)),(M.indent||M.dedent)&&(b=!0)}var R={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:b?[]:null}},copyState:function(I){var $={state:I.state,pending:I.pending,local:I.local,localState:null,indent:I.indent&&I.indent.slice(0)};I.localState&&($.localState=t.copyState(I.local.mode,I.localState)),I.stack&&($.stack=I.stack.slice(0));for(var ne=I.persistentStates;ne;ne=ne.next)$.persistentStates={mode:ne.mode,spec:ne.spec,state:ne.state==I.localState?$.localState:t.copyState(ne.mode,ne.state),next:$.persistentStates};return $},token:l(w,g),innerMode:function(I){return I.local&&{mode:I.local.mode,state:I.localState}},indent:h(w,x)};if(x)for(var T in x)x.hasOwnProperty(T)&&(R[T]=x[T]);return R};function n(g,y){if(!g.hasOwnProperty(y))throw new Error("Undefined state "+y+" in simple mode")}function i(g,y){if(!g)return/(?:)/;var w="";return g instanceof RegExp?(g.ignoreCase&&(w="i"),g.unicode&&(w+="u"),g=g.source):g=String(g),new RegExp((y===!1?"":"^")+"(?:"+g+")",w)}function o(g){if(!g)return null;if(g.apply)return g;if(typeof g=="string")return g.replace(/\./g," ");for(var y=[],w=0;w<g.length;w++)y.push(g[w]&&g[w].replace(/\./g," "));return y}function a(g,y){(g.next||g.push)&&n(y,g.next||g.push),this.regex=i(g.regex),this.token=o(g.token),this.data=g}function l(g,y){return function(w,x){if(x.pending){var b=x.pending.shift();return x.pending.length==0&&(x.pending=null),w.pos+=b.text.length,b.token}if(x.local)if(x.local.end&&w.match(x.local.end)){var _=x.local.endToken||null;return x.local=x.localState=null,_}else{var _=x.local.mode.token(w,x.localState),S;return x.local.endScan&&(S=x.local.endScan.exec(w.current()))&&(w.pos=w.start+S.index),_}for(var k=g[x.state],O=0;O<k.length;O++){var M=k[O],R=(!M.data.sol||w.sol())&&w.match(M.regex);if(R){M.data.next?x.state=M.data.next:M.data.push?((x.stack||(x.stack=[])).push(x.state),x.state=M.data.push):M.data.pop&&x.stack&&x.stack.length&&(x.state=x.stack.pop()),M.data.mode&&d(y,x,M.data.mode,M.token),M.data.indent&&x.indent.push(w.indentation()+y.indentUnit),M.data.dedent&&x.indent.pop();var T=M.token;if(T&&T.apply&&(T=T(R)),R.length>2&&M.token&&typeof M.token!="string"){for(var I=2;I<R.length;I++)R[I]&&(x.pending||(x.pending=[])).push({text:R[I],token:M.token[I-1]});return w.backUp(R[0].length-(R[1]?R[1].length:0)),T[0]}else return T&&T.join?T[0]:T}}return w.next(),null}}function u(g,y){if(g===y)return!0;if(!g||typeof g!="object"||!y||typeof y!="object")return!1;var w=0;for(var x in g)if(g.hasOwnProperty(x)){if(!y.hasOwnProperty(x)||!u(g[x],y[x]))return!1;w++}for(var x in y)y.hasOwnProperty(x)&&w--;return w==0}function d(g,y,w,x){var b;if(w.persistent)for(var _=y.persistentStates;_&&!b;_=_.next)(w.spec?u(w.spec,_.spec):w.mode==_.mode)&&(b=_);var S=b?b.mode:w.mode||t.getMode(g,w.spec),k=b?b.state:t.startState(S);w.persistent&&!b&&(y.persistentStates={mode:S,spec:w.spec,state:k,next:y.persistentStates}),y.localState=k,y.local={mode:S,end:w.end&&i(w.end),endScan:w.end&&w.forceEnd!==!1&&i(w.end,!1),endToken:x&&x.join?x[x.length-1]:x}}function f(g,y){for(var w=0;w<y.length;w++)if(y[w]===g)return!0}function h(g,y){return function(w,x,b){if(w.local&&w.local.mode.indent)return w.local.mode.indent(w.localState,x,b);if(w.indent==null||w.local||y.dontIndentStates&&f(w.state,y.dontIndentStates)>-1)return t.Pass;var _=w.indent.length-1,S=g[w.state];e:for(;;){for(var k=0;k<S.length;k++){var O=S[k];if(O.data.dedent&&O.data.dedentIfLineStart!==!1){var M=O.regex.exec(x);if(M&&M[0]){_--,(O.next||O.push)&&(S=g[O.next||O.push]),x=x.slice(M[0].length);continue e}}}break}return _<0?0:w.indent[_]}}})}()),wy.exports}AP();!window.CodeMirror&&(window.CodeMirror=X1);const Jl=window.CodeMirror||X1,TP=gs({name:"DefaultMode",props:{name:{type:String,default:`cm-textarea-${+new Date}`},value:{type:String,default:""},content:{type:String,default:""},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>null},placeholder:{type:String,default:""}},emits:{ready:r=>r,"update:cminstance":r=>r},setup(r,{emit:e}){const t=Se(),n=Se(null),i=()=>{n.value=uc(Jl.fromTextArea(t.value,r.options)),e("update:cminstance",n.value);const o=Qt(()=>r.cminstance,a=>{var l;a&&((l=r.cminstance)==null||l.setValue(r.value||r.content)),e("ready",ze(n)),o==null||o()},{deep:!0})};return Kt(()=>{i()}),{textarea:t,initialize:i}}}),Bv=(r,e)=>{const t=r.__vccOpts||r;for(const[n,i]of e)t[n]=i;return t},DP=["name","placeholder"];function LP(r,e,t,n,i,o){return G(),ue("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,DP)}const Ey=Bv(TP,[["render",LP]]);window.diff_match_patch=MP;window.DIFF_DELETE=-1;window.DIFF_INSERT=1;window.DIFF_EQUAL=0;const PP=gs({name:"MergeMode",props:{options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=Se(),n=Se(),i=()=>{t.value=uc(Jl.MergeView(n.value,r.options)),e("update:cminstance",t.value),e("ready",t)};return Kt(()=>{i()}),{mergeView:n,initialize:i}}}),RP={ref:"mergeView"};function IP(r,e,t,n,i,o){return G(),ue("div",RP,null,512)}const BP=Bv(PP,[["render",IP]]);function jP(r){const e=/#link#(.+)#link#/g,t=[];let n;for(n=e.exec(r);n;){const i=document.createElement("a"),o=JSON.parse(n[1]),a=Object.entries(o);for(const[l,u]of a)i.setAttribute(l,u);i.className="editor_custom_link",i.innerHTML="logDownload",t.push({start:n.index,end:n.index+n[0].length,node:i}),n=e.exec(r)}return t}function HP(r){const e=[];function t(){const n=/#log<(\w*)>log#((.|\r\n|\n)*?)#log<(\w*)>log#/g;let i;for(i=n.exec(r);i;){const o=i[0].replace(/\r\n/g,`
`).split(`
`),a=i[2].replace(/\r\n/g,`
`).split(`
`),l=document.createElement("span"),u=i[1];l.className=`c-editor--log__${u}`;let d=0;for(let f=0;f<o.length;f++){const h=o[f],g=a[f],y=l.cloneNode(!1);y.innerText=g,e.push({start:i.index+d,end:i.index+d+h.length,node:y}),d=d+h.length+1}i=n.exec(r)}}return t(),e}const Ru=[{regex:/(\[.*?\])([ \t]*)(<error>[ \t])(.+)/,token:["tag","","error.strong","error.strong"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<info>)(.+)(.?)/,token:["tag","","bracket","bracket","hr"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<warning>)(.+)(.?)/,token:["tag","","comment","comment","hr"],sol:!0}];Jl.defineSimpleMode("fclog",{start:[...Ru,{regex:/.*/,token:"hr"}],error:[...Ru,{regex:/.*/,token:"error.strong"}],info:[...Ru,{regex:/.*/,token:"bracket"}],warning:[...Ru,{regex:/.*\[/,token:"comment"}]});Jl.defineSimpleMode("log",{start:[{regex:/^[=]+[^=]*[=]+/,token:"strong"},{regex:/([^\w])([A-Z][\w]*)/,token:["","string"]},{regex:/(^[A-Z][\w]*)/,token:"string"}]});const $P=gs({name:"CodemirrorFclog",props:{value:{type:String,default:""},name:{type:String,default:`cm-textarea-${+new Date}`},options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""}},emits:["update:cminstance","ready"],setup(r,{emit:e}){const t=Se(),n=Se(null),i=(a=r.cminstance)=>{a.getAllMarks().forEach(d=>d.clear());const l=a.getValue(),u=[].concat(jP(l)).concat(HP(l));for(let d=0;d<u.length;d++){const f=u[d];a.markText(a.posFromIndex(f.start),a.posFromIndex(f.end),{replacedWith:f.node})}},o=()=>{var a;n.value=uc(Jl.fromTextArea(t.value,r.options)),e("update:cminstance",ze(n)),(a=n.value)==null||a.on("change",i)};return Qt(()=>r.cminstance,a=>{var l;a&&(i(r.cminstance),(l=r.cminstance)==null||l.setValue(r.value),e("ready",n))},{deep:!0,immediate:!0}),Kt(()=>{o()}),{initialize:o,textarea:t}}}),FP=["name","placeholder"];function zP(r,e,t,n,i,o){return G(),ue("textarea",{ref:"textarea",name:r.$props.name,placeholder:r.$props.placeholder},null,8,FP)}const WP=Bv($P,[["render",zP]]),G1={"update:value":()=>!0,change:(r,e)=>({value:r,cm:e}),input:()=>!0,ready:r=>r},UP=["changes","scroll","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],VP=()=>{const r={};return UP.forEach(e=>{r[e]=(...t)=>t}),r},qP={...G1,...VP()},Cf={mode:"text",theme:"default",lineNumbers:!0,smartIndent:!0,indentUnit:2,styleActiveLine:!0};function XP(r){Promise.resolve().then(()=>{const e=r.getScrollInfo();r.scrollTo(e.left,e.height)})}const GP=({props:r,cminstance:e,emit:t,internalInstance:n,content:i})=>{const o=tn(()=>{var l;return r.merge?(l=ze(e))==null?void 0:l.editor():ze(e)}),a=()=>{const l=[];return Object.keys(n==null?void 0:n.vnode.props).forEach(u=>{if(u.startsWith("on")){const d=u.replace(u[2],u[2].toLowerCase()).slice(2);!G1[d]&&l.push(d)}}),l};return{listenerEvents:()=>{o.value.on("change",u=>{const d=u.getValue();d===i.value&&d!==""||(i.value=d,t("update:value",i.value||""),t("input",i.value||" "),Promise.resolve().then(()=>{t("change",i.value,u)}),r.keepCursorInEnd&&XP(u))});const l={};a().filter(u=>!l[u]&&(l[u]=!0)).forEach(u=>{o.value.on(u,(...d)=>{t(u,...d)})})}}};function YP({props:r,cminstance:e,presetRef:t}){const n=Se("100%"),i=Se("100%"),o=tn(()=>{var g;return r.merge?(g=ze(e))==null?void 0:g.editor():ze(e)}),a=()=>{xn(()=>{var g;(g=o.value)==null||g.refresh()})},l=g=>g?!(g&&isNaN(+g)):!1,u=(g=r.width,y=r.height)=>{var w;let x="100%",b="100%";l(g)?x=`${String(g)}px`:g&&(x=g),l(y)?b=`${String(y)}px`:y&&(b=y),n.value=x,i.value=b,(w=o.value)==null||w.setSize("100%","100%")},d=()=>{var g;const y=(g=o.value)==null?void 0:g.getWrapperElement();y==null||y.remove()},f=()=>{var g,y,w;const x=(g=o.value)==null?void 0:g.getDoc().getHistory();(y=t.value)==null||y.initialize(),d(),(w=o.value)==null||w.getDoc().setHistory(x)},h=()=>{const g=document.querySelector(".CodeMirror-gutters");return(g==null?void 0:g.style.left.replace("px",""))!=="0"};return{reload:f,refresh:a,resize:u,destroy:d,containerWidth:n,containerHeight:i,reviseStyle:()=>{if(a(),!h())return;const g=setInterval(()=>{h()?a():clearInterval(g)},60),y=setTimeout(()=>{clearInterval(g),clearTimeout(y)},400)}}}const KP=gs({__name:"index",props:{value:{type:String,default:""},options:{type:Object,default:()=>Cf},globalOptions:{type:Object,default:()=>Cf},placeholder:{type:String,default:""},border:{type:Boolean,default:!1},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},originalStyle:{type:Boolean,default:!1},keepCursorInEnd:{type:Boolean,default:!1},merge:{type:Boolean,default:!1},name:{type:String,default:""},marker:{type:Function,default:()=>null},unseenLines:{type:Array,default:()=>[]}},emits:qP,setup(r,{expose:e,emit:t}){var n,i,o;typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value(V){if(V==null)throw new TypeError("Cannot convert undefined or null to object");const J=Object(V);for(let D=1;D<arguments.length;D++){const U=arguments[D];if(U!=null)for(const j in U)Object.prototype.hasOwnProperty.call(U,j)&&(J[j]=U[j])}return J},writable:!0,configurable:!0});const a=r,l=t,u=Se(null),d=Se(""),f=uC(Ey),h=Se({foldGutter:!0,...Cf,...a.globalOptions,...a.options,gutters:[...new Set(["CodeMirror-linenumbers","CodeMirror-foldgutter",...((n=a.options)==null?void 0:n.gutters)||[]])]}),g=dC(),y=a.name||((o=(i=g==null?void 0:g.parent)==null?void 0:i.type)==null?void 0:o.name)||void 0,w=Se(null),x=tn(()=>{var V;return a.merge?(V=ze(u))==null?void 0:V.editor():ze(u)}),{refresh:b,resize:_,destroy:S,containerHeight:k,containerWidth:O,reviseStyle:M}=YP({props:a,cminstance:u,presetRef:w}),{listenerEvents:R}=GP({props:a,cminstance:u,emit:l,internalInstance:g,content:d}),T=()=>{a.unseenLines!==void 0&&a.marker!==void 0&&a.unseenLines.forEach(V=>{var J,D;const U=(J=u.value)==null?void 0:J.lineInfo(V);(D=u.value)==null||D.setGutterMarker(V,"breakpoints",U!=null&&U.gutterMarkers?null:a.marker())})},I=V=>{var J,D;const U=(J=u.value)==null?void 0:J.getValue();V!==U&&((D=u.value)==null||D.setValue(V),d.value=V,M()),T()},$=()=>{R(),T(),_(a.width,a.height),l("ready",u.value),Qt([()=>a.width,()=>a.height],([V,J])=>{_(V,J)},{deep:!0})},ne=()=>{if(a.options.mode==="fclog"||a.options.mode==="log"){f.value=WP;return}if(a.merge){f.value=BP;return}f.value=Ey};return Qt(()=>a.options,V=>{var J;for(const D in a.options)(J=x.value)==null||J.setOption(D,ze(V[D]))},{deep:!0}),Qt(()=>a.value,V=>{I(V)}),Qt(()=>a.merge,ne,{immediate:!0}),Mi(()=>{S()}),e({cminstance:u,resize:_,refresh:b,destroy:S}),(V,J)=>(G(),ue("div",{class:gn(["codemirror-container",{merge:V.$props.merge,bordered:V.$props.border||V.$props.merge&&!a.originalStyle,"original-style":a.originalStyle}]),style:Oi({height:ze(k),width:ze(O)})},[(G(),Ue(v1(f.value),cC({ref_key:"presetRef",ref:w,cminstance:u.value,"onUpdate:cminstance":J[0]||(J[0]=D=>u.value=D),style:{height:"100%"}},{...V.$props,...V.$attrs,options:h.value,name:ze(y),content:d.value},{onReady:$}),null,16,["cminstance"]))],6))}});function JP(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}JP(`.codemirror-container {
  position: relative;
  display: inline-block;
  height: 100%;
  width: fit-content;
  font-size: 13px;
  overflow: hidden;
}
.codemirror-container.bordered {
  border: 1px solid #aaaaaa;
}

.codemirror-container .editor_custom_link {
  cursor: pointer;
  color: #1474f1;
  text-decoration: underline;
}
.codemirror-container .editor_custom_link:hover {
  color: #04b4fa;
}
.codemirror-container:not(.original-style) .CodeMirror-lines .CodeMirror-placeholder.CodeMirror-line-like {
  color: #666;
}
.codemirror-container:not(.original-style) .CodeMirror,
.codemirror-container:not(.original-style) .CodeMirror-merge-pane {
  height: 100%;
  font-family: consolas !important;
}
.codemirror-container:not(.original-style) .CodeMirror-merge,
.codemirror-container:not(.original-style) .CodeMirror-merge-right .CodeMirror {
  height: 100%;
  border: none !important;
}
.codemirror-container:not(.original-style) .c-editor--log__error {
  color: #bb0606;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__info {
  color: #333333;
  font-weight: bold;
}
.codemirror-container:not(.original-style) .c-editor--log__warning {
  color: #ee9900;
}
.codemirror-container:not(.original-style) .c-editor--log__success {
  color: #669600;
}
.codemirror-container:not(.original-style) .cm-header,
.codemirror-container:not(.original-style) .cm-strong {
  font-weight: bold;
}
`);const Cy={__name:"code-edit-box",props:{value:{type:String,default:""},width:{type:Number,default:664},height:{type:Number,default:150}},emits:["update:value","change"],setup(r,{expose:e,emit:t}){const n=t,i=Se(""),o=r;Qt(()=>o.value,g=>{i.value=g},{immediate:!0});const a={mode:"text/javascript",theme:"dracula"},l=Se(null),u=g=>{n("update:value",g)},d=()=>{l.value.refresh()},f=()=>{},h=()=>{};return e({handleRefresh:d}),(g,y)=>(G(),ue("div",null,[H(ze(KP),{onWheel:y[0]||(y[0]=dn(()=>{},["stop"])),originalStyle:"",class:"cm-component",value:i.value,"onUpdate:value":y[1]||(y[1]=w=>i.value=w),options:a,ref_key:"cmRef",ref:l,height:o.height,width:o.width,onChange:u,onInput:h,onReady:f},null,8,["value","height","width"])]))}},ZP={class:"problem-optimization-form"},QP={class:"node-form-content"},eR={class:"gray-block"},tR={class:"array-form-box"},nR={class:"flex-block-item"},rR=["onClick"],iR={class:"code-edit-box"},oR={class:"title-block"},aR={class:"code-box"},sR={class:"flex-block-item"},lR={class:"gray-block mt16"},uR={class:"output-box"},dR={class:"flex-block-item",style:{gap:"12px"}},cR=["onClick"],fR=["onClick"],hR={key:0,class:"sub-field-box"},pR={style:{margin:"40px 0 24px 0"}},ky=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,vR={__name:"code-run-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Se([]);function o(){const J=n.lf.getNodeModelById(n.nodeId);if(J){let D=J.getAllParentVariable();i.value=a(D)}}function a(J){return J.forEach(D=>{D.typ=="node"?D.node_type==1?D.value="global":D.value=D.node_id:D.value=D.key,D.children&&D.children.length>0&&(D.children=a(D.children))}),J}const l=Se(),u=Jt({main_func:"",params:[{field:"",variable:""}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),d=()=>{u.main_func=ky};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function h(J){return J.forEach(D=>{D.cu_key=Math.random()*1e4,D.subs&&D.subs.length?h(D.subs):D.subs=[]}),J}const g=()=>{const J=JSON.stringify({code_run:{...u,params:y()}});t("update-node",{...n.node,...u,node_params:J})};function y(){let J=[];return u.params.forEach(D=>{J.push({field:D.field,variable:D.variable&&D.variable.length>0?D.variable.join("."):""})}),J}const w=()=>{try{let J=n.node.dataRaw||n.node.node_params||"{}",D=JSON.parse(J).code_run||{};D=JSON.parse(JSON.stringify(D)),o();for(let U in D){if(U=="params"){D[U]&&D[U].length>0?u[U]=D[U].map(j=>({...j,cu_key:Math.random()*1e4})):u[U]=[];continue}if(U=="output"){u.output=h(D[U]);continue}u[U]=D[U]}u.main_func=u.main_func||ky,u.params=u.params.map(U=>{let j="";for(let fe=0;fe<f.length;fe++)if(U.variable.indexOf(f[fe])>-1){j=f[fe];break}if(j!=""){let fe=U.variable.split(".");U.variable=[fe[0],j]}else U.variable=U.variable.split(".");return{...U,key:Math.random()*1e4}})}catch(J){}};Qt(()=>u,()=>{g()},{deep:!0});const x=()=>{u.params.push({key:"",value:"",cu_key:Math.random()*1e4})},b=J=>{u.params.splice(J,1)},_=()=>{u.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},S=J=>{u.output.splice(J,1)},k=J=>{J.subs=[]},O=J=>{u.output[J].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},M=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],R=J=>{J||o()},T=Se(!1),I=Se(null),$=()=>{T.value=!0,I.value&&I.value.handleRefresh()},ne=()=>{T.value=!1},V=()=>{t("close")};return Kt(()=>{w()}),(J,D)=>{const U=kr,j=va,fe=_s,Ee=Yi,_e=Fn,rt=bs,Me=Di,ve=$r,Ve=Hr,Be=Sr,de=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"运行一段JS代码，将代码return的数据输出到下一节点。一般用于进行数据处理。",onClose:V},null,8,["title","iconName"])]),default:q(()=>[E("div",ZP,[E("div",QP,[H(de,{ref_key:"formRef",ref:l,layout:"vertical",model:u},{default:q(()=>[E("div",eR,[D[10]||(D[10]=E("div",{class:"gray-block-title"},"输入",-1)),E("div",tR,[D[6]||(D[6]=E("div",{class:"form-item-label"},"自定义输入参数",-1)),(G(!0),ue(st,null,mt(u.params,(le,W)=>(G(),ue("div",{class:"form-item-list",key:W},[H(Ee,{label:null,name:["params",W,"variable"]},{default:q(()=>[E("div",nR,[H(j,null,{default:q(()=>[H(U,{style:{width:"190px"},value:le.field,"onUpdate:value":Y=>le.field=Y,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),H(fe,{value:le.variable,"onUpdate:value":Y=>le.variable=Y,onDropdownVisibleChange:R,style:{width:"400px"},options:i.value,allowClear:!1,displayRender:({labels:Y})=>Y.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","options","displayRender"]),E("div",{class:"btn-hover-wrap",onClick:Y=>b(W)},[H(ze(gr))],8,rR)])]),_:2},1032,["name"])]))),128)),H(_e,{onClick:x,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>D[5]||(D[5]=[$e("添加参数")])),_:1,__:[5]},8,["icon"])]),E("div",iR,[E("div",oR,[D[7]||(D[7]=E("div",null,"JavaScript 代码",-1)),H(rt,{gap:16,align:"center"},{default:q(()=>[E("a",{onClick:d},"还原为模板"),E("div",{class:"btn-hover-wrap",onClick:$},[H(ze(kv))])]),_:1})]),E("div",aR,[H(Cy,{value:u.main_func,"onUpdate:value":D[0]||(D[0]=le=>u.main_func=le),width:410,height:170},null,8,["value"])])]),H(Ee,{name:"timeout",class:"mt16"},{label:q(()=>[H(rt,{gap:2},{default:q(()=>D[8]||(D[8]=[$e("超时时长")])),_:1,__:[8]})]),default:q(()=>[E("div",sR,[H(Me,{placeholder:"请输入请求地址",style:{width:"138px"},precision:0,value:u.timeout,"onUpdate:value":D[1]||(D[1]=le=>u.timeout=le),min:0,max:3e3},null,8,["value"]),D[9]||(D[9]=$e(" 秒 "))])]),_:1})]),E("div",lR,[D[13]||(D[13]=E("div",{class:"gray-block-title"},"输出 (自定义输出字段)",-1)),E("div",uR,[D[12]||(D[12]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:D[2]||(D[2]=dn(()=>{},["stop"]))},[(G(!0),ue(st,null,mt(u.output,(le,W)=>(G(),ue("div",{class:"form-item-list",key:W},[H(Ee,{label:null,name:["output",W,"key"]},{default:q(()=>[E("div",dR,[H(U,{style:{width:"214px"},value:le.key,"onUpdate:value":Y=>le.key=Y,placeholder:"请输入"},null,8,["value","onUpdate:value"]),H(j,null,{default:q(()=>[H(Ve,{onChange:Y=>k(le),value:le.typ,"onUpdate:value":Y=>le.typ=Y,placeholder:"请选择",style:{width:"214px"}},{default:q(()=>[(G(),ue(st,null,mt(M,Y=>H(ve,{value:Y.value,key:Y.value},{default:q(()=>[$e(Ne(Y.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),le.typ=="object"?(G(),ue("div",{key:0,class:"btn-hover-wrap",onClick:Y=>O(W)},[H(ze(xs))],8,cR)):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:Y=>S(W)},[H(ze(gr))],8,fR)]),le.subs&&le.subs.length>0?(G(),ue("div",hR,[H(j,null,{default:q(()=>[H(_P,{data:le.subs,level:2,typOptions:M},null,8,["data"])]),_:2},1024)])):tt("",!0)]),_:2},1032,["name"])]))),128)),H(_e,{onClick:_,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>D[11]||(D[11]=[$e("添加参数")])),_:1,__:[11]},8,["icon"])],32)])]),D[15]||(D[15]=E("div",{class:"gray-block mt16"},[E("div",{class:"gray-block-title"},"异常处理"),E("div",null,"运行代码报错时执行该分支")],-1)),H(Be,{open:T.value,"onUpdate:open":D[4]||(D[4]=le=>T.value=le),title:"编辑代码",width:746},{footer:q(()=>[H(_e,{type:"primary",onClick:ne},{default:q(()=>D[14]||(D[14]=[$e("确定")])),_:1,__:[14]})]),default:q(()=>[E("div",pR,[H(Cy,{ref_key:"codeEditBoxRef",ref:I,value:u.main_func,"onUpdate:value":D[3]||(D[3]=le=>u.main_func=le),width:698,height:472},null,8,["value"])])]),_:1},8,["open"])]),_:1,__:[15]},8,["model"])])])]),_:1})}}},gR=xt(vR,[["__scopeId","data-v-ff8a1a30"]]),mR={class:"sub-field-item"},yR=["onClick"],_R=["onClick"],bR={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(u=>u.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px"),i=(u,d)=>{d[u].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},o=(u,d)=>{d.splice(u,1)},a=u=>{u.subs=[]},l=u=>u.typ=="object"&&e.level<=2;return(u,d)=>{const f=kr,h=$r,g=Hr,y=On("SubsKey",!0);return G(!0),ue(st,null,mt(e.data,(w,x)=>(G(),ue("div",{class:gn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:w.cu_key},[E("div",mR,[d[0]||(d[0]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(f,{class:"mr12",style:Oi({width:n.value}),value:w.key,"onUpdate:value":b=>w.key=b,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),d[1]||(d[1]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(g,{class:"mr12",onChange:b=>a(w),value:w.typ,"onUpdate:value":b=>w.typ=b,placeholder:"请选择",style:Oi({width:n.value})},{default:q(()=>[(G(!0),ue(st,null,mt(t.value,b=>(G(),Ue(h,{value:b.value},{default:q(()=>[$e(Ne(b.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),l(w)?(G(),ue("div",{key:0,class:"btn-hover-wrap mr12",onClick:b=>i(x,e.data)},[H(ze(xs))],8,yR)):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:b=>o(x,e.data)},[H(ze(gr))],8,_R)]),w.subs&&w.subs.length>0?(G(),Ue(y,{key:0,level:e.level+1,typOptions:e.typOptions,data:w.subs},null,8,["level","typOptions","data"])):tt("",!0)],2))),128)}}},xR=xt(bR,[["__scopeId","data-v-b8acefd2"]]),wR={class:"problem-optimization-form"},SR={class:"node-form-content"},ER={class:"gray-block"},CR={class:"flex-block-item"},kR={class:"array-form-box"},OR={class:"flex-block-item"},NR={class:"at-input-flex1"},MR={class:"field-list-item"},AR={class:"field-label"},TR={class:"field-type"},DR=["onClick"],LR={class:"array-form-box"},PR={class:"flex-block-item"},RR={class:"at-input-flex1"},IR={class:"field-list-item"},BR={class:"field-label"},jR={class:"field-type"},HR=["onClick"],$R={key:0},FR={key:0,class:"array-form-box"},zR={class:"flex-block-item"},WR={class:"at-input-flex1"},UR={class:"field-list-item"},VR={class:"field-label"},qR={class:"field-type"},XR=["onClick"],GR={class:"field-list-item"},YR={class:"field-label"},KR={class:"field-type"},JR={class:"flex-block-item"},ZR={class:"gray-block mt16"},QR={class:"output-box"},eI={class:"flex-block-item",style:{gap:"12px"}},tI=["onClick"],nI=["onClick"],rI={key:0,class:"sub-field-box"},iI={__name:"http-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Se([]),o=Jt({}),a=(ne,V,J)=>{if(ne){let D=`at_input_${V}_${J}`;o[D]=ne}},l=(ne,V,J,D)=>{ne=="body_raw"?(f.body_raw=V,f.body_raw_tags=J):(D.tags=J,D.value=V)},u=()=>{const ne=n.lf.getNodeModelById(n.nodeId);if(ne){let V=ne.getAllParentVariable();V.forEach(J=>{J.tags=J.tags||[]}),i.value=V}},d=Se(),f=Jt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function h(ne){return ne.forEach(V=>{V.cu_key=Math.random()*1e4,V.subs&&V.subs.length?h(V.subs):V.subs=[]}),ne}const g=()=>{const ne=JSON.stringify({curl:{...f}});t("update-node",{...n.node,...f,node_params:ne})},y=()=>{try{let ne=n.node.dataRaw||n.node.node_params||"{}",V=JSON.parse(ne).curl||{};V=JSON.parse(JSON.stringify(V)),u();for(let J in V){if(J=="headers"||J=="params"||J=="body"){V[J]&&V[J].length>0?f[J]=V[J].map(D=>({...D,cu_key:Math.random()*1e4})):f[J]=[];continue}if(J=="output"){f.output=h(V[J]);continue}f[J]=V[J]}}catch(ne){}};Qt(()=>f,()=>{g()},{deep:!0});const w=()=>{f.headers.push({key:"",value:"",cu_key:Math.random()*1e4})},x=ne=>{f.headers.splice(ne,1)},b=()=>{f.params.push({key:"",value:"",cu_key:Math.random()*1e4})},_=ne=>{f.params.splice(ne,1)},S=()=>{f.body.push({key:"",value:"",cu_key:Math.random()*1e4})},k=ne=>{f.body.splice(ne,1)},O=()=>{f.output.push({key:"",typ:"string",subs:[],cu_key:Math.random()*1e4})},M=ne=>{f.output.splice(ne,1)},R=ne=>{ne.subs=[]},T=ne=>{f.output[ne].subs.push({key:"",value:"",subs:[],cu_key:Math.random()*1e4})},I=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],$=()=>{t("close")};return Kt(()=>{y()}),(ne,V)=>{const J=$r,D=Hr,U=va,j=kr,fe=Yi,Ee=Fn,_e=b1,rt=_1,Me=bs,ve=Di,Ve=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"发起一个http请求，实现与第三方系统数据交互",onClose:$},null,8,["title","iconName"])]),default:q(()=>[E("div",wR,[E("div",SR,[H(Ve,{ref_key:"formRef",ref:d,layout:"vertical",model:f},{default:q(()=>[E("div",ER,[V[19]||(V[19]=E("div",{class:"gray-block-title"},"输入",-1)),H(fe,{label:"请求地址",name:"rawurl",rules:[{required:!0,message:"请输入请求地址"}]},{default:q(()=>[E("div",CR,[H(U,null,{default:q(()=>[H(D,{value:f.method,"onUpdate:value":V[0]||(V[0]=Be=>f.method=Be),style:{width:"120px"}},{default:q(()=>[H(J,{value:"POST"},{default:q(()=>V[7]||(V[7]=[$e("POST")])),_:1,__:[7]}),H(J,{value:"GET"},{default:q(()=>V[8]||(V[8]=[$e("GET")])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),H(j,{class:"flex1",value:f.rawurl,"onUpdate:value":V[1]||(V[1]=Be=>f.rawurl=Be),placeholder:"请输入请求地址"},null,8,["value"])])]),_:1}),E("div",kR,[V[10]||(V[10]=E("div",{class:"form-item-label"},"HEADERS",-1)),(G(!0),ue(st,null,mt(f.headers,(Be,de)=>(G(),ue("div",{class:"form-item-list",key:de},[H(fe,{label:null,name:["headers",de,"value"]},{default:q(()=>[E("div",OR,[H(U,null,{default:q(()=>[H(j,{style:{width:"120px"},value:Be.key,"onUpdate:value":le=>Be.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",NR,[H(or,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>a(le,"headers",de),options:i.value,defaultSelectedList:Be.tags,defaultValue:Be.value,onOpen:u,onChange:(le,W)=>l("headers",le,W,Be,de),placeholder:"请输入变量值，键入“/”插入变量"},{option:q(({label:le,payload:W})=>[E("div",MR,[E("div",AR,Ne(le),1),E("div",TR,Ne(W.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>x(de)},[H(ze(gr))],8,DR)])]),_:2},1032,["name"])]))),128)),H(Ee,{onClick:w,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>V[9]||(V[9]=[$e("添加参数")])),_:1,__:[9]},8,["icon"])]),E("div",LR,[V[12]||(V[12]=E("div",{class:"form-item-label"},"PARAMS",-1)),(G(!0),ue(st,null,mt(f.params,(Be,de)=>(G(),ue("div",{class:"form-item-list",key:de},[H(fe,{label:null,name:["params",de,"value"]},{default:q(()=>[E("div",PR,[H(U,null,{default:q(()=>[H(j,{style:{width:"120px"},value:Be.key,"onUpdate:value":le=>Be.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",RR,[H(or,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>a(le,"params",de),options:i.value,defaultSelectedList:Be.tags,defaultValue:Be.value,onOpen:u,onChange:(le,W)=>l("params",le,W,Be,de),placeholder:"请输入变量值，键入“/”插入变量"},{option:q(({label:le,payload:W})=>[E("div",IR,[E("div",BR,Ne(le),1),E("div",jR,Ne(W.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>_(de)},[H(ze(gr))],8,HR)])]),_:2},1032,["name"])]))),128)),H(Ee,{onClick:b,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>V[11]||(V[11]=[$e("添加参数")])),_:1,__:[11]},8,["icon"])]),f.method=="POST"?(G(),ue("div",$R,[H(fe,{label:"BODY",name:"type",class:"line-height-22"},{default:q(()=>[H(rt,{value:f.type,"onUpdate:value":V[2]||(V[2]=Be=>f.type=Be)},{default:q(()=>[H(_e,{value:0},{default:q(()=>V[13]||(V[13]=[$e("none")])),_:1,__:[13]}),H(_e,{value:1},{default:q(()=>V[14]||(V[14]=[$e("x-www-form-urlencoded")])),_:1,__:[14]}),H(_e,{value:2},{default:q(()=>V[15]||(V[15]=[$e("JSON")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),f.type==1?(G(),ue("div",FR,[(G(!0),ue(st,null,mt(f.body,(Be,de)=>(G(),ue("div",{class:"form-item-list",key:de},[H(fe,{label:null,name:["body",de,"value"],rules:{required:!0}},{default:q(()=>[E("div",zR,[H(U,null,{default:q(()=>[H(j,{style:{width:"120px"},value:Be.key,"onUpdate:value":le=>Be.key=le,placeholder:"请输入参数KEY"},null,8,["value","onUpdate:value"])]),_:2},1024),E("div",WR,[H(or,{inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",ref_for:!0,ref:le=>a(le,"body",de),options:i.value,defaultSelectedList:Be.tags,defaultValue:Be.value,onOpen:u,onChange:(le,W)=>l("body",le,W,Be,de),placeholder:"请输入变量值，键入“/”插入变量"},{option:q(({label:le,payload:W})=>[E("div",UR,[E("div",VR,Ne(le),1),E("div",qR,Ne(W.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",{class:"btn-hover-wrap",onClick:le=>k(de)},[H(ze(gr))],8,XR)])]),_:2},1032,["name"])]))),128)),H(Ee,{onClick:S,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>V[16]||(V[16]=[$e("添加参数")])),_:1,__:[16]},8,["icon"])])):tt("",!0),f.type==2?(G(),Ue(fe,{key:1,label:null,name:"body_raw"},{default:q(()=>[H(or,{type:"textarea",options:i.value,defaultSelectedList:f.body_raw_tags,defaultValue:f.body_raw,ref:Be=>a(Be,"body","body_raw"),onOpen:u,onChange:V[3]||(V[3]=(Be,de)=>l("body_raw",Be,de)),placeholder:"请输入变量值，键入“/”插入变量"},{option:q(({label:Be,payload:de})=>[E("div",GR,[E("div",YR,Ne(Be),1),E("div",KR,Ne(de.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"])]),_:1})):tt("",!0)])):tt("",!0),H(fe,{name:"timeout"},{label:q(()=>[H(Me,{gap:2},{default:q(()=>V[17]||(V[17]=[$e("超时时长")])),_:1,__:[17]})]),default:q(()=>[E("div",JR,[H(ve,{placeholder:"请输入请求地址",style:{width:"120px"},precision:0,value:f.timeout,"onUpdate:value":V[4]||(V[4]=Be=>f.timeout=Be),min:0,max:3e3},null,8,["value"]),V[18]||(V[18]=$e(" 秒 "))])]),_:1})]),E("div",ZR,[E("div",{class:"gray-block-title",onClick:V[5]||(V[5]=(...Be)=>ne.test&&ne.test(...Be))},"输出 (输出字段提取)"),E("div",QR,[V[21]||(V[21]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",{class:"array-form-box",onMousedown:V[6]||(V[6]=dn(()=>{},["stop"]))},[(G(!0),ue(st,null,mt(f.output,(Be,de)=>(G(),ue("div",{class:"form-item-list",key:de},[H(fe,{label:null,name:["output",de,"key"]},{default:q(()=>[E("div",eI,[H(j,{style:{width:"214px"},value:Be.key,"onUpdate:value":le=>Be.key=le,placeholder:"请输入"},null,8,["value","onUpdate:value"]),H(U,null,{default:q(()=>[H(D,{onChange:le=>R(Be),value:Be.typ,"onUpdate:value":le=>Be.typ=le,placeholder:"请选择",style:{width:"214px"}},{default:q(()=>[(G(),ue(st,null,mt(I,le=>H(J,{value:le.value,key:le.value},{default:q(()=>[$e(Ne(le.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Be.typ=="object"?(G(),ue("div",{key:0,class:"btn-hover-wrap",onClick:le=>T(de)},[H(ze(xs))],8,tI)):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:le=>M(de)},[H(ze(gr))],8,nI)]),Be.subs&&Be.subs.length>0?(G(),ue("div",rI,[H(U,null,{default:q(()=>[H(xR,{data:Be.subs,level:2,typOptions:I},null,8,["data"])]),_:2},1024)])):tt("",!0)]),_:2},1032,["name"])]))),128)),H(Ee,{onClick:O,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>V[20]||(V[20]=[$e("添加参数")])),_:1,__:[20]},8,["icon"])],32)])])]),_:1},8,["model"])])])]),_:1})}}},oI=xt(iI,[["__scopeId","data-v-b2059d33"]]),jn={EQUALITY:{EQ:{label:"等于",value:"eq"},IS:{label:"是",value:"eq"},IS_NOT:{label:"不是",value:"neq"}},COMPARISON:{GT:{label:"大于",value:"gt"},LT:{label:"小于",value:"lt"},GTE:{label:"大于等于",value:"gte"},LTE:{label:"小于等于",value:"lte"},BETWEEN:{label:"介于",value:"between"}},TEXT:{CONTAIN:{label:"包含",value:"contain"},NOT_CONTAIN:{label:"不包含",value:"not_contain"}},NULLABILITY:{EMPTY:{label:"为空",value:"empty"},NOT_EMPTY:{label:"不为空",value:"not_empty"}},BOOLEAN:{TRUE:{label:"是",value:"true"},FALSE:{label:"不是",value:"false"}}},Y1={string:[jn.EQUALITY.IS,jn.EQUALITY.IS_NOT,jn.TEXT.CONTAIN,jn.TEXT.NOT_CONTAIN,jn.NULLABILITY.EMPTY,jn.NULLABILITY.NOT_EMPTY],integer:[jn.COMPARISON.GT,jn.COMPARISON.LT,jn.COMPARISON.GTE,jn.COMPARISON.LTE,jn.EQUALITY.EQ,jn.COMPARISON.BETWEEN],number:[jn.COMPARISON.GT,jn.COMPARISON.LT,jn.COMPARISON.GTE,jn.COMPARISON.LTE,jn.EQUALITY.EQ,jn.COMPARISON.BETWEEN],boolean:[jn.BOOLEAN.TRUE,jn.BOOLEAN.FALSE]},K1=r=>Y1[r]||[],jv=(r,e)=>{const n=K1(e).find(i=>i.value===r);return(n==null?void 0:n.label)||r},aI={class:"query-condition-filter"},sI={class:"condition-select-box"},lI={class:"select-wrapper"},uI={class:"field-items"},dI={class:"field-select-box"},cI={class:"operator-select-box"},fI={class:"field-value-box"},hI={key:0,class:"site-input-group-wrapper"},pI={class:"site-input-left",title:"请输入数字，键入“/”插入变量"},vI={class:"site-input-right",title:"请输入数字，键入“/”插入变量"},gI=["onClick"],mI={class:"add-btn-box"},yI={__name:"query-condition-filter",props:{where:{type:Array,default:()=>[]},fieldOptions:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},type:{type:[Number,String],default:1}},emits:["change","changeType"],setup(r,{emit:e}){const t=e,n=r,i=Mt("getNode"),o=Jt({list:n.where,type:n.type});Qt(()=>n.where,k=>{o.list=k}),Qt(()=>n.type,k=>{o.type=k});const a=tn(()=>n.where.length>1),l=tn(()=>Y1),u=Se([]),d=()=>{let k=i().getAllParentVariable();u.value=k||[]},f=()=>{d()},h=()=>{let k={type:o.type,list:o.list};t("change",k)},g=(k,O,M,R)=>{o.list[R].rule_value1=k,o.list[R].atTags=O,h()},y=(k,O,M,R)=>{o.list[R].rule_value2=k,o.list[R].atTags2=O,h()},w=()=>{let k={form_field_id:"",field_name:"",field_type:"",rule:"",rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list.push(k),h()},x=k=>{o.list.splice(k,1),h()},b=(k,O)=>{let M=K1(O.type),R={form_field_id:O.value,field_name:O.name,field_type:O.type,rule:M[0].value,rule_value1:"",rule_value2:"",atTags:[],atTags2:[]};o.list[k]=R,h()},_=(k,O)=>{let M=o.list[k];M.rule=O.value,M.rule_value1="",M.rule_value2="",M.atTags=[],M.atTags2=[],h()},S=({key:k})=>{o.type=k,t("changeType",k),h()};return Kt(()=>{d()}),(k,O)=>{const M=Ev,R=Sv,T=Cv,I=$r,$=Hr,ne=kr,V=jr,J=Fn,D=Ai;return G(),ue("div",{class:gn(["query-condition-filter-warpper",{"is-multiple":a.value}])},[E("div",aI,[O[5]||(O[5]=E("div",{class:"auxiliary-line"},null,-1)),E("div",sI,[E("div",lI,[H(T,null,{overlay:q(()=>[H(R,{style:{width:"100px"},onClick:S},{default:q(()=>[(G(),Ue(M,{key:1},{default:q(()=>O[1]||(O[1]=[E("a",{href:"javascript:;"},"且",-1)])),_:1,__:[1]})),(G(),Ue(M,{key:2},{default:q(()=>O[2]||(O[2]=[E("a",{href:"javascript:;"},"或",-1)])),_:1,__:[2]}))]),_:1})]),default:q(()=>[E("a",{class:"ant-dropdown-link",onClick:O[0]||(O[0]=dn(()=>{},["prevent"]))},[$e(Ne(o.type==1?"且":"或")+" ",1),H(ze(ys))])]),_:1})])]),E("div",uI,[(G(!0),ue(st,null,mt(o.list,(U,j)=>(G(),ue("div",{class:"field-item",key:U.field},[E("div",dI,[H($,{style:{width:"100px"},value:U.form_field_id,"onUpdate:value":fe=>U.form_field_id=fe,onChange:(fe,Ee)=>b(j,Ee)},{default:q(()=>[H(I,{value:0,type:"integer",name:"ID",key:"id"},{default:q(()=>O[3]||(O[3]=[$e("ID")])),_:1,__:[3]}),(G(!0),ue(st,null,mt(n.fieldOptions,fe=>(G(),Ue(I,{value:fe.id,type:fe.type,name:fe.name,key:fe.id},{default:q(()=>[$e(Ne(fe.name),1)]),_:2},1032,["value","type","name"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",cI,[H($,{value:U.rule,"onUpdate:value":fe=>U.rule=fe,style:{width:"100px"},onChange:(fe,Ee)=>_(j,Ee)},{default:q(()=>[(G(!0),ue(st,null,mt(l.value[U.field_type],fe=>(G(),Ue(I,{value:fe.value,key:fe.value},{default:q(()=>[$e(Ne(fe.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),E("div",fI,[U.rule==="between"?(G(),ue("div",hI,[E("div",pI,[H(or,{options:u.value,defaultValue:U.rule_value1,defaultSelectedList:U.atTags,onOpen:f,onChange:(fe,Ee)=>g(fe,Ee,U,j),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])]),O[4]||(O[4]=E("span",{class:"site-input-split"},"~",-1)),E("div",vI,[H(or,{options:u.value,defaultValue:U.rule_value2,defaultSelectedList:U.atTags2,onOpen:f,onChange:(fe,Ee)=>y(fe,Ee,U,j),placeholder:"请输入数字"},null,8,["options","defaultValue","defaultSelectedList","onChange"])])])):["empty","not_empty","boolean"].includes(U.field_type)?(G(),Ue(ne,{key:1,placeholder:"无需输入值",disabled:""})):["integer","number"].includes(U.field_type)?(G(),Ue(or,{key:2,options:u.value,defaultValue:U.rule_value1,defaultSelectedList:U.atTags,onOpen:f,onChange:(fe,Ee)=>g(fe,Ee,U,j),placeholder:"请输入数字，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"])):(G(),Ue(or,{key:3,options:u.value,defaultValue:U.rule_value1,defaultSelectedList:U.atTags,onOpen:f,onChange:(fe,Ee)=>g(fe,Ee,U,j),placeholder:"请输入参数值，键入“/”插入变量"},null,8,["options","defaultValue","defaultSelectedList","onChange"]))]),E("span",{class:"field-del-btn",onClick:fe=>x(j)},[H(V,{class:"del-icon",name:"close-circle"})],8,gI)]))),128))])]),E("div",mI,[r.disabled?(G(),Ue(D,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:q(()=>[E("span",null,[H(J,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:q(()=>[H(ze($n)),O[6]||(O[6]=$e(" 添加条件 "))]),_:1,__:[6]})])]),_:1})):(G(),Ue(J,{key:1,class:"add-btn",type:"dashed",block:"",onClick:w},{default:q(()=>[H(ze($n)),O[7]||(O[7]=$e(" 添加条件 "))]),_:1,__:[7]}))])],2)}}},Hv=xt(yI,[["__scopeId","data-v-d18ef387"]]),_I={class:"delete-data-form"},bI={class:"node-box-content"},xI={class:"setting-box"},wI={class:"setting-box"},SI={__name:"delete-data-form",props:{lf:{type:Object,default:null},nodeType:{type:String},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Mt("setData"),n=Do();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),a=({type:w,list:x})=>{o.formData.typ=w,o.formData.where=x,d()},l=(w,x)=>{x?(o.formData.form_name=x.name,o.formData.form_description=x.description,y(x.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.where=[]),d()},u=()=>{let w=e.node.dataRaw||"{}";i=JSON.parse(w);let x=f(i.form_delete.where||[]);i.form_delete.where=x,o.formData=i.form_delete,o.formData.form_id&&y(o.formData.form_id),d()},d=()=>{let w={...Gi(o.formData)};w.where=h(w.where),i.form_delete=w,t({...e.node,node_params:JSON.stringify(i)})},f=w=>{let x=[];return w.forEach(b=>{let _=JSON.parse(JSON.stringify(b)),S=_.rule.split("_");_.form_field_id=_.form_field_id*1,_.field_type=S[0],S.shift(),_.rule=S.join("_"),x.push(_)}),x},h=w=>{let x=[];return w.forEach(b=>{let _=JSON.parse(JSON.stringify(b));_.form_field_id=_.form_field_id*1,_.rule=b.field_type+"_"+b.rule,x.push(_)}),x},g=async()=>{const w=await n.getFormList();w&&(o.tableList=w)},y=async w=>{n.getFormFieldList({form_id:w}).then(x=>{x.forEach(b=>{b.id=b.id*1}),o.fieldList=x}).catch(()=>{})};return Kt(()=>{g(),u()}),(w,x)=>(G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:q(()=>x[1]||(x[1]=[E("span",null,[$e("删除指定数据表中符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",_I,[E("div",bI,[x[2]||(x[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ss,alt:""}),E("span",{class:"text"},"输入")],-1)),x[3]||(x[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",xI,[H(pc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":x[0]||(x[0]=b=>o.formData.form_id=b),onChange:l},null,8,["options","title","description","value"])]),x[4]||(x[4]=E("div",{class:"setting-label"},[E("span",null,"删除条件")],-1)),E("div",wI,[H(Hv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])])])])]),_:1}))}},EI=xt(SI,[["__scopeId","data-v-c1b21ded"]]),CI={class:"variable-node"},kI={class:"node-form-content"},OI={class:"gray-block"},NI={class:"field-items"},MI={class:"field-name-box"},AI={class:"field-value-box"},TI={class:"field-value-option"},DI={class:"option-label"},LI={class:"option-type"},PI={class:"field-actions"},RI={__name:"variable-assignment-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Se([]),o=Se([]);function a(){const _=n.lf.getNodeModelById(n.nodeId);if(_){let k=_.getGlobalVariable().diy_global||[];k.forEach(O=>{O.label=O.key,O.value="global."+O.key}),o.value=k||[]}}function l(){const _=n.lf.getNodeModelById(n.nodeId);if(_){let S=_.getAllParentVariable();i.value=S}}const u=Se([]),d=()=>{let _=JSON.parse(n.node.node_params);_.assign=[...u.value],t("update-node",{...n.node,node_params:JSON.stringify(_)})},f=()=>{try{let _=n.node.dataRaw||n.node.node_params||"{}",S=JSON.parse(_).assign||[];S=JSON.parse(JSON.stringify(S)),S.forEach(k=>{k.tags=k.tags||[]}),u.value=S,a()}catch(_){}},h=_=>{_&&l()},g=(_,S,k)=>{k.tags=S,k.value=_,d()},y=()=>{u.value.push({variable:void 0,value:""}),d()},w=_=>{u.value.splice(_,1),d()},x=_=>{_&&a()},b=()=>{t("close")};return Kt(()=>{f()}),(_,S)=>{const k=$r,O=Hr,M=Fn;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"通过本节点可以给全局变量赋值",onClose:b},null,8,["title","iconName"])]),default:q(()=>[E("div",CI,[E("div",kI,[E("div",OI,[E("div",NI,[(G(!0),ue(st,null,mt(u.value,(R,T)=>(G(),ue("div",{class:"field-item",key:T},[E("div",MI,[H(O,{style:{width:"100%"},placeholder:"请输入选择变量",value:R.variable,"onUpdate:value":I=>R.variable=I,onDropdownVisibleChange:x,onChange:d},{default:q(()=>[(G(!0),ue(st,null,mt(o.value,I=>(G(),Ue(k,{value:I.value,key:I.key},{default:q(()=>[E("span",null,Ne(I.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),E("div",AI,[H(or,{ref_for:!0,ref:"atInput"+T,inputStyle:"overflow-y: hidden; overflow-x: scroll; height: 22px;",options:i.value,defaultSelectedList:R.tags,defaultValue:R.value,onOpen:h,onChange:(I,$)=>g(I,$,R,T),placeholder:"请输入变量值，键入“/”插入变量"},{option:q(({label:I,payload:$})=>[E("div",TI,[E("div",DI,Ne(I),1),E("div",LI,Ne($.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",PI,[H(ze(gr),{class:"action-btn",onClick:I=>w(T)},null,8,["onClick"])])]))),128))]),E("div",null,[H(M,{style:{width:"100%"},class:"add-btn",type:"dashed",onClick:y},{icon:q(()=>[H(ze($n))]),default:q(()=>[S[0]||(S[0]=$e(" 添加赋值变量 "))]),_:1,__:[0]})])])])])]),_:1})}}},II=xt(RI,[["__scopeId","data-v-1b385123"]]),BI={class:"update-data-form"},jI={class:"node-box-content"},HI={class:"setting-box"},$I={class:"setting-box"},FI={class:"setting-box"},zI={__name:"update-data-form",props:{node:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Do();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),a=({type:x,list:b})=>{o.formData.typ=x,o.formData.where=b,f()},l=(x,b)=>{b?(o.formData.form_name=b.name,o.formData.form_description=b.description,w(b.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.datas=[],o.formData.where=[],o.formData.typ=1),f()},u=x=>{o.formData.datas=x,f()},d=()=>{let x=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(x);let b=h(i.form_update.where||[]);i.form_update.where=b,o.formData=i.form_update,o.formData.form_id&&w(o.formData.form_id),f()},f=()=>{let x={...Gi(o.formData)};x.where=g(x.where),i.form_update=x,t({...e.node,node_params:JSON.stringify(i)})},h=x=>{let b=[];return x.forEach(_=>{let S=JSON.parse(JSON.stringify(_)),k=S.rule.split("_");S.form_field_id=S.form_field_id*1,S.field_type=k[0],k.shift(),S.rule=k.join("_"),b.push(S)}),b},g=x=>{let b=[];return x.forEach(_=>{let S=JSON.parse(JSON.stringify(_));S.form_field_id=S.form_field_id*1,S.rule=_.field_type+"_"+_.rule,b.push(S)}),b},y=async()=>{const x=await n.getFormList();x&&(o.tableList=x)},w=async x=>{n.getFormFieldList({form_id:x}).then(b=>{b.forEach(_=>{_.id=_.id*1}),o.fieldList=b}).catch(()=>{})};return Kt(()=>{y(),d()}),(x,b)=>(G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:q(()=>b[1]||(b[1]=[E("span",null,[$e("在指定数据表中更新符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",BI,[E("div",jI,[b[2]||(b[2]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ss,alt:""}),E("span",{class:"text"},"输入")],-1)),b[3]||(b[3]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",HI,[H(pc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":b[0]||(b[0]=_=>o.formData.form_id=_),onChange:l},null,8,["options","title","description","value"])]),b[4]||(b[4]=E("div",{class:"setting-label"},[E("span",null,"更新条件")],-1)),E("div",$I,[H(Hv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:a},null,8,["disabled","where","field-options","type"])]),b[5]||(b[5]=E("div",{class:"setting-label"},[E("span",null,"更新数据")],-1)),E("div",FI,[H(Iv,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showEmptyFieldRow:o.formData.form_id=="",list:o.formData.datas,onChange:u},null,8,["form-id","showAdd","showEmptyFieldRow","list"])])])])]),_:1}))}},WI=xt(zI,[["__scopeId","data-v-9cb10cb8"]]),J1={__name:"add-params-modal",emits:["add","edit","addSub"],setup(r,{expose:e,emit:t}){const n=t,i=Se(!1),o=Se("新增参数");let a="add";const l=(_,S)=>S?/^[a-zA-Z_]+$/.test(S)?Promise.resolve():Promise.reject("只能包含英文字母和下划线"):Promise.reject("请输入参数key");let u=0;const d=Jt({key:"",typ:"string",required:!1,default:"",enum:"",cu_key:"",subs:[]}),f=()=>{i.value=!0},h=()=>{Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),a="add",o.value="新增参数",i.value=!0},g=_=>{u=_,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),a="addSub",o.value="新增参数",i.value=!0},y=(_,S)=>{u=S,Object.assign(d,{key:"",typ:"string",required:!1,default:"",enum:"",cu_key:Math.random()*1e4,subs:[]}),Object.assign(d,{..._}),a="edit",o.value="编辑参数",i.value=!0},w=Se(null),x=()=>{w.value.validate().then(()=>{a=="add"&&n("add",{...d}),a=="addSub"&&n("addSub",{...d},u),a=="edit"&&n("edit",{...d},u),i.value=!1})},b=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}];return e({show:f,add:h,edit:y,addSub:g}),(_,S)=>{const k=kr,O=Yi,M=$r,R=Hr,T=pa,I=dc,$=Ti,ne=Sr;return G(),ue("div",null,[H(ne,{open:i.value,"onUpdate:open":S[5]||(S[5]=V=>i.value=V),title:o.value,onOk:x,width:472,"ok-text":"确定","cancel-text":"取消"},{default:q(()=>[H($,{ref_key:"formRef",ref:w,layout:"vertical",model:d,style:{margin:"24px 0"}},{default:q(()=>[H(O,{label:"参数key",name:"key",rules:[{required:!0,validator:(V,J)=>l(V,J)}]},{default:q(()=>[H(k,{value:d.key,"onUpdate:value":S[0]||(S[0]=V=>d.key=V),maxlength:20,placeholder:"英文字母和下划线“_”组成，最多20字符"},null,8,["value"])]),_:1},8,["rules"]),H(O,{label:"参数类型",name:"typ",rules:[{required:!0,message:"请选择参数类型"}]},{default:q(()=>[H(R,{value:d.typ,"onUpdate:value":S[1]||(S[1]=V=>d.typ=V),placeholder:"请选择",style:{width:"100%"}},{default:q(()=>[(G(),ue(st,null,mt(b,V=>H(M,{value:V.value},{default:q(()=>[$e(Ne(V.value),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),H(O,{label:"是否必填",name:"required",rules:[{required:!0,message:"请选择是否必填"}]},{default:q(()=>[H(T,{checked:d.required,"onUpdate:checked":S[2]||(S[2]=V=>d.required=V)},null,8,["checked"])]),_:1}),H(O,{label:"默认值",name:"default",rules:[{required:d.required,message:"请输入默认值"}]},{default:q(()=>[H(k,{value:d.default,"onUpdate:value":S[3]||(S[3]=V=>d.default=V),placeholder:"必填时大模型未提取到会返回默认值"},null,8,["value"])]),_:1},8,["rules"]),H(O,{label:"枚举值",name:"enum"},{default:q(()=>[H(I,{style:{height:"80px"},value:d.enum,"onUpdate:value":S[4]||(S[4]=V=>d.enum=V),placeholder:"列举该字段的值，一行一个。系统会要求大模型只能返回列举的值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},UI={class:"sub-field-item"},VI=["onClick"],qI=["onClick"],XI=["onClick"],GI={__name:"subs-key",props:{data:{},level:{type:Number},typOptions:{type:Array}},setup(r){const e=r,t=tn(()=>e.level>2?e.typOptions.filter(y=>y.value!="object"):e.typOptions),n=tn(()=>e.level==2?"180px":"146px");let i=0;const o=(y,w)=>{w.splice(y,1)},a=y=>{y.subs=[]},l=Se(null),u=y=>{i=y,l.value.add()},d=(y,w)=>{l.value.edit(y,w)},f=y=>{e.data[i].subs.push(y)},h=(y,w)=>{e.data.splice(w,1,y)},g=y=>y.typ=="object"&&e.level<=2;return(y,w)=>{const x=kr,b=$r,_=Hr,S=On("SubsKey",!0);return G(),ue(st,null,[(G(!0),ue(st,null,mt(e.data,(k,O)=>(G(),ue("div",{class:gn(["sub-field-item-box",`sub-field-item-box_${e.level}`]),key:k.cu_key},[E("div",UI,[w[0]||(w[0]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(x,{class:"mr12",style:Oi({width:n.value}),value:k.key,"onUpdate:value":M=>k.key=M,placeholder:"请输入"},null,8,["style","value","onUpdate:value"]),w[1]||(w[1]=E("img",{class:"fork-icon",src:ts,alt:""},null,-1)),H(_,{class:"mr12",onChange:M=>a(k),value:k.typ,"onUpdate:value":M=>k.typ=M,placeholder:"请选择",style:Oi({width:n.value})},{default:q(()=>[(G(!0),ue(st,null,mt(t.value,M=>(G(),Ue(b,{value:M.value},{default:q(()=>[$e(Ne(M.value),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onChange","value","onUpdate:value","style"]),g(k)?(G(),ue("div",{key:0,class:"btn-hover-wrap mr12",onClick:M=>u(O,e.data)},[H(ze(xs))],8,VI)):tt("",!0),E("div",{class:"btn-hover-wrap mr12",onClick:M=>d(k,O)},[H(ze(Nv))],8,qI),E("div",{class:"btn-hover-wrap",onClick:M=>o(O,e.data)},[H(ze(gr))],8,XI)]),k.subs&&k.subs.length>0?(G(),Ue(S,{key:0,level:e.level+1,typOptions:e.typOptions,data:k.subs},null,8,["level","typOptions","data"])):tt("",!0)],2))),128)),H(J1,{onAdd:f,onEdit:h,ref_key:"addParamsModalRef",ref:l},null,512)],64)}}},YI=xt(GI,[["__scopeId","data-v-30c2ddb1"]]),KI={class:"problem-optimization-form"},JI={class:"node-form-content"},ZI={class:"gray-block"},QI={class:"flex-block-item"},e3={class:"number-box"},t3={class:"number-slider-box"},n3={class:"number-input-box"},r3={class:"number-box"},i3={class:"number-slider-box"},o3={class:"number-input-box"},a3={class:"number-box"},s3={class:"number-box"},l3={class:"number-slider-box"},u3={class:"number-input-box"},d3={class:"field-list-item"},c3={class:"field-label"},f3={class:"field-type"},h3={class:"diy-form-item"},p3={class:"form-content"},v3={class:"gray-block mt16"},g3={class:"output-box"},m3={class:"array-form-box"},y3={class:"flex-block-item",style:{gap:"12px"}},_3=["onClick"],b3=["onClick"],x3=["onClick"],w3={key:0,class:"sub-field-box"},S3={__name:"index",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Yr(),o=Se(null),a=tn(()=>i.modelList),l=Se([]),u=Se([]),d=Se(!1),f=()=>{d.value=!d.value},h=(Me,ve)=>{_.prompt=Me,_.prompt_tags=ve};function g(){const Me=n.lf.getNodeModelById(n.nodeId);if(Me){let ve=Me.getAllParentVariable();u.value=y(ve)}}function y(Me){return Me.forEach(ve=>{ve.typ=="node"?ve.node_type==1?ve.value="global":ve.value=ve.node_id:ve.value=ve.key,ve.children&&ve.children.length>0&&(ve.children=y(ve.children))}),Me}const w=()=>{const Me=n.lf.getNodeModelById(n.nodeId);if(Me){let ve=Me.getAllParentVariable();l.value=ve}};function x(Me){if(Me){let ve=Me.split("."),Ve=ve[0],Be=ve.filter((de,le)=>le>0).join(".");return[Ve,Be]}return["global","question"]}const b=Se(),_=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:"",enable_thinking:!1,output:[]}),S=()=>{const Me=JSON.stringify({params_extractor:{..._,question_value:_.question_value.join("."),model_config_id:_.model_config_id?+_.model_config_id:_.model_config_id}});t("update-node",{...n.node,..._,node_params:Me})},k=()=>{try{let Me=n.node.dataRaw||n.node.node_params||"{}",ve=JSON.parse(Me).params_extractor||{};ve=JSON.parse(JSON.stringify(ve)),w(),g();for(let Ve in ve){if(Ve=="output"){_.output=O(ve[Ve]);continue}if(Ve=="question_value"){_.question_value=x(ve[Ve]);continue}_[Ve]=ve[Ve]}!_.model_config_id&&a.value.length>0&&(_.model_config_id=a.value[0].id,_.use_model=a.value[0].children[0].name)}catch(Me){}};Qt(()=>_,()=>{S()},{deep:!0});function O(Me){return Me.forEach(ve=>{ve.cu_key=Math.random()*1e4,ve.subs&&ve.subs.length?O(ve.subs):ve.subs=[]}),Me}const M=Se(null),R=()=>{M.value.add()},T=(Me,ve)=>{M.value.edit(Me,ve)},I=Me=>{_.output.push(Me)},$=(Me,ve)=>{_.output.splice(ve,1,Me)},ne=Me=>{_.output.splice(Me,1)},V=Me=>{Me.subs=[]},J=Me=>{M.value.addSub(Me)},D=(Me,ve)=>{_.output[ve].subs.push(Me)},U=[{lable:"string",value:"string"},{lable:"number",value:"number"},{lable:"boole",value:"boole"},{lable:"float",value:"float"},{lable:"object",value:"object"},{lable:"array<string>",value:"array<string>"},{lable:"array<number>",value:"array<number>"},{lable:"array<boole>",value:"array<boole>"},{lable:"array<float>",value:"array<float>"},{lable:"array<object>",value:"array<object>"}],j=Me=>{Me||g()},fe=Se({}),Ee=(Me,ve)=>{fe.value=ve},_e=tn(()=>{if(!_.model_config_id)return!1;let Me=_.model_config_id+"#"+_.use_model;return fe.value[Me]}),rt=()=>{t("close")};return Kt(()=>{k()}),(Me,ve)=>{const Ve=Fn,Be=Yi,de=Ai,le=Xl,W=va,Y=Di,se=pa,ge=_s,Pe=kr,Le=$r,He=Hr,ft=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"用大模型从用户消息中提取指定的参数并输出到下一节点",onClose:rt},null,8,["title","iconName"])]),default:q(()=>[E("div",KI,[E("div",JI,[H(ft,{ref_key:"formRef",ref:b,layout:"vertical",model:_},{default:q(()=>[E("div",ZI,[ve[24]||(ve[24]=E("div",{class:"gray-block-title"},"输入",-1)),H(Be,{label:"LLM模型",name:"use_model"},{default:q(()=>[E("div",QI,[H(fc,{modelType:"LLM",modeName:_.use_model,"onUpdate:modeName":ve[0]||(ve[0]=Ke=>_.use_model=Ke),modeId:_.model_config_id,"onUpdate:modeId":ve[1]||(ve[1]=Ke=>_.model_config_id=Ke),onLoaded:Ee,style:{width:"348px"}},null,8,["modeName","modeId"]),H(Ve,{onClick:f},{default:q(()=>[ve[12]||(ve[12]=$e("高级设置 ")),d.value?(G(),Ue(ze(ys),{key:0})):(G(),Ue(ze(cc),{key:1}))]),_:1,__:[12]})])]),_:1}),d.value?(G(),Ue(Be,{key:0,name:"temperature"},{label:q(()=>[ve[14]||(ve[14]=E("span",null,"温度 ",-1)),H(de,null,{title:q(()=>ve[13]||(ve[13]=[$e("温度越低，回答越严谨。温度越高，回答越发散。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",e3,[E("div",t3,[H(W,null,{default:q(()=>[H(le,{class:"custom-slider",value:_.temperature,"onUpdate:value":ve[2]||(ve[2]=Ke=>_.temperature=Ke),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",n3,[H(Y,{value:_.temperature,"onUpdate:value":ve[3]||(ve[3]=Ke=>_.temperature=Ke),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):tt("",!0),d.value?(G(),Ue(Be,{key:1,name:"max_token"},{label:q(()=>[ve[16]||(ve[16]=E("span",null,"最大token ",-1)),H(de,null,{title:q(()=>ve[15]||(ve[15]=[$e("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",r3,[E("div",i3,[H(W,null,{default:q(()=>[H(le,{class:"custom-slider",value:_.max_token,"onUpdate:value":ve[4]||(ve[4]=Ke=>_.max_token=Ke),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",o3,[H(Y,{value:_.max_token,"onUpdate:value":ve[5]||(ve[5]=Ke=>_.max_token=Ke),min:0,max:100*1024},null,8,["value"])])])]),_:1})):tt("",!0),d.value&&_e.value?(G(),Ue(Be,{key:2,name:"enable_thinking"},{label:q(()=>[ve[18]||(ve[18]=E("span",null,"深度思考 ",-1)),H(de,null,{title:q(()=>ve[17]||(ve[17]=[$e("开启时，调用大模型时会指定走深度思考模式")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",a3,[H(se,{checked:_.enable_thinking,"onUpdate:checked":ve[6]||(ve[6]=Ke=>_.enable_thinking=Ke)},null,8,["checked"])])]),_:1})):tt("",!0),H(Be,{name:"context_pair"},{label:q(()=>[ve[20]||(ve[20]=E("span",null,"上下文数量 ",-1)),H(de,null,{title:q(()=>ve[19]||(ve[19]=[$e("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",s3,[E("div",l3,[H(W,null,{default:q(()=>[H(le,{class:"custom-slider",value:_.context_pair,"onUpdate:value":ve[7]||(ve[7]=Ke=>_.context_pair=Ke),min:0,max:50},null,8,["value"])]),_:1})]),E("div",u3,[H(Y,{value:_.context_pair,"onUpdate:value":ve[8]||(ve[8]=Ke=>_.context_pair=Ke),min:0,max:50},null,8,["value"])])])]),_:1}),H(Be,{name:"prompt",class:"width-100"},{label:q(()=>ve[21]||(ve[21]=[E("div",{class:"space-between-box"},[E("div",null,"提示词")],-1)])),default:q(()=>[H(or,{type:"textarea",inputStyle:"height: 100px;",options:l.value,defaultSelectedList:_.prompt_tags,defaultValue:_.prompt,ref_key:"atInputRef",ref:o,onOpen:w,onChange:ve[9]||(ve[9]=(Ke,Nt)=>h(Ke,Nt)),placeholder:"请输入消息内容，键入“/”可以插入变量"},{option:q(({label:Ke,payload:Nt})=>[E("div",d3,[E("div",c3,Ne(Ke),1),E("div",f3,Ne(Nt.typ),1)])]),_:1},8,["options","defaultSelectedList","defaultValue"]),ve[22]||(ve[22]=E("div",{class:"form-tip"},"输入 / 插入变量",-1))]),_:1,__:[22]}),E("div",h3,[ve[23]||(ve[23]=E("div",{class:"form-label"},"用户问题",-1)),E("div",p3,[H(ge,{value:_.question_value,"onUpdate:value":ve[10]||(ve[10]=Ke=>_.question_value=Ke),onDropdownVisibleChange:j,style:{width:"220px"},options:u.value,allowClear:!1,displayRender:({labels:Ke})=>Ke.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","options","displayRender"])])])]),E("div",v3,[E("div",{class:"gray-block-title",onClick:ve[11]||(ve[11]=(...Ke)=>Me.test&&Me.test(...Ke))},"输出 (输出字段提取)"),E("div",g3,[ve[26]||(ve[26]=E("div",{class:"output-block"},[E("div",{class:"output-item"},"参数Key"),E("div",{class:"output-item"},"类型")],-1)),E("div",m3,[(G(!0),ue(st,null,mt(_.output,(Ke,Nt)=>(G(),ue("div",{class:"form-item-list",key:Nt},[H(Be,{label:null,name:["output",Nt,"key"]},{default:q(()=>[E("div",y3,[H(Pe,{style:{width:"214px"},value:Ke.key,"onUpdate:value":yt=>Ke.key=yt,placeholder:"请输入"},null,8,["value","onUpdate:value"]),H(W,null,{default:q(()=>[H(He,{onChange:yt=>V(Ke),value:Ke.typ,"onUpdate:value":yt=>Ke.typ=yt,placeholder:"请选择",style:{width:"214px"}},{default:q(()=>[(G(),ue(st,null,mt(U,yt=>H(Le,{value:yt.value,key:yt.value},{default:q(()=>[$e(Ne(yt.value),1)]),_:2},1032,["value"])),64))]),_:2},1032,["onChange","value","onUpdate:value"])]),_:2},1024),Ke.typ=="object"?(G(),ue("div",{key:0,class:"btn-hover-wrap",onClick:yt=>J(Nt)},[H(ze(xs))],8,_3)):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:yt=>T(Ke,Nt)},[H(ze(Nv))],8,b3),E("div",{class:"btn-hover-wrap",onClick:yt=>ne(Nt)},[H(ze(gr))],8,x3)]),Ke.subs&&Ke.subs.length>0?(G(),ue("div",w3,[H(W,null,{default:q(()=>[H(YI,{data:Ke.subs,level:2,typOptions:U},null,8,["data"])]),_:2},1024)])):tt("",!0)]),_:2},1032,["name"])]))),128)),H(Ve,{onClick:R,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>ve[25]||(ve[25]=[$e("添加参数")])),_:1,__:[25]},8,["icon"])])])])]),_:1},8,["model"])]),H(J1,{onAdd:I,onEdit:$,onAddSub:D,ref_key:"addParamsModalRef",ref:M},null,512)])]),_:1})}}},E3=xt(S3,[["__scopeId","data-v-abc4a683"]]),C3={class:"collapse-panel-warpper"},k3={class:"collapse-panel-header"},O3={class:"title-text"},N3={class:"collapse-panel-body"},M3={__name:"collapse-panel",props:{title:{type:String},count:{type:[Number,String],default:0},defaultCollapsed:{type:Boolean,default:!1}},setup(r){const t=Se(r.defaultCollapsed),n=()=>{t.value=!t.value};return(i,o)=>{const a=jr;return G(),ue("div",C3,[E("div",k3,[E("div",{class:"collapse-panel-title",onClick:dn(n,["stop"])},[E("span",O3,[$e(Ne(r.title)+" ",1),r.count?(G(),ue(st,{key:0},[$e("（"+Ne(r.count)+"）",1)],64)):tt("",!0)]),H(a,{name:"arrow-down",class:gn(["arrow-icon",{collapsed:t.value}]),style:{"font-size":"16px",color:"#000"}},null,8,["class"])])]),Mo(E("div",N3,[Za(i.$slots,"default",{},void 0,!0)],512),[[fa,!t.value]])])}}},kf=xt(M3,[["__scopeId","data-v-9d22edcd"]]),A3={class:"field-select-box"},T3={key:0,class:"field-list-box"},D3={key:1,class:"empty-box"},L3={__name:"field-select-alert",emits:["ok"],setup(r,{expose:e,emit:t}){const n=t,i=Jt({show:!1,formId:"",selectedRowKeys:[],selectedRows:[]}),o=Se([{title:"字段名称",dataIndex:"name",key:"name"},{title:"数据类型",dataIndex:"type",key:"type"},{title:"字段描述",dataIndex:"description",key:"description"}]),a=Se([{name:"create_time",type:"integer",description:"create_time",is_asc:0},{name:"update_time",type:"integer",description:"update_time",is_asc:0}]),l=(f,h)=>{i.selectedRowKeys=f,i.selectedRows=h},u=({formId:f,selectedRowKeys:h,selectedRows:g})=>{i.formId=f,i.selectedRowKeys=h,i.selectedRows=g,i.show=!0},d=()=>{n("ok",i.selectedRowKeys,i.selectedRows),i.show=!1};return e({open:u}),(f,h)=>{const g=y1,y=Sr;return G(),Ue(y,{width:"746px",open:i.show,"onUpdate:open":h[1]||(h[1]=w=>i.show=w),title:"关联数据表",onOk:d,"ok-text":"确定","cancel-text":"取消"},{default:q(()=>[E("div",A3,[a.value.length?(G(),ue("div",T3,[H(g,{rowKey:"name","row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:l},dataSource:a.value,columns:o.value,pagination:!1},null,8,["row-selection","dataSource","columns"])])):tt("",!0),a.value.length?tt("",!0):(G(),ue("div",D3,[h[3]||(h[3]=E("img",{src:Av,alt:""},null,-1)),E("div",null,[h[2]||(h[2]=$e(" 暂无字段, 请先去数据表添加 ")),E("a",{onClick:h[0]||(h[0]=(...w)=>f.openAddLibrary&&f.openAddLibrary(...w))}," 去添加")])]))])]),_:1},8,["open"])}}},P3=xt(L3,[["__scopeId","data-v-fca59186"]]),R3={class:"field-list"},I3={class:"field-list-col field-drag-col"},B3={class:"drag-btn"},j3={class:"field-list-col field-name-col"},H3={class:"field-name-box"},$3={class:"field-name"},F3={class:"field-type-tag"},z3={class:"field-list-col field-value-col"},W3={key:0,class:"field-list-col field-del-col"},U3={class:"add-btn-box"},V3={__name:"index",props:{showAdd:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},formId:{type:[String,Number],default:""},list:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["change"],setup(r,{emit:e}){const t=e,n=r,i=[{label:"升序",value:1,key:"asc"},{label:"降序",value:0,key:"desc"}],o=Se([]);Qt(()=>n.list,g=>{o.value=g.map(y=>({...y,is_asc:y.is_asc?1:0}))});const a=g=>{o.value.splice(g,1),d()},l=(g,y)=>{o.value=y.map(w=>({...w})),d()},u=()=>{d()},d=()=>{let g=o.value.map(y=>({...y,is_asc:y.is_asc==1}));t("change",g)},f=Se(),h=()=>{f.value.open({formId:n.formId,selectedRows:n.list,selectedRowKeys:n.list.map(g=>g.name)})};return(g,y)=>{const w=$r,x=Hr,b=jr,_=Fn,S=Ai;return G(),ue("div",null,[E("div",R3,[(G(!0),ue(st,null,mt(o.value,k=>(G(),ue("div",{class:"field-list-row",key:k.name},[E("div",I3,[E("span",B3,[H(ze(w1))])]),E("div",j3,[E("div",H3,[E("span",$3,Ne(k.name),1),E("span",F3,Ne(k.type),1)])]),E("div",z3,[H(x,{value:k.is_asc,"onUpdate:value":O=>k.is_asc=O,style:{width:"100%"},onChange:u},{default:q(()=>[(G(),ue(st,null,mt(i,O=>H(w,{value:O.value,key:O.key},{default:q(()=>[$e(Ne(O.label),1)]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value"])]),n.showDelete?(G(),ue("div",W3,[E("span",{class:"del-btn",onClick:y[0]||(y[0]=O=>a(g.index))},[H(b,{class:"del-icon",name:"close-circle"})])])):tt("",!0)]))),128))]),E("div",U3,[r.disabled?(G(),Ue(S,{key:0,title:"请先选择数据库",style:{width:"100%"}},{default:q(()=>[E("span",null,[H(_,{class:"add-btn",type:"dashed",disabled:"",block:""},{default:q(()=>[H(ze($n)),y[1]||(y[1]=$e(" 添加排序字段 "))]),_:1,__:[1]})])]),_:1})):(G(),Ue(_,{key:1,class:"add-btn",type:"dashed",block:"",onClick:h},{default:q(()=>[H(ze($n)),y[2]||(y[2]=$e(" 添加排序字段 "))]),_:1,__:[2]}))]),H(P3,{formId:r.formId,ref_key:"fieldSelectAlertRef",ref:f,onOk:l},null,8,["formId"])])}}},q3=xt(V3,[["__scopeId","data-v-d239001f"]]),X3={class:"field-item"},G3={class:"field-name"},Y3={class:"field-type"},K3={__name:"output-fields",props:{treeData:{type:Array,default:()=>[]}},setup(r){const e=r,t=Se([]);return(n,i)=>{const o=jr,a=SC;return G(),ue("div",{class:"field-tree-wrapper",onWheel:i[1]||(i[1]=dn(()=>{},["stop"])),onTouchmove:i[2]||(i[2]=dn(()=>{},["stop"]))},[H(a,{selectedKeys:t.value,"onUpdate:selectedKeys":i[0]||(i[0]=l=>t.value=l),blockNode:"",defaultExpandAll:!0,height:224,"tree-data":e.treeData},{switcherIcon:q(({switcherCls:l})=>[E("span",{class:gn(l)},[H(o,{class:"switcher-btn",name:"arrow-down",style:{"font-size":"14px",color:"#333"}})],2)]),title:q(({dataRef:l})=>[E("div",X3,[E("span",G3,Ne(l.title),1),E("span",Y3,Ne(l.type),1)])]),_:1},8,["selectedKeys","tree-data"])],32)}}},J3=xt(K3,[["__scopeId","data-v-29131f6c"]]),Z3={class:"select-data-form"},Q3={class:"node-box-content"},e8={class:"setting-box"},t8={class:"setting-box"},n8={class:"node-box-content"},r8={class:"setting-box"},i8={__name:"select-data-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Mt("setData"),n=Do();let i={};const o=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),a=tn(()=>[{title:"output_list",key:"output_list",type:"Array(Object)",children:o.formData.fields.map(k=>({title:k.name,key:k.name,type:k.type}))},{title:"row_num",key:"row_num",type:"integer"}]),l=({type:S,list:k})=>{o.formData.typ=S,o.formData.where=k,y()},u=S=>{o.formData.order=[...S],y()},d=(S,k)=>{k?(o.formData.form_name=k.name,o.formData.form_description=k.description,_(k.id)):(o.formData.form_name="",o.formData.form_description="",o.formData.typ=1,o.formData.fields=[],o.formData.where=[],o.formData.order=[],o.formData.limit=100),y()},f=S=>{o.formData.fields=S,y()},h=()=>{y()},g=()=>{let S=e.node.dataRaw||e.node.node_params||"{}";i=JSON.parse(S);let k=w(i.form_select.where||[]);i.form_select.where=k,o.formData=i.form_select,o.formData.form_id&&_(o.formData.form_id),y()},y=()=>{let S={...Gi(o.formData)};S.where=x(S.where),i.form_select=S,t({...e.node,node_params:JSON.stringify(i)})},w=S=>{let k=[];return S.forEach(O=>{let M=JSON.parse(JSON.stringify(O)),R=M.rule.split("_");M.form_field_id=M.form_field_id*1,M.field_type=R[0],R.shift(),M.rule=R.join("_"),k.push(M)}),k},x=S=>{let k=[];return S.forEach(O=>{let M=JSON.parse(JSON.stringify(O));M.form_field_id=M.form_field_id*1,M.rule=O.field_type+"_"+O.rule,k.push(M)}),k},b=async()=>{const S=await n.getFormList();S&&(o.tableList=S)},_=async S=>{n.getFormFieldList({form_id:S}).then(k=>{k.forEach(O=>{O.id=O.id*1}),o.fieldList=k}).catch(()=>{})};return Kt(()=>{b(),g()}),(S,k)=>{const O=Di;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:q(()=>k[8]||(k[8]=[E("span",null,[$e("在指定数据表中查询符合条件的数据，可以在数据库中维护数据表 "),E("a",{target:"_blank",href:"/#/database/list"},"去管理")],-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",Z3,[E("div",Q3,[k[9]||(k[9]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Ss,alt:""}),E("span",{class:"text"},"输入")],-1)),k[10]||(k[10]=E("div",{class:"setting-label"},[E("span",null,"数据表")],-1)),E("div",e8,[H(pc,{options:o.tableList,title:o.formData.form_name,description:o.formData.form_description,value:o.formData.form_id,"onUpdate:value":k[0]||(k[0]=M=>o.formData.form_id=M),onChange:d},null,8,["options","title","description","value"])]),E("div",t8,[H(kf,{title:"查询条件",count:o.formData.where.length},{default:q(()=>[H(Hv,{disabled:!o.formData.form_id,where:o.formData.where,"field-options":o.fieldList,type:o.formData.typ,onChange:l},null,8,["disabled","where","field-options","type"])]),_:1},8,["count"])]),E("div",{class:"setting-box",onWheel:k[1]||(k[1]=dn(()=>{},["stop"])),onTouchmove:k[2]||(k[2]=dn(()=>{},["stop"]))},[H(kf,{title:"查询字段",count:o.formData.fields.length},{default:q(()=>[H(Iv,{"form-id":o.formData.form_id,showAdd:o.formData.form_id!="",showInput:!1,showEmptyFieldRow:o.formData.form_id=="",list:o.formData.fields,onChange:f},null,8,["form-id","showAdd","showEmptyFieldRow","list"])]),_:1},8,["count"])],32),E("div",{class:"setting-box",onWheel:k[3]||(k[3]=dn(()=>{},["stop"])),onTouchmove:k[4]||(k[4]=dn(()=>{},["stop"]))},[H(kf,{title:"排序",count:o.formData.order.length},{default:q(()=>[H(q3,{"form-id":o.formData.form_id,disabled:!o.formData.form_id,list:o.formData.order,onChange:u},null,8,["form-id","disabled","list"])]),_:1},8,["count"])],32),k[11]||(k[11]=E("div",{class:"setting-label"},[E("span",null,"查询数量")],-1)),E("div",{class:"setting-box",onWheel:k[6]||(k[6]=dn(()=>{},["stop"])),onTouchmove:k[7]||(k[7]=dn(()=>{},["stop"]))},[H(O,{min:1,max:1e3,value:o.formData.limit,"onUpdate:value":k[5]||(k[5]=M=>o.formData.limit=M),disabled:!o.formData.form_id,style:{width:"205px"},onChange:h},null,8,["value","disabled"])],32)]),E("div",n8,[k[12]||(k[12]=E("div",{class:"node-box-title"},[E("img",{class:"input-icon",src:Rv,alt:""}),E("span",{class:"text"},"输出")],-1)),E("div",r8,[H(J3,{treeData:a.value},null,8,["treeData"])])])])]),_:1})}}},o8=xt(i8,[["__scopeId","data-v-10a423c3"]]),a8={class:"problem-optimization-form"},s8={class:"gray-block"},l8={class:"flex-block-item"},u8={class:"number-box"},d8={class:"number-slider-box"},c8={class:"number-input-box"},f8={class:"number-box"},h8={class:"number-slider-box"},p8={class:"number-input-box"},v8={class:"number-box"},g8={class:"number-box"},m8={class:"number-slider-box"},y8={class:"number-input-box"},_8={class:"gray-block mt16"},b8={class:"array-form-box"},x8={class:"flex-block-item"},w8=["onClick"],S8={class:"form-item-list"},E8={class:"flex-block-item"},C8={__name:"question-node-form",props:{lf:{type:Object,default:null},nodeId:{type:String,default:""},node:{type:Object,default:()=>({})}},emits:["update-node"],setup(r,{emit:e}){const t=e,n=r,i=Yr(),o=tn(()=>i.modelList),a=Se(!1),l=()=>{a.value=!a.value},u=Se(),d=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]}),f=()=>{const k=JSON.stringify({cate:{...d,model_config_id:d.model_config_id?+d.model_config_id:d.model_config_id}});t("update-node",{...n.node,...d,node_params:k})},h=()=>{try{let k=n.node.dataRaw||n.node.node_params||"{}",O=JSON.parse(k).cate||{};O=JSON.parse(JSON.stringify(O));for(let M in O)if(M=="categorys")if(O.categorys&&O.categorys.length>0){let R=O.categorys.map(T=>({...T,key:Math.random()*1e4}));d[M]=R}else d[M]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else d[M]=O[M];!d.model_config_id&&o.value.length>0&&(d.model_config_id=o.value[0].id,d.use_model=o.value[0].children[0].name)}catch(k){}};Qt(()=>d,()=>{f()},{deep:!0});const g=()=>{d.categorys.push({category:"",next_node_key:"",key:Math.random()*1e4})},y=k=>{d.categorys.splice(k,1)},w=()=>Promise.resolve(),x=Se({}),b=(k,O)=>{x.value=O},_=tn(()=>{if(!d.model_config_id)return!1;let k=d.model_config_id+"#"+d.use_model;return x.value[k]}),S=()=>{t("close")};return Kt(()=>{h()}),(k,O)=>{const M=Fn,R=Yi,T=Ai,I=Xl,$=va,ne=Di,V=pa,J=kr,D=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name,desc:"由大模型判断用户消息属于哪个分类，不同分类走不同分支",onClose:S},null,8,["title","iconName"])]),default:q(()=>[E("div",a8,[E("div",{class:"node-form-content",onMousedown:O[9]||(O[9]=dn(()=>{},["stop"]))},[H(D,{ref_key:"formRef",ref:u,layout:"vertical",model:d},{default:q(()=>[E("div",s8,[O[19]||(O[19]=E("div",{class:"gray-block-title"},"输入",-1)),H(R,{label:"LLM模型",name:"use_model"},{default:q(()=>[E("div",l8,[H(fc,{modelType:"LLM",modeName:d.use_model,"onUpdate:modeName":O[0]||(O[0]=U=>d.use_model=U),modeId:d.model_config_id,"onUpdate:modeId":O[1]||(O[1]=U=>d.model_config_id=U),onLoaded:b,style:{width:"348px"}},null,8,["modeName","modeId"]),H(M,{onClick:l},{default:q(()=>[O[10]||(O[10]=$e("高级设置 ")),a.value?(G(),Ue(ze(ys),{key:0})):(G(),Ue(ze(cc),{key:1}))]),_:1,__:[10]})])]),_:1}),a.value?(G(),Ue(R,{key:0,name:"temperature"},{label:q(()=>[O[12]||(O[12]=E("span",null,"温度 ",-1)),H(T,null,{title:q(()=>O[11]||(O[11]=[$e("温度越低，回答越严谨。温度越高，回答越发散。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",u8,[E("div",d8,[H($,null,{default:q(()=>[H(I,{class:"custom-slider",value:d.temperature,"onUpdate:value":O[2]||(O[2]=U=>d.temperature=U),min:0,max:2,step:.1},null,8,["value"])]),_:1})]),E("div",c8,[H(ne,{value:d.temperature,"onUpdate:value":O[3]||(O[3]=U=>d.temperature=U),min:0,max:2,step:.1},null,8,["value"])])])]),_:1})):tt("",!0),a.value?(G(),Ue(R,{key:1,name:"max_token"},{label:q(()=>[O[14]||(O[14]=E("span",null,"最大token ",-1)),H(T,null,{title:q(()=>O[13]||(O[13]=[$e("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",f8,[E("div",h8,[H($,null,{default:q(()=>[H(I,{class:"custom-slider",value:d.max_token,"onUpdate:value":O[4]||(O[4]=U=>d.max_token=U),min:0,max:100*1024},null,8,["value"])]),_:1})]),E("div",p8,[H(ne,{value:d.max_token,"onUpdate:value":O[5]||(O[5]=U=>d.max_token=U),min:0,max:100*1024},null,8,["value"])])])]),_:1})):tt("",!0),a.value&&_.value?(G(),Ue(R,{key:2,name:"enable_thinking"},{label:q(()=>[O[16]||(O[16]=E("span",null,"深度思考 ",-1)),H(T,null,{title:q(()=>O[15]||(O[15]=[$e("开启时，调用大模型时会指定走深度思考模式")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",v8,[H(V,{checked:d.enable_thinking,"onUpdate:checked":O[6]||(O[6]=U=>d.enable_thinking=U)},null,8,["checked"])])]),_:1})):tt("",!0),H(R,{name:"context_pair"},{label:q(()=>[O[18]||(O[18]=E("span",null,"上下文数量 ",-1)),H(T,null,{title:q(()=>O[17]||(O[17]=[$e("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:q(()=>[H(ze(Kn),{class:"question-icon"})]),_:1})]),default:q(()=>[E("div",g8,[E("div",m8,[H($,null,{default:q(()=>[H(I,{class:"custom-slider",value:d.context_pair,"onUpdate:value":O[7]||(O[7]=U=>d.context_pair=U),min:0,max:50},null,8,["value"])]),_:1})]),E("div",y8,[H(ne,{value:d.context_pair,"onUpdate:value":O[8]||(O[8]=U=>d.context_pair=U),min:0,max:50},null,8,["value"])])])]),_:1}),O[20]||(O[20]=E("div",{class:"diy-form-item"},[E("div",{class:"form-label"},"用户问题"),E("div",{class:"form-content"},"流程开始>用户问题")],-1))]),E("div",_8,[O[22]||(O[22]=E("div",{class:"gray-block-title"},"问题分类设置",-1)),E("div",b8,[(G(!0),ue(st,null,mt(d.categorys,(U,j)=>(G(),ue("div",{class:"form-item-list",key:U.key},[H(R,{label:null,name:["categorys",j,"category"],rules:{required:!0,validator:(fe,Ee)=>w(fe,Ee)}},{default:q(()=>[E("div",x8,[H(J,{class:"flex1",value:U.category,"onUpdate:value":fe=>U.category=fe,placeholder:"请输入"},null,8,["value","onUpdate:value"]),E("div",{class:"btn-hover-wrap",onClick:fe=>y(j)},[H(ze(gr))],8,w8)])]),_:2},1032,["name","rules"])]))),128)),E("div",S8,[H(R,{label:null},{default:q(()=>[E("div",E8,[H(J,{class:"flex1",value:"默认分类",readonly:""})])]),_:1})]),H(M,{onClick:g,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>O[21]||(O[21]=[$e("添加问题分类")])),_:1,__:[21]},8,["icon"])])])]),_:1},8,["model"])],32)])]),_:1})}}},k8=xt(C8,[["__scopeId","data-v-3875cab5"]]),O8={class:"judge-node-form"},N8={class:"gray-block-title"},M8=["onClick"],A8={class:"condition-list-box"},T8={class:"left-select-box"},D8={class:"condition-body"},L8=["onClick"],P8={class:"btn-wrap"},R8={class:"add-btn-block"},I8={__name:"judge-node-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=r,t=Mt("getNode"),n=Mt("setData"),i=Se(),o=Jt({term:[]}),a=Se([]);function l(){let R=t().getAllParentVariable();a.value=u(R)}function u(R){return R.forEach(T=>{T.typ=="node"?T.node_type==1?T.value="global":T.value=T.node_id:T.value=T.key,T.children&&T.children.length>0&&(T.children=u(T.children))}),R}const d=R=>{R||l()};let f=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const h=()=>{try{let R=JSON.parse(e.node.node_params).term||[];R=R.map(T=>{let I=T.terms.map($=>{let ne="";for(let V=0;V<f.length;V++)if($.variable.indexOf(f[V])>-1){ne=f[V];break}if(ne!=""){let V=$.variable.split(".");$.variable=[V[0],ne]}else $.variable=$.variable.split(".");return{...$,type:$.type>0?$.type:1,key:Math.random()*1e4}});return{...T,is_or:T.is_or?1:0,terms:I,key:Math.random()*1e4}}),o.term=R,g()}catch(R){}},g=()=>{let R=JSON.parse(JSON.stringify(o.term));R=R.map(T=>({is_or:T.is_or==1,next_node_key:T.next_node_key,terms:T.terms.map(I=>({variable:I.variable.join("."),is_mult:I.is_mult,type:I.type,value:I.value}))})),n({...e.node,term:R,node_params:JSON.stringify({term:R})})},y=R=>{o.term[R].terms.push({is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4})},w=(R,T)=>{o.term[R].terms.splice(T,1)},x=()=>{o.term.push({is_or:0,key:Math.random()*1e4,next_node_key:"",terms:[{is_mult:!1,type:void 0,value:"",variable:[],key:Math.random()*1e4}]})},b=R=>{o.term.splice(R,1)},_=R=>{let T=O(R);R.is_mult=T.includes("array"),R.type=void 0};let S=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],k=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function O(R){let T="";if(R.variable&&R.variable.length>0){let I=a.value.filter($=>$.key==R.variable[0]);I&&I.length&&(T=I[0].typ),T=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter($=>$.key==R.variable[1])),I&&I.length&&(T=I[0].typ),T=="object"&&(I[0]&&I[0].children&&(I=I[0].subs.filter($=>$.key==R.variable[2])),I&&I.length&&(T=I[0].typ)))}return T}function M(R){if(!R.variable)return[];let T=O(R);return T==""?R.is_mult?k:S:T=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:T.includes("array")?k:S}return Qt(()=>o,()=>{g()},{deep:!0}),Kt(()=>{l(),h()}),(R,T)=>{const I=bs,$=$r,ne=Hr,V=_s,J=kr,D=Fn,U=Ti;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{desc:q(()=>T[2]||(T[2]=[E("span",null,"指定条件创建不同分支，系统根据变量值判断应该走哪个分支",-1)])),_:1},8,["title","iconName"])]),default:q(()=>[E("div",O8,[E("div",{class:"form-block",onMousedown:T[1]||(T[1]=dn(()=>{},["stop"]))},[H(U,{ref_key:"formRef",ref:i,layout:"vertical",model:o},{default:q(()=>[H(ze(ZN),{style:{display:"flex","flex-direction":"column",gap:"8px"},handle:".drag-btn",modelValue:o.term,"onUpdate:modelValue":T[0]||(T[0]=j=>o.term=j),"item-key":"key"},{item:q(({element:j,index:fe})=>[(G(),ue("div",{class:"gray-block",key:j.key},[E("div",N8,[H(I,{gap:8},{default:q(()=>[H(ze(w1),{class:"icon drag-btn"}),$e(Ne(fe==0?"if":"else if"),1)]),_:2},1024),o.term.length>1?(G(),ue("div",{key:0,class:"btn-hover-wrap",onClick:Ee=>b(fe)},[H(ze(gr))],8,M8)):tt("",!0)]),E("div",A8,[E("div",T8,[H(ne,{size:"small",value:j.is_or,"onUpdate:value":Ee=>j.is_or=Ee,bordered:!1,style:{width:"64px"}},{default:q(()=>[H($,{value:0},{default:q(()=>T[3]||(T[3]=[$e("and")])),_:1,__:[3]}),H($,{value:1},{default:q(()=>T[4]||(T[4]=[$e("or")])),_:1,__:[4]})]),_:2},1032,["value","onUpdate:value"])]),E("div",D8,[(G(!0),ue(st,null,mt(j.terms,(Ee,_e)=>(G(),ue("div",{class:"condition-item",key:Ee.key},[H(V,{value:Ee.variable,"onUpdate:value":rt=>Ee.variable=rt,onChange:rt=>_(Ee),onDropdownVisibleChange:d,style:{width:"160px"},options:a.value,allowClear:!1,displayRender:({labels:rt})=>rt.join("/"),"field-names":{children:"children"},placeholder:"请选择"},null,8,["value","onUpdate:value","onChange","options","displayRender"]),H(ne,{value:Ee.type,"onUpdate:value":rt=>Ee.type=rt,style:{width:"120px"},placeholder:"请选择"},{default:q(()=>[(G(!0),ue(st,null,mt(M(Ee),rt=>(G(),Ue($,{value:rt.value,key:rt.value},{default:q(()=>[$e(Ne(rt.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),Ee.type!=5&&Ee.type!=6?(G(),Ue(J,{key:0,placeholder:"请输入",value:Ee.value,"onUpdate:value":rt=>Ee.value=rt,style:{width:"150px"}},null,8,["value","onUpdate:value"])):tt("",!0),E("div",{class:"btn-hover-wrap",onClick:rt=>w(fe,_e)},[H(ze(gr))],8,L8)]))),128))])]),E("div",P8,[H(D,{onClick:Ee=>y(fe),icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>T[5]||(T[5]=[$e("添加条件")])),_:2,__:[5]},1032,["onClick","icon"])])]))]),_:1},8,["modelValue"]),E("div",R8,[H(D,{onClick:x,icon:bn(ze($n)),block:"",type:"dashed"},{default:q(()=>T[6]||(T[6]=[$e("添加分支")])),_:1,__:[6]},8,["icon"])]),T[7]||(T[7]=E("div",{class:"gray-block mt8"},[E("div",{class:"gray-block-title"},"else"),E("div",{class:"main-text"},"不符合上述所有分支的条件时，走默认分支")],-1))]),_:1,__:[7]},8,["model"])],32)])]),_:1})}}},B8=xt(I8,[["__scopeId","data-v-8d703e95"]]),j8={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData"],components:{NodeFormHeader:lr,AtInput:or,FullscreenOutlined:kv,FullAtInput:V1,NodeFormLayout:sr},props:{node:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{formState(){this.update()}},mounted(){this.getValueOptions();const r=this.getGraph();let e=this.node.dataRaw||this.node.node_params||"{}";const n=JSON.parse(e).reply||{content:"",content_tags:[]};this.formState.content=n.content,this.formState.content_tags=n.content_tags||[],this.$nextTick(()=>{this.$refs.atInputRef.refresh()}),this.update(),r.eventCenter.on("custom:setNodeName",this.onUpatateNodeName)},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{onUpatateNodeName(r){ws.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.node.node_params);r.reply={...this.formState},this.setData({...this.node,node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()},handleOpenFullAtModal(){this.$refs.fullAtInputRef.show()},handleRefreshAtInput(){this.$refs.atInputRef.refresh()}}},H8={class:"specify-reply-form"},$8={class:"node-content"},F8={class:"form-item-label"},z8={class:"flex-between-box"},W8={class:"form-item-body"};function U8(r,e,t,n,i,o){const a=On("NodeFormHeader"),l=On("FullscreenOutlined"),u=On("at-input"),d=On("FullAtInput"),f=On("NodeFormLayout");return G(),Ue(f,null,{header:q(()=>[H(a,{title:t.node.node_name,iconName:t.node.node_icon_name,desc:"触发该节点，将生成一条固定消息"},null,8,["title","iconName"])]),default:q(()=>[E("div",H8,[E("div",$8,[e[5]||(e[5]=E("div",{class:"form-label"},"输出",-1)),E("div",{class:"form-item",onMousedown:e[2]||(e[2]=dn(()=>{},["stop"]))},[E("div",F8,[E("div",z8,[e[4]||(e[4]=E("div",null,"消息内容",-1)),E("div",{class:"btn-hover-wrap",onClick:e[0]||(e[0]=(...h)=>o.handleOpenFullAtModal&&o.handleOpenFullAtModal(...h))},[H(l)])])]),E("div",W8,[H(u,{inputStyle:"height: 100px;",options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef",placeholder:"请输入消息内容，键入“/”可以插入变量","input-style":"height: 130px",type:"textarea",onOpen:o.showAtList,onChange:e[1]||(e[1]=(h,g)=>o.changeValue(h,g))},null,8,["options","defaultSelectedList","defaultValue","onOpen"])])],32)]),H(d,{options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,placeholder:"请输入消息内容，键入“/”可以插入变量",type:"textarea",onOpen:o.showAtList,onChange:e[3]||(e[3]=(h,g)=>o.changeValue(h,g)),onOk:o.handleRefreshAtInput,ref:"fullAtInputRef"},null,8,["options","defaultSelectedList","defaultValue","onOpen","onOk"])])]),_:1})}const V8=xt(j8,[["render",U8],["__scopeId","data-v-87ffa1dc"]]),q8=["src"],X8={class:"mcp-form"},G8={class:"node-options"},Y8={class:"options-item-tit"},K8={class:"option-label"},J8={class:"option-type"},Z8={class:"field-list-item"},Q8={class:"field-label"},eB={class:"field-type"},tB={class:"desc"},nB={__name:"mcp-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=Mt("getNode"),t=Mt("setData"),n=r,i=Jt({mcpInfo:{},toolInfo:{}}),o=Jt({params:{}}),a=Se([]);let l={};function u(){d(),l=JSON.parse(n.node.node_params),g()}function d(){a.value=e().getAllParentVariable()}function f(y,w,x){y.value=w,y.tags=x,h()}function h(){let y={arguments:{},tag_map:{}};for(let w in o.params){let x=o.params[w].value,b=i.toolInfo.inputSchema.properties[w]||{};b.type=="string"?x=String(x):["number","integer"].includes(b.type)&&(x=Number(x)),y.arguments[w]=x,y.tag_map[w]=o.params[w].tags}l.mcp.arguments=y.arguments,l.mcp.tag_map=y.tag_map||[],t({...n.node,node_params:JSON.stringify(l)})}const g=()=>{A1({provider_id:l.mcp.provider_id}).then(y=>{var S;i.mcpInfo=(y==null?void 0:y.data)||{};let w=h1((S=i.mcpInfo)==null?void 0:S.tools,[]);i.toolInfo=w.find(k=>k.name==l.mcp.tool_name);let x=i.toolInfo.inputSchema||{},b=(x==null?void 0:x.properties)||{},_=(x==null?void 0:x.required)||[];b=JSON.parse(JSON.stringify(b));for(let k in b)b[k].value=String(l.mcp.arguments[k]||""),b[k].tags=l.mcp.tag_map?l.mcp.tag_map[k]:[],b[k].required=_.includes(k);o.params=b})};return Kt(()=>{u()}),(y,w)=>(G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,iconName:r.node.node_icon_name},{"node-icon":q(()=>[E("img",{class:"node-icon",src:i.mcpInfo.avatar,alt:""},null,8,q8)]),desc:q(()=>[E("span",null,Ne(i.toolInfo.description),1)]),_:1},8,["title","iconName"])]),default:q(()=>[E("div",X8,[E("div",G8,[w[0]||(w[0]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Ss,class:"title-icon"}),$e("输入")])],-1)),(G(!0),ue(st,null,mt(o.params,(x,b)=>(G(),ue("div",{key:b,class:gn(["options-item",{"is-required":x.required}])},[E("div",Y8,[E("div",K8,Ne(b),1),E("div",J8,Ne(x.type),1)]),E("div",null,[H(or,{type:"textarea",inputStyle:"height: 64px;",options:a.value,defaultSelectedList:x.tags,defaultValue:x.value,ref_for:!0,ref:"atInputRef",onOpen:d,onChange:(_,S)=>f(x,_,S),placeholder:"请输入内容，键入“/”可以插入变量"},{option:q(({label:_,payload:S})=>[E("div",Z8,[E("div",Q8,Ne(_),1),E("div",eB,Ne(S.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",tB,Ne(x.description),1)],2))),128))]),w[1]||(w[1]=E("div",{class:"node-options"},[E("div",{class:"options-title"},[E("div",null,[E("img",{src:Rv,class:"title-icon"}),$e("输出")])]),E("div",{class:"options-item"},[E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"输出")]),E("div",{class:"options-item-tit"},[E("div",{class:"option-label"},"text"),E("div",{class:"option-type"},"string")]),E("div",{class:"desc"},"工具生成的内容")])],-1))])]),_:1}))}},rB=xt(nB,[["__scopeId","data-v-f79fdff9"]]),iB=["src"],oB={class:"mcp-form"},aB={class:"node-options"},sB={class:"options-item-tit"},lB={class:"option-label"},uB={class:"option-type"},dB={class:"field-list-item"},cB={class:"field-label"},fB={class:"field-type"},hB={class:"desc"},pB={__name:"zm-plugins-node-form",props:{node:{type:Object,default:()=>({})}},setup(r){const e=Mt("getNode"),t=Mt("setData"),n=r,i=Jt({}),o=Se({}),a=Se([]);let l={};function u(){h(),l=JSON.parse(n.node.node_params),f(),d()}function d(){var w;D1({name:(w=l==null?void 0:l.plugin)==null?void 0:w.name}).then(x=>{let b=(x==null?void 0:x.data)||{};o.value=b.remote})}function f(){var w;T1({name:((w=l==null?void 0:l.plugin)==null?void 0:w.name)||"",action:"default/get-schema",params:{}}).then(x=>{var b;Object.assign(i,(x==null?void 0:x.data)||{});for(let _ in i)i[_].value=String((l==null?void 0:l.plugin.params[_])||""),i[_].tags=l.tag_map?(b=l==null?void 0:l.plugin)==null?void 0:b.tag_map[_]:[]})}function h(){a.value=e().getAllParentVariable()}function g(w,x,b){w.value=x,w.tags=b,y()}function y(){let w={params:{},tag_map:{}};for(let x in i){let b=i[x].value;i[x].type=="string"?b=String(b):["number","integer"].includes(i[x].type)&&(b=Number(b)),w.params[x]=b,w.tag_map[x]=i[x].tags}l.plugin.params=w.params,l.plugin.tag_map=w.tag_map,t({...n.node,node_params:JSON.stringify(l)})}return Kt(()=>{u()}),(w,x)=>{const b=Ov;return G(),Ue(sr,null,{header:q(()=>[H(lr,{title:r.node.node_name,desc:o.value.description},{"node-icon":q(()=>[o.value.icon?(G(),ue("img",{key:0,class:"node-icon",src:o.value.icon},null,8,iB)):(G(),Ue(b,{key:1,size:"small"}))]),_:1},8,["title","desc"])]),default:q(()=>[E("div",oB,[E("div",aB,[x[0]||(x[0]=E("div",{class:"options-title"},[E("div",null,[E("img",{src:Ss,class:"title-icon"}),$e("输入")])],-1)),(G(!0),ue(st,null,mt(i,(_,S)=>(G(),ue("div",{key:S,class:gn(["options-item",{"is-required":_.required}])},[E("div",sB,[E("div",lB,Ne(S),1),E("div",uB,Ne(_.type),1)]),E("div",null,[H(or,{type:"textarea",inputStyle:"height: 64px;",options:a.value,defaultSelectedList:_.tags,defaultValue:_.value,ref_for:!0,ref:"atInputRef",onOpen:h,onChange:(k,O)=>g(_,k,O),placeholder:"请输入内容，键入“/”可以插入变量"},{option:q(({label:k,payload:O})=>[E("div",dB,[E("div",cB,Ne(k),1),E("div",fB,Ne(O.typ),1)])]),_:2},1032,["options","defaultSelectedList","defaultValue","onChange"])]),E("div",hB,Ne(_.description),1)],2))),128))])])]),_:1})}}},vB=xt(pB,[["__scopeId","data-v-6d131980"]]),gB=["width"],mB={class:"node-form-drawer-body"},yB=["node-key"],_B={__name:"index",props:{open:{type:Boolean,default:!1},lf:{type:Object,default:null},nodeId:{type:String,default:""},nodeType:{type:String,default:"start-node"},node:{type:Object,default:()=>({})}},emits:["update:open","update-node","change-title"],setup(r,{expose:e,emit:t}){const n={"start-node":AT,"problem-optimization-node":fD,"ai-dialogue-node":BD,"add-data-node":_L,"knowledge-base-node":pP,"code-run-node":gR,"http-node":oI,"delete-data-node":EI,"variable-assignment-node":II,"update-data-node":WI,"parameter-extraction-node":E3,"select-data-node":o8,"question-node":k8,"judge-node":B8,"specify-reply-node":V8,"mcp-node":rB,"zm-plugins-node":vB},i=t,o=r,a=tn({get:()=>o.open,set:S=>i("update:open",S)}),l=()=>{a.value=!1},u=tn(()=>["delete-data-node","update-data-node","select-data-node","judge-node"].includes(o.nodeType)?600:480),d=()=>o.lf.getNodeModelById(o.nodeId),f=()=>o.lf.graphModel,h=S=>{b(S)},g=S=>{i("change-title",S)},y=()=>{a.value=!1;let S=d();f().eventCenter.emit("custom:node:delete",S)};Yo("lf",o.lf),Yo("getNode",d),Yo("getGraph",f),Yo("setData",h),Yo("changeTitle",g),Yo("deleteNode",y),Yo("close",l);const w=tn(()=>{const S=`${o.nodeType}`;return n[S]||null}),x=Se(null),b=S=>{clearTimeout(x.value),x.value=setTimeout(()=>{S.dataRaw=S.node_params,i("update-node",S)},300)},_=()=>{a.value=!1};return e({open}),(S,k)=>{const O=Fn,M=EC;return G(),Ue(hC,{name:"slide-right",appear:""},{default:q(()=>[a.value?(G(),ue("div",{key:0,width:u.value,style:Oi({width:u.value+"px"}),class:"node-form-drawer","aria-label":"节点表单编辑器",role:"dialog",onKeydown:fC(_,["esc"])},[E("div",mB,[E("div",{class:"drawer-form","node-key":o.nodeType},[w.value?(G(),Ue(v1(w.value),{lf:o.lf,"node-id":o.nodeId,"node-type":o.nodeType,node:o.node,key:o.nodeId,onClose:_,onUpdateNode:b},null,40,["lf","node-id","node-type","node"])):(G(),Ue(M,{key:1,status:"warning",title:"组件加载失败","sub-title":"无法找到对应的节点表单组件"},{extra:q(()=>[H(O,{type:"primary",onClick:_},{default:q(()=>k[0]||(k[0]=[$e("关闭")])),_:1,__:[0]})]),_:1}))],8,yB)])],44,gB)):tt("",!0)]),_:1})}}},bB=xt(_B,[["__scopeId","data-v-13f956b2"]]);var vc,Xt,Z1,Qo,Oy,Q1,ex,tx,$v,Ep,Cp,Ml={},nx=[],xB=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Zl=Array.isArray;function oo(r,e){for(var t in e)r[t]=e[t];return r}function Fv(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function wt(r,e,t){var n,i,o,a={};for(o in e)o=="key"?n=e[o]:o=="ref"?i=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?vc.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(o in r.defaultProps)a[o]===void 0&&(a[o]=r.defaultProps[o]);return sd(r,a,n,i,null)}function sd(r,e,t,n,i){var o={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Z1,__i:-1,__u:0};return i==null&&Xt.vnode!=null&&Xt.vnode(o),o}function gc(){return{current:null}}function ns(r){return r.children}function Yt(r,e){this.props=r,this.context=e}function rs(r,e){if(e==null)return r.__?rs(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?rs(r):null}function rx(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return rx(r)}}function Ny(r){(!r.__d&&(r.__d=!0)&&Qo.push(r)&&!vd.__r++||Oy!=Xt.debounceRendering)&&((Oy=Xt.debounceRendering)||Q1)(vd)}function vd(){for(var r,e,t,n,i,o,a,l=1;Qo.length;)Qo.length>l&&Qo.sort(ex),r=Qo.shift(),l=Qo.length,r.__d&&(t=void 0,n=void 0,i=(n=(e=r).__v).__e,o=[],a=[],e.__P&&((t=oo({},n)).__v=n.__v+1,Xt.vnode&&Xt.vnode(t),zv(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[i]:null,o,i??rs(n),!!(32&n.__u),a),t.__v=n.__v,t.__.__k[t.__i]=t,ax(o,t,a),n.__e=n.__=null,t.__e!=i&&rx(t)));vd.__r=0}function ix(r,e,t,n,i,o,a,l,u,d,f){var h,g,y,w,x,b,_,S=n&&n.__k||nx,k=e.length;for(u=wB(t,e,S,u,k),h=0;h<k;h++)(y=t.__k[h])!=null&&(g=y.__i==-1?Ml:S[y.__i]||Ml,y.__i=h,b=zv(r,y,g,i,o,a,l,u,d,f),w=y.__e,y.ref&&g.ref!=y.ref&&(g.ref&&Wv(g.ref,null,y),f.push(y.ref,y.__c||w,y)),x==null&&w!=null&&(x=w),(_=!!(4&y.__u))||g.__k===y.__k?u=ox(y,u,r,_):typeof y.type=="function"&&b!==void 0?u=b:w&&(u=w.nextSibling),y.__u&=-7);return t.__e=x,u}function wB(r,e,t,n,i){var o,a,l,u,d,f=t.length,h=f,g=0;for(r.__k=new Array(i),o=0;o<i;o++)(a=e[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(u=o+g,(a=r.__k[o]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?sd(null,a,null,null,null):Zl(a)?sd(ns,{children:a},null,null,null):a.constructor==null&&a.__b>0?sd(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=r,a.__b=r.__b+1,l=null,(d=a.__i=SB(a,t,u,h))!=-1&&(h--,(l=t[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(i>f?g--:i<f&&g++),typeof a.type!="function"&&(a.__u|=4)):d!=u&&(d==u-1?g--:d==u+1?g++:(d>u?g--:g++,a.__u|=4))):r.__k[o]=null;if(h)for(o=0;o<f;o++)(l=t[o])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=rs(l)),lx(l,l));return n}function ox(r,e,t,n){var i,o;if(typeof r.type=="function"){for(i=r.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=r,e=ox(i[o],e,t,n));return e}r.__e!=e&&(n&&(e&&r.type&&!e.parentNode&&(e=rs(r)),t.insertBefore(r.__e,e||null)),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function gd(r,e){return e=e||[],r==null||typeof r=="boolean"||(Zl(r)?r.some(function(t){gd(t,e)}):e.push(r)),e}function SB(r,e,t,n){var i,o,a,l=r.key,u=r.type,d=e[t],f=d!=null&&(2&d.__u)==0;if(d===null&&r.key==null||f&&l==d.key&&u==d.type)return t;if(n>(f?1:0)){for(i=t-1,o=t+1;i>=0||o<e.length;)if((d=e[a=i>=0?i--:o++])!=null&&(2&d.__u)==0&&l==d.key&&u==d.type)return a}return-1}function My(r,e,t){e[0]=="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||xB.test(e)?t:t+"px"}function Iu(r,e,t,n,i){var o,a;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||My(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||My(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(tx,"$1")),a=e.toLowerCase(),e=a in r||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+o]=t,t?n?t.u=n.u:(t.u=$v,r.addEventListener(e,o?Cp:Ep,o)):r.removeEventListener(e,o?Cp:Ep,o);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function Ay(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=$v++;else if(e.t<t.u)return;return t(Xt.event?Xt.event(e):e)}}}function zv(r,e,t,n,i,o,a,l,u,d){var f,h,g,y,w,x,b,_,S,k,O,M,R,T,I,$,ne,V=e.type;if(e.constructor!=null)return null;128&t.__u&&(u=!!(32&t.__u),o=[l=e.__e=t.__e]),(f=Xt.__b)&&f(e);e:if(typeof V=="function")try{if(_=e.props,S="prototype"in V&&V.prototype.render,k=(f=V.contextType)&&n[f.__c],O=f?k?k.props.value:f.__:n,t.__c?b=(h=e.__c=t.__c).__=h.__E:(S?e.__c=h=new V(_,O):(e.__c=h=new Yt(_,O),h.constructor=V,h.render=CB),k&&k.sub(h),h.props=_,h.state||(h.state={}),h.context=O,h.__n=n,g=h.__d=!0,h.__h=[],h._sb=[]),S&&h.__s==null&&(h.__s=h.state),S&&V.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=oo({},h.__s)),oo(h.__s,V.getDerivedStateFromProps(_,h.__s))),y=h.props,w=h.state,h.__v=e,g)S&&V.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),S&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(S&&V.getDerivedStateFromProps==null&&_!==y&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(_,O),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(_,h.__s,O)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(h.props=_,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(J){J&&(J.__=e)}),M=0;M<h._sb.length;M++)h.__h.push(h._sb[M]);h._sb=[],h.__h.length&&a.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(_,h.__s,O),S&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(y,w,x)})}if(h.context=O,h.props=_,h.__P=r,h.__e=!1,R=Xt.__r,T=0,S){for(h.state=h.__s,h.__d=!1,R&&R(e),f=h.render(h.props,h.state,h.context),I=0;I<h._sb.length;I++)h.__h.push(h._sb[I]);h._sb=[]}else do h.__d=!1,R&&R(e),f=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++T<25);h.state=h.__s,h.getChildContext!=null&&(n=oo(oo({},n),h.getChildContext())),S&&!g&&h.getSnapshotBeforeUpdate!=null&&(x=h.getSnapshotBeforeUpdate(y,w)),$=f,f!=null&&f.type===ns&&f.key==null&&($=sx(f.props.children)),l=ix(r,Zl($)?$:[$],e,t,n,i,o,a,l,u,d),h.base=e.__e,e.__u&=-161,h.__h.length&&a.push(h),b&&(h.__E=h.__=null)}catch(J){if(e.__v=null,u||o!=null)if(J.then){for(e.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,e.__e=l}else{for(ne=o.length;ne--;)Fv(o[ne]);kp(e)}else e.__e=t.__e,e.__k=t.__k,J.then||kp(e);Xt.__e(J,e,t)}else o==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):l=e.__e=EB(t.__e,e,t,n,i,o,a,u,d);return(f=Xt.diffed)&&f(e),128&e.__u?void 0:l}function kp(r){r&&r.__c&&(r.__c.__e=!0),r&&r.__k&&r.__k.forEach(kp)}function ax(r,e,t){for(var n=0;n<t.length;n++)Wv(t[n],t[++n],t[++n]);Xt.__c&&Xt.__c(e,r),r.some(function(i){try{r=i.__h,i.__h=[],r.some(function(o){o.call(i)})}catch(o){Xt.__e(o,i.__v)}})}function sx(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Zl(r)?r.map(sx):oo({},r)}function EB(r,e,t,n,i,o,a,l,u){var d,f,h,g,y,w,x,b=t.props,_=e.props,S=e.type;if(S=="svg"?i="http://www.w3.org/2000/svg":S=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(d=0;d<o.length;d++)if((y=o[d])&&"setAttribute"in y==!!S&&(S?y.localName==S:y.nodeType==3)){r=y,o[d]=null;break}}if(r==null){if(S==null)return document.createTextNode(_);r=document.createElementNS(i,S,_.is&&_),l&&(Xt.__m&&Xt.__m(e,o),l=!1),o=null}if(S==null)b===_||l&&r.data==_||(r.data=_);else{if(o=o&&vc.call(r.childNodes),b=t.props||Ml,!l&&o!=null)for(b={},d=0;d<r.attributes.length;d++)b[(y=r.attributes[d]).name]=y.value;for(d in b)if(y=b[d],d!="children"){if(d=="dangerouslySetInnerHTML")h=y;else if(!(d in _)){if(d=="value"&&"defaultValue"in _||d=="checked"&&"defaultChecked"in _)continue;Iu(r,d,null,y,i)}}for(d in _)y=_[d],d=="children"?g=y:d=="dangerouslySetInnerHTML"?f=y:d=="value"?w=y:d=="checked"?x=y:l&&typeof y!="function"||b[d]===y||Iu(r,d,y,b[d],i);if(f)l||h&&(f.__html==h.__html||f.__html==r.innerHTML)||(r.innerHTML=f.__html),e.__k=[];else if(h&&(r.innerHTML=""),ix(e.type=="template"?r.content:r,Zl(g)?g:[g],e,t,n,S=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,a,o?o[0]:t.__k&&rs(t,0),l,u),o!=null)for(d=o.length;d--;)Fv(o[d]);l||(d="value",S=="progress"&&w==null?r.removeAttribute("value"):w!=null&&(w!==r[d]||S=="progress"&&!w||S=="option"&&w!=b[d])&&Iu(r,d,w,b[d],i),d="checked",x!=null&&x!=r[d]&&Iu(r,d,x,b[d],i))}return r}function Wv(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(i){Xt.__e(i,t)}}function lx(r,e,t){var n,i;if(Xt.unmount&&Xt.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||Wv(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){Xt.__e(o,e)}n.base=n.__P=null}if(n=r.__k)for(i=0;i<n.length;i++)n[i]&&lx(n[i],e,t||typeof r.type!="function");t||Fv(r.__e),r.__c=r.__=r.__e=void 0}function CB(r,e,t){return this.constructor(r,t)}function kB(r,e,t){var n,i,o,a;e==document&&(e=document.documentElement),Xt.__&&Xt.__(r,e),i=(n=!1)?null:e.__k,o=[],a=[],zv(e,r=e.__k=wt(ns,null,[r]),i||Ml,Ml,e.namespaceURI,i?null:e.firstChild?vc.call(e.childNodes):null,o,i?i.__e:e.firstChild,n,a),ax(o,r,a)}vc=nx.slice,Xt={__e:function(r,e,t,n){for(var i,o,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(r)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(r,n||{}),a=i.__d),a)return i.__E=i}catch(l){r=l}throw r}},Z1=0,Yt.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=oo({},this.state),typeof r=="function"&&(r=r(oo({},t),this.props)),r&&oo(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),Ny(this))},Yt.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Ny(this))},Yt.prototype.render=ns,Qo=[],Q1=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ex=function(r,e){return r.__v.__b-e.__v.__b},vd.__r=0,tx=/(PointerCapture)$|Capture$/i,$v=0,Ep=Ay(!1),Cp=Ay(!0);var OB="An invariant failed, however the error is obfuscated because this is a production build.",md=[];Object.freeze(md);var Uv={};Object.freeze(Uv);function Br(){return++Ot.mobxGuid}function an(r){throw oa(!1,r),"X"}function oa(r,e){if(!r)throw new Error("[mobx] "+(e||OB))}function ux(r){var e=!1;return function(){if(!e)return e=!0,r.apply(this,arguments)}}var Bu=function(){};function NB(r){var e=[];return r.forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),e}function Vv(r){return r!==null&&typeof r=="object"}function Es(r){if(r===null||typeof r!="object")return!1;var e=Object.getPrototypeOf(r);return e===Object.prototype||e===null}function MB(r){if(ks(r)||Fr(r))return r;if(Array.isArray(r))return new Map(r);if(Es(r)){var e=new Map;for(var t in r)e.set(t,r[t]);return e}else return an("Cannot convert to map from '"+r+"'")}function Cs(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!0,configurable:!0,value:t})}function AB(r,e,t){Object.defineProperty(r,e,{enumerable:!1,writable:!1,configurable:!0,value:t})}function TB(r,e){var t=Object.getOwnPropertyDescriptor(r,e);return!t||t.configurable!==!1&&t.writable!==!1}function Po(r,e){var t="isMobX"+r;return e.prototype[t]=!0,function(n){return Vv(n)&&n[t]===!0}}function ks(r){return r instanceof Map}function Ql(r){return r instanceof Set}function dx(r){var e=new Set;for(var t in r)e.add(t);return Object.getOwnPropertySymbols(r).forEach(function(n){Object.getOwnPropertyDescriptor(r,n).enumerable&&e.add(n)}),Array.from(e)}function Co(r){return r&&r.toString?r.toString():new String(r).toString()}function cx(r){return r===null?null:typeof r=="object"?""+r:r}var DB=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames,$t=Symbol("mobx administration"),Os=function(){function r(e){e===void 0&&(e="Atom@"+Br()),this.name=e,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=ln.NOT_TRACKING}return r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.reportObserved=function(){return wx(this)},r.prototype.reportChanged=function(){Si(),e4(this),Ei()},r.prototype.toString=function(){return this.name},r}(),qv=Po("Atom",Os);function Xv(r,e,t){e===void 0&&(e=Bu),t===void 0&&(t=Bu);var n=new Os(r);return e!==Bu&&h4(n,e),t!==Bu&&Nx(n,t),n}function LB(r,e){return jx(r,e)}function PB(r,e){return Object.is(r,e)}var is={structural:LB,default:PB};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Op=function(r,e){return Op=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Op(r,e)};function RB(r,e){Op(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var yd=function(){return yd=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},yd.apply(this,arguments)};function Wi(r){var e=typeof Symbol=="function"&&r[Symbol.iterator],t=0;return e?e.call(r):{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}}}function Xa(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o}function Gv(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Xa(arguments[e]));return r}var _d=Symbol("mobx did run lazy initializers"),ll=Symbol("mobx pending decorators"),IB={},BB={};function jB(r,e){var t=e?IB:BB;return t[r]||(t[r]={configurable:!0,enumerable:e,get:function(){return ua(this),this[r]},set:function(n){ua(this),this[r]=n}})}function ua(r){var e,t;if(r[_d]!==!0){var n=r[ll];if(n){Cs(r,_d,!0);var i=Gv(Object.getOwnPropertySymbols(n),Object.keys(n));try{for(var o=Wi(i),a=o.next();!a.done;a=o.next()){var l=a.value,u=n[l];u.propertyCreator(r,u.prop,u.descriptor,u.decoratorTarget,u.decoratorArguments)}}catch(d){e={error:d}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}}}function fx(r,e){return function(){var n,i=function(a,l,u,d){if(d===!0)return e(a,l,u,a,n),null;if(!Object.prototype.hasOwnProperty.call(a,ll)){var f=a[ll];Cs(a,ll,yd({},f))}return a[ll][l]={prop:l,propertyCreator:e,descriptor:u,decoratorTarget:a,decoratorArguments:n},jB(l,r)};return HB(arguments)?(n=md,i.apply(null,arguments)):(n=Array.prototype.slice.call(arguments),i)}}function HB(r){return(r.length===2||r.length===3)&&(typeof r[1]=="string"||typeof r[1]=="symbol")||r.length===4&&r[3]===!0}function eu(r,e,t){return ls(r)?r:Array.isArray(r)?De.array(r,{name:t}):Es(r)?De.object(r,void 0,{name:t}):ks(r)?De.map(r,{name:t}):Ql(r)?De.set(r,{name:t}):r}function $B(r,e,t){return r==null||Li(r)||Ki(r)||Fr(r)||si(r)?r:Array.isArray(r)?De.array(r,{name:t,deep:!1}):Es(r)?De.object(r,void 0,{name:t,deep:!1}):ks(r)?De.map(r,{name:t,deep:!1}):Ql(r)?De.set(r,{name:t,deep:!1}):an(!1)}function mc(r){return r}function FB(r,e,t){return jx(r,e)?e:r}function yc(r){oa(r);var e=fx(!0,function(n,i,o,a,l){var u=o?o.initializer?o.initializer.call(n):o.value:void 0;Qv(n).addObservableProp(i,u,r)}),t=e;return t.enhancer=r,t}var hx={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(hx);function Ua(r){return r==null?hx:typeof r=="string"?{name:r,deep:!0,proxy:!0}:r}var Yv=yc(eu),zB=yc($B),px=yc(mc),WB=yc(FB);function ju(r){return r.defaultDecorator?r.defaultDecorator.enhancer:r.deep===!1?mc:eu}function UB(r,e,t){if(typeof arguments[1]=="string"||typeof arguments[1]=="symbol")return Yv.apply(null,arguments);if(ls(r))return r;var n=Es(r)?De.object(r,e,t):Array.isArray(r)?De.array(r,e):ks(r)?De.map(r,e):Ql(r)?De.set(r,e):r;if(n!==r)return n;an(!1)}var Ty={box:function(r,e){arguments.length>2&&il("box");var t=Ua(e);return new sa(r,ju(t),t.name,!0,t.equals)},array:function(r,e){arguments.length>2&&il("array");var t=Ua(e);return N4(r,ju(t),t.name)},map:function(r,e){arguments.length>2&&il("map");var t=Ua(e);return new Zv(r,ju(t),t.name)},set:function(r,e){arguments.length>2&&il("set");var t=Ua(e);return new Ix(r,ju(t),t.name)},object:function(r,e,t){typeof arguments[1]=="string"&&il("object");var n=Ua(t);if(n.proxy===!1)return Lp({},r,e,n);var i=Ax(n),o=Lp({},void 0,void 0,n),a=C4(o);return Tx(a,r,e,i),a},ref:px,shallow:zB,deep:Yv,struct:WB},De=UB;Object.keys(Ty).forEach(function(r){return De[r]=Ty[r]});function il(r){an("Expected one or two arguments to observable."+r+". Did you accidentally try to use observable."+r+" as decorator?")}var bd=fx(!1,function(r,e,t,n,i){var o=t.get,a=t.set,l=i[0]||{};Qv(r).addComputedProp(r,e,yd({get:o,set:a,context:r},l))}),VB=bd({equals:is.structural}),fn=function(e,t,n){if(typeof t=="string"||e!==null&&typeof e=="object"&&arguments.length===1)return bd.apply(null,arguments);var i=typeof t=="object"?t:{};return i.get=e,i.set=typeof t=="function"?t:i.set,i.name=i.name||e.name||"",new as(i)};fn.struct=VB;var ln;(function(r){r[r.NOT_TRACKING=-1]="NOT_TRACKING",r[r.UP_TO_DATE=0]="UP_TO_DATE",r[r.POSSIBLY_STALE=1]="POSSIBLY_STALE",r[r.STALE=2]="STALE"})(ln||(ln={}));var Ui;(function(r){r[r.NONE=0]="NONE",r[r.LOG=1]="LOG",r[r.BREAK=2]="BREAK"})(Ui||(Ui={}));var xd=function(){function r(e){this.cause=e}return r}();function ul(r){return r instanceof xd}function Np(r){switch(r.dependenciesState){case ln.UP_TO_DATE:return!1;case ln.NOT_TRACKING:case ln.STALE:return!0;case ln.POSSIBLY_STALE:{for(var e=Kv(!0),t=Ns(),n=r.observing,i=n.length,o=0;o<i;o++){var a=n[o];if(ss(a)){if(Ot.disableErrorBoundaries)a.get();else try{a.get()}catch{return Oo(t),hl(e),!0}if(r.dependenciesState===ln.STALE)return Oo(t),hl(e),!0}}return mx(r),Oo(t),hl(e),!1}}}function os(r){var e=r.observers.size>0;Ot.computationDepth>0&&e&&an(!1),!Ot.allowStateChanges&&(e||Ot.enforceActions==="strict")&&an(!1)}function vx(r,e,t){var n=Kv(!0);mx(r),r.newObserving=new Array(r.observing.length+100),r.unboundDepsCount=0,r.runId=++Ot.runId;var i=Ot.trackingDerivation;Ot.trackingDerivation=r;var o;if(Ot.disableErrorBoundaries===!0)o=e.call(t);else try{o=e.call(t)}catch(a){o=new xd(a)}return Ot.trackingDerivation=i,qB(r),hl(n),o}function qB(r){for(var e=r.observing,t=r.observing=r.newObserving,n=ln.UP_TO_DATE,i=0,o=r.unboundDepsCount,a=0;a<o;a++){var l=t[a];l.diffValue===0&&(l.diffValue=1,i!==a&&(t[i]=l),i++),l.dependenciesState>n&&(n=l.dependenciesState)}for(t.length=i,r.newObserving=null,o=e.length;o--;){var l=e[o];l.diffValue===0&&bx(l,r),l.diffValue=0}for(;i--;){var l=t[i];l.diffValue===1&&(l.diffValue=0,QB(l,r))}n!==ln.UP_TO_DATE&&(r.dependenciesState=n,r.onBecomeStale())}function Mp(r){var e=r.observing;r.observing=[];for(var t=e.length;t--;)bx(e[t],r);r.dependenciesState=ln.NOT_TRACKING}function gx(r){var e=Ns();try{return r()}finally{Oo(e)}}function Ns(){var r=Ot.trackingDerivation;return Ot.trackingDerivation=null,r}function Oo(r){Ot.trackingDerivation=r}function Kv(r){var e=Ot.allowStateReads;return Ot.allowStateReads=r,e}function hl(r){Ot.allowStateReads=r}function mx(r){if(r.dependenciesState!==ln.UP_TO_DATE){r.dependenciesState=ln.UP_TO_DATE;for(var e=r.observing,t=e.length;t--;)e[t].lowestObserverState=ln.UP_TO_DATE}}var wd=0,XB=1,Dy=Object.getOwnPropertyDescriptor(function(){},"name");Dy&&Dy.configurable;function aa(r,e,t){var n=function(){return yx(r,e,t||this,arguments)};return n.isMobxAction=!0,n}function yx(r,e,t,n){var i=GB();try{return e.apply(t,n)}catch(o){throw i.error=o,o}finally{YB(i)}}function GB(r,e,t){var n=oi(),i=0,o=Ns();Si();var a=_c(!0),l=Kv(!0),u={prevDerivation:o,prevAllowStateChanges:a,prevAllowStateReads:l,notifySpy:n,startTime:i,actionId:XB++,parentActionId:wd};return wd=u.actionId,u}function YB(r){wd!==r.actionId&&an("invalid action stack. did you forget to finish an action?"),wd=r.parentActionId,r.error!==void 0&&(Ot.suppressReactionErrors=!0),bc(r.prevAllowStateChanges),hl(r.prevAllowStateReads),Ei(),Oo(r.prevDerivation),r.notifySpy,Ot.suppressReactionErrors=!1}function _c(r){var e=Ot.allowStateChanges;return Ot.allowStateChanges=r,e}function bc(r){Ot.allowStateChanges=r}var sa=function(r){RB(e,r);function e(t,n,i,o,a){i===void 0&&(i="ObservableValue@"+Br()),a===void 0&&(a=is.default);var l=r.call(this,i)||this;return l.enhancer=n,l.name=i,l.equals=a,l.hasUnreportedChange=!1,l.value=n(t,void 0,i),l}return e.prototype.dehanceValue=function(t){return this.dehancer!==void 0?this.dehancer(t):t},e.prototype.set=function(t){this.value,t=this.prepareNewValue(t),t!==Ot.UNCHANGED&&this.setNewValue(t)},e.prototype.prepareNewValue=function(t){if(os(this),Vi(this)){var n=qi(this,{object:this,type:"update",newValue:t});if(!n)return Ot.UNCHANGED;t=n.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?Ot.UNCHANGED:t},e.prototype.setNewValue=function(t){var n=this.value;this.value=t,this.reportChanged(),Ci(this)&&ki(this,{type:"update",object:this,newValue:t,oldValue:n})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return tu(this,t)},e.prototype.observe=function(t,n){return n&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),nu(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return cx(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e}(Os),KB=Po("ObservableValue",sa),as=function(){function r(e){this.dependenciesState=ln.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=ln.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+Br(),this.value=new xd(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=Ui.NONE,oa(e.get,"missing option for computed: get"),this.derivation=e.get,this.name=e.name||"ComputedValue@"+Br(),e.set&&(this.setter=aa(this.name+"-setter",e.set)),this.equals=e.equals||(e.compareStructural||e.struct?is.structural:is.default),this.scope=e.context,this.requiresReaction=!!e.requiresReaction,this.keepAlive=!!e.keepAlive}return r.prototype.onBecomeStale=function(){n4(this)},r.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach(function(e){return e()})},r.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach(function(e){return e()})},r.prototype.get=function(){this.isComputing&&an("Cycle detected in computation "+this.name+": "+this.derivation),Ot.inBatch===0&&this.observers.size===0&&!this.keepAlive?Np(this)&&(this.warnAboutUntrackedRead(),Si(),this.value=this.computeValue(!1),Ei()):(wx(this),Np(this)&&this.trackAndCompute()&&t4(this));var e=this.value;if(ul(e))throw e.cause;return e},r.prototype.peek=function(){var e=this.computeValue(!1);if(ul(e))throw e.cause;return e},r.prototype.set=function(e){if(this.setter){oa(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=!1}}else oa(!1,!1)},r.prototype.trackAndCompute=function(){var e=this.value,t=this.dependenciesState===ln.NOT_TRACKING,n=this.computeValue(!0),i=t||ul(e)||ul(n)||!this.equals(e,n);return i&&(this.value=n),i},r.prototype.computeValue=function(e){this.isComputing=!0,Ot.computationDepth++;var t;if(e)t=vx(this,this.derivation,this.scope);else if(Ot.disableErrorBoundaries===!0)t=this.derivation.call(this.scope);else try{t=this.derivation.call(this.scope)}catch(n){t=new xd(n)}return Ot.computationDepth--,this.isComputing=!1,t},r.prototype.suspend=function(){this.keepAlive||(Mp(this),this.value=void 0)},r.prototype.observe=function(e,t){var n=this,i=!0,o=void 0;return d4(function(){var a=n.get();if(!i||t){var l=Ns();e({type:"update",object:n,newValue:a,oldValue:o}),Oo(l)}i=!1,o=a})},r.prototype.warnAboutUntrackedRead=function(){},r.prototype.toJSON=function(){return this.get()},r.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},r.prototype.valueOf=function(){return cx(this.get())},r.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},r}(),ss=Po("ComputedValue",as),ld=function(){function r(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1}return r}(),JB={};function Ap(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:JB}var ud=!0,_x=!1,Ot=function(){var r=Ap();return r.__mobxInstanceCount>0&&!r.__mobxGlobals&&(ud=!1),r.__mobxGlobals&&r.__mobxGlobals.version!==new ld().version&&(ud=!1),ud?r.__mobxGlobals?(r.__mobxInstanceCount+=1,r.__mobxGlobals.UNCHANGED||(r.__mobxGlobals.UNCHANGED={}),r.__mobxGlobals):(r.__mobxInstanceCount=1,r.__mobxGlobals=new ld):(setTimeout(function(){_x||an("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")},1),new ld)}();function ZB(){(Ot.pendingReactions.length||Ot.inBatch||Ot.isRunningReactions)&&an("isolateGlobalState should be called before MobX is running any reactions"),_x=!0,ud&&(--Ap().__mobxInstanceCount===0&&(Ap().__mobxGlobals=void 0),Ot=new ld)}function Tp(){return Ot}function QB(r,e){r.observers.add(e),r.lowestObserverState>e.dependenciesState&&(r.lowestObserverState=e.dependenciesState)}function bx(r,e){r.observers.delete(e),r.observers.size===0&&xx(r)}function xx(r){r.isPendingUnobservation===!1&&(r.isPendingUnobservation=!0,Ot.pendingUnobservations.push(r))}function Si(){Ot.inBatch++}function Ei(){if(--Ot.inBatch===0){Cx();for(var r=Ot.pendingUnobservations,e=0;e<r.length;e++){var t=r[e];t.isPendingUnobservation=!1,t.observers.size===0&&(t.isBeingObserved&&(t.isBeingObserved=!1,t.onBecomeUnobserved()),t instanceof as&&t.suspend())}Ot.pendingUnobservations=[]}}function wx(r){var e=Ot.trackingDerivation;return e!==null?(e.runId!==r.lastAccessedBy&&(r.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=r,r.isBeingObserved||(r.isBeingObserved=!0,r.onBecomeObserved())),!0):(r.observers.size===0&&Ot.inBatch>0&&xx(r),!1)}function e4(r){r.lowestObserverState!==ln.STALE&&(r.lowestObserverState=ln.STALE,r.observers.forEach(function(e){e.dependenciesState===ln.UP_TO_DATE&&(e.isTracing!==Ui.NONE&&Sx(e,r),e.onBecomeStale()),e.dependenciesState=ln.STALE}))}function t4(r){r.lowestObserverState!==ln.STALE&&(r.lowestObserverState=ln.STALE,r.observers.forEach(function(e){e.dependenciesState===ln.POSSIBLY_STALE?e.dependenciesState=ln.STALE:e.dependenciesState===ln.UP_TO_DATE&&(r.lowestObserverState=ln.UP_TO_DATE)}))}function n4(r){r.lowestObserverState===ln.UP_TO_DATE&&(r.lowestObserverState=ln.POSSIBLY_STALE,r.observers.forEach(function(e){e.dependenciesState===ln.UP_TO_DATE&&(e.dependenciesState=ln.POSSIBLY_STALE,e.isTracing!==Ui.NONE&&Sx(e,r),e.onBecomeStale())}))}function Sx(r,e){if(""+r.name+e.name,r.isTracing===Ui.BREAK){var t=[];Ex(v4(r),t,1),new Function(`debugger;
/*
Tracing '`+r.name+`'

You are entering this break point because derivation '`+r.name+"' is being traced and '"+e.name+`' is now forcing it to update.
Just follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update
The stackframe you are looking for is at least ~6-8 stack-frames up.

`+(r instanceof as?r.derivation.toString().replace(/[*]\//g,"/"):"")+`

The dependencies for this derivation are:

`+t.join(`
`)+`
*/
    `)()}}function Ex(r,e,t){if(e.length>=1e3){e.push("(and many more)");return}e.push(""+new Array(t).join("	")+r.name),r.dependencies&&r.dependencies.forEach(function(n){return Ex(n,e,t+1)})}var Al=function(){function r(e,t,n,i){e===void 0&&(e="Reaction@"+Br()),i===void 0&&(i=!1),this.name=e,this.onInvalidate=t,this.errorHandler=n,this.requiresObservable=i,this.observing=[],this.newObserving=[],this.dependenciesState=ln.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+Br(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=Ui.NONE}return r.prototype.onBecomeStale=function(){this.schedule()},r.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,Ot.pendingReactions.push(this),Cx())},r.prototype.isScheduled=function(){return this._isScheduled},r.prototype.runReaction=function(){if(!this.isDisposed){if(Si(),this._isScheduled=!1,Np(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending&&oi()}catch(e){this.reportExceptionInDerivation(e)}}Ei()}},r.prototype.track=function(e){if(!this.isDisposed){Si(),this._isRunning=!0;var t=vx(this,e,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&Mp(this),ul(t)&&this.reportExceptionInDerivation(t.cause),Ei()}},r.prototype.reportExceptionInDerivation=function(e){var t=this;if(this.errorHandler){this.errorHandler(e,this);return}if(Ot.disableErrorBoundaries)throw e;var n="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";Ot.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(n,e),Ot.globalReactionErrorHandlers.forEach(function(i){return i(e,t)})},r.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(Si(),Mp(this),Ei()))},r.prototype.getDisposer=function(){var e=this.dispose.bind(this);return e[$t]=this,e},r.prototype.toString=function(){return"Reaction["+this.name+"]"},r.prototype.trace=function(e){e===void 0&&(e=!1),w4(this,e)},r}(),Ly=100,Dp=function(r){return r()};function Cx(){Ot.inBatch>0||Ot.isRunningReactions||Dp(r4)}function r4(){Ot.isRunningReactions=!0;for(var r=Ot.pendingReactions,e=0;r.length>0;){++e===Ly&&(console.error("Reaction doesn't converge to a stable state after "+Ly+" iterations."+(" Probably there is a cycle in the reactive function: "+r[0])),r.splice(0));for(var t=r.splice(0),n=0,i=t.length;n<i;n++)t[n].runReaction()}Ot.isRunningReactions=!1}var Sd=Po("Reaction",Al);function i4(r){var e=Dp;Dp=function(t){return r(function(){return e(t)})}}function oi(){return!1}function o4(r){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function a4(){an(!1)}function Py(r){return function(e,t,n){if(n){if(n.value)return{value:aa(r,n.value),enumerable:!1,configurable:!0,writable:!0};var i=n.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return aa(r,i.call(this))}}}return s4(r).apply(this,arguments)}}function s4(r){return function(e,t,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:function(){},set:function(i){Cs(this,t,Ae(r,i))}})}}function l4(r,e,t,n){return n===!0?(Of(r,e,t.value),null):t?{configurable:!0,enumerable:!1,get:function(){return Of(this,e,t.value||t.initializer.call(this)),this[e]},set:a4}:{enumerable:!1,configurable:!0,set:function(i){Of(this,e,i)},get:function(){}}}var Ae=function(e,t,n,i){if(arguments.length===1&&typeof e=="function")return aa(e.name||"<unnamed action>",e);if(arguments.length===2&&typeof t=="function")return aa(e,t);if(arguments.length===1&&typeof e=="string")return Py(e);if(i===!0)Cs(e,t,aa(e.name||t,n.value,this));else return Py(t).apply(null,arguments)};Ae.bound=l4;function u4(r,e){var t=typeof r=="string"?r:r.name||"<unnamed action>",n=typeof r=="function"?r:e;return yx(t,n,this,void 0)}function Of(r,e,t){Cs(r,e,aa(e,t.bind(r)))}function d4(r,e){e===void 0&&(e=Uv);var t=e&&e.name||r.name||"Autorun@"+Br(),n=!e.scheduler&&!e.delay,i;if(n)i=new Al(t,function(){this.track(l)},e.onError,e.requiresObservable);else{var o=kx(e),a=!1;i=new Al(t,function(){a||(a=!0,o(function(){a=!1,i.isDisposed||i.track(l)}))},e.onError,e.requiresObservable)}function l(){r(i)}return i.schedule(),i.getDisposer()}var c4=function(r){return r()};function kx(r){return r.scheduler?r.scheduler:r.delay?function(e){return setTimeout(e,r.delay)}:c4}function Ox(r,e,t){t===void 0&&(t=Uv);var n=t.name||"Reaction@"+Br(),i=Ae(n,t.onError?f4(t.onError,e):e),o=!t.scheduler&&!t.delay,a=kx(t),l=!0,u=!1,d,f=t.compareStructural?is.structural:t.equals||is.default,h=new Al(n,function(){l||o?g():u||(u=!0,a(g))},t.onError,t.requiresObservable);function g(){if(u=!1,!h.isDisposed){var y=!1;h.track(function(){var w=r(h);y=l||!f(d,w),d=w}),l&&t.fireImmediately&&i(d,h),!l&&y===!0&&i(d,h),l&&(l=!1)}}return h.schedule(),h.getDisposer()}function f4(r,e){return function(){try{return e.apply(this,arguments)}catch(t){r.call(this,t)}}}function h4(r,e,t){return Mx("onBecomeObserved",r,e)}function Nx(r,e,t){return Mx("onBecomeUnobserved",r,e)}function Mx(r,e,t,n){var i=Ao(e),o=t,a=r+"Listeners";i[a]?i[a].add(o):i[a]=new Set([o]);var l=i[r];return typeof l!="function"?an(!1):function(){var u=i[a];u&&(u.delete(o),u.size===0&&delete i[a])}}function p4(r){var e=r.enforceActions,t=r.computedRequiresReaction,n=r.computedConfigurable,i=r.disableErrorBoundaries,o=r.reactionScheduler,a=r.reactionRequiresObservable,l=r.observableRequiresReaction;if(ZB(),e!==void 0){var u=void 0;switch(e){case!0:case"observed":u=!0;break;case!1:case"never":u=!1;break;case"strict":case"always":u="strict";break;default:an("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}Ot.enforceActions=u,Ot.allowStateChanges=!(u===!0||u==="strict")}t!==void 0&&(Ot.computedRequiresReaction=!!t),a!==void 0&&(Ot.reactionRequiresObservable=!!a),l!==void 0&&(Ot.observableRequiresReaction=!!l,Ot.allowStateReads=!Ot.observableRequiresReaction),n!==void 0&&(Ot.computedConfigurable=!!n),i!==void 0&&(i===!0&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),Ot.disableErrorBoundaries=!!i),o&&i4(o)}function Lp(r,e,t,n){n=Ua(n);var i=Ax(n);return ua(r),Qv(r,n.name,i.enhancer),e&&Tx(r,e,t,i),r}function Ax(r){return r.defaultDecorator||(r.deep===!1?px:Yv)}function Tx(r,e,t,n){var i,o,a,l,u,d;Si();try{var a=DB(e);try{for(var f=Wi(a),h=f.next();!h.done;h=f.next()){var d=h.value,g=Object.getOwnPropertyDescriptor(e,d),y=t&&d in t?t[d]:g.get?bd:n,w=y(r,d,g,!0);w&&Object.defineProperty(r,d,w)}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}finally{Ei()}}function v4(r,e){return Dx(Ao(r,e))}function Dx(r){var e={name:r.name};return r.observing&&r.observing.length>0&&(e.dependencies=NB(r.observing).map(Dx)),e}function Lx(r,e){if(r==null)return!1;if(e!==void 0){if(Li(r)===!1||!r[$t].values.has(e))return!1;var t=Ao(r,e);return ss(t)}return ss(r)}function g4(r){return arguments.length>1?an(!1):Lx(r)}function Ry(r,e){return typeof e!="string"?an(!1):Lx(r,e)}function m4(r,e){return r==null?!1:Li(r)||!!r[$t]||qv(r)||Sd(r)||ss(r)}function ls(r){return arguments.length!==1&&an(!1),m4(r)}function us(r){return Li(r)?r[$t].getKeys():Fr(r)||si(r)?Array.from(r.keys()):Ki(r)?r.map(function(e,t){return t}):an(!1)}function y4(r){return Li(r)?us(r).map(function(e){return r[e]}):Fr(r)?us(r).map(function(e){return r.get(e)}):si(r)?Array.from(r.values()):Ki(r)?r.slice():an(!1)}function _4(r){return Li(r)?us(r).map(function(e){return[e,r[e]]}):Fr(r)?us(r).map(function(e){return[e,r.get(e)]}):si(r)?Array.from(r.entries()):Ki(r)?r.map(function(e,t){return[t,e]}):an(!1)}function Jv(r,e,t){if(arguments.length===2&&!si(r)){Si();var n=e;try{for(var i in n)Jv(r,i,n[i])}finally{Ei()}return}if(Li(r)){var o=r[$t],a=o.values.get(e);a?o.write(e,t):o.addObservableProp(e,t,o.defaultEnhancer)}else if(Fr(r))r.set(e,t);else if(si(r))r.add(e);else if(Ki(r))typeof e!="number"&&(e=parseInt(e,10)),oa(e>=0,"Not a valid index: '"+e+"'"),Si(),e>=r.length&&(r.length=e+1),r[e]=t,Ei();else return an(!1)}function Px(r,e,t,n){return b4(r,e,t)}function b4(r,e,t){return xc(r).observe(e,t)}var x4={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Ba(r,e,t,n){return n.detectCycles&&r.set(e,t),t}function xo(r,e,t){if(!e.recurseEverything&&!ls(r)||typeof r!="object")return r;if(r===null)return null;if(r instanceof Date)return r;if(KB(r))return xo(r.get(),e,t);ls(r)&&us(r);var n=e.detectCycles===!0;if(n&&r!==null&&t.has(r))return t.get(r);if(Ki(r)||Array.isArray(r)){var i=Ba(t,r,[],e),o=r.map(function(y){return xo(y,e,t)});i.length=o.length;for(var a=0,l=o.length;a<l;a++)i[a]=o[a];return i}if(si(r)||Object.getPrototypeOf(r)===Set.prototype)if(e.exportMapsAsObjects===!1){var u=Ba(t,r,new Set,e);return r.forEach(function(y){u.add(xo(y,e,t))}),u}else{var d=Ba(t,r,[],e);return r.forEach(function(y){d.push(xo(y,e,t))}),d}if(Fr(r)||Object.getPrototypeOf(r)===Map.prototype)if(e.exportMapsAsObjects===!1){var f=Ba(t,r,new Map,e);return r.forEach(function(y,w){f.set(w,xo(y,e,t))}),f}else{var h=Ba(t,r,{},e);return r.forEach(function(y,w){h[w]=xo(y,e,t)}),h}var g=Ba(t,r,{},e);return dx(r).forEach(function(y){g[y]=xo(r[y],e,t)}),g}function yi(r,e){typeof e=="boolean"&&(e={detectCycles:e}),e||(e=x4),e.detectCycles=e.detectCycles===void 0?e.recurseEverything===!0:e.detectCycles===!0;var t;return e.detectCycles&&(t=new Map),xo(r,e,t)}function w4(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=!1;typeof r[r.length-1]=="boolean"&&(t=r.pop());var n=S4(r);if(!n)return an(!1);n.isTracing===Ui.NONE&&""+n.name,n.isTracing=t?Ui.BREAK:Ui.LOG}function S4(r){switch(r.length){case 0:return Ot.trackingDerivation;case 1:return Ao(r[0]);case 2:return Ao(r[0],r[1])}}function bi(r,e){e===void 0&&(e=void 0),Si();try{return r.apply(e)}finally{Ei()}}function Hu(r){return r[$t]}function $u(r){return typeof r=="string"||typeof r=="number"||typeof r=="symbol"}var E4={has:function(r,e){if(e===$t||e==="constructor"||e===_d)return!0;var t=Hu(r);return $u(e)?t.has(e):e in r},get:function(r,e){if(e===$t||e==="constructor"||e===_d)return r[e];var t=Hu(r),n=t.values.get(e);if(n instanceof Os){var i=n.get();return i===void 0&&t.has(e),i}return $u(e)&&t.has(e),r[e]},set:function(r,e,t){return $u(e)?(Jv(r,e,t),!0):!1},deleteProperty:function(r,e){if(!$u(e))return!1;var t=Hu(r);return t.remove(e),!0},ownKeys:function(r){var e=Hu(r);return e.keysAtom.reportObserved(),Reflect.ownKeys(r)},preventExtensions:function(r){return an("Dynamic observable objects cannot be frozen"),!1}};function C4(r){var e=new Proxy(r,E4);return r[$t].proxy=e,e}function Vi(r){return r.interceptors!==void 0&&r.interceptors.length>0}function tu(r,e){var t=r.interceptors||(r.interceptors=[]);return t.push(e),ux(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function qi(r,e){var t=Ns();try{for(var n=Gv(r.interceptors||[]),i=0,o=n.length;i<o&&(e=n[i](e),oa(!e||e.type,"Intercept handlers should return nothing or a change object"),!!e);i++);return e}finally{Oo(t)}}function Ci(r){return r.changeListeners!==void 0&&r.changeListeners.length>0}function nu(r,e){var t=r.changeListeners||(r.changeListeners=[]);return t.push(e),ux(function(){var n=t.indexOf(e);n!==-1&&t.splice(n,1)})}function ki(r,e){var t=Ns(),n=r.changeListeners;if(n){n=n.slice();for(var i=0,o=n.length;i<o;i++)n[i](e);Oo(t)}}var k4=1e4,O4={get:function(r,e){return e===$t?r[$t]:e==="length"?r[$t].getArrayLength():typeof e=="number"?io.get.call(r,e):typeof e=="string"&&!isNaN(e)?io.get.call(r,parseInt(e)):io.hasOwnProperty(e)?io[e]:r[e]},set:function(r,e,t){return e==="length"&&r[$t].setArrayLength(t),typeof e=="number"&&io.set.call(r,e,t),typeof e=="symbol"||isNaN(e)?r[e]=t:io.set.call(r,parseInt(e),t),!0},preventExtensions:function(r){return an("Observable arrays cannot be frozen"),!1}};function N4(r,e,t,n){t===void 0&&(t="ObservableArray@"+Br()),n===void 0&&(n=!1);var i=new Rx(t,e,n);AB(i.values,$t,i);var o=new Proxy(i.values,O4);if(i.proxy=o,r&&r.length){var a=_c(!0);i.spliceWithArray(0,0,r),bc(a)}return o}var Rx=function(){function r(e,t,n){this.owned=n,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new Os(e||"ObservableArray@"+Br()),this.enhancer=function(i,o){return t(i,o,e+"[..]")}}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.dehanceValues=function(e){return this.dehancer!==void 0&&e.length>0?e.map(this.dehancer):e},r.prototype.intercept=function(e){return tu(this,e)},r.prototype.observe=function(e,t){return t===void 0&&(t=!1),t&&e({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),nu(this,e)},r.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},r.prototype.setArrayLength=function(e){if(typeof e!="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e!==t)if(e>t){for(var n=new Array(e-t),i=0;i<e-t;i++)n[i]=void 0;this.spliceWithArray(t,0,n)}else this.spliceWithArray(e,t-e)},r.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=t},r.prototype.spliceWithArray=function(e,t,n){var i=this;os(this.atom);var o=this.values.length;if(e===void 0?e=0:e>o?e=o:e<0&&(e=Math.max(0,o+e)),arguments.length===1?t=o-e:t==null?t=0:t=Math.max(0,Math.min(t,o-e)),n===void 0&&(n=md),Vi(this)){var a=qi(this,{object:this.proxy,type:"splice",index:e,removedCount:t,added:n});if(!a)return md;t=a.removedCount,n=a.added}n=n.length===0?n:n.map(function(u){return i.enhancer(u,void 0)});var l=this.spliceItemsIntoValues(e,t,n);return(t!==0||n.length!==0)&&this.notifyArraySplice(e,n,l),this.dehanceValues(l)},r.prototype.spliceItemsIntoValues=function(e,t,n){var i;if(n.length<k4)return(i=this.values).splice.apply(i,Gv([e,t],n));var o=this.values.slice(e,e+t);return this.values=this.values.slice(0,e).concat(n,this.values.slice(e+t)),o},r.prototype.notifyArrayChildUpdate=function(e,t,n){var i=!this.owned&&oi(),o=Ci(this),a=o||i?{object:this.proxy,type:"update",index:e,newValue:t,oldValue:n}:null;this.atom.reportChanged(),o&&ki(this,a)},r.prototype.notifyArraySplice=function(e,t,n){var i=!this.owned&&oi(),o=Ci(this),a=o||i?{object:this.proxy,type:"splice",index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom.reportChanged(),o&&ki(this,a)},r}(),io={intercept:function(r){return this[$t].intercept(r)},observe:function(r,e){e===void 0&&(e=!1);var t=this[$t];return t.observe(r,e)},clear:function(){return this.splice(0)},replace:function(r){var e=this[$t];return e.spliceWithArray(0,e.values.length,r)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=this[$t];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(r);case 2:return i.spliceWithArray(r,e)}return i.spliceWithArray(r,e,t)},spliceWithArray:function(r,e,t){var n=this[$t];return n.spliceWithArray(r,e,t)},push:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[$t];return t.spliceWithArray(t.values.length,0,r),t.values.length},pop:function(){return this.splice(Math.max(this[$t].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this[$t];return t.spliceWithArray(0,0,r),t.values.length},reverse:function(){var r=this.slice();return r.reverse.apply(r,arguments)},sort:function(r){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(r){var e=this[$t],t=e.dehanceValues(e.values).indexOf(r);return t>-1?(this.splice(t,1),!0):!1},get:function(r){var e=this[$t];if(e){if(r<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[r]);console.warn("[mobx.array] Attempt to read an array index ("+r+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(r,e){var t=this[$t],n=t.values;if(r<n.length){os(t.atom);var i=n[r];if(Vi(t)){var o=qi(t,{type:"update",object:t.proxy,index:r,newValue:e});if(!o)return;e=o.newValue}e=t.enhancer(e,i);var a=e!==i;a&&(n[r]=e,t.notifyArrayChildUpdate(r,e,i))}else if(r===n.length)t.spliceWithArray(r,0,[e]);else throw new Error("[mobx.array] Index out of bounds, "+r+" is larger than "+n.length)}};["concat","flat","includes","indexOf","join","lastIndexOf","slice","toString","toLocaleString"].forEach(function(r){typeof Array.prototype[r]=="function"&&(io[r]=function(){var e=this[$t];e.atom.reportObserved();var t=e.dehanceValues(e.values);return t[r].apply(t,arguments)})});["every","filter","find","findIndex","flatMap","forEach","map","some"].forEach(function(r){typeof Array.prototype[r]=="function"&&(io[r]=function(e,t){var n=this,i=this[$t];i.atom.reportObserved();var o=i.dehanceValues(i.values);return o[r](function(a,l){return e.call(t,a,l,n)},t)})});["reduce","reduceRight"].forEach(function(r){io[r]=function(){var e=this,t=this[$t];t.atom.reportObserved();var n=arguments[0];return arguments[0]=function(i,o,a){return o=t.dehanceValue(o),n(i,o,a,e)},t.values[r].apply(t.values,arguments)}});var M4=Po("ObservableArrayAdministration",Rx);function Ki(r){return Vv(r)&&M4(r[$t])}var Iy,A4={},Zv=function(){function r(e,t,n){if(t===void 0&&(t=eu),n===void 0&&(n="ObservableMap@"+Br()),this.enhancer=t,this.name=n,this[Iy]=A4,this._keysAtom=Xv(this.name+".keys()"),this[Symbol.toStringTag]="Map",typeof Map!="function")throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(e)}return r.prototype._has=function(e){return this._data.has(e)},r.prototype.has=function(e){var t=this;if(!Ot.trackingDerivation)return this._has(e);var n=this._hasMap.get(e);if(!n){var i=n=new sa(this._has(e),mc,this.name+"."+Co(e)+"?",!1);this._hasMap.set(e,i),Nx(i,function(){return t._hasMap.delete(e)})}return n.get()},r.prototype.set=function(e,t){var n=this._has(e);if(Vi(this)){var i=qi(this,{type:n?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return n?this._updateValue(e,t):this._addValue(e,t),this},r.prototype.delete=function(e){var t=this;if(os(this._keysAtom),Vi(this)){var n=qi(this,{type:"delete",object:this,name:e});if(!n)return!1}if(this._has(e)){var i=oi(),o=Ci(this),n=o||i?{type:"delete",object:this,oldValue:this._data.get(e).value,name:e}:null;return bi(function(){t._keysAtom.reportChanged(),t._updateHasMapEntry(e,!1);var l=t._data.get(e);l.setNewValue(void 0),t._data.delete(e)}),o&&ki(this,n),!0}return!1},r.prototype._updateHasMapEntry=function(e,t){var n=this._hasMap.get(e);n&&n.setNewValue(t)},r.prototype._updateValue=function(e,t){var n=this._data.get(e);if(t=n.prepareNewValue(t),t!==Ot.UNCHANGED){var i=oi(),o=Ci(this),a=o||i?{type:"update",object:this,oldValue:n.value,name:e,newValue:t}:null;n.setNewValue(t),o&&ki(this,a)}},r.prototype._addValue=function(e,t){var n=this;os(this._keysAtom),bi(function(){var l=new sa(t,n.enhancer,n.name+"."+Co(e),!1);n._data.set(e,l),t=l.value,n._updateHasMapEntry(e,!0),n._keysAtom.reportChanged()});var i=oi(),o=Ci(this),a=o||i?{type:"add",object:this,name:e,newValue:t}:null;o&&ki(this,a)},r.prototype.get=function(e){return this.has(e)?this.dehanceValue(this._data.get(e).get()):this.dehanceValue(void 0)},r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},r.prototype.values=function(){var e=this,t=this.keys();return Ed({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:e.get(o)}}})},r.prototype.entries=function(){var e=this,t=this.keys();return Ed({next:function(){var n=t.next(),i=n.done,o=n.value;return{done:i,value:i?void 0:[o,e.get(o)]}}})},r.prototype[Iy=$t,Symbol.iterator]=function(){return this.entries()},r.prototype.forEach=function(e,t){var n,i;try{for(var o=Wi(this),a=o.next();!a.done;a=o.next()){var l=Xa(a.value,2),u=l[0],d=l[1];e.call(t,d,u,this)}}catch(f){n={error:f}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},r.prototype.merge=function(e){var t=this;return Fr(e)&&(e=e.toJS()),bi(function(){var n=_c(!0);try{Es(e)?dx(e).forEach(function(i){return t.set(i,e[i])}):Array.isArray(e)?e.forEach(function(i){var o=Xa(i,2),a=o[0],l=o[1];return t.set(a,l)}):ks(e)?(e.constructor!==Map&&an("Cannot initialize from classes that inherit from Map: "+e.constructor.name),e.forEach(function(i,o){return t.set(o,i)})):e!=null&&an("Cannot initialize map from "+e)}finally{bc(n)}}),this},r.prototype.clear=function(){var e=this;bi(function(){gx(function(){var t,n;try{for(var i=Wi(e.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;e.delete(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.replace=function(e){var t=this;return bi(function(){var n,i,o,a,l=MB(e),u=new Map,d=!1;try{for(var f=Wi(t._data.keys()),h=f.next();!h.done;h=f.next()){var g=h.value;if(!l.has(g)){var y=t.delete(g);if(y)d=!0;else{var w=t._data.get(g);u.set(g,w)}}}}catch(I){n={error:I}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var x=Wi(l.entries()),b=x.next();!b.done;b=x.next()){var _=Xa(b.value,2),g=_[0],w=_[1],S=t._data.has(g);if(t.set(g,w),t._data.has(g)){var k=t._data.get(g);u.set(g,k),S||(d=!0)}}}catch(I){o={error:I}}finally{try{b&&!b.done&&(a=x.return)&&a.call(x)}finally{if(o)throw o.error}}if(!d)if(t._data.size!==u.size)t._keysAtom.reportChanged();else for(var O=t._data.keys(),M=u.keys(),R=O.next(),T=M.next();!R.done;){if(R.value!==T.value){t._keysAtom.reportChanged();break}R=O.next(),T=M.next()}t._data=u}),this},Object.defineProperty(r.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.toPOJO=function(){var e,t,n={};try{for(var i=Wi(this),o=i.next();!o.done;o=i.next()){var a=Xa(o.value,2),l=a[0],u=a[1];n[typeof l=="symbol"?l:Co(l)]=u}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.toJS=function(){return new Map(this)},r.prototype.toJSON=function(){return this.toPOJO()},r.prototype.toString=function(){var e=this;return this.name+"[{ "+Array.from(this.keys()).map(function(t){return Co(t)+": "+(""+e.get(t))}).join(", ")+" }]"},r.prototype.observe=function(e,t){return nu(this,e)},r.prototype.intercept=function(e){return tu(this,e)},r}(),Fr=Po("ObservableMap",Zv),By,T4={},Ix=function(){function r(e,t,n){if(t===void 0&&(t=eu),n===void 0&&(n="ObservableSet@"+Br()),this.name=n,this[By]=T4,this._data=new Set,this._atom=Xv(this.name),this[Symbol.toStringTag]="Set",typeof Set!="function")throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(i,o){return t(i,o,n)},e&&this.replace(e)}return r.prototype.dehanceValue=function(e){return this.dehancer!==void 0?this.dehancer(e):e},r.prototype.clear=function(){var e=this;bi(function(){gx(function(){var t,n;try{for(var i=Wi(e._data.values()),o=i.next();!o.done;o=i.next()){var a=o.value;e.delete(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}})})},r.prototype.forEach=function(e,t){var n,i;try{for(var o=Wi(this),a=o.next();!a.done;a=o.next()){var l=a.value;e.call(t,l,l,this)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},Object.defineProperty(r.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),r.prototype.add=function(e){var t=this;if(os(this._atom),Vi(this)){var n=qi(this,{type:"add",object:this,newValue:e});if(!n)return this}if(!this.has(e)){bi(function(){t._data.add(t.enhancer(e,void 0)),t._atom.reportChanged()});var i=oi(),o=Ci(this),n=o||i?{type:"add",object:this,newValue:e}:null;o&&ki(this,n)}return this},r.prototype.delete=function(e){var t=this;if(Vi(this)){var n=qi(this,{type:"delete",object:this,oldValue:e});if(!n)return!1}if(this.has(e)){var i=oi(),o=Ci(this),n=o||i?{type:"delete",object:this,oldValue:e}:null;return bi(function(){t._atom.reportChanged(),t._data.delete(e)}),o&&ki(this,n),!0}return!1},r.prototype.has=function(e){return this._atom.reportObserved(),this._data.has(this.dehanceValue(e))},r.prototype.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return Ed({next:function(){var i=e;return e+=1,i<n.length?{value:[t[i],n[i]],done:!1}:{done:!0}}})},r.prototype.keys=function(){return this.values()},r.prototype.values=function(){this._atom.reportObserved();var e=this,t=0,n=Array.from(this._data.values());return Ed({next:function(){return t<n.length?{value:e.dehanceValue(n[t++]),done:!1}:{done:!0}}})},r.prototype.replace=function(e){var t=this;return si(e)&&(e=e.toJS()),bi(function(){var n=_c(!0);try{Array.isArray(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):Ql(e)?(t.clear(),e.forEach(function(i){return t.add(i)})):e!=null&&an("Cannot initialize set from "+e)}finally{bc(n)}}),this},r.prototype.observe=function(e,t){return nu(this,e)},r.prototype.intercept=function(e){return tu(this,e)},r.prototype.toJS=function(){return new Set(this)},r.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},r.prototype[By=$t,Symbol.iterator]=function(){return this.values()},r}(),si=Po("ObservableSet",Ix),Bx=function(){function r(e,t,n,i){t===void 0&&(t=new Map),this.target=e,this.values=t,this.name=n,this.defaultEnhancer=i,this.keysAtom=new Os(n+".keys")}return r.prototype.read=function(e){return this.values.get(e).get()},r.prototype.write=function(e,t){var n=this.target,i=this.values.get(e);if(i instanceof as){i.set(t);return}if(Vi(this)){var o=qi(this,{type:"update",object:this.proxy||n,name:e,newValue:t});if(!o)return;t=o.newValue}if(t=i.prepareNewValue(t),t!==Ot.UNCHANGED){var a=Ci(this),l=oi(),o=a||l?{type:"update",object:this.proxy||n,oldValue:i.value,name:e,newValue:t}:null;i.setNewValue(t),a&&ki(this,o)}},r.prototype.has=function(e){var t=this.pendingKeys||(this.pendingKeys=new Map),n=t.get(e);if(n)return n.get();var i=!!this.values.get(e);return n=new sa(i,mc,this.name+"."+Co(e)+"?",!1),t.set(e,n),n.get()},r.prototype.addObservableProp=function(e,t,n){n===void 0&&(n=this.defaultEnhancer);var i=this.target;if(Vi(this)){var o=qi(this,{object:this.proxy||i,name:e,type:"add",newValue:t});if(!o)return;t=o.newValue}var a=new sa(t,n,this.name+"."+Co(e),!1);this.values.set(e,a),t=a.value,Object.defineProperty(i,e,D4(e)),this.notifyPropertyAddition(e,t)},r.prototype.addComputedProp=function(e,t,n){var i=this.target;n.name=n.name||this.name+"."+Co(t),this.values.set(t,new as(n)),(e===i||TB(e,t))&&Object.defineProperty(e,t,L4(t))},r.prototype.remove=function(e){if(this.values.has(e)){var t=this.target;if(Vi(this)){var n=qi(this,{object:this.proxy||t,name:e,type:"remove"});if(!n)return}try{Si();var i=Ci(this),o=oi(),a=this.values.get(e),l=a&&a.get();if(a&&a.set(void 0),this.keysAtom.reportChanged(),this.values.delete(e),this.pendingKeys){var u=this.pendingKeys.get(e);u&&u.set(!1)}delete this.target[e];var n=i||o?{type:"remove",object:this.proxy||t,oldValue:l,name:e}:null;i&&ki(this,n)}finally{Ei()}}},r.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},r.prototype.observe=function(e,t){return nu(this,e)},r.prototype.intercept=function(e){return tu(this,e)},r.prototype.notifyPropertyAddition=function(e,t){var n=Ci(this),i=oi(),o=n||i?{type:"add",object:this.proxy||this.target,name:e,newValue:t}:null;if(n&&ki(this,o),this.pendingKeys){var a=this.pendingKeys.get(e);a&&a.set(!0)}this.keysAtom.reportChanged()},r.prototype.getKeys=function(){var e,t;this.keysAtom.reportObserved();var n=[];try{for(var i=Wi(this.values),o=i.next();!o.done;o=i.next()){var a=Xa(o.value,2),l=a[0],u=a[1];u instanceof sa&&n.push(l)}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}();function Qv(r,e,t){if(e===void 0&&(e=""),t===void 0&&(t=eu),Object.prototype.hasOwnProperty.call(r,$t))return r[$t];Es(r)||(e=(r.constructor.name||"ObservableObject")+"@"+Br()),e||(e="ObservableObject@"+Br());var n=new Bx(r,new Map,Co(e),t);return Cs(r,$t,n),n}var jy=Object.create(null),Hy=Object.create(null);function D4(r){return jy[r]||(jy[r]={configurable:!0,enumerable:!0,get:function(){return this[$t].read(r)},set:function(e){this[$t].write(r,e)}})}function $y(r){var e=r[$t];return e||(ua(r),r[$t])}function L4(r){return Hy[r]||(Hy[r]={configurable:Ot.computedConfigurable,enumerable:!1,get:function(){return $y(this).read(r)},set:function(e){$y(this).write(r,e)}})}var P4=Po("ObservableObjectAdministration",Bx);function Li(r){return Vv(r)?(ua(r),P4(r[$t])):!1}function Ao(r,e){if(typeof r=="object"&&r!==null){if(Ki(r))return e!==void 0&&an(!1),r[$t].atom;if(si(r))return r[$t];if(Fr(r)){var t=r;if(e===void 0)return t._keysAtom;var n=t._data.get(e)||t._hasMap.get(e);return n||an(!1),n}if(ua(r),e&&!r[$t]&&r[e],Li(r)){if(!e)return an(!1);var n=r[$t].values.get(e);return n||an(!1),n}if(qv(r)||ss(r)||Sd(r))return r}else if(typeof r=="function"&&Sd(r[$t]))return r[$t];return an(!1)}function xc(r,e){if(r||an("Expecting some object"),e!==void 0)return xc(Ao(r,e));if(qv(r)||ss(r)||Sd(r)||Fr(r)||si(r))return r;if(ua(r),r[$t])return r[$t];an(!1)}function R4(r,e){var t;return e!==void 0?t=Ao(r,e):Li(r)||Fr(r)||si(r)?t=xc(r):t=Ao(r),t.name}var Fy=Object.prototype.toString;function jx(r,e,t){return t===void 0&&(t=-1),Pp(r,e,t)}function Pp(r,e,t,n,i){if(r===e)return r!==0||1/r===1/e;if(r==null||e==null)return!1;if(r!==r)return e!==e;var o=typeof r;if(o!=="function"&&o!=="object"&&typeof e!="object")return!1;var a=Fy.call(r);if(a!==Fy.call(e))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+r==""+e;case"[object Number]":return+r!=+r?+e!=+e:+r==0?1/+r===1/e:+r==+e;case"[object Date]":case"[object Boolean]":return+r==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(r)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":t>=0&&t++;break}r=zy(r),e=zy(e);var l=a==="[object Array]";if(!l){if(typeof r!="object"||typeof e!="object")return!1;var u=r.constructor,d=e.constructor;if(u!==d&&!(typeof u=="function"&&u instanceof u&&typeof d=="function"&&d instanceof d)&&"constructor"in r&&"constructor"in e)return!1}if(t===0)return!1;t<0&&(t=-1),n=n||[],i=i||[];for(var f=n.length;f--;)if(n[f]===r)return i[f]===e;if(n.push(r),i.push(e),l){if(f=r.length,f!==e.length)return!1;for(;f--;)if(!Pp(r[f],e[f],t-1,n,i))return!1}else{var h=Object.keys(r),g=void 0;if(f=h.length,Object.keys(e).length!==f)return!1;for(;f--;)if(g=h[f],!(I4(e,g)&&Pp(r[g],e[g],t-1,n,i)))return!1}return n.pop(),i.pop(),!0}function zy(r){return Ki(r)?r.slice():ks(r)||Fr(r)||Ql(r)||si(r)?Array.from(r.entries()):r}function I4(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Ed(r){return r[Symbol.iterator]=B4,r}function B4(){return this}if(typeof Proxy>"u"||typeof Symbol>"u")throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:o4,extras:{getDebugName:R4},$mobx:$t});function j4(r){return!(r.prototype&&r.prototype.render)&&!Yt.isPrototypeOf(r)}function Hx(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.prefix,n=t===void 0?"":t,i=e.suffix,o=i===void 0?"":i,a=r.displayName||r.name||r.constructor&&r.constructor.name||"<component>";return n+a+o}var Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$x=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},Fx=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),zx=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},Wx=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},Uy=console;function H4(r){var e=Tp().allowStateChanges;return Tp().allowStateChanges=r,e}function $4(r){Tp().allowStateChanges=r}function F4(r,e,t,n,i){var o=H4(r),a=void 0;try{a=e(t,n,i)}finally{$4(o)}return a}function Vy(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r[e],i=Ux[e],o=n?t===!0?function(){i.apply(this,arguments),n.apply(this,arguments)}:function(){n.apply(this,arguments),i.apply(this,arguments)}:i;r[e]=o}function qy(r,e){if(r==null||e==null||(typeof r>"u"?"undefined":Wy(r))!=="object"||(typeof e>"u"?"undefined":Wy(e))!=="object")return r!==e;var t=Object.keys(r);if(t.length!==Object.keys(e).length)return!0;for(var n=void 0,i=t.length-1;n=t[i];i--)if(e[n]!==r[n])return!0;return!1}var Ux={componentWillMount:function(){var e=this,t=Hx(this),n=!1,i=!1;function o(h){var g=this[h],y=Xv("reactive "+h);Object.defineProperty(this,h,{configurable:!0,enumerable:!0,get:function(){return y.reportObserved(),g},set:function(x){!i&&qy(g,x)?(g=x,n=!0,y.reportChanged(),n=!1):g=x}})}o.call(this,"props"),o.call(this,"state");var a=this.render.bind(this),l=null,u=!1,d=function(){return l=new Al(t+".render()",function(){if(!u&&(u=!0,typeof e.componentWillReact=="function"&&e.componentWillReact(),e.__$mobxIsUnmounted!==!0)){var g=!0;try{i=!0,n||Yt.prototype.forceUpdate.call(e),g=!1}finally{i=!1,g&&l.dispose()}}}),l.reactComponent=e,f.$mobx=l,e.render=f,f(e.props,e.state,e.context)},f=function(g,y,w){u=!1;var x=void 0,b=void 0;if(l.track(function(){try{b=F4(!1,a,g,y,w)}catch(_){x=_}}),x)throw x;return b};this.render=d},componentWillUnmount:function(){this.render.$mobx&&this.render.$mobx.dispose(),this.__$mobxIsUnmounted=!0},componentDidMount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return this.state!==t?!0:qy(this.props,e)}};function eg(r){if(arguments.length>1&&Uy.warn('Mobx observer: Using observer to inject stores is not supported. Use `@connect(["store1", "store2"]) ComponentClass instead or preferably, use `@inject("store1", "store2") @observer ComponentClass` or `inject("store1", "store2")(observer(componentClass))``'),r.isMobxInjector===!0&&Uy.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),j4(r)){var e,t;return eg((t=e=function(i){zx(o,i);function o(){return $x(this,o),Wx(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return Fx(o,[{key:"render",value:function(){return r.call(this,this.props,this.context)}}]),o}(Yt),e.displayName=Hx(r),t))}if(!r)throw new Error("Please pass a valid component to 'observer'");var n=r.prototype||r;return z4(n),r.isMobXReactObserver=!0,r}function z4(r){Vy(r,"componentWillMount",!0),Vy(r,"componentDidMount"),r.shouldComponentUpdate||(r.shouldComponentUpdate=Ux.shouldComponentUpdate)}var W4=eg(function(r){var e=r.children;return e[0]()});W4.displayName="Observer";var U4=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V4(r,e){return e={exports:{}},r(e,e.exports),e.exports}V4(function(r,e){(function(t,n){r.exports=n()})(U4,function(){var t={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i=Object.defineProperty,o=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,l=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=u&&u(Object);return function f(h,g,y){if(typeof g!="string"){if(d){var w=u(g);w&&w!==d&&f(h,w,y)}var x=o(g);a&&(x=x.concat(a(g)));for(var b=0;b<x.length;++b){var _=x[b];if(!t[_]&&!n[_]&&(!y||!y[_])){var S=l(g,_);try{i(h,_,S)}catch{}}}return h}return h}})});var Xy={children:!0,key:!0,ref:!0},Gy=console;(function(r){zx(e,r);function e(){return $x(this,e),Wx(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Fx(e,[{key:"render",value:function(n){var i=n.children;return i.length>1?wt("div",null," ",i," "):i[0]}},{key:"getChildContext",value:function(){var n={},i=this.context.mobxStores;if(i)for(var o in i)n[o]=i[o];for(var a in this.props)!Xy[a]&&a!=="suppressChangedStoreWarning"&&(n[a]=this.props[a]);return{mobxStores:n}}},{key:"componentWillReceiveProps",value:function(n){if(Object.keys(n).length!==Object.keys(this.props).length&&Gy.warn("MobX Provider: The set of provided stores has changed. Please avoid changing stores as the change might not propagate to all children"),!n.suppressChangedStoreWarning)for(var i in n)!Xy[i]&&this.props[i]!==n[i]&&Gy.warn("MobX Provider: Provided store '"+i+"' has changed. Please avoid replacing stores as the change might not propagate to all children")}}]),e})(Yt);if(!Yt)throw new Error("mobx-preact requires Preact to be available");var Fi,Nf,Yy,Vx=[],ir=Xt,Ky=ir.__b,Jy=ir.__r,Zy=ir.diffed,Qy=ir.__c,e_=ir.unmount,t_=ir.__;function q4(){for(var r;r=Vx.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(dd),r.__H.__h.forEach(Rp),r.__H.__h=[]}catch(e){r.__H.__h=[],ir.__e(e,r.__v)}}ir.__b=function(r){Fi=null,Ky&&Ky(r)},ir.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),t_&&t_(r,e)},ir.__r=function(r){Jy&&Jy(r);var e=(Fi=r.__c).__H;e&&(Nf===Fi?(e.__h=[],Fi.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(dd),e.__h.forEach(Rp),e.__h=[])),Nf=Fi},ir.diffed=function(r){Zy&&Zy(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(Vx.push(e)!==1&&Yy===ir.requestAnimationFrame||((Yy=ir.requestAnimationFrame)||X4)(q4)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),Nf=Fi=null},ir.__c=function(r,e){e.some(function(t){try{t.__h.forEach(dd),t.__h=t.__h.filter(function(n){return!n.__||Rp(n)})}catch(n){e.some(function(i){i.__h&&(i.__h=[])}),e=[],ir.__e(n,t.__v)}}),Qy&&Qy(r,e)},ir.unmount=function(r){e_&&e_(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{dd(n)}catch(i){e=i}}),t.__H=void 0,e&&ir.__e(e,t.__v))};var n_=typeof requestAnimationFrame=="function";function X4(r){var e,t=function(){clearTimeout(n),n_&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,35);n_&&(e=requestAnimationFrame(t))}function dd(r){var e=Fi,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),Fi=e}function Rp(r){var e=Fi;r.__c=r.__(),Fi=e}function G4(r,e){for(var t in e)r[t]=e[t];return r}function r_(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function i_(r,e){this.props=r,this.context=e}(i_.prototype=new Yt).isPureReactComponent=!0,i_.prototype.shouldComponentUpdate=function(r,e){return r_(this.props,r)||r_(this.state,e)};var o_=Xt.__b;Xt.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),o_&&o_(r)};var Y4=Xt.__e;Xt.__e=function(r,e,t,n){if(r.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),i.__c(r,e)}Y4(r,e,t,n)};var a_=Xt.unmount;function qx(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=G4({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return qx(n,e,t)})),r}function Xx(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return Xx(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function Mf(){this.__u=0,this.o=null,this.__b=null}function Gx(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function Fu(){this.i=null,this.l=null}Xt.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),a_&&a_(r)},(Mf.prototype=new Yt).__c=function(r,e){var t=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(t);var i=Gx(n.__v),o=!1,a=function(){o||(o=!0,t.__R=null,i?i(l):l())};t.__R=a;var l=function(){if(!--n.__u){if(n.state.__a){var u=n.state.__a;n.__v.__k[0]=Xx(u,u.__c.__P,u.__c.__O)}var d;for(n.setState({__a:n.__b=null});d=n.o.pop();)d.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(a,a)},Mf.prototype.componentWillUnmount=function(){this.o=[]},Mf.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=qx(this.__b,t,n.__O=n.__P)}this.__b=null}var i=e.__a&&wt(ns,null,r.fallback);return i&&(i.__u&=-33),[wt(ns,null,e.__a?null:r.children),i]};var s_=function(r,e,t){if(++t[1]===t[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(t=r.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.i=t=t[2]}};(Fu.prototype=new Yt).__a=function(r){var e=this,t=Gx(e.__v),n=e.l.get(r);return n[0]++,function(i){var o=function(){e.props.revealOrder?(n.push(i),s_(e,r,n)):i()};t?t(o):o()}},Fu.prototype.render=function(r){this.i=null,this.l=new Map;var e=gd(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return r.children},Fu.prototype.componentDidUpdate=Fu.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,t){s_(r,t,e)})};var K4=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,J4=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Z4=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Q4=/[A-Z0-9]/g,ej=typeof document<"u",tj=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function l_(r,e,t){return e.__k==null&&(e.textContent=""),kB(r,e),typeof t=="function"&&t(),r?r.__c:null}Yt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Yt.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var u_=Xt.event;function nj(){}function rj(){return this.cancelBubble}function ij(){return this.defaultPrevented}Xt.event=function(r){return u_&&(r=u_(r)),r.persist=nj,r.isPropagationStopped=rj,r.isDefaultPrevented=ij,r.nativeEvent=r};var oj={enumerable:!1,configurable:!0,get:function(){return this.class}},d_=Xt.vnode;Xt.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,i={},o=n.indexOf("-")===-1;for(var a in t){var l=t[a];if(!(a==="value"&&"defaultValue"in t&&l==null||ej&&a==="children"&&n==="noscript"||a==="class"||a==="className")){var u=a.toLowerCase();a==="defaultValue"&&"value"in t&&t.value==null?a="value":a==="download"&&l===!0?l="":u==="translate"&&l==="no"?l=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?a="ondblclick":u!=="onchange"||n!=="input"&&n!=="textarea"||tj(t.type)?u==="onfocus"?a="onfocusin":u==="onblur"?a="onfocusout":Z4.test(a)&&(a=u):u=a="oninput":o&&J4.test(a)?a=a.replace(Q4,"-$&").toLowerCase():l===null&&(l=void 0),u==="oninput"&&i[a=u]&&(a="oninputCapture"),i[a]=l}}n=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=gd(t.children).forEach(function(d){d.props.selected=i.value.indexOf(d.props.value)!=-1})),n=="select"&&i.defaultValue!=null&&(i.value=gd(t.children).forEach(function(d){d.props.selected=i.multiple?i.defaultValue.indexOf(d.props.value)!=-1:i.defaultValue==d.props.value})),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",oj)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i}(r),r.$$typeof=K4,d_&&d_(r)};var c_=Xt.__r;Xt.__r=function(r){c_&&c_(r),r.__c};var f_=Xt.diffed;Xt.diffed=function(r){f_&&f_(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};var aj=0;function Te(r,e,t,n,i,o){e||(e={});var a,l,u=e;if("ref"in u)for(l in u={},e)l=="ref"?a=e[l]:u[l]=e[l];var d={type:r,props:u,key:t,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--aj,__i:-1,__u:0,__source:i,__self:o};if(typeof r=="function"&&(a=r.defaultProps))for(l in a)u[l]===void 0&&(u[l]=a[l]);return Xt.vnode&&Xt.vnode(d),d}var sj=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},Tl;(function(r){function e(t){var n=sj(t,[]),i=t.container;if(!i)throw new Error("Ensure the container of LogicFlow is specified and valid.");return on({},r.defaults,n)}r.get=e})(Tl||(Tl={}));(function(r){r.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(Tl||(Tl={}));var h_={node:!1,edge:!1},lj={node:!0,edge:!0},uj=function(r){return!r||typeof r=="boolean"?r===!0?Ht(lj):Ht(h_):Qa(Ht(h_),r)},dj=function(){return Gl(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function vr(r){try{return JSON.parse(JSON.stringify(r))}catch{return r}}var zu=200,cj=9999,fj=10,en;(function(r){r[r.DEFAULT=1]="DEFAULT",r[r.TEXT_EDIT=2]="TEXT_EDIT",r[r.SHOW_MENU=3]="SHOW_MENU",r[r.ALLOW_CONNECT=4]="ALLOW_CONNECT",r[r.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(en||(en={}));var Sn;(function(r){r.NODE="node",r.EDGE="edge",r.GRAPH="graph"})(Sn||(Sn={}));var Vt;(function(r){r.NODE="node",r.CIRCLE_NODE="circle-node",r.POLYGON_NODE="polygon-node",r.RECT_NODE="rect-node",r.TEXT_NODE="text-node",r.ELLIPSE_NODE="ellipse-node",r.DIAMOND_NODE="diamond-node",r.HTML_NODE="html-node",r.CUSTOM_HTML_NODE="custom-html-node",r.EDGE="edge",r.LINE_EDGE="line-edge",r.POLYLINE_EDGE="polyline-edge",r.BEZIER_EDGE="bezier-edge",r.GRAPH="graph"})(Vt||(Vt={}));var kt;(function(r){r.ELEMENT_CLICK="element:click",r.NODE_ADD="node:add",r.NODE_DELETE="node:delete",r.NODE_CLICK="node:click",r.NODE_DBCLICK="node:dbclick",r.NODE_GROUP_COPY="node:group-copy-add",r.NODE_DND_ADD="node:dnd-add",r.NODE_DND_DRAG="node:dnd-drag",r.NODE_MOUSEDOWN="node:mousedown",r.NODE_DRAGSTART="node:dragstart",r.NODE_DRAG="node:drag",r.NODE_DROP="node:drop",r.NODE_MOUSEUP="node:mouseup",r.NODE_MOUSEMOVE="node:mousemove",r.NODE_MOUSEENTER="node:mouseenter",r.NODE_MOUSELEAVE="node:mouseleave",r.NODE_CONTEXTMENU="node:contextmenu",r.NODE_ROTATE="node:rotate",r.NODE_RESIZE="node:resize",r.NODE_FOCUS="node:focus",r.NODE_BLUR="node:blur",r.NODE_PROPERTIES_CHANGE="node:properties-change",r.NODE_PROPERTIES_DELETE="node:properties-delete",r.EDGE_ADD="edge:add",r.EDGE_DELETE="edge:delete",r.EDGE_CLICK="edge:click",r.EDGE_DBCLICK="edge:dbclick",r.EDGE_FOCUS="edge:focus",r.EDGE_BLUR="edge:blur",r.EDGE_MOUSEENTER="edge:mouseenter",r.EDGE_MOUSELEAVE="edge:mouseleave",r.EDGE_CONTEXTMENU="edge:contextmenu",r.EDGE_ADJUST="edge:adjust",r.EDGE_EXCHANGE_NODE="edge:exchange-node",r.ANCHOR_CLICK="anchor:click",r.ANCHOR_MOUSEDOWN="anchor:mousedown",r.ANCHOR_DRAGSTART="anchor:dragstart",r.ANCHOR_DRAG="anchor:drag",r.ANCHOR_DROP="anchor:drop",r.ANCHOR_DRAGEND="anchor:dragend",r.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",r.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",r.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",r.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",r.ADJUST_POINT_DRAG="adjustPoint:drag",r.ADJUST_POINT_DROP="adjustPoint:drop",r.ADJUST_POINT_DRAGEND="adjustPoint:dragend",r.BLANK_MOUSEDOWN="blank:mousedown",r.BLANK_DRAGSTART="blank:dragstart",r.BLANK_DRAG="blank:drag",r.BLANK_DROP="blank:drop",r.BLANK_MOUSEMOVE="blank:mousemove",r.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",r.BLANK_MOUSEUP="blank:mouseup",r.BLANK_CLICK="blank:click",r.BLANK_CONTEXTMENU="blank:contextmenu",r.SELECTION_MOUSEDOWN="selection:mousedown",r.SELECTION_DRAGSTART="selection:dragstart",r.SELECTION_DRAG="selection:drag",r.SELECTION_DROP="selection:drop",r.SELECTION_MOUSEMOVE="selection:mousemove",r.SELECTION_MOUSEUP="selection:mouseup",r.SELECTION_CONTEXTMENU="selection:contextmenu",r.CONNECTION_NOT_ALLOWED="connection:not-allowed",r.TEXT_MOUSEDOWN="text:mousedown",r.TEXT_DRAGSTART="text:dragstart",r.TEXT_DRAG="text:drag",r.TEXT_DROP="text:drop",r.TEXT_CLICK="text:click",r.TEXT_DBCLICK="text:dbclick",r.TEXT_BLUR="text:blur",r.TEXT_MOUSEMOVE="text:mousemove",r.TEXT_MOUSEUP="text:mouseup",r.TEXT_FOCUS="text:focus",r.TEXT_ADD="text:add",r.TEXT_UPDATE="text:update",r.TEXT_CLEAR="text:clear",r.LABEL_MOUSEDOWN="label:mousedown",r.LABEL_DRAGSTART="label:dragstart",r.LABEL_DRAG="label:drag",r.LABEL_DROP="label:drop",r.LABEL_CLICK="label:click",r.LABEL_DBCLICK="label:dbclick",r.LABEL_BLUR="label:blur",r.LABEL_MOUSEMOVE="label:mousemove",r.LABEL_MOUSEUP="label:mouseup",r.LABEL_FOCUS="label:focus",r.LABEL_ADD="label:add",r.LABEL_UPDATE="label:update",r.LABEL_CLEAR="label:clear",r.LABEL_DELETE="label:delete",r.LABEL_SHOULD_ADD="label:should-add",r.LABEL_BATCH_ADD="label:batch-add",r.LABEL_SHOULD_UPDATE="label:should-update",r.LABEL_SHOULD_DELETE="label:should-delete",r.LABEL_BATCH_DELETE="label:batch-delete",r.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",r.HISTORY_CHANGE="history:change",r.GRAPH_TRANSFORM="graph:transform",r.GRAPH_RENDERED="graph:rendered",r.GRAPH_UPDATED="graph:updated",r.EDIT_CONFIG_CHANGED="editConfig:changed"})(kt||(kt={}));var xi;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.INCREASE=1]="INCREASE"})(xi||(xi={}));var vn;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(vn||(vn={}));var ai;(function(r){r.TEXT="text",r.LABEL="label"})(ai||(ai={}));var hj=0,li=function(){function r(e){var t=e.onDragStart,n=t===void 0?Sf:t,i=e.onDragging,o=i===void 0?Sf:i,a=e.onDragEnd,l=a===void 0?Sf:a,u=e.eventType,d=u===void 0?"":u,f=e.eventCenter,h=e.step,g=h===void 0?1:h,y=e.isStopPropagation,w=y===void 0?!0:y,x=e.model,b=e.data,_=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(S){var k,O,M=window==null?void 0:window.document;if(S.button===hj){_.isStopPropagation&&S.stopPropagation(),_.isStartDragging=!0,_.startX=S.clientX,_.startY=S.clientY,M.addEventListener("mousemove",_.handleMouseMove,!1),M.addEventListener("mouseup",_.handleMouseUp,!1);var R=(k=_.model)===null||k===void 0?void 0:k.getData();(O=_.eventCenter)===null||O===void 0||O.emit(kt["".concat(_.eventType,"_MOUSEDOWN")],{e:S,data:_.data||R}),_.startTime=new Date().getTime()}},this.handleMouseMove=function(S){var k,O;if(_.isStopPropagation&&S.stopPropagation(),!!_.isStartDragging&&(_.sumDeltaX+=S.clientX-_.startX,_.sumDeltaY+=S.clientY-_.startY,_.startX=S.clientX,_.startY=S.clientY,_.step<=1||Math.abs(_.sumDeltaX)>_.step||Math.abs(_.sumDeltaY)>_.step)){var M=_.sumDeltaX%_.step,R=_.sumDeltaY%_.step,T=_.sumDeltaX-M,I=_.sumDeltaY-R;_.sumDeltaX=M,_.sumDeltaY=R;var $=(k=_.model)===null||k===void 0?void 0:k.getData();_.isDragging||((O=_.eventCenter)===null||O===void 0||O.emit(kt["".concat(_.eventType,"_DRAGSTART")],{e:S,data:_.data||$}),_.onDragStart({event:S})),_.isDragging=!0,Promise.resolve().then(function(){var ne,V;_.onDragging({deltaX:T,deltaY:I,event:S}),(ne=_.eventCenter)===null||ne===void 0||ne.emit(kt["".concat(_.eventType,"_MOUSEMOVE")],{deltaX:T,deltaY:I,e:S,data:_.data||$}),(V=_.eventCenter)===null||V===void 0||V.emit(kt["".concat(_.eventType,"_DRAG")],{e:S,data:_.data||$})})}},this.handleMouseUp=function(S){var k=window.document;_.isStartDragging=!1,_.isStopPropagation&&S.stopPropagation(),Promise.resolve().then(function(){var O,M,R;k.removeEventListener("mousemove",_.handleMouseMove,!1),k.removeEventListener("mouseup",_.handleMouseUp,!1);var T=(O=_.model)===null||O===void 0?void 0:O.getData();(M=_.eventCenter)===null||M===void 0||M.emit(kt["".concat(_.eventType,"_MOUSEUP")],{e:S,data:_.data||T}),_.isDragging&&(_.isDragging=!1,_.onDragEnd({event:S}),(R=_.eventCenter)===null||R===void 0||R.emit(kt["".concat(_.eventType,"_DROP")],{e:S,data:_.data||T}))})},this.cancelDrag=function(){var S=window==null?void 0:window.document;S.removeEventListener("mousemove",_.handleMouseMove,!1),S.removeEventListener("mouseup",_.handleMouseUp,!1),_.onDragEnd({event:void 0}),_.isDragging=!1},this.destroy=function(){_.isStartDragging&&_.cancelDrag()},this.onDragStart=n,this.onDragging=o,this.onDragEnd=l,this.step=g,this.isStopPropagation=w,this.eventType=d,this.eventCenter=f,this.model=x,this.data=b}return r.prototype.setStep=function(e){this.step=e},r.prototype.setModel=function(e){this.model=e},r}(),pj=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{x:e-n/2,y:t-i/2,x1:e+n/2,y1:t+i/2}},vj=function(r){var e=r.startPoint,t=r.endPoint,n=(e.x+t.x)/2,i=(e.y+t.y)/2,o=Math.abs(e.x-t.x)+10,a=Math.abs(e.y-t.y)+10;return{x:n-o/2,y:i-a/2,x1:n+o/2,y1:i+a/2}},gj=function(r){var e=r.points,t=da(e),n=Pl(t,8),i=n.x,o=n.y,a=n.width,l=n.height;return{x:i-a/2,y:o-l/2,x1:i+a/2,y1:o+l/2}},mj=function(r){var e=r.path,t=tg(e),n=Pl(t,8),i=n.x,o=n.y,a=n.width,l=n.height;return{x:i-a/2,y:o-l/2,x1:i+a/2,y1:o+l/2}},yj=function(r){if(r.modelType===Vt.LINE_EDGE)return vj(r);if(r.modelType===Vt.POLYLINE_EDGE)return gj(r);if(r.modelType===Vt.BEZIER_EDGE)return mj(r)},_j=function(r,e,t,n){var i=(e.y-r.y)*(n.x-t.x)-(r.x-e.x)*(t.y-n.y);if(i===0)return!1;var o=((e.x-r.x)*(n.x-t.x)*(t.y-r.y)+(e.y-r.y)*(n.x-t.x)*r.x-(n.y-t.y)*(e.x-r.x)*t.x)/i,a=-((e.y-r.y)*(n.y-t.y)*(t.x-r.x)+(e.x-r.x)*(n.y-t.y)*r.y-(n.x-t.x)*(e.y-r.y)*t.y)/i;return(o-r.x)*(o-e.x)<=0&&(a-r.y)*(a-e.y)<=0&&(o-t.x)*(o-n.x)<=0&&(a-t.y)*(a-n.y)<=0?{x:o,y:a}:!1},Dl=function(r,e,t){var n=r.x,i=r.y,o=e.x,a=e.y,l=t.x,u=t.y,d=(u-a)/(l-o),f=a-d*o;return(n>=o&&n<=l||n<=o&&n>=l)&&(i>=a&&i<=u||i<=a&&i>=u)&&Math.abs(i-d*n-f)<Number.EPSILON},Ll=function(r){var e=r.start,t=r.end,n=r.offset,i=r.verticalLength,o=r.type,a={leftX:0,leftY:0,rightX:0,rightY:0},l=Math.atan((t.y-e.y)/(t.x-e.x)),u=Math.atan(n/i),d=Math.sqrt(i*i+n*n);return o==="start"?t.x>=e.x?(a.leftX=e.x+d*Math.sin(l+u),a.leftY=e.y-d*Math.cos(l+u),a.rightX=e.x-d*Math.sin(l-u),a.rightY=e.y+d*Math.cos(l-u)):(a.leftX=e.x-d*Math.sin(l+u),a.leftY=e.y+d*Math.cos(l+u),a.rightX=e.x+d*Math.sin(l-u),a.rightY=e.y-d*Math.cos(l-u)):o==="end"&&(t.x>=e.x?(a.leftX=t.x+d*Math.sin(l-u),a.leftY=t.y-d*Math.cos(l-u),a.rightX=t.x-d*Math.sin(l+u),a.rightY=t.y+d*Math.cos(l+u)):(a.leftX=t.x-d*Math.sin(l-u),a.leftY=t.y+d*Math.cos(l-u),a.rightX=t.x+d*Math.sin(l+u),a.rightY=t.y-d*Math.cos(l+u))),a},Ga=function(){return Ga=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ga.apply(this,arguments)},ri=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},ko=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},bj=function(r,e){return Math.abs(r.centerX-e.centerX)*2<r.width+e.width&&Math.abs(r.centerY-e.centerY)*2<r.height+e.height},Ip=function(r){var e=[],t={};return r.forEach(function(n){var i="".concat(n.x,"-").concat(n.y);n.id=i,t[i]=n}),Object.keys(t).forEach(function(n){e.push(t[n])}),e},Cd=function(r,e){return r.width===0&&r.height===0?r:{x:r.x,y:r.y,centerX:r.centerX,centerY:r.centerY,minX:r.minX-e,minY:r.minY-e,maxX:r.maxX+e,maxY:r.maxY+e,height:r.height+2*e,width:r.width+2*e}},xj=function(r,e){var t=Math.abs(r.x-e.centerX),n=Math.abs(r.y-e.centerY);return t/e.width>n/e.height?vn.HORIZONTAL:vn.VERTICAL},kd=function(r,e,t){var n=xj(t,e);return n===vn.HORIZONTAL?{x:t.x>r.centerX?r.maxX:r.minX,y:t.y}:{x:t.x,y:t.y>r.centerY?r.maxY:r.minY}},p_=function(r,e){var t=Math.min(r.minX,e.minX),n=Math.min(r.minY,e.minY),i=Math.max(r.maxX,e.maxX),o=Math.max(r.maxY,e.maxY);return{x:(t+i)/2,y:(n+o)/2,centerX:(t+i)/2,centerY:(n+o)/2,minX:t,minY:n,maxX:i,maxY:o,height:o-n,width:i-t}},Pl=function(r,e){r===void 0&&(r=[]);var t=[],n=[];r.forEach(function(f){t.push(f.x),n.push(f.y)});var i=Math.min.apply(Math,ko([],ri(t),!1)),o=Math.max.apply(Math,ko([],ri(t),!1)),a=Math.min.apply(Math,ko([],ri(n),!1)),l=Math.max.apply(Math,ko([],ri(n),!1)),u=o-i,d=l-a;return e&&(u+=e,d+=e),{centerX:(i+o)/2,centerY:(a+l)/2,maxX:o,maxY:l,minX:i,minY:a,x:(i+o)/2,y:(a+l)/2,height:d,width:u}},Od=function(r){var e=r.minX,t=r.minY,n=r.maxX,i=r.maxY;return[{x:e,y:t},{x:n,y:t},{x:n,y:i},{x:e,y:i}]},Wu=function(r,e){var t=r.x,n=r.y;return t<e.minX||t>e.maxX||n<e.minY||n>e.maxY},wj=function(r,e){return e<r.minX||e>r.maxX?[]:[{x:e,y:r.minY},{x:e,y:r.maxY}]},Sj=function(r,e){return e<r.minY||e>r.maxY?[]:[{x:r.minX,y:e},{x:r.maxX,y:e}]},Ej=function(r,e){return ko(ko([],ri(wj(r,e.x)),!1),ri(Sj(r,e.y)),!1)},Bp=function(r,e){return Math.abs(r.x-e.x)+Math.abs(r.y-e.y)},Cj=function(r,e){var t=-2,n=0;return e.forEach(function(i){i&&(r.x===i.x&&(n+=t),r.y===i.y&&(n+=t))}),n},v_=function(r,e,t,n,i){return Bp(r,e)+Bp(r,t)+Cj(r,[e,t,n,i])},Yx=function(r,e,t,n,i){i||(i=0),r.unshift(e[n]),t[n]&&t[n]!==n&&i<=100&&Yx(r,e,t,t[n],i+1)},kj=function(r,e){var t=r.indexOf(e);t>-1&&r.splice(t,1)},dl=function(r,e,t,n){var i=e.x-r.x,o=e.y-r.y,a=n.x-t.x,l=n.y-t.y,u=(-o*(r.x-t.x)+i*(r.y-t.y))/(-a*o+i*l),d=(a*(r.y-t.y)-l*(r.x-t.x))/(-a*o+i*l);return u>=0&&u<=1&&d>=0&&d<=1},g_=function(r,e,t){if(t.width===0&&t.height===0)return!1;var n=ri(Od(t),4),i=n[0],o=n[1],a=n[2],l=n[3];return dl(r,e,i,o)||dl(r,e,i,l)||dl(r,e,o,a)||dl(r,e,a,l)},Oj=function(r,e,t,n){var i=[];return r.forEach(function(o){o!==e&&(o.x===e.x||o.y===e.y)&&!g_(o,e,t)&&!g_(o,e,n)&&i.push(o)}),Ip(i)},Nj=function(r,e,t,n,i,o,a){var l=[],u=[e],d={},f={},h={};e.id&&(f[e.id]=0,h[e.id]=v_(e,t,e));var g={};r.forEach(function(x){x.id&&(g[x.id]=x)});for(var y=function(){var x,b=1/0;if(u.forEach(function(S){S.id&&h[S.id]<b&&(b=h[S.id],x=S)}),x===t&&t.id){var _=[];return Yx(_,g,d,t.id),{value:_}}if(!x)return{value:[e,t]};kj(u,x),l.push(x),Oj(r,x,n,i).forEach(function(S){if(l.indexOf(S)===-1&&(u.indexOf(S)===-1&&u.push(S),x!=null&&x.id&&(S!=null&&S.id))){var k=h[x.id]+Bp(x,S);if(f[S.id]&&k>=f[S.id])return;d[S.id]=x.id,f[S.id]=k,h[S.id]=f[S.id]+v_(S,t,e,o,a)}})};u.length;){var w=y();if(typeof w=="object")return w.value}return[e,t]},m_=function(r){return Xr(r)},Kx=function(r){for(var e=1;e<r.length-1;){var t=r[e-1],n=r[e],i=r[e+1];t.x===n.x&&n.x===i.x||t.y===n.y&&n.y===i.y?r.splice(e,1):e++}return r},y_=function(r,e,t,n,i){var o=m_(t),a=m_(n),l=Cd(o,i),u=Cd(a,i),d=kd(l,o,r),f=kd(u,a,e);if(bj(l,u)){var h=Aj(r,e,d,f);return ko(ko([r,d],ri(h),!1),[f,e],!1)}var g=Pl([d,f]),y=p_(l,g),w=p_(u,g),x=[];x=x.concat(Od(y)),x=x.concat(Od(w));var b={x:(r.x+e.x)/2,y:(r.y+e.y)/2};[g,y,w].forEach(function(S){x=x.concat(Ej(S,b).filter(function(k){return Wu(k,l)&&Wu(k,u)}))}),[{x:d.x,y:f.y},{x:f.x,y:d.y}].forEach(function(S){Wu(S,l)&&Wu(S,u)&&x.push(S)}),x.unshift(d),x.push(f),x=Ip(x);var _=Nj(x,d,f,o,a,r,e);return _.unshift(r),_.push(e),_.length>2&&(_=Kx(_)),Ip(_)},Mj=function(r){if(r.length===1){var e=ri(r,1),t=e[0];return[t,t]}else{for(var n=r[0],i=r[1],o=wi(n.x,n.y,i.x,i.y),a=1;a<r.length-1;a++){var l=r[a],u=r[a+1],d=wi(l.x,l.y,u.x,u.y);d>o&&(o=d,n=l,i=u)}return[n,i]}},__=function(r,e,t){var n=ao(r,t),i=ao(e,t);return n&&i},b_=function(r,e,t){var n=ao(r,t),i=ao(e,t),o=n&&i,a=n||i;return!o&&a},x_=function(r,e,t){for(var n=void 0,i=Xr(t),o=Od(i),a=0;a<o.length;a++){var l=dl(r,e,o[a],o[(a+1)%o.length]);l&&(n=[o[a],o[(a+1)%o.length]])}if(n)return _j(r,e,n[0],n[1])},Nd=function(r,e){var t=void 0;return r.x===e.x?t=vn.VERTICAL:r.y===e.y&&(t=vn.HORIZONTAL),t},da=function(r){var e=r.split(" "),t=[];return e&&e.forEach(function(n){var i=ri(n.split(","),2),o=i[0],a=i[1];t.push({x:Number(o),y:Number(a)})}),t},Aj=function(r,e,t,n){var i=[],o=Nd(r,t),a=Nd(e,n);if(o===a)r.y===t.y?(i.push({x:t.x,y:(t.y+n.y)/2}),i.push({x:n.x,y:(t.y+n.y)/2})):(i.push({x:(t.x+n.x)/2,y:t.y}),i.push({x:(t.x+n.x)/2,y:n.y}));else{var l={x:t.x,y:n.y},u=Dl(l,r,t),d=Dl(l,e,n);if(u||d)l={x:n.x,y:t.y};else{var f=w_(l,r,t),h=w_(l,e,n);f&&h&&(l={x:n.x,y:t.y})}i.push(l)}return i},w_=function(r,e,t){return r.x===e.x&&r.x===t.x||r.y===e.y&&r.y===t.y},Jx=function(r){if(!r)return 0;for(var e=0,t=0;t<r.length;t++){var n=r.charCodeAt(t);r.match(/[A-Z]/)?e+=1.5:n>=1&&n<=126||n>=65376&&n<=65439?e+=1:e+=2}return e},Tj=function(r){var e=r.start,t=r.end,n;if(e.x===t.x&&e.y===t.y)n="";else{var i={start:e,end:t,offset:10,verticalLength:5},o=Ll(Ga(Ga({},i),{type:"start"})),a=Ll(Ga(Ga({},i),{type:"end"}));n="M".concat(o.leftX," ").concat(o.leftY,`
    L`).concat(o.rightX," ").concat(o.rightY,`
    L`).concat(a.rightX," ").concat(a.rightY,`
    L`).concat(a.leftX," ").concat(a.leftY," z")}return{d:n,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},S_=function(r){var e=r.start,t=r.end,n=r.sourceNode,i=r.targetNode,o=r.offset,a=Xr(n),l=Xr(i),u=Cd(a,o),d=Cd(l,o),f=kd(u,a,e),h=kd(d,l,t);return{sNext:f,ePre:h}},tg=function(r){var e=r.replace(/M/g,"").replace(/C/g,",").split(","),t=Uu(e[0]),n=Uu(e[1]),i=Uu(e[2]),o=Uu(e[3]);return[t,n,i,o]},Uu=function(r){var e=ri(r.replace(/(^\s*)/g,"").split(" "),2),t=e[0],n=e[1];return{x:+t,y:+n}},E_=function(r,e){var t=ri(r,4),n=t[0],i=t[1],o=t[2],a=t[3],l=x5(n,i,o,a,e);return[l,r[3]]},Zx=function(r,e){for(var t=r.x,n=r.y,i=da(e),o=Number.MAX_SAFE_INTEGER,a,l=[],u=0;u<i.length;u++)l.push({start:i[u],end:i[(u+1)%i.length]});if(l.forEach(function(g){var y=g.start,w=g.end;if(y.x===w.x){var x={x:y.x,y:n},b=Dl(x,y,w);if(b){var _=Math.abs(y.x-t);_<o&&(o=_,a=x)}}else if(y.y===w.y){var x={x:t,y:y.y},b=Dl(x,y,w);if(b){var _=Math.abs(y.y-n);_<o&&(o=_,a=x)}}}),!a){var d=l[0],f=d.start,h=d.end;a={x:f.x+(h.x-f.x)/2,y:f.y+(h.y-f.y)/2}}return a},Dj=function(r){return Va(r,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},C_=function(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))};function Lj(r,e){return typeof e!="function"?function(t,n,i){return Object.assign({type:r.edgeType},i)}:function(t,n,i){var o=e(t,n,i);return o?typeof o=="string"?Object.assign({},i,{type:o}):Object.assign({type:o},i):{type:r.edgeType}}}var Pj=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return un(e,function(o){var a=Jx(o);i=a>i?a:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},ja=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Vu=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};function ds(r,e,t){return t&&e*Math.round(r/e)||r}function Rj(r,e,t){if(!r)return[];var n=Math.min.apply(Math,Vu([],ja(r.map(function(x){return x[0]})),!1)),i=Math.max.apply(Math,Vu([],ja(r.map(function(x){return x[0]})),!1)),o=Math.min.apply(Math,Vu([],ja(r.map(function(x){return x[1]})),!1)),a=Math.max.apply(Math,Vu([],ja(r.map(function(x){return x[1]})),!1)),l=-n,u=-o,d=r.map(function(x){var b=ja(x,2),_=b[0],S=b[1];return[_+l,S+u]}),f=i-n,h=a-o,g=e?e/f:1,y=t?t/h:1,w=Math.min(g,y);return d.map(function(x){var b=ja(x,2),_=b[0],S=b[1];return[_*w,S*w]})}var Af=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Tf=function(r,e,t){var n=Af(r,2),i=n[0],o=n[1],a=Af(e,2),l=a[0],u=a[1],d=Af(t,2),f=d[0],h=d[1];return i>l&&i<f&&o>u&&o<h},Qx=function(r,e){var t=e.multipleSelectKey,n=!1;switch(t){case"meta":n=r.metaKey;break;case"alt":n=r.altKey;break;case"shift":n=r.shiftKey;break;case"ctrl":n=r.ctrlKey;break;default:n=!1;break}return n},ng=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function k_(r,e){return r instanceof ar&&e instanceof ar}var ew=function(r){ng(e,r);function e(t,n,i){var o=r.call(this,3)||this;return o[0]=t,o[1]=n,o[2]=i,o.x=t,o.y=n,o.z=i,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.add=function(t){if(k_(this,t))return new ar(this.x+t.x,this.y+t.y);var n=this.z+t.z;return new jp((this.x+t.x)/n,(this.y+t.y)/n)},e.prototype.subtract=function(t){if(k_(this,t))return new ar(this.x-t.x,this.y-t.y);var n=this.z-t.z;return n===0?new ar(this.x-t.x,this.y-t.y):new jp((this.x-t.x)/n,(this.y-t.y)/n)},e}(Array),ar=function(r){ng(e,r);function e(t,n,i){var o=r.call(this,t,n,i??0)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var n=this;return t.reduce(function(i,o,a){return i+o*n[a]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var n=this.crossZ(t),i=Math.acos(this.normalize().dot(t.normalize()));return n>=0?i:-i},e}(ew),jp=function(r){ng(e,r);function e(t,n){var i=r.call(this,t,n,1)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Point"},e}(ew),wc=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ha=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Df=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},ru=function(r){wc(e,r);function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=r.call(this,t.length)||this;return i.fill(new Array(3)),t.forEach(function(o,a){i[a]=o}),i.columns=t[0].length,i.rows=t.length,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return Df([],Ha(this.map(function(n){return n[t]})),!1)},e.prototype.transpose=function(){for(var t=[],n=0;n<this.columns;n++)t.push(this.getColumn(n));return new(e.bind.apply(e,Df([void 0],Ha(t),!1)))},e.prototype.cross=function(t){var n=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var i=0;i<this.rows;i++)for(var o=this.getRow(i),a=function(u){var d=t.getColumn(u);n[i][u]=o.reduce(function(f,h,g){return f+h*d[g]},0)},l=0;l<t.columns;l++)a(l);return new(e.bind.apply(e,Df([void 0],Ha(n),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new jp(t[0],t[1])})},e.prototype.toString=function(){var t=Ha(this[0],2),n=t[0],i=t[1],o=Ha(this[1],2),a=o[0],l=o[1],u=Ha(this[2],2),d=u[0],f=u[1];return"matrix(".concat(n," ").concat(i," ").concat(a," ").concat(l," ").concat(d," ").concat(f,")")},e.prototype.translate=function(t,n){return this.cross(new Md(t,n))},e.prototype.rotate=function(t){return this.cross(new Ij(t))},e.prototype.scale=function(t,n){return this.cross(new Bj(t,n))},e}(Array),Ij=function(r){wc(e,r);function e(t){var n=r.call(this,new ar(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new ar(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new ar(0,0,1))||this;return Object.setPrototypeOf(n,e.prototype),n}return e.prototype.inverse=function(){return this.transpose()},e}(ru),Bj=function(r){wc(e,r);function e(t,n){var i=r.call(this,new ar(t,0,0),new ar(0,n,0),new ar(0,0,1))||this;return i.sx=t,i.sy=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(ru),Md=function(r){wc(e,r);function e(t,n){var i=r.call(this,new ar(1,0,0),new ar(0,1,0),new ar(t,n,1))||this;return i.tx=t,i.ty=n,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(ru);p4({});var Ad=function(){return Ad=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ad.apply(this,arguments)},jj=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Hp=function(r){var e=r.anchors;return e},Td=function(r,e){for(var t=e.nodes,n,i=t.length-1;i>=0;i--){var o=t[i],a=Fj(r,o);if(a){var l=o.getTargetAnchor(r);if(l){var u={node:o,anchorIndex:l.index,anchor:l.anchor};(!n||Hj(o,n.node,e))&&(n=u)}}}return n},Hj=function(r,e,t){return r.zIndex>e.zIndex?!0:t.nodesMap[r.id].index>t.nodesMap[e.id].index},$j=function(r,e){for(var t=Hp(e),n,i=Number.MAX_SAFE_INTEGER,o=0;o<t.length;o++){var a=wi(r.x,r.y,t[o].x,t[o].y);a<i&&(i=a,n={index:o,anchor:Ad(Ad({},t[o]),{x:t[o].x,y:t[o].y,id:t[o].id})})}return n},wi=function(r,e,t,n){return Math.hypot(r-t,e-n)},ao=function(r,e,t){t===void 0&&(t=0);var n=!1,i=Xr(e),o=jj(new ru([r.x,r.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),a=o[0],l=o[1],u={x:a,y:l};return u.x>=i.minX-t&&u.x<=i.maxX+t&&u.y>=i.minY-t&&u.y<=i.maxY+t&&(n=!0),n},Fj=function(r,e){return ao(r,e,5)},Xr=function(r){var e=r.x,t=r.y,n=r.width,i=r.height;return{minX:e-n/2,minY:t-i/2,maxX:e+n/2,maxY:t+i/2,x:e,y:t,width:n,height:i,centerX:e,centerY:t}},zj=function(r){var e=r,t=e.x,n=e.y,i=e.width,o=e.height,a=e.radius;return[{x:t-i/2+a,y:n-o/2+a,r:a},{x:t+i/2-a,y:n-o/2+a,r:a},{x:t-i/2+a,y:n+o/2-a,r:a},{x:t+i/2-a,y:n+o/2-a,r:a}]},O_=function(r,e,t){var n=zj(t),i,o=Number.MAX_SAFE_INTEGER;return n.forEach(function(a){var l=wi(r.x,r.y,a.x,a.y);l<o&&(o=l,i=a)}),$p(r,e,i)},$p=function(r,e,t){var n,i=t.x,o=t.y,a=t.r;if(e===vn.HORIZONTAL){var l=i-Math.sqrt(a*a-(r.y-o)*(r.y-o)),u=i+Math.sqrt(a*a-(r.y-o)*(r.y-o)),d=Math.abs(l-r.x)<Math.abs(u-r.x)?l:u;n={x:d,y:r.y}}else if(e===vn.VERTICAL){var f=o-Math.sqrt(a*a-(r.x-i)*(r.x-i)),h=o+Math.sqrt(a*a-(r.x-i)*(r.x-i)),g=Math.abs(f-r.y)<Math.abs(h-r.y)?f:h;n={x:r.x,y:g}}return n},N_=function(r,e){var t=e,n=!1,i=t.x,o=t.y,a=t.width,l=t.height,u=t.radius,d={minX:i-a/2+u,maxX:i+a/2-u,minY:o-l/2+u,maxY:o+l/2-u};return r.y===o+l/2||r.y===o-l/2?n=r.x>d.minX&&r.x<d.maxX:(r.x===i+a/2||r.x===i-a/2)&&(n=r.y>d.minY&&r.y<d.maxY),n},M_=function(r,e,t){var n,i=t,o=i.x,a=i.y,l=i.rx,u=i.ry;if(e===vn.HORIZONTAL){var d=o-Math.sqrt(l*l-(r.y-a)*(r.y-a)*l*l/(u*u)),f=o+Math.sqrt(l*l-(r.y-a)*(r.y-a)*l*l/(u*u)),h=Math.abs(d-r.x)<Math.abs(f-r.x)?d:f;n={x:h,y:r.y}}else if(e===vn.VERTICAL){var g=a-Math.sqrt(u*u-(r.x-o)*(r.x-o)*u*u/(l*l)),y=a+Math.sqrt(u*u-(r.x-o)*(r.x-o)*u*u/(l*l)),w=Math.abs(g-r.y)<Math.abs(y-r.y)?g:y;n={x:r.x,y:w}}return n},qu=function(r,e,t){for(var n=t.pointsPosition,i=Number.MAX_SAFE_INTEGER,o,a=[],l=0;l<n.length;l++)a.push({start:n[l],end:n[(l+1)%n.length]});return a.forEach(function(u){var d=u.start,f=u.end,h=d,g=f;d.x>f.x&&(h=f,g=d);var y={x:r.x,y:r.y};if(h.x===g.x&&e===vn.HORIZONTAL&&(y={x:h.x,y:r.y}),h.y===g.y&&e===vn.VERTICAL&&(y={x:r.x,y:h.y}),h.x!==g.x&&h.y!==g.y){var w=(g.y-h.y)/(g.x-h.x),x=(h.x*g.y-g.x*h.y)/(h.x-g.x);e===vn.HORIZONTAL?y={x:(r.y-x)/w,y:r.y}:e===vn.VERTICAL&&(y={x:r.x,y:w*r.x+x})}var b=Dl(y,d,f);if(b){var _=wi(y.x,y.y,r.x,r.y);_<i&&(i=_,o=y)}}),o},Wj=function(r){var e=Va(r,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},A_=function(r,e,t,n){var i=r.x,o=r.y;return e.x>r.x?i=r.x+t/2:e.x<r.x&&(i=r.x-t/2),e.y>r.y?o=r.y+n/2:e.y<r.y&&(o=r.y-n/2),{x:i,y:o}},tw=function(r){var e=r.rows,t=r.style,n=r.rowsLength,i=r.className,o=document.createElement("div");o.className=i,o.style.fontSize="".concat(t.fontSize),o.style.width="".concat(t.width),o.style.lineHeight="".concat(t.lineHeight),o.style.padding="".concat(t.padding),t.fontFamily&&(o.style.fontFamily="".concat(t.fontFamily)),n>1?e.forEach(function(l){var u=document.createElement("div");u.textContent=l,o.appendChild(u)}):o.textContent=e[0],document.body.appendChild(o);var a=o.clientHeight;return document.body.removeChild(o),a},T_=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,i=0;return e&&e.forEach(function(o){var a=Jx(o);i=a>i?a:i}),{width:Math.ceil(i/2)*n+n/4,height:t*(n+2)+n/4}},Dd=function(r){return typeof r!="object"?{isAllPass:!!r,msg:r?"":"不允许连接"}:r};let Xu;const Uj=new Uint8Array(16);function Vj(){if(!Xu&&(Xu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xu(Uj)}const rr=[];for(let r=0;r<256;++r)rr.push((r+256).toString(16).slice(1));function qj(r,e=0){return rr[r[e+0]]+rr[r[e+1]]+rr[r[e+2]]+rr[r[e+3]]+"-"+rr[r[e+4]]+rr[r[e+5]]+"-"+rr[r[e+6]]+rr[r[e+7]]+"-"+rr[r[e+8]]+rr[r[e+9]]+"-"+rr[r[e+10]]+rr[r[e+11]]+rr[r[e+12]]+rr[r[e+13]]+rr[r[e+14]]+rr[r[e+15]]}const Xj=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),D_={randomUUID:Xj};function Gj(r,e,t){if(D_.randomUUID&&!r)return D_.randomUUID();r=r||{};const n=r.random||(r.rng||Vj)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,qj(n)}var No=function(){return Gj()},pl=new Map,nw=function(r){var e=No();function t(){r();var i=pl.get(e);if(i){var o=window.requestAnimationFrame(t);pl.set(e,o)}}var n=window.requestAnimationFrame(t);return pl.set(e,n),e},Ld=function(r){var e=pl.get(r);e&&(window.cancelAnimationFrame(e),pl.delete(r))},Rl=function(){return Rl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Rl.apply(this,arguments)},Yj=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function rw(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.value,a=r.fontSize,l=a===void 0?12:a,u=r.fill,d=u===void 0?"currentColor":u,f=r.overflowMode,h=f===void 0?"default":f,g=r.textWidth,y=g===void 0?void 0:g,w=r.model,x={x:t,y:i,fill:d,fontSize:l,textAnchor:"middle",dominantBaseline:"central"};if(un(To(r),function(M){var R=Yj(M,2),T=R[0],I=R[1];typeof I!="object"&&(x[T]=I)}),o){var b=String(o).split(/[\r\n]/g),_=b.length;if(h!=="default"){var S=w.BaseType,k=w.modelType;if(S===Sn.NODE&&k!==Vt.TEXT_NODE||S===Sn.EDGE&&y)return Kj(r)}if(_>1){var O=b.map(function(M,R){var T=l+2,I=(R-(_-1)/2)*T;return Te("tspan",{className:"lf-text-tspan",x:t,y:i+I,children:M})});return Te("text",Rl({},x,{children:O}))}return Te("text",Rl({},x,{children:o}))}return null}function Kj(r){var e=r.x,t=r.y,n=r.value,i=r.model,o=r.textWidth,a=r.fontSize,l=a===void 0?12:a,u=r.lineHeight,d=r.fontFamily,f=d===void 0?"":d,h=r.wrapPadding,g=h===void 0?"0, 0":h,y=r.overflowMode,w=i.width,x=i.height,b=i.textHeight,_=o||w,S=String(n).split(/[\r\n]/g),k=S.length,O=tw({rows:S,style:{fontSize:"".concat(l,"px"),width:"".concat(_,"px"),fontFamily:f,lineHeight:u,padding:g},rowsLength:k,className:"lf-get-text-height"}),M=x>O?x:O;b&&(M=b);var R=y==="ellipsis";return R&&(M=l+2),Te("g",{children:Te("foreignObject",{width:_,height:M,x:e-_/2,y:t-M/2,style:{overflow:"visible",textAlign:"left"},children:Te("div",{className:"lf-node-text-auto-wrap",style:{minHeight:M,width:_,padding:g},children:Te("div",{className:R?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:R?S.join(""):"",style:Rl({},r),children:S.map(function(T){return Te("div",{className:"lf-node-text--auto-wrap-inner",children:T})})})})})})}var Fp=function(){return Fp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Fp.apply(this,arguments)},Jj=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function cs(r){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return un(To(r),function(t){var n=Jj(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),Te("line",Fp({},e))}var zp=function(){return zp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},zp.apply(this,arguments)},Zj=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function ii(r){var e=r.x,t=r.y,n=r.width,i=r.height,o=r.className,a=r.strokeWidth,l=r.radius,u=l===void 0?0:l,d=e-n/2,f=t-i/2,h={};return h["stroke-width"]=a,un(To(r),function(g){var y=Zj(g,2),w=y[0],x=y[1];typeof x!="object"&&(h[w]=x)}),o?h.className="lf-basic-shape ".concat(o):h.className="lf-basic-shape",u&&(h.rx=u,h.ry=u),h.x=d,h.y=f,Te("rect",zp({},h))}var Wp=function(){return Wp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wp.apply(this,arguments)},Qj=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function Il(r){var e={d:""};return un(To(r),function(t){var n=Qj(t,2),i=n[0],o=n[1];(i==="style"||typeof o!="object")&&(e[i]=o)}),Te("path",Wp({},e))}var Up=function(){return Up=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Up.apply(this,arguments)},e5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function fs(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.r,a=o===void 0?4:o,l=r.className,u={cx:t,cy:i,r:a,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return un(To(r),function(d){var f=e5(d,2),h=f[0],g=f[1];typeof g!="object"&&(u[h]=g)}),l?u.className="lf-basic-shape ".concat(l):u.className="lf-basic-shape",Te("circle",Up({},u))}var Vp=function(){return Vp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Vp.apply(this,arguments)},t5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function n5(r){var e=r.x,t=e===void 0?0:e,n=r.y,i=n===void 0?0:n,o=r.rx,a=o===void 0?4:o,l=r.ry,u=l===void 0?4:l,d=r.className,f={cx:t,cy:i,rx:a,ry:u,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return un(To(r),function(h){var g=t5(h,2),y=g[0],w=g[1];typeof w!="object"&&(f[y]=w)}),d?f.className="lf-basic-shape ".concat(d):f.className="lf-basic-shape",Te("ellipse",Vp({},f))}var Pd=function(){return Pd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Pd.apply(this,arguments)},r5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function i5(r,e){var t=r.map(function(S){return{x:S[0],y:S[1]}}),n=t.length;if(n<3)return"";for(var i=Math.abs(e),o="",a=0;a<n;a++){var l=t[(a-1+n)%n],u=t[a],d=t[(a+1)%n],f={x:u.x-l.x,y:u.y-l.y},h={x:d.x-u.x,y:d.y-u.y},g=Math.hypot(f.x,f.y),y=Math.hypot(h.x,h.y),w={x:f.x/g,y:f.y/g},x={x:h.x/y,y:h.y/y},b={x:u.x-w.x*i,y:u.y-w.y*i},_={x:u.x+x.x*i,y:u.y+x.y*i};a===0?o+="M ".concat(b.x," ").concat(b.y," "):o+="L ".concat(b.x," ").concat(b.y," "),o+="Q ".concat(u.x," ").concat(u.y," ").concat(_.x," ").concat(_.y," ")}return o+="Z",o}function rg(r){var e=r.points,t=e===void 0?[]:e,n=r.className,i=r.radius,o={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(un(To(r),function(l){var u=r5(l,2),d=u[0],f=u[1];typeof f!="object"&&(o[d]=f)}),n?o.classNmae="lf-basic-shape ".concat(n):o.className="lf-basic-shape",i){var a=i5(t,i);return o.d=a,Te("path",Pd({},o))}else return o.points=t.map(function(l){return l.join(",")}).join(" "),Te("polygon",Pd({},o))}var qp=function(){return qp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},qp.apply(this,arguments)},o5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o};function a5(r){var e=r.className,t={points:"",fill:"none"};return un(To(r),function(n){var i=o5(n,2),o=i[0],a=i[1];(o==="style"||typeof a!="object")&&(t[o]=a)}),e&&(t.className="".concat(e)),Te("polyline",qp({},t))}var iw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bl=function(){return Bl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bl.apply(this,arguments)},s5=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},l5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},nn;(function(r){r[r.LEFT_TOP=0]="LEFT_TOP",r[r.RIGHT_TOP=1]="RIGHT_TOP",r[r.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",r[r.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(nn||(nn={}));var u5=function(r){iw(e,r);function e(t){var n=r.call(this)||this;n.isShiftPressed=!1,n.bindKeyboardEvents=function(){document.addEventListener("keydown",n.handleKeyDown),document.addEventListener("keyup",n.handleKeyUp)},n.handleKeyDown=function(l){l.key==="Shift"&&(n.isShiftPressed=!0)},n.handleKeyUp=function(l){l.key==="Shift"&&(n.isShiftPressed=!1)},n.updateEdgePointByAnchors=function(){var l=n.nodeModel,u=l.id,d=l.anchors,f=n.graphModel.getNodeEdges(u);un(f,function(h){if(h.sourceNodeId===u){var g=la(d,function(y){return y.id===h.sourceAnchorId});g&&h.updateStartPoint({x:g.x,y:g.y})}else if(h.targetNodeId===u){var g=la(d,function(w){return w.id===h.targetAnchorId});g&&h.updateEndPoint({x:g.x,y:g.y})}})},n.triggerResizeEvent=function(l,u,d,f,h,g){n.graphModel.eventCenter.emit(kt.NODE_RESIZE,{preData:l,data:u,deltaX:d,deltaY:f,index:h,model:g})},n.recalcResizeInfo=function(l,u,d,f,h){d===void 0&&(d=1),f===void 0&&(f=!1),h===void 0&&(h=!1);var g=Ht(u),y=g.deltaX,w=g.deltaY,x=g.width,b=g.height,_=g.PCTResizeInfo;if(_){var S=4,k=0,O=0;switch(l){case nn.LEFT_TOP:O=(y*-1-w)/S;break;case nn.RIGHT_TOP:O=(y-w)/S;break;case nn.RIGHT_BOTTOM:O=(y+w)/S;break;case nn.LEFT_BOTTOM:O=(y*-1+w)/S;break}O!==0&&(k=Math.round(O/_.ResizeBasis.basisHeight*1e5)/1e3),_.ResizePCT.widthPCT=Math.max(Math.min(_.ResizePCT.widthPCT+k,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit),_.ResizePCT.heightPCT=Math.max(Math.min(_.ResizePCT.heightPCT+k,_.ScaleLimit.maxScaleLimit),_.ScaleLimit.minScaleLimit);var M=Math.round(_.ResizePCT.widthPCT*_.ResizeBasis.basisWidth/100),R=Math.round(_.ResizePCT.heightPCT*_.ResizeBasis.basisHeight/100);switch(l){case nn.LEFT_TOP:y=x-M,w=b-R;break;case nn.RIGHT_TOP:y=M-x,w=b-R;break;case nn.RIGHT_BOTTOM:y=M-x,w=R-b;break;case nn.LEFT_BOTTOM:y=x-M,w=R-b;break}return g}switch(l){case nn.LEFT_TOP:g.width=f?x:x-y*d,g.height=h?b:b-w*d;break;case nn.RIGHT_TOP:g.width=f?x:x+y*d,g.height=h?b:b-w*d;break;case nn.RIGHT_BOTTOM:g.width=f?x:x+y*d,g.height=h?b:b+w*d;break;case nn.LEFT_BOTTOM:g.width=f?x:x-y*d,g.height=h?b:b+w*d;break}return g},n.resizeNode=function(l){var u=l.deltaX,d=l.deltaY,f=n.index,h=n.props,g=h.model,y=h.graphModel,w=h.x,x=h.y;ow({x:w,y:x,deltaX:u,deltaY:d,index:f,nodeModel:g,graphModel:y,forceProportional:n.isShiftPressed,cancelCallback:function(){n.dragHandler.cancelDrag()}})},n.onDragStart=function(){n.graphModel.selectNodeById(n.nodeModel.id)},n.onDragging=function(l){var u=l.deltaX,d=l.deltaY,f=n.graphModel.transformModel,h=l5(f.fixDeltaXY(u,d),2),g=h[0],y=h[1];n.resizeNode({deltaX:g,deltaY:y})},n.onDragEnd=function(){var l=n.nodeModel.x,u=n.nodeModel.y;n.nodeModel.moveTo(l,u),n.updateEdgePointByAnchors()};var i=t.index,o=t.model,a=t.graphModel;return n.index=i,n.nodeModel=o,n.graphModel=a,n.dragHandler=new li({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:a.gridSize}),n.bindKeyboardEvents(),n}return e.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.direction,a=t.model,l=a.getResizeControlStyle(),u=l.width,d=l.height,f=s5(l,["width","height"]);return Te("g",{className:"lf-resize-control lf-resize-control-".concat(o),children:[Te(ii,Bl({className:"lf-resize-control-content",x:n,y:i,width:u??7,height:d??7},f)),Te(ii,{className:"lf-resize-control-content",x:n,y:i,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(Yt),d5=function(r){iw(e,r);function e(){return r.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=Xr(n),a=o.minX,l=o.minY,u=o.maxX,d=o.maxY,f=[{index:nn.LEFT_TOP,direction:"nw",x:a,y:l},{index:nn.RIGHT_TOP,direction:"ne",x:u,y:l},{index:nn.RIGHT_BOTTOM,direction:"se",x:u,y:d},{index:nn.LEFT_BOTTOM,direction:"sw",x:a,y:d}];return so(f,function(h){return Te(u5,Bl({},h,{model:n,graphModel:i}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.getResizeOutlineStyle();return Te(ii,Bl({},l,{x:n,y:i,width:o,height:a}))},e.prototype.render=function(){return Te("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(Yt);function c5(r,e){var t=r.x,n=r.y,i=e.x,o=e.y,a={x:t+(i-t)/2,y:n+(o-n)/2};return a}function cl(r,e,t){var n=f5(t),i=r.x-e.x,o=r.y-e.y,a=i*Math.cos(n)-o*Math.sin(n)+e.x,l=i*Math.sin(n)+o*Math.cos(n)+e.y;return{x:a,y:l}}function f5(r){return r*Math.PI/180}function h5(r){return r/Math.PI*180}function p5(r,e,t,n,i,o,a,l){i===void 0&&(i=!1),o===void 0&&(o=!1);var u={x:t.x-(r.x-t.x),y:t.y-(r.y-t.y)},d=c5(u,e),f=cl(e,d,-n),h=cl(u,d,-n);if(i){var g=Math.abs(f.x-h.x),y=g-a;d.x>f.x?d.x=d.x+y/2:d.x=d.x-y/2}if(o){var w=Math.abs(f.y-h.y),x=w-l;d.y>f.y?d.y=d.y+x/2:d.y=d.y-x/2}if(i||o){var b=cl(h,d,n),_=b.x-u.x,S=b.y-u.y;d.x=d.x-_,d.y=d.y-S,h=cl(u,d,-n),f={x:d.x-(h.x-d.x),y:d.y-(h.y-d.y)}}var k=Math.abs(f.x-h.x),O=Math.abs(f.y-h.y);return i&&(k=a),o&&(O=l),{width:k,height:O,center:d}}function v5(r,e,t,n,i,o,a,l,u){l===void 0&&(l=!1),u===void 0&&(u=!1);var d=e.deltaX,f=e.deltaY,h=e.width,g=e.height,y=h5(t),w={x:n,y:i},x={x:o,y:a},b=cl(w,x,y),_={x:b.x+d,y:b.y+f},S=p5(b,_,x,y,l,u,h,g),k=S.width,O=S.height,M=S.center;return e.width=k*r,e.height=O*r,e.deltaX=(M.x-x.x)*2,e.deltaY=(M.y-x.y)*2,e}var g5=function(r,e,t,n,i,o,a,l,u,d,f){t===void 0&&(t=1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=0),f===void 0&&(f=!1);var h=Ht(e),g=h.deltaX,y=h.deltaY,w=h.width,x=h.height,b=h.PCTResizeInfo;if(b){var _=4,S=0,k=0;switch(r){case nn.LEFT_TOP:k=(g*-1-y)/_;break;case nn.RIGHT_TOP:k=(g-y)/_;break;case nn.RIGHT_BOTTOM:k=(g+y)/_;break;case nn.LEFT_BOTTOM:k=(g*-1+y)/_;break}k!==0&&(S=Math.round(k/b.ResizeBasis.basisHeight*1e5)/1e3),b.ResizePCT.widthPCT=Math.max(Math.min(b.ResizePCT.widthPCT+S,b.ScaleLimit.maxScaleLimit),b.ScaleLimit.minScaleLimit),b.ResizePCT.heightPCT=Math.max(Math.min(b.ResizePCT.heightPCT+S,b.ScaleLimit.maxScaleLimit),b.ScaleLimit.minScaleLimit);var O=Math.round(b.ResizePCT.widthPCT*b.ResizeBasis.basisWidth/100),M=Math.round(b.ResizePCT.heightPCT*b.ResizeBasis.basisHeight/100);switch(r){case nn.LEFT_TOP:g=w-O,y=x-M;break;case nn.RIGHT_TOP:g=O-w,y=x-M;break;case nn.RIGHT_BOTTOM:g=O-w,y=M-x;break;case nn.LEFT_BOTTOM:g=w-O,y=M-x;break}return h}if(o%(2*Math.PI)!==0&&a!==void 0&&l!==void 0)return v5(t,h,o,a,l,u,d,n,i);if(f){var R=w/x,T=0,I=w,$=x;switch(r){case nn.LEFT_TOP:T=Math.abs(g)>Math.abs(y)?-g:-y,R>=1?(I=w+T,$=I/R):($=x+T,I=$*R),h.width=I,h.height=$,h.deltaX=w-I,h.deltaY=x-$;break;case nn.RIGHT_TOP:T=Math.abs(g)>Math.abs(y)?g:-y,R>=1?(I=w+T,$=I/R):($=x-T,I=$*R),h.width=I,h.height=$,h.deltaX=I-w,h.deltaY=x-$;break;case nn.RIGHT_BOTTOM:T=Math.abs(g)>Math.abs(y)?g:y,R>=1?(I=w+T,$=I/R):($=x+T,I=$*R),h.width=I,h.height=$,h.deltaX=I-w,h.deltaY=$-x;break;case nn.LEFT_BOTTOM:T=Math.abs(g)>Math.abs(y)?-g:y,R>=1?(I=w-T,$=I/R):($=x+T,I=$*R),h.width=I,h.height=$,h.deltaX=w-I,h.deltaY=$-x;break}return h}switch(r){case nn.LEFT_TOP:h.width=n?w:w-g*t,h.height=i?x:x-y*t;break;case nn.RIGHT_TOP:h.width=n?w:w+g*t,h.height=i?x:x-y*t;break;case nn.RIGHT_BOTTOM:h.width=n?w:w+g*t,h.height=i?x:x+y*t;break;case nn.LEFT_BOTTOM:h.width=n?w:w-g*t,h.height=i?x:x+y*t;break}return h},m5=function(r,e){var t=r.id,n=r.anchors,i=e.getNodeEdges(t);un(i,function(o){if(o.sourceNodeId===t){var a=la(n,function(l){return l.id===o.sourceAnchorId});a&&o.updateStartPoint({x:a.x,y:a.y})}else if(o.targetNodeId===t){var a=la(n,function(u){return u.id===o.targetAnchorId});a&&o.updateEndPoint({x:a.x,y:a.y})}})},y5=function(r,e,t,n,i,o,a){a.eventCenter.emit(kt.NODE_RESIZE,{preData:r,data:e,deltaX:t,deltaY:n,index:i,model:o})},ow=function(r){var e=r.x,t=r.y,n=r.deltaX,i=r.deltaY,o=r.index,a=r.nodeModel,l=r.graphModel,u=r.cancelCallback,d=r.forceProportional,f=d===void 0?!1:d,h=a.r,g=a.rx,y=a.ry,w=a.width,x=a.height,b=a.PCTResizeInfo,_=a.minWidth,S=a.minHeight,k=a.maxWidth,O=a.maxHeight,M=a.rotate,R=a.x,T=a.y,I=_===k,$=S===O,ne={width:h||g||w,height:h||y||x,deltaX:n,deltaY:i,PCTResizeInfo:b},V=h||g&&y?1/2:1,J=e,D=t,U=g5(o,ne,V,I,$,M,J,D,R,T,f);if(U.width<_||U.width>k||U.height<S||U.height>O){u==null||u();return}(M%(2*Math.PI)==0||b||J===void 0||D===void 0)&&(U.deltaX=I?0:U.deltaX,U.deltaY=$?0:U.deltaY);var j=a.getData(),fe=a.resize(U);j.x===fe.x&&j.y===fe.y||(m5(a,l),y5(j,fe,n,i,o,a,l))},_5=100,b5={x:1,y:0};function x5(r,e,t,n,i){for(var o=function(y){if(y<0||y>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:r.x*Math.pow(1-y,3)+3*e.x*y*Math.pow(1-y,2)+3*t.x*Math.pow(y,2)*(1-y)+n.x*Math.pow(y,3),y:r.y*Math.pow(1-y,3)+3*e.y*y*Math.pow(1-y,2)+3*t.y*Math.pow(y,2)*(1-y)+n.y*Math.pow(y,3)}},a=0,l=2,u=n.x,d=n.y,f=n;a<i&&l<50;){f=o(1-l/_5);var h=f.x,g=f.y;a=wi(u,d,h,g),l++}return f}function w5(r,e){return r.x*e.y-r.y*e.x}function S5(r,e){var t=[r.x,r.y,r.z],n=[e.x,e.y,e.z];return n.reduce(function(i,o,a){return i+o*t[a]})}function E5(r,e){var t=w5(r,e),n=Math.acos(S5(L_(r),L_(e)));return t>=0?n:-n}function L_(r){var e=Math.hypot(r.x,r.y);return{x:r.x/e,y:r.y/e,z:0}}function C5(r){return E5(b5,r)}function k5(r){return r*(180/Math.PI)}var aw={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},O5={rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},N5={baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},M5={rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},jl={colorful:M5,dark:N5,radius:O5,default:aw},A5={background:"#23272e"},T5={background:"#fefeff"},Xp={background:"#ffffff"},Hl={colorful:T5,dark:A5,radius:Xp,default:Xp},D5={color:"#66676a",thickness:1},L5={color:"#dadada",thickness:1},Gp={color:"#acacac",thickness:1},$l={colorful:L5,dark:D5,radius:Gp,default:Gp},sw=function(r,e){var t=Ht(aw);return e&&(t=Qa(t,jl[e])),r&&(t=Qa(t,r)),t},P5=function(r,e){if(jl[r]){console.warn("theme mode ".concat(r," already exists"));return}jl[r]=e,Hl[r]=e.background||Xp,$l[r]=e.grid||Gp},R5=function(r){delete jl[r],delete Hl[r],delete $l[r]},P_=function(){var r={colorful:{},dark:{},radius:{},default:{}};on(jl,r),on(Hl,r),on($l,r)},I5=sw,B5=1e3,j5=999,ig=function(){return++B5},H5=function(){return--j5},Ln=function(){return Ln=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ln.apply(this,arguments)},Lt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Sc=function(){function r(e,t){var n;this.BaseType=Sn.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ai.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=en.DEFAULT,this.modelType=Vt.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initEdgeData(e),this.setAttributes()}return r.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||No()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var o=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=o,on(this,Dj(e));var a=this.graphModel.overlapMode;a===xi.INCREASE&&(this.zIndex=e.zIndex||ig()),this.setAnchors(),this.initPoints(),this.formatText(e)},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.getEdgeStyle=function(){return Ln(Ln({},this.graphModel.theme.baseEdge),this.style)},r.prototype.getAdjustPointStyle=function(){return Ln({},this.graphModel.theme.edgeAdjust)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return Ht(e)},r.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return Ht(e)},r.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),n=this.graphModel.theme.arrow,i=this.isAnimation?t.stroke:e.stroke;return Ln(Ln(Ln({},e),{fill:i,stroke:i}),n)},r.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return Ht(t)},r.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(r.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),r.prototype.getBeginAnchor=function(e,t,n){var i,o,a=Hp(e);if(n){if(i=la(a,function(l){return l.id===n}),i)return i;console.warn("未在节点上找到指定的起点锚点".concat(n,"，已使用默认锚点作为起点"))}return a.forEach(function(l){var u=C_(l,t);(o===void 0||u<o)&&(o=u,i=l)}),i},r.prototype.getEndAnchor=function(e,t){var n=this,i,o,a=Hp(e);if(t){if(i=la(a,function(l){return l.id===t}),i)return i;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return a.forEach(function(l){if(n.startPoint){var u=C_(l,n.startPoint);(o===void 0||u<o)&&(o=u,i=l)}}),i},r.prototype.getProperties=function(){return yi(this.properties)},r.prototype.getData=function(){var e=this.properties;ls(e)&&(e=yi(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:on({},this.startPoint),endPoint:on({},this.endPoint)};this.graphModel.overlapMode===xi.INCREASE&&(t.zIndex=this.zIndex);var n=this.text,i=n.x,o=n.y,a=n.value;return a&&(t.text={x:i,y:o,value:a}),t},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.setProperty=function(e,t){Jv(this.properties,e,vr(t)),this.setAttributes()},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setProperties=function(e){this.properties=Ln(Ln({},yi(this.properties)),vr(e)),this.setAttributes()},r.prototype.changeEdgeId=function(e){var t=this.arrowConfig,n=t.markerEnd,i=t.markerStart;i&&i==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),n&&n==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},r.prototype.setStyle=function(e,t){var n;this.style=Ln(Ln({},this.style),(n={},n[e]=vr(t),n))},r.prototype.setStyles=function(e){this.style=Ln(Ln({},this.style),vr(e))},r.prototype.updateStyles=function(e){this.style=Ln({},vr(e))},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,a=o.edgeTextDraggable,l=o.edgeTextEdit,u=this.textPosition,d=u.x,f=u.y,h=e.text,g={value:"",x:d,y:f,draggable:a,editable:l};h&&(typeof h=="string"?g=Ln(Ln({},g),{value:h}):(g=Ln(Ln({},g),{x:(t=h.x)!==null&&t!==void 0?t:d,y:(n=h.y)!==null&&n!==void 0?n:f,value:(i=h.value)!==null&&i!==void 0?i:""}),es(h.draggable)||(g.draggable=h.draggable),es(h.editable)||(g.editable=h.editable))),this.text=g},r.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,n=e.y;this.text.x=t,this.text.y=n},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,a=n.value,l=n.draggable,u=n.editable;this.text={value:a,editable:u,draggable:l,x:i+e,y:o+t}},r.prototype.setText=function(e){e&&on(this.text,e)},r.prototype.updateText=function(e){this.text=Ln(Ln({},yi(this.text)),{value:e})},r.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.openEdgeAnimation=function(){this.isAnimation=!0},r.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateStartPoint=function(e){this.startPoint=e},r.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},r.prototype.updateEndPoint=function(e){this.endPoint=e},r.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},r.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},r.prototype.initPoints=function(){},r.prototype.updateAttributes=function(e){on(this,e)},r.prototype.getAdjustStart=function(){return this.startPoint},r.prototype.getAdjustEnd=function(){return this.endPoint},r.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,n=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:n.x,y:n.y})},r.BaseType=Sn.EDGE,Lt([De],r.prototype,"type",void 0),Lt([De],r.prototype,"sourceNodeId",void 0),Lt([De],r.prototype,"targetNodeId",void 0),Lt([De],r.prototype,"startPoint",void 0),Lt([De],r.prototype,"endPoint",void 0),Lt([De],r.prototype,"textMode",void 0),Lt([De],r.prototype,"text",void 0),Lt([De],r.prototype,"properties",void 0),Lt([De],r.prototype,"points",void 0),Lt([De],r.prototype,"pointsList",void 0),Lt([De],r.prototype,"isSelected",void 0),Lt([De],r.prototype,"isHovered",void 0),Lt([De],r.prototype,"isHitable",void 0),Lt([De],r.prototype,"isHittable",void 0),Lt([De],r.prototype,"draggable",void 0),Lt([De],r.prototype,"visible",void 0),Lt([De],r.prototype,"isAnimation",void 0),Lt([De],r.prototype,"isShowAdjustPoint",void 0),Lt([De],r.prototype,"zIndex",void 0),Lt([De],r.prototype,"state",void 0),Lt([De],r.prototype,"style",void 0),Lt([De],r.prototype,"arrowConfig",void 0),Lt([fn],r.prototype,"sourceNode",null),Lt([fn],r.prototype,"targetNode",null),Lt([fn],r.prototype,"textPosition",null),Lt([Ae],r.prototype,"setProperty",null),Lt([Ae],r.prototype,"deleteProperty",null),Lt([Ae],r.prototype,"setProperties",null),Lt([Ae],r.prototype,"changeEdgeId",null),Lt([Ae],r.prototype,"setStyle",null),Lt([Ae],r.prototype,"setStyles",null),Lt([Ae],r.prototype,"updateStyles",null),Lt([Ae],r.prototype,"setTextMode",null),Lt([Ae],r.prototype,"formatText",null),Lt([Ae],r.prototype,"resetTextPosition",null),Lt([Ae],r.prototype,"moveText",null),Lt([Ae],r.prototype,"setText",null),Lt([Ae],r.prototype,"updateText",null),Lt([Ae],r.prototype,"setAnchors",null),Lt([Ae],r.prototype,"setSelected",null),Lt([Ae],r.prototype,"setHovered",null),Lt([Ae],r.prototype,"setHitable",null),Lt([Ae],r.prototype,"setHittable",null),Lt([Ae],r.prototype,"openEdgeAnimation",null),Lt([Ae],r.prototype,"closeEdgeAnimation",null),Lt([Ae],r.prototype,"setElementState",null),Lt([Ae],r.prototype,"updateStartPoint",null),Lt([Ae],r.prototype,"moveStartPoint",null),Lt([Ae],r.prototype,"updateEndPoint",null),Lt([Ae],r.prototype,"moveEndPoint",null),Lt([Ae],r.prototype,"setZIndex",null),Lt([Ae],r.prototype,"initPoints",null),Lt([Ae],r.prototype,"updateAttributes",null),Lt([Ae],r.prototype,"getAdjustStart",null),Lt([Ae],r.prototype,"getAdjustEnd",null),Lt([Ae],r.prototype,"updateAfterAdjustStartAndEnd",null),r}(),$5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ea=function(){return ea=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ea.apply(this,arguments)},Qr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Lf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Yp=function(r){$5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.BEZIER_EDGE,i.path="",i.initEdgeData(t),i.setAttributes(),i}return e.prototype.initEdgeData=function(t){this.offset=Gl(t,"properties.offset",100),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return ea(ea(ea({},n),Ht(t)),Ht(o))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,n=0;return this.pointsList.forEach(function(i){var o=i.x,a=i.y;t+=o,n+=a}),{x:t/this.pointsList.length,y:n/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,a=i.y;return{x:o,y:a}});return ea(ea({},t),{pointsList:n})},e.prototype.getControls=function(){var t=this.startPoint,n=this.endPoint,i=S_({start:t,end:n,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return i},e.prototype.getPath=function(t){var n=Lf(t,4),i=n[0],o=n[1],a=n[2],l=n[3];return"M ".concat(i.x," ").concat(i.y,`
    C `).concat(o.x," ").concat(o.y,`,
    `).concat(a.x," ").concat(a.y,`,
    `).concat(l.x," ").concat(l.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),n=t.sNext,i=t.ePre;this.updatePath(n,i)},e.prototype.updatePath=function(t,n){t=Ht(t),n=Ht(n);var i={x:this.startPoint.x,y:this.startPoint.y},o={x:this.endPoint.x,y:this.endPoint.y};if(!t||!n){var a=this.getControls();t=a.sNext,n=a.ePre}this.pointsList=[i,t,n,o],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n;var i=Lf(this.pointsList,3),o=i[1],a=i[2];o.x+=t,o.y+=n,this.updatePath(o,a)},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n;var i=Lf(this.pointsList,3),o=i[1],a=i[2];a.x+=t,a.y+=n,this.updatePath(o,a)},e.prototype.updateAdjustAnchor=function(t,n){var i;n==="sNext"?this.pointsList[1]=t:n==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,a=t.targetNode,l=S_({start:n,end:i,sourceNode:o,targetNode:a,offset:this.offset}),u=l.sNext,d=l.ePre;this.pointsList=[n,u,d,i],this.initPoints()},Qr([De],e.prototype,"offset",void 0),Qr([De],e.prototype,"path",void 0),Qr([Ae],e.prototype,"initPoints",null),Qr([Ae],e.prototype,"updatePoints",null),Qr([Ae],e.prototype,"updateStartPoint",null),Qr([Ae],e.prototype,"updateEndPoint",null),Qr([Ae],e.prototype,"moveStartPoint",null),Qr([Ae],e.prototype,"moveEndPoint",null),Qr([Ae],e.prototype,"updateAdjustAnchor",null),Qr([Ae],e.prototype,"getAdjustStart",null),Qr([Ae],e.prototype,"getAdjustEnd",null),Qr([Ae],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Sc),F5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vl=function(){return vl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vl.apply(this,arguments)},R_=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},z5=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},I_=function(r){F5(e,r);function e(){var t=r.apply(this,z5([],R_(arguments),!1))||this;return t.modelType=Vt.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return vl(vl(vl({},n),Ht(t)),Ht(o))},e.prototype.initEdgeData=function(t){r.prototype.initEdgeData.call(this,t),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var n=R_(t,2),i=n[0],o=n[1];return"".concat(i.x,",").concat(i.y," ").concat(o.x,",").concat(o.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(Sc),W5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gl=function(){return gl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gl.apply(this,arguments)},nr=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},B_=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},U5=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},hs=function(r){W5(e,r);function e(){var t=r.apply(this,U5([],B_(arguments),!1))||this;return t.modelType=Vt.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=Gl(t,"properties.offset",30),t.pointsList&&(this.pointsList=t.pointsList),r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,n=r.prototype.getEdgeStyle.call(this),i=this.properties.style,o=i===void 0?{}:i;return gl(gl(gl({},n),Ht(t)),Ht(o))},e.prototype.getTextPosition=function(){var t,n=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!n){var i=this.dbClickPosition,o=i.x,a=i.y;return{x:o,y:a}}var l=da(this.points),u=B_(Mj(l),2),d=u[0],f=u[1];return{x:(d.x+f.x)/2,y:(d.y+f.y)/2}},e.prototype.getAfterAnchor=function(t,n,i){var o,a;return i.forEach(function(l){var u;t===vn.HORIZONTAL?u=Math.abs(n.y-l.y):t===vn.VERTICAL&&(u=Math.abs(n.x-l.x)),(!a||a>u)&&(a=u,o=l)}),o},e.prototype.getCrossPoint=function(t,n,i){var o;return t===vn.HORIZONTAL?o={x:i.x,y:n.y}:t===vn.VERTICAL&&(o={x:n.x,y:i.y}),o},e.prototype.removeCrossPoints=function(t,n,i){var o=i.map(function(_){return _});if(t===1){var a=o[t],l=o[n],u=o[t-1],d=__(u,a,this.sourceNode);if(d){var f=b_(a,l,this.sourceNode);if(f){var h=x_(a,l,this.sourceNode);h&&(o[t]=h,o.splice(t-1,1),t--,n--)}}else{var g=this.sourceNode.anchors;g.forEach(function(_){if(_.x===u.x&&_.x===a.x||_.y===u.y&&_.y===a.y){var S=wi(_.x,_.y,a.x,a.y),k=wi(u.x,u.y,a.x,a.y);S<k&&(o[t-1]=_)}})}}if(n===i.length-2){var y=o[t],w=o[n],x=o[n+1],b=__(w,x,this.targetNode);if(b){var f=b_(y,w,this.targetNode);if(f){var h=x_(y,w,this.targetNode);h&&(o[n]=h,o.splice(n+1,1))}}else{var g=this.targetNode.anchors;g.forEach(function(S){if(S.x===x.x&&S.x===w.x||S.y===x.y&&S.y===w.y){var k=wi(S.x,S.y,w.x,w.y),O=wi(x.x,x.y,w.x,w.y);k<O&&(o[n+1]=S)}})}}return o},e.prototype.getDraggingPoints=function(t,n,i,o,a){var l=a.map(function(f){return f}),u=this.getAfterAnchor(t,i,o),d=this.getCrossPoint(t,i,u);return n==="start"?(l.unshift(d),l.unshift(u)):(l.push(d),l.push(u)),l},e.prototype.updateCrossPoints=function(t){var n=t.map(function(S){return S}),i=t[0],o=t[1],a=t[n.length-2],l=t[n.length-1],u=this,d=u.sourceNode,f=u.targetNode,h=d.modelType,g=f.modelType,y=Nd(i,o),w=n[0];switch(h){case Vt.RECT_NODE:if(d.radius!==0){var x=N_(i,d);x||(w=O_(i,y,d))}break;case Vt.CIRCLE_NODE:w=$p(i,y,d);break;case Vt.ELLIPSE_NODE:w=M_(i,y,d);break;case Vt.DIAMOND_NODE:w=qu(i,y,d);break;case Vt.POLYGON_NODE:w=qu(i,y,d);break}w&&(n[0]=w);var b=Nd(a,l),_=n[n.length-1];switch(g){case Vt.RECT_NODE:if(f.radius!==0){var x=N_(l,f);x||(_=O_(l,b,f))}break;case Vt.CIRCLE_NODE:_=$p(l,b,f);break;case Vt.ELLIPSE_NODE:_=M_(l,b,f);break;case Vt.DIAMOND_NODE:_=qu(l,b,f);break;case Vt.POLYGON_NODE:_=qu(l,b,f);break}return _&&(n[n.length-1]=_),n},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(i){var o=i.x,a=i.y;return{x:o,y:a}});return Object.assign({},t,{pointsList:n})},e.prototype.getPath=function(t){return t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=y_({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n,this.updatePoints()},e.prototype.updatePointsList=function(t,n){this.pointsList.forEach(function(a){a.x+=t,a.y+=n});var i=this.pointsList[0];this.startPoint=Object.assign({},i);var o=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},o),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,n){var i;this.isDragging=!0;var o=t.start,a=t.end,l=t.startIndex,u=t.endIndex,d=t.direction,f=this.pointsList,h=f;return d===vn.HORIZONTAL?(f[l]={x:o.x,y:o.y+n.y},f[u]={x:a.x,y:a.y+n.y},h=this.pointsList.map(function(g){return g})):d===vn.VERTICAL&&(f[l]={x:o.x+n.x,y:o.y},f[u]={x:a.x+n.x,y:a.y},h=this.pointsList.map(function(g){return g})),this.updatePointsAfterDrag(h),this.draggingPointList=h,!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[u]),startIndex:l,endIndex:u,direction:d}},e.prototype.dragAppend=function(t,n){var i;this.isDragging=!0;var o=t.start,a=t.end,l=t.startIndex,u=t.endIndex,d=t.direction,f=this.pointsList;if(d===vn.HORIZONTAL){f[l]={x:o.x,y:o.y+n.y},f[u]={x:a.x,y:a.y+n.y};var h=this.pointsList.map(function(b){return b});if(l!==0&&u!==this.pointsList.length-1&&(h=this.removeCrossPoints(l,u,h)),l===0){var g={x:o.x,y:o.y+n.y},y=ao(g,this.sourceNode);if(!y){var w=this.sourceNode.anchors;h=this.getDraggingPoints(d,"start",g,w,h)}}if(u===this.pointsList.length-1){var x={x:a.x,y:a.y+n.y},y=ao(x,this.targetNode);if(!y){var w=this.targetNode.anchors;h=this.getDraggingPoints(d,"end",x,w,h)}}this.updatePointsAfterDrag(h),this.draggingPointList=h}else if(d===vn.VERTICAL){f[l]={x:o.x+n.x,y:o.y},f[u]={x:a.x+n.x,y:a.y};var h=this.pointsList.map(function(_){return _});if(l!==0&&u!==this.pointsList.length-1&&(h=this.removeCrossPoints(l,u,h)),l===0){var g={x:o.x+n.x,y:o.y},y=ao(g,this.sourceNode);if(!y){var w=this.sourceNode.anchors;h=this.getDraggingPoints(d,"start",g,w,h)}}if(u===this.pointsList.length-1){var x={x:a.x+n.x,y:a.y},y=ao(x,this.targetNode);if(!y){var w=this.targetNode.anchors;h=this.getDraggingPoints(d,"end",x,w,h)}}this.updatePointsAfterDrag(h),this.draggingPointList=h}return!((i=this.text)===null||i===void 0)&&i.value&&this.setText(on({},this.text,this.textPosition)),{start:on({},f[l]),end:on({},f[u]),startIndex:l,endIndex:u,direction:d}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=Kx(da(this.points));this.pointsList=t.map(function(o){return o}),this.draggingPointList=[];var n=t[0];this.startPoint=on({},n);var i=t[t.length-1];this.endPoint=on({},i)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var n=this.updateCrossPoints(t);this.points=n.map(function(i){return"".concat(i.x,",").concat(i.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,i=t.endPoint,o=t.sourceNode,a=t.targetNode;this.pointsList=y_({x:n.x,y:n.y},{x:i.x,y:i.y},o,a,this.offset||0),this.initPoints()},nr([De],e.prototype,"offset",void 0),nr([De],e.prototype,"dbClickPosition",void 0),nr([Ae],e.prototype,"initPoints",null),nr([Ae],e.prototype,"updatePoints",null),nr([Ae],e.prototype,"updateStartPoint",null),nr([Ae],e.prototype,"moveStartPoint",null),nr([Ae],e.prototype,"updateEndPoint",null),nr([Ae],e.prototype,"moveEndPoint",null),nr([Ae],e.prototype,"updatePointsList",null),nr([Ae],e.prototype,"dragAppendStart",null),nr([Ae],e.prototype,"dragAppendSimple",null),nr([Ae],e.prototype,"dragAppend",null),nr([Ae],e.prototype,"dragAppendEnd",null),nr([Ae],e.prototype,"updatePointsAfterDrag",null),nr([Ae],e.prototype,"getAdjustStart",null),nr([Ae],e.prototype,"getAdjustEnd",null),nr([Ae],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Sc),Yn=function(){return Yn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Yn.apply(this,arguments)},jt=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},j_=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},V5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Ro=function(){function r(e,t){var n;this.BaseType=Sn.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ai.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=en.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=Vt.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,n=t.x,i=n===void 0?0:n,o=t.y,a=o===void 0?0:o;this.transform=new Md(-i,-a).rotate(e).translate(i,a).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),r.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),i=this.createId();e.id=i||n||No()}this.formatText(e),on(this,Wj(e));var o=this.graphModel.overlapMode;o===xi.INCREASE&&(this.zIndex=e.zIndex||ig())},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,i,o=this.graphModel.editConfigModel,a=o.nodeTextDraggable,l=o.nodeTextEdit,u=e.x,d=e.y,f=e.text,h={value:"",x:u,y:d,draggable:a,editable:l};f&&(typeof f=="string"?h.value=f:(h=Yn(Yn({},h),{x:(t=f.x)!==null&&t!==void 0?t:u,y:(n=f.y)!==null&&n!==void 0?n:d,value:(i=f.value)!==null&&i!==void 0?i:""}),es(f.draggable)||(h.draggable=f.draggable),es(f.editable)||(h.editable=f.editable))),e.text=h},r.prototype.resize=function(e){var t=e.width,n=e.height,i=e.deltaX,o=e.deltaY,a=this.isAllowResizeNode(i,o,t,n);return a?(this.move(i/2,o/2),this.width=t,this.height=n,this.setProperties({width:t,height:n}),this.getData()):this.getData()},r.prototype.proportionalResize=function(){},r.prototype.getData=function(){var e=this.text,t=e.x,n=e.y,i=e.value,o=this.properties;ls(o)&&(o=yi(o)),wr(o.width)&&(o.width=this.width),wr(o.height)&&(o.height=this.height);var a={id:this.id,type:this.type,x:this.x,y:this.y,properties:o};return this.rotate&&(a.rotate=this.rotate),this.graphModel.overlapMode===xi.INCREASE&&(a.zIndex=this.zIndex),i&&(a.text={x:t,y:n,value:i}),a},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.getProperties=function(){return yi(this.properties)},r.prototype.getOuterGAttributes=function(){return{className:""}},r.prototype.getNodeStyle=function(){return Yn(Yn({},this.graphModel.theme.baseNode),this.style)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,n=t===void 0?{}:t;return Yn(Yn({},Ht(e)),Ht(n))},r.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return Ht(e)},r.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return Ht(e)},r.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return Ht(e)},r.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return Ht(t)},r.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return Ht(t)},r.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return Ht(e)},r.prototype.isAllowConnectedAsSource=function(e,t,n,i){var o=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var a=!0,l="",u=0;u<o.length;u++){var d=o[u];if(!d.validate.call(this,this,e,t,n,i)){a=!1,l=d.message;break}}return{isAllPass:a,msg:l}},r.prototype.getConnectedSourceRules=function(){return this.sourceRules},r.prototype.isAllowConnectedAsTarget=function(e,t,n,i){var o=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var a=!0,l="",u=0;u<o.length;u++){var d=o[u];if(!d.validate.call(this,e,this,t,n,i)){a=!1,l=d.message;break}}return{isAllPass:a,msg:l}},r.prototype.isAllowMoveNode=function(e,t){var n,i,o=!0,a=!0,l=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var u=j_(l),d=u.next();!d.done;d=u.next()){var f=d.value,h=f(this,e,t);if(!h)return!1;if(typeof h=="object"){var g=h;if(!g.x&&!g.y)return!1;o=o&&g.x,a=a&&g.y}}}catch(y){n={error:y}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return{x:o,y:a}},r.prototype.getConnectedTargetRules=function(){return this.targetRules},r.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,n=e.id,i=e.x,o=e.y;return t&&t.length>0?t.map(function(a,l){return a.length?(a=a,{id:"".concat(n,"_").concat(l),x:i+a[0],y:o+a[1]}):(a=a,Yn(Yn({},a),{x:i+a.x,y:o+a.y,id:a.id||"".concat(n,"_").concat(l)}))}):this.getDefaultAnchor()},r.prototype.getDefaultAnchor=function(){return[]},r.prototype.getTargetAnchor=function(e){return $j(e,this)},r.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(r.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,n=t.x,i=t.y,o=t.rotate;return e.forEach(function(a){var l=a.x,u=a.y,d=V5(new ru([l,u,1]).translate(-n,-i).rotate(o).translate(n,i)[0],2),f=d[0],h=d[1];a.x=f,a.y=h}),e},enumerable:!1,configurable:!0}),r.prototype.getAnchorInfo=function(e){if(!wr(e))for(var t=0;t<this.anchors.length;t++){var n=this.anchors[t];if(n.id===e)return n}},r.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},r.prototype.isAllowMoveByXORY=function(e,t,n){var i,o;if(n)i=!0,o=!0;else{var a=this.isAllowMoveNode(e,t);typeof a=="boolean"?(i=a,o=a):(i=a.x,o=a.y)}return{isAllowMoveX:i,isAllowMoveY:o}},r.prototype.move=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,a=i.isAllowMoveY;return o&&(this.x=this.x+e,this.text&&this.moveText(e,0)),a&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(o||a)&&(this.rotate=this._rotate),o||a},r.prototype.getMoveDistance=function(e,t,n){n===void 0&&(n=!1);var i=this.isAllowMoveByXORY(e,t,n),o=i.isAllowMoveX,a=i.isAllowMoveY,l=0,u=0;return o&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),l=e),a&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),u=t),this.transform=new Md(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[l,u]},r.prototype.moveTo=function(e,t,n){n===void 0&&(n=!1);var i=e-this.x,o=t-this.y;return!n&&!this.isAllowMoveNode(i,o)?!1:(this.text&&this.moveText(i,o),this.x=e,this.y=t,!0)},r.prototype.moveText=function(e,t){var n=this.text,i=n.x,o=n.y,a=n.value,l=n.draggable,u=n.editable;this.text={value:a,editable:u,draggable:l,x:i+e,y:o+t}},r.prototype.updateText=function(e){this.text=Yn(Yn({},yi(this.text)),{value:e})},r.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},r.prototype.isAllowResizeNode=function(e,t,n,i){var o,a,l=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var u=j_(l),d=u.next();!d.done;d=u.next()){var f=d.value,h=f(this,e,t,n,i);if(!h)return!1}}catch(g){o={error:g}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return!0},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},r.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},r.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},r.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateProperties=function(e,t){var n=yi(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(kt.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:n,properties:e})},r.prototype.setProperty=function(e,t){var n=yi(this.properties),i=Ht(n);CC(i,e,vr(t)),this.updateProperties(i,[e])},r.prototype.setProperties=function(e){var t=yi(this.properties),n=Yn(Yn({},t),vr(e)),i=[];kC(e,function(o,a){(xp(t,a)&&t[a]!==o||!xp(t,a))&&i.push(a)}),this.updateProperties(n,i)},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setStyle=function(e,t){var n;this.style=Yn(Yn({},this.style),(n={},n[e]=vr(t),n))},r.prototype.setStyles=function(e){this.style=Yn(Yn({},this.style),vr(e))},r.prototype.updateStyles=function(e){this.style=Yn({},vr(e))},r.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},r.prototype.updateAttributes=function(e){on(this,e)},r.BaseType=Sn.NODE,jt([De],r.prototype,"type",void 0),jt([De],r.prototype,"x",void 0),jt([De],r.prototype,"y",void 0),jt([De],r.prototype,"textMode",void 0),jt([De],r.prototype,"text",void 0),jt([De],r.prototype,"properties",void 0),jt([De],r.prototype,"_width",void 0),jt([De],r.prototype,"_height",void 0),jt([De],r.prototype,"anchorsOffset",void 0),jt([De],r.prototype,"isSelected",void 0),jt([De],r.prototype,"isHovered",void 0),jt([De],r.prototype,"isShowAnchor",void 0),jt([De],r.prototype,"isDragging",void 0),jt([De],r.prototype,"isHitable",void 0),jt([De],r.prototype,"isHittable",void 0),jt([De],r.prototype,"draggable",void 0),jt([De],r.prototype,"visible",void 0),jt([De],r.prototype,"rotatable",void 0),jt([De],r.prototype,"resizable",void 0),jt([De],r.prototype,"zIndex",void 0),jt([De],r.prototype,"state",void 0),jt([De],r.prototype,"autoToFront",void 0),jt([De],r.prototype,"style",void 0),jt([De],r.prototype,"transform",void 0),jt([De],r.prototype,"_rotate",void 0),jt([fn],r.prototype,"incoming",null),jt([fn],r.prototype,"outgoing",null),jt([Ae],r.prototype,"setTextMode",null),jt([Ae],r.prototype,"addNodeMoveRules",null),jt([Ae],r.prototype,"move",null),jt([Ae],r.prototype,"getMoveDistance",null),jt([Ae],r.prototype,"moveTo",null),jt([Ae],r.prototype,"moveText",null),jt([Ae],r.prototype,"updateText",null),jt([Ae],r.prototype,"addNodeResizeRules",null),jt([Ae],r.prototype,"setSelected",null),jt([Ae],r.prototype,"setHovered",null),jt([Ae],r.prototype,"setIsShowAnchor",null),jt([Ae],r.prototype,"setRotatable",null),jt([Ae],r.prototype,"setResizable",null),jt([Ae],r.prototype,"setHitable",null),jt([Ae],r.prototype,"setHittable",null),jt([Ae],r.prototype,"setElementState",null),jt([Ae],r.prototype,"setProperty",null),jt([Ae],r.prototype,"setProperties",null),jt([Ae],r.prototype,"deleteProperty",null),jt([Ae],r.prototype,"setStyle",null),jt([Ae],r.prototype,"setStyles",null),jt([Ae],r.prototype,"updateStyles",null),jt([Ae],r.prototype,"setZIndex",null),jt([Ae],r.prototype,"updateAttributes",null),r}(),q5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ml=function(){return ml=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ml.apply(this,arguments)},Pf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Rd=function(r){q5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.CIRCLE_NODE,i.r=50,i.initNodeData(t),i.setAttributes(),i}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.circle,i=this.properties.style,o=i===void 0?{}:i;return ml(ml(ml({},t),Ht(n)),Ht(o))},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.r;return[{x:n,y:i-o,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+o,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.deltaX,o=t.deltaY;return this.move(i/2,o/2),this.r=n,this.setProperties({r:n}),this.getData()},Pf([De],e.prototype,"r",void 0),Pf([fn],e.prototype,"width",null),Pf([fn],e.prototype,"height",null),e}(Ro),X5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yl=function(){return yl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yl.apply(this,arguments)},$a=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Gu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Kp=function(r){X5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.DIAMOND_NODE,i.rx=30,i.ry=50,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.diamond,i=this.properties.style,o=i===void 0?{}:i;return yl(yl(yl({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,n=t.x,i=t.y,o=t.rx,a=t.ry;return[[n,i-a],[n+o,i],[n,i+a],[n-o,i]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return so(this.points,function(t){var n=Gu(t,2),i=n[0],o=n[1];return{x:i,y:o}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return un(this.points,function(i){var o=Gu(i,1),a=o[0];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return un(this.points,function(i){var o=Gu(i,2),a=o[1];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return so(this.points,function(n,i){var o=Gu(n,2),a=o[0],l=o[1];return{x:a,y:l,id:"".concat(t.id,"_").concat(i)}})},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,a=t.deltaY;return this.move(o/2,a/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},$a([De],e.prototype,"rx",void 0),$a([De],e.prototype,"ry",void 0),$a([fn],e.prototype,"points",null),$a([fn],e.prototype,"pointsPosition",null),$a([fn],e.prototype,"width",null),$a([fn],e.prototype,"height",null),e}(Ro),G5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),_l=function(){return _l=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},_l.apply(this,arguments)},Yu=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Jp=function(r){G5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.ELLIPSE_NODE,i.rx=30,i.ry=45,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,i=t.ry;n&&(this.rx=n),i&&(this.ry=i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.ellipse,i=this.properties.style,o=i===void 0?{}:i;return _l(_l(_l({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.rx,a=t.ry;return[{x:n,y:i-a,id:"".concat(this.id,"_0")},{x:n+o,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+a,id:"".concat(this.id,"_2")},{x:n-o,y:i,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,i=t.height,o=t.deltaX,a=t.deltaY;return this.move(o/2,a/2),this.rx=n,this.ry=i,this.setProperties({rx:n,ry:i}),this.getData()},Yu([De],e.prototype,"rx",void 0),Yu([De],e.prototype,"ry",void 0),Yu([fn],e.prototype,"width",null),Yu([fn],e.prototype,"height",null),e}(Ro),Y5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bl=function(){return bl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bl.apply(this,arguments)},Ku=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ju=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Id=function(r){Y5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.POLYGON_NODE,i.points=[[50,0],[100,50],[50,100],[0,50]],i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.points,i=t.width,o=t.height,a=n||this.points;this.points=Rj(a,i,o)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.polygon,i=this.properties.style,o=i===void 0?{}:i;return bl(bl(bl({},t),Ht(n)),Ht(o))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,n=t.x,i=t.y,o=t.width,a=t.height;return this.points.map(function(l){return{x:l[0]+n-o/2,y:l[1]+i-a/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Ju(i,1),a=o[0];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(i){var o=Ju(i,2),a=o[1];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=this,i=n.x,o=n.y,a=n.width,l=n.height,u=n.points;return u.map(function(d,f){var h=Ju(d,2),g=h[0],y=h[1];return{x:i+g-a/2,y:o+y-l/2,id:"".concat(t.id,"_").concat(f)}})},e.prototype.resize=function(t){var n=this,i=t.width,o=t.height,a=t.deltaX,l=t.deltaY;this.move(a/2,l/2);var u=so(this.points,function(d){var f=Ju(d,2),h=f[0],g=f[1];return[h*i/n.width,g*o/n.height]});return this.points=u,this.properties.points=u,this.getData()},Ku([De],e.prototype,"points",void 0),Ku([fn],e.prototype,"pointsPosition",null),Ku([fn],e.prototype,"width",null),Ku([fn],e.prototype,"height",null),e}(Ro),K5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),xl=function(){return xl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},xl.apply(this,arguments)},J5=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},ps=function(r){K5(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.RECT_NODE,i.radius=0,i.initNodeData(t),i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height,o=t.radius,a=this.getNodeStyle().radius;wr(n)||(this.width=n),wr(i)||(this.height=i),wr(o)||(this.radius=o),wr(a)||(this.radius=a)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,a=t.height;return[{x:n,y:i-a/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+a/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.rect,i=this.properties.style,o=i===void 0?{}:i;return xl(xl(xl({},t),Ht(n)),Ht(o))},J5([De],e.prototype,"radius",void 0),e}(Ro),Z5=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),wl=function(){return wl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},wl.apply(this,arguments)},H_=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Q5=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},eH=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},$_=function(r){Z5(e,r);function e(){var t=r.apply(this,eH([],Q5(arguments),!1))||this;return t.modelType=Vt.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=r.prototype.getTextStyle.call(this),n=this.graphModel.theme.text,i=this.properties.textStyle;return wl(wl(wl({},t),Ht(n)),Ht(i))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=T_({rows:t,fontSize:n,rowsLength:t.length}).width;return i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,i=T_({rows:t,fontSize:n,rowsLength:t.length}).height;return i},enumerable:!1,configurable:!0}),H_([fn],e.prototype,"width",null),H_([fn],e.prototype,"height",null),e}(Ro),tH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Fl=function(r){tH(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.modelType=Vt.HTML_NODE,i.setAttributes(),i}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,i=t.height;n&&(this.width=n),i&&(this.height=i)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,i=t.y,o=t.width,a=t.height;return[{x:n,y:i-a/2,id:"".concat(this.id,"_0")},{x:n+o/2,y:i,id:"".concat(this.id,"_1")},{x:n,y:i+a/2,id:"".concat(this.id,"_2")},{x:n-o/2,y:i,id:"".concat(this.id,"_3")}]},e}(Ro),rn=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},nH={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},Zu=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],rH=function(){function r(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=ai.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ai.TEXT,this.edgeTextMode=ai.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",on(this,this.computeConfig(e))}return r.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);on(this,t)},r.prototype.computeConfig=function(e){var t=e.isSilentMode,n=e.textDraggable,i=e.textMode,o=e.textEdit,a=e.adjustEdgeStartAndEnd,l={};if(t===!1&&on(l,this.stagedConfig),t===!0&&t!==this.isSilentMode){var u=Va(nH,Zu);this.stagedConfig=Va(this,Zu),on(l,u)}es(o)||on(l,{nodeTextEdit:o,edgeTextEdit:o}),es(n)||on(l,{nodeTextDraggable:n,edgeTextDraggable:n}),i&&on(l,{nodeTextMode:i,edgeTextMode:i}),wp(a)&&on(l,{adjustEdgeStart:a,adjustEdgeEnd:a});var d=Va(e,Zu);return on(l,d)},r.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},r.prototype.getConfig=function(){return Va(this,Zu)},rn([De],r.prototype,"isSilentMode",void 0),rn([De],r.prototype,"stopZoomGraph",void 0),rn([De],r.prototype,"stopMoveGraph",void 0),rn([De],r.prototype,"stopScrollGraph",void 0),rn([De],r.prototype,"snapGrid",void 0),rn([De],r.prototype,"textMode",void 0),rn([De],r.prototype,"textEdit",void 0),rn([De],r.prototype,"textDraggable",void 0),rn([De],r.prototype,"nodeTextEdit",void 0),rn([De],r.prototype,"nodeTextDraggable",void 0),rn([De],r.prototype,"nodeTextMultiple",void 0),rn([De],r.prototype,"nodeTextVertical",void 0),rn([De],r.prototype,"nodeTextMode",void 0),rn([De],r.prototype,"edgeTextMode",void 0),rn([De],r.prototype,"edgeTextEdit",void 0),rn([De],r.prototype,"edgeTextDraggable",void 0),rn([De],r.prototype,"edgeTextMultiple",void 0),rn([De],r.prototype,"edgeTextVertical",void 0),rn([De],r.prototype,"hideAnchors",void 0),rn([De],r.prototype,"allowRotate",void 0),rn([De],r.prototype,"allowResize",void 0),rn([De],r.prototype,"hoverOutline",void 0),rn([De],r.prototype,"nodeSelectedOutline",void 0),rn([De],r.prototype,"adjustNodePosition",void 0),rn([De],r.prototype,"autoExpand",void 0),rn([De],r.prototype,"adjustEdge",void 0),rn([De],r.prototype,"adjustEdgeMiddle",void 0),rn([De],r.prototype,"adjustEdgeStartAndEnd",void 0),rn([De],r.prototype,"adjustEdgeStart",void 0),rn([De],r.prototype,"adjustEdgeEnd",void 0),rn([De],r.prototype,"edgeSelectedOutline",void 0),rn([Ae],r.prototype,"updateEditConfig",null),rn([Ae],r.prototype,"updateTextMode",null),r}(),iH="*",oH=function(){function r(){this._events={}}return r.prototype.on=function(e,t,n){var i=this;e==null||e.split(",").forEach(function(o){o=o.trim(),i._events[o]||(i._events[o]=[]),i._events[o].push({callback:t,once:!!n})})},r.prototype.once=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){i=i.trim(),n.on(i,t,!0)})},r.prototype.emit=function(e,t){var n=this;e==null||e.split(",").forEach(function(i){var o=n._events[i]||[],a=n._events[iH]||[],l=function(u){for(var d=u.length,f=0;f<d;f++)if(u[f]){var h=u[f],g=h.callback,y=h.once;y&&(u.splice(f,1),u.length===0&&delete n._events[i],d--,f--),g.apply(n,[t])}};l(o),l(a)})},r.prototype.off=function(e,t){var n=this;e||(this._events={}),e.split(",").forEach(function(i){if(!t)delete n._events[i];else{for(var o=n._events[i]||[],a=o.length,l=0;l<a;l++)o[l].callback===t&&(o.splice(l,1),a--,l--);o.length===0&&delete n._events[i]}})},r.prototype.getEvents=function(){return this._events},r.prototype.destroy=function(){this._events={}},r}(),aH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zp=function(){return Zp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Zp.apply(this,arguments)},sH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},lH=function(r){aH(e,r);function e(t){var n=r.call(this)||this;n.stepScrollX=0,n.stepScrollY=0,n.onDragging=function(l){var u=l.deltaX,d=l.deltaY;n.setState({isDragging:!0});var f=n.props.graphModel,h=f.transformModel,g=f.editConfigModel;g.stopMoveGraph!==!0&&h.translate(u,d)},n.onDragEnd=function(){n.setState({isDragging:!1})},n.zoomHandler=function(l){var u=n.props,d=u.graphModel,f=d.editConfigModel,h=d.transformModel,g=d.gridSize,y=u.graphModel,w=l.deltaX,x=l.deltaY,b=f.stopScrollGraph,_=f.stopZoomGraph;if(!b&&!l.ctrlKey&&!l.metaKey){if(l.preventDefault(),n.stepScrollX+=w,n.stepScrollY+=x,Math.abs(n.stepScrollX)>=g){var S=n.stepScrollX%g,k=n.stepScrollX-S;h.translate(-k*h.SCALE_X,0),n.stepScrollX=S}if(Math.abs(n.stepScrollY)>=g){var O=n.stepScrollY%g,M=n.stepScrollY-O;h.translate(0,-M*h.SCALE_Y),n.stepScrollY=O}return}if(!_){l.preventDefault();var R=y.getPointByClient({x:l.clientX,y:l.clientY}),T=R.canvasOverlayPosition,I=T.x,$=T.y;h.zoom(l.deltaY<0,[I,$])}},n.clickHandler=function(l){var u=l.target;if(u.getAttribute("name")==="canvas-overlay"){var d=n.props.graphModel,f=d.selectElements;f.size>0&&d.clearSelectElements(),d.eventCenter.emit(kt.BLANK_CLICK,{e:l})}},n.handleContextMenu=function(l){var u=l.target;if(u.getAttribute("name")==="canvas-overlay"){l.preventDefault();var d=n.props.graphModel,f=d.getPointByClient({x:l.clientX,y:l.clientY});d.eventCenter.emit(kt.BLANK_CONTEXTMENU,{e:l,position:f})}},n.mouseDownHandler=function(l){var u=n.props.graphModel,d=u.eventCenter,f=u.editConfigModel,h=u.transformModel.SCALE_X,g=u.gridSize,y=f.adjustEdge,w=f.adjustNodePosition,x=f.stopMoveGraph,b=l.target,_=!y&&!w;(b.getAttribute("name")==="canvas-overlay"||_)&&(x!==!0?(n.stepDrag.setStep(g*h),n.stepDrag.handleMouseDown(l)):d.emit(kt.BLANK_MOUSEDOWN,{e:l}),n.clickHandler(l))};var i=t.graphModel,o=i.gridSize,a=i.eventCenter;return n.stepDrag=new li({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"BLANK",isStopPropagation:!1,eventCenter:a,model:void 0}),n.state={isDragging:!1},n}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props,o=i.children,a=i.dnd,l=this.state.isDragging;return Te("svg",Zp({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:l?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},a.eventMap(),{children:Te("g",{transform:n,children:o})}))},e=sH([Er],e),e}(Yt),lw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),zl=function(){return zl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},zl.apply(this,arguments)},uH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},dH=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},F_=function(r){lw(e,r);function e(){var t=r.call(this)||this;return t.onDragging=function(n){var i=n.event,o=t.props,a=o.graphModel,l=o.bezierModel,u=o.type,d=a.getPointByClient({x:i.clientX,y:i.clientY}).canvasOverlayPosition,f=d.x,h=d.y;l.updateAdjustAnchor({x:f,y:h},u),a.eventCenter.emit(kt.EDGE_ADJUST,{data:l.getData()})},t.onDragEnd=function(){var n=t.props.bezierModel;n.isDragging=!1},t.dragHandler=new li({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,n=this.props.position,i=n.x,o=n.y,a=this.props.bezierModel,l=a.getEdgeStyle().adjustAnchor;return Te(fs,zl({className:"lf-bezier-adjust-anchor",x:i,y:o},l,{onMouseDown:function(u){t.dragHandler.handleMouseDown(u)}}))},e}(Yt),cH=function(r){lw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,n){var i=t.path,o=t.id,a=tg(i),l=dH(a,4),u=l[0],d=l[1],f=l[2],h=l[3],g=t.getEdgeStyle().adjustLine,y=[];return y.push(Te(cs,zl({x1:u.x,y1:u.y,x2:d.x,y2:d.y},g))),y.push(Te(F_,{position:d,bezierModel:t,graphModel:n,type:"sNext"},"".concat(o,"_ePre"))),y.push(Te(cs,zl({x1:h.x,y1:h.y,x2:f.x,y2:f.y},g))),y.push(Te(F_,{position:f,bezierModel:t,graphModel:n,type:"ePre"},"".concat(o,"_sNext"))),y},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,n=t.edges,i=[],o=0;o<n.length;o++){var a=n[o];a.isSelected&&a.modelType===Vt.BEZIER_EDGE&&a.draggable&&i.push(this.getBezierAdjust(a,t))}return i},e.prototype.render=function(){return Te("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=uH([Er],e),e}(Yt),fH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),hH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},pH=function(r){fH(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return Te("div",{className:"lf-background",children:Te("div",{style:OC(t)?t:{},className:"lf-background-area"})})},e=hH([Er],e),e}(Yt),vH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ja=function(r){vH(e,r);function e(t){var n=r.call(this,t)||this;return n.id=No(),n.gridOptions=n.props.graphModel.grid,n}return e.prototype.renderDot=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,a=t.visible,l=n??{},u=l.color,d=l.thickness,f=d===void 0?2:d,h=Math.min(Math.max(2,f),o/4),g=a?1:0;return Te("g",{fill:u,opacity:g,children:[Te("circle",{cx:0,cy:0,r:h/2}),Te("circle",{cx:0,cy:o,r:h/2}),Te("circle",{cx:o,cy:0,r:h/2}),Te("circle",{cx:o,cy:o,r:h/2})]})},e.prototype.renderMesh=function(){var t=this.gridOptions,n=t.config,i=t.size,o=i===void 0?1:i,a=t.visible,l=n??{},u=l.color,d=l.thickness,f=d===void 0?1:d,h=Math.min(Math.max(1,f),o/2),g="M 0 0 H ".concat(o," V ").concat(o," H 0 Z"),y=a?1:0;return Te("path",{d:g,stroke:u,strokeWidth:h/2,opacity:y,fill:"transparent"})},e.prototype.render=function(){var t=this.props.graphModel,n=t.transformModel,i=t.grid;this.gridOptions=i;var o=this.gridOptions,a=o.type,l=o.size,u=l===void 0?1:l,d=n.SCALE_X,f=n.SKEW_Y,h=n.SKEW_X,g=n.SCALE_Y,y=n.TRANSLATE_X,w=n.TRANSLATE_Y,x=[d,f,h,g,y,w].join(","),b="matrix(".concat(x,")");return Te("div",{className:"lf-grid",children:Te("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[Te("defs",{children:Te("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:b,x:"0",y:"0",width:u,height:u,children:[a==="dot"&&this.renderDot(),a==="mesh"&&this.renderMesh()]})}),Te("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=gH([Er],e),e}(Yt);(function(r){r.defaultProps={size:fj,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var n=Ht(r.defaultProps);return typeof t=="number"?on(n,{size:t}):typeof t=="boolean"?on(n,{visible:t}):on(n,t)}r.getGridOptions=e})(Ja||(Ja={}));var mH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},_H=function(r){mH(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,i=this.props.children;return Te("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:Te("g",{transform:n,children:i})})},e=yH([Er],e),e}(Yt),bH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),wo=function(){return wo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},wo.apply(this,arguments)},xH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},wH=function(r){bH(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,n=t.nodes,i=t.editConfigModel,o=i.hoverOutline,a=i.nodeSelectedOutline,l=[];return n.forEach(function(u){if(u.isHovered||u.isSelected){var d=u.isHovered,f=u.isSelected,h=u.x,g=u.y,y=u.width,w=u.height;if(a&&f||o&&d){var x=u.getOutlineStyle(),b={};if(Object.keys(x).forEach(function(S){S!=="hover"&&(b[S]=x[S])}),d){var _=x.hover;b=wo(wo({},b),_)}l.push(Te(ii,wo({transform:u.transform,className:"lf-outline-node",x:h,y:g,width:y+10,height:w+10},b)))}}}),l},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,n=t.edges,i=t.editConfigModel,o=i.edgeSelectedOutline,a=i.hoverOutline,l=[],u=0;u<n.length;u++){var d=n[u];(o&&d.isSelected||a&&d.isHovered)&&(d.modelType===Vt.LINE_EDGE?l.push(this.getLineOutline(d)):d.modelType===Vt.POLYLINE_EDGE?l.push(this.getPolylineOutline(d)):d.modelType===Vt.BEZIER_EDGE&&l.push(this.getBezierOutline(d)))}return l},e.prototype.getLineOutline=function(t){var n=t.startPoint,i=t.endPoint,o=(n.x+i.x)/2,a=(n.y+i.y)/2,l=Math.abs(n.x-i.x)+10,u=Math.abs(n.y-i.y)+10,d=t.getOutlineStyle();return Te(ii,wo({className:"lf-outline-edge",x:o,y:a,width:l,height:u},d))},e.prototype.getPolylineOutline=function(t){var n=t.points,i=da(n),o=Pl(i,8),a=o.x,l=o.y,u=o.width,d=o.height,f=t.getOutlineStyle();return Te(ii,wo({className:"lf-outline",x:a,y:l,width:u,height:d},f))},e.prototype.getBezierOutline=function(t){var n=t.path,i=tg(n),o=Pl(i,8),a=o.x,l=o.y,u=o.width,d=o.height,f=t.getOutlineStyle();return Te(ii,wo({className:"lf-outline",x:a,y:l,width:u,height:d},f))},e.prototype.render=function(){return Te("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=xH([Er],e),e}(Yt),SH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),So=function(){return So=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},So.apply(this,arguments)},EH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},CH=function(r){SH(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,n=t??{},i=n.position,o=n.isShowHorizontal,a=n.isShowVertical,l=t==null?void 0:t.getStyle(),u=i??{},d=u.x,f=d===void 0?0:d,h=u.y,g=h===void 0?0:h,y=So(So({x1:-1e5,y1:g,x2:1e5,y2:g},l),{stroke:o?l==null?void 0:l.stroke:"none"}),w=So(So({x1:f,y1:-1e5,x2:f,y2:1e5},l),{stroke:a?l==null?void 0:l.stroke:"none"});return Te("g",{className:"lf-snapline",children:[Te(cs,So({},y)),Te(cs,So({},w))]})},e=EH([Er],e),e}(Yt),kH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),OH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},NH=function(r){kH(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,n=t.tool,i=t.graphModel,o=i.textEditElement,a=n.getTools(),l=a.map(function(u){return wt(u,{textEditElement:o,graphModel:i,lf:n.instance})});return n.components=l,l},e.prototype.triggerToolRender=function(){var t=this.props,n=t.tool,i=t.graphModel,o=document.querySelector("#ToolOverlay_".concat(i.flowId)),a=n.getInstance();a.components.forEach(function(l){return l(a,o)}),a.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return Te("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=OH([Er],e),e}(Yt),pi=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Fa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},MH={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},AH=function(){function r(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var n=t.stopMoveGraph,i=n===void 0?!1:n;this.updateTranslateLimits(i)}return r.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},r.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},r.prototype.HtmlPointToCanvasPoint=function(e){var t=Fa(e,2),n=t[0],i=t[1];return[(n-this.TRANSLATE_X)/this.SCALE_X,(i-this.TRANSLATE_Y)/this.SCALE_Y]},r.prototype.CanvasPointToHtmlPoint=function(e){var t=Fa(e,2),n=t[0],i=t[1];return[n*this.SCALE_X+this.TRANSLATE_X,i*this.SCALE_Y+this.TRANSLATE_Y]},r.prototype.moveCanvasPointByHtml=function(e,t,n){var i=Fa(e,2),o=i[0],a=i[1];return[o+t/this.SCALE_X,a+n/this.SCALE_Y]},r.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},r.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},r.prototype.zoom=function(e,t){e===void 0&&(e=!1);var n=this.SCALE_X,i=this.SCALE_Y;return typeof e=="number"?(n=e,i=e):e?(n+=this.ZOOM_SIZE,i+=this.ZOOM_SIZE):(n-=this.ZOOM_SIZE,i-=this.ZOOM_SIZE),n<this.MINI_SCALE_SIZE||n>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(n-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(i-this.SCALE_Y)*t[1]),this.SCALE_X=n,this.SCALE_Y=i,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},r.prototype.emitGraphTransform=function(e){this.eventCenter.emit(kt.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},r.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},r.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},r.prototype.focusOn=function(e,t,n,i){var o=Fa(this.CanvasPointToHtmlPoint([e,t]),2),a=o[0],l=o[1],u=Fa([n/2-a,i/2-l],2),d=u[0],f=u[1];this.TRANSLATE_X+=d,this.TRANSLATE_Y+=f,this.emitGraphTransform("focusOn")},r.prototype.updateTranslateLimits=function(e){var t;t=Fa(Array.isArray(e)&&e.length===4?e:MH[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},pi([De],r.prototype,"SCALE_X",void 0),pi([De],r.prototype,"SKEW_Y",void 0),pi([De],r.prototype,"SKEW_X",void 0),pi([De],r.prototype,"SCALE_Y",void 0),pi([De],r.prototype,"TRANSLATE_X",void 0),pi([De],r.prototype,"TRANSLATE_Y",void 0),pi([De],r.prototype,"ZOOM_SIZE",void 0),pi([Ae],r.prototype,"zoom",null),pi([Ae],r.prototype,"resetZoom",null),pi([Ae],r.prototype,"translate",null),pi([Ae],r.prototype,"focusOn",null),r}(),TH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Rf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},DH=function(r){TH(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.parentTransform=n.parentTransform,i}return e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,n=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale();t*=i.scaleX,n*=i.scaleY}else t*=this.parentTransform.SCALE_X,n*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:n}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,n=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var i=this.parentTransform.getCumulativeScale(),o=i.scaleX,a=i.scaleY;t=o*t,n=a*n}return{translateX:t,translateY:n}},e.prototype.HtmlPointToCanvasPoint=function(t){var n=Rf(t,2),i=n[0],o=n[1],a=this.getCumulativeScale(),l=a.scaleX,u=a.scaleY,d=this.getCumulativeTranslate(),f=d.translateX,h=d.translateY;return[(i-f)/l,(o-h)/u]},e.prototype.CanvasPointToHtmlPoint=function(t){var n=Rf(t,2),i=n[0],o=n[1],a=this.getCumulativeScale(),l=a.scaleX,u=a.scaleY,d=this.getCumulativeTranslate(),f=d.translateX,h=d.translateY;return[i*l+f,o*u+h]},e.prototype.moveCanvasPointByHtml=function(t,n,i){var o=Rf(t,2),a=o[0],l=o[1],u=this.getCumulativeScale(),d=u.scaleX,f=u.scaleY;return[a+n/d,l+i/f]},e.prototype.fixDeltaXY=function(t,n){var i=this.getCumulativeScale(),o=i.scaleX,a=i.scaleY;return[t/o,n/a]},e}(AH),hr=function(){return hr=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hr.apply(this,arguments)},Ct=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},LH=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zn=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},ei=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},PH=function(){function r(e){var t=this,n,i;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=xi.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var o=e.container,a=e.partial,l=e.background,u=l===void 0?{}:l,d=e.grid,f=e.idGenerator,h=e.edgeGenerator,g=e.animation,y=e.customTrajectory;this.rootEl=o,this.partial=!!a,this.background=u,typeof d=="object"&&e.snapGrid&&(this.gridSize=d.size||1),this.customStyles=e.style||{},this.grid=Ja.getGridOptions(d??!1),this.theme=sw(e.style,e.themeMode),this.theme.grid=Ht(this.grid),this.theme.background=Ht(this.background),this.edgeType=e.edgeType||"polyline",this.animation=uj(g),this.overlapMode=e.overlapMode||xi.DEFAULT,this.width=(n=e.width)!==null&&n!==void 0?n:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=wr(e.width),this.height=(i=e.height)!==null&&i!==void 0?i:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=wr(e.height);var w=new ResizeObserver(S1(function(x){var b,_;try{for(var S=LH(x),k=S.next();!k.done;k=S.next()){var O=k.value;O.target===t.rootEl&&(t.resize(),t.eventCenter.emit("graph:resize",{target:t.rootEl,contentRect:O.contentRect}))}}catch(M){b={error:M}}finally{try{k&&!k.done&&(_=S.return)&&_.call(S)}finally{if(b)throw b.error}}},16));w.observe(this.rootEl),this.waitCleanEffects.push(function(){w.disconnect()}),this.eventCenter=new oH,this.editConfigModel=new rH(e),this.transformModel=new DH(this.eventCenter,e),this.flowId=No(),this.idGenerator=f,this.edgeGenerator=Lj(this,h),this.customTrajectory=y}return Object.defineProperty(r.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelsMap",{get:function(){return ei(ei([],Zn(this.nodes),!1),Zn(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sortElements",{get:function(){for(var e=ei(ei([],Zn(this.nodes),!1),Zn(this.edges),!1).sort(function(l,u){return l.zIndex-u.zIndex}),t=[],n=[-zu,-zu],i=[this.width+zu,this.height+zu],o=0;o<e.length;o++){var a=e[o];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,n,i,!1,!1))&&t.push(a)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(n){return n.state===en.TEXT_EDIT}),t=this.edges.find(function(n){return n.state===en.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),r.prototype.getAreaElement=function(e,t,n,i,o){var a=this;n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1);var l=[];return un(ei(ei([],Zn(this.nodes),!1),Zn(this.edges),!1),function(u){var d=a.isElementInArea(u,e,t,n,i);(!o||u.visible)&&d&&l.push(u)}),l},r.prototype.getModel=function(e){return this.modelMap.get(e)},r.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getPointByClient=function(e){var t=e.x,n=e.y,i=this.rootEl.getBoundingClientRect(),o={x:t-i.left,y:n-i.top},a=Zn(this.transformModel.HtmlPointToCanvasPoint([o.x,o.y]),2),l=a[0],u=a[1],d={x:l,y:u};return{domOverlayPosition:o,canvasOverlayPosition:d}},r.prototype.isElementInArea=function(e,t,n,i,o){var a;if(i===void 0&&(i=!0),o===void 0&&(o=!0),e.BaseType===Sn.NODE){e=e;for(var l=Xr(e),u=l.minX,d=l.minY,f=l.maxX,h=l.maxY,g=[{x:u,y:d},{x:f,y:d},{x:f,y:h},{x:u,y:h}],y=o,w=0;w<g.length;w++){var x=g[w],b=x.x,_=x.y;if(a=Zn(this.transformModel.CanvasPointToHtmlPoint([b,_]),2),b=a[0],_=a[1],Tf([b,_],t,n)!==o){y=!o;break}}return y}if(e.BaseType===Sn.EDGE){e=e;var S=e.startPoint,k=e.endPoint,O=this.transformModel.CanvasPointToHtmlPoint([S.x,S.y]),M=this.transformModel.CanvasPointToHtmlPoint([k.x,k.y]),R=Tf(O,t,n),T=Tf(M,t,n);return i?R&&T:R||T}return!1},r.prototype.graphDataToModel=function(e){var t=this;if(!e){this.clearData();return}if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),e.nodes?this.nodes=so(e.nodes,function(i){var o=t.getModelAfterSnapToGrid(i);return t.elementsModelMap.set(o.id,o),t.nodeModelMap.set(o.id,o),o}):this.nodes=[],e.edges){var n=this.edgeType;this.edges=so(e.edges,function(i){var o,a=t.getModel((o=i.type)!==null&&o!==void 0?o:n);if(!a)throw new Error("找不到".concat(i.type,"对应的边。"));var l=new a(i,t);return t.edgeModelMap.set(l.id,l),t.elementsModelMap.set(l.id,l),l})}else this.edges=[]},r.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(n){var i=n.getData();i&&!n.virtual&&e.push(i)});var t=[];return this.nodes.forEach(function(n){var i=n.getData();i&&!n.virtual&&t.push(i)}),{nodes:t,edges:e}},r.prototype.modelToHistoryData=function(){for(var e=!1,t=[],n=0;n<this.nodes.length;n++){var i=this.nodes[n];if(i.isDragging){e=!0;break}else t.push(i.getHistoryData())}if(e)return!1;for(var o=!1,a=[],l=0;l<this.edges.length;l++){var u=this.edges[l];if(u.isDragging){o=!0;break}else a.push(u.getHistoryData())}return o?!1:{nodes:t,edges:a}},r.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getElement=function(e){return this.modelsMap[e]},r.prototype.getNodeEdges=function(e){for(var t=[],n=0;n<this.edges.length;n++){var i=this.edges[n],o=i.sourceNodeId===e,a=i.targetNodeId===e;(o||a)&&t.push(i)}return t},r.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,n={nodes:[],edges:[]};return t.forEach(function(i){if(i.BaseType===Sn.NODE&&n.nodes.push(i.getData()),i.BaseType===Sn.EDGE){var o=i.getData(),a=t.get(o.sourceNodeId)&&t.get(o.targetNodeId);(e||a)&&n.edges.push(o)}}),n},r.prototype.updateAttributes=function(e,t){var n=this.getElement(e);n==null||n.updateAttributes(t)},r.prototype.changeNodeId=function(e,t){return t||(t=No()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(n){n.sourceNodeId===e&&(n.sourceNodeId=t),n.targetNodeId===e&&(n.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},r.prototype.changeEdgeId=function(e,t){return t||(t=No()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(n){n.id===e&&n.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},r.prototype.getTextModel=function(e){var t=this.editConfigModel,n=t.textMode,i=t.nodeTextMode,o=t.edgeTextMode;if(e.BaseType===Sn.NODE)return e.textMode||i||n||ai.TEXT;if(e.BaseType===Sn.EDGE)return e.textMode||o||n||ai.TEXT},r.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},r.prototype.setFakeNode=function(e){this.fakeNode=e},r.prototype.removeFakeNode=function(){this.fakeNode=null},r.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},r.prototype.toFront=function(e){var t,n,i,o=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((n=this.edgesMap[e])===null||n===void 0?void 0:n.model);o&&(this.overlapMode===xi.DEFAULT&&((i=this.topElement)===null||i===void 0||i.setZIndex(),o.setZIndex(cj),this.topElement=o),this.overlapMode===xi.INCREASE&&this.setElementZIndex(e,"top"))},r.prototype.setElementZIndex=function(e,t){var n,i,o=((n=this.nodesMap[e])===null||n===void 0?void 0:n.model)||((i=this.edgesMap[e])===null||i===void 0?void 0:i.model);if(o){var a=void 0;typeof t=="number"?a=t:(t==="top"&&(a=ig()),t==="bottom"&&(a=H5())),o.setZIndex(a)}},r.prototype.deleteNode=function(e){var t=this.nodesMap[e].model,n=t.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(kt.NODE_DELETE,{data:n,model:t})},r.prototype.addNode=function(e,t,n){t===void 0&&(t=kt.NODE_ADD);var i=vr(e),o=i.id;o&&this.nodesMap[o]&&delete i.id;var a=this.getModelAfterSnapToGrid(i);this.nodes.push(a);var l=a.getData(),u={data:l};return n&&(u.e=n),this.eventCenter.emit(t,u),a},r.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type),n=this.editConfigModel.snapGrid;if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var i=e.x,o=e.y;i&&o&&(e.x=ds(i,this.gridSize,n),e.y=ds(o,this.gridSize,n),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-i,e.text.y+=e.y-o));var a=new t(e,this);return this.nodeModelMap.set(a.id,a),this.elementsModelMap.set(a.id,a),a},r.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){n.x+=30,n.y+=30,n.id="",typeof n.text=="object"&&n.text!==null&&(n.text.x+=30,n.text.y+=30);var i=this.addNode(n);return i.setSelected(!0),t==null||t.setSelected(!1),i.getData()}},r.prototype.moveNode=function(e,t,n,i){var o;i===void 0&&(i=!1);var a=this.nodesMap[e];if(!a){console.warn("不存在id为".concat(e,"的节点"));return}var l=a.model;o=Zn(l.getMoveDistance(t,n,i),2),t=o[0],n=o[1],this.moveEdge(e,t,n)},r.prototype.moveNode2Coordinate=function(e,t,n,i){i===void 0&&(i=!1);var o=this.nodesMap[e];if(!o){console.warn("不存在id为".concat(e,"的节点"));return}var a=o.model,l=a.x,u=a.y,d=t-l,f=n-u;this.moveNode(e,d,f,i)},r.prototype.editText=function(e){this.setElementStateById(e,en.TEXT_EDIT)},r.prototype.addEdge=function(e){var t=vr(e),n=t.type;n||(n=this.edgeType),t.id&&this.edgesMap[t.id]&&(delete t.id,delete t.sourceAnchorId,delete t.targetAnchorId);var i=this.getModel(n);if(!i)throw new Error("找不到".concat(n,"对应的边，请确认是否已注册此类型边。"));var o=new i(hr(hr({},t),{type:n}),this);this.edgeModelMap.set(o.id,o),this.elementsModelMap.set(o.id,o);var a=o.getData();return this.edges.push(o),this.eventCenter.emit(kt.EDGE_ADD,{data:a}),o},r.prototype.moveEdge=function(e,t,n){for(var i=0;i<this.edges.length;i++){var o=this.edges[i],a=o.textPosition,l=a.x,u=a.y,d=this.edges[i].sourceNodeId===e,f=this.edges[i].targetNodeId===e;d&&o.moveStartPoint(t,n),f&&o.moveEndPoint(t,n),(d||f)&&this.handleEdgeTextMove(o,l,u)}},r.prototype.handleEdgeTextMove=function(e,t,n){var i;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===Vt.POLYLINE_EDGE&&(!((i=e.text)===null||i===void 0)&&i.value)){var o=e.text,a=Zx(o,e.points);e.moveText(a.x-o.x,a.y-o.y)}var l=e.textPosition,u=l.x,d=l.y;e.moveText(u-t,d-n)},r.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var n=0;n<this.edges.length;n++)if(this.edges[n].sourceNodeId===e&&this.edges[n].targetNodeId===t){var i=this.edges[n].getData();this.edges.splice(n,1),n--,this.eventCenter.emit(kt.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var n=this.edgesMap[e].index,i=this.edgesMap[e].model.getData();this.edges.splice(n,1),this.eventCenter.emit(kt.EDGE_DELETE,{data:i})}},r.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(kt.EDGE_DELETE,{data:n})}},r.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(kt.EDGE_DELETE,{data:n})}},r.prototype.setElementStateById=function(e,t,n){this.nodes.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(en.DEFAULT)}),this.edges.forEach(function(i){i.id===e?i.setElementState(t,n):i.setElementState(en.DEFAULT)})},r.prototype.updateText=function(e,t){var n=la(ei(ei([],Zn(this.nodes),!1),Zn(this.edges),!1),function(i){return i.id===e});n==null||n.updateText(t)},r.prototype.selectNodeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.nodesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectEdgeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var i=(n=this.edgesMap[e])===null||n===void 0?void 0:n.model;i==null||i.setSelected(!0)},r.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var n=this.getElement(e);n==null||n.setSelected(!0)},r.prototype.deselectElementById=function(e){var t=this.getElement(e);t&&t.setSelected(!1)},r.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===xi.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},r.prototype.moveNodes=function(e,t,n,i){var o,a,l,u=this;i===void 0&&(i=!1);for(var d=e.reduce(function(k,O){var M,R=(M=u.nodesMap[O])===null||M===void 0?void 0:M.model;return R&&(k[O]=R.getMoveDistance(t,n,i)),k},{}),f=0;f<this.edges.length;f++){var h=this.edges[f],g=h.textPosition,y=g.x,w=g.y,x=d[h.sourceNodeId],b=d[h.targetNodeId],_=void 0,S=void 0;x&&b&&h.modelType===Vt.POLYLINE_EDGE?(o=Zn(x,2),_=o[0],S=o[1],h.updatePointsList(_,S)):(x&&(a=Zn(x,2),_=a[0],S=a[1],h.moveStartPoint(_,S)),b&&(l=Zn(b,2),_=l[0],S=l[1],h.moveEndPoint(_,S))),(x||b)&&this.handleEdgeTextMove(h,y,w)}},r.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},r.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},r.prototype.setDefaultEdgeType=function(e){this.edgeType=e},r.prototype.changeNodeType=function(e,t){var n=this.getNodeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的节点"));return}var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var a=new o(i,this);this.nodes.splice(this.nodesMap[e].index,1,a);var l=this.getNodeEdges(e);l.forEach(function(u){if(u.sourceNodeId===e){var d=A_(a,u.startPoint,a.width,a.height);u.updateStartPoint(d)}if(u.targetNodeId===e){var d=A_(a,u.endPoint,a.width,a.height);u.updateEndPoint(d)}})},r.prototype.changeEdgeType=function(e,t){var n=this.getEdgeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的边"));return}if(n.type!==t){var i=n.getData();i.type=t;var o=this.getModel(t);if(!o)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete i.pointsList;var a=new o(i,this);this.edges.splice(this.edgesMap[e].index,1,a)}},r.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetNodeId===e&&t.push(n)}),t},r.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceNodeId===e&&t.push(n)}),t},r.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetAnchorId===e&&t.push(n)}),t},r.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceAnchorId===e&&t.push(n)}),t},r.prototype.getNodeIncomingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){var o;i.targetNodeId===e&&n.push((o=t.nodesMap[i.sourceNodeId])===null||o===void 0?void 0:o.model)}),n},r.prototype.getNodeOutgoingNode=function(e){var t=this,n=[];return this.edges.forEach(function(i){i.sourceNodeId===e&&n.push(t.nodesMap[i.targetNodeId].model)}),n},r.prototype.setTheme=function(e,t){var n;if(t&&(Hl[t]&&this.updateBackgroundOptions(hr(hr({},typeof this.background=="object"?this.background:{}),Hl[t])),$l[t]&&this.updateGridOptions(Ja.getGridOptions(hr(hr({},this.grid),$l[t])))),e.background&&this.updateBackgroundOptions(e.background),e.grid){var i=Ja.getGridOptions((n=e.grid)!==null&&n!==void 0?n:!1);this.updateGridOptions(i)}this.theme=I5(hr(hr({},this.customStyles),e),t),this.customStyles=hr(hr({},this.customStyles),e)},r.prototype.getTheme=function(){var e=this,t=e.background,n=e.grid,i=hr(hr({},Ht(this.theme)),{background:t,grid:n});return i},r.prototype.updateGridOptions=function(e){Qa(this.grid,e)},r.prototype.updateGridSize=function(e){this.gridSize=e},r.prototype.updateBackgroundOptions=function(e){wp(e)||wp(this.background)?this.background=e:this.background=hr(hr({},this.background),e)},r.prototype.resize=function(e,t){this.width=e??this.rootEl.getBoundingClientRect().width,this.isContainerWidth=wr(e),this.height=t??this.rootEl.getBoundingClientRect().height,this.isContainerHeight=wr(t),(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},r.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},r.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],n=[];e.forEach(function(g){var y=g.x,w=g.y,x=g.width,b=g.height,_=g.getNodeStyle().strokeWidth,S=_===void 0?0:_,k=y+x/2+S,O=y-x/2-S,M=w+b/2+S,R=w-b/2-S;t=t.concat([k,O].filter(function(T){return!Number.isNaN(T)})),n=n.concat([M,R].filter(function(T){return!Number.isNaN(T)}))});var i=Math.min.apply(Math,ei([],Zn(t),!1)),o=Math.max.apply(Math,ei([],Zn(t),!1)),a=Math.min.apply(Math,ei([],Zn(n),!1)),l=Math.max.apply(Math,ei([],Zn(n),!1)),u=o-i||0,d=l-a||0,f=i+u/2,h=a+d/2;return{width:u,height:d,x:f,y:h}},r.prototype.translateCenter=function(){var e=this,t=e.nodes,n=e.width,i=e.height,o=e.rootEl,a=e.transformModel;if(t.length){var l=n||o.clientWidth,u=i||o.clientHeight,d=this.getVirtualRectSize(),f=d.x,h=d.y;a.focusOn(f,h,l,u)}},r.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var n=this,i=n.nodes,o=n.width,a=n.height,l=n.rootEl,u=n.transformModel;if(i.length){var d=o||l.clientWidth,f=a||l.clientHeight,h=this.getVirtualRectSize(),g=h.width,y=h.height,w=h.x,x=h.y,b=(g+t)/d,_=(y+e)/f,S=1/Math.max(b,_),k=[d/2,f/2];u.zoom(S,k),u.focusOn(w,x,d,f)}},r.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},r.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},r.prototype.getPartial=function(){return this.partial},r.prototype.setPartial=function(e){this.partial=e},r.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(e){e()})}catch(e){console.warn("error on destroy GraphModel",e)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},Ct([De],r.prototype,"width",void 0),Ct([De],r.prototype,"height",void 0),Ct([De],r.prototype,"theme",void 0),Ct([De],r.prototype,"grid",void 0),Ct([De],r.prototype,"edgeType",void 0),Ct([De],r.prototype,"nodes",void 0),Ct([De],r.prototype,"edges",void 0),Ct([De],r.prototype,"fakeNode",void 0),Ct([De],r.prototype,"overlapMode",void 0),Ct([De],r.prototype,"background",void 0),Ct([De],r.prototype,"gridSize",void 0),Ct([De],r.prototype,"transformModel",void 0),Ct([De],r.prototype,"editConfigModel",void 0),Ct([De],r.prototype,"partial",void 0),Ct([fn],r.prototype,"nodesMap",null),Ct([fn],r.prototype,"edgesMap",null),Ct([fn],r.prototype,"modelsMap",null),Ct([fn],r.prototype,"sortElements",null),Ct([fn],r.prototype,"textEditElement",null),Ct([fn],r.prototype,"selectElements",null),Ct([fn],r.prototype,"selectNodes",null),Ct([Ae],r.prototype,"setTextMode",null),Ct([Ae],r.prototype,"setFakeNode",null),Ct([Ae],r.prototype,"removeFakeNode",null),Ct([Ae],r.prototype,"setModel",null),Ct([Ae],r.prototype,"toFront",null),Ct([Ae],r.prototype,"setElementZIndex",null),Ct([Ae],r.prototype,"deleteNode",null),Ct([Ae],r.prototype,"addNode",null),Ct([Ae],r.prototype,"cloneNode",null),Ct([Ae],r.prototype,"moveNode",null),Ct([Ae],r.prototype,"moveNode2Coordinate",null),Ct([Ae],r.prototype,"editText",null),Ct([Ae],r.prototype,"addEdge",null),Ct([Ae],r.prototype,"moveEdge",null),Ct([Ae],r.prototype,"deleteEdgeBySourceAndTarget",null),Ct([Ae],r.prototype,"deleteEdgeById",null),Ct([Ae],r.prototype,"deleteEdgeBySource",null),Ct([Ae],r.prototype,"deleteEdgeByTarget",null),Ct([Ae],r.prototype,"setElementStateById",null),Ct([Ae],r.prototype,"updateText",null),Ct([Ae],r.prototype,"selectNodeById",null),Ct([Ae],r.prototype,"selectEdgeById",null),Ct([Ae],r.prototype,"selectElementById",null),Ct([Ae],r.prototype,"deselectElementById",null),Ct([Ae],r.prototype,"clearSelectElements",null),Ct([Ae],r.prototype,"moveNodes",null),Ct([Ae],r.prototype,"setDefaultEdgeType",null),Ct([Ae],r.prototype,"changeNodeType",null),Ct([Ae],r.prototype,"changeEdgeType",null),Ct([Ae],r.prototype,"getNodeIncomingEdge",null),Ct([Ae],r.prototype,"getNodeOutgoingEdge",null),Ct([Ae],r.prototype,"getAnchorIncomingEdge",null),Ct([Ae],r.prototype,"getAnchorOutgoingEdge",null),Ct([Ae],r.prototype,"getNodeIncomingNode",null),Ct([Ae],r.prototype,"getNodeOutgoingNode",null),Ct([Ae],r.prototype,"setTheme",null),Ct([Ae],r.prototype,"getTheme",null),Ct([Ae],r.prototype,"resize",null),Ct([Ae],r.prototype,"clearData",null),Ct([Ae],r.prototype,"translateCenter",null),Ct([Ae],r.prototype,"fitView",null),Ct([Ae],r.prototype,"openEdgeAnimation",null),Ct([Ae],r.prototype,"closeEdgeAnimation",null),Ct([Ae],r.prototype,"setPartial",null),r}(),ta=function(){return ta=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ta.apply(this,arguments)},ol=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},RH=function(){function r(e,t){t===void 0&&(t=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e,this.epsilon=t}return r.prototype.getStyle=function(){return ta({},this.graphModel.theme.snapline)},r.prototype.getCenterSnapLine=function(e,t){for(var n=e.x,i=e.y,o=!1,a=!1,l=0;l<t.length;l++){var u=t[l];if(u.id!==e.id&&(vi(n,u.x,this.epsilon)&&(o=!0),vi(i,u.y,this.epsilon)&&(a=!0),o&&a))break}return{isShowVertical:o,isShowHorizontal:a,position:{x:n,y:i}}},r.prototype.getHorizontalSnapline=function(e,t){var n=!1,i=0,o=e.id,a;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)a=Xr(l);else{var u=this.graphModel.getNodeModelById(o);u&&(a=Xr(u))}}for(var d=0;d<t.length;d++){var f=t[d];if(f.id!==e.id){var h=Xr(f);if(vi(h.minY,a==null?void 0:a.minY,this.epsilon)||vi(h.maxY,a==null?void 0:a.minY,this.epsilon)){n=!0,i=a.minY;break}if(vi(h.minY,a==null?void 0:a.maxY,this.epsilon)||vi(h.maxY,a==null?void 0:a.maxY,this.epsilon)){n=!0,i=a.maxY;break}}}return{isShowHorizontal:n,isShowVertical:this.isShowVertical,position:ta(ta({},this.position),{y:i})}},r.prototype.getVerticalSnapline=function(e,t){var n=!1,i=0,o=e.id,a;if(o){var l=this.graphModel.fakeNode;if(l&&l.id===o)a=Xr(l);else{var u=this.graphModel.getNodeModelById(o);u&&(a=Xr(u))}}for(var d=0;d<t.length;d++){var f=t[d];if(f.id!==e.id){var h=Xr(f);if(vi(h.minX,a==null?void 0:a.minX,this.epsilon)){n=!0,i=a.minX;break}if(vi(h.minX,a==null?void 0:a.minX,this.epsilon)||vi(h.maxX,a==null?void 0:a.minX,this.epsilon)){n=!0,i=a.minX;break}if(vi(h.minX,a==null?void 0:a.maxX,this.epsilon)||vi(h.maxX,a==null?void 0:a.maxX,this.epsilon)){n=!0,i=a.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:n,position:ta(ta({},this.position),{x:i})}},r.prototype.getSnapLinePosition=function(e,t){var n=this.getCenterSnapLine(e,t),i=n.isShowHorizontal,o=n.isShowVertical;if(!i){var a=this.getHorizontalSnapline(e,t);a.isShowHorizontal&&(n.isShowHorizontal=a.isShowHorizontal,n.position.y=a.position.y)}if(!o){var l=this.getVerticalSnapline(e,t);l.isShowVertical&&(n.isShowVertical=l.isShowVertical,n.position.x=l.position.x)}return n},r.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,n=e.isShowVertical,i=e.position;this.position=i,this.isShowHorizontal=t,this.isShowVertical=n},r.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},r.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,n=this.getSnapLinePosition(e,t);this.setSnaplineInfo(n)},ol([De],r.prototype,"isShowHorizontal",void 0),ol([De],r.prototype,"isShowVertical",void 0),ol([De],r.prototype,"position",void 0),ol([Ae],r.prototype,"clearSnapline",null),ol([Ae],r.prototype,"setNodeSnapLine",null),r}();function vi(r,e,t){return Math.abs(r-e)<=t}var IH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),BH=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},jH=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},HH=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},$H=function(r){IH(e,r);function e(){var t=r.apply(this,HH([],jH(arguments),!1))||this;return t.handleResize=function(){var n=t.props,i=n.graphModel,o=n.options,a=i.width,l=i.height,u=i.isContainerWidth,d=i.isContainerHeight,f=a,h=l,g=!1;u&&(f=void 0,g=!0),d&&(h=void 0,g=!0),g&&i.resize(f,h),o.width=a,o.height=l},t.throttleResize=NC(t.handleResize,200),t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(kt.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,n,i){i===void 0&&(i="canvas-overlay");var o=this.props.getView,a=o(t.type);return a?Te(a,{model:t,graphModel:n,overlay:i},t.id):null},e.prototype.render=function(){var t=this,n=this.props,i=n.graphModel,o=n.tool,a=n.options,l=n.dnd,u=n.snaplineModel,d={};a.width&&(d.width="".concat(i.width,"px")),a.height&&(d.height="".concat(i.height,"px"));var f=i.fakeNode,h=i.editConfigModel,g=i.background,y=h.adjustEdge;return Te("div",{className:"lf-graph","flow-id":i.flowId,style:d,children:[Te(lH,{graphModel:i,dnd:l,children:[Te("g",{className:"lf-base",children:so(i.sortElements,function(w){return t.getComponent(w,i)})}),f?this.getComponent(f,i):""]}),Te(_H,{graphModel:i,children:[Te(wH,{graphModel:i}),y?Te(cH,{graphModel:i}):"",a.snapline!==!1?Te(CH,{snaplineModel:u}):""]}),Te(NH,{graphModel:i,tool:o}),g&&Te(pH,{background:g}),Te(Ja,{graphModel:i})]})},e=BH([Er],e),e}(Yt),FH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),$i=function(){return $i=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},$i.apply(this,arguments)},zH=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},WH=function(r){FH(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(n){var i=n.event,o=t.props,a=o.anchorData,l=o.nodeModel,u=o.graphModel;u.selectNodeById(l.id),l.autoToFront&&u.toFront(l.id),u.eventCenter.emit(kt.ANCHOR_DRAGSTART,{data:a,e:i,nodeModel:l}),t.setState({startX:a.x,startY:a.y,endX:a.x,endY:a.y})},t.onDragging=function(n){var i=n.event,o=t.props,a=o.graphModel,l=o.nodeModel,u=o.anchorData,d=a.transformModel,f=a.eventCenter,h=a.width,g=a.height,y=a.editConfigModel,w=y.autoExpand,x=y.stopMoveGraph;if(i){var b=i.clientX,_=i.clientY,S=a.getPointByClient({x:b,y:_}),k=S.domOverlayPosition,O=k.x,M=k.y,R=S.canvasOverlayPosition,T=R.x,I=R.y;t.t&&Ld(t.t);var $=[],ne=10;O<10?$=[ne,0]:O+10>h?$=[-ne,0]:M<10?$=[0,ne]:M+10>g&&($=[0,-ne]),t.setState({endX:T,endY:I,dragging:!0}),t.moveAnchorEnd(T,I),$.length>0&&!x&&w&&(t.t=nw(function(){var V=zH($,2),J=V[0],D=V[1];d.translate(J,D);var U=t.state,j=U.endX,fe=U.endY;t.setState({endX:j-J,endY:fe-D}),t.moveAnchorEnd(j-J,fe-D)})),f.emit(kt.ANCHOR_DRAG,{data:u,e:i,nodeModel:l})}},t.onDragEnd=function(n){var i=n.event;t.t&&Ld(t.t);var o=t.checkEnd(i);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var a=t.props,l=a.graphModel,u=a.nodeModel,d=a.anchorData;l.eventCenter.emit(kt.ANCHOR_DRAGEND,{data:d,e:i,nodeModel:u,edgeModel:o??void 0})},t.checkEnd=function(n){var i,o=t.props,a=o.graphModel,l=o.nodeModel,u=o.anchorData,d=u.x,f=u.y,h=u.id,g=t.state,y=g.endX,w=g.endY,x=g.dragging,b=Td({x:y,y:w},a);if(t.preTargetNode&&t.preTargetNode.state!==en.DEFAULT&&t.preTargetNode.setElementState(en.DEFAULT),!!x&&b&&b.node){var _=b.node,S=b.anchor.id,k="".concat(l.id,"_").concat(_.id,"_").concat(S,"_").concat(h),O=t.sourceRuleResults.get(k)||{},M=O.isAllPass,R=O.msg,T=t.targetRuleResults.get(k)||{},I=T.isAllPass,$=T.msg;if(M&&I){_.setElementState(en.DEFAULT);var ne=a.getNodeModelById(b.node.id),V=(i=a.edgeGenerator)===null||i===void 0?void 0:i.call(a,l.getData(),ne==null?void 0:ne.getData()),J=a.addEdge($i($i({},V),{sourceNodeId:l.id,sourceAnchorId:h,startPoint:{x:d,y:f},targetNodeId:b.node.id,targetAnchorId:b.anchor.id,endPoint:{x:b.anchor.x,y:b.anchor.y}})),D=t.props.anchorData;return a.eventCenter.emit(kt.ANCHOR_DROP,{data:D,e:n,nodeModel:l,edgeModel:J}),J}var U=_.getData();return a.eventCenter.emit(kt.CONNECTION_NOT_ALLOWED,{data:U,msg:$||R||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new li({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,n=t.anchorData,i=t.style,o=t.node,a=o.getAnchorShape(n);if(a)return a;var l=n.x,u=n.y,d=$i($i({},i),i==null?void 0:i.hover);return Te("g",{children:[Te(fs,$i({className:"lf-node-anchor-hover"},d,{x:l,y:u})),Te(fs,$i({className:"lf-node-anchor"},i,{x:l,y:u}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,n=t.graphModel,i=n.getAnchorIncomingEdge,o=n.getAnchorOutgoingEdge,a=t.anchorData.id;return{incomingEdgeList:i(a),outgoingEdgeList:o(a)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,n){var i,o,a=this.props,l=a.graphModel,u=a.nodeModel,d=a.anchorData,f=Td({x:t,y:n},l);if(f){var h=f.node,g=f.anchor.id;if(this.preTargetNode&&this.preTargetNode!==f.node&&this.preTargetNode.setElementState(en.DEFAULT),d.id===g)return;this.preTargetNode=h;var y="".concat(u.id,"_").concat(h.id,"_").concat(g,"_").concat(d.id);if(!this.targetRuleResults.has(y)){var w=f.anchor,x=u.isAllowConnectedAsSource(h,d,w),b=h.isAllowConnectedAsTarget(u,d,w);this.sourceRuleResults.set(y,Dd(x)),this.targetRuleResults.set(y,Dd(b))}var _=((i=this.sourceRuleResults.get(y))!==null&&i!==void 0?i:{}).isAllPass,S=((o=this.targetRuleResults.get(y))!==null&&o!==void 0?o:{}).isAllPass;_&&S?h.setElementState(en.ALLOW_CONNECT):h.setElementState(en.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==en.DEFAULT&&this.preTargetNode.setElementState(en.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,n=t.startX,i=t.startY,o=t.endX,a=t.endY,l=wi(n,i,o,a);return l>10},e.prototype.render=function(){var t=this,n=this.state,i=n.startX,o=n.startY,a=n.endX,l=n.endY,u=this.props,d=u.anchorData,f=u.edgeStyle,h=u.nodeModel,g=u.graphModel,y=d.edgeAddable;return Te("g",{className:"lf-anchor",children:[Te("g",{onClick:function(w){w.stopPropagation(),g.eventCenter.emit(kt.ANCHOR_CLICK,{data:d,e:w,nodeModel:h})},onMouseDown:function(w){g.eventCenter.emit(kt.ANCHOR_MOUSEDOWN,{data:d,e:w,nodeModel:h}),y!==!1&&t.dragHandler.handleMouseDown(w)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory($i({sourcePoint:{x:i,y:o},targetPoint:{x:a,y:l}},f)):Te(cs,$i({x1:i,y1:o,x2:a,y2:l},f,{"pointer-events":"none"})))]})},e}(Yt),UH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Qp=function(){return Qp=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Qp.apply(this,arguments)},VH=function(r){UH(e,r);function e(t){var n=r.call(this,t)||this;return n.style={},n.onDragging=function(i){var o,a=i.event,l=n.props,u=l.graphModel,d=l.nodeModel,f=l.eventCenter,h=u.selectNodes,g=d.x,y=d.y,w=a.clientX,x=a.clientY,b=u.getPointByClient({x:w,y:x}).canvasOverlayPosition,_=b.x,S=b.y,k=new ar(_-g,S-y),O=((o=n.normal)===null||o===void 0?void 0:o.angle(k))-n.defaultAngle,M=new Md(-g,-y).rotate(O).translate(g,y).toString();d.transform=M,d.rotate=O;var R=so(h,function(I){return I.id});R.indexOf(d.id)===-1&&(R=[d.id]);var T=MC(R,function(I,$){var ne=u.getNodeModelById($);return I[$]=ne==null?void 0:ne.getMoveDistance(0,0,!1),I},{});R.forEach(function(I){var $=u.getNodeEdges(I);$.forEach(function(ne){if(T[ne.sourceNodeId]){var V=u.getNodeModelById(ne.sourceNodeId),J=V.anchors.find(function(D){return D.id===ne.sourceAnchorId});ne.updateStartPoint(J)}if(T[ne.targetNodeId]){var V=u.getNodeModelById(ne.targetNodeId),J=V.anchors.find(function(j){return j.id===ne.targetAnchorId});ne.updateEndPoint(J)}})}),f.emit(kt.NODE_ROTATE,{e:a,model:d,data:d.getData()})},n.style=t.style,n.stepperDrag=new li({onDragging:n.onDragging}),n}return e.prototype.render=function(){var t=this,n=this.props.nodeModel,i=n.x,o=n.y,a=n.width,l=n.height,u=i+a/2+20,d=o-l/2-20;return this.normal=new ar(1,0),this.defaultAngle=this.normal.angle(new ar(u-i,d-o)),n.defaultAngle=this.defaultAngle,Te("g",{className:"lf-rotate-control",children:Te("g",{onMouseDown:function(f){t.stepperDrag.handleMouseDown(f)},children:Te(fs,Qp({},this.style,{cx:u,cy:d}))})})},e}(Yt),If={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var z_;function qH(){return z_||(z_=1,function(r){(function(){var e={}.hasOwnProperty;function t(){for(var o="",a=0;a<arguments.length;a++){var l=arguments[a];l&&(o=i(o,n(l)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var l in o)e.call(o,l)&&o[l]&&(a=i(a,l));return a}function i(o,a){return a?o?o+" "+a:o+a:o}r.exports?(t.default=t,r.exports=t):window.classNames=t})()}(If)),If.exports}var XH=qH();const ev=ha(XH);var GH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),tv=function(){return tv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},tv.apply(this,arguments)},YH=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},uw=function(r){GH(e,r);function e(t){var n=r.call(this)||this;n.mouseDownHandler=function(o){var a=n.props,l=a.draggable,u=a.model,d=a.graphModel,f=d.editConfigModel.nodeTextDraggable;(l??f)&&(o.stopPropagation(),n.stepperDrag.model=u,n.stepperDrag.handleMouseDown(o))},n.onDragging=function(o){var a=o.deltaX,l=o.deltaY,u=n.props,d=u.model,f=u.graphModel.transformModel;if(a||l){var h=YH(f.fixDeltaXY(a,l),2),g=h[0],y=h[1];d.moveText(g,y)}},n.dbClickHandler=function(){var o=n.props,a=o.editable,l=o.graphModel.eventCenter,u=o.model;a&&u.setElementState(en.TEXT_EDIT),l.emit(kt.TEXT_DBCLICK,{data:u.text,model:u})};var i=t.draggable;return n.stepperDrag=new li({onDragging:n.onDragging,step:1,eventType:"TEXT",isStopPropagation:i}),n}return e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,a=n.text,l=a.value,u=a.x,d=a.y,f=a.editable,h=a.draggable,g={x:u,y:d,className:"",value:l},y=n.getTextStyle(),w=o.nodeTextDraggable||h;return Te(rw,tv({},g,y,{className:ev({"lf-element-text":f,"lf-text-draggable":!f&&w,"lf-text-disabled":!f&&!w}),model:n}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return Te("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(Yt),KH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gi=function(){return gi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gi.apply(this,arguments)},Qu=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},JH=function(r){KH(e,r);function e(t){var n=r.call(this,t)||this;return n.setHoverOn=function(){n.setState({isHovered:!0})},n.setHoverOff=function(){n.setState({isHovered:!1})},n.state={isHovered:!1},n}return e.prototype.getBackground=function(){var t=this.state.isHovered,n=this.props.model,i=n.text,o=n.getTextStyle(),a=o.background||{};if(t&&o.hover&&o.hover.background&&(a=gi(gi({},a),o.hover.background)),i!=null&&i.value&&(a==null?void 0:a.fill)!=="transparent"){var l=o.fontSize,u=o.textWidth,d=o.lineHeight,f=o.overflowMode,h=a.wrapPadding,g=i==null?void 0:i.value.split(/[\r\n]/g),y=g.length,w=i.x,x=i.y,b={};if(f==="autoWrap"&&u){var _=tw({rows:g,style:{fontSize:"".concat(l,"px"),width:"".concat(u,"px"),lineHeight:d,padding:h},rowsLength:y,className:"lf-get-text-height"});b=gi(gi({},a),{x:w,y:x,width:u,height:_})}else{var S=Pj({rows:g,rowsLength:y,fontSize:l}),k=S.width,O=S.height;if(f==="ellipsis"&&(k=u,O=l+2),typeof a.wrapPadding=="string"){var M=a.wrapPadding.split(",").filter(function(rt){return rt.trim()}).map(function(rt){return parseFloat(rt.trim())});if(M.length>0&&M.length<=4){if(M.length===1){var R=Qu(M,1),T=R[0];M=[T,T,T,T]}else if(M.length===2){var I=Qu(M,2),$=I[0],ne=I[1];M=[$,ne,$,ne]}else if(M.length===3){var V=Qu(M,3),J=V[0],ne=V[1],D=V[2];M=[J,ne,D,ne]}var U=Qu(M,4),j=U[0],fe=U[1],Ee=U[2],_e=U[3];k+=fe+_e,O+=j+Ee,w=w+(fe-_e)/2,x=x+(Ee-j)/2}}b=gi(gi({},a),{x:w-1,y:x-1,width:k,height:O})}return Te(ii,gi({},b))}return null},e.prototype.getShape=function(){var t=this.props.model,n=t.text,i=n.x,o=n.y,a=n.value;if(!a)return null;var l=t.getTextStyle(),u=gi({x:i,y:o,value:a,model:t,className:"lf-element-text"},l);return Te("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),Te(rw,gi({},u))]})},e}(uw),ZH=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bd=function(){return Bd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Bd.apply(this,arguments)},QH=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},ed=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Io=function(r){ZH(e,r);function e(t){var n=r.call(this)||this;n.onDragStart=function(u){var d=u.event,f=n.props,h=f.model,g=f.graphModel;if(d){var y=g.getPointByClient({x:d.clientX,y:d.clientY}).canvasOverlayPosition,w=y.x,x=y.y;n.moveOffset={dx:h.x-w,dy:h.y-x}}},n.onDragging=function(u){var d,f,h,g,y=u.event,w=n.props,x=w.model,b=w.graphModel,_=b.editConfigModel,S=_.stopMoveGraph,k=_.autoExpand,O=_.snapGrid,M=b.transformModel,R=b.selectNodes,T=b.width,I=b.height,$=b.gridSize;x.isDragging=!0;var ne=y,V=ne.clientX,J=ne.clientY,D=b.getPointByClient({x:V,y:J}).canvasOverlayPosition,U=D.x,j=D.y,fe=ed(M.CanvasPointToHtmlPoint([U,j]),2),Ee=fe[0],_e=fe[1];if(U=U+((f=(d=n.moveOffset)===null||d===void 0?void 0:d.dx)!==null&&f!==void 0?f:0),j=j+((g=(h=n.moveOffset)===null||h===void 0?void 0:h.dy)!==null&&g!==void 0?g:0),U=ds(U,$,O),j=ds(j,$,O),!T||!I){b.moveNode2Coordinate(x.id,U,j);return}var rt=Ee<0||_e<0||Ee>T||_e>I;if(!(k&&!S&&rt)){var Me=ed(M.CanvasPointToHtmlPoint([U-x.width/2,j-x.height/2]),2),ve=Me[0],Ve=Me[1],Be=ed(M.CanvasPointToHtmlPoint([U+x.width/2,j+x.height/2]),2),de=Be[0],le=Be[1],W=Math.max($,20),Y=[];ve<0?Y=[W,0]:de>b.width?Y=[-W,0]:Ve<0?Y=[0,W]:le>b.height&&(Y=[0,-W]),n.t&&Ld(n.t);var se=R.map(function(ge){return ge.id});se.indexOf(x.id)===-1&&(se=[x.id]),Y.length>0&&!S&&k?n.t=nw(function(){var ge=ed(Y,2),Pe=ge[0],Le=ge[1];M.translate(Pe??0,Le??0);var He=-(Pe??0)/M.SCALE_X,ft=-(Le??0)/M.SCALE_X;b.moveNodes(se,He,ft)}):b.moveNodes(se,U-x.x,j-x.y)}},n.onDragEnd=function(){n.t&&Ld(n.t);var u=n.props.model;u.isDragging=!1},n.onMouseOut=function(u){dj()&&n.setHoverOff(u)},n.handleMouseUp=function(){var u=n.props.model;n.mouseUpDrag=u.isDragging},n.handleClick=function(u){var d=n.mouseUpDrag===!1;if(n.startTime){var f=n.props,h=f.model,g=f.graphModel;if(d){var y=h.getData(),w=g.getPointByClient({x:u.clientX,y:u.clientY}),x={data:y,e:u,position:w,isSelected:!1,isMultiple:!1},b=u.button===2,_=u.detail===2;if(!b){var S=g.editConfigModel,k=Qx(u,S);x.isMultiple=k,h.isSelected&&!_&&k?(x.isSelected=!1,h.setSelected(!1)):(g.selectNodeById(h.id,k),x.isSelected=!0,S.isSilentMode||n.toFront()),_?(S.nodeTextEdit&&h.text.editable&&S.textMode===ai.TEXT&&(h.setSelected(!1),g.setElementStateById(h.id,en.TEXT_EDIT)),g.eventCenter.emit(kt.NODE_DBCLICK,x)):(g.eventCenter.emit(kt.ELEMENT_CLICK,x),g.eventCenter.emit(kt.NODE_CLICK,x))}}}},n.handleContextMenu=function(u){u.preventDefault();var d=n.props,f=d.model,h=d.graphModel,g=h.editConfigModel,y=f.getData(),w=h.getPointByClient({x:u.clientX,y:u.clientY});h.setElementStateById(f.id,en.SHOW_MENU,w.domOverlayPosition),f.isSelected||h.selectNodeById(f.id),h.eventCenter.emit(kt.NODE_CONTEXTMENU,{data:y,e:u,position:w}),g.isSilentMode||n.toFront()},n.handleMouseDown=function(u){var d=n.props,f=d.model,h=d.graphModel;n.startTime=new Date().getTime();var g=h.editConfigModel;g.adjustNodePosition&&f.draggable&&n.stepDrag&&n.stepDrag.handleMouseDown(u)},n.handleFocus=function(){var u=n.props,d=u.model,f=u.graphModel;f.eventCenter.emit(kt.NODE_FOCUS,{data:d.getData()})},n.handleBlur=function(){var u=n.props,d=u.model,f=u.graphModel;f.eventCenter.emit(kt.NODE_BLUR,{data:d.getData()})},n.setHoverOn=function(u){var d=n.props,f=d.model,h=d.graphModel;if(!f.isHovered){var g=f.getData();f.setHovered(!0),h.eventCenter.emit(kt.NODE_MOUSEENTER,{data:g,e:u})}},n.setHoverOff=function(u){var d=n.props,f=d.model,h=d.graphModel,g=f.getData();f.isHovered&&(f.setHovered(!1),h.eventCenter.emit(kt.NODE_MOUSELEAVE,{data:g,e:u}))};var i=t.graphModel,o=i.gridSize,a=i.eventCenter,l=t.model;return n.stepDrag=new li({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:o,eventType:"NODE",isStopPropagation:!1,eventCenter:a,model:l}),n.modelDisposer=Ox(function(){return n.props},function(u){u&&u.model&&n.stepDrag.setModel(u.model)}),n}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,n=this.props,i=n.model,o=n.graphModel,a=i.isSelected,l=i.isHitable,u=i.isDragging,d=i.isShowAnchor;return l&&(a||d)&&!u?so(i.anchors,function(f,h){var g=i.getAnchorLineStyle(f),y=i.getAnchorStyle(f);return Te(WH,{anchorData:f,node:t,style:y,edgeStyle:g,anchorIndex:h,nodeModel:i,graphModel:o,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,a=o.isSilentMode,l=o.allowRotate,u=n.isSelected,d=n.isHitable,f=n.rotatable,h=n.isHovered,g=l&&f,y=n.getRotateControlStyle();if(!a&&d&&(u||h)&&g)return Te(VH,{graphModel:i,nodeModel:n,eventCenter:i.eventCenter,style:y})},e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,a=o.isSilentMode,l=o.allowResize,u=n.isSelected,d=n.isHitable,f=n.resizable,h=n.isHovered,g=l&&f,y=n.getResizeControlStyle();return!a&&d&&(u||h)&&g?Te(d5,{style:y,model:n,graphModel:i}):null},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,a=o.editConfigModel;if(a.nodeTextMode!==ai.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var l=!1;return a.nodeTextDraggable&&i.text.draggable&&(l=!0),Te(uw,{editable:a.nodeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,n=t.state,i=t.isDragging,o=t.isSelected,a="lf-node";switch(n){case en.ALLOW_CONNECT:a+=" lf-node-allow";break;case en.NOT_ALLOW_CONNECT:a+=" lf-node-not-allow";break;default:a+=" lf-node-default";break}return i&&(a+=" lf-dragging"),o&&(a+=" lf-node-selected"),a},e.prototype.toFront=function(){var t=this.props,n=t.model,i=t.graphModel;n.autoToFront&&i.toFront(n.id)},e.prototype.render=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,a=o.hideAnchors,l=o.adjustNodePosition,u=o.allowRotate,d=o.allowResize,f=i.gridSize,h=i.transformModel.SCALE_X,g=n.isHitable,y=n.draggable,w=n.transform,x=n.getOuterGAttributes(),b=x.className,_=b===void 0?"":b,S=QH(x,["className"]),k=Te("g",{className:"lf-node-content",children:[Te("g",{transform:w,children:[this.getShape(),this.getText(),u&&this.getRotateControl(),d&&this.getResizeControl()]}),!a&&this.getAnchors()]}),O;return g?(l&&y&&this.stepDrag.setStep(f*h),O=Te("g",Bd({className:"".concat(this.getStateClassName()," ").concat(_),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},S,{children:k}))):O=Te("g",Bd({className:"".concat(this.getStateClassName()," ").concat(_)},S,{children:k})),O},e.isObserved=!1,e}(Yt),e$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),nv=function(){return nv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},nv.apply(this,arguments)},ca=function(r){e$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Te(ii,nv({},n,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(Io),t$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),rv=function(){return rv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},rv.apply(this,arguments)},jd=function(r){t$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.r,a=t.getNodeStyle();return Te(fs,rv({},a,{x:n,y:i,r:o}))},e}(Io),n$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Hd=function(){return Hd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Hd.apply(this,arguments)},$d=function(r){n$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,a=n.width,l=n.height,u=n.points,d=t.getNodeStyle(),f={transform:"matrix(1 0 0 1 ".concat(i-a/2," ").concat(o-l/2,")")};return Te("g",Hd({},f,{children:Te(rg,Hd({},d,{points:u,x:i,y:o}))}))},e}(Io),r$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),iv=function(){return iv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},iv.apply(this,arguments)},ov=function(r){r$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Te("g",{children:Te(rg,iv({},n,{points:t.points,x:t.x,y:t.y}))})},e}(Io),i$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),av=function(){return av=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},av.apply(this,arguments)},sv=function(r){i$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return Te(n5,av({},n,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(Io),o$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Sl=function(){return Sl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Sl.apply(this,arguments)},W_=function(r){o$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,n=t.getTextStyle(),i=t.width,o=t.height,a=t.x,l=t.y,u=Sl(Sl({},n.background),{x:a,y:l,width:i,height:o});return Te(ii,Sl({},u))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return Te("g",{children:this.getBackground()})},e}(Io),a$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),lv=function(){return lv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},lv.apply(this,arguments)},s$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},l$=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Wl=function(r){a$(e,r);function e(){var t=r.apply(this,l$([],s$(arguments),!1))||this;return t.ref=gc(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.height,a=t.width,l=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),Te("foreignObject",lv({},l,{x:n-a/2,y:i-o/2,width:a,height:o,ref:this.ref}))},e}(Io),u$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),mi=function(){return mi=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},mi.apply(this,arguments)},d$=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},c$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},zi;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(zi||(zi={}));var U_=function(r){u$(e,r);function e(t){var n=r.call(this)||this;n.handleMouseDown=function(u){n.stepDrag&&n.stepDrag.handleMouseDown(u)},n.onDragStart=function(){var u=n.props,d=u.x,f=u.y,h=u.edgeModel,g=h.startPoint,y=h.endPoint,w=h.pointsList;n.oldEdge={startPoint:g,endPoint:y,pointsList:w},n.setState({endX:d,endY:f,dragging:!0})},n.onDragging=function(u){var d=u.deltaX,f=u.deltaY,h=n.state,g=h.endX,y=h.endY,w=n.props,x=w.graphModel,b=w.type,_=x.transformModel,S=x.editConfigModel,k=c$(_.moveCanvasPointByHtml([g,y],d,f),2),O=k[0],M=k[1];n.setState({endX:O,endY:M,dragging:!0});var R=n.props.edgeModel,T=Td({x:g,y},x);if(T&&T.node&&n.isAllowAdjust(T).pass){var I=R.startPoint,$=R.endPoint,ne=R.sourceNode,V=R.targetNode,J=b===zi.SOURCE?{startPoint:{x:T.anchor.x,y:T.anchor.y},endPoint:{x:$.x,y:$.y},sourceNode:T.node,targetNode:V}:{startPoint:{x:I.x,y:I.y},endPoint:{x:T.anchor.x,y:T.anchor.y},sourceNode:ne,targetNode:T.node};R.updateAfterAdjustStartAndEnd(J)}else b===zi.SOURCE?R.updateStartPoint({x:O,y:M}):R.updateEndPoint({x:O,y:M});R.text.value&&S.adjustEdge&&R.setText(Object.assign({},R.text,R.textPosition))},n.onDragEnd=function(u){var d,f,h,g=u.event;try{n.setState({dragging:!1});var y=n.props,w=y.graphModel,x=y.edgeModel,b=y.type,_=n.state,S=_.endX,k=_.endY,O=_.dragging,M=Td({x:S,y:k},w);if(!O)return;var R=!1,T=void 0;if(M&&M.node){var I=n.isAllowAdjust(M),$=I.pass,ne=I.msg,V=I.newTargetNode;if($){var J=x.getData(),D=J.text,U=J.sourceAnchorId,j=U===void 0?"":U,fe=J.targetAnchorId,Ee=fe===void 0?"":fe,_e=d$(J,["text","sourceAnchorId","targetAnchorId"]);if(T=mi(mi({sourceAnchorId:j,targetAnchorId:Ee},_e),{text:(D==null?void 0:D.value)||""}),b===zi.SOURCE){var rt=w.getNodeModelById(M.node.id),Me=w.getNodeModelById(x.targetNodeId),ve=(d=w.edgeGenerator)===null||d===void 0?void 0:d.call(w,rt==null?void 0:rt.getData(),Me==null?void 0:Me.getData(),T);T=mi(mi({},ve),{sourceNodeId:M.node.id,sourceAnchorId:M.anchor.id,startPoint:{x:M.anchor.x,y:M.anchor.y},targetNodeId:x.targetNodeId,endPoint:mi({},x.endPoint)}),x.sourceNodeId===M.node.id&&x.sourceAnchorId===M.anchor.id&&(R=!0)}else if(b===zi.TARGET){var rt=w.getNodeModelById(x.sourceNodeId),Me=w.getNodeModelById(M.node.id),ve=(f=w.edgeGenerator)===null||f===void 0?void 0:f.call(w,rt==null?void 0:rt.getData(),Me==null?void 0:Me.getData(),T);T=mi(mi({},ve),{sourceNodeId:x.sourceNodeId,startPoint:mi({},x.startPoint),targetNodeId:M.node.id,targetAnchorId:M.anchor.id,endPoint:{x:M.anchor.x,y:M.anchor.y}}),x.targetNodeId===M.node.id&&x.targetAnchorId===M.anchor.id&&(R=!0)}}else{R=!0;var Ve=V.getData();w.eventCenter.emit(kt.CONNECTION_NOT_ALLOWED,{data:Ve,msg:ne})}}else R=!0;if(R)n.recoveryEdge();else{var Be=x.getData();w.deleteEdgeById(x.id);var de=w.addEdge(mi({},T));w.eventCenter.emit(kt.EDGE_EXCHANGE_NODE,{data:{newEdge:de.getData(),oldEdge:Be}})}(h=n.preTargetNode)===null||h===void 0||h.setElementState(en.DEFAULT)}finally{var w=n.props.graphModel;w.eventCenter.emit(kt.ADJUST_POINT_DRAGEND,{e:g,data:n.stepDragData})}},n.recoveryEdge=function(){var u=n.props.edgeModel,d=n.oldEdge,f=d.startPoint,h=d.endPoint,g=d.pointsList;u.updateStartPoint(f),u.updateEndPoint(h),u.modelType!==Vt.LINE_EDGE&&(u.pointsList=g??[],u.initPoints())},n.getAdjustPointStyle=function(){var u=n.props.graphModel.theme,d=u.edgeAdjust;return d},n.state={dragging:!1,endX:0,endY:0},n.targetRuleResults=new Map,n.sourceRuleResults=new Map;var i=t.type,o=t.edgeModel,a=t.graphModel,l=a.eventCenter;return n.stepDragData={type:i,edgeData:o.getData()},n.stepDrag=new li({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:l,data:n.stepDragData}),n}return e.prototype.isAllowAdjust=function(t){var n=this.props,i=n.edgeModel,o=i.id,a=i.sourceNode,l=i.targetNode,u=i.sourceAnchorId,d=i.targetAnchorId,f=n.type,h,g,y,w;if(f===zi.SOURCE?(h=t.node,g=l,y=t.anchor,w=l.getAnchorInfo(d)):(h=a,g=t.node,w=t.anchor,y=a.getAnchorInfo(u)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(en.DEFAULT),this.preTargetNode=t.node,w.id===y.id)return{pass:!1,msg:"",newTargetNode:g};var x="".concat(h.id,"_").concat(g.id,"_").concat(y.id,"_").concat(w.id);if(!this.targetRuleResults.has(x)){var b=h.isAllowConnectedAsSource(g,y,w,o),_=g.isAllowConnectedAsTarget(h,y,w,o);this.sourceRuleResults.set(x,Dd(b)),this.targetRuleResults.set(x,Dd(_))}var S=this.sourceRuleResults.get(x),k=S.isAllPass,O=S.msg,M=this.targetRuleResults.get(x),R=M.isAllPass,T=M.msg,I=k&&R?en.ALLOW_CONNECT:en.NOT_ALLOW_CONNECT;return f===zi.SOURCE?h.setElementState(I):g.setElementState(I),{pass:k&&R,msg:T||O,newTargetNode:g}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.getAdjustPointShape,a=t.edgeModel,l=this.state.dragging;return Te("g",{pointerEvents:l?"none":"",onMouseDown:this.handleMouseDown,children:l?"":o(n,i,a)})},e}(Yt),f$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),uv=function(){return uv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},uv.apply(this,arguments)};(function(r){f$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,n=t.arrowInfo,i=t.style,o=n.start,a=n.end,l={start:o,end:a,offset:i.offset,verticalLength:i.verticalLength,type:"end"},u=Ll(l),d=u.leftX,f=u.leftY,h=u.rightX,g=u.rightY;return uv({d:"M".concat(d," ").concat(f," L").concat(a.x," ").concat(a.y," L").concat(h," ").concat(g," z")},i)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),n=t.d,i=t.strokeWidth,o=t.stroke,a=t.fill;return Te(Il,{d:n,fill:a,strokeWidth:i,stroke:o})},e.prototype.render=function(){return Te("g",{className:"lf-arrow",children:this.getShape()})},e})(Yt);var h$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),El=function(){return El=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},El.apply(this,arguments)},p$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Ec=function(r){h$(e,r);function e(){var t=r.call(this)||this;return t.textRef=gc(),t.handleHover=function(n,i){var o=t.props,a=o.model,l=o.graphModel.eventCenter;a.setHovered(n);var u=n?kt.EDGE_MOUSEENTER:kt.EDGE_MOUSELEAVE,d=a.getData();l.emit(u,{data:d,e:i})},t.setHoverOn=function(n){var i=t.props.model.isHovered;i||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,n))},t.setHoverOff=function(n){var i=t.props.model.isHovered;i&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,n))},t.handleContextMenu=function(n){n.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var i=t.props,o=i.model,a=i.graphModel,l=a.editConfigModel,u=a.getPointByClient({x:n.clientX,y:n.clientY});a.setElementStateById(o.id,en.SHOW_MENU,u.domOverlayPosition),l.isSilentMode||t.toFront(),o.isSelected||a.selectEdgeById(o.id);var d=o==null?void 0:o.getData();a.eventCenter.emit(kt.EDGE_CONTEXTMENU,{data:d,e:n,position:u})},t.handleMouseDown=function(n){n.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(){var n=t.props.model;t.mouseUpDrag=n.isDragging},t.handleClick=function(n){if(t.startTime&&!t.mouseUpDrag){var i=n.button===2;if(!i){var o=n.detail===2,a=t.props,l=a.model,u=a.graphModel,d=l==null?void 0:l.getData(),f=u.getPointByClient({x:n.clientX,y:n.clientY});if(o){var h=u.editConfigModel,g=u.textEditElement,y=l.id,w=l.text,x=l.modelType;if(g&&g.id===y&&u.setElementStateById(y,en.DEFAULT),h.edgeTextEdit&&w.editable&&(l.setSelected(!1),u.setElementStateById(y,en.TEXT_EDIT)),x===Vt.POLYLINE_EDGE){var b=l,_=u.getPointByClient({x:n.x,y:n.y}).canvasOverlayPosition,S=_.x,k=_.y;b.dbClickPosition=Zx({x:S,y:k},b.points)}u.eventCenter.emit(kt.EDGE_DBCLICK,{data:d,e:n,position:f})}else u.eventCenter.emit(kt.ELEMENT_CLICK,{data:d,e:n,position:f}),u.eventCenter.emit(kt.EDGE_CLICK,{data:d,e:n,position:f});var O=u.editConfigModel;u.selectEdgeById(l.id,Qx(n,O)),O.isSilentMode||t.toFront()}}},t.handleFocus=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(kt.EDGE_FOCUS,{data:i.getData()})},t.handleBlur=function(){var n=t.props,i=n.model,o=n.graphModel;o.eventCenter.emit(kt.EDGE_BLUR,{data:i.getData()})},t}return e.prototype.getShape=function(){return Te("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,n=this.props,i=n.model,o=n.graphModel,a=o.editConfigModel;if(a.edgeTextMode!==ai.TEXT||i.state===en.TEXT_EDIT)return null;if(i.text){var l=!1;return a.edgeTextDraggable&&i.text.draggable&&(l=!0),Te(JH,{ref:this.textRef,editable:a.edgeTextEdit&&((t=i.text.editable)!==null&&t!==void 0?t:!0),model:i,graphModel:o,draggable:l})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isSelected,a=this.state.hover;return{start:n,end:i,hover:a,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint;return[n,i]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,n=t.id,i=t.getArrowStyle(),o=i.refY,a=o===void 0?0:o,l=i.refX,u=l===void 0?2:l,d=p$(this.getLastTwoPoints(),2),f=d[0],h=d[1],g="auto";if(f&&h){var y=h.x-f.x,w=h.y-f.y;if(y!==0||w!==0){var x=k5(C5({x:y,y:w}));Number.isFinite(x)&&!Number.isNaN(x)&&(g=x)}}return Te("g",{children:Te("defs",{children:[Te("marker",{id:"marker-start-".concat(n),refX:-u,refY:a,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),Te("marker",{id:"marker-end-".concat(n),refX:u,refY:a,overflow:"visible",orient:g,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getArrowPath=function(t,n){var i=n.stroke,o=n.fill,a=o===void 0?i:o,l=n.strokeWidth,u=n.offset,d=u===void 0?10:u,f=n.verticalLength,h=n.strokeLinecap,g=n.strokeLinejoin,y=n.transform,w="";switch(t){case"solid":w="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(f," L").concat(3*d/4,",-").concat(f," Z");break;case"hollow":w="M".concat(-d/4,",0 L").concat(3*d/4,",").concat(f," L").concat(-d/4,",0 L").concat(3*d/4,",-").concat(f," L").concat(-d/4,",0 Z");break;case"diamond":w="M".concat(-d/2,",0 L0,").concat(f," L").concat(d/2,",0 L0,-").concat(f," L").concat(-d/2,",0 Z");break;case"circle":w="M".concat(-d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(d/2,",0 A").concat(d/4,",").concat(d/4," 0 1,0 ").concat(-d/2,",0 Z");break;default:w="";break}return Te("path",{d:w,stroke:i,fill:a,strokeWidth:l,strokeLinecap:h,strokeLinejoin:g,transform:y})},e.prototype.getStartArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,a=n.offset,l=n.verticalLength,u=n.startArrowType,d=u===void 0?"none":u,f=n.strokeLinecap,h=n.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:o,offset:a,verticalLength:l,strokeLinecap:f,strokeLinejoin:h})},e.prototype.getEndArrow=function(){var t=this.props.model,n=t.getArrowStyle(),i=n.stroke,o=n.strokeWidth,a=n.offset,l=n.verticalLength,u=n.endArrowType,d=u===void 0?"solid":u,f=n.strokeLinecap,h=n.strokeLinejoin;return this.getArrowPath(d,{stroke:i,strokeWidth:o,offset:a,verticalLength:l,strokeLinecap:f,strokeLinejoin:h,transform:"rotate(180)"})},e.prototype.getAdjustPointShape=function(t,n,i){var o=i.getAdjustPointStyle();return Te(fs,El({className:"lf-edge-adjust-point"},o,{x:t,y:n}))},e.prototype.getAdjustPoints=function(){var t=this.props,n=t.model,i=t.graphModel,o=i.editConfigModel,a=o.adjustEdgeStartAndEnd,l=o.adjustEdgeStart,u=o.adjustEdgeEnd,d=n.getAdjustStart(),f=n.getAdjustEnd();return Te("g",{children:[a&&l&&Te(U_,El({type:zi.SOURCE},d,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i})),a&&u&&Te(U_,El({type:zi.TARGET},f,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:i}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return Te("g",{})},e.prototype.getAppend=function(){return Te("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,n=t.graphModel,i=t.model;n.toFront(i.id)},e.prototype.render=function(){var t=this.props.model,n=t.isSelected,i=t.isHitable,o=t.isShowAdjustPoint;return Te("g",{children:[Te("g",{className:["lf-edge",!i&&"pointer-none",n&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),o&&n?this.getAdjustPoints():""]})},e.isObserved=!1,e}(Yt),v$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),dv=function(){return dv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},dv.apply(this,arguments)},g$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},cv=function(r){v$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.getEdgeStyle(),i=t,o=i.path,a=i.isAnimation,l=i.arrowConfig,u=t.getEdgeAnimationStyle(),d=u.strokeDasharray,f=u.stroke,h=u.strokeDashoffset,g=u.animationName,y=u.animationDuration,w=u.animationIterationCount,x=u.animationTimingFunction,b=u.animationDirection;return Te(Il,dv({d:o},n,l,a?{strokeDasharray:d,stroke:f,style:{strokeDashoffset:h,animationName:g,animationDuration:y,animationIterationCount:w,animationTimingFunction:x,animationDirection:b}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return Te(Il,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,n=this.state.hover,i=t.isSelected,o=t.getArrowStyle().offset,a=t.pointsList.map(function(h){return{x:h.x,y:h.y}}),l=g$(E_(a,o),2),u=l[0],d=l[1],f={start:u,end:d,hover:n,isSelected:i};return f},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.getArrowStyle().offset,i=t.pointsList.map(function(o){return{x:o.x,y:o.y}});return E_(i,n)},e}(Ec),m$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),fv=function(){return fv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},fv.apply(this,arguments)},V_=function(r){m$(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o=t.isAnimation,a=t.arrowConfig,l=t.getEdgeStyle(),u=t.getEdgeAnimationStyle(),d=u.strokeDasharray,f=u.stroke,h=u.strokeDashoffset,g=u.animationName,y=u.animationDuration,w=u.animationIterationCount,x=u.animationTimingFunction,b=u.animationDirection;return Te(cs,fv({},l,{x1:n.x,y1:n.y,x2:i.x,y2:i.y},a,o?{strokeDasharray:d,stroke:f,style:{strokeDashoffset:h,animationName:g,animationDuration:y,animationIterationCount:w,animationTimingFunction:x,animationDirection:b}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,n=t.startPoint,i=t.endPoint,o={start:n,end:i},a=Tj(o),l=a.d,u=a.strokeWidth,d=a.fill,f=a.strokeDasharray,h=a.stroke;return Te(Il,{d:l,fill:d,strokeWidth:u,stroke:h,strokeDasharray:f})},e}(Ec),y$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),na=function(){return na=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},na.apply(this,arguments)},_$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},vs=function(r){y$(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(){var n=t.props.model;n.dragAppendStart(),t.isShowAdjustPointTemp=n.isShowAdjustPoint,n.isShowAdjustPoint=!1},t.onDragging=function(n){var i=n.deltaX,o=n.deltaY,a=t.props,l=a.model,u=a.graphModel;t.isDragging=!0;var d=u.transformModel,f=u.editConfigModel,h=_$(d.fixDeltaXY(i,o),2),g=h[0],y=h[1],w=l,x=f.adjustEdgeMiddle;x?t.appendInfo=w.dragAppendSimple(t.appendInfo,{x:g,y}):t.appendInfo=w.dragAppend(t.appendInfo,{x:g,y})},t.onDragEnd=function(){var n,i=t.props,o=i.model,a=i.graphModel.eventCenter,l=o;l.dragAppendEnd(),t.isDragging=!1,l.isShowAdjustPoint=(n=t.isShowAdjustPointTemp)!==null&&n!==void 0?n:!1,t.appendInfo=void 0,a.emit(kt.EDGE_ADJUST,{data:l.getData()})},t.beforeDragStart=function(n,i){i.draggable&&t.drag.handleMouseDown(n),t.appendInfo=i},t.drag=new li({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,a=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),u=l.strokeDasharray,d=l.stroke,f=l.strokeDashoffset,h=l.animationName,g=l.animationDuration,y=l.animationIterationCount,w=l.animationTimingFunction,x=l.animationDirection;return Te(a5,na({points:n},a,o,i?{strokeDasharray:u,stroke:d,style:{strokeDashoffset:f,animationName:h,animationDuration:g,animationIterationCount:y,animationTimingFunction:w,animationDirection:x}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.points,i=t.isSelected,o=this.state.hover,a=da(n),l=a[0],u=a[0];return a.length>=2&&(l=a[a.length-2],u=a[a.length-1]),{start:l,end:u,hover:o,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.points,i=da(n),o=i[0],a=i[0];return i.length>=2&&(o=i[i.length-2],a=i[i.length-1]),[o,a]},e.prototype.getAppendAttributes=function(t){var n=t.start,i=t.end,o;if(n.x===i.x&&n.y===i.y)o="";else{var a={start:n,end:i,offset:10,verticalLength:5},l=Ll(na(na({},a),{type:"start"})),u=Ll(na(na({},a),{type:"end"}));o="M".concat(l.leftX," ").concat(l.leftY,`
      L`).concat(l.rightX," ").concat(l.rightY,`
      L`).concat(u.rightX," ").concat(u.rightY,`
      L`).concat(u.leftX," ").concat(u.leftY," z")}return{d:o,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var n=this.getAppendAttributes(t),i=n.d,o=n.strokeWidth,a=n.fill,l=n.strokeDasharray,u=n.stroke;return Te(Il,{d:i,fill:a,strokeWidth:o,stroke:u,strokeDasharray:l})},e.prototype.getAppendWidth=function(){for(var t=this,n=this.props,i=n.model,o=n.graphModel,a=i.pointsList,l=i.draggable,u=[],d=a.length,f=function(y){var w="lf-polyline-append",x={start:{x:a[y].x,y:a[y].y},end:{x:a[y+1].x,y:a[y+1].y},startIndex:y,endIndex:y+1,direction:vn.HORIZONTAL,draggable:!0},b=Te("g",{className:w,children:h.getAppendShape(x)}),_=o.editConfigModel,S=_.adjustEdge,k=_.adjustEdgeMiddle;if(S&&l){var O=x.startIndex,M=x.endIndex,R=k&&(O===0||M===d-1);x.draggable=!R,x.start.x===x.end.x?(x.draggable&&(w+="-ew-resize"),x.direction=vn.VERTICAL):x.start.y===x.end.y&&(x.draggable&&(w+="-ns-resize"),x.direction=vn.HORIZONTAL),b=Te("g",{className:h.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(T){return t.beforeDragStart(T,x)},children:Te("g",{className:w,children:h.getAppendShape(x)})})}u.push(b)},h=this,g=0;g<d-1;g++)f(g);return Te("g",{children:u})},e}(Ec),Ya=function(){return Ya=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ya.apply(this,arguments)},b$=function(){function r(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(i){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(Ya(Ya({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY}))))},this.onDragOver=function(i){if(t.lf.graphModel.eventCenter.emit(kt.BLANK_CANVAS_MOUSEMOVE,{e:i}),i.preventDefault(),t.fakeNode){var o=t.clientToLocalPoint({x:i.clientX,y:i.clientY}),a=o.x,l=o.y;t.fakeNode.moveTo(a,l);var u=t.fakeNode.getData();t.lf.setNodeSnapLine(u),t.lf.graphModel.eventCenter.emit(kt.NODE_DND_DRAG,{data:u,e:i})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(i){!t.lf.graphModel||!i||!t.nodeConfig||(t.lf.addNode(Ya(Ya({},t.nodeConfig),t.clientToLocalPoint({x:i.clientX,y:i.clientY})),kt.NODE_DND_ADD,i),i.preventDefault(),i.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var n=e.lf;this.lf=n}return r.prototype.clientToLocalPoint=function(e){var t=e.x,n=e.y,i=Gl(this.lf.options,["grid","size"]),o=this.lf.graphModel.getPointByClient({x:t,y:n}),a=o.canvasOverlayPosition,l=a.x,u=a.y,d=this.lf.graphModel.editConfigModel.snapGrid;return{x:ds(l,i,d),y:ds(u,i,d)}},r.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},r.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},r}();function x$(r,e){r.on("node:mousemove",function(t){var n=t.data;e.setNodeSnapLine(n)}),r.on("node:mouseup",function(){e.clearSnapline()})}var w$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ro=function(){return ro=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ro.apply(this,arguments)},S$=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},E$=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},C$=function(r){w$(e,r);function e(t){var n=r.call(this,t)||this;return n.ref=gc(),n.__prevText={type:"",text:"",id:""},n.keyupHandler=function(i){var o=n.props.graphModel.textEditElement;i.key==="Enter"&&i.altKey&&(o==null||o.setElementState(en.DEFAULT))},n.inputHandler=function(i){var o=i.target.innerText,a=n.props.graphModel.textEditElement;a&&(n.__prevText={type:a.type,text:o.replace(/(\r\n)+$|(\n)+$/,""),id:a.id})},n.keydownHandler=function(i){i.stopPropagation()},n.state={style:{left:0,top:0}},n}return e.getDerivedStateFromProps=function(t){var n,i=t.textEditElement,o=t.graphModel,a=o.transformModel,l=o.theme,u=l.inputText,d;if(i){if(!(!((n=i.text)===null||n===void 0)&&n.value)&&i.BaseType===Sn.EDGE){var f=i.text,h=i.textPosition,g=h.x,y=h.y;f.x=g,f.y=y,i.setText(f)}var w={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(i.BaseType===Sn.EDGE){var x=l.edgeText,b=x.overflowMode,_=x.lineHeight,S=x.wrapPadding,k=x.textWidth;k&&b==="autoWrap"&&(d=ro(ro({},w),{width:k,minWidth:k,lineHeight:_,padding:S}))}else if(i.BaseType===Sn.NODE){var O=l.nodeText,b=O.overflowMode,_=O.lineHeight,S=O.wrapPadding,k=O.textWidth,M=i.width,R=i.modelType,T=i.textWidth,I=T||k||M;(R!==Vt.TEXT_NODE&&b==="autoWrap"||R===Vt.TEXT_NODE&&k)&&(d=ro(ro({},w),{width:I,minWidth:I,lineHeight:_,padding:S}))}var $=i.text,ne=$.x,V=$.y,J=E$(a.CanvasPointToHtmlPoint([ne,V]),2),D=J[0],U=J[1];return{style:ro(ro({left:D,top:U},d),u)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var n=this.__prevText,i=n.text,o=n.id;t.updateText(o,i),t.eventCenter.emit(kt.TEXT_UPDATE,{data:ro({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var i=window.getSelection();i==null||i.removeAllRanges(),i==null||i.addRange(n)}},e.prototype.render=function(){var t,n=this.props.graphModel.textEditElement,i=this.state.style;return n?Te("div",{contentEditable:!0,className:"lf-text-input",style:i,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=n.text)===null||t===void 0?void 0:t.value},n.id):null},e.toolName="text-edit-tool",e=S$([Er],e),e}(Yt),k$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),O$=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Bf=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},N$=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},M$=function(r){k$(e,r);function e(t){var n=r.call(this,t)||this;n.handleMouseDown=function(l){n.stepDrag.handleMouseDown(l)},n.handleWheelEvent=function(l){var u,d;l.preventDefault();var f=l.deltaX,h=l.deltaY,g=l.clientX,y=l.clientY,w=l.ctrlKey,x=new WheelEvent("wheel",{deltaX:f,deltaY:h,clientX:g,clientY:y,ctrlKey:w});(d=(u=n.props.lf.container)===null||u===void 0?void 0:u.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||d===void 0||d.dispatchEvent(x)},n.onDragging=function(l){var u=l.deltaX,d=l.deltaY,f=n.props,h=f.graphModel,g=f.lf,y=g.getTransform(),w=y.SCALE_X,x=y.SCALE_Y,b=h.getSelectElements(!0);h.moveNodes(b.nodes.map(function(_){return _.id}),u/w,d/x)},n.handleContextMenu=function(l){l.preventDefault();var u=n.props,d=u.graphModel,f=u.graphModel,h=f.eventCenter,g=f.selectElements,y=d.getPointByClient({x:l.clientX,y:l.clientY}),w={nodes:[],edges:[]},x=N$([],Bf(g.values()),!1);x.forEach(function(b){b.BaseType===Sn.NODE&&w.nodes.push(b.getData()),b.BaseType===Sn.EDGE&&w.edges.push(b.getData())}),h.emit(kt.SELECTION_CONTEXTMENU,{data:w,e:l,position:y})};var i=t.graphModel,o=i.gridSize,a=i.eventCenter;return n.stepDrag=new li({onDragging:n.onDragging,step:o,eventType:"SELECTION",eventCenter:a}),n}return e.prototype.render=function(){var t,n,i=this.props.graphModel,o=i.selectElements,a=i.transformModel,l=this.props.lf.getTransform(),u=l.SCALE_X,d=l.SCALE_Y;if(!(o.size<=1)){var f=Number.MAX_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER;o.forEach(function(x){var b;x.BaseType===Sn.NODE&&(b=pj(x)),x.BaseType===Sn.EDGE&&(b=yj(x)),b!==void 0&&(f=Math.min(f,b.x),h=Math.min(h,b.y),g=Math.max(g,b.x1),y=Math.max(y,b.y1))}),t=Bf(a.CanvasPointToHtmlPoint([f,h]),2),f=t[0],h=t[1],n=Bf(a.CanvasPointToHtmlPoint([g,y]),2),g=n[0],y=n[1];var w={left:"".concat(f-20*u/2,"px"),top:"".concat(h-20*d/2,"px"),width:"".concat(g-f+20*u,"px"),height:"".concat(y-h+20*d,"px"),"border-width":"".concat(2*u,"px")};return Te("div",{className:"lf-multiple-select",style:w,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=O$([Er],e),e}(Yt),jf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},A$=[C$,M$],T$=function(){function r(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,un(A$,function(o){t.isDisabled(o.toolName)||t.registerTool(o.toolName,o)});var n=e.graphModel,i=n.eventCenter;i.on("".concat(kt.GRAPH_TRANSFORM,",").concat(kt.NODE_CLICK,",").concat(kt.BLANK_CLICK," "),function(){var o,a=n.textEditElement,l=n.editConfigModel,u=l.edgeTextEdit,d=l.nodeTextEdit;(u||d)&&a&&((o=n.textEditElement)===null||o===void 0||o.setElementState(en.DEFAULT))})}return r.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},r.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},r.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ".concat(t," 的工具"))},r.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ".concat(t," 的工具"))},r.prototype.getTools=function(){return Array.from(this.toolMap.values())},r.prototype.getInstance=function(){return this.instance},r.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},jf([De],r.prototype,"toolMap",void 0),jf([Ae],r.prototype,"disableTool",null),jf([Ae],r.prototype,"enableTool",null),r}();function D$(r){throw new Error("[mobx-utils] "+r)}function Fd(r,e){e===void 0&&(e="Illegal state"),r||D$(e)}var dw=function(r){return r&&r!==Object.prototype&&Object.getOwnPropertyNames(r).concat(dw(Object.getPrototypeOf(r))||[])},L$=function(r){var e=dw(r),t=e.filter(function(n,i){return e.indexOf(n)===i});return t},P$=function(r){return L$(r).filter(function(e){return e!=="constructor"&&!~e.indexOf("__")})},cw="pending",zd="fulfilled",og="rejected";function R$(r){switch(this.state){case cw:return r.pending&&r.pending(this.value);case og:return r.rejected&&r.rejected(this.value);case zd:return r.fulfilled?r.fulfilled(this.value):this.value}}function q_(r,e){if(Fd(arguments.length<=2,"fromPromise expects up to two arguments"),Fd(typeof r=="function"||typeof r=="object"&&r&&typeof r.then=="function","Please pass a promise or function to fromPromise"),r.isPromiseBasedObservable===!0)return r;typeof r=="function"&&(r=new Promise(r));var t=r;r.then(Ae("observableFromPromise-resolve",function(i){t.value=i,t.state=zd}),Ae("observableFromPromise-reject",function(i){t.value=i,t.state=og})),t.isPromiseBasedObservable=!0,t.case=R$;var n=e&&e.state===zd?e.value:void 0;return Lp(t,{value:n,state:cw},{},{deep:!1}),t}(function(r){r.reject=Ae("fromPromise.reject",function(t){var n=r(Promise.reject(t));return n.state=og,n.value=t,n});function e(t){t===void 0&&(t=void 0);var n=r(Promise.resolve(t));return n.state=zd,n.value=t,n}r.resolve=Ae("fromPromise.resolve",e)})(q_||(q_={}));var td=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o};(function(){function r(e,t){var n=this;u4(function(){n.current=t,n.subscription=e.subscribe(n)})}return r.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},r.prototype.next=function(e){this.current=e},r.prototype.complete=function(){this.dispose()},r.prototype.error=function(e){this.current=e,this.dispose()},td([De.ref],r.prototype,"current",void 0),td([Ae.bound],r.prototype,"next",null),td([Ae.bound],r.prototype,"complete",null),td([Ae.bound],r.prototype,"error",null),r})();var Wd=function(){return Wd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wd.apply(this,arguments)},al=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},I$=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];(function(){function r(e){var t=this;this.model=e,this.localValues=De.map({}),this.localComputedValues=De.map({}),this.isPropertyDirty=function(n){return t.localValues.has(n)},Fd(Li(e),"createViewModel expects an observable object"),P$(e).forEach(function(n){if(!(n===$t||n==="__mobxDidRunLazyInitializers")){if(Fd(I$.indexOf(n)===-1,"The propertyname "+n+" is reserved and cannot be used with viewModels"),Ry(e,n)){var i=xc(e,n).derivation;t.localComputedValues.set(n,fn(i.bind(t)))}var o=Object.getOwnPropertyDescriptor(e,n),a=o?{enumerable:o.enumerable}:{};Object.defineProperty(t,n,Wd(Wd({},a),{configurable:!0,get:function(){return Ry(e,n)?t.localComputedValues.get(n).get():t.isPropertyDirty(n)?t.localValues.get(n):t.model[n]},set:Ae(function(l){l!==t.model[n]?t.localValues.set(n,l):t.localValues.delete(n)})}))}})}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),r.prototype.submit=function(){var e=this;us(this.localValues).forEach(function(t){var n=e.localValues.get(t),i=e.model[t];Ki(i)?i.replace(n):Fr(i)?(i.clear(),i.merge(n)):g4(n)||(e.model[t]=n)}),this.localValues.clear()},r.prototype.reset=function(){this.localValues.clear()},r.prototype.resetProperty=function(e){this.localValues.delete(e)},al([fn],r.prototype,"isDirty",null),al([fn],r.prototype,"changedValues",null),al([Ae.bound],r.prototype,"submit",null),al([Ae.bound],r.prototype,"reset",null),al([Ae.bound],r.prototype,"resetProperty",null),r})();function Hf(r){if(!r)return"ROOT";for(var e=[];r.parent;)e.push(r.path),r=r.parent;return e.reverse().join("/")}function $f(r){return Li(r)||Ki(r)||Fr(r)}function B$(r,e){var t=new WeakMap;function n(l){var u=t.get(l.object);i(l,u),e(l,Hf(u),r)}function i(l,u){switch(l.type){case"add":o(l.newValue,u,l.name);break;case"update":a(l.oldValue),o(l.newValue,u,l.name||""+l.index);break;case"remove":case"delete":a(l.oldValue);break;case"splice":l.removed.map(a),l.added.forEach(function(h,g){return o(h,u,""+(l.index+g))});for(var d=l.index+l.addedCount;d<l.object.length;d++)if($f(l.object[d])){var f=t.get(l.object[d]);f&&(f.path=""+d)}break}}function o(l,u,d){if($f(l)){var f=t.get(l);if(f){if(f.parent!==u||f.path!==d)throw new Error("The same observable object cannot appear twice in the same tree,"+(" trying to assign it to '"+Hf(u)+"/"+d+"',")+(" but it already exists at '"+Hf(f.parent)+"/"+f.path+"'"))}else{var h={parent:u,path:d,dispose:Px(l,n)};t.set(l,h),_4(l).forEach(function(g){var y=g[0],w=g[1];return o(w,h,y)})}}}function a(l){if($f(l)){var u=t.get(l);if(!u)return;t.delete(l),u.dispose(),y4(l).forEach(a)}}return o(r,void 0,""),function(){a(r)}}var j$=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){j$(e,r);function e(t,n,i){var o=i===void 0?{}:i,a=o.name,l=a===void 0?"ogm"+(Math.random()*1e3|0):a,u=o.keyToName,d=u===void 0?function(g){return""+g}:u,f=r.call(this)||this;f._keyToName=d,f._groupBy=n,f._ogmInfoKey=Symbol("ogmInfo"+l),f._base=t;for(var h=0;h<t.length;h++)f._addItem(t[h]);return f._disposeBaseObserver=Px(f._base,function(g){if(g.type==="splice")bi(function(){for(var y=0,w=g.removed;y<w.length;y++){var x=w[y];f._removeItem(x)}for(var b=0,_=g.added;b<_.length;b++){var S=_[b];f._addItem(S)}});else if(g.type==="update")bi(function(){f._removeItem(g.oldValue),f._addItem(g.newValue)});else throw new Error("illegal state")}),f}return e.prototype.clear=function(){throw new Error("not supported")},e.prototype.delete=function(t){throw new Error("not supported")},e.prototype.set=function(t,n){throw new Error("not supported")},e.prototype.dispose=function(){this._disposeBaseObserver();for(var t=0;t<this._base.length;t++){var n=this._base[t],i=n[this._ogmInfoKey];i.reaction(),delete n[this._ogmInfoKey]}},e.prototype._getGroupArr=function(t){var n=r.prototype.get.call(this,t);return n===void 0&&(n=De([],{name:"GroupArray["+this._keyToName(t)+"]",deep:!1}),r.prototype.set.call(this,t,n)),n},e.prototype._removeFromGroupArr=function(t,n){var i=r.prototype.get.call(this,t);i.length===1?r.prototype.delete.call(this,t):(n===i.length-1||(i[n]=i[i.length-1],i[n][this._ogmInfoKey].groupArrIndex=n),i.length--)},e.prototype._addItem=function(t){var n=this,i=this._groupBy(t),o=this._getGroupArr(i),a={groupByValue:i,groupArrIndex:o.length,reaction:Ox(function(){return n._groupBy(t)},function(l,u){var d=t[n._ogmInfoKey];n._removeFromGroupArr(d.groupByValue,d.groupArrIndex);var f=n._getGroupArr(l),h=f.length;f.push(t),d.groupByValue=l,d.groupArrIndex=h})};Object.defineProperty(t,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:a}),o.push(t)},e.prototype._removeItem=function(t){var n=t[this._ogmInfoKey];this._removeFromGroupArr(n.groupByValue,n.groupArrIndex),n.reaction(),delete t[this._ogmInfoKey]},e})(Zv);Promise.resolve(),typeof queueMicrotask<"u"||typeof process<"u"&&process.nextTick;var hv=function(){return hv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hv.apply(this,arguments)},H$=function(){function r(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return r.prototype.add=function(e){ay(AC(this.undos),e)||(this.undos.push(e),ay(this.curData,e)||(this.redos=[]),this.eventCenter.emit(kt.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},r.prototype.undoAble=function(){return this.undos.length>1},r.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=Ht(t),t}},r.prototype.redoAble=function(){return this.redos.length>0},r.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=Ht(e),e}},r.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=B$(e,S1(function(){var n=e.modelToHistoryData();n&&t.add(hv({},n))},this.waitTime))},r.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},r}(),Ff={exports:{}},X_;function $$(){return X_||(X_=1,function(r){(function(e,t,n){if(!e)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u,d=1;d<20;++d)i[111+d]="f"+d;for(d=0;d<=9;++d)i[d+96]=d.toString();function f(T,I,$){if(T.addEventListener){T.addEventListener(I,$,!1);return}T.attachEvent("on"+I,$)}function h(T){if(T.type=="keypress"){var I=String.fromCharCode(T.which);return T.shiftKey||(I=I.toLowerCase()),I}return i[T.which]?i[T.which]:o[T.which]?o[T.which]:String.fromCharCode(T.which).toLowerCase()}function g(T,I){return T.sort().join(",")===I.sort().join(",")}function y(T){var I=[];return T.shiftKey&&I.push("shift"),T.altKey&&I.push("alt"),T.ctrlKey&&I.push("ctrl"),T.metaKey&&I.push("meta"),I}function w(T){if(T.preventDefault){T.preventDefault();return}T.returnValue=!1}function x(T){if(T.stopPropagation){T.stopPropagation();return}T.cancelBubble=!0}function b(T){return T=="shift"||T=="ctrl"||T=="alt"||T=="meta"}function _(){if(!u){u={};for(var T in i)T>95&&T<112||i.hasOwnProperty(T)&&(u[i[T]]=T)}return u}function S(T,I,$){return $||($=_()[T]?"keydown":"keypress"),$=="keypress"&&I.length&&($="keydown"),$}function k(T){return T==="+"?["+"]:(T=T.replace(/\+{2}/g,"+plus"),T.split("+"))}function O(T,I){var $,ne,V,J=[];for($=k(T),V=0;V<$.length;++V)ne=$[V],l[ne]&&(ne=l[ne]),I&&I!="keypress"&&a[ne]&&(ne=a[ne],J.push("shift")),b(ne)&&J.push(ne);return I=S(ne,J,I),{key:ne,modifiers:J,action:I}}function M(T,I){return T===null||T===t?!1:T===I?!0:M(T.parentNode,I)}function R(T){var I=this;if(T=T||t,!(I instanceof R))return new R(T);I.target=T,I._callbacks={},I._directMap={};var $={},ne,V=!1,J=!1,D=!1;function U(ve){ve=ve||{};var Ve=!1,Be;for(Be in $){if(ve[Be]){Ve=!0;continue}$[Be]=0}Ve||(D=!1)}function j(ve,Ve,Be,de,le,W){var Y,se,ge=[],Pe=Be.type;if(!I._callbacks[ve])return[];for(Pe=="keyup"&&b(ve)&&(Ve=[ve]),Y=0;Y<I._callbacks[ve].length;++Y)if(se=I._callbacks[ve][Y],!(!de&&se.seq&&$[se.seq]!=se.level)&&Pe==se.action&&(Pe=="keypress"&&!Be.metaKey&&!Be.ctrlKey||g(Ve,se.modifiers))){var Le=!de&&se.combo==le,He=de&&se.seq==de&&se.level==W;(Le||He)&&I._callbacks[ve].splice(Y,1),ge.push(se)}return ge}function fe(ve,Ve,Be,de){I.stopCallback(Ve,Ve.target||Ve.srcElement,Be,de)||ve(Ve,Be)===!1&&(w(Ve),x(Ve))}I._handleKey=function(ve,Ve,Be){var de=j(ve,Ve,Be),le,W={},Y=0,se=!1;for(le=0;le<de.length;++le)de[le].seq&&(Y=Math.max(Y,de[le].level));for(le=0;le<de.length;++le){if(de[le].seq){if(de[le].level!=Y)continue;se=!0,W[de[le].seq]=1,fe(de[le].callback,Be,de[le].combo,de[le].seq);continue}se||fe(de[le].callback,Be,de[le].combo)}var ge=Be.type=="keypress"&&J;Be.type==D&&!b(ve)&&!ge&&U(W),J=se&&Be.type=="keydown"};function Ee(ve){typeof ve.which!="number"&&(ve.which=ve.keyCode);var Ve=h(ve);if(Ve){if(ve.type=="keyup"&&V===Ve){V=!1;return}I.handleKey(Ve,y(ve),ve)}}function _e(){clearTimeout(ne),ne=setTimeout(U,1e3)}function rt(ve,Ve,Be,de){$[ve]=0;function le(Pe){return function(){D=Pe,++$[ve],_e()}}function W(Pe){fe(Be,Pe,ve),de!=="keyup"&&(V=h(Pe)),setTimeout(U,10)}for(var Y=0;Y<Ve.length;++Y){var se=Y+1===Ve.length,ge=se?W:le(de||O(Ve[Y+1]).action);Me(Ve[Y],ge,de,ve,Y)}}function Me(ve,Ve,Be,de,le){I._directMap[ve+":"+Be]=Ve,ve=ve.replace(/\s+/g," ");var W=ve.split(" "),Y;if(W.length>1){rt(ve,W,Ve,Be);return}Y=O(ve,Be),I._callbacks[Y.key]=I._callbacks[Y.key]||[],j(Y.key,Y.modifiers,{type:Y.action},de,ve,le),I._callbacks[Y.key][de?"unshift":"push"]({callback:Ve,modifiers:Y.modifiers,action:Y.action,seq:de,level:le,combo:ve})}I._bindMultiple=function(ve,Ve,Be){for(var de=0;de<ve.length;++de)Me(ve[de],Ve,Be)},f(T,"keypress",Ee),f(T,"keydown",Ee),f(T,"keyup",Ee)}R.prototype.bind=function(T,I,$){var ne=this;return T=T instanceof Array?T:[T],ne._bindMultiple.call(ne,T,I,$),ne},R.prototype.unbind=function(T,I){var $=this;return $.bind.call($,T,function(){},I)},R.prototype.trigger=function(T,I){var $=this;return $._directMap[T+":"+I]&&$._directMap[T+":"+I]({},T),$},R.prototype.reset=function(){var T=this;return T._callbacks={},T._directMap={},T},R.prototype.stopCallback=function(T,I){var $=this;if((" "+I.className+" ").indexOf(" mousetrap ")>-1||M(I,$.target))return!1;if("composedPath"in T&&typeof T.composedPath=="function"){var ne=T.composedPath()[0];ne!==T.target&&(I=ne)}return I.tagName=="INPUT"||I.tagName=="SELECT"||I.tagName=="TEXTAREA"||I.isContentEditable},R.prototype.handleKey=function(){var T=this;return T._handleKey.apply(T,arguments)},R.addKeycodes=function(T){for(var I in T)T.hasOwnProperty(I)&&(i[I]=T[I]);u=null},R.init=function(){var T=R(t);for(var I in T)I.charAt(0)!=="_"&&(R[I]=function($){return function(){return T[$].apply(T,arguments)}}(I))},R.init(),e.Mousetrap=R,r.exports&&(r.exports=R)})(typeof window<"u"?window:null,typeof window<"u"?document:null)}(Ff)),Ff.exports}var F$=$$();const z$=ha(F$);var ji=null;function G_(r,e){var t,n;return r.x+=e,r.y+=e,Sp(r.text)||(r.text.x+=e,r.text.y+=e),Sp((t=r.properties)===null||t===void 0?void 0:t._label)||(n=r.properties)===null||n===void 0||n._label.forEach(function(i){i.x+=e,i.y+=e}),r}function Y_(r,e){return r.startPoint&&(r.startPoint.x+=e,r.startPoint.y+=e),r.endPoint&&(r.endPoint.x+=e,r.endPoint.y+=e),r.pointsList&&r.pointsList.length>0&&r.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Sp(r.text)||(r.text.x+=e,r.text.y+=e),r}var za=40,nd=40;function W$(r,e){var t=r.keyboard,n=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(nd=za,!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=r.options.guards,o=e.getSelectElements(!1),a=i&&i.beforeClone?i.beforeClone(o):!0;return!a||o.nodes.length===0&&o.edges.length===0?(ji=null,!0):(ji=o,ji.nodes.forEach(function(l){return G_(l,za)}),ji.edges.forEach(function(l){return Y_(l,za)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;if(ji&&(ji.nodes||ji.edges)){r.clearSelectElements();var i=r.addElements(ji,nd);if(!i)return!0;i.nodes.forEach(function(o){return r.selectElementById(o.id,!0)}),i.edges.forEach(function(o){return r.selectElementById(o.id,!0)}),ji.nodes.forEach(function(o){return G_(o,za)}),ji.edges.forEach(function(o){return Y_(o,za)}),nd=nd+za}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.redo(),!1)}),t.on(["backspace"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;var i=e.getSelectElements(!0);return r.clearSelectElements(),i.edges.forEach(function(o){return o.id&&r.deleteEdge(o.id)}),i.nodes.forEach(function(o){return o.id&&r.deleteNode(o.id)}),!1})}var U$=function(){function r(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new z$(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return r.prototype.initShortcuts=function(){var e=this,t,n=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(n)if(E1(n))n.forEach(function(l){var u=l.keys,d=l.callback,f=l.action;return e.on(u,d,f)});else{var i=n.keys,o=n.callback,a=n.action;this.on(i,o,a)}},r.prototype.on=function(e,t,n){this.mousetrap.bind(this.getKeys(e),t,n)},Object.defineProperty(r.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),r.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},r.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},r.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},r.prototype.destroy=function(){this.mousetrap.reset()},r.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(n){return t.formatKey(n)})},r.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},r}(),Eo=function(){return Eo=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Eo.apply(this,arguments)},rd=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},zf=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Wf=Symbol("plugin registered by Logicflow.use"),pv=function(){function r(e){var t=this,n;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(d,f){return t.viewMap.set(d,f)},this.getView=function(d){return t.viewMap.get(d)};var i=Tl.get(e),o=i.container,a=i.width,l=i.height;this.options=i,this.container=this.initContainer(o,a,l),this.graphModel=new PH(Eo(Eo({},i),{container:this.container})),this.plugins=(n=i.plugins)!==null&&n!==void 0?n:[];var u=this.graphModel.eventCenter;this.tool=new T$(this),this.dnd=new b$({lf:this}),this.history=new H$(u),this.keyboard=new U$({lf:this,keyboard:i.keyboard}),i.snapline!==!1&&(this.snaplineModel=new RH(this.graphModel,i.snaplineEpsilon),x$(u,this.snaplineModel)),i.isSilentMode||(W$(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(i.disabledPlugins)}return r.prototype.initContainer=function(e,t,n){var i=document.createElement("div");return i.style.position="relative",i.style.width=t?"".concat(t,"px"):"100%",i.style.height=n?"".concat(n,"px"):"100%",e.innerHTML="",e.appendChild(i),i},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return r.toStringTag},enumerable:!1,configurable:!0}),r.prototype.register=function(e,t,n){if(n===void 0&&(n=!0),typeof e!="string"){this.registerElement(e);return}var i={BaseEdge:Ec,BaseEdgeModel:Sc,BaseNode:Io,BaseNodeModel:Ro,RectNode:ca,RectNodeModel:ps,CircleNode:jd,CircleNodeModel:Rd,PolygonNode:$d,PolygonNodeModel:Id,TextNode:W_,TextNodeModel:$_,LineEdge:V_,LineEdgeModel:I_,DiamondNode:ov,DiamondNodeModel:Kp,PolylineEdge:vs,PolylineEdgeModel:hs,BezierEdge:cv,BezierEdgeModel:Yp,EllipseNode:sv,EllipseNodeModel:Jp,HtmlNode:Wl,HtmlNodeModel:Fl,h:wt,type:e};if(this.viewMap.forEach(function(d){var f=d.extendKey;f&&(i[f]=d)}),this.graphModel.modelMap.forEach(function(d){var f=d.extendKey;f&&(i[f]=d)}),t){var o=t(i),a=o.view,l=o.model,u=a;n&&!u.isObserved&&(u.isObserved=!0,u=Er(u)),this.setView(e,u),this.graphModel.setModel(e,l)}},r.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=Er(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},r.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),un(e,function(n){t.registerElement(n)})},r.prototype.defaultRegister=function(){var e=[{type:"rect",view:ca,model:ps},{type:"circle",view:jd,model:Rd},{type:"polygon",view:$d,model:Id},{type:"text",view:W_,model:$_},{type:"ellipse",view:sv,model:Jp},{type:"diamond",view:ov,model:Kp},{type:"html",view:Wl,model:Fl},{type:"line",view:V_,model:I_},{type:"polyline",view:vs,model:hs},{type:"bezier",view:cv,model:Yp}];this.batchRegister(e)},r.prototype.addNode=function(e,t,n){return t===void 0&&(t=kt.NODE_ADD),this.graphModel.addNode(e,t,n)},r.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteNode(e),o},r.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){var i=this.options.guards,o=i!=null&&i.beforeClone?i.beforeClone(n):!0;if(o)return this.graphModel.cloneNode(e)}},r.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},r.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},r.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},r.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},r.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},r.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},r.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},r.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},r.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var n=new t(Eo(Eo({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(n),n},r.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},r.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},r.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},r.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},r.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},r.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},r.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},r.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,n=e.targetNodeId,i=[],o=this.graphModel.edges;return t&&n?un(o,function(a){a.sourceNodeId===t&&a.targetNodeId===n&&i.push(a)}):t?un(o,function(a){a.sourceNodeId===t&&i.push(a)}):n&&un(o,function(a){a.targetNodeId===n&&i.push(a)}),i},r.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},r.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},r.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var n=t.getData(),i=this.options.guards,o=i!=null&&i.beforeDelete?i.beforeDelete(n):!0;return o&&this.graphModel.deleteEdgeById(e),o},r.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,n=e.targetNodeId;t&&n?this.graphModel.deleteEdgeBySourceAndTarget(t,n):t?this.graphModel.deleteEdgeBySource(t):n&&this.graphModel.deleteEdgeByTarget(n)},r.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},r.prototype.addElements=function(e,t){var n=this,i=e.nodes,o=e.edges;t===void 0&&(t=40);var a={},l={nodes:[],edges:[]};return un(i,function(u){var d=u.id,f=n.addNode(u);d&&(a[d]=f.id),l.nodes.push(f)}),un(o,function(u){var d=u.sourceNodeId,f=u.targetNodeId;a[d]&&(d=a[d]),a[f]&&(f=a[f]);var h=n.graphModel.addEdge(Eo(Eo({},u),{sourceNodeId:d,targetNodeId:f}));l.edges.push(h)}),l},r.prototype.selectElementById=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),this.graphModel.selectElementById(e,t),!t&&n&&this.graphModel.toFront(e)},r.prototype.deselectElementById=function(e){this.graphModel.deselectElementById(e)},r.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},r.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},r.prototype.getModelById=function(e){return this.graphModel.getElement(e)},r.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},r.prototype.deleteElement=function(e){var t,n,i,o=this.getModelById(e);if(!o)return!1;var a=(t={},t[Sn.NODE]=this.deleteNode,t[Sn.EDGE]=this.deleteEdge,t);return(i=(n=a[o.BaseType])===null||n===void 0?void 0:n.call(this,e))!==null&&i!==void 0?i:!1},r.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},r.prototype.getAreaElement=function(e,t,n,i,o){return n===void 0&&(n=!0),i===void 0&&(i=!0),o===void 0&&(o=!1),this.graphModel.getAreaElement(e,t,n,i,o).map(function(a){return a.getData()})},r.prototype.setProperties=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.setProperties(vr(t))},r.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},r.prototype.deleteProperty=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.deleteProperty(t)},r.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},r.prototype.editText=function(e){this.graphModel.editText(e)},r.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},r.prototype.updateEditConfig=function(e){var t=this.graphModel,n=t.editConfigModel,i=t.transformModel,o=n.snapGrid;if(n.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&i.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0),!wr(e==null?void 0:e.snapGrid)&&e.snapGrid!==o){var a=this.graphModel.grid.size,l=a===void 0?1:a;this.graphModel.updateGridSize(e.snapGrid?l:1)}this.emit(kt.EDIT_CONFIG_CHANGED,{data:n.getConfig()})},r.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},r.prototype.setTheme=function(e,t){this.graphModel.setTheme(e,t)},r.prototype.getTheme=function(){return this.graphModel.getTheme()},r.prototype.focusByElement=function(e){var t=void 0,n=this.getNodeModelById(e);if(n){var i=n.getData(),o=i.x,a=i.y;t={x:o,y:a}}var l=this.getEdgeModelById(e);if(l){var u=l.textPosition,o=u.x,a=u.y;t={x:o,y:a}}t&&this.focusByCoordinate(t)},r.prototype.focusByCoordinate=function(e){var t=this.graphModel,n=t.transformModel,i=t.width,o=t.height,a=e.x,l=e.y;n.focusOn(a,l,i,o)},r.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,n=e.coordinate;t&&this.focusByElement(t),n&&this.focusByCoordinate(n)}},r.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},r.prototype.toFront=function(e){this.graphModel.toFront(e)},r.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},r.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,zf([n],rd(e),!1)):n},r.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},r.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},r.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(vr(e)),this.options.history!==!1&&this.history.watch(this.graphModel),l_(Te($H,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(kt.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},r.prototype.render=function(e){var t=Ht(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},r.prototype.undo=function(){if(this.history.undoAble()){var e=vr(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.redo=function(){if(this.history.redoAble()){var e=vr(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.zoom=function(e,t){var n=this.graphModel.transformModel;return n.zoom(e,t)},r.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},r.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},r.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},r.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,n=e.SCALE_Y,i=e.TRANSLATE_X,o=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:n,TRANSLATE_X:i,TRANSLATE_Y:o}},r.prototype.translate=function(e,t){var n=this.graphModel.transformModel;n.translate(e,t)},r.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,n=e.TRANSLATE_Y;this.translate(-t,-n)},r.prototype.translateCenter=function(){this.graphModel.translateCenter()},r.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},r.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},r.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},r.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},r.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},r.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},r.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},r.use=function(e,t){var n,i=e.pluginName;if(!i)throw new Error("请给插件指定 pluginName!");this.extensions.set(i,(n={},n[Wf]=Wf,n.extension=e,n.props=t,n))},r.addThemeMode=function(e,t){P5(e,t)},r.removeThemeMode=function(e){R5(e)},r.clearThemeMode=function(){P_()},r.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var n=Array.from(r.extensions,function(o){var a=rd(o,2),l=a[1];return l}),i=zf(zf([],rd(this.plugins),!1),rd(n),!1);un(i,function(o){var a,l;Wf in o?(a=o.extension,l=o.props):a=o;var u=a==null?void 0:a.pluginName;TC(e,u)===-1&&t.installPlugin(a,l)})},r.prototype.installPlugin=function(e,t){var n,i;if("pluginName"in e&&"install"in e){var o=e.pluginName,a=e.install,l=e.render;o&&(a&&a.call(e,this,r),l&&this.components.push(l.bind(e)),this.extension[o]=e);return}var u=e,d=u.pluginName,f=new u({lf:this,LogicFlow:r,props:t,options:(i=(n=this.options.pluginsOptions)===null||n===void 0?void 0:n[d])!==null&&i!==void 0?i:{}});f.render&&this.components.push(f.render.bind(f)),this.extension[d]=f},r.prototype.destroy=function(){var e;this.clearData(),l_(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),P_();for(var t in this.extension){var n=this.extension[t];"destroy"in n&&((e=n.destroy)===null||e===void 0||e.call(n))}},r.extensions=new Map,r}();(function(r){r.toStringTag="LF.".concat(r.name)})(pv||(pv={}));const V$=pv;function Er(r){return eg(r)}var K_={width:40,height:40},J_={width:40,height:40},Z_={width:40,height:40},Q_={width:100,height:80},e0={width:100,height:80},q$=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),X$=(globalThis==null?void 0:globalThis._ids)||new q$;function Ms(){return X$.next()}var fw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){fw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(Ms())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var t=r.prototype.getConnectedTargetRules.call(this),n={message:"起始节点不能作为边的终点",validate:function(){return!1}};return t.push(n),t},e.extendKey="StartEventModel",e})(Rd);(function(r){fw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="StartEventNode",e})(jd);var hw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ud=function(){return Ud=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ud.apply(this,arguments)};(function(r){hw(e,r);function e(t,n){return t.id||(t.id="Event_".concat(Ms())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),r.call(this,t,n)||this}return e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var t=r.prototype.getConnectedSourceRules.call(this),n={message:"结束节点不能作为边的起点",validate:function(){return!1}};return t.push(n),t},e.extendKey="EndEventModel",e})(Rd);(function(r){hw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle(),i=t,o=i.x,a=i.y,l=i.r,u=r.prototype.getShape.call(this);return wt("g",{},u,wt("circle",Ud(Ud({},n),{cx:o,cy:a,r:l-5})))},e.extendKey="EndEventView",e})(jd);var pw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){pw(e,r);function e(t,n){return t.id||(t.id="Flow_".concat(Ms())),r.call(this,t,n)||this}return e.extendKey="SequenceFlowModel",e})(hs);(function(r){pw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.extendKey="SequenceFlowEdge",e})(vs);var vw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Cl=function(){return Cl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Cl.apply(this,arguments)};(function(r){vw(e,r);function e(t,n){var i=this;return t.id||(t.id="Gateway_".concat(Ms())),t.text||(t.text=""),t.text&&typeof t.text=="string"&&(t.text={value:t.text,x:t.x,y:t.y+40}),i=r.call(this,t,n)||this,i.points=[[25,0],[50,25],[25,50],[0,25]],i}return e.extendKey="ExclusiveGatewayModel",e})(Id);(function(r){vw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,i=n.x,o=n.y,a=n.width,l=n.height,u=n.points,d=t.getNodeStyle();return wt("g",{transform:"matrix(1 0 0 1 ".concat(i-a/2," ").concat(o-l/2,")")},wt("polygon",Cl(Cl({},d),{x:i,y:o,points:u})),wt("path",Cl({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},d)))},e.extendKey="ExclusiveGatewayNode",e})($d);var gw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),vv=function(){return vv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vv.apply(this,arguments)};(function(r){gw(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(Ms())),r.call(this,t,n)||this}return e.extendKey="ServiceTaskModel",e})(ps);(function(r){gw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.getNodeStyle();return wt("svg",{x:n-o/2+5,y:i-a/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},wt("path",{fill:l.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.radius,u=t.getNodeStyle();return wt("g",{},[wt("rect",vv({x:n-o/2,y:i-a/2,rx:l,ry:l,width:o,height:a},u)),this.getLabelShape()])},e.extendKey="ServiceTaskNode",e})(ca);var mw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Vd=function(){return Vd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Vd.apply(this,arguments)};(function(r){mw(e,r);function e(t,n){return t.id||(t.id="Activity_".concat(Ms())),r.call(this,t,n)||this}return e.extendKey="UserTaskModel",e})(ps);(function(r){mw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.getNodeStyle();return wt("svg",{x:n-o/2+5,y:i-a/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},wt("path",{fill:l.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.radius,u=t.getNodeStyle();return wt("g",{},[wt("rect",Vd(Vd({},u),{x:n-o/2,y:i-a/2,rx:l,ry:l,width:o,height:a})),this.getLabelShape()])},e.extendKey="UserTaskNode",e})(ca);var G$=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),Y$=(globalThis==null?void 0:globalThis._ids)||new G$;function t0(){return Y$.next()}function yw(r){return Object.prototype.toString.call(r)}function K$(r){return"  ".repeat(r)}function qd(r){var e=r;return yw(r)==="[object Object]"?(e={},Object.keys(r).forEach(function(t){var n=t;t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=qd(r[t])})):Array.isArray(r)&&(e=[],r.forEach(function(t,n){e[n]=qd(t)})),e}function Xd(r){return r==null?"":r.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function J$(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(qd(r)).replace(/"/g,"'")}return Xd(String(e))}var Ko=`	
`;function cd(r,e,t){var n=K$(t);if(r!==0&&r!==!1&&!r)return Ko+n+"<".concat(e," />");var i="";if(e==="#text")return Ko+n+Xd(String(r));if(e==="#cdata-section")return Ko+n+"<![CDATA["+r+"]]>";if(e==="#comment")return Ko+n+"<!--"+r+"-->";if("".concat(e).charAt(0)==="-")return" "+e.substring(1)+'="'+J$(r)+'"';if(Array.isArray(r))r.forEach(function(u){i+=cd(u,e,t+1)});else if(yw(r)==="[object Object]"){var o=Object.keys(r),a="",l="";i+=(t===0?"":Ko+n)+"<"+e,o.forEach(function(u){u.charAt(0)==="-"?a+=cd(r[u],u,t+1):l+=cd(r[u],u,t+1)}),i+=a+(l!==""?">".concat(l).concat(Ko+n,"</").concat(e,">"):" />")}else i+=Ko+n+"<".concat(e,">").concat(Xd(String(r)),"</").concat(e,">");return i}function Z$(r){var e="";for(var t in r)e+=cd(r[t],t,0);return e}var Or=function(){};Or.ObjTree=function(){return this};Or.ObjTree.VERSION="0.23";Or.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Or.ObjTree.prototype.attr_prefix="-";Or.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e)return this.parseDOM(e)};Or.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,a=t,l=n.onComplete;n.onComplete=function(f){var h;f&&f.responseXML&&f.responseXML.documentElement&&(h=o.parseDOM(f.responseXML.documentElement)),a(h,f),l&&l(f)}}else n.asynchronous=!1;var u;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var d=new HTTP.Request(n);d&&(u=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(r,n);d&&(u=d.transport)}if(t)return u;if(u&&u.responseXML&&u.responseXML.documentElement)return this.parseDOM(u.responseXML.documentElement)};Or.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!=11){var n={};n[r.nodeName]=t,t=n}return t}};Or.ObjTree.prototype.parseElement=function(r){if(r.nodeType!=7){if(r.nodeType==3||r.nodeType==4||r.nodeType==8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var a=r.attributes[i].nodeValue;try{a=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{a=r.attributes[i].nodeValue}a&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],a))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var u=r.childNodes[i].nodeType;u==3||u==4||u==8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var a=this.parseElement(r.childNodes[i]);a&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],a))}}}}else t===null&&(t={});return t}};Or.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t==1&&(r[e]=[]),r[e][r[e].length]=n):t==1?r[e]=n:t==2?r[e]=[r[e],n]:r[e][r[e].length]=n};Or.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};Or.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];i.charAt(0)!=this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<"+i+" />":typeof o=="object"&&o.constructor==Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" "+i.substring(1)+'="'+this.xml_escape(o)+'"'}var a=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<"+r+a+`>
`+l+"</"+r+`>
`:l="<"+r+a+">"+l+"</"+r+`>
`:l="<"+r+a+` />
`),l};Or.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<"+r+" />":typeof i=="object"&&i.constructor==Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};Or.ObjTree.prototype.scalar_to_xml=function(r,e){return r=="#text"?this.xml_escape(e):"<"+r+">"+this.xml_escape(e)+"</"+r+`>
`};Or.ObjTree.prototype.xml_escape=Xd;var Q$=function(r){return new Or.ObjTree().parseXML(r)},eF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gv=function(){return gv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},gv.apply(this,arguments)},Cc=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Xi;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow"})(Xi||(Xi={}));var _w=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],n0=["properties","startPoint","endPoint","pointsList"],bw=function(r){return String(r||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};function r0(r){var e=r?n0.concat(r):n0;return function(t){function n(i){var o={};return typeof i=="string"?i:Array.isArray(i)?i.map(function(a){return n(a)}):(Object.entries(i).forEach(function(a){var l=Cc(a,2),u=l[0],d=l[1];typeof d!="object"?u.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(u)?o[u]=d:o["-".concat(u)]=d:e.includes(u)?o["-".concat(u)]=n(d):o[u]=n(d)}),o)}return n(t)}}function Gd(r){var e={};return Object.entries(r).forEach(function(t){var n=Cc(t,2),i=n[0],o=n[1];i.indexOf("-")===0?e[i.substring(1)]=qd(o):typeof o=="string"?e[i]=o:Object.prototype.toString.call(o)==="[object Object]"?e[i]=Gd(o):Array.isArray(o)?e[i]=o.map(function(a){return Gd(a)}):e[i]=o}),e}function tF(r,e,t){var n=new Map;e.nodes.forEach(function(o){var a,l={"-id":o.id};if(!((a=o.text)===null||a===void 0)&&a.value&&(l["-name"]=o.text.value),o.properties){var u=r0(t)(o.properties);Object.assign(l,u)}n.set(o.id,l),r[o.type]?Array.isArray(r[o.type])?r[o.type].push(l):r[o.type]=[r[o.type],l]:r[o.type]=l});var i=e.edges.map(function(o){var a,l,u=n.get(o.targetNodeId);u["bpmn:incoming"]?Array.isArray(u["bpmn:incoming"])?u["bpmn:incoming"].push(o.id):u["bpmn:incoming"]=[u["bpmn:incoming"],o.id]:u["bpmn:incoming"]=o.id;var d={"-id":o.id,"-sourceRef":o.sourceNodeId,"-targetRef":o.targetNodeId};if(!((a=o.text)===null||a===void 0)&&a.value&&(d["-name"]=(l=o.text)===null||l===void 0?void 0:l.value),o.properties){var f=r0(t)(o.properties);Object.assign(d,f)}return d});e.edges.forEach(function(o){var a=n.get(o.sourceNodeId);a["bpmn:outgoing"]?Array.isArray(a["bpmn:outgoing"])?a["bpmn:outgoing"].push(o.id):a["bpmn:outgoing"]=[a["bpmn:outgoing"],o.id]:a["bpmn:outgoing"]=o.id}),r[Xi.FLOW]=i}function nF(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var u=l.x,d=l.y;return{"-x":u,"-y":d}}),a={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(a["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),a}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,a=80,l=t.x,u=t.y,d=Bo.shapeConfigMap.get(t.type);d&&(o=d.width,a=d.height),l-=o/2,u-=a/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":u,"-width":o,"-height":a}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}function rF(r){var e=[],t=[],n=r["bpmn:definitions"];if(n){var i=n["bpmn:process"],o=n["bpmndi:BPMNDiagram"],a=o==null?void 0:o["bpmndi:BPMNPlane"];if(!i||!a)return{nodes:e,edges:t};Object.keys(i).forEach(function(l){if(l.indexOf("bpmn:")===0){var u=i[l];if(l===Xi.FLOW){var d=a["bpmndi:BPMNEdge"],f=(Array.isArray(d),d);t=oF(u,f)}else{var h=a["bpmndi:BPMNShape"],g=(Array.isArray(h),h);e=e.concat(iF(u,g,l))}}})}return{nodes:e,edges:t}}function iF(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(a){var l;Array.isArray(e)?l=e.find(function(d){return d["-bpmnElement"]===a["-id"]}):l=e;var u=i0(l,t,a);n.push(u)});else{var i=void 0;Array.isArray(e)?i=e.find(function(a){return a["-bpmnElement"]===r["-id"]}):i=e;var o=i0(i,t,r);n.push(o)}return n}function i0(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=bw(t["-name"]),a=Bo.shapeConfigMap.get(e);a&&(n+=a.width/2,i+=a.height/2);var l;Object.entries(t).forEach(function(h){var g=Cc(h,2),y=g[0],w=g[1];_w.indexOf(y)===-1&&(l||(l={}),l[y]=w)}),l&&(l=Gd(l));var u;if(o&&(u={x:n,y:i,value:o},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var d=r["bpmndi:BPMNLabel"]["dc:Bounds"];u.x=Number(d["-x"])+Number(d["-width"])/2,u.y=Number(d["-y"])+Number(d["-height"])/2}var f={id:r["-bpmnElement"],type:e,x:n,y:i,properties:l};return u&&(f.text=u),f}function oF(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(a){return a["-bpmnElement"]===i["-id"]}):o=e,t.push(o0(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(o0(n,r))}return t}function o0(r,e){var t,n=e["-name"]?bw("".concat(e["-name"])):"";if(n){var i=void 0;r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"]&&(i=r["bpmndi:BPMNLabel"]["dc:Bounds"]);var o=0;if(n.split(`
`).forEach(function(y){o<y.length&&(o=y.length)}),i)t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7};else{var a=r["di:waypoint"]||[],l=a[0],u=a[a.length-1]||l,d=(Number((l==null?void 0:l["-x"])||0)+Number((u==null?void 0:u["-x"])||0))/2,f=(Number((l==null?void 0:l["-y"])||0)+Number((u==null?void 0:u["-y"])||0))/2;t={value:n,x:d,y:f}}}var h;Object.entries(e).forEach(function(y){var w=Cc(y,2),x=w[0],b=w[1];_w.indexOf(x)===-1&&(h||(h={}),h[x]=b)}),h&&(h=Gd(h));var g={id:e["-id"],type:Xi.FLOW,pointsList:r["di:waypoint"].map(function(y){return{x:Number(y["-x"]),y:Number(y["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:h};return t&&(g.text=t),g}var Bo=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var a=gv({},n.processAttributes);tF(a,i,o);var l={"-id":"BPMNPlane_1","-bpmnElement":a["-id"]};nF(l,i);var u=n.definitionAttributes;u["bpmn:process"]=a,u["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":l};var d={"bpmn:definitions":u};return d},this.adapterIn=function(i){if(i)return rF(i)},t.adapterIn=function(i){return n.adapterIn(i)},t.adapterOut=function(i,o){return n.adapterOut(i,o)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(t0())},this.definitionAttributes={"-id":"Definitions_".concat(t0()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();Bo.shapeConfigMap.set(Xi.START,{width:K_.width,height:K_.height});Bo.shapeConfigMap.set(Xi.END,{width:J_.width,height:J_.height});Bo.shapeConfigMap.set(Xi.GATEWAY,{width:Z_.width,height:Z_.height});Bo.shapeConfigMap.set(Xi.SYSTEM,{width:Q_.width,height:Q_.height});Bo.shapeConfigMap.set(Xi.USER,{width:e0.width,height:e0.height});(function(r){eF(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(o){var a=typeof o=="string"?n.sanitizeNameAttributes(o):o,l=Q$(a);return n.adapterIn(l)},n.adapterXmlOut=function(o,a){var l=n.adapterOut(o,a);return Z$(l)};var i=t.lf;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n}return e.prototype.sanitizeNameAttributes=function(t){return t.replace(/name="([^"]*)"/g,function(n,i){var o=i.replace(/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'name="'.concat(o,'"')})},e.pluginName="bpmnXmlAdapter",e})(Bo);var aF=function(){function r(){globalThis._ids=this,this._ids=new Set}return r.prototype.generateId=function(){var e="xxxxxxx".replace(/[x]/g,function(t){var n=Math.random()*16|0,i=t==="x"?n:n&3|8;return i.toString(16)});return e},r.prototype.next=function(){for(var e=this.generateId();this._ids.has(e);)e=this.generateId();return this._ids.add(e),e},r}(),sF=(globalThis==null?void 0:globalThis._ids)||new aF;function lF(){return sF.next()}wt("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),wt("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),wt("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"});wt("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"});wt("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"});var uF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ra=function(){return ra=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ra.apply(this,arguments)},dF=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},cF=li,fF=function(r){uF(e,r);function e(t){var n=r.call(this)||this;return n.updatePosition=function(i){var o=i.deltaX,a=i.deltaY,l=n.nodeModel,u=l.x,d=l.y;n.nodeModel.x=u+o/2,n.nodeModel.y=d+a/2,n.nodeModel.moveText(o/2,a/2)},n.getResize=function(i){var o=i.index,a=i.deltaX,l=i.deltaY,u=i.width,d=i.height,f=i.PCTResizeInfo,h=i.pct,g=h===void 0?1:h,y=i.freezeWidth,w=y===void 0?!1:y,x=i.freezeHeight,b=x===void 0?!1:x,_={width:u,height:d,deltaX:a,deltaY:l};if(f){var S=4,k=0,O=0;switch(o){case 0:O=(a*-1-l)/S;break;case 1:O=(a-l)/S;break;case 2:O=(a+l)/S;break;case 3:O=(a*-1+l)/S;break}O!==0&&(k=Math.round(O/f.ResizeBasis.basisHeight*1e5)/1e3),f.ResizePCT.widthPCT=Math.max(Math.min(f.ResizePCT.widthPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit),f.ResizePCT.heightPCT=Math.max(Math.min(f.ResizePCT.heightPCT+k,f.ScaleLimit.maxScaleLimit),f.ScaleLimit.minScaleLimit);var M=Math.round(f.ResizePCT.widthPCT*f.ResizeBasis.basisWidth/100),R=Math.round(f.ResizePCT.heightPCT*f.ResizeBasis.basisHeight/100);switch(o){case 0:a=u-M,l=d-R;break;case 1:a=M-u,l=d-R;break;case 2:a=M-u,l=R-d;break;case 3:a=u-M,l=R-d;break}return _.width=M,_.height=R,_.deltaX=a/g,_.deltaY=l/g,_}switch(o){case 0:_.width=w?u:u-a*g,_.height=b?d:d-l*g;break;case 1:_.width=w?u:u+a*g,_.height=b?d:d-l*g;break;case 2:_.width=w?u:u+a*g,_.height=b?d:d+l*g;break;case 3:_.width=w?u:u-a*g,_.height=b?d:d+l*g;break}return _},n.updateEdgePointByAnchors=function(){var i=n.nodeModel,o=i.id,a=i.anchors,l=n.getNodeEdges(o);l.sourceEdges.forEach(function(u){var d=a.find(function(f){return f.id===u.sourceAnchorId});d&&u.updateStartPoint({x:d.x,y:d.y})}),l.targetEdges.forEach(function(u){var d=a.find(function(f){return f.id===u.targetAnchorId});d&&u.updateEndPoint({x:d.x,y:d.y})})},n.updateRect=function(i){var o=i.deltaX,a=i.deltaY,l=n.nodeModel,u=l.x,d=l.y,f=l.width,h=l.height,g=l.radius,y=l.PCTResizeInfo,w=n.nodeModel,x=w.minWidth,b=w.minHeight,_=w.maxWidth,S=w.maxHeight,k=n.index,O=x===_,M=b===S,R=n.getResize({index:k,deltaX:o,deltaY:a,width:f,height:h,PCTResizeInfo:y,pct:1,freezeWidth:O,freezeHeight:M});if(R.width<x||R.width>_||R.height<b||R.height>S){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:O?0:R.deltaX,deltaY:M?0:R.deltaY}),n.nodeModel.width=R.width,n.nodeModel.height=R.height,n.nodeModel.setProperties({nodeSize:{width:R.width,height:R.height}});var T={x:u,y:d,width:f,height:h,radius:g},I={x:n.nodeModel.x,y:n.nodeModel.y,width:n.nodeModel.width,height:n.nodeModel.height,radius:g};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:a,beforeNode:T,afterNode:I})},n.updateEllipse=function(i){var o=i.deltaX,a=i.deltaY,l=n.nodeModel,u=l.rx,d=l.ry,f=l.x,h=l.y,g=l.PCTResizeInfo,y=n.index,w=n.nodeModel,x=w.minWidth,b=w.minHeight,_=w.maxWidth,S=w.maxHeight,k=x===_,O=b===S,M=u,R=d,T=n.getResize({index:y,deltaX:o,deltaY:a,width:M,height:R,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:O});if(T.width<x/2||T.width>_/2||T.height<b/2||T.height>S/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:T.deltaX,deltaY:O?0:T.deltaY}),n.nodeModel.rx=T.width,n.nodeModel.ry=T.height,n.nodeModel.setProperties({nodeSize:{rx:T.width,ry:T.height}});var I={x:f,y:h},$={rx:T.width,ry:T.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:a,beforeNode:ra(ra({},I),{rx:u,ry:d}),afterNode:$})},n.updateDiamond=function(i){var o=i.deltaX,a=i.deltaY,l=n.nodeModel,u=l.rx,d=l.ry,f=l.x,h=l.y,g=l.PCTResizeInfo,y=n.index,w=n.nodeModel,x=w.minWidth,b=w.minHeight,_=w.maxWidth,S=w.maxHeight,k=x===_,O=b===S,M=u,R=d,T=n.getResize({index:y,deltaX:o,deltaY:a,width:M,height:R,PCTResizeInfo:g,pct:1/2,freezeWidth:k,freezeHeight:O});if(T.width<x/2||T.width>_/2||T.height<b/2||T.height>S/2){n.dragHandler.cancelDrag();return}n.updatePosition({deltaX:k?0:T.deltaX,deltaY:O?0:T.deltaY}),n.nodeModel.rx=T.width,n.nodeModel.ry=T.height,n.nodeModel.setProperties({nodeSize:{rx:T.width,ry:T.height}});var I={x:f,y:h,rx:u,ry:d},$={rx:T.width,ry:T.height,x:n.nodeModel.x,y:n.nodeModel.y};n.updateEdgePointByAnchors(),n.eventEmit({deltaX:o,deltaY:a,beforeNode:I,afterNode:$})},n.eventEmit=function(i){var o=i.deltaX,a=i.deltaY,l=i.beforeNode,u=i.afterNode,d=n.nodeModel,f=d.id,h=d.modelType,g=d.type,y=ra({id:f,modelType:h,type:g},l),w=ra({id:f,modelType:h,type:g},u);n.graphModel.eventCenter.emit("node:resize",{preData:y,data:w,deltaX:o,deltaY:a,index:n.index,model:n.nodeModel})},n.onDragging=function(i){var o,a=i.deltaX,l=i.deltaY,u=n.graphModel.transformModel,d=n.nodeModel.modelType;o=dF(u.fixDeltaXY(a,l),2),a=o[0],l=o[1],d===Vt.RECT_NODE||d===Vt.HTML_NODE?n.updateRect({deltaX:a,deltaY:l}):d===Vt.ELLIPSE_NODE?n.updateEllipse({deltaX:a,deltaY:l}):d===Vt.DIAMOND_NODE&&n.updateDiamond({deltaX:a,deltaY:l})},n.onDragEnd=function(){var i=n.graphModel.gridSize,o=i===void 0?1:i,a=o*Math.round(n.nodeModel.x/o),l=o*Math.round(n.nodeModel.y/o);n.nodeModel.moveTo(a,l),n.updateEdgePointByAnchors()},n.index=t.index,n.nodeModel=t.model,n.graphModel=t.graphModel,n.dragHandler=new cF({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:1}),n}return e.prototype.getNodeEdges=function(t){for(var n=this.graphModel,i=n.edges,o=[],a=[],l=0;l<i.length;l++){var u=i[l];u.sourceNodeId===t?o.push(u):i[l].targetNodeId===t&&a.push(u)}return{sourceEdges:o,targetEdges:a}},e.prototype.render=function(){var t=this.props,n=t.x,i=t.y,o=t.index,a=t.model,l=a.getControlPointStyle();return Te("g",{className:"lf-resize-control-".concat(o),children:Te(ii,ra({className:"lf-node-control",x:n,y:i},l,{onMouseDown:this.dragHandler.handleMouseDown}))})},e}(Yt),hF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Yd=function(){return Yd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Yd.apply(this,arguments)},kc=function(r){hF(e,r);function e(){var t=r.call(this)||this;return t.state={},t}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,i=t.graphModel,o=n.x,a=n.y,l=n.width,u=n.height,d={minX:o-l/2,minY:a-u/2,maxX:o+l/2,maxY:a+u/2},f=d.minX,h=d.minY,g=d.maxX,y=d.maxY,w=[{x:f,y:h},{x:g,y:h},{x:g,y},{x:f,y}];return w.map(function(x,b){return Te(fF,Yd({index:b},x,{model:n,graphModel:i}))})},e.prototype.getGroupSolid=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.getResizeOutlineStyle();return Te(ii,Yd({},l,{x:n,y:i,width:o,height:a}))},e.prototype.render=function(){return Te("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},e}(Yt),xw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){xw(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Jp);(function(r){xw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Te(kc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model,i=t.graphModel.editConfigModel.isSilentMode;return Te("g",{children:[this.getResizeShape(),n.isSelected&&!i?this.getControlGroup():""]})},e})(sv);var ww=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),mv=function(){return mv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},mv.apply(this,arguments)};(function(r){ww(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.rx=o.rx,i.ry=o.ry),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(this.rx*2)*100,this.maxHeight/(this.ry*2)*100),minScaleLimit:Math.max(this.minWidth/(this.rx*2)*100,this.minHeight/(this.ry*2)*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Kp);(function(r){ww(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Te(kc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){var t=this.props.model,n=t.points,i=t.getNodeStyle();return Te("g",{children:Te(rg,mv({},i,{points:n}))})},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Te("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(ov);var Sw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();(function(r){Sw(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e})(Fl);(function(r){Sw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Te(kc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Te("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e})(Wl);var Ew=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),pF=function(r){Ew(e,r);function e(t,n){var i=r.call(this,t,n)||this,o=t.properties.nodeSize;return o&&(i.width=o.width,i.height=o.height),i}return e.prototype.initNodeData=function(t){r.prototype.initNodeData.call(this,t),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var t=r.prototype.getOutlineStyle.call(this),n=this.graphModel.editConfigModel.isSilentMode;return n||(t.stroke="none",t.hover&&(t.hover.stroke="none")),t},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(t===void 0&&(t=!0),t){var n={widthPCT:100,heightPCT:100},i={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:n,ResizeBasis:i,ScaleLimit:o}}else delete this.PCTResizeInfo},e}(ps),vF=function(r){Ew(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props,n=t.model,i=t.graphModel;return Te(kc,{model:n,graphModel:i})},e.prototype.getResizeShape=function(){return r.prototype.getShape.call(this)},e.prototype.getShape=function(){var t=this.props,n=t.model.isSelected,i=t.graphModel.editConfigModel.isSilentMode;return Te("g",{children:[this.getResizeShape(),n&&!i?this.getControlGroup():""]})},e}(ca),Cw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Kd=function(){return Kd=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Kd.apply(this,arguments)},Jo=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},Zo=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},a0=500,s0=300,gF=-1e4;(function(r){Cw(e,r);function e(){var t=r.apply(this,Zo([],Jo(arguments),!1))||this;return t.isGroup=!0,t.isFolded=!1,t.unfoldedWidth=a0,t.unfoldedHeight=s0,t.childrenLastFoldStatus={},t}return e.prototype.initNodeData=function(t){var n=this;r.prototype.initNodeData.call(this,t);var i=[];E1(t.children)&&(i=t.children),this.children=new Set(i),this.width=a0,this.height=s0,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=gF,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,this.properties.isFolded===void 0&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){n.isFolded&&n.foldGroup(n.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.foldGroup=function(t){var n=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var i=Zo(Zo([],Jo(this.incoming.edges),!1),Jo(this.outgoing.edges),!1);this.children.forEach(function(o){var a=n.graphModel.getElement(o);if(a){var l=a.isFolded;if(a.isGroup&&!a.isFolded&&a.foldGroup(t),a.isGroup&&!t){var u=n.childrenLastFoldStatus[o];u!==void 0&&u!==a.isFolded&&a.foldGroup(u)}n.childrenLastFoldStatus[o]=!!l,a.visible=!t;var d=a.incoming.edges,f=a.outgoing.edges;i=Zo(Zo(Zo([],Jo(i),!1),Jo(d),!1),Jo(f),!1)}}),this.foldEdge(t,i)}},e.prototype.getAnchorStyle=function(t){var n=r.prototype.getAnchorStyle.call(this,t);return n.stroke="transparent",n.fill="transparent",n.hover.fill="transparent",n.hover.stroke="transparent",n},e.prototype.foldEdge=function(t,n){var i=this;n.forEach(function(o,a){var l=o.id,u=o.sourceNodeId,d=o.targetNodeId,f=o.startPoint,h=o.endPoint,g=o.type,y=o.text,w=o.getProperties(),x={id:"".concat(l,"__").concat(a),sourceNodeId:u,targetNodeId:d,startPoint:f,endPoint:h,type:g,properties:w,text:y==null?void 0:y.value};o.virtual&&i.graphModel.deleteEdgeById(o.id);var b=i.graphModel.group.getNodeGroup(d);b||(b=i.graphModel.getNodeModelById(d));var _=i.graphModel.group.getNodeGroup(u);_||(_=i.graphModel.getNodeModelById(u)),t&&o.visible!==!1&&(i.children.has(u)||i.id===u?(x.startPoint=void 0,x.sourceNodeId=i.id):(x.endPoint=void 0,x.targetNodeId=i.id),(b.id!==i.id||_.id!==i.id)&&i.createVirtualEdge(x),o.visible=!1),!t&&o.visible===!1&&(b&&b.isGroup&&b.isFolded?(x.targetNodeId=b.id,x.endPoint=void 0,i.createVirtualEdge(x)):_&&_.isGroup&&_.isFolded?(x.sourceNodeId=_.id,x.startPoint=void 0,i.createVirtualEdge(x)):o.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isFoldedEdge=!0},e.prototype.isInRange=function(t){var n=t.minX,i=t.minY,o=t.maxX,a=t.maxY;return n>=this.x-this.width/2&&o<=this.x+this.width/2&&i>=this.y-this.height/2&&a<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var n=t.minX,i=t.minY,o=t.maxX,a=t.maxY;return{x:n>=this.x-this.width/2&&o<=this.x+this.width/2,y:i>=this.y-this.height/2&&a<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this);n.children=[],this.children.forEach(function(o){var a=t.graphModel.getNodeModelById(o);a&&!a.virtual&&n.children.push(o)});var i=n.properties;return i==null||delete i.groupAddable,i==null||delete i.isFolded,n},e.prototype.getHistoryData=function(){var t=r.prototype.getData.call(this);t.children=Zo([],Jo(this.children),!1),t.isGroup=!0;var n=t.properties;return n==null||delete n.groupAddable,n!=null&&n.isFolded&&(t.x=t.x+this.unfoldedWidth/2-this.foldedWidth/2,t.y=t.y+this.unfoldedHeight/2-this.foldedHeight/2),t},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--},e})(pF);(function(r){Cw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getControlGroup=function(){var t=this.props.model,n=t.resizable,i=t.properties;return n&&!i.isFolded?r.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,a=t.y,l=t.radius,u=t.properties,d=t.getAddableOutlineStyle;if(!u.groupAddable)return null;var f=this.props.model.getNodeStyle().strokeWidth,h=f===void 0?0:f,g=d(),y=n+h+8,w=i+h+8;return wt("rect",Kd(Kd({},g),{width:y,height:w,x:o-y/2,y:a-w/2,rx:l,ry:l}))},e.prototype.getFoldIcon=function(){var t=this.props.model,n=t.x-t.width/2+5,i=t.y-t.height/2+5;if(!t.foldable)return null;var o=wt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," M").concat(n+7,",").concat(i+2," ").concat(n+7,",").concat(i+10):"M ".concat(n+3,",").concat(i+6," ").concat(n+11,",").concat(i+6," ")});return wt("g",{},[wt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),o])},e.prototype.getResizeShape=function(){return wt("g",{},[this.getAddableShape(),r.prototype.getResizeShape.call(this),this.getFoldIcon()])},e})(vF);var l0=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),kl=function(){return kl=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},kl.apply(this,arguments)};function mF(r){var e=function(n){l0(i,n);function i(o,a){o.id||(o.id="Flow_".concat(lF()));var l=kl(kl(kl({},{}),o.properties),{isDefaultFlow:!1});return o.properties=l,n.call(this,o,a)||this}return i.extendKey="SequenceFlowModel",i}(hs),t=function(n){l0(i,n);function i(){return n!==null&&n.apply(this,arguments)||this}return i.prototype.getStartArrow=function(){var o=this.props.model,a=o.properties.isDefaultFlow;return a?wt("path",{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}):wt("path",{d:""})},i.extendKey="SequenceFlowEdge",i}(vs);return{type:"bpmn:sequenceFlow",view:t,model:e}}mF();var u0={width:40,height:40},d0={width:40,height:40},c0={width:100,height:80},Jd={width:100,height:80},f0={width:100,height:80},h0={width:100,height:80},p0={width:100,height:80},v0={width:100,height:80},g0={width:100,height:80},m0={width:100,height:80},Nr=function(){};Nr.ObjTree=function(){return this};Nr.ObjTree.VERSION="0.23";Nr.ObjTree.prototype.xmlDecl=`<?xml version="1.0" encoding="UTF-8" ?>
`;Nr.ObjTree.prototype.attr_prefix="-";Nr.ObjTree.prototype.parseXML=function(r){var e;if(window.DOMParser){var t=new DOMParser,n=t.parseFromString(r,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(r),e=t.documentElement);if(e){var i=this.parseDOM(e);return i}};Nr.ObjTree.prototype.parseHTTP=function(r,e,t){var n={};for(var i in e)n[i]=e[i];if(n.method||(typeof n.postBody>"u"&&typeof n.postbody>"u"&&typeof n.parameters>"u"?n.method="get":n.method="post"),t){n.asynchronous=!0;var o=this,a=t,l=n.onComplete;n.onComplete=function(f){var h;f&&f.responseXML&&f.responseXML.documentElement&&(h=o.parseDOM(f.responseXML.documentElement)),a(h,f),l&&l(f)}}else n.asynchronous=!1;var u;if(typeof HTTP<"u"&&HTTP.Request){n.uri=r;var d=new HTTP.Request(n);d&&(u=d.transport)}else if(typeof Ajax<"u"&&Ajax.Request){var d=new Ajax.Request(r,n);d&&(u=d.transport)}if(t)return u;if(u&&u.responseXML&&u.responseXML.documentElement)return this.parseDOM(u.responseXML.documentElement)};Nr.ObjTree.prototype.parseDOM=function(r){if(r){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var t=this.parseElement(r);if(this.__force_array[r.nodeName]&&(t=[t]),r.nodeType!==11){var n={};n[r.nodeName]=t,t=n}return t}};Nr.ObjTree.prototype.parseElement=function(r){if(r.nodeType!==7){if(r.nodeType===3||r.nodeType===4||r.nodeType===8){var e=r.nodeValue.match(/[^\x00-\x20]/);return e==null?void 0:r.nodeValue}var t=null,n={};if(r.attributes&&r.attributes.length){t={};for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i].nodeName;if(typeof o=="string"){var a=r.attributes[i].nodeValue;try{a=JSON.parse(r.attributes[i].nodeValue.replace(/'/g,'"'))}catch{a=r.attributes[i].nodeValue}a!=null&&(o=this.attr_prefix+o,typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],a))}}}if(r.childNodes&&r.childNodes.length){var l=!0;t&&(l=!1);for(var i=0;i<r.childNodes.length&&l;i++){var u=r.childNodes[i].nodeType;u===3||u===4||u===8||(l=!1)}if(l){t||(t="");for(var i=0;i<r.childNodes.length;i++)t+=r.childNodes[i].nodeValue}else{t||(t={});for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i].nodeName;if(typeof o=="string"){var a=this.parseElement(r.childNodes[i]);a&&(typeof n[o]>"u"&&(n[o]=0),n[o]++,this.addNode(t,o,n[o],a))}}}}else t===null&&(t={});return t}};Nr.ObjTree.prototype.addNode=function(r,e,t,n){this.__force_array[e]?(t===1&&(r[e]=[]),r[e][r[e].length]=n):t===1?r[e]=n:t===2?r[e]=[r[e],n]:r[e][r[e].length]=n};Nr.ObjTree.prototype.writeXML=function(r){var e=this.hash_to_xml(null,r);return this.xmlDecl+e};Nr.ObjTree.prototype.hash_to_xml=function(r,e){var t=[],n=[];for(var i in e)if(xp(e,i)){var o=e[i];i.charAt(0)!==this.attr_prefix?typeof o>"u"||o==null?t[t.length]="<".concat(i," />"):typeof o=="object"&&o.constructor===Array?t[t.length]=this.array_to_xml(i,o):typeof o=="object"?t[t.length]=this.hash_to_xml(i,o):t[t.length]=this.scalar_to_xml(i,o):n[n.length]=" ".concat(i.substring(1),'="').concat(this.xml_escape(o),'"')}var a=n.join(""),l=t.join("");return typeof r>"u"||r==null||(t.length>0?l.match(/\n/)?l="<".concat(r).concat(a,`>
`).concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(a,">").concat(l,"</").concat(r,`>
`):l="<".concat(r).concat(a,` />
`)),l};Nr.ObjTree.prototype.array_to_xml=function(r,e){for(var t=[],n=0;n<e.length;n++){var i=e[n];typeof i>"u"||i==null?t[t.length]="<".concat(r," />"):typeof i=="object"&&i.constructor===Array?t[t.length]=this.array_to_xml(r,i):typeof i=="object"?t[t.length]=this.hash_to_xml(r,i):t[t.length]=this.scalar_to_xml(r,i)}return t.join("")};Nr.ObjTree.prototype.scalar_to_xml=function(r,e){return r==="#text"?this.xml_escape(e):"<".concat(r,">").concat(this.xml_escape(e),"</").concat(r,`>
`)};Nr.ObjTree.prototype.xml_escape=function(r){return r.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var yF=function(r){return new Nr.ObjTree().parseXML(r)};function kw(r){return Object.prototype.toString.call(r)}function y0(r){return"  ".repeat(r)}function Zd(r){return kw(r)==="[object Object]"?Object.keys(r).reduce(function(e,t){var n=t;return t.charAt(0)==="-"&&(n=t.substring(1)),e[n]=Zd(r[t]),e},{}):Array.isArray(r)?r.map(function(e){return Zd(e)}):r}function _F(r){var e=r;try{typeof e!="string"&&(e=JSON.parse(r))}catch{e=JSON.stringify(Zd(r)).replace(/"/g,"'")}return e}var _0=`	
`;function fd(r,e,t){var n=y0(t),i="",o=_0+n;if(e==="-json")return"";if(e==="#text")return o+r;if(e==="#cdata-section")return"".concat(o,"<![CDATA[").concat(r,"]]>");if(e==="#comment")return"".concat(o,"<!--").concat(r,"-->");if("".concat(e).charAt(0)==="-")return" ".concat(e.substring(1),'="').concat(_F(r),'"');if(Array.isArray(r))i+=r.map(function(d){return fd(d,e,t+1)}).join("");else if(kw(r)==="[object Object]"){var a=Object.keys(r),l="",u=r["-json"]?_0+y0(t+1)+r["-json"]:"";i+="".concat(t===0?"":o,"<").concat(e),a.forEach(function(d){d.charAt(0)==="-"?l+=fd(r[d],d,t+1):u+=fd(r[d],d,t+1)}),i+=l+(u!==""?">".concat(u).concat(o,"</").concat(e,">"):" />")}else i+="".concat(o,"<").concat(e,">").concat(r.toString(),"</").concat(e,">");return i}function bF(r){var e="";for(var t in r)e+=fd(r[t],t,0);return e}var xF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),yv=function(){return yv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},yv.apply(this,arguments)},b0=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t},ag=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},pr=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},_i=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},Cr;(function(r){r.START="bpmn:startEvent",r.END="bpmn:endEvent",r.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",r.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",r.BOUNDARY="bpmn:boundaryEvent",r.PARALLEL_GATEWAY="bpmn:parallelGateway",r.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",r.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",r.USER="bpmn:userTask",r.SYSTEM="bpmn:serviceTask",r.FLOW="bpmn:sequenceFlow",r.SUBPROCESS="bpmn:subProcess"})(Cr||(Cr={}));var Ow=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],wF=["properties","startPoint","endPoint","pointsList"],Qd={in:[],out:["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"]},Nw=function(r,e){var t=Object.keys(e||{});return t.forEach(function(n){if(r[n]){var i=e[n],o=i.in,a=i.out;o&&(r[n].in=o),a&&(r[n].out=a)}else r[n]=e[n]}),r},ni={"bpmn:startEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ni[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateCatchEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ni[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:intermediateThrowEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ni[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:boundaryEvent":{out:function(r){var e,t,n=r.properties;return((t=(e=ni[n.definitionType])===null||e===void 0?void 0:e.out)===null||t===void 0?void 0:t.call(e,r))||{}}},"bpmn:sequenceFlow":{out:function(r){var e=r.properties,t=e.expressionType,n=e.condition;return n?t==="cdata"?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(n,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(n,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(r){var e=r.properties,t=e.timerType,n=e.timerValue,i=e.definitionId,o=function(){return"<bpmn:".concat(t,' xsi:type="bpmn:tFormalExpression">').concat(n,"</bpmn:").concat(t,">")};return{json:'<bpmn:timerEventDefinition id="'.concat(i,'"').concat(t&&n?">".concat(o(),"</bpmn:timerEventDefinition>"):"/>")}},in:function(r,e){var t,n,i,o,a=r,l=e["-id"],u="",d="";try{for(var f=ag(Object.keys(e)),h=f.next();!h.done;h=f.next()){var g=h.value;g.includes("bpmn:")&&(i=pr(g.split(":"),2),u=i[1],d=(o=e[g])===null||o===void 0?void 0:o["#text"])}}catch(y){t={error:y}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}return{"-definitionId":l,"-definitionType":a,"-timerType":u,"-timerValue":d}}},"bpmn:conditionExpression":{in:function(r,e){var t,n="",i="";return e["#cdata-section"]?(i="cdata",n=((t=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))===null||t===void 0?void 0:t[1])||""):e["#text"]&&(i="normal",n=e["#text"]),{"-condition":n,"-expressionType":i}}}};function SF(r){var e=r??{},t=e.retainedAttrsFields,n=e.excludeFields,i=e.transformer,o=new Set(_i(_i([],pr(wF),!1),pr(t||[]),!1)),a={in:new Set(_i(_i([],pr(Qd.in),!1),pr((n==null?void 0:n.in)||[]),!1)),out:new Set(_i(_i([],pr(Qd.out),!1),pr((n==null?void 0:n.out)||[]),!1))};return ni=Nw(ni,i),function(l){var u=l.nodes,d=l.edges;function f(h,g){var y,w;if((h==null?void 0:h.flag)!==1){var x;if((x=ni[h.type])&&x.out){var b=x.out(h),_=Object.keys(b);_.length>0&&_.forEach(function($){h[$]=b[$]})}h!=null&&h.children&&(h.children=h.children.map(function($){var ne=u.find(function(V){return V.id===$})||d.find(function(V){return V.id===$});return ne||{}}));var S={};if(typeof h=="string")return h;if(Array.isArray(h))return h.map(function($){return f($,"")}).filter(function($){return $!=null});try{for(var k=ag(Object.entries(h)),O=k.next();!O.done;O=k.next()){var M=pr(O.value,2),R=M[0],T=M[1];if((T==null?void 0:T.flag)===1)return;var I=[g,R].filter(function($){return $}).join(".");a.out.has(I)||(typeof T!="object"?R.indexOf("-")===0||["#text","#cdata-section","#comment"].includes(R)?S[R]=T:S["-".concat(R)]=T:o.has(I)?S["-".concat(R)]=f(T,I):S[R]=f(T,I))}}catch($){y={error:$}}finally{try{O&&!O.done&&(w=k.return)&&w.call(k)}finally{if(y)throw y.error}}return S}}return f(l,"")}}function ec(r){var e,t,n={};try{for(var i=ag(Object.entries(r)),o=i.next();!o.done;o=i.next()){var a=pr(o.value,2),l=a[0],u=a[1];l.indexOf("-")===0?n[l.substring(1)]=Zd(u):typeof u=="string"?n[l]=u:Object.prototype.toString.call(u)==="[object Object]"?n[l]=ec(u):Array.isArray(u)?n[l]=u.map(function(d){return ec(d)}):n[l]=u}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n}function EF(r,e,t){var n,i=new Map,o=SF(t)(e);o.nodes.forEach(function(l){var u=l["-id"],d=l["-type"],f=l.text,h=l.children,g=b0(l,["-id","-type","text","children"]),y={"-id":u};f!=null&&f["-value"]&&(y["-name"]=f["-value"]),g["-json"]&&(y["-json"]=g["-json"]),g["-properties"]&&Object.assign(y,g["-properties"]),h&&(y.children=h),r[d]||(r[d]=[]),r[d].push(y),i.set(u,y)});var a=o.edges.map(function(l){var u=l["-id"],d=l["-sourceNodeId"],f=l["-targetNodeId"],h=l.text,g=b0(l,["-id","-sourceNodeId","-targetNodeId","text"]),y=i.get(f);y["bpmn:incoming"]||(y["bpmn:incoming"]=[]),y["bpmn:incoming"].push(u);var w={"-id":u,"-sourceRef":d,"-targetRef":f};return h!=null&&h["-value"]&&(w["-name"]=h["-value"]),g["-json"]&&(w["-json"]=g["-json"]),g["-properties"]&&Object.assign(w,g["-properties"]),w});return e.edges.forEach(function(l){var u=l.sourceNodeId,d=l.id,f=i.get(u);f["bpmn:outgoing"]||(f["bpmn:outgoing"]=[]),f["bpmn:outgoing"].push(d)}),(n=r["bpmn:subProcess"])===null||n===void 0||n.forEach(function(l){var u={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},d=[];l.children.forEach(function(x){var b,_=i.get(x["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(k){_[k]&&_[k].forEach(function(O){u[k].add(O)})});var S=(b=r[x["-type"]])===null||b===void 0?void 0:b.findIndex(function(k){return k["-id"]===x["-id"]});S>=0&&r[x["-type"]].splice(S,1),i.delete(x["-id"]),l[x["-type"]]||(l[x["-type"]]=[]),l[x["-type"]].push(_)});var f=u["bpmn:incoming"],h=u["bpmn:outgoing"];h.forEach(function(x){f.has(x)&&d.push(x)});for(var g=function(x){var b=a.findIndex(function(_){return _["-id"]===d[x]});b>=0?(l["bpmn:sequenceFlow"]||(l["bpmn:sequenceFlow"]=[]),l["bpmn:sequenceFlow"].push(a[b]),a.splice(b,1)):x++,y=x},y,w=0;w<d.length;)g(w),w=y;delete l.children}),r[Cr.FLOW]=a,r}function CF(r,e){r["bpmndi:BPMNEdge"]=e.edges.map(function(t){var n,i=t.id,o=t.pointsList.map(function(l){var u=l.x,d=l.y;return{"-x":u,"-y":d}}),a={"-id":"".concat(i,"_di"),"-bpmnElement":i,"di:waypoint":o};return!((n=t.text)===null||n===void 0)&&n.value&&(a["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),a}),r["bpmndi:BPMNShape"]=e.nodes.map(function(t){var n,i=t.id,o=100,a=80,l=t.x,u=t.y,d=zr.shapeConfigMap.get(t.type);d&&(o=d.width,a=d.height),l-=o/2,u-=a/2;var f={"-id":"".concat(i,"_di"),"-bpmnElement":i,"dc:Bounds":{"-x":l,"-y":u,"-width":o,"-height":a}};return!((n=t.text)===null||n===void 0)&&n.value&&(f["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-t.text.value.length*10/2,"-y":t.text.y-7,"-width":t.text.value.length*10,"-height":14}}),f})}var kF=["bpmn:incoming","bpmn:outgoing"];function OF(r,e){var t=[],n=[],i=new Map,o=e??{},a=o.transformer,l=o.excludeFields,u={in:new Set(_i(_i([],pr(Qd.in),!1),pr((l==null?void 0:l.in)||[]),!1)),out:new Set(_i(_i([],pr(Qd.out),!1),pr((l==null?void 0:l.out)||[]),!1))};ni=Nw(ni,a);var d=r["bpmn:definitions"];if(d){var f=d["bpmn:process"];(function(g,y){y.forEach(function(w){try{Object.keys(g).forEach(function(x){try{w(x)}catch(b){console.error(b)}})}catch(x){console.error(x)}})})(f,[function(g){function y(x){x["-children"]||(x["-children"]=[]),Object.keys(x).forEach(function(b){var _;b.indexOf("bpmn:")===0&&!kF.includes(b)&&(f[b]||(f[b]=[]),!Array.isArray(f[b])&&(f[b]=[f[b]]),Array.isArray(x[b])?(_=f[b]).push.apply(_,_i([],pr(x[b]),!1)):f[b].push(x[b]),Array.isArray(x[b])?x[b].forEach(function(S){!b.includes("Flow")&&x["-children"].push(S["-id"])}):!b.includes("Flow")&&x["-children"].push(x[b]["-id"]),delete x[b])})}if(g==="bpmn:subProcess"){var w=f[g];Array.isArray(w)?w.forEach(function(x){g==="bpmn:subProcess"&&y(x)}):y(w)}},function(g){var y=function(x){Object.keys(x).forEach(function(b){var _,S;if(b.includes("bpmn:")){var k={};ni[b]&&ni[b].in?(k=(S=(_=ni[b]).in)===null||S===void 0?void 0:S.call(_,b,C1.cloneDeep(x[b])),delete x[b]):w(x[b]);var O=void 0;(O=Reflect.ownKeys(k)).length>0&&O.forEach(function(M){Reflect.set(x,M,k[M])})}})};function w(x){i.set(x["-id"],x),Array.isArray(x)?x.forEach(function(b){w(b)}):typeof x=="object"&&y(x)}w(f[g])},function(g){if(g.indexOf("bpmn:")===0){var y=f[g];if(g==="bpmn:sequenceFlow"){var w=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];n=MF(y,w)}else{var x=d["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if(g==="bpmn:boundaryEvent"){var b=f[g],_=function(S){var k=S["-attachedToRef"],O=i.get(k);O["-boundaryEvents"]||(O["-boundaryEvents"]=[]),O["-boundaryEvents"].push(S["-id"])};Array.isArray(b)?b.forEach(function(S){_(S)}):_(b)}t=t.concat(NF(y,x,g))}}}])}var h=function(g,y,w){Object.keys(g).forEach(function(x){var b=w?"".concat(w,".").concat(x):x;y.has(b)?delete g[x]:typeof g[x]=="object"&&h(g[x],y,b)})};return t.forEach(function(g){var y,w;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var x=(w=e==null?void 0:e.mapping)===null||w===void 0?void 0:w.in,b=g.type;x[b]&&(g.type=x[b])}h(g,u.in,"")}),n.forEach(function(g){var y,w;if(!((y=e==null?void 0:e.mapping)===null||y===void 0)&&y.in){var x=(w=e==null?void 0:e.mapping)===null||w===void 0?void 0:w.in,b=g.type;x[b]&&(g.type=x[b])}h(g,u.in,"")}),{nodes:t,edges:n}}function NF(r,e,t){var n=[];if(Array.isArray(r))r.forEach(function(a){var l;Array.isArray(e)?l=e.find(function(d){return d["-bpmnElement"]===a["-id"]}):l=e;var u=x0(l,t,a);n.push(u)});else{var i=void 0;Array.isArray(e)?i=e.find(function(a){return a["-bpmnElement"]===r["-id"]}):i=e;var o=x0(i,t,r);n.push(o)}return n}function x0(r,e,t){var n=Number(r["dc:Bounds"]["-x"]),i=Number(r["dc:Bounds"]["-y"]),o=t["-children"],a=t["-name"],l=zr.shapeConfigMap.get(e);l&&(n+=l.width/2,i+=l.height/2);var u={};Object.entries(t).forEach(function(g){var y=pr(g,2),w=y[0],x=y[1];Ow.includes(w)||(u[w]=x)}),u=ec(u);var d;if(a&&(d={x:n,y:i,value:a},r["bpmndi:BPMNLabel"]&&r["bpmndi:BPMNLabel"]["dc:Bounds"])){var f=r["bpmndi:BPMNLabel"]["dc:Bounds"];d.x=Number(f["-x"])+Number(f["-width"])/2,d.y=Number(f["-y"])+Number(f["-height"])/2}var h={id:r["-bpmnElement"],type:e,x:n,y:i,properties:u};return o&&(h.children=o),d&&(h.text=d),h}function MF(r,e){var t=[];if(Array.isArray(r))r.forEach(function(i){var o;Array.isArray(e)?o=e.find(function(a){return a["-bpmnElement"]===i["-id"]}):o=e,t.push(w0(o,i))});else{var n=void 0;Array.isArray(e)?n=e.find(function(i){return i["-bpmnElement"]===r["-id"]}):n=e,t.push(w0(n,r))}return t}function w0(r,e){var t,n=e["-name"]?"".concat(e["-name"]):"";if(n){var i=r["bpmndi:BPMNLabel"]["dc:Bounds"],o=0;n.split(`
`).forEach(function(d){o<d.length&&(o=d.length)}),t={value:n,x:Number(i["-x"])+o*10/2,y:Number(i["-y"])+7}}var a={};Object.entries(e).forEach(function(d){var f=pr(d,2),h=f[0],g=f[1];Ow.includes(h)||(a[h]=g)}),a=ec(a);var l=r["di:waypoint"].map(function(d){return{x:Number(d["-x"]),y:Number(d["-y"])}}),u={id:e["-id"],type:Cr.FLOW,pointsList:l,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:a};return t&&(u.text=t),u}var zr=function(){function r(e){var t=e.lf,n=this;this.adapterOut=function(i,o){var a,l,u=yv({},n.processAttributes);EF(u,i,o);var d={"-id":"BPMNPlane_1","-bpmnElement":u["-id"]};CF(d,i);var f=n.definitionAttributes;f["bpmn:process"]=u,f["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":d};var h={"bpmn:definitions":f};if(!((a=o==null?void 0:o.mapping)===null||a===void 0)&&a.out){var g=(l=o==null?void 0:o.mapping)===null||l===void 0?void 0:l.out,y=function(w){Array.isArray(w)&&w.forEach(function(x){return y(x)}),typeof w=="object"&&Object.keys(w).forEach(function(x){var b;(b=g[x])?(w[b]=C1.cloneDeep(w[x]),delete w[x],y(w[b])):y(w[x])})};y(h)}return h},this.adapterIn=function(i,o){if(i)return OF(i,o)},t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return r.prototype.setCustomShape=function(e,t){r.shapeConfigMap.set(e,t)},r.pluginName="bpmn-adapter",r.shapeConfigMap=new Map,r}();zr.shapeConfigMap.set(Cr.START,{width:u0.width,height:u0.height});zr.shapeConfigMap.set(Cr.END,{width:d0.width,height:d0.height});zr.shapeConfigMap.set(Cr.INTERMEDIATE_CATCH,{width:Jd.width,height:Jd.height});zr.shapeConfigMap.set(Cr.INTERMEDIATE_THROW,{width:Jd.width,height:Jd.height});zr.shapeConfigMap.set(Cr.BOUNDARY,{width:c0.width,height:c0.height});zr.shapeConfigMap.set(Cr.PARALLEL_GATEWAY,{width:f0.width,height:f0.height});zr.shapeConfigMap.set(Cr.INCLUSIVE_GATEWAY,{width:h0.width,height:h0.height});zr.shapeConfigMap.set(Cr.EXCLUSIVE_GATEWAY,{width:p0.width,height:p0.height});zr.shapeConfigMap.set(Cr.SYSTEM,{width:v0.width,height:v0.height});zr.shapeConfigMap.set(Cr.USER,{width:g0.width,height:g0.height});zr.shapeConfigMap.set(Cr.SUBPROCESS,{width:m0.width,height:m0.height});(function(r){xF(e,r);function e(t){var n=r.call(this,t)||this;n.adapterXmlIn=function(a){var l=yF(a);return n.adapterIn(l,n.props)},n.adapterXmlOut=function(a){var l=n.adapterOut(a,n.props);return bF(l)};var i=t.lf,o=t.props;return i.adapterIn=n.adapterXmlIn,i.adapterOut=n.adapterXmlOut,n.props=o,n}return e.pluginName="BPMNAdapter",e})(zr);function AF(r,e,t){var n=e.x,i=e.y,o=r.x,a=r.y,l=o-n,u=a-i,d=l*Math.cos(t)-u*Math.sin(t),f=l*Math.sin(t)+u*Math.cos(t),h=d+n,g=f+i;return{x:h,y:g}}var TF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),tc=function(){return tc=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},tc.apply(this,arguments)},DF=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},LF=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){TF(e,r);function e(){var t=r.apply(this,LF([],DF(arguments),!1))||this;return t.childrenPositionMap=new Map,t.onNodeRotate=function(n){var i=n.model,o=t.props,a=o.model,l=o.graphModel,u=a.transformWithContainer,d=a.isRestrict,f=t.childrenPositionMap;if(!(!u||d)&&i.id===a.id){var h={x:a.x,y:a.y};un(Array.from(a.children),function(g){var y=l.getNodeModelById(g);if(y){var w={x:y.x,y:y.y};f.has(y.id)?w=f.get(y.id):f.set(y.id,w);var x=i.rotate*(180/Math.PI);x<0&&(x+=360);var b=x*(Math.PI/180),_=AF(w,h,b);y.moveTo(_.x,_.y),y.rotate=i.rotate}})}},t.onNodeResize=function(n){var i=n.deltaX,o=n.deltaY,a=n.index,l=n.model,u=n.preData,d=t.props,f=d.model,h=d.graphModel,g=f.transformWithContainer,y=f.isRestrict;if(!(!g||y)&&l.id===f.id){var w=u.properties,x=w||{},b=x.width,_=x.height;un(Array.from(f.children),function(S){var k=h.getNodeModelById(S);if(k){var O=k.width/b*i,M=k.height/_*o;ow({deltaX:O,deltaY:M,index:a,nodeModel:k,graphModel:h,cancelCallback:function(){}})}})}},t.onNodeMouseMove=function(){},t.graphRendered=function(){var n=t.props.model;n.isCollapsed&&n.toggleCollapse(!0)},t}return e.prototype.componentDidMount=function(){r.prototype.componentDidMount.call(this);var t=this.props.graphModel.eventCenter;t.on("node:rotate",this.onNodeRotate),t.on("node:resize",this.onNodeResize),t.on("node:mousemove",this.onNodeMouseMove),t.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this);var t=this.props.graphModel.eventCenter;t.off("node:rotate",this.onNodeRotate),t.off("node:resize",this.onNodeResize),t.off("node:mousemove",this.onNodeMouseMove),t.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,n){var i=this,o=[];return t.isGroup&&un(Array.from(t.children),function(a){o.push(a);var l=n.getNodeModelById(a);l!=null&&l.isGroup&&(o=o.concat(i.getNodesInGroup(l,n)))}),o},e.prototype.getResizeControl=function(){var t=this.props.model,n=t.resizable,i=t.isCollapsed,o=n&&!i;return o?r.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,n=t.width,i=t.height,o=t.x,a=t.y,l=t.radius,u=t.groupAddable;if(!u)return null;var d=t.getNodeStyle().strokeWidth,f=d===void 0?0:d,h=t.getAddableOutlineStyle(),g=n+f+8,y=i+f+8;return wt("rect",tc(tc({},h),{width:g,height:y,x:o-g/2,y:a-y/2,rx:l,ry:l}))},e.prototype.getCollapseIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," M").concat(t+7,",").concat(n+2," ").concat(t+7,",").concat(n+10)},e.prototype.getExpandIcon=function(t,n){return"M ".concat(t+3,",").concat(n+6," ").concat(t+11,",").concat(n+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=n-o/2+10,u=i-a/2+10;if(!t.collapsible)return null;var d=t!=null&&t.isCollapsed?this.getCollapseIcon(l,u):this.getExpandIcon(l,u),f=wt("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d});return wt("g",{},[wt("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:l,y:u,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),f])},e.prototype.getShape=function(){return wt("g",{},[this.getAppendAreaShape(),r.prototype.getShape.call(this),this.getOperateIcon()])},e})(ca);var PF=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),nc=function(){return nc=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},nc.apply(this,arguments)},Uf=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Wa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},sl=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},RF=400,IF=230,BF=80,jF=60,HF=-1e4;(function(r){PF(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.isGroup=!0,i.isRestrict=!1,i.autoResize=!1,i.collapsible=!0,i.isCollapsed=!1,i.groupAddable=!1,i.transformWithContainer=!1,i.childrenLastCollapseStateDict=new Map,i.childrenLastCollapseStateDict=new Map,i.initNodeData(t),i.setAttributes(),i}return e.prototype.initNodeData=function(t){var n;r.prototype.initNodeData.call(this,t);var i=(n=t.properties)!==null&&n!==void 0?n:{},o=i.children,a=i.width,l=i.height,u=i.collapsedWidth,d=i.collapsedHeight,f=i.collapsible,h=i.isCollapsed,g=i.zIndex,y=i.isRestrict,w=i.autoResize,x=i.autoToFront,b=i.transformWithContainer;this.children=o?new Set(o):new Set,this.zIndex=g??HF,this.isCollapsed=h??!1,this.setProperties({isCollapsed:h??!1});var _=a??RF,S=l??IF;this.width=_,this.height=S,this.expandWidth=_,this.expandHeight=S,this.collapsedWidth=u??BF,this.collapsedHeight=d??jF,this.isRestrict=y??!1,this.transformWithContainer=b??!1,this.autoResize=w??!1,this.collapsible=f??!0,this.autoToFront=x??!1,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this)},e.prototype.getData=function(){var t=this,n=r.prototype.getData.call(this),i=[];return un(Array.from(this.children),function(o){var a=t.graphModel.getNodeModelById(o);a&&!a.virtual&&i.push(o)}),n.children=i,n.properties&&(n.properties.children=i,n.properties.isCollapsed=this.isCollapsed),n},e.prototype.getNodesInGroup=function(t){var n=[];return t.isGroup&&un(Array.from(t.children),function(i){n.push(i)}),n},e.prototype.getMoveDistance=function(t,n,i){i===void 0&&(i=!1);var o=Wa(r.prototype.getMoveDistance.call(this,t,n,i),2),a=o[0],l=o[1],u=this.getNodesInGroup(this);return this.graphModel.moveNodes(u,t,n,i),[a,l]},e.prototype.getHistoryData=function(){var t=r.prototype.getHistoryData.call(this);t.children=Array.from(this.children),t.isGroup=!0;var n=this,i=n.x,o=n.y,a=n.collapsedWidth,l=n.collapsedHeight,u=n.expandWidth,d=n.expandHeight,f=n.isCollapsed;return f&&(t.x=i+u/2-a/2,t.y=o+d/2-l/2,t.text&&(t.text.x=t.text.x+u/2-a/2,t.text.y=t.text.y+d/2-l/2)),t},e.prototype.toggleCollapse=function(t){var n=this,i=this.graphModel,o=!!t;this.isCollapsed=o,this.setProperties({isCollapsed:o}),i.eventCenter.emit("dynamicGroup:collapse",{collapse:o,nodeModel:this}),o?this.collapse():this.expand();var a=sl(sl([],Wa(this.incoming.edges),!1),Wa(this.outgoing.edges),!1),l=Array.from(this.children);un(l,function(u){var d,f,h=n.graphModel.elementsModelMap.get(u);if(h){var g=h.isCollapsed;if(h.isGroup){var y=h;if(y.isCollapsed||y.toggleCollapse(t),!t){var w=(d=n.childrenLastCollapseStateDict)===null||d===void 0?void 0:d.get(u);w!==void 0&&w!==h.isCollapsed&&y.toggleCollapse(w)}}if((f=n.childrenLastCollapseStateDict)===null||f===void 0||f.set(u,!!g),h.visible=!t,h.BaseType===Sn.NODE){var x=h.incoming.edges,b=h.outgoing.edges;a=sl(sl(sl([],Wa(a),!1),Wa(x),!1),Wa(b),!1)}}}),this.collapseEdge(o,a)},e.prototype.collapse=function(){var t=this,n=t.x,i=t.y,o=t.text,a=t.width,l=t.height,u=t.collapsedWidth,d=t.collapsedHeight;this.x=n-a/2+u/2,this.y=i-l/2+d/2,this.text.x=o.x-a/2+u/2,this.text.y=o.y-l/2+d/2,this.expandWidth=a,this.expandHeight=l,this.width=u,this.height=d},e.prototype.expand=function(){var t=this,n=t.x,i=t.y,o=t.text,a=t.expandWidth,l=t.expandHeight,u=t.collapsedWidth,d=t.collapsedHeight;this.width=a,this.height=l,this.x=n+this.width/2-u/2,this.y=i+this.height/2-d/2,this.text.x=o.x+this.width/2-u/2,this.text.y=o.y+this.height/2-d/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var n=this.graphModel.addEdge(t);n.virtual=!0,n.text.editable=!1,n.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,n){var i=this,o=this.graphModel;un(n,function(a,l){var u,d=a.getData(),f=d.targetNodeId,h=d.sourceNodeId,g=nc(nc({},d),{id:"".concat(d.id,"__").concat(l),text:(u=d.text)===null||u===void 0?void 0:u.value});a.virtual&&o.deleteEdgeById(a.id);var y=o.dynamicGroup.getGroupByNodeId(f);y||(y=o.getNodeModelById(f));var w=o.dynamicGroup.getGroupByNodeId(h);w||(w=o.getNodeModelById(h)),t&&a.visible&&(i.children.has(h)||i.id===h?(g.startPoint=void 0,g.sourceNodeId=i.id):(g.endPoint=void 0,g.targetNodeId=i.id),(y.id!==i.id||w.id!==i.id)&&i.createVirtualEdge(g),a.visible=!1),!t&&!a.visible&&(y&&y.isGroup&&y.isCollapsed?(g.targetNodeId=y.id,g.endPoint=void 0,i.createVirtualEdge(g)):w&&w.isGroup&&w.isCollapsed?(g.sourceNodeId=w.id,g.startPoint=void 0,i.createVirtualEdge(g)):a.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var n=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:n,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var n=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:n})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var t=r.prototype.getResizeOutlineStyle.call(this);return t.stroke="none",t},e.prototype.getAnchorStyle=function(){var t=r.prototype.getAnchorStyle.call(this);return t.stroke="transparent",t.fill="transparent",t.hover&&(t.hover.fill="transparent",t.hover.stroke="transparent"),t},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Uf([De],e.prototype,"isCollapsed",void 0),Uf([De],e.prototype,"groupAddable",void 0),Uf([De],e.prototype,"transformWithContainer",void 0),e})(ps);var S0;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(S0||(S0={}));var $F=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ol=function(){return Ol=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ol.apply(this,arguments)},FF=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},zF=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},WF=function(r){$F(e,r);function e(t){var n=r.call(this,t)||this;n.textRef=gc(),n.setHoverOn=function(){var u=n.props.element;u.isDragging||n.state.isHovered||(n.setState({isHovered:!0}),u.setHovered(!0))},n.setHoverOff=function(){var u=n.props.element;n.state.isHovered&&(n.setState({isHovered:!1}),u.setHovered(!1))},n.handleMouseDown=function(u){var d,f=n.props,h=f.label,g=f.graphModel,y=g.editConfigModel.nodeTextDraggable;((d=h.draggable)!==null&&d!==void 0?d:y)&&!n.state.isDragging&&!n.state.isEditing&&n.stepDrag.handleMouseDown(u)},n.handleMouseUp=function(u){n.state.isDragging&&n.stepDrag.handleMouseUp(u)},n.handleDragging=function(u){var d=u.deltaX,f=u.deltaY;n.state.isDragging||n.setState({isDragging:!0});var h=n.props,g=h.label,y=h.graphModel,w=y.transformModel,x=zF(w.fixDeltaXY(d,f),2),b=x[0],_=x[1];n.setElementModelLabelInfo({x:g.x+b,y:g.y+_}),y.eventCenter.emit("label:drag",{data:g.getData(),model:g})},n.handleDragEnd=function(){n.setState({isDragging:!1})},n.handleClick=function(u){var d=n.props,f=d.label,h=d.element,g=d.graphModel;h.setSelected(!n.state.isSelected),n.setState({isSelected:!n.state.isSelected}),n.setElementModelLabelInfo({isSelected:!0}),g.eventCenter.emit("label:click",{data:f.getData(),e:u,model:h})},n.handleDbClick=function(u){var d=n.props,f=d.label,h=d.element,g=d.graphModel;if(g.eventCenter.emit("label:dblclick",{data:f.getData(),e:u,model:h}),!f.editable){h.setSelected(!0);return}if(h.setSelected(),h.setElementState(en.TEXT_EDIT),n.setState({isEditing:!0}),n.textRef.current){n.textRef.current.contentEditable="true",n.textRef.current.focus();var y=document.createRange(),w=window.getSelection();y.selectNodeContents(n.textRef.current),y.collapse(!1),w==null||w.removeAllRanges(),w==null||w.addRange(y)}},n.handleBlur=function(u){var d=n.props,f=d.label,h=d.element,g=d.graphModel.eventCenter;g.emit("label:blur",{e:u,model:h,data:f.getData(),element:n.textRef.current}),n.setState({isDragging:!1,isHovered:!1,isSelected:!1})},n.handleInput=function(u){var d=n.props,f=d.label,h=d.graphModel;h.eventCenter.emit("label:input",{e:u,data:f.getData()})},n.reCalcLabelSize=function(){};var i=t.label,o=t.graphModel,a=o.gridSize,l=o.eventCenter;return n.stepDrag=new li({onDragging:n.handleDragging,onDragEnd:n.handleDragEnd,step:a,eventType:"LABEL",model:i,eventCenter:l}),n.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},n}return e.prototype.setElementModelLabelInfo=function(t){var n=this.props,i=n.label,o=n.element,a=n.graphModel,l=o.properties._label,u=l,d=DC(u,function(g){return g.id===i.id}),f=u[d];u[d]=Ol(Ol({},f),t);var h=a.getElement(o.id);h==null||h.setProperty("_label",u)},e.prototype.componentDidMount=function(){var t=this,n=this.props,i=n.label,o=n.element,a=n.graphModel;a.eventCenter.on("blank:click,node:click,edge:click,label:click",function(l){var u,d,f,h,g=l.data;if(((g==null?void 0:g.type)!=="label"||g.type==="label"&&g.id!==i.id||t.state.isSelected)&&t.setState({isSelected:!1}),((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.state.isEditing){t.setState({isEditing:!1});var y=(d=(u=t.textRef.current)===null||u===void 0?void 0:u.innerText)!==null&&d!==void 0?d:"",w=(h=(f=t.textRef.current)===null||f===void 0?void 0:f.innerHTML)!==null&&h!==void 0?h:"";t.setElementModelLabelInfo({value:y,content:w,isSelected:!1}),o.setElementState(en.DEFAULT)}((g==null?void 0:g.type)!=="label"||g.type=="label"&&g.id!==i.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},e.prototype.componentDidUpdate=function(){},e.prototype.componentWillUnmount=function(){var t=this.props.graphModel;t.eventCenter.off("blank:click,node:click,edge:click")},e.prototype.render=function(){var t,n=this.props,i=n.label,o=n.element,a=n.graphModel,l=this.state,u=l.isDragging,d=l.isHovered,f=l.isSelected,h=l.isEditing,g=a.transformModel,y=g.getTransformStyle().transform,w=i.id,x=i.x,b=i.y,_=i.zIndex,S=i.vertical,k=i.style,O=i.rotate,M=i.content,R=i.labelWidth,T=i.textOverflowMode,I=R??(o.BaseType==="node"?o.width-20:80),$={left:"".concat(x-I/2,"px"),top:"".concat(b-10,"px"),width:"".concat(I,"px"),height:"20px",zIndex:_??1,transform:O?"".concat(y," rotate(").concat(O,"deg)"):"".concat(y," rotate(").concat(S?-.25:0,"turn)")};return Te("div",{id:"element-container-".concat(w),className:ev("lf-label-editor-container"),style:$,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:Te("div",{ref:this.textRef,id:"editor-container-".concat(w),className:ev("lf-label-editor",(t={"lf-label-editor-dragging":u,"lf-label-editor-editing":h,"lf-label-editor-hover":!h&&(d||f)},t["lf-label-editor-".concat(T)]=!h,t)),onInput:this.handleInput,style:Ol({maxWidth:"".concat(I,"px"),boxSizing:"border-box",display:"inline-block",background:h||o.BaseType==="edge"?"#fff":"transparent"},k),dangerouslySetInnerHTML:{__html:M}})})},e=FF([Er],e),e}(Yt),ti=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},UF=No,VF=function(){function r(e,t,n){var i;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=t,this.graphModel=n,this.id=(i=e.id)!==null&&i!==void 0?i:UF(),this.initLabelData(e)}return r.prototype.initLabelData=function(e){on(this,e)},r.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:yi(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},ti([De],r.prototype,"x",void 0),ti([De],r.prototype,"y",void 0),ti([De],r.prototype,"content",void 0),ti([De],r.prototype,"value",void 0),ti([De],r.prototype,"rotate",void 0),ti([De],r.prototype,"style",void 0),ti([De],r.prototype,"zIndex",void 0),ti([De],r.prototype,"vertical",void 0),ti([De],r.prototype,"editable",void 0),ti([De],r.prototype,"draggable",void 0),ti([De],r.prototype,"labelWidth",void 0),ti([De],r.prototype,"textOverflowMode",void 0),r}(),hd={exports:{}},Vf=hd.exports,E0;function qF(){return E0||(E0=1,function(r){/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */"classList"in document.createElement("_")||function(e){if("Element"in e){var t="classList",n="prototype",i=e.Element[n],o=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},l=Array[n].indexOf||function(w){for(var x=0,b=this.length;x<b;x++)if(x in this&&this[x]===w)return x;return-1},u=function(w,x){this.name=w,this.code=DOMException[w],this.message=x},d=function(w,x){if(x==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(x))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return l.call(w,x)},f=function(w){for(var x=a.call(w.getAttribute("class")||""),b=x?x.split(/\s+/):[],_=0,S=b.length;_<S;_++)this.push(b[_]);this._updateClassName=function(){w.setAttribute("class",this.toString())}},h=f[n]=[],g=function(){return new f(this)};if(u[n]=Error[n],h.item=function(w){return this[w]||null},h.contains=function(w){return w+="",d(this,w)!==-1},h.add=function(){var w=arguments,x=0,b=w.length,_,S=!1;do _=w[x]+"",d(this,_)===-1&&(this.push(_),S=!0);while(++x<b);S&&this._updateClassName()},h.remove=function(){var w=arguments,x=0,b=w.length,_,S=!1,k;do for(_=w[x]+"",k=d(this,_);k!==-1;)this.splice(k,1),S=!0,k=d(this,_);while(++x<b);S&&this._updateClassName()},h.toggle=function(w,x){w+="";var b=this.contains(w),_=b?x!==!0&&"remove":x!==!1&&"add";return _&&this[_](w),x===!0||x===!1?x:!b},h.toString=function(){return this.join(" ")},o.defineProperty){var y={get:g,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,y)}catch(w){w.number===-2146823252&&(y.enumerable=!1,o.defineProperty(i,t,y))}}else o[n].__defineGetter__&&i.__defineGetter__(t,g)}}(self);/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */(function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{new Blob;return}catch{}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(i){var o=function(T){return Object.prototype.toString.call(T).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},l=function(I,$,ne){this.data=I,this.size=I.length,this.type=$,this.encoding=ne},u=a.prototype,d=l.prototype,f=i.FileReaderSync,h=function(T){this.code=this[this.name=T]},g="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),y=g.length,w=i.URL||i.webkitURL||i,x=w.createObjectURL,b=w.revokeObjectURL,_=w,S=i.btoa,k=i.atob,O=i.ArrayBuffer,M=i.Uint8Array,R=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(l.fake=d.fake=!0;y--;)h.prototype[g[y]]=y+1;return w.createObjectURL||(_=i.URL=function(T){var I=document.createElementNS("http://www.w3.org/1999/xhtml","a"),$;return I.href=T,"origin"in I||(I.protocol.toLowerCase()==="data:"?I.origin=null:($=T.match(R),I.origin=$&&$[1])),I}),_.createObjectURL=function(T){var I=T.type,$;if(I===null&&(I="application/octet-stream"),T instanceof l)return $="data:"+I,T.encoding==="base64"?$+";base64,"+T.data:T.encoding==="URI"?$+","+decodeURIComponent(T.data):S?$+";base64,"+S(T.data):$+","+encodeURIComponent(T.data);if(x)return x.call(w,T)},_.revokeObjectURL=function(T){T.substring(0,5)!=="data:"&&b&&b.call(w,T)},u.append=function(T){var I=this.data;if(M&&(T instanceof O||T instanceof M)){for(var $="",ne=new M(T),V=0,J=ne.length;V<J;V++)$+=String.fromCharCode(ne[V]);I.push($)}else if(o(T)==="Blob"||o(T)==="File")if(f){var D=new f;I.push(D.readAsBinaryString(T))}else throw new h("NOT_READABLE_ERR");else T instanceof l?T.encoding==="base64"&&k?I.push(k(T.data)):T.encoding==="URI"?I.push(decodeURIComponent(T.data)):T.encoding==="raw"&&I.push(T.data):(typeof T!="string"&&(T+=""),I.push(unescape(encodeURIComponent(T))))},u.getBlob=function(T){return arguments.length||(T=null),new l(this.data.join(""),T,"raw")},u.toString=function(){return"[object BlobBuilder]"},d.slice=function(T,I,$){var ne=arguments.length;return ne<3&&($=null),new l(this.data.slice(T,ne>1?I:this.data.length),$,this.encoding)},d.toString=function(){return"[object Blob]"},d.close=function(){this.size=0,delete this.data},a}(e);e.Blob=function(i,o){var a=o&&o.type||"",l=new t;if(i)for(var u=0,d=i.length;u<d;u++)Uint8Array&&i[u]instanceof Uint8Array?l.append(i[u].buffer):l.append(i[u]);var f=l.getBlob(a);return!f.slice&&f.webkitSlice&&(f.slice=f.webkitSlice),f};var n=Object.getPrototypeOf||function(i){return i.__proto__};e.Blob.prototype=n(new e.Blob)})(typeof self<"u"&&self||typeof window<"u"&&window||Vf.content||Vf),function(e,t){var n=typeof process<"u"&&process&&process.versions&&process.versions.electron;n?e.MediumEditor=t:r.exports=t}(Vf,function(){function e(t,n){return this.init(t,n)}return e.extensions={},function(t){function n(u,d){var f,h=Array.prototype.slice.call(arguments,2);d=d||{};for(var g=0;g<h.length;g++){var y=h[g];if(y)for(f in y)y.hasOwnProperty(f)&&typeof y[f]<"u"&&(u||d.hasOwnProperty(f)===!1)&&(d[f]=y[f])}return d}var i=!1;try{var o=document.createElement("div"),a=document.createTextNode(" ");o.appendChild(a),i=o.contains(a)}catch{}var l={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(u){return!!(l.isMac&&u.metaKey||!l.isMac&&u.ctrlKey)},isKey:function(u,d){var f=l.getKeyCode(u);return Array.isArray(d)===!1?f===d:d.indexOf(f)!==-1},getKeyCode:function(u){var d=u.which;return d===null&&(d=u.charCode!==null?u.charCode:u.keyCode),d},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var d=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,d)},defaults:function(){var d=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,d)},createLink:function(u,d,f,h){var g=u.createElement("a");return l.moveTextRangeIntoElement(d[0],d[d.length-1],g),g.setAttribute("href",f),h&&(h==="_blank"&&g.setAttribute("rel","noopener noreferrer"),g.setAttribute("target",h)),g},findOrCreateMatchingTextNodes:function(u,d,f){for(var h=u.createTreeWalker(d,NodeFilter.SHOW_ALL,null,!1),g=[],y=0,w=!1,x=null,b=null;(x=h.nextNode())!==null;)if(!(x.nodeType>3))if(x.nodeType===3){if(!w&&f.start<y+x.nodeValue.length&&(w=!0,b=l.splitStartNodeIfNeeded(x,f.start,y)),w&&l.splitEndNodeIfNeeded(x,b,f.end,y),w&&y===f.end)break;if(w&&y>f.end+1)throw new Error("PerformLinking overshot the target!");w&&g.push(b||x),y+=x.nodeValue.length,b!==null&&(y+=b.nodeValue.length,h.nextNode()),b=null}else x.tagName.toLowerCase()==="img"&&(!w&&f.start<=y&&(w=!0),w&&g.push(x));return g},splitStartNodeIfNeeded:function(u,d,f){return d!==f?u.splitText(d-f):null},splitEndNodeIfNeeded:function(u,d,f,h){var g,y;g=h+u.nodeValue.length+(d?d.nodeValue.length:0)-1,y=f-h-(d?u.nodeValue.length:0),g>=f&&h!==g&&y!==0&&(d||u).splitText(y)},splitByBlockElements:function(u){if(u.nodeType!==3&&u.nodeType!==1)return[];var d=[],f=e.util.blockContainerElementNames.join(",");if(u.nodeType===3||u.querySelectorAll(f).length===0)return[u];for(var h=0;h<u.childNodes.length;h++){var g=u.childNodes[h];if(g.nodeType===3)d.push(g);else if(g.nodeType===1){var y=g.querySelectorAll(f);y.length===0?d.push(g):d=d.concat(e.util.splitByBlockElements(g))}}return d},findAdjacentTextNodeWithContent:function(d,f,h){var g=!1,y,w=h.createNodeIterator(d,NodeFilter.SHOW_TEXT,null,!1);for(y=w.nextNode();y;){if(y===f)g=!0;else if(g&&y.nodeType===3&&y.nodeValue&&y.nodeValue.trim().length>0)break;y=w.nextNode()}return y},findPreviousSibling:function(u){if(!u||l.isMediumEditorElement(u))return!1;for(var d=u.previousSibling;!d&&!l.isMediumEditorElement(u.parentNode);)u=u.parentNode,d=u.previousSibling;return d},isDescendant:function(d,f,h){if(!d||!f)return!1;if(d===f)return!!h;if(d.nodeType!==1)return!1;if(i||f.nodeType!==3)return d.contains(f);for(var g=f.parentNode;g!==null;){if(g===d)return!0;g=g.parentNode}return!1},isElement:function(d){return!!(d&&d.nodeType===1)},throttle:function(u,d){var f=50,h,g,y,w=null,x=0,b=function(){x=Date.now(),w=null,y=u.apply(h,g),w||(h=g=null)};return!d&&d!==0&&(d=f),function(){var _=Date.now(),S=d-(_-x);return h=this,g=arguments,S<=0||S>d?(w&&(clearTimeout(w),w=null),x=_,y=u.apply(h,g),w||(h=g=null)):w||(w=setTimeout(b,S)),y}},traverseUp:function(u,d){if(!u)return!1;do{if(u.nodeType===1){if(d(u))return u;if(l.isMediumEditorElement(u))return!1}u=u.parentNode}while(u);return!1},htmlEntities:function(u){return String(u).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(u,d){var f,h,g,y,w,x,b,_=!1,S=["insertHTML",!1,d];if(!e.util.isEdge&&u.queryCommandSupported("insertHTML"))try{return u.execCommand.apply(u,S)}catch{}if(f=u.getSelection(),f.rangeCount){if(h=f.getRangeAt(0),b=h.commonAncestorContainer,l.isMediumEditorElement(b)&&!b.firstChild)h.selectNode(b.appendChild(u.createTextNode("")));else if(b.nodeType===3&&h.startOffset===0&&h.endOffset===b.nodeValue.length||b.nodeType!==3&&b.innerHTML===h.toString()){for(;!l.isMediumEditorElement(b)&&b.parentNode&&b.parentNode.childNodes.length===1&&!l.isMediumEditorElement(b.parentNode);)b=b.parentNode;h.selectNode(b)}for(h.deleteContents(),g=u.createElement("div"),g.innerHTML=d,y=u.createDocumentFragment();g.firstChild;)w=g.firstChild,x=y.appendChild(w);h.insertNode(y),x&&(h=h.cloneRange(),h.setStartAfter(x),h.collapse(!0),e.selection.selectRange(u,h)),_=!0}return u.execCommand.callListeners&&u.execCommand.callListeners(S,_),_},execFormatBlock:function(u,d){var f=l.getTopBlockContainer(e.selection.getSelectionStart(u)),h;if(d==="blockquote"){if(f&&(h=Array.prototype.slice.call(f.childNodes),h.some(function(g){return l.isBlockContainer(g)})))return u.execCommand("outdent",!1,null);if(l.isIE)return u.execCommand("indent",!1,d)}if(f&&d===f.nodeName.toLowerCase()&&(d="p"),l.isIE&&(d="<"+d+">"),f&&f.nodeName.toLowerCase()==="blockquote"){if(l.isIE&&d==="<p>")return u.execCommand("outdent",!1,d);if((l.isFF||l.isEdge)&&d==="p")return h=Array.prototype.slice.call(f.childNodes),h.some(function(g){return!l.isBlockContainer(g)})&&u.execCommand("formatBlock",!1,d),u.execCommand("outdent",!1,d)}return u.execCommand("formatBlock",!1,d)},setTargetBlank:function(u,d){var f,h=d||!1;if(u.nodeName.toLowerCase()==="a")u.target="_blank",u.rel="noopener noreferrer";else for(u=u.getElementsByTagName("a"),f=0;f<u.length;f+=1)(h===!1||h===u[f].attributes.href.value)&&(u[f].target="_blank",u[f].rel="noopener noreferrer")},removeTargetBlank:function(u,d){var f;if(u.nodeName.toLowerCase()==="a")u.removeAttribute("target"),u.removeAttribute("rel");else for(u=u.getElementsByTagName("a"),f=0;f<u.length;f+=1)d===u[f].attributes.href.value&&(u[f].removeAttribute("target"),u[f].removeAttribute("rel"))},addClassToAnchors:function(u,d){var f=d.split(" "),h,g;if(u.nodeName.toLowerCase()==="a")for(g=0;g<f.length;g+=1)u.classList.add(f[g]);else{var y=u.getElementsByTagName("a");if(y.length===0){var w=l.getClosestTag(u,"a");u=w?[w]:[]}else u=y;for(h=0;h<u.length;h+=1)for(g=0;g<f.length;g+=1)u[h].classList.add(f[g])}},isListItem:function(u){if(!u)return!1;if(u.nodeName.toLowerCase()==="li")return!0;for(var d=u.parentNode,f=d.nodeName.toLowerCase();f==="li"||!l.isBlockContainer(d)&&f!=="div";){if(f==="li")return!0;if(d=d.parentNode,d)f=d.nodeName.toLowerCase();else return!1}return!1},cleanListDOM:function(u,d){if(d.nodeName.toLowerCase()==="li"){var f=d.parentElement;f.parentElement.nodeName.toLowerCase()==="p"&&(l.unwrap(f.parentElement,u),e.selection.moveCursor(u,d.firstChild,d.firstChild.textContent.length))}},splitOffDOMTree:function(u,d,f){for(var h=d,g=null,y=!f;h!==u;){var w=h.parentNode,x=w.cloneNode(!1),b=y?h:w.firstChild,_;for(g&&(y?x.appendChild(g):_=g),g=x;b;){var S=b.nextSibling;b===h?(b.hasChildNodes()?b=b.cloneNode(!1):b.parentNode.removeChild(b),b.textContent&&g.appendChild(b),b=y?S:null):(b.parentNode.removeChild(b),(b.hasChildNodes()||b.textContent)&&g.appendChild(b),b=S)}_&&g.appendChild(_),h=w}return g},moveTextRangeIntoElement:function(u,d,f){if(!u||!d)return!1;var h=l.findCommonRoot(u,d);if(!h)return!1;if(d===u){var g=u.parentNode,y=u.nextSibling;return g.removeChild(u),f.appendChild(u),y?g.insertBefore(f,y):g.appendChild(f),f.hasChildNodes()}for(var w=[],x,b,_,S=0;S<h.childNodes.length;S++)if(_=h.childNodes[S],!x)l.isDescendant(_,u,!0)&&(x=_);else if(l.isDescendant(_,d,!0)){b=_;break}else w.push(_);var k=b.nextSibling,O=h.ownerDocument.createDocumentFragment();return x===u?(x.parentNode.removeChild(x),O.appendChild(x)):O.appendChild(l.splitOffDOMTree(x,u)),w.forEach(function(M){M.parentNode.removeChild(M),O.appendChild(M)}),b===d?(b.parentNode.removeChild(b),O.appendChild(b)):O.appendChild(l.splitOffDOMTree(b,d,!0)),f.appendChild(O),b.parentNode===h?h.insertBefore(f,b):k?h.insertBefore(f,k):h.appendChild(f),f.hasChildNodes()},depthOfNode:function(u){for(var d=0,f=u;f.parentNode!==null;)f=f.parentNode,d++;return d},findCommonRoot:function(u,d){for(var f=l.depthOfNode(u),h=l.depthOfNode(d),g=u,y=d;f!==h;)f>h?(g=g.parentNode,f-=1):(y=y.parentNode,h-=1);for(;g!==y;)g=g.parentNode,y=y.parentNode;return g},isElementAtBeginningOfBlock:function(u){for(var d,f;!l.isBlockContainer(u)&&!l.isMediumEditorElement(u);){for(f=u;f=f.previousSibling;)if(d=f.nodeType===3?f.nodeValue:f.textContent,d.length>0)return!1;u=u.parentNode}return!0},isMediumEditorElement:function(u){return u&&u.getAttribute&&!!u.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(u){return l.traverseUp(u,function(d){return l.isMediumEditorElement(d)})},isBlockContainer:function(u){return u&&u.nodeType!==3&&l.blockContainerElementNames.indexOf(u.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(u){return l.traverseUp(u,function(d){return l.isBlockContainer(d)||l.isMediumEditorElement(d)})},getTopBlockContainer:function(u){var d=l.isBlockContainer(u)?u:!1;return l.traverseUp(u,function(f){return l.isBlockContainer(f)&&(d=f),!d&&l.isMediumEditorElement(f)?(d=f,!0):!1}),d},getFirstSelectableLeafNode:function(u){for(;u&&u.firstChild;)u=u.firstChild;if(u=l.traverseUp(u,function(f){return l.emptyElementNames.indexOf(f.nodeName.toLowerCase())===-1}),u.nodeName.toLowerCase()==="table"){var d=u.querySelector("th, td");d&&(u=d)}return u},getFirstTextNode:function(u){return l.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),l._getFirstTextNode(u)},_getFirstTextNode:function(u){if(u.nodeType===3)return u;for(var d=0;d<u.childNodes.length;d++){var f=l._getFirstTextNode(u.childNodes[d]);if(f!==null)return f}return null},ensureUrlHasProtocol:function(u){return u.indexOf("://")===-1?"http://"+u:u},warn:function(){t.console!==void 0&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(u,d,f){var h=u+" is deprecated, please use "+d+" instead.";f&&(h+=" Will be removed in "+f),l.warn(h)},deprecatedMethod:function(u,d,f,h){l.deprecated(u,d,h),typeof this[d]=="function"&&this[d].apply(this,f)},cleanupAttrs:function(u,d){d.forEach(function(f){u.removeAttribute(f)})},cleanupTags:function(u,d){d.indexOf(u.nodeName.toLowerCase())!==-1&&u.parentNode.removeChild(u)},unwrapTags:function(u,d){d.indexOf(u.nodeName.toLowerCase())!==-1&&e.util.unwrap(u,document)},getClosestTag:function(u,d){return l.traverseUp(u,function(f){return f.nodeName.toLowerCase()===d.toLowerCase()})},unwrap:function(u,d){for(var f=d.createDocumentFragment(),h=Array.prototype.slice.call(u.childNodes),g=0;g<h.length;g++)f.appendChild(h[g]);f.childNodes.length?u.parentNode.replaceChild(f,u):u.parentNode.removeChild(u)},guid:function(){function u(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u()}};e.util=l}(window),function(){var t=function(n){e.util.extend(this,n)};t.extend=function(n){var i=this,o;n&&n.hasOwnProperty("constructor")?o=n.constructor:o=function(){return i.apply(this,arguments)},e.util.extend(o,i);var a=function(){this.constructor=o};return a.prototype=i.prototype,o.prototype=new a,n&&e.util.extend(o.prototype,n),o},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(n){return this.base.options[n]}},["execAction","on","off","subscribe","trigger"].forEach(function(n){t.prototype[n]=function(){return this.base[n].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(i){return e.util.isBlockContainer(i)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(i,o){var a=o.getSelection(),l,u;return a.rangeCount===0?!1:(l=a.getRangeAt(0),u=l.commonAncestorContainer,e.util.traverseUp(u,i))},getSelectionElement:function(i){return this.findMatchingSelectionParent(function(o){return e.util.isMediumEditorElement(o)},i)},exportSelection:function(i,o){if(!i)return null;var a=null,l=o.getSelection();if(l.rangeCount>0){var u=l.getRangeAt(0),d=u.cloneRange(),f;d.selectNodeContents(i),d.setEnd(u.startContainer,u.startOffset),f=d.toString().length,a={start:f,end:f+u.toString().length},this.doesRangeStartWithImages(u,o)&&(a.startsWithImage=!0);var h=this.getTrailingImageCount(i,a,u.endContainer,u.endOffset);if(h&&(a.trailingImageCount=h),f!==0){var g=this.getIndexRelativeToAdjacentEmptyBlocks(o,i,u.startContainer,u.startOffset);g!==-1&&(a.emptyBlocksIndex=g)}}return a},importSelection:function(i,o,a,l){if(!(!i||!o)){var u=a.createRange();u.setStart(o,0),u.collapse(!0);var d=o,f=[],h=0,g=!1,y=!1,w=0,x=!1,b,_=!1,S=null;for((l||i.startsWithImage||typeof i.emptyBlocksIndex<"u")&&(_=!0);!x&&d;){if(d.nodeType>3){d=f.pop();continue}if(d.nodeType===3&&!y)b=h+d.length,!g&&i.start>=h&&i.start<=b&&(_||i.start<b?(u.setStart(d,i.start-h),g=!0):S=d),g&&i.end>=h&&i.end<=b&&(i.trailingImageCount?y=!0:(u.setEnd(d,i.end-h),x=!0)),h=b;else{if(i.trailingImageCount&&y&&(d.nodeName.toLowerCase()==="img"&&w++,w===i.trailingImageCount)){for(var k=0;d.parentNode.childNodes[k]!==d;)k++;u.setEnd(d.parentNode,k+1),x=!0}if(!x&&d.nodeType===1)for(var O=d.childNodes.length-1;O>=0;)f.push(d.childNodes[O]),O-=1}x||(d=f.pop())}!g&&S&&(u.setStart(S,S.length),u.setEnd(S,S.length)),typeof i.emptyBlocksIndex<"u"&&(u=this.importSelectionMoveCursorPastBlocks(a,o,i.emptyBlocksIndex,u)),l&&(u=this.importSelectionMoveCursorPastAnchor(i,u)),this.selectRange(a,u)}},importSelectionMoveCursorPastAnchor:function(i,o){var a=function(h){return h.nodeName.toLowerCase()==="a"};if(i.start===i.end&&o.startContainer.nodeType===3&&o.startOffset===o.startContainer.nodeValue.length&&e.util.traverseUp(o.startContainer,a)){for(var l=o.startContainer,u=o.startContainer.parentNode;u!==null&&u.nodeName.toLowerCase()!=="a";)u.childNodes[u.childNodes.length-1]!==l?u=null:(l=u,u=u.parentNode);if(u!==null&&u.nodeName.toLowerCase()==="a"){for(var d=null,f=0;d===null&&f<u.parentNode.childNodes.length;f++)u.parentNode.childNodes[f]===u&&(d=f);o.setStart(u.parentNode,d+1),o.collapse(!0)}}return o},importSelectionMoveCursorPastBlocks:function(i,o,a,l){var u=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),d=l.startContainer,f,h,g=0;for(a=a||1,d.nodeType===3&&e.util.isBlockContainer(d.previousSibling)?f=d.previousSibling:f=e.util.getClosestBlockContainer(d);u.nextNode();)if(!h)f===u.currentNode&&(h=u.currentNode);else if(h=u.currentNode,g++,g===a||h.textContent.length>0)break;return h||(h=f),l.setStart(e.util.getFirstSelectableLeafNode(h),0),l},getIndexRelativeToAdjacentEmptyBlocks:function(i,o,a,l){if(a.textContent.length>0&&l>0)return-1;var u=a;if(u.nodeType!==3&&(u=a.childNodes[l]),u){if(!e.util.isElementAtBeginningOfBlock(u))return-1;var d=e.util.findPreviousSibling(u);if(d){if(d.nodeValue)return-1}else return-1}for(var f=e.util.getClosestBlockContainer(a),h=i.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,t,!1),g=0;h.nextNode();){var y=h.currentNode.textContent==="";if((y||g>0)&&(g+=1),h.currentNode===f)return g;y||(g=0)}return g},doesRangeStartWithImages:function(i,o){if(i.startOffset!==0||i.startContainer.nodeType!==1)return!1;if(i.startContainer.nodeName.toLowerCase()==="img")return!0;var a=i.startContainer.querySelector("img");if(!a)return!1;for(var l=o.createTreeWalker(i.startContainer,NodeFilter.SHOW_ALL,null,!1);l.nextNode();){var u=l.currentNode;if(u===a)break;if(u.nodeValue)return!1}return!0},getTrailingImageCount:function(i,o,a,l){if(l===0||a.nodeType!==1||a.nodeName.toLowerCase()!=="img"&&!a.querySelector("img"))return 0;for(var u=a.childNodes[l-1];u.hasChildNodes();)u=u.lastChild;for(var d=i,f=[],h=0,g=!1,y=!1,w=!1,x,b=0;!w&&d;){if(d.nodeType>3){d=f.pop();continue}if(d.nodeType===3&&!y)b=0,x=h+d.length,!g&&o.start>=h&&o.start<=x&&(g=!0),g&&o.end>=h&&o.end<=x&&(y=!0),h=x;else if(d.nodeName.toLowerCase()==="img"&&b++,d===u)w=!0;else if(d.nodeType===1)for(var _=d.childNodes.length-1;_>=0;)f.push(d.childNodes[_]),_-=1;w||(d=f.pop())}return b},selectionContainsContent:function(i){var o=i.getSelection();if(!o||o.isCollapsed||!o.rangeCount)return!1;if(o.toString().trim()!=="")return!0;var a=this.getSelectedParentElement(o.getRangeAt(0));return!!(a&&(a.nodeName.toLowerCase()==="img"||a.nodeType===1&&a.querySelector("img")))},selectionInContentEditableFalse:function(i){var o,a=this.findMatchingSelectionParent(function(l){var u=l&&l.getAttribute("contenteditable");return u==="true"&&(o=!0),l.nodeName!=="#text"&&u==="false"},i);return!o&&a},getSelectionHtml:function(o){var a,l="",u=o.getSelection(),d,f;if(u.rangeCount){for(f=o.createElement("div"),a=0,d=u.rangeCount;a<d;a+=1)f.appendChild(u.getRangeAt(a).cloneContents());l=f.innerHTML}return l},getCaretOffsets:function(o,a){var l,u;return a||(a=window.getSelection().getRangeAt(0)),l=a.cloneRange(),u=a.cloneRange(),l.selectNodeContents(o),l.setEnd(a.endContainer,a.endOffset),u.selectNodeContents(o),u.setStart(a.endContainer,a.endOffset),{left:l.toString().length,right:u.toString().length}},rangeSelectsSingleNode:function(i){var o=i.startContainer;return o===i.endContainer&&o.hasChildNodes()&&i.endOffset===i.startOffset+1},getSelectedParentElement:function(i){return i?this.rangeSelectsSingleNode(i)&&i.startContainer.childNodes[i.startOffset].nodeType!==3?i.startContainer.childNodes[i.startOffset]:i.startContainer.nodeType===3?i.startContainer.parentNode:i.startContainer:null},getSelectedElements:function(i){var o=i.getSelection(),a,l,u;if(!o.rangeCount||o.isCollapsed||!o.getRangeAt(0).commonAncestorContainer)return[];if(a=o.getRangeAt(0),a.commonAncestorContainer.nodeType===3){for(l=[],u=a.commonAncestorContainer;u.parentNode&&u.parentNode.childNodes.length===1;)l.push(u.parentNode),u=u.parentNode;return l}return[].filter.call(a.commonAncestorContainer.getElementsByTagName("*"),function(d){return typeof o.containsNode=="function"?o.containsNode(d,!0):!0})},selectNode:function(i,o){var a=o.createRange();a.selectNodeContents(i),this.selectRange(o,a)},select:function(i,o,a,l,u){var d=i.createRange();return d.setStart(o,a),l?d.setEnd(l,u):d.collapse(!0),this.selectRange(i,d),d},clearSelection:function(i,o){o?i.getSelection().collapseToStart():i.getSelection().collapseToEnd()},moveCursor:function(i,o,a){this.select(i,o,a)},getSelectionRange:function(i){var o=i.getSelection();return o.rangeCount===0?null:o.getRangeAt(0)},selectRange:function(i,o){var a=i.getSelection();a.removeAllRanges(),a.addRange(o)},getSelectionStart:function(i){var o=i.getSelection().anchorNode,a=o&&o.nodeType===3?o.parentNode:o;return a}};e.selection=n}(),function(){function t(i,o){return i?i.some(function(a){if(typeof a.getInteractionElements!="function")return!1;var l=a.getInteractionElements();return l?(Array.isArray(l)||(l=[l]),l.some(function(u){return e.util.isDescendant(u,o,!0)})):!1}):!1}var n=function(i){this.base=i,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(i,o,a,l){var u=this.base.options.contentWindow,d=this.base.options.ownerDocument;i=e.util.isElement(i)||[u,d].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(f){f.addEventListener(o,a,l),this.events.push([f,o,a,l])}).bind(this))},detachDOMEvent:function(i,o,a,l){var u,d,f=this.base.options.contentWindow,h=this.base.options.ownerDocument;i&&(i=e.util.isElement(i)||[f,h].indexOf(i)>-1?[i]:i,Array.prototype.forEach.call(i,(function(g){u=this.indexOfListener(g,o,a,l),u!==-1&&(d=this.events.splice(u,1)[0],d[0].removeEventListener(d[1],d[2],d[3]))}).bind(this)))},indexOfListener:function(i,o,a,l){var u,d,f;for(u=0,d=this.events.length;u<d;u=u+1)if(f=this.events[u],f[0]===i&&f[1]===o&&f[2]===a&&f[3]===l)return u;return-1},detachAllDOMEvents:function(){for(var i=this.events.pop();i;)i[0].removeEventListener(i[1],i[2],i[3]),i=this.events.pop()},detachAllEventsFromElement:function(i){for(var o=this.events.filter(function(d){return d&&d[0].getAttribute&&d[0].getAttribute("medium-editor-index")===i.getAttribute("medium-editor-index")}),a=0,l=o.length;a<l;a++){var u=o[a];this.detachDOMEvent(u[0],u[1],u[2],u[3])}},attachAllEventsToElement:function(i){this.listeners.editableInput&&(this.contentCache[i.getAttribute("medium-editor-index")]=i.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(o){this.attachDOMEvent(i,o.name,o.handler.bind(this))},this)},enableCustomEvent:function(i){this.disabledEvents[i]!==void 0&&delete this.disabledEvents[i]},disableCustomEvent:function(i){this.disabledEvents[i]=!0},attachCustomEvent:function(i,o){this.setupListener(i),this.customEvents[i]||(this.customEvents[i]=[]),this.customEvents[i].push(o)},detachCustomEvent:function(i,o){var a=this.indexOfCustomListener(i,o);a!==-1&&this.customEvents[i].splice(a,1)},indexOfCustomListener:function(i,o){return!this.customEvents[i]||!this.customEvents[i].length?-1:this.customEvents[i].indexOf(o)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(i,o,a){this.customEvents[i]&&!this.disabledEvents[i]&&this.customEvents[i].forEach(function(l){l(o,a)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(i){i.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=(function(i){this.handleDocumentExecCommand(i)}).bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var i=this.options.ownerDocument;if(!(!this.execCommandListener||!i.execCommand.listeners)){var o=i.execCommand.listeners.indexOf(this.execCommandListener);o!==-1&&i.execCommand.listeners.splice(o,1),i.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var i=this.options.ownerDocument;if(!i.execCommand.listeners){var o=function(l,u){i.execCommand.listeners&&i.execCommand.listeners.forEach(function(d){d({command:l[0],value:l[2],args:l,result:u})})},a=function(){var l=i.execCommand.orig.apply(this,arguments);if(!i.execCommand.listeners)return l;var u=Array.prototype.slice.call(arguments);return o(u,l),l};a.orig=i.execCommand,a.listeners=[],a.callListeners=o,i.execCommand=a}},unwrapExecCommand:function(){var i=this.options.ownerDocument;i.execCommand.orig&&(i.execCommand=i.execCommand.orig)},setupListener:function(i){if(!this.listeners[i]){switch(i){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(o){this.contentCache[o.getAttribute("medium-editor-index")]=o.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste);break}this.listeners[i]=!0}},attachToEachElement:function(i,o){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(a){this.attachDOMEvent(a,i,o.bind(this))},this),this.eventsCache.push({name:i,handler:o})},cleanupElement:function(i){var o=i.getAttribute("medium-editor-index");o&&(this.detachAllEventsFromElement(i),this.contentCache&&delete this.contentCache[o])},focusElement:function(i){i.focus(),this.updateFocus(i,{target:i,type:"focus"})},updateFocus:function(i,o){var a=this.base.getFocusedElement(),l;a&&o.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(a,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(l=a),l||this.base.elements.some(function(d){return!l&&e.util.isDescendant(d,i,!0)&&(l=d),!!l},this);var u=!e.util.isDescendant(a,i,!0)&&!t(this.base.extensions,i);l!==a&&(a&&u&&(a.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",o,a)),l&&(l.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",o,l))),u&&this.triggerCustomEvent("externalInteraction",o)},updateInput:function(i,o){if(this.contentCache){var a=i.getAttribute("medium-editor-index"),l=i.innerHTML;l!==this.contentCache[a]&&this.triggerCustomEvent("editableInput",o,i),this.contentCache[a]=l}},handleDocumentSelectionChange:function(i){if(i.currentTarget&&i.currentTarget.activeElement){var o=i.currentTarget.activeElement,a;this.base.elements.some(function(l){return e.util.isDescendant(l,o,!0)?(a=l,!0):!1},this),a&&this.updateInput(a,{target:o,currentTarget:a})}},handleDocumentExecCommand:function(){var i=this.base.getFocusedElement();i&&this.updateInput(i,{target:i,currentTarget:i})},handleBodyClick:function(i){this.updateFocus(i.target,i)},handleBodyFocus:function(i){this.updateFocus(i.target,i)},handleBodyMousedown:function(i){this.lastMousedownTarget=i.target},handleInput:function(i){this.updateInput(i.currentTarget,i)},handleClick:function(i){this.triggerCustomEvent("editableClick",i,i.currentTarget)},handleBlur:function(i){this.triggerCustomEvent("editableBlur",i,i.currentTarget)},handleKeypress:function(i){if(this.triggerCustomEvent("editableKeypress",i,i.currentTarget),this.keypressUpdateInput){var o={target:i.target,currentTarget:i.currentTarget};setTimeout((function(){this.updateInput(o.currentTarget,o)}).bind(this),0)}},handleKeyup:function(i){this.triggerCustomEvent("editableKeyup",i,i.currentTarget)},handleMouseover:function(i){this.triggerCustomEvent("editableMouseover",i,i.currentTarget)},handleDragging:function(i){this.triggerCustomEvent("editableDrag",i,i.currentTarget)},handleDrop:function(i){this.triggerCustomEvent("editableDrop",i,i.currentTarget)},handlePaste:function(i){this.triggerCustomEvent("editablePaste",i,i.currentTarget)},handleKeydown:function(i){if(this.triggerCustomEvent("editableKeydown",i,i.currentTarget),e.util.isKey(i,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.ENTER)||i.ctrlKey&&e.util.isKey(i,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",i,i.currentTarget);if(e.util.isKey(i,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",i,i.currentTarget);if(e.util.isKey(i,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",i,i.currentTarget)}},e.Events=n}(),function(){var t=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(n){t.isBuiltInButton(n)?e.Extension.call(this,this.defaults[n]):e.Extension.call(this,n)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var n=this.document.createElement("button"),i=this.contentDefault,o=this.getAria(),a=this.getEditorOption("buttonLabels");return n.classList.add("medium-editor-action"),n.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(l){n.classList.add(l)}),n.setAttribute("data-action",this.getAction()),o&&(n.setAttribute("title",o),n.setAttribute("aria-label",o)),this.attrs&&Object.keys(this.attrs).forEach(function(l){n.setAttribute(l,this.attrs[l])},this),a==="fontawesome"&&this.contentFA&&(i=this.contentFA),n.innerHTML=i,n},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=this.getAction();i&&this.execAction(i)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var n=null;return this.useQueryState&&(n=this.base.queryCommandState(this.getAction())),n},isAlreadyApplied:function(n){var i=!1,o=this.getTagNames(),a,l;return this.knownState===!1||this.knownState===!0?this.knownState:(o&&o.length>0&&(i=o.indexOf(n.nodeName.toLowerCase())!==-1),!i&&this.style&&(a=this.style.value.split("|"),l=this.window.getComputedStyle(n,null).getPropertyValue(this.style.prop),a.forEach(function(u){this.knownState||(i=l.indexOf(u)!==-1,(i||this.style.prop!=="text-decoration")&&(this.knownState=i))},this)),i)}});t.isBuiltInButton=function(n){return typeof n=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(n)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var n=this.base.getExtensionByName("toolbar");n&&n.hideToolbarDefaultActions()},setToolbarPosition:function(){var n=this.base.getExtensionByName("toolbar");n&&n.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(n){n.preventDefault(),n.stopPropagation();var i=e.selection.getSelectionRange(this.document);return i.startContainer.nodeName.toLowerCase()==="a"||i.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(i),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(n){e.util.isKey(n,e.util.keyCode.K)&&e.util.isMetaCtrlKey(n)&&!n.shiftKey&&this.handleClick(n)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var n=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return n.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),n.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&n.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),n.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(n){var i=this.getInput(),o=this.getAnchorTargetCheckbox(),a=this.getAnchorButtonCheckbox();if(n=n||{value:""},typeof n=="string"&&(n={value:n}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),i.value=n.value,i.focus(),o&&(o.checked=n.target==="_blank"),a){var l=n.buttonClass?n.buttonClass.split(" "):[];a.checked=l.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var n=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox(),o={value:this.getInput().value.trim()};return this.linkValidation&&(o.value=this.checkLinkFormat(o.value)),o.target="_self",n&&n.checked&&(o.target="_blank"),i&&i.checked&&(o.buttonClass=this.customClassOption),o},doFormSave:function(){var n=this.getFormOpts();this.completeFormSave(n)},completeFormSave:function(n){this.base.restoreSelection(),this.execAction(this.action,n),this.base.checkSelection()},ensureEncodedUri:function(n){return n===decodeURI(n)?encodeURI(n):n},ensureEncodedUriComponent:function(n){return n===decodeURIComponent(n)?encodeURIComponent(n):n},ensureEncodedParam:function(n){var i=n.split("="),o=i[0],a=i[1];return o+(a===void 0?"":"="+this.ensureEncodedUriComponent(a))},ensureEncodedQuery:function(n){return n.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(n){var i=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,o=i.test(n),a="",l=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/,u=n.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),d=u[1],f=u[2],h=u[3];if(l.test(n))return"tel:"+n;if(!o){var g=d.split("/")[0];(g.match(/.+(\.|:).+/)||g==="localhost")&&(a="http://")}return a+this.ensureEncodedUri(d)+(f===void 0?"":"?"+this.ensureEncodedQuery(f))+(h===void 0?"":"#"+h)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(n){var i=n.querySelector(".medium-editor-toolbar-close"),o=n.querySelector(".medium-editor-toolbar-save"),a=n.querySelector(".medium-editor-toolbar-input");this.on(n,"click",this.handleFormClick.bind(this)),this.on(a,"keyup",this.handleTextboxKeyup.bind(this)),this.on(i,"click",this.handleCloseClick.bind(this)),this.on(o,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var n=this.document,i=n.createElement("div");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),i.innerHTML=this.getTemplate(),this.attachFormEvents(i),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(n){if(n.keyCode===e.util.keyCode.ENTER){n.preventDefault(),this.doFormSave();return}n.keyCode===e.util.keyCode.ESCAPE&&(n.preventDefault(),this.doFormCancel())},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var n=this.document.createElement("div");return n.id="medium-editor-anchor-preview-"+this.getEditorId(),n.className="medium-editor-anchor-preview",n.innerHTML=this.getTemplate(),this.on(n,"click",this.handleClick.bind(this)),n},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(n){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||n.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=n.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=n.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=n,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(n){n=n||this.activeAnchor;var i=this.window.innerWidth,o=this.anchorPreview.offsetHeight,a=n.getBoundingClientRect(),l=this.diffLeft,u=this.diffTop,d=this.getEditorOption("elementsContainer"),f=["absolute","fixed"].indexOf(window.getComputedStyle(d).getPropertyValue("position"))>-1,h={},g,y,w,x,b;g=this.anchorPreview.offsetWidth/2;var _=this.base.getExtensionByName("toolbar");_&&(l=_.diffLeft,u=_.diffTop),y=l-g,f?(x=d.getBoundingClientRect(),["top","left"].forEach(function(S){h[S]=a[S]-x[S]}),h.width=a.width,h.height=a.height,a=h,i=x.width,b=d.scrollTop):b=this.window.pageYOffset,w=a.left+a.width/2,b+=o+a.top+a.height-u-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(b)+"px",this.anchorPreview.style.right="initial",w<g?(this.anchorPreview.style.left=y+g+"px",this.anchorPreview.style.right="initial"):i-w<g?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=y+w+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(n){var i=this.base.getExtensionByName("anchor"),o=this.activeAnchor;i&&o&&(n.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay((function(){if(o){var a={value:o.attributes.href.value,target:o.getAttribute("target"),buttonClass:o.getAttribute("class")};i.showForm(a),o=null}}).bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(n){var i=e.util.getClosestTag(n.target,"a");if(i!==!1){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(i.outerHTML)||/href=["']#\S+["']/.test(i.outerHTML)))return!0;var o=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&o&&o.isDisplayed&&o.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==i&&this.detachPreviewHandlers(),this.anchorToPreview=i,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay((function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}).bind(this))}},handlePreviewMouseover:function(){this.lastOver=new Date().getTime(),this.hovering=!0},handlePreviewMouseout:function(n){(!n.relatedTarget||!/anchor-preview/.test(n.relatedTarget.className))&&(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;var n=new Date().getTime()-this.lastOver;n>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=new Date().getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){var t,n,i,o,a;t=[" ","	",`
`,"\r"," "," "," "," "," ","\u2028","\u2029"],n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+n+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",o=new RegExp("^("+n+")$","i"),a=new RegExp(i,"gi");function l(d){return!e.util.getClosestTag(d,"a")}var u=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var d=0,f=0;f<this.window._mediumEditors.length;f++){var h=this.window._mediumEditors[f];h!==null&&h.getExtensionByName("autoLink")!==void 0&&d++}return d===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(d,f){this.performLinking(f)},onKeypress:function(d){this.disableEventHandling||e.util.isKey(d,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout((function(){try{var f=this.base.exportSelection();this.performLinking(d.target)&&this.base.importSelection(f,!0)}catch(h){window.console&&window.console.error("Failed to perform linking",h),this.disableEventHandling=!0}}).bind(this),0))},performLinking:function(d){var f=e.util.splitByBlockElements(d),h=!1;f.length===0&&(f=[d]);for(var g=0;g<f.length;g++)h=this.removeObsoleteAutoLinkSpans(f[g])||h,h=this.performLinkingWithinElement(f[g])||h;return this.base.events.updateInput(d,{target:d,currentTarget:d}),h},removeObsoleteAutoLinkSpans:function(d){if(!d||d.nodeType===3)return!1;for(var f=d.querySelectorAll('span[data-auto-link="true"]'),h=!1,g=0;g<f.length;g++){var y=f[g].textContent;if(y.indexOf("://")===-1&&(y=e.util.ensureUrlHasProtocol(y)),f[g].getAttribute("data-href")!==y&&l(f[g])){h=!0;var w=y.replace(/\s+$/,"");if(f[g].getAttribute("data-href")===w){var x=y.length-w.length,b=e.util.splitOffDOMTree(f[g],this.splitTextBeforeEnd(f[g],x));f[g].parentNode.insertBefore(b,f[g].nextSibling)}else e.util.unwrap(f[g],this.document)}}return h},splitTextBeforeEnd:function(d,f){for(var h=this.document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null,!1),g=!0;g;)g=h.lastChild()!==null;for(var y,w,x;f>0&&x!==null;)y=h.currentNode,w=y.nodeValue,w.length>f?(x=y.splitText(w.length-f),f=0):(x=h.previousNode(),f-=w.length);return x},performLinkingWithinElement:function(d){for(var f=this.findLinkableText(d),h=!1,g=0;g<f.length;g++){var y=e.util.findOrCreateMatchingTextNodes(this.document,d,f[g]);this.shouldNotLink(y)||this.createAutoLink(y,f[g].href)}return h},shouldNotLink:function(d){for(var f=!1,h=0;h<d.length&&f===!1;h++)f=!!e.util.traverseUp(d[h],function(g){return g.nodeName.toLowerCase()==="a"||g.getAttribute&&g.getAttribute("data-auto-link")==="true"});return f},findLinkableText:function(d){for(var f=d.textContent,h=null,g=[];(h=a.exec(f))!==null;){var y=!0,w=h.index+h[0].length;y=(h.index===0||t.indexOf(f[h.index-1])!==-1)&&(w===f.length||t.indexOf(f[w])!==-1),y=y&&(h[0].indexOf("/")!==-1||o.test(h[0].split(".").pop().split("?").shift())),y&&g.push({href:h[0],start:h.index,end:w})}return g},createAutoLink:function(d,f){f=e.util.ensureUrlHasProtocol(f);var h=e.util.createLink(this.document,d,f,this.getEditorOption("targetBlank")?"_blank":null),g=this.document.createElement("span");for(g.setAttribute("data-auto-link","true"),g.setAttribute("data-href",f),h.insertBefore(g,h.firstChild);h.childNodes.length>1;)g.appendChild(h.childNodes[1])}});e.extensions.autoLink=u}(),function(){var t="medium-editor-dragover";function n(o){var a=e.util.getContainerEditorElement(o),l=Array.prototype.slice.call(a.parentElement.querySelectorAll("."+t));l.forEach(function(u){u.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(o){o.preventDefault(),o.dataTransfer.dropEffect="copy";var a=o.target.classList?o.target:o.target.parentElement;n(a),o.type==="dragover"&&a.classList.add(t)},handleDrop:function(o){o.preventDefault(),o.stopPropagation(),this.base.selectElement(o.target);var a=this.base.exportSelection();a.start=a.end,this.base.importSelection(a),o.dataTransfer.files&&Array.prototype.slice.call(o.dataTransfer.files).forEach(function(l){this.isAllowedFile(l)&&l.type.match("image")&&this.insertImageFile(l)},this),n(o.target)},isAllowedFile:function(o){return this.allowedTypes.some(function(a){return!!o.type.match(a)})},insertImageFile:function(o){if(typeof FileReader=="function"){var a=new FileReader;a.readAsDataURL(o),a.addEventListener("load",(function(l){var u=this.document.createElement("img");u.src=l.target.result,e.util.insertHTMLCommand(this.document,u.outerHTML)}).bind(this))}}});e.extensions.fileDragging=i}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(n){var i=n.key.charCodeAt(0);this.keys[i]||(this.keys[i]=[]),this.keys[i].push(n)},this)},handleKeydown:function(n){var i=e.util.getKeyCode(n);if(this.keys[i]){var o=e.util.isMetaCtrlKey(n),a=!!n.shiftKey,l=!!n.altKey;this.keys[i].forEach(function(u){u.meta===o&&u.shift===a&&(u.alt===l||u.alt===void 0)&&(n.preventDefault(),n.stopPropagation(),typeof u.command=="function"?u.command.apply(this):u.command!==!1&&this.execAction(u.command))},this)}}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontName")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(n){var i=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("select"),a=n.createElement("a"),l=n.createElement("a"),u;i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this));for(var d=0;d<this.fonts.length;d++)u=n.createElement("option"),u.innerHTML=this.fonts[d],u.value=this.fonts[d],o.appendChild(u);return o.className="medium-editor-toolbar-select",i.appendChild(o),this.on(o,"change",this.handleFontChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),a.setAttribute("href","#"),a.className="medium-editor-toobar-close",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(a),this.on(a,"click",this.handleCloseClick.bind(this)),i},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("face")&&n.removeAttribute("face")})},handleFontChange:function(){var n=this.getSelect().value;n===""?this.clearFontName():this.execAction("fontName",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(n){if(n.preventDefault(),n.stopPropagation(),!this.isDisplayed()){var i=this.document.queryCommandValue("fontSize")+"";this.showForm(i)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(n){var i=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),i.value=n||"",i.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var n=this.document,i=n.createElement("div"),o=n.createElement("input"),a=n.createElement("a"),l=n.createElement("a");return i.className="medium-editor-toolbar-form",i.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(i,"click",this.handleFormClick.bind(this)),o.setAttribute("type","range"),o.setAttribute("min","1"),o.setAttribute("max","7"),o.className="medium-editor-toolbar-input",i.appendChild(o),this.on(o,"change",this.handleSliderChange.bind(this)),l.setAttribute("href","#"),l.className="medium-editor-toobar-save",l.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",i.appendChild(l),this.on(l,"click",this.handleSaveClick.bind(this),!0),a.setAttribute("href","#"),a.className="medium-editor-toobar-close",a.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",i.appendChild(a),this.on(a,"click",this.handleCloseClick.bind(this)),i},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(n){n.nodeName.toLowerCase()==="font"&&n.hasAttribute("size")&&n.removeAttribute("size")})},handleSliderChange:function(){var n=this.getInput().value;n==="4"?this.clearFontSize():this.execAction("fontSize",{value:n})},handleFormClick:function(n){n.stopPropagation()},handleSaveClick:function(n){n.preventDefault(),this.doFormSave()},handleCloseClick:function(n){n.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){var t="%ME_PASTEBIN%",n=null,i=null,o=function(d){d.stopPropagation()};function a(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function l(d,f,h){var g=d.clipboardData||f.clipboardData||h.dataTransfer,y={};if(!g)return y;if(g.getData){var w=g.getData("Text");w&&w.length>0&&(y["text/plain"]=w)}if(g.types)for(var x=0;x<g.types.length;x++){var b=g.types[x];y[b]=g.getData(b)}return y}var u=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(d){this.on(d,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(d,f){this.on(f,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(d,f){if(!d.defaultPrevented){var h=l(d,this.window,this.document),g=h["text/html"],y=h["text/plain"];this.window.clipboardData&&d.clipboardData===void 0&&!g&&(g=y),(g||y)&&(d.preventDefault(),this.doPaste(g,y,f))}},doPaste:function(d,f,h){var g,y="",w;if(this.cleanPastedHTML&&d)return this.cleanPaste(d);if(f){if(this.getEditorOption("disableReturn")||h&&h.getAttribute("data-disable-return"))y=e.util.htmlEntities(f);else if(g=f.split(/[\r\n]+/g),g.length>1)for(w=0;w<g.length;w+=1)g[w]!==""&&(y+="<p>"+e.util.htmlEntities(g[w])+"</p>");else y=e.util.htmlEntities(g[0]);e.util.insertHTMLCommand(this.document,y)}},handlePasteBinPaste:function(d){if(d.defaultPrevented){this.removePasteBin();return}var f=l(d,this.window,this.document),h=f["text/html"],g=f["text/plain"],y=i;if(!this.cleanPastedHTML||h){d.preventDefault(),this.removePasteBin(),this.doPaste(h,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y);return}setTimeout((function(){this.cleanPastedHTML&&(h=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(h,g,y),this.trigger("editablePaste",{currentTarget:y,target:y},y)}).bind(this),0)},handleKeydown:function(d,f){e.util.isKey(d,e.util.keyCode.V)&&e.util.isMetaCtrlKey(d)&&(d.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(f))},createPasteBin:function(d){var f,h=e.selection.getSelectionRange(this.document),g=this.window.pageYOffset;i=d,h&&(f=h.getClientRects(),f.length?g+=f[0].top:h.startContainer.getBoundingClientRect!==void 0?g+=h.startContainer.getBoundingClientRect().top:g+=h.getBoundingClientRect().top),n=h;var y=this.document.createElement("div");y.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),y.setAttribute("style","border: 1px red solid; position: absolute; top: "+g+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),y.setAttribute("contentEditable",!0),y.innerHTML=t,this.document.body.appendChild(y),this.on(y,"focus",o),this.on(y,"focusin",o),this.on(y,"focusout",o),y.focus(),e.selection.selectNode(y,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(y,"paste",this.boundHandlePaste)},removePasteBin:function(){n!==null&&(e.selection.selectRange(this.document,n),n=null),i!==null&&(i=null);var d=this.getPasteBin();d&&d&&(this.off(d,"focus",o),this.off(d,"focusin",o),this.off(d,"focusout",o),this.off(d,"paste",this.boundHandlePaste),d.parentElement.removeChild(d))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var d=this.getPasteBin();if(!d||d.firstChild&&d.firstChild.id==="mcepastebin")return!1;var f=d.innerHTML;return!f||f===t?!1:f},cleanPaste:function(d){var f,h,g,y,w=/<p|<br|<div/.test(d),x=[].concat(this.preCleanReplacements||[],a(),this.cleanReplacements||[]);for(f=0;f<x.length;f+=1)d=d.replace(x[f][0],x[f][1]);if(!w)return this.pasteHTML(d);for(g=this.document.createElement("div"),g.innerHTML="<p>"+d.split("<br><br>").join("</p><p>")+"</p>",h=g.querySelectorAll("a,p,div,br"),f=0;f<h.length;f+=1)switch(y=h[f],y.innerHTML=y.innerHTML.replace(/\n/gi," "),y.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(y);break;case"br":this.filterLineBreak(y);break}this.pasteHTML(g.innerHTML)},pasteHTML:function(d,f){f=e.util.defaults({},f,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var h,g,y,w,x=this.document.createDocumentFragment();for(x.appendChild(this.document.createElement("body")),w=x.querySelector("body"),w.innerHTML=d,this.cleanupSpans(w),h=w.querySelectorAll("*"),y=0;y<h.length;y+=1)g=h[y],g.nodeName.toLowerCase()==="a"&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(g),e.util.cleanupAttrs(g,f.cleanAttrs),e.util.cleanupTags(g,f.cleanTags),e.util.unwrapTags(g,f.unwrapTags);e.util.insertHTMLCommand(this.document,w.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(d){return d&&(d.nodeName.toLowerCase()==="p"||d.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(d){/^\s*$/.test(d.textContent)&&d.parentNode&&d.parentNode.removeChild(d)},filterLineBreak:function(d){this.isCommonBlock(d.previousElementSibling)?this.removeWithParent(d):this.isCommonBlock(d.parentNode)&&(d.parentNode.firstChild===d||d.parentNode.lastChild===d)?this.removeWithParent(d):d.parentNode&&d.parentNode.childElementCount===1&&d.parentNode.textContent===""&&this.removeWithParent(d)},removeWithParent:function(d){d&&d.parentNode&&(d.parentNode.parentNode&&d.parentNode.childElementCount===1?d.parentNode.parentNode.removeChild(d.parentNode):d.parentNode.removeChild(d))},cleanupSpans:function(d){var f,h,g,y=d.querySelectorAll(".replace-with"),w=function(x){return x&&x.nodeName!=="#text"&&x.getAttribute("contenteditable")==="false"};for(f=0;f<y.length;f+=1)h=y[f],g=this.document.createElement(h.classList.contains("bold")?"b":"i"),h.classList.contains("bold")&&h.classList.contains("italic")?g.innerHTML="<i>"+h.innerHTML+"</i>":g.innerHTML=h.innerHTML,h.parentNode.replaceChild(g,h);for(y=d.querySelectorAll("span"),f=0;f<y.length;f+=1){if(h=y[f],e.util.traverseUp(h,w))return!1;e.util.unwrap(h,this.document)}}});e.extensions.paste=u}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(n,i){this.initElement(i)},initElement:function(n){n.getAttribute("data-placeholder")||n.setAttribute("data-placeholder",this.text),this.updatePlaceholder(n)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(n,i){this.cleanupElement(i)},cleanupElement:function(n){n.getAttribute("data-placeholder")===this.text&&n.removeAttribute("data-placeholder")},showPlaceholder:function(n){n&&(e.util.isFF&&n.childNodes.length===0?(n.classList.add("medium-editor-placeholder-relative"),n.classList.remove("medium-editor-placeholder")):(n.classList.add("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(n){n&&(n.classList.remove("medium-editor-placeholder"),n.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(n,i){if(n.querySelector("img, blockquote, ul, ol, table")||n.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(n);i||this.showPlaceholder(n)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(n,i){var o=this.hideOnClick&&i===this.base.getFocusedElement();this.updatePlaceholder(i,o)},handleFocus:function(n,i){this.hidePlaceholder(i)},handleBlur:function(n,i){this.updatePlaceholder(i)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(n,i){return this.base.extensions.forEach(function(o){if(o!==this)return n.apply(i||this,arguments)},this)},createToolbar:function(){var n=this.document.createElement("div");return n.id="medium-editor-toolbar-"+this.getEditorId(),n.className="medium-editor-toolbar",this.static?n.className+=" static-toolbar":this.relativeContainer?n.className+=" medium-editor-relative-toolbar":n.className+=" medium-editor-stalker-toolbar",n.appendChild(this.createToolbarButtons()),this.forEachExtension(function(i){i.hasForm&&n.appendChild(i.getForm())}),this.attachEventHandlers(),n},createToolbarButtons:function(){var n=this.document.createElement("ul"),i,o,a,l,u,d;return n.id="medium-editor-toolbar-actions"+this.getEditorId(),n.className="medium-editor-toolbar-actions",n.style.display="block",this.buttons.forEach(function(f){typeof f=="string"?(u=f,d=null):(u=f.name,d=f),l=this.base.addBuiltInExtension(u,d),l&&typeof l.getButton=="function"&&(o=l.getButton(this.base),i=this.document.createElement("li"),e.util.isElement(o)?i.appendChild(o):i.innerHTML=o,n.appendChild(i))},this),a=n.querySelectorAll("button"),a.length>0&&(a[0].classList.add(this.firstButtonClass),a[a.length-1].classList.add(this.lastButtonClass)),n},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle((function(){this.base.isActive&&this.positionToolbarIfShown()}).bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(n){if(n&&n.target&&e.util.isDescendant(this.getToolbarElement(),n.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout((function(){this.checkState()}).bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout((function(){this.hideToolbar()}).bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay((function(){this.showToolbar()}).bind(this))},hideExtensionForms:function(){this.forEachExtension(function(n){n.hasForm&&n.isDisplayed()&&n.hideForm()})},multipleBlockElementsSelected:function(){var n=/<[^\/>][^>]*><\/[^>]+>/gim,i=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),o=e.selection.getSelectionHtml(this.document).replace(n,""),a=o.match(i);return!!a&&a.length>1},modifySelection:function(){var n=this.window.getSelection(),i=n.getRangeAt(0);if(this.standardizeSelectionStart&&i.startContainer.nodeValue&&i.startOffset===i.startContainer.nodeValue.length){var o=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),i.startContainer,this.document);if(o){for(var a=0;o.nodeValue.substr(a,1).trim().length===0;)a=a+1;i=e.selection.select(this.document,o,a,i.endContainer,i.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var n=e.selection.getSelectionElement(this.window);if(!n||this.getEditorElements().indexOf(n)===-1||n.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(n){typeof n.isActive=="function"&&typeof n.setInactive=="function"&&n.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var n=[],i=null,o=e.selection.getSelectionRange(this.document),a,l=function(u){typeof u.checkState=="function"?u.checkState(a):typeof u.isActive=="function"&&typeof u.isAlreadyApplied=="function"&&typeof u.setActive=="function"&&!u.isActive()&&u.isAlreadyApplied(a)&&u.setActive()};if(o&&(this.forEachExtension(function(u){if(typeof u.queryCommandState=="function"&&(i=u.queryCommandState(),i!==null)){i&&typeof u.setActive=="function"&&u.setActive();return}n.push(u)}),a=e.selection.getSelectedParentElement(o),!!this.getEditorElements().some(function(u){return e.util.isDescendant(u,a,!0)})))for(;a&&(n.forEach(l),!e.util.isMediumEditorElement(a));)a=a.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var n=this.base.getFocusedElement(),i=this.window.getSelection();if(!n)return this;(this.static||!i.isCollapsed)&&(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(n):this.positionToolbar(i)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(n){this.getToolbarElement().style.left="0";var i=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,o=this.window.innerWidth,a=this.getToolbarElement(),l=n.getBoundingClientRect(),u=l.top+i,d=l.left+l.width/2,f=a.offsetHeight,h=a.offsetWidth,g=h/2,y;switch(this.sticky?i>u+n.offsetHeight-f-this.stickyTopOffset?(a.style.top=u+n.offsetHeight-f+"px",a.classList.remove("medium-editor-sticky-toolbar")):i>u-f-this.stickyTopOffset?(a.classList.add("medium-editor-sticky-toolbar"),a.style.top=this.stickyTopOffset+"px"):(a.classList.remove("medium-editor-sticky-toolbar"),a.style.top=u-f+"px"):a.style.top=u-f+"px",this.align){case"left":y=l.left;break;case"right":y=l.right-h;break;case"center":y=d-g;break}y<0?y=0:y+h>o&&(y=o-Math.ceil(h)-1),a.style.left=y+"px"},positionToolbar:function(n){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var i=n.getRangeAt(0),o=i.getBoundingClientRect();(!o||o.height===0&&o.width===0&&i.startContainer===i.endContainer)&&(i.startContainer.nodeType===1&&i.startContainer.querySelector("img")?o=i.startContainer.querySelector("img").getBoundingClientRect():o=i.startContainer.getBoundingClientRect());var a=this.window.innerWidth,l=this.getToolbarElement(),u=l.offsetHeight,d=l.offsetWidth,f=d/2,h=50,g=this.diffLeft-f,y=this.getEditorOption("elementsContainer"),w=["absolute","fixed"].indexOf(window.getComputedStyle(y).getPropertyValue("position"))>-1,x={},b={},_,S;w?(S=y.getBoundingClientRect(),["top","left"].forEach(function(k){b[k]=o[k]-S[k]}),b.width=o.width,b.height=o.height,o=b,a=S.width,x.top=y.scrollTop):x.top=this.window.pageYOffset,_=o.left+o.width/2,x.top+=o.top-u,o.top<h?(l.classList.add("medium-toolbar-arrow-over"),l.classList.remove("medium-toolbar-arrow-under"),x.top+=h+o.height-this.diffTop):(l.classList.add("medium-toolbar-arrow-under"),l.classList.remove("medium-toolbar-arrow-over"),x.top+=this.diffTop),_<f?(x.left=g+f,x.right="initial"):a-_<f?(x.left="auto",x.right=0):(x.left=g+_,x.right="initial"),["top","left","right"].forEach(function(k){l.style[k]=x[k]+(isNaN(x[k])?"":"px")})}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(n){var i="medium-editor-dragover";n.preventDefault(),n.dataTransfer.dropEffect="copy",n.type==="dragover"?n.target.classList.add(i):n.type==="dragleave"&&n.target.classList.remove(i)},handleDrop:function(n){var i="medium-editor-dragover",o;n.preventDefault(),n.stopPropagation(),n.dataTransfer.files&&(o=Array.prototype.slice.call(n.dataTransfer.files,0),o.some((function(a){if(a.type.match("image")){var l,u;l=new FileReader,l.readAsDataURL(a),u="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+u+'" />'),l.onload=(function(){var d=this.document.getElementById(u);d&&(d.removeAttribute("id"),d.removeAttribute("class"),d.src=l.result)}).bind(this)}}).bind(this))),n.target.classList.remove(i)}});e.extensions.imageDragging=t}(),function(){function t(D){var U=e.selection.getSelectionStart(this.options.ownerDocument),j=U.textContent,fe=e.selection.getCaretOffsets(U);(j[fe.left-1]===void 0||j[fe.left-1].trim()===""||j[fe.left]!==void 0&&j[fe.left].trim()==="")&&D.preventDefault()}function n(D,U){if(this.options.disableReturn||U.getAttribute("data-disable-return"))D.preventDefault();else if(this.options.disableDoubleReturn||U.getAttribute("data-disable-double-return")){var j=e.selection.getSelectionStart(this.options.ownerDocument);(j&&j.textContent.trim()===""&&j.nodeName.toLowerCase()!=="li"||j.previousElementSibling&&j.previousElementSibling.nodeName.toLowerCase()!=="br"&&j.previousElementSibling.textContent.trim()==="")&&D.preventDefault()}}function i(D){var U=e.selection.getSelectionStart(this.options.ownerDocument),j=U&&U.nodeName.toLowerCase();j==="pre"&&(D.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(U)&&(D.preventDefault(),D.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function o(D){var U,j=e.selection.getSelectionStart(this.options.ownerDocument),fe=j.nodeName.toLowerCase(),Ee=/^(\s+|<br\/?>)?$/i,_e=/h\d/i;e.util.isKey(D,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&j.previousElementSibling&&_e.test(fe)&&e.selection.getCaretOffsets(j).left===0?e.util.isKey(D,e.util.keyCode.BACKSPACE)&&Ee.test(j.previousElementSibling.innerHTML)?(j.previousElementSibling.parentNode.removeChild(j.previousElementSibling),D.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(D,e.util.keyCode.ENTER)&&(U=this.options.ownerDocument.createElement("p"),U.innerHTML="<br>",j.previousElementSibling.parentNode.insertBefore(U,j),D.preventDefault()):e.util.isKey(D,e.util.keyCode.DELETE)&&j.nextElementSibling&&j.previousElementSibling&&!_e.test(fe)&&Ee.test(j.innerHTML)&&_e.test(j.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,j.nextElementSibling),j.previousElementSibling.parentNode.removeChild(j),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&fe==="li"&&Ee.test(j.innerHTML)&&!j.previousElementSibling&&!j.parentElement.previousElementSibling&&j.nextElementSibling&&j.nextElementSibling.nodeName.toLowerCase()==="li"?(U=this.options.ownerDocument.createElement("p"),U.innerHTML="<br>",j.parentElement.parentElement.insertBefore(U,j.parentElement),e.selection.moveCursor(this.options.ownerDocument,U),j.parentElement.removeChild(j),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(j,"blockquote")!==!1&&e.selection.getCaretOffsets(j).left===0?(D.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(D,e.util.keyCode.ENTER)&&e.util.getClosestTag(j,"blockquote")!==!1&&e.selection.getCaretOffsets(j).right===0?(U=this.options.ownerDocument.createElement("p"),U.innerHTML="<br>",j.parentElement.insertBefore(U,j.nextSibling),e.selection.moveCursor(this.options.ownerDocument,U),D.preventDefault()):e.util.isKey(D,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(j.parentElement)&&!j.previousElementSibling&&j.nextElementSibling&&Ee.test(j.innerHTML)&&(D.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,j.nextSibling),j.parentElement.removeChild(j))}function a(D){var U=e.selection.getSelectionStart(this.options.ownerDocument),j;U&&(e.util.isMediumEditorElement(U)&&U.children.length===0&&!e.util.isBlockContainer(U)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(D,e.util.keyCode.ENTER)&&!e.util.isListItem(U)&&!e.util.isBlockContainer(U)&&(j=U.nodeName.toLowerCase(),j==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!D.shiftKey&&!D.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function l(D,U){var j=U.parentNode.querySelector('textarea[medium-editor-textarea-id="'+U.getAttribute("medium-editor-textarea-id")+'"]');j&&(j.value=U.innerHTML.trim())}function u(D){D._mediumEditors||(D._mediumEditors=[null]),this.id||(this.id=D._mediumEditors.length),D._mediumEditors[this.id]=this}function d(D){!D._mediumEditors||!D._mediumEditors[this.id]||(D._mediumEditors[this.id]=null)}function f(D,U,j){var fe=[];if(D||(D=[]),typeof D=="string"&&(D=U.querySelectorAll(D)),e.util.isElement(D)&&(D=[D]),j)for(var Ee=0;Ee<D.length;Ee++){var _e=D[Ee];e.util.isElement(_e)&&!_e.getAttribute("data-medium-editor-element")&&!_e.getAttribute("medium-editor-textarea-id")&&fe.push(_e)}else fe=Array.prototype.slice.apply(D);return fe}function h(D){var U=D.parentNode.querySelector('textarea[medium-editor-textarea-id="'+D.getAttribute("medium-editor-textarea-id")+'"]');U&&(U.classList.remove("medium-editor-hidden"),U.removeAttribute("medium-editor-textarea-id")),D.parentNode&&D.parentNode.removeChild(D)}function g(D,U){return Object.keys(U).forEach(function(j){D[j]===void 0&&(D[j]=U[j])}),D}function y(D,U,j){var fe={window:j.options.contentWindow,document:j.options.ownerDocument,base:j};return D=g(D,fe),typeof D.init=="function"&&D.init(),D.name||(D.name=U),D}function w(){return this.elements.every(function(D){return!!D.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function x(){return w.call(this)?this.options.anchorPreview!==!1:!1}function b(){return this.options.placeholder!==!1}function _(){return this.options.autoLink!==!1}function S(){return this.options.imageDragging!==!1}function k(){return this.options.keyboardCommands!==!1}function O(){return!this.options.extensions.imageDragging}function M(D){for(var U=this.options.ownerDocument.createElement("div"),j=Date.now(),fe="medium-editor-"+j,Ee=D.attributes;this.options.ownerDocument.getElementById(fe);)j++,fe="medium-editor-"+j;U.className=D.className,U.id=fe,U.innerHTML=D.value,D.setAttribute("medium-editor-textarea-id",fe);for(var _e=0,rt=Ee.length;_e<rt;_e++)U.hasAttribute(Ee[_e].nodeName)||U.setAttribute(Ee[_e].nodeName,Ee[_e].value);return D.form&&this.on(D.form,"reset",(function(Me){Me.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(fe))}).bind(this)),D.classList.add("medium-editor-hidden"),D.parentNode.insertBefore(U,D),U}function R(D,U){if(!D.getAttribute("data-medium-editor-element")){D.nodeName.toLowerCase()==="textarea"&&(D=M.call(this,D),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=l.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!D.getAttribute("data-disable-editing")&&(D.setAttribute("contentEditable",!0),D.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(D.getAttribute("data-disable-return")||D.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!D.getAttribute("data-disable-return")&&this.on(D,"keyup",a.bind(this));var j=e.util.guid();D.setAttribute("data-medium-editor-element",!0),D.classList.add("medium-editor-element"),D.setAttribute("role","textbox"),D.setAttribute("aria-multiline",!0),D.setAttribute("data-medium-editor-editor-index",U),D.setAttribute("medium-editor-index",j),J[j]=D.innerHTML,this.events.attachAllEventsToElement(D)}return D}function T(){this.subscribe("editableKeydownTab",i.bind(this)),this.subscribe("editableKeydownDelete",o.bind(this)),this.subscribe("editableKeydownEnter",o.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function I(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(Ee){Ee!=="toolbar"&&this.options.extensions[Ee]&&this.extensions.push(y(this.options.extensions[Ee],Ee,this))},this),O.call(this)){var D=this.options.fileDragging;D||(D={},S.call(this)||(D.allowedTypes=[])),this.addBuiltInExtension("fileDragging",D)}var U={paste:!0,"anchor-preview":x.call(this),autoLink:_.call(this),keyboardCommands:k.call(this),placeholder:b.call(this)};Object.keys(U).forEach(function(Ee){U[Ee]&&this.addBuiltInExtension(Ee)},this);var j=this.options.extensions.toolbar;if(!j&&w.call(this)){var fe=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});j=new e.extensions.toolbar(fe)}j&&this.extensions.push(y(j,"toolbar",this))}function $(D,U){var j=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return U&&j.forEach(function(fe){U.hasOwnProperty(fe[0])&&U[fe[0]]!==void 0&&e.util.deprecated(fe[0],fe[1],"v6.0.0")}),e.util.defaults({},U,D)}function ne(D,U){var j=/^append-(.+)$/gi,fe=/justify([A-Za-z]*)$/g,Ee,_e;if(Ee=j.exec(D),Ee)return e.util.execFormatBlock(this.options.ownerDocument,Ee[1]);if(D==="fontSize")return U.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),_e=U.value||U.size,this.options.ownerDocument.execCommand("fontSize",!1,_e);if(D==="fontName")return U.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),_e=U.value||U.name,this.options.ownerDocument.execCommand("fontName",!1,_e);if(D==="createLink")return this.createLink(U);if(D==="image"){var rt=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,rt)}if(D==="html"){var Me=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,Me)}if(fe.exec(D)){var ve=this.options.ownerDocument.execCommand(D,!1,null),Ve=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return Ve&&V.call(this,e.util.getTopBlockContainer(Ve)),ve}return _e=U&&U.value,this.options.ownerDocument.execCommand(D,!1,_e)}function V(D){if(D){var U,j=Array.prototype.slice.call(D.childNodes).filter(function(fe){var Ee=fe.nodeName.toLowerCase()==="div";return Ee&&!U&&(U=fe.style.textAlign),Ee});j.length&&(this.saveSelection(),j.forEach(function(fe){if(fe.style.textAlign===U){var Ee=fe.lastChild;if(Ee){e.util.unwrap(fe,this.options.ownerDocument);var _e=this.options.ownerDocument.createElement("BR");Ee.parentNode.insertBefore(_e,Ee.nextSibling)}}},this),D.style.textAlign=U,this.restoreSelection())}}var J={};e.prototype={init:function(D,U){return this.options=$.call(this,this.defaults,U),this.origElements=D,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(u.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),this.elements.length!==0&&(this.isActive=!0,I.call(this),T.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(D){typeof D.destroy=="function"&&D.destroy()},this),this.events.destroy(),this.elements.forEach(function(D){this.options.spellcheck&&(D.innerHTML=D.innerHTML),D.removeAttribute("contentEditable"),D.removeAttribute("spellcheck"),D.removeAttribute("data-medium-editor-element"),D.classList.remove("medium-editor-element"),D.removeAttribute("role"),D.removeAttribute("aria-multiline"),D.removeAttribute("medium-editor-index"),D.removeAttribute("data-medium-editor-editor-index"),D.getAttribute("medium-editor-textarea-id")&&h(D)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,d.call(this,this.options.contentWindow))},on:function(D,U,j,fe){return this.events.attachDOMEvent(D,U,j,fe),this},off:function(D,U,j,fe){return this.events.detachDOMEvent(D,U,j,fe),this},subscribe:function(D,U){return this.events.attachCustomEvent(D,U),this},unsubscribe:function(D,U){return this.events.detachCustomEvent(D,U),this},trigger:function(D,U,j){return this.events.triggerCustomEvent(D,U,j),this},delay:function(D){var U=this;return setTimeout(function(){U.isActive&&D()},this.options.delay)},serialize:function(){var D,U,j={},fe=this.elements.length;for(D=0;D<fe;D+=1)U=this.elements[D].id!==""?this.elements[D].id:"element-"+D,j[U]={value:this.elements[D].innerHTML.trim()};return j},getExtensionByName:function(D){var U;return this.extensions&&this.extensions.length&&this.extensions.some(function(j){return j.name===D?(U=j,!0):!1}),U},addBuiltInExtension:function(D,U){var j=this.getExtensionByName(D),fe;if(j)return j;switch(D){case"anchor":fe=e.util.extend({},this.options.anchor,U),j=new e.extensions.anchor(fe);break;case"anchor-preview":j=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":j=new e.extensions.autoLink;break;case"fileDragging":j=new e.extensions.fileDragging(U);break;case"fontname":j=new e.extensions.fontName(this.options.fontName);break;case"fontsize":j=new e.extensions.fontSize(U);break;case"keyboardCommands":j=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":j=new e.extensions.paste(this.options.paste);break;case"placeholder":j=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(D)&&(U?(fe=e.util.defaults({},U,e.extensions.button.prototype.defaults[D]),j=new e.extensions.button(fe)):j=new e.extensions.button(D))}return j&&this.extensions.push(y(j,D,this)),j},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var D=this.getExtensionByName("toolbar");return D&&D.checkState(),this},queryCommandState:function(D){var U=/^full-(.+)$/gi,j,fe=null;j=U.exec(D),j&&(D=j[1]);try{fe=this.options.ownerDocument.queryCommandState(D)}catch{fe=null}return fe},execAction:function(D,U){var j=/^full-(.+)$/gi,fe,Ee;return fe=j.exec(D),fe?(this.saveSelection(),this.selectAllContents(),Ee=ne.call(this,fe[1],U),this.restoreSelection()):Ee=ne.call(this,D,U),(D==="insertunorderedlist"||D==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),Ee},getSelectedParentElement:function(D){return D===void 0&&(D=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(D)},selectAllContents:function(){var D=e.selection.getSelectionElement(this.options.contentWindow);if(D){for(;D.children.length===1;)D=D.children[0];this.selectElement(D)}},selectElement:function(D){e.selection.selectNode(D,this.options.ownerDocument);var U=e.selection.getSelectionElement(this.options.contentWindow);U&&this.events.focusElement(U)},getFocusedElement:function(){var D;return this.elements.some(function(U){return!D&&U.getAttribute("data-medium-focused")&&(D=U),!!D},this),D},exportSelection:function(){var D=e.selection.getSelectionElement(this.options.contentWindow),U=this.elements.indexOf(D),j=null;return U>=0&&(j=e.selection.exportSelection(D,this.options.ownerDocument)),j!==null&&U!==0&&(j.editableElementIndex=U),j},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(D,U){if(D){var j=this.elements[D.editableElementIndex||0];e.selection.importSelection(D,j,this.options.ownerDocument,U)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(D){var U=e.selection.getSelectionElement(this.options.contentWindow),j={},fe;if(this.elements.indexOf(U)!==-1){try{if(this.events.disableCustomEvent("editableInput"),D.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),fe=D.url||D.value,fe&&fe.trim().length>0){var Ee=this.options.contentWindow.getSelection();if(Ee){var _e=Ee.getRangeAt(0),rt=_e.commonAncestorContainer,Me,ve,Ve,Be;if(_e.endContainer.nodeType===3&&_e.startContainer.nodeType!==3&&_e.startOffset===0&&_e.startContainer.firstChild===_e.endContainer&&(rt=_e.endContainer),ve=e.util.getClosestBlockContainer(_e.startContainer),Ve=e.util.getClosestBlockContainer(_e.endContainer),rt.nodeType!==3&&rt.textContent.length!==0&&ve===Ve){var de=ve||U,le=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),Me=this.exportSelection(),le.appendChild(de.cloneNode(!0)),U===de?e.selection.select(this.options.ownerDocument,de.firstChild,0,de.lastChild,de.lastChild.nodeType===3?de.lastChild.nodeValue.length:de.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,de,0,de,de.childNodes.length);var W=this.exportSelection();Be=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,le,{start:Me.start-W.start,end:Me.end-W.start,editableElementIndex:Me.editableElementIndex}),Be.length===0&&(le=this.options.ownerDocument.createDocumentFragment(),le.appendChild(rt.cloneNode(!0)),Be=[le.firstChild.firstChild,le.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,Be,fe.trim());var Y=(le.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,le.firstChild.innerHTML.replace(/^\s+/,"")),Me.start-=Y,Me.end-=Y,this.importSelection(Me)}else this.options.ownerDocument.execCommand("createLink",!1,fe);this.options.targetBlank||D.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),fe):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),fe),D.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),D.buttonClass)}}if(this.options.targetBlank||D.target==="_blank"||D.buttonClass){j=this.options.ownerDocument.createEvent("HTMLEvents"),j.initEvent("input",!0,!0,this.options.contentWindow);for(var se=0,ge=this.elements.length;se<ge;se+=1)this.elements[se].dispatchEvent(j)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",j,U)}},cleanPaste:function(D){this.getExtensionByName("paste").cleanPaste(D)},pasteHTML:function(D,U){this.getExtensionByName("paste").pasteHTML(D,U)},setContent:function(D,U){if(U=U||0,this.elements[U]){var j=this.elements[U];j.innerHTML=D,this.checkContentChanged(j)}},getContent:function(D){return D=D||0,this.elements[D]?this.elements[D].innerHTML.trim():null},checkContentChanged:function(D){D=D||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(D,{target:D,currentTarget:D})},resetContent:function(D){if(D){var U=this.elements.indexOf(D);U!==-1&&this.setContent(J[D.getAttribute("medium-editor-index")],U);return}this.elements.forEach(function(j,fe){this.setContent(J[j.getAttribute("medium-editor-index")],fe)},this)},addElements:function(D){var U=f(D,this.options.ownerDocument,!0);if(U.length===0)return!1;U.forEach(function(j){j=R.call(this,j,this.id),this.elements.push(j),this.trigger("addElement",{target:j,currentTarget:j},j)},this)},removeElements:function(D){var U=f(D,this.options.ownerDocument),j=U.map(function(fe){return fe.getAttribute("medium-editor-textarea-id")&&fe.parentNode?fe.parentNode.querySelector('div[medium-editor-textarea-id="'+fe.getAttribute("medium-editor-textarea-id")+'"]'):fe});this.elements=this.elements.filter(function(fe){return j.indexOf(fe)!==-1?(this.events.cleanupElement(fe),fe.getAttribute("medium-editor-textarea-id")&&h(fe),this.trigger("removeElement",{target:fe,currentTarget:fe},fe),!1):!0},this)}},e.getEditorFromElement=function(D){var U=D.getAttribute("data-medium-editor-editor-index"),j=D&&D.ownerDocument&&(D.ownerDocument.defaultView||D.ownerDocument.parentWindow);return j&&j._mediumEditors&&j._mediumEditors[U]?j._mediumEditors[U]:null}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(t){var n=t.split("-"),i=n[0].split("."),o=n.length>1?n[1]:"";return{major:parseInt(i[0],10),minor:parseInt(i[1],10),revision:parseInt(i[2],10),preRelease:o,toString:function(){return[i[0],i[1],i[2]].join(".")+(o?"-"+o:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e}())}(hd)),hd.exports}var XF=qF();const rc=ha(XF);/*!
 * vanilla-picker v2.12.3
 * https://vanilla-picker.js.org
 *
 * Copyright 2017-2024 Andreas Borgen (https://github.com/Sphinxxxx), Adam Brooks (https://github.com/dissimulate)
 * Released under the ISC license.
 */var sg=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},lg=function(){function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),id=function(){function r(e,t){var n=[],i=!0,o=!1,a=void 0;try{for(var l=e[Symbol.iterator](),u;!(i=(u=l.next()).done)&&(n.push(u.value),!(t&&n.length===t));i=!0);}catch(d){o=!0,a=d}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}return n}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();String.prototype.startsWith=String.prototype.startsWith||function(r){return this.indexOf(r)===0};String.prototype.padStart=String.prototype.padStart||function(r,e){for(var t=this;t.length<r;)t=e+t;return t};var GF={cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"};function C0(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e>0?r.toFixed(e).replace(/0+$/,"").replace(/\.$/,""):r.toString();return t||"0"}var YF=function(){function r(e,t,n,i){sg(this,r);var o=this;function a(u){if(u.startsWith("hsl")){var d=u.match(/([\-\d\.e]+)/g).map(Number),f=id(d,4),h=f[0],g=f[1],y=f[2],w=f[3];w===void 0&&(w=1),h/=360,g/=100,y/=100,o.hsla=[h,g,y,w]}else if(u.startsWith("rgb")){var x=u.match(/([\-\d\.e]+)/g).map(Number),b=id(x,4),_=b[0],S=b[1],k=b[2],O=b[3];O===void 0&&(O=1),o.rgba=[_,S,k,O]}else u.startsWith("#")?o.rgba=r.hexToRgb(u):o.rgba=r.nameToRgb(u)||r.hexToRgb(u)}if(e!==void 0)if(Array.isArray(e))this.rgba=e;else if(n===void 0){var l=e&&""+e;l&&a(l.toLowerCase())}else this.rgba=[e,t,n,i===void 0?1:i]}return lg(r,[{key:"printRGB",value:function(t){var n=t?this.rgba:this.rgba.slice(0,3),i=n.map(function(o,a){return C0(o,a===3?3:0)});return t?"rgba("+i+")":"rgb("+i+")"}},{key:"printHSL",value:function(t){var n=[360,100,100,1],i=["","%","%",""],o=t?this.hsla:this.hsla.slice(0,3),a=o.map(function(l,u){return C0(l*n[u],u===3?3:1)+i[u]});return t?"hsla("+a+")":"hsl("+a+")"}},{key:"printHex",value:function(t){var n=this.hex;return t?n:n.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=r.hslToRgb(this._hsla)},set:function(t){t.length===3&&(t[3]=1),this._rgba=t,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=r.rgbToHsl(this._rgba)},set:function(t){t.length===3&&(t[3]=1),this._hsla=t,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var t=this.rgba,n=t.map(function(i,o){return o<3?i.toString(16):Math.round(i*255).toString(16)});return"#"+n.map(function(i){return i.padStart(2,"0")}).join("")},set:function(t){this.rgba=r.hexToRgb(t)}}],[{key:"hexToRgb",value:function(t){var n=(t.startsWith("#")?t.slice(1):t).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!n.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+t);var i=n.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(o){return parseInt(o,16)});return i[3]=i[3]/255,i}},{key:"nameToRgb",value:function(t){var n=t.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),i=GF[n];return i===void 0?i:r.hexToRgb(i.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(t){var n=id(t,4),i=n[0],o=n[1],a=n[2],l=n[3];i/=255,o/=255,a/=255;var u=Math.max(i,o,a),d=Math.min(i,o,a),f=void 0,h=void 0,g=(u+d)/2;if(u===d)f=h=0;else{var y=u-d;switch(h=g>.5?y/(2-u-d):y/(u+d),u){case i:f=(o-a)/y+(o<a?6:0);break;case o:f=(a-i)/y+2;break;case a:f=(i-o)/y+4;break}f/=6}return[f,h,g,l]}},{key:"hslToRgb",value:function(t){var n=id(t,4),i=n[0],o=n[1],a=n[2],l=n[3],u=void 0,d=void 0,f=void 0;if(o===0)u=d=f=a;else{var h=function(b,_,S){return S<0&&(S+=1),S>1&&(S-=1),S<.16666666666666666?b+(_-b)*6*S:S<.5?_:S<.6666666666666666?b+(_-b)*(.6666666666666666-S)*6:b},g=a<.5?a*(1+o):a+o-a*o,y=2*a-g;u=h(y,g,i+1/3),d=h(y,g,i),f=h(y,g,i-1/3)}var w=[u*255,d*255,f*255].map(Math.round);return w[3]=l,w}}]),r}(),KF=function(){function r(){sg(this,r),this._events=[]}return lg(r,[{key:"add",value:function(t,n,i){t.addEventListener(n,i,!1),this._events.push({target:t,type:n,handler:i})}},{key:"remove",value:function(t,n,i){this._events=this._events.filter(function(o){var a=!0;return t&&t!==o.target&&(a=!1),n&&n!==o.type&&(a=!1),i&&i!==o.handler&&(a=!1),a&&r._doRemove(o.target,o.type,o.handler),!a})}},{key:"destroy",value:function(){this._events.forEach(function(t){return r._doRemove(t.target,t.type,t.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(t,n,i){t.removeEventListener(n,i,!1)}}]),r}();function JF(r){var e=document.createElement("div");return e.innerHTML=r,e.firstElementChild}function qf(r,e,t){var n=!1;function i(u,d,f){return Math.max(d,Math.min(u,f))}function o(u,d,f){if(f&&(n=!0),!!n){u.preventDefault();var h=e.getBoundingClientRect(),g=h.width,y=h.height,w=d.clientX,x=d.clientY,b=i(w-h.left,0,g),_=i(x-h.top,0,y);t(b/g,_/y)}}function a(u,d){var f=u.buttons===void 0?u.which:u.buttons;f===1?o(u,u,d):n=!1}function l(u,d){u.touches.length===1?o(u,u.touches[0],d):n=!1}r.add(e,"mousedown",function(u){a(u,!0)}),r.add(e,"touchstart",function(u){l(u,!0)}),r.add(window,"mousemove",a),r.add(e,"touchmove",l),r.add(window,"mouseup",function(u){n=!1}),r.add(e,"touchend",function(u){n=!1}),r.add(e,"touchcancel",function(u){n=!1})}var ZF=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,QF=360,Mw="keydown",od="mousedown",Xf="focusin";function Hi(r,e){return(e||document).querySelector(r)}function e6(r){r.preventDefault(),r.stopPropagation()}function Gf(r,e,t,n,i){r.add(e,Mw,function(o){t.indexOf(o.key)>=0&&n(o)})}var Aw=function(){function r(e){sg(this,r),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new KF,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(e)}return lg(r,[{key:"setOptions",value:function(t){var n=this;if(!t)return;var i=this.settings;function o(d,f,h){for(var g in d)f[g]=d[g]}if(t instanceof HTMLElement)i.parent=t;else{i.parent&&t.parent&&i.parent!==t.parent&&(this._events.remove(i.parent),this._popupInited=!1),o(t,i),t.onChange&&(this.onChange=t.onChange),t.onDone&&(this.onDone=t.onDone),t.onOpen&&(this.onOpen=t.onOpen),t.onClose&&(this.onClose=t.onClose);var a=t.color||t.colour;a&&this._setColor(a)}var l=i.parent;if(l&&i.popup&&!this._popupInited){var u=function(f){return n.openHandler(f)};this._events.add(l,"click",u),Gf(this._events,l,[" ","Spacebar","Enter"],u),this._popupInited=!0}else t.parent&&!i.popup&&this.show()}},{key:"openHandler",value:function(t){if(this.show()){t&&t.preventDefault(),this.settings.parent.style.pointerEvents="none";var n=t&&t.type===Mw?this._domEdit:this.domElement;setTimeout(function(){return n.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(t){var n=t&&t.type,i=!1;if(!t)i=!0;else if(n===od||n===Xf){var o=(this.__containedEvent||0)+100;t.timeStamp>o&&(i=!0)}else e6(t),i=!0;i&&this.hide()&&(this.settings.parent.style.pointerEvents="",n!==od&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(t,n){this.closeHandler(),this.setOptions(t),n&&this.openHandler()}},{key:"setColor",value:function(t,n){this._setColor(t,{silent:n})}},{key:"_setColor",value:function(t,n){if(typeof t=="string"&&(t=t.trim()),!!t){n=n||{};var i=void 0;try{i=new YF(t)}catch(a){if(n.failSilently)return;throw a}if(!this.settings.alpha){var o=i.hsla;o[3]=1,i.hsla=o}this.colour=this.color=i,this._setHSLA(null,null,null,null,n)}}},{key:"setColour",value:function(t,n){this.setColor(t,n)}},{key:"show",value:function(){var t=this.settings.parent;if(!t)return!1;if(this.domElement){var n=this._toggleDOM(!0);return this._setPosition(),n}var i=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',o=JF(i);return this.domElement=o,this._domH=Hi(".picker_hue",o),this._domSL=Hi(".picker_sl",o),this._domA=Hi(".picker_alpha",o),this._domEdit=Hi(".picker_editor input",o),this._domSample=Hi(".picker_sample",o),this._domOkay=Hi(".picker_done button",o),this._domCancel=Hi(".picker_cancel button",o),o.classList.add("layout_"+this.settings.layout),this.settings.alpha||o.classList.add("no_alpha"),this.settings.editor||o.classList.add("no_editor"),this.settings.cancelButton||o.classList.add("no_cancel"),this._ifPopup(function(){return o.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var t=this,n=this,i=this.domElement,o=this._events;function a(d,f,h){o.add(d,f,h)}a(i,"click",function(d){return d.preventDefault()}),qf(o,this._domH,function(d,f){return n._setHSLA(d)}),qf(o,this._domSL,function(d,f){return n._setHSLA(null,d,1-f)}),this.settings.alpha&&qf(o,this._domA,function(d,f){return n._setHSLA(null,null,null,1-f)});var l=this._domEdit;a(l,"input",function(d){n._setColor(this.value,{fromEditor:!0,failSilently:!0})}),a(l,"focus",function(d){var f=this;f.selectionStart===f.selectionEnd&&f.select()}),this._ifPopup(function(){var d=function(g){return t.closeHandler(g)};a(window,od,d),a(window,Xf,d),Gf(o,i,["Esc","Escape"],d);var f=function(g){t.__containedEvent=g.timeStamp};a(i,od,f),a(i,Xf,f),a(t._domCancel,"click",d)});var u=function(f){t._ifPopup(function(){return t.closeHandler(f)}),t.onDone&&t.onDone(t.colour)};a(this._domOkay,"click",u),Gf(o,i,["Enter"],u)}},{key:"_setPosition",value:function(){var t=this.settings.parent,n=this.domElement;t!==n.parentNode&&t.appendChild(n),this._ifPopup(function(i){getComputedStyle(t).position==="static"&&(t.style.position="relative");var o=i===!0?"popup_right":"popup_"+i;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(a){a===o?n.classList.add(a):n.classList.remove(a)}),n.classList.add(o)})}},{key:"_setHSLA",value:function(t,n,i,o,a){a=a||{};var l=this.colour,u=l.hsla;[t,n,i,o].forEach(function(d,f){(d||d===0)&&(u[f]=d)}),l.hsla=u,this._updateUI(a),this.onChange&&!a.silent&&this.onChange(l)}},{key:"_updateUI",value:function(t){if(!this.domElement)return;t=t||{};var n=this.colour,i=n.hsla,o="hsl("+i[0]*QF+", 100%, 50%)",a=n.hslString,l=n.hslaString,u=this._domH,d=this._domSL,f=this._domA,h=Hi(".picker_selector",u),g=Hi(".picker_selector",d),y=Hi(".picker_selector",f);function w(R,T,I){T.style.left=I*100+"%"}function x(R,T,I){T.style.top=I*100+"%"}w(u,h,i[0]),this._domSL.style.backgroundColor=this._domH.style.color=o,w(d,g,i[1]),x(d,g,1-i[2]),d.style.color=a,x(f,y,1-i[3]);var b=a,_=b.replace("hsl","hsla").replace(")",", 0)"),S="linear-gradient("+[b,_]+")";if(this._domA.style.background=S+", "+ZF,!t.fromEditor){var k=this.settings.editorFormat,O=this.settings.alpha,M=void 0;switch(k){case"rgb":M=n.printRGB(O);break;case"hsl":M=n.printHSL(O);break;default:M=n.printHex(O)}this._domEdit.value=M}this._domSample.style.color=l}},{key:"_ifPopup",value:function(t,n){this.settings.parent&&this.settings.popup?t&&t(this.settings.popup):n&&n()}},{key:"_toggleDOM",value:function(t){var n=this.domElement;if(!n)return!1;var i=t?"":"none",o=n.style.display!==i;return o&&(n.style.display=i),o}}]),r}();{var Yf=document.createElement("style");Yf.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(Yf),Aw.StyleElement=Yf}var Kf={exports:{}},k0;function Tw(){return k0||(k0=1,function(r,e){(function(t,n){r.exports=t()})(function(){var t="object",n="function",i="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],a=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],u=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(W,Y){var se=typeof W[Y];return se==n||!!(se==t&&W[Y])||se=="unknown"}function f(W,Y){return!!(typeof W[Y]==t&&W[Y])}function h(W,Y){return typeof W[Y]!=i}function g(W){return function(Y,se){for(var ge=se.length;ge--;)if(!W(Y,se[ge]))return!1;return!0}}var y=g(d),w=g(f),x=g(h);function b(W){return W&&y(W,u)&&x(W,l)}function _(W){return f(W,"body")?W.body:W.getElementsByTagName("body")[0]}var S=[].forEach?function(W,Y){W.forEach(Y)}:function(W,Y){for(var se=0,ge=W.length;se<ge;++se)Y(W[se],se)},k={},O=typeof window!=i&&typeof document!=i,M={isHostMethod:d,isHostObject:f,isHostProperty:h,areHostMethods:y,areHostObjects:w,areHostProperties:x,isTextRange:b,getBody:_,forEach:S},R={version:"1.3.2",initialized:!1,isBrowser:O,supported:!0,util:M,features:{},modules:k,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i?!0:rangyAutoInitialize}};function T(W){typeof console!=i&&d(console,"log")}function I(W,Y){O&&Y?alert(W):T(W)}function $(W){R.initialized=!0,R.supported=!1,I("Rangy is not supported in this environment. Reason: "+W,R.config.alertOnFail)}R.fail=$;function ne(W){I("Rangy warning: "+W,R.config.alertOnWarn)}R.warn=ne;var V;({}).hasOwnProperty?(M.extend=V=function(W,Y,se){var ge,Pe;for(var Le in Y)Le==="__proto__"||Le==="constructor"||Le==="prototype"||Y.hasOwnProperty(Le)&&(ge=W[Le],Pe=Y[Le],se&&ge!==null&&typeof ge=="object"&&Pe!==null&&typeof Pe=="object"&&V(ge,Pe,!0),W[Le]=Pe);return Y.hasOwnProperty("toString")&&(W.toString=Y.toString),W},M.createOptions=function(W,Y){var se={};return V(se,Y),W&&V(se,W),se}):$("hasOwnProperty not supported"),O||$("Rangy can only run in a browser"),function(){var W;if(O){var Y=document.createElement("div");Y.appendChild(document.createElement("span"));var se=[].slice;try{se.call(Y.childNodes,0)[0].nodeType==1&&(W=function(ge){return se.call(ge,0)})}catch{}}W||(W=function(ge){for(var Pe=[],Le=0,He=ge.length;Le<He;++Le)Pe[Le]=ge[Le];return Pe}),M.toArray=W}();var J;O&&(d(document,"addEventListener")?J=function(W,Y,se){W.addEventListener(Y,se,!1)}:d(document,"attachEvent")?J=function(W,Y,se){W.attachEvent("on"+Y,se)}:$("Document does not have required addEventListener or attachEvent method"),M.addListener=J);var D=[];function U(W){return W.message||W.description||String(W)}function j(){if(!(!O||R.initialized)){var W,Y=!1,se=!1;d(document,"createRange")&&(W=document.createRange(),y(W,a)&&x(W,o)&&(Y=!0));var ge=_(document);if(!ge||ge.nodeName.toLowerCase()!="body"){$("No body element found");return}if(ge&&d(ge,"createTextRange")&&(W=ge.createTextRange(),b(W)&&(se=!0)),!Y&&!se){$("Neither Range nor TextRange are available");return}R.initialized=!0,R.features={implementsDomRange:Y,implementsTextRange:se};var Pe,Le;for(var He in k)(Pe=k[He])instanceof Me&&Pe.init(Pe,R);for(var ft=0,Ke=D.length;ft<Ke;++ft)try{D[ft](R)}catch(Nt){Le="Rangy init listener threw an exception. Continuing. Detail: "+U(Nt),T(Le)}}}function fe(W,Y,se){se&&(W+=" in module "+se.name),R.warn("DEPRECATED: "+W+" is deprecated. Please use "+Y+" instead.")}function Ee(W,Y,se,ge){W[Y]=function(){return fe(Y,se,ge),W[se].apply(W,M.toArray(arguments))}}M.deprecationNotice=fe,M.createAliasForDeprecatedMethod=Ee,R.init=j,R.addInitListener=function(W){R.initialized?W(R):D.push(W)};var _e=[];R.addShimListener=function(W){_e.push(W)};function rt(W){W=W||window,j();for(var Y=0,se=_e.length;Y<se;++Y)_e[Y](W)}O&&(R.shim=R.createMissingNativeApi=rt,Ee(R,"createMissingNativeApi","shim"));function Me(W,Y,se){this.name=W,this.dependencies=Y,this.initialized=!1,this.supported=!1,this.initializer=se}Me.prototype={init:function(){for(var W=this.dependencies||[],Y=0,se=W.length,ge,Pe;Y<se;++Y){if(Pe=W[Y],ge=k[Pe],!ge||!(ge instanceof Me))throw new Error("required module '"+Pe+"' not found");if(ge.init(),!ge.supported)throw new Error("required module '"+Pe+"' not supported")}this.initializer(this)},fail:function(W){throw this.initialized=!0,this.supported=!1,new Error(W)},warn:function(W){R.warn("Module "+this.name+": "+W)},deprecationNotice:function(W,Y){R.warn("DEPRECATED: "+W+" in module "+this.name+" is deprecated. Please use "+Y+" instead")},createError:function(W){return new Error("Error in Rangy "+this.name+" module: "+W)}};function ve(W,Y,se){var ge=new Me(W,Y,function(Pe){if(!Pe.initialized){Pe.initialized=!0;try{se(R,Pe),Pe.supported=!0}catch(He){var Le="Module '"+W+"' failed to load: "+U(He);T(Le),He.stack&&T(He.stack)}}});return k[W]=ge,ge}R.createModule=function(W){var Y,se;arguments.length==2?(Y=arguments[1],se=[]):(Y=arguments[2],se=arguments[1]);var ge=ve(W,se,Y);R.initialized&&R.supported&&ge.init()},R.createCoreModule=function(W,Y,se){ve(W,Y,se)};function Ve(){}R.RangePrototype=Ve,R.rangePrototype=new Ve;function Be(){}R.selectionPrototype=new Be,R.createCoreModule("DomUtil",[],function(W,Y){var se="undefined",ge=W.util,Pe=ge.getBody;ge.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||Y.fail("document missing a Node creation method"),ge.isHostMethod(document,"getElementsByTagName")||Y.fail("document missing getElementsByTagName method");var Le=document.createElement("div");ge.areHostMethods(Le,["insertBefore","appendChild","cloneNode"])||Y.fail("Incomplete Element implementation"),ge.isHostProperty(Le,"innerHTML")||Y.fail("Element is missing innerHTML property");var He=document.createTextNode("test");ge.areHostMethods(He,["splitText","deleteData","insertData","appendData","cloneNode"])||Y.fail("Incomplete Text Node implementation");var ft=function(xe,qe){for(var gt=xe.length;gt--;)if(xe[gt]===qe)return!0;return!1};function Ke(xe){var qe;return typeof xe.namespaceURI==se||(qe=xe.namespaceURI)===null||qe=="http://www.w3.org/1999/xhtml"}function Nt(xe){var qe=xe.parentNode;return qe.nodeType==1?qe:null}function yt(xe){for(var qe=0;xe=xe.previousSibling;)++qe;return qe}function Wt(xe){switch(xe.nodeType){case 7:case 10:return 0;case 3:case 8:return xe.length;default:return xe.childNodes.length}}function Ft(xe,qe){var gt=[],Et;for(Et=xe;Et;Et=Et.parentNode)gt.push(Et);for(Et=qe;Et;Et=Et.parentNode)if(ft(gt,Et))return Et;return null}function te(xe,qe,gt){for(var Et=gt?qe:qe.parentNode;Et;){if(Et===xe)return!0;Et=Et.parentNode}return!1}function A(xe,qe){return te(xe,qe,!0)}function F(xe,qe,gt){for(var Et,qt=gt?xe:xe.parentNode;qt;){if(Et=qt.parentNode,Et===qe)return qt;qt=Et}return null}function ee(xe){var qe=xe.nodeType;return qe==3||qe==4||qe==8}function K(xe){if(!xe)return!1;var qe=xe.nodeType;return qe==3||qe==8}function oe(xe,qe){var gt=qe.nextSibling,Et=qe.parentNode;return gt?Et.insertBefore(xe,gt):Et.appendChild(xe),xe}function ie(xe,qe,gt){var Et=xe.cloneNode(!1);if(Et.deleteData(0,qe),xe.deleteData(qe,xe.length-qe),oe(Et,xe),gt)for(var qt=0,Gt;Gt=gt[qt++];)Gt.node==xe&&Gt.offset>qe?(Gt.node=Et,Gt.offset-=qe):Gt.node==xe.parentNode&&Gt.offset>yt(xe)&&++Gt.offset;return Et}function ce(xe){if(xe.nodeType==9)return xe;if(typeof xe.ownerDocument!=se)return xe.ownerDocument;if(typeof xe.document!=se)return xe.document;if(xe.parentNode)return ce(xe.parentNode);throw Y.createError("getDocument: no document found for node")}function Ce(xe){var qe=ce(xe);if(typeof qe.defaultView!=se)return qe.defaultView;if(typeof qe.parentWindow!=se)return qe.parentWindow;throw Y.createError("Cannot get a window object for node")}function ke(xe){if(typeof xe.contentDocument!=se)return xe.contentDocument;if(typeof xe.contentWindow!=se)return xe.contentWindow.document;throw Y.createError("getIframeDocument: No Document object found for iframe element")}function je(xe){if(typeof xe.contentWindow!=se)return xe.contentWindow;if(typeof xe.contentDocument!=se)return xe.contentDocument.defaultView;throw Y.createError("getIframeWindow: No Window object found for iframe element")}function Ze(xe){return xe&&ge.isHostMethod(xe,"setTimeout")&&ge.isHostObject(xe,"document")}function ct(xe,qe,gt){var Et;if(xe?ge.isHostProperty(xe,"nodeType")?Et=xe.nodeType==1&&xe.tagName.toLowerCase()=="iframe"?ke(xe):ce(xe):Ze(xe)&&(Et=xe.document):Et=document,!Et)throw qe.createError(gt+"(): Parameter must be a Window object or DOM node");return Et}function pt(xe){for(var qe;qe=xe.parentNode;)xe=qe;return xe}function Rt(xe,qe,gt,Et){var qt,Gt,Qn,mn,zn;if(xe==gt)return qe===Et?0:qe<Et?-1:1;if(qt=F(gt,xe,!0))return qe<=yt(qt)?-1:1;if(qt=F(xe,gt,!0))return yt(qt)<Et?-1:1;if(Gt=Ft(xe,gt),!Gt)throw new Error("comparePoints error: nodes have no common ancestor");if(Qn=xe===Gt?Gt:F(xe,Gt,!0),mn=gt===Gt?Gt:F(gt,Gt,!0),Qn===mn)throw Y.createError("comparePoints got to case 4 and childA and childB are the same!");for(zn=Gt.firstChild;zn;){if(zn===Qn)return-1;if(zn===mn)return 1;zn=zn.nextSibling}}var Je=!1;function dt(xe){var qe;try{return qe=xe.parentNode,!1}catch{return!0}}(function(){var xe=document.createElement("b");xe.innerHTML="1";var qe=xe.firstChild;xe.innerHTML="<br />",Je=dt(qe),W.features.crashyTextNodes=Je})();function It(xe){if(!xe)return"[No node]";if(Je&&dt(xe))return"[Broken node]";if(ee(xe))return'"'+xe.data+'"';if(xe.nodeType==1){var qe=xe.id?' id="'+xe.id+'"':"";return"<"+xe.nodeName+qe+">[index:"+yt(xe)+",length:"+xe.childNodes.length+"]["+(xe.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return xe.nodeName}function at(xe){for(var qe=ce(xe).createDocumentFragment(),gt;gt=xe.firstChild;)qe.appendChild(gt);return qe}var Fe;typeof window.getComputedStyle!=se?Fe=function(xe,qe){return Ce(xe).getComputedStyle(xe,null)[qe]}:typeof document.documentElement.currentStyle!=se?Fe=function(xe,qe){return xe.currentStyle?xe.currentStyle[qe]:""}:Y.fail("No means of obtaining computed style properties found");function Re(xe,qe,gt){var Et=Pe(xe),qt=xe.createElement("div");qt.contentEditable=""+!!gt,qe&&(qt.innerHTML=qe);var Gt=Et.firstChild;return Gt?Et.insertBefore(qt,Gt):Et.appendChild(qt),qt}function vt(xe){return xe.parentNode.removeChild(xe)}function Ye(xe){this.root=xe,this._next=xe}Ye.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var xe=this._current=this._next,qe,gt;if(this._current)if(qe=xe.firstChild,qe)this._next=qe;else{for(gt=null;xe!==this.root&&!(gt=xe.nextSibling);)xe=xe.parentNode;this._next=gt}return this._current},detach:function(){this._current=this._next=this.root=null}};function Qe(xe){return new Ye(xe)}function nt(xe,qe){this.node=xe,this.offset=qe}nt.prototype={equals:function(xe){return!!xe&&this.node===xe.node&&this.offset==xe.offset},inspect:function(){return"[DomPosition("+It(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function St(xe){this.code=this[xe],this.codeName=xe,this.message="DOMException: "+this.codeName}St.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},St.prototype.toString=function(){return this.message},W.dom={arrayContains:ft,isHtmlNamespace:Ke,parentElement:Nt,getNodeIndex:yt,getNodeLength:Wt,getCommonAncestor:Ft,isAncestorOf:te,isOrIsAncestorOf:A,getClosestAncestorIn:F,isCharacterDataNode:ee,isTextOrCommentNode:K,insertAfter:oe,splitDataNode:ie,getDocument:ce,getWindow:Ce,getIframeWindow:je,getIframeDocument:ke,getBody:Pe,isWindow:Ze,getContentDocument:ct,getRootContainer:pt,comparePoints:Rt,isBrokenNode:dt,inspectNode:It,getComputedStyleProperty:Fe,createTestElement:Re,removeNode:vt,fragmentFromNodeChildren:at,createIterator:Qe,DomPosition:nt},W.DOMException=St}),R.createCoreModule("DomRange",["DomUtil"],function(W,Y){var se=W.dom,ge=W.util,Pe=se.DomPosition,Le=W.DOMException,He=se.isCharacterDataNode,ft=se.getNodeIndex,Ke=se.isOrIsAncestorOf,Nt=se.getDocument,yt=se.comparePoints,Wt=se.splitDataNode,Ft=se.getClosestAncestorIn,te=se.getNodeLength,A=se.arrayContains,F=se.getRootContainer,ee=W.features.crashyTextNodes,K=se.removeNode;function oe(Q,L){return Q.nodeType!=3&&(Ke(Q,L.startContainer)||Ke(Q,L.endContainer))}function ie(Q){return Q.document||Nt(Q.startContainer)}function ce(Q){return F(Q.startContainer)}function Ce(Q){return new Pe(Q.parentNode,ft(Q))}function ke(Q){return new Pe(Q.parentNode,ft(Q)+1)}function je(Q,L,X){var he=Q.nodeType==11?Q.firstChild:Q;return He(L)?X==L.length?se.insertAfter(Q,L):L.parentNode.insertBefore(Q,X==0?L:Wt(L,X)):X>=L.childNodes.length?L.appendChild(Q):L.insertBefore(Q,L.childNodes[X]),he}function Ze(Q,L,X){if(Zt(Q),Zt(L),ie(L)!=ie(Q))throw new Le("WRONG_DOCUMENT_ERR");var he=yt(Q.startContainer,Q.startOffset,L.endContainer,L.endOffset),Oe=yt(Q.endContainer,Q.endOffset,L.startContainer,L.startOffset);return X?he<=0&&Oe>=0:he<0&&Oe>0}function ct(Q){for(var L,X,he=ie(Q.range).createDocumentFragment(),Oe;X=Q.next();){if(L=Q.isPartiallySelectedSubtree(),X=X.cloneNode(!L),L&&(Oe=Q.getSubtreeIterator(),X.appendChild(ct(Oe)),Oe.detach()),X.nodeType==10)throw new Le("HIERARCHY_REQUEST_ERR");he.appendChild(X)}return he}function pt(Q,L,X){var he,Oe;X=X||{stop:!1};for(var me,we;me=Q.next();)if(Q.isPartiallySelectedSubtree()){if(L(me)===!1){X.stop=!0;return}else if(we=Q.getSubtreeIterator(),pt(we,L,X),we.detach(),X.stop)return}else for(he=se.createIterator(me);Oe=he.next();)if(L(Oe)===!1){X.stop=!0;return}}function Rt(Q){for(var L;Q.next();)Q.isPartiallySelectedSubtree()?(L=Q.getSubtreeIterator(),Rt(L),L.detach()):Q.remove()}function Je(Q){for(var L,X=ie(Q.range).createDocumentFragment(),he;L=Q.next();){if(Q.isPartiallySelectedSubtree()?(L=L.cloneNode(!1),he=Q.getSubtreeIterator(),L.appendChild(Je(he)),he.detach()):Q.remove(),L.nodeType==10)throw new Le("HIERARCHY_REQUEST_ERR");X.appendChild(L)}return X}function dt(Q,L,X){var he=!!(L&&L.length),Oe,me=!!X;he&&(Oe=new RegExp("^("+L.join("|")+")$"));var we=[];return pt(new at(Q,!1),function(it){if(!(he&&!Oe.test(it.nodeType))&&!(me&&!X(it))){var bt=Q.startContainer;if(!(it==bt&&He(bt)&&Q.startOffset==bt.length)){var Pt=Q.endContainer;it==Pt&&He(Pt)&&Q.endOffset==0||we.push(it)}}}),we}function It(Q){var L=typeof Q.getName>"u"?"Range":Q.getName();return"["+L+"("+se.inspectNode(Q.startContainer)+":"+Q.startOffset+", "+se.inspectNode(Q.endContainer)+":"+Q.endOffset+")]"}function at(Q,L){if(this.range=Q,this.clonePartiallySelectedTextNodes=L,!Q.collapsed){this.sc=Q.startContainer,this.so=Q.startOffset,this.ec=Q.endContainer,this.eo=Q.endOffset;var X=Q.commonAncestorContainer;this.sc===this.ec&&He(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===X&&!He(this.sc)?this.sc.childNodes[this.so]:Ft(this.sc,X,!0),this._last=this.ec===X&&!He(this.ec)?this.ec.childNodes[this.eo-1]:Ft(this.ec,X,!0))}}at.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var Q=this._current=this._next;return Q&&(this._next=Q!==this._last?Q.nextSibling:null,He(Q)&&this.clonePartiallySelectedTextNodes&&(Q===this.ec&&(Q=Q.cloneNode(!0)).deleteData(this.eo,Q.length-this.eo),this._current===this.sc&&(Q=Q.cloneNode(!0)).deleteData(0,this.so))),Q},remove:function(){var Q=this._current,L,X;He(Q)&&(Q===this.sc||Q===this.ec)?(L=Q===this.sc?this.so:0,X=Q===this.ec?this.eo:Q.length,L!=X&&Q.deleteData(L,X-L)):Q.parentNode&&K(Q)},isPartiallySelectedSubtree:function(){var Q=this._current;return oe(Q,this.range)},getSubtreeIterator:function(){var Q;if(this.isSingleCharacterDataNode)Q=this.range.cloneRange(),Q.collapse(!1);else{Q=new pn(ie(this.range));var L=this._current,X=L,he=0,Oe=L,me=te(L);Ke(L,this.sc)&&(X=this.sc,he=this.so),Ke(L,this.ec)&&(Oe=this.ec,me=this.eo),zt(Q,X,he,Oe,me)}return new at(Q,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Fe=[1,3,4,5,7,8,10],Re=[2,9,11],vt=[5,6,10,12],Ye=[1,3,4,5,7,8,10,11],Qe=[1,3,4,5,7,8];function nt(Q){return function(L,X){for(var he,Oe=X?L:L.parentNode;Oe;){if(he=Oe.nodeType,A(Q,he))return Oe;Oe=Oe.parentNode}return null}}var St=nt([9,11]),xe=nt(vt),qe=nt([6,10,12]),gt=nt([1]);function Et(Q,L){if(qe(Q,L))throw new Le("INVALID_NODE_TYPE_ERR")}function qt(Q,L){if(!A(L,Q.nodeType))throw new Le("INVALID_NODE_TYPE_ERR")}function Gt(Q,L){if(L<0||L>(He(Q)?Q.length:Q.childNodes.length))throw new Le("INDEX_SIZE_ERR")}function Qn(Q,L){if(St(Q,!0)!==St(L,!0))throw new Le("WRONG_DOCUMENT_ERR")}function mn(Q){if(xe(Q,!0))throw new Le("NO_MODIFICATION_ALLOWED_ERR")}function zn(Q,L){if(!Q)throw new Le(L)}function Kr(Q,L){return L<=(He(Q)?Q.length:Q.childNodes.length)}function Jr(Q){return!!Q.startContainer&&!!Q.endContainer&&!(ee&&(se.isBrokenNode(Q.startContainer)||se.isBrokenNode(Q.endContainer)))&&F(Q.startContainer)==F(Q.endContainer)&&Kr(Q.startContainer,Q.startOffset)&&Kr(Q.endContainer,Q.endOffset)}function Zt(Q){if(!Jr(Q))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+Q.inspect()+")")}var Mr=document.createElement("style"),Nn=!1;try{Mr.innerHTML="<b>x</b>",Nn=Mr.firstChild.nodeType==3}catch{}W.features.htmlParsingConforms=Nn;var Ar=Nn?function(Q){var L=this.startContainer,X=Nt(L);if(!L)throw new Le("INVALID_STATE_ERR");var he=null;return L.nodeType==1?he=L:He(L)&&(he=se.parentElement(L)),he===null||he.nodeName=="HTML"&&se.isHtmlNamespace(Nt(he).documentElement)&&se.isHtmlNamespace(he)?he=X.createElement("body"):he=he.cloneNode(!1),he.innerHTML=Q,se.fragmentFromNodeChildren(he)}:function(Q){var L=ie(this),X=L.createElement("body");return X.innerHTML=Q,se.fragmentFromNodeChildren(X)};function ui(Q,L){Zt(Q);var X=Q.startContainer,he=Q.startOffset,Oe=Q.endContainer,me=Q.endOffset,we=X===Oe;He(Oe)&&me>0&&me<Oe.length&&Wt(Oe,me,L),He(X)&&he>0&&he<X.length&&(X=Wt(X,he,L),we?(me-=he,Oe=X):Oe==X.parentNode&&me>=ft(X)&&me++,he=0),Q.setStartAndEnd(X,he,Oe,me)}function Dt(Q){Zt(Q);var L=Q.commonAncestorContainer.parentNode.cloneNode(!1);return L.appendChild(Q.cloneContents()),L.innerHTML}var Pi=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Wr=0,Wn=1,ur=2,dr=3,Tr=0,Zr=1,Dr=2,Ur=3;ge.extend(W.rangePrototype,{compareBoundaryPoints:function(Q,L){Zt(this),Qn(this.startContainer,L.startContainer);var X,he,Oe,me,we=Q==dr||Q==Wr?"start":"end",it=Q==Wn||Q==Wr?"start":"end";return X=this[we+"Container"],he=this[we+"Offset"],Oe=L[it+"Container"],me=L[it+"Offset"],yt(X,he,Oe,me)},insertNode:function(Q){if(Zt(this),qt(Q,Ye),mn(this.startContainer),Ke(Q,this.startContainer))throw new Le("HIERARCHY_REQUEST_ERR");var L=je(Q,this.startContainer,this.startOffset);this.setStartBefore(L)},cloneContents:function(){Zt(this);var Q,L;if(this.collapsed)return ie(this).createDocumentFragment();if(this.startContainer===this.endContainer&&He(this.startContainer))return Q=this.startContainer.cloneNode(!0),Q.data=Q.data.slice(this.startOffset,this.endOffset),L=ie(this).createDocumentFragment(),L.appendChild(Q),L;var X=new at(this,!0);return Q=ct(X),X.detach(),Q},canSurroundContents:function(){Zt(this),mn(this.startContainer),mn(this.endContainer);var Q=new at(this,!0),L=Q._first&&oe(Q._first,this)||Q._last&&oe(Q._last,this);return Q.detach(),!L},surroundContents:function(Q){if(qt(Q,Qe),!this.canSurroundContents())throw new Le("INVALID_STATE_ERR");var L=this.extractContents();if(Q.hasChildNodes())for(;Q.lastChild;)Q.removeChild(Q.lastChild);je(Q,this.startContainer,this.startOffset),Q.appendChild(L),this.selectNode(Q)},cloneRange:function(){Zt(this);for(var Q=new pn(ie(this)),L=Pi.length,X;L--;)X=Pi[L],Q[X]=this[X];return Q},toString:function(){Zt(this);var Q=this.startContainer;if(Q===this.endContainer&&He(Q))return Q.nodeType==3||Q.nodeType==4?Q.data.slice(this.startOffset,this.endOffset):"";var L=[],X=new at(this,!0);return pt(X,function(he){(he.nodeType==3||he.nodeType==4)&&L.push(he.data)}),X.detach(),L.join("")},compareNode:function(Q){Zt(this);var L=Q.parentNode,X=ft(Q);if(!L)throw new Le("NOT_FOUND_ERR");var he=this.comparePoint(L,X),Oe=this.comparePoint(L,X+1);return he<0?Oe>0?Dr:Tr:Oe>0?Zr:Ur},comparePoint:function(Q,L){return Zt(this),zn(Q,"HIERARCHY_REQUEST_ERR"),Qn(Q,this.startContainer),yt(Q,L,this.startContainer,this.startOffset)<0?-1:yt(Q,L,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Ar,toHtml:function(){return Dt(this)},intersectsNode:function(Q,L){if(Zt(this),F(Q)!=ce(this))return!1;var X=Q.parentNode,he=ft(Q);if(!X)return!0;var Oe=yt(X,he,this.endContainer,this.endOffset),me=yt(X,he+1,this.startContainer,this.startOffset);return L?Oe<=0&&me>=0:Oe<0&&me>0},isPointInRange:function(Q,L){return Zt(this),zn(Q,"HIERARCHY_REQUEST_ERR"),Qn(Q,this.startContainer),yt(Q,L,this.startContainer,this.startOffset)>=0&&yt(Q,L,this.endContainer,this.endOffset)<=0},intersectsRange:function(Q){return Ze(this,Q,!1)},intersectsOrTouchesRange:function(Q){return Ze(this,Q,!0)},intersection:function(Q){if(this.intersectsRange(Q)){var L=yt(this.startContainer,this.startOffset,Q.startContainer,Q.startOffset),X=yt(this.endContainer,this.endOffset,Q.endContainer,Q.endOffset),he=this.cloneRange();return L==-1&&he.setStart(Q.startContainer,Q.startOffset),X==1&&he.setEnd(Q.endContainer,Q.endOffset),he}return null},union:function(Q){if(this.intersectsOrTouchesRange(Q)){var L=this.cloneRange();return yt(Q.startContainer,Q.startOffset,this.startContainer,this.startOffset)==-1&&L.setStart(Q.startContainer,Q.startOffset),yt(Q.endContainer,Q.endOffset,this.endContainer,this.endOffset)==1&&L.setEnd(Q.endContainer,Q.endOffset),L}else throw new Le("Ranges do not intersect")},containsNode:function(Q,L){return L?this.intersectsNode(Q,!1):this.compareNode(Q)==Ur},containsNodeContents:function(Q){return this.comparePoint(Q,0)>=0&&this.comparePoint(Q,te(Q))<=0},containsRange:function(Q){var L=this.intersection(Q);return L!==null&&Q.equals(L)},containsNodeText:function(Q){var L=this.cloneRange();L.selectNode(Q);var X=L.getNodes([3]);if(X.length>0){L.setStart(X[0],0);var he=X.pop();return L.setEnd(he,he.length),this.containsRange(L)}else return this.containsNodeContents(Q)},getNodes:function(Q,L){return Zt(this),dt(this,Q,L)},getDocument:function(){return ie(this)},collapseBefore:function(Q){this.setEndBefore(Q),this.collapse(!1)},collapseAfter:function(Q){this.setStartAfter(Q),this.collapse(!0)},getBookmark:function(Q){var L=ie(this),X=W.createRange(L);Q=Q||se.getBody(L),X.selectNodeContents(Q);var he=this.intersection(X),Oe=0,me=0;return he&&(X.setEnd(he.startContainer,he.startOffset),Oe=X.toString().length,me=Oe+he.toString().length),{start:Oe,end:me,containerNode:Q}},moveToBookmark:function(Q){var L=Q.containerNode,X=0;this.setStart(L,0),this.collapse(!0);for(var he=[L],Oe,me=!1,we=!1,it,bt,Pt;!we&&(Oe=he.pop());)if(Oe.nodeType==3)it=X+Oe.length,!me&&Q.start>=X&&Q.start<=it&&(this.setStart(Oe,Q.start-X),me=!0),me&&Q.end>=X&&Q.end<=it&&(this.setEnd(Oe,Q.end-X),we=!0),X=it;else for(Pt=Oe.childNodes,bt=Pt.length;bt--;)he.push(Pt[bt])},getName:function(){return"DomRange"},equals:function(Q){return pn.rangesEqual(this,Q)},isValid:function(){return Jr(this)},inspect:function(){return It(this)},detach:function(){}});function Z(Q){Q.START_TO_START=Wr,Q.START_TO_END=Wn,Q.END_TO_END=ur,Q.END_TO_START=dr,Q.NODE_BEFORE=Tr,Q.NODE_AFTER=Zr,Q.NODE_BEFORE_AND_AFTER=Dr,Q.NODE_INSIDE=Ur}function be(Q){Z(Q),Z(Q.prototype)}function Xe(Q,L){return function(){Zt(this);var X=this.startContainer,he=this.startOffset,Oe=this.commonAncestorContainer,me=new at(this,!0),we,it;X!==Oe&&(we=Ft(X,Oe,!0),it=ke(we),X=it.node,he=it.offset),pt(me,mn),me.reset();var bt=Q(me);return me.detach(),L(this,X,he,X,he),bt}}function ot(Q,L){function X(we,it){return function(bt){qt(bt,Fe),qt(F(bt),Re);var Pt=(we?Ce:ke)(bt);(it?he:Oe)(this,Pt.node,Pt.offset)}}function he(we,it,bt){var Pt=we.endContainer,Mn=we.endOffset;(it!==we.startContainer||bt!==we.startOffset)&&((F(it)!=F(Pt)||yt(it,bt,Pt,Mn)==1)&&(Pt=it,Mn=bt),L(we,it,bt,Pt,Mn))}function Oe(we,it,bt){var Pt=we.startContainer,Mn=we.startOffset;(it!==we.endContainer||bt!==we.endOffset)&&((F(it)!=F(Pt)||yt(it,bt,Pt,Mn)==-1)&&(Pt=it,Mn=bt),L(we,Pt,Mn,it,bt))}var me=function(){};me.prototype=W.rangePrototype,Q.prototype=new me,ge.extend(Q.prototype,{setStart:function(we,it){Et(we,!0),Gt(we,it),he(this,we,it)},setEnd:function(we,it){Et(we,!0),Gt(we,it),Oe(this,we,it)},setStartAndEnd:function(){var we=arguments,it=we[0],bt=we[1],Pt=it,Mn=bt;switch(we.length){case 3:Mn=we[2];break;case 4:Pt=we[2],Mn=we[3];break}Et(it,!0),Gt(it,bt),Et(Pt,!0),Gt(Pt,Mn),L(this,it,bt,Pt,Mn)},setBoundary:function(we,it,bt){this["set"+(bt?"Start":"End")](we,it)},setStartBefore:X(!0,!0),setStartAfter:X(!1,!0),setEndBefore:X(!0,!1),setEndAfter:X(!1,!1),collapse:function(we){Zt(this),we?L(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):L(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(we){Et(we,!0),L(this,we,0,we,te(we))},selectNode:function(we){Et(we,!1),qt(we,Fe);var it=Ce(we),bt=ke(we);L(this,it.node,it.offset,bt.node,bt.offset)},extractContents:Xe(Je,L),deleteContents:Xe(Rt,L),canSurroundContents:function(){Zt(this),mn(this.startContainer),mn(this.endContainer);var we=new at(this,!0),it=we._first&&oe(we._first,this)||we._last&&oe(we._last,this);return we.detach(),!it},splitBoundaries:function(){ui(this)},splitBoundariesPreservingPositions:function(we){ui(this,we)},normalizeBoundaries:function(){Zt(this);var we=this.startContainer,it=this.startOffset,bt=this.endContainer,Pt=this.endOffset,Mn=function(yn){var Vr=yn.nextSibling;Vr&&Vr.nodeType==yn.nodeType&&(bt=yn,Pt=yn.length,yn.appendData(Vr.data),K(Vr))},Ts=function(yn){var Vr=yn.previousSibling;if(Vr&&Vr.nodeType==yn.nodeType){we=yn;var iu=yn.length;if(it=Vr.length,yn.insertData(0,Vr.data),K(Vr),we==bt)Pt+=it,bt=we;else if(bt==yn.parentNode){var uo=ft(yn);Pt==uo?(bt=yn,Pt=iu):Pt>uo&&Pt--}}},Bt=!0,Lr;if(He(bt))Pt==bt.length?Mn(bt):Pt==0&&(Lr=bt.previousSibling,Lr&&Lr.nodeType==bt.nodeType&&(Pt=Lr.length,we==bt&&(Bt=!1),Lr.appendData(bt.data),K(bt),bt=Lr));else{if(Pt>0){var ma=bt.childNodes[Pt-1];ma&&He(ma)&&Mn(ma)}Bt=!this.collapsed}if(Bt){if(He(we))it==0?Ts(we):it==we.length&&(Lr=we.nextSibling,Lr&&Lr.nodeType==we.nodeType&&(bt==Lr&&(bt=we,Pt+=we.length),we.appendData(Lr.data),K(Lr)));else if(it<we.childNodes.length){var lo=we.childNodes[it];lo&&He(lo)&&Ts(lo)}}else we=bt,it=Pt;L(this,we,it,bt,Pt)},collapseToPoint:function(we,it){Et(we,!0),Gt(we,it),this.setStartAndEnd(we,it)},parentElement:function(){Zt(this);var we=this.commonAncestorContainer;return we?gt(this.commonAncestorContainer,!0):null}}),be(Q)}function Ge(Q){Q.collapsed=Q.startContainer===Q.endContainer&&Q.startOffset===Q.endOffset,Q.commonAncestorContainer=Q.collapsed?Q.startContainer:se.getCommonAncestor(Q.startContainer,Q.endContainer)}function zt(Q,L,X,he,Oe){Q.startContainer=L,Q.startOffset=X,Q.endContainer=he,Q.endOffset=Oe,Q.document=se.getDocument(L),Ge(Q)}function pn(Q){zt(this,Q,0,Q,0)}ot(pn,zt),ge.extend(pn,{rangeProperties:Pi,RangeIterator:at,copyComparisonConstants:be,createPrototypeRange:ot,inspect:It,toHtml:Dt,getRangeDocument:ie,rangesEqual:function(Q,L){return Q.startContainer===L.startContainer&&Q.startOffset===L.startOffset&&Q.endContainer===L.endContainer&&Q.endOffset===L.endOffset}}),W.DomRange=pn}),R.createCoreModule("WrappedRange",["DomRange"],function(W,Y){var se,ge,Pe=W.dom,Le=W.util,He=Pe.DomPosition,ft=W.DomRange,Ke=Pe.getBody,Nt=Pe.getContentDocument,yt=Pe.isCharacterDataNode;if(W.features.implementsDomRange&&function(){var K,oe=ft.rangeProperties;function ie(Je){for(var dt=oe.length,It;dt--;)It=oe[dt],Je[It]=Je.nativeRange[It];Je.collapsed=Je.startContainer===Je.endContainer&&Je.startOffset===Je.endOffset}function ce(Je,dt,It,at,Fe){var Re=Je.startContainer!==dt||Je.startOffset!=It,vt=Je.endContainer!==at||Je.endOffset!=Fe,Ye=!Je.equals(Je.nativeRange);(Re||vt||Ye)&&(Je.setEnd(at,Fe),Je.setStart(dt,It))}var Ce;se=function(Je){if(!Je)throw Y.createError("WrappedRange: Range must be specified");this.nativeRange=Je,ie(this)},ft.createPrototypeRange(se,ce),K=se.prototype,K.selectNode=function(Je){this.nativeRange.selectNode(Je),ie(this)},K.cloneContents=function(){return this.nativeRange.cloneContents()},K.surroundContents=function(Je){this.nativeRange.surroundContents(Je),ie(this)},K.collapse=function(Je){this.nativeRange.collapse(Je),ie(this)},K.cloneRange=function(){return new se(this.nativeRange.cloneRange())},K.refresh=function(){ie(this)},K.toString=function(){return this.nativeRange.toString()};var ke=document.createTextNode("test");Ke(document).appendChild(ke);var je=document.createRange();je.setStart(ke,0),je.setEnd(ke,0);try{je.setStart(ke,1),K.setStart=function(Je,dt){this.nativeRange.setStart(Je,dt),ie(this)},K.setEnd=function(Je,dt){this.nativeRange.setEnd(Je,dt),ie(this)},Ce=function(Je){return function(dt){this.nativeRange[Je](dt),ie(this)}}}catch{K.setStart=function(dt,It){try{this.nativeRange.setStart(dt,It)}catch{this.nativeRange.setEnd(dt,It),this.nativeRange.setStart(dt,It)}ie(this)},K.setEnd=function(dt,It){try{this.nativeRange.setEnd(dt,It)}catch{this.nativeRange.setStart(dt,It),this.nativeRange.setEnd(dt,It)}ie(this)},Ce=function(dt,It){return function(at){try{this.nativeRange[dt](at)}catch{this.nativeRange[It](at),this.nativeRange[dt](at)}ie(this)}}}K.setStartBefore=Ce("setStartBefore","setEndBefore"),K.setStartAfter=Ce("setStartAfter","setEndAfter"),K.setEndBefore=Ce("setEndBefore","setStartBefore"),K.setEndAfter=Ce("setEndAfter","setStartAfter"),K.selectNodeContents=function(Je){this.setStartAndEnd(Je,0,Pe.getNodeLength(Je))},je.selectNodeContents(ke),je.setEnd(ke,3);var Ze=document.createRange();Ze.selectNodeContents(ke),Ze.setEnd(ke,4),Ze.setStart(ke,2),je.compareBoundaryPoints(je.START_TO_END,Ze)==-1&&je.compareBoundaryPoints(je.END_TO_START,Ze)==1?K.compareBoundaryPoints=function(Je,dt){return dt=dt.nativeRange||dt,Je==dt.START_TO_END?Je=dt.END_TO_START:Je==dt.END_TO_START&&(Je=dt.START_TO_END),this.nativeRange.compareBoundaryPoints(Je,dt)}:K.compareBoundaryPoints=function(Je,dt){return this.nativeRange.compareBoundaryPoints(Je,dt.nativeRange||dt)};var ct=document.createElement("div");ct.innerHTML="123";var pt=ct.firstChild,Rt=Ke(document);Rt.appendChild(ct),je.setStart(pt,1),je.setEnd(pt,2),je.deleteContents(),pt.data=="13"&&(K.deleteContents=function(){this.nativeRange.deleteContents(),ie(this)},K.extractContents=function(){var Je=this.nativeRange.extractContents();return ie(this),Je}),Rt.removeChild(ct),Rt=null,Le.isHostMethod(je,"createContextualFragment")&&(K.createContextualFragment=function(Je){return this.nativeRange.createContextualFragment(Je)}),Ke(document).removeChild(ke),K.getName=function(){return"WrappedRange"},W.WrappedRange=se,W.createNativeRange=function(Je){return Je=Nt(Je,Y,"createNativeRange"),Je.createRange()}}(),W.features.implementsTextRange){var Wt=function(K){var oe=K.parentElement(),ie=K.duplicate();ie.collapse(!0);var ce=ie.parentElement();ie=K.duplicate(),ie.collapse(!1);var Ce=ie.parentElement(),ke=ce==Ce?ce:Pe.getCommonAncestor(ce,Ce);return ke==oe?ke:Pe.getCommonAncestor(oe,ke)},Ft=function(K){return K.compareEndPoints("StartToEnd",K)==0},te=function(K,oe,ie,ce,Ce){var ke=K.duplicate();ke.collapse(ie);var je=ke.parentElement();if(Pe.isOrIsAncestorOf(oe,je)||(je=oe),!je.canHaveHTML){var Ze=new He(je.parentNode,Pe.getNodeIndex(je));return{boundaryPosition:Ze,nodeInfo:{nodeIndex:Ze.offset,containerElement:Ze.node}}}var ct=Pe.getDocument(je).createElement("span");ct.parentNode&&Pe.removeNode(ct);for(var pt,Rt=ie?"StartToStart":"StartToEnd",Je,dt,It,at,Fe=Ce&&Ce.containerElement==je?Ce.nodeIndex:0,Re=je.childNodes.length,vt=Re,Ye=vt;Ye==Re?je.appendChild(ct):je.insertBefore(ct,je.childNodes[Ye]),ke.moveToElementText(ct),pt=ke.compareEndPoints(Rt,K),!(pt==0||Fe==vt);){if(pt==-1){if(vt==Fe+1)break;Fe=Ye}else vt=vt==Fe+1?Fe:Ye;Ye=Math.floor((Fe+vt)/2),je.removeChild(ct)}if(at=ct.nextSibling,pt==-1&&at&&yt(at)){ke.setEndPoint(ie?"EndToStart":"EndToEnd",K);var Qe;if(/[\r\n]/.test(at.data)){var nt=ke.duplicate(),St=nt.text.replace(/\r\n/g,"\r").length;for(Qe=nt.moveStart("character",St);(pt=nt.compareEndPoints("StartToEnd",nt))==-1;)Qe++,nt.moveStart("character",1)}else Qe=ke.text.length;It=new He(at,Qe)}else Je=(ce||!ie)&&ct.previousSibling,dt=(ce||ie)&&ct.nextSibling,dt&&yt(dt)?It=new He(dt,0):Je&&yt(Je)?It=new He(Je,Je.data.length):It=new He(je,Pe.getNodeIndex(ct));return Pe.removeNode(ct),{boundaryPosition:It,nodeInfo:{nodeIndex:Ye,containerElement:je}}},A=function(K,oe){var ie,ce,Ce=K.offset,ke=Pe.getDocument(K.node),je,Ze,ct=Ke(ke).createTextRange(),pt=yt(K.node);return pt?(ie=K.node,ce=ie.parentNode):(Ze=K.node.childNodes,ie=Ce<Ze.length?Ze[Ce]:null,ce=K.node),je=ke.createElement("span"),je.innerHTML="&#feff;",ie?ce.insertBefore(je,ie):ce.appendChild(je),ct.moveToElementText(je),ct.collapse(!oe),ce.removeChild(je),pt&&ct[oe?"moveStart":"moveEnd"]("character",Ce),ct};ge=function(K){this.textRange=K,this.refresh()},ge.prototype=new ft(document),ge.prototype.refresh=function(){var K,oe,ie,ce=Wt(this.textRange);Ft(this.textRange)?oe=K=te(this.textRange,ce,!0,!0).boundaryPosition:(ie=te(this.textRange,ce,!0,!1),K=ie.boundaryPosition,oe=te(this.textRange,ce,!1,!1,ie.nodeInfo).boundaryPosition),this.setStart(K.node,K.offset),this.setEnd(oe.node,oe.offset)},ge.prototype.getName=function(){return"WrappedTextRange"},ft.copyComparisonConstants(ge);var F=function(K){if(K.collapsed)return A(new He(K.startContainer,K.startOffset),!0);var oe=A(new He(K.startContainer,K.startOffset),!0),ie=A(new He(K.endContainer,K.endOffset),!1),ce=Ke(ft.getRangeDocument(K)).createTextRange();return ce.setEndPoint("StartToStart",oe),ce.setEndPoint("EndToEnd",ie),ce};if(ge.rangeToTextRange=F,ge.prototype.toTextRange=function(){return F(this)},W.WrappedTextRange=ge,!W.features.implementsDomRange||W.config.preferTextRange){var ee=function(K){return K("return this;")()}(Function);typeof ee.Range>"u"&&(ee.Range=ge),W.createNativeRange=function(K){return K=Nt(K,Y,"createNativeRange"),Ke(K).createTextRange()},W.WrappedRange=ge}}W.createRange=function(K){return K=Nt(K,Y,"createRange"),new W.WrappedRange(W.createNativeRange(K))},W.createRangyRange=function(K){return K=Nt(K,Y,"createRangyRange"),new ft(K)},Le.createAliasForDeprecatedMethod(W,"createIframeRange","createRange"),Le.createAliasForDeprecatedMethod(W,"createIframeRangyRange","createRangyRange"),W.addShimListener(function(K){var oe=K.document;typeof oe.createRange>"u"&&(oe.createRange=function(){return W.createRange(oe)}),oe=K=null})}),R.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(W,Y){W.config.checkSelectionRanges=!0;var se="boolean",ge="number",Pe=W.dom,Le=W.util,He=Le.isHostMethod,ft=W.DomRange,Ke=W.WrappedRange,Nt=W.DOMException,yt=Pe.DomPosition,Wt,Ft,te=W.features,A="Control",F=Pe.getDocument,ee=Pe.getBody,K=ft.rangesEqual;function oe(Z){return typeof Z=="string"?/^backward(s)?$/i.test(Z):!!Z}function ie(Z,be){if(Z){if(Pe.isWindow(Z))return Z;if(Z instanceof Zt)return Z.win;var Xe=Pe.getContentDocument(Z,Y,be);return Pe.getWindow(Xe)}else return window}function ce(Z){return ie(Z,"getWinSelection").getSelection()}function Ce(Z){return ie(Z,"getDocSelection").document.selection}function ke(Z){var be=!1;return Z.anchorNode&&(be=Pe.comparePoints(Z.anchorNode,Z.anchorOffset,Z.focusNode,Z.focusOffset)==1),be}var je=He(window,"getSelection"),Ze=Le.isHostObject(document,"selection");te.implementsWinGetSelection=je,te.implementsDocSelection=Ze;var ct=Ze&&(!je||W.config.preferTextRange);if(ct)Wt=Ce,W.isSelectionValid=function(Z){var be=ie(Z,"isSelectionValid").document,Xe=be.selection;return Xe.type!="None"||F(Xe.createRange().parentElement())==be};else if(je)Wt=ce,W.isSelectionValid=function(){return!0};else return Y.fail("Neither document.selection or window.getSelection() detected."),!1;W.getNativeSelection=Wt;var pt=Wt();if(!pt)return Y.fail("Native selection was null (possibly issue 138?)"),!1;var Rt=W.createNativeRange(document),Je=ee(document),dt=Le.areHostProperties(pt,["anchorNode","focusNode","anchorOffset","focusOffset"]);te.selectionHasAnchorAndFocus=dt;var It=He(pt,"extend");te.selectionHasExtend=It;var at=He(pt,"setBaseAndExtent");te.selectionHasSetBaseAndExtent=at;var Fe=typeof pt.rangeCount==ge;te.selectionHasRangeCount=Fe;var Re=!1,vt=!0,Ye=It?function(Z,be){var Xe=ft.getRangeDocument(be),ot=W.createRange(Xe);ot.collapseToPoint(be.endContainer,be.endOffset),Z.addRange(Et(ot)),Z.extend(be.startContainer,be.startOffset)}:null;Le.areHostMethods(pt,["addRange","getRangeAt","removeAllRanges"])&&typeof pt.rangeCount==ge&&te.implementsDomRange&&function(){var Z=window.getSelection();if(Z){for(var be=Z.rangeCount,Xe=be>1,ot=[],Ge=ke(Z),zt=0;zt<be;++zt)ot[zt]=Z.getRangeAt(zt);var pn=Pe.createTestElement(document,"",!1),Q=pn.appendChild(document.createTextNode("   ")),L=document.createRange();if(L.setStart(Q,1),L.collapse(!0),Z.removeAllRanges(),Z.addRange(L),vt=Z.rangeCount==1,Z.removeAllRanges(),!Xe){var X=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(X&&parseInt(X[1])>=36)Re=!1;else{var he=L.cloneRange();L.setStart(Q,0),he.setEnd(Q,3),he.setStart(Q,2),Z.addRange(L),Z.addRange(he),Re=Z.rangeCount==2}}for(Pe.removeNode(pn),Z.removeAllRanges(),zt=0;zt<be;++zt)zt==0&&Ge?Ye?Ye(Z,ot[zt]):(W.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),Z.addRange(ot[zt])):Z.addRange(ot[zt])}}(),te.selectionSupportsMultipleRanges=Re,te.collapsedNonEditableSelectionsSupported=vt;var Qe=!1,nt;Je&&He(Je,"createControlRange")&&(nt=Je.createControlRange(),Le.areHostProperties(nt,["item","add"])&&(Qe=!0)),te.implementsControlRange=Qe,dt?Ft=function(Z){return Z.anchorNode===Z.focusNode&&Z.anchorOffset===Z.focusOffset}:Ft=function(Z){return Z.rangeCount?Z.getRangeAt(Z.rangeCount-1).collapsed:!1};function St(Z,be,Xe){var ot=Xe?"end":"start",Ge=Xe?"start":"end";Z.anchorNode=be[ot+"Container"],Z.anchorOffset=be[ot+"Offset"],Z.focusNode=be[Ge+"Container"],Z.focusOffset=be[Ge+"Offset"]}function xe(Z){var be=Z.nativeSelection;Z.anchorNode=be.anchorNode,Z.anchorOffset=be.anchorOffset,Z.focusNode=be.focusNode,Z.focusOffset=be.focusOffset}function qe(Z){Z.anchorNode=Z.focusNode=null,Z.anchorOffset=Z.focusOffset=0,Z.rangeCount=0,Z.isCollapsed=!0,Z._ranges.length=0,gt(Z)}function gt(Z){Z.type=Z.rangeCount==0?"None":Ft(Z)?"Caret":"Range"}function Et(Z){var be;return Z instanceof ft?(be=W.createNativeRange(Z.getDocument()),be.setEnd(Z.endContainer,Z.endOffset),be.setStart(Z.startContainer,Z.startOffset)):Z instanceof Ke?be=Z.nativeRange:te.implementsDomRange&&Z instanceof Pe.getWindow(Z.startContainer).Range&&(be=Z),be}function qt(Z){if(!Z.length||Z[0].nodeType!=1)return!1;for(var be=1,Xe=Z.length;be<Xe;++be)if(!Pe.isAncestorOf(Z[0],Z[be]))return!1;return!0}function Gt(Z){var be=Z.getNodes();if(!qt(be))throw Y.createError("getSingleElementFromRange: range "+Z.inspect()+" did not consist of a single element");return be[0]}function Qn(Z){return!!Z&&typeof Z.text<"u"}function mn(Z,be){var Xe=new Ke(be);Z._ranges=[Xe],St(Z,Xe,!1),Z.rangeCount=1,Z.isCollapsed=Xe.collapsed,gt(Z)}function zn(Z){if(Z._ranges.length=0,Z.docSelection.type=="None")qe(Z);else{var be=Z.docSelection.createRange();if(Qn(be))mn(Z,be);else{Z.rangeCount=be.length;for(var Xe,ot=F(be.item(0)),Ge=0;Ge<Z.rangeCount;++Ge)Xe=W.createRange(ot),Xe.selectNode(be.item(Ge)),Z._ranges.push(Xe);Z.isCollapsed=Z.rangeCount==1&&Z._ranges[0].collapsed,St(Z,Z._ranges[Z.rangeCount-1],!1),gt(Z)}}}function Kr(Z,be){for(var Xe=Z.docSelection.createRange(),ot=Gt(be),Ge=F(Xe.item(0)),zt=ee(Ge).createControlRange(),pn=0,Q=Xe.length;pn<Q;++pn)zt.add(Xe.item(pn));try{zt.add(ot)}catch{throw Y.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}zt.select(),zn(Z)}var Jr;He(pt,"getRangeAt")?Jr=function(Z,be){try{return Z.getRangeAt(be)}catch{return null}}:dt&&(Jr=function(Z){var be=F(Z.anchorNode),Xe=W.createRange(be);return Xe.setStartAndEnd(Z.anchorNode,Z.anchorOffset,Z.focusNode,Z.focusOffset),Xe.collapsed!==this.isCollapsed&&Xe.setStartAndEnd(Z.focusNode,Z.focusOffset,Z.anchorNode,Z.anchorOffset),Xe});function Zt(Z,be,Xe){this.nativeSelection=Z,this.docSelection=be,this._ranges=[],this.win=Xe,this.refresh()}Zt.prototype=W.selectionPrototype;function Mr(Z){Z.win=Z.anchorNode=Z.focusNode=Z._ranges=null,Z.rangeCount=Z.anchorOffset=Z.focusOffset=0,Z.detached=!0,gt(Z)}var Nn=[];function Ar(Z,be){for(var Xe=Nn.length,ot,Ge;Xe--;)if(ot=Nn[Xe],Ge=ot.selection,be=="deleteAll")Mr(Ge);else if(ot.win==Z)return be=="delete"?(Nn.splice(Xe,1),!0):Ge;return be=="deleteAll"&&(Nn.length=0),null}var ui=function(Z){if(Z&&Z instanceof Zt)return Z.refresh(),Z;Z=ie(Z,"getNativeSelection");var be=Ar(Z),Xe=Wt(Z),ot=Ze?Ce(Z):null;return be?(be.nativeSelection=Xe,be.docSelection=ot,be.refresh()):(be=new Zt(Xe,ot,Z),Nn.push({win:Z,selection:be})),be};W.getSelection=ui,Le.createAliasForDeprecatedMethod(W,"getIframeSelection","getSelection");var Dt=Zt.prototype;function Pi(Z,be){for(var Xe=F(be[0].startContainer),ot=ee(Xe).createControlRange(),Ge=0,zt,pn=be.length;Ge<pn;++Ge){zt=Gt(be[Ge]);try{ot.add(zt)}catch{throw Y.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}ot.select(),zn(Z)}if(!ct&&dt&&Le.areHostMethods(pt,["removeAllRanges","addRange"])){Dt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),qe(this)};var Wr=function(Z,be){Ye(Z.nativeSelection,be),Z.refresh()};Fe?Dt.addRange=function(Z,be){if(Qe&&Ze&&this.docSelection.type==A)Kr(this,Z);else if(oe(be)&&It)Wr(this,Z);else{var Xe;Re?Xe=this.rangeCount:(this.removeAllRanges(),Xe=0);var ot=Et(Z).cloneRange();try{this.nativeSelection.addRange(ot)}catch{}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==Xe+1){if(W.config.checkSelectionRanges){var Ge=Jr(this.nativeSelection,this.rangeCount-1);Ge&&!K(Ge,Z)&&(Z=new Ke(Ge))}this._ranges[this.rangeCount-1]=Z,St(this,Z,dr(this.nativeSelection)),this.isCollapsed=Ft(this),gt(this)}else this.refresh()}}:Dt.addRange=function(Z,be){oe(be)&&It?Wr(this,Z):(this.nativeSelection.addRange(Et(Z)),this.refresh())},Dt.setRanges=function(Z){if(Qe&&Ze&&Z.length>1)Pi(this,Z);else{this.removeAllRanges();for(var be=0,Xe=Z.length;be<Xe;++be)this.addRange(Z[be])}}}else if(He(pt,"empty")&&He(Rt,"select")&&Qe&&ct)Dt.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var Z;if(this.anchorNode)Z=F(this.anchorNode);else if(this.docSelection.type==A){var be=this.docSelection.createRange();be.length&&(Z=F(be.item(0)))}if(Z){var Xe=ee(Z).createTextRange();Xe.select(),this.docSelection.empty()}}}catch{}qe(this)},Dt.addRange=function(Z){this.docSelection.type==A?Kr(this,Z):(W.WrappedTextRange.rangeToTextRange(Z).select(),this._ranges[0]=Z,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,St(this,Z,!1),gt(this))},Dt.setRanges=function(Z){this.removeAllRanges();var be=Z.length;be>1?Pi(this,Z):be&&this.addRange(Z[0])};else return Y.fail("No means of selecting a Range or TextRange was found"),!1;Dt.getRangeAt=function(Z){if(Z<0||Z>=this.rangeCount)throw new Nt("INDEX_SIZE_ERR");return this._ranges[Z].cloneRange()};var Wn;if(ct)Wn=function(Z){var be;W.isSelectionValid(Z.win)?be=Z.docSelection.createRange():(be=ee(Z.win.document).createTextRange(),be.collapse(!0)),Z.docSelection.type==A?zn(Z):Qn(be)?mn(Z,be):qe(Z)};else if(He(pt,"getRangeAt")&&typeof pt.rangeCount==ge)Wn=function(Z){if(Qe&&Ze&&Z.docSelection.type==A)zn(Z);else if(Z._ranges.length=Z.rangeCount=Z.nativeSelection.rangeCount,Z.rangeCount){for(var be=0,Xe=Z.rangeCount;be<Xe;++be)Z._ranges[be]=new W.WrappedRange(Z.nativeSelection.getRangeAt(be));St(Z,Z._ranges[Z.rangeCount-1],dr(Z.nativeSelection)),Z.isCollapsed=Ft(Z),gt(Z)}else qe(Z)};else if(dt&&typeof pt.isCollapsed==se&&typeof Rt.collapsed==se&&te.implementsDomRange)Wn=function(Z){var be,Xe=Z.nativeSelection;Xe.anchorNode?(be=Jr(Xe,0),Z._ranges=[be],Z.rangeCount=1,xe(Z),Z.isCollapsed=Ft(Z),gt(Z)):qe(Z)};else return Y.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Dt.refresh=function(Z){var be=Z?this._ranges.slice(0):null,Xe=this.anchorNode,ot=this.anchorOffset;if(Wn(this),Z){var Ge=be.length;if(Ge!=this._ranges.length||this.anchorNode!=Xe||this.anchorOffset!=ot)return!0;for(;Ge--;)if(!K(be[Ge],this._ranges[Ge]))return!0;return!1}};var ur=function(Z,be){var Xe=Z.getAllRanges();Z.removeAllRanges();for(var ot=0,Ge=Xe.length;ot<Ge;++ot)K(be,Xe[ot])||Z.addRange(Xe[ot]);Z.rangeCount||qe(Z)};Qe&&Ze?Dt.removeRange=function(Z){if(this.docSelection.type==A){for(var be=this.docSelection.createRange(),Xe=Gt(Z),ot=F(be.item(0)),Ge=ee(ot).createControlRange(),zt,pn=!1,Q=0,L=be.length;Q<L;++Q)zt=be.item(Q),zt!==Xe||pn?Ge.add(be.item(Q)):pn=!0;Ge.select(),zn(this)}else ur(this,Z)}:Dt.removeRange=function(Z){ur(this,Z)};var dr;!ct&&dt&&te.implementsDomRange?(dr=ke,Dt.isBackward=function(){return dr(this)}):dr=Dt.isBackward=function(){return!1},Dt.isBackwards=Dt.isBackward,Dt.toString=function(){for(var Z=[],be=0,Xe=this.rangeCount;be<Xe;++be)Z[be]=""+this._ranges[be];return Z.join("")};function Tr(Z,be){if(Z.win.document!=F(be))throw new Nt("WRONG_DOCUMENT_ERR")}function Zr(Z,be){if(be<0||be>(Pe.isCharacterDataNode(Z)?Z.length:Z.childNodes.length))throw new Nt("INDEX_SIZE_ERR")}Dt.collapse=function(Z,be){Tr(this,Z);var Xe=W.createRange(Z);Xe.collapseToPoint(Z,be),this.setSingleRange(Xe),this.isCollapsed=!0},Dt.collapseToStart=function(){if(this.rangeCount){var Z=this._ranges[0];this.collapse(Z.startContainer,Z.startOffset)}else throw new Nt("INVALID_STATE_ERR")},Dt.collapseToEnd=function(){if(this.rangeCount){var Z=this._ranges[this.rangeCount-1];this.collapse(Z.endContainer,Z.endOffset)}else throw new Nt("INVALID_STATE_ERR")},Dt.selectAllChildren=function(Z){Tr(this,Z);var be=W.createRange(Z);be.selectNodeContents(Z),this.setSingleRange(be)},at?Dt.setBaseAndExtent=function(Z,be,Xe,ot){this.nativeSelection.setBaseAndExtent(Z,be,Xe,ot),this.refresh()}:It&&(Dt.setBaseAndExtent=function(Z,be,Xe,ot){Zr(Z,be),Zr(Xe,ot),Tr(this,Z),Tr(this,Xe);var Ge=W.createRange(node),zt=Pe.comparePoints(Z,be,Xe,ot)==-1;zt?Ge.setStartAndEnd(Xe,ot,Z,be):Ge.setStartAndEnd(Z,be,Xe,ot),this.setSingleRange(Ge,zt)}),Dt.deleteFromDocument=function(){if(Qe&&Ze&&this.docSelection.type==A){for(var Z=this.docSelection.createRange(),be;Z.length;)be=Z.item(0),Z.remove(be),Pe.removeNode(be);this.refresh()}else if(this.rangeCount){var Xe=this.getAllRanges();if(Xe.length){this.removeAllRanges();for(var ot=0,Ge=Xe.length;ot<Ge;++ot)Xe[ot].deleteContents();this.addRange(Xe[Ge-1])}}},Dt.eachRange=function(Z,be){for(var Xe=0,ot=this._ranges.length;Xe<ot;++Xe)if(Z(this.getRangeAt(Xe)))return be},Dt.getAllRanges=function(){var Z=[];return this.eachRange(function(be){Z.push(be)}),Z},Dt.setSingleRange=function(Z,be){this.removeAllRanges(),this.addRange(Z,be)},Dt.callMethodOnEachRange=function(Z,be){var Xe=[];return this.eachRange(function(ot){Xe.push(ot[Z].apply(ot,be||[]))}),Xe};function Dr(Z){return function(be,Xe){var ot;this.rangeCount?(ot=this.getRangeAt(0),ot["set"+(Z?"Start":"End")](be,Xe)):(ot=W.createRange(this.win.document),ot.setStartAndEnd(be,Xe)),this.setSingleRange(ot,this.isBackward())}}Dt.setStart=Dr(!0),Dt.setEnd=Dr(!1),W.rangePrototype.select=function(Z){ui(this.getDocument()).setSingleRange(this,Z)},Dt.changeEachRange=function(Z){var be=[],Xe=this.isBackward();this.eachRange(function(ot){Z(ot),be.push(ot)}),this.removeAllRanges(),Xe&&be.length==1?this.addRange(be[0],"backward"):this.setRanges(be)},Dt.containsNode=function(Z,be){return this.eachRange(function(Xe){return Xe.containsNode(Z,be)},!0)||!1},Dt.getBookmark=function(Z){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[Z])}},Dt.moveToBookmark=function(Z){for(var be=[],Xe=0,ot,Ge;ot=Z.rangeBookmarks[Xe++];)Ge=W.createRange(this.win),Ge.moveToBookmark(ot),be.push(Ge);Z.backward?this.setSingleRange(be[0],"backward"):this.setRanges(be)},Dt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Dt.restoreRanges=function(Z){this.removeAllRanges();for(var be=0,Xe;Xe=Z.ranges[be];++be)this.addRange(Xe,Z.backward&&be==0)},Dt.toHtml=function(){var Z=[];return this.eachRange(function(be){Z.push(ft.toHtml(be))}),Z.join("")},te.implementsTextRange&&(Dt.getNativeTextRange=function(){var Z;if(Z=this.docSelection){var be=Z.createRange();if(Qn(be))return be;throw Y.createError("getNativeTextRange: selection is a control selection")}else{if(this.rangeCount>0)return W.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw Y.createError("getNativeTextRange: selection contains no range")}});function Ur(Z){var be=[],Xe=new yt(Z.anchorNode,Z.anchorOffset),ot=new yt(Z.focusNode,Z.focusOffset),Ge=typeof Z.getName=="function"?Z.getName():"Selection";if(typeof Z.rangeCount<"u")for(var zt=0,pn=Z.rangeCount;zt<pn;++zt)be[zt]=ft.inspect(Z.getRangeAt(zt));return"["+Ge+"(Ranges: "+be.join(", ")+")(anchor: "+Xe.inspect()+", focus: "+ot.inspect()+"]"}Dt.getName=function(){return"WrappedSelection"},Dt.inspect=function(){return Ur(this)},Dt.detach=function(){Ar(this.win,"delete"),Mr(this)},Zt.detachAll=function(){Ar(null,"deleteAll")},Zt.inspect=Ur,Zt.isDirectionBackward=oe,W.Selection=Zt,W.selectionPrototype=Dt,W.addShimListener(function(Z){typeof Z.getSelection>"u"&&(Z.getSelection=function(){return ui(Z)}),Z=null})});var de=!1,le=function(W){de||(de=!0,!R.initialized&&R.config.autoInitialize&&j())};return O&&(document.readyState=="complete"?le():(d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",le,!1),J(window,"load",le))),R})}(Kf)),Kf.exports}var t6=Tw();const O0=ha(t6);var Jf={exports:{}},N0;function n6(){return N0||(N0=1,function(r,e){(function(t,n){r.exports=t(Tw())})(function(t){return t.createModule("ClassApplier",["WrappedSelection"],function(n,i){var o=n.dom,a=o.DomPosition,l=o.arrayContains,u=n.util,d=u.forEach,f="span",h=u.isHostMethod(document,"createElementNS");function g(te,A){for(var F in te)if(te.hasOwnProperty(F)&&A(F,te[F])===!1)return!1;return!0}function y(te){return te.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function w(te,A){return!!te&&new RegExp("(?:^|\\s)"+A+"(?:\\s|$)").test(te)}function x(te,A){if(typeof te.classList=="object")return te.classList.contains(A);var F=typeof te.className=="string",ee=F?te.className:te.getAttribute("class");return w(ee,A)}function b(te,A){if(typeof te.classList=="object")te.classList.add(A);else{var F=typeof te.className=="string",ee=F?te.className:te.getAttribute("class");ee?w(ee,A)||(ee+=" "+A):ee=A,F?te.className=ee:te.setAttribute("class",ee)}}var _=function(){function te(A,F,ee){return F&&ee?" ":""}return function(A,F){if(typeof A.classList=="object")A.classList.remove(F);else{var ee=typeof A.className=="string",K=ee?A.className:A.getAttribute("class");K=K.replace(new RegExp("(^|\\s)"+F+"(\\s|$)"),te),ee?A.className=K:A.setAttribute("class",K)}}}();function S(te){var A=typeof te.className=="string";return A?te.className:te.getAttribute("class")}function k(te){return te&&te.split(/\s+/).sort().join(" ")}function O(te){return k(S(te))}function M(te,A){return O(te)==O(A)}function R(te,A){for(var F=A.split(/\s+/),ee=0,K=F.length;ee<K;++ee)if(!x(te,y(F[ee])))return!1;return!0}function T(te){var A=te.parentNode;return A&&A.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(A.nodeName)}function I(te,A,F,ee,K){var oe=te.node,ie=te.offset,ce=oe,Ce=ie;oe==ee&&ie>K&&++Ce,oe==A&&(ie==F||ie==F+1)&&(ce=ee,Ce+=K-F),oe==A&&ie>F+1&&--Ce,te.node=ce,te.offset=Ce}function $(te,A,F){te.node==A&&te.offset>F&&--te.offset}function ne(te,A,F,ee){F==-1&&(F=A.childNodes.length);var K=te.parentNode,oe=o.getNodeIndex(te);d(ee,function(ie){I(ie,K,oe,A,F)}),A.childNodes.length==F?A.appendChild(te):A.insertBefore(te,A.childNodes[F])}function V(te,A){var F=te.parentNode,ee=o.getNodeIndex(te);d(A,function(K){$(K,F,ee)}),o.removeNode(te)}function J(te,A,F,ee,K){for(var oe,ie=[];oe=te.firstChild;)ne(oe,A,F++,K),ie.push(oe);return V(te,K),ie}function D(te,A){return J(te,te.parentNode,o.getNodeIndex(te),!0,A)}function U(te,A){var F=te.cloneRange();F.selectNodeContents(A);var ee=F.intersection(te),K=ee?ee.toString():"";return K!=""}function j(te){for(var A=te.getNodes([3]),F=0,ee;(ee=A[F])&&!U(te,ee);)++F;for(var K=A.length-1;(ee=A[K])&&!U(te,ee);)--K;return A.slice(F,K+1)}function fe(te,A){if(te.attributes.length!=A.attributes.length)return!1;for(var F=0,ee=te.attributes.length,K,oe,ie;F<ee;++F)if(K=te.attributes[F],ie=K.name,ie!="class"&&(oe=A.attributes.getNamedItem(ie),K===null!=(oe===null)||K.specified!=oe.specified||K.specified&&K.nodeValue!==oe.nodeValue))return!1;return!0}function Ee(te,A){for(var F=0,ee=te.attributes.length,K;F<ee;++F)if(K=te.attributes[F].name,!(A&&l(A,K))&&te.attributes[F].specified&&K!="class")return!0;return!1}var _e=o.getComputedStyleProperty,rt=function(){var te=document.createElement("div");return typeof te.isContentEditable=="boolean"?function(A){return A&&A.nodeType==1&&A.isContentEditable}:function(A){return!A||A.nodeType!=1||A.contentEditable=="false"?!1:A.contentEditable=="true"||rt(A.parentNode)}}();function Me(te){var A;return te&&te.nodeType==1&&((A=te.parentNode)&&A.nodeType==9&&A.designMode=="on"||rt(te)&&!rt(te.parentNode))}function ve(te){return(rt(te)||te.nodeType!=1&&rt(te.parentNode))&&!Me(te)}var Ve=/^inline(-block|-table)?$/i;function Be(te){return te&&te.nodeType==1&&!Ve.test(_e(te,"display"))}var de=/[^\r\n\t\f \u200B]/;function le(te){if(te.data.length==0)return!0;if(de.test(te.data))return!1;var A=_e(te.parentNode,"whiteSpace");switch(A){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(te.data))return!1}return Be(te.previousSibling)||Be(te.nextSibling)}function W(te){var A=[],F,ee;for(F=0;ee=te[F++];)A.push(new a(ee.startContainer,ee.startOffset),new a(ee.endContainer,ee.endOffset));return A}function Y(te,A){for(var F=0,ee,K,oe,ie=te.length;F<ie;++F)ee=te[F],K=A[F*2],oe=A[F*2+1],ee.setStartAndEnd(K.node,K.offset,oe.node,oe.offset)}function se(te,A){return o.isCharacterDataNode(te)?A==0?!!te.previousSibling:A==te.length?!!te.nextSibling:!0:A>0&&A<te.childNodes.length}function ge(te,A,F,ee){var K,oe,ie=F==0;if(o.isAncestorOf(A,te))return te;if(o.isCharacterDataNode(A)){var ce=o.getNodeIndex(A);if(F==0)F=ce;else if(F==A.length)F=ce+1;else throw i.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+F+" in "+A.data);A=A.parentNode}if(se(A,F)){K=A.cloneNode(!1),oe=A.parentNode,K.id&&K.removeAttribute("id");for(var Ce,ke=0;Ce=A.childNodes[F];)ne(Ce,K,ke++,ee);return ne(K,oe,o.getNodeIndex(A)+1,ee),A==te?K:ge(te,oe,o.getNodeIndex(K),ee)}else if(te!=A){K=A.parentNode;var je=o.getNodeIndex(A);return ie||je++,ge(te,K,je,ee)}return te}function Pe(te,A){return te.namespaceURI==A.namespaceURI&&te.tagName.toLowerCase()==A.tagName.toLowerCase()&&M(te,A)&&fe(te,A)&&_e(te,"display")=="inline"&&_e(A,"display")=="inline"}function Le(te){var A=te?"nextSibling":"previousSibling";return function(F,ee){var K=F.parentNode,oe=F[A];if(oe){if(oe&&oe.nodeType==3)return oe}else if(ee&&(oe=K[A],oe&&oe.nodeType==1&&Pe(K,oe))){var ie=oe[te?"firstChild":"lastChild"];if(ie&&ie.nodeType==3)return ie}return null}}var He=Le(!1),ft=Le(!0);function Ke(te){this.isElementMerge=te.nodeType==1,this.textNodes=[];var A=this.isElementMerge?te.lastChild:te;A&&(this.textNodes[0]=A)}Ke.prototype={doMerge:function(te){var A=this.textNodes,F=A[0];if(A.length>1){var ee=o.getNodeIndex(F),K=[],oe=0,ie;d(A,function(ce,Ce){ie=ce.parentNode,Ce>0&&(ie.removeChild(ce),ie.hasChildNodes()||o.removeNode(ie),te&&d(te,function(ke){ke.node==ce&&(ke.node=F,ke.offset+=oe),ke.node==ie&&ke.offset>ee&&(--ke.offset,ke.offset==ee+1&&Ce<A.length-1&&(ke.node=F,ke.offset=oe))})),K[Ce]=ce.data,oe+=ce.data.length}),F.data=K.join("")}return F.data},getLength:function(){for(var te=this.textNodes.length,A=0;te--;)A+=this.textNodes[te].length;return A},toString:function(){var te=[];return d(this.textNodes,function(A,F){te[F]="'"+A.data+"'"}),"[Merge("+te.join(",")+")]"}};var Nt=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],yt={};function Wt(te,A,F){var ee,K,oe,ie,ce=this;ce.cssClass=ce.className=te;var Ce=null,ke={};if(typeof A=="object"&&A!==null){for(typeof A.elementTagName<"u"&&(A.elementTagName=A.elementTagName.toLowerCase()),F=A.tagNames,Ce=A.elementProperties,ke=A.elementAttributes,K=0;ie=Nt[K++];)A.hasOwnProperty(ie)&&(ce[ie]=A[ie]);ee=A.normalize}else ee=A;ce.normalize=typeof ee>"u"?!0:ee,ce.attrExceptions=[];var je=document.createElement(ce.elementTagName);ce.elementProperties=ce.copyPropertiesToElement(Ce,je,!0),g(ke,function(ct,pt){ce.attrExceptions.push(ct),ke[ct]=""+pt}),ce.elementAttributes=ke,ce.elementSortedClassName=ce.elementProperties.hasOwnProperty("className")?k(ce.elementProperties.className+" "+te):te,ce.applyToAnyTagName=!1;var Ze=typeof F;if(Ze=="string")F=="*"?ce.applyToAnyTagName=!0:ce.tagNames=y(F.toLowerCase()).split(/\s*,\s*/);else if(Ze=="object"&&typeof F.length=="number")for(ce.tagNames=[],K=0,oe=F.length;K<oe;++K)F[K]=="*"?ce.applyToAnyTagName=!0:ce.tagNames.push(F[K].toLowerCase());else ce.tagNames=[ce.elementTagName]}Wt.prototype={elementTagName:f,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(te,A,F){var ee,K,oe={},ie,ce,Ce,ke;for(var je in te)if(te.hasOwnProperty(je))if(ce=te[je],Ce=A[je],je=="className")b(A,ce),b(A,this.className),A[je]=k(A[je]),F&&(oe[je]=ce);else if(je=="style"){K=Ce,F&&(oe[je]=ie={});for(ee in te[je])te[je].hasOwnProperty(ee)&&(K[ee]=ce[ee],F&&(ie[ee]=K[ee]));this.attrExceptions.push(je)}else A[je]=ce,F&&(oe[je]=A[je],ke=yt.hasOwnProperty(je)?yt[je]:je,this.attrExceptions.push(ke));return F?oe:""},copyAttributesToElement:function(te,A){for(var F in te)te.hasOwnProperty(F)&&!/^class(?:Name)?$/i.test(F)&&A.setAttribute(F,te[F])},appliesToElement:function(te){return l(this.tagNames,te.tagName.toLowerCase())},getEmptyElements:function(te){var A=this;return te.getNodes([1],function(F){return A.appliesToElement(F)&&!F.hasChildNodes()})},hasClass:function(te){return te.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(te))&&x(te,this.className)},getSelfOrAncestorWithClass:function(te){for(;te;){if(this.hasClass(te))return te;te=te.parentNode}return null},isModifiable:function(te){return!this.applyToEditableOnly||ve(te)},isIgnorableWhiteSpaceNode:function(te){return this.ignoreWhiteSpace&&te&&te.nodeType==3&&le(te)},postApply:function(te,A,F,ee){var K=te[0],oe=te[te.length-1],ie=[],ce,Ce=K,ke=oe,je=0,Ze=oe.length,ct;d(te,function(dt){ct=He(dt,!ee),ct?(ce||(ce=new Ke(ct),ie.push(ce)),ce.textNodes.push(dt),dt===K&&(Ce=ce.textNodes[0],je=Ce.length),dt===oe&&(ke=ce.textNodes[0],Ze=ce.getLength())):ce=null});var pt=ft(oe,!ee);if(pt&&(ce||(ce=new Ke(oe),ie.push(ce)),ce.textNodes.push(pt)),ie.length){for(var Rt=0,Je=ie.length;Rt<Je;++Rt)ie[Rt].doMerge(F);A.setStartAndEnd(Ce,je,ke,Ze)}},createContainer:function(te){var A=o.getDocument(te),F=h&&!o.isHtmlNamespace(te)&&te.namespaceURI?A.createElementNS(te.namespaceURI,this.elementTagName):A.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,F,!1),this.copyAttributesToElement(this.elementAttributes,F),b(F,this.className),this.onElementCreate&&this.onElementCreate(F,this),F},elementHasProperties:function(te,A){var F=this;return g(A,function(ee,K){if(ee=="className")return R(te,K);if(typeof K=="object"){if(!F.elementHasProperties(te[ee],K))return!1}else if(te[ee]!==K)return!1})},elementHasAttributes:function(te,A){return g(A,function(F,ee){if(te.getAttribute(F)!==ee)return!1})},applyToTextNode:function(te,A){if(T(te)){var F=te.parentNode;if(F.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(F)&&this.elementHasProperties(F,this.elementProperties)&&this.elementHasAttributes(F,this.elementAttributes))b(F,this.className);else{var ee=te.parentNode,K=this.createContainer(ee);ee.insertBefore(K,te),K.appendChild(te)}}},isRemovable:function(te){return te.tagName.toLowerCase()==this.elementTagName&&O(te)==this.elementSortedClassName&&this.elementHasProperties(te,this.elementProperties)&&!Ee(te,this.attrExceptions)&&this.elementHasAttributes(te,this.elementAttributes)&&this.isModifiable(te)},isEmptyContainer:function(te){var A=te.childNodes.length;return te.nodeType==1&&this.isRemovable(te)&&(A==0||A==1&&this.isEmptyContainer(te.firstChild))},removeEmptyContainers:function(te){var A=this,F=te.getNodes([1],function(oe){return A.isEmptyContainer(oe)}),ee=[te],K=W(ee);d(F,function(oe){V(oe,K)}),Y(ee,K)},undoToTextNode:function(te,A,F,ee){if(!A.containsNode(F)){var K=A.cloneRange();K.selectNode(F),K.isPointInRange(A.endContainer,A.endOffset)&&(ge(F,A.endContainer,A.endOffset,ee),A.setEndAfter(F)),K.isPointInRange(A.startContainer,A.startOffset)&&(F=ge(F,A.startContainer,A.startOffset,ee))}this.isRemovable(F)?D(F,ee):_(F,this.className)},splitAncestorWithClass:function(te,A,F){var ee=this.getSelfOrAncestorWithClass(te);ee&&ge(ee,te,A,F)},undoToAncestor:function(te,A){this.isRemovable(te)?D(te,A):_(te,this.className)},applyToRange:function(te,A){var F=this;A=A||[];var ee=W(A||[]);te.splitBoundariesPreservingPositions(ee),F.removeEmptyElements&&F.removeEmptyContainers(te);var K=j(te);if(K.length){d(K,function(ce){!F.isIgnorableWhiteSpaceNode(ce)&&!F.getSelfOrAncestorWithClass(ce)&&F.isModifiable(ce)&&F.applyToTextNode(ce,ee)});var oe=K[K.length-1];te.setStartAndEnd(K[0],0,oe,oe.length),F.normalize&&F.postApply(K,te,ee,!1),Y(A,ee)}var ie=F.getEmptyElements(te);d(ie,function(ce){b(ce,F.className)})},applyToRanges:function(te){for(var A=te.length;A--;)this.applyToRange(te[A],te);return te},applyToSelection:function(te){var A=n.getSelection(te);A.setRanges(this.applyToRanges(A.getAllRanges()))},undoToRange:function(te,A){var F=this;A=A||[];var ee=W(A);te.splitBoundariesPreservingPositions(ee),F.removeEmptyElements&&F.removeEmptyContainers(te,ee);var K=j(te),oe,ie,ce=K[K.length-1];if(K.length){F.splitAncestorWithClass(te.endContainer,te.endOffset,ee),F.splitAncestorWithClass(te.startContainer,te.startOffset,ee);for(var Ce=0,ke=K.length;Ce<ke;++Ce)oe=K[Ce],ie=F.getSelfOrAncestorWithClass(oe),ie&&F.isModifiable(oe)&&F.undoToAncestor(ie,ee);te.setStartAndEnd(K[0],0,ce,ce.length),F.normalize&&F.postApply(K,te,ee,!0),Y(A,ee)}var je=F.getEmptyElements(te);d(je,function(Ze){_(Ze,F.className)})},undoToRanges:function(te){for(var A=te.length;A--;)this.undoToRange(te[A],te);return te},undoToSelection:function(te){var A=n.getSelection(te),F=n.getSelection(te).getAllRanges();this.undoToRanges(F),A.setRanges(F)},isAppliedToRange:function(te){if(te.collapsed||te.toString()=="")return!!this.getSelfOrAncestorWithClass(te.commonAncestorContainer);var A=te.getNodes([3]);if(A.length){for(var F=0,ee;ee=A[F++];)if(!this.isIgnorableWhiteSpaceNode(ee)&&U(te,ee)&&this.isModifiable(ee)&&!this.getSelfOrAncestorWithClass(ee))return!1}return!0},isAppliedToRanges:function(te){var A=te.length;if(A==0)return!1;for(;A--;)if(!this.isAppliedToRange(te[A]))return!1;return!0},isAppliedToSelection:function(te){var A=n.getSelection(te);return this.isAppliedToRanges(A.getAllRanges())},toggleRange:function(te){this.isAppliedToRange(te)?this.undoToRange(te):this.applyToRange(te)},toggleSelection:function(te){this.isAppliedToSelection(te)?this.undoToSelection(te):this.applyToSelection(te)},getElementsWithClassIntersectingRange:function(te){var A=[],F=this;return te.getNodes([3],function(ee){var K=F.getSelfOrAncestorWithClass(ee);K&&!l(A,K)&&A.push(K)}),A},detach:function(){}};function Ft(te,A,F){return new Wt(te,A,F)}Wt.util={hasClass:x,addClass:b,removeClass:_,getClass:S,hasSameClasses:M,hasAllClasses:R,replaceWithOwnChildren:D,elementsHaveSameNonClassAttributes:fe,elementHasNonClassAttributes:Ee,splitNodeAt:ge,isEditableElement:rt,isEditingHost:Me,isEditable:ve},n.CssClassApplier=n.ClassApplier=Wt,n.createClassApplier=Ft,u.createAliasForDeprecatedMethod(n,"createCssClassApplier","createClassApplier",i)}),t})}(Jf)),Jf.exports}n6();var M0={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},A0=rc.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var r=this;O0.init(),rc.extensions.button.prototype.init.call(this),this.colorPicker=new Aw({parent:this.button,color:"#000",onDone:function(e){r.coloredText&&r.coloredText.isAppliedToSelection()&&r.coloredText.undoToSelection(),r.coloredText=O0.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),r.coloredText.toggleSelection(),r.base.checkContentChanged(),r.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(r){return r.nodeName.toLowerCase()==="mark"},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),r6=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),i6=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var l=r.length-1;l>=0;l--)(a=r[l])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},T0=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},D0=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};(function(r){r6(e,r);function e(t){var n=r.call(this,t)||this;n.labelMap=new Map;var i=t.lf,o=t.graphModel;return n.lf=i,n.graphModel=o,n.state={tick:0},n}return e.prototype.componentDidMount=function(){var t=this,n=this.props.graphModel;this.editor=new rc(".lf-label-editor",Qa(M0,{autoLink:!0,extensions:{colorPicker:new A0}})),n.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),n.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},e.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):((t=this.editor)===null||t===void 0||t.destroy(),this.editor=new rc(".lf-label-editor",Qa(M0,{autoLink:!0,extensions:{colorPicker:new A0}})))},e.prototype.componentWillUnmount=function(){var t;(t=this.editor)===null||t===void 0||t.destroy()},e.prototype.getLabels=function(){var t=this,n=this.props,i=n.lf.extension,o=n.graphModel,a=D0(D0([],T0(o.nodes),!1),T0(o.edges),!1),l=i.label;if(l){var u=[];return un(a,function(d){var f,h,g=d.getData(),y=(h=(f=g.properties)===null||f===void 0?void 0:f._label)!==null&&h!==void 0?h:[];un(y,function(w){var x=t.labelMap,b=new VF(w,d,o);x.set(b.id,b),u.push(Te(WF,{label:b,element:d,graphModel:o},b.id))})}),u}return null},e.prototype.render=function(){return Te("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},e.toolName="label-edit-tool",e=i6([Er],e),e})(Yt);var o6=function(){function r(e){var t=e.lf,n=this;this.lf=t,this.lf.setPatternItems=function(i){n.setPatternItems(i)}}return r.prototype.render=function(e,t){var n=this;if(this.destroy(),!this.shapeList||this.shapeList.length===0){this.domContainer=t;return}this.panelEl=document.createElement("div"),this.panelEl.className="lf-dndpanel",this.shapeList.forEach(function(i){var o;(o=n.panelEl)===null||o===void 0||o.appendChild(n.createDndItem(i))}),t.appendChild(this.panelEl),this.domContainer=t},r.prototype.destroy=function(){this.domContainer&&this.panelEl&&this.domContainer.contains(this.panelEl)&&this.domContainer.removeChild(this.panelEl)},r.prototype.setPatternItems=function(e){this.shapeList=e,this.domContainer&&this.render(this.lf,this.domContainer)},r.prototype.createDndItem=function(e){var t=this,n=document.createElement("div");n.className=e.className?"lf-dnd-item ".concat(e.className):"lf-dnd-item";var i=document.createElement("div");if(i.className="lf-dnd-shape",e.icon&&(i.style.backgroundImage="url(".concat(e.icon,")")),n.appendChild(i),e.label){var o=document.createElement("div");o.innerText=e.label,o.className="lf-dnd-text",n.appendChild(o)}return e.disabled?(n.classList.add("disabled"),n.onmousedown=function(){e.callback&&e.callback(t.lf,t.domContainer)},n):(n.onmousedown=function(){e.type&&t.lf.dnd.startDrag({type:e.type,properties:e.properties,text:e.text}),e.callback&&e.callback(t.lf,t.domContainer)},n.ondblclick=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-dbclick",{e:a,data:e})},n.onclick=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-click",{e:a,data:e})},n.oncontextmenu=function(a){t.lf.graphModel.eventCenter.emit("dnd:panel-contextmenu",{e:a,data:e})},n)},r.pluginName="dndPanel",r}(),a6=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ia=function(){return ia=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ia.apply(this,arguments)},s6=function(r){a6(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.setAttributes=function(){var t=this.properties,n=t.width,i=t.height,o=t.radius;wr(n)||(this.width=n),wr(i)||(this.height=i),wr(o)||(this.radius=o)},e.prototype.getTextStyle=function(){var t=this.properties,n=t.refX,i=n===void 0?0:n,o=t.refY,a=o===void 0?0:o,l=t.textStyle,u=r.prototype.getTextStyle.call(this);return ia(ia(ia({},u),Ht(l)||{}),{transform:"matrix(1 0 0 1 ".concat(i," ").concat(a,")")})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.properties.style;return ia(ia({},t),Ht(n)||{})},e}(Fl),Dw={};function kn(r,e){var t=r.type,n=r.component,i=r.effect,o=r.view,a=r.model;if(!t)throw new Error("You should specify type in config");Dw[t]={component:n,effect:i},e.register({type:t,view:o||f6,model:a||s6})}var As=!1,ic=new Map,oc=Jt({});function l6(r,e,t,n,i){As&&(oc[r]=uc(gs({render:function(){return bn(p1,{to:t},[bn(e,{node:n,graph:i})])},provide:function(){return{getNode:function(){return n},getGraph:function(){return i}}}})))}function u6(r){As&&delete oc[r]}function L0(){return As}function Lw(){return As=!0,gs({props:{flowId:{type:String,required:!0}},setup:function(r){return function(){var e=[];return Object.keys(oc).forEach(function(t){t.startsWith(r.flowId)&&e.push(oc[t])}),bn(st,{},e.map(function(t){return bn(t)}))}}})}function d6(r,e){if(!(!e||!r||!As)){var t=Lw();if(!ic.has(e)){var n=document.createElement("div");r.appendChild(n);var i=ms(t,{flowId:e});i.mount(n),ic.set(e,i)}}}function P0(r){if(!(!r||!As)){var e=ic.get(r);e&&(e.unmount(),ic.delete(r))}}var c6=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),f6=function(r){c6(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){r.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var n=document.createElement("div");n.className="custom-vue-node-content",this.root=n,t.appendChild(n),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var n=this.getComponentContainer(),i=this.props,o=i.model,a=i.graphModel;if(n){var l=Dw[o.type].component;l&&(L0()?l6(this.targetId(),l,n,o,a):(this.vm=ms({render:function(){return bn(l,{node:o,graph:a})},provide:function(){return{getNode:function(){return o},getGraph:function(){return a}}}}),(t=this.vm)===null||t===void 0||t.mount(n)))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){L0()&&u6(this.targetId()),this.unmountVueComponent()},e}(Wl),h6=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},p6=function(){function r(e){var t=e.lf,n=e.LogicFlow,i=e.options,o=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){o.updateViewPortBounds(),o.isShow&&o.updateViewPort()},this.render=function(l,u){o.container=u,o.lf.on("history:change",function(){o.isShow&&o.setView()}),o.lf.on("graph:transform",function(){o.isShow&&o.setView(!1)})},this.show=function(l,u){o.isShow||(o.initMiniMap(),o.lf.on("graph:resize",o.onGraphResize),o.createMiniMap(l,u),o.setView(!0)),o.isShow=!0},this.hide=function(){o.isShow&&(P0(o.lfMap.graphModel.flowId),o.lf.off("graph:resize",o.onGraphResize),o.lfMap.destroy(),o.translateX=0,o.translateY=0,o.removeMiniMap(),o.lf.emit("miniMap:close",{})),o.isShow=!1},this.updatePosition=function(l){if(typeof l=="object")(l.left!==void 0||l.right!==void 0)&&(o.leftPosition=l.left,o.rightPosition=l.right),(l.top!==void 0||l.bottom!==void 0)&&(o.topPosition=l.top,o.bottomPosition=l.bottom);else switch(l){case"left-top":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=0,o.bottomPosition=void 0;break;case"right-top":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=0,o.bottomPosition=void 0;break;case"left-bottom":o.leftPosition=0,o.rightPosition=void 0,o.topPosition=void 0,o.bottomPosition=0;break;case"right-bottom":o.leftPosition=void 0,o.rightPosition=0,o.topPosition=void 0,o.bottomPosition=0;break}o.updateMiniMapPosition()},this.reset=function(){o.lf.resetTranslate(),o.lf.resetZoom()},this.setShowEdge=function(l){o.showEdge!==l&&(o.showEdge=l,o.setView())},this.startDrag=function(l){document.addEventListener("mousemove",o.drag),document.addEventListener("mouseup",o.drop);var u=l.x,d=l.y;o.startPosition={x:u,y:d}},this.drag=function(l){var u=l.x,d=l.y,f=(u-o.startPosition.x)/o.scale,h=(d-o.startPosition.y)/o.scale,g=o.viewPortLeft+f+o.viewPortWidth/o.scale/2,y=o.viewPortTop+h+o.viewPortHeight/o.scale/2;o.startPosition={x:u,y:d},o.lf.focusOn({coordinate:{x:g,y}})},this.drop=function(){document.removeEventListener("mousemove",o.drag),document.removeEventListener("mouseup",o.drop)},this.mapClick=function(l){var u=l.offsetX,d=l.offsetY,f=o.translateX+u/o.scale,h=o.translateY+d/o.scale;o.lf.focusOn({coordinate:{x:f,y:h}})},this.lf=t,this.LFCtor=n,i&&this.setOption(i),this.viewPortWidth=t.graphModel.width,this.viewPortHeight=t.graphModel.height;var a={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=a,this.elementAreaBounds=a,this.viewPortBounds=a}return r.prototype.setOption=function(e){var t=e.width,n=t===void 0?150:t,i=e.height,o=i===void 0?220:i,a=e.showEdge,l=a===void 0?!1:a,u=e.isShowHeader,d=u===void 0?!1:u,f=e.isShowCloseIcon,h=f===void 0?!1:f,g=e.leftPosition,y=e.topPosition,w=e.rightPosition,x=w===void 0?0:w,b=e.bottomPosition,_=b===void 0?0:b,S=e.headerTitle,k=S===void 0?"导航":S;this.width=n,this.height=o,this.showEdge=l,this.isShowHeader=d,this.isShowCloseIcon=h,this.leftPosition=g,this.rightPosition=g!==void 0?void 0:x,this.topPosition=y,this.bottomPosition=y!==void 0?void 0:_,this.headerTitle=k},r.prototype.initMiniMap=function(){var e=document.createElement("div");e.className="lf-mini-map-graph",e.style.width="".concat(this.width,"px"),e.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:e,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins}),d6(e,this.lfMap.graphModel.flowId),this.miniMapWrap=e,this.createViewPort(),e.addEventListener("click",this.mapClick)},r.prototype.createMiniMap=function(e,t){var n,i=document.createElement("div");this.miniMapContainer=i,i.appendChild(this.miniMapWrap),i.style.position="absolute",(e!==void 0||t!==void 0)&&(this.leftPosition=e||0,this.topPosition=t||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),i.className="lf-mini-map",this.isShowCloseIcon||i.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||i.classList.add("lf-mini-map-no-header"),(n=this.container)===null||n===void 0||n.appendChild(i),this.miniMapWrap.appendChild(this.viewport);var o=document.createElement("div");o.className="lf-mini-map-header",o.innerText=this.headerTitle,i.appendChild(o);var a=document.createElement("span");a.className="lf-mini-map-close",a.addEventListener("click",this.hide),i.appendChild(a)},r.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var e=this.miniMapContainer.style;this.rightPosition!==void 0?(e.right="".concat(this.rightPosition,"px"),e.left=""):(e.left="".concat(this.leftPosition,"px"),e.right=""),this.bottomPosition!==void 0?(e.bottom="".concat(this.bottomPosition,"px"),e.top=""):(e.top="".concat(this.topPosition,"px"),e.bottom="")}},r.prototype.removeMiniMap=function(){var e;this.miniMapContainer&&((e=this.container)===null||e===void 0||e.removeChild(this.miniMapContainer))},r.prototype.updateBounds=function(e){e&&this.updateElementAreaBounds(e),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},r.prototype.updateElementAreaBounds=function(e){var t={left:0,right:0,top:0,bottom:0},n=e.nodes;n&&n.length>0&&n.forEach(function(i){var o,a,l=i.x,u=i.y,d=(o=i.width)!==null&&o!==void 0?o:200,f=(a=i.height)!==null&&a!==void 0?a:200,h=l-d/2,g=l+d/2,y=u-f/2,w=u+f/2;t.left=Math.min(h,t.left),t.right=Math.max(g,t.right),t.top=Math.min(y,t.top),t.bottom=Math.max(w,t.bottom)}),this.elementAreaBounds=t},r.prototype.updateViewPortBounds=function(){var e=this.lf.getTransform(),t=e.TRANSLATE_X,n=e.TRANSLATE_Y,i=e.SCALE_X,o=e.SCALE_Y,a=this.lf.graphModel,l=a.width,u=a.height;this.viewPortBounds={left:-t/i,right:(-t+l)/i,top:-n/o,bottom:(-n+u)/o}},r.prototype.resetData=function(e){var t=e.nodes,n=e.edges;return t.forEach(function(i){i.text=void 0}),this.showEdge&&n.forEach(function(i){i.text=void 0}),{nodes:t,edges:this.showEdge?n:[]}},r.prototype.setView=function(e){var t,n;if(e===void 0&&(e=!0),e){var i=this.lf.getGraphRawData(),o=this.resetData(i),a=this.lf.viewMap,l=this.lf.graphModel.modelMap,u=this.lfMap.viewMap;try{for(var d=h6(a.keys()),f=d.next();!f.done;f=d.next()){var h=f.value;u.has(h)||this.lfMap.register({type:h,view:a.get(h),model:l.get(h)})}}catch($){t={error:$}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}this.lfMap.render(o),this.updateBounds(o)}else this.updateBounds();var g=this.bounds,y=g.left,w=g.top,x=g.right,b=g.bottom,_=x-y,S=b-w,k=this.width/_,O=this.height/S,M=Math.min(k,O);this.scale=M;var R=y-(this.width/M-_)/2,T=w-(this.height/M-S)/2;if(this.lfMap.graphModel.transformModel.translate(-R+this.translateX,-T+this.translateY),this.translateX=R,this.translateY=T,this.miniMapWrap.firstChild){var I=this.miniMapWrap.firstChild.style;I.pointerEvents="none",I.transform="matrix(".concat(M,", 0, 0, ").concat(M,", 0, 0)"),I.transformOrigin="left top",I.height="".concat(this.height/M,"px"),I.width="".concat(this.width/M,"px"),this.updateViewPort()}},r.prototype.updateViewPort=function(){var e=this.viewport.style,t=this.lf.getTransform(),n=t.TRANSLATE_X,i=t.TRANSLATE_Y,o=t.SCALE_X,a=t.SCALE_Y,l=this.lf.graphModel,u=l.width,d=l.height;this.viewPortLeft=-n/o,this.viewPortTop=-i/a,this.viewPortWidth=u/o*this.scale,this.viewPortHeight=d/a*this.scale,e.width="".concat(this.viewPortWidth,"px"),e.height="".concat(this.viewPortHeight,"px"),e.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),e.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},r.prototype.createViewPort=function(){var e=document.createElement("div");e.className="lf-minimap-viewport",e.addEventListener("mousedown",this.startDrag),e.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=e},r.prototype.destroy=function(){P0(this.lfMap.graphModel.flowId),this.lf.off("graph:resize",this.onGraphResize)},r.pluginName="miniMap",r}(),R0=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},I0=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},v6=function(){function r(e){var t=e.lf,n=e.options,i=this,o;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(a){var l=a.e;i.handleMouseDown(l)},this.draw=function(a){var l=i.lf.getPointByClient(a.clientX,a.clientY).domOverlayPosition,u=l.x,d=l.y;if(i.endPoint={x:u,y:d},i.startPoint){var f=i.startPoint,h=f.x,g=f.y,y=h,w=g,x=u-h,b=d-g;u<h&&(y=u,x=h-u),d<g&&(w=d,b=g-d),i.wrapper&&(i.wrapper.style.left="".concat(y,"px"),i.wrapper.style.top="".concat(w,"px"),i.wrapper.style.width="".concat(x,"px"),i.wrapper.style.height="".concat(b,"px"))}},this.drawOff=function(a){if(i.mouseDownInfo){var l=i.mouseDownInfo,u=l.x,d=l.y,f=l.time,h=Math.abs(a.clientX-u)<5&&Math.abs(a.clientY-d)<5&&Date.now()-f<200;if(h){i.lf.clearSelectElements(),i.cleanupSelectionState();return}}var g=Ht(i.startPoint),y=Ht(i.endPoint);if(document.removeEventListener("mousemove",i.draw),i.exclusiveMode||document.removeEventListener("mouseup",i.drawOff),i.lf.updateEditConfig({stopMoveGraph:i.originalStopMoveGraph}),g&&y){var u=g.x,d=g.y,w=y.x,x=y.y,b=[Math.min(u,w),Math.min(d,x)],_=[Math.max(u,w),Math.max(d,x)];if(i.lf.emit("selection:selected-area",{topLeft:b,bottomRight:_}),Math.abs(w-u)<10&&Math.abs(x-d)<10){i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0);return}var S=i.lf.graphModel.getAreaElement(b,_,i.isWholeEdge,i.isWholeNode,!0),k=i.lf.graphModel,O=k.dynamicGroup,M=k.group,R=[],T=i.lf.getSelectElements(),I=new Set(I0(I0([],R0(T.nodes.map(function(V){return V.id})),!1),R0(T.edges.map(function(V){return V.id})),!1));S.forEach(function(V){if(M){var J=M.getNodeGroup(V.id);if(S.includes(J))return}if(O){var J=O.getGroupByNodeId(V.id);if(S.includes(J))return}if(i.exclusiveMode&&I.has(V.id)){i.lf.deselectElementById(V.id);return}i.lf.selectElementById(V.id,!0),R.push(V)}),i.startPoint=void 0,i.endPoint=void 0,R.length>0&&i.lf.emit("selection:drop",{e:a}),i.lf.emit("selection:selected",{elements:R,leftTopPoint:b,rightBottomPoint:_})}i.wrapper&&(i.wrapper.oncontextmenu=null,i.container&&i.wrapper.parentNode===i.container&&i.container.removeChild(i.wrapper),i.wrapper=void 0)},this.lf=t,this.exclusiveMode=(o=n==null?void 0:n.exclusiveMode)!==null&&o!==void 0?o:!1,t.openSelectionSelect=function(){i.openSelectionSelect()},t.closeSelectionSelect=function(){i.closeSelectionSelect()},t.setSelectionSelectMode=function(a){i.setExclusiveMode(a)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return r.prototype.render=function(e,t){this.container=t},r.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("mousemove",this.draw),document.removeEventListener("mouseup",this.drawOff)},r.prototype.setExclusiveMode=function(e){e===void 0&&(e=!1),this.exclusiveMode!==e&&(this.cleanupSelectionState(),this.exclusiveMode=e,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},r.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.addEventListener("mousedown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},r.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("mousedown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},r.prototype.handleMouseDown=function(e){var t;if(!(!this.container||this.disabled)){var n=e.button===2;if(!n){this.cleanupSelectionState(),this.mouseDownInfo={x:e.clientX,y:e.clientY,time:Date.now()},this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.lf.updateEditConfig({stopMoveGraph:!0});var i=this.lf.getPointByClient(e.clientX,e.clientY).domOverlayPosition,o=i.x,a=i.y;this.startPoint={x:o,y:a},this.endPoint={x:o,y:a};var l=document.createElement("div");l.className="lf-selection-select",l.oncontextmenu=function(d){d.preventDefault()},l.style.top="".concat(this.startPoint.y,"px"),l.style.left="".concat(this.startPoint.x,"px"),(t=this.container)===null||t===void 0||t.appendChild(l),this.wrapper=l,document.addEventListener("mousemove",this.draw),document.addEventListener("mouseup",this.drawOff)}}},r.prototype.setSelectionSense=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),this.isWholeEdge=e,this.isWholeNode=t},r.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},r.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var e=Ht(this.endPoint),t=new MouseEvent("mouseup",{clientX:e.x,clientY:e.y});this.drawOff(t)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},r.prototype.open=function(){this.disabled=!1},r.prototype.close=function(){this.disabled=!0},r.pluginName="selectionSelect",r}();var Pw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ka=function(){return Ka=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ka.apply(this,arguments)},Nl=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},g6={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function m6(r){for(var e=r,t=1;t<e.length-1;){var n=Nl(e[t-1],2),i=n[0],o=n[1],a=Nl(e[t],2),l=a[0],u=a[1],d=Nl(e[t+1],2),f=d[0],h=d[1];i===l&&l===f||o===u&&u===h?e.splice(t,1):t++}return e}function y6(r,e,t,n){var i=[r[0],r[1]],o=[r[0],r[1]];switch(t){case"tl":return e==="tr"?(i[1]+=n,o[0]+=n):e==="lb"&&(i[0]+=n,o[1]+=n),[i,o];case"tr":return e==="tl"?(i[1]+=n,o[0]-=n):e==="rb"&&(i[0]-=n,o[1]+=n),[i,o];case"bl":return e==="br"?(i[1]-=n,o[0]+=n):e==="lt"&&(i[0]+=n,o[1]-=n),[i,o];case"br":return e==="bl"?(i[1]-=n,o[0]-=n):e==="rt"&&(i[0]-=n,o[1]-=n),[i,o];default:return[]}}function _6(r,e,t,n){var i,o="",a="";r[0]===e[0]?o=r[1]>e[1]?"t":"b":r[1]===e[1]&&(o=r[0]>e[0]?"l":"r"),e[0]===t[0]?a=e[1]>t[1]?"t":"b":e[1]===t[1]&&(a=e[0]>t[0]?"l":"r");var l=Math.min(Math.hypot(e[0]-r[0],e[1]-r[1])/2,Math.hypot(t[0]-e[0],t[1]-e[1])/2,n)||1/5*n,u="".concat(o).concat(a),d=g6[u]||"-",f="L ".concat(r[0]," ").concat(r[1]);if(d==="-")f+="L ".concat(e[0]," ").concat(e[1]," L ").concat(t[0]," ").concat(t[1]);else{var h=Nl(y6(e,u,d,l),2),g=h[0],y=h[1];g&&y&&(f+="L ".concat(g[0]," ").concat(g[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(y[0]," ").concat(y[1]),i=Nl(y,2),e[0]=i[0],e[1]=i[1])}return f}function b6(r,e){var t=0,n="";if(r.length===2)n+="M".concat(r[t][0]," ").concat(r[t++][1]," L ").concat(r[t][0]," ").concat(r[t][1]);else{for(n+="M".concat(r[t][0]," ").concat(r[t++][1]);t+1<r.length;){var i=r[t-1],o=r[t],a=r[t+++1];n+=_6(i,o,a,e)}n+="L ".concat(r[t][0]," ").concat(r[t][1])}return n}(function(r){Pw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,i=t.isAnimation,o=t.arrowConfig,a=t.radius,l=a===void 0?5:a,u=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),f=m6(n.split(" ").map(function(y){return y.split(",").map(function(w){return+w})})),h=b6(f,l),g=Ka(Ka(Ka({style:i?d:{}},u),o),{fill:"none"});return wt("path",Ka({d:h},g))},e})(vs);(function(r){Pw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(hs);var Rw=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ac=function(){return ac=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ac.apply(this,arguments)},B0=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return o},j0=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},x6=function(r){Rw(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.id,i=t.x,o=t.y,a=t.width,l=t.height,u=t.properties,d=this.props.model.getNodeStyle();return wt("svg",{x:i-a/2,y:o-l/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[u.labelText?wt("text",{x:0,y:-5,fontSize:"16px",fill:d.stroke},u.labelText):"",u.disabledDelete?"":wt("text",{x:u.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:d.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,n)},"x")])},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.id,u=this.props.model.getNodeStyle();return wt("g",{},[wt("rect",ac(ac({},u),{x:n-o/2,y:i-a/2,width:o,height:a,id:l})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){var n=this.props.graphModel;n.deleteNode(t)},e}($d),w6=function(r){Rw(e,r);function e(){var t=r.apply(this,j0([],B0(arguments),!1))||this;return t.d=10,t.isResize=!1,t}return e.prototype.initNodeData=function(t){t.text={value:"",x:t.x,y:t.y,draggable:!1,editable:!1},r.prototype.initNodeData.call(this,t),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t=this,n;this.points=[],((n=this.properties)===null||n===void 0?void 0:n.node_selection_ids).length>1&&setTimeout(function(){var i;t.updatePointsByNodes(((i=t.properties)===null||i===void 0?void 0:i.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this);return t.stroke=this.properties.strokeColor||"#008000",t.strokeDasharray="10 5",t},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var n=t.x,i=t.y;this.x=n,this.y=i},e.prototype.updatePointsByNodes=function(t){var n=this,i=[],o=1/0,a=1/0,l=-1/0,u=-1/0;t.forEach(function(d){var f=n.graphModel.getNodeModelById(d);if(f){var h=f.width,g=f.height,y=f.x,w=f.y;o=Math.min(o,y-h/2-n.d),a=Math.min(a,w-g/2-n.d),l=Math.max(l,y+h/2+n.d),u=Math.max(u,w+g/2+n.d)}}),i.push([o,a],[l,a],[l,u],[o,u]),![o,a,l,u].some(function(d){return Math.abs(d)===1/0})&&(this.updatePoints(i),this.updateCoordinate({x:(l+o)/2,y:(u+a)/2}))},e.prototype.resize=function(t){var n;this.isResize=!0;for(var i=t.width,o=t.height,a={x:i/this.width,y:o/this.height},l=(this.properties.node_selection_ids||[]).slice(),u=[],d=new Set;l.length;){var f=l.shift(),h=(n=this.graphModel.nodesMap[f])===null||n===void 0?void 0:n.model;if(h){if(!pd(h)){u.push(h);continue}d.has(h.id)||(d.add(h.id),l.push.apply(l,j0([],B0(h.properties.node_selection_ids||[]),!1)))}}var g={x:this.x-this.width/2,y:this.y-this.height/2},y=r.prototype.resize.call(this,t),w={x:this.x-this.width/2,y:this.y-this.height/2};return u.forEach(function(x){x.width=x.width*a.x,x.height=x.height*a.y;var b=(x.x-g.x)*a.x+w.x-x.x,_=(x.y-g.y)*a.y+w.y-x.y;x.move(b,_,!0)}),this.isResize=!1,y},e}(Id),_v="node-selection";(function(){function r(e){var t=e.lf;this.selectNodes=[],this.d=10,this.lf=t,t.register({type:_v,view:x6,model:w6})}return Object.defineProperty(r.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(e){return e.id})},enumerable:!1,configurable:!0}),r.prototype.addNodeSelection=function(){var e=this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0});e.updatePointsByNodes(this.selectNodesIds)},r.prototype.updateNodeSelection=function(){var e,t=this.getNodeSelection();t&&(this.lf.setProperties(t.id,{node_selection_ids:this.selectNodesIds}),(e=this.lf.getNodeModelById(t.id))===null||e===void 0||e.updatePointsByNodes(this.selectNodesIds))},r.prototype.getNodeSelection=function(){var e=this,t=this.selectNodesIds,n=this.lf.getGraphRawData(),i=t.filter(function(o){return o!==e.currentClickNode.id});return n.nodes.find(function(o){if(o.type==="node-selection"){var a=Gl(o,"properties.node_selection_ids",[]);return i.every(function(l){return a.includes(l)})}return!1})},r.prototype.onNodeChange=function(e,t){var n=e.graphModel.nodes.filter(function(i){if(!pd(i))return!1;var o=i.properties.node_selection_ids||[];return o.includes(t.id)});Promise.resolve().then(function(){n.forEach(function(i){i.updatePointsByNodes(i.properties.node_selection_ids||[])})})},r.prototype.render=function(e){var t=this;this.lf=e,e.on("node:click",function(n){var i;if(!(!n.e.shiftKey||n.data.type===_v)){t.currentClickNode=n.data;var o=!1;t.selectNodesIds.includes(n.data.id)&&((i=t.lf.getNodeModelById(n.data.id))===null||i===void 0||i.setSelected(!1),o=!0);var a=e.getSelectElements(!0).nodes;t.selectNodes=a,t.selectNodes.length===1?o?t.updateNodeSelection():t.addNodeSelection():t.selectNodes.length>1&&t.updateNodeSelection()}}),e.graphModel.addNodeMoveRules(function(n,i,o){if(t.onNodeChange(e,n),pd(n)&&!n.isResize){var a=n.properties.node_selection_ids||[];return e.graphModel.moveNodes(a,i,o,!0),!0}return!0}),e.graphModel.addNodeResizeRules(function(n){return pd(n)||t.onNodeChange(e,n),!0})},r.pluginName="node-selection",r})();var pd=function(r){return!!(r&&r.type===_v)},S6=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),sc=function(){return sc=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},sc.apply(this,arguments)};(function(r){S6(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getLabelShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=t.properties;return wt("text",{x:n-o/2+5,y:i-a/2+16,fontSize:12,fill:"blue"},l.moreText)},e.prototype.getShape=function(){var t=this.props.model,n=t.x,i=t.y,o=t.width,a=t.height,l=this.props.model.getNodeStyle();return wt("g",{},[wt("rect",sc(sc({},l),{fill:"#FFFFFF",x:n-o/2,y:i-a/2})),this.getLabelShape()])},e})(ca);var Zf,H0;function Ni(){if(H0)return Zf;H0=1;var r;if(typeof L1=="function")try{r=QN()}catch{}return r||(r=window.graphlib),Zf=r,Zf}var Qf,$0;function E6(){if($0)return Qf;$0=1;var r=eM(),e=1,t=4;function n(i){return r(i,e|t)}return Qf=n,Qf}var eh,F0;function Oc(){if(F0)return eh;F0=1;var r=Tv(),e=P1(),t=R1(),n=Yl();function i(o,a,l){if(!n(l))return!1;var u=typeof a;return(u=="number"?e(l)&&t(a,l.length):u=="string"&&a in l)?r(l[a],o):!1}return eh=i,eh}var th,z0;function C6(){if(z0)return th;z0=1;var r=Dv(),e=Tv(),t=Oc(),n=hc(),i=Object.prototype,o=i.hasOwnProperty,a=r(function(l,u){l=Object(l);var d=-1,f=u.length,h=f>2?u[2]:void 0;for(h&&t(u[0],u[1],h)&&(f=1);++d<f;)for(var g=u[d],y=n(g),w=-1,x=y.length;++w<x;){var b=y[w],_=l[b];(_===void 0||e(_,i[b])&&!o.call(l,b))&&(l[b]=g[b])}return l});return th=a,th}var nh,W0;function k6(){if(W0)return nh;W0=1;var r=Kl(),e=P1(),t=tM();function n(i){return function(o,a,l){var u=Object(o);if(!e(o)){var d=r(a,3);o=t(o),a=function(h){return d(u[h],h,u)}}var f=i(o,a,l);return f>-1?u[d?o[f]:f]:void 0}}return nh=n,nh}var rh,U0;function O6(){if(U0)return rh;U0=1;var r=/\s/;function e(t){for(var n=t.length;n--&&r.test(t.charAt(n)););return n}return rh=e,rh}var ih,V0;function N6(){if(V0)return ih;V0=1;var r=O6(),e=/^\s+/;function t(n){return n&&n.slice(0,r(n)+1).replace(e,"")}return ih=t,ih}var oh,q0;function M6(){if(q0)return oh;q0=1;var r=N6(),e=Yl(),t=Lv(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(t(d))return n;if(e(d)){var f=typeof d.valueOf=="function"?d.valueOf():d;d=e(f)?f+"":f}if(typeof d!="string")return d===0?d:+d;d=r(d);var h=o.test(d);return h||a.test(d)?l(d.slice(2),h?2:8):i.test(d)?n:+d}return oh=u,oh}var ah,X0;function Iw(){if(X0)return ah;X0=1;var r=M6(),e=1/0,t=17976931348623157e292;function n(i){if(!i)return i===0?i:0;if(i=r(i),i===e||i===-e){var o=i<0?-1:1;return o*t}return i===i?i:0}return ah=n,ah}var sh,G0;function A6(){if(G0)return sh;G0=1;var r=Iw();function e(t){var n=r(t),i=n%1;return n===n?i?n-i:n:0}return sh=e,sh}var lh,Y0;function T6(){if(Y0)return lh;Y0=1;var r=nM(),e=Kl(),t=A6(),n=Math.max;function i(o,a,l){var u=o==null?0:o.length;if(!u)return-1;var d=l==null?0:t(l);return d<0&&(d=n(u+d,0)),r(o,e(a,3),d)}return lh=i,lh}var uh,K0;function D6(){if(K0)return uh;K0=1;var r=k6(),e=T6(),t=r(e);return uh=t,uh}var dh,J0;function Bw(){if(J0)return dh;J0=1;var r=I1();function e(t){var n=t==null?0:t.length;return n?r(t,1):[]}return dh=e,dh}var ch,Z0;function L6(){if(Z0)return ch;Z0=1;var r=B1(),e=rM(),t=hc();function n(i,o){return i==null?i:r(i,e(o),t)}return ch=n,ch}var fh,Q0;function P6(){if(Q0)return fh;Q0=1;function r(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}return fh=r,fh}var hh,eb;function R6(){if(eb)return hh;eb=1;var r=j1(),e=iM(),t=Kl();function n(i,o){var a={};return o=t(o,3),e(i,function(l,u,d){r(a,u,o(l,u,d))}),a}return hh=n,hh}var ph,tb;function ug(){if(tb)return ph;tb=1;var r=Lv();function e(t,n,i){for(var o=-1,a=t.length;++o<a;){var l=t[o],u=n(l);if(u!=null&&(d===void 0?u===u&&!r(u):i(u,d)))var d=u,f=l}return f}return ph=e,ph}var vh,nb;function I6(){if(nb)return vh;nb=1;function r(e,t){return e>t}return vh=r,vh}var gh,rb;function B6(){if(rb)return gh;rb=1;var r=ug(),e=I6(),t=Pv();function n(i){return i&&i.length?r(i,t,e):void 0}return gh=n,gh}var mh,ib;function jw(){if(ib)return mh;ib=1;var r=j1(),e=Tv();function t(n,i,o){(o!==void 0&&!e(n[i],o)||o===void 0&&!(i in n))&&r(n,i,o)}return mh=t,mh}var yh,ob;function j6(){if(ob)return yh;ob=1;var r=oM(),e=aM(),t=sM(),n="[object Object]",i=Function.prototype,o=Object.prototype,a=i.toString,l=o.hasOwnProperty,u=a.call(Object);function d(f){if(!t(f)||r(f)!=n)return!1;var h=e(f);if(h===null)return!0;var g=l.call(h,"constructor")&&h.constructor;return typeof g=="function"&&g instanceof g&&a.call(g)==u}return yh=d,yh}var _h,ab;function Hw(){if(ab)return _h;ab=1;function r(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}return _h=r,_h}var bh,sb;function H6(){if(sb)return bh;sb=1;var r=lM(),e=hc();function t(n){return r(n,e(n))}return bh=t,bh}var xh,lb;function $6(){if(lb)return xh;lb=1;var r=jw(),e=uM(),t=dM(),n=mM(),i=cM(),o=fM(),a=H1(),l=hM(),u=pM(),d=vM(),f=Yl(),h=j6(),g=gM(),y=Hw(),w=H6();function x(b,_,S,k,O,M,R){var T=y(b,S),I=y(_,S),$=R.get(I);if($){r(b,S,$);return}var ne=M?M(T,I,S+"",b,_,R):void 0,V=ne===void 0;if(V){var J=a(I),D=!J&&u(I),U=!J&&!D&&g(I);ne=I,J||D||U?a(T)?ne=T:l(T)?ne=n(T):D?(V=!1,ne=e(I,!0)):U?(V=!1,ne=t(I,!0)):ne=[]:h(I)||o(I)?(ne=T,o(T)?ne=w(T):(!f(T)||d(T))&&(ne=i(I))):V=!1}V&&(R.set(I,ne),O(ne,I,k,M,R),R.delete(I)),r(b,S,ne)}return xh=x,xh}var wh,ub;function F6(){if(ub)return wh;ub=1;var r=yM(),e=jw(),t=B1(),n=$6(),i=Yl(),o=hc(),a=Hw();function l(u,d,f,h,g){u!==d&&t(d,function(y,w){if(g||(g=new r),i(y))n(u,d,w,f,l,h,g);else{var x=h?h(a(u,w),y,w+"",u,d,g):void 0;x===void 0&&(x=y),e(u,w,x)}},o)}return wh=l,wh}var Sh,db;function z6(){if(db)return Sh;db=1;var r=Dv(),e=Oc();function t(n){return r(function(i,o){var a=-1,l=o.length,u=l>1?o[l-1]:void 0,d=l>2?o[2]:void 0;for(u=n.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(o[0],o[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++a<l;){var f=o[a];f&&n(i,f,a,u)}return i})}return Sh=t,Sh}var Eh,cb;function W6(){if(cb)return Eh;cb=1;var r=F6(),e=z6(),t=e(function(n,i,o){r(n,i,o)});return Eh=t,Eh}var Ch,fb;function $w(){if(fb)return Ch;fb=1;function r(e,t){return e<t}return Ch=r,Ch}var kh,hb;function U6(){if(hb)return kh;hb=1;var r=ug(),e=$w(),t=Pv();function n(i){return i&&i.length?r(i,t,e):void 0}return kh=n,kh}var Oh,pb;function V6(){if(pb)return Oh;pb=1;var r=ug(),e=Kl(),t=$w();function n(i,o){return i&&i.length?r(i,e(o,2),t):void 0}return Oh=n,Oh}var Nh,vb;function q6(){if(vb)return Nh;vb=1;var r=_M(),e=function(){return r.Date.now()};return Nh=e,Nh}var Mh,gb;function X6(){if(gb)return Mh;gb=1;var r=$1(),e=F1(),t=R1(),n=Yl(),i=bM();function o(a,l,u,d){if(!n(a))return a;l=e(l,a);for(var f=-1,h=l.length,g=h-1,y=a;y!=null&&++f<h;){var w=i(l[f]),x=u;if(w==="__proto__"||w==="constructor"||w==="prototype")return a;if(f!=g){var b=y[w];x=d?d(b,w,y):void 0,x===void 0&&(x=n(b)?b:t(l[f+1])?[]:{})}r(y,w,x),y=y[w]}return a}return Mh=o,Mh}var Ah,mb;function G6(){if(mb)return Ah;mb=1;var r=z1(),e=X6(),t=F1();function n(i,o,a){for(var l=-1,u=o.length,d={};++l<u;){var f=o[l],h=r(i,f);a(h,f)&&e(d,t(f,i),h)}return d}return Ah=n,Ah}var Th,yb;function Y6(){if(yb)return Th;yb=1;var r=G6(),e=xM();function t(n,i){return r(n,i,function(o,a){return e(n,a)})}return Th=t,Th}var Dh,_b;function K6(){if(_b)return Dh;_b=1;var r=Bw(),e=SM(),t=wM();function n(i){return t(e(i,void 0,r),i+"")}return Dh=n,Dh}var Lh,bb;function J6(){if(bb)return Lh;bb=1;var r=Y6(),e=K6(),t=e(function(n,i){return n==null?{}:r(n,i)});return Lh=t,Lh}var Ph,xb;function Z6(){if(xb)return Ph;xb=1;var r=Math.ceil,e=Math.max;function t(n,i,o,a){for(var l=-1,u=e(r((i-n)/(o||1)),0),d=Array(u);u--;)d[a?u:++l]=n,n+=o;return d}return Ph=t,Ph}var Rh,wb;function Q6(){if(wb)return Rh;wb=1;var r=Z6(),e=Oc(),t=Iw();function n(i){return function(o,a,l){return l&&typeof l!="number"&&e(o,a,l)&&(a=l=void 0),o=t(o),a===void 0?(a=o,o=0):a=t(a),l=l===void 0?o<a?1:-1:t(l),r(o,a,l,i)}}return Rh=n,Rh}var Ih,Sb;function e7(){if(Sb)return Ih;Sb=1;var r=Q6(),e=r();return Ih=e,Ih}var Bh,Eb;function t7(){if(Eb)return Bh;Eb=1;function r(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}return Bh=r,Bh}var jh,Cb;function n7(){if(Cb)return jh;Cb=1;var r=Lv();function e(t,n){if(t!==n){var i=t!==void 0,o=t===null,a=t===t,l=r(t),u=n!==void 0,d=n===null,f=n===n,h=r(n);if(!d&&!h&&!l&&t>n||l&&u&&f&&!d&&!h||o&&u&&f||!i&&f||!a)return 1;if(!o&&!l&&!h&&t<n||h&&i&&a&&!o&&!l||d&&i&&a||!u&&a||!f)return-1}return 0}return jh=e,jh}var Hh,kb;function r7(){if(kb)return Hh;kb=1;var r=n7();function e(t,n,i){for(var o=-1,a=t.criteria,l=n.criteria,u=a.length,d=i.length;++o<u;){var f=r(a[o],l[o]);if(f){if(o>=d)return f;var h=i[o];return f*(h=="desc"?-1:1)}}return t.index-n.index}return Hh=e,Hh}var $h,Ob;function i7(){if(Ob)return $h;Ob=1;var r=CM(),e=z1(),t=Kl(),n=EM(),i=t7(),o=kM(),a=r7(),l=Pv(),u=H1();function d(f,h,g){h.length?h=r(h,function(x){return u(x)?function(b){return e(b,x.length===1?x[0]:x)}:x}):h=[l];var y=-1;h=r(h,o(t));var w=n(f,function(x,b,_){var S=r(h,function(k){return k(x)});return{criteria:S,index:++y,value:x}});return i(w,function(x,b){return a(x,b,g)})}return $h=d,$h}var Fh,Nb;function o7(){if(Nb)return Fh;Nb=1;var r=I1(),e=i7(),t=Dv(),n=Oc(),i=t(function(o,a){if(o==null)return[];var l=a.length;return l>1&&n(o,a[0],a[1])?a=[]:l>2&&n(a[0],a[1],a[2])&&(a=[a[0]]),e(o,r(a,1),[])});return Fh=i,Fh}var zh,Mb;function a7(){if(Mb)return zh;Mb=1;var r=OM(),e=0;function t(n){var i=++e;return r(n)+i}return zh=t,zh}var Wh,Ab;function s7(){if(Ab)return Wh;Ab=1;function r(e,t,n){for(var i=-1,o=e.length,a=t.length,l={};++i<o;){var u=i<a?t[i]:void 0;n(l,e[i],u)}return l}return Wh=r,Wh}var Uh,Tb;function l7(){if(Tb)return Uh;Tb=1;var r=$1(),e=s7();function t(n,i){return e(n||[],i||[],r)}return Uh=t,Uh}var Vh,Db;function En(){if(Db)return Vh;Db=1;var r;if(typeof L1=="function")try{r={cloneDeep:E6(),constant:IM(),defaults:C6(),each:RM(),filter:PM(),find:D6(),flatten:Bw(),forEach:LM(),forIn:L6(),has:DM(),isUndefined:TM(),last:P6(),map:AM(),mapValues:R6(),max:B6(),merge:W6(),min:U6(),minBy:V6(),now:q6(),pick:J6(),range:e7(),reduce:MM(),sortBy:o7(),uniqueId:a7(),values:NM(),zipObject:l7()}}catch{}return r||(r=window._),Vh=r,Vh}var qh,Lb;function u7(){if(Lb)return qh;Lb=1,qh=r;function r(){var n={};n._next=n._prev=n,this._sentinel=n}r.prototype.dequeue=function(){var n=this._sentinel,i=n._prev;if(i!==n)return e(i),i},r.prototype.enqueue=function(n){var i=this._sentinel;n._prev&&n._next&&e(n),n._next=i._next,i._next._prev=n,i._next=n,n._prev=i},r.prototype.toString=function(){for(var n=[],i=this._sentinel,o=i._prev;o!==i;)n.push(JSON.stringify(o,t)),o=o._prev;return"["+n.join(", ")+"]"};function e(n){n._prev._next=n._next,n._next._prev=n._prev,delete n._next,delete n._prev}function t(n,i){if(n!=="_next"&&n!=="_prev")return i}return qh}var Xh,Pb;function d7(){if(Pb)return Xh;Pb=1;var r=En(),e=Ni().Graph,t=u7();Xh=i;var n=r.constant(1);function i(d,f){if(d.nodeCount()<=1)return[];var h=l(d,f||n),g=o(h.graph,h.buckets,h.zeroIdx);return r.flatten(r.map(g,function(y){return d.outEdges(y.v,y.w)}),!0)}function o(d,f,h){for(var g=[],y=f[f.length-1],w=f[0],x;d.nodeCount();){for(;x=w.dequeue();)a(d,f,h,x);for(;x=y.dequeue();)a(d,f,h,x);if(d.nodeCount()){for(var b=f.length-2;b>0;--b)if(x=f[b].dequeue(),x){g=g.concat(a(d,f,h,x,!0));break}}}return g}function a(d,f,h,g,y){var w=y?[]:void 0;return r.forEach(d.inEdges(g.v),function(x){var b=d.edge(x),_=d.node(x.v);y&&w.push({v:x.v,w:x.w}),_.out-=b,u(f,h,_)}),r.forEach(d.outEdges(g.v),function(x){var b=d.edge(x),_=x.w,S=d.node(_);S.in-=b,u(f,h,S)}),d.removeNode(g.v),w}function l(d,f){var h=new e,g=0,y=0;r.forEach(d.nodes(),function(b){h.setNode(b,{v:b,in:0,out:0})}),r.forEach(d.edges(),function(b){var _=h.edge(b.v,b.w)||0,S=f(b),k=_+S;h.setEdge(b.v,b.w,k),y=Math.max(y,h.node(b.v).out+=S),g=Math.max(g,h.node(b.w).in+=S)});var w=r.range(y+g+3).map(function(){return new t}),x=g+1;return r.forEach(h.nodes(),function(b){u(w,x,h.node(b))}),{graph:h,buckets:w,zeroIdx:x}}function u(d,f,h){h.out?h.in?d[h.out-h.in+f].enqueue(h):d[d.length-1].enqueue(h):d[0].enqueue(h)}return Xh}var Gh,Rb;function c7(){if(Rb)return Gh;Rb=1;var r=En(),e=d7();Gh={run:t,undo:i};function t(o){var a=o.graph().acyclicer==="greedy"?e(o,l(o)):n(o);r.forEach(a,function(u){var d=o.edge(u);o.removeEdge(u),d.forwardName=u.name,d.reversed=!0,o.setEdge(u.w,u.v,d,r.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function n(o){var a=[],l={},u={};function d(f){r.has(u,f)||(u[f]=!0,l[f]=!0,r.forEach(o.outEdges(f),function(h){r.has(l,h.w)?a.push(h):d(h.w)}),delete l[f])}return r.forEach(o.nodes(),d),a}function i(o){r.forEach(o.edges(),function(a){var l=o.edge(a);if(l.reversed){o.removeEdge(a);var u=l.forwardName;delete l.reversed,delete l.forwardName,o.setEdge(a.w,a.v,l,u)}})}return Gh}var Yh,Ib;function Ir(){if(Ib)return Yh;Ib=1;var r=En(),e=Ni().Graph;Yh={addDummyNode:t,simplify:n,asNonCompoundGraph:i,successorWeights:o,predecessorWeights:a,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:f,addBorderNode:h,maxRank:g,partition:y,time:w,notime:x};function t(b,_,S,k){var O;do O=r.uniqueId(k);while(b.hasNode(O));return S.dummy=_,b.setNode(O,S),O}function n(b){var _=new e().setGraph(b.graph());return r.forEach(b.nodes(),function(S){_.setNode(S,b.node(S))}),r.forEach(b.edges(),function(S){var k=_.edge(S.v,S.w)||{weight:0,minlen:1},O=b.edge(S);_.setEdge(S.v,S.w,{weight:k.weight+O.weight,minlen:Math.max(k.minlen,O.minlen)})}),_}function i(b){var _=new e({multigraph:b.isMultigraph()}).setGraph(b.graph());return r.forEach(b.nodes(),function(S){b.children(S).length||_.setNode(S,b.node(S))}),r.forEach(b.edges(),function(S){_.setEdge(S,b.edge(S))}),_}function o(b){var _=r.map(b.nodes(),function(S){var k={};return r.forEach(b.outEdges(S),function(O){k[O.w]=(k[O.w]||0)+b.edge(O).weight}),k});return r.zipObject(b.nodes(),_)}function a(b){var _=r.map(b.nodes(),function(S){var k={};return r.forEach(b.inEdges(S),function(O){k[O.v]=(k[O.v]||0)+b.edge(O).weight}),k});return r.zipObject(b.nodes(),_)}function l(b,_){var S=b.x,k=b.y,O=_.x-S,M=_.y-k,R=b.width/2,T=b.height/2;if(!O&&!M)throw new Error("Not possible to find intersection inside of the rectangle");var I,$;return Math.abs(M)*R>Math.abs(O)*T?(M<0&&(T=-T),I=T*O/M,$=T):(O<0&&(R=-R),I=R,$=R*M/O),{x:S+I,y:k+$}}function u(b){var _=r.map(r.range(g(b)+1),function(){return[]});return r.forEach(b.nodes(),function(S){var k=b.node(S),O=k.rank;r.isUndefined(O)||(_[O][k.order]=S)}),_}function d(b){var _=r.min(r.map(b.nodes(),function(S){return b.node(S).rank}));r.forEach(b.nodes(),function(S){var k=b.node(S);r.has(k,"rank")&&(k.rank-=_)})}function f(b){var _=r.min(r.map(b.nodes(),function(M){return b.node(M).rank})),S=[];r.forEach(b.nodes(),function(M){var R=b.node(M).rank-_;S[R]||(S[R]=[]),S[R].push(M)});var k=0,O=b.graph().nodeRankFactor;r.forEach(S,function(M,R){r.isUndefined(M)&&R%O!==0?--k:k&&r.forEach(M,function(T){b.node(T).rank+=k})})}function h(b,_,S,k){var O={width:0,height:0};return arguments.length>=4&&(O.rank=S,O.order=k),t(b,"border",O,_)}function g(b){return r.max(r.map(b.nodes(),function(_){var S=b.node(_).rank;if(!r.isUndefined(S))return S}))}function y(b,_){var S={lhs:[],rhs:[]};return r.forEach(b,function(k){_(k)?S.lhs.push(k):S.rhs.push(k)}),S}function w(b,_){var S=r.now();try{return _()}finally{b+""+(r.now()-S)}}function x(b,_){return _()}return Yh}var Kh,Bb;function f7(){if(Bb)return Kh;Bb=1;var r=En(),e=Ir();Kh={run:t,undo:i};function t(o){o.graph().dummyChains=[],r.forEach(o.edges(),function(a){n(o,a)})}function n(o,a){var l=a.v,u=o.node(l).rank,d=a.w,f=o.node(d).rank,h=a.name,g=o.edge(a),y=g.labelRank;if(f!==u+1){o.removeEdge(a);var w,x,b;for(b=0,++u;u<f;++b,++u)g.points=[],x={width:0,height:0,edgeLabel:g,edgeObj:a,rank:u},w=e.addDummyNode(o,"edge",x,"_d"),u===y&&(x.width=g.width,x.height=g.height,x.dummy="edge-label",x.labelpos=g.labelpos),o.setEdge(l,w,{weight:g.weight},h),b===0&&o.graph().dummyChains.push(w),l=w;o.setEdge(l,d,{weight:g.weight},h)}}function i(o){r.forEach(o.graph().dummyChains,function(a){var l=o.node(a),u=l.edgeLabel,d;for(o.setEdge(l.edgeObj,u);l.dummy;)d=o.successors(a)[0],o.removeNode(a),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),a=d,l=o.node(a)})}return Kh}var Jh,jb;function lc(){if(jb)return Jh;jb=1;var r=En();Jh={longestPath:e,slack:t};function e(n){var i={};function o(a){var l=n.node(a);if(r.has(i,a))return l.rank;i[a]=!0;var u=r.min(r.map(n.outEdges(a),function(d){return o(d.w)-n.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}r.forEach(n.sources(),o)}function t(n,i){return n.node(i.w).rank-n.node(i.v).rank-n.edge(i).minlen}return Jh}var Zh,Hb;function Fw(){if(Hb)return Zh;Hb=1;var r=En(),e=Ni().Graph,t=lc().slack;Zh=n;function n(l){var u=new e({directed:!1}),d=l.nodes()[0],f=l.nodeCount();u.setNode(d,{});for(var h,g;i(u,l)<f;)h=o(u,l),g=u.hasNode(h.v)?t(l,h):-t(l,h),a(u,l,g);return u}function i(l,u){function d(f){r.forEach(u.nodeEdges(f),function(h){var g=h.v,y=f===g?h.w:g;!l.hasNode(y)&&!t(u,h)&&(l.setNode(y,{}),l.setEdge(f,y,{}),d(y))})}return r.forEach(l.nodes(),d),l.nodeCount()}function o(l,u){return r.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return t(u,d)})}function a(l,u,d){r.forEach(l.nodes(),function(f){u.node(f).rank+=d})}return Zh}var Qh,$b;function h7(){if($b)return Qh;$b=1;var r=En(),e=Fw(),t=lc().slack,n=lc().longestPath,i=Ni().alg.preorder,o=Ni().alg.postorder,a=Ir().simplify;Qh=l,l.initLowLimValues=h,l.initCutValues=u,l.calcCutValue=f,l.leaveEdge=y,l.enterEdge=w,l.exchangeEdges=x;function l(k){k=a(k),n(k);var O=e(k);h(O),u(O,k);for(var M,R;M=y(O);)R=w(O,k,M),x(O,k,M,R)}function u(k,O){var M=o(k,k.nodes());M=M.slice(0,M.length-1),r.forEach(M,function(R){d(k,O,R)})}function d(k,O,M){var R=k.node(M),T=R.parent;k.edge(M,T).cutvalue=f(k,O,M)}function f(k,O,M){var R=k.node(M),T=R.parent,I=!0,$=O.edge(M,T),ne=0;return $||(I=!1,$=O.edge(T,M)),ne=$.weight,r.forEach(O.nodeEdges(M),function(V){var J=V.v===M,D=J?V.w:V.v;if(D!==T){var U=J===I,j=O.edge(V).weight;if(ne+=U?j:-j,_(k,M,D)){var fe=k.edge(M,D).cutvalue;ne+=U?-fe:fe}}}),ne}function h(k,O){arguments.length<2&&(O=k.nodes()[0]),g(k,{},1,O)}function g(k,O,M,R,T){var I=M,$=k.node(R);return O[R]=!0,r.forEach(k.neighbors(R),function(ne){r.has(O,ne)||(M=g(k,O,M,ne,R))}),$.low=I,$.lim=M++,T?$.parent=T:delete $.parent,M}function y(k){return r.find(k.edges(),function(O){return k.edge(O).cutvalue<0})}function w(k,O,M){var R=M.v,T=M.w;O.hasEdge(R,T)||(R=M.w,T=M.v);var I=k.node(R),$=k.node(T),ne=I,V=!1;I.lim>$.lim&&(ne=$,V=!0);var J=r.filter(O.edges(),function(D){return V===S(k,k.node(D.v),ne)&&V!==S(k,k.node(D.w),ne)});return r.minBy(J,function(D){return t(O,D)})}function x(k,O,M,R){var T=M.v,I=M.w;k.removeEdge(T,I),k.setEdge(R.v,R.w,{}),h(k),u(k,O),b(k,O)}function b(k,O){var M=r.find(k.nodes(),function(T){return!O.node(T).parent}),R=i(k,M);R=R.slice(1),r.forEach(R,function(T){var I=k.node(T).parent,$=O.edge(T,I),ne=!1;$||($=O.edge(I,T),ne=!0),O.node(T).rank=O.node(I).rank+(ne?$.minlen:-$.minlen)})}function _(k,O,M){return k.hasEdge(O,M)}function S(k,O,M){return M.low<=O.lim&&O.lim<=M.lim}return Qh}var ep,Fb;function p7(){if(Fb)return ep;Fb=1;var r=lc(),e=r.longestPath,t=Fw(),n=h7();ep=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":a(u);break;case"longest-path":o(u);break;default:l(u)}}var o=e;function a(u){e(u),t(u)}function l(u){n(u)}return ep}var tp,zb;function v7(){if(zb)return tp;zb=1;var r=En();tp=e;function e(i){var o=n(i);r.forEach(i.graph().dummyChains,function(a){for(var l=i.node(a),u=l.edgeObj,d=t(i,o,u.v,u.w),f=d.path,h=d.lca,g=0,y=f[g],w=!0;a!==u.w;){if(l=i.node(a),w){for(;(y=f[g])!==h&&i.node(y).maxRank<l.rank;)g++;y===h&&(w=!1)}if(!w){for(;g<f.length-1&&i.node(y=f[g+1]).minRank<=l.rank;)g++;y=f[g]}i.setParent(a,y),a=i.successors(a)[0]}})}function t(i,o,a,l){var u=[],d=[],f=Math.min(o[a].low,o[l].low),h=Math.max(o[a].lim,o[l].lim),g,y;g=a;do g=i.parent(g),u.push(g);while(g&&(o[g].low>f||h>o[g].lim));for(y=g,g=l;(g=i.parent(g))!==y;)d.push(g);return{path:u.concat(d.reverse()),lca:y}}function n(i){var o={},a=0;function l(u){var d=a;r.forEach(i.children(u),l),o[u]={low:d,lim:a++}}return r.forEach(i.children(),l),o}return tp}var np,Wb;function g7(){if(Wb)return np;Wb=1;var r=En(),e=Ir();np={run:t,cleanup:a};function t(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),f=r.max(r.values(d))-1,h=2*f+1;l.graph().nestingRoot=u,r.forEach(l.edges(),function(y){l.edge(y).minlen*=h});var g=o(l)+1;r.forEach(l.children(),function(y){n(l,u,h,g,f,d,y)}),l.graph().nodeRankFactor=h}function n(l,u,d,f,h,g,y){var w=l.children(y);if(!w.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var x=e.addBorderNode(l,"_bt"),b=e.addBorderNode(l,"_bb"),_=l.node(y);l.setParent(x,y),_.borderTop=x,l.setParent(b,y),_.borderBottom=b,r.forEach(w,function(S){n(l,u,d,f,h,g,S);var k=l.node(S),O=k.borderTop?k.borderTop:S,M=k.borderBottom?k.borderBottom:S,R=k.borderTop?f:2*f,T=O!==M?1:h-g[y]+1;l.setEdge(x,O,{weight:R,minlen:T,nestingEdge:!0}),l.setEdge(M,b,{weight:R,minlen:T,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,x,{weight:0,minlen:h+g[y]})}function i(l){var u={};function d(f,h){var g=l.children(f);g&&g.length&&r.forEach(g,function(y){d(y,h+1)}),u[f]=h}return r.forEach(l.children(),function(f){d(f,1)}),u}function o(l){return r.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function a(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,r.forEach(l.edges(),function(d){var f=l.edge(d);f.nestingEdge&&l.removeEdge(d)})}return np}var rp,Ub;function m7(){if(Ub)return rp;Ub=1;var r=En(),e=Ir();rp=t;function t(i){function o(a){var l=i.children(a),u=i.node(a);if(l.length&&r.forEach(l,o),r.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,f=u.maxRank+1;d<f;++d)n(i,"borderLeft","_bl",a,u,d),n(i,"borderRight","_br",a,u,d)}}r.forEach(i.children(),o)}function n(i,o,a,l,u,d){var f={width:0,height:0,rank:d,borderType:o},h=u[o][d-1],g=e.addDummyNode(i,"border",f,a);u[o][d]=g,i.setParent(g,l),h&&i.setEdge(h,g,{weight:1})}return rp}var ip,Vb;function y7(){if(Vb)return ip;Vb=1;var r=En();ip={adjust:e,undo:t};function e(d){var f=d.graph().rankdir.toLowerCase();(f==="lr"||f==="rl")&&n(d)}function t(d){var f=d.graph().rankdir.toLowerCase();(f==="bt"||f==="rl")&&o(d),(f==="lr"||f==="rl")&&(l(d),n(d))}function n(d){r.forEach(d.nodes(),function(f){i(d.node(f))}),r.forEach(d.edges(),function(f){i(d.edge(f))})}function i(d){var f=d.width;d.width=d.height,d.height=f}function o(d){r.forEach(d.nodes(),function(f){a(d.node(f))}),r.forEach(d.edges(),function(f){var h=d.edge(f);r.forEach(h.points,a),r.has(h,"y")&&a(h)})}function a(d){d.y=-d.y}function l(d){r.forEach(d.nodes(),function(f){u(d.node(f))}),r.forEach(d.edges(),function(f){var h=d.edge(f);r.forEach(h.points,u),r.has(h,"x")&&u(h)})}function u(d){var f=d.x;d.x=d.y,d.y=f}return ip}var op,qb;function _7(){if(qb)return op;qb=1;var r=En();op=e;function e(t){var n={},i=r.filter(t.nodes(),function(d){return!t.children(d).length}),o=r.max(r.map(i,function(d){return t.node(d).rank})),a=r.map(r.range(o+1),function(){return[]});function l(d){if(!r.has(n,d)){n[d]=!0;var f=t.node(d);a[f.rank].push(d),r.forEach(t.successors(d),l)}}var u=r.sortBy(i,function(d){return t.node(d).rank});return r.forEach(u,l),a}return op}var ap,Xb;function b7(){if(Xb)return ap;Xb=1;var r=En();ap=e;function e(n,i){for(var o=0,a=1;a<i.length;++a)o+=t(n,i[a-1],i[a]);return o}function t(n,i,o){for(var a=r.zipObject(o,r.map(o,function(g,y){return y})),l=r.flatten(r.map(i,function(g){return r.sortBy(r.map(n.outEdges(g),function(y){return{pos:a[y.w],weight:n.edge(y).weight}}),"pos")}),!0),u=1;u<o.length;)u<<=1;var d=2*u-1;u-=1;var f=r.map(new Array(d),function(){return 0}),h=0;return r.forEach(l.forEach(function(g){var y=g.pos+u;f[y]+=g.weight;for(var w=0;y>0;)y%2&&(w+=f[y+1]),y=y-1>>1,f[y]+=g.weight;h+=g.weight*w})),h}return ap}var sp,Gb;function x7(){if(Gb)return sp;Gb=1;var r=En();sp=e;function e(t,n){return r.map(n,function(i){var o=t.inEdges(i);if(o.length){var a=r.reduce(o,function(l,u){var d=t.edge(u),f=t.node(u.v);return{sum:l.sum+d.weight*f.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:a.sum/a.weight,weight:a.weight}}else return{v:i}})}return sp}var lp,Yb;function w7(){if(Yb)return lp;Yb=1;var r=En();lp=e;function e(i,o){var a={};r.forEach(i,function(u,d){var f=a[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};r.isUndefined(u.barycenter)||(f.barycenter=u.barycenter,f.weight=u.weight)}),r.forEach(o.edges(),function(u){var d=a[u.v],f=a[u.w];!r.isUndefined(d)&&!r.isUndefined(f)&&(f.indegree++,d.out.push(a[u.w]))});var l=r.filter(a,function(u){return!u.indegree});return t(l)}function t(i){var o=[];function a(d){return function(f){f.merged||(r.isUndefined(f.barycenter)||r.isUndefined(d.barycenter)||f.barycenter>=d.barycenter)&&n(d,f)}}function l(d){return function(f){f.in.push(d),--f.indegree===0&&i.push(f)}}for(;i.length;){var u=i.pop();o.push(u),r.forEach(u.in.reverse(),a(u)),r.forEach(u.out,l(u))}return r.map(r.filter(o,function(d){return!d.merged}),function(d){return r.pick(d,["vs","i","barycenter","weight"])})}function n(i,o){var a=0,l=0;i.weight&&(a+=i.barycenter*i.weight,l+=i.weight),o.weight&&(a+=o.barycenter*o.weight,l+=o.weight),i.vs=o.vs.concat(i.vs),i.barycenter=a/l,i.weight=l,i.i=Math.min(o.i,i.i),o.merged=!0}return lp}var up,Kb;function S7(){if(Kb)return up;Kb=1;var r=En(),e=Ir();up=t;function t(o,a){var l=e.partition(o,function(x){return r.has(x,"barycenter")}),u=l.lhs,d=r.sortBy(l.rhs,function(x){return-x.i}),f=[],h=0,g=0,y=0;u.sort(i(!!a)),y=n(f,d,y),r.forEach(u,function(x){y+=x.vs.length,f.push(x.vs),h+=x.barycenter*x.weight,g+=x.weight,y=n(f,d,y)});var w={vs:r.flatten(f,!0)};return g&&(w.barycenter=h/g,w.weight=g),w}function n(o,a,l){for(var u;a.length&&(u=r.last(a)).i<=l;)a.pop(),o.push(u.vs),l++;return l}function i(o){return function(a,l){return a.barycenter<l.barycenter?-1:a.barycenter>l.barycenter?1:o?l.i-a.i:a.i-l.i}}return up}var dp,Jb;function E7(){if(Jb)return dp;Jb=1;var r=En(),e=x7(),t=w7(),n=S7();dp=i;function i(l,u,d,f){var h=l.children(u),g=l.node(u),y=g?g.borderLeft:void 0,w=g?g.borderRight:void 0,x={};y&&(h=r.filter(h,function(M){return M!==y&&M!==w}));var b=e(l,h);r.forEach(b,function(M){if(l.children(M.v).length){var R=i(l,M.v,d,f);x[M.v]=R,r.has(R,"barycenter")&&a(M,R)}});var _=t(b,d);o(_,x);var S=n(_,f);if(y&&(S.vs=r.flatten([y,S.vs,w],!0),l.predecessors(y).length)){var k=l.node(l.predecessors(y)[0]),O=l.node(l.predecessors(w)[0]);r.has(S,"barycenter")||(S.barycenter=0,S.weight=0),S.barycenter=(S.barycenter*S.weight+k.order+O.order)/(S.weight+2),S.weight+=2}return S}function o(l,u){r.forEach(l,function(d){d.vs=r.flatten(d.vs.map(function(f){return u[f]?u[f].vs:f}),!0)})}function a(l,u){r.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return dp}var cp,Zb;function C7(){if(Zb)return cp;Zb=1;var r=En(),e=Ni().Graph;cp=t;function t(i,o,a){var l=n(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return r.forEach(i.nodes(),function(d){var f=i.node(d),h=i.parent(d);(f.rank===o||f.minRank<=o&&o<=f.maxRank)&&(u.setNode(d),u.setParent(d,h||l),r.forEach(i[a](d),function(g){var y=g.v===d?g.w:g.v,w=u.edge(y,d),x=r.isUndefined(w)?0:w.weight;u.setEdge(y,d,{weight:i.edge(g).weight+x})}),r.has(f,"minRank")&&u.setNode(d,{borderLeft:f.borderLeft[o],borderRight:f.borderRight[o]}))}),u}function n(i){for(var o;i.hasNode(o=r.uniqueId("_root")););return o}return cp}var fp,Qb;function k7(){if(Qb)return fp;Qb=1;var r=En();fp=e;function e(t,n,i){var o={},a;r.forEach(i,function(l){for(var u=t.parent(l),d,f;u;){if(d=t.parent(u),d?(f=o[d],o[d]=u):(f=a,a=u),f&&f!==u){n.setEdge(f,u);return}u=d}})}return fp}var hp,e1;function O7(){if(e1)return hp;e1=1;var r=En(),e=_7(),t=b7(),n=E7(),i=C7(),o=k7(),a=Ni().Graph,l=Ir();hp=u;function u(g){var y=l.maxRank(g),w=d(g,r.range(1,y+1),"inEdges"),x=d(g,r.range(y-1,-1,-1),"outEdges"),b=e(g);h(g,b);for(var _=Number.POSITIVE_INFINITY,S,k=0,O=0;O<4;++k,++O){f(k%2?w:x,k%4>=2),b=l.buildLayerMatrix(g);var M=t(g,b);M<_&&(O=0,S=r.cloneDeep(b),_=M)}h(g,S)}function d(g,y,w){return r.map(y,function(x){return i(g,x,w)})}function f(g,y){var w=new a;r.forEach(g,function(x){var b=x.graph().root,_=n(x,b,w,y);r.forEach(_.vs,function(S,k){x.node(S).order=k}),o(x,w,_.vs)})}function h(g,y){r.forEach(y,function(w){r.forEach(w,function(x,b){g.node(x).order=b})})}return hp}var pp,t1;function N7(){if(t1)return pp;t1=1;var r=En(),e=Ni().Graph,t=Ir();pp={positionX:w,findType1Conflicts:n,findType2Conflicts:i,addConflict:a,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:g,findSmallestWidthAlignment:h,balance:y};function n(_,S){var k={};function O(M,R){var T=0,I=0,$=M.length,ne=r.last(R);return r.forEach(R,function(V,J){var D=o(_,V),U=D?_.node(D).order:$;(D||V===ne)&&(r.forEach(R.slice(I,J+1),function(j){r.forEach(_.predecessors(j),function(fe){var Ee=_.node(fe),_e=Ee.order;(_e<T||U<_e)&&!(Ee.dummy&&_.node(j).dummy)&&a(k,fe,j)})}),I=J+1,T=U)}),R}return r.reduce(S,O),k}function i(_,S){var k={};function O(R,T,I,$,ne){var V;r.forEach(r.range(T,I),function(J){V=R[J],_.node(V).dummy&&r.forEach(_.predecessors(V),function(D){var U=_.node(D);U.dummy&&(U.order<$||U.order>ne)&&a(k,D,V)})})}function M(R,T){var I=-1,$,ne=0;return r.forEach(T,function(V,J){if(_.node(V).dummy==="border"){var D=_.predecessors(V);D.length&&($=_.node(D[0]).order,O(T,ne,J,I,$),ne=J,I=$)}O(T,ne,T.length,$,R.length)}),T}return r.reduce(S,M),k}function o(_,S){if(_.node(S).dummy)return r.find(_.predecessors(S),function(k){return _.node(k).dummy})}function a(_,S,k){if(S>k){var O=S;S=k,k=O}var M=_[S];M||(_[S]=M={}),M[k]=!0}function l(_,S,k){if(S>k){var O=S;S=k,k=O}return r.has(_[S],k)}function u(_,S,k,O){var M={},R={},T={};return r.forEach(S,function(I){r.forEach(I,function($,ne){M[$]=$,R[$]=$,T[$]=ne})}),r.forEach(S,function(I){var $=-1;r.forEach(I,function(ne){var V=O(ne);if(V.length){V=r.sortBy(V,function(fe){return T[fe]});for(var J=(V.length-1)/2,D=Math.floor(J),U=Math.ceil(J);D<=U;++D){var j=V[D];R[ne]===ne&&$<T[j]&&!l(k,ne,j)&&(R[j]=ne,R[ne]=M[ne]=M[j],$=T[j])}}})}),{root:M,align:R}}function d(_,S,k,O,M){var R={},T=f(_,S,k,M),I=M?"borderLeft":"borderRight";function $(J,D){for(var U=T.nodes(),j=U.pop(),fe={};j;)fe[j]?J(j):(fe[j]=!0,U.push(j),U=U.concat(D(j))),j=U.pop()}function ne(J){R[J]=T.inEdges(J).reduce(function(D,U){return Math.max(D,R[U.v]+T.edge(U))},0)}function V(J){var D=T.outEdges(J).reduce(function(j,fe){return Math.min(j,R[fe.w]-T.edge(fe))},Number.POSITIVE_INFINITY),U=_.node(J);D!==Number.POSITIVE_INFINITY&&U.borderType!==I&&(R[J]=Math.max(R[J],D))}return $(ne,T.predecessors.bind(T)),$(V,T.successors.bind(T)),r.forEach(O,function(J){R[J]=R[k[J]]}),R}function f(_,S,k,O){var M=new e,R=_.graph(),T=x(R.nodesep,R.edgesep,O);return r.forEach(S,function(I){var $;r.forEach(I,function(ne){var V=k[ne];if(M.setNode(V),$){var J=k[$],D=M.edge(J,V);M.setEdge(J,V,Math.max(T(_,ne,$),D||0))}$=ne})}),M}function h(_,S){return r.minBy(r.values(S),function(k){var O=Number.NEGATIVE_INFINITY,M=Number.POSITIVE_INFINITY;return r.forIn(k,function(R,T){var I=b(_,T)/2;O=Math.max(R+I,O),M=Math.min(R-I,M)}),O-M})}function g(_,S){var k=r.values(S),O=r.min(k),M=r.max(k);r.forEach(["u","d"],function(R){r.forEach(["l","r"],function(T){var I=R+T,$=_[I],ne;if($!==S){var V=r.values($);ne=T==="l"?O-r.min(V):M-r.max(V),ne&&(_[I]=r.mapValues($,function(J){return J+ne}))}})})}function y(_,S){return r.mapValues(_.ul,function(k,O){if(S)return _[S.toLowerCase()][O];var M=r.sortBy(r.map(_,O));return(M[1]+M[2])/2})}function w(_){var S=t.buildLayerMatrix(_),k=r.merge(n(_,S),i(_,S)),O={},M;r.forEach(["u","d"],function(T){M=T==="u"?S:r.values(S).reverse(),r.forEach(["l","r"],function(I){I==="r"&&(M=r.map(M,function(J){return r.values(J).reverse()}));var $=(T==="u"?_.predecessors:_.successors).bind(_),ne=u(_,M,k,$),V=d(_,M,ne.root,ne.align,I==="r");I==="r"&&(V=r.mapValues(V,function(J){return-J})),O[T+I]=V})});var R=h(_,O);return g(O,R),y(O,_.graph().align)}function x(_,S,k){return function(O,M,R){var T=O.node(M),I=O.node(R),$=0,ne;if($+=T.width/2,r.has(T,"labelpos"))switch(T.labelpos.toLowerCase()){case"l":ne=-T.width/2;break;case"r":ne=T.width/2;break}if(ne&&($+=k?ne:-ne),ne=0,$+=(T.dummy?S:_)/2,$+=(I.dummy?S:_)/2,$+=I.width/2,r.has(I,"labelpos"))switch(I.labelpos.toLowerCase()){case"l":ne=I.width/2;break;case"r":ne=-I.width/2;break}return ne&&($+=k?ne:-ne),ne=0,$}}function b(_,S){return _.node(S).width}return pp}var vp,n1;function M7(){if(n1)return vp;n1=1;var r=En(),e=Ir(),t=N7().positionX;vp=n;function n(o){o=e.asNonCompoundGraph(o),i(o),r.forEach(t(o),function(a,l){o.node(l).x=a})}function i(o){var a=e.buildLayerMatrix(o),l=o.graph().ranksep,u=0;r.forEach(a,function(d){var f=r.max(r.map(d,function(h){return o.node(h).height}));r.forEach(d,function(h){o.node(h).y=u+f/2}),u+=f+l})}return vp}var gp,r1;function A7(){if(r1)return gp;r1=1;var r=En(),e=c7(),t=f7(),n=p7(),i=Ir().normalizeRanks,o=v7(),a=Ir().removeEmptyRanks,l=g7(),u=m7(),d=y7(),f=O7(),h=M7(),g=Ir(),y=Ni().Graph;gp=w;function w(de,le){var W=le&&le.debugTiming?g.time:g.notime;W("layout",function(){var Y=W("  buildLayoutGraph",function(){return $(de)});W("  runLayout",function(){x(Y,W)}),W("  updateInputGraph",function(){b(de,Y)})})}function x(de,le){le("    makeSpaceForEdgeLabels",function(){ne(de)}),le("    removeSelfEdges",function(){rt(de)}),le("    acyclic",function(){e.run(de)}),le("    nestingGraph.run",function(){l.run(de)}),le("    rank",function(){n(g.asNonCompoundGraph(de))}),le("    injectEdgeLabelProxies",function(){V(de)}),le("    removeEmptyRanks",function(){a(de)}),le("    nestingGraph.cleanup",function(){l.cleanup(de)}),le("    normalizeRanks",function(){i(de)}),le("    assignRankMinMax",function(){J(de)}),le("    removeEdgeLabelProxies",function(){D(de)}),le("    normalize.run",function(){t.run(de)}),le("    parentDummyChains",function(){o(de)}),le("    addBorderSegments",function(){u(de)}),le("    order",function(){f(de)}),le("    insertSelfEdges",function(){Me(de)}),le("    adjustCoordinateSystem",function(){d.adjust(de)}),le("    position",function(){h(de)}),le("    positionSelfEdges",function(){ve(de)}),le("    removeBorderNodes",function(){_e(de)}),le("    normalize.undo",function(){t.undo(de)}),le("    fixupEdgeLabelCoords",function(){fe(de)}),le("    undoCoordinateSystem",function(){d.undo(de)}),le("    translateGraph",function(){U(de)}),le("    assignNodeIntersects",function(){j(de)}),le("    reversePoints",function(){Ee(de)}),le("    acyclic.undo",function(){e.undo(de)})}function b(de,le){r.forEach(de.nodes(),function(W){var Y=de.node(W),se=le.node(W);Y&&(Y.x=se.x,Y.y=se.y,le.children(W).length&&(Y.width=se.width,Y.height=se.height))}),r.forEach(de.edges(),function(W){var Y=de.edge(W),se=le.edge(W);Y.points=se.points,r.has(se,"x")&&(Y.x=se.x,Y.y=se.y)}),de.graph().width=le.graph().width,de.graph().height=le.graph().height}var _=["nodesep","edgesep","ranksep","marginx","marginy"],S={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},k=["acyclicer","ranker","rankdir","align"],O=["width","height"],M={width:0,height:0},R=["minlen","weight","width","height","labeloffset"],T={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},I=["labelpos"];function $(de){var le=new y({multigraph:!0,compound:!0}),W=Be(de.graph());return le.setGraph(r.merge({},S,Ve(W,_),r.pick(W,k))),r.forEach(de.nodes(),function(Y){var se=Be(de.node(Y));le.setNode(Y,r.defaults(Ve(se,O),M)),le.setParent(Y,de.parent(Y))}),r.forEach(de.edges(),function(Y){var se=Be(de.edge(Y));le.setEdge(Y,r.merge({},T,Ve(se,R),r.pick(se,I)))}),le}function ne(de){var le=de.graph();le.ranksep/=2,r.forEach(de.edges(),function(W){var Y=de.edge(W);Y.minlen*=2,Y.labelpos.toLowerCase()!=="c"&&(le.rankdir==="TB"||le.rankdir==="BT"?Y.width+=Y.labeloffset:Y.height+=Y.labeloffset)})}function V(de){r.forEach(de.edges(),function(le){var W=de.edge(le);if(W.width&&W.height){var Y=de.node(le.v),se=de.node(le.w),ge={rank:(se.rank-Y.rank)/2+Y.rank,e:le};g.addDummyNode(de,"edge-proxy",ge,"_ep")}})}function J(de){var le=0;r.forEach(de.nodes(),function(W){var Y=de.node(W);Y.borderTop&&(Y.minRank=de.node(Y.borderTop).rank,Y.maxRank=de.node(Y.borderBottom).rank,le=r.max(le,Y.maxRank))}),de.graph().maxRank=le}function D(de){r.forEach(de.nodes(),function(le){var W=de.node(le);W.dummy==="edge-proxy"&&(de.edge(W.e).labelRank=W.rank,de.removeNode(le))})}function U(de){var le=Number.POSITIVE_INFINITY,W=0,Y=Number.POSITIVE_INFINITY,se=0,ge=de.graph(),Pe=ge.marginx||0,Le=ge.marginy||0;function He(ft){var Ke=ft.x,Nt=ft.y,yt=ft.width,Wt=ft.height;le=Math.min(le,Ke-yt/2),W=Math.max(W,Ke+yt/2),Y=Math.min(Y,Nt-Wt/2),se=Math.max(se,Nt+Wt/2)}r.forEach(de.nodes(),function(ft){He(de.node(ft))}),r.forEach(de.edges(),function(ft){var Ke=de.edge(ft);r.has(Ke,"x")&&He(Ke)}),le-=Pe,Y-=Le,r.forEach(de.nodes(),function(ft){var Ke=de.node(ft);Ke.x-=le,Ke.y-=Y}),r.forEach(de.edges(),function(ft){var Ke=de.edge(ft);r.forEach(Ke.points,function(Nt){Nt.x-=le,Nt.y-=Y}),r.has(Ke,"x")&&(Ke.x-=le),r.has(Ke,"y")&&(Ke.y-=Y)}),ge.width=W-le+Pe,ge.height=se-Y+Le}function j(de){r.forEach(de.edges(),function(le){var W=de.edge(le),Y=de.node(le.v),se=de.node(le.w),ge,Pe;W.points?(ge=W.points[0],Pe=W.points[W.points.length-1]):(W.points=[],ge=se,Pe=Y),W.points.unshift(g.intersectRect(Y,ge)),W.points.push(g.intersectRect(se,Pe))})}function fe(de){r.forEach(de.edges(),function(le){var W=de.edge(le);if(r.has(W,"x"))switch((W.labelpos==="l"||W.labelpos==="r")&&(W.width-=W.labeloffset),W.labelpos){case"l":W.x-=W.width/2+W.labeloffset;break;case"r":W.x+=W.width/2+W.labeloffset;break}})}function Ee(de){r.forEach(de.edges(),function(le){var W=de.edge(le);W.reversed&&W.points.reverse()})}function _e(de){r.forEach(de.nodes(),function(le){if(de.children(le).length){var W=de.node(le),Y=de.node(W.borderTop),se=de.node(W.borderBottom),ge=de.node(r.last(W.borderLeft)),Pe=de.node(r.last(W.borderRight));W.width=Math.abs(Pe.x-ge.x),W.height=Math.abs(se.y-Y.y),W.x=ge.x+W.width/2,W.y=Y.y+W.height/2}}),r.forEach(de.nodes(),function(le){de.node(le).dummy==="border"&&de.removeNode(le)})}function rt(de){r.forEach(de.edges(),function(le){if(le.v===le.w){var W=de.node(le.v);W.selfEdges||(W.selfEdges=[]),W.selfEdges.push({e:le,label:de.edge(le)}),de.removeEdge(le)}})}function Me(de){var le=g.buildLayerMatrix(de);r.forEach(le,function(W){var Y=0;r.forEach(W,function(se,ge){var Pe=de.node(se);Pe.order=ge+Y,r.forEach(Pe.selfEdges,function(Le){g.addDummyNode(de,"selfedge",{width:Le.label.width,height:Le.label.height,rank:Pe.rank,order:ge+ ++Y,e:Le.e,label:Le.label},"_se")}),delete Pe.selfEdges})})}function ve(de){r.forEach(de.nodes(),function(le){var W=de.node(le);if(W.dummy==="selfedge"){var Y=de.node(W.e.v),se=Y.x+Y.width/2,ge=Y.y,Pe=W.x-se,Le=Y.height/2;de.setEdge(W.e,W.label),de.removeNode(le),W.label.points=[{x:se+2*Pe/3,y:ge-Le},{x:se+5*Pe/6,y:ge-Le},{x:se+Pe,y:ge},{x:se+5*Pe/6,y:ge+Le},{x:se+2*Pe/3,y:ge+Le}],W.label.x=W.x,W.label.y=W.y}})}function Ve(de,le){return r.mapValues(r.pick(de,le),Number)}function Be(de){var le={};return r.forEach(de,function(W,Y){le[Y.toLowerCase()]=W}),le}return gp}var mp,i1;function T7(){if(i1)return mp;i1=1;var r=En(),e=Ir(),t=Ni().Graph;mp={debugOrdering:n};function n(i){var o=e.buildLayerMatrix(i),a=new t({compound:!0,multigraph:!0}).setGraph({});return r.forEach(i.nodes(),function(l){a.setNode(l,{label:l}),a.setParent(l,"layer"+i.node(l).rank)}),r.forEach(i.edges(),function(l){a.setEdge(l.v,l.w,{},l.name)}),r.forEach(o,function(l,u){var d="layer"+u;a.setNode(d,{rank:"same"}),r.reduce(l,function(f,h){return a.setEdge(f,h,{style:"invis"}),h})}),a}return mp}var yp,o1;function D7(){return o1||(o1=1,yp="0.8.5"),yp}var _p,a1;function L7(){return a1||(a1=1,_p={graphlib:Ni(),layout:A7(),debug:T7(),util:{time:Ir().time,notime:Ir().notime},version:D7()}),_p}var zw=L7();const P7=ha(zw);var bv=function(){return bv=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},bv.apply(this,arguments)},R7=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},I7=function(){function r(){}return r.prototype.render=function(e){this.lf=e},r.prototype.layout=function(e){var t=this;e===void 0&&(e={});var n=this.lf.graphModel,i=n.nodes,o=n.edges,a=n.gridSize,l=100,u=150;a>20&&(l=a*2,u=a*2),this.option=bv({rankdir:"LR",align:"UL",ranker:"tight-tree",ranksep:u,nodesep:l,marginx:120,marginy:120},e);var d=new zw.graphlib.Graph;d.setGraph(this.option),d.setDefaultEdgeLabel(function(){return{}}),i.forEach(function(g){d.setNode(g.id,{width:g.width||150,height:g.height||50,id:g.id})}),o.forEach(function(g){d.setEdge(g.sourceNodeId,g.targetNodeId,{id:g.id})}),P7.layout(d);var f=[],h=[];i.forEach(function(g){var y,w=d.node(g.id),x=w.x,b=w.y,_=g.getData();if(!_)throw new Error("布局错误：找不到ID为 ".concat(g.id," 的节点"));_.x=x,_.y=b,!((y=_==null?void 0:_.text)===null||y===void 0)&&y.x&&(_.text.x=x,_.text.y=b),f.push(_)}),o.forEach(function(g){var y=g.getData();if(y){if(!e.isDefaultAnchor)delete y.pointsList,delete y.startPoint,delete y.endPoint,y.text&&y.text.value&&(y.text=y.text.value);else{delete y.pointsList,delete y.startPoint,delete y.endPoint,delete y.sourceAnchorId,delete y.targetAnchorId;var w=t.lf.getEdgeModelById(g.id);if(w&&(y.pointsList=t.calcPointsList(w,f)),y.pointsList){var x=y.pointsList[0],b=y.pointsList[y.pointsList.length-1];y.startPoint={x:x.x,y:x.y},y.endPoint={x:b.x,y:b.y}}y.text&&y.text.value&&(y.text=y.text.value)}h.push(y)}}),this.lf.renderRawData({nodes:f,edges:h})},r.prototype.getBytesLength=function(e){if(!e)return 0;for(var t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);e.match(/[A-Z]/)?t+=1.5:i>=1&&i<=126||i>=65376&&i<=65439?t+=1:t+=2}return t},r.prototype.pointFilter=function(e){for(var t=R7([],e,!0),n=1;n<t.length-1;){var i=t[n-1],o=t[n],a=t[n+1];i.x===o.x&&o.x===a.x||i.y===o.y&&o.y===a.y?t.splice(n,1):n++}return t},r.prototype.calcPointsList=function(e,t){var n=[],i=this.lf.getNodeModelById(e.sourceNodeId),o=this.lf.getNodeModelById(e.targetNodeId),a=t.find(function(d){return d.id===e.sourceNodeId}),l=t.find(function(d){return d.id===e.targetNodeId});if(!(!i||!o||!a||!l)){var u=Number(e.offset)||50;if(this.option.rankdir==="LR"&&e.modelType==="polyline-edge"){if(a.x<l.x)return n.push({x:a.x+i.width/2,y:a.y}),n.push({x:a.x+i.width/2+u,y:a.y}),n.push({x:a.x+i.width/2+u,y:l.y}),n.push({x:l.x-o.width/2,y:l.y}),this.pointFilter(n);if(a.x>l.x)return a.y>=l.y?(n.push({x:a.x,y:a.y+i.height/2}),n.push({x:a.x,y:a.y+i.height/2+u}),n.push({x:l.x,y:a.y+i.height/2+u}),n.push({x:l.x,y:l.y+o.height/2})):(n.push({x:a.x,y:a.y-i.height/2}),n.push({x:a.x,y:a.y-i.height/2-u}),n.push({x:l.x,y:a.y-i.height/2-u}),n.push({x:l.x,y:l.y-o.height/2})),this.pointFilter(n)}if(this.option.rankdir==="TB"&&e.modelType==="polyline-edge"){if(a.y<l.y)return n.push({x:a.x,y:a.y+i.height/2}),n.push({x:a.x,y:a.y+i.height/2+u}),n.push({x:l.x,y:a.y+i.height/2+u}),n.push({x:l.x,y:l.y-o.height/2}),this.pointFilter(n);if(a.y>l.y)return a.x>=l.x?(n.push({x:a.x+i.width/2,y:a.y}),n.push({x:a.x+i.width/2+u,y:a.y}),n.push({x:a.x+i.width/2+u,y:l.y}),n.push({x:l.x+o.width/2,y:l.y})):(n.push({x:a.x-i.width/2,y:a.y}),n.push({x:a.x-i.width/2-u,y:a.y}),n.push({x:a.x-i.width/2-u,y:l.y}),n.push({x:l.x-o.width/2,y:l.y})),this.pointFilter(n)}}},r.pluginName="dagre",r}();const B7={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(r){if(r){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const r=this.getGraphModel(),e=this.getModel();r.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},j7={class:"custom-line-popup"};function H7(r,e,t,n,i,o){return Mo((G(),ue("div",j7,[E("button",{class:"delete-btn",onClick:e[0]||(e[0]=dn((...a)=>o.handleDelete&&o.handleDelete(...a),["stop"]))},"删 除")],512)),[[fa,i.isDeleteConfirmShow]])}const $7=xt(B7,[["render",H7],["__scopeId","data-v-8168a5a6"]]),F7=70,z7=36;let W7=class extends vs{constructor(e){super(e),this.isMounted=!1,this.r=bn($7,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=ms({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getText(){const{model:e}=this.props,{customWidth:t=F7,customHeight:n=z7}=e.getProperties(),i=e.id,{startPoint:o,endPoint:a,arrowConfig:l,pointsList:u}=e;let d={x:(o.x+a.x-t)/2,y:(o.y+a.y-n)/2,width:t,height:n};if(u.length>2){let h=Math.round(u.length/2);d.x=u[h-1].x+5,d.y=u[h-1].y}const f={width:t,height:n};return setTimeout(()=>{const h=document.querySelector("#line_"+i).querySelector(".vue-app-wrapper");this.isMounted?(this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties()):(this.isMounted=!0,this.app.mount(h))},0),wt("foreignObject",{...d,id:"line_"+i},[wt("div",{id:i,style:f,className:"vue-app-wrapper"})])}},U7=class extends hs{initEdgeData(e){super.initEdgeData(e)}createId(){return Ul("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#2475FC":e.stroke="#A1A7B3",e.strokeWidth=2,e}getArrowStyle(){const e=super.getArrowStyle();return e.refX=0,e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),n=this.graphModel.getNodeModelById(this.targetNodeId),i=n==null?void 0:n.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}};const V7={type:"custom-edge",view:W7,model:U7},q7={name:"CustomLine",emits:["delete"],inject:["getGraphModel","getModel"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isDeleteConfirmShow:!1}},watch:{isSelected(r){if(r){let t=this.getGraphModel().getSelectElements(!0);t.nodes.length===0&&t.edges.length===1&&(this.isDeleteConfirmShow=!0)}else this.isDeleteConfirmShow=!1}},methods:{handleDelete(){const r=this.getGraphModel(),e=this.getModel();r.eventCenter.emit("custom:edge:delete",e),this.$emit("delete")}}},X7={class:"custom-line-popup"};function G7(r,e,t,n,i,o){return Mo((G(),ue("div",X7,[E("div",{class:"minus-circle-outlined",onClick:e[0]||(e[0]=dn((...a)=>o.handleDelete&&o.handleDelete(...a),["stop"]))})],512)),[[fa,i.isDeleteConfirmShow]])}const Y7=xt(q7,[["render",G7],["__scopeId","data-v-871eddb7"]]);class K7 extends cv{constructor(e){super(e),this.isMounted=!1,this.r=bn(Y7,{properties:e.model.getProperties(),isSelected:e.model.isSelected,isHovered:e.model.isHovered}),this.app=ms({render:()=>this.r,provide:()=>({getModel:()=>e.model,getGraphModel:()=>e.graphModel}),mounted:()=>{}})}getEndArrow(){const{model:e}=this.props,{stroke:t,strokeWidth:n}=e.getArrowStyle();return wt("path",{stroke:t,strokeWidth:n,d:"M -9 -7 0 0 -9 7",fill:"none"})}getText(){const{model:e}=this.props,{startPoint:t,endPoint:n,pointsList:i}=e,o=e.id,a=24,l=24,u=a/2,d=l/2,f=_=>{const{x:S,y:k}=t,{x:O,y:M}=i[1],{x:R,y:T}=i[2],{x:I,y:$}=n,ne=_*_,V=ne*_,J=1-_,D=J*J,U=D*J;return{x:S*U+3*O*D*_+3*R*J*ne+I*V,y:k*U+3*M*D*_+3*T*J*ne+$*V}},h=(_=5)=>{let S=0,k=f(0);for(let O=1;O<=_;O++){const M=O/_,R=f(M),T=R.x-k.x,I=R.y-k.y;S+=Math.sqrt(T*T+I*I),k=R}return S},g=_=>{const S=_/2;let k=0,O=1,M=.5,R=1e-4;for(;O-k>R;)M=(k+O)/2,T(M)<S?k=M:O=M;function T(I){let $=0,ne=f(0);const V=5;for(let J=1;J<=V;J++){const D=J/V*I,U=f(D),j=U.x-ne.x,fe=U.y-ne.y;$+=Math.sqrt(j*j+fe*fe),ne=U}return $}return f(M)},y=h(),w=g(y),x={x:w.x-u,y:w.y-d,width:a,height:l},b={width:a,height:l};return setTimeout(()=>{var S,k;const _=(S=document.querySelector(`#line_${o}`))==null?void 0:S.querySelector(".vue-app-wrapper");!this.isMounted&&_?(this.isMounted=!0,this.app.mount(_)):(k=this.r)!=null&&k.component&&(this.r.component.props.isSelected=e.isSelected,this.r.component.props.isHovered=e.isHovered,this.r.component.props.properties=e.getProperties())},0),wt("foreignObject",{...x,id:`line_${o}`},[wt("div",{id:o,style:b,className:"vue-app-wrapper"})])}}class J7 extends Yp{initEdgeData(e){super.initEdgeData(e)}setAttributes(e){super.setAttributes(e);let t=this.getProperties().offset;t&&(this.offset=t,this.pointsList=[],this.initPoints())}createId(){return Ul("customEdge")}getEdgeStyle(){const e=super.getEdgeStyle();return this.isSelected||this.isHovered?e.stroke="#37e1ffff":e.stroke="#2475FC",e.strokeWidth=2,e}getArrowStyle(){return{...super.getArrowStyle(),...this.arrowStyle,refX:0,refY:0}}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId),t=e==null?void 0:e.getDefaultAnchor().find(o=>o.id===this.sourceAnchorId),n=this.graphModel.getNodeModelById(this.targetNodeId),i=n==null?void 0:n.getDefaultAnchor().find(o=>o.id===this.targetAnchorId);if(t){const o={x:t==null?void 0:t.x,y:t==null?void 0:t.y};this.updateStartPoint(o)}if(i){const o={x:i==null?void 0:i.x,y:i==null?void 0:i.y};this.updateEndPoint(o)}this.pointsList=[],this.initPoints()}}const Z7={type:"custom-bezier-edge",view:K7,model:J7};function Ww(r,e){return r.map(t=>{let n=e?e.node_id:t.node_id,i=e?e.node_name:t.node_name,o=e?e.node_type:t.node_type,a=t.name||t.key,l=e?`${e.text}.${a}`:a,u=t.children||t.subs||[],d="",f="";o==1?f=`global.${l}`:e?f=`${e.original_value}.${t.key}`:f=`${n}.${t.key}`,d=`【${f}】`;let h={label:a,value:d,original_value:f,node_id:n,node_name:i,node_type:o,text:l,key:t.key,id:n,typ:t.typ,children:u||[]};return h.children&&h.children.length>0&&(h.children=Ww(h.children,h)),h})}class Pn extends Wl{constructor(e){super(e)}renderVue(e,t){this.isMounted=!1,this.r=bn(e,{properties:t.model.getProperties(),isSelected:t.model.isSelected,isHovered:t.model.isHovered}),this.app=ms({render:()=>this.r,provide:()=>({getNode:()=>t.model,getGraph:()=>t.graphModel,resetSize:()=>{if(this.r&&this.r.el){let n=this.r.el.clientHeight,i=this.r.el.clientWidth;t.model.properties={...t.model.properties,width:i,height:n},t.model.width=i,t.model.height=n,t.model._width=i,t.model._height=n,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)}},updateAnchorList:n=>{t.model.properties.anchorList=n},setData:n=>{n.dataRaw=n.node_params,xn(()=>{t.model.properties={...t.model.properties,...n};let i=null;this.r&&this.r.el&&(i=this.r.el.clientHeight),t.model.height=i||n.height||t.model.properties.height,t.model._height=i||n.height||t.model.properties.height,t.model.refreshBranch(),t.graphModel.eventCenter.emit("custom:setData",t.model)})},setTitle:n=>{t.model.properties.node_name=n,t.graphModel.eventCenter.emit("custom:setNodeName",{node_name:n,node_id:t.model.id,node_type:t.model.type})}}),mounted:()=>{}})}shouldUpdate(){const e={...this.props.model.properties,isSelected:this.props.model.isSelected,isHovered:this.props.model.isHovered};if(!(this.preProperties&&this.preProperties===JSON.stringify(e)))return this.preProperties=JSON.stringify(e),!0}getAnchorShape(e){let t=this.props.graphModel.getNodeEdges(this.props.model.id),n=t.map(w=>w.sourceAnchorId),i=t.map(w=>w.targetAnchorId),o=!1;const{x:a,y:l,type:u}=e,d=10;u==="left"?o=i.includes(e.id):o=n.includes(e.id);const f=wt("circle",{className:"custom-anchor-circle",cx:a,cy:l,r:d,fill:"#fff",stroke:"#2475FC","stroke-width":2}),h=wt("g",{className:"custom-anchor-arrow",transform:`translate(${a-d-2}, ${l-d-2})`},[wt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),wt("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z",fill:"#fff"})]),g=wt("g",{className:`custom-anchor-plus ${o?"anchor-hide":""}`,transform:`translate(${a-d-2}, ${l-d-2})`},[wt("circle",{cx:12,cy:12,r:d,fill:"#2475FC",stroke:"#2475FC","stroke-width":1}),wt("line",{x1:12,y1:6,x2:12,y2:18,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"}),wt("line",{x1:6,y1:12,x2:18,y2:12,strokeWidth:2.4,strokeLinecap:"round",strokeLinejoin:"round",stroke:"#fff"})]);return wt("g",{id:e.id,className:`custom-anchor custom-anchor-${u} ${o?"anchor-selected":"anchor-not-selected"}`,onClick:w=>{w.stopPropagation();const{graphModel:x,model:b}=this.props;u==="right"&&!o&&x.eventCenter.emit("custom:showPopupMenu",{anchorData:e,model:b})}},f,h,g)}setHtml(e){if(!this.props.model.virtual)if(this.isMounted)this.r.component.props.isSelected=this.props.model.isSelected,this.r.component.props.isHovered=this.props.model.isHovered,this.r.component.props.properties=this.props.model.getProperties();else{this.isMounted=!0;const t=document.createElement("div");t.className="root-node",t.id="node-"+this.props.model.id,e.appendChild(t),this.app.mount(t)}}}class Rn extends Fl{createId(){return Ul(this.type)}initNodeData(e){this.width=e.properties.width,this.height=e.properties.height,super.initNodeData(e)}getAnchorLineStyle(){const e=super.getAnchorLineStyle();return e.stroke="#2475FC",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getGlobalVariable(){const{nodes:e}=this.graphModel;let t=e.find(o=>o.type==="start-node");if(!t)return{sys_global:[],diy_global:[],all_global:[]};let n=JSON.parse(t.properties.node_params);return{sys_global:n.start.sys_global,diy_global:n.start.diy_global,all_global:[...n.start.sys_global,...n.start.diy_global]}}getAllParentVariable(){const e=[],t=new Set,n=this.incoming.edges,{nodes:i}=this.graphModel,o=["start-node","http-node","parameter-extraction-node","knowledge-base-node","ai-dialogue-node","specify-reply-node","problem-optimization-node","select-data-node","code-run-node","mcp-node"];let a=i.find(d=>d.type==="start-node");a&&(t.add(a.id),e.push(a));const l=d=>{for(let f=0;f<d.length;f++){let g=d[f].sourceNode;t.has(g.id)||(t.add(g.id),o.includes(g.type)&&e.push(g),l(g.incoming.edges))}};l(n);let u=[];for(const d of e){if(!o.includes(d.type))continue;let f=JSON.parse(d.properties.node_params),h={label:d.properties.node_name,value:d.id,node_id:d.id,node_type:d.properties.node_type,typ:"node",children:[]};d.type==="http-node"&&(h.children=f.curl.output),d.type==="code-run-node"&&(h.children=f.code_run.output),d.type==="parameter-extraction-node"&&(h.children=f.params_extractor.output),d.type==="start-node"&&(h.children=[...f.start.diy_global,...f.start.sys_global]),d.type==="select-data-node"&&(h.children=[{key:"output_list",typ:"Array(Object)",name:"output_list",label:"output_list"},{key:"row_num",typ:"integer",name:"row_num",label:"row_num"}]),d.type==="knowledge-base-node"&&(h.children=[{key:"special.lib_paragraph_list",typ:"string",name:"知识库引用",label:"知识库引用"}]),d.type==="ai-dialogue-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"AI回复内容",label:"AI回复内容"}]),d.type==="specify-reply-node"&&(h.children=[{key:"special.llm_reply_content",typ:"string",name:"消息内容",label:"消息内容"}]),d.type==="problem-optimization-node"&&(h.children=[{key:"special.question_optimize_reply_content",typ:"string",name:"问题优化结果",label:"问题优化结果"}]),d.type==="mcp-node"&&(h.children=[{key:"special.mcp_reply_content",typ:"string",name:"text",label:"工具生成的内容"}]),h.children.forEach(g=>{g.node_id=d.id,g.node_name=d.properties.node_name,g.node_type=d.properties.node_type}),h.children=Ww(h.children,null),u.push(h)}return u}refreshBranch(){this.incoming.edges.forEach(e=>{e.updatePathByAnchor()}),this.outgoing.edges.forEach(e=>{e.updatePathByAnchor()})}}const Q7="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8%205C8.55228%205%209%204.55228%209%204C9%203.44772%208.55228%203%208%203C7.44772%203%207%203.44772%207%204C7%204.55228%207.44772%205%208%205Z'%20fill='%23595959'/%3e%3cpath%20d='M8%209C8.55228%209%209%208.55228%209%208C9%207.44772%208.55228%207%208%207C7.44772%207%207%207.44772%207%208C7%208.55228%207.44772%209%208%209Z'%20fill='%23595959'/%3e%3cpath%20d='M8%2012.666C8.55228%2012.666%209%2012.2183%209%2011.666C9%2011.1137%208.55228%2010.666%208%2010.666C7.44772%2010.666%207%2011.1137%207%2011.666C7%2012.2183%207.44772%2012.666%208%2012.666Z'%20fill='%23595959'/%3e%3c/svg%3e",e9={name:"NodeCommon",inject:["setTitle","getNode","getGraph"],props:{iconUrl:{type:String,default:""},iconName:{type:String,default:""},node_type:{default:""},nodeKey:{type:String,default:""},value:{type:String,default:""},title:{type:String,default:""},menus:{type:Array,default(){return[]}},hideMenus:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{isShowMenu:!1,localMenus:[]}},computed:{allMenus(){return[...this.menus,...this.localMenus]}},mounted(){document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)},methods:{handleMenu(r){this.$emit("handleMenu",r)},showMenu(){this.isShowMenu=!this.isShowMenu},handleDelete(){let r=this.getNode();this.getGraph().eventCenter.emit("custom:node:delete",r)},documentClick(r){this.isShowMenu&&!this.$el.querySelector(".node-menus").contains(r.target)&&r.target!==this.$el.querySelector(".node-menu-btn")&&r.target!==this.$el.querySelector(".btn-icon")&&(this.isShowMenu=!1)},getImgUrl(){return O1(this.node_type)},updateTitle(r){this.setTitle(r)}}},t9=["data-node-name","data-node-type"],n9={class:"node-header"},r9={class:"node-header-left"},i9={key:0,class:"node-icon"},o9=["src"],a9={class:"node-title"},s9={key:0,class:"node-menu-wrapper"},l9={class:"node-menus"},u9=["onClick"],d9={class:"node-body"};function c9(r,e,t,n,i,o){return G(),ue("div",{class:gn(["node-common-wrapper",[`node-common-wrapper_${t.iconName}`]]),"data-node-name":t.title,"data-node-type":t.node_type},[E("div",{class:gn(["node-common",{isHovered:t.isHovered,isSelected:t.isSelected}])},[E("div",n9,[E("div",r9,[t.iconUrl||t.iconName?(G(),ue("span",i9,[E("img",{src:t.iconUrl||o.getImgUrl(t.iconName),alt:""},null,8,o9)])):tt("",!0),E("span",a9,Ne(t.title),1)]),E("div",null,[t.hideMenus?tt("",!0):(G(),ue("div",s9,[E("div",{class:"node-menu-btn",onClick:e[0]||(e[0]=dn((...a)=>o.showMenu&&o.showMenu(...a),["stop"]))},e[2]||(e[2]=[E("img",{class:"btn-icon",src:Q7,alt:""},null,-1)])),Mo(E("div",l9,[(G(!0),ue(st,null,mt(o.allMenus,a=>(G(),ue("div",{class:"node-menu",key:a.key,onClick:dn(l=>o.handleMenu(a),["stop"])},Ne(a.name),9,u9))),128)),E("div",{class:"node-menu del-btn",onClick:e[1]||(e[1]=dn(a=>o.handleDelete(r.item),["stop"]))},"删除")],512),[[fa,i.isShowMenu]])]))])]),E("div",d9,[Za(r.$slots,"default",{},void 0,!0)])],2)],10,t9)}const In=xt(e9,[["render",c9],["__scopeId","data-v-927b1762"]]),f9={name:"StartNode",components:{NodeCommon:In},inject:["resetSize"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{sys_global:[],diy_global:[],show:!1}},computed:{options(){return[...this.sys_global,...this.diy_global]}},watch:{properties:{handler(){this.reset()},deep:!0}},mounted(){this.reset()},methods:{reset(){if(!this.properties||!this.properties.node_params)return;let r=JSON.parse(this.properties.node_params);this.sys_global=r.start.sys_global,this.diy_global=r.start.diy_global,this.$nextTick(()=>{this.resetSize()})}}},h9={class:"start-node"},p9={class:"start-node-options"},v9={class:"options-list"},g9={class:"option-label"},m9={class:"option-type"};function y9(r,e,t,n,i,o){const a=On("node-common");return G(),Ue(a,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,"hide-menus":!0,style:{width:"420px"}},{default:q(()=>[E("div",h9,[E("div",p9,[e[0]||(e[0]=E("div",{class:"options-title"},"输入",-1)),E("div",v9,[(G(!0),ue(st,null,mt(o.options,l=>(G(),ue("div",{class:gn(["options-item",{"is-required":l.required}]),key:l.key},[E("div",g9,Ne(l.key),1),E("div",m9,Ne(l.typ),1)],2))),128))])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const _9=xt(f9,[["render",y9],["__scopeId","data-v-a8526388"]]);let b9=class extends Pn{constructor(e){super(e),this.renderVue(_9,e)}},x9=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",isHovered:a,isSelected:l,nodeId:e}]}};const w9={type:"start-node",model:x9,view:b9},Nc={__name:"model-name-text",props:{useModel:{type:[String,Number],default:""},modelConfigId:{type:[String,Number],default:""}},setup(r){const e=r,t=Yr(),{modelList:n}=ql(t),i=Se(""),o=()=>{if(!e.useModel){i.value="";return}for(const a of n.value)if(a.children){for(const l of a.children)if(e.useModel==l.name&&e.modelConfigId==l.id){i.value=l.show_model_name||l.deployment_name||l.name;return}}};return Qt(()=>[e.useModel,e.modelConfigId],()=>{o()},{immediate:!0}),(a,l)=>(G(),ue("span",null,Ne(i.value),1))}},ga={__name:"user-question-text",props:{value:{type:Array,default:()=>[]}},setup(r,{expose:e}){const t=r,n=Mt("getNode"),i=Se([]),o=Se("");function a(){let h=n().getAllParentVariable();i.value=l(h)}function l(h){return h.forEach(g=>{g.typ=="node"?g.node_type==1?g.value="global":g.value=g.node_id:g.value=g.key,g.children&&g.children.length>0&&(g.children=l(g.children))}),h}const u=(h,g)=>{for(const y of h){if(y.value===g)return y.label;if(y.children&&y.children.length>0){const w=u(y.children,g);if(w)return w}}return null},d=()=>{if(!t.value||t.value.length===0)return"";a();let h=[];t.value.forEach(g=>{const y=u(i.value,g);y&&h.push(y)}),o.value=h.join("/")},f=()=>{d()};return Qt(()=>t.value,()=>{d()},{immediate:!0}),e({refresh:f}),(h,g)=>(G(),ue("span",null,Ne(o.value),1))}},S9={class:"ai-dialogue-node"},E9={class:"field-list"},C9={class:"field-item"},k9={class:"field-item-content"},O9={class:"field-value"},N9={class:"field-key"},M9={class:"field-item"},A9={class:"field-item-content"},T9={class:"field-value"},D9={class:"field-key"},L9={class:"field-item"},P9={class:"field-item-content"},R9={class:"category-list"},I9={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("resetSize"),i=Yr(),{modelList:o}=ql(i),a=Se([]),l=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",question_value:[],enable_thinking:!1,categorys:[{category:"",next_node_key:"",key:Math.random()*1e4}]});function u(h){if(h&&typeof h=="string"){let g=h.split("."),y=g[0],w=g.filter((x,b)=>b>0).join(".");return[y,w]}else if(h&&typeof h=="object"&&h.length===2)return h;return["global","question"]}const d=()=>{const h=e.properties.dataRaw||e.properties.node_params||"{}";let g={};try{g=JSON.parse(h).cate||{}}catch{g={}}g=JSON.parse(JSON.stringify(g));for(let y in g)if(y==="question_value")l.question_value=u(g.question_value);else if(y=="categorys")if(g.categorys&&g.categorys.length>0){let w=g.categorys.map(x=>({...x,key:Math.random()*1e4}));l[y]=w}else l[y]=[{category:"",next_node_key:"",key:Math.random()*1e4}];else l[y]=g[y];!l.model_config_id&&o.value.length>0&&(l.model_config_id=o.value[0].id,l.use_model=o.value[0].children[0].name),xn(()=>{n()})},f=()=>{const h=JSON.stringify({cate:{...l,model_config_id:l.model_config_id?+l.model_config_id:l.model_config_id}});t({...e.node,...l,node_params:h})};return Qt(()=>e.properties,d,{deep:!0}),Kt(()=>{d(),n(),f()}),Mi(()=>{}),(h,g)=>(G(),Ue(In,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",S9,[E("div",E9,[E("div",C9,[g[0]||(g[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",k9,[E("div",O9,[E("span",N9,[H(ga,{ref:"questionTextRef",value:l.question_value},null,8,["value"])])])])]),E("div",M9,[g[1]||(g[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",A9,[E("div",T9,[E("span",D9,[H(Nc,{useModel:l.use_model,modelConfigId:l.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",L9,[g[3]||(g[3]=E("div",{class:"field-item-label"},"问题分类",-1)),E("div",P9,[E("div",R9,[(G(!0),ue(st,null,mt(l.categorys,y=>(G(),ue("div",{class:"field-value category-value",key:y.key},[E("span",null,Ne(y.category),1)]))),128)),g[2]||(g[2]=E("div",{class:"field-value category-value"},[E("span",null,"默认分类")],-1))])])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},B9=xt(I9,[["__scopeId","data-v-d3bd1d72"]]);let j9=class extends Pn{constructor(e){super(e),this.renderVue(B9,e)}},H9=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getAnchorPos(){return qN(this.properties)}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;let d=[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}],f=this.getAnchorPos(),h=n-o/2;for(let g=0;g<f.length;g++)d.push({id:f[g].id,x:t+i/2,y:h+132+g*32,type:"right"});return d.push({id:u+"-anchor_right",x:t+i/2,y:o/2+n-28,type:"right",nodeId:e}),d}};const $9={type:"question-node",model:H9,view:j9},F9={name:"QuestionNode",components:{NodeCommon:In},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}},z9={class:"question-node"},W9={class:"node-desc"};function U9(r,e,t,n,i,o){const a=On("node-common");return G(),Ue(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:q(()=>[E("div",z9,[E("div",W9,Ne(t.properties.content||"点击设置消息内容"),1)])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const V9=xt(F9,[["render",U9],["__scopeId","data-v-a573d26e"]]);let q9=class extends Pn{constructor(e){super(e),this.renderVue(V9,e)}},X9=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;let d=[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}];return this.properties.node_type!=5&&d.push({x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}),d}};const G9={type:"action-node",model:X9,view:q9},Y9={name:"QuestionNode",components:{NodeCommon:In},inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},methods:{handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}},secondsToMinutes(r){return eC(r)}}},K9={class:"qa-node"},J9={key:0,class:"no-data"};function Z9(r,e,t,n,i,o){const a=On("node-common");return G(),Ue(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,onHandleMenu:o.handleMenu},{default:q(()=>[E("div",K9,[t.properties.no_resp_jump_time?tt("",!0):(G(),ue("div",J9,"点击设置消息内容"))])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","onHandleMenu"])}const Q9=xt(Y9,[["render",Z9],["__scopeId","data-v-7f55a54e"]]);let ez=class extends Pn{constructor(e){super(e),this.renderVue(Q9,e)}},tz=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const nz={type:"qa-node",model:tz,view:ez},rz={class:"ai-dialogue-node"},iz={class:"field-list"},oz={class:"field-item"},az={class:"field-item-content"},sz={class:"field-value"},lz={class:"field-item"},uz={class:"field-item-content"},dz={class:"field-value"},cz={class:"field-key"},fz={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Yr(),{modelList:l}=ql(a),u=Se(null),d=Se([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,libs_node_key:void 0}),h=Se([]);function g(_){if(_){let S=_.split("."),k=S[0],O=S.filter((M,R)=>R>0).join(".");return[k,O]}return["global","question"]}const y=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let S={};try{S=JSON.parse(_).llm||{}}catch{S={}}x();const{model_config_id:k,use_model:O,context_pair:M,temperature:R,max_token:T,prompt:I,prompt_tags:$,question_value:ne,enable_thinking:V,libs_node_key:J}=JSON.parse(JSON.stringify(S));f.model_config_id=k,f.use_model=O,f.context_pair=M||0,f.temperature=R,f.max_token=T,f.prompt=I,f.enable_thinking=V,f.prompt_tags=$||[],f.libs_node_key=J,f.question_value=g(ne),!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),xn(()=>{o()})},w=()=>{const _=JSON.stringify({llm:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:_})},x=()=>{let _=i().getAllParentVariable();h.value=_},b=_=>{x(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(S=>{if(S.node_id==_.node_id){let k=S.label.split("/");k[0]=_.node_name,S.label=k.join("/"),S.node_name=_.node_name}}),w(),u.value.refresh()};return Qt(()=>e.properties,y,{deep:!0}),Kt(()=>{y(),o(),n().eventCenter.on("custom:setNodeName",b)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",b)}),(_,S)=>(G(),Ue(In,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",rz,[E("div",iz,[E("div",oz,[S[0]||(S[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",az,[E("div",sz,[H(ga,{ref_key:"questionTextRef",ref:u,value:f.question_value},null,8,["value"])])])]),E("div",lz,[S[1]||(S[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",uz,[E("div",dz,[E("span",cz,[H(Nc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),S[2]||(S[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"AI回复内容"),E("span",{class:"field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},hz=xt(fz,[["__scopeId","data-v-84fe052f"]]);let pz=class extends Pn{constructor(e){super(e),this.renderVue(hz,e)}},vz=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const gz={type:"ai-dialogue-node",model:vz,view:pz},Uw=r=>{let e=[];return r.forEach(t=>{t.children&&t.children.length>0?e.push(...Uw(t.children)):e.push(t)}),e},mz={name:"JMention",inject:[],emits:["input","change","update:selectedList","focus","open"],props:{type:{type:String,default:"input",validator(r){return["input","textarea"].includes(r)}},placeholder:{type:String,default:"请输入"},defaultValue:{type:String,default:""},options:{type:Array,default:()=>[]},defaultSelectedList:{type:Array,default:()=>[]},canRepeat:{type:Boolean,default:!0},isContain:{type:Boolean,default:!1},inputStyle:{type:String,default:""}},data(){return{timer:null,showDropdown:!1,showAtList:!1,positionStyle:"",chooseIndex:0,selectedList:[],selectedIdSet:new Set,showOptions:[],atText:"",localValue:""}},watch:{defaultValue(r){r!=this.localValue&&this.refresh()},chooseIndex(){},showAtList(r){this.onOpen(r)},options(){this.initShowOptionList()}},mounted(){this.initShowOptionList(),this.initData()},beforeUnmount(){},methods:{getText(r){const e=document.createElement("div");e.innerHTML=r;let t="";return Array.from(e.childNodes).forEach(n=>{let i="";this.type==="textarea"?n.nodeName==="BR"?i=`
`:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:i=n.textContent:n.classList&&n.classList.contains("j-mention-at")?i=n.dataset.value:n.nodeName==="BR"?i="":i=n.textContent.replace(/\n/g,""),(i==="&nbsp;"||i===" ")&&(i=""),t+=i}),t},onChange(){let e=this.$refs.JMention.innerHTML,t=this.getText(e);this.localValue=t;let n={};this.selectedList.forEach(o=>{!n[o.value]&&t.indexOf(o.value)!==-1&&(n[o.value]=o)});let i=Object.values(n);this.$emit("change",t,i)},refresh(){this.selectedList=[],this.selectedIdSet=new Set,this.initShowOptionList(),this.initData()},initData(){const r=this.$refs.JMention;let e=this.defaultValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=this.defaultSelectedList||[],n=Uw(this.options),i=[...t,...n].filter(a=>a&&a.value&&a.value!=""&&a.typ!=="node");const o=new Set;i.forEach(a=>{const l=new RegExp(`(${a.value})`,"g");if(l.test(this.defaultValue)&&!o.has(a.value)){let u=a.node_name+"."+a.text;u=u.replace(/\./g,"/"),e=e.replace(l,`<span class="j-mention-at" data-id="${a.node_id}" contentEditable="false" data-value="${a.value}">${u}</span> `),o.add(a.value),this.selectOption(a,!0)}}),r.innerHTML=e,this.localValue=this.defaultValue},initShowOptionList(){this.showOptions=this.options.filter(r=>this.atText?r.label.startsWith(this.atText):this.canRepeat?!0:!this.selectedIdSet.has(r.id+""))},dropDownKeydown(r){const{keyCode:e}=r;if(!this.showDropdown){if(e===13&&this.type==="input"){r.preventDefault(),r.stopPropagation();return}return}if(![13,38,40].includes(e)||(r.preventDefault(),r.stopPropagation(),e===13))return;const n={38:-1,40:1};this.chooseIndex+=n[e]||0,this.chooseIndex=Math.max(0,Math.min(this.chooseIndex,this.showOptions.length-1))},getLastChar(r=1){const e=window.getSelection();if(e.rangeCount<=0)return;const t=e.getRangeAt(0),n=t.startOffset,i=t.startContainer;let o="";if(i.nodeType===Node.TEXT_NODE)o=i.textContent.slice(0,n);else if(i.nodeType===Node.ELEMENT_NODE){const a=i.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?o+=u.textContent.slice(0,n):o+=u.textContent)}}return o.slice(-r)},getLastAtText(){const r=window.getSelection();if(r.rangeCount<=0)return;const e=r.getRangeAt(0),t=e.startOffset,n=e.startContainer;let i="";if(n.nodeType===Node.TEXT_NODE)i=n.textContent.slice(0,t);else if(n.nodeType===Node.ELEMENT_NODE){const a=n.childNodes;for(let l=0;l<a.length;l++){const u=a[l];u.nodeType===Node.TEXT_NODE&&(l===a.length-1?i+=u.textContent.slice(0,t):i+=u.textContent)}}const o=i.lastIndexOf("/");return o===-1?"":i.slice(o+1)},async getCaretPosition(){const r=window.getSelection();if(r.rangeCount<=0)return{top:0,left:0};const t=r.getRangeAt(0).getBoundingClientRect(),n=await this.getDropdownListSize();let i=t.bottom,o=t.left;const a=window.innerWidth,l=window.innerHeight;return o+n.width>a&&(o=a-n.width),i+n.height>l&&(i=t.top-n.height),{top:i,left:o,x:o,y:i}},async getDropdownListSize(){this.showDropdown=!0,await this.$nextTick();const r=this.$refs.dropdownList.offsetWidth,e=this.$refs.dropdownList.offsetHeight;return this.showDropdown=!1,{width:r,height:e}},updateSelectedList(){const e=this.$refs.JMention.querySelectorAll(".j-mention-at");this.selectedList=[],this.selectedIdSet=new Set;for(const t of e){let n=t.dataset.value;const i=this.options.find(o=>o.value==n);this.selectedList.push(i),this.selectedIdSet.add(n)}this.$emit("update:selectedList",this.selectedList),!(e.length===this.selectedList.length&&!this.atText&&!this.showDropdown)&&this.initShowOptionList()},checkStartWith(r){return this.options.filter(t=>t.label.startsWith(r)).length>0},updateValue(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this.onChange()},100)},clickJMention(){this.showDropdown=!1,this.showAtList=!1},async divInput(r){this.updateValue();const e=this.getLastChar();if(r.inputType==="deleteContentBackward"&&!this.atText&&(this.showDropdown=!1,this.showAtList=!1),e==="/")this.showDropdown=!0,this.atText="";else{const i=this.getLastAtText();this.atText=i;const o=this.checkStartWith(i);i&&(this.showDropdown=o)}if(!this.showDropdown)return;const{x:t,y:n}=await this.getCaretPosition();this.showDropdown=!0,this.positionStyle="",this.positionStyle+=`left:${t}px;`,this.positionStyle+=`top:${n}px;`,this.chooseIndex=0,this.showAtList=!0},insertAtCaret(r,e){let t=this.atText.length+1;this.getLastChar(t)!=="/"+this.atText&&(t=0);const i=window.getSelection();if(i.rangeCount<=0)return;const o=i.getRangeAt(0),a=o.startOffset,l=o.startContainer;let u=a-t,d=l;if(u<0){let f=l.previousSibling;for(;f;){if(f.nodeType===Node.TEXT_NODE){u=f.textContent.length-t,d=f;break}f=f.previousSibling}}if(d.nodeType===Node.TEXT_NODE){d.replaceData(u,t," ");const f=document.createElement("span");f.contentEditable="false",f.classList.add("j-mention-at"),f.style=this.atTextStyle,f.textContent=`${r}`;const h=document.createElement("span");h.contentEditable=!0,h.innerHTML+="&nbsp;",h.classList.add("at-space");for(const w in e)f.dataset[w]=e[w];const g=document.createRange();g.setStart(d,u),g.insertNode(f);let y=f.nextSibling;y||(y=document.createTextNode(""),h.parentNode.appendChild(y)),o.setStart(y,1),o.setEnd(y,1),i.removeAllRanges(),i.addRange(o)}},onSelectOption(r,e,t){let n=t[t.length-1];delete n.children,this.selectOption(n)},selectOption(r,e=!1){if(!r)return;this.showDropdown=!1,this.showAtList=!1;let t=r.node_name+"."+r.text;t=t.replace(/\./g,"/");const n={id:r.id,label:r.label,value:r.value,text:r.text,index:this.selectedList.length};this.selectedList.push(r),this.selectedIdSet.add(r.value),e||(this.insertAtCaret(t,n),this.initShowOptionList(),this.updateValue())}}};function yz(r,e,t,n,i,o){return G(),ue("span",{ref:"JMention",class:gn(["j-mention",["type-"+t.type]])},null,2)}const Gr=xt(mz,[["render",yz]]),_z={class:"ai-dialogue-node"},bz={class:"field-list"},xz={class:"field-item"},wz={class:"field-item-content"},Sz={class:"field-value"},Ez={class:"field-key"},Cz={class:"field-type"},kz={class:"field-item"},Oz={class:"field-item-content"},Nz={class:"field-text"},Mz={class:"right-arrow"},Az={class:"field-text2"},Tz={class:"field-item"},Dz={class:"field-item-content"},Lz={class:"field-text"},Pz={class:"right-arrow"},Rz={class:"field-text2"},Iz={key:0,class:"field-item"},Bz={class:"field-item-content"},jz={class:"field-text"},Hz={class:"right-arrow"},$z={class:"field-text2"},Fz={key:1,class:"field-item"},zz={class:"field-item-content"},Wz={class:"field-list-item"},Uz={class:"field-item"},Vz={class:"field-item-content"},qz={class:"field-key"},Xz={class:"field-type"},Gz={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Se([]),l=Jt({method:"POST",rawurl:"",headers:[{key:"",value:""}],params:[{key:"",value:""}],type:1,body:[],body_raw:"",body_raw_tags:[],timeout:30,output:[{key:"",typ:"",subs:[]}]});function u(x){return x.forEach(b=>{b.cu_key=Math.random()*1e4,b.subs&&b.subs.length?u(b.subs):b.subs=[]}),x}const d=Se([]),f=()=>{const x=e.properties.dataRaw||e.properties.node_params||"{}";let b={};try{b=JSON.parse(x).curl||{}}catch{b={}}g(),b=JSON.parse(JSON.stringify(b));for(let _ in b){if(_=="headers"||_=="params"||_=="body"){b[_]&&b[_].length>0?l[_]=b[_].map(S=>({...S,cu_key:Math.random()*1e4})):l[_]=[];continue}if(_=="output"){l.output=u(b[_]);continue}l[_]=b[_]}xn(()=>{o()})},h=()=>{const x=JSON.stringify({curl:{...l}});t({...e.node,...l,node_params:x})},g=()=>{let x=i().getAllParentVariable();x.forEach(b=>{b.tags=b.tags||[]}),d.value=x},y=x=>{ws.includes(x.node_type)&&(g(),xn(()=>{l.body_raw_tags&&l.body_raw_tags.length>0&&l.body_raw_tags.forEach(_=>{if(_.node_id==x.node_id){let S=_.label.split("/");S[0]=x.node_name,_.label=S.join("/"),_.node_name=x.node_name}}),["headers","params","body"].forEach(_=>{l[_].forEach(k=>{k.tags&&k.tags.length>0&&k.tags.forEach(O=>{if(O.node_id==x.node_id){let M=O.label.split("/");M[0]=x.node_name,O.label=M.join("/"),O.node_name=x.node_name}})})}),h()}))},w=()=>{};return Qt(()=>e.properties,f,{deep:!0}),Kt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",y)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",y)}),(x,b)=>(G(),Ue(In,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,onClick:w},{default:q(()=>[E("div",_z,[E("div",bz,[E("div",xz,[b[0]||(b[0]=E("div",{class:"field-item-label"},"请求地址",-1)),E("div",wz,[E("div",Sz,[E("span",Ez,Ne(l.method),1),E("span",Cz,Ne(l.rawurl),1)])])]),E("div",kz,[b[1]||(b[1]=E("div",{class:"field-item-label"},"HEADERS",-1)),E("div",Oz,[(G(!0),ue(st,null,mt(l.headers,_=>(G(),ue("div",{class:"field-list-item",key:_.cu_key},[E("div",Nz,Ne(_.key),1),E("div",Mz,[H(ze(fl))]),E("div",Az,[H(Gr,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),E("div",Tz,[b[2]||(b[2]=E("div",{class:"field-item-label"},"PARAMS",-1)),E("div",Dz,[(G(!0),ue(st,null,mt(l.params,_=>(G(),ue("div",{class:"field-list-item",key:_.cu_key},[E("div",Lz,Ne(_.key),1),E("div",Pz,[H(ze(fl))]),E("div",Rz,[H(Gr,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])]),l.type==1?(G(),ue("div",Iz,[b[3]||(b[3]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",Bz,[(G(!0),ue(st,null,mt(l.body,_=>(G(),ue("div",{class:"field-list-item",key:_.cu_key},[E("div",jz,Ne(_.key),1),E("div",Hz,[H(ze(fl))]),E("div",$z,[H(Gr,{options:d.value,"default-value":_.value,defaultSelectedList:_.tags},null,8,["options","default-value","defaultSelectedList"])])]))),128))])])):tt("",!0),l.type==2?(G(),ue("div",Fz,[b[4]||(b[4]=E("div",{class:"field-item-label"},"BODY",-1)),E("div",zz,[E("div",Wz,Ne(l.body_raw),1)])])):tt("",!0),E("div",Uz,[b[5]||(b[5]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",Vz,[(G(!0),ue(st,null,mt(l.output,_=>(G(),ue("div",{class:"field-value",key:_.cu_key},[E("span",qz,Ne(_.key),1),E("span",Xz,Ne(_.typ),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Yz=xt(Gz,[["__scopeId","data-v-2ec194e8"]]);let Kz=class extends Pn{constructor(e){super(e),this.renderVue(Yz,e)}},Jz=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+26,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+26,id:u+"-anchor_right",type:"right",nodeId:e}]}};const Zz={type:"http-node",model:Jz,view:Kz},Qz={class:"ai-dialogue-node"},eW={class:"field-list"},tW={class:"field-item"},nW={class:"field-item-content"},rW={class:"field-value"},iW={class:"field-item"},oW={class:"field-item-content"},aW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Se(null),l=Se([]),u=Jt({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,top_k:5,similarity:.5,search_type:1,question_value:[]}),d=Se([]);function f(S){if(S){let k=S.split("."),O=k[0],M=k.filter((R,T)=>T>0).join(".");return[O,M]}return["global","question"]}const h=()=>{const S=e.properties.dataRaw||e.properties.node_params||"{}";let k={};try{k=JSON.parse(S).libs||{}}catch{k={}}b(),k=JSON.parse(JSON.stringify(k));for(let O in k)O=="library_ids"?u[O]=k[O]?k[O].split(","):[]:O=="question_value"?u.question_value=f(k.question_value):u[O]=k[O];xn(()=>{o()})},g=()=>{const S=JSON.stringify({libs:{...u,rerank_model_config_id:u.rerank_model_config_id?+u.rerank_model_config_id:void 0,question_value:u.question_value.join("."),library_ids:u.library_ids.join(",")}});t({...e.node,...u,node_params:S})},y=Se([]),w=tn(()=>y.value.filter(S=>u.library_ids.includes(S.id))),x=async()=>{const S=await xv({type:""});S&&(y.value=S.data||[],xn(()=>{o()}))},b=()=>{let S=i().getAllParentVariable();d.value=S},_=()=>{b(),g(),a.value.refresh()};return Qt(()=>e.properties,h,{deep:!0}),Kt(()=>{x(),h(),n().eventCenter.on("custom:setNodeName",_)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",_)}),(S,k)=>(G(),Ue(In,{title:e.properties.node_name,menus:l.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",Qz,[E("div",eW,[E("div",tW,[k[0]||(k[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",nW,[E("div",rW,[H(ga,{ref_key:"questionTextRef",ref:a,value:u.question_value},null,8,["value"])])])]),k[2]||(k[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"输出字段"),E("div",{class:"field-item-content"},[E("div",{class:"field-value is-required"},[E("span",{class:"field-key"},"知识库引用"),E("span",{class:"field-type"},"string")])])],-1)),E("div",iW,[k[1]||(k[1]=E("div",{class:"field-item-label"},"知识库",-1)),E("div",oW,[(G(!0),ue(st,null,mt(w.value,O=>(G(),ue("div",{class:"library-item",key:O.id},Ne(O.library_name),1))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},sW=xt(aW,[["__scopeId","data-v-2328071d"]]);let lW=class extends Pn{constructor(e){super(e),this.renderVue(sW,e)}},uW=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const dW={type:"knowledge-base-node",model:uW,view:lW},cW={name:"EndNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:In},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[]}},mounted(){this.$nextTick(()=>{this.resetSize()})},computed:{},methods:{handleMenu(){}}};function fW(r,e,t,n,i,o){const a=On("node-common");return G(),Ue(a,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu,style:{width:"420px",height:"94px"}},{default:q(()=>e[0]||(e[0]=[E("div",{class:"end-node"},[E("div",{class:"node-desc"},"触发该节点结束调用,并返回流程执行结果")],-1)])),_:1,__:[0]},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const hW=xt(cW,[["render",fW],["__scopeId","data-v-120df52f"]]);let pW=class extends Pn{constructor(e){super(e),this.renderVue(hW,e)}},vW=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e}]}};const gW={type:"end-node",model:vW,view:pW},mW={name:"EndNode",inject:["getNode","getGraph","setData"],components:{NodeCommon:In},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{observer:null,menus:[],formState:{content:"",height:88}}},computed:{},mounted(){var t;let r=JSON.parse(this.properties.node_params);this.formState={...this.formState,...r};const e=(t=this.$refs.textareaRef)==null?void 0:t.querySelector("textarea");e&&(this.observer=new ResizeObserver(n=>{for(const i of n){const{height:o}=i.contentRect;this.formState.height=o+8,this.updateContent()}}),this.observer.observe(e))},beforeUnmount(){this.observer&&this.observer.disconnect()},methods:{getHeight(){return 68+this.formState.height},updateContent(){this.setData({node_params:JSON.stringify(this.formState),height:this.getHeight()})},handleMenu(r){if(r.key==="delete"){let e=this.getNode();this.getGraph().deleteNode(e.id)}}}};function yW(r,e,t,n,i,o){const a=dc,l=On("node-common");return G(),Ue(l,{title:t.properties.node_name,menus:i.menus,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type,onHandleMenu:o.handleMenu},{default:q(()=>[E("div",{class:"explain-node",onMousedown:e[3]||(e[3]=dn(()=>{},["stop"])),ref:"textareaRef"},[H(a,{style:Oi({height:`${i.formState.height}px`}),onWheel:e[0]||(e[0]=dn(()=>{},["stop"])),bordered:!1,class:"explain-textarea",value:i.formState.content,"onUpdate:value":e[1]||(e[1]=u=>i.formState.content=u),placeholder:"请输入注释",onInput:e[2]||(e[2]=u=>o.updateContent(u.target.value))},null,8,["style","value"])],544)]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type","onHandleMenu"])}const _W=xt(mW,[["render",yW],["__scopeId","data-v-ae80eb55"]]);let bW=class extends Pn{constructor(e){super(e),this.renderVue(_W,e)}},xW=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[]}};const wW={type:"explain-node",model:xW,view:bW},SW={class:"ai-dialogue-node"},EW={class:"field-list"},CW={class:"field-item"},kW={class:"field-item-content"},OW={class:"field-text"},NW={class:"right-arrow"},MW={class:"field-text"},AW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Se([]),l=Jt({list:[]}),u=Se([]),d=Se([]),f=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let _=[];try{_=JSON.parse(b).assign||[]}catch(S){}w(),y(),_.forEach(S=>{S.tags=S.tags||[]}),l.list=_,xn(()=>{o()})},h=()=>{let b=JSON.parse(e.properties.node_params);b.assign=[...l.list],t({...e.node,node_params:JSON.stringify(b)})};function g(b){return b?b.split(".")[1]:""}const y=()=>{let _=i().getGlobalVariable().diy_global||[];_.forEach(S=>{S.label=S.key,S.value="global."+S.key}),u.value=_||[]},w=()=>{let b=i().getAllParentVariable();b.forEach(_=>{_.tags=_.tags||[]}),d.value=b},x=b=>{ws.includes(b.node_type)&&(w(),xn(()=>{l.list.forEach(_=>{_.tags&&_.tags.length>0&&_.tags.forEach(S=>{if(S.node_id==b.node_id){let k=S.label.split("/");k[0]=b.node_name,S.label=k.join("/"),S.node_name=b.node_name}})}),h()}))};return Qt(()=>e.properties,f,{deep:!0}),Kt(()=>{f(),o(),n().eventCenter.on("custom:setNodeName",x)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",x)}),(b,_)=>(G(),Ue(In,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",SW,[E("div",EW,[E("div",CW,[_[0]||(_[0]=E("div",{class:"field-item-label"},"变量",-1)),E("div",kW,[(G(!0),ue(st,null,mt(l.list,(S,k)=>(G(),ue("div",{class:"field-list-item",key:k},[E("div",OW,[H(Gr,{options:d.value,"default-value":S.value,defaultSelectedList:S.tags},null,8,["options","default-value","defaultSelectedList"])]),E("div",NW,[H(ze(fl))]),E("div",MW,Ne(g(S.variable)),1)]))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},TW=xt(AW,[["__scopeId","data-v-7189ac92"]]);let DW=class extends Pn{constructor(e){super(e),this.renderVue(TW,e)}},LW=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const PW={type:"variable-assignment-node",model:LW,view:DW},RW={class:"judge-node"},IW={class:"if-box-label"},BW={class:"if-box-content"},jW={class:"condition-box"},HW={key:0,class:"condition-left-box"},$W={class:"connection-text"},FW={key:1,class:"condition-line"},zW={class:"condition-body"},WW={class:"field-items"},UW={class:"field-name"},VW={class:"field-rule"},qW={class:"field-value"},XW={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("resetSize"),n=Mt("getNode"),i=Mt("updateAnchorList");let o=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];const a=Jt({term:[]}),l=Se([]),u=Se([]);function d(){let S=n().getAllParentVariable();l.value=f(S)}function f(S){return S.forEach(k=>{k.typ=="node"?k.node_type==1?k.value="global":k.value=k.node_id:k.value=k.key,k.children&&k.children.length>0&&(k.children=f(k.children))}),S}let h=[{label:"等于",value:1},{label:"不等于",value:2},{label:"包含",value:3},{label:"不包含",value:4},{label:"为空",value:5},{label:"不为空",value:6}],g=[{label:"包含其中一项",value:3},{label:"不包含其中一项",value:4},{label:"为空",value:5},{label:"不为空",value:6}];function y(S){let k="";if(S.variable&&S.variable.length>0){let O=l.value.filter(M=>M.key==S.variable[0]);O&&O.length&&(k=O[0].typ),k=="object"&&(O[0]&&O[0].children&&(O=O[0].subs.filter(M=>M.key==S.variable[1])),O&&O.length&&(k=O[0].typ),k=="object"&&(O[0]&&O[0].children&&(O=O[0].subs.filter(M=>M.key==S.variable[2])),O&&O.length&&(k=O[0].typ)))}return k}function w(S){if(!S.variable)return[];let k=y(S);return k==""?S.is_mult?g:h:k=="boole"?[{label:"等于",value:1},{label:"不等于",value:2}]:k.includes("array")?g:h}const x=S=>{let k=w(S),O=k.findIndex(M=>M.value==S.type);return k[O].label},b=()=>{try{let S=JSON.parse(e.properties.node_params).term||[];S=S.map(k=>{let O=k.terms.map(M=>{let R="";for(let T=0;T<o.length;T++)if(M.variable.indexOf(o[T])>-1){R=o[T];break}if(R!=""){let T=M.variable.split(".");M.variable=[T[0],R]}else M.variable=M.variable.split(".");return{...M,type:M.type>0?M.type:1,key:Math.random()*1e4}});return{...k,is_or:k.is_or?1:0,terms:O,key:Math.random()*1e4}}),a.term=S,xn(()=>{t(),_()})}catch(S){}},_=()=>{const S=e.properties.nodeSortKey;let k=[],O=56;for(let M=0;M<a.term.length;M++){let R=a.term[M];if(R){let T=0,I=O,$=8,ne=2,V=24,J=R.terms.length;T=J*V+$*2+ne*(J-1),M>0&&M<a.term.length&&(I+=8),O=I+T,k.push({id:S+"-anchor_"+M,offsetHeight:T,offsetTop:I})}}k.length>0&&k.push({id:S+"-anchor_right",offsetHeight:24,offsetTop:O+8}),i(k)};return Qt(()=>e.properties.node_params,(S,k)=>{S!=k&&b()},{deep:!0}),Kt(()=>{d(),b()}),(S,k)=>(G(),Ue(In,{title:r.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",RW,[(G(!0),ue(st,null,mt(a.term,(O,M)=>(G(),ue("div",{class:"if-box",ref_for:!0,ref:R=>u.value[M]=R,key:M},[E("div",IW,Ne(M==0?"if":"else if"),1),E("div",BW,[E("div",jW,[O.terms.length>1?(G(),ue("div",HW,[E("span",$W,Ne(O.is_or==1?"or":"and"),1)])):tt("",!0),O.terms.length>1?(G(),ue("div",FW)):tt("",!0),E("div",zW,[E("div",WW,[(G(!0),ue(st,null,mt(O.terms,(R,T)=>(G(),ue("div",{class:"field-item",key:T},[E("span",UW,[H(ga,{value:R.variable},null,8,["value"])]),E("span",VW,Ne(x(R)),1),E("span",qW,Ne(R.value),1)]))),128))])])])])]))),128)),k[0]||(k[0]=E("div",{class:"else-box"},[E("div",{class:"else-box-label"},"else"),E("div",{class:"else-box-content"},[E("div",{class:"else-desc"},"不符合上述所有分支的条件时，走默认分支")])],-1))])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},GW=xt(XW,[["__scopeId","data-v-ec454a26"]]);let YW=class extends Pn{constructor(e){super(e),this.renderVue(GW,e)}},KW=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const a=n.graphModel.edges.map(u=>u.sourceAnchorId),l=o.id;return o.type==="right"&&!a.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:a,anchorList:l}=this.properties;let u=[{x:t-i/2,y:n-o/2+24,id:a+"-anchor_left",type:"left",nodeId:e}];if(l)for(let d=0;d<l.length;d++){let{offsetTop:f,offsetHeight:h}=l[d],g=n-o/2;u.push({id:l[d].id,x:t+i/2,y:g+f+h/2,type:"right"})}return u}};const JW={type:"judge-node",model:KW,view:YW},ZW={name:"SpecifyReplyNode",inject:["getNode","getGraph","setData","resetSize"],components:{NodeCommon:In,AtText:Gr},props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[],valueOptions:[],formState:{content:"",content_tags:[]}}},computed:{},watch:{properties:{handler(r,e){r.dataRaw!==e.dataRaw&&this.init()},deep:!0}},mounted(){this.getGraph().eventCenter.on("custom:setNodeName",this.onUpatateNodeName),this.init()},onBeforeUnmount(){this.getGraph().eventCenter.off("custom:setNodeName",this.onUpatateNodeName)},methods:{init(){this.getValueOptions();let r=this.properties.dataRaw||this.properties.node_params||"{}";const t=JSON.parse(r).reply||{content:"",content_tags:[]};this.formState.content=t.content,this.formState.content_tags=t.content_tags||[],this.$nextTick(()=>{this.resetSize()})},onUpatateNodeName(r){ws.includes(r.node_type)&&(this.getValueOptions(),this.$nextTick(()=>{this.formState.content_tags&&this.formState.content_tags.length>0&&this.formState.content_tags.forEach(e=>{if(e.node_id==r.node_id){let t=e.label.split("/");t[0]=r.node_name,e.label=t.join("/"),e.node_name=r.node_name}}),this.$refs.atInputRef.refresh(),this.update()}))},getValueOptions(){let r=this.getNode().getAllParentVariable();this.valueOptions=r||[]},update(){let r=JSON.parse(this.properties.node_params);r.reply={...this.formState},this.setData({node_params:JSON.stringify(r)})},showAtList(r){r&&this.getValueOptions()},changeValue(r,e){this.formState.content_tags=e,this.formState.content=r,this.update()}}},QW={class:"specify-reply-node"},eU={class:"static-field-list"},tU={class:"static-field-item"},nU={class:"static-field-item-content"},rU={class:"static-field-value"},iU={key:1};function oU(r,e,t,n,i,o){const a=On("at-text"),l=On("node-common");return G(),Ue(l,{title:t.properties.node_name,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key,node_type:t.properties.node_type},{default:q(()=>[E("div",QW,[E("div",eU,[E("div",tU,[e[0]||(e[0]=E("div",{class:"static-field-item-label"},"消息内容",-1)),E("div",nU,[E("div",rU,[i.formState.content.length>0?(G(),Ue(a,{key:0,options:i.valueOptions,defaultSelectedList:i.formState.content_tags,defaultValue:i.formState.content,ref:"atInputRef"},null,8,["options","defaultSelectedList","defaultValue"])):(G(),ue("span",iU,"--"))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"])}const aU=xt(ZW,[["render",oU],["__scopeId","data-v-39d8d3b6"]]);let sU=class extends Pn{constructor(e){super(e),this.renderVue(aU,e)}},lU=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o)=>{if(n.id==i.id)return!1;const a=n.graphModel.edges.map(u=>u.sourceAnchorId),l=o.id;return o.type==="right"&&!a.includes(l)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o}=this,{nodeSortKey:a}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:a+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:a+"-anchor_right",type:"right",nodeId:e}]}};const uU={type:"specify-reply-node",model:lU,view:sU},dU={class:"ai-dialogue-node"},cU={class:"field-list"},fU={class:"field-item"},hU={class:"field-item-content"},pU={class:"field-value"},vU={class:"field-item"},gU={class:"field-item-content"},mU={class:"field-value"},yU={class:"field-key"},_U={class:"field-item"},bU={class:"field-item-content"},xU={class:"field-key"},wU={class:"field-type"},SU={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Yr(),{modelList:l}=ql(a),u=Se(null),d=Se([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1,output:[]}),h=Se([]),g=Se([]);function y(M){if(M){let R=M.split("."),T=R[0],I=R.filter(($,ne)=>ne>0).join(".");return[T,I]}return["global","question"]}function w(M){return M.forEach(R=>{R.cu_key=Math.random()*1e4,R.subs&&R.subs.length?w(R.subs):R.subs=[]}),M}const x=()=>{const M=e.properties.dataRaw||e.properties.node_params||"{}";let R={};try{R=JSON.parse(M).params_extractor||{}}catch{R={}}R=JSON.parse(JSON.stringify(R)),_(),S();for(let T in R){if(T=="output"){f.output=w(R[T]);continue}if(T=="question_value"){f.question_value=y(R[T]);continue}f[T]=R[T]}!f.model_config_id&&l.value.length>0&&(f.model_config_id=l.value[0].id,f.use_model=l.value[0].children[0].name),xn(()=>{o()})},b=()=>{const M=JSON.stringify({params_extractor:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}});t({...e.node,...f,node_params:M})},_=()=>{let M=i().getAllParentVariable();M.forEach(R=>{R.tags=R.tags||[]}),h.value=M};function S(){let M=i().getAllParentVariable();g.value=k(M)}function k(M){return M.forEach(R=>{R.typ=="node"?R.node_type==1?R.value="global":R.value=R.node_id:R.value=R.key,R.children&&R.children.length>0&&(R.children=k(R.children))}),M}const O=M=>{ws.includes(M.node_type)&&(_(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(R=>{if(R.node_id==M.node_id){let T=R.label.split("/");T[0]=M.node_name,R.label=T.join("/"),R.node_name=M.node_name}}),b(),u.value.refresh())};return Qt(()=>e.properties.dataRaw,(M,R)=>{M!=R&&x()},{deep:!0}),Kt(()=>{x(),o(),n().eventCenter.on("custom:setNodeName",O)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",O)}),(M,R)=>(G(),Ue(In,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",dU,[E("div",cU,[E("div",fU,[R[0]||(R[0]=E("div",{class:"field-item-label"},"用户问题",-1)),E("div",hU,[E("div",pU,[H(ga,{ref_key:"questionTextRef",ref:u,value:f.question_value},null,8,["value"])])])]),E("div",vU,[R[1]||(R[1]=E("div",{class:"field-item-label"},"LLM模型",-1)),E("div",gU,[E("div",mU,[E("span",yU,[H(Nc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])])]),E("div",_U,[R[2]||(R[2]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",bU,[(G(!0),ue(st,null,mt(f.output,T=>(G(),ue("div",{class:gn(["field-value",{"is-required":T.required}]),key:T.cu_key},[E("span",xU,Ne(T.key),1),E("span",wU,Ne(T.typ),1)],2))),128))])])])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},EU=xt(SU,[["__scopeId","data-v-b4fcdde5"]]);let CU=class extends Pn{constructor(e){super(e),this.renderVue(EU,e)}},kU=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const OU={type:"parameter-extraction-node",model:kU,view:CU},NU={class:"ai-dialogue-node"},MU={class:"static-field-list"},AU={class:"static-field-item"},TU={class:"static-field-item-content"},DU={class:"static-field-value"},LU={class:"static-field-item"},PU={class:"static-field-item-content"},RU={class:"static-field-value"},IU={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Se(null),n=Mt("setData"),i=Mt("getGraph"),o=Mt("getNode"),a=Mt("resetSize"),l=Yr(),{modelList:u}=ql(l),d=Se([]),f=Jt({model_config_id:void 0,use_model:void 0,temperature:0,max_token:0,context_pair:0,prompt:"",prompt_tags:[],question_value:[],enable_thinking:!1}),h=Se([]);function g(_){if(_){let S=_.split("."),k=S[0],O=S.filter((M,R)=>R>0).join(".");return[k,O]}return["global","question"]}const y=()=>{const _=e.properties.dataRaw||e.properties.node_params||"{}";let S={};try{S=JSON.parse(_).question_optimize||{}}catch{S={}}x();const{model_config_id:k,use_model:O,context_pair:M,temperature:R,max_token:T,prompt:I,prompt_tags:$,question_value:ne,enable_thinking:V}=JSON.parse(JSON.stringify(S));f.model_config_id=k,f.use_model=O,f.context_pair=M||0,f.temperature=R,f.max_token=T,f.prompt=I,f.enable_thinking=V,f.prompt_tags=$||[],f.question_value=g(ne),!f.model_config_id&&u.value.length>0&&(f.model_config_id=u.value[0].id,f.use_model=u.value[0].children[0].name),xn(()=>{a()})},w=()=>{const _={...f,node_params:JSON.stringify({question_optimize:{...f,question_value:f.question_value.join("."),model_config_id:f.model_config_id?+f.model_config_id:f.model_config_id}})};n(_)},x=()=>{let _=o().getAllParentVariable();h.value=_},b=_=>{x(),f.prompt_tags&&f.prompt_tags.length>0&&f.prompt_tags.forEach(S=>{if(S.node_id==_.node_id){let k=S.label.split("/");k[0]=_.node_name,S.label=k.join("/"),S.node_name=_.node_name}}),w(),t.value.refresh()};return Qt(()=>e.properties,y,{deep:!0}),Kt(()=>{y(),xn(()=>{a()}),i().eventCenter.on("custom:setNodeName",b)}),Mi(()=>{i().eventCenter.off("custom:setNodeName",b)}),(_,S)=>(G(),Ue(In,{title:e.properties.node_name,menus:d.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",NU,[E("div",MU,[E("div",AU,[S[0]||(S[0]=E("div",{class:"static-field-item-label"},"用户问题",-1)),E("div",TU,[E("div",DU,[H(ga,{ref_key:"questionTextRef",ref:t,value:f.question_value},null,8,["value"])])])]),E("div",LU,[S[1]||(S[1]=E("div",{class:"static-field-item-label"},"LLM模型",-1)),E("div",PU,[E("div",RU,[H(Nc,{useModel:f.use_model,modelConfigId:f.model_config_id},null,8,["useModel","modelConfigId"])])])]),S[2]||(S[2]=E("div",{class:"static-field-item"},[E("div",{class:"static-field-item-label"},"输出"),E("div",{class:"static-field-item-content"},[E("div",{class:"static-field-value"},[E("span",{class:"static-field-key"},"问题优化结果"),E("span",{class:"static-field-type"},"string")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},BU=xt(IU,[["__scopeId","data-v-b6c9b29b"]]);let jU=class extends Pn{constructor(e){super(e),this.renderVue(BU,e)}},HU=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const $U={type:"problem-optimization-node",model:HU,view:jU},Vw="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20class='design-iconfont'%3e%3cpath%20d='M13%208L3%208'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%2012L13%208L9%204'%20stroke='%23595959'%20stroke-width='1.33333'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",FU={class:"add-data-node"},zU={class:"static-field-list"},WU={class:"static-field-item"},UU={class:"static-field-item-content"},VU={class:"static-field-value"},qU={class:"static-field-item"},XU={class:"static-field-item-content"},GU={key:0,class:"static-field-value"},YU={class:"field-name"},KU={class:"field-name"},JU={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("resetSize"),i=Mt("getNode");let o={};const a=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",datas:[]}}),l=Se([]),u=()=>{let h=i().getAllParentVariable();l.value=h||[]},d=()=>{let h=e.properties.dataRaw||e.properties.node_params||"{}";o=JSON.parse(h),u(),a.formData=o.form_insert,f(),xn(()=>{n()})},f=()=>{o.form_insert=Gi(a.formData),t({...e.node,node_params:JSON.stringify(o)})};return Qt(()=>e.properties.dataRaw,(h,g)=>{h!==g&&d()}),Kt(()=>{d()}),(h,g)=>(G(),Ue(In,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",FU,[E("div",zU,[E("div",WU,[g[0]||(g[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",UU,[E("div",VU,Ne(a.formData.form_name||"--"),1)])]),E("div",qU,[g[2]||(g[2]=E("div",{class:"static-field-item-label"},"插入数据",-1)),E("div",XU,[a.formData.datas.length==0?(G(),ue("div",GU,"--")):tt("",!0),(G(!0),ue(st,null,mt(a.formData.datas,y=>(G(),ue("div",{class:"static-field-value",key:y.id},[E("span",YU,[H(Gr,{options:l.value,"default-value":y.value,defaultSelectedList:y.atTags},null,8,["options","default-value","defaultSelectedList"])]),g[1]||(g[1]=E("span",{class:"field-arrow"},[E("img",{src:Vw,alt:""})],-1)),E("span",KU,Ne(y.name),1)]))),128))])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},ZU=xt(JU,[["__scopeId","data-v-419759cb"]]);let QU=class extends Pn{constructor(e){super(e),this.renderVue(ZU,e)}},eV=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const tV={type:"add-data-node",model:eV,view:QU},nV={class:"node-box"},rV={class:"static-field-list"},iV={class:"static-field-item"},oV={class:"static-field-item-content"},aV={class:"static-field-value"},sV={class:"static-field-item",style:{"align-items":"center"}},lV={class:"static-field-item-content"},uV={key:0,class:"static-field-value"},dV={class:"condition-box"},cV={key:0,class:"condition-left-box"},fV={class:"connection-text"},hV={key:1,class:"condition-line"},pV={class:"condition-body"},vV={class:"field-items"},gV={class:"field-name"},mV={class:"field-rule"},yV={class:"field-value"},_V={class:"static-field-item"},bV={class:"static-field-item-content"},xV={class:"options-list"},wV={class:"option-label"},SV={class:"option-label"},EV={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("resetSize"),i=Mt("getNode"),o=Do();let a={};const l=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,datas:[],where:[]},fieldList:[]}),u=Se([]),d=()=>{let b=i().getAllParentVariable();u.value=b||[]},f=()=>{let b=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(b),d();let _=g(a.form_update.where||[]);a.form_update.where=_,l.formData=a.form_update,l.formData.form_id&&w(l.formData.form_id),h(),xn(()=>{n()})},h=()=>{let b={...Gi(l.formData)};b.where=y(b.where),a.form_update=b,t({...e.node,node_params:JSON.stringify(a)})},g=b=>{let _=[];return b.forEach(S=>{let k=JSON.parse(JSON.stringify(S)),O=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=O[0],O.shift(),k.rule=O.join("_"),_.push(k)}),_},y=b=>{let _=[];return b.forEach(S=>{let k=JSON.parse(JSON.stringify(S));k.form_field_id=k.form_field_id*1,k.rule=S.field_type+"_"+S.rule,_.push(k)}),_},w=async b=>{o.getFormFieldList({form_id:b}).then(_=>{_.forEach(S=>{S.id=S.id*1}),l.fieldList=_}).catch(()=>{})},x=(b,_)=>jv(_,b);return Qt(()=>e.properties.dataRaw,(b,_)=>{b!==_&&f()}),Kt(()=>{f()}),(b,_)=>(G(),Ue(In,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:q(()=>[E("div",nV,[E("div",rV,[E("div",iV,[_[0]||(_[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",oV,[E("div",aV,Ne(l.formData.form_name||"--"),1)])]),E("div",sV,[_[2]||(_[2]=E("div",{class:"static-field-item-label"},"更新条件",-1)),E("div",lV,[l.formData.where.length==0?(G(),ue("span",uV,"--")):tt("",!0),E("div",dV,[l.formData.where.length>1?(G(),ue("div",cV,[E("span",fV,Ne(l.formData.typ==1?"且":"或"),1)])):tt("",!0),l.formData.where.length>1?(G(),ue("div",hV)):tt("",!0),E("div",pV,[E("div",vV,[(G(!0),ue(st,null,mt(l.formData.where,S=>(G(),ue("div",{class:"field-item",key:S.id},[E("span",gV,Ne(S.field_name),1),E("span",mV,Ne(x(S.field_type,S.rule)),1),E("span",yV,[H(Gr,{options:u.value,"default-value":S.rule_value1,defaultSelectedList:S.atTags},null,8,["options","default-value","defaultSelectedList"]),S.rule_value2?(G(),ue(st,{key:0},[_[1]||(_[1]=E("span",null,"-",-1)),H(Gr,{options:u.value,"default-value":S.rule_value2,defaultSelectedList:S.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):tt("",!0)])]))),128))])])])])]),E("div",_V,[_[4]||(_[4]=E("div",{class:"static-field-item-label"},"更新数据",-1)),E("div",bV,[E("div",xV,[(G(!0),ue(st,null,mt(l.formData.datas,S=>(G(),ue("div",{class:"options-item",key:S.key},[E("div",wV,[H(Gr,{options:u.value,"default-value":S.value,defaultSelectedList:S.atTags},null,8,["options","default-value","defaultSelectedList"])]),_[3]||(_[3]=E("span",{class:"field-arrow"},[E("img",{src:Vw,alt:""})],-1)),E("div",SV,Ne(S.name),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},CV=xt(EV,[["__scopeId","data-v-632323ff"]]);let kV=class extends Pn{constructor(e){super(e),this.renderVue(CV,e)}},OV=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const NV={type:"update-data-node",model:OV,view:kV},MV={class:"node-box"},AV={class:"static-field-list"},TV={class:"static-field-item"},DV={class:"static-field-item-content"},LV={class:"static-field-value"},PV={class:"static-field-item",style:{"align-items":"center"}},RV={class:"static-field-item-content"},IV={key:0,class:"static-field-value"},BV={class:"condition-box"},jV={key:0,class:"condition-left-box"},HV={class:"connection-text"},$V={key:1,class:"condition-line"},FV={class:"condition-body"},zV={class:"field-items"},WV={class:"field-name"},UV={class:"field-rule"},VV={class:"field-value"},qV={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("resetSize"),n=Mt("setData"),i=Mt("getNode"),o=Do();let a={};const l=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,where:[]},fieldList:[]}),u=Se([]),d=()=>{let b=i().getAllParentVariable();u.value=b||[]},f=()=>{let b=e.properties.dataRaw||e.properties.node_params||"{}";a=JSON.parse(b),d();let _=y(a.form_delete.where||[]);a.form_delete.where=_,l.formData=a.form_delete,l.formData.form_id&&w(l.formData.form_id),h(),xn(()=>{t()})},h=()=>{let b={...Gi(l.formData)};b.where=g(b.where),a.form_delete=b,n({...e.node,node_params:JSON.stringify(a)})},g=b=>{let _=[];return b.forEach(S=>{let k=JSON.parse(JSON.stringify(S));k.form_field_id=k.form_field_id*1,k.rule=S.field_type+"_"+S.rule,_.push(k)}),_},y=b=>{let _=[];return b.forEach(S=>{let k=JSON.parse(JSON.stringify(S)),O=k.rule.split("_");k.form_field_id=k.form_field_id*1,k.field_type=O[0],O.shift(),k.rule=O.join("_"),_.push(k)}),_},w=async b=>{o.getFormFieldList({form_id:b}).then(_=>{_.forEach(S=>{S.id=S.id*1}),l.fieldList=_,xn(()=>{t()})}).catch(()=>{})},x=(b,_)=>jv(_,b);return Qt(()=>e.properties.dataRaw,(b,_)=>{b!==_&&f()}),Kt(()=>{f()}),(b,_)=>(G(),Ue(In,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:q(()=>[E("div",MV,[E("div",AV,[E("div",TV,[_[0]||(_[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",DV,[E("div",LV,Ne(l.formData.form_name||"--"),1)])]),E("div",PV,[_[2]||(_[2]=E("div",{class:"static-field-item-label"},"删除条件",-1)),E("div",RV,[l.formData.where.length==0?(G(),ue("span",IV,"--")):tt("",!0),E("div",BV,[l.formData.where.length>1?(G(),ue("div",jV,[E("span",HV,Ne(l.formData.typ==1?"且":"或"),1)])):tt("",!0),l.formData.where.length>1?(G(),ue("div",$V)):tt("",!0),E("div",FV,[E("div",zV,[(G(!0),ue(st,null,mt(l.formData.where,S=>(G(),ue("div",{class:"field-item",key:S.id},[E("span",WV,Ne(S.field_name),1),E("span",UV,Ne(x(S.field_type,S.rule)),1),E("span",VV,[H(Gr,{options:u.value,"default-value":S.rule_value1,defaultSelectedList:S.atTags},null,8,["options","default-value","defaultSelectedList"]),S.rule_value2?(G(),ue(st,{key:0},[_[1]||(_[1]=E("span",null,"-",-1)),H(Gr,{options:u.value,"default-value":S.rule_value2,defaultSelectedList:S.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):tt("",!0)])]))),128))])])])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},XV=xt(qV,[["__scopeId","data-v-a02bcfc5"]]);let GV=class extends Pn{constructor(e){super(e),this.renderVue(XV,e)}},YV=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const KV={type:"delete-data-node",model:YV,view:GV},JV={class:"node-box"},ZV={class:"static-field-list"},QV={class:"static-field-item"},eq={class:"static-field-item-content"},tq={class:"static-field-value"},nq={class:"static-field-item",style:{"align-items":"center"}},rq={class:"static-field-item-content"},iq={key:0,class:"static-field-value"},oq={class:"condition-box"},aq={key:0,class:"condition-left-box"},sq={class:"connection-text"},lq={key:1,class:"condition-line"},uq={class:"condition-body"},dq={class:"field-items"},cq={class:"field-name"},fq={class:"field-rule"},hq={class:"field-value"},pq={class:"static-field-item"},vq={class:"static-field-item-content"},gq={class:"options-list"},mq={class:"option-label"},yq={class:"option-type"},_q={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("resetSize"),i=Mt("getNode"),o=Mt("getGraph"),a=Do();let l={};const u=Jt({tableList:[],formData:{form_name:"",form_description:"",form_id:"",typ:1,fields:[],where:[],order:[],limit:100},fieldList:[]}),d=Se([]),f=()=>{let k=i().getAllParentVariable();d.value=k||[]},h=()=>{let k=e.properties.dataRaw||e.properties.node_params||"{}";l=JSON.parse(k),f();let O=y(l.form_select.where||[]);l.form_select.where=O,u.formData=l.form_select,u.formData.form_id&&b(u.formData.form_id),g(),xn(()=>{n()})},g=()=>{let k={...Gi(u.formData)};k.where=w(k.where),l.form_select=k,t({...e.node,node_params:JSON.stringify(l)})},y=k=>{let O=[];return k.forEach(M=>{let R=JSON.parse(JSON.stringify(M)),T=R.rule.split("_");R.form_field_id=R.form_field_id*1,R.field_type=T[0],T.shift(),R.rule=T.join("_"),O.push(R)}),O},w=k=>{let O=[];return k.forEach(M=>{let R=JSON.parse(JSON.stringify(M));R.form_field_id=R.form_field_id*1,R.rule=M.field_type+"_"+M.rule,O.push(R)}),O},x=async()=>{const k=await a.getFormList();k&&(u.tableList=k)},b=async k=>{a.getFormFieldList({form_id:k}).then(O=>{O.forEach(M=>{M.id=M.id*1}),u.fieldList=O}).catch(()=>{})},_=(k,O)=>jv(O,k),S=()=>{h()};return Qt(()=>e.properties.dataRaw,(k,O)=>{k!==O&&h()}),Kt(()=>{x(),h(),o().eventCenter.on("custom:setNodeName",S)}),Mi(()=>{o().eventCenter.off("custom:setNodeName",S)}),(k,O)=>(G(),Ue(In,{title:e.properties.node_name,"icon-name":r.properties.node_icon_name,isSelected:r.isSelected,isHovered:r.isHovered,"node-key":r.properties.node_key,node_type:r.properties.node_type},{default:q(()=>[E("div",JV,[E("div",ZV,[E("div",QV,[O[0]||(O[0]=E("div",{class:"static-field-item-label"},"数据表",-1)),E("div",eq,[E("div",tq,Ne(u.formData.form_name||"--"),1)])]),E("div",nq,[O[2]||(O[2]=E("div",{class:"static-field-item-label"},"查询条件",-1)),E("div",rq,[u.formData.where.length==0?(G(),ue("span",iq,"--")):tt("",!0),E("div",oq,[u.formData.where.length>1?(G(),ue("div",aq,[E("span",sq,Ne(u.formData.typ==1?"且":"或"),1)])):tt("",!0),u.formData.where.length>1?(G(),ue("div",lq)):tt("",!0),E("div",uq,[E("div",dq,[(G(!0),ue(st,null,mt(u.formData.where,M=>(G(),ue("div",{class:"field-item",key:M.id},[E("span",cq,Ne(M.field_name),1),E("span",fq,Ne(_(M.field_type,M.rule)),1),E("span",hq,[H(Gr,{options:d.value,"default-value":M.rule_value1,defaultSelectedList:M.atTags},null,8,["options","default-value","defaultSelectedList"]),M.rule_value2?(G(),ue(st,{key:0},[O[1]||(O[1]=E("span",null,"-",-1)),H(Gr,{options:d.value,"default-value":M.rule_value2,defaultSelectedList:M.atTags2},null,8,["options","default-value","defaultSelectedList"])],64)):tt("",!0)])]))),128))])])])])]),E("div",pq,[O[3]||(O[3]=E("div",{class:"static-field-item-label"},"查询字段",-1)),E("div",vq,[E("div",gq,[(G(!0),ue(st,null,mt(u.formData.fields,M=>(G(),ue("div",{class:"options-item",key:M.key},[E("div",mq,Ne(M.name),1),E("div",yq,Ne(M.type),1)]))),128))])])])])])]),_:1},8,["title","icon-name","isSelected","isHovered","node-key","node_type"]))}},bq=xt(_q,[["__scopeId","data-v-8cf3c00f"]]);let xq=class extends Pn{constructor(e){super(e),this.renderVue(bq,e)}},wq=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+25,id:u+"-anchor_right",type:"right",nodeId:e}]}};const Sq={type:"select-data-node",model:wq,view:xq},Eq={class:"ai-dialogue-node"},Cq={class:"field-list"},kq={class:"field-item"},Oq={class:"field-item-content"},Nq={class:"field-text"},Mq={class:"right-arrow"},Aq={class:"field-text"},Tq={class:"field-item"},Dq={class:"field-item-content"},Lq={class:"field-key"},Pq={class:"field-type"},Rq=`function main({data1, data2}){
	return {
		data1,
    	data2
	}
}`,Iq={__name:"index",props:{properties:{type:Object,default:()=>({})},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},setup(r){const e=r,t=Mt("setData"),n=Mt("getGraph"),i=Mt("getNode"),o=Mt("resetSize"),a=Se([]),l=Jt({main_func:"",params:[{field:"",variable:[]}],timeout:30,output:[{key:"",typ:"",subs:[]}],exception:""}),u=Se([]);let d=["special.lib_paragraph_list","special.llm_reply_content","specify-reply-node"];function f(b){return b.forEach(_=>{_.cu_key=Math.random()*1e4,_.subs&&_.subs.length?f(_.subs):_.subs=[]}),b}const h=()=>{const b=e.properties.dataRaw||e.properties.node_params||"{}";let _={};try{_=JSON.parse(b).code_run||{}}catch{_={}}w(),_=JSON.parse(JSON.stringify(_));for(let S in _){if(S=="params"){_[S]&&_[S].length>0?l[S]=_[S].map(k=>({...k,cu_key:Math.random()*1e4})):l[S]=[];continue}if(S=="output"){l.output=f(_[S]);continue}l[S]=_[S]}l.main_func=l.main_func||Rq,l.params=l.params.map(S=>{let k="";for(let O=0;O<d.length;O++)if(S.variable.indexOf(d[O])>-1){k=d[O];break}if(k!=""){let O=S.variable.split(".");S.variable=[O[0],k]}else S.variable=S.variable.split(".");return{...S,key:Math.random()*1e4}}),xn(()=>{o()})},g=()=>{const b=JSON.stringify({code_run:{...l,params:y()}});t({...e.node,...l,node_params:b})};function y(){let b=[];return l.params.forEach(_=>{b.push({field:_.field,variable:_.variable&&_.variable.length>0?_.variable.join("."):""})}),b}const w=()=>{let b=i().getAllParentVariable();u.value=b},x=b=>{ws.includes(b.node_type)&&(w(),xn(()=>{g()}))};return Qt(()=>e.properties,h,{deep:!0}),Kt(()=>{h(),o(),n().eventCenter.on("custom:setNodeName",x)}),Mi(()=>{n().eventCenter.off("custom:setNodeName",x)}),(b,_)=>(G(),Ue(In,{title:e.properties.node_name,menus:a.value,"icon-name":e.properties.node_icon_name,isSelected:e.isSelected,isHovered:e.isHovered,"node-key":e.properties.node_key,node_type:e.properties.node_type,style:{width:"420px"}},{default:q(()=>[E("div",Eq,[E("div",Cq,[E("div",kq,[_[0]||(_[0]=E("div",{class:"field-item-label"},"输入参数",-1)),E("div",Oq,[(G(!0),ue(st,null,mt(l.params,S=>(G(),ue("div",{class:"field-list-item",key:S.cu_key},[E("div",Nq,[H(ga,{value:S.variable},null,8,["value"])]),E("div",Mq,[H(ze(fl))]),E("div",Aq,Ne(S.field),1)]))),128))])]),E("div",Tq,[_[1]||(_[1]=E("div",{class:"field-item-label"},"输出字段",-1)),E("div",Dq,[(G(!0),ue(st,null,mt(l.output,S=>(G(),ue("div",{class:"field-value",key:S.cu_key},[E("span",Lq,Ne(S.key),1),E("span",Pq,Ne(S.typ),1)]))),128))])]),_[2]||(_[2]=E("div",{class:"field-item"},[E("div",{class:"field-item-label"},"异常处理"),E("div",{class:"field-item-content"},[E("div",{class:"field-value"},[E("span",{class:"field-key"},"运行代码报错时执行该分支")])])],-1))])])]),_:1},8,["title","menus","icon-name","isSelected","isHovered","node-key","node_type"]))}},Bq=xt(Iq,[["__scopeId","data-v-b020100f"]]);let jq=class extends Pn{constructor(e){super(e),this.renderVue(Bq,e)}},Hq=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+28,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+28,id:u+"-anchor_right",type:"right",nodeId:e},{x:t+i/2,y:n+o/2-28,id:u+"-anchor_right_exception",type:"right",nodeId:e}]}};const $q={type:"code-run-node",model:Hq,view:jq},Fq={name:"QuestionNode",components:{NodeCommon:In},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],visible:!1,toolInfo:{},mcpInfo:{},nodeParams:{mcp:{provider_id:"",tool_name:"",arguments:{}}}}},mounted(){this.nodeParams=JSON.parse(this.properties.node_params),this.loadProvider()},methods:{loadProvider(){var r;A1({provider_id:((r=this.nodeParams)==null?void 0:r.mcp.provider_id)||""}).then(e=>{var n;this.mcpInfo=(e==null?void 0:e.data)||{};let t=h1((n=this.mcpInfo)==null?void 0:n.tools,[]);this.toolInfo=t.find(i=>{var o;return i.name==((o=this.nodeParams)==null?void 0:o.mcp.tool_name)})})},update(r){let e=this.nodeParams;e.mcp.arguments=r.arguments,e.mcp.tag_map=r.tag_map,this.setData({node_params:JSON.stringify(e)})}}},zq={class:"mcp-node"};function Wq(r,e,t,n,i,o){var u;const a=Mv,l=On("node-common");return G(),Ue(l,{title:(u=i.toolInfo)==null?void 0:u.name,"icon-url":i.mcpInfo.avatar,"icon-name":t.properties.node_icon_name,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:q(()=>[E("div",zq,[e[1]||(e[1]=$e(" MCP插件： ")),i.toolInfo===null?(G(),Ue(a,{key:0,color:"red"},{default:q(()=>e[0]||(e[0]=[$e("工具不存在或工具异常")])),_:1,__:[0]})):(G(),Ue(a,{key:1},{default:q(()=>[$e(Ne(t.properties.node_name),1)]),_:1}))])]),_:1},8,["title","icon-url","icon-name","isSelected","isHovered","node-key"])}const Uq=xt(Fq,[["render",Wq]]);let Vq=class extends Pn{constructor(e){super(e),this.renderVue(Uq,e)}},qq=class extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}};const Xq={type:"mcp-node",model:qq,view:Vq},Gq={name:"QuestionNode",components:{NodeCommon:In},inject:["getNode","getGraph","setData"],props:{properties:{type:Object,default(){return{}}},isSelected:{type:Boolean,default:!1},isHovered:{type:Boolean,default:!1}},data(){return{menus:[{name:"删除",key:"delete",color:"#fb363f"}],formState:{},nodeParams:{},info:{}}},mounted(){this.init()},watch:{properties:{handler(r,e){r.dataRaw!==e.dataRaw&&(this.nodeParamsFormat(),this.formStateFormat())},deep:!0}},methods:{init(){this.nodeParamsFormat(),this.loadPluginParams(),this.loadPluginInfo()},loadPluginInfo(){var r,e;D1({name:(e=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:e.name}).then(t=>{let n=(t==null?void 0:t.data)||{};this.info=n.remote})},loadPluginParams(){var r,e;T1({name:((e=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:e.name)||"",action:"default/get-schema",params:{}}).then(t=>{this.formState=(t==null?void 0:t.data)||{},this.formStateFormat()})},nodeParamsFormat(){this.nodeParams=JSON.parse(this.properties.node_params)},formStateFormat(){var r,e,t,n;for(let i in this.formState)this.formState[i].value=String(((e=(r=this.nodeParams)==null?void 0:r.plugin)==null?void 0:e.params[i])||""),this.formState[i].tags=((n=(t=this.nodeParams)==null?void 0:t.plugin)==null?void 0:n.tag_map)||[]}}},Yq={class:"ding-group-node"},Kq={class:"label"};function Jq(r,e,t,n,i,o){const a=Mv,l=On("node-common");return G(),Ue(l,{title:t.properties.node_name,iconUrl:i.info.icon,isSelected:t.isSelected,isHovered:t.isHovered,"node-key":t.properties.node_key},{default:q(()=>[E("div",Yq,[(G(!0),ue(st,null,mt(i.formState,(u,d)=>(G(),ue("div",{key:d},[E("span",Kq,Ne(d)+"：",1),H(a,null,{default:q(()=>[$e(Ne(u.value||"--"),1)]),_:2},1024)]))),128))])]),_:1},8,["title","iconUrl","isSelected","isHovered","node-key"])}const Zq=xt(Gq,[["render",Jq],["__scopeId","data-v-513dd738"]]);class Qq extends Pn{constructor(e){super(e),this.renderVue(Zq,e)}}class eX extends Rn{setAttributes(){const e={message:"只允许从右边的锚点连出",validate:(n,i,o,a)=>{if(n.id==i.id)return!1;const l=n.graphModel.edges.map(d=>d.sourceAnchorId),u=o.id;return o.type==="right"&&!l.includes(u)}};this.sourceRules=[e];const t={message:"只允许连接左边的锚点",validate:(n,i,o,a)=>n.id==i.id?!1:a.type==="left"};this.targetRules=[t]}getDefaultAnchor(){const{id:e,x:t,y:n,width:i,height:o,isHovered:a,isSelected:l}=this,{nodeSortKey:u}=this.properties;return[{x:t-i/2,y:n-o/2+24,id:u+"-anchor_left",type:"left",nodeId:e},{x:t+i/2,y:n-o/2+24,id:u+"-anchor_right",type:"right",nodeId:e}]}}const tX={type:"zm-plugins-node",model:eX,view:Qq},nX={name:"QuestionNode",components:{PopupMenu:W1},emits:["click-item"],inject:["getNode","getGraph"],props:{properties:{type:Object,default(){return{}}}},data(){return{}},mounted(){},methods:{handleAddNode(r){this.$emit("click-item",r)}}};function rX(r,e,t,n,i,o){const a=On("PopupMenu");return G(),Ue(a,{onAddNode:o.handleAddNode,type:"node"},null,8,["onAddNode"])}const iX=xt(nX,[["render",rX]]),oX=130,aX=440;class sX{constructor({lf:e}){bo(this,"listenDelete",()=>{this.hideMenu()});this.menuTypeMap=new Map,this.lf=e,this.__menuDOM=document.createElement("div"),this.__menuDOM.className="lf-inner-context",this.__menuDOM.style.width=`${oX}px`,this.__menuDOM.style.height=`${aX}px`,this.isMounted=!1,this.r=bn(iX,{properties:{},isSelected:!1,isHovered:!1,onClickItem:({node:t,event:n})=>{this.hideMenu(),e.graphModel.eventCenter.emit("custom:addNode",{node:t,event:n,model:this._activeData,anchorData:this._activeAnchorData})}}),this.app=ms({render:()=>this.r,provide:()=>({getNode:()=>this._activeData,getGraph:()=>e.graphModel}),mounted:()=>{}})}render(e,t){this.container=t,this.isMounted||(this.isMounted=!0,this.container.appendChild(this.__menuDOM),this.app.mount(this.__menuDOM)),e.on("custom:showPopupMenu",({anchorData:n,model:i})=>{this._activeData=i,this._activeAnchorData=n,this.createMenu()}),e.on("node:click",({data:n})=>{this.hideMenu()}),e.on("edge:click",({data:n})=>{this.hideMenu()}),e.on("blank:click",()=>{this.hideMenu()})}createMenu(){this.showMenu()}getContextMenuPosition(){const e=this._activeAnchorData;let t=e.x+5,n=e.y-10;return this.lf.graphModel.transformModel.CanvasPointToHtmlPoint([t,n])}showMenu(){const[e,t]=this.getContextMenuPosition();this.__menuDOM.style.display="flex",this.__menuDOM.style.top=`${t}px`,this.__menuDOM.style.left=`${e+10}px`,!this.isShow&&this.lf.on("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!0}hideMenu(){this.__menuDOM.style.display="none",this.isShow,this.lf.off("node:delete,edge:delete,node:drag,graph:transform",this.listenDelete),this.isShow=!1}}class qw{constructor({lf:e}){bo(this,"handleHistoryKeyDown",e=>{if(this.isInputElement(e.target))return;const{ctrlKey:t,key:n,metaKey:i}=e,o=t||i;if(o&&n.toLowerCase()==="z"&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),this.undo();return}if(o&&(n.toLowerCase()==="y"||n.toLowerCase()==="z"&&e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.redo();return}});this.lf=e,this.historyStack=[],this.redoStack=[],this.isProcessing=!1,this.historyChangeCallbacks=[],this._isSelectionDrop=!1,this._isSelectionCompleted=!1}createSnapshot(){const e=this.lf.getGraphData(),t=this.lf.getSelectElements(!0);let n=[...t.nodes,...t.edges].map(i=>i.id);return{nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),selectedElementIds:n||[],timestamp:Date.now(),operation:"snapshot"}}saveCurrentState(e="change"){if(this.isProcessing)return;const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.redoStack=[],this.notifyHistoryChange()}undo(){if(this.historyStack.length<=1||this.isProcessing)return;const e=this.historyStack.pop();this.redoStack.push(e);const t=this.historyStack[this.historyStack.length-1];this.restoreState(t),this.notifyHistoryChange()}redo(){if(this.redoStack.length===0||this.isProcessing)return;const e=this.redoStack.pop();this.historyStack.push(e),this.restoreState(e),this.notifyHistoryChange()}restoreState(e){this.isProcessing=!0;try{this.lf.clearSelectElements(),this.lf.clearData(),this.lf.graphModel.graphDataToModel({nodes:e.nodes||[],edges:e.edges||[]}),e.selectedElementIds&&e.selectedElementIds.length>0&&e.selectedElementIds.forEach(t=>{this.lf.selectElementById(t,!0)})}finally{this.isProcessing=!1}}isInputElement(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName))return!0;let n=e;for(;n&&n!==document.body;){if(n.hasAttribute&&n.hasAttribute("contenteditable"))return!0;n=n.parentElement}return!1}registerLogicFlowEvents(){["node:add","node:drop","edge:add","edge:adjust"].forEach(t=>{this.lf.on(t,()=>{this.saveCurrentState(t)})}),this.lf.on("selection:drop",()=>{this._isSelectionDrop=!0,this._isSelectionCompleted=!1,setTimeout(()=>{this.onselectionDrop()},20)}),this.lf.on("selection:selected",()=>{this._isSelectionDrop&&(this._isSelectionDrop=!1,this._isSelectionCompleted=!0)}),this.lf.on("blank:click",()=>{this.clearSelectedStatus()}),this.lf.on("element:click",()=>{this.clearSelectedStatus()})}clearSelectedStatus(){this._isSelectionDrop=!1,this._isSelectionCompleted=!1}onselectionDrop(){this._isSelectionCompleted||this.saveCurrentState("selection:drop"),this._isSelectionDrop=!1}render(e,t,n){this.maxHistorySize=n&&n.maxHistorySize||50,document.addEventListener("keydown",this.handleHistoryKeyDown),this.registerLogicFlowEvents()}setInitialState(e){this.historyStack=[],this.redoStack=[];const t={nodes:JSON.parse(JSON.stringify(e.nodes||[])),edges:JSON.parse(JSON.stringify(e.edges||[])),timestamp:Date.now(),operation:"init"};this.historyStack.push(t),this.notifyHistoryChange()}canUndo(){return this.historyStack.length>1}canRedo(){return this.redoStack.length>0}getHistorySize(){return Math.max(0,this.historyStack.length-1)}getRedoSize(){return this.redoStack.length}onHistoryChange(e){typeof e=="function"&&this.historyChangeCallbacks.push(e)}notifyHistoryChange(){this.historyChangeCallbacks.forEach(e=>{try{const t=this.historyStack.map((o,a)=>({index:a,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),n=this.redoStack.map((o,a)=>({index:a,timestamp:o.timestamp,operation:o.operation,nodeCount:o.nodes?o.nodes.length:0,edgeCount:o.edges?o.edges.length:0,nodes:o.nodes||[],edges:o.edges||[],selectedElementIds:o.selectedElementIds||[]})),i=this.historyStack.length-1;e({canUndo:this.canUndo(),canRedo:this.canRedo(),historySize:this.getHistorySize(),redoSize:this.getRedoSize(),maxSize:this.maxHistorySize,currentCanvas:t[i],historyDetails:t,redoDetails:n,currentHistoryIndex:i})}catch(t){console.error("History change callback error:",t)}})}clearHistory(){this.historyStack=[this.createSnapshot()],this.redoStack=[],this.notifyHistoryChange()}replaceLastState(e="replace"){if(this.isProcessing)return;this.canUndo()&&this.historyStack.pop();const t=this.createSnapshot();t.operation=e,this.historyStack.push(t),this.historyStack.length>this.maxHistorySize&&this.historyStack.shift(),this.notifyHistoryChange()}beginTransaction(){this.isProcessing=!0}commitTransaction(e="commit"){this.isProcessing=!1,this.saveCurrentState(e)}destroy(){document.removeEventListener("keydown",this.handleHistoryKeyDown),this.historyChangeCallbacks=[],this.historyStack=[],this.redoStack=[]}}bo(qw,"pluginName","canvasHistory");class Xw{constructor({lf:e}){bo(this,"wheelEventListener",e=>{if(e.shiftKey){e.preventDefault();const t=this.lf.getTransform();let n=t.SCALE_X,i=t.SCALE_Y;e.deltaY>0?this.lf.translate(-100*n,100*i):this.lf.translate(100*n,-100*i)}else if(e.ctrlKey){e.preventDefault();const{transformModel:t}=this.lf.graphModel,[n,i]=t.HtmlPointToCanvasPoint([e.clientX,e.clientY]),o=this.lf.getTransform();this.zoom=o.SCALE_X,e.deltaY<0?this.zoom+=.04:this.zoom-=.04,this.lf.zoom(this.zoom,[n,i])}});bo(this,"keydownListener",e=>{const t=e.key.toLowerCase(),{graphModel:{eventCenter:n}}=this.lf,i=e.target,o=i===document.body||this.lf.container.contains(i);if(e.ctrlKey){if(t==="c"){if(!o)return;e.preventDefault();let a=this.lf.getSelectElements(!0);a=JSON.parse(JSON.stringify(a)),a.edges=[];const l=a.nodes.filter(u=>u.type!=="start-node"&&u.type!=="custom-group");if(l.length>0){this.basePointX=20,this.basePointY=20;let u={x:1/0,y:1/0};l.forEach(d=>{d.id="",d.nodeSortKey="",d.properties.id="",d.properties.next_node_key="",d.properties.nodeSortKey="",d.properties.node_key="",!d.width&&d.properties.width&&(d.width=d.properties.width),!d.height&&d.properties.height&&(d.height=d.properties.height),d.x<u.x&&(u.x=d.x),d.y<u.y&&(u.y=d.y)}),this.clipboard={nodes:l,basePoint:u}}else this.clipboard=null;return}if(t==="v"){if(!o)return;if(e.preventDefault(),this.clipboard&&this.clipboard.nodes.length>0){const a={x:this.clipboard.basePoint.x+this.basePointX,y:this.clipboard.basePoint.y+this.basePointY};n.emit("custom:paste",{originalNodes:this.clipboard.nodes,basePoint:this.clipboard.basePoint,pasteBasePoint:a}),this.basePointX+=20,this.basePointY+=20}return}}if(t==="delete"&&o){n.emit("custom:keyoard:delete");return}e.ctrlKey&&!this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!0,this.lf.extension.selectionSelect.openSelectionSelect(),this.lf.once("selection:selected",()=>{this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect()}))});bo(this,"keyupListener",e=>{!e.ctrlKey&&this.isCtrlPressed&&(e.preventDefault(),this.isCtrlPressed=!1,this.lf.extension.selectionSelect.closeSelectionSelect())});this.lf=e,this.isCtrlPressed=!1,this.zoom=1,this.clipboard=null,this.basePointX=20,this.basePointY=20}render(){this.lf.container.tabIndex=0,this.lf.container.addEventListener("wheel",this.wheelEventListener,{passive:!1}),document.addEventListener("keydown",this.keydownListener,{passive:!1}),document.addEventListener("keyup",this.keyupListener,{passive:!1})}destroy(){this.lf.container.removeEventListener("wheel",this.wheelEventListener),document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener)}}bo(Xw,"pluginName","custom-keyboard");const lX={class:"logic-flow-wrapper"},s1="dont_show_delete_node_confirm",uX={__name:"workflow-canvas",emits:["selectNode","onDeleteNode","onDeleteEdge","runTest","blankClick"],setup(r,{expose:e,emit:t}){const n=t;let i=null;const{setStorage:o,getStorage:a}=tC(),l=Se(a(s1)||!1),u=Se(null),d=Se(!1),f=Se(null),h=Se(null),g=Lw(),y=Se(""),w=Se([]),x={nodes:[]},b={width:160,height:140,bottomPosition:24,rightPosition:16},_={exclusiveMode:!1},S=W=>{i&&i.zoom(W)};function k(){if(h.value){i=new V$({container:h.value,nodeTextEdit:!1,edgeTextEdit:!1,textEdit:!1,grid:!1,stopMoveGraph:!1,stopZoomGraph:!0,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!0,edgeSelectedOutline:!0,nodeSelectedOutline:!0,hoverOutline:!0,hideAnchors:!1,background:{backgroundColor:"#f0f2f5"},plugins:[o6,p6,sX,v6,qw,Xw,I7],pluginsOptions:{miniMap:b,selectionSelect:_,canvasHistory:{maxHistorySize:100}},keyboard:{enabled:!1,shortcuts:[{keys:["cmd + z","ctrl + z","cmd + y","ctrl + y","cmd + c","ctrl + c","cmd + v","ctrl + v"],callback:()=>{}}]}}),kn(V7,i),kn(Z7,i),kn(w9,i),kn($9,i),kn(G9,i),kn(Zz,i),kn(nz,i),kn(gz,i),kn(dW,i),kn(gW,i),kn(wW,i),kn(JW,i),kn(PW,i),kn(uU,i),kn(OU,i),kn($U,i),kn(tV,i),kn(NV,i),kn(KV,i),kn(Sq,i),kn($q,i),kn(Xq,i),kn(tX,i),i.setDefaultEdgeType("custom-bezier-edge"),i.on("graph:rendered",({graphModel:Y})=>{y.value=Y.flowId});let W=1;i.on("node:dragstart",({data:Y})=>{let se=i.graphModel.getElement(Y.id);W=se.zIndex,se.setZIndex(999999)}),i.on("node:drop",({data:Y})=>{i.graphModel.getElement(Y.id).setZIndex(W)}),i.on("node:drag",({data:Y})=>{const se=Y.id;i.graphModel.getNodeEdges(se).forEach(Pe=>{if(Pe.type==="custom-bezier-edge"){const{startPoint:Le,endPoint:He}=Pe,ft=He.x-Le.x,Ke=He.y-Le.y;let Ft=10+Math.sqrt(ft*ft+Ke*Ke)*.3;const te=10,A=1e3;Ft=Math.round(Ft),Ft=Math.max(te,Math.min(Ft,A)),Pe.setProperties({offset:Ft})}})}),i.on("node:add",()=>{}),i.on("custom:addNode",Y=>{I(Y)}),i.on("element:click",Y=>{w.value=[Y.data]}),i.on("node:click",({data:Y})=>{rt(Y)}),i.on("blank:click",()=>{le()}),i.on("selection:selected",Y=>{let se=[];Y.elements.forEach(ge=>{let Pe=i.getDataById(ge.id);(ge.BaseType==="node"||ge.BaseType==="edge")&&se.push(Pe)}),w.value=se}),i.on("node:delete",({data:Y})=>{let se=JSON.parse(JSON.stringify(Y));Ve(se)}),i.on("edge:delete",({data:Y})=>{let se=JSON.parse(JSON.stringify(Y));Be(se)}),i.on("custom:node:delete",Y=>{U(Y)}),i.on("custom:edge:delete",Y=>{j(Y)}),i.on("custom:keyoard:delete",()=>{fe()}),i.on("custom:paste",ne),i.render(x),i.setZoomMiniSize(.01),i.setZoomMaxSize(8),i.container.setAttribute("tabindex","0"),i.container.style.outline="none",i.container.focus()}}const O=()=>i.getGraphRawData(),M=W=>{let Y=XN();W.nodes.forEach(ge=>{let Pe=Y[ge.type];ge.properties.node_icon_name=Pe.properties.node_icon_name,ge.properties.width||(ge.properties.width=Pe.width),ge.properties.height||(ge.properties.height=Pe.height)}),i.clearData(),i.graphModel.graphDataToModel(W),i.graphModel.translateCenter(),i.extension.miniMap.show();const se=i.extension.canvasHistory;se&&se.setInitialState(W)};let R={};const T=W=>{const Y=W.node||W,se=W.anchorData,ge=W.event;if(Y.id=Y.id||Ul(Y.type),Y.nodeSortKey=Y.id.substring(0,8)+Y.id.substring(Y.id.length-8),W.isCopy||(R[Y.type]?(R[Y.type]=R[Y.type]+1,Y.properties.node_name=Y.properties.node_name+R[Y.type]):R[Y.type]=1),Y.properties.width=Y.width,Y.properties.height=Y.height,Y.properties.nodeSortKey=Y.nodeSortKey,ge){const{transformModel:Pe}=i.graphModel,{left:Le,top:He}=h.value.getBoundingClientRect(),[ft,Ke]=Pe.HtmlPointToCanvasPoint([ge.clientX-Le,ge.clientY-He]);Y.x=ft+Y.width/2,Y.y=Ke+Y.height/2}else if(!Y.x&&!Y.y)if(se)Y.x=se.x+Y.width+100,Y.y=se.y+Y.height/2-24;else{const{transformModel:Pe}=i.graphModel,Le=Pe.HtmlPointToCanvasPoint([i.graphModel.width/2,i.graphModel.height/2]);Y.x=Le[0],Y.y=Le[1]}return Y},I=W=>{const Y=T(W),se=W.model,ge=W.anchorData;let Pe=0;i.graphModel.nodes.forEach(He=>{He.zIndex>Pe&&(Pe=He.zIndex)}),Pe=Pe+1;let Le=i.addNode(Y);ge&&i.graphModel.addEdge({type:"custom-bezier-edge",sourceNodeId:se.id,targetNodeId:Le.id,sourceAnchorId:ge.id,startPoint:{x:ge.x,y:ge.y}}),Le.setZIndex(Pe),i.graphModel.clearSelectElements(),Le.setSelected(!0)},$=()=>{i.extension.dagre.layout({rankdir:"LR",align:"UL",ranker:"tight-tree"}),i.fitView();const W=i.getGraphRawData();i.clearSelectElements(),i.clearData(),i.graphModel.graphDataToModel(W)},ne=({originalNodes:W,basePoint:Y,pasteBasePoint:se})=>{const ge=i.extension.canvasHistory;ge&&ge.beginTransaction();try{const Pe=W.map(He=>{const ft=He.x-Y.x,Ke=He.y-Y.y,Nt=JSON.parse(JSON.stringify(He));return Nt.x=se.x+ft,Nt.y=se.y+Ke,T({node:Nt,isCopy:!0})}),{nodes:Le}=i.addElements({nodes:Pe});i.clearSelectElements(),Le.forEach(He=>{He.setSelected(!0)})}finally{ge&&ge.commitTransaction("paste")}},V=W=>{W.height&&(W.properties.height=W.height);let Y=i.getNodeModelById(W.id);Y.height=W.properties.height||W.height||Y.height,Y.properties=W.properties,W.properties.node_type==2&&W.properties.node_sub_type==21&&Y.graphModel.getNodeEdges(W.id).forEach(ge=>{ge.sourceNodeId==Y.id&&(Y.getAnchorInfo(ge.sourceAnchorId)||Y.graphModel.deleteEdgeById(ge.id))}),Y.refreshBranch()};function J(W){return i.getNodeModelById(W.id)}function D(W){return i.getEdgeModelById(W.id)}const U=W=>{W&&W.id&&(w.value=[W]),Ee()},j=W=>{W&&W.id&&(w.value=[W]),Ee()},fe=()=>{let W=i.getSelectElements(!0);w.value=[...W.nodes,...W.edges],Ee()},Ee=()=>{if(w.value.length===0)return;const W=w.value.filter(se=>J(se)?se.type!=="start-node":!0);if(W.length===0){w.value=[];return}const Y=()=>{const se=i.extension.canvasHistory;se&&se.replaceLastState("replace-before-delete"),W.forEach(ge=>{J(ge)?i.deleteNode(ge.id):D(ge)&&i.deleteEdge(ge.id)}),se&&se.saveCurrentState("delete"),w.value=[],i.clearSelectElements()};if(l.value){Y();return}if(W.length>1||W.length===1&&J(W[0])){const se=W.length>1?"批量删除":"删除节点",ge=`确定要删除选中的 ${W.length} 个元素吗？`;let Pe=!1;Sr.confirm({title:se,content:bn("div",{},[bn("p",ge),bn(x1,{class:"dont-show-again-checkbox",onChange:Le=>{Pe=Le.target.checked}},()=>"不再提示")]),onOk:()=>{Pe&&(l.value=!0,o(s1,!0)),Y()},onCancel:()=>{}})}else Y()},_e=["explain-node","end-node"],rt=W=>{const Y=JSON.parse(JSON.stringify(W));Y.properties.dataRaw=Y.properties.dataRaw||Y.properties.node_params,n("selectNode",Y),!_e.includes(W.type)&&(f.value=Y,d.value=!0)},Me=W=>{f.value.properties=W,V(JSON.parse(JSON.stringify(f.value)))},ve=W=>{f.value.properties.node_name=W,V(JSON.parse(JSON.stringify(f.value))),i.graphModel.eventCenter.emit("custom:setNodeName",{node_name:W,node_id:f.value.id,node_type:f.value.type})},Ve=W=>{n("onDeleteNode",W),f.value&&W.id===f.value.id&&(d.value=!1,setTimeout(()=>{f.value=null},350))},Be=W=>{n("onDeleteEdge",W)},de=()=>{n("runTest")},le=()=>{n("blankClick"),d.value&&(d.value=!1),w.value.length>0&&(w.value=[],i.clearSelectElements())};return Kt(()=>{k()}),g1(()=>{i&&i.destroy()}),e({setData:M,getData:O,updateNode:V}),(W,Y)=>(G(),ue("div",lX,[E("div",{ref_key:"containerRef",ref:h,class:"logic-flow-container"},null,512),H(ze(g),{"flow-id":y.value},null,8,["flow-id"]),ze(i)?(G(),Ue(ZA,{key:0,lf:ze(i),onRunTest:de,onAddNode:I,onZoomChange:S,onAutoLayout:$},null,8,["lf"])):tt("",!0),f.value?(G(),Ue(bB,{key:1,ref_key:"nodeFormDrawerRef",ref:u,open:d.value,"onUpdate:open":Y[0]||(Y[0]=se=>d.value=se),destroyOnClose:!0,"node-id":f.value.id,node:f.value.properties,"node-type":f.value.type,lf:ze(i),onUpdateNode:Me,onChangeTitle:ve},null,8,["open","node-id","node","node-type","lf"])):tt("",!0)]))}},dX={class:"flex-content-box"},cX={class:"test-model-box"},fX={key:2,class:"input-list-box"},hX={class:"add-btn-box"},pX={key:0,class:"result-list-box loading-box"},vX={key:1,class:"result-list-box"},gX=["onClick"],mX={class:"status-block"},yX={class:"icon-name-box"},_X=["src"],bX={class:"node-name"},xX={key:0,class:"time-tag"},wX={class:"right-active-icon"},SX={class:"save-btn-box"},EX={class:"preview-box"},CX={class:"preview-title"},kX={class:"icon-name-box"},OX=["src"],NX={class:"node-name"},MX={key:0,class:"time-tag"},AX={class:"preview-content-block"},TX={class:"title-block"},DX={class:"preview-code-box"},LX={__name:"index",props:{lf:{type:Object},start_node_params:{default:()=>{},type:Object},isLockedByOther:{type:Boolean,default:!1}},emits:["save","getGlobal"],setup(r,{expose:e,emit:t}){const n=r,i=tn(()=>n.start_node_params.diy_global||[]),o=t,a=Vl().query,l=Se(!1),u=Se(""),d=Se([]),f=tn(()=>u.value?d.value.filter(I=>I.node_key==u.value)[0]:null),h=Se(!1),g=Jt({is_draft:!0,robot_key:a.robot_key,question:"",openid:"",global:"",globalState:{}}),y=()=>{if(n.isLockedByOther){Hn.warning("当前已有其他用户在编辑中，无法运行测试");return}o("save","automatic");let I=localStorage.getItem("workflow_run_test_data")||"{}";I=JSON.parse(I),g.question=I.question||"",g.openid=I.openid||"",g.global=I.global||"",d.value=[],u.value="",o("getGlobal"),xn(()=>{i.value.forEach($=>{g.globalState[$.key]=w($)});try{let $=I.global?JSON.parse(I.global):{};for(let ne in g.globalState)$[ne]&&(Array.isArray($[ne])?g.globalState[ne]=$[ne].map(V=>({value:V,key:Math.random()*1e3})):g.globalState[ne]=$[ne])}catch($){}}),l.value=!0};function w(I){return I.typ=="string"||I.typ=="number"?"":[{value:"",key:Math.random()*1e4}]}function x(){let I={};return i.value.forEach($=>{if($.typ=="string"&&(I[$.key]=g.globalState[$.key]),$.typ=="number"&&(I[$.key]=g.globalState[$.key]?+g.globalState[$.key]:""),$.typ=="array<string>"){let ne=g.globalState[$.key].map(V=>V.value).filter(V=>V);I[$.key]=ne}}),JSON.stringify(I)}const b=(I,$)=>{g.globalState[I].splice($,1)},_=I=>{g.globalState[I].push({value:"",key:Math.random()*1e4})},S=Se(null),k=()=>{S.value.validate().then(()=>{let I={...g};I.global=x(),delete I.globalState,h.value=!0,d.value=[],localStorage.setItem("workflow_run_test_data",JSON.stringify({...I})),GE({...I}).then($=>{Hn.success("测试结果生成完成"),O($.data||[])}).catch($=>{d.value=[],$.data&&$.data.length&&O($.data)}).finally(()=>{h.value=!1})})},O=I=>{var $;d.value=I.map(ne=>({...ne,is_success:ne.error_msg==="<nil>",node_icon:O1(ne.node_type)})),u.value=($=d.value[0])==null?void 0:$.node_key},M=I=>{u.value=I.node_key},R=()=>{nC(JSON.stringify(f.value.output)),Hn.success("复制成功")};return e({open:()=>{y()}}),(I,$)=>{const ne=Mv,V=bs,J=kr,D=Yi,U=Di,j=va,fe=Fn,Ee=Ti,_e=Ov,rt=Sr;return G(),ue("div",null,[H(rt,{open:l.value,"onUpdate:open":$[2]||($[2]=Me=>l.value=Me),title:"运行测试",footer:null,width:820,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"600px","padding-right":"24px","overflow-y":"auto"}},{default:q(()=>[E("div",dX,[E("div",cX,[$[9]||($[9]=E("div",{class:"top-title"},"开始节点参数",-1)),H(Ee,{model:g,ref_key:"formRef",ref:S,layout:"vertical","wrapper-col":{span:24},autocomplete:"off"},{default:q(()=>[H(D,{name:"question",rules:[{required:!0,message:"请输入question!"}]},{label:q(()=>[H(V,{gap:4},{default:q(()=>[$[4]||($[4]=$e("question ")),H(ne,{style:{margin:"0"}},{default:q(()=>$[3]||($[3]=[$e("string")])),_:1,__:[3]})]),_:1,__:[4]})]),default:q(()=>[H(J,{placeholder:"请输入",value:g.question,"onUpdate:value":$[0]||($[0]=Me=>g.question=Me)},null,8,["value"])]),_:1}),H(D,{name:"openid",rules:[{required:!0,message:"请输入openid!"}]},{label:q(()=>[H(V,{gap:4},{default:q(()=>[$[6]||($[6]=$e("openid ")),H(ne,{style:{margin:"0"}},{default:q(()=>$[5]||($[5]=[$e("string")])),_:1,__:[5]})]),_:1,__:[6]})]),default:q(()=>[H(J,{placeholder:"请输入",value:g.openid,"onUpdate:value":$[1]||($[1]=Me=>g.openid=Me)},null,8,["value"])]),_:1}),(G(!0),ue(st,null,mt(i.value,Me=>(G(),Ue(D,{name:["globalState",Me.key],key:Me.key,rules:[{required:Me.required,message:`请输入${Me.key}`}]},{label:q(()=>[H(V,{gap:4},{default:q(()=>[$e(Ne(Me.key)+" ",1),H(ne,{style:{margin:"0"}},{default:q(()=>[$e(Ne(Me.typ),1)]),_:2},1024)]),_:2},1024)]),default:q(()=>[Me.typ=="string"?(G(),Ue(J,{key:0,placeholder:"请输入",value:g.globalState[Me.key],"onUpdate:value":ve=>g.globalState[Me.key]=ve},null,8,["value","onUpdate:value"])):tt("",!0),Me.typ=="number"?(G(),Ue(U,{key:1,style:{width:"100%"},placeholder:"请输入",value:g.globalState[Me.key],"onUpdate:value":ve=>g.globalState[Me.key]=ve},null,8,["value","onUpdate:value"])):tt("",!0),Me.typ=="array<string>"?(G(),ue("div",fX,[(G(!0),ue(st,null,mt(g.globalState[Me.key],(ve,Ve)=>(G(),ue("div",{class:"input-list-item",key:Ve},[H(j,null,{default:q(()=>[H(J,{placeholder:"请输入",value:ve.value,"onUpdate:value":Be=>ve.value=Be},null,8,["value","onUpdate:value"])]),_:2},1024),g.globalState[Me.key].length>1?(G(),Ue(ze(gr),{key:0,onClick:Be=>b(Me.key,Ve)},null,8,["onClick"])):tt("",!0)]))),128)),E("div",hX,[H(fe,{onClick:ve=>_(Me.key),block:"",type:"dashed"},{default:q(()=>$[7]||($[7]=[$e("添加")])),_:2,__:[7]},1032,["onClick"])])])):tt("",!0)]),_:2},1032,["name","rules"]))),128))]),_:1},8,["model"]),h.value?(G(),ue("div",pX,[h.value?(G(),Ue(_e,{key:0,tip:"测试结果生成中..."})):tt("",!0)])):tt("",!0),d.value.length>0?(G(),ue("div",vX,[(G(!0),ue(st,null,mt(d.value,(Me,ve)=>(G(),ue("div",{class:gn(["list-item-block",{active:u.value==Me.node_key}]),onClick:Ve=>M(Me),key:ve},[E("div",mX,[Me.is_success?(G(),Ue(ze(k1),{key:0,style:{color:"#138b1b"}})):(G(),Ue(ze(LC),{key:1,style:{color:"#d81e06"}}))]),E("div",yX,[E("img",{src:Me.node_icon,alt:""},null,8,_X),E("div",bX,Ne(Me.node_name),1)]),Me.is_success?(G(),ue("div",xX,Ne(Me.use_time)+"ms",1)):tt("",!0),E("div",wX,[H(ze(PC))])],10,gX))),128))])):tt("",!0),E("div",SX,[H(fe,{loading:h.value,onClick:k,style:{"background-color":"#00ad3a"},type:"primary"},{default:q(()=>[H(ze(m1)),$[8]||($[8]=$e("运行测试"))]),_:1,__:[8]},8,["loading"])])]),E("div",EX,[f.value?(G(),ue(st,{key:0},[E("div",CX,[$[10]||($[10]=E("div",{class:"title-text"},"日志详情",-1)),E("div",kX,[E("img",{src:f.value.node_icon,alt:""},null,8,OX),E("div",NX,Ne(f.value.node_name),1)]),f.value.is_success?(G(),ue("div",MX,Ne(f.value.use_time)+"ms",1)):tt("",!0)]),E("div",AX,[E("div",TX,[$[11]||($[11]=$e("运行日志")),H(ze(RC),{onClick:R})]),E("div",DX,[H(ze(GN),{data:f.value.output},null,8,["data"])])])],64)):tt("",!0)])])]),_:1},8,["open"])])}}},PX=xt(LX,[["__scopeId","data-v-eb3e0659"]]),RX={class:"page-header"},IX={class:"header-content"},BX={key:1,class:"robot-status-box status-0"},jX={key:0,class:"header-right"},HX={key:0,class:"last-save-time"},$X={key:0,class:"auto-save-hint"},FX={style:{display:"flex","align-items":"center",gap:"8px"}},zX={class:"lock-config"},WX={style:{"margin-top":"24px","text-align":"right"}},UX={key:1,class:"lock-tip"},VX={class:"lock-info"},qX={__name:"page-header",props:{saveLoading:{default:!1,type:Boolean},showRight:{default:!0,type:Boolean},start_node_params:{default:()=>({}),type:Object},currentVersion:{default:"",type:String},isEditing:{default:!0,type:Boolean},isLockedByOther:{default:!1,type:Boolean},lockRemoteAddr:{default:"",type:String},lockUserAgent:{default:"",type:String},loginUserName:{default:"",type:String},autoSaveEnabled:{default:!0,type:Boolean},isLeader:{default:!0,type:Boolean}},emits:["save","release","edit","getGlobal","getVersionRecord"],setup(r,{expose:e,emit:t}){const n=Yr(),i=tn(()=>n.robotInfo),o=t,a=r,l=Se(null),u=rC(),d=tn(()=>{var I;const T=(I=u.userInfo)==null?void 0:I.role_type;return T==1||T==2}),f=Se(!1),h=Se(10),g=Se(!1),y=async()=>{g.value=!0;try{await KE({draft_exptime:h.value}),Hn.success("编辑锁设置已保存"),f.value=!1}catch{Hn.error("保存失败，请稍后重试")}finally{g.value=!1}};Kt(async()=>{var T;try{const I=await YE(),$=+((T=I==null?void 0:I.data)==null?void 0:T.draft_exptime);typeof $=="number"&&(h.value=Math.max(10,Math.min(60,Math.round($))))}catch{}});const w=()=>{},x=()=>{o("edit")},b=(T="handle")=>{o("save",T)},_=()=>{o("release")},S=()=>{o("getGlobal")},k=()=>{o("getVersionRecord")},O=()=>{o("edit")},M=()=>{l.value.open()};function R(T,I="YY-MM-DD HH:mm:ss"){return!T||T<=0?"--":qa(T*1e3).format(I)}return e({openRunTest:M}),(T,I)=>{const $=Fn,ne=Ai,V=jr,J=Di,D=wv;return G(),ue("div",RX,[E("div",IX,[H(BM),i.value.start_node_key!=""?(G(),ue("div",{key:0,class:"robot-status-box status-1",onClick:x},[H(ze(k1),{class:"robot-status-icon"}),I[6]||(I[6]=E("div",{class:"robot-status-text"},"已发布",-1))])):(G(),ue("div",BX,[H(ze(IC),{class:"robot-status-icon"}),I[7]||(I[7]=E("div",{class:"robot-status-text"},"未发布",-1))]))]),a.showRight?(G(),ue("div",jX,[r.currentVersion==""&&r.isEditing?(G(),ue(st,{key:0},[i.value.draft_save_time&&i.value.draft_save_time!=0?(G(),ue("div",HX,[$e(Ne(R(i.value.draft_save_time,"MM/DD HH:mm:ss"))+" "+Ne(i.value.draft_save_type=="handle"?"手动":"自动")+"保存草稿 ",1),r.isEditing&&!r.isLockedByOther&&(!r.autoSaveEnabled||!r.isLeader)?(G(),ue("span",$X,"你可能已在其他页面编辑，已停止自动保存")):tt("",!0)])):tt("",!0),r.isLockedByOther?tt("",!0):(G(),ue(st,{key:1},[H($,{class:"save-draft",onClick:I[0]||(I[0]=U=>b("handle"))},{default:q(()=>I[8]||(I[8]=[$e("保存草稿")])),_:1,__:[8]}),H($,{type:"primary",loading:a.saveLoading,class:"publish-robot",onClick:_},{default:q(()=>I[9]||(I[9]=[$e("发布机器人")])),_:1,__:[9]},8,["loading"])],64))],64)):tt("",!0),!r.isEditing&&!r.currentVersion||r.isLockedByOther?(G(),Ue($,{key:1,disabled:r.isLockedByOther,type:"primary",class:"ml8",onClick:O},{icon:q(()=>[H(ze(Nv))]),default:q(()=>[I[10]||(I[10]=$e(" 编辑 "))]),_:1,__:[10]},8,["disabled"])):tt("",!0),H(ne,{title:"历史发布详情"},{default:q(()=>[H($,{onClick:I[1]||(I[1]=U=>k())},{default:q(()=>[H(ze(BC))]),_:1})]),_:1}),d.value?(G(),Ue(D,{key:2,trigger:"click",placement:"bottomRight",open:f.value,"onUpdate:open":I[5]||(I[5]=U=>f.value=U),"overlay-style":{width:"372px",padding:"16px"},"overlay-class-name":"popover-material",onOnOpenChange:w},{title:q(()=>[E("div",FX,[H(V,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px",color:"#262626"}}),I[11]||(I[11]=E("span",{style:{color:"#262626"}},"编辑锁设置",-1)),I[12]||(I[12]=E("span",{style:{color:"#8c8c8c","font-weight":"normal"}},"不同的IP和UserAgent都会限制",-1))])]),content:q(()=>[E("div",zX,[I[13]||(I[13]=E("span",{style:{color:"#595959"}},"编辑结束后锁",-1)),H(J,{value:h.value,"onUpdate:value":I[2]||(I[2]=U=>h.value=U),min:10,max:60,precision:0,style:{margin:"0 4px",width:"86px"}},null,8,["value"]),I[14]||(I[14]=E("span",{style:{color:"#595959"}},"分钟后才能编辑",-1))]),E("div",WX,[H($,{class:"ml8",onClick:I[3]||(I[3]=U=>f.value=!1)},{default:q(()=>I[15]||(I[15]=[$e("取 消")])),_:1,__:[15]}),H($,{type:"primary",class:"ml8",loading:g.value,onClick:y},{default:q(()=>I[16]||(I[16]=[$e("保 存")])),_:1,__:[16]},8,["loading"])])]),default:q(()=>[H($,{class:"",onClick:I[4]||(I[4]=U=>f.value=!0),style:{padding:"5px 9px"}},{default:q(()=>[H(V,{class:"lock-icon",name:"lock-icon",style:{"font-size":"14px"}})]),_:1})]),_:1},8,["open"])):tt("",!0)])):tt("",!0),r.isLockedByOther?(G(),ue("div",UX,[I[17]||(I[17]=E("div",null,"当前已有用户正在编辑中，无法编辑保存草稿或发布工作流",-1)),E("div",VX,"（"+Ne("用户："+r.loginUserName||"--")+" "+Ne("IP："+r.lockRemoteAddr||"--")+" "+Ne("User Agent："+r.lockUserAgent||"--")+"）",1)])):tt("",!0),H(PX,{ref_key:"runTestRef",ref:l,start_node_params:r.start_node_params,onGetGlobal:S,onSave:b,isLockedByOther:r.isLockedByOther},null,8,["start_node_params","isLockedByOther"])])}}},XX=xt(qX,[["__scopeId","data-v-d4328ace"]]),GX={class:"form-box"},YX={class:"form-item"},KX={class:"form-content"},JX={class:"version-input-box"},ZX={class:"form-item"},QX={class:"form-content"},eG={__name:"version-model",emits:["ok"],setup(r,{expose:e,emit:t}){const n=Vl().query,i=Se(!1);let o="";const a=Yr(),l=Se(""),u=Se(""),d=Se(""),f=Se(""),h=Se(!1),g=t,y=b=>{x(),f.value="",o=b,i.value=!0},w=()=>{h.value=!0,ZE({robot_key:n.robot_key,node_list:o,version:`${l.value}.${u.value}.${d.value}`,version_desc:f.value,draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}).then(async b=>{await a.getRobot(n.id);const _=+a.robotInfo.draft_save_time||0;a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:_}),i.value=!1,b&&b.res==0&&(Hn.success("发布成功"),g("ok"))}).finally(()=>{h.value=!1})},x=()=>{JE({robot_key:n.robot_key}).then(b=>{let _=b.data.version_params||[];l.value=_[0],u.value=_[1],d.value=_[2]})};return e({show:y}),(b,_)=>{const S=Di,k=dc,O=Sr;return G(),ue("div",null,[H(O,{open:i.value,"onUpdate:open":_[4]||(_[4]=M=>i.value=M),title:"发布","ok-text":"立即发布",onOk:w,confirmLoading:h.value,width:600},{default:q(()=>[E("div",GX,[E("div",YX,[_[8]||(_[8]=E("div",{class:"form-label"},"版本号：",-1)),E("div",KX,[E("div",JX,[_[5]||(_[5]=$e(" v ")),H(S,{value:l.value,"onUpdate:value":_[0]||(_[0]=M=>l.value=M),precision:0,min:0,max:1e3},null,8,["value"]),_[6]||(_[6]=E("span",null,".",-1)),H(S,{value:u.value,"onUpdate:value":_[1]||(_[1]=M=>u.value=M),precision:0,min:0,max:1e3},null,8,["value"]),_[7]||(_[7]=E("span",null,".",-1)),H(S,{value:d.value,"onUpdate:value":_[2]||(_[2]=M=>d.value=M),precision:0,min:0,max:1e3},null,8,["value"])])])]),E("div",ZX,[_[9]||(_[9]=E("div",{class:"form-label"},"版本描述：",-1)),E("div",QX,[H(k,{value:f.value,"onUpdate:value":_[3]||(_[3]=M=>f.value=M),placeholder:"请描述本次发布版本的更新内容","auto-size":{minRows:4,maxRows:7}},null,8,["value"])])])])]),_:1},8,["open","confirmLoading"])])}}},tG=xt(eG,[["__scopeId","data-v-72e384f1"]]),nG={class:"version-detail"},rG={class:"version-desc flex-center"},iG={class:"version-file-box"},oG={class:"version-text"},aG={class:"version-text"},sG=["onClick"],lG={class:"version-header"},uG={class:"version-title"},dG={class:"time-text flex-center"},cG={class:"version-file-box"},fG={class:"version-text"},hG={class:"version-text"},pG={class:"version-desc"},vG={__name:"publish-detail",props:{isLockedByOther:{type:Boolean,default:!1}},emits:["setVersion","preview"],setup(r,{expose:e,emit:t}){const n=Vl().query,i=Se(!1),o=Se(""),a=Se(""),l=t,u=r,d=Yr(),f=tn(()=>d.robotInfo),h=Se([]),g=()=>{i.value=!0,y(),bp({robot_key:n.robot_key}).then(_=>{const S=(_==null?void 0:_.data)||{};o.value=S.remote_addr||"",a.value=S.user_agent||""})},y=()=>{QE({robot_key:n.robot_key}).then(_=>{h.value=_.data.versions||[]})},w=_=>{Sr.confirm({title:`确定要恢复到v${_.version}版吗`,icon:null,content:bn("div",{style:"color:red;"},"恢复后，将覆盖当前草稿内容。如需要将此版本作为发布版本，需要您手动点击发布"),onOk(){oy({robot_key:n.robot_key,version_id:_.version_id}).then(S=>{l("setVersion",S.data),i.value=!1,S.res==0&&Hn.success("设置成功")})},onCancel(){}})},x=_=>{_==""?f1({robot_key:n.robot_key,data_type:1}).then(S=>{l("preview",S.data,_),i.value=!1}):oy({robot_key:n.robot_key,version_id:_}).then(S=>{l("preview",S.data,_),i.value=!1})};function b(_,S="YYYY-MM-DD HH:mm:ss"){return _<=0?"--":qa(_*1e3).format(S)}return e({showDrawer:g}),(_,S)=>{const k=jr,O=wv,M=Ev,R=Sv,T=Cv,I=HC;return G(),ue("div",null,[H(I,{open:i.value,"onUpdate:open":S[2]||(S[2]=$=>i.value=$),title:"发布详情",placement:"right",width:400,bodyStyle:{padding:"12px 24px"}},{default:q(()=>[E("div",nG,[f.value.draft_save_time&&f.value.draft_save_time!=0?(G(),ue("div",{key:0,class:"version-list",onClick:S[0]||(S[0]=$=>x(""))},[S[3]||(S[3]=E("div",{class:"version-header"},[E("div",{class:"version-title"},"当前最新草稿")],-1)),E("div",rG,[$e(" 最近保存于"+Ne(b(f.value.draft_save_time,"MM/DD HH:mm:ss"))+" ",1),E("div",iG,[H(O,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:q(()=>[E("div",oG," IP："+Ne(o.value||"--"),1),E("div",aG," User Agent："+Ne(a.value||"--"),1)]),default:q(()=>[H(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:1})])])])):tt("",!0),(G(!0),ue(st,null,mt(h.value,($,ne)=>(G(),ue("div",{class:"version-list",onClick:V=>x($.version_id),key:$.version},[E("div",lG,[E("div",uG,[$e(" v"+Ne($.version)+" ",1),E("span",dG,[$e(Ne(b($.create_time))+" ",1),E("div",cG,[H(O,{placement:"topRight","overlay-style":{"max-width":"372px"}},{content:q(()=>[E("div",fG," IP："+Ne($.last_edit_ip||"--"),1),E("div",hG," User Agent："+Ne($.last_edit_user_agent||"--"),1)]),default:q(()=>[H(k,{class:"file-icon",name:"file-icon",style:{"font-size":"14px",color:"#333"}})]),_:2},1024)])])]),H(T,null,{overlay:q(()=>[H(R,null,{default:q(()=>[H(M,{disabled:u.isLockedByOther,onClick:V=>w($)},{default:q(()=>S[4]||(S[4]=[$e(" 恢复到此版本 ")])),_:2,__:[4]},1032,["disabled","onClick"])]),_:2},1024)]),default:q(()=>[E("div",{class:"hover-btn-box",onClick:S[1]||(S[1]=dn(()=>{},["stop"]))},[H(ze(jC))])]),_:2},1024)]),E("div",pG,Ne($.version_desc),1)],8,sG))),128))])]),_:1},8,["open"])])}}},gG=xt(vG,[["__scopeId","data-v-aa2afdc4"]]),mG={class:"workflow-page"},yG={class:"page-body"},_G={class:"page-left"},bG={class:"page-container"},xG=5*60*1e3,l1=60*1e3,wG=20*1e3,u1="wf_autosave_leader_",d1=2*60*1e3,c1="当前草稿已经不是最新的草稿版本，保存后会覆盖，确认保存么？",SG={__name:"index",setup(r){const e=Vl(),t=e.query,n=Se(e.query.robot_key),i=Se(null),o=Se(null),a=Yr(),l=Se(""),u=Se(""),d=Se(null),f=YN(),h=Se(!0),g=Se(!1),y=Se(!0);let w=null,x=null,b=Date.now(),_="";const S=Se(""),k=Se(""),O=Se(""),M=Se(!1),R=`${Date.now()}_${Math.random()}`;let T=null;const I=()=>`${u1}${n.value}`,$=()=>`wf_open_tabs_${n.value}`;function ne(){try{const Fe=parseInt(localStorage.getItem($())||"0",10)||0;localStorage.setItem($(),String(Fe+1))}catch(Fe){console.warn("incrementOpenTabs error",Fe)}}function V(){try{const Fe=parseInt(localStorage.getItem($())||"0",10)||0,Re=Math.max(0,Fe-1);Re<=0?setTimeout(()=>{localStorage.removeItem($()),localStorage.removeItem(I())},0):localStorage.setItem($(),String(Re))}catch(Fe){console.warn("decrementOpenTabs error",Fe)}}function J(){try{const Fe=Date.now();for(let Re=0;Re<localStorage.length;Re++){const vt=localStorage.key(Re);if(vt&&vt.startsWith(u1)){const Ye=localStorage.getItem(vt);let Qe=null;try{Qe=Ye?JSON.parse(Ye):null}catch{Qe=null}(!Qe||typeof Qe.ts!="number"||Fe-Qe.ts>l1)&&localStorage.removeItem(vt)}}}catch(Fe){console.warn("cleanupExpiredLeaderKeys error",Fe)}}function D(){try{const Fe=localStorage.getItem(I());return Fe?JSON.parse(Fe):null}catch{return null}}function U(){localStorage.setItem(I(),JSON.stringify({tabId:R,ts:Date.now()}))}function j(){const Fe=D();return!Fe||Date.now()-Fe.ts>l1?(U(),!0):Fe.tabId===R}function fe(){const Fe=D();Fe&&Fe.tabId===R&&localStorage.removeItem(I())}function Ee(Fe){try{const Re=localStorage.getItem(Fe),vt=Re?JSON.parse(Re):null;vt&&vt.tabId===R&&localStorage.removeItem(Fe)}catch{}}function _e(Fe){Fe.key===I()&&(F(),J(),M.value=j())}function rt(){document.visibilityState==="visible"&&(M.value=j()),J(),F()}function Me(){ve(),J(),M.value=j(),T=setInterval(()=>{const Fe=j();M.value=Fe,Fe&&localStorage.setItem(I(),JSON.stringify({tabId:R,ts:Date.now()}))},wG),window.addEventListener("storage",_e),document.addEventListener("visibilitychange",rt),window.addEventListener("beforeunload",()=>{fe(),V()}),window.addEventListener("pagehide",()=>{fe(),V()})}function ve(){T&&clearInterval(T),T=null,window.removeEventListener("storage",_e),document.removeEventListener("visibilitychange",rt),window.removeEventListener("beforeunload",fe)}function Ve(){try{const Fe=ft();return JSON.stringify(Fe)}catch{return""}}function Be(){de(),_=Ve(),b=Date.now(),x=setInterval(()=>{if(!h.value)return;const Fe=Ve();Fe&&Fe!==_&&(_=Fe,b=Date.now(),le())},2*1e3)}function de(){x&&clearInterval(x),x=null}function le(){try{if(!h.value||g.value)return;(!y.value||!j())&&(U(),y.value=!0),F()}catch{}}function W(){Y(),w=setInterval(()=>{h.value&&y.value&&Date.now()-b>=xG&&(y.value=!1,Hn.warning("已超过5分钟无改动，自动保存已暂停"),F())},30*1e3)}function Y(){w&&clearInterval(w),w=null}async function se(){try{const Fe=await bp({robot_key:n.value}),Re=(Fe==null?void 0:Fe.data)||{};g.value=!Re.lock_res,S.value=Re.remote_addr||"",k.value=Re.user_agent||"",O.value=Re.login_user_name||"",F()}catch{g.value=!1}}async function ge(){try{const Fe=await bp({robot_key:n.value}),Re=(Fe==null?void 0:Fe.data)||{};return Re.lock_res?(g.value=!1,S.value="",k.value="",O.value="",!0):(g.value=!Re.lock_res,S.value=Re.remote_addr||"",k.value=Re.user_agent||"",O.value=Re.login_user_name||"",!1)}catch{return g.value=!1,!0}}function Pe(Fe){Fe=Fe||[];let Re=[],vt=[];Fe.forEach(Ye=>{if(Ye.node_type==0){let Qe=JSON.parse(Ye.node_info_json);Qe.type=="custom-edge"&&(Qe.pointsList=[],Qe.type="custom-bezier-edge"),vt.push(Qe)}else{const Qe=f[Ye.node_type];if(Ye.type=Qe,Ye.node_type==1){let St=JSON.parse(Ye.node_params);St.start||(St.start=[]),Ye.node_params=JSON.stringify(St)}let nt=JSON.parse(Ye.node_info_json);Ye.node_type!=0&&(nt.type=f[Ye.node_type],nt.id=Ye.node_key||Ul(nt.type),nt.x=nt.x||0,nt.y=nt.y||0),Ye.node_type==-1&&(Ye.node_params=nt.dataRaw),nt.nodeSortKey?Ye.nodeSortKey=nt.nodeSortKey:Ye.nodeSortKey=nt.id.substring(0,8)+nt.id.substring(nt.id.length-8),Ye.dataRaw=nt.dataRaw||Ye.node_params,delete Ye.node_info_json,nt.properties=Ye,nt.properties.width=nt.width,nt.properties.height=nt.height,Re.push(nt)}}),He({nodes:Re,edges:vt})}const Le=Fe=>{i.value.open(Fe,!0)},He=Fe=>{o.value.setData(Fe)},ft=()=>{let Fe=o.value.getData(),Re=[],vt={};return Fe.edges.forEach(Ye=>{let Qe={node_key:Ye.id,node_name:"edge",node_type:0},nt={...Ye};Qe.node_info_json=nt,Re.push(Qe),Ye.sourceAnchorId&&(vt[Ye.sourceAnchorId]=Ye.targetNodeId),Ye.targetAnchorId&&(vt[Ye.targetAnchorId]=Ye.sourceNodeId)}),Fe.nodes.forEach(Ye=>{let Qe={...Ye.properties,node_type:+Ye.properties.node_type,node_key:Ye.id};Qe.node_info_json={type:Ye.type,x:Ye.x,y:Ye.y,width:Ye.properties.width,height:Ye.properties.height,id:Ye.id,nodeSortKey:Qe.nodeSortKey,dataRaw:Ye.properties.node_params},Qe.next_node_key=vt[Qe.nodeSortKey+"-anchor_right"]||"",Qe.prev_node_key=vt[Qe.nodeSortKey+"-anchor_left"]||"";let nt=JSON.parse(Qe.node_params);if(Qe.node_type==2&&nt.term&&nt.term.length>0&&nt.term.forEach((St,xe)=>{let qe=Qe.nodeSortKey+"-anchor_"+xe;St.next_node_key=vt[qe]||""}),Qe.node_type==3&&nt.cate&&nt.cate.categorys&&nt.cate.categorys.length>0&&nt.cate.categorys.forEach((St,xe)=>{let qe=Qe.nodeSortKey+"-anchor_"+xe;St.next_node_key=vt[qe]||""}),Qe.node_type==17){let St=vt[Qe.nodeSortKey+"-anchor_right_exception"];St&&(nt.code_run.exception=St)}Qe.node_params=nt,delete Qe.dataRaw,Re.push(Qe)}),Re},Ke=async Fe=>{if(g.value){Fe==="handle"&&Hn.warning("当前已有其他用户在编辑中，无法保存");return}if(!h.value||!y.value&&Fe==="automatic")return;let Re=ft();if(Fe==="handle"){const vt=+a.robotInfo.draft_save_time||0,Ye={robot_key:n.value,data_type:1,node_list:JSON.stringify(Re),draft_save_type:"handle",draft_save_time:vt,re_cover_save:0},Qe=await te(Ye,!1);Qe.saved?Hn.success("保存成功"):Qe.behind;return}try{await Go({robot_key:n.value,data_type:1,node_list:JSON.stringify(Re),draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id);const vt=+a.robotInfo.draft_save_time||qa().unix();a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:vt})}catch{}};let Nt=null,yt=!1,Wt=!1,Ft=0;async function te(Fe,Re){var vt,Ye;try{const Qe=await Go(Fe);if(!(((vt=Qe==null?void 0:Qe.data)==null?void 0:vt.behind_draft)==1||(Qe==null?void 0:Qe.behind_draft)==1)){await a.getRobot(t.id);const St=+a.robotInfo.draft_save_time||qa().unix();return a.setDrafSaveTime({draft_save_type:Re?"automatic":"handle",draft_save_time:St}),{saved:!0,behind:!1}}if(Re){const St=Date.now();if(yt||Wt&&St-Ft<d1)return y.value=!1,F(),{saved:!1,behind:!0};yt=!0,Wt=!0,Ft=St}return await new Promise(St=>{Sr.confirm({title:"提示",icon:null,content:c1,okText:"确 定",cancelText:"取 消",async onOk(){var gt;const xe={...Fe,re_cover_save:1},qe=await Go(xe);if(qe&&qe.res==0||!((gt=qe==null?void 0:qe.data)!=null&&gt.behind_draft)){await a.getRobot(t.id);const Et=+a.robotInfo.draft_save_time||qa().unix();a.setDrafSaveTime({draft_save_type:Re?"automatic":"handle",draft_save_time:Et})}Re&&(y.value=!0,F(),yt=!1,Wt=!1,Ft=Date.now()),St({saved:!0,behind:!0})},onCancel(){Re&&(y.value=!1,F(),yt=!1,Ft=Date.now()),St({saved:!1,behind:!0})}})})}catch(Qe){if(!(((Ye=Qe==null?void 0:Qe.data)==null?void 0:Ye.behind_draft)==1||(Qe==null?void 0:Qe.behind_draft)==1))return{saved:!1,behind:!1};if(Re){const St=Date.now();if(yt||Wt&&St-Ft<d1)return y.value=!1,F(),{saved:!1,behind:!0};yt=!0,Wt=!0,Ft=St}return await new Promise(St=>{Sr.confirm({title:"提示",icon:null,content:c1,okText:"确 定",cancelText:"取 消",async onOk(){var gt;const xe={...Fe,re_cover_save:1},qe=await Go(xe);if(qe&&qe.res==0||!((gt=qe==null?void 0:qe.data)!=null&&gt.behind_draft)){await a.getRobot(t.id);const Et=+a.robotInfo.draft_save_time||qa().unix();a.setDrafSaveTime({draft_save_type:Re?"automatic":"handle",draft_save_time:Et})}Re&&(y.value=!0,F(),yt=!1,Wt=!1,Ft=Date.now()),St({saved:!0,behind:!0})},onCancel(){Re&&(y.value=!1,F(),yt=!1,Ft=Date.now()),St({saved:!1,behind:!0})}})})}}async function A(){if(g.value||!h.value||!y.value)return;const Fe=ft(),Re=+a.robotInfo.draft_save_time||0,vt={robot_key:n.value,data_type:1,node_list:JSON.stringify(Fe),draft_save_type:"automatic",draft_save_time:Re,re_cover_save:0};await te(vt,!0)}function F(){Nt&&clearInterval(Nt),Nt=null,M.value=j(),h.value&&y.value&&!g.value&&j()&&(Nt=setInterval(()=>{A()},1*60*1e3))}g1(()=>{Nt&&clearInterval(Nt),Y(),de(),ve(),fe(),V()});const ee=Se(null),K=Se(!1),oe=Fe=>{ee.value.show(Fe)},ie=async()=>{if(g.value){Hn.warning("当前已有其他用户在编辑中，无法发布");return}let Fe=ft(),Re=[];for(let vt=0;vt<Fe.length;vt++){let Ye=Fe[vt];Ye.node_type==0||Ye.node_type==-1||(Ye.node_type==1?Ye.next_node_key==""&&Re.push(Ye):Ye.node_type==7||Ye.node_type==3?Ye.prev_node_key==""&&Re.push(Ye):(Ye.next_node_key==""||Ye.prev_node_key=="")&&Re.push(Ye))}if(Re.length>0){Hn.error("存在未关联的节点，请先关联");return}try{await Go({robot_key:n.value,data_type:1,node_list:JSON.stringify(Fe),draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id),a.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}),oe(JSON.stringify(Fe))}catch{K.value=!1}};let ce=Se(null);const Ce=Fe=>{ce.value=Fe,Fe.properties.node_sub_type!=51&&le()},ke=()=>{le()},je=async()=>{let Fe=(Re,vt,Ye)=>{const Qe=new Set(Re.map(nt=>nt.model_define));return vt.filter(nt=>{let St=nt[Ye];Qe.has(St)&&Re.filter(xe=>{if(xe.model_define==St)return xe.children=oC(xe.children,nt.children),!1})}),Re};return M1({model_type:"LLM"}).then(Re=>{let vt=Re.data||[],Ye=[],Qe=[];Qe=vt.map(nt=>{Ye=[];for(let St=0;St<nt.model_info.llm_model_list.length;St++){const xe=nt.model_info.llm_model_list[St];Ye.push({name:xe,deployment_name:nt.model_config.deployment_name,id:nt.model_config.id,model_define:nt.model_info.model_define})}return{id:nt.model_config.id,name:nt.model_info.model_name,model_define:nt.model_info.model_define,icon:nt.model_info.model_icon_url,children:Ye,deployment_name:nt.model_config.deployment_name}}),Qe=Fe(iC(Qe,"model_define"),Qe,"model_define"),a.setModelList(Qe)})},Ze=Se({diy_global:[],sys_global:[]}),ct=()=>{let Re=ft().filter(vt=>vt.node_type==1);Re.length>0&&(Ze.value=Re[0].node_params.start)},pt=Se(null),Rt=()=>{y.value=!1,F(),pt.value.showDrawer()},Je=Fe=>{if(g.value){Hn.warning("当前已有其他用户在编辑中，无法恢复");return}const Re=ft();Go({robot_key:n.value,data_type:1,node_list:JSON.stringify(Re),draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0}).then(()=>{a.getRobot(t.id).then(()=>{a.setDrafSaveTime({draft_save_type:"handle",draft_save_time:+a.robotInfo.draft_save_time||0})}),l.value="",u.value=null,Pe(Fe),Hn.success("已保存当前草稿并恢复版本"),h.value=!0,y.value=!0,F()})},dt=async(Fe,Re)=>{if(!g.value){const vt=ft();try{await Go({robot_key:n.value,data_type:1,node_list:JSON.stringify(vt),draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0}),await a.getRobot(t.id),a.setDrafSaveTime({draft_save_type:"automatic",draft_save_time:+a.robotInfo.draft_save_time||0})}catch{}}u.value=Re,clearInterval(Nt),Pe(Fe)},It=()=>{d.value.openRunTest()};Kt(async()=>{ne(),await je();const Fe=await f1({robot_key:n.value,data_type:1});Pe(Fe.data),await se(),g.value?(h.value=!1,y.value=!1,Hn.warning("其他人在编辑，已切换为查看模式")):await ge()?(h.value=!0,y.value=!0):(h.value=!1,y.value=!1),Me(),F();let Re=I();Qt(()=>e.query.robot_key,vt=>{!vt||vt===n.value||(Ee(Re),V(),n.value=vt,Re=I(),ne(),Me(),F())}),W(),Be(),e.query.show_tips&&Hn.info("按住Shift 滚动鼠标可左右移动画布，按住Ctrl 滚动鼠标可放大缩小画布",6)});const at=async()=>{if(g.value){Hn.warning("当前已有其他用户在编辑中，无法编辑");return}await ge()&&(h.value=!0,y.value=!0,_=Ve(),b=Date.now(),Be(),F(),Hn.success("已进入编辑模式"),Le(1))};return(Fe,Re)=>(G(),ue("div",mG,[H(XX,{ref_key:"pageHeaderRef",ref:d,onEdit:at,onSave:Ke,onRelease:ie,onGetGlobal:ct,onGetVersionRecord:Rt,currentVersion:u.value,start_node_params:Ze.value,saveLoading:K.value,isEditing:h.value,isLockedByOther:g.value,lockRemoteAddr:S.value,lockUserAgent:k.value,loginUserName:O.value,autoSaveEnabled:y.value,isLeader:M.value},null,8,["currentVersion","start_node_params","saveLoading","isEditing","isLockedByOther","lockRemoteAddr","lockUserAgent","loginUserName","autoSaveEnabled","isLeader"]),E("div",yG,[E("div",_G,[H(VM)]),E("div",bG,[H(uX,{ref_key:"workflowCanvasRef",ref:o,onSelectedNode:Ce,onOnDeleteNode:ke,onRunTest:It},null,512)])]),H(jM,{ref_key:"addRobotAlertRef",ref:i},null,512),H(tG,{ref_key:"versionModelRef",ref:ee},null,512),H(gG,{ref_key:"publishDetailRef",ref:pt,onPreview:dt,onSetVersion:Je,isLockedByOther:g.value},null,8,["isLockedByOther"])]))}},IY=xt(SG,[["__scopeId","data-v-de3cad3b"]]);export{IY as default};
