import{_ as Q}from"./empty-BFmzY9bl.js";import{d as H}from"./vuedraggable.umd-BzpNiY3c.js";import{c as K,e as X,r as Y,f as Z,h as ee}from"./index-BNO9ztvM.js";import{_ as V,b as F,a3 as te,a as ae,a4 as se}from"../../index-DxV-PNCd.js";import{ai as oe,a9 as ne,T as le,ar as ie,h as ce,i as pe,k as re,I as N,o as _e,e as de,F as ue,B as W,M as j,b as E,a6 as me,al as ve,W as fe}from"./ui-antd-AfNpv4wx.js";import{ac as x,ad as m,as as t,az as B,k as o,at as n,u as a,F as he,ae as C,G as I,ar as p,f as $,r as D,e as ge,J as ye,o as be}from"./vue-chunks-CGLjTDrY.js";import{u as ke}from"./index-DwtbXc27.js";import{C as xe}from"./cu-upload-CiYxFes3.js";import"./vue-pdf-embed-CiRf6fZ3.js";import"./neo4j-L2Hgpmga.js";import"./utils-COBjqVvs.js";import"./other-BrZCAsTs.js";const we={class:"wechat-app-item"},Ce={class:"item-body"},$e=["src"],Ie={class:"app-info"},Se={class:"app-name"},Ae={class:"app-desc"},Be={class:"ext-info-list"},Ee={class:"ext-content"},Oe={class:"ext-info-list"},Te={key:0,class:"status-block status-success"},Me={class:"status-block status-warning"},Ue={class:"btn-wrapper-box"},Ve={style:{color:"#fb363f"}},Fe={__name:"wechat-app-item",props:{item:{type:Object,default:()=>({})},app_type:{type:String,default:""}},emits:["edit","delete","refresh"],setup(y,{emit:v}){const{t:d}=F("views.user.official-account.components.wechat-app-item"),e=v,w=["mini_program","official_account"],r=y;function i(){e("edit",{...r.item})}function k(){e("delete",{...r.item})}function f(){e("refresh",{...r.item})}return(O,l)=>{const u=le,_=pe,b=ce,h=re;return m(),x("div",we,[t("div",Ce,[t("img",{class:"app-avatar",src:y.item.app_avatar,alt:""},null,8,$e),t("div",Ie,[t("div",Se,n(y.item.app_name),1),t("div",Ae,n(a(d)("app_id_label"))+n(y.item.app_id),1)])]),w.includes(r.app_type)?(m(),x(he,{key:0},[t("div",Be,[t("div",Ee,n(y.item.wechat_reply_type),1)]),t("div",Oe,[y.item.account_is_verify=="true"?(m(),x("div",Te,[o(a(oe)),I(" "+n(a(d)("verified")),1)])):(m(),C(u,{key:1,gap:8},{default:p(()=>[t("div",Me,[o(a(ne)),I(" "+n(a(d)("unverified")),1)]),t("a",{onClick:f},n(a(d)("refresh_status")),1)]),_:1}))])],64)):B("",!0),o(h,null,{overlay:p(()=>[o(b,null,{default:p(()=>[o(_,{onClick:i},{default:p(()=>[t("a",null,n(a(d)("edit")),1)]),_:1}),o(_,{onClick:k},{default:p(()=>[t("a",Ve,n(a(d)("delete")),1)]),_:1})]),_:1})]),default:p(()=>[t("div",Ue,[o(a(ie),{class:"zm-pointer"})])]),_:1})])}}},Re=V(Fe,[["__scopeId","data-v-985bada2"]]),qe="/assets/img/preview_01-Buh2wvv6.png",Pe="/assets/img/config_preview_01-BMDVQPd_.png",De={class:"page-title-input"},Ne={class:"upload-logo"},We=["src"],je={__name:"page-title-input",props:{avatar:{type:String,default:""},value:{type:String,default:""},placeholder:{type:String,default:"请输入标题"},autoUpload:{type:Boolean,default:!0}},emits:["update:value","update:avatar","changeAvatar"],setup(y,{emit:v}){const d=v,e=y,w=i=>{d("update:value",i.srcElement.value)},r=i=>{let k={file:i[0],category:"icon"};e.autoUpload&&ke(k).then(f=>{d("update:avatar",f.data.link)}),te(i[0]).then(f=>{d("changeAvatar",{file:i[0],url:f})})};return(i,k)=>{const f=N;return m(),x("div",De,[t("div",Ne,[o(xe,{onChange:r},{default:p(()=>[t("img",{class:"avatar",src:e.avatar},null,8,We)]),_:1})]),o(f,{size:"large",value:e.value,placeholder:y.placeholder,onInput:w},null,8,["value","placeholder"])])}}},ze=V(je,[["__scopeId","data-v-722c4816"]]),Je={key:0,class:"add-wechat-app-alert"},Ge={class:"alert-body"},Le={class:"form-box"},Qe={class:"my-ip"},He={class:"ip-text"},Ke={key:1,class:"add-wechat-app-alert"},Xe={class:"config-preview-box"},Ye={class:"config-items"},Ze={class:"config-item"},et={class:"config-value"},tt={class:"config-item"},at={class:"config-value"},st={class:"config-item"},ot={class:"config-value"},nt="/upload/default/official_account_avatar.png",lt={__name:"store-modal",emits:["ok"],setup(y,{expose:v,emit:d}){const{t:e}=F("views.user.official-account.components.store-modal"),w=d,r=$(!1),i=$(1),k=$(!1),f=$(),O={id:void 0,app_name:"",app_id:"",app_secret:"",app_avatar:"",app_avatar_url:nt,app_type:"official_account",wechat_ip:""},l=D({}),u={app_name:[{required:!0,message:e("app_name_required"),trigger:"change"},{trigger:"change",validator:()=>l.app_avatar_url?Promise.resolve():Promise.reject(e("avatar_required"))}],app_id:[{required:!0,message:e("app_id_required"),trigger:"change"}],app_secret:[{required:!0,message:e("app_secret_required"),trigger:"change"}]},_=ge(()=>{let c=l.id?e("edit_official_account"):e("add_official_account"),s=i.value==1?e("fill_dev_info"):e("server_config");return c+s}),b=({file:c,url:s})=>{l.app_avatar=c,l.app_avatar_url=s},h=D({push_aeskey:"",push_token:"",push_url:""}),S=()=>{let c={...ye(l)};delete c.app_avatar_url,K(c).then(s=>{Object.assign(h,s.data),i.value=2,E.success(e("save_success")),w("ok")})},R=()=>{f.value.validate().then(()=>{S()}).catch(c=>{})},z=()=>{r.value=!1},q=()=>{f.value.clearValidate(),f.value.resetFields(),r.value=!1},T=c=>{se(c),E.success(e("copy_success"))},J=()=>{T(l.wechat_ip)};return v({open:async(c=null)=>{c?(c.app_avatar_url=c.app_avatar,c.app_avatar=""):(c=JSON.parse(JSON.stringify(O)),c.id="");const s=ae(),{companyInfo:A,getCompanyInfo:M}=s;A||await M(),c.wechat_ip=A.wechat_ip,i.value=1,Object.assign(l,c),r.value=!0}}),(c,s)=>{const A=W,M=_e,U=de,P=N,G=ue,L=j;return m(),C(L,{width:"1168px",open:r.value,"onUpdate:open":s[7]||(s[7]=g=>r.value=g),title:_.value,onCancel:q},{footer:p(()=>[i.value===1?(m(),C(A,{key:"back",onClick:q},{default:p(()=>[I(n(a(e)("cancel_btn")),1)]),_:1})):B("",!0),i.value===1?(m(),C(A,{key:"submit",type:"primary",loading:k.value,onClick:R},{default:p(()=>[I(n(a(e)("save_and_next_btn")),1)]),_:1},8,["loading"])):B("",!0),i.value===2?(m(),C(A,{key:"submit",type:"primary",loading:k.value,onClick:z},{default:p(()=>[I(n(a(e)("config_done_btn")),1)]),_:1},8,["loading"])):B("",!0)]),default:p(()=>[i.value===1?(m(),x("div",Je,[o(M,{class:"tip-alert",message:a(e)("step1_alert_msg"),type:"info","show-icon":""},null,8,["message"]),t("div",Ge,[t("div",Le,[o(G,{ref_key:"formRef",ref:f,layout:"vertical",model:l,rules:u},{default:p(()=>[o(U,{label:a(e)("app_name_label"),name:"app_name"},{default:p(()=>[o(ze,{autoUpload:!1,avatar:l.app_avatar_url,"onUpdate:avatar":s[0]||(s[0]=g=>l.app_avatar_url=g),value:l.app_name,"onUpdate:value":s[1]||(s[1]=g=>l.app_name=g),valueModifiers:{trim:!0},placeholder:a(e)("app_name_placeholder"),onChangeAvatar:b},null,8,["avatar","value","placeholder"])]),_:1},8,["label"]),o(U,{label:a(e)("app_id_label"),name:"app_id"},{default:p(()=>[o(P,{value:l.app_id,"onUpdate:value":s[2]||(s[2]=g=>l.app_id=g),valueModifiers:{trim:!0},disabled:l.id>0,placeholder:a(e)("app_id_placeholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),o(U,{label:a(e)("app_secret_label"),name:"app_secret"},{default:p(()=>[o(P,{value:l.app_secret,"onUpdate:value":s[3]||(s[3]=g=>l.app_secret=g),valueModifiers:{trim:!0},placeholder:a(e)("app_secret_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(U,{label:a(e)("ip_whitelist_label"),required:""},{default:p(()=>[t("div",Qe,[t("span",He,n(l.wechat_ip),1),t("a",{class:"copy-btn",onClick:J},n(a(e)("copy_btn")),1)])]),_:1},8,["label"])]),_:1},8,["model"])]),s[8]||(s[8]=t("div",{class:"preview-box"},[t("img",{class:"preview-img",src:qe})],-1))])])):B("",!0),i.value===2?(m(),x("div",Ke,[o(M,{class:"tip-alert",message:a(e)("step2_alert_msg"),type:"info","show-icon":""},null,8,["message"]),t("div",Xe,[t("div",Ye,[t("div",Ze,[t("span",et,n(h.push_url),1),t("span",{class:"copy-btn",onClick:s[4]||(s[4]=g=>T(h.push_url))},n(a(e)("copy_text")),1)]),t("div",tt,[t("span",at,n(h.push_token),1),t("span",{class:"copy-btn",onClick:s[5]||(s[5]=g=>T(h.push_token))},n(a(e)("copy_text")),1)]),t("div",st,[t("span",ot,n(h.push_aeskey),1),t("span",{class:"copy-btn",onClick:s[6]||(s[6]=g=>T(h.push_aeskey))},n(a(e)("copy_text")),1)])]),s[9]||(s[9]=t("img",{class:"config-preview-img",src:Pe},null,-1))])])):B("",!0)]),_:1},8,["open","title"])}}},it=V(lt,[["__scopeId","data-v-96a855a4"]]),ct={class:"_container"},pt={class:"page-title"},rt={key:0,class:"loading-box"},_t={key:2,class:"empty-box"},dt={class:"title"},ut={__name:"index",setup(y){const{t:v}=F("views.user.official-account.index"),d=$(),e=$([]),w=$(!0);be(()=>{r()});const r=()=>{X({app_type:"official_account",app_name:""}).then(u=>{e.value=u.data}).finally(()=>{w.value=!1})},i=()=>{d.value.open()},k=u=>{let _=3;const b=j.confirm({title:v("confirm_remove",{app_name:u.app_name}),icon:o(fe),content:v("remove_warning"),okText:_+" 确 定",okType:"danger",cancelText:"取消",okButtonProps:{disabled:!0},onOk(){Z({id:u.id}).then(()=>{r(),E.success(v("delete_success"))})},onCancel(){}});let h=setInterval(()=>{_==1?(b.update({okText:"确定",okButtonProps:{disabled:!1}}),clearInterval(h),h=void 0):(_-=1,b.update({okText:_+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},f=u=>{d.value.open({...u})},O=u=>{Y({id:u.id}).then(()=>{E.success(v("refresh_success")),r()})},l=()=>{let u=[];e.value.forEach((_,b)=>{u.push(_.id)}),ee({id_list:u.toString()}).then(_=>{E.success(v("sort_success"))})};return(u,_)=>{const b=W,h=ve;return m(),x("div",ct,[t("div",pt,[t("span",null,n(a(v)("title")),1),o(b,{onClick:i,icon:o(a(me)),type:"primary"},{default:p(()=>[I(n(a(v)("bind_btn")),1)]),_:1},8,["icon"])]),w.value?(m(),x("div",rt,[o(h)])):e.value.length?(m(),C(a(H),{key:1,class:"wechat-app-list",modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=S=>e.value=S),"item-key":"id",onEnd:l,handle:".drag-item"},{item:p(({element:S,index:R})=>[(m(),C(Re,{class:"drag-item",key:S.id,item:S,app_type:"official_account",onEdit:f,onDelete:k,onRefresh:O},null,8,["item"]))]),_:1},8,["modelValue"])):(m(),x("div",_t,[_[1]||(_[1]=t("img",{src:Q},null,-1)),t("div",dt,n(a(v)("empty_title")),1),o(b,{onClick:i,class:"btn",type:"primary"},{default:p(()=>[I(n(a(v)("bind_now_btn")),1)]),_:1})])),o(it,{ref_key:"storeRef",ref:d,onOk:r},null,512)])}}},St=V(ut,[["__scopeId","data-v-e122d97d"]]);export{St as default};
