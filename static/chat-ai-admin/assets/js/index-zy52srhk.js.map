{"version":3,"file":"index-zy52srhk.js","sources":["../../../../front-end/chat-ai-admin-vue/src/views/public-library/add/index.vue"],"sourcesContent":["<style lang=\"less\" scoped>\r\n.add-library-page {\r\n  padding: 24px;\r\n\r\n  .form-box {\r\n    width: 568px;\r\n    margin: 0 auto;\r\n  }\r\n}\r\n\r\n.model-icon {\r\n  height: 18px;\r\n}\r\n\r\n.form-item-tip {\r\n  color: #999;\r\n}\r\n\r\n.card-box {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n.use-model-item {\r\n  position: relative;\r\n  width: 226px;\r\n  height: 124px;\r\n  border-radius: 2px;\r\n  border: 2px solid #d9d9d9;\r\n  cursor: pointer;\r\n  padding: 15px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.use-model-item-top {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  font-size: 14px;\r\n  color: #595959;\r\n}\r\n\r\n.use-model-item-top-icon {\r\n  margin-right: 5px;\r\n}\r\n\r\n.use-model-item-top.active {\r\n  color: #2475fc;\r\n  font-weight: bolder;\r\n}\r\n\r\n.use-model-item.active {\r\n  border: 2px solid #2475fc;\r\n\r\n  .check-arrow {\r\n    position: absolute;\r\n    display: block;\r\n    right: -1px;\r\n    bottom: -1px;\r\n    width: 24px;\r\n    height: 24px;\r\n    font-size: 24px;\r\n    color: #fff;\r\n  }\r\n\r\n  .retrieval-mode-title {\r\n    color: #2475fc;\r\n  }\r\n}\r\n\r\n.upload-document-type-box {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 8px;\r\n  .type-item {\r\n    position: relative;\r\n    width: calc((100% - 8px) / 2);\r\n    cursor: pointer;\r\n    padding: 16px;\r\n    display: flex;\r\n    border: 1px solid #d9d9d9;\r\n    border-radius: 2px;\r\n    box-shadow: none;\r\n    transition: box-shadow 1s;\r\n    &:hover {\r\n      box-shadow:\r\n        0px 5px 5px -3px rgba(0, 0, 0, 0.1),\r\n        0px 8px 10px 1px rgba(0, 0, 0, 0.06),\r\n        0px 3px 14px 2px rgba(0, 0, 0, 0.05);\r\n    }\r\n    &.active {\r\n      border: 2px solid #2475fc;\r\n      .svg-action {\r\n        color: #2475fc;\r\n      }\r\n      .right-block .title-text {\r\n        color: #2475fc;\r\n      }\r\n    }\r\n    .check-arrow {\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: -1px;\r\n    }\r\n  }\r\n  .right-block {\r\n    .title-block {\r\n      display: flex;\r\n      font-size: 14px;\r\n      line-height: 22px;\r\n      .title-text {\r\n        margin-left: 2px;\r\n        color: #262626;\r\n        font-weight: 600;\r\n      }\r\n    }\r\n    .desc {\r\n      color: #595959;\r\n      margin-top: 4px;\r\n      line-height: 22px;\r\n      word-break: break-all;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<template>\r\n  <div class=\"add-library-page\">\r\n    <div class=\"form-box\">\r\n      <a-form :label-col=\"{ span: 5 }\">\r\n        <a-form-item ref=\"name\" label=\"知识库名称\" v-bind=\"validateInfos.library_name\">\r\n          <a-input\r\n            v-model:value=\"formState.library_name\"\r\n            type=\"text\"\r\n            placeholder=\"请输入知识库名称，最多20个字\"\r\n            :maxlength=\"20\"\r\n          />\r\n        </a-form-item>\r\n\r\n        <a-form-item label=\"知识库简介\">\r\n          <a-textarea v-model:value=\"formState.library_intro\" placeholder=\"请输入知识库介绍\" />\r\n        </a-form-item>\r\n\r\n        <a-form-item ref=\"name\" label=\"知识库封面\" v-bind=\"validateInfos.avatar\">\r\n          <AvatarInput v-model:value=\"formState.avatar\" @change=\"onAvatarChange\" />\r\n          <div class=\"form-item-tip\">请上传知识库封面，建议尺寸为100*100px.大小不超过100kb</div>\r\n        </a-form-item>\r\n\r\n        <a-form-item :wrapper-col=\"{ span: 14, offset: 4 }\">\r\n          <a-button @click=\"resetForm\">取 消</a-button>\r\n          <a-button\r\n            type=\"primary\"\r\n            style=\"margin-left: 16px\"\r\n            :loading=\"saveLoading\"\r\n            @click.prevent=\"onSubmit\"\r\n            >下一步</a-button\r\n          >\r\n        </a-form-item>\r\n      </a-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref, onMounted, computed } from 'vue'\r\nimport { Form, message } from 'ant-design-vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { createLibrary } from '@/api/library/index'\r\nimport AvatarInput from './components/avatar-input.vue'\r\nimport { LIBRARY_NORMAL_AVATAR, LIBRARY_OPEN_AVATAR } from '@/constants/index'\r\nimport { transformUrlData } from '@/utils/validate.js'\r\nimport { getLibraryInfo } from '@/api/library'\r\n\r\n// 设置全局默认的duration为（2秒）\r\nmessage.config({\r\n  duration: 2\r\n})\r\n\r\nconst router = useRouter()\r\n\r\nconst type = computed(() => {\r\n  return 1\r\n})\r\n\r\nconst useForm = Form.useForm\r\nconst saveLoading = ref(false)\r\n\r\nconst defaultAvatar = type.value == 0 ? LIBRARY_NORMAL_AVATAR : LIBRARY_OPEN_AVATAR\r\nconst formState = reactive({\r\n  type: type.value,\r\n  access_rights: 0,\r\n  library_name: '',\r\n  library_intro: '',\r\n  use_model: '',\r\n  model_config_id: '',\r\n  library_files: undefined,\r\n  avatar: defaultAvatar,\r\n  avatar_file: undefined,\r\n  is_offline: false,\r\n  urls: '',\r\n  doc_type: 1,\r\n  file_name: '',\r\n  is_qa_doc: type.value == 2 ? 1 : 0, // 0 普通文档 1QA文档\r\n  qa_index_type: 1, // 1问题与答案一起生成索引 2仅对问题生成索引\r\n  doc_auto_renew_frequency: 1\r\n})\r\n\r\nconst rules = reactive({\r\n  library_name: [{ required: true, message: '请输入库名称', trigger: 'change' }]\r\n})\r\n\r\nconst { validate, validateInfos } = useForm(formState, rules)\r\n\r\nconst onAvatarChange = (data) => {\r\n  formState.avatar = data.imageUrl\r\n  formState.avatar_file = data.file\r\n}\r\n\r\nconst resetForm = () => {\r\n  router.back()\r\n}\r\n\r\nconst onSubmit = () => {\r\n  validate()\r\n    .then(() => {\r\n      saveForm()\r\n    })\r\n    .catch((err) => {\r\n      console.log(err, 'err')\r\n    })\r\n}\r\n\r\nconst saveForm = () => {\r\n  let formData = new FormData()\r\n\r\n  let newFormState = JSON.parse(JSON.stringify(formState)) // 深拷贝，不能改变原对象\r\n\r\n  formData.append('type', formState.type)\r\n  formData.append('access_rights', formState.access_rights)\r\n  formData.append('library_name', formState.library_name)\r\n  formData.append('library_intro', formState.library_intro)\r\n  formData.append('use_model', newFormState.use_model)\r\n  formData.append('model_config_id', formState.model_config_id)\r\n  formData.append('avatar', formState.avatar_file ? formState.avatar_file : '')\r\n  formData.append('is_offline', formState.is_offline)\r\n  formData.append('urls', JSON.stringify(transformUrlData(formState.urls)))\r\n  formData.append('doc_type', formState.doc_type)\r\n  formData.append('file_name', formState.file_name)\r\n  formData.append('is_qa_doc', formState.is_qa_doc)\r\n  formData.append('qa_index_type', formState.qa_index_type)\r\n  formData.append('doc_auto_renew_frequency', formState.doc_auto_renew_frequency)\r\n  formData.append('is_default', 2)\r\n\r\n  saveLoading.value = true\r\n\r\n  createLibrary(formData)\r\n    .then((res) => {\r\n      message.success('创建成功')\r\n\r\n      toHome(res.data.id)\r\n    })\r\n    .catch(() => {\r\n      saveLoading.value = false\r\n    })\r\n}\r\n\r\nconst toHome = (id) => {\r\n  getLibraryInfo({ id: id })\r\n    .then((res) => {\r\n      saveLoading.value = false\r\n      // 对外知识库\r\n      router.replace({\r\n        path: '/public-library/config',\r\n        query: {\r\n          library_id: res.data.id,\r\n          library_key: res.data.library_key\r\n        }\r\n      })\r\n    })\r\n    .catch(() => {\r\n      saveLoading.value = false\r\n    })\r\n}\r\n\r\nonMounted(() => {})\r\n</script>\r\n"],"names":["message","router","useRouter","type","computed","useForm","Form","saveLoading","ref","defaultAvatar","LIBRARY_NORMAL_AVATAR","LIBRARY_OPEN_AVATAR","formState","reactive","rules","validate","validateInfos","onAvatarChange","data","resetForm","onSubmit","saveForm","err","formData","newFormState","transformUrlData","createLibrary","res","toHome","id","getLibraryInfo","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_a_form","_component_a_form_item","_mergeProps","_unref","_component_a_input","_cache","$event","_component_a_textarea","AvatarInput","_component_a_button"],"mappings":"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"}