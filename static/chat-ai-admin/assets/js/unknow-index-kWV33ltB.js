import{_ as Re}from"./cu-scroll-C_QJcxx1.js";import{u as xe}from"./robot-jPE-s270.js";import{d as K,Z as Fe,w as Ge,X as Ee,B as ce,M as ie,bu as je,aT as Be,a9 as Je,o as $e,v as pe,G as qe,y as Pe,z as Qe,$ as Ce,a3 as ve,a4 as fe,O as Ie,aB as Ve,b as V,F as le,e as Se,ah as Me,Q as He,D as Xe,h as Ze,i as We,k as et,E as tt,ae as nt,T as ot}from"./ui-antd-B11sc9DP.js";import{aw as ne,av as De,f as u,r as E,o as st,w as Oe,ac as v,ad as i,as as e,k as n,ar as o,F,ax as te,u as G,ae as R,G as x,at as Y,e as W,j as at,az as P,n as me,A as ke,ai as lt,aE as we,aF as be,af as _e,q as it}from"./vue-chunks-CGLjTDrY.js";import{_ as H,d as ye,A as ut,aX as rt,aZ as dt,aj as _t,c as mt}from"../../index-C5-B0r5-.js";import{M as ge}from"./model-select-DkFuDwQt.js";import{u as ct}from"./index-DM5bNlEU.js";import{a3 as pt,a4 as Ue,a5 as vt,a6 as ft}from"./index-AgSL8KLK.js";import{U as ze}from"./index-B2MTQrOC.js";import{u as Le}from"./util-BwuffJOK.js";import{M as yt}from"./editor-code-DDvPSeJb.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./neo4j-Bk0ySkcX.js";import"./utils-BH-4gQMj.js";import"./other-BrZCAsTs.js";import"./index-Btdd0zUd.js";import"./index-GO4nEZEO.js";const gt={class:"zm-date"},kt={class:"date-btn"},wt={class:"date-content"},Ye={__name:"date",props:{datekey:{type:String,default:""}},emits:["dateChange"],setup(j,{emit:N}){const $=ne().query,q=De(),a=j,g=u(1),r=N;let c=E([{label:"今日",value:!0,key:2,start_date:K().startOf("day"),end_date:K().endOf("day")},{label:"昨日",value:!1,key:3,start_date:K().subtract(1,"day").startOf("day"),end_date:K().startOf("day").subtract(1,"millisecond")},{label:"近7日",value:!1,key:4,start_date:K().subtract(6,"day").startOf("day"),end_date:K().endOf("day").subtract(1,"millisecond")},{label:"自定义",value:!1,key:5,start_date:K().startOf("month").startOf("day"),end_date:K().endOf("day")}]);const l=u(null),I=u(null),O=u([]),S=f=>f>=K().subtract(0,"day"),M=()=>{let f=g.value,s=null;c.forEach(d=>{d.key==f&&(s=d)}),O.value=[s.start_date,s.end_date],l.value=s.start_date.startOf("day").format("YYYYMMDD"),I.value=s.end_date.endOf("day").format("YYYYMMDD"),z()},U=(f,s)=>{l.value=f[0].startOf("day").format("YYYYMMDD"),I.value=f[1].endOf("day").format("YYYYMMDD"),g.value=5,z()},z=()=>{r("dateChange",{start_time:l.value,end_time:I.value})};return st(()=>{$.start_date&&$.end_date?(g.value=5,O.value=[K($.start_date),K($.end_date)],l.value=K($.start_date).format("YYYYMMDD"),I.value=K($.end_date).format("YYYYMMDD"),z(),setTimeout(()=>{q.push({path:q.path,query:{id:$.id,robot_key:$.robot_key}})},400)):(g.value=parseInt(a.datekey),M())}),Oe(()=>a.datekey,(f,s)=>{g.value=parseInt(a.datekey.split("-")[0]),M()}),(f,s)=>{const d=Fe,k=Ge,b=Ee;return i(),v("div",gt,[e("div",kt,[n(k,{value:g.value,"onUpdate:value":s[0]||(s[0]=D=>g.value=D),onChange:M},{default:o(()=>[(i(!0),v(F,null,te(G(c),D=>(i(),R(d,{class:"date-btn-button",value:D.key,key:D.key},{default:o(()=>[x(Y(D.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e("div",wt,[n(b,{value:O.value,"onUpdate:value":s[1]||(s[1]=D=>O.value=D),onChange:U,format:"YYYY-MM-DD",disabledDate:S,allowClear:!1},null,8,["value"])])])}}},bt={class:"ai-generate-wrapper"},ht={class:"form-box-wrapper ai-generate-wrapper-box"},xt={class:"ai-generate-wrapper-left"},$t={class:"form-box-wrapper-options"},qt={class:"form-item flex1"},Ct={class:"form-content"},It={class:"form-item generate-btn-box"},St={key:0,class:"progress-box"},Mt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleDownload"],setup(j,{expose:N,emit:$}){const q=u(10),a=u(!1),g=u(!1),r=E({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),c=j,l=$,I=u(!1),O=()=>{I.value=!0},S=()=>{a.value=!1},M=async()=>{var T;g.value=!0;try{let _={library_id:(T=c.detailsInfo)==null?void 0:T.library_id,model_config_id:r.model_config_id,use_model:r.use_model,num:r.count};I.value=!1,a.value=!0,k()}finally{g.value=!1}},U=u(!1),z=u(!1);let f=null;const s=W(()=>q.value>=100?"success":"active"),d=W(()=>({"0%":"#108ee9","100%":"#87d068"})),k=()=>{U.value=!0,z.value=!1,q.value=0,f=setInterval(()=>{q.value<100?(q.value+=Math.floor(Math.random()*10)+1,q.value>100&&(q.value=100)):(clearInterval(f),U.value=!1,z.value=!0)},800)},b=()=>{l("handleDownload")},D=T=>{if(U.value)return T.preventDefault(),T.returnValue="数据正在生成中，确定要离开吗？","数据正在生成中，确定要离开吗？"};return at(()=>{clearInterval(f),window.removeEventListener("beforeunload",D)}),N({showModal:O,hideModal:S}),(T,_)=>{const B=ye,p=ce,m=ie,C=je,Q=Be;return i(),v("div",null,[n(m,{open:I.value,"onUpdate:open":_[2]||(_[2]=A=>I.value=A),maskClosable:!1,width:"472px","ok-button-props":{style:{display:"none"}}},{title:o(()=>[..._[4]||(_[4]=[e("div",{class:"custom-modal-header"},[e("span",null,"AI智能总结")],-1)])]),footer:o(()=>[..._[7]||(_[7]=[])]),default:o(()=>[e("div",bt,[e("div",ht,[e("div",xt,[e("div",$t,[e("div",qt,[_[5]||(_[5]=e("div",{class:"form-label required"},"请选择生成未知问题总结的大模型",-1)),e("div",Ct,[n(ge,{modelType:"LLM",modeName:r.use_model,"onUpdate:modeName":_[0]||(_[0]=A=>r.use_model=A),modeId:r.model_config_id,"onUpdate:modeId":_[1]||(_[1]=A=>r.model_config_id=A)},null,8,["modeName","modeId"])])])]),e("div",It,[n(p,{onClick:M,loading:g.value,class:"generate-btn"},{default:o(()=>[n(B,{name:"ai-generate-white",style:{"font-size":"16px"}}),_[6]||(_[6]=x(" 开始总结 ",-1))]),_:1},8,["loading"])])])])])]),_:1},8,["open"]),n(m,{open:a.value,"onUpdate:open":_[3]||(_[3]=A=>a.value=A),title:"生成数据",footer:null,width:746},{default:o(()=>[q.value<100?(i(),v("div",St,[n(C,{type:"circle",percent:q.value,status:s.value,"stroke-color":d.value},null,8,["percent","status","stroke-color"]),_[8]||(_[8]=e("div",{class:"tip"},"数据生成中，请勿关闭页面",-1))])):(i(),R(Q,{key:1,status:"success",title:"生成完成"},{subTitle:o(()=>[..._[9]||(_[9]=[x(" 您可以去未知问题总结中下载生成的数据 ",-1)])]),extra:o(()=>[n(p,{onClick:b,type:"primary"},{default:o(()=>[..._[10]||(_[10]=[x("去下载",-1)])]),_:1})]),_:1}))]),_:1},8,["open"])])}}},Dt=H(Mt,[["__scopeId","data-v-a9443953"]]),Ot={class:"list-wrapper"},Ut={class:"content-wrapper"},zt={class:"tip-icon"},Lt={class:"search-block"},Yt={key:0},Tt={key:1},Nt={__name:"index",setup(j){const N=ne().query,$=u(1),q=u([]),a=E({robot_id:N.id,start_day:"",end_day:"",page:1,size:10,total:0}),g=u(null),r=M=>{a.page=M.current,a.size=M.pageSize,O()},c=()=>{a.page=1,O()},l=()=>{$.value=2,g.value&&g.value.hideModal()},I=M=>{a.start_day=M.start_time,a.end_day=M.end_time,c()},O=()=>{ct({...a}).then(M=>{let U=M.data.list;q.value=U,a.total=+M.data.total})},S=[{title:"未知问题",dataIndex:"question",key:"question",width:"60%"},{title:"触发日期",dataIndex:"show_date",key:"show_date",width:"20%"},{title:"当日出现次数",key:"trigger_total",dataIndex:"trigger_total",width:"20%"}];return(M,U)=>{const z=$e,f=pe,s=qe;return i(),v(F,null,[e("div",Ot,[e("div",Ut,[n(z,{"show-icon":"",class:"alert-box"},{icon:o(()=>[e("div",zt,[n(G(Je))])]),message:o(()=>[...U[0]||(U[0]=[e("div",{class:"tip-title"},"统计用户在与机器人对话中，没有从知识库中检索出知识的用户问题",-1),e("div",{class:"tip-content"},[e("p",null," 1. 如果您认为知识库里面有对应的知识，只是没有检索出来，可能是您设置的召回阈值过高或者top K较少。您调整机器人的召回设置来提升召回率。 ")],-1)])]),_:1}),e("div",Lt,[n(Ye,{datekey:"4",onDateChange:I})]),n(s,{class:"table-list",columns:S,"data-source":q.value,pagination:{current:a.page,total:a.total,pageSize:a.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:r},{bodyCell:o(({column:d,record:k})=>[d.key==="question"?(i(),v(F,{key:0},[k.question.length>100?(i(),v("div",Yt,[n(f,{overlayClassName:"search-content-tip",placement:"top"},{title:o(()=>[x(Y(k.question),1)]),default:o(()=>[e("div",null,Y(k.question.slice(0,100)+"..."),1)]),_:2},1024)])):(i(),v("div",Tt,Y(k.question),1))],64)):P("",!0)]),_:1},8,["data-source","pagination"])])]),n(Dt,{ref_key:"aiGenerateRef",ref:g,onHandleDownload:l},null,512)],64)}}},At=H(Nt,[["__scopeId","data-v-15df8dc9"]]),Kt={class:"custom-modal-header"},Rt={key:1},Ft={key:2},Gt={class:"form-box-wrapper"},Et={class:"form-item"},jt={class:"form-content"},Bt={class:"form-item"},Jt={class:"form-content"},Pt={class:"form-item"},Qt={class:"form-content"},Vt={class:"form-item"},Ht={class:"form-label-box"},Xt={class:"form-content"},Zt={class:"form-item"},Wt={class:"form-content"},en={key:0,class:"error-tip"},tn={class:"form-item"},nn={class:"form-content"},on={class:"upload-box-wrapper"},sn={key:0},an={class:"ai-generate-wrapper"},ln={class:"form-box-wrapper ai-generate-wrapper-box"},un={class:"ai-generate-wrapper-left"},rn={class:"form-box-wrapper-options"},dn={class:"form-item flex1"},_n={class:"form-content"},mn={class:"form-item flex1"},cn={class:"form-content dual-inputs"},pn={class:"input-group"},vn={class:"form-label-input-box"},fn={class:"form-box-wrapper-content"},yn={class:"problem-box"},gn={class:"problem-content"},kn={class:"problem-box"},wn={class:"problem-content"},bn={class:"form-item generate-btn-box"},hn={class:"result-nav"},xn={key:0,class:"tip"},$n={key:1,class:"result-nav-text"},qn={key:0,class:"container"},Cn={class:"result-container"},In=["innerHTML"],Sn={class:"result-footer"},Mn={__name:"import-library-modal",emits:["ok"],setup(j,{expose:N,emit:$}){const q=u(!1),a=u(!1),g=u(!1),r=u(!1),c=u(!1),l=E({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5,library_id:void 0}),I=new yt({html:!0,linkify:!0,typographer:!0}),O=u(""),S=E({finish:"",content:""});Oe(()=>S.content,()=>{O.value=I.render(S.content)});const M=$,U=u("1"),z=u(!1),f=u(""),s=u(""),d=u(""),k=u(""),b=u(""),D=u([]),T=u(""),_=u("0"),B=u([]),p=()=>{ut({type:2}).then(h=>{_.value="0",B.value=h.data||[]})};p();const m=()=>{A()},C=h=>{var t;p(),a.value=!1,g.value=!1,c.value=!1,f.value="",s.value="",T.value=h.id||"",d.value=h.answer||"",D.value=h.images||[],k.value=h.question||"",b.value=h.similar_questions?h.similar_questions.join(`
`):"",_.value=h.group_id||"0",l.library_id=h.library_id||"",l.library_id||(l.library_id=(t=B.value[0])==null?void 0:t.id),A(),z.value=!0},Q=u([]),A=()=>{_t({library_id:l.library_id}).then(h=>{Q.value=h.data||[]})},ee=()=>{if(se(),!k.value)return V.error("请输入分段问题");if(!d.value)return V.error("请输入分段答案");if(d.value.length>1e4)return;let h={title:f.value,content:s.value,question:k.value,answer:d.value,images:D.value,library_id:l.library_id};h.group_id=_.value||0;let t=b.value.trim();t?(t=t.split(`
`),h.similar_questions=JSON.stringify(t)):h.similar_questions="[]";let y=new FormData;for(let L in h)Le.isArray(h[L])?h[L].forEach(J=>{y.append(L,J)}):y.append(L,h[L]);dt(y).then(L=>{pt({id:T.value,to_library_id:l.library_id}).then(J=>{V.success("导入成功"),z.value=!1,M("ok")})})},oe=()=>{if(!l.library_id)return V.error("请选择知识库");a.value=!0},X=u(""),ue=async()=>{S.content="",X.value="",r.value=!0,c.value=!0;try{let h={library_id:l.library_id,model_config_id:l.model_config_id,use_model:l.use_model,num:l.count,question:k.value,answer:d.value};const t=await rt(h);X.value=t.data.map(y=>y).join(`
`),S.content=t.data.map((y,L)=>`<div class="dialog-message">${L+1}. ${y}</div>`).join(""),g.value=!0}finally{r.value=!1}},re=()=>{b.value?b.value+=`
${X.value}`:b.value+=X.value,V.success("保存成功"),g.value=!1,a.value=!1,c.value=!1};function Z(h){return h.split(`
`).map(t=>t.trim()).filter(t=>t).join(`
`)}const se=()=>{b.value=Z(b.value)};return N({showModal:C}),(h,t)=>{const y=ce,L=Qe,J=Pe,de=Ce,ae=ye,Te=fe,Ne=ve,Ae=Ie,Ke=ie;return i(),v("div",null,[n(Ke,{open:z.value,"onUpdate:open":t[12]||(t[12]=w=>z.value=w),onOk:ee,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"670px","overflow-y":"auto","padding-right":"12px"},width:a.value?c.value?"944px":"472px":"746px","ok-button-props":{style:{display:a.value?"none":"block"}}},{title:o(()=>[e("div",Kt,[a.value?(i(),R(y,{key:0,type:"text",class:"back-button",onClick:t[0]||(t[0]=w=>a.value=!1)},{icon:o(()=>[n(G(Ve),{style:{"font-size":"12px"}})]),_:1})):P("",!0),a.value?(i(),v("span",Rt,"AI生成相似问法")):(i(),v("span",Ft,"导入知识库"))])]),footer:o(()=>[a.value?P("",!0):(i(),v(F,{key:0},[n(y,{onClick:t[11]||(t[11]=w=>z.value=!1)},{default:o(()=>[...t[30]||(t[30]=[x("取消",-1)])]),_:1}),n(y,{type:"primary",onClick:ee},{default:o(()=>[...t[31]||(t[31]=[x("确定",-1)])]),_:1})],64))]),default:o(()=>[me(e("div",Gt,[e("div",Et,[t[13]||(t[13]=e("div",{class:"form-label required"},"问题请选择要导入的问答知识库：",-1)),e("div",jt,[n(J,{onChange:m,value:l.library_id,"onUpdate:value":t[1]||(t[1]=w=>l.library_id=w),style:{width:"100%"},placeholder:"请选择"},{default:o(()=>[(i(!0),v(F,null,te(B.value,w=>(i(),R(L,{value:w.id,key:w.id},{default:o(()=>[x(Y(w.library_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Bt,[t[14]||(t[14]=e("div",{class:"form-label required"},"所属分类：",-1)),e("div",Jt,[n(J,{value:_.value,"onUpdate:value":t[2]||(t[2]=w=>_.value=w),style:{width:"100%"}},{default:o(()=>[(i(!0),v(F,null,te(Q.value,w=>(i(),R(L,{value:w.id},{default:o(()=>[x(Y(w.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",Pt,[t[15]||(t[15]=e("div",{class:"form-label required"},"分段问题：",-1)),e("div",Qt,[n(de,{placeholder:"请输入分段问题",value:k.value,"onUpdate:value":t[3]||(t[3]=w=>k.value=w),style:{height:"100px"}},null,8,["value"])])]),e("div",Vt,[e("div",Ht,[t[17]||(t[17]=e("div",{class:"form-label required"},"相似问法",-1)),e("div",{class:"ai-generate",onClick:oe},[n(ae,{name:"ai-generate",style:{"font-size":"14px"}}),t[16]||(t[16]=e("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),e("div",Xt,[n(de,{placeholder:"请输入相似问法",value:b.value,"onUpdate:value":t[4]||(t[4]=w=>b.value=w),style:{height:"100px"},onBlur:se},null,8,["value"]),t[18]||(t[18]=e("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),e("div",Zt,[t[19]||(t[19]=e("div",{class:"form-label required"},"分段答案：",-1)),e("div",Wt,[n(de,{placeholder:"请输入分段答案",value:d.value,"onUpdate:value":t[5]||(t[5]=w=>d.value=w),maxlength:1e4,style:{height:"100px"}},null,8,["value"]),d.value.length>1e4?(i(),v("div",en,"分段答案最多支持10000个字符")):P("",!0)])]),e("div",tn,[t[21]||(t[21]=e("div",{class:"form-label"},"附件",-1)),e("div",nn,[e("div",on,[n(Ne,{activeKey:U.value,"onUpdate:activeKey":t[6]||(t[6]=w=>U.value=w),size:"small"},{default:o(()=>[n(Te,{key:"1"},{tab:o(()=>[e("span",null,[n(ae,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),t[20]||(t[20]=x(" 图片 ",-1)),D.value.length?(i(),v("span",sn,"("+Y(D.value.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(ze,{value:D.value,"onUpdate:value":t[7]||(t[7]=w=>D.value=w)},null,8,["value"])])])])],512),[[ke,!a.value]]),me(e("div",an,[e("div",ln,[e("div",un,[e("div",rn,[e("div",dn,[t[22]||(t[22]=e("div",{class:"form-label required"},"相似问法模型：",-1)),e("div",_n,[n(ge,{modelType:"LLM",modeName:l.use_model,"onUpdate:modeName":t[8]||(t[8]=w=>l.use_model=w),modeId:l.model_config_id,"onUpdate:modeId":t[9]||(t[9]=w=>l.model_config_id=w)},null,8,["modeName","modeId"])])]),e("div",mn,[e("div",cn,[e("div",pn,[t[24]||(t[24]=e("div",{class:"form-label required"},"问题个数：",-1)),e("div",vn,[n(Ae,{value:l.count,"onUpdate:value":t[10]||(t[10]=w=>l.count=w),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),t[23]||(t[23]=x("个 ",-1))])])])])]),e("div",fn,[e("div",yn,[t[25]||(t[25]=e("div",{class:"problem"},"问题",-1)),e("div",gn,Y(k.value),1)]),e("div",kn,[t[26]||(t[26]=e("div",{class:"problem"},"答案",-1)),e("div",wn,Y(d.value),1)])]),e("div",bn,[n(y,{onClick:ue,loading:r.value,class:"generate-btn"},{default:o(()=>[n(ae,{name:"ai-generate-white",style:{"font-size":"16px"}}),t[27]||(t[27]=x(" 开始生成 ",-1))]),_:1},8,["loading"])])]),e("div",{class:lt(["ai-generate-wrapper-right",{"show-result":c.value}])},[e("div",hn,[n(ae,{name:"generate-icon",style:{"font-size":"14px"}}),r.value?(i(),v("span",xn,"相似问法生成中...")):(i(),v("div",$n,"相似问法生成完毕"))]),!S.content&&r.value&&!q.value?(i(),v("div",qn,[...t[28]||(t[28]=[e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1),e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)])])):P("",!0),e("div",Cn,[e("div",{class:"dialog-content",innerHTML:O.value},null,8,In)]),e("div",Sn,[n(y,{class:"result-footer-btn",type:"primary",onClick:re},{default:o(()=>[...t[29]||(t[29]=[x("保存相似问法",-1)])]),_:1})])],2)])],512),[[ke,a.value]])]),_:1},8,["open","width","ok-button-props"])])}}},Dn=H(Mn,[["__scopeId","data-v-ddecb35c"]]),On={class:"form-box"},Un={__name:"auto-cluster-modal",emits:["ok"],setup(j,{expose:N,emit:$}){const q=$,a=ne().query,g=u(!1),r=E({unknown_summary_model_config_id:"",unknown_summary_use_model:"",unknown_summary_similarity:"",unknown_summary_status:"",id:a.id}),c=le.useForm;u(!1);const l=f=>{r.unknown_summary_model_config_id=f.unknown_summary_model_config_id||"",r.unknown_summary_use_model=f.unknown_summary_use_model||"",r.unknown_summary_similarity=f.unknown_summary_similarity||"",r.unknown_summary_status=f.unknown_summary_status||"",g.value=!0},I=E({unknown_summary_similarity:[{required:!0,message:"请输入相似度阈值",trigger:"change"}],unknown_summary_model_config_id:[{required:!0,message:"请选择使用的向量模型",trigger:"change"}]}),{validate:O,validateInfos:S}=c(r,I),M=f=>{f.length},U=()=>{O().then(()=>{z()}).catch(f=>{})},z=()=>{Ue({...r}).then(f=>{V.success("保存成功"),g.value=!1,q("ok")})};return N({show:l}),(f,s)=>{const d=Se,k=pe,b=Ie,D=le,T=ie;return i(),v("div",null,[n(T,{open:g.value,"onUpdate:open":s[3]||(s[3]=_=>g.value=_),title:"自动聚类设置",onOk:U},{default:o(()=>[e("div",On,[n(D,{layout:"vertical"},{default:o(()=>[n(d,we(be(G(S).unknown_summary_model_config_id)),{label:o(()=>[...s[4]||(s[4]=[x("请设置使用的向量模型 ",-1)])]),default:o(()=>[n(ge,{modelType:"TEXT EMBEDDING",modeName:r.unknown_summary_use_model,"onUpdate:modeName":s[0]||(s[0]=_=>r.unknown_summary_use_model=_),modeId:r.unknown_summary_model_config_id,"onUpdate:modeId":s[1]||(s[1]=_=>r.unknown_summary_model_config_id=_),onLoaded:M,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},16),n(d,we(be(G(S).unknown_summary_similarity)),{label:o(()=>[s[6]||(s[6]=x("相似度阈值 ",-1)),n(k,null,{title:o(()=>[...s[5]||(s[5]=[x("语意相似度大于指定阈值的问题会自动聚类",-1)])]),default:o(()=>[n(G(Me),{class:"ml4"})]),_:1})]),default:o(()=>[n(b,{placeholder:"请输入相似度阈值",style:{width:"100%"},value:r.unknown_summary_similarity,"onUpdate:value":s[2]||(s[2]=_=>r.unknown_summary_similarity=_),min:0,max:1,precision:2,step:.1},null,8,["value"])]),_:1},16)]),_:1})])]),_:1},8,["open"])])}}},zn=H(Un,[["__scopeId","data-v-81c864fc"]]),Ln={class:"form-box"},Yn={class:"upload-box-wrapper"},Tn={key:0},Nn={__name:"set-answer-modal",emits:["ok"],setup(j,{expose:N,emit:$}){const q=$,a=ne().query,g=u("1"),r=u(!1),c=E({id:a.id,question:"",unknown_list:"",answer:"",images:[]}),l=le.useForm,I=u(!1),O=s=>{Object.assign(c,JSON.parse(JSON.stringify(s))),r.value=!0},S=E({question:[{required:!0,message:"请输入问题",trigger:"change"}],unknown_list:[{required:!0,message:"请输入相似问法",trigger:"change"}],answer:[{required:!0,message:"请输入答案",trigger:"change"}]}),{validate:M,validateInfos:U}=l(c,S),z=()=>{M().then(()=>{f()}).catch(s=>{})},f=()=>{let s={...c},d=s.unknown_list.trim();d?(d=d.split(`
`),s.unknown_list=JSON.stringify(d)):s.unknown_list="[]";let k=new FormData;for(let b in s)Le.isArray(s[b])?s[b].forEach(D=>{k.append(b,D)}):k.append(b,s[b]);I.value=!0,vt(k).then(b=>{V.success("保存成功"),r.value=!1,q("ok")}).finally(()=>{I.value=!1})};return N({show:O}),(s,d)=>{const k=Ce,b=Se,D=ye,T=fe,_=ve,B=ze,p=le,m=ie;return i(),v("div",null,[n(m,{open:r.value,"onUpdate:open":d[5]||(d[5]=C=>r.value=C),title:"设置答案",onOk:z,width:746,confirmLoading:I.value},{default:o(()=>[e("div",Ln,[n(p,{layout:"vertical"},{default:o(()=>[n(b,_e({label:"问题"},G(U).question),{default:o(()=>[n(k,{placeholder:"请输入问题",value:c.question,"onUpdate:value":d[0]||(d[0]=C=>c.question=C),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,_e({label:"相似问法(一行一个，最多可添加100个相似问法)"},G(U).unknown_list),{default:o(()=>[n(k,{placeholder:"请输入相似问法",value:c.unknown_list,"onUpdate:value":d[1]||(d[1]=C=>c.unknown_list=C),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,_e({label:"答案"},G(U).answer),{default:o(()=>[n(k,{placeholder:"请输入分段答案",value:c.answer,"onUpdate:value":d[2]||(d[2]=C=>c.answer=C),maxlength:1e4,style:{height:"100px"}},null,8,["value"])]),_:1},16),n(b,{label:"附件"},{default:o(()=>[e("div",Yn,[n(_,{activeKey:g.value,"onUpdate:activeKey":d[3]||(d[3]=C=>g.value=C),size:"small"},{default:o(()=>[n(T,{key:"1"},{tab:o(()=>[e("span",null,[n(D,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),d[6]||(d[6]=x(" 图片 ",-1)),c.images.length?(i(),v("span",Tn,"("+Y(c.images.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(B,{value:c.images,"onUpdate:value":d[4]||(d[4]=C=>c.images=C)},null,8,["value"])])]),_:1})]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},An=H(Nn,[["__scopeId","data-v-af7afebd"]]),Kn={class:"user-model-page"},Rn={class:"search-block"},Fn={class:"left-block"},Gn={class:"right-block"},En={class:"list-box"},jn={class:"qa-list-box"},Bn={class:"list-item"},Jn={class:"list-content"},Pn={class:"classify-scroll-box"},Qn={key:0,class:"list-item"},Vn={class:"list-content"},Hn={class:"fragment-img"},Xn=["src"],Zn={class:"import-td-box"},Wn={key:0,class:"status-block success"},eo={key:1,class:"status-block none"},to=["href"],no=["onClick"],oo=["onClick"],so={__name:"index",setup(j){const N=mt(),$=xe(),{getRobot:q}=$,a=W(()=>$.robotInfo),g=W(()=>a.value.unknown_summary_status==1),r=ne().query;De(),u(2);const c=E({start_day:"",end_day:""}),l=E({page:1,size:10,total:0}),I=u([]),O=u(!1),S=()=>{let p={robot_id:r.id,...c,...l};O.value=!0,ft({...p}).then(m=>{I.value=m.data.list.map(C=>({...C,images:C.images?JSON.parse(C.images):[],unknown_list:C.unknown_list?JSON.parse(C.unknown_list):[]})),l.total=+m.data.total||0}).finally(()=>{O.value=!1})};S();const M=p=>{let m=N.getToken,C=c.start_day,Q=c.end_day,A=`/manage/getUnknownIssueSummary?robot_id=${r.id}&token=${m}&start_day=${C}&end_day=${Q}&export=${p}`;window.location.href=A},U=p=>{l.page=p.current,l.size=p.pageSize,S()},z=()=>{l.page=1,S()},f=p=>{c.start_day=p.start_time,c.end_day=p.end_time,z()},s=u(null),d=p=>{s.value.showModal({id:p.id,library_id:p.to_library_id>0?p.to_library_id:"",answer:p.answer,question:p.question,similar_questions:p.unknown_list,images:p.images})},k=u(null),b=()=>{k.value.show({unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:a.value.unknown_summary_status})},D=p=>{p?k.value.show({unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:1}):Ue({id:r.id,unknown_summary_model_config_id:a.value.unknown_summary_model_config_id,unknown_summary_use_model:a.value.unknown_summary_use_model,unknown_summary_similarity:a.value.unknown_summary_similarity,unknown_summary_status:0}).then(m=>{V.success("保存成功"),q(r.id)})},T=u(null),_=p=>{T.value.show({id:p.id,question:p.question,answer:p.answer,unknown_list:p.unknown_list.join(`
`),images:p.images})},B=()=>{q(r.id)};return(p,m)=>{const C=$e,Q=pe,A=He,ee=ce,oe=We,X=Ze,ue=et,re=nt,Z=tt,se=ot,h=qe,t=it("viewer");return i(),v("div",Kn,[n(C,{"show-icon":"",style:{"padding-top":"16px"}},{message:o(()=>[...m[2]||(m[2]=[e("p",null,"1、开启后，系统将自动将语意相近的未知问题聚类，生成聚类问题",-1),e("p",null,"2、您可以将聚类问题导出，添加回复后更新到知识库单面。",-1)])]),_:1}),e("div",Rn,[e("div",Fn,[m[5]||(m[5]=e("span",null,"自动聚类",-1)),n(Q,null,{title:o(()=>[...m[3]||(m[3]=[x("开启后，系统将自动将语意相近的未知问题累类，生成聚类问题",-1)])]),default:o(()=>[n(G(Me)),m[4]||(m[4]=x("： ",-1))]),_:1}),n(A,{onChange:D,checked:g.value,"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("a",{onClick:b},"设置")]),e("div",Gn,[n(Ye,{datekey:"4",onDateChange:f}),n(ee,{type:"primary",onClick:z},{default:o(()=>[...m[6]||(m[6]=[x("查询",-1)])]),_:1}),n(ue,null,{overlay:o(()=>[n(X,null,{default:o(()=>[n(oe,{onClick:m[0]||(m[0]=y=>M("docx")),key:"1"},{default:o(()=>[...m[7]||(m[7]=[x("下载为docx",-1)])]),_:1}),n(oe,{onClick:m[1]||(m[1]=y=>M("xlsx")),key:"2"},{default:o(()=>[...m[8]||(m[8]=[x("下载为xlsx",-1)])]),_:1})]),_:1})]),default:o(()=>[n(ee,{type:"primary"},{default:o(()=>[m[9]||(m[9]=x(" 下载 ",-1)),n(G(Xe))]),_:1})]),_:1})])]),e("div",En,[n(h,{"data-source":I.value,loading:O.value,pagination:{current:l.page,total:l.total,pageSize:l.size,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},onChange:U},{default:o(()=>[n(Z,{key:"question",title:"聚类问题",width:480},{default:o(({record:y})=>[e("div",jn,[e("div",Bn,[m[10]||(m[10]=e("div",{class:"list-label"},"问题",-1)),e("div",Jn,[x(Y(y.question)+" ",1),y.unknown_total>0?(i(),R(re,{key:0,placement:"topLeft"},{content:o(()=>[e("div",Pn,[(i(!0),v(F,null,te(y.unknown_list,(L,J)=>(i(),v("div",{class:"list-item",key:J},Y(L),1))),128))])]),title:o(()=>[e("span",null,"共聚类了"+Y(y.unknown_total)+"个未知问题",1)]),default:o(()=>[e("a",null,"（"+Y(y.unknown_total)+"） ",1)]),_:2},1024)):P("",!0)])]),y.answer?(i(),v("div",Qn,[m[11]||(m[11]=e("div",{class:"list-label"},"答案",-1)),e("div",Vn,Y(y.answer),1)])):P("",!0),me((i(),v("div",Hn,[(i(!0),v(F,null,te(y.images,(L,J)=>(i(),v("img",{key:J,src:L,alt:""},null,8,Xn))),128))])),[[t]])])]),_:1}),n(Z,{key:"show_date",title:"触发日期",width:120},{default:o(({record:y})=>[x(Y(y.show_date),1)]),_:1}),n(Z,{key:"to_library_id",title:"是否导入知识库",width:160},{default:o(({record:y})=>[e("div",Zn,[y.to_library_id>0?(i(),v("div",Wn,[...m[12]||(m[12]=[e("span",null,null,-1),x(" 已导入 ",-1)])])):(i(),v("div",eo,[...m[13]||(m[13]=[e("span",null,null,-1),x(" 未导入 ",-1)])])),e("a",{href:`/#/library/details/knowledge-document?id=${y.to_library_id}`,target:"_blank"},Y(y.to_library_name),9,to)])]),_:1}),n(Z,{key:"action",title:"操作",width:135},{default:o(({record:y})=>[n(se,{gap:8},{default:o(()=>[e("a",{onClick:L=>_(y)},"设置答案",8,no),e("a",{onClick:L=>d(y)},"导入知识库",8,oo)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading","pagination"])]),n(Dn,{onOk:S,ref_key:"importLibraryModalRef",ref:s},null,512),n(zn,{onOk:B,ref_key:"autoClusterModalRef",ref:k},null,512),n(An,{onOk:S,ref_key:"setAnswerModalRef",ref:T},null,512)])}}},ao=H(so,[["__scopeId","data-v-29668232"]]),lo={class:"user-model-page"},he="/robot/config/unknown_issue/activeKey",io={__name:"unknow-index",setup(j){const N=xe(),$=u(+localStorage.getItem(he)||1),q=W(()=>N.robotInfo),a=W(()=>q.value.unknown_summary_status==1),g=()=>{localStorage.setItem(he,$.value)};return(r,c)=>{const l=fe,I=ve,O=Re;return i(),v(F,null,[n(I,{class:"tab-wrapper",activeKey:$.value,"onUpdate:activeKey":c[0]||(c[0]=S=>$.value=S),onChange:g},{default:o(()=>[a.value?(i(),v(F,{key:0},[(i(),R(l,{key:2,tab:"未知问题总结"})),(i(),R(l,{key:1,tab:"未知问题统计"}))],64)):(i(),v(F,{key:1},[(i(),R(l,{key:1,tab:"未知问题统计"})),(i(),R(l,{key:2,tab:"未知问题总结"}))],64))]),_:1},8,["activeKey"]),e("div",lo,[n(O,null,{default:o(()=>[$.value==1?(i(),R(At,{key:0})):(i(),R(ao,{key:1}))]),_:1})])],64)}}},Io=H(io,[["__scopeId","data-v-5395bc93"]]);export{Io as default};
