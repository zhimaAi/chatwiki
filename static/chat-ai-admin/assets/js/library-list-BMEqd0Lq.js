import{_ as Ne}from"./cu-scroll-BmJNJRCz.js";import{_ as ae,a as Ie,ae as Ve,ad as Ee,d as Ce,bf as He,ax as pe,ay as ce,bg as De,bh as Ze,bi as Pe,ah as Oe,aP as je,f as Je,B as Me,aw as Qe,aR as Ke,bj as Ye,bk as We,bl as Xe}from"../../index-C1Xsov4S.js";import{e as fe,Y as f,_ as d,a1 as z,F as D,ab as Ge,a5 as n,ae as A,a7 as Q,k as a,a2 as o,u as C,B as N,f as p,r as xe,o as e2,n as oe,G as u,A as se,ac as P,y as t2,a9 as Ue,aa as a2}from"./vue-chunks-DCKTEHpB.js";import{E as l2}from"./empty-box-vvdJX5k0.js";import{p as we,e as ze,f as Te,h as qe,R as be,M as te,a as V,F as n2,b as o2,I as Be,X as s2,v as Re,w as Fe,J as i2,aD as r2,a9 as d2,ae as W,N as _2,H as u2,q as p2,u as c2,B as f2,a3 as Ae,ao as m2,ay as v2,Q as Se}from"./ui-antd-D64OvTpt.js";import{A as h2}from"./avatar-input-CkEKiDLT.js";import{t as k2}from"./validate-8MtiUsxW.js";import{M as ge}from"./model-select-Dnf798RG.js";import{O as g2}from"./open-grapg-modal-Bshg93js.js";import{P as y2}from"./page-tabs-KBDWT8vG.js";import{_ as b2}from"./page-alert-Bo_UnvJL.js";import{L as C2}from"./list-tabs-BOqV1hiy.js";import{d as x2}from"./vuedraggable.umd-B9hsMa4o.js";import{a as w2}from"./index-CTy81fs2.js";import{S as $2}from"./select-wechat-app-DMdcYQSd.js";import"./pull-up.esm-DIiTC7VE.js";import"./observe-dom.esm-B25JyVKH.js";import"./utils-D9NMMoMR.js";import"./empty-BFmzY9bl.js";import"./index-DTf9Tj4Y.js";import"./loading-box-CyUSXD2F.js";import"./index-DLEjqKv8.js";const L2="data:image/svg+xml,%3csvg%20width='62'%20height='62'%20viewBox='0%200%2062%2062'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2016C0%207.16344%207.16344%200%2016%200H46C54.8366%200%2062%207.16344%2062%2016V46C62%2054.8366%2054.8366%2062%2046%2062H16C7.16344%2062%200%2054.8366%200%2046V16Z'%20fill='%2321A665'/%3e%3cg%20filter='url(%23filter0_d_11589_11828)'%3e%3cpath%20d='M17.5418%2041.2916C17.5418%2035.1931%2017.5418%2020.7083%2017.5418%2020.7083C17.5418%2018.0849%2019.6685%2015.9583%2022.2918%2015.9583H39.7085V36.5416C39.7085%2036.5416%2026.4343%2036.5416%2022.2918%2036.5416C19.6793%2036.5416%2017.5418%2038.6666%2017.5418%2041.2916Z'%20fill='white'%20stroke='white'%20stroke-width='3.16667'%20stroke-linejoin='round'/%3e%3cpath%20d='M39.7085%2036.5417C39.7085%2036.5417%2023.2052%2036.5417%2022.2918%2036.5417C19.6685%2036.5417%2017.5418%2038.6684%2017.5418%2041.2917C17.5418%2043.9151%2019.6685%2046.0417%2022.2918%2046.0417C24.0407%2046.0417%2032.4852%2046.0417%2044.4585%2046.0417V17.5417'%20stroke='white'%20stroke-width='3.16667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M23.0832%2041.2917H38.9165'%20stroke='white'%20stroke-width='3.16667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M34.1961%2020.5428C33.3496%2018.8498%2031.2939%2017.2778%2028.7545%2017.2778C27.5453%2017.2778%2025.6105%2017.7615%2024.1595%2019.5754C23.0712%2020.6637%2022.8293%2022.1148%2022.9502%2023.4449C23.0712%2024.4123%2023.6758%2025.6215%2024.4013%2026.468C24.6432%2024.4123%2025.7315%2022.8403%2027.1825%2021.752C29.601%2019.8172%2032.2613%2019.9381%2034.1961%2020.5428Z'%20fill='%2321A665'/%3e%3cpath%20d='M36.2518%2023.5658C34.6798%2021.631%2032.1404%2021.0264%2029.722%2021.8729C29.8429%2021.8729%2029.8429%2021.8729%2029.9638%2021.9938C33.4706%2023.2031%2035.4054%2027.0726%2034.1961%2030.5794C33.8334%2031.5467%2033.3497%2032.3932%2032.7451%2032.9978C33.4706%2032.756%2034.3171%2032.5141%2034.9217%2032.0304C37.582%2029.8538%2038.0657%2026.1052%2036.2518%2023.5658Z'%20fill='%2321A665'/%3e%3cpath%20d='M28.7546%2029.8538C28.2709%2029.8538%2027.6663%2029.7329%2027.1826%2029.7329H26.9407C26.8198%2029.7329%2026.6989%2029.7329%2026.578%2029.8538L24.885%2030.9422H24.7641C24.6432%2030.9422%2024.5223%2030.8212%2024.5223%2030.7003V30.4585C24.5223%2030.4585%2024.7641%2029.612%2024.7641%2029.1283V29.0074C24.7641%2028.8865%2024.6432%2028.6446%2024.5223%2028.6446C22.8293%2027.4354%2021.6201%2025.6215%2021.3783%2023.6868C21.0155%2024.4123%2020.8946%2024.896%2020.6527%2025.7425C19.8063%2028.7655%2021.6201%2032.2723%2024.6432%2033.2397C28.15%2034.328%2031.4149%2033.1188%2032.6241%2030.0957C32.745%2029.7329%2032.866%2029.1283%2032.9869%2028.6446C31.7776%2029.4911%2030.4475%2029.8538%2028.7546%2029.8538Z'%20fill='%2321A665'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='filter0_d_11589_11828'%20x='8'%20y='12'%20width='46'%20height='46'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20type='matrix'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='4'/%3e%3cfeGaussianBlur%20stdDeviation='2'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20type='matrix'%20values='0%200%200%200%200.0886636%200%200%200%200%200.202211%200%200%200%200%200.413084%200%200%200%200.14%200'/%3e%3cfeBlend%20mode='normal'%20in2='BackgroundImageFix'%20result='effect1_dropShadow_11589_11828'/%3e%3cfeBlend%20mode='normal'%20in='SourceGraphic'%20in2='effect1_dropShadow_11589_11828'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",M2={class:"list-box"},A2=["onClick"],S2={class:"library-info"},I2={class:"library-icon"},O2=["src"],G2={key:0,class:"sync-tag run"},U2={key:1,class:"sync-tag fail"},z2={class:"library-info-content"},T2={class:"library-title"},q2={class:"library-type"},B2={key:0,class:"type-tag"},R2={key:1,class:"type-tag"},F2={key:2,class:"type-tag"},N2={key:3,class:"type-tag"},V2={class:"item-body"},E2={class:"item-footer"},H2={class:"library-size"},D2={class:"text-item"},Z2={class:"text-item"},P2={class:"text-item"},j2=["onClick"],J2=["onClick"],Q2={__name:"index",props:{list:{type:Array,default:()=>[]}},emits:["add","edit","delete","openEditGroupModal"],setup(X,{emit:T}){const U=T,x=Ie();fe(()=>{var m;return((m=x.companyInfo)==null?void 0:m.neo4j_status)=="true"});const S=X,w=m=>{U("edit",m)},g=m=>{U("delete",m)},$=m=>{U("openEditGroupModal",m)};return(m,e)=>{const _=we,y=Ce,v=Te,k=ze,O=qe;return d(),f("div",M2,[S.list.length?(d(!0),f(D,{key:0},Ge(S.list,c=>(d(),f("div",{class:"list-item-wrapper",key:c.id},[n("div",{class:"list-item",onClick:N(b=>w(c),["stop"])},[n("div",S2,[n("div",I2,[n("img",{src:c.avatar},null,8,O2),c.type==3?(d(),f(D,{key:0},[c.sync_official_content_status==2?(d(),f("span",G2,"同步中")):c.sync_official_content_status==3?(d(),f("span",U2,"同步失败")):A("",!0)],64)):A("",!0)]),n("div",z2,[n("div",T2,Q(c.library_name),1),n("div",q2,[c.type==0?(d(),f("span",B2,"普通知识库")):A("",!0),c.type==1?(d(),f("span",R2,"对外知识库")):A("",!0),c.type==2?(d(),f("span",F2,"问答知识库")):A("",!0),c.type==3?(d(),f("span",N2,"公众号知识库")):A("",!0)])])]),n("div",V2,[a(_,{title:C(Ee)(c.library_intro,c,14,2,0),placement:"top"},{default:o(()=>[n("div",{class:"library-desc",ref_for:!0,ref:b=>C(Ve)(b,c)},Q(c.library_intro),513)]),_:2},1032,["title"])]),n("div",E2,[n("div",H2,[n("span",D2,"文档："+Q(c.file_total),1),n("span",Z2,"大小："+Q(c.file_size_str),1),n("span",P2,"关联应用："+Q(c.robot_nums||0),1)]),n("div",{class:"action-box",onClick:e[1]||(e[1]=N(()=>{},["stop"]))},[a(O,null,{overlay:o(()=>[a(k,null,{default:o(()=>[a(v,null,{default:o(()=>[n("a",{class:"delete-text-color",href:"javascript:;",onClick:N(b=>g(c),["stop"])},"删 除",8,j2)]),_:2},1024),a(v,null,{default:o(()=>[n("div",{onClick:N(b=>$(c),["stop"])},"修改分组",8,J2)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",{class:"action-item",onClick:e[0]||(e[0]=N(()=>{},["stop"]))},[a(y,{class:"action-icon",name:"point-h"})])]),_:2},1024)])])],8,A2)]))),128)):(d(),z(l2,{key:1,style:{"margin-top":"80px"}}))])}}},K2=ae(Q2,[["__scopeId","data-v-ad9571d5"]]),Y2="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.8066%2055.3034C14.0866%2051.3489%2011.0624%2045.5975%2015.5685%2027.6849C20.074%209.77234%2025.4347%206.23271%2041.1546%2010.1872C56.8746%2014.1417%2059.8378%2019.7747%2055.3323%2037.6873C50.8267%2055.5999%2045.5265%2059.2579%2029.8059%2055.3034H29.8066Z'%20fill='%232475FC'/%3e%3cpath%20d='M27.6401%2056.8699C9.97054%2056.8699%205.24487%2051.5938%205.24487%2031.46C5.24487%2011.3261%209.97054%206.15887%2027.6401%206.15887C45.3096%206.15887%2049.9398%2011.3261%2049.9398%2031.46C49.9398%2051.5938%2045.3096%2056.8699%2027.6401%2056.8699Z'%20fill='%232CAAFF'/%3e%3cpath%20d='M38.7639%2045.5143H36.8936C36.3373%2045.5143%2035.8577%2045.4677%2035.4549%2045.3743C35.052%2045.281%2034.7067%2045.1363%2034.419%2044.9403C34.1313%2044.7443%2033.8867%2044.497%2033.6853%2044.1983C33.4838%2043.8997%2033.2968%2043.5543%2033.1242%2043.1623C32.8364%2042.453%2032.5727%2041.809%2032.3329%2041.2303C32.0931%2040.6517%2031.8869%2040.1477%2031.7142%2039.7183C31.5032%2039.233%2031.3114%2038.785%2031.1388%2038.3743H23.974C23.8397%2038.8037%2023.6767%2039.2703%2023.4849%2039.7743C23.3314%2040.2037%2023.13%2040.7217%2022.8806%2041.3283C22.6312%2041.935%2022.3435%2042.593%2022.0174%2043.3023C21.6337%2044.1423%2021.1925%2044.721%2020.6938%2045.0383C20.195%2045.3557%2019.6291%2045.5143%2018.9961%2045.5143H17.0107C16.1667%2045.5143%2015.596%2045.3323%2015.2986%2044.9683C15.0013%2044.6043%2015.0253%2043.9837%2015.3706%2043.1063C15.7159%2042.2663%2016.1187%2041.277%2016.5791%2040.1383C17.0395%2038.9997%2017.5286%2037.791%2018.0466%2036.5123C18.5645%2035.2337%2019.1016%2033.9223%2019.6579%2032.5783C20.2142%2031.2343%2020.7513%2029.9183%2021.2693%2028.6303C22.497%2025.625%2023.7822%2022.4983%2025.125%2019.2503C25.2593%2018.933%2025.4319%2018.6437%2025.6429%2018.3823C25.8347%2018.177%2026.0889%2017.981%2026.4054%2017.7943C26.7219%2017.6077%2027.12%2017.5143%2027.5996%2017.5143C28.0983%2017.5143%2028.5059%2017.6123%2028.8224%2017.8083C29.139%2018.0043%2029.4027%2018.2237%2029.6137%2018.4663C29.8439%2018.7463%2030.0262%2019.0543%2030.1604%2019.3903C31.5224%2022.6757%2032.8172%2025.821%2034.0449%2028.8263C34.5629%2030.1143%2035.1%2031.4257%2035.6563%2032.7603C36.2126%2034.095%2036.7449%2035.3923%2037.2532%2036.6523C37.7616%2037.9123%2038.2412%2039.093%2038.6919%2040.1943C39.1427%2041.2957%2039.5312%2042.2477%2039.8573%2043.0503C40.1259%2043.685%2040.1642%2044.2543%2039.9724%2044.7583C39.7806%2045.2623%2039.3777%2045.5143%2038.7639%2045.5143ZM30.4194%2034.8743L27.6859%2025.3823H27.6571L24.607%2034.8743H30.4194Z'%20fill='white'/%3e%3c/svg%3e",W2="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2062%2062'%20class='design-iconfont'%3e%3cpath%20d='M0%2014.5882C0%206.53137%206.53137%200%2014.5882%200H47.4118C55.4686%200%2062%206.53137%2062%2014.5882V47.4118C62%2055.4686%2055.4686%2062%2047.4118%2062H14.5882C6.53137%2062%200%2055.4686%200%2047.4118V14.5882Z'%20fill='%234876FF'/%3e%3cg%20filter='url(%23kd70btl3k__filter0_d_7802_38768)'%3e%3cpath%20d='M42.8433%2015.6719H27.4866C24.6533%2015.6719%2022.33%2017.9952%2022.33%2020.8852V32.6152C22.33%2035.5052%2024.6533%2037.8285%2027.4866%2037.8285H37.861L41.4876%2041.1719C42.5076%2042.1352%2044.2643%2041.4552%2044.2643%2040.0385V37.7719C47.041%2037.7719%2048%2035.4485%2048%2032.6152V20.8852C48%2017.9952%2045.6766%2015.6719%2042.8433%2015.6719Z'%20fill='%23D6E0FF'/%3e%3cpath%20d='M36.9952%2017.1719H19.7806C16.6044%2017.1719%2014%2019.7763%2014%2023.016V36.1652C14%2039.3413%2016.5409%2041.9458%2019.6535%2042.0093V44.5502C19.6535%2046.1383%2021.6227%2046.9005%2022.7661%2045.8206L26.8316%2042.0728H36.9952C40.1714%2042.0728%2042.7758%2039.4684%2042.7758%2036.2287V23.016C42.7758%2019.7763%2040.1714%2017.1719%2036.9952%2017.1719Z'%20fill='%23EBF0FF'/%3e%3cpath%20d='M35.8572%2028.9015C35.8572%2026.5396%2035.2018%2024.6658%2033.8911%2023.2801C32.5804%2021.8944%2030.8072%2021.1995%2028.5715%2021.1953C26.342%2021.1953%2024.5709%2021.8881%2023.2581%2023.2738C21.9453%2024.6595%2021.2878%2026.5259%2021.2858%2028.8732C21.2858%2031.1973%2021.9401%2033.0564%2023.2487%2034.4505C24.5574%2035.8446%2026.2974%2036.5427%2028.4688%2036.5447C29.0683%2036.5626%2029.6676%2036.5012%2030.2514%2036.3621C30.3074%2036.4093%2030.9638%2037.4265%2031.7726%2037.8863C32.3384%2038.2078%2033.0977%2038.2247%2033.6736%2038.1731C34.1554%2038.1299%2034.4572%2037.6737%2034.3836%2037.1957C34.3104%2036.7211%2033.8837%2036.3943%2033.42%2036.2696C33.3237%2036.2437%2033.2286%2036.2126%2033.1352%2036.1763C32.8819%2036.0309%2032.6781%2035.8113%2032.5503%2035.5464C34.757%2034.1965%2035.8593%2031.9815%2035.8572%2028.9015ZM31.278%2032.8475L31.1286%2033.0396C31.0602%2033.131%2030.6433%2032.1641%2029.6292%2031.8492C29.0996%2031.7142%2028.5513%2031.6807%2028.0124%2031.7487C27.6975%2031.7884%2027.4827%2032.0714%2027.4827%2032.3888C27.4827%2032.7549%2027.771%2033.0497%2028.1222%2033.153C28.3685%2033.2254%2028.6053%2033.33%2028.8266%2033.4648C29.2341%2033.7797%2029.5919%2034.186%2029.4176%2034.2332C29.113%2034.3135%2028.7992%2034.3527%2028.4844%2034.3497C27.9396%2034.3544%2027.403%2034.2154%2026.9274%2033.9465C26.4518%2033.6776%2026.0535%2033.288%2025.7717%2032.816C25.0935%2031.7873%2024.7534%2030.4394%2024.7513%2028.7724C24.7492%2027.1054%2025.0894%2025.7565%2025.7717%2024.7256C26.0684%2024.2609%2026.4754%2023.8788%2026.9555%2023.6142C27.4356%2023.3497%2027.9735%2023.2111%2028.5201%2023.2111C29.0668%2023.2111%2029.6047%2023.3497%2030.0848%2023.6142C30.5649%2023.8788%2030.9719%2024.2609%2031.2686%2024.7256C31.9592%2025.7313%2032.3046%2027.0739%2032.3046%2028.7535C32.3046%2030.4772%2031.9624%2031.8419%2031.278%2032.8475Z'%20fill='%234876FF'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='kd70btl3k__filter0_d_7802_38768'%20x='9.875'%20y='15.6719'%20width='42.25'%20height='38.9023'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='4.125'/%3e%3cfeGaussianBlur%20stdDeviation='2.0625'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20values='0%200%200%200%200.413084%200%200%200%200%200.250874%200%200%200%200%200.0886636%200%200%200%200.14%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20result='effect1_dropShadow_7802_38768'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect1_dropShadow_7802_38768'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",X2={class:"add-libray-popup",ref:"modal"},et={class:"add-libray-popup-body"},tt={class:"libray-type-list"},at={class:"libray-action"},lt={class:"libray-action"},nt={__name:"add-libray-popup",emits:["ok"],setup(X,{expose:T,emit:U}){const x=U,S=p(!1),w=()=>{S.value=!0},g=()=>{S.value=!1},$=e=>{S.value=!1,x("ok",e)},m=e=>{$(e)};return T({show:w,close:g}),(e,_)=>{const y=te;return d(),f("div",X2,[a(y,{footer:null,getContainer:()=>e.$refs.modal,open:S.value,"onUpdate:open":_[2]||(_[2]=v=>S.value=v),title:"",width:520,onOk:$},{default:o(()=>[n("div",et,[_[7]||(_[7]=n("div",{class:"popup-title"},"新建知识库",-1)),n("div",tt,[n("div",{class:"libray-item",onClick:_[0]||(_[0]=v=>m(0))},[_[3]||(_[3]=n("div",{class:"libray-item-header"},[n("img",{class:"libray-icon",src:Y2,alt:""}),n("div",{class:"libray-type-name"},"普通知识库")],-1)),_[4]||(_[4]=n("div",{class:"libray-desc"}," 导入文档或网页创建知识库，知识库可以与聊天机器人或工作流关联。用户和机器人聊天时，机器人可以引用知识库内知识回复用户 ",-1)),n("div",at,[a(C(be))])]),n("div",{class:"libray-item",onClick:_[1]||(_[1]=v=>m(2))},[_[5]||(_[5]=n("div",{class:"libray-item-header"},[n("img",{class:"libray-icon",src:W2,alt:""}),n("div",{class:"libray-type-name"},"问答知识库")],-1)),_[6]||(_[6]=n("div",{class:"libray-desc"}," 通过excel或者word导入FAQ问答对构建知识库，适合客服场景或者需要用FAQ问答数据精确回答的场景。用户提问时，如果系统检索到与用户问题匹配度很高的问答对，会直接回复对应的答案。 ",-1)),n("div",lt,[a(C(be))])])])])]),_:1},8,["getContainer","open"])],512)}}},ot=ae(nt,[["__scopeId","data-v-0c724719"]]),st={class:"form-box"},it={class:"indexing-methods-box"},rt={class:"list-title-block"},dt={class:"list-title-block"},_t={class:"select-card-box"},ut={class:"card-title"},pt={class:"card-title"},ct={class:"card-title"},ft={class:"card-title"},mt={class:"graph-switch-box"},vt={class:"lable-text"},ht={class:"graph-switch-box"},kt={class:"lable-text"},ye="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",gt={__name:"add-library-model",setup(X,{expose:T}){const U=Ie(),x=fe(()=>{var s;return((s=U.companyInfo)==null?void 0:s.neo4j_status)=="true"});V.config({duration:2});const S=p(null),w=p(!0),g=Ue(),$=p(!1),m=p(!1),e=xe({type:"0",access_rights:0,library_name:"",library_intro:"",use_model:"",model_config_id:"",library_files:void 0,avatar:"",avatar_file:void 0,is_offline:!1,urls:"",doc_type:1,file_name:"",is_qa_doc:0,qa_index_type:1,doc_auto_renew_frequency:1,chunk_type:1,normal_chunk_default_separators_no:[12,11],normal_chunk_default_chunk_size:512,normal_chunk_default_chunk_overlap:50,semantic_chunk_default_chunk_size:512,semantic_chunk_default_chunk_overlap:50,semantic_chunk_default_threshold:90,normal_chunk_default_not_merged_text:"false",graph_switch:!1,graph_model_config_id:void 0,graph_use_model:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:ye,group_id:0,father_chunk_paragraph_type:2,father_chunk_separators_no:[],father_chunk_chunk_size:1024,son_chunk_separators_no:[],son_chunk_chunk_size:512,sync_official_history_type:2,enable_cron_sync_official_content:!0,app_id_list:""}),_=s=>{e.avatar=s.imageUrl,e.avatar_file=s.file},y=p([]);He().then(s=>{y.value=s.data.map(t=>({label:t.name,value:t.no}))});const v=s=>{e.chunk_type=s},k=p([]),O=s=>{k.value=s,t2(()=>{(!e.ai_chunk_model||!Number(e.ai_chunk_model_config_id))&&c()})},c=()=>{if(k.value.length>0){let s=null,t=null;for(let L of k.value)if(L.model_define==="tongyi"){s=L;for(let i of s.children)if(i.name==="qwen-max"){t=i;break}break}s||(s=k.value[0],t=s.children[0]),s&&t&&(e.ai_chunk_model=t.name,e.ai_chunk_model_config_id=t.model_config_id)}},b=s=>{s.length&&(e.use_model=s[0].children[0].name,e.model_config_id=s[0].model_config_id)},ie=p(null),me=s=>{if(s){let t={graph_model_config_id:e.graph_model_config_id,graph_use_model:e.graph_use_model};if((!e.graph_model_config_id||!e.graph_use_model)&&k.value.length>0){let L=k.value[0];if(L){let i=L.children[0];t.graph_use_model=i.name,t.graph_model_config_id=i.model_config_id}}ie.value.show(t)}else e.graph_switch=!1},j=s=>{s.graph_model_config_id&&(e.graph_switch=!0,e.graph_model_config_id=s.graph_model_config_id,e.graph_use_model=s.graph_use_model)},ee=()=>{$.value=!1},le=()=>{S.value.validate().then(()=>{re()}).catch(s=>{})},re=()=>{let s=new FormData,t=JSON.parse(JSON.stringify(e));s.append("type",e.type),s.append("access_rights",e.access_rights),s.append("library_name",e.library_name),s.append("qa_index_type",e.qa_index_type),s.append("library_intro",e.library_intro),s.append("use_model",t.use_model),s.append("model_config_id",e.model_config_id),s.append("avatar",e.avatar_file?e.avatar_file:""),s.append("is_offline",e.is_offline),s.append("urls",JSON.stringify(k2(e.urls))),s.append("doc_type",e.doc_type),s.append("file_name",e.file_name),s.append("is_qa_doc",e.is_qa_doc),s.append("qa_index_type",e.qa_index_type),s.append("doc_auto_renew_frequency",e.doc_auto_renew_frequency),s.append("chunk_type",e.chunk_type),s.append("normal_chunk_default_separators_no",JSON.stringify(e.normal_chunk_default_separators_no)),s.append("normal_chunk_default_not_merged_text",e.normal_chunk_default_not_merged_text),s.append("normal_chunk_default_chunk_size",e.normal_chunk_default_chunk_size),s.append("normal_chunk_default_chunk_overlap",e.normal_chunk_default_chunk_overlap),s.append("semantic_chunk_default_chunk_size",e.semantic_chunk_default_chunk_size),s.append("semantic_chunk_default_chunk_overlap",e.semantic_chunk_default_chunk_overlap),s.append("semantic_chunk_default_threshold",e.semantic_chunk_default_threshold),s.append("graph_switch",e.graph_switch?1:0),s.append("graph_model_config_id",e.graph_model_config_id),s.append("graph_use_model",e.graph_use_model),s.append("ai_chunk_size",e.ai_chunk_size),s.append("ai_chunk_model",e.ai_chunk_model),s.append("ai_chunk_model_config_id",e.ai_chunk_model_config_id),s.append("ai_chunk_prumpt",e.ai_chunk_prumpt),s.append("father_chunk_paragraph_type",e.father_chunk_paragraph_type),s.append("father_chunk_separators_no",JSON.stringify(e.father_chunk_separators_no)),s.append("son_chunk_separators_no",JSON.stringify(e.son_chunk_separators_no)),s.append("father_chunk_chunk_size",e.father_chunk_chunk_size),s.append("son_chunk_chunk_size",e.son_chunk_chunk_size),s.append("group_id",e.group_id),s.append("is_default",2);let L=De;e.type==3&&(L=Ze,s.append("app_id_list",e.app_id_list),s.append("sync_official_history_type",e.sync_official_history_type),s.append("enable_cron_sync_official_content",Number(e.enable_cron_sync_official_content))),m.value=!0,L(s).then(i=>{var Z,J;V.success("创建成功"),$.value=!1;let K="/library/details/knowledge-document",q;e.type==3?q={id:(Z=i==null?void 0:i.data)==null?void 0:Z[0]}:(q={id:(J=i==null?void 0:i.data)==null?void 0:J.id},e.doc_type==3&&(K="/library/preview",q={id:i.data.file_ids[0]})),g.push({path:K,query:q}),m.value=!1,$.value=!1}).catch(()=>{m.value=!1})},ve=({type:s,group_id:t,wx_app_ids:L})=>{e.type=s,s==3?e.app_id_list=L:s==0?(e.avatar=pe,e.avatar_file=pe):(e.avatar=ce,e.avatar_file=ce),e.library_name="",e.library_intro="",e.qa_index_type=1,e.chunk_type=1,e.normal_chunk_default_separators_no=[12,11],e.normal_chunk_default_chunk_size=512,e.normal_chunk_default_chunk_overlap=50,e.normal_chunk_default_not_merged_text="false",e.semantic_chunk_default_chunk_size=512,e.semantic_chunk_default_chunk_overlap=50,e.semantic_chunk_default_threshold=50,e.graph_switch=!1,e.father_chunk_paragraph_type=2,e.father_chunk_separators_no=[12,11],e.father_chunk_chunk_size=1024,e.son_chunk_separators_no=[8,10],e.son_chunk_chunk_size=512,e.ai_chunk_size=5e3,e.ai_chunk_model="",e.ai_chunk_model_config_id="",e.ai_chunk_prumpt=ye,e.group_id=t||0,$.value=!0},ne=s=>{s!=e.qa_index_type&&(e.qa_index_type=s)};return T({show:ve}),e2(()=>{}),(s,t)=>{const L=Be,i=o2,K=s2,q=Fe,Z=Re,J=i2,E=we,G=Ce,B=u2,R=_2,de=c2,he=p2,ke=n2,_e=te;return d(),f(D,null,[a(_e,{open:$.value,"onUpdate:open":t[32]||(t[32]=l=>$.value=l),title:"添加知识库",onOk:le,confirmLoading:m.value,wrapClassName:"no-padding-modal",bodyStyle:{"padding-right":"24px","max-height":"540px","overflow-y":"auto"},onCancel:ee,width:"620px"},{default:o(()=>[n("div",st,[a(ke,{layout:"vertical",ref_key:"formRef",ref:S,model:e},{default:o(()=>[e.type!=3?(d(),f(D,{key:0},[a(i,{ref:"name",name:"library_name",label:"知识库名称",rules:[{required:!0,message:"请输入库名称",trigger:"change"}]},{default:o(()=>[a(L,{value:e.library_name,"onUpdate:value":t[0]||(t[0]=l=>e.library_name=l),placeholder:"请输入知识库名称，最多20个字",maxlength:20},null,8,["value"])]),_:1},512),a(i,{label:"知识库简介"},{default:o(()=>[a(K,{maxlength:1e3,value:e.library_intro,"onUpdate:value":t[1]||(t[1]=l=>e.library_intro=l),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1}),a(i,{ref:"name",label:"知识库封面"},{default:o(()=>[a(h2,{value:e.avatar,"onUpdate:value":t[2]||(t[2]=l=>e.avatar=l),onChange:_},null,8,["value"]),t[33]||(t[33]=n("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1))]),_:1},512)],64)):(d(),f(D,{key:1},[a(i,{label:"历史发布内容获取时间段"},{default:o(()=>[a(Z,{value:e.sync_official_history_type,"onUpdate:value":t[3]||(t[3]=l=>e.sync_official_history_type=l)},{default:o(()=>[a(q,{value:10},{default:o(()=>[...t[34]||(t[34]=[u("全部",-1)])]),_:1}),a(q,{value:1},{default:o(()=>[...t[35]||(t[35]=[u("半年内",-1)])]),_:1}),a(q,{value:2},{default:o(()=>[...t[36]||(t[36]=[u("一年内",-1)])]),_:1}),a(q,{value:3},{default:o(()=>[...t[37]||(t[37]=[u("三年以内",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(i,{label:"每天3:00获取最新发布内容"},{default:o(()=>[a(J,{checked:e.enable_cron_sync_official_content,"onUpdate:checked":t[4]||(t[4]=l=>e.enable_cron_sync_official_content=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})],64)),n("div",{class:"hight-set-text",onClick:t[5]||(t[5]=l=>w.value=!w.value)},[w.value?(d(),z(C(r2),{key:0})):(d(),z(C(d2),{key:1})),t[38]||(t[38]=u(" 高级设置 ",-1)),t[39]||(t[39]=n("span",{style:{color:"#8c8c8c"}},"适用于高级用户",-1))]),oe(a(i,null,{label:o(()=>[t[41]||(t[41]=u("文档解析向量模型 ",-1)),a(E,null,{title:o(()=>[...t[40]||(t[40]=[u("向量模型可以将分段数据转化为向量形式，存储到向量数据库中，便于后续根据用户问题查询匹配。",-1)])]),default:o(()=>[a(C(W),{class:"ml4"})]),_:1})]),default:o(()=>[a(ge,{modelType:"TEXT EMBEDDING",modeName:e.use_model,"onUpdate:modeName":t[6]||(t[6]=l=>e.use_model=l),modeId:e.model_config_id,"onUpdate:modeId":t[7]||(t[7]=l=>e.model_config_id=l),onLoaded:b,style:{width:"100%"}},null,8,["modeName","modeId"])]),_:1},512),[[se,!w.value]]),oe(a(i,{label:"索引方式"},{default:o(()=>[n("div",it,[n("div",{class:P(["list-item",{active:e.qa_index_type==1}]),onClick:t[8]||(t[8]=l=>ne(1))},[a(G,{class:"check-icon",name:"check-arrow-filled"}),n("div",rt,[a(G,{name:"file-search"}),t[42]||(t[42]=u(" 问题与答案一起生成索引 ",-1))]),t[43]||(t[43]=n("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1))],2),n("div",{class:P(["list-item",{active:e.qa_index_type==2}]),onClick:t[9]||(t[9]=l=>ne(2))},[a(G,{class:"check-icon",name:"check-arrow-filled"}),n("div",dt,[a(G,{name:"comment-search"}),t[44]||(t[44]=u(" 仅对问题生成索引 ",-1))]),t[45]||(t[45]=n("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1))],2)])]),_:1},512),[[se,!w.value&&e.type==2]]),oe(n("div",null,[a(i,{label:"分段方式",required:""},{default:o(()=>[t[54]||(t[54]=n("div",{class:"form-alert-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),n("div",_t,[n("div",{class:P(["select-card-item",{active:e.chunk_type==1}]),onClick:t[10]||(t[10]=l=>v(1))},[a(G,{class:"check-arrow",name:"check-arrow-filled"}),n("div",ut,[a(G,{name:"ordinary-segmentation",class:"title-icon"}),t[46]||(t[46]=u(" 普通分段 ",-1))]),t[47]||(t[47]=n("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1))],2),n("div",{class:P(["select-card-item",{active:e.chunk_type==2}]),onClick:t[11]||(t[11]=l=>v(2))},[a(G,{class:"check-arrow",name:"check-arrow-filled"}),n("div",pt,[a(G,{name:"semantic-segmentation",class:"title-icon"}),t[48]||(t[48]=u(" 语义分段 ",-1))]),t[49]||(t[49]=n("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1))],2),n("div",{class:P(["select-card-item",{active:e.chunk_type==4}]),onClick:t[12]||(t[12]=l=>v(4))},[a(G,{class:"check-arrow",name:"check-arrow-filled"}),n("div",ct,[a(G,{name:"semantic-segmentation",class:"title-icon"}),t[50]||(t[50]=u(" 父子分段 ",-1))]),t[51]||(t[51]=n("div",{class:"card-desc"}," 基于文章中句号等符号进行分段，不会消耗模型token。父分段会拆分为若干子分段，子块用于检索，父块用作上下文 ",-1))],2),n("div",{class:P(["select-card-item",{active:e.chunk_type==3}]),onClick:t[13]||(t[13]=l=>v(3))},[a(G,{class:"check-arrow",name:"check-arrow-filled"}),n("div",ft,[a(G,{name:"semantic-segmentation",class:"title-icon"}),t[52]||(t[52]=u(" AI分段 ",-1))]),t[53]||(t[53]=n("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1))],2)])]),_:1}),e.chunk_type==1?(d(),f(D,{key:0},[a(i,{label:"分段标识符",required:""},{default:o(()=>[a(Z,{value:e.normal_chunk_default_separators_no,"onUpdate:value":t[14]||(t[14]=l=>e.normal_chunk_default_separators_no=l),mode:"tags",style:{width:"100%"},placeholder:"请选择分段标识符",options:y.value},null,8,["value","options"])]),_:1}),a(R,null,{default:o(()=>[a(i,{label:"分段最大长度",required:""},{default:o(()=>[a(R,{gap:8,align:"center"},{default:o(()=>[a(B,{value:e.normal_chunk_default_chunk_size,"onUpdate:value":t[15]||(t[15]=l=>e.normal_chunk_default_chunk_size=l),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[55]||(t[55]=u(" 字符 ",-1))]),_:1})]),_:1}),a(i,{label:"分段重叠长度"},{default:o(()=>[a(R,{gap:8,align:"center"},{default:o(()=>[a(B,{value:e.normal_chunk_default_chunk_overlap,"onUpdate:value":t[16]||(t[16]=l=>e.normal_chunk_default_chunk_overlap=l),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[56]||(t[56]=u(" 字符 ",-1))]),_:1})]),_:1})]),_:1}),n("div",mt,[n("div",vt,[t[57]||(t[57]=u(" 自动合并较小分段 ",-1)),a(E,{title:"开启后，如果分段长度不足设置的最大分段长度，会尝试与下一分段合并，直至合并后的分段字符数大于分段最大长度"},{default:o(()=>[a(C(W),{class:"ml4"})]),_:1})]),a(J,{checkedValue:"false",unCheckedValue:"true",checked:e.normal_chunk_default_not_merged_text,"onUpdate:checked":t[17]||(t[17]=l=>e.normal_chunk_default_not_merged_text=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])],64)):A("",!0),e.chunk_type==2?(d(),f(D,{key:1},[e.chunk_type==2?(d(),z(i,{key:0,required:""},{label:o(()=>[t[59]||(t[59]=u(" 分段阈值 ",-1)),a(E,null,{title:o(()=>[...t[58]||(t[58]=[u("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。",-1)])]),default:o(()=>[a(C(W),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:o(()=>[a(B,{value:e.semantic_chunk_default_threshold,"onUpdate:value":t[18]||(t[18]=l=>e.semantic_chunk_default_threshold=l),style:{width:"100%"},placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])]),_:1})):A("",!0),a(R,null,{default:o(()=>[a(i,{label:"分段最大长度",required:""},{default:o(()=>[a(R,{gap:8,align:"center"},{default:o(()=>[a(B,{value:e.semantic_chunk_default_chunk_size,"onUpdate:value":t[19]||(t[19]=l=>e.semantic_chunk_default_chunk_size=l),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[60]||(t[60]=u(" 字符 ",-1))]),_:1})]),_:1}),a(i,{label:"分段重叠长度"},{default:o(()=>[a(R,{gap:8,align:"center"},{default:o(()=>[a(B,{value:e.semantic_chunk_default_chunk_overlap,"onUpdate:value":t[20]||(t[20]=l=>e.semantic_chunk_default_chunk_overlap=l),style:{width:"230px"},precision:0,min:1,max:1e5},null,8,["value"]),t[61]||(t[61]=u(" 字符 ",-1))]),_:1})]),_:1})]),_:1})],64)):A("",!0),e.chunk_type==3?(d(),f(D,{key:2},[e.chunk_type==3?(d(),z(i,{key:0,required:""},{label:o(()=>[...t[62]||(t[62]=[u(" AI大模型 ",-1)])]),default:o(()=>[a(ge,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:e.ai_chunk_model,"onUpdate:modeName":t[21]||(t[21]=l=>e.ai_chunk_model=l),modeId:e.ai_chunk_model_config_id,"onUpdate:modeId":t[22]||(t[22]=l=>e.ai_chunk_model_config_id=l),style:{width:"100%"},onLoaded:O},null,8,["modeName","modeId"])]),_:1})):A("",!0),a(i,{label:"提示词设置",required:""},{default:o(()=>[a(R,{gap:8,align:"center"},{default:o(()=>[a(K,{maxLength:500,style:{height:"80px"},value:e.ai_chunk_prumpt,"onUpdate:value":t[23]||(t[23]=l=>e.ai_chunk_prumpt=l),placeholder:ye},null,8,["value"])]),_:1})]),_:1}),a(i,null,{label:o(()=>[t[64]||(t[64]=u(" 单次最大字符数 ",-1)),a(E,null,{title:o(()=>[...t[63]||(t[63]=[u("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。",-1)])]),default:o(()=>[a(C(W),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1})]),default:o(()=>[a(B,{class:"form-item-inptu-numbner",value:e.ai_chunk_size,"onUpdate:value":t[24]||(t[24]=l=>e.ai_chunk_size=l),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:l=>parseInt(l),parser:l=>parseInt(l)},null,8,["value","formatter","parser"]),t[65]||(t[65]=u(" 字符 ",-1))]),_:1})],64)):A("",!0),e.chunk_type==4?(d(),f(D,{key:3},[t[70]||(t[70]=n("div",{class:"main-title-block"},"父块（用作上下文）",-1)),a(i,{label:"分段类型"},{default:o(()=>[a(he,{value:e.father_chunk_paragraph_type,"onUpdate:value":t[25]||(t[25]=l=>e.father_chunk_paragraph_type=l)},{default:o(()=>[a(de,{value:1},{default:o(()=>[t[66]||(t[66]=u("全文 ",-1)),a(E,{title:"整个文档用作父块并直接检索。请注意，出于性能原因，超过 10000 个标记的文本将被自动截断。"},{default:o(()=>[a(C(W))]),_:1})]),_:1}),a(de,{value:2},{default:o(()=>[t[67]||(t[67]=u("段落 ",-1)),a(E,{title:"此模式根据分隔符和最大块长度将文本拆分为段落，使用拆分文本作为检索的父块"},{default:o(()=>[a(C(W))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),e.father_chunk_paragraph_type==2?(d(),z(i,{key:0,label:"分段标识符"},{default:o(()=>[a(Z,{placeholder:"请选择",style:{width:"100%"},mode:"tags",options:y.value,value:e.father_chunk_separators_no,"onUpdate:value":t[26]||(t[26]=l=>e.father_chunk_separators_no=l)},null,8,["options","value"])]),_:1})):A("",!0),e.father_chunk_paragraph_type==2?(d(),z(i,{key:1,label:"分段最大长度"},{default:o(()=>[a(R,{align:"center",gap:8},{default:o(()=>[a(B,{style:{flex:"1"},value:e.father_chunk_chunk_size,"onUpdate:value":t[27]||(t[27]=l=>e.father_chunk_chunk_size=l),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:l=>parseInt(l),parser:l=>parseInt(l)},null,8,["value","formatter","parser"]),t[68]||(t[68]=n("span",{class:"unit-text"},"字符",-1))]),_:1})]),_:1})):A("",!0),t[71]||(t[71]=n("div",{class:"main-title-block"},"子块（用于检索）",-1)),a(i,{label:"分段标识符"},{default:o(()=>[a(Z,{placeholder:"请选择",style:{width:"100%"},mode:"tags",options:y.value,value:e.son_chunk_separators_no,"onUpdate:value":t[28]||(t[28]=l=>e.son_chunk_separators_no=l)},null,8,["options","value"])]),_:1}),a(i,{label:"分段最大长度"},{default:o(()=>[a(R,{align:"center",gap:8},{default:o(()=>[a(B,{style:{flex:"1"},value:e.son_chunk_chunk_size,"onUpdate:value":t[29]||(t[29]=l=>e.son_chunk_chunk_size=l),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:l=>parseInt(l),parser:l=>parseInt(l)},null,8,["value","formatter","parser"]),t[69]||(t[69]=n("span",{class:"unit-text"},"字符",-1))]),_:1})]),_:1})],64)):A("",!0),oe(n("div",ht,[n("div",kt,[t[73]||(t[73]=u(" 生成知识图谱 ",-1)),a(E,null,{title:o(()=>[...t[72]||(t[72]=[u("文件分块后，所有块将用于生成知识图谱，提高复杂问题推理能力。",-1)])]),default:o(()=>[a(C(W),{class:"ml4"})]),_:1})]),a(J,{onChange:me,checked:e.graph_switch,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])],512),[[se,x.value]]),oe(a(i,{label:"知识图谱模型"},{default:o(()=>[a(ge,{modelType:"LLM",modeName:e.graph_use_model,"onUpdate:modeName":t[30]||(t[30]=l=>e.graph_use_model=l),modeId:e.graph_model_config_id,"onUpdate:modeId":t[31]||(t[31]=l=>e.graph_model_config_id=l),style:{width:"300px"},onLoaded:O},null,8,["modeName","modeId"])]),_:1},512),[[se,e.graph_switch&&x.value]])],512),[[se,!w.value&&(e.type==0||e.type==3)]])]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"]),a(g2,{onOk:j,ref_key:"openGrapgModalRef",ref:ie},null,512)],64)}}},yt=ae(gt,[["__scopeId","data-v-35cf3146"]]),bt={class:"form-item"},Ct={class:"form-content"},xt={__name:"add-group",emits:["ok"],setup(X,{expose:T,emit:U}){const x=p(!1),S=U,w=p("新建分组"),g=xe({group_name:"",id:""}),$=e=>{g.group_name=e.group_name||"",g.id=e.id||"",w.value=e.id?"编辑分组":"新建分组",x.value=!0},m=()=>{if(!g.group_name)return V.error("请输入分组名称");Pe({...g}).then(e=>{V.success(`${w.value}成功`),x.value=!1,S("ok")})};return T({show:$}),(e,_)=>{const y=Be,v=te;return d(),f("div",null,[a(v,{open:x.value,"onUpdate:open":_[1]||(_[1]=k=>x.value=k),title:w.value,onOk:m,zIndex:2e3},{default:o(()=>[n("div",bt,[_[2]||(_[2]=n("div",{class:"form-label"},"分组名称：",-1)),n("div",Ct,[a(y,{maxLength:15,value:g.group_name,"onUpdate:value":_[0]||(_[0]=k=>g.group_name=k),placeholder:"请输入分组名称"},null,8,["value"])])])]),_:1},8,["open","title"])])}}},wt=ae(xt,[["__scopeId","data-v-4b52c8e8"]]),$t={class:"form-item"},Lt={class:"form-content"},Mt={__name:"edit-group",emits:["ok"],setup(X,{expose:T,emit:U}){const x=p(!1),S=U,w=p("修改分组"),g=xe({group_id:"",library_id:""}),$=p([]),m=y=>{g.group_id=y.group_id||"0",g.library_id=y.id||"",_(),x.value=!0},e=()=>{if(!g.group_id)return V.error("请选择分组");je({...g}).then(y=>{V.success(`${w.value}成功`),x.value=!1,S("ok")})},_=()=>{Oe().then(y=>{$.value=y.data||[]})};return T({show:m}),(y,v)=>{const k=Fe,O=Re,c=te;return d(),f("div",null,[a(c,{open:x.value,"onUpdate:open":v[1]||(v[1]=b=>x.value=b),title:w.value,onOk:e},{default:o(()=>[n("div",$t,[v[2]||(v[2]=n("div",{class:"form-label"},"分组名称：",-1)),n("div",Lt,[a(O,{value:g.group_id,"onUpdate:value":v[0]||(v[0]=b=>g.group_id=b),style:{width:"100%"},placeholder:"请选择分组"},{default:o(()=>[(d(!0),f(D,null,Ge($.value,b=>(d(),z(k,{value:b.id},{default:o(()=>[u(Q(b.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])]),_:1},8,["open","title"])])}}},At=ae(Mt,[["__scopeId","data-v-62ebd416"]]),St={"bg-color":"#f5f9ff",class:"library-page"},It={class:"library-page-body"},Ot={class:"list-toolbar"},Gt={class:"toolbar-box"},Ut={class:"toolbar-box"},zt={class:"create-action"},Tt=["src"],qt={class:"create-action"},Bt=["src"],Rt={class:"list-group-box"},Ft={class:"group-head-box"},Nt={key:0,class:"head-title"},Vt={class:"classify-box",style:{"margin-top":"16px"}},Et=["onClick"],Ht={class:"classify-title"},Dt={key:0,class:"drag-btn"},Zt={key:1,style:{width:"20px",display:"inline-block"}},Pt={class:"right-content"},jt={key:0,class:"btn-box"},Jt={class:"hover-btn-wrap"},Qt=["onClick"],Kt=["onClick"],Yt={__name:"library-list",setup(X){var _e;Ue();const T=a2(),U=p([{title:"知识库",path:"/library/list"},{title:"数据库",path:"/database/list"},{title:"文档提取FAQ",path:"/ai-extract-faq/list"},{title:"触发次数统计",path:"/trigger-statics/list"}]),x=p([{title:"全部 (0)",value:"all"},{title:"普通知识库 (0)",value:"0"},{title:"问答知识库 (0)",value:"2"}]),S=Je();let{role_permission:w,role_type:g}=S;const $=fe(()=>g==1||w.includes("LibraryCreate")),m=p(null),e=p(null),_=p(null),y=p(null),v=p([]),k=p(String(((_e=T.query)==null?void 0:_e.active)||"all")),O=p("");let c="library-list-hide-group-key";const b=p(localStorage.getItem(c)==1),ie=()=>{b.value=!b.value,localStorage.setItem(c,b.value?1:0)},me=p(""),j=p([]);fe(()=>j.value.filter(l=>l.group_name.includes(me.value)));const ee=()=>{let l=k.value==="all"?"":k.value;Oe({type:l}).then(r=>{let M=r.data||[],h=0;M.forEach(H=>{h+=+H.total}),j.value=[{group_name:"全部",total:h,id:""},...M]})};ee();const le=l=>{l==3?_.value.open():re(l)},re=l=>{m.value.show({type:l,group_id:O.value})},ve=(l,r)=>{if(!r.length)return V.warning("请选择公众号");_.value.close(),m.value.show({type:3,group_id:O.value,wx_app_ids:l})},ne=p([]),s=async l=>{await w2({ability_type:"library_ability_official_account"}).then(F=>{var ue;let Y=(F==null?void 0:F.data)||{};((ue=Y==null?void 0:Y.user_config)==null?void 0:ue.switch_status)==1&&(y.value=Y)});let r=0,M=0,h=0,H=0;v.value=[],l.forEach(F=>{F.type==0&&(M+=1),F.type==2&&(h+=1),F.type==3&&(H+=1,v.value.push(F.official_app_id)),r+=1}),x.value=[{title:"全部 ("+r+")",value:"all"},{title:"普通知识库 ("+M+")",value:"0"},{title:"问答知识库 ("+h+")",value:"2"}],y.value&&x.value.push({title:"公众号知识库 ("+H+")",value:"3"})};let t=p([]);const L=()=>{let l=k.value==="all"?"":k.value;Me({type:l}).then(r=>{let M=r.data||[];M.forEach(h=>{h.file_size_str=Qe(h.file_size),h.avatar||(h.avatar=h.type==0?pe:ce)}),O.value!=""&&(M=M.filter(h=>h.group_id==O.value)),ne.value=M,k.value==="all"?(t.value=r.data,s(t.value)):Me().then(h=>{t.value=h.data,s(t.value)})})};L();const i=()=>{L(),ee()},K=l=>{l.type=="1"?window.open(`/#/public-library/config?library_id=${l.id}`,"_blank","noopener"):window.open(`/#/library/details?id=${l.id}`,"_blank","noopener")},q=l=>{if(We(l.id)!=4)return V.error("您没有删除该知识库的权限");let M=3,h=te.confirm({title:`删除${l.library_name}`,icon:a(Se),content:"您确定要删除此知识库吗？",okText:M+" 确 定",okType:"danger",okButtonProps:{disabled:!0},cancelText:"取 消",onOk(){Z(l)},onCancel(){}}),H=setInterval(()=>{M==1?(h.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(H),H=void 0):(M-=1,h.update({okText:M+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},Z=({id:l})=>{Xe({id:l}).then(()=>{V.success("删除成功"),L(),ee()})},J=l=>{O.value=l.id,L()},E=p(null),G=l=>{E.value.show({...l})},B=p(null),R=l=>{B.value.show({...l})},de=l=>{te.confirm({title:`确认删除分组${l.group_name}`,icon:a(Se),content:"",okText:"确认",okType:"danger",cancelText:"取消",onOk(){Ye({id:l.id}).then(()=>{V.success("删除成功"),ee(),O.value==l.id&&(O.value=""),L()})}})};p(!1);const he=l=>l.draggedContext.element.id>0&&l.relatedContext.element.id>0,ke=async()=>{try{const l=j.value.filter(r=>r.id>0).map((r,M)=>({id:r.id,sort:j.value.length-M}));await Ke({sort_group:JSON.stringify(l)}),V.success("排序已保存")}catch(l){console.error("排序保存失败:",l),getGroupLists()}};return(l,r)=>{const M=f2,h=Te,H=ze,F=qe,Y=we,ue=Ce,$e=Ne;return d(),f("div",St,[a(y2,{class:"mb-16",tabs:U.value,active:"/library/list"},null,8,["tabs"]),a(b2,{class:"mb-16 mr-16",title:"使用说明"},{default:o(()=>[...r[7]||(r[7]=[n("div",null,[n("p",null," 1、知识库可以关联到聊天机器人中使用，创建机器人之前请先创建知识库，然后去机器人设置中关联。 "),n("p",null," 2、知识库支持普通知识库和问答知识库。普通知识库适用于非结构化数据，支持text/doc/pdf/md/html等格式文件，上传后系统会自动分段处理，也支持自定义分段。问答知识库适用于一问一答形式结构化数据，支持通过excel/word批量上传或自定义添加问题和答案。 ")],-1)])]),_:1}),n("div",It,[n("div",Ot,[n("div",Gt,[a(C2,{tabs:x.value,value:k.value,"onUpdate:value":r[0]||(r[0]=I=>k.value=I),onChange:i},null,8,["tabs","value"])]),n("div",Ut,[$.value?(d(),z(F,{key:0},{overlay:o(()=>[a(H,null,{default:o(()=>[a(h,{onClick:r[2]||(r[2]=N(I=>le(0),["prevent"]))},{default:o(()=>[n("span",zt,[n("img",{class:"icon",src:C(pe),alt:""},null,8,Tt),r[9]||(r[9]=n("span",null,"普通知识库",-1))])]),_:1}),a(h,{onClick:r[3]||(r[3]=N(I=>le(2),["prevent"]))},{default:o(()=>[n("span",qt,[n("img",{class:"icon",src:C(ce),alt:""},null,8,Bt),r[10]||(r[10]=n("span",null,"问答知识库",-1))])]),_:1}),y.value?(d(),z(h,{key:0,onClick:r[4]||(r[4]=N(I=>le(3),["prevent"]))},{default:o(()=>[...r[11]||(r[11]=[n("span",{class:"create-action"},[n("img",{class:"icon",src:L2,alt:""}),n("span",null,"公众号知识库")],-1)])]),_:1})):A("",!0)]),_:1})]),default:o(()=>[a(M,{type:"primary",onClick:r[1]||(r[1]=N(()=>{},["prevent"]))},{icon:o(()=>[a(C(Ae))]),default:o(()=>[r[8]||(r[8]=u(" 新建知识库 ",-1))]),_:1})]),_:1})):A("",!0)])]),n("div",Rt,[n("div",{class:P(["group-list-box",{"hide-group":b.value}])},[a($e,{style:{"padding-right":"16px"}},{default:o(()=>[n("div",Ft,[b.value?A("",!0):(d(),f("div",Nt,[r[12]||(r[12]=n("div",null,"知识库分组",-1)),a(Y,{title:"新建分组"},{default:o(()=>[n("div",{class:"hover-btn-wrap",onClick:r[5]||(r[5]=I=>G({}))},[a(C(Ae))])]),_:1})]))]),n("div",Vt,[a(C(x2),{modelValue:j.value,"onUpdate:modelValue":r[6]||(r[6]=I=>j.value=I),"item-key":"id",onEnd:ke,move:he,handle:".drag-btn"},{item:o(({element:I})=>[n("div",{class:P(["classify-item",{active:I.id==O.value}]),onClick:Le=>J(I)},[n("div",Ht,[I.id>0?(d(),f("span",Dt,[a(ue,{name:"drag"})])):(d(),f("span",Zt)),u(" "+Q(I.group_name),1)]),n("div",Pt,[n("div",{class:P(["num",{"num-block":I.id<=0}])},Q(I.total),3),I.id>0?(d(),f("div",jt,[a(F,{placement:"bottomRight"},{overlay:o(()=>[a(H,null,{default:o(()=>[a(h,null,{default:o(()=>[n("div",{onClick:N(Le=>G(I),["stop"])},"重命名",8,Qt)]),_:2},1024),a(h,null,{default:o(()=>[n("div",{onClick:N(Le=>de(I),["stop"])},"删 除",8,Kt)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",Jt,[a(C(m2))])]),_:2},1024)])):A("",!0)])],10,Et)]),_:1},8,["modelValue"])])]),_:1}),a(Y,{placement:"right",title:b.value?"展开分组":"收起分组"},{default:o(()=>[n("div",{class:"hide-group-box",onClick:ie},[b.value?(d(),z(C(be),{key:1})):(d(),z(C(v2),{key:0}))])]),_:1},8,["title"])],2),a($e,{style:{"padding-right":"16px",flex:"1"}},{default:o(()=>[a(K2,{"show-create":$.value,list:ne.value,onEdit:K,onDelete:q,onOpenEditGroupModal:R},null,8,["show-create","list"])]),_:1})])]),a(ot,{ref_key:"addLibrayPopup",ref:e,onOk:re},null,512),a(yt,{ref_key:"addLibraryModelRef",ref:m},null,512),a(wt,{ref_key:"addGroupRef",ref:E,onOk:i},null,512),a(At,{ref_key:"editGroupRef",ref:B,onOk:i},null,512),a($2,{ref_key:"wxAppRef",ref:_,title:"添加知识库",okText:"下一步","disabled-app-ids":v.value,onOk:ve},null,8,["disabled-app-ids"])])}}},ya=ae(Yt,[["__scopeId","data-v-c737e256"]]);export{ya as default};
